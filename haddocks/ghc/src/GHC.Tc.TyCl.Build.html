<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><link rel="stylesheet" type="text/css" href="style.css" /><script type="text/javascript" src="highlight.js"></script></head><body><pre><span class="hs-comment">{-
(c) The University of Glasgow 2006
(c) The GRASP/AQUA Project, Glasgow University, 1992-1998
-}</span><span>
</span><span id="line-5"></span><span>
</span><span id="line-6"></span><span>
</span><span id="line-7"></span><span class="hs-pragma">{-# OPTIONS_GHC -Wno-incomplete-uni-patterns #-}</span><span>
</span><span id="line-8"></span><span>
</span><span id="line-9"></span><span class="hs-keyword">module</span><span> </span><span class="annot"><a href="GHC.Tc.TyCl.Build.html"><span class="hs-identifier">GHC.Tc.TyCl.Build</span></a></span><span> </span><span class="hs-special">(</span><span>
</span><span id="line-10"></span><span>        </span><span class="annot"><a href="GHC.Tc.TyCl.Build.html#buildDataCon"><span class="hs-identifier">buildDataCon</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-11"></span><span>        </span><span class="annot"><a href="GHC.Tc.TyCl.Build.html#buildPatSyn"><span class="hs-identifier">buildPatSyn</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-12"></span><span>        </span><span class="annot"><a href="GHC.Tc.TyCl.Build.html#TcMethInfo"><span class="hs-identifier">TcMethInfo</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Tc.TyCl.Build.html#MethInfo"><span class="hs-identifier">MethInfo</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Tc.TyCl.Build.html#buildClass"><span class="hs-identifier">buildClass</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-13"></span><span>        </span><span class="annot"><a href="GHC.Tc.TyCl.Build.html#mkNewTyConRhs"><span class="hs-identifier">mkNewTyConRhs</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-14"></span><span>        </span><span class="annot"><a href="GHC.Tc.TyCl.Build.html#newImplicitBinder"><span class="hs-identifier">newImplicitBinder</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Tc.TyCl.Build.html#newTyConRepName"><span class="hs-identifier">newTyConRepName</span></a></span><span>
</span><span id="line-15"></span><span>    </span><span class="hs-special">)</span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-16"></span><span>
</span><span id="line-17"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Prelude.html"><span class="hs-identifier">GHC.Prelude</span></a></span><span>
</span><span id="line-18"></span><span>
</span><span id="line-19"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Iface.Env.html"><span class="hs-identifier">GHC.Iface.Env</span></a></span><span>
</span><span id="line-20"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Builtin.Types.html"><span class="hs-identifier">GHC.Builtin.Types</span></a></span><span>
</span><span id="line-21"></span><span>
</span><span id="line-22"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.TcType.html"><span class="hs-identifier">GHC.Tc.Utils.TcType</span></a></span><span>
</span><span id="line-23"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.Monad.html"><span class="hs-identifier">GHC.Tc.Utils.Monad</span></a></span><span>
</span><span id="line-24"></span><span>
</span><span id="line-25"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Core.DataCon.html"><span class="hs-identifier">GHC.Core.DataCon</span></a></span><span>
</span><span id="line-26"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Core.PatSyn.html"><span class="hs-identifier">GHC.Core.PatSyn</span></a></span><span>
</span><span id="line-27"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Core.Class.html"><span class="hs-identifier">GHC.Core.Class</span></a></span><span>
</span><span id="line-28"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Core.TyCon.html"><span class="hs-identifier">GHC.Core.TyCon</span></a></span><span>
</span><span id="line-29"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Core.Type.html"><span class="hs-identifier">GHC.Core.Type</span></a></span><span>
</span><span id="line-30"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Core.Multiplicity.html"><span class="hs-identifier">GHC.Core.Multiplicity</span></a></span><span>
</span><span id="line-31"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Core.FamInstEnv.html"><span class="hs-identifier">GHC.Core.FamInstEnv</span></a></span><span class="hs-special">(</span><span> </span><span class="annot"><a href="GHC.Core.FamInstEnv.html#FamInstEnvs"><span class="hs-identifier">FamInstEnvs</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Core.FamInstEnv.html#mkNewTypeCoAxiom"><span class="hs-identifier">mkNewTypeCoAxiom</span></a></span><span> </span><span class="hs-special">)</span><span>
</span><span id="line-32"></span><span>
</span><span id="line-33"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Types.SrcLoc.html"><span class="hs-identifier">GHC.Types.SrcLoc</span></a></span><span class="hs-special">(</span><span> </span><span class="annot"><a href="GHC.Types.SrcLoc.html#SrcSpan"><span class="hs-identifier">SrcSpan</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Types.SrcLoc.html#noSrcSpan"><span class="hs-identifier">noSrcSpan</span></a></span><span> </span><span class="hs-special">)</span><span>
</span><span id="line-34"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Types.Var.html"><span class="hs-identifier">GHC.Types.Var</span></a></span><span>
</span><span id="line-35"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Types.Var.Set.html"><span class="hs-identifier">GHC.Types.Var.Set</span></a></span><span>
</span><span id="line-36"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Types.Basic.html"><span class="hs-identifier">GHC.Types.Basic</span></a></span><span>
</span><span id="line-37"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Types.Name.html"><span class="hs-identifier">GHC.Types.Name</span></a></span><span>
</span><span id="line-38"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Types.Name.Env.html"><span class="hs-identifier">GHC.Types.Name.Env</span></a></span><span>
</span><span id="line-39"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Types.Id.Make.html"><span class="hs-identifier">GHC.Types.Id.Make</span></a></span><span>
</span><span id="line-40"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Types.SourceText.html"><span class="hs-identifier">GHC.Types.SourceText</span></a></span><span>
</span><span id="line-41"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Types.Unique.Supply.html"><span class="hs-identifier">GHC.Types.Unique.Supply</span></a></span><span>
</span><span id="line-42"></span><span>
</span><span id="line-43"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Utils.Misc.html"><span class="hs-identifier">GHC.Utils.Misc</span></a></span><span>
</span><span id="line-44"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Utils.Outputable.html"><span class="hs-identifier">GHC.Utils.Outputable</span></a></span><span>
</span><span id="line-45"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Utils.Panic.html"><span class="hs-identifier">GHC.Utils.Panic</span></a></span><span>
</span><span id="line-46"></span><span>
</span><span id="line-47"></span><span>
</span><span id="line-48"></span><span id="local-6989586621682987293"><span id="local-6989586621682987294"><span class="annot"><a href="GHC.Tc.TyCl.Build.html#mkNewTyConRhs"><span class="hs-identifier hs-type">mkNewTyConRhs</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Types.Name.html#Name"><span class="hs-identifier hs-type">Name</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Core.TyCon.html#TyCon"><span class="hs-identifier hs-type">TyCon</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Core.DataCon.html#DataCon"><span class="hs-identifier hs-type">DataCon</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#TcRnIf"><span class="hs-identifier hs-type">TcRnIf</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682987293"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682987294"><span class="hs-identifier hs-type">n</span></a></span><span> </span><span class="annot"><a href="GHC.Core.TyCon.html#AlgTyConRhs"><span class="hs-identifier hs-type">AlgTyConRhs</span></a></span></span></span><span>
</span><span id="line-49"></span><span class="hs-comment">-- ^ Monadic because it makes a Name for the coercion TyCon</span><span>
</span><span id="line-50"></span><span class="hs-comment">--   We pass the Name of the parent TyCon, as well as the TyCon itself,</span><span>
</span><span id="line-51"></span><span class="hs-comment">--   because the latter is part of a knot, whereas the former is not.</span><span>
</span><span id="line-52"></span><span id="mkNewTyConRhs"><span class="annot"><span class="annottext">mkNewTyConRhs :: forall m n. Name -&gt; TyCon -&gt; DataCon -&gt; TcRnIf m n AlgTyConRhs
</span><a href="GHC.Tc.TyCl.Build.html#mkNewTyConRhs"><span class="hs-identifier hs-var hs-var">mkNewTyConRhs</span></a></span></span><span> </span><span id="local-6989586621682987499"><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621682987499"><span class="hs-identifier hs-var">tycon_name</span></a></span></span><span> </span><span id="local-6989586621682987500"><span class="annot"><span class="annottext">TyCon
</span><a href="#local-6989586621682987500"><span class="hs-identifier hs-var">tycon</span></a></span></span><span> </span><span id="local-6989586621682987501"><span class="annot"><span class="annottext">DataCon
</span><a href="#local-6989586621682987501"><span class="hs-identifier hs-var">con</span></a></span></span><span>
</span><span id="line-53"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>  </span><span class="hs-special">{</span><span> </span><span id="local-6989586621682987502"><span class="annot"><a href="#local-6989586621682987502"><span class="hs-identifier hs-var">co_tycon_name</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Name -&gt; (OccName -&gt; OccName) -&gt; TcRnIf m n Name
forall m n. Name -&gt; (OccName -&gt; OccName) -&gt; TcRnIf m n Name
</span><a href="GHC.Tc.TyCl.Build.html#newImplicitBinder"><span class="hs-identifier hs-var">newImplicitBinder</span></a></span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621682987499"><span class="hs-identifier hs-var">tycon_name</span></a></span><span> </span><span class="annot"><span class="annottext">OccName -&gt; OccName
</span><a href="GHC.Types.Name.Occurrence.html#mkNewTyCoOcc"><span class="hs-identifier hs-var">mkNewTyCoOcc</span></a></span><span>
</span><span id="line-54"></span><span>        </span><span class="hs-special">;</span><span> </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621682987504"><span class="annot"><a href="#local-6989586621682987504"><span class="hs-identifier hs-var hs-var">nt_ax</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Name -&gt; TyCon -&gt; [TyVar] -&gt; [Role] -&gt; Type -&gt; CoAxiom Unbranched
</span><a href="GHC.Core.FamInstEnv.html#mkNewTypeCoAxiom"><span class="hs-identifier hs-var">mkNewTypeCoAxiom</span></a></span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621682987502"><span class="hs-identifier hs-var">co_tycon_name</span></a></span><span> </span><span class="annot"><span class="annottext">TyCon
</span><a href="#local-6989586621682987500"><span class="hs-identifier hs-var">tycon</span></a></span><span> </span><span class="annot"><span class="annottext">[TyVar]
</span><a href="#local-6989586621682987505"><span class="hs-identifier hs-var">etad_tvs</span></a></span><span> </span><span class="annot"><span class="annottext">[Role]
</span><a href="#local-6989586621682987506"><span class="hs-identifier hs-var">etad_roles</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682987507"><span class="hs-identifier hs-var">etad_rhs</span></a></span><span>
</span><span id="line-55"></span><span>        </span><span class="hs-special">;</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.Monad.html#traceIf"><span class="hs-identifier hs-type">traceIf</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Utils.Outputable.html#text"><span class="hs-identifier hs-type">text</span></a></span><span> </span><span class="annot"><span class="hs-string">&quot;mkNewTyConRhs&quot;</span></span><span> </span><span class="annot"><a href="GHC.Utils.Outputable.html#%3C%2B%3E"><span class="hs-operator hs-type">&lt;+&gt;</span></a></span><span> </span><span class="annot"><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-type">ppr</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682987504"><span class="hs-identifier hs-type">nt_ax</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-56"></span><span>        </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">return</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Core.TyCon.html#NewTyCon"><span class="hs-identifier hs-type">NewTyCon</span></a></span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><a href="GHC.Core.TyCon.html#data_con"><span class="hs-identifier hs-var">data_con</span></a></span><span>     </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="#local-6989586621682987501"><span class="hs-identifier hs-type">con</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-57"></span><span>                             </span><span class="annot"><a href="GHC.Core.TyCon.html#nt_rhs"><span class="hs-identifier hs-var">nt_rhs</span></a></span><span>       </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="#local-6989586621682987515"><span class="hs-identifier hs-type">rhs_ty</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-58"></span><span>                             </span><span class="annot"><a href="GHC.Core.TyCon.html#nt_etad_rhs"><span class="hs-identifier hs-var">nt_etad_rhs</span></a></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621682987505"><span class="hs-identifier hs-type">etad_tvs</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="#local-6989586621682987507"><span class="hs-identifier hs-type">etad_rhs</span></a></span><span class="hs-special">)</span><span class="hs-special">,</span><span>
</span><span id="line-59"></span><span>                             </span><span class="annot"><a href="GHC.Core.TyCon.html#nt_co"><span class="hs-identifier hs-var">nt_co</span></a></span><span>        </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="#local-6989586621682987504"><span class="hs-identifier hs-type">nt_ax</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-60"></span><span>                             </span><span class="annot"><a href="GHC.Core.TyCon.html#nt_fixed_rep"><span class="hs-identifier hs-var">nt_fixed_rep</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="GHC.Core.Type.html#isFixedRuntimeRepKind"><span class="hs-identifier hs-type">isFixedRuntimeRepKind</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682987520"><span class="hs-identifier hs-type">res_kind</span></a></span><span> </span><span class="hs-special">}</span><span> </span><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-61"></span><span>                             </span><span class="hs-comment">-- Coreview looks through newtypes with a Nothing</span><span>
</span><span id="line-62"></span><span>                             </span><span class="hs-comment">-- for nt_co, or uses explicit coercions otherwise</span><span>
</span><span id="line-63"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-64"></span><span>    </span><span id="local-6989586621682987521"><span class="annot"><span class="annottext">tvs :: [TyVar]
</span><a href="#local-6989586621682987521"><span class="hs-identifier hs-var hs-var">tvs</span></a></span></span><span>      </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">TyCon -&gt; [TyVar]
</span><a href="GHC.Core.TyCon.html#tyConTyVars"><span class="hs-identifier hs-var">tyConTyVars</span></a></span><span> </span><span class="annot"><span class="annottext">TyCon
</span><a href="#local-6989586621682987500"><span class="hs-identifier hs-var">tycon</span></a></span><span>
</span><span id="line-65"></span><span>    </span><span id="local-6989586621682987523"><span class="annot"><span class="annottext">roles :: [Role]
</span><a href="#local-6989586621682987523"><span class="hs-identifier hs-var hs-var">roles</span></a></span></span><span>    </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">TyCon -&gt; [Role]
</span><a href="GHC.Core.TyCon.html#tyConRoles"><span class="hs-identifier hs-var">tyConRoles</span></a></span><span> </span><span class="annot"><span class="annottext">TyCon
</span><a href="#local-6989586621682987500"><span class="hs-identifier hs-var">tycon</span></a></span><span>
</span><span id="line-66"></span><span>    </span><span id="local-6989586621682987520"><span class="annot"><span class="annottext">res_kind :: Type
</span><a href="#local-6989586621682987520"><span class="hs-identifier hs-var hs-var">res_kind</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">TyCon -&gt; Type
</span><a href="GHC.Core.TyCon.html#tyConResKind"><span class="hs-identifier hs-var">tyConResKind</span></a></span><span> </span><span class="annot"><span class="annottext">TyCon
</span><a href="#local-6989586621682987500"><span class="hs-identifier hs-var">tycon</span></a></span><span>
</span><span id="line-67"></span><span>    </span><span id="local-6989586621682987515"><span class="annot"><span class="annottext">rhs_ty :: Type
</span><a href="#local-6989586621682987515"><span class="hs-identifier hs-var hs-var">rhs_ty</span></a></span></span><span>
</span><span id="line-68"></span><span>      </span><span class="hs-comment">-- Only try if the newtype is actually valid (see &quot;otherwise&quot; below).</span><span>
</span><span id="line-69"></span><span>      </span><span class="hs-glyph">|</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#Scaled"><span class="hs-identifier hs-type">Scaled</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621682987527"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682987527"><span class="hs-identifier hs-var">arg_ty</span></a></span></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">DataCon -&gt; [Scaled Type]
</span><a href="GHC.Core.DataCon.html#dataConRepArgTys"><span class="hs-identifier hs-var">dataConRepArgTys</span></a></span><span> </span><span class="annot"><span class="annottext">DataCon
</span><a href="#local-6989586621682987501"><span class="hs-identifier hs-var">con</span></a></span><span>
</span><span id="line-70"></span><span>      </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">[TyVar] -&gt; Bool
forall a. [a] -&gt; Bool
forall (t :: * -&gt; *) a. Foldable t =&gt; t a -&gt; Bool
</span><span class="hs-identifier hs-var">null</span></span><span> </span><span class="annot"><span class="annottext">([TyVar] -&gt; Bool) -&gt; [TyVar] -&gt; Bool
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">DataCon -&gt; [TyVar]
</span><a href="GHC.Core.DataCon.html#dataConExTyCoVars"><span class="hs-identifier hs-var">dataConExTyCoVars</span></a></span><span> </span><span class="annot"><span class="annottext">DataCon
</span><a href="#local-6989586621682987501"><span class="hs-identifier hs-var">con</span></a></span><span>
</span><span id="line-71"></span><span>      </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[TyVar] -&gt; ThetaType -&gt; Type -&gt; Type
HasDebugCallStack =&gt; [TyVar] -&gt; ThetaType -&gt; Type -&gt; Type
</span><a href="GHC.Core.TyCo.Subst.html#substTyWith"><span class="hs-identifier hs-var">substTyWith</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">DataCon -&gt; [TyVar]
</span><a href="GHC.Core.DataCon.html#dataConUnivTyVars"><span class="hs-identifier hs-var">dataConUnivTyVars</span></a></span><span> </span><span class="annot"><span class="annottext">DataCon
</span><a href="#local-6989586621682987501"><span class="hs-identifier hs-var">con</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-72"></span><span>                         </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[TyVar] -&gt; ThetaType
</span><a href="GHC.Core.TyCo.Rep.html#mkTyVarTys"><span class="hs-identifier hs-var">mkTyVarTys</span></a></span><span> </span><span class="annot"><span class="annottext">[TyVar]
</span><a href="#local-6989586621682987521"><span class="hs-identifier hs-var">tvs</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682987527"><span class="hs-identifier hs-var">arg_ty</span></a></span><span>
</span><span id="line-73"></span><span>        </span><span class="hs-comment">-- Instantiate the newtype's RHS with the</span><span>
</span><span id="line-74"></span><span>        </span><span class="hs-comment">-- type variables from the tycon</span><span>
</span><span id="line-75"></span><span>        </span><span class="hs-comment">-- NB: a newtype DataCon has a type that must look like</span><span>
</span><span id="line-76"></span><span>        </span><span class="hs-comment">--        forall tvs.  &lt;arg-ty&gt; -&gt; T tvs</span><span>
</span><span id="line-77"></span><span>        </span><span class="hs-comment">-- Note that we *can't* use dataConInstOrigArgTys here because</span><span>
</span><span id="line-78"></span><span>        </span><span class="hs-comment">-- the newtype arising from   class Foo a =&gt; Bar a where {}</span><span>
</span><span id="line-79"></span><span>        </span><span class="hs-comment">-- has a single argument (Foo a) that is a *type class*, so</span><span>
</span><span id="line-80"></span><span>        </span><span class="hs-comment">-- dataConInstOrigArgTys returns [].</span><span>
</span><span id="line-81"></span><span>      </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">otherwise</span></span><span>
</span><span id="line-82"></span><span>      </span><span class="hs-comment">-- If the newtype is invalid (e.g. doesn't have a single argument),</span><span>
</span><span id="line-83"></span><span>      </span><span class="hs-comment">-- we fake up a type here. The newtype will get rejected once we're</span><span>
</span><span id="line-84"></span><span>      </span><span class="hs-comment">-- outside the knot-tied loop, in GHC.Tc.TyCl.checkNewDataCon.</span><span>
</span><span id="line-85"></span><span>      </span><span class="hs-comment">-- See the various test cases in T23308.</span><span>
</span><span id="line-86"></span><span>      </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="GHC.Builtin.Types.html#unitTy"><span class="hs-identifier hs-var">unitTy</span></a></span><span> </span><span class="hs-comment">-- Might be ill-kinded, but checkNewDataCon should reject this</span><span>
</span><span id="line-87"></span><span>               </span><span class="hs-comment">-- whole declaration soon enough, before that causes any problems.</span><span>
</span><span id="line-88"></span><span>
</span><span id="line-89"></span><span>    </span><span class="hs-comment">-- Eta-reduce the newtype</span><span>
</span><span id="line-90"></span><span>    </span><span class="hs-comment">-- See Note [Newtype eta] in GHC.Core.TyCon</span><span>
</span><span id="line-91"></span><span>    </span><span class="annot"><a href="#local-6989586621682987505"><span class="hs-identifier hs-type">etad_tvs</span></a></span><span>   </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="GHC.Types.Var.html#TyVar"><span class="hs-identifier hs-type">TyVar</span></a></span><span class="hs-special">]</span><span>  </span><span class="hs-comment">-- Matched lazily, so that mkNewTypeCo can</span><span>
</span><span id="line-92"></span><span>    </span><span class="annot"><a href="#local-6989586621682987506"><span class="hs-identifier hs-type">etad_roles</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="Language.Haskell.Syntax.Basic.html#Role"><span class="hs-identifier hs-type">Role</span></a></span><span class="hs-special">]</span><span>   </span><span class="hs-comment">-- return a TyCon without pulling on rhs_ty</span><span>
</span><span id="line-93"></span><span>    </span><span class="annot"><a href="#local-6989586621682987507"><span class="hs-identifier hs-type">etad_rhs</span></a></span><span>   </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#Type"><span class="hs-identifier hs-type">Type</span></a></span><span>     </span><span class="hs-comment">-- See Note [Tricky iface loop] in GHC.Iface.Load</span><span>
</span><span id="line-94"></span><span>    </span><span class="hs-special">(</span><span id="local-6989586621682987505"><span class="annot"><span class="annottext">[TyVar]
</span><a href="#local-6989586621682987505"><span class="hs-identifier hs-var">etad_tvs</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682987506"><span class="annot"><span class="annottext">[Role]
</span><a href="#local-6989586621682987506"><span class="hs-identifier hs-var">etad_roles</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682987507"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682987507"><span class="hs-identifier hs-var">etad_rhs</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[TyVar] -&gt; [Role] -&gt; Type -&gt; ([TyVar], [Role], Type)
</span><a href="#local-6989586621682987535"><span class="hs-identifier hs-var">eta_reduce</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[TyVar] -&gt; [TyVar]
forall a. [a] -&gt; [a]
</span><span class="hs-identifier hs-var">reverse</span></span><span> </span><span class="annot"><span class="annottext">[TyVar]
</span><a href="#local-6989586621682987521"><span class="hs-identifier hs-var">tvs</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[Role] -&gt; [Role]
forall a. [a] -&gt; [a]
</span><span class="hs-identifier hs-var">reverse</span></span><span> </span><span class="annot"><span class="annottext">[Role]
</span><a href="#local-6989586621682987523"><span class="hs-identifier hs-var">roles</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682987515"><span class="hs-identifier hs-var">rhs_ty</span></a></span><span>
</span><span id="line-95"></span><span>
</span><span id="line-96"></span><span>    </span><span class="annot"><a href="#local-6989586621682987535"><span class="hs-identifier hs-type">eta_reduce</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="GHC.Types.Var.html#TyVar"><span class="hs-identifier hs-type">TyVar</span></a></span><span class="hs-special">]</span><span>       </span><span class="hs-comment">-- Reversed</span><span>
</span><span id="line-97"></span><span>               </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="Language.Haskell.Syntax.Basic.html#Role"><span class="hs-identifier hs-type">Role</span></a></span><span class="hs-special">]</span><span>        </span><span class="hs-comment">-- also reversed</span><span>
</span><span id="line-98"></span><span>               </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#Type"><span class="hs-identifier hs-type">Type</span></a></span><span>          </span><span class="hs-comment">-- Rhs type</span><span>
</span><span id="line-99"></span><span>               </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="hs-special">[</span><span class="annot"><a href="GHC.Types.Var.html#TyVar"><span class="hs-identifier hs-type">TyVar</span></a></span><span class="hs-special">]</span><span class="hs-special">,</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="Language.Haskell.Syntax.Basic.html#Role"><span class="hs-identifier hs-type">Role</span></a></span><span class="hs-special">]</span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#Type"><span class="hs-identifier hs-type">Type</span></a></span><span class="hs-special">)</span><span>  </span><span class="hs-comment">-- Eta-reduced version</span><span>
</span><span id="line-100"></span><span>                                           </span><span class="hs-comment">-- (tyvars in normal order)</span><span>
</span><span id="line-101"></span><span>    </span><span id="local-6989586621682987535"><span class="annot"><span class="annottext">eta_reduce :: [TyVar] -&gt; [Role] -&gt; Type -&gt; ([TyVar], [Role], Type)
</span><a href="#local-6989586621682987535"><span class="hs-identifier hs-var hs-var">eta_reduce</span></a></span></span><span> </span><span class="hs-special">(</span><span id="local-6989586621682987537"><span class="annot"><span class="annottext">TyVar
</span><a href="#local-6989586621682987537"><span class="hs-identifier hs-var">a</span></a></span></span><span class="annot"><span class="hs-glyph hs-type">:</span></span><span id="local-6989586621682987538"><span class="annot"><span class="annottext">[TyVar]
</span><a href="#local-6989586621682987538"><span class="hs-keyword hs-var">as</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Role
</span><span class="hs-identifier">_</span></span><span class="annot"><span class="hs-glyph hs-type">:</span></span><span id="local-6989586621682987539"><span class="annot"><span class="annottext">[Role]
</span><a href="#local-6989586621682987539"><span class="hs-identifier hs-var">rs</span></a></span></span><span class="hs-special">)</span><span> </span><span id="local-6989586621682987540"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682987540"><span class="hs-identifier hs-var">ty</span></a></span></span><span>
</span><span id="line-102"></span><span>      </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span class="hs-special">(</span><span id="local-6989586621682987541"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682987541"><span class="hs-identifier hs-var">fun</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682987542"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682987542"><span class="hs-identifier hs-var">arg</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Type -&gt; Maybe (Type, Type)
</span><a href="GHC.Core.Type.html#splitAppTy_maybe"><span class="hs-identifier hs-var">splitAppTy_maybe</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682987540"><span class="hs-identifier hs-var">ty</span></a></span><span>
</span><span id="line-103"></span><span>      </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span id="local-6989586621682987544"><span class="annot"><span class="annottext">TyVar
</span><a href="#local-6989586621682987544"><span class="hs-identifier hs-var">tv</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Type -&gt; Maybe TyVar
</span><a href="GHC.Core.Type.html#getTyVar_maybe"><span class="hs-identifier hs-var">getTyVar_maybe</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682987542"><span class="hs-identifier hs-var">arg</span></a></span><span>
</span><span id="line-104"></span><span>      </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">TyVar
</span><a href="#local-6989586621682987544"><span class="hs-identifier hs-var">tv</span></a></span><span> </span><span class="annot"><span class="annottext">TyVar -&gt; TyVar -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">==</span></span><span> </span><span class="annot"><span class="annottext">TyVar
</span><a href="#local-6989586621682987537"><span class="hs-identifier hs-var">a</span></a></span><span>
</span><span id="line-105"></span><span>      </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Bool
</span><span class="hs-identifier hs-var">not</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TyVar
</span><a href="#local-6989586621682987537"><span class="hs-identifier hs-var">a</span></a></span><span> </span><span class="annot"><span class="annottext">TyVar -&gt; VarSet -&gt; Bool
</span><a href="GHC.Types.Var.Set.html#elemVarSet"><span class="hs-operator hs-var">`elemVarSet`</span></a></span><span> </span><span class="annot"><span class="annottext">Type -&gt; VarSet
</span><a href="GHC.Core.TyCo.FVs.html#tyCoVarsOfType"><span class="hs-identifier hs-var">tyCoVarsOfType</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682987541"><span class="hs-identifier hs-var">fun</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-106"></span><span>      </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">HasDebugCallStack =&gt; Type -&gt; Type
Type -&gt; Type
</span><a href="GHC.Core.Type.html#typeKind"><span class="hs-identifier hs-var">typeKind</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682987541"><span class="hs-identifier hs-var">fun</span></a></span><span> </span><span class="annot"><span class="annottext">HasCallStack =&gt; Type -&gt; Type -&gt; Bool
Type -&gt; Type -&gt; Bool
</span><a href="GHC.Core.TyCo.Compare.html#eqType"><span class="hs-operator hs-var">`eqType`</span></a></span><span> </span><span class="annot"><span class="annottext">HasDebugCallStack =&gt; Type -&gt; Type
Type -&gt; Type
</span><a href="GHC.Core.Type.html#typeKind"><span class="hs-identifier hs-var">typeKind</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TyCon -&gt; ThetaType -&gt; Type
</span><a href="GHC.Core.Type.html#mkTyConApp"><span class="hs-identifier hs-var">mkTyConApp</span></a></span><span> </span><span class="annot"><span class="annottext">TyCon
</span><a href="#local-6989586621682987500"><span class="hs-identifier hs-var">tycon</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[TyVar] -&gt; ThetaType
</span><a href="GHC.Core.TyCo.Rep.html#mkTyVarTys"><span class="hs-identifier hs-var">mkTyVarTys</span></a></span><span> </span><span class="annot"><span class="annottext">([TyVar] -&gt; ThetaType) -&gt; [TyVar] -&gt; ThetaType
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">[TyVar] -&gt; [TyVar]
forall a. [a] -&gt; [a]
</span><span class="hs-identifier hs-var">reverse</span></span><span> </span><span class="annot"><span class="annottext">[TyVar]
</span><a href="#local-6989586621682987538"><span class="hs-keyword hs-var">as</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-107"></span><span>        </span><span class="hs-comment">-- Why this kind-check?  See Note [Newtype eta and homogeneous axioms]</span><span>
</span><span id="line-108"></span><span>      </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[TyVar] -&gt; [Role] -&gt; Type -&gt; ([TyVar], [Role], Type)
</span><a href="#local-6989586621682987535"><span class="hs-identifier hs-var">eta_reduce</span></a></span><span> </span><span class="annot"><span class="annottext">[TyVar]
</span><a href="#local-6989586621682987538"><span class="hs-keyword hs-var">as</span></a></span><span> </span><span class="annot"><span class="annottext">[Role]
</span><a href="#local-6989586621682987539"><span class="hs-identifier hs-var">rs</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682987541"><span class="hs-identifier hs-var">fun</span></a></span><span>
</span><span id="line-109"></span><span>    </span><span class="annot"><a href="#local-6989586621682987535"><span class="hs-identifier hs-var">eta_reduce</span></a></span><span> </span><span id="local-6989586621682987552"><span class="annot"><span class="annottext">[TyVar]
</span><a href="#local-6989586621682987552"><span class="hs-keyword hs-var">as</span></a></span></span><span> </span><span id="local-6989586621682987553"><span class="annot"><span class="annottext">[Role]
</span><a href="#local-6989586621682987553"><span class="hs-identifier hs-var">rs</span></a></span></span><span> </span><span id="local-6989586621682987554"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682987554"><span class="hs-identifier hs-var">ty</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[TyVar] -&gt; [TyVar]
forall a. [a] -&gt; [a]
</span><span class="hs-identifier hs-var">reverse</span></span><span> </span><span class="annot"><span class="annottext">[TyVar]
</span><a href="#local-6989586621682987552"><span class="hs-keyword hs-var">as</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">[Role] -&gt; [Role]
forall a. [a] -&gt; [a]
</span><span class="hs-identifier hs-var">reverse</span></span><span> </span><span class="annot"><span class="annottext">[Role]
</span><a href="#local-6989586621682987553"><span class="hs-identifier hs-var">rs</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682987554"><span class="hs-identifier hs-var">ty</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-110"></span><span>
</span><span id="line-111"></span><span class="hs-comment">{- Note [Newtype eta and homogeneous axioms]
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
When eta-reducing a newtype, we must be careful to make sure the axiom
is homogeneous.  (That is, the two types related by the axiom must
have the same kind.)  All known proofs of type safety for Core rely on
the homogeneity of axioms, so let's not monkey with that.

It is easy to mistakenly make an inhomogeneous axiom (#19739):
  type T :: forall (a :: Type) -&gt; Type
  newtype T a = MkT (Proxy a)

Can we eta-reduce, thus?
  axT :: T ~ Proxy

No!  Because
   T     :: forall a -&gt; Type
   Proxy :: Type     -&gt; Type

This is inhomogeneous. Hence, we have an extra kind-check in eta_reduce,
to make sure the reducts have the same kind. This is simple, although
perhaps quadratic in complexity, if we eta-reduce many arguments (which
seems vanishingly unlikely in practice).  But NB that the free-variable
check, which immediately precedes the kind check, is also potentially
quadratic.

There are other ways we could do the check (discussion on #19739):

* We could look at the sequence of binders on the newtype and on the
  head of the representation type, and make sure the visibilities on
  the binders match up. This is quite a bit more code, and the reasoning
  is subtler.

* We could, say, do the kind-check at the end and then backtrack until the
  kinds match up. Hard to know whether that's more performant or not.
-}</span><span>
</span><span id="line-146"></span><span>
</span><span id="line-147"></span><span class="hs-comment">------------------------------------------------------</span><span>
</span><span id="line-148"></span><span id="local-6989586621682987332"><span id="local-6989586621682987333"><span class="annot"><a href="GHC.Tc.TyCl.Build.html#buildDataCon"><span class="hs-identifier hs-type">buildDataCon</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Core.FamInstEnv.html#FamInstEnvs"><span class="hs-identifier hs-type">FamInstEnvs</span></a></span><span>
</span><span id="line-149"></span><span>            </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Types.Id.Make.html#DataConBangOpts"><span class="hs-identifier hs-type">DataConBangOpts</span></a></span><span>
</span><span id="line-150"></span><span>            </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Types.Name.html#Name"><span class="hs-identifier hs-type">Name</span></a></span><span>
</span><span id="line-151"></span><span>            </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Bool</span></span><span>                     </span><span class="hs-comment">-- Declared infix</span><span>
</span><span id="line-152"></span><span>            </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Core.TyCon.html#TyConRepName"><span class="hs-identifier hs-type">TyConRepName</span></a></span><span>
</span><span id="line-153"></span><span>            </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="GHC.Core.DataCon.html#HsSrcBang"><span class="hs-identifier hs-type">HsSrcBang</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-154"></span><span>           </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="GHC.Types.FieldLabel.html#FieldLabel"><span class="hs-identifier hs-type">FieldLabel</span></a></span><span class="hs-special">]</span><span>             </span><span class="hs-comment">-- Field labels</span><span>
</span><span id="line-155"></span><span>           </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="GHC.Types.Var.html#TyVar"><span class="hs-identifier hs-type">TyVar</span></a></span><span class="hs-special">]</span><span>                  </span><span class="hs-comment">-- Universals</span><span>
</span><span id="line-156"></span><span>           </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="GHC.Types.Var.html#TyCoVar"><span class="hs-identifier hs-type">TyCoVar</span></a></span><span class="hs-special">]</span><span>                </span><span class="hs-comment">-- Existentials</span><span>
</span><span id="line-157"></span><span>           </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="GHC.Types.Var.html#InvisTVBinder"><span class="hs-identifier hs-type">InvisTVBinder</span></a></span><span class="hs-special">]</span><span>          </span><span class="hs-comment">-- User-written 'TyVarBinder's</span><span>
</span><span id="line-158"></span><span>           </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="GHC.Core.DataCon.html#EqSpec"><span class="hs-identifier hs-type">EqSpec</span></a></span><span class="hs-special">]</span><span>                 </span><span class="hs-comment">-- Equality spec</span><span>
</span><span id="line-159"></span><span>           </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#KnotTied"><span class="hs-identifier hs-type">KnotTied</span></a></span><span> </span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#ThetaType"><span class="hs-identifier hs-type">ThetaType</span></a></span><span>       </span><span class="hs-comment">-- Does not include the &quot;stupid theta&quot;</span><span>
</span><span id="line-160"></span><span>                                       </span><span class="hs-comment">-- or the GADT equalities</span><span>
</span><span id="line-161"></span><span>           </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#KnotTied"><span class="hs-identifier hs-type">KnotTied</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#Scaled"><span class="hs-identifier hs-type">Scaled</span></a></span><span> </span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#Type"><span class="hs-identifier hs-type">Type</span></a></span><span class="hs-special">)</span><span class="hs-special">]</span><span> </span><span class="hs-comment">-- Arguments</span><span>
</span><span id="line-162"></span><span>           </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#KnotTied"><span class="hs-identifier hs-type">KnotTied</span></a></span><span> </span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#Type"><span class="hs-identifier hs-type">Type</span></a></span><span>            </span><span class="hs-comment">-- Result types</span><span>
</span><span id="line-163"></span><span>           </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#KnotTied"><span class="hs-identifier hs-type">KnotTied</span></a></span><span> </span><span class="annot"><a href="GHC.Core.TyCon.html#TyCon"><span class="hs-identifier hs-type">TyCon</span></a></span><span>           </span><span class="hs-comment">-- Rep tycon</span><span>
</span><span id="line-164"></span><span>           </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Types.Name.Env.html#NameEnv"><span class="hs-identifier hs-type">NameEnv</span></a></span><span> </span><span class="annot"><a href="Language.Haskell.Syntax.Basic.html#ConTag"><span class="hs-identifier hs-type">ConTag</span></a></span><span>           </span><span class="hs-comment">-- Maps the Name of each DataCon to its</span><span>
</span><span id="line-165"></span><span>                                       </span><span class="hs-comment">-- ConTag</span><span>
</span><span id="line-166"></span><span>           </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#TcRnIf"><span class="hs-identifier hs-type">TcRnIf</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682987332"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682987333"><span class="hs-identifier hs-type">n</span></a></span><span> </span><span class="annot"><a href="GHC.Core.DataCon.html#DataCon"><span class="hs-identifier hs-type">DataCon</span></a></span></span></span><span>
</span><span id="line-167"></span><span class="hs-comment">-- A wrapper for DataCon.mkDataCon that</span><span>
</span><span id="line-168"></span><span class="hs-comment">--   a) makes the worker Id</span><span>
</span><span id="line-169"></span><span class="hs-comment">--   b) makes the wrapper Id if necessary, including</span><span>
</span><span id="line-170"></span><span class="hs-comment">--      allocating its unique (hence monadic)</span><span>
</span><span id="line-171"></span><span id="buildDataCon"><span class="annot"><span class="annottext">buildDataCon :: forall m n.
FamInstEnvs
-&gt; DataConBangOpts
-&gt; Name
-&gt; Bool
-&gt; Name
-&gt; [HsSrcBang]
-&gt; [FieldLabel]
-&gt; [TyVar]
-&gt; [TyVar]
-&gt; [InvisTVBinder]
-&gt; [EqSpec]
-&gt; ThetaType
-&gt; [Scaled Type]
-&gt; Type
-&gt; TyCon
-&gt; NameEnv ConTag
-&gt; TcRnIf m n DataCon
</span><a href="GHC.Tc.TyCl.Build.html#buildDataCon"><span class="hs-identifier hs-var hs-var">buildDataCon</span></a></span></span><span> </span><span id="local-6989586621682987570"><span class="annot"><span class="annottext">FamInstEnvs
</span><a href="#local-6989586621682987570"><span class="hs-identifier hs-var">fam_envs</span></a></span></span><span> </span><span id="local-6989586621682987571"><span class="annot"><span class="annottext">DataConBangOpts
</span><a href="#local-6989586621682987571"><span class="hs-identifier hs-var">dc_bang_opts</span></a></span></span><span> </span><span id="local-6989586621682987572"><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621682987572"><span class="hs-identifier hs-var">src_name</span></a></span></span><span> </span><span id="local-6989586621682987573"><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621682987573"><span class="hs-identifier hs-var">declared_infix</span></a></span></span><span> </span><span id="local-6989586621682987574"><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621682987574"><span class="hs-identifier hs-var">prom_info</span></a></span></span><span> </span><span id="local-6989586621682987575"><span class="annot"><span class="annottext">[HsSrcBang]
</span><a href="#local-6989586621682987575"><span class="hs-identifier hs-var">src_bangs</span></a></span></span><span>
</span><span id="line-172"></span><span>             </span><span id="local-6989586621682987576"><span class="annot"><span class="annottext">[FieldLabel]
</span><a href="#local-6989586621682987576"><span class="hs-identifier hs-var">field_lbls</span></a></span></span><span> </span><span id="local-6989586621682987577"><span class="annot"><span class="annottext">[TyVar]
</span><a href="#local-6989586621682987577"><span class="hs-identifier hs-var">univ_tvs</span></a></span></span><span> </span><span id="local-6989586621682987578"><span class="annot"><span class="annottext">[TyVar]
</span><a href="#local-6989586621682987578"><span class="hs-identifier hs-var">ex_tvs</span></a></span></span><span> </span><span id="local-6989586621682987579"><span class="annot"><span class="annottext">[InvisTVBinder]
</span><a href="#local-6989586621682987579"><span class="hs-identifier hs-var">user_tvbs</span></a></span></span><span> </span><span id="local-6989586621682987580"><span class="annot"><span class="annottext">[EqSpec]
</span><a href="#local-6989586621682987580"><span class="hs-identifier hs-var">eq_spec</span></a></span></span><span> </span><span id="local-6989586621682987581"><span class="annot"><span class="annottext">ThetaType
</span><a href="#local-6989586621682987581"><span class="hs-identifier hs-var">ctxt</span></a></span></span><span> </span><span id="local-6989586621682987582"><span class="annot"><span class="annottext">[Scaled Type]
</span><a href="#local-6989586621682987582"><span class="hs-identifier hs-var">arg_tys</span></a></span></span><span> </span><span id="local-6989586621682987583"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682987583"><span class="hs-identifier hs-var">res_ty</span></a></span></span><span>
</span><span id="line-173"></span><span>             </span><span id="local-6989586621682987584"><span class="annot"><span class="annottext">TyCon
</span><a href="#local-6989586621682987584"><span class="hs-identifier hs-var">rep_tycon</span></a></span></span><span> </span><span id="local-6989586621682987585"><span class="annot"><span class="annottext">NameEnv ConTag
</span><a href="#local-6989586621682987585"><span class="hs-identifier hs-var">tag_map</span></a></span></span><span>
</span><span id="line-174"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>  </span><span class="hs-special">{</span><span> </span><span id="local-6989586621682987586"><span class="annot"><a href="#local-6989586621682987586"><span class="hs-identifier hs-var">wrap_name</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Name -&gt; (OccName -&gt; OccName) -&gt; TcRnIf m n Name
forall m n. Name -&gt; (OccName -&gt; OccName) -&gt; TcRnIf m n Name
</span><a href="GHC.Tc.TyCl.Build.html#newImplicitBinder"><span class="hs-identifier hs-var">newImplicitBinder</span></a></span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621682987572"><span class="hs-identifier hs-var">src_name</span></a></span><span> </span><span class="annot"><span class="annottext">OccName -&gt; OccName
</span><a href="GHC.Types.Name.Occurrence.html#mkDataConWrapperOcc"><span class="hs-identifier hs-var">mkDataConWrapperOcc</span></a></span><span>
</span><span id="line-175"></span><span>        </span><span class="hs-special">;</span><span> </span><span id="local-6989586621682987588"><span class="annot"><a href="#local-6989586621682987588"><span class="hs-identifier hs-var">work_name</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><a href="GHC.Tc.TyCl.Build.html#newImplicitBinder"><span class="hs-identifier hs-type">newImplicitBinder</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682987572"><span class="hs-identifier hs-type">src_name</span></a></span><span> </span><span class="annot"><a href="GHC.Types.Name.Occurrence.html#mkDataConWorkerOcc"><span class="hs-identifier hs-type">mkDataConWorkerOcc</span></a></span><span>
</span><span id="line-176"></span><span>        </span><span class="hs-comment">-- This last one takes the name of the data constructor in the source</span><span>
</span><span id="line-177"></span><span>        </span><span class="hs-comment">-- code, which (for Haskell source anyway) will be in the DataName name</span><span>
</span><span id="line-178"></span><span>        </span><span class="hs-comment">-- space, and puts it into the VarName name space</span><span>
</span><span id="line-179"></span><span>
</span><span id="line-180"></span><span>        </span><span class="hs-special">;</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.Monad.html#traceIf"><span class="hs-identifier hs-type">traceIf</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Utils.Outputable.html#text"><span class="hs-identifier hs-type">text</span></a></span><span> </span><span class="annot"><span class="hs-string">&quot;buildDataCon 1&quot;</span></span><span> </span><span class="annot"><a href="GHC.Utils.Outputable.html#%3C%2B%3E"><span class="hs-operator hs-type">&lt;+&gt;</span></a></span><span> </span><span class="annot"><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-type">ppr</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682987572"><span class="hs-identifier hs-type">src_name</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-181"></span><span>        </span><span class="hs-special">;</span><span> </span><span id="local-6989586621682987590"><span class="annot"><a href="#local-6989586621682987590"><span class="hs-identifier hs-var">us</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.Monad.html#newUniqueSupply"><span class="hs-identifier hs-type">newUniqueSupply</span></a></span><span>
</span><span id="line-182"></span><span>        </span><span class="hs-special">;</span><span> </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621682987592"><span class="annot"><a href="#local-6989586621682987592"><span class="hs-identifier hs-var hs-var">stupid_ctxt</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">TyCon -&gt; ThetaType -&gt; [TyVar] -&gt; ThetaType
</span><a href="GHC.Tc.TyCl.Build.html#mkDataConStupidTheta"><span class="hs-identifier hs-var">mkDataConStupidTheta</span></a></span><span> </span><span class="annot"><span class="annottext">TyCon
</span><a href="#local-6989586621682987584"><span class="hs-identifier hs-var">rep_tycon</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(Scaled Type -&gt; Type) -&gt; [Scaled Type] -&gt; ThetaType
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><span class="hs-identifier hs-var">map</span></span><span> </span><span class="annot"><span class="annottext">Scaled Type -&gt; Type
forall a. Scaled a -&gt; a
</span><a href="GHC.Core.TyCo.Rep.html#scaledThing"><span class="hs-identifier hs-var">scaledThing</span></a></span><span> </span><span class="annot"><span class="annottext">[Scaled Type]
</span><a href="#local-6989586621682987582"><span class="hs-identifier hs-var">arg_tys</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[TyVar]
</span><a href="#local-6989586621682987577"><span class="hs-identifier hs-var">univ_tvs</span></a></span><span>
</span><span id="line-183"></span><span>              </span><span id="local-6989586621682987595"><span class="annot"><a href="#local-6989586621682987595"><span class="hs-identifier hs-var hs-var">tag</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">NameEnv ConTag -&gt; Name -&gt; ConTag
forall a. NameEnv a -&gt; Name -&gt; a
</span><a href="GHC.Types.Name.Env.html#lookupNameEnv_NF"><span class="hs-identifier hs-var">lookupNameEnv_NF</span></a></span><span> </span><span class="annot"><span class="annottext">NameEnv ConTag
</span><a href="#local-6989586621682987585"><span class="hs-identifier hs-var">tag_map</span></a></span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621682987572"><span class="hs-identifier hs-var">src_name</span></a></span><span>
</span><span id="line-184"></span><span>              </span><span class="hs-comment">-- See Note [Constructor tag allocation], fixes #14657</span><span>
</span><span id="line-185"></span><span>              </span><span id="local-6989586621682987597"><span class="annot"><a href="#local-6989586621682987597"><span class="hs-identifier hs-var hs-var">data_con</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Name
-&gt; Bool
-&gt; Name
-&gt; [HsSrcBang]
-&gt; [FieldLabel]
-&gt; [TyVar]
-&gt; [TyVar]
-&gt; ConcreteTyVars
-&gt; [InvisTVBinder]
-&gt; [EqSpec]
-&gt; ThetaType
-&gt; [Scaled Type]
-&gt; Type
-&gt; PromDataConInfo
-&gt; TyCon
-&gt; ConTag
-&gt; ThetaType
-&gt; TyVar
-&gt; DataConRep
-&gt; DataCon
</span><a href="GHC.Core.DataCon.html#mkDataCon"><span class="hs-identifier hs-var">mkDataCon</span></a></span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621682987572"><span class="hs-identifier hs-var">src_name</span></a></span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621682987573"><span class="hs-identifier hs-var">declared_infix</span></a></span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621682987574"><span class="hs-identifier hs-var">prom_info</span></a></span><span>
</span><span id="line-186"></span><span>                                   </span><span class="annot"><span class="annottext">[HsSrcBang]
</span><a href="#local-6989586621682987575"><span class="hs-identifier hs-var">src_bangs</span></a></span><span> </span><span class="annot"><span class="annottext">[FieldLabel]
</span><a href="#local-6989586621682987576"><span class="hs-identifier hs-var">field_lbls</span></a></span><span>
</span><span id="line-187"></span><span>                                   </span><span class="annot"><span class="annottext">[TyVar]
</span><a href="#local-6989586621682987577"><span class="hs-identifier hs-var">univ_tvs</span></a></span><span> </span><span class="annot"><span class="annottext">[TyVar]
</span><a href="#local-6989586621682987578"><span class="hs-identifier hs-var">ex_tvs</span></a></span><span>
</span><span id="line-188"></span><span>                                   </span><span class="annot"><span class="annottext">ConcreteTyVars
</span><a href="GHC.Tc.Utils.TcType.html#noConcreteTyVars"><span class="hs-identifier hs-var">noConcreteTyVars</span></a></span><span>
</span><span id="line-189"></span><span>                                   </span><span class="annot"><span class="annottext">[InvisTVBinder]
</span><a href="#local-6989586621682987579"><span class="hs-identifier hs-var">user_tvbs</span></a></span><span> </span><span class="annot"><span class="annottext">[EqSpec]
</span><a href="#local-6989586621682987580"><span class="hs-identifier hs-var">eq_spec</span></a></span><span> </span><span class="annot"><span class="annottext">ThetaType
</span><a href="#local-6989586621682987581"><span class="hs-identifier hs-var">ctxt</span></a></span><span>
</span><span id="line-190"></span><span>                                   </span><span class="annot"><span class="annottext">[Scaled Type]
</span><a href="#local-6989586621682987582"><span class="hs-identifier hs-var">arg_tys</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682987583"><span class="hs-identifier hs-var">res_ty</span></a></span><span> </span><span class="annot"><span class="annottext">PromDataConInfo
</span><a href="GHC.Core.TyCon.html#NoPromInfo"><span class="hs-identifier hs-var">NoPromInfo</span></a></span><span> </span><span class="annot"><span class="annottext">TyCon
</span><a href="#local-6989586621682987584"><span class="hs-identifier hs-var">rep_tycon</span></a></span><span> </span><span class="annot"><span class="annottext">ConTag
</span><a href="#local-6989586621682987595"><span class="hs-identifier hs-var">tag</span></a></span><span>
</span><span id="line-191"></span><span>                                   </span><span class="annot"><span class="annottext">ThetaType
</span><a href="#local-6989586621682987592"><span class="hs-identifier hs-var">stupid_ctxt</span></a></span><span> </span><span class="annot"><span class="annottext">TyVar
</span><a href="#local-6989586621682987601"><span class="hs-identifier hs-var">dc_wrk</span></a></span><span> </span><span class="annot"><span class="annottext">DataConRep
</span><a href="#local-6989586621682987602"><span class="hs-identifier hs-var">dc_rep</span></a></span><span>
</span><span id="line-192"></span><span>              </span><span id="local-6989586621682987601"><span class="annot"><a href="#local-6989586621682987601"><span class="hs-identifier hs-var hs-var">dc_wrk</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Name -&gt; DataCon -&gt; TyVar
</span><a href="GHC.Types.Id.Make.html#mkDataConWorkId"><span class="hs-identifier hs-var">mkDataConWorkId</span></a></span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621682987588"><span class="hs-identifier hs-var">work_name</span></a></span><span> </span><span class="annot"><span class="annottext">DataCon
</span><a href="#local-6989586621682987597"><span class="hs-identifier hs-var">data_con</span></a></span><span>
</span><span id="line-193"></span><span>              </span><span id="local-6989586621682987602"><span class="annot"><a href="#local-6989586621682987602"><span class="hs-identifier hs-var hs-var">dc_rep</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">UniqSupply -&gt; UniqSM DataConRep -&gt; DataConRep
forall a. UniqSupply -&gt; UniqSM a -&gt; a
</span><a href="GHC.Types.Unique.Supply.html#initUs_"><span class="hs-identifier hs-var">initUs_</span></a></span><span> </span><span class="annot"><span class="annottext">UniqSupply
</span><a href="#local-6989586621682987590"><span class="hs-identifier hs-var">us</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">DataConBangOpts
-&gt; FamInstEnvs -&gt; Name -&gt; DataCon -&gt; UniqSM DataConRep
</span><a href="GHC.Types.Id.Make.html#mkDataConRep"><span class="hs-identifier hs-var">mkDataConRep</span></a></span><span> </span><span class="annot"><span class="annottext">DataConBangOpts
</span><a href="#local-6989586621682987571"><span class="hs-identifier hs-var">dc_bang_opts</span></a></span><span> </span><span class="annot"><span class="annottext">FamInstEnvs
</span><a href="#local-6989586621682987570"><span class="hs-identifier hs-var">fam_envs</span></a></span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621682987586"><span class="hs-identifier hs-var">wrap_name</span></a></span><span> </span><span class="annot"><span class="annottext">DataCon
</span><a href="#local-6989586621682987597"><span class="hs-identifier hs-var">data_con</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-194"></span><span>
</span><span id="line-195"></span><span>        </span><span class="hs-special">;</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.Monad.html#traceIf"><span class="hs-identifier hs-type">traceIf</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Utils.Outputable.html#text"><span class="hs-identifier hs-type">text</span></a></span><span> </span><span class="annot"><span class="hs-string">&quot;buildDataCon 2&quot;</span></span><span> </span><span class="annot"><a href="GHC.Utils.Outputable.html#%3C%2B%3E"><span class="hs-operator hs-type">&lt;+&gt;</span></a></span><span> </span><span class="annot"><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-type">ppr</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682987572"><span class="hs-identifier hs-type">src_name</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-196"></span><span>        </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">return</span></span><span> </span><span class="annot"><a href="#local-6989586621682987597"><span class="hs-identifier hs-type">data_con</span></a></span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-197"></span><span>
</span><span id="line-198"></span><span>
</span><span id="line-199"></span><span class="hs-comment">-- The stupid context for a data constructor should be limited to</span><span>
</span><span id="line-200"></span><span class="hs-comment">-- the type variables mentioned in the arg_tys</span><span>
</span><span id="line-201"></span><span class="hs-comment">-- ToDo: Or functionally dependent on?</span><span>
</span><span id="line-202"></span><span class="hs-comment">--       This whole stupid theta thing is, well, stupid.</span><span>
</span><span id="line-203"></span><span class="hs-comment">--</span><span>
</span><span id="line-204"></span><span class="hs-comment">-- See Note [The stupid context] in GHC.Core.DataCon.</span><span>
</span><span id="line-205"></span><span class="annot"><a href="GHC.Tc.TyCl.Build.html#mkDataConStupidTheta"><span class="hs-identifier hs-type">mkDataConStupidTheta</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Core.TyCon.html#TyCon"><span class="hs-identifier hs-type">TyCon</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#Type"><span class="hs-identifier hs-type">Type</span></a></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="GHC.Types.Var.html#TyVar"><span class="hs-identifier hs-type">TyVar</span></a></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#PredType"><span class="hs-identifier hs-type">PredType</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-206"></span><span id="mkDataConStupidTheta"><span class="annot"><span class="annottext">mkDataConStupidTheta :: TyCon -&gt; ThetaType -&gt; [TyVar] -&gt; ThetaType
</span><a href="GHC.Tc.TyCl.Build.html#mkDataConStupidTheta"><span class="hs-identifier hs-var hs-var">mkDataConStupidTheta</span></a></span></span><span> </span><span id="local-6989586621682987607"><span class="annot"><span class="annottext">TyCon
</span><a href="#local-6989586621682987607"><span class="hs-identifier hs-var">tycon</span></a></span></span><span> </span><span id="local-6989586621682987608"><span class="annot"><span class="annottext">ThetaType
</span><a href="#local-6989586621682987608"><span class="hs-identifier hs-var">arg_tys</span></a></span></span><span> </span><span id="local-6989586621682987609"><span class="annot"><span class="annottext">[TyVar]
</span><a href="#local-6989586621682987609"><span class="hs-identifier hs-var">univ_tvs</span></a></span></span><span>
</span><span id="line-207"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">ThetaType -&gt; Bool
forall a. [a] -&gt; Bool
forall (t :: * -&gt; *) a. Foldable t =&gt; t a -&gt; Bool
</span><span class="hs-identifier hs-var">null</span></span><span> </span><span class="annot"><span class="annottext">ThetaType
</span><a href="#local-6989586621682987610"><span class="hs-identifier hs-var">stupid_theta</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span>      </span><span class="hs-comment">-- The common case</span><span>
</span><span id="line-208"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">otherwise</span></span><span>         </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(Type -&gt; Bool) -&gt; ThetaType -&gt; ThetaType
forall a. (a -&gt; Bool) -&gt; [a] -&gt; [a]
</span><span class="hs-identifier hs-var">filter</span></span><span> </span><span class="annot"><span class="annottext">Type -&gt; Bool
</span><a href="#local-6989586621682987611"><span class="hs-identifier hs-var">in_arg_tys</span></a></span><span> </span><span class="annot"><span class="annottext">ThetaType
</span><a href="#local-6989586621682987610"><span class="hs-identifier hs-var">stupid_theta</span></a></span><span>
</span><span id="line-209"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-210"></span><span>    </span><span id="local-6989586621682987612"><span class="annot"><span class="annottext">tc_subst :: Subst
</span><a href="#local-6989586621682987612"><span class="hs-identifier hs-var hs-var">tc_subst</span></a></span></span><span>     </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[TyVar] -&gt; ThetaType -&gt; Subst
HasDebugCallStack =&gt; [TyVar] -&gt; ThetaType -&gt; Subst
</span><a href="GHC.Core.TyCo.Subst.html#zipTvSubst"><span class="hs-identifier hs-var">zipTvSubst</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TyCon -&gt; [TyVar]
</span><a href="GHC.Core.TyCon.html#tyConTyVars"><span class="hs-identifier hs-var">tyConTyVars</span></a></span><span> </span><span class="annot"><span class="annottext">TyCon
</span><a href="#local-6989586621682987607"><span class="hs-identifier hs-var">tycon</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-211"></span><span>                              </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[TyVar] -&gt; ThetaType
</span><a href="GHC.Core.TyCo.Rep.html#mkTyVarTys"><span class="hs-identifier hs-var">mkTyVarTys</span></a></span><span> </span><span class="annot"><span class="annottext">[TyVar]
</span><a href="#local-6989586621682987609"><span class="hs-identifier hs-var">univ_tvs</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-212"></span><span>    </span><span id="local-6989586621682987610"><span class="annot"><span class="annottext">stupid_theta :: ThetaType
</span><a href="#local-6989586621682987610"><span class="hs-identifier hs-var hs-var">stupid_theta</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">HasDebugCallStack =&gt; Subst -&gt; ThetaType -&gt; ThetaType
Subst -&gt; ThetaType -&gt; ThetaType
</span><a href="GHC.Core.TyCo.Subst.html#substTheta"><span class="hs-identifier hs-var">substTheta</span></a></span><span> </span><span class="annot"><span class="annottext">Subst
</span><a href="#local-6989586621682987612"><span class="hs-identifier hs-var">tc_subst</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TyCon -&gt; ThetaType
</span><a href="GHC.Core.TyCon.html#tyConStupidTheta"><span class="hs-identifier hs-var">tyConStupidTheta</span></a></span><span> </span><span class="annot"><span class="annottext">TyCon
</span><a href="#local-6989586621682987607"><span class="hs-identifier hs-var">tycon</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-213"></span><span>        </span><span class="hs-comment">-- Start by instantiating the master copy of the</span><span>
</span><span id="line-214"></span><span>        </span><span class="hs-comment">-- stupid theta, taken from the TyCon</span><span>
</span><span id="line-215"></span><span>
</span><span id="line-216"></span><span>    </span><span id="local-6989586621682987616"><span class="annot"><span class="annottext">arg_tyvars :: VarSet
</span><a href="#local-6989586621682987616"><span class="hs-identifier hs-var hs-var">arg_tyvars</span></a></span></span><span>      </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ThetaType -&gt; VarSet
</span><a href="GHC.Core.TyCo.FVs.html#tyCoVarsOfTypes"><span class="hs-identifier hs-var">tyCoVarsOfTypes</span></a></span><span> </span><span class="annot"><span class="annottext">ThetaType
</span><a href="#local-6989586621682987608"><span class="hs-identifier hs-var">arg_tys</span></a></span><span>
</span><span id="line-217"></span><span>    </span><span id="local-6989586621682987611"><span class="annot"><span class="annottext">in_arg_tys :: Type -&gt; Bool
</span><a href="#local-6989586621682987611"><span class="hs-identifier hs-var hs-var">in_arg_tys</span></a></span></span><span> </span><span id="local-6989586621682987618"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682987618"><span class="hs-identifier hs-var">pred</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Type -&gt; VarSet
</span><a href="GHC.Core.TyCo.FVs.html#tyCoVarsOfType"><span class="hs-identifier hs-var">tyCoVarsOfType</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682987618"><span class="hs-identifier hs-var">pred</span></a></span><span> </span><span class="annot"><span class="annottext">VarSet -&gt; VarSet -&gt; Bool
</span><a href="GHC.Types.Var.Set.html#intersectsVarSet"><span class="hs-operator hs-var">`intersectsVarSet`</span></a></span><span> </span><span class="annot"><span class="annottext">VarSet
</span><a href="#local-6989586621682987616"><span class="hs-identifier hs-var">arg_tyvars</span></a></span><span>
</span><span id="line-218"></span><span>
</span><span id="line-219"></span><span>
</span><span id="line-220"></span><span class="hs-comment">------------------------------------------------------</span><span>
</span><span id="line-221"></span><span class="annot"><a href="GHC.Tc.TyCl.Build.html#buildPatSyn"><span class="hs-identifier hs-type">buildPatSyn</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Types.Name.html#Name"><span class="hs-identifier hs-type">Name</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Bool</span></span><span>
</span><span id="line-222"></span><span>            </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Core.PatSyn.html#PatSynMatcher"><span class="hs-identifier hs-type">PatSynMatcher</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Core.PatSyn.html#PatSynBuilder"><span class="hs-identifier hs-type">PatSynBuilder</span></a></span><span>
</span><span id="line-223"></span><span>            </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="hs-special">[</span><span class="annot"><a href="GHC.Types.Var.html#InvisTVBinder"><span class="hs-identifier hs-type">InvisTVBinder</span></a></span><span class="hs-special">]</span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#ThetaType"><span class="hs-identifier hs-type">ThetaType</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="hs-comment">-- ^ Univ and req</span></span><span>
</span><span id="line-224"></span><span>            </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="hs-special">[</span><span class="annot"><a href="GHC.Types.Var.html#InvisTVBinder"><span class="hs-identifier hs-type">InvisTVBinder</span></a></span><span class="hs-special">]</span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#ThetaType"><span class="hs-identifier hs-type">ThetaType</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="hs-comment">-- ^ Ex and prov</span></span><span>
</span><span id="line-225"></span><span>            </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#FRRType"><span class="hs-identifier hs-type">FRRType</span></a></span><span class="hs-special">]</span><span>                    </span><span class="annot"><span class="hs-comment">-- ^ Argument types</span></span><span>
</span><span id="line-226"></span><span>            </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#Type"><span class="hs-identifier hs-type">Type</span></a></span><span>                         </span><span class="annot"><span class="hs-comment">-- ^ Result type</span></span><span>
</span><span id="line-227"></span><span>            </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="GHC.Types.FieldLabel.html#FieldLabel"><span class="hs-identifier hs-type">FieldLabel</span></a></span><span class="hs-special">]</span><span>                 </span><span class="hs-comment">-- ^ Field labels for</span><span>
</span><span id="line-228"></span><span>                                            </span><span class="hs-comment">--   a record pattern synonym</span><span>
</span><span id="line-229"></span><span>            </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Core.PatSyn.html#PatSyn"><span class="hs-identifier hs-type">PatSyn</span></a></span><span>
</span><span id="line-230"></span><span id="buildPatSyn"><span class="annot"><span class="annottext">buildPatSyn :: Name
-&gt; Bool
-&gt; PatSynMatcher
-&gt; PatSynBuilder
-&gt; ([InvisTVBinder], ThetaType)
-&gt; ([InvisTVBinder], ThetaType)
-&gt; ThetaType
-&gt; Type
-&gt; [FieldLabel]
-&gt; PatSyn
</span><a href="GHC.Tc.TyCl.Build.html#buildPatSyn"><span class="hs-identifier hs-var hs-var">buildPatSyn</span></a></span></span><span> </span><span id="local-6989586621682987621"><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621682987621"><span class="hs-identifier hs-var">src_name</span></a></span></span><span> </span><span id="local-6989586621682987622"><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621682987622"><span class="hs-identifier hs-var">declared_infix</span></a></span></span><span> </span><span id="local-6989586621682987623"><span class="annot"><span class="annottext">matcher :: PatSynMatcher
</span><a href="#local-6989586621682987623"><span class="hs-identifier hs-var">matcher</span></a></span></span><span class="hs-glyph">@</span><span class="hs-special">(</span><span class="annot"><span class="annottext">Name
</span><span class="hs-identifier">_</span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682987624"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682987624"><span class="hs-identifier hs-var">matcher_ty</span></a></span></span><span class="hs-special">,</span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span> </span><span id="local-6989586621682987625"><span class="annot"><span class="annottext">PatSynBuilder
</span><a href="#local-6989586621682987625"><span class="hs-identifier hs-var">builder</span></a></span></span><span>
</span><span id="line-231"></span><span>            </span><span class="hs-special">(</span><span id="local-6989586621682987626"><span class="annot"><span class="annottext">[InvisTVBinder]
</span><a href="#local-6989586621682987626"><span class="hs-identifier hs-var">univ_tvs</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682987627"><span class="annot"><span class="annottext">ThetaType
</span><a href="#local-6989586621682987627"><span class="hs-identifier hs-var">req_theta</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span id="local-6989586621682987628"><span class="annot"><span class="annottext">[InvisTVBinder]
</span><a href="#local-6989586621682987628"><span class="hs-identifier hs-var">ex_tvs</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682987629"><span class="annot"><span class="annottext">ThetaType
</span><a href="#local-6989586621682987629"><span class="hs-identifier hs-var">prov_theta</span></a></span></span><span class="hs-special">)</span><span> </span><span id="local-6989586621682987630"><span class="annot"><span class="annottext">ThetaType
</span><a href="#local-6989586621682987630"><span class="hs-identifier hs-var">arg_tys</span></a></span></span><span>
</span><span id="line-232"></span><span>            </span><span id="local-6989586621682987631"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682987631"><span class="hs-identifier hs-var">pat_ty</span></a></span></span><span> </span><span id="local-6989586621682987632"><span class="annot"><span class="annottext">[FieldLabel]
</span><a href="#local-6989586621682987632"><span class="hs-identifier hs-var">field_labels</span></a></span></span><span>
</span><span id="line-233"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-comment">-- The assertion checks that the matcher is</span><span>
</span><span id="line-234"></span><span>    </span><span class="hs-comment">-- compatible with the pattern synonym</span><span>
</span><span id="line-235"></span><span>    </span><span class="annot"><span class="annottext">Bool -&gt; SDoc -&gt; PatSyn -&gt; PatSyn
forall a. HasCallStack =&gt; Bool -&gt; SDoc -&gt; a -&gt; a
</span><a href="GHC.Utils.Panic.html#assertPpr"><span class="hs-identifier hs-var">assertPpr</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[Bool] -&gt; Bool
forall (t :: * -&gt; *). Foldable t =&gt; t Bool -&gt; Bool
</span><span class="hs-identifier hs-var">and</span></span><span> </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">[InvisTVBinder]
</span><a href="#local-6989586621682987626"><span class="hs-identifier hs-var">univ_tvs</span></a></span><span> </span><span class="annot"><span class="annottext">[InvisTVBinder] -&gt; [TyVar] -&gt; Bool
forall a b. [a] -&gt; [b] -&gt; Bool
</span><a href="GHC.Utils.Misc.html#equalLength"><span class="hs-operator hs-var">`equalLength`</span></a></span><span> </span><span class="annot"><span class="annottext">[TyVar]
</span><a href="#local-6989586621682987636"><span class="hs-identifier hs-var">univ_tvs1</span></a></span><span>
</span><span id="line-236"></span><span>                   </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">[InvisTVBinder]
</span><a href="#local-6989586621682987628"><span class="hs-identifier hs-var">ex_tvs</span></a></span><span> </span><span class="annot"><span class="annottext">[InvisTVBinder] -&gt; [TyVar] -&gt; Bool
forall a b. [a] -&gt; [b] -&gt; Bool
</span><a href="GHC.Utils.Misc.html#equalLength"><span class="hs-operator hs-var">`equalLength`</span></a></span><span> </span><span class="annot"><span class="annottext">[TyVar]
</span><a href="#local-6989586621682987637"><span class="hs-identifier hs-var">ex_tvs1</span></a></span><span>
</span><span id="line-237"></span><span>                   </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682987631"><span class="hs-identifier hs-var">pat_ty</span></a></span><span> </span><span class="annot"><span class="annottext">HasCallStack =&gt; Type -&gt; Type -&gt; Bool
Type -&gt; Type -&gt; Bool
</span><a href="GHC.Core.TyCo.Compare.html#eqType"><span class="hs-operator hs-var">`eqType`</span></a></span><span> </span><span class="annot"><span class="annottext">HasDebugCallStack =&gt; Subst -&gt; Type -&gt; Type
Subst -&gt; Type -&gt; Type
</span><a href="GHC.Core.TyCo.Subst.html#substTy"><span class="hs-identifier hs-var">substTy</span></a></span><span> </span><span class="annot"><span class="annottext">Subst
</span><a href="#local-6989586621682987639"><span class="hs-identifier hs-var">subst</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Scaled Type -&gt; Type
forall a. Scaled a -&gt; a
</span><a href="GHC.Core.TyCo.Rep.html#scaledThing"><span class="hs-identifier hs-var">scaledThing</span></a></span><span> </span><span class="annot"><span class="annottext">Scaled Type
</span><a href="#local-6989586621682987640"><span class="hs-identifier hs-var">pat_ty1</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-238"></span><span>                   </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">ThetaType
</span><a href="#local-6989586621682987629"><span class="hs-identifier hs-var">prov_theta</span></a></span><span> </span><span class="annot"><span class="annottext">ThetaType -&gt; ThetaType -&gt; Bool
</span><a href="GHC.Core.TyCo.Compare.html#eqTypes"><span class="hs-operator hs-var">`eqTypes`</span></a></span><span> </span><span class="annot"><span class="annottext">HasDebugCallStack =&gt; Subst -&gt; ThetaType -&gt; ThetaType
Subst -&gt; ThetaType -&gt; ThetaType
</span><a href="GHC.Core.TyCo.Subst.html#substTys"><span class="hs-identifier hs-var">substTys</span></a></span><span> </span><span class="annot"><span class="annottext">Subst
</span><a href="#local-6989586621682987639"><span class="hs-identifier hs-var">subst</span></a></span><span> </span><span class="annot"><span class="annottext">ThetaType
</span><a href="#local-6989586621682987643"><span class="hs-identifier hs-var">prov_theta1</span></a></span><span>
</span><span id="line-239"></span><span>                   </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">ThetaType
</span><a href="#local-6989586621682987627"><span class="hs-identifier hs-var">req_theta</span></a></span><span> </span><span class="annot"><span class="annottext">ThetaType -&gt; ThetaType -&gt; Bool
</span><a href="GHC.Core.TyCo.Compare.html#eqTypes"><span class="hs-operator hs-var">`eqTypes`</span></a></span><span> </span><span class="annot"><span class="annottext">HasDebugCallStack =&gt; Subst -&gt; ThetaType -&gt; ThetaType
Subst -&gt; ThetaType -&gt; ThetaType
</span><a href="GHC.Core.TyCo.Subst.html#substTys"><span class="hs-identifier hs-var">substTys</span></a></span><span> </span><span class="annot"><span class="annottext">Subst
</span><a href="#local-6989586621682987639"><span class="hs-identifier hs-var">subst</span></a></span><span> </span><span class="annot"><span class="annottext">ThetaType
</span><a href="#local-6989586621682987644"><span class="hs-identifier hs-var">req_theta1</span></a></span><span>
</span><span id="line-240"></span><span>                   </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">ThetaType -&gt; ThetaType -&gt; Bool
</span><a href="#local-6989586621682987645"><span class="hs-identifier hs-var">compareArgTys</span></a></span><span> </span><span class="annot"><span class="annottext">ThetaType
</span><a href="#local-6989586621682987630"><span class="hs-identifier hs-var">arg_tys</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">HasDebugCallStack =&gt; Subst -&gt; ThetaType -&gt; ThetaType
Subst -&gt; ThetaType -&gt; ThetaType
</span><a href="GHC.Core.TyCo.Subst.html#substTys"><span class="hs-identifier hs-var">substTys</span></a></span><span> </span><span class="annot"><span class="annottext">Subst
</span><a href="#local-6989586621682987639"><span class="hs-identifier hs-var">subst</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(Scaled Type -&gt; Type) -&gt; [Scaled Type] -&gt; ThetaType
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><span class="hs-identifier hs-var">map</span></span><span> </span><span class="annot"><span class="annottext">Scaled Type -&gt; Type
forall a. Scaled a -&gt; a
</span><a href="GHC.Core.TyCo.Rep.html#scaledThing"><span class="hs-identifier hs-var">scaledThing</span></a></span><span> </span><span class="annot"><span class="annottext">[Scaled Type]
</span><a href="#local-6989586621682987646"><span class="hs-identifier hs-var">arg_tys1</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-241"></span><span>                   </span><span class="hs-special">]</span><span class="hs-special">)</span><span>
</span><span id="line-242"></span><span>              </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[SDoc] -&gt; SDoc
forall doc. IsDoc doc =&gt; [doc] -&gt; doc
</span><a href="GHC.Utils.Outputable.html#vcat"><span class="hs-identifier hs-var">vcat</span></a></span><span> </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">[InvisTVBinder] -&gt; SDoc
forall a. Outputable a =&gt; a -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="annot"><span class="annottext">[InvisTVBinder]
</span><a href="#local-6989586621682987626"><span class="hs-identifier hs-var">univ_tvs</span></a></span><span> </span><span class="annot"><span class="annottext">SDoc -&gt; SDoc -&gt; SDoc
forall doc. IsLine doc =&gt; doc -&gt; doc -&gt; doc
</span><a href="GHC.Utils.Outputable.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">SDoc
</span><a href="#local-6989586621682987648"><span class="hs-identifier hs-var">twiddle</span></a></span><span> </span><span class="annot"><span class="annottext">SDoc -&gt; SDoc -&gt; SDoc
forall doc. IsLine doc =&gt; doc -&gt; doc -&gt; doc
</span><a href="GHC.Utils.Outputable.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">[TyVar] -&gt; SDoc
forall a. Outputable a =&gt; a -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="annot"><span class="annottext">[TyVar]
</span><a href="#local-6989586621682987636"><span class="hs-identifier hs-var">univ_tvs1</span></a></span><span>
</span><span id="line-243"></span><span>                    </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">[InvisTVBinder] -&gt; SDoc
forall a. Outputable a =&gt; a -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="annot"><span class="annottext">[InvisTVBinder]
</span><a href="#local-6989586621682987628"><span class="hs-identifier hs-var">ex_tvs</span></a></span><span> </span><span class="annot"><span class="annottext">SDoc -&gt; SDoc -&gt; SDoc
forall doc. IsLine doc =&gt; doc -&gt; doc -&gt; doc
</span><a href="GHC.Utils.Outputable.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">SDoc
</span><a href="#local-6989586621682987648"><span class="hs-identifier hs-var">twiddle</span></a></span><span> </span><span class="annot"><span class="annottext">SDoc -&gt; SDoc -&gt; SDoc
forall doc. IsLine doc =&gt; doc -&gt; doc -&gt; doc
</span><a href="GHC.Utils.Outputable.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">[TyVar] -&gt; SDoc
forall a. Outputable a =&gt; a -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="annot"><span class="annottext">[TyVar]
</span><a href="#local-6989586621682987637"><span class="hs-identifier hs-var">ex_tvs1</span></a></span><span>
</span><span id="line-244"></span><span>                    </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Type -&gt; SDoc
forall a. Outputable a =&gt; a -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682987631"><span class="hs-identifier hs-var">pat_ty</span></a></span><span> </span><span class="annot"><span class="annottext">SDoc -&gt; SDoc -&gt; SDoc
forall doc. IsLine doc =&gt; doc -&gt; doc -&gt; doc
</span><a href="GHC.Utils.Outputable.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">SDoc
</span><a href="#local-6989586621682987648"><span class="hs-identifier hs-var">twiddle</span></a></span><span> </span><span class="annot"><span class="annottext">SDoc -&gt; SDoc -&gt; SDoc
forall doc. IsLine doc =&gt; doc -&gt; doc -&gt; doc
</span><a href="GHC.Utils.Outputable.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">Scaled Type -&gt; SDoc
forall a. Outputable a =&gt; a -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="annot"><span class="annottext">Scaled Type
</span><a href="#local-6989586621682987640"><span class="hs-identifier hs-var">pat_ty1</span></a></span><span>
</span><span id="line-245"></span><span>                    </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">ThetaType -&gt; SDoc
forall a. Outputable a =&gt; a -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="annot"><span class="annottext">ThetaType
</span><a href="#local-6989586621682987629"><span class="hs-identifier hs-var">prov_theta</span></a></span><span> </span><span class="annot"><span class="annottext">SDoc -&gt; SDoc -&gt; SDoc
forall doc. IsLine doc =&gt; doc -&gt; doc -&gt; doc
</span><a href="GHC.Utils.Outputable.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">SDoc
</span><a href="#local-6989586621682987648"><span class="hs-identifier hs-var">twiddle</span></a></span><span> </span><span class="annot"><span class="annottext">SDoc -&gt; SDoc -&gt; SDoc
forall doc. IsLine doc =&gt; doc -&gt; doc -&gt; doc
</span><a href="GHC.Utils.Outputable.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">ThetaType -&gt; SDoc
forall a. Outputable a =&gt; a -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="annot"><span class="annottext">ThetaType
</span><a href="#local-6989586621682987643"><span class="hs-identifier hs-var">prov_theta1</span></a></span><span>
</span><span id="line-246"></span><span>                    </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">ThetaType -&gt; SDoc
forall a. Outputable a =&gt; a -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="annot"><span class="annottext">ThetaType
</span><a href="#local-6989586621682987627"><span class="hs-identifier hs-var">req_theta</span></a></span><span> </span><span class="annot"><span class="annottext">SDoc -&gt; SDoc -&gt; SDoc
forall doc. IsLine doc =&gt; doc -&gt; doc -&gt; doc
</span><a href="GHC.Utils.Outputable.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">SDoc
</span><a href="#local-6989586621682987648"><span class="hs-identifier hs-var">twiddle</span></a></span><span> </span><span class="annot"><span class="annottext">SDoc -&gt; SDoc -&gt; SDoc
forall doc. IsLine doc =&gt; doc -&gt; doc -&gt; doc
</span><a href="GHC.Utils.Outputable.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">ThetaType -&gt; SDoc
forall a. Outputable a =&gt; a -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="annot"><span class="annottext">ThetaType
</span><a href="#local-6989586621682987644"><span class="hs-identifier hs-var">req_theta1</span></a></span><span>
</span><span id="line-247"></span><span>                    </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">ThetaType -&gt; SDoc
forall a. Outputable a =&gt; a -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="annot"><span class="annottext">ThetaType
</span><a href="#local-6989586621682987630"><span class="hs-identifier hs-var">arg_tys</span></a></span><span> </span><span class="annot"><span class="annottext">SDoc -&gt; SDoc -&gt; SDoc
forall doc. IsLine doc =&gt; doc -&gt; doc -&gt; doc
</span><a href="GHC.Utils.Outputable.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">SDoc
</span><a href="#local-6989586621682987648"><span class="hs-identifier hs-var">twiddle</span></a></span><span> </span><span class="annot"><span class="annottext">SDoc -&gt; SDoc -&gt; SDoc
forall doc. IsLine doc =&gt; doc -&gt; doc -&gt; doc
</span><a href="GHC.Utils.Outputable.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">[Scaled Type] -&gt; SDoc
forall a. Outputable a =&gt; a -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="annot"><span class="annottext">[Scaled Type]
</span><a href="#local-6989586621682987646"><span class="hs-identifier hs-var">arg_tys1</span></a></span><span class="hs-special">]</span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(PatSyn -&gt; PatSyn) -&gt; PatSyn -&gt; PatSyn
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-248"></span><span>    </span><span class="annot"><span class="annottext">Name
-&gt; Bool
-&gt; ([InvisTVBinder], ThetaType)
-&gt; ([InvisTVBinder], ThetaType)
-&gt; ThetaType
-&gt; Type
-&gt; PatSynMatcher
-&gt; PatSynBuilder
-&gt; [FieldLabel]
-&gt; PatSyn
</span><a href="GHC.Core.PatSyn.html#mkPatSyn"><span class="hs-identifier hs-var">mkPatSyn</span></a></span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621682987621"><span class="hs-identifier hs-var">src_name</span></a></span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621682987622"><span class="hs-identifier hs-var">declared_infix</span></a></span><span>
</span><span id="line-249"></span><span>             </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[InvisTVBinder]
</span><a href="#local-6989586621682987626"><span class="hs-identifier hs-var">univ_tvs</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">ThetaType
</span><a href="#local-6989586621682987627"><span class="hs-identifier hs-var">req_theta</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[InvisTVBinder]
</span><a href="#local-6989586621682987628"><span class="hs-identifier hs-var">ex_tvs</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">ThetaType
</span><a href="#local-6989586621682987629"><span class="hs-identifier hs-var">prov_theta</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-250"></span><span>             </span><span class="annot"><span class="annottext">ThetaType
</span><a href="#local-6989586621682987630"><span class="hs-identifier hs-var">arg_tys</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682987631"><span class="hs-identifier hs-var">pat_ty</span></a></span><span>
</span><span id="line-251"></span><span>             </span><span class="annot"><span class="annottext">PatSynMatcher
</span><a href="#local-6989586621682987623"><span class="hs-identifier hs-var">matcher</span></a></span><span> </span><span class="annot"><span class="annottext">PatSynBuilder
</span><a href="#local-6989586621682987625"><span class="hs-identifier hs-var">builder</span></a></span><span> </span><span class="annot"><span class="annottext">[FieldLabel]
</span><a href="#local-6989586621682987632"><span class="hs-identifier hs-var">field_labels</span></a></span><span>
</span><span id="line-252"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-253"></span><span>    </span><span class="hs-special">(</span><span class="hs-special">(</span><span class="annot"><span class="annottext">TyVar
</span><span class="hs-identifier">_</span></span><span class="annot"><span class="hs-glyph hs-type">:</span></span><span class="annot"><span class="annottext">TyVar
</span><span class="hs-identifier">_</span></span><span class="annot"><span class="hs-glyph hs-type">:</span></span><span id="local-6989586621682987636"><span class="annot"><span class="annottext">[TyVar]
</span><a href="#local-6989586621682987636"><span class="hs-identifier hs-var">univ_tvs1</span></a></span></span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span id="local-6989586621682987644"><span class="annot"><span class="annottext">ThetaType
</span><a href="#local-6989586621682987644"><span class="hs-identifier hs-var">req_theta1</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682987650"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682987650"><span class="hs-identifier hs-var">tau</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Type -&gt; ([TyVar], ThetaType, Type)
</span><a href="GHC.Tc.Utils.TcType.html#tcSplitSigmaTy"><span class="hs-identifier hs-var">tcSplitSigmaTy</span></a></span><span> </span><span class="annot"><span class="annottext">(Type -&gt; ([TyVar], ThetaType, Type))
-&gt; Type -&gt; ([TyVar], ThetaType, Type)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682987624"><span class="hs-identifier hs-var">matcher_ty</span></a></span><span>
</span><span id="line-254"></span><span>    </span><span class="hs-special">(</span><span class="hs-special">[</span><span id="local-6989586621682987640"><span class="annot"><span class="annottext">Scaled Type
</span><a href="#local-6989586621682987640"><span class="hs-identifier hs-var">pat_ty1</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682987652"><span class="annot"><span class="annottext">Scaled Type
</span><a href="#local-6989586621682987652"><span class="hs-identifier hs-var">cont_sigma</span></a></span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Scaled Type
</span><span class="hs-identifier">_</span></span><span class="hs-special">]</span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Type
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span>      </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Type -&gt; ([Scaled Type], Type)
</span><a href="GHC.Tc.Utils.TcType.html#tcSplitFunTys"><span class="hs-identifier hs-var">tcSplitFunTys</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682987650"><span class="hs-identifier hs-var">tau</span></a></span><span>
</span><span id="line-255"></span><span>    </span><span class="hs-special">(</span><span id="local-6989586621682987637"><span class="annot"><span class="annottext">[TyVar]
</span><a href="#local-6989586621682987637"><span class="hs-identifier hs-var">ex_tvs1</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682987643"><span class="annot"><span class="annottext">ThetaType
</span><a href="#local-6989586621682987643"><span class="hs-identifier hs-var">prov_theta1</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682987654"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682987654"><span class="hs-identifier hs-var">cont_tau</span></a></span></span><span class="hs-special">)</span><span>   </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Type -&gt; ([TyVar], ThetaType, Type)
</span><a href="GHC.Tc.Utils.TcType.html#tcSplitSigmaTy"><span class="hs-identifier hs-var">tcSplitSigmaTy</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Scaled Type -&gt; Type
forall a. Scaled a -&gt; a
</span><a href="GHC.Core.TyCo.Rep.html#scaledThing"><span class="hs-identifier hs-var">scaledThing</span></a></span><span> </span><span class="annot"><span class="annottext">Scaled Type
</span><a href="#local-6989586621682987652"><span class="hs-identifier hs-var">cont_sigma</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-256"></span><span>    </span><span class="hs-special">(</span><span id="local-6989586621682987646"><span class="annot"><span class="annottext">[Scaled Type]
</span><a href="#local-6989586621682987646"><span class="hs-identifier hs-var">arg_tys1</span></a></span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Type
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Type -&gt; ([Scaled Type], Type)
</span><a href="GHC.Tc.Utils.TcType.html#tcSplitFunTys"><span class="hs-identifier hs-var">tcSplitFunTys</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682987654"><span class="hs-identifier hs-var">cont_tau</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-257"></span><span>    </span><span id="local-6989586621682987648"><span class="annot"><span class="annottext">twiddle :: SDoc
</span><a href="#local-6989586621682987648"><span class="hs-identifier hs-var hs-var">twiddle</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Char -&gt; SDoc
forall doc. IsLine doc =&gt; Char -&gt; doc
</span><a href="GHC.Utils.Outputable.html#char"><span class="hs-identifier hs-var">char</span></a></span><span> </span><span class="annot"><span class="annottext">Char
</span><span class="hs-char">'~'</span></span><span>
</span><span id="line-258"></span><span>    </span><span id="local-6989586621682987639"><span class="annot"><span class="annottext">subst :: Subst
</span><a href="#local-6989586621682987639"><span class="hs-identifier hs-var hs-var">subst</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[TyVar] -&gt; ThetaType -&gt; Subst
HasDebugCallStack =&gt; [TyVar] -&gt; ThetaType -&gt; Subst
</span><a href="GHC.Core.TyCo.Subst.html#zipTvSubst"><span class="hs-identifier hs-var">zipTvSubst</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[TyVar]
</span><a href="#local-6989586621682987636"><span class="hs-identifier hs-var">univ_tvs1</span></a></span><span> </span><span class="annot"><span class="annottext">[TyVar] -&gt; [TyVar] -&gt; [TyVar]
forall a. [a] -&gt; [a] -&gt; [a]
</span><span class="hs-operator hs-var">++</span></span><span> </span><span class="annot"><span class="annottext">[TyVar]
</span><a href="#local-6989586621682987637"><span class="hs-identifier hs-var">ex_tvs1</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-259"></span><span>                       </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[TyVar] -&gt; ThetaType
</span><a href="GHC.Core.TyCo.Rep.html#mkTyVarTys"><span class="hs-identifier hs-var">mkTyVarTys</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[InvisTVBinder] -&gt; [TyVar]
forall tv argf. [VarBndr tv argf] -&gt; [tv]
</span><a href="GHC.Types.Var.html#binderVars"><span class="hs-identifier hs-var">binderVars</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[InvisTVBinder]
</span><a href="#local-6989586621682987626"><span class="hs-identifier hs-var">univ_tvs</span></a></span><span> </span><span class="annot"><span class="annottext">[InvisTVBinder] -&gt; [InvisTVBinder] -&gt; [InvisTVBinder]
forall a. [a] -&gt; [a] -&gt; [a]
</span><span class="hs-operator hs-var">++</span></span><span> </span><span class="annot"><span class="annottext">[InvisTVBinder]
</span><a href="#local-6989586621682987628"><span class="hs-identifier hs-var">ex_tvs</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-260"></span><span>
</span><span id="line-261"></span><span>    </span><span class="hs-comment">-- For a nullary pattern synonym we add a single (# #) argument to the</span><span>
</span><span id="line-262"></span><span>    </span><span class="hs-comment">-- matcher to preserve laziness in the case of unlifted types.</span><span>
</span><span id="line-263"></span><span>    </span><span class="hs-comment">-- See #12746</span><span>
</span><span id="line-264"></span><span>    </span><span class="annot"><a href="#local-6989586621682987645"><span class="hs-identifier hs-type">compareArgTys</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#Type"><span class="hs-identifier hs-type">Type</span></a></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#Type"><span class="hs-identifier hs-type">Type</span></a></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Bool</span></span><span>
</span><span id="line-265"></span><span>    </span><span id="local-6989586621682987645"><span class="annot"><span class="annottext">compareArgTys :: ThetaType -&gt; ThetaType -&gt; Bool
</span><a href="#local-6989586621682987645"><span class="hs-identifier hs-var hs-var">compareArgTys</span></a></span></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><span class="hs-special">[</span><span id="local-6989586621682987660"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682987660"><span class="hs-identifier hs-var">x</span></a></span></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682987660"><span class="hs-identifier hs-var">x</span></a></span><span> </span><span class="annot"><span class="annottext">HasCallStack =&gt; Type -&gt; Type -&gt; Bool
Type -&gt; Type -&gt; Bool
</span><a href="GHC.Core.TyCo.Compare.html#eqType"><span class="hs-operator hs-var">`eqType`</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="GHC.Builtin.Types.html#unboxedUnitTy"><span class="hs-identifier hs-var">unboxedUnitTy</span></a></span><span>
</span><span id="line-266"></span><span>    </span><span class="annot"><a href="#local-6989586621682987645"><span class="hs-identifier hs-var">compareArgTys</span></a></span><span> </span><span id="local-6989586621682987662"><span class="annot"><span class="annottext">ThetaType
</span><a href="#local-6989586621682987662"><span class="hs-identifier hs-var">arg_tys</span></a></span></span><span> </span><span id="local-6989586621682987663"><span class="annot"><span class="annottext">ThetaType
</span><a href="#local-6989586621682987663"><span class="hs-identifier hs-var">matcher_arg_tys</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ThetaType
</span><a href="#local-6989586621682987662"><span class="hs-identifier hs-var">arg_tys</span></a></span><span> </span><span class="annot"><span class="annottext">ThetaType -&gt; ThetaType -&gt; Bool
</span><a href="GHC.Core.TyCo.Compare.html#eqTypes"><span class="hs-operator hs-var">`eqTypes`</span></a></span><span> </span><span class="annot"><span class="annottext">ThetaType
</span><a href="#local-6989586621682987663"><span class="hs-identifier hs-var">matcher_arg_tys</span></a></span><span>
</span><span id="line-267"></span><span>
</span><span id="line-268"></span><span>
</span><span id="line-269"></span><span class="hs-comment">------------------------------------------------------</span><span>
</span><span id="line-270"></span><span class="hs-keyword">type</span><span> </span><span id="TcMethInfo"><span class="annot"><a href="GHC.Tc.TyCl.Build.html#TcMethInfo"><span class="hs-identifier hs-var">TcMethInfo</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="GHC.Tc.TyCl.Build.html#MethInfo"><span class="hs-identifier hs-type">MethInfo</span></a></span><span>  </span><span class="hs-comment">-- this variant needs zonking</span><span>
</span><span id="line-271"></span><span class="hs-keyword">type</span><span> </span><span id="MethInfo"><span class="annot"><a href="GHC.Tc.TyCl.Build.html#MethInfo"><span class="hs-identifier hs-var">MethInfo</span></a></span></span><span>       </span><span class="hs-comment">-- A temporary intermediate, to communicate</span><span>
</span><span id="line-272"></span><span>                    </span><span class="hs-comment">-- between tcClassSigs and buildClass.</span><span>
</span><span id="line-273"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><span> </span><span class="annot"><a href="GHC.Types.Name.html#Name"><span class="hs-identifier hs-type">Name</span></a></span><span>   </span><span class="hs-comment">-- Name of the class op</span><span>
</span><span id="line-274"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#Type"><span class="hs-identifier hs-type">Type</span></a></span><span>   </span><span class="hs-comment">-- Type of the class op</span><span>
</span><span id="line-275"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Maybe</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Types.Basic.html#DefMethSpec"><span class="hs-identifier hs-type">DefMethSpec</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Types.SrcLoc.html#SrcSpan"><span class="hs-identifier hs-type">SrcSpan</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#Type"><span class="hs-identifier hs-type">Type</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-276"></span><span>         </span><span class="hs-comment">-- Nothing                    =&gt; no default method</span><span>
</span><span id="line-277"></span><span>         </span><span class="hs-comment">--</span><span>
</span><span id="line-278"></span><span>         </span><span class="hs-comment">-- Just VanillaDM             =&gt; There is an ordinary</span><span>
</span><span id="line-279"></span><span>         </span><span class="hs-comment">--                               polymorphic default method</span><span>
</span><span id="line-280"></span><span>         </span><span class="hs-comment">--</span><span>
</span><span id="line-281"></span><span>         </span><span class="hs-comment">-- Just (GenericDM (loc, ty)) =&gt; There is a generic default metho</span><span>
</span><span id="line-282"></span><span>         </span><span class="hs-comment">--                               Here is its type, and the location</span><span>
</span><span id="line-283"></span><span>         </span><span class="hs-comment">--                               of the type signature</span><span>
</span><span id="line-284"></span><span>         </span><span class="hs-comment">--    We need that location /only/ to attach it to the</span><span>
</span><span id="line-285"></span><span>         </span><span class="hs-comment">--    generic default method's Name; and we need /that/</span><span>
</span><span id="line-286"></span><span>         </span><span class="hs-comment">--    only to give the right location of an ambiguity error</span><span>
</span><span id="line-287"></span><span>         </span><span class="hs-comment">--    for the generic default method, spat out by checkValidClass</span><span>
</span><span id="line-288"></span><span>
</span><span id="line-289"></span><span id="local-6989586621682987369"><span id="local-6989586621682987370"><span class="annot"><a href="GHC.Tc.TyCl.Build.html#buildClass"><span class="hs-identifier hs-type">buildClass</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Types.Name.html#Name"><span class="hs-identifier hs-type">Name</span></a></span><span>  </span><span class="hs-comment">-- Name of the class/tycon (they have the same Name)</span><span>
</span><span id="line-290"></span><span>           </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="GHC.Core.TyCon.html#TyConBinder"><span class="hs-identifier hs-type">TyConBinder</span></a></span><span class="hs-special">]</span><span>                </span><span class="hs-comment">-- Of the tycon</span><span>
</span><span id="line-291"></span><span>           </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="Language.Haskell.Syntax.Basic.html#Role"><span class="hs-identifier hs-type">Role</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-292"></span><span>           </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="GHC.Core.Class.html#FunDep"><span class="hs-identifier hs-type">FunDep</span></a></span><span> </span><span class="annot"><a href="GHC.Types.Var.html#TyVar"><span class="hs-identifier hs-type">TyVar</span></a></span><span class="hs-special">]</span><span>               </span><span class="hs-comment">-- Functional dependencies</span><span>
</span><span id="line-293"></span><span>           </span><span class="hs-comment">-- Super classes, associated types, method info, minimal complete def.</span><span>
</span><span id="line-294"></span><span>           </span><span class="hs-comment">-- This is Nothing if the class is abstract.</span><span>
</span><span id="line-295"></span><span>           </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Maybe</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#KnotTied"><span class="hs-identifier hs-type">KnotTied</span></a></span><span> </span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#ThetaType"><span class="hs-identifier hs-type">ThetaType</span></a></span><span class="hs-special">,</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="GHC.Core.Class.html#ClassATItem"><span class="hs-identifier hs-type">ClassATItem</span></a></span><span class="hs-special">]</span><span class="hs-special">,</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#KnotTied"><span class="hs-identifier hs-type">KnotTied</span></a></span><span> </span><span class="annot"><a href="GHC.Tc.TyCl.Build.html#MethInfo"><span class="hs-identifier hs-type">MethInfo</span></a></span><span class="hs-special">]</span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Core.Class.html#ClassMinimalDef"><span class="hs-identifier hs-type">ClassMinimalDef</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-296"></span><span>           </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#TcRnIf"><span class="hs-identifier hs-type">TcRnIf</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682987369"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682987370"><span class="hs-identifier hs-type">n</span></a></span><span> </span><span class="annot"><a href="GHC.Core.Class.html#Class"><span class="hs-identifier hs-type">Class</span></a></span></span></span><span>
</span><span id="line-297"></span><span>
</span><span id="line-298"></span><span id="buildClass"><span class="annot"><span class="annottext">buildClass :: forall m n.
Name
-&gt; [TyConBinder]
-&gt; [Role]
-&gt; [FunDep TyVar]
-&gt; Maybe
     (ThetaType, [ClassATItem], [KnotTied MethInfo], ClassMinimalDef)
-&gt; TcRnIf m n Class
</span><a href="GHC.Tc.TyCl.Build.html#buildClass"><span class="hs-identifier hs-var hs-var">buildClass</span></a></span></span><span> </span><span id="local-6989586621682987698"><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621682987698"><span class="hs-identifier hs-var">tycon_name</span></a></span></span><span> </span><span id="local-6989586621682987699"><span class="annot"><span class="annottext">[TyConBinder]
</span><a href="#local-6989586621682987699"><span class="hs-identifier hs-var">binders</span></a></span></span><span> </span><span id="local-6989586621682987700"><span class="annot"><span class="annottext">[Role]
</span><a href="#local-6989586621682987700"><span class="hs-identifier hs-var">roles</span></a></span></span><span> </span><span id="local-6989586621682987701"><span class="annot"><span class="annottext">[FunDep TyVar]
</span><a href="#local-6989586621682987701"><span class="hs-identifier hs-var">fds</span></a></span></span><span> </span><span class="annot"><span class="annottext">Maybe
  (ThetaType, [ClassATItem], [KnotTied MethInfo], ClassMinimalDef)
</span><span class="hs-identifier hs-var">Nothing</span></span><span>
</span><span id="line-299"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(Class -&gt; IOEnv (Env m n) Class) -&gt; IOEnv (Env m n) Class
forall a env. (a -&gt; IOEnv env a) -&gt; IOEnv env a
</span><a href="GHC.Data.IOEnv.html#fixM"><span class="hs-identifier hs-var">fixM</span></a></span><span>  </span><span class="annot"><span class="annottext">((Class -&gt; IOEnv (Env m n) Class) -&gt; IOEnv (Env m n) Class)
-&gt; (Class -&gt; IOEnv (Env m n) Class) -&gt; IOEnv (Env m n) Class
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-glyph">\</span><span> </span><span id="local-6989586621682987703"><span class="annot"><span class="annottext">Class
</span><a href="#local-6989586621682987703"><span class="hs-identifier hs-var">rec_clas</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span>       </span><span class="hs-comment">-- Only name generation inside loop</span><span>
</span><span id="line-300"></span><span>    </span><span class="hs-keyword">do</span><span>  </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">SDoc -&gt; TcRnIf m n ()
forall m n. SDoc -&gt; TcRnIf m n ()
</span><a href="GHC.Tc.Utils.Monad.html#traceIf"><span class="hs-identifier hs-var">traceIf</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">String -&gt; SDoc
forall doc. IsLine doc =&gt; String -&gt; doc
</span><a href="GHC.Utils.Outputable.html#text"><span class="hs-identifier hs-var">text</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;buildClass&quot;</span></span><span class="hs-special">)</span><span>
</span><span id="line-301"></span><span>
</span><span id="line-302"></span><span>        </span><span class="hs-special">;</span><span> </span><span id="local-6989586621682987704"><span class="annot"><a href="#local-6989586621682987704"><span class="hs-identifier hs-var">tc_rep_name</span></a></span></span><span>  </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Name -&gt; TcRnIf m n Name
forall gbl lcl. Name -&gt; TcRnIf gbl lcl Name
</span><a href="GHC.Tc.TyCl.Build.html#newTyConRepName"><span class="hs-identifier hs-var">newTyConRepName</span></a></span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621682987698"><span class="hs-identifier hs-var">tycon_name</span></a></span><span>
</span><span id="line-303"></span><span>        </span><span class="hs-special">;</span><span> </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621682987705"><span class="annot"><a href="#local-6989586621682987705"><span class="hs-identifier hs-var hs-var">univ_tvs</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[TyConBinder] -&gt; [TyVar]
forall tv argf. [VarBndr tv argf] -&gt; [tv]
</span><a href="GHC.Types.Var.html#binderVars"><span class="hs-identifier hs-var">binderVars</span></a></span><span> </span><span class="annot"><span class="annottext">[TyConBinder]
</span><a href="#local-6989586621682987699"><span class="hs-identifier hs-var">binders</span></a></span><span>
</span><span id="line-304"></span><span>              </span><span id="local-6989586621682987706"><span class="annot"><a href="#local-6989586621682987706"><span class="hs-identifier hs-var hs-var">tycon</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Name
-&gt; [TyConBinder] -&gt; [Role] -&gt; AlgTyConRhs -&gt; Class -&gt; Name -&gt; TyCon
</span><a href="GHC.Core.TyCon.html#mkClassTyCon"><span class="hs-identifier hs-var">mkClassTyCon</span></a></span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621682987698"><span class="hs-identifier hs-var">tycon_name</span></a></span><span> </span><span class="annot"><span class="annottext">[TyConBinder]
</span><a href="#local-6989586621682987699"><span class="hs-identifier hs-var">binders</span></a></span><span> </span><span class="annot"><span class="annottext">[Role]
</span><a href="#local-6989586621682987700"><span class="hs-identifier hs-var">roles</span></a></span><span>
</span><span id="line-305"></span><span>                                   </span><span class="annot"><span class="annottext">AlgTyConRhs
</span><a href="GHC.Core.TyCon.html#AbstractTyCon"><span class="hs-identifier hs-var">AbstractTyCon</span></a></span><span>
</span><span id="line-306"></span><span>                                   </span><span class="annot"><span class="annottext">Class
</span><a href="#local-6989586621682987703"><span class="hs-identifier hs-var">rec_clas</span></a></span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621682987704"><span class="hs-identifier hs-var">tc_rep_name</span></a></span><span>
</span><span id="line-307"></span><span>              </span><span id="local-6989586621682987709"><span class="annot"><a href="#local-6989586621682987709"><span class="hs-identifier hs-var hs-var">result</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Name -&gt; [TyVar] -&gt; [FunDep TyVar] -&gt; TyCon -&gt; Class
</span><a href="GHC.Core.Class.html#mkAbstractClass"><span class="hs-identifier hs-var">mkAbstractClass</span></a></span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621682987698"><span class="hs-identifier hs-var">tycon_name</span></a></span><span> </span><span class="annot"><span class="annottext">[TyVar]
</span><a href="#local-6989586621682987705"><span class="hs-identifier hs-var">univ_tvs</span></a></span><span> </span><span class="annot"><span class="annottext">[FunDep TyVar]
</span><a href="#local-6989586621682987701"><span class="hs-identifier hs-var">fds</span></a></span><span> </span><span class="annot"><span class="annottext">TyCon
</span><a href="#local-6989586621682987706"><span class="hs-identifier hs-var">tycon</span></a></span><span>
</span><span id="line-308"></span><span>        </span><span class="hs-special">;</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.Monad.html#traceIf"><span class="hs-identifier hs-type">traceIf</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Utils.Outputable.html#text"><span class="hs-identifier hs-type">text</span></a></span><span> </span><span class="annot"><span class="hs-string">&quot;buildClass&quot;</span></span><span> </span><span class="annot"><a href="GHC.Utils.Outputable.html#%3C%2B%3E"><span class="hs-operator hs-type">&lt;+&gt;</span></a></span><span> </span><span class="annot"><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-type">ppr</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682987706"><span class="hs-identifier hs-type">tycon</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-309"></span><span>        </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">return</span></span><span> </span><span class="annot"><a href="#local-6989586621682987709"><span class="hs-identifier hs-type">result</span></a></span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-310"></span><span>
</span><span id="line-311"></span><span class="annot"><a href="GHC.Tc.TyCl.Build.html#buildClass"><span class="hs-identifier hs-var">buildClass</span></a></span><span> </span><span id="local-6989586621682987711"><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621682987711"><span class="hs-identifier hs-var">tycon_name</span></a></span></span><span> </span><span id="local-6989586621682987712"><span class="annot"><span class="annottext">[TyConBinder]
</span><a href="#local-6989586621682987712"><span class="hs-identifier hs-var">binders</span></a></span></span><span> </span><span id="local-6989586621682987713"><span class="annot"><span class="annottext">[Role]
</span><a href="#local-6989586621682987713"><span class="hs-identifier hs-var">roles</span></a></span></span><span> </span><span id="local-6989586621682987714"><span class="annot"><span class="annottext">[FunDep TyVar]
</span><a href="#local-6989586621682987714"><span class="hs-identifier hs-var">fds</span></a></span></span><span>
</span><span id="line-312"></span><span>           </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span class="hs-special">(</span><span id="local-6989586621682987715"><span class="annot"><span class="annottext">ThetaType
</span><a href="#local-6989586621682987715"><span class="hs-identifier hs-var">sc_theta</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682987716"><span class="annot"><span class="annottext">[ClassATItem]
</span><a href="#local-6989586621682987716"><span class="hs-identifier hs-var">at_items</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682987717"><span class="annot"><span class="annottext">[KnotTied MethInfo]
</span><a href="#local-6989586621682987717"><span class="hs-identifier hs-var">sig_stuff</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682987718"><span class="annot"><span class="annottext">ClassMinimalDef
</span><a href="#local-6989586621682987718"><span class="hs-identifier hs-var">mindef</span></a></span></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-313"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(Class -&gt; IOEnv (Env m n) Class) -&gt; IOEnv (Env m n) Class
forall a env. (a -&gt; IOEnv env a) -&gt; IOEnv env a
</span><a href="GHC.Data.IOEnv.html#fixM"><span class="hs-identifier hs-var">fixM</span></a></span><span>  </span><span class="annot"><span class="annottext">((Class -&gt; IOEnv (Env m n) Class) -&gt; IOEnv (Env m n) Class)
-&gt; (Class -&gt; IOEnv (Env m n) Class) -&gt; IOEnv (Env m n) Class
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-glyph">\</span><span> </span><span id="local-6989586621682987719"><span class="annot"><span class="annottext">Class
</span><a href="#local-6989586621682987719"><span class="hs-identifier hs-var">rec_clas</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span>       </span><span class="hs-comment">-- Only name generation inside loop</span><span>
</span><span id="line-314"></span><span>    </span><span class="hs-keyword">do</span><span>  </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">SDoc -&gt; TcRnIf m n ()
forall m n. SDoc -&gt; TcRnIf m n ()
</span><a href="GHC.Tc.Utils.Monad.html#traceIf"><span class="hs-identifier hs-var">traceIf</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">String -&gt; SDoc
forall doc. IsLine doc =&gt; String -&gt; doc
</span><a href="GHC.Utils.Outputable.html#text"><span class="hs-identifier hs-var">text</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;buildClass&quot;</span></span><span class="hs-special">)</span><span>
</span><span id="line-315"></span><span>
</span><span id="line-316"></span><span>        </span><span class="hs-special">;</span><span> </span><span id="local-6989586621682987720"><span class="annot"><a href="#local-6989586621682987720"><span class="hs-identifier hs-var">datacon_name</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Name -&gt; (OccName -&gt; OccName) -&gt; TcRnIf m n Name
forall m n. Name -&gt; (OccName -&gt; OccName) -&gt; TcRnIf m n Name
</span><a href="GHC.Tc.TyCl.Build.html#newImplicitBinder"><span class="hs-identifier hs-var">newImplicitBinder</span></a></span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621682987711"><span class="hs-identifier hs-var">tycon_name</span></a></span><span> </span><span class="annot"><span class="annottext">OccName -&gt; OccName
</span><a href="GHC.Types.Name.Occurrence.html#mkClassDataConOcc"><span class="hs-identifier hs-var">mkClassDataConOcc</span></a></span><span>
</span><span id="line-317"></span><span>        </span><span class="hs-special">;</span><span> </span><span id="local-6989586621682987722"><span class="annot"><a href="#local-6989586621682987722"><span class="hs-identifier hs-var">tc_rep_name</span></a></span></span><span>  </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><a href="GHC.Tc.TyCl.Build.html#newTyConRepName"><span class="hs-identifier hs-type">newTyConRepName</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682987711"><span class="hs-identifier hs-type">tycon_name</span></a></span><span>
</span><span id="line-318"></span><span>
</span><span id="line-319"></span><span>        </span><span class="hs-special">;</span><span> </span><span id="local-6989586621682987723"><span class="annot"><a href="#local-6989586621682987723"><span class="hs-identifier hs-var">op_items</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="hs-identifier hs-type">mapM</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621682987725"><span class="hs-identifier hs-type">mk_op_item</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682987719"><span class="hs-identifier hs-type">rec_clas</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><a href="#local-6989586621682987717"><span class="hs-identifier hs-type">sig_stuff</span></a></span><span>
</span><span id="line-320"></span><span>                        </span><span class="hs-comment">-- Build the selector id and default method id</span><span>
</span><span id="line-321"></span><span>
</span><span id="line-322"></span><span>              </span><span class="hs-comment">-- Make selectors for the superclasses</span><span>
</span><span id="line-323"></span><span>        </span><span class="hs-special">;</span><span> </span><span id="local-6989586621682987726"><span class="annot"><a href="#local-6989586621682987726"><span class="hs-identifier hs-var">sc_sel_names</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="hs-identifier hs-type">mapM</span></span><span>  </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Tc.TyCl.Build.html#newImplicitBinder"><span class="hs-identifier hs-type">newImplicitBinder</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682987711"><span class="hs-identifier hs-type">tycon_name</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">.</span></span><span> </span><span class="annot"><a href="GHC.Types.Name.Occurrence.html#mkSuperDictSelOcc"><span class="hs-identifier hs-type">mkSuperDictSelOcc</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-324"></span><span>                                </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Utils.Misc.html#takeList"><span class="hs-identifier hs-type">takeList</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682987715"><span class="hs-identifier hs-type">sc_theta</span></a></span><span> </span><span class="hs-special">[</span><span class="annot"><a href="GHC.Types.Basic.html#fIRST_TAG"><span class="hs-identifier hs-type">fIRST_TAG</span></a></span><span class="hs-glyph">..</span><span class="hs-special">]</span><span class="hs-special">)</span><span>
</span><span id="line-325"></span><span>        </span><span class="hs-special">;</span><span> </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621682987731"><span class="annot"><a href="#local-6989586621682987731"><span class="hs-identifier hs-var hs-var">sc_sel_ids</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">Name -&gt; Class -&gt; TyVar
</span><a href="GHC.Types.Id.Make.html#mkDictSelId"><span class="hs-identifier hs-var">mkDictSelId</span></a></span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621682987733"><span class="hs-identifier hs-var">sc_name</span></a></span><span> </span><span class="annot"><span class="annottext">Class
</span><a href="#local-6989586621682987719"><span class="hs-identifier hs-var">rec_clas</span></a></span><span>
</span><span id="line-326"></span><span>                           </span><span class="hs-glyph">|</span><span> </span><span id="local-6989586621682987733"><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621682987733"><span class="hs-identifier hs-var">sc_name</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">[Name]
</span><a href="#local-6989586621682987726"><span class="hs-identifier hs-var">sc_sel_names</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-327"></span><span>              </span><span class="hs-comment">-- We number off the Dict superclass selectors, 1, 2, 3 etc so that we</span><span>
</span><span id="line-328"></span><span>              </span><span class="hs-comment">-- can construct names for the selectors. Thus</span><span>
</span><span id="line-329"></span><span>              </span><span class="hs-comment">--      class (C a, C b) =&gt; D a b where ...</span><span>
</span><span id="line-330"></span><span>              </span><span class="hs-comment">-- gives superclass selectors</span><span>
</span><span id="line-331"></span><span>              </span><span class="hs-comment">--      D_sc1, D_sc2</span><span>
</span><span id="line-332"></span><span>              </span><span class="hs-comment">-- (We used to call them D_C, but now we can have two different</span><span>
</span><span id="line-333"></span><span>              </span><span class="hs-comment">--  superclasses both called C!)</span><span>
</span><span id="line-334"></span><span>
</span><span id="line-335"></span><span>        </span><span class="hs-special">;</span><span> </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621682987734"><span class="annot"><a href="#local-6989586621682987734"><span class="hs-identifier hs-var hs-var">use_newtype</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ThetaType -&gt; Bool
forall a. [a] -&gt; Bool
</span><a href="GHC.Utils.Misc.html#isSingleton"><span class="hs-identifier hs-var">isSingleton</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ThetaType
</span><a href="#local-6989586621682987715"><span class="hs-identifier hs-var">sc_theta</span></a></span><span> </span><span class="annot"><span class="annottext">ThetaType -&gt; ThetaType -&gt; ThetaType
forall a. [a] -&gt; [a] -&gt; [a]
</span><span class="hs-operator hs-var">++</span></span><span> </span><span class="annot"><span class="annottext">ThetaType
</span><a href="#local-6989586621682987736"><span class="hs-identifier hs-var">op_tys</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-336"></span><span>                </span><span class="hs-comment">-- Use a newtype if the data constructor</span><span>
</span><span id="line-337"></span><span>                </span><span class="hs-comment">--   (a) has exactly one value field</span><span>
</span><span id="line-338"></span><span>                </span><span class="hs-comment">--       i.e. exactly one operation or superclass taken together</span><span>
</span><span id="line-339"></span><span>                </span><span class="hs-comment">--   (b) that value is of lifted type (which they always are, because</span><span>
</span><span id="line-340"></span><span>                </span><span class="hs-comment">--       we box equality superclasses)</span><span>
</span><span id="line-341"></span><span>                </span><span class="hs-comment">-- See Note [Class newtypes and equality predicates]</span><span>
</span><span id="line-342"></span><span>                </span><span class="hs-comment">--</span><span>
</span><span id="line-343"></span><span>                </span><span class="hs-comment">-- In the case of</span><span>
</span><span id="line-344"></span><span>                </span><span class="hs-comment">--     class C a =&gt; D a</span><span>
</span><span id="line-345"></span><span>                </span><span class="hs-comment">-- we use a newtype, but with one superclass and no arguments</span><span>
</span><span id="line-346"></span><span>              </span><span id="local-6989586621682987737"><span class="annot"><a href="#local-6989586621682987737"><span class="hs-identifier hs-var hs-var">args</span></a></span></span><span>       </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[Name]
</span><a href="#local-6989586621682987726"><span class="hs-identifier hs-var">sc_sel_names</span></a></span><span> </span><span class="annot"><span class="annottext">[Name] -&gt; [Name] -&gt; [Name]
forall a. [a] -&gt; [a] -&gt; [a]
</span><span class="hs-operator hs-var">++</span></span><span> </span><span class="annot"><span class="annottext">[Name]
</span><a href="#local-6989586621682987738"><span class="hs-identifier hs-var">op_names</span></a></span><span>
</span><span id="line-347"></span><span>              </span><span id="local-6989586621682987736"><span class="annot"><a href="#local-6989586621682987736"><span class="hs-identifier hs-var hs-var">op_tys</span></a></span></span><span>     </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682987739"><span class="hs-identifier hs-var">ty</span></a></span><span> </span><span class="hs-glyph">|</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Name
</span><span class="hs-identifier">_</span></span><span class="hs-special">,</span><span id="local-6989586621682987739"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682987739"><span class="hs-identifier hs-var">ty</span></a></span></span><span class="hs-special">,</span><span class="annot"><span class="annottext">Maybe (DefMethSpec (SrcSpan, Type))
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">[KnotTied MethInfo]
</span><a href="#local-6989586621682987717"><span class="hs-identifier hs-var">sig_stuff</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-348"></span><span>              </span><span id="local-6989586621682987738"><span class="annot"><a href="#local-6989586621682987738"><span class="hs-identifier hs-var hs-var">op_names</span></a></span></span><span>   </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621682987740"><span class="hs-identifier hs-var">op</span></a></span><span> </span><span class="hs-glyph">|</span><span> </span><span class="hs-special">(</span><span id="local-6989586621682987740"><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621682987740"><span class="hs-identifier hs-var">op</span></a></span></span><span class="hs-special">,</span><span class="annot"><span class="annottext">Type
</span><span class="hs-identifier">_</span></span><span class="hs-special">,</span><span class="annot"><span class="annottext">Maybe (DefMethSpec (SrcSpan, Type))
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">[KnotTied MethInfo]
</span><a href="#local-6989586621682987717"><span class="hs-identifier hs-var">sig_stuff</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-349"></span><span>              </span><span id="local-6989586621682987741"><span class="annot"><a href="#local-6989586621682987741"><span class="hs-identifier hs-var hs-var">rec_tycon</span></a></span></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Class -&gt; TyCon
</span><a href="GHC.Core.Class.html#classTyCon"><span class="hs-identifier hs-var">classTyCon</span></a></span><span> </span><span class="annot"><span class="annottext">Class
</span><a href="#local-6989586621682987719"><span class="hs-identifier hs-var">rec_clas</span></a></span><span>
</span><span id="line-350"></span><span>              </span><span id="local-6989586621682987743"><span class="annot"><a href="#local-6989586621682987743"><span class="hs-identifier hs-var hs-var">univ_bndrs</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[TyConBinder] -&gt; [InvisTVBinder]
</span><a href="GHC.Core.TyCon.html#tyConInvisTVBinders"><span class="hs-identifier hs-var">tyConInvisTVBinders</span></a></span><span> </span><span class="annot"><span class="annottext">[TyConBinder]
</span><a href="#local-6989586621682987712"><span class="hs-identifier hs-var">binders</span></a></span><span>
</span><span id="line-351"></span><span>              </span><span id="local-6989586621682987745"><span class="annot"><a href="#local-6989586621682987745"><span class="hs-identifier hs-var hs-var">univ_tvs</span></a></span></span><span>   </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[InvisTVBinder] -&gt; [TyVar]
forall tv argf. [VarBndr tv argf] -&gt; [tv]
</span><a href="GHC.Types.Var.html#binderVars"><span class="hs-identifier hs-var">binderVars</span></a></span><span> </span><span class="annot"><span class="annottext">[InvisTVBinder]
</span><a href="#local-6989586621682987743"><span class="hs-identifier hs-var">univ_bndrs</span></a></span><span>
</span><span id="line-352"></span><span>              </span><span id="local-6989586621682987746"><span class="annot"><a href="#local-6989586621682987746"><span class="hs-identifier hs-var hs-var">bang_opts</span></a></span></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[HsImplBang] -&gt; DataConBangOpts
</span><a href="GHC.Types.Id.Make.html#FixedBangOpts"><span class="hs-identifier hs-var">FixedBangOpts</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(Name -&gt; HsImplBang) -&gt; [Name] -&gt; [HsImplBang]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><span class="hs-identifier hs-var">map</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">HsImplBang -&gt; Name -&gt; HsImplBang
forall a b. a -&gt; b -&gt; a
</span><span class="hs-identifier hs-var">const</span></span><span> </span><span class="annot"><span class="annottext">HsImplBang
</span><a href="GHC.Core.DataCon.html#HsLazy"><span class="hs-identifier hs-var">HsLazy</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[Name]
</span><a href="#local-6989586621682987737"><span class="hs-identifier hs-var">args</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-353"></span><span>
</span><span id="line-354"></span><span>        </span><span class="hs-special">;</span><span> </span><span id="local-6989586621682987750"><span class="annot"><a href="#local-6989586621682987750"><span class="hs-identifier hs-var">rep_nm</span></a></span></span><span>   </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><a href="GHC.Tc.TyCl.Build.html#newTyConRepName"><span class="hs-identifier hs-type">newTyConRepName</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682987720"><span class="hs-identifier hs-type">datacon_name</span></a></span><span>
</span><span id="line-355"></span><span>        </span><span class="hs-special">;</span><span> </span><span id="local-6989586621682987751"><span class="annot"><a href="#local-6989586621682987751"><span class="hs-identifier hs-var">dict_con</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><a href="GHC.Tc.TyCl.Build.html#buildDataCon"><span class="hs-identifier hs-type">buildDataCon</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Utils.Panic.Plain.html#panic"><span class="hs-identifier hs-type">panic</span></a></span><span> </span><span class="annot"><span class="hs-string">&quot;buildClass: FamInstEnvs&quot;</span></span><span class="hs-special">)</span><span>
</span><span id="line-356"></span><span>                                   </span><span class="annot"><a href="#local-6989586621682987746"><span class="hs-identifier hs-type">bang_opts</span></a></span><span>
</span><span id="line-357"></span><span>                                   </span><span class="annot"><a href="#local-6989586621682987720"><span class="hs-identifier hs-type">datacon_name</span></a></span><span>
</span><span id="line-358"></span><span>                                   </span><span class="annot"><span class="hs-identifier hs-type">False</span></span><span>        </span><span class="hs-comment">-- Not declared infix</span><span>
</span><span id="line-359"></span><span>                                   </span><span class="annot"><a href="#local-6989586621682987750"><span class="hs-identifier hs-type">rep_nm</span></a></span><span>
</span><span id="line-360"></span><span>                                   </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">map</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">const</span></span><span> </span><span class="annot"><a href="#local-6989586621682987753"><span class="hs-identifier hs-type">no_bang</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><a href="#local-6989586621682987737"><span class="hs-identifier hs-type">args</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-361"></span><span>                                   </span><span class="hs-special">[</span><span class="hs-comment">{- No fields -}</span><span class="hs-special">]</span><span>
</span><span id="line-362"></span><span>                                   </span><span class="annot"><a href="#local-6989586621682987745"><span class="hs-identifier hs-type">univ_tvs</span></a></span><span>
</span><span id="line-363"></span><span>                                   </span><span class="hs-special">[</span><span class="hs-comment">{- no existentials -}</span><span class="hs-special">]</span><span>
</span><span id="line-364"></span><span>                                   </span><span class="annot"><a href="#local-6989586621682987743"><span class="hs-identifier hs-type">univ_bndrs</span></a></span><span>
</span><span id="line-365"></span><span>                                   </span><span class="hs-special">[</span><span class="hs-comment">{- No GADT equalities -}</span><span class="hs-special">]</span><span>
</span><span id="line-366"></span><span>                                   </span><span class="annot"><a href="#local-6989586621682987715"><span class="hs-identifier hs-type">sc_theta</span></a></span><span>
</span><span id="line-367"></span><span>                                   </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">map</span></span><span> </span><span class="annot"><a href="GHC.Core.Type.html#unrestricted"><span class="hs-identifier hs-type">unrestricted</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682987736"><span class="hs-identifier hs-type">op_tys</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-comment">-- type classes are unrestricted</span><span>
</span><span id="line-368"></span><span>                                   </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Core.Type.html#mkTyConApp"><span class="hs-identifier hs-type">mkTyConApp</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682987741"><span class="hs-identifier hs-type">rec_tycon</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#mkTyVarTys"><span class="hs-identifier hs-type">mkTyVarTys</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682987745"><span class="hs-identifier hs-type">univ_tvs</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-369"></span><span>                                   </span><span class="annot"><a href="#local-6989586621682987741"><span class="hs-identifier hs-type">rec_tycon</span></a></span><span>
</span><span id="line-370"></span><span>                                   </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Core.TyCon.html#mkTyConTagMap"><span class="hs-identifier hs-type">mkTyConTagMap</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682987741"><span class="hs-identifier hs-type">rec_tycon</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-371"></span><span>
</span><span id="line-372"></span><span>        </span><span class="hs-special">;</span><span> </span><span id="local-6989586621682987756"><span class="annot"><a href="#local-6989586621682987756"><span class="hs-identifier hs-var">rhs</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-373"></span><span>                  </span><span class="annot"><span class="annottext">()
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621682987734"><span class="hs-identifier hs-var">use_newtype</span></a></span><span>
</span><span id="line-374"></span><span>                    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Name -&gt; TyCon -&gt; DataCon -&gt; IOEnv (Env m n) AlgTyConRhs
forall m n. Name -&gt; TyCon -&gt; DataCon -&gt; TcRnIf m n AlgTyConRhs
</span><a href="GHC.Tc.TyCl.Build.html#mkNewTyConRhs"><span class="hs-identifier hs-var">mkNewTyConRhs</span></a></span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621682987711"><span class="hs-identifier hs-var">tycon_name</span></a></span><span> </span><span class="annot"><span class="annottext">TyCon
</span><a href="#local-6989586621682987741"><span class="hs-identifier hs-var">rec_tycon</span></a></span><span> </span><span class="annot"><span class="annottext">DataCon
</span><a href="#local-6989586621682987751"><span class="hs-identifier hs-var">dict_con</span></a></span><span>
</span><span id="line-375"></span><span>                    </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Name -&gt; Bool
</span><a href="GHC.Builtin.Types.html#isCTupleTyConName"><span class="hs-identifier hs-var">isCTupleTyConName</span></a></span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621682987711"><span class="hs-identifier hs-var">tycon_name</span></a></span><span>
</span><span id="line-376"></span><span>                    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">AlgTyConRhs -&gt; IOEnv (Env m n) AlgTyConRhs
forall a. a -&gt; IOEnv (Env m n) a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Core.TyCon.html#TupleTyCon"><span class="hs-identifier hs-type">TupleTyCon</span></a></span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">data_con :: DataCon
</span><a href="GHC.Core.TyCon.html#data_con"><span class="hs-identifier hs-var">data_con</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">DataCon
</span><a href="#local-6989586621682987751"><span class="hs-identifier hs-var">dict_con</span></a></span><span>
</span><span id="line-377"></span><span>                                          </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">tup_sort :: TupleSort
</span><a href="GHC.Core.TyCon.html#tup_sort"><span class="hs-identifier hs-var">tup_sort</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">TupleSort
</span><a href="GHC.Types.Basic.html#ConstraintTuple"><span class="hs-identifier hs-var">ConstraintTuple</span></a></span><span> </span><span class="hs-special">}</span><span class="hs-special">)</span><span>
</span><span id="line-378"></span><span>                    </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">otherwise</span></span><span>
</span><span id="line-379"></span><span>                    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">AlgTyConRhs -&gt; IOEnv (Env m n) AlgTyConRhs
forall a. a -&gt; IOEnv (Env m n) a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[DataCon] -&gt; AlgTyConRhs
</span><a href="GHC.Core.TyCon.html#mkDataTyConRhs"><span class="hs-identifier hs-var">mkDataTyConRhs</span></a></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">DataCon
</span><a href="#local-6989586621682987751"><span class="hs-identifier hs-var">dict_con</span></a></span><span class="hs-special">]</span><span class="hs-special">)</span><span>
</span><span id="line-380"></span><span>
</span><span id="line-381"></span><span>        </span><span class="hs-special">;</span><span> </span><span class="hs-keyword">let</span><span> </span><span class="hs-special">{</span><span> </span><span id="local-6989586621682987762"><span class="annot"><a href="#local-6989586621682987762"><span class="hs-identifier hs-var hs-var">tycon</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Name
-&gt; [TyConBinder] -&gt; [Role] -&gt; AlgTyConRhs -&gt; Class -&gt; Name -&gt; TyCon
</span><a href="GHC.Core.TyCon.html#mkClassTyCon"><span class="hs-identifier hs-var">mkClassTyCon</span></a></span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621682987711"><span class="hs-identifier hs-var">tycon_name</span></a></span><span> </span><span class="annot"><span class="annottext">[TyConBinder]
</span><a href="#local-6989586621682987712"><span class="hs-identifier hs-var">binders</span></a></span><span> </span><span class="annot"><span class="annottext">[Role]
</span><a href="#local-6989586621682987713"><span class="hs-identifier hs-var">roles</span></a></span><span>
</span><span id="line-382"></span><span>                                     </span><span class="annot"><span class="annottext">AlgTyConRhs
</span><a href="#local-6989586621682987756"><span class="hs-identifier hs-var">rhs</span></a></span><span> </span><span class="annot"><span class="annottext">Class
</span><a href="#local-6989586621682987719"><span class="hs-identifier hs-var">rec_clas</span></a></span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621682987722"><span class="hs-identifier hs-var">tc_rep_name</span></a></span><span>
</span><span id="line-383"></span><span>                </span><span class="hs-comment">-- A class can be recursive, and in the case of newtypes</span><span>
</span><span id="line-384"></span><span>                </span><span class="hs-comment">-- this matters.  For example</span><span>
</span><span id="line-385"></span><span>                </span><span class="hs-comment">--      class C a where { op :: C b =&gt; a -&gt; b -&gt; Int }</span><span>
</span><span id="line-386"></span><span>                </span><span class="hs-comment">-- Because C has only one operation, it is represented by</span><span>
</span><span id="line-387"></span><span>                </span><span class="hs-comment">-- a newtype, and it should be a *recursive* newtype.</span><span>
</span><span id="line-388"></span><span>                </span><span class="hs-comment">-- [If we don't make it a recursive newtype, we'll expand the</span><span>
</span><span id="line-389"></span><span>                </span><span class="hs-comment">-- newtype like a synonym, but that will lead to an infinite</span><span>
</span><span id="line-390"></span><span>                </span><span class="hs-comment">-- type]</span><span>
</span><span id="line-391"></span><span>
</span><span id="line-392"></span><span>              </span><span class="hs-special">;</span><span> </span><span id="local-6989586621682987763"><span class="annot"><a href="#local-6989586621682987763"><span class="hs-identifier hs-var hs-var">result</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Name
-&gt; [TyVar]
-&gt; [FunDep TyVar]
-&gt; ThetaType
-&gt; [TyVar]
-&gt; [ClassATItem]
-&gt; [ClassOpItem]
-&gt; ClassMinimalDef
-&gt; TyCon
-&gt; Class
</span><a href="GHC.Core.Class.html#mkClass"><span class="hs-identifier hs-var">mkClass</span></a></span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621682987711"><span class="hs-identifier hs-var">tycon_name</span></a></span><span> </span><span class="annot"><span class="annottext">[TyVar]
</span><a href="#local-6989586621682987745"><span class="hs-identifier hs-var">univ_tvs</span></a></span><span> </span><span class="annot"><span class="annottext">[FunDep TyVar]
</span><a href="#local-6989586621682987714"><span class="hs-identifier hs-var">fds</span></a></span><span>
</span><span id="line-393"></span><span>                                 </span><span class="annot"><span class="annottext">ThetaType
</span><a href="#local-6989586621682987715"><span class="hs-identifier hs-var">sc_theta</span></a></span><span> </span><span class="annot"><span class="annottext">[TyVar]
</span><a href="#local-6989586621682987731"><span class="hs-identifier hs-var">sc_sel_ids</span></a></span><span> </span><span class="annot"><span class="annottext">[ClassATItem]
</span><a href="#local-6989586621682987716"><span class="hs-identifier hs-var">at_items</span></a></span><span>
</span><span id="line-394"></span><span>                                 </span><span class="annot"><span class="annottext">[ClassOpItem]
</span><a href="#local-6989586621682987723"><span class="hs-identifier hs-var">op_items</span></a></span><span> </span><span class="annot"><span class="annottext">ClassMinimalDef
</span><a href="#local-6989586621682987718"><span class="hs-identifier hs-var">mindef</span></a></span><span> </span><span class="annot"><span class="annottext">TyCon
</span><a href="#local-6989586621682987762"><span class="hs-identifier hs-var">tycon</span></a></span><span>
</span><span id="line-395"></span><span>              </span><span class="hs-special">}</span><span>
</span><span id="line-396"></span><span>        </span><span class="hs-special">;</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.Monad.html#traceIf"><span class="hs-identifier hs-type">traceIf</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Utils.Outputable.html#text"><span class="hs-identifier hs-type">text</span></a></span><span> </span><span class="annot"><span class="hs-string">&quot;buildClass&quot;</span></span><span> </span><span class="annot"><a href="GHC.Utils.Outputable.html#%3C%2B%3E"><span class="hs-operator hs-type">&lt;+&gt;</span></a></span><span> </span><span class="annot"><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-type">ppr</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682987762"><span class="hs-identifier hs-type">tycon</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-397"></span><span>        </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">return</span></span><span> </span><span class="annot"><a href="#local-6989586621682987763"><span class="hs-identifier hs-type">result</span></a></span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-398"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-399"></span><span>    </span><span id="local-6989586621682987753"><span class="annot"><span class="annottext">no_bang :: HsSrcBang
</span><a href="#local-6989586621682987753"><span class="hs-identifier hs-var hs-var">no_bang</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">SourceText -&gt; SrcUnpackedness -&gt; SrcStrictness -&gt; HsSrcBang
</span><a href="GHC.Core.DataCon.html#mkHsSrcBang"><span class="hs-identifier hs-var">mkHsSrcBang</span></a></span><span> </span><span class="annot"><span class="annottext">SourceText
</span><a href="GHC.Types.SourceText.html#NoSourceText"><span class="hs-identifier hs-var">NoSourceText</span></a></span><span> </span><span class="annot"><span class="annottext">SrcUnpackedness
</span><a href="Language.Haskell.Syntax.Basic.html#NoSrcUnpack"><span class="hs-identifier hs-var">NoSrcUnpack</span></a></span><span> </span><span class="annot"><span class="annottext">SrcStrictness
</span><a href="Language.Haskell.Syntax.Basic.html#NoSrcStrict"><span class="hs-identifier hs-var">NoSrcStrict</span></a></span><span>
</span><span id="line-400"></span><span>
</span><span id="line-401"></span><span>    </span><span id="local-6989586621682987383"><span id="local-6989586621682987384"><span class="annot"><a href="#local-6989586621682987725"><span class="hs-identifier hs-type">mk_op_item</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Core.Class.html#Class"><span class="hs-identifier hs-type">Class</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.TyCl.Build.html#TcMethInfo"><span class="hs-identifier hs-type">TcMethInfo</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#TcRnIf"><span class="hs-identifier hs-type">TcRnIf</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682987383"><span class="hs-identifier hs-type">n</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682987384"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="annot"><a href="GHC.Core.Class.html#ClassOpItem"><span class="hs-identifier hs-type">ClassOpItem</span></a></span></span></span><span>
</span><span id="line-402"></span><span>    </span><span id="local-6989586621682987725"><span class="annot"><span class="annottext">mk_op_item :: forall n m. Class -&gt; KnotTied MethInfo -&gt; TcRnIf n m ClassOpItem
</span><a href="#local-6989586621682987725"><span class="hs-identifier hs-var hs-var">mk_op_item</span></a></span></span><span> </span><span id="local-6989586621682987771"><span class="annot"><span class="annottext">Class
</span><a href="#local-6989586621682987771"><span class="hs-identifier hs-var">rec_clas</span></a></span></span><span> </span><span class="hs-special">(</span><span id="local-6989586621682987772"><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621682987772"><span class="hs-identifier hs-var">op_name</span></a></span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Type
</span><span class="hs-identifier">_</span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682987773"><span class="annot"><span class="annottext">Maybe (DefMethSpec (SrcSpan, Type))
</span><a href="#local-6989586621682987773"><span class="hs-identifier hs-var">dm_spec</span></a></span></span><span class="hs-special">)</span><span>
</span><span id="line-403"></span><span>      </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span id="local-6989586621682987774"><span class="annot"><a href="#local-6989586621682987774"><span class="hs-identifier hs-var">dm_info</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Name
-&gt; Maybe (DefMethSpec (SrcSpan, Type))
-&gt; TcRnIf n m (Maybe (Name, DefMethSpec Type))
forall n m.
Name
-&gt; Maybe (DefMethSpec (SrcSpan, Type))
-&gt; TcRnIf n m (Maybe (Name, DefMethSpec Type))
</span><a href="#local-6989586621682987775"><span class="hs-identifier hs-var">mk_dm_info</span></a></span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621682987772"><span class="hs-identifier hs-var">op_name</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe (DefMethSpec (SrcSpan, Type))
</span><a href="#local-6989586621682987773"><span class="hs-identifier hs-var">dm_spec</span></a></span><span>
</span><span id="line-404"></span><span>           </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">return</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Types.Id.Make.html#mkDictSelId"><span class="hs-identifier hs-type">mkDictSelId</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682987772"><span class="hs-identifier hs-type">op_name</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682987771"><span class="hs-identifier hs-type">rec_clas</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="#local-6989586621682987774"><span class="hs-identifier hs-type">dm_info</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-405"></span><span>
</span><span id="line-406"></span><span>    </span><span id="local-6989586621682987404"><span id="local-6989586621682987405"><span class="annot"><a href="#local-6989586621682987775"><span class="hs-identifier hs-type">mk_dm_info</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Types.Name.html#Name"><span class="hs-identifier hs-type">Name</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Maybe</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Types.Basic.html#DefMethSpec"><span class="hs-identifier hs-type">DefMethSpec</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Types.SrcLoc.html#SrcSpan"><span class="hs-identifier hs-type">SrcSpan</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#Type"><span class="hs-identifier hs-type">Type</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-407"></span><span>               </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#TcRnIf"><span class="hs-identifier hs-type">TcRnIf</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682987404"><span class="hs-identifier hs-type">n</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682987405"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Maybe</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Types.Name.html#Name"><span class="hs-identifier hs-type">Name</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Types.Basic.html#DefMethSpec"><span class="hs-identifier hs-type">DefMethSpec</span></a></span><span> </span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#Type"><span class="hs-identifier hs-type">Type</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span></span></span><span>
</span><span id="line-408"></span><span>    </span><span id="local-6989586621682987775"><span class="annot"><span class="annottext">mk_dm_info :: forall n m.
Name
-&gt; Maybe (DefMethSpec (SrcSpan, Type))
-&gt; TcRnIf n m (Maybe (Name, DefMethSpec Type))
</span><a href="#local-6989586621682987775"><span class="hs-identifier hs-var hs-var">mk_dm_info</span></a></span></span><span> </span><span class="annot"><span class="annottext">Name
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">Maybe (DefMethSpec (SrcSpan, Type))
</span><span class="hs-identifier hs-var">Nothing</span></span><span>
</span><span id="line-409"></span><span>      </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Maybe (Name, DefMethSpec Type)
-&gt; IOEnv (Env n m) (Maybe (Name, DefMethSpec Type))
forall a. a -&gt; IOEnv (Env n m) a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="annot"><span class="annottext">Maybe (Name, DefMethSpec Type)
forall a. Maybe a
</span><span class="hs-identifier hs-var">Nothing</span></span><span>
</span><span id="line-410"></span><span>    </span><span class="annot"><a href="#local-6989586621682987775"><span class="hs-identifier hs-var">mk_dm_info</span></a></span><span> </span><span id="local-6989586621682987781"><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621682987781"><span class="hs-identifier hs-var">op_name</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span class="annot"><span class="annottext">DefMethSpec (SrcSpan, Type)
</span><a href="GHC.Types.Basic.html#VanillaDM"><span class="hs-identifier hs-var">VanillaDM</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-411"></span><span>      </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span id="local-6989586621682987783"><span class="annot"><a href="#local-6989586621682987783"><span class="hs-identifier hs-var">dm_name</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Name -&gt; (OccName -&gt; OccName) -&gt; TcRnIf n m Name
forall m n. Name -&gt; (OccName -&gt; OccName) -&gt; TcRnIf m n Name
</span><a href="GHC.Tc.TyCl.Build.html#newImplicitBinder"><span class="hs-identifier hs-var">newImplicitBinder</span></a></span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621682987781"><span class="hs-identifier hs-var">op_name</span></a></span><span> </span><span class="annot"><span class="annottext">OccName -&gt; OccName
</span><a href="GHC.Types.Name.Occurrence.html#mkDefaultMethodOcc"><span class="hs-identifier hs-var">mkDefaultMethodOcc</span></a></span><span>
</span><span id="line-412"></span><span>           </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">return</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621682987783"><span class="hs-identifier hs-type">dm_name</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Types.Basic.html#VanillaDM"><span class="hs-identifier hs-type">VanillaDM</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-413"></span><span>    </span><span class="annot"><a href="#local-6989586621682987775"><span class="hs-identifier hs-var">mk_dm_info</span></a></span><span> </span><span id="local-6989586621682987785"><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621682987785"><span class="hs-identifier hs-var">op_name</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Types.Basic.html#GenericDM"><span class="hs-identifier hs-type">GenericDM</span></a></span><span> </span><span class="hs-special">(</span><span id="local-6989586621682987787"><span class="annot"><span class="annottext">SrcSpan
</span><a href="#local-6989586621682987787"><span class="hs-identifier hs-var">loc</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682987788"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682987788"><span class="hs-identifier hs-var">dm_ty</span></a></span></span><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-414"></span><span>      </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span id="local-6989586621682987789"><span class="annot"><a href="#local-6989586621682987789"><span class="hs-identifier hs-var">dm_name</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Name -&gt; (OccName -&gt; OccName) -&gt; SrcSpan -&gt; TcRnIf n m Name
forall m n.
Name -&gt; (OccName -&gt; OccName) -&gt; SrcSpan -&gt; TcRnIf m n Name
</span><a href="GHC.Tc.TyCl.Build.html#newImplicitBinderLoc"><span class="hs-identifier hs-var">newImplicitBinderLoc</span></a></span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621682987785"><span class="hs-identifier hs-var">op_name</span></a></span><span> </span><span class="annot"><span class="annottext">OccName -&gt; OccName
</span><a href="GHC.Types.Name.Occurrence.html#mkDefaultMethodOcc"><span class="hs-identifier hs-var">mkDefaultMethodOcc</span></a></span><span> </span><span class="annot"><span class="annottext">SrcSpan
</span><a href="#local-6989586621682987787"><span class="hs-identifier hs-var">loc</span></a></span><span>
</span><span id="line-415"></span><span>           </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">return</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621682987789"><span class="hs-identifier hs-type">dm_name</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Types.Basic.html#GenericDM"><span class="hs-identifier hs-type">GenericDM</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682987788"><span class="hs-identifier hs-type">dm_ty</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-416"></span><span>
</span><span id="line-417"></span><span class="hs-comment">{-
Note [Class newtypes and equality predicates]
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
Consider
        class (a ~ F b) =&gt; C a b where
          op :: a -&gt; b

We cannot represent this by a newtype, even though it's not
existential, because there are two value fields (the equality
predicate and op. See #2238

Moreover,
          class (a ~ F b) =&gt; C a b where {}
Here we can't use a newtype either, even though there is only
one field, because equality predicates are unboxed, and classes
are boxed.
-}</span><span>
</span><span id="line-434"></span><span>
</span><span id="line-435"></span><span id="local-6989586621682987307"><span id="local-6989586621682987308"><span class="annot"><a href="GHC.Tc.TyCl.Build.html#newImplicitBinder"><span class="hs-identifier hs-type">newImplicitBinder</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Types.Name.html#Name"><span class="hs-identifier hs-type">Name</span></a></span><span>                       </span><span class="hs-comment">-- Base name</span><span>
</span><span id="line-436"></span><span>                  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Types.Name.Occurrence.html#OccName"><span class="hs-identifier hs-type">OccName</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Types.Name.Occurrence.html#OccName"><span class="hs-identifier hs-type">OccName</span></a></span><span class="hs-special">)</span><span>       </span><span class="hs-comment">-- Occurrence name modifier</span><span>
</span><span id="line-437"></span><span>                  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#TcRnIf"><span class="hs-identifier hs-type">TcRnIf</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682987307"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682987308"><span class="hs-identifier hs-type">n</span></a></span><span> </span><span class="annot"><a href="GHC.Types.Name.html#Name"><span class="hs-identifier hs-type">Name</span></a></span></span></span><span>            </span><span class="hs-comment">-- Implicit name</span><span>
</span><span id="line-438"></span><span class="hs-comment">-- Called in GHC.Tc.TyCl.Build to allocate the implicit binders of type/class decls</span><span>
</span><span id="line-439"></span><span class="hs-comment">-- For source type/class decls, this is the first occurrence</span><span>
</span><span id="line-440"></span><span class="hs-comment">-- For iface ones, GHC.Iface.Load has already allocated a suitable name in the cache</span><span>
</span><span id="line-441"></span><span id="newImplicitBinder"><span class="annot"><span class="annottext">newImplicitBinder :: forall m n. Name -&gt; (OccName -&gt; OccName) -&gt; TcRnIf m n Name
</span><a href="GHC.Tc.TyCl.Build.html#newImplicitBinder"><span class="hs-identifier hs-var hs-var">newImplicitBinder</span></a></span></span><span> </span><span id="local-6989586621682987791"><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621682987791"><span class="hs-identifier hs-var">base_name</span></a></span></span><span> </span><span id="local-6989586621682987792"><span class="annot"><span class="annottext">OccName -&gt; OccName
</span><a href="#local-6989586621682987792"><span class="hs-identifier hs-var">mk_sys_occ</span></a></span></span><span>
</span><span id="line-442"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Name -&gt; (OccName -&gt; OccName) -&gt; SrcSpan -&gt; TcRnIf m n Name
forall m n.
Name -&gt; (OccName -&gt; OccName) -&gt; SrcSpan -&gt; TcRnIf m n Name
</span><a href="GHC.Tc.TyCl.Build.html#newImplicitBinderLoc"><span class="hs-identifier hs-var">newImplicitBinderLoc</span></a></span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621682987791"><span class="hs-identifier hs-var">base_name</span></a></span><span> </span><span class="annot"><span class="annottext">OccName -&gt; OccName
</span><a href="#local-6989586621682987792"><span class="hs-identifier hs-var">mk_sys_occ</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Name -&gt; SrcSpan
</span><a href="GHC.Types.Name.html#nameSrcSpan"><span class="hs-identifier hs-var">nameSrcSpan</span></a></span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621682987791"><span class="hs-identifier hs-var">base_name</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-443"></span><span>
</span><span id="line-444"></span><span id="local-6989586621682987409"><span id="local-6989586621682987410"><span class="annot"><a href="GHC.Tc.TyCl.Build.html#newImplicitBinderLoc"><span class="hs-identifier hs-type">newImplicitBinderLoc</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Types.Name.html#Name"><span class="hs-identifier hs-type">Name</span></a></span><span>                       </span><span class="hs-comment">-- Base name</span><span>
</span><span id="line-445"></span><span>                     </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Types.Name.Occurrence.html#OccName"><span class="hs-identifier hs-type">OccName</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Types.Name.Occurrence.html#OccName"><span class="hs-identifier hs-type">OccName</span></a></span><span class="hs-special">)</span><span>       </span><span class="hs-comment">-- Occurrence name modifier</span><span>
</span><span id="line-446"></span><span>                     </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Types.SrcLoc.html#SrcSpan"><span class="hs-identifier hs-type">SrcSpan</span></a></span><span>
</span><span id="line-447"></span><span>                     </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#TcRnIf"><span class="hs-identifier hs-type">TcRnIf</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682987409"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682987410"><span class="hs-identifier hs-type">n</span></a></span><span> </span><span class="annot"><a href="GHC.Types.Name.html#Name"><span class="hs-identifier hs-type">Name</span></a></span></span></span><span>            </span><span class="hs-comment">-- Implicit name</span><span>
</span><span id="line-448"></span><span class="hs-comment">-- Just the same, but lets you specify the SrcSpan</span><span>
</span><span id="line-449"></span><span id="newImplicitBinderLoc"><span class="annot"><span class="annottext">newImplicitBinderLoc :: forall m n.
Name -&gt; (OccName -&gt; OccName) -&gt; SrcSpan -&gt; TcRnIf m n Name
</span><a href="GHC.Tc.TyCl.Build.html#newImplicitBinderLoc"><span class="hs-identifier hs-var hs-var">newImplicitBinderLoc</span></a></span></span><span> </span><span id="local-6989586621682987796"><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621682987796"><span class="hs-identifier hs-var">base_name</span></a></span></span><span> </span><span id="local-6989586621682987797"><span class="annot"><span class="annottext">OccName -&gt; OccName
</span><a href="#local-6989586621682987797"><span class="hs-identifier hs-var">mk_sys_occ</span></a></span></span><span> </span><span id="local-6989586621682987798"><span class="annot"><span class="annottext">SrcSpan
</span><a href="#local-6989586621682987798"><span class="hs-identifier hs-var">loc</span></a></span></span><span>
</span><span id="line-450"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span id="local-6989586621682987799"><span class="annot"><span class="annottext">Module
</span><a href="#local-6989586621682987799"><span class="hs-identifier hs-var">mod</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Name -&gt; Maybe Module
</span><a href="GHC.Types.Name.html#nameModule_maybe"><span class="hs-identifier hs-var">nameModule_maybe</span></a></span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621682987796"><span class="hs-identifier hs-var">base_name</span></a></span><span>
</span><span id="line-451"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Module -&gt; OccName -&gt; SrcSpan -&gt; TcRnIf m n Name
forall a b. Module -&gt; OccName -&gt; SrcSpan -&gt; TcRnIf a b Name
</span><a href="GHC.Iface.Env.html#newGlobalBinder"><span class="hs-identifier hs-var">newGlobalBinder</span></a></span><span> </span><span class="annot"><span class="annottext">Module
</span><a href="#local-6989586621682987799"><span class="hs-identifier hs-var">mod</span></a></span><span> </span><span class="annot"><span class="annottext">OccName
</span><a href="#local-6989586621682987802"><span class="hs-identifier hs-var">occ</span></a></span><span> </span><span class="annot"><span class="annottext">SrcSpan
</span><a href="#local-6989586621682987798"><span class="hs-identifier hs-var">loc</span></a></span><span>
</span><span id="line-452"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">otherwise</span></span><span>           </span><span class="hs-comment">-- When typechecking a [d| decl bracket |],</span><span>
</span><span id="line-453"></span><span>                        </span><span class="hs-comment">-- TH generates types, classes etc with Internal names,</span><span>
</span><span id="line-454"></span><span>                        </span><span class="hs-comment">-- so we follow suit for the implicit binders</span><span>
</span><span id="line-455"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>  </span><span class="hs-special">{</span><span> </span><span id="local-6989586621682987803"><span class="annot"><a href="#local-6989586621682987803"><span class="hs-identifier hs-var">uniq</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">TcRnIf m n Unique
forall gbl lcl. TcRnIf gbl lcl Unique
</span><a href="GHC.Tc.Utils.Monad.html#newUnique"><span class="hs-identifier hs-var">newUnique</span></a></span><span>
</span><span id="line-456"></span><span>        </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">return</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Types.Name.html#mkInternalName"><span class="hs-identifier hs-type">mkInternalName</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682987803"><span class="hs-identifier hs-type">uniq</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682987802"><span class="hs-identifier hs-type">occ</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682987798"><span class="hs-identifier hs-type">loc</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-457"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-458"></span><span>    </span><span id="local-6989586621682987802"><span class="annot"><span class="annottext">occ :: OccName
</span><a href="#local-6989586621682987802"><span class="hs-identifier hs-var hs-var">occ</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">OccName -&gt; OccName
</span><a href="#local-6989586621682987797"><span class="hs-identifier hs-var">mk_sys_occ</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Name -&gt; OccName
</span><a href="GHC.Types.Name.html#nameOccName"><span class="hs-identifier hs-var">nameOccName</span></a></span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621682987796"><span class="hs-identifier hs-var">base_name</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-459"></span><span>
</span><span id="line-460"></span><span class="annot"><span class="hs-comment">-- | Make the 'TyConRepName' for this 'TyCon'</span></span><span>
</span><span id="line-461"></span><span id="local-6989586621682987376"><span id="local-6989586621682987377"><span class="annot"><a href="GHC.Tc.TyCl.Build.html#newTyConRepName"><span class="hs-identifier hs-type">newTyConRepName</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Types.Name.html#Name"><span class="hs-identifier hs-type">Name</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#TcRnIf"><span class="hs-identifier hs-type">TcRnIf</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682987376"><span class="hs-identifier hs-type">gbl</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682987377"><span class="hs-identifier hs-type">lcl</span></a></span><span> </span><span class="annot"><a href="GHC.Core.TyCon.html#TyConRepName"><span class="hs-identifier hs-type">TyConRepName</span></a></span></span></span><span>
</span><span id="line-462"></span><span id="newTyConRepName"><span class="annot"><span class="annottext">newTyConRepName :: forall gbl lcl. Name -&gt; TcRnIf gbl lcl Name
</span><a href="GHC.Tc.TyCl.Build.html#newTyConRepName"><span class="hs-identifier hs-var hs-var">newTyConRepName</span></a></span></span><span> </span><span id="local-6989586621682987807"><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621682987807"><span class="hs-identifier hs-var">tc_name</span></a></span></span><span>
</span><span id="line-463"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span id="local-6989586621682987808"><span class="annot"><span class="annottext">Module
</span><a href="#local-6989586621682987808"><span class="hs-identifier hs-var">mod</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Name -&gt; Maybe Module
</span><a href="GHC.Types.Name.html#nameModule_maybe"><span class="hs-identifier hs-var">nameModule_maybe</span></a></span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621682987807"><span class="hs-identifier hs-var">tc_name</span></a></span><span>
</span><span id="line-464"></span><span>  </span><span class="hs-special">,</span><span> </span><span class="hs-special">(</span><span id="local-6989586621682987809"><span class="annot"><span class="annottext">Module
</span><a href="#local-6989586621682987809"><span class="hs-identifier hs-var">mod</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682987810"><span class="annot"><span class="annottext">OccName
</span><a href="#local-6989586621682987810"><span class="hs-identifier hs-var">occ</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Module -&gt; OccName -&gt; (Module, OccName)
</span><a href="GHC.Core.TyCon.html#tyConRepModOcc"><span class="hs-identifier hs-var">tyConRepModOcc</span></a></span><span> </span><span class="annot"><span class="annottext">Module
</span><a href="#local-6989586621682987808"><span class="hs-identifier hs-var">mod</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Name -&gt; OccName
</span><a href="GHC.Types.Name.html#nameOccName"><span class="hs-identifier hs-var">nameOccName</span></a></span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621682987807"><span class="hs-identifier hs-var">tc_name</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-465"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Module -&gt; OccName -&gt; SrcSpan -&gt; TcRnIf gbl lcl Name
forall a b. Module -&gt; OccName -&gt; SrcSpan -&gt; TcRnIf a b Name
</span><a href="GHC.Iface.Env.html#newGlobalBinder"><span class="hs-identifier hs-var">newGlobalBinder</span></a></span><span> </span><span class="annot"><span class="annottext">Module
</span><a href="#local-6989586621682987809"><span class="hs-identifier hs-var">mod</span></a></span><span> </span><span class="annot"><span class="annottext">OccName
</span><a href="#local-6989586621682987810"><span class="hs-identifier hs-var">occ</span></a></span><span> </span><span class="annot"><span class="annottext">SrcSpan
</span><a href="GHC.Types.SrcLoc.html#noSrcSpan"><span class="hs-identifier hs-var">noSrcSpan</span></a></span><span>
</span><span id="line-466"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">otherwise</span></span><span>
</span><span id="line-467"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Name -&gt; (OccName -&gt; OccName) -&gt; TcRnIf gbl lcl Name
forall m n. Name -&gt; (OccName -&gt; OccName) -&gt; TcRnIf m n Name
</span><a href="GHC.Tc.TyCl.Build.html#newImplicitBinder"><span class="hs-identifier hs-var">newImplicitBinder</span></a></span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621682987807"><span class="hs-identifier hs-var">tc_name</span></a></span><span> </span><span class="annot"><span class="annottext">OccName -&gt; OccName
</span><a href="GHC.Types.Name.Occurrence.html#mkTyConRepOcc"><span class="hs-identifier hs-var">mkTyConRepOcc</span></a></span><span>
</span><span id="line-468"></span></pre></body></html>