<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><link rel="stylesheet" type="text/css" href="style.css" /><script type="text/javascript" src="highlight.js"></script></head><body><pre><span class="hs-pragma">{-# LANGUAGE CPP #-}</span><span>
</span><span id="line-2"></span><span class="hs-pragma">{-# LANGUAGE LambdaCase #-}</span><span>
</span><span id="line-3"></span><span class="hs-pragma">{-# LANGUAGE NondecreasingIndentation #-}</span><span>
</span><span id="line-4"></span><span class="hs-pragma">{-# LANGUAGE TypeFamilies #-}</span><span>
</span><span id="line-5"></span><span class="hs-pragma">{-# LANGUAGE MultiWayIf #-}</span><span>
</span><span id="line-6"></span><span>
</span><span id="line-7"></span><span class="hs-pragma">{-# OPTIONS_GHC -Wno-incomplete-record-updates #-}</span><span>
</span><span id="line-8"></span><span>
</span><span id="line-9"></span><span class="hs-comment">{-
(c) The University of Glasgow 2006
(c) The GRASP/AQUA Project, Glasgow University, 1992-1998

-}</span><span>
</span><span id="line-14"></span><span>
</span><span id="line-15"></span><span class="hs-comment">-- | Typechecking a whole module</span><span>
</span><span id="line-16"></span><span class="hs-comment">--</span><span>
</span><span id="line-17"></span><span class="hs-comment">-- https://gitlab.haskell.org/ghc/ghc/wikis/commentary/compiler/type-checker</span><span>
</span><span id="line-18"></span><span class="hs-keyword">module</span><span> </span><span class="annot"><a href="GHC.Tc.Module.html"><span class="hs-identifier">GHC.Tc.Module</span></a></span><span> </span><span class="hs-special">(</span><span>
</span><span id="line-19"></span><span>        </span><span class="annot"><a href="GHC.Tc.Module.html#tcRnStmt"><span class="hs-identifier">tcRnStmt</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Tc.Module.html#tcRnExpr"><span class="hs-identifier">tcRnExpr</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Tc.Module.html#TcRnExprMode"><span class="hs-identifier">TcRnExprMode</span></a></span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Tc.Module.html#tcRnType"><span class="hs-identifier">tcRnType</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-20"></span><span>        </span><span class="annot"><a href="GHC.Tc.Module.html#tcRnImportDecls"><span class="hs-identifier">tcRnImportDecls</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-21"></span><span>        </span><span class="annot"><a href="GHC.Tc.Module.html#tcRnLookupRdrName"><span class="hs-identifier">tcRnLookupRdrName</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-22"></span><span>        </span><span class="annot"><a href="GHC.Tc.Module.html#getModuleInterface"><span class="hs-identifier">getModuleInterface</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-23"></span><span>        </span><span class="annot"><a href="GHC.Tc.Module.html#tcRnDeclsi"><span class="hs-identifier">tcRnDeclsi</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-24"></span><span>        </span><span class="annot"><a href="GHC.Tc.Module.html#isGHCiMonad"><span class="hs-identifier">isGHCiMonad</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-25"></span><span>        </span><span class="annot"><a href="GHC.Tc.Module.html#runTcInteractive"><span class="hs-identifier">runTcInteractive</span></a></span><span class="hs-special">,</span><span>    </span><span class="hs-comment">-- Used by GHC API clients (#8878)</span><span>
</span><span id="line-26"></span><span>        </span><span class="annot"><a href="GHC.Tc.Module.html#withTcPlugins"><span class="hs-identifier">withTcPlugins</span></a></span><span class="hs-special">,</span><span>       </span><span class="hs-comment">-- Used by GHC API clients (#20499)</span><span>
</span><span id="line-27"></span><span>        </span><span class="annot"><a href="GHC.Tc.Module.html#withHoleFitPlugins"><span class="hs-identifier">withHoleFitPlugins</span></a></span><span class="hs-special">,</span><span>  </span><span class="hs-comment">-- Used by GHC API clients (#20499)</span><span>
</span><span id="line-28"></span><span>        </span><span class="annot"><a href="GHC.Tc.Module.html#tcRnLookupName"><span class="hs-identifier">tcRnLookupName</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-29"></span><span>        </span><span class="annot"><a href="GHC.Tc.Module.html#tcRnGetInfo"><span class="hs-identifier">tcRnGetInfo</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-30"></span><span>        </span><span class="annot"><a href="GHC.Tc.Module.html#tcRnModule"><span class="hs-identifier">tcRnModule</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Tc.Module.html#tcRnModuleTcRnM"><span class="hs-identifier">tcRnModuleTcRnM</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-31"></span><span>        </span><span class="annot"><a href="GHC.Tc.Module.html#tcTopSrcDecls"><span class="hs-identifier">tcTopSrcDecls</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-32"></span><span>        </span><span class="annot"><a href="GHC.Tc.Module.html#rnTopSrcDecls"><span class="hs-identifier">rnTopSrcDecls</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-33"></span><span>        </span><span class="annot"><a href="GHC.Tc.Module.html#checkBootDecl"><span class="hs-identifier">checkBootDecl</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Tc.Module.html#checkHiBootIface%27"><span class="hs-identifier">checkHiBootIface'</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-34"></span><span>        </span><span class="annot"><a href="GHC.Tc.Utils.Backpack.html#findExtraSigImports"><span class="hs-identifier">findExtraSigImports</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-35"></span><span>        </span><span class="annot"><a href="GHC.Tc.Utils.Backpack.html#implicitRequirements"><span class="hs-identifier">implicitRequirements</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-36"></span><span>        </span><span class="annot"><a href="GHC.Tc.Utils.Backpack.html#checkUnit"><span class="hs-identifier">checkUnit</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-37"></span><span>        </span><span class="annot"><a href="GHC.Tc.Utils.Backpack.html#mergeSignatures"><span class="hs-identifier">mergeSignatures</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-38"></span><span>        </span><span class="annot"><a href="GHC.Tc.Utils.Backpack.html#tcRnMergeSignatures"><span class="hs-identifier">tcRnMergeSignatures</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-39"></span><span>        </span><span class="annot"><a href="GHC.Tc.Utils.Backpack.html#instantiateSignature"><span class="hs-identifier">instantiateSignature</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-40"></span><span>        </span><span class="annot"><a href="GHC.Tc.Utils.Backpack.html#tcRnInstantiateSignature"><span class="hs-identifier">tcRnInstantiateSignature</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-41"></span><span>        </span><span class="annot"><a href="GHC.Tc.Module.html#loadUnqualIfaces"><span class="hs-identifier">loadUnqualIfaces</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-42"></span><span>        </span><span class="hs-comment">-- More private...</span><span>
</span><span id="line-43"></span><span>        </span><span class="annot"><a href="GHC.Tc.Module.html#checkBootDeclM"><span class="hs-identifier">checkBootDeclM</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-44"></span><span>        </span><span class="annot"><a href="GHC.Tc.Module.html#getRenamedStuff"><span class="hs-identifier">getRenamedStuff</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Tc.Module.html#RenamedStuff"><span class="hs-identifier">RenamedStuff</span></a></span><span>
</span><span id="line-45"></span><span>    </span><span class="hs-special">)</span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-46"></span><span>
</span><span id="line-47"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Prelude.html"><span class="hs-identifier">GHC.Prelude</span></a></span><span>
</span><span id="line-48"></span><span>
</span><span id="line-49"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Driver.Env.html"><span class="hs-identifier">GHC.Driver.Env</span></a></span><span>
</span><span id="line-50"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Driver.Plugins.html"><span class="hs-identifier">GHC.Driver.Plugins</span></a></span><span>
</span><span id="line-51"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Driver.DynFlags.html"><span class="hs-identifier">GHC.Driver.DynFlags</span></a></span><span>
</span><span id="line-52"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Driver.Config.Diagnostic.html"><span class="hs-identifier">GHC.Driver.Config.Diagnostic</span></a></span><span>
</span><span id="line-53"></span><span>
</span><span id="line-54"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Tc.Errors.Hole.Plugin.html"><span class="hs-identifier">GHC.Tc.Errors.Hole.Plugin</span></a></span><span> </span><span class="hs-special">(</span><span> </span><span class="annot"><a href="GHC.Tc.Errors.Hole.Plugin.html#HoleFitPluginR"><span class="hs-identifier">HoleFitPluginR</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span> </span><span class="hs-special">)</span><span>
</span><span id="line-55"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Tc.Errors.Types.html"><span class="hs-identifier">GHC.Tc.Errors.Types</span></a></span><span>
</span><span id="line-56"></span><span class="hs-keyword">import</span><span> </span><span class="hs-pragma">{-# SOURCE</span><span> </span><span class="hs-pragma">#-}</span><span> </span><span class="annot"><a href="GHC.Tc.Gen.Splice.html"><span class="hs-identifier">GHC.Tc.Gen.Splice</span></a></span><span> </span><span class="hs-special">(</span><span> </span><span class="annot"><a href="GHC.Tc.Gen.Splice.html#finishTH"><span class="hs-identifier">finishTH</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Tc.Gen.Splice.html#runRemoteModFinalizers"><span class="hs-identifier">runRemoteModFinalizers</span></a></span><span> </span><span class="hs-special">)</span><span>
</span><span id="line-57"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Tc.Gen.HsType.html"><span class="hs-identifier">GHC.Tc.Gen.HsType</span></a></span><span>
</span><span id="line-58"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Tc.Validity.html"><span class="hs-identifier">GHC.Tc.Validity</span></a></span><span class="hs-special">(</span><span> </span><span class="annot"><a href="GHC.Tc.Validity.html#checkValidType"><span class="hs-identifier">checkValidType</span></a></span><span> </span><span class="hs-special">)</span><span>
</span><span id="line-59"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Tc.Gen.Match.html"><span class="hs-identifier">GHC.Tc.Gen.Match</span></a></span><span>
</span><span id="line-60"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.Unify.html"><span class="hs-identifier">GHC.Tc.Utils.Unify</span></a></span><span class="hs-special">(</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.Unify.html#checkConstraints"><span class="hs-identifier">checkConstraints</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.Unify.html#tcSubTypeSigma"><span class="hs-identifier">tcSubTypeSigma</span></a></span><span> </span><span class="hs-special">)</span><span>
</span><span id="line-61"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Tc.Zonk.Type.html"><span class="hs-identifier">GHC.Tc.Zonk.Type</span></a></span><span>
</span><span id="line-62"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Tc.Gen.Expr.html"><span class="hs-identifier">GHC.Tc.Gen.Expr</span></a></span><span>
</span><span id="line-63"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Tc.Gen.App.html"><span class="hs-identifier">GHC.Tc.Gen.App</span></a></span><span class="hs-special">(</span><span> </span><span class="annot"><a href="GHC.Tc.Gen.App.html#tcInferSigma"><span class="hs-identifier">tcInferSigma</span></a></span><span> </span><span class="hs-special">)</span><span>
</span><span id="line-64"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.Monad.html"><span class="hs-identifier">GHC.Tc.Utils.Monad</span></a></span><span>
</span><span id="line-65"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Tc.Gen.Export.html"><span class="hs-identifier">GHC.Tc.Gen.Export</span></a></span><span>
</span><span id="line-66"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Tc.Types.Evidence.html"><span class="hs-identifier">GHC.Tc.Types.Evidence</span></a></span><span>
</span><span id="line-67"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Tc.Types.Constraint.html"><span class="hs-identifier">GHC.Tc.Types.Constraint</span></a></span><span>
</span><span id="line-68"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Tc.Types.Origin.html"><span class="hs-identifier">GHC.Tc.Types.Origin</span></a></span><span>
</span><span id="line-69"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Tc.Instance.Family.html"><span class="hs-identifier">GHC.Tc.Instance.Family</span></a></span><span>
</span><span id="line-70"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Tc.Gen.Annotation.html"><span class="hs-identifier">GHC.Tc.Gen.Annotation</span></a></span><span>
</span><span id="line-71"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Tc.Gen.Bind.html"><span class="hs-identifier">GHC.Tc.Gen.Bind</span></a></span><span>
</span><span id="line-72"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Tc.Gen.Default.html"><span class="hs-identifier">GHC.Tc.Gen.Default</span></a></span><span>
</span><span id="line-73"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.Env.html"><span class="hs-identifier">GHC.Tc.Utils.Env</span></a></span><span>
</span><span id="line-74"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Tc.Gen.Rule.html"><span class="hs-identifier">GHC.Tc.Gen.Rule</span></a></span><span>
</span><span id="line-75"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Tc.Gen.Foreign.html"><span class="hs-identifier">GHC.Tc.Gen.Foreign</span></a></span><span>
</span><span id="line-76"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Tc.TyCl.Instance.html"><span class="hs-identifier">GHC.Tc.TyCl.Instance</span></a></span><span>
</span><span id="line-77"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.TcMType.html"><span class="hs-identifier">GHC.Tc.Utils.TcMType</span></a></span><span>
</span><span id="line-78"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.TcType.html"><span class="hs-identifier">GHC.Tc.Utils.TcType</span></a></span><span>
</span><span id="line-79"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Tc.Solver.html"><span class="hs-identifier">GHC.Tc.Solver</span></a></span><span>
</span><span id="line-80"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Tc.TyCl.html"><span class="hs-identifier">GHC.Tc.TyCl</span></a></span><span>
</span><span id="line-81"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Tc.Instance.Typeable.html"><span class="hs-identifier">GHC.Tc.Instance.Typeable</span></a></span><span> </span><span class="hs-special">(</span><span> </span><span class="annot"><a href="GHC.Tc.Instance.Typeable.html#mkTypeableBinds"><span class="hs-identifier">mkTypeableBinds</span></a></span><span> </span><span class="hs-special">)</span><span>
</span><span id="line-82"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.Backpack.html"><span class="hs-identifier">GHC.Tc.Utils.Backpack</span></a></span><span>
</span><span id="line-83"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Tc.Zonk.TcType.html"><span class="hs-identifier">GHC.Tc.Zonk.TcType</span></a></span><span>
</span><span id="line-84"></span><span>
</span><span id="line-85"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Rename.Bind.html"><span class="hs-identifier">GHC.Rename.Bind</span></a></span><span> </span><span class="hs-special">(</span><span> </span><span class="annot"><a href="GHC.Rename.Bind.html#rejectBootDecls"><span class="hs-identifier">rejectBootDecls</span></a></span><span> </span><span class="hs-special">)</span><span>
</span><span id="line-86"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Rename.Splice.html"><span class="hs-identifier">GHC.Rename.Splice</span></a></span><span> </span><span class="hs-special">(</span><span> </span><span class="annot"><a href="GHC.Rename.Splice.html#rnTopSpliceDecls"><span class="hs-identifier">rnTopSpliceDecls</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Rename.Splice.html#traceSplice"><span class="hs-identifier">traceSplice</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Rename.Splice.html#SpliceInfo"><span class="hs-identifier">SpliceInfo</span></a></span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span> </span><span class="hs-special">)</span><span>
</span><span id="line-87"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Rename.HsType.html"><span class="hs-identifier">GHC.Rename.HsType</span></a></span><span>
</span><span id="line-88"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Rename.Expr.html"><span class="hs-identifier">GHC.Rename.Expr</span></a></span><span>
</span><span id="line-89"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Rename.Fixity.html"><span class="hs-identifier">GHC.Rename.Fixity</span></a></span><span> </span><span class="hs-special">(</span><span> </span><span class="annot"><a href="GHC.Rename.Fixity.html#lookupFixityRn"><span class="hs-identifier">lookupFixityRn</span></a></span><span> </span><span class="hs-special">)</span><span>
</span><span id="line-90"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Rename.Names.html"><span class="hs-identifier">GHC.Rename.Names</span></a></span><span>
</span><span id="line-91"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Rename.Env.html"><span class="hs-identifier">GHC.Rename.Env</span></a></span><span>
</span><span id="line-92"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Rename.Module.html"><span class="hs-identifier">GHC.Rename.Module</span></a></span><span>
</span><span id="line-93"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Rename.Doc.html"><span class="hs-identifier">GHC.Rename.Doc</span></a></span><span>
</span><span id="line-94"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Rename.Utils.html"><span class="hs-identifier">GHC.Rename.Utils</span></a></span><span> </span><span class="hs-special">(</span><span> </span><span class="annot"><a href="GHC.Rename.Utils.html#mkNameClashErr"><span class="hs-identifier">mkNameClashErr</span></a></span><span> </span><span class="hs-special">)</span><span>
</span><span id="line-95"></span><span>
</span><span id="line-96"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Iface.Decl.html"><span class="hs-identifier">GHC.Iface.Decl</span></a></span><span>    </span><span class="hs-special">(</span><span> </span><span class="annot"><a href="GHC.Iface.Decl.html#coAxiomToIfaceDecl"><span class="hs-identifier">coAxiomToIfaceDecl</span></a></span><span> </span><span class="hs-special">)</span><span>
</span><span id="line-97"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Iface.Env.html"><span class="hs-identifier">GHC.Iface.Env</span></a></span><span>     </span><span class="hs-special">(</span><span> </span><span class="annot"><a href="GHC.Iface.Env.html#externaliseName"><span class="hs-identifier">externaliseName</span></a></span><span> </span><span class="hs-special">)</span><span>
</span><span id="line-98"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Iface.Load.html"><span class="hs-identifier">GHC.Iface.Load</span></a></span><span>
</span><span id="line-99"></span><span>
</span><span id="line-100"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Builtin.Types.html"><span class="hs-identifier">GHC.Builtin.Types</span></a></span><span> </span><span class="hs-special">(</span><span> </span><span class="annot"><a href="GHC.Builtin.Types.html#mkListTy"><span class="hs-identifier">mkListTy</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Builtin.Types.html#anyTypeOfKind"><span class="hs-identifier">anyTypeOfKind</span></a></span><span> </span><span class="hs-special">)</span><span>
</span><span id="line-101"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Builtin.Names.html"><span class="hs-identifier">GHC.Builtin.Names</span></a></span><span>
</span><span id="line-102"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Builtin.Utils.html"><span class="hs-identifier">GHC.Builtin.Utils</span></a></span><span>
</span><span id="line-103"></span><span>
</span><span id="line-104"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Hs.html"><span class="hs-identifier">GHC.Hs</span></a></span><span> </span><span class="hs-keyword">hiding</span><span> </span><span class="hs-special">(</span><span> </span><span class="annot"><a href="Language.Haskell.Syntax.Decls.html#FunDep"><span class="hs-identifier">FunDep</span></a></span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span> </span><span class="hs-special">)</span><span>
</span><span id="line-105"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Hs.Dump.html"><span class="hs-identifier">GHC.Hs.Dump</span></a></span><span>
</span><span id="line-106"></span><span>
</span><span id="line-107"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Core.PatSyn.html"><span class="hs-identifier">GHC.Core.PatSyn</span></a></span><span>
</span><span id="line-108"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Core.Predicate.html"><span class="hs-identifier">GHC.Core.Predicate</span></a></span><span> </span><span class="hs-special">(</span><span> </span><span class="annot"><a href="GHC.Core.Predicate.html#classMethodTy"><span class="hs-identifier">classMethodTy</span></a></span><span> </span><span class="hs-special">)</span><span>
</span><span id="line-109"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Core.InstEnv.html"><span class="hs-identifier">GHC.Core.InstEnv</span></a></span><span>
</span><span id="line-110"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Core.TyCon.html"><span class="hs-identifier">GHC.Core.TyCon</span></a></span><span>
</span><span id="line-111"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Core.DataCon.html"><span class="hs-identifier">GHC.Core.DataCon</span></a></span><span>
</span><span id="line-112"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Core.TyCo.Rep.html"><span class="hs-identifier">GHC.Core.TyCo.Rep</span></a></span><span>
</span><span id="line-113"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Core.Type.html"><span class="hs-identifier">GHC.Core.Type</span></a></span><span>
</span><span id="line-114"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Core.Class.html"><span class="hs-identifier">GHC.Core.Class</span></a></span><span>
</span><span id="line-115"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Core.Coercion.Axiom.html"><span class="hs-identifier">GHC.Core.Coercion.Axiom</span></a></span><span>
</span><span id="line-116"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Core.Reduction.html"><span class="hs-identifier">GHC.Core.Reduction</span></a></span><span> </span><span class="hs-special">(</span><span> </span><span class="annot"><a href="GHC.Core.Reduction.html#Reduction"><span class="hs-identifier">Reduction</span></a></span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span> </span><span class="hs-special">)</span><span>
</span><span id="line-117"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Core.TyCo.Ppr.html"><span class="hs-identifier">GHC.Core.TyCo.Ppr</span></a></span><span class="hs-special">(</span><span> </span><span class="annot"><a href="GHC.Core.TyCo.Ppr.html#debugPprType"><span class="hs-identifier">debugPprType</span></a></span><span> </span><span class="hs-special">)</span><span>
</span><span id="line-118"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Core.FamInstEnv.html"><span class="hs-identifier">GHC.Core.FamInstEnv</span></a></span><span>
</span><span id="line-119"></span><span>   </span><span class="hs-special">(</span><span> </span><span class="annot"><a href="GHC.Core.FamInstEnv.html#FamInst"><span class="hs-identifier">FamInst</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Core.FamInstEnv.html#pprFamInst"><span class="hs-identifier">pprFamInst</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Core.FamInstEnv.html#famInstsRepTyCons"><span class="hs-identifier">famInstsRepTyCons</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Core.FamInstEnv.html#orphNamesOfFamInst"><span class="hs-identifier">orphNamesOfFamInst</span></a></span><span>
</span><span id="line-120"></span><span>   </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Core.FamInstEnv.html#famInstEnvElts"><span class="hs-identifier">famInstEnvElts</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Core.FamInstEnv.html#extendFamInstEnvList"><span class="hs-identifier">extendFamInstEnvList</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Core.FamInstEnv.html#normaliseType"><span class="hs-identifier">normaliseType</span></a></span><span> </span><span class="hs-special">)</span><span>
</span><span id="line-121"></span><span>
</span><span id="line-122"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Parser.Header.html"><span class="hs-identifier">GHC.Parser.Header</span></a></span><span>       </span><span class="hs-special">(</span><span> </span><span class="annot"><a href="GHC.Parser.Header.html#mkPrelImports"><span class="hs-identifier">mkPrelImports</span></a></span><span> </span><span class="hs-special">)</span><span>
</span><span id="line-123"></span><span>
</span><span id="line-124"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.IfaceToCore.html"><span class="hs-identifier">GHC.IfaceToCore</span></a></span><span>
</span><span id="line-125"></span><span>
</span><span id="line-126"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Runtime.Context.html"><span class="hs-identifier">GHC.Runtime.Context</span></a></span><span>
</span><span id="line-127"></span><span>
</span><span id="line-128"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Utils.Error.html"><span class="hs-identifier">GHC.Utils.Error</span></a></span><span>
</span><span id="line-129"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Utils.Outputable.html"><span class="hs-identifier">GHC.Utils.Outputable</span></a></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">Outputable</span></span><span>
</span><span id="line-130"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Utils.Panic.html"><span class="hs-identifier">GHC.Utils.Panic</span></a></span><span>
</span><span id="line-131"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Utils.Misc.html"><span class="hs-identifier">GHC.Utils.Misc</span></a></span><span>
</span><span id="line-132"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Utils.Logger.html"><span class="hs-identifier">GHC.Utils.Logger</span></a></span><span>
</span><span id="line-133"></span><span>
</span><span id="line-134"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Types.Error.html"><span class="hs-identifier">GHC.Types.Error</span></a></span><span>
</span><span id="line-135"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Types.Name.Reader.html"><span class="hs-identifier">GHC.Types.Name.Reader</span></a></span><span>
</span><span id="line-136"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Types.DefaultEnv.html"><span class="hs-identifier">GHC.Types.DefaultEnv</span></a></span><span> </span><span class="hs-special">(</span><span> </span><span class="annot"><a href="GHC.Types.DefaultEnv.html#DefaultEnv"><span class="hs-identifier">DefaultEnv</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Types.DefaultEnv.html#ClassDefaults"><span class="hs-identifier">ClassDefaults</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Types.DefaultEnv.html#ClassDefaults"><span class="hs-identifier">ClassDefaults</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Types.DefaultEnv.html#cd_class"><span class="hs-identifier">cd_class</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Types.DefaultEnv.html#cd_types"><span class="hs-identifier">cd_types</span></a></span><span class="hs-special">)</span><span class="hs-special">,</span><span>
</span><span id="line-137"></span><span>                              </span><span class="annot"><a href="GHC.Types.DefaultEnv.html#emptyDefaultEnv"><span class="hs-identifier">emptyDefaultEnv</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Types.DefaultEnv.html#isEmptyDefaultEnv"><span class="hs-identifier">isEmptyDefaultEnv</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Types.DefaultEnv.html#unitDefaultEnv"><span class="hs-identifier">unitDefaultEnv</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Types.DefaultEnv.html#lookupDefaultEnv"><span class="hs-identifier">lookupDefaultEnv</span></a></span><span> </span><span class="hs-special">)</span><span>
</span><span id="line-138"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Types.Fixity.Env.html"><span class="hs-identifier">GHC.Types.Fixity.Env</span></a></span><span>
</span><span id="line-139"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Types.Id.html"><span class="hs-identifier">GHC.Types.Id</span></a></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">Id</span></span><span>
</span><span id="line-140"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Types.Id.Info.html"><span class="hs-identifier">GHC.Types.Id.Info</span></a></span><span class="hs-special">(</span><span> </span><span class="annot"><a href="GHC.Types.Id.Info.html#IdDetails"><span class="hs-identifier">IdDetails</span></a></span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span> </span><span class="hs-special">)</span><span>
</span><span id="line-141"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Types.Var.Env.html"><span class="hs-identifier">GHC.Types.Var.Env</span></a></span><span>
</span><span id="line-142"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Types.TypeEnv.html"><span class="hs-identifier">GHC.Types.TypeEnv</span></a></span><span>
</span><span id="line-143"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Types.Unique.FM.html"><span class="hs-identifier">GHC.Types.Unique.FM</span></a></span><span>
</span><span id="line-144"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Types.Name.html"><span class="hs-identifier">GHC.Types.Name</span></a></span><span>
</span><span id="line-145"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Types.Name.Env.html"><span class="hs-identifier">GHC.Types.Name.Env</span></a></span><span>
</span><span id="line-146"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Types.Name.Set.html"><span class="hs-identifier">GHC.Types.Name.Set</span></a></span><span>
</span><span id="line-147"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Types.Avail.html"><span class="hs-identifier">GHC.Types.Avail</span></a></span><span>
</span><span id="line-148"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Types.Basic.html"><span class="hs-identifier">GHC.Types.Basic</span></a></span><span> </span><span class="hs-keyword">hiding</span><span class="hs-special">(</span><span> </span><span class="annot"><a href="GHC.Types.Basic.html#SuccessFlag"><span class="hs-identifier">SuccessFlag</span></a></span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span> </span><span class="hs-special">)</span><span>
</span><span id="line-149"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Types.Annotations.html"><span class="hs-identifier">GHC.Types.Annotations</span></a></span><span>
</span><span id="line-150"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Types.SrcLoc.html"><span class="hs-identifier">GHC.Types.SrcLoc</span></a></span><span>
</span><span id="line-151"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Types.SourceFile.html"><span class="hs-identifier">GHC.Types.SourceFile</span></a></span><span>
</span><span id="line-152"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Types.PkgQual.html"><span class="hs-identifier">GHC.Types.PkgQual</span></a></span><span>
</span><span id="line-153"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><a href="../../ghc-boot-9.12.2-1a37/src/GHC.LanguageExtensions.html"><span class="hs-identifier">GHC.LanguageExtensions</span></a></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">LangExt</span></span><span>
</span><span id="line-154"></span><span>
</span><span id="line-155"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Unit.External.html"><span class="hs-identifier">GHC.Unit.External</span></a></span><span>
</span><span id="line-156"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Unit.Types.html"><span class="hs-identifier">GHC.Unit.Types</span></a></span><span>
</span><span id="line-157"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Unit.State.html"><span class="hs-identifier">GHC.Unit.State</span></a></span><span>
</span><span id="line-158"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Unit.Home.html"><span class="hs-identifier">GHC.Unit.Home</span></a></span><span>
</span><span id="line-159"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Unit.Module.html"><span class="hs-identifier">GHC.Unit.Module</span></a></span><span>
</span><span id="line-160"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Unit.Module.Warnings.html"><span class="hs-identifier">GHC.Unit.Module.Warnings</span></a></span><span>
</span><span id="line-161"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Unit.Module.ModSummary.html"><span class="hs-identifier">GHC.Unit.Module.ModSummary</span></a></span><span>
</span><span id="line-162"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Unit.Module.ModIface.html"><span class="hs-identifier">GHC.Unit.Module.ModIface</span></a></span><span>
</span><span id="line-163"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Unit.Module.ModDetails.html"><span class="hs-identifier">GHC.Unit.Module.ModDetails</span></a></span><span>
</span><span id="line-164"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Unit.Module.Deps.html"><span class="hs-identifier">GHC.Unit.Module.Deps</span></a></span><span>
</span><span id="line-165"></span><span>
</span><span id="line-166"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Data.FastString.html"><span class="hs-identifier">GHC.Data.FastString</span></a></span><span>
</span><span id="line-167"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Data.Maybe.html"><span class="hs-identifier">GHC.Data.Maybe</span></a></span><span>
</span><span id="line-168"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Data.List.SetOps.html"><span class="hs-identifier">GHC.Data.List.SetOps</span></a></span><span>
</span><span id="line-169"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Data.Bag.html"><span class="hs-identifier">GHC.Data.Bag</span></a></span><span>
</span><span id="line-170"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><a href="GHC.Data.BooleanFormula.html"><span class="hs-identifier">GHC.Data.BooleanFormula</span></a></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">BF</span></span><span>
</span><span id="line-171"></span><span>
</span><span id="line-172"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="../../base-4.21.0.0-ae91/src/Control.Arrow.html"><span class="hs-identifier">Control.Arrow</span></a></span><span> </span><span class="hs-special">(</span><span> </span><span class="annot"><span class="hs-identifier">second</span></span><span> </span><span class="hs-special">)</span><span>
</span><span id="line-173"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="../../deepseq-1.5.1.0-6837/src/Control.DeepSeq.html"><span class="hs-identifier">Control.DeepSeq</span></a></span><span>
</span><span id="line-174"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="../../base-4.21.0.0-ae91/src/Control.Monad.html"><span class="hs-identifier">Control.Monad</span></a></span><span>
</span><span id="line-175"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="../../transformers-0.6.1.2-38b1/src/Control.Monad.Trans.Writer.CPS.html"><span class="hs-identifier">Control.Monad.Trans.Writer.CPS</span></a></span><span>
</span><span id="line-176"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="../../base-4.21.0.0-ae91/src/Data.Data.html"><span class="hs-identifier">Data.Data</span></a></span><span> </span><span class="hs-special">(</span><span> </span><span class="annot"><span class="hs-identifier">Data</span></span><span> </span><span class="hs-special">)</span><span>
</span><span id="line-177"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="../../base-4.21.0.0-ae91/src/Data.Functor.Classes.html"><span class="hs-identifier">Data.Functor.Classes</span></a></span><span> </span><span class="hs-special">(</span><span> </span><span class="annot"><a href="../../base-4.21.0.0-ae91/src/Data.Functor.Classes.html#liftEq"><span class="hs-identifier">liftEq</span></a></span><span> </span><span class="hs-special">)</span><span>
</span><span id="line-178"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="../../base-4.21.0.0-ae91/src/Data.List.html"><span class="hs-identifier">Data.List</span></a></span><span> </span><span class="hs-special">(</span><span> </span><span class="annot"><span class="hs-identifier">sort</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">sortBy</span></span><span> </span><span class="hs-special">)</span><span>
</span><span id="line-179"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="../../base-4.21.0.0-ae91/src/Data.List.NonEmpty.html"><span class="hs-identifier">Data.List.NonEmpty</span></a></span><span> </span><span class="hs-special">(</span><span> </span><span class="annot"><span class="hs-identifier">NonEmpty</span></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span> </span><span class="hs-special">)</span><span>
</span><span id="line-180"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><a href="../../base-4.21.0.0-ae91/src/Data.List.NonEmpty.html"><span class="hs-identifier">Data.List.NonEmpty</span></a></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">NE</span></span><span>
</span><span id="line-181"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="../../base-4.21.0.0-ae91/src/Data.Ord.html"><span class="hs-identifier">Data.Ord</span></a></span><span>
</span><span id="line-182"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><a href="../../containers-0.7-5a8f/src/Data.Set.html"><span class="hs-identifier">Data.Set</span></a></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">S</span></span><span>
</span><span id="line-183"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><a href="../../containers-0.7-5a8f/src/Data.Map.html"><span class="hs-identifier">Data.Map</span></a></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">M</span></span><span>
</span><span id="line-184"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="../../base-4.21.0.0-ae91/src/Data.Foldable.html"><span class="hs-identifier">Data.Foldable</span></a></span><span> </span><span class="hs-special">(</span><span> </span><span class="annot"><span class="hs-identifier">for_</span></span><span> </span><span class="hs-special">)</span><span>
</span><span id="line-185"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="../../base-4.21.0.0-ae91/src/Data.Traversable.html"><span class="hs-identifier">Data.Traversable</span></a></span><span> </span><span class="hs-special">(</span><span> </span><span class="annot"><span class="hs-identifier">for</span></span><span> </span><span class="hs-special">)</span><span>
</span><span id="line-186"></span><span>
</span><span id="line-187"></span><span>
</span><span id="line-188"></span><span>
</span><span id="line-189"></span><span class="hs-comment">{-
************************************************************************
*                                                                      *
        Typecheck and rename a module
*                                                                      *
************************************************************************
-}</span><span>
</span><span id="line-196"></span><span>
</span><span id="line-197"></span><span class="annot"><span class="hs-comment">-- | Top level entry point for typechecker and renamer</span></span><span>
</span><span id="line-198"></span><span class="annot"><a href="GHC.Tc.Module.html#tcRnModule"><span class="hs-identifier hs-type">tcRnModule</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Driver.Env.Types.html#HscEnv"><span class="hs-identifier hs-type">HscEnv</span></a></span><span>
</span><span id="line-199"></span><span>           </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Unit.Module.ModSummary.html#ModSummary"><span class="hs-identifier hs-type">ModSummary</span></a></span><span>
</span><span id="line-200"></span><span>           </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Bool</span></span><span>              </span><span class="hs-comment">-- True &lt;=&gt; save renamed syntax</span><span>
</span><span id="line-201"></span><span>           </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Hs.html#HsParsedModule"><span class="hs-identifier hs-type">HsParsedModule</span></a></span><span>
</span><span id="line-202"></span><span>           </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Types.Error.html#Messages"><span class="hs-identifier hs-type">Messages</span></a></span><span> </span><span class="annot"><a href="GHC.Tc.Errors.Types.html#TcRnMessage"><span class="hs-identifier hs-type">TcRnMessage</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Maybe</span></span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#TcGblEnv"><span class="hs-identifier hs-type">TcGblEnv</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-203"></span><span>
</span><span id="line-204"></span><span id="tcRnModule"><span class="annot"><span class="annottext">tcRnModule :: HscEnv
-&gt; ModSummary
-&gt; Bool
-&gt; HsParsedModule
-&gt; IO (Messages TcRnMessage, Maybe TcGblEnv)
</span><a href="GHC.Tc.Module.html#tcRnModule"><span class="hs-identifier hs-var hs-var">tcRnModule</span></a></span></span><span> </span><span id="local-6989586621683116500"><span class="annot"><span class="annottext">HscEnv
</span><a href="#local-6989586621683116500"><span class="hs-identifier hs-var">hsc_env</span></a></span></span><span> </span><span id="local-6989586621683116501"><span class="annot"><span class="annottext">ModSummary
</span><a href="#local-6989586621683116501"><span class="hs-identifier hs-var">mod_sum</span></a></span></span><span> </span><span id="local-6989586621683116502"><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621683116502"><span class="hs-identifier hs-var">save_rn_syntax</span></a></span></span><span>
</span><span id="line-205"></span><span>   </span><span id="local-6989586621683116503"><span class="annot"><span class="annottext">parsedModule :: HsParsedModule
</span><a href="#local-6989586621683116503"><span class="hs-identifier hs-var">parsedModule</span></a></span></span><span class="hs-glyph">@</span><span class="annot"><a href="GHC.Hs.html#HsParsedModule"><span class="hs-identifier hs-type">HsParsedModule</span></a></span><span> </span><span class="hs-special">{</span><span class="annot"><span class="annottext">hpm_module :: HsParsedModule -&gt; Located (HsModule GhcPs)
</span><a href="GHC.Hs.html#hpm_module"><span class="hs-identifier hs-var">hpm_module</span></a></span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="GHC.Types.SrcLoc.html#L"><span class="hs-identifier hs-type">L</span></a></span><span> </span><span id="local-6989586621683116507"><span class="annot"><span class="annottext">SrcSpan
</span><a href="#local-6989586621683116507"><span class="hs-identifier hs-var">loc</span></a></span></span><span> </span><span id="local-6989586621683116508"><span class="annot"><span class="annottext">HsModule GhcPs
</span><a href="#local-6989586621683116508"><span class="hs-identifier hs-var">this_module</span></a></span></span><span class="hs-special">}</span><span>
</span><span id="line-206"></span><span> </span><span class="hs-glyph">|</span><span> </span><span class="annot"><a href="GHC.Types.SrcLoc.html#RealSrcSpan"><span class="hs-identifier hs-type">RealSrcSpan</span></a></span><span> </span><span id="local-6989586621683116510"><span class="annot"><span class="annottext">RealSrcSpan
</span><a href="#local-6989586621683116510"><span class="hs-identifier hs-var">real_loc</span></a></span></span><span> </span><span class="annot"><span class="annottext">Maybe BufSpan
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">SrcSpan
</span><a href="#local-6989586621683116507"><span class="hs-identifier hs-var">loc</span></a></span><span>
</span><span id="line-207"></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Logger
-&gt; SDoc
-&gt; ((Messages TcRnMessage, Maybe TcGblEnv) -&gt; ())
-&gt; IO (Messages TcRnMessage, Maybe TcGblEnv)
-&gt; IO (Messages TcRnMessage, Maybe TcGblEnv)
forall (m :: * -&gt; *) a.
MonadIO m =&gt;
Logger -&gt; SDoc -&gt; (a -&gt; ()) -&gt; m a -&gt; m a
</span><a href="GHC.Utils.Error.html#withTiming"><span class="hs-identifier hs-var">withTiming</span></a></span><span> </span><span class="annot"><span class="annottext">Logger
</span><a href="#local-6989586621683116512"><span class="hs-identifier hs-var">logger</span></a></span><span>
</span><span id="line-208"></span><span>              </span><span class="hs-special">(</span><span class="annot"><span class="annottext">String -&gt; SDoc
forall doc. IsLine doc =&gt; String -&gt; doc
</span><a href="GHC.Utils.Outputable.html#text"><span class="hs-identifier hs-var">text</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;Renamer/typechecker&quot;</span></span><span class="annot"><span class="annottext">SDoc -&gt; SDoc -&gt; SDoc
forall doc. IsLine doc =&gt; doc -&gt; doc -&gt; doc
</span><a href="GHC.Utils.Outputable.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a></span><span class="annot"><span class="annottext">SDoc -&gt; SDoc
forall doc. IsLine doc =&gt; doc -&gt; doc
</span><a href="GHC.Utils.Outputable.html#brackets"><span class="hs-identifier hs-var">brackets</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Module -&gt; SDoc
forall a. Outputable a =&gt; a -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="annot"><span class="annottext">Module
</span><a href="#local-6989586621683116517"><span class="hs-identifier hs-var">this_mod</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-209"></span><span>              </span><span class="hs-special">(</span><span class="annot"><span class="annottext">() -&gt; (Messages TcRnMessage, Maybe TcGblEnv) -&gt; ()
forall a b. a -&gt; b -&gt; a
</span><span class="hs-identifier hs-var">const</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(IO (Messages TcRnMessage, Maybe TcGblEnv)
 -&gt; IO (Messages TcRnMessage, Maybe TcGblEnv))
-&gt; IO (Messages TcRnMessage, Maybe TcGblEnv)
-&gt; IO (Messages TcRnMessage, Maybe TcGblEnv)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-210"></span><span>   </span><span class="annot"><span class="annottext">HscEnv
-&gt; HscSource
-&gt; Bool
-&gt; Module
-&gt; RealSrcSpan
-&gt; TcM TcGblEnv
-&gt; IO (Messages TcRnMessage, Maybe TcGblEnv)
forall r.
HscEnv
-&gt; HscSource
-&gt; Bool
-&gt; Module
-&gt; RealSrcSpan
-&gt; TcM r
-&gt; IO (Messages TcRnMessage, Maybe r)
</span><a href="GHC.Tc.Utils.Monad.html#initTc"><span class="hs-identifier hs-var">initTc</span></a></span><span> </span><span class="annot"><span class="annottext">HscEnv
</span><a href="#local-6989586621683116500"><span class="hs-identifier hs-var">hsc_env</span></a></span><span> </span><span class="annot"><span class="annottext">HscSource
</span><a href="#local-6989586621683116520"><span class="hs-identifier hs-var">hsc_src</span></a></span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621683116502"><span class="hs-identifier hs-var">save_rn_syntax</span></a></span><span> </span><span class="annot"><span class="annottext">Module
</span><a href="#local-6989586621683116517"><span class="hs-identifier hs-var">this_mod</span></a></span><span> </span><span class="annot"><span class="annottext">RealSrcSpan
</span><a href="#local-6989586621683116510"><span class="hs-identifier hs-var">real_loc</span></a></span><span> </span><span class="annot"><span class="annottext">(TcM TcGblEnv -&gt; IO (Messages TcRnMessage, Maybe TcGblEnv))
-&gt; TcM TcGblEnv -&gt; IO (Messages TcRnMessage, Maybe TcGblEnv)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-211"></span><span>          </span><span class="annot"><span class="annottext">HscEnv -&gt; TcM TcGblEnv -&gt; TcM TcGblEnv
forall a. HscEnv -&gt; TcM a -&gt; TcM a
</span><a href="GHC.Tc.Module.html#withTcPlugins"><span class="hs-identifier hs-var">withTcPlugins</span></a></span><span> </span><span class="annot"><span class="annottext">HscEnv
</span><a href="#local-6989586621683116500"><span class="hs-identifier hs-var">hsc_env</span></a></span><span> </span><span class="annot"><span class="annottext">(TcM TcGblEnv -&gt; TcM TcGblEnv) -&gt; TcM TcGblEnv -&gt; TcM TcGblEnv
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-212"></span><span>          </span><span class="annot"><span class="annottext">HscEnv -&gt; TcM TcGblEnv -&gt; TcM TcGblEnv
forall a. HscEnv -&gt; TcM a -&gt; TcM a
</span><a href="GHC.Tc.Module.html#withDefaultingPlugins"><span class="hs-identifier hs-var">withDefaultingPlugins</span></a></span><span> </span><span class="annot"><span class="annottext">HscEnv
</span><a href="#local-6989586621683116500"><span class="hs-identifier hs-var">hsc_env</span></a></span><span> </span><span class="annot"><span class="annottext">(TcM TcGblEnv -&gt; TcM TcGblEnv) -&gt; TcM TcGblEnv -&gt; TcM TcGblEnv
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-213"></span><span>          </span><span class="annot"><span class="annottext">HscEnv -&gt; TcM TcGblEnv -&gt; TcM TcGblEnv
forall a. HscEnv -&gt; TcM a -&gt; TcM a
</span><a href="GHC.Tc.Module.html#withHoleFitPlugins"><span class="hs-identifier hs-var">withHoleFitPlugins</span></a></span><span> </span><span class="annot"><span class="annottext">HscEnv
</span><a href="#local-6989586621683116500"><span class="hs-identifier hs-var">hsc_env</span></a></span><span> </span><span class="annot"><span class="annottext">(TcM TcGblEnv -&gt; TcM TcGblEnv) -&gt; TcM TcGblEnv -&gt; TcM TcGblEnv
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-214"></span><span>
</span><span id="line-215"></span><span>          </span><span class="annot"><span class="annottext">HscEnv
-&gt; ModSummary
-&gt; HsParsedModule
-&gt; (Module, SrcSpan)
-&gt; TcM TcGblEnv
</span><a href="GHC.Tc.Module.html#tcRnModuleTcRnM"><span class="hs-identifier hs-var">tcRnModuleTcRnM</span></a></span><span> </span><span class="annot"><span class="annottext">HscEnv
</span><a href="#local-6989586621683116500"><span class="hs-identifier hs-var">hsc_env</span></a></span><span> </span><span class="annot"><span class="annottext">ModSummary
</span><a href="#local-6989586621683116501"><span class="hs-identifier hs-var">mod_sum</span></a></span><span> </span><span class="annot"><span class="annottext">HsParsedModule
</span><a href="#local-6989586621683116503"><span class="hs-identifier hs-var">parsedModule</span></a></span><span> </span><span class="annot"><span class="annottext">(Module, SrcSpan)
</span><a href="#local-6989586621683116522"><span class="hs-identifier hs-var">pair</span></a></span><span>
</span><span id="line-216"></span><span>
</span><span id="line-217"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">otherwise</span></span><span>
</span><span id="line-218"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(Messages TcRnMessage, Maybe TcGblEnv)
-&gt; IO (Messages TcRnMessage, Maybe TcGblEnv)
forall a. a -&gt; IO a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">MsgEnvelope TcRnMessage
</span><a href="#local-6989586621683116523"><span class="hs-identifier hs-var">err_msg</span></a></span><span> </span><span class="annot"><span class="annottext">MsgEnvelope TcRnMessage
-&gt; Messages TcRnMessage -&gt; Messages TcRnMessage
forall e. MsgEnvelope e -&gt; Messages e -&gt; Messages e
</span><a href="GHC.Types.Error.html#addMessage"><span class="hs-operator hs-var">`addMessage`</span></a></span><span> </span><span class="annot"><span class="annottext">Messages TcRnMessage
forall e. Messages e
</span><a href="GHC.Types.Error.html#emptyMessages"><span class="hs-identifier hs-var">emptyMessages</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Maybe TcGblEnv
forall a. Maybe a
</span><span class="hs-identifier hs-var">Nothing</span></span><span class="hs-special">)</span><span>
</span><span id="line-219"></span><span>
</span><span id="line-220"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-221"></span><span>    </span><span id="local-6989586621683116520"><span class="annot"><span class="annottext">hsc_src :: HscSource
</span><a href="#local-6989586621683116520"><span class="hs-identifier hs-var hs-var">hsc_src</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ModSummary -&gt; HscSource
</span><a href="GHC.Unit.Module.ModSummary.html#ms_hsc_src"><span class="hs-identifier hs-var">ms_hsc_src</span></a></span><span> </span><span class="annot"><span class="annottext">ModSummary
</span><a href="#local-6989586621683116501"><span class="hs-identifier hs-var">mod_sum</span></a></span><span>
</span><span id="line-222"></span><span>    </span><span id="local-6989586621683116512"><span class="annot"><span class="annottext">logger :: Logger
</span><a href="#local-6989586621683116512"><span class="hs-identifier hs-var hs-var">logger</span></a></span></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">HscEnv -&gt; Logger
</span><a href="GHC.Driver.Env.Types.html#hsc_logger"><span class="hs-identifier hs-var">hsc_logger</span></a></span><span> </span><span class="annot"><span class="annottext">HscEnv
</span><a href="#local-6989586621683116500"><span class="hs-identifier hs-var">hsc_env</span></a></span><span>
</span><span id="line-223"></span><span>    </span><span id="local-6989586621683116528"><span class="annot"><span class="annottext">home_unit :: HomeUnit
</span><a href="#local-6989586621683116528"><span class="hs-identifier hs-var hs-var">home_unit</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">HscEnv -&gt; HomeUnit
</span><a href="GHC.Driver.Env.html#hsc_home_unit"><span class="hs-identifier hs-var">hsc_home_unit</span></a></span><span> </span><span class="annot"><span class="annottext">HscEnv
</span><a href="#local-6989586621683116500"><span class="hs-identifier hs-var">hsc_env</span></a></span><span>
</span><span id="line-224"></span><span>    </span><span id="local-6989586621683116523"><span class="annot"><span class="annottext">err_msg :: MsgEnvelope TcRnMessage
</span><a href="#local-6989586621683116523"><span class="hs-identifier hs-var hs-var">err_msg</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">SrcSpan -&gt; TcRnMessage -&gt; MsgEnvelope TcRnMessage
forall e. Diagnostic e =&gt; SrcSpan -&gt; e -&gt; MsgEnvelope e
</span><a href="GHC.Utils.Error.html#mkPlainErrorMsgEnvelope"><span class="hs-identifier hs-var">mkPlainErrorMsgEnvelope</span></a></span><span> </span><span class="annot"><span class="annottext">SrcSpan
</span><a href="#local-6989586621683116507"><span class="hs-identifier hs-var">loc</span></a></span><span> </span><span class="annot"><span class="annottext">(TcRnMessage -&gt; MsgEnvelope TcRnMessage)
-&gt; TcRnMessage -&gt; MsgEnvelope TcRnMessage
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-225"></span><span>              </span><span class="annot"><span class="annottext">Module -&gt; TcRnMessage
</span><a href="GHC.Tc.Errors.Types.html#TcRnModMissingRealSrcSpan"><span class="hs-identifier hs-var">TcRnModMissingRealSrcSpan</span></a></span><span> </span><span class="annot"><span class="annottext">Module
</span><a href="#local-6989586621683116517"><span class="hs-identifier hs-var">this_mod</span></a></span><span>
</span><span id="line-226"></span><span>
</span><span id="line-227"></span><span>    </span><span class="annot"><a href="#local-6989586621683116522"><span class="hs-identifier hs-type">pair</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Unit.Types.html#Module"><span class="hs-identifier hs-type">Module</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Types.SrcLoc.html#SrcSpan"><span class="hs-identifier hs-type">SrcSpan</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-228"></span><span>    </span><span id="local-6989586621683116522"><span class="annot"><span class="annottext">pair :: (Module, SrcSpan)
</span><a href="#local-6989586621683116522"><span class="hs-identifier hs-var">pair</span></a></span></span><span class="hs-glyph">@</span><span class="hs-special">(</span><span id="local-6989586621683116517"><span class="annot"><span class="annottext">Module
</span><a href="#local-6989586621683116517"><span class="hs-identifier hs-var">this_mod</span></a></span></span><span class="hs-special">,</span><span class="annot"><span class="annottext">SrcSpan
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span>
</span><span id="line-229"></span><span>      </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Types.SrcLoc.html#L"><span class="hs-identifier hs-type">L</span></a></span><span> </span><span id="local-6989586621683116532"><span class="annot"><span class="annottext">SrcSpanAnnA
</span><a href="#local-6989586621683116532"><span class="hs-identifier hs-var">mod_loc</span></a></span></span><span> </span><span id="local-6989586621683116533"><span class="annot"><span class="annottext">ModuleName
</span><a href="#local-6989586621683116533"><span class="hs-identifier hs-var">mod</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">HsModule GhcPs -&gt; Maybe (XRec GhcPs ModuleName)
forall p. HsModule p -&gt; Maybe (XRec p ModuleName)
</span><a href="Language.Haskell.Syntax.html#hsmodName"><span class="hs-identifier hs-var">hsmodName</span></a></span><span> </span><span class="annot"><span class="annottext">HsModule GhcPs
</span><a href="#local-6989586621683116508"><span class="hs-identifier hs-var">this_module</span></a></span><span>
</span><span id="line-230"></span><span>      </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">HomeUnit -&gt; ModuleName -&gt; Module
</span><a href="GHC.Unit.Home.html#mkHomeModule"><span class="hs-identifier hs-var">mkHomeModule</span></a></span><span> </span><span class="annot"><span class="annottext">HomeUnit
</span><a href="#local-6989586621683116528"><span class="hs-identifier hs-var">home_unit</span></a></span><span> </span><span class="annot"><span class="annottext">ModuleName
</span><a href="#local-6989586621683116533"><span class="hs-identifier hs-var">mod</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">SrcSpanAnnA -&gt; SrcSpan
forall a. HasLoc a =&gt; a -&gt; SrcSpan
</span><a href="GHC.Parser.Annotation.html#locA"><span class="hs-identifier hs-var">locA</span></a></span><span> </span><span class="annot"><span class="annottext">SrcSpanAnnA
</span><a href="#local-6989586621683116532"><span class="hs-identifier hs-var">mod_loc</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-231"></span><span>
</span><span id="line-232"></span><span>      </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">otherwise</span></span><span>   </span><span class="hs-comment">-- 'module M where' is omitted</span><span>
</span><span id="line-233"></span><span>      </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">HomeUnit -&gt; ModuleName -&gt; Module
</span><a href="GHC.Unit.Home.html#mkHomeModule"><span class="hs-identifier hs-var">mkHomeModule</span></a></span><span> </span><span class="annot"><span class="annottext">HomeUnit
</span><a href="#local-6989586621683116528"><span class="hs-identifier hs-var">home_unit</span></a></span><span> </span><span class="annot"><span class="annottext">ModuleName
</span><a href="GHC.Builtin.Names.html#mAIN_NAME"><span class="hs-identifier hs-var">mAIN_NAME</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">SrcLoc -&gt; SrcSpan
</span><a href="GHC.Types.SrcLoc.html#srcLocSpan"><span class="hs-identifier hs-var">srcLocSpan</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">SrcSpan -&gt; SrcLoc
</span><a href="GHC.Types.SrcLoc.html#srcSpanStart"><span class="hs-identifier hs-var">srcSpanStart</span></a></span><span> </span><span class="annot"><span class="annottext">SrcSpan
</span><a href="#local-6989586621683116507"><span class="hs-identifier hs-var">loc</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-234"></span><span>
</span><span id="line-235"></span><span>
</span><span id="line-236"></span><span>
</span><span id="line-237"></span><span>
</span><span id="line-238"></span><span class="annot"><a href="GHC.Tc.Module.html#tcRnModuleTcRnM"><span class="hs-identifier hs-type">tcRnModuleTcRnM</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Driver.Env.Types.html#HscEnv"><span class="hs-identifier hs-type">HscEnv</span></a></span><span>
</span><span id="line-239"></span><span>                </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Unit.Module.ModSummary.html#ModSummary"><span class="hs-identifier hs-type">ModSummary</span></a></span><span>
</span><span id="line-240"></span><span>                </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Hs.html#HsParsedModule"><span class="hs-identifier hs-type">HsParsedModule</span></a></span><span>
</span><span id="line-241"></span><span>                </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Unit.Types.html#Module"><span class="hs-identifier hs-type">Module</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Types.SrcLoc.html#SrcSpan"><span class="hs-identifier hs-type">SrcSpan</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-242"></span><span>                </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#TcRn"><span class="hs-identifier hs-type">TcRn</span></a></span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#TcGblEnv"><span class="hs-identifier hs-type">TcGblEnv</span></a></span><span>
</span><span id="line-243"></span><span class="hs-comment">-- Factored out separately from tcRnModule so that a Core plugin can</span><span>
</span><span id="line-244"></span><span class="hs-comment">-- call the type checker directly</span><span>
</span><span id="line-245"></span><span id="tcRnModuleTcRnM"><span class="annot"><span class="annottext">tcRnModuleTcRnM :: HscEnv
-&gt; ModSummary
-&gt; HsParsedModule
-&gt; (Module, SrcSpan)
-&gt; TcM TcGblEnv
</span><a href="GHC.Tc.Module.html#tcRnModuleTcRnM"><span class="hs-identifier hs-var hs-var">tcRnModuleTcRnM</span></a></span></span><span> </span><span id="local-6989586621683116540"><span class="annot"><span class="annottext">HscEnv
</span><a href="#local-6989586621683116540"><span class="hs-identifier hs-var">hsc_env</span></a></span></span><span> </span><span id="local-6989586621683116541"><span class="annot"><span class="annottext">ModSummary
</span><a href="#local-6989586621683116541"><span class="hs-identifier hs-var">mod_sum</span></a></span></span><span>
</span><span id="line-246"></span><span>                </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Hs.html#HsParsedModule"><span class="hs-identifier hs-type">HsParsedModule</span></a></span><span> </span><span class="hs-special">{</span><span>
</span><span id="line-247"></span><span>                   </span><span class="annot"><span class="annottext">hpm_module :: HsParsedModule -&gt; Located (HsModule GhcPs)
</span><a href="GHC.Hs.html#hpm_module"><span class="hs-identifier hs-var">hpm_module</span></a></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-248"></span><span>                      </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Types.SrcLoc.html#L"><span class="hs-identifier hs-type">L</span></a></span><span> </span><span id="local-6989586621683116542"><span class="annot"><span class="annottext">SrcSpan
</span><a href="#local-6989586621683116542"><span class="hs-identifier hs-var">loc</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Language.Haskell.Syntax.html#HsModule"><span class="hs-identifier hs-type">HsModule</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Hs.html#XModulePs"><span class="hs-identifier hs-type">XModulePs</span></a></span><span> </span><span class="annot"><span class="annottext">EpAnn AnnsModule
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">EpLayout
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621683116545"><span class="annot"><span class="annottext">Maybe (LWarningTxt GhcPs)
</span><a href="#local-6989586621683116545"><span class="hs-identifier hs-var">mod_deprec</span></a></span></span><span> </span><span id="local-6989586621683116546"><span class="annot"><span class="annottext">Maybe (LHsDoc GhcPs)
</span><a href="#local-6989586621683116546"><span class="hs-identifier hs-var">maybe_doc_hdr</span></a></span></span><span class="hs-special">)</span><span>
</span><span id="line-249"></span><span>                                       </span><span id="local-6989586621683116547"><span class="annot"><span class="annottext">Maybe (XRec GhcPs ModuleName)
</span><a href="#local-6989586621683116547"><span class="hs-identifier hs-var">maybe_mod</span></a></span></span><span> </span><span id="local-6989586621683116548"><span class="annot"><span class="annottext">Maybe (XRec GhcPs [XRec GhcPs (IE GhcPs)])
</span><a href="#local-6989586621683116548"><span class="hs-identifier hs-var">export_ies</span></a></span></span><span> </span><span id="local-6989586621683116549"><span class="annot"><span class="annottext">[LImportDecl GhcPs]
</span><a href="#local-6989586621683116549"><span class="hs-identifier hs-var">import_decls</span></a></span></span><span> </span><span id="local-6989586621683116550"><span class="annot"><span class="annottext">[LHsDecl GhcPs]
</span><a href="#local-6989586621683116550"><span class="hs-identifier hs-var">local_decls</span></a></span></span><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">,</span><span>
</span><span id="line-250"></span><span>                   </span><span class="annot"><span class="annottext">hpm_src_files :: HsParsedModule -&gt; [String]
</span><a href="GHC.Hs.html#hpm_src_files"><span class="hs-identifier hs-var">hpm_src_files</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="local-6989586621683116552"><span class="annot"><span class="annottext">[String]
</span><a href="#local-6989586621683116552"><span class="hs-identifier hs-var">src_files</span></a></span></span><span>
</span><span id="line-251"></span><span>                </span><span class="hs-special">}</span><span class="hs-special">)</span><span>
</span><span id="line-252"></span><span>                </span><span class="hs-special">(</span><span id="local-6989586621683116553"><span class="annot"><span class="annottext">Module
</span><a href="#local-6989586621683116553"><span class="hs-identifier hs-var">this_mod</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621683116554"><span class="annot"><span class="annottext">SrcSpan
</span><a href="#local-6989586621683116554"><span class="hs-identifier hs-var">prel_imp_loc</span></a></span></span><span class="hs-special">)</span><span>
</span><span id="line-253"></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">SrcSpan -&gt; TcM TcGblEnv -&gt; TcM TcGblEnv
forall a. SrcSpan -&gt; TcRn a -&gt; TcRn a
</span><a href="GHC.Tc.Utils.Monad.html#setSrcSpan"><span class="hs-identifier hs-var">setSrcSpan</span></a></span><span> </span><span class="annot"><span class="annottext">SrcSpan
</span><a href="#local-6989586621683116542"><span class="hs-identifier hs-var">loc</span></a></span><span> </span><span class="annot"><span class="annottext">(TcM TcGblEnv -&gt; TcM TcGblEnv) -&gt; TcM TcGblEnv -&gt; TcM TcGblEnv
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-254"></span><span>   </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span class="hs-keyword">let</span><span> </span><span class="hs-special">{</span><span> </span><span id="local-6989586621683116556"><span class="annot"><span class="annottext">explicit_mod_hdr :: Bool
</span><a href="#local-6989586621683116556"><span class="hs-identifier hs-var hs-var hs-var">explicit_mod_hdr</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Maybe (GenLocated SrcSpanAnnA ModuleName) -&gt; Bool
forall a. Maybe a -&gt; Bool
</span><span class="hs-identifier hs-var">isJust</span></span><span> </span><span class="annot"><span class="annottext">Maybe (XRec GhcPs ModuleName)
Maybe (GenLocated SrcSpanAnnA ModuleName)
</span><a href="#local-6989586621683116547"><span class="hs-identifier hs-var">maybe_mod</span></a></span><span>
</span><span id="line-255"></span><span>            </span><span class="hs-special">;</span><span> </span><span id="local-6989586621683116558"><span class="annot"><span class="annottext">hsc_src :: HscSource
</span><a href="#local-6989586621683116558"><span class="hs-identifier hs-var hs-var hs-var">hsc_src</span></a></span></span><span>          </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ModSummary -&gt; HscSource
</span><a href="GHC.Unit.Module.ModSummary.html#ms_hsc_src"><span class="hs-identifier hs-var">ms_hsc_src</span></a></span><span> </span><span class="annot"><span class="annottext">ModSummary
</span><a href="#local-6989586621683116541"><span class="hs-identifier hs-var">mod_sum</span></a></span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-256"></span><span>      </span><span class="hs-special">;</span><span> </span><span class="hs-comment">-- Load the hi-boot interface for this module, if any</span><span>
</span><span id="line-257"></span><span>        </span><span class="hs-comment">-- We do this now so that the boot_names can be passed</span><span>
</span><span id="line-258"></span><span>        </span><span class="hs-comment">-- to tcTyAndClassDecls, because the boot_names are</span><span>
</span><span id="line-259"></span><span>        </span><span class="hs-comment">-- automatically considered to be loop breakers</span><span>
</span><span id="line-260"></span><span>        </span><span id="local-6989586621683116559"><span class="annot"><a href="#local-6989586621683116559"><span class="hs-identifier hs-var">tcg_env</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">TcM TcGblEnv
forall gbl lcl. TcRnIf gbl lcl gbl
</span><a href="GHC.Tc.Utils.Monad.html#getGblEnv"><span class="hs-identifier hs-var">getGblEnv</span></a></span><span>
</span><span id="line-261"></span><span>      </span><span class="hs-special">;</span><span> </span><span id="local-6989586621683116561"><span class="annot"><a href="#local-6989586621683116561"><span class="hs-identifier hs-var">boot_info</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><a href="GHC.IfaceToCore.html#tcHiBootIface"><span class="hs-identifier hs-type">tcHiBootIface</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683116558"><span class="hs-identifier hs-type">hsc_src</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683116553"><span class="hs-identifier hs-type">this_mod</span></a></span><span>
</span><span id="line-262"></span><span>      </span><span class="hs-special">;</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.Monad.html#setGblEnv"><span class="hs-identifier hs-type">setGblEnv</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621683116559"><span class="hs-identifier hs-type">tcg_env</span></a></span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#tcg_self_boot"><span class="hs-identifier hs-var">tcg_self_boot</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="#local-6989586621683116561"><span class="hs-identifier hs-type">boot_info</span></a></span><span> </span><span class="hs-special">}</span><span class="hs-special">)</span><span>
</span><span id="line-263"></span><span>        </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-264"></span><span>        </span><span class="hs-special">{</span><span> </span><span class="hs-comment">-- Deal with imports; first add implicit prelude</span><span>
</span><span id="line-265"></span><span>          </span><span id="local-6989586621683116565"><span class="annot"><a href="#local-6989586621683116565"><span class="hs-identifier hs-var">implicit_prelude</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.Monad.html#xoptM"><span class="hs-identifier hs-type">xoptM</span></a></span><span> </span><span class="annot"><span class="hs-identifier hs-type">LangExt.ImplicitPrelude</span></span><span>
</span><span id="line-266"></span><span>        </span><span class="hs-special">;</span><span> </span><span class="hs-keyword">let</span><span> </span><span class="hs-special">{</span><span> </span><span id="local-6989586621683116568"><span class="annot"><a href="#local-6989586621683116568"><span class="hs-identifier hs-var hs-var">prel_imports</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ModuleName
-&gt; SrcSpan -&gt; Bool -&gt; [LImportDecl GhcPs] -&gt; [LImportDecl GhcPs]
</span><a href="GHC.Parser.Header.html#mkPrelImports"><span class="hs-identifier hs-var">mkPrelImports</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Module -&gt; ModuleName
forall unit. GenModule unit -&gt; ModuleName
</span><a href="GHC.Unit.Types.html#moduleName"><span class="hs-identifier hs-var">moduleName</span></a></span><span> </span><span class="annot"><span class="annottext">Module
</span><a href="#local-6989586621683116553"><span class="hs-identifier hs-var">this_mod</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">SrcSpan
</span><a href="#local-6989586621683116554"><span class="hs-identifier hs-var">prel_imp_loc</span></a></span><span>
</span><span id="line-267"></span><span>                               </span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621683116565"><span class="hs-identifier hs-var">implicit_prelude</span></a></span><span> </span><span class="annot"><span class="annottext">[LImportDecl GhcPs]
</span><a href="#local-6989586621683116549"><span class="hs-identifier hs-var">import_decls</span></a></span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-268"></span><span>
</span><span id="line-269"></span><span>        </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">when</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Utils.Misc.html#notNull"><span class="hs-identifier hs-type">notNull</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683116568"><span class="hs-identifier hs-type">prel_imports</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-270"></span><span>            </span><span class="annot"><a href="GHC.Tc.Utils.Monad.html#addDiagnostic"><span class="hs-identifier hs-type">addDiagnostic</span></a></span><span> </span><span class="annot"><a href="GHC.Tc.Errors.Types.html#TcRnImplicitImportOfPrelude"><span class="hs-identifier hs-type">TcRnImplicitImportOfPrelude</span></a></span><span>
</span><span id="line-271"></span><span>
</span><span id="line-272"></span><span>        </span><span class="hs-special">;</span><span> </span><span class="hs-comment">-- TODO This is a little skeevy; maybe handle a bit more directly</span><span>
</span><span id="line-273"></span><span>          </span><span class="hs-keyword">let</span><span> </span><span class="hs-special">{</span><span> </span><span id="local-6989586621683116574"><span class="annot"><a href="#local-6989586621683116574"><span class="hs-identifier hs-var hs-var">simplifyImport</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Types.SrcLoc.html#L"><span class="hs-identifier hs-type">L</span></a></span><span> </span><span class="annot"><span class="annottext">SrcSpanAnnA
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621683116575"><span class="annot"><span class="annottext">ImportDecl GhcPs
</span><a href="#local-6989586621683116575"><span class="hs-identifier hs-var">idecl</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-274"></span><span>                  </span><span class="hs-special">(</span><span> </span><span class="annot"><span class="annottext">UnitEnv -&gt; ModuleName -&gt; RawPkgQual -&gt; PkgQual
</span><a href="GHC.Rename.Names.html#renameRawPkgQual"><span class="hs-identifier hs-var">renameRawPkgQual</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">HscEnv -&gt; UnitEnv
</span><a href="GHC.Driver.Env.Types.html#hsc_unit_env"><span class="hs-identifier hs-var">hsc_unit_env</span></a></span><span> </span><span class="annot"><span class="annottext">HscEnv
</span><a href="#local-6989586621683116540"><span class="hs-identifier hs-var">hsc_env</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">GenLocated SrcSpanAnnA ModuleName -&gt; ModuleName
forall l e. GenLocated l e -&gt; e
</span><a href="GHC.Types.SrcLoc.html#unLoc"><span class="hs-identifier hs-var">unLoc</span></a></span><span> </span><span class="annot"><span class="annottext">(GenLocated SrcSpanAnnA ModuleName -&gt; ModuleName)
-&gt; GenLocated SrcSpanAnnA ModuleName -&gt; ModuleName
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">ImportDecl GhcPs -&gt; XRec GhcPs ModuleName
forall pass. ImportDecl pass -&gt; XRec pass ModuleName
</span><a href="Language.Haskell.Syntax.ImpExp.html#ideclName"><span class="hs-identifier hs-var">ideclName</span></a></span><span> </span><span class="annot"><span class="annottext">ImportDecl GhcPs
</span><a href="#local-6989586621683116575"><span class="hs-identifier hs-var">idecl</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ImportDecl GhcPs -&gt; ImportDeclPkgQual GhcPs
forall pass. ImportDecl pass -&gt; ImportDeclPkgQual pass
</span><a href="Language.Haskell.Syntax.ImpExp.html#ideclPkgQual"><span class="hs-identifier hs-var">ideclPkgQual</span></a></span><span> </span><span class="annot"><span class="annottext">ImportDecl GhcPs
</span><a href="#local-6989586621683116575"><span class="hs-identifier hs-var">idecl</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-275"></span><span>                  </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">GenLocated SrcSpanAnnA ModuleName -&gt; GenLocated SrcSpan ModuleName
forall a e b.
(HasLoc (GenLocated a e), HasAnnotation b) =&gt;
GenLocated a e -&gt; GenLocated b e
</span><a href="GHC.Parser.Annotation.html#reLoc"><span class="hs-identifier hs-var">reLoc</span></a></span><span> </span><span class="annot"><span class="annottext">(GenLocated SrcSpanAnnA ModuleName
 -&gt; GenLocated SrcSpan ModuleName)
-&gt; GenLocated SrcSpanAnnA ModuleName
-&gt; GenLocated SrcSpan ModuleName
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">ImportDecl GhcPs -&gt; XRec GhcPs ModuleName
forall pass. ImportDecl pass -&gt; XRec pass ModuleName
</span><a href="Language.Haskell.Syntax.ImpExp.html#ideclName"><span class="hs-identifier hs-var">ideclName</span></a></span><span> </span><span class="annot"><span class="annottext">ImportDecl GhcPs
</span><a href="#local-6989586621683116575"><span class="hs-identifier hs-var">idecl</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-276"></span><span>              </span><span class="hs-special">}</span><span>
</span><span id="line-277"></span><span>        </span><span class="hs-special">;</span><span> </span><span id="local-6989586621683116582"><span class="annot"><a href="#local-6989586621683116582"><span class="hs-identifier hs-var">raw_sig_imports</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="hs-identifier hs-type">liftIO</span></span><span>
</span><span id="line-278"></span><span>                             </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="annot"><a href="GHC.Tc.Utils.Backpack.html#findExtraSigImports"><span class="hs-identifier hs-type">findExtraSigImports</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683116540"><span class="hs-identifier hs-type">hsc_env</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683116558"><span class="hs-identifier hs-type">hsc_src</span></a></span><span>
</span><span id="line-279"></span><span>                                 </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Unit.Types.html#moduleName"><span class="hs-identifier hs-var">moduleName</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683116553"><span class="hs-identifier hs-type">this_mod</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-280"></span><span>        </span><span class="hs-special">;</span><span> </span><span id="local-6989586621683116584"><span class="annot"><a href="#local-6989586621683116584"><span class="hs-identifier hs-var">raw_req_imports</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="hs-identifier hs-type">liftIO</span></span><span>
</span><span id="line-281"></span><span>                             </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="annot"><a href="GHC.Tc.Utils.Backpack.html#implicitRequirements"><span class="hs-identifier hs-type">implicitRequirements</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683116540"><span class="hs-identifier hs-type">hsc_env</span></a></span><span>
</span><span id="line-282"></span><span>                                </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">map</span></span><span> </span><span class="annot"><a href="#local-6989586621683116574"><span class="hs-identifier hs-type">simplifyImport</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621683116568"><span class="hs-identifier hs-type">prel_imports</span></a></span><span>
</span><span id="line-283"></span><span>                                                     </span><span class="annot"><span class="hs-operator hs-type">++</span></span><span> </span><span class="annot"><a href="#local-6989586621683116549"><span class="hs-identifier hs-type">import_decls</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-284"></span><span>        </span><span class="hs-special">;</span><span> </span><span class="hs-keyword">let</span><span> </span><span class="hs-special">{</span><span> </span><span id="local-6989586621683116597"><span class="annot"><a href="#local-6989586621683116597"><span class="hs-identifier hs-var hs-var">mkImport</span></a></span></span><span> </span><span id="local-6989586621683116598"><span class="annot"><span class="annottext">ModuleName
</span><a href="#local-6989586621683116598"><span class="hs-identifier hs-var">mod_name</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ImportDecl pass -&gt; GenLocated e (ImportDecl pass)
forall e a. HasAnnotation e =&gt; a -&gt; GenLocated e a
</span><a href="GHC.Parser.Annotation.html#noLocA"><span class="hs-identifier hs-var">noLocA</span></a></span><span>
</span><span id="line-285"></span><span>                </span><span class="annot"><span class="annottext">(ImportDecl pass -&gt; GenLocated e (ImportDecl pass))
-&gt; ImportDecl pass -&gt; GenLocated e (ImportDecl pass)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ModuleName -&gt; ImportDecl GhcPs
</span><a href="GHC.Hs.ImpExp.html#simpleImportDecl"><span class="hs-identifier hs-var">simpleImportDecl</span></a></span><span> </span><span class="annot"><span class="annottext">ModuleName
</span><a href="#local-6989586621683116598"><span class="hs-identifier hs-var">mod_name</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-286"></span><span>                  </span><span class="hs-special">{</span><span> </span><span class="annot"><a href="Language.Haskell.Syntax.ImpExp.html#ideclImportList"><span class="hs-identifier hs-var">ideclImportList</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Language.Haskell.Syntax.ImpExp.html#Exactly"><span class="hs-identifier hs-type">Exactly</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Parser.Annotation.html#noLocA"><span class="hs-identifier hs-type">noLocA</span></a></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span class="hs-special">)</span><span class="hs-special">}</span><span class="hs-special">}</span><span>
</span><span id="line-287"></span><span>        </span><span class="hs-special">;</span><span> </span><span class="hs-keyword">let</span><span> </span><span class="hs-special">{</span><span> </span><span id="local-6989586621683116608"><span class="annot"><a href="#local-6989586621683116608"><span class="hs-identifier hs-var hs-var">withReason</span></a></span></span><span> </span><span id="local-6989586621683116609"><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621683116609"><span class="hs-identifier hs-var">t</span></a></span></span><span> </span><span id="local-6989586621683116610"><span class="annot"><span class="annottext">[a]
</span><a href="#local-6989586621683116610"><span class="hs-identifier hs-var">imps</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(a -&gt; (a, t)) -&gt; [a] -&gt; [(a, t)]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><span class="hs-identifier hs-var">map</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">,</span><span class="annot"><span class="annottext">String -&gt; t
forall doc. IsLine doc =&gt; String -&gt; doc
</span><a href="GHC.Utils.Outputable.html#text"><span class="hs-identifier hs-var">text</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621683116609"><span class="hs-identifier hs-var">t</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[a]
</span><a href="#local-6989586621683116610"><span class="hs-identifier hs-var">imps</span></a></span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-288"></span><span>        </span><span class="hs-special">;</span><span> </span><span class="hs-keyword">let</span><span> </span><span class="hs-special">{</span><span> </span><span id="local-6989586621683116611"><span class="annot"><a href="#local-6989586621683116611"><span class="hs-identifier hs-var hs-var">all_imports</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">String
-&gt; [GenLocated SrcSpanAnnA (ImportDecl GhcPs)]
-&gt; [(GenLocated SrcSpanAnnA (ImportDecl GhcPs), SDoc)]
forall {t} {a}. IsLine t =&gt; String -&gt; [a] -&gt; [(a, t)]
</span><a href="#local-6989586621683116608"><span class="hs-identifier hs-var">withReason</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;is implicitly imported&quot;</span></span><span> </span><span class="annot"><span class="annottext">[LImportDecl GhcPs]
[GenLocated SrcSpanAnnA (ImportDecl GhcPs)]
</span><a href="#local-6989586621683116568"><span class="hs-identifier hs-var">prel_imports</span></a></span><span>
</span><span id="line-289"></span><span>                  </span><span class="annot"><span class="annottext">[(GenLocated SrcSpanAnnA (ImportDecl GhcPs), SDoc)]
-&gt; [(GenLocated SrcSpanAnnA (ImportDecl GhcPs), SDoc)]
-&gt; [(GenLocated SrcSpanAnnA (ImportDecl GhcPs), SDoc)]
forall a. [a] -&gt; [a] -&gt; [a]
</span><span class="hs-operator hs-var">++</span></span><span> </span><span class="annot"><span class="annottext">String
-&gt; [GenLocated SrcSpanAnnA (ImportDecl GhcPs)]
-&gt; [(GenLocated SrcSpanAnnA (ImportDecl GhcPs), SDoc)]
forall {t} {a}. IsLine t =&gt; String -&gt; [a] -&gt; [(a, t)]
</span><a href="#local-6989586621683116608"><span class="hs-identifier hs-var">withReason</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;is directly imported&quot;</span></span><span> </span><span class="annot"><span class="annottext">[LImportDecl GhcPs]
[GenLocated SrcSpanAnnA (ImportDecl GhcPs)]
</span><a href="#local-6989586621683116549"><span class="hs-identifier hs-var">import_decls</span></a></span><span>
</span><span id="line-290"></span><span>                  </span><span class="annot"><span class="annottext">[(GenLocated SrcSpanAnnA (ImportDecl GhcPs), SDoc)]
-&gt; [(GenLocated SrcSpanAnnA (ImportDecl GhcPs), SDoc)]
-&gt; [(GenLocated SrcSpanAnnA (ImportDecl GhcPs), SDoc)]
forall a. [a] -&gt; [a] -&gt; [a]
</span><span class="hs-operator hs-var">++</span></span><span> </span><span class="annot"><span class="annottext">String
-&gt; [GenLocated SrcSpanAnnA (ImportDecl GhcPs)]
-&gt; [(GenLocated SrcSpanAnnA (ImportDecl GhcPs), SDoc)]
forall {t} {a}. IsLine t =&gt; String -&gt; [a] -&gt; [(a, t)]
</span><a href="#local-6989586621683116608"><span class="hs-identifier hs-var">withReason</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;is an extra sig import&quot;</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(ModuleName -&gt; GenLocated SrcSpanAnnA (ImportDecl GhcPs))
-&gt; [ModuleName] -&gt; [GenLocated SrcSpanAnnA (ImportDecl GhcPs)]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><span class="hs-identifier hs-var">map</span></span><span> </span><span class="annot"><span class="annottext">ModuleName -&gt; GenLocated SrcSpanAnnA (ImportDecl GhcPs)
forall {pass} {e} {e}.
(XCImportDecl pass ~ XImportDeclPass,
 XRec pass [XRec pass (IE pass)]
 ~ GenLocated e [XRec pass (IE pass)],
 XRec pass ModuleName ~ GenLocated SrcSpanAnnA ModuleName,
 ImportDeclPkgQual pass ~ RawPkgQual, HasAnnotation e,
 HasAnnotation e) =&gt;
ModuleName -&gt; GenLocated e (ImportDecl pass)
</span><a href="#local-6989586621683116597"><span class="hs-identifier hs-var">mkImport</span></a></span><span> </span><span class="annot"><span class="annottext">[ModuleName]
</span><a href="#local-6989586621683116582"><span class="hs-identifier hs-var">raw_sig_imports</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-291"></span><span>                  </span><span class="annot"><span class="annottext">[(GenLocated SrcSpanAnnA (ImportDecl GhcPs), SDoc)]
-&gt; [(GenLocated SrcSpanAnnA (ImportDecl GhcPs), SDoc)]
-&gt; [(GenLocated SrcSpanAnnA (ImportDecl GhcPs), SDoc)]
forall a. [a] -&gt; [a] -&gt; [a]
</span><span class="hs-operator hs-var">++</span></span><span> </span><span class="annot"><span class="annottext">String
-&gt; [GenLocated SrcSpanAnnA (ImportDecl GhcPs)]
-&gt; [(GenLocated SrcSpanAnnA (ImportDecl GhcPs), SDoc)]
forall {t} {a}. IsLine t =&gt; String -&gt; [a] -&gt; [(a, t)]
</span><a href="#local-6989586621683116608"><span class="hs-identifier hs-var">withReason</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;is an implicit req import&quot;</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(ModuleName -&gt; GenLocated SrcSpanAnnA (ImportDecl GhcPs))
-&gt; [ModuleName] -&gt; [GenLocated SrcSpanAnnA (ImportDecl GhcPs)]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><span class="hs-identifier hs-var">map</span></span><span> </span><span class="annot"><span class="annottext">ModuleName -&gt; GenLocated SrcSpanAnnA (ImportDecl GhcPs)
forall {pass} {e} {e}.
(XCImportDecl pass ~ XImportDeclPass,
 XRec pass [XRec pass (IE pass)]
 ~ GenLocated e [XRec pass (IE pass)],
 XRec pass ModuleName ~ GenLocated SrcSpanAnnA ModuleName,
 ImportDeclPkgQual pass ~ RawPkgQual, HasAnnotation e,
 HasAnnotation e) =&gt;
ModuleName -&gt; GenLocated e (ImportDecl pass)
</span><a href="#local-6989586621683116597"><span class="hs-identifier hs-var">mkImport</span></a></span><span> </span><span class="annot"><span class="annottext">[ModuleName]
</span><a href="#local-6989586621683116584"><span class="hs-identifier hs-var">raw_req_imports</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-292"></span><span>        </span><span class="hs-special">;</span><span> </span><span class="hs-comment">-- OK now finally rename the imports</span><span>
</span><span id="line-293"></span><span>          </span><span class="hs-special">(</span><span id="local-6989586621683116612"><span class="annot"><a href="#local-6989586621683116612"><span class="hs-identifier hs-var">defaultImportsByClass</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621683116613"><span class="annot"><a href="#local-6989586621683116613"><span class="hs-identifier hs-var">tcg_env</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span>
</span><span id="line-294"></span><span>            </span><span class="hs-pragma">{-# SCC</span><span> </span><span class="hs-pragma">&quot;tcRnImports&quot;</span><span> </span><span class="hs-pragma">#-}</span><span> </span><span class="annot"><a href="GHC.Tc.Module.html#tcRnImports"><span class="hs-identifier hs-type">tcRnImports</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683116540"><span class="hs-identifier hs-type">hsc_env</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683116611"><span class="hs-identifier hs-type">all_imports</span></a></span><span>
</span><span id="line-295"></span><span>
</span><span id="line-296"></span><span>        </span><span class="hs-comment">-- Put a version of the header without identifier info into the tcg_env</span><span>
</span><span id="line-297"></span><span>        </span><span class="hs-comment">-- Make sure to do this before 'tcRnSrcDecls', because we need the</span><span>
</span><span id="line-298"></span><span>        </span><span class="hs-comment">-- module header when we're splicing TH, since it can be accessed via</span><span>
</span><span id="line-299"></span><span>        </span><span class="hs-comment">-- 'getDoc'.</span><span>
</span><span id="line-300"></span><span>        </span><span class="hs-comment">-- We will rename it properly after renaming everything else so that</span><span>
</span><span id="line-301"></span><span>        </span><span class="hs-comment">-- haddock can link the identifiers</span><span>
</span><span id="line-302"></span><span>        </span><span class="hs-special">;</span><span> </span><span id="local-6989586621683116615"><span class="annot"><a href="#local-6989586621683116615"><span class="hs-identifier hs-var">tcg_env</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="hs-identifier hs-type">return</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621683116613"><span class="hs-identifier hs-type">tcg_env</span></a></span><span>
</span><span id="line-303"></span><span>                              </span><span class="hs-special">{</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#tcg_hdr_info"><span class="hs-identifier hs-var">tcg_hdr_info</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">fmap</span></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span class="hs-special">(</span><span class="annot"><a href="GHC.Hs.Doc.html#WithHsDocIdentifiers"><span class="hs-identifier hs-type">WithHsDocIdentifiers</span></a></span><span> </span><span id="local-6989586621683116618"><span class="annot"><span class="annottext">HsDocString
</span><a href="#local-6989586621683116618"><span class="hs-identifier hs-var">str</span></a></span></span><span> </span><span class="annot"><span class="annottext">[Located (IdP GhcPs)]
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">HsDocString
-&gt; [Located (IdP (GhcPass 'Renamed))] -&gt; HsDoc (GhcPass 'Renamed)
forall a pass.
a -&gt; [Located (IdP pass)] -&gt; WithHsDocIdentifiers a pass
</span><a href="GHC.Hs.Doc.html#WithHsDocIdentifiers"><span class="hs-identifier hs-var">WithHsDocIdentifiers</span></a></span><span> </span><span class="annot"><span class="annottext">HsDocString
</span><a href="#local-6989586621683116618"><span class="hs-identifier hs-var">str</span></a></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span class="hs-special">)</span><span>
</span><span id="line-304"></span><span>                                                </span><span class="annot"><span class="hs-operator hs-type">&lt;$&gt;</span></span><span> </span><span class="annot"><a href="#local-6989586621683116546"><span class="hs-identifier hs-type">maybe_doc_hdr</span></a></span><span> </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="#local-6989586621683116547"><span class="hs-identifier hs-type">maybe_mod</span></a></span><span> </span><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span class="hs-special">)</span><span>
</span><span id="line-305"></span><span>        </span><span class="hs-special">;</span><span> </span><span class="hs-comment">-- If the whole module is warned about or deprecated</span><span>
</span><span id="line-306"></span><span>          </span><span class="hs-comment">-- (via mod_deprec) record that in tcg_warns. If we do thereby add</span><span>
</span><span id="line-307"></span><span>          </span><span class="hs-comment">-- a WarnAll, it will override any subsequent deprecations added to tcg_warns</span><span>
</span><span id="line-308"></span><span>        </span><span class="hs-special">;</span><span> </span><span id="local-6989586621683116620"><span class="annot"><a href="#local-6989586621683116620"><span class="hs-identifier hs-var">tcg_env1</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><a href="#local-6989586621683116545"><span class="hs-identifier hs-type">mod_deprec</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-309"></span><span>                             </span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Types.SrcLoc.html#L"><span class="hs-identifier hs-type">L</span></a></span><span> </span><span class="annot"><span class="annottext">SrcSpanAnnP
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621683116621"><span class="annot"><span class="annottext">WarningTxt GhcPs
</span><a href="#local-6989586621683116621"><span class="hs-identifier hs-var">txt</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span id="local-6989586621683116622"><span class="annot"><a href="#local-6989586621683116622"><span class="hs-identifier hs-var">txt'</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">WarningTxt GhcPs -&gt; RnM (WarningTxt (GhcPass 'Renamed))
</span><a href="GHC.Rename.Module.html#rnWarningTxt"><span class="hs-identifier hs-var">rnWarningTxt</span></a></span><span> </span><span class="annot"><span class="annottext">WarningTxt GhcPs
</span><a href="#local-6989586621683116621"><span class="hs-identifier hs-var">txt</span></a></span><span>
</span><span id="line-310"></span><span>                                                  </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">pure</span></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="annot"><a href="#local-6989586621683116615"><span class="hs-identifier hs-type">tcg_env</span></a></span><span> </span><span class="hs-special">{</span><span class="annot"><a href="GHC.Tc.Types.html#tcg_warns"><span class="hs-identifier hs-var">tcg_warns</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="GHC.Unit.Module.Warnings.html#WarnAll"><span class="hs-identifier hs-type">WarnAll</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683116622"><span class="hs-identifier hs-type">txt'</span></a></span><span class="hs-special">}</span><span>
</span><span id="line-311"></span><span>                                                  </span><span class="hs-special">}</span><span>
</span><span id="line-312"></span><span>                             </span><span class="annot"><span class="annottext">Maybe (LWarningTxt GhcPs)
</span><span class="hs-identifier hs-var">Nothing</span></span><span>            </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">TcGblEnv -&gt; TcM TcGblEnv
forall a. a -&gt; IOEnv (Env TcGblEnv TcLclEnv) a
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">pure</span></span><span> </span><span class="annot"><span class="annottext">TcGblEnv
</span><a href="#local-6989586621683116615"><span class="hs-identifier hs-var">tcg_env</span></a></span><span>
</span><span id="line-313"></span><span>        </span><span class="hs-special">;</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.Monad.html#setGblEnv"><span class="hs-identifier hs-type">setGblEnv</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683116620"><span class="hs-identifier hs-type">tcg_env1</span></a></span><span>
</span><span id="line-314"></span><span>          </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span class="hs-comment">-- Rename and type check the declarations</span><span>
</span><span id="line-315"></span><span>                 </span><span class="annot"><a href="GHC.Tc.Utils.Monad.html#traceRn"><span class="hs-identifier hs-type">traceRn</span></a></span><span> </span><span class="annot"><span class="hs-string">&quot;rn1a&quot;</span></span><span> </span><span class="annot"><a href="GHC.Utils.Outputable.html#empty"><span class="hs-identifier hs-type">empty</span></a></span><span>
</span><span id="line-316"></span><span>               </span><span class="hs-special">;</span><span> </span><span id="local-6989586621683116628"><span class="annot"><a href="#local-6989586621683116628"><span class="hs-identifier hs-var">tcg_env</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span>
</span><span id="line-317"></span><span>                   </span><span class="hs-keyword">case</span><span> </span><span class="annot"><a href="#local-6989586621683116558"><span class="hs-identifier hs-type">hsc_src</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-318"></span><span>                    </span><span class="annot"><a href="GHC.Types.SourceFile.html#HsBootOrSig"><span class="hs-identifier hs-type">HsBootOrSig</span></a></span><span> </span><span id="local-6989586621683116630"><span class="annot"><span class="annottext">HsBootOrSig
</span><a href="#local-6989586621683116630"><span class="hs-identifier hs-var">boot_or_sig</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-319"></span><span>                      </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span id="local-6989586621683116631"><span class="annot"><a href="#local-6989586621683116631"><span class="hs-identifier hs-var">tcg_env</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">HsBootOrSig -&gt; [LHsDecl GhcPs] -&gt; TcM TcGblEnv
</span><a href="GHC.Tc.Module.html#tcRnHsBootDecls"><span class="hs-identifier hs-var">tcRnHsBootDecls</span></a></span><span> </span><span class="annot"><span class="annottext">HsBootOrSig
</span><a href="#local-6989586621683116630"><span class="hs-identifier hs-var">boot_or_sig</span></a></span><span> </span><span class="annot"><span class="annottext">[LHsDecl GhcPs]
</span><a href="#local-6989586621683116550"><span class="hs-identifier hs-var">local_decls</span></a></span><span>
</span><span id="line-320"></span><span>                         </span><span class="hs-special">;</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.Monad.html#traceRn"><span class="hs-identifier hs-type">traceRn</span></a></span><span> </span><span class="annot"><span class="hs-string">&quot;rn4a: before exports&quot;</span></span><span> </span><span class="annot"><a href="GHC.Utils.Outputable.html#empty"><span class="hs-identifier hs-type">empty</span></a></span><span>
</span><span id="line-321"></span><span>                         </span><span class="hs-special">;</span><span> </span><span id="local-6989586621683116633"><span class="annot"><a href="#local-6989586621683116633"><span class="hs-identifier hs-var">tcg_env</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.Monad.html#setGblEnv"><span class="hs-identifier hs-type">setGblEnv</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683116631"><span class="hs-identifier hs-type">tcg_env</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span>
</span><span id="line-322"></span><span>                                      </span><span class="annot"><a href="GHC.Tc.Gen.Export.html#rnExports"><span class="hs-identifier hs-type">rnExports</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683116556"><span class="hs-identifier hs-type">explicit_mod_hdr</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683116548"><span class="hs-identifier hs-type">export_ies</span></a></span><span>
</span><span id="line-323"></span><span>                         </span><span class="hs-special">;</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.Monad.html#traceRn"><span class="hs-identifier hs-type">traceRn</span></a></span><span> </span><span class="annot"><span class="hs-string">&quot;rn4b: after exports&quot;</span></span><span> </span><span class="annot"><a href="GHC.Utils.Outputable.html#empty"><span class="hs-identifier hs-type">empty</span></a></span><span>
</span><span id="line-324"></span><span>                         </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">return</span></span><span> </span><span class="annot"><a href="#local-6989586621683116633"><span class="hs-identifier hs-type">tcg_env</span></a></span><span>
</span><span id="line-325"></span><span>                         </span><span class="hs-special">}</span><span>
</span><span id="line-326"></span><span>                    </span><span class="annot"><span class="annottext">HscSource
</span><a href="GHC.Types.SourceFile.html#HsSrcFile"><span class="hs-identifier hs-var">HsSrcFile</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-327"></span><span>                      </span><span class="hs-pragma">{-# SCC</span><span> </span><span class="hs-pragma">&quot;tcRnSrcDecls&quot;</span><span> </span><span class="hs-pragma">#-}</span><span>
</span><span id="line-328"></span><span>                        </span><span class="annot"><span class="annottext">Bool
-&gt; Maybe (GenLocated SrcSpanAnnLI [XRec GhcPs (IE GhcPs)])
-&gt; [LHsDecl GhcPs]
-&gt; TcM TcGblEnv
</span><a href="GHC.Tc.Module.html#tcRnSrcDecls"><span class="hs-identifier hs-var">tcRnSrcDecls</span></a></span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621683116556"><span class="hs-identifier hs-var">explicit_mod_hdr</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe (XRec GhcPs [XRec GhcPs (IE GhcPs)])
Maybe (GenLocated SrcSpanAnnLI [XRec GhcPs (IE GhcPs)])
</span><a href="#local-6989586621683116548"><span class="hs-identifier hs-var">export_ies</span></a></span><span> </span><span class="annot"><span class="annottext">[LHsDecl GhcPs]
</span><a href="#local-6989586621683116550"><span class="hs-identifier hs-var">local_decls</span></a></span><span>
</span><span id="line-329"></span><span>
</span><span id="line-330"></span><span>               </span><span class="hs-special">;</span><span> </span><span class="annot"><a href="GHC.Utils.Monad.html#whenM"><span class="hs-identifier hs-type">whenM</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Tc.Utils.Monad.html#goptM"><span class="hs-identifier hs-type">goptM</span></a></span><span> </span><span class="annot"><a href="GHC.Driver.Flags.html#Opt_DoCoreLinting"><span class="hs-identifier hs-type">Opt_DoCoreLinting</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span>
</span><span id="line-331"></span><span>                 </span><span class="annot"><a href="GHC.Tc.Types.html#lintGblEnv"><span class="hs-identifier hs-type">lintGblEnv</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Driver.Env.Types.html#hsc_logger"><span class="hs-identifier hs-var">hsc_logger</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683116540"><span class="hs-identifier hs-type">hsc_env</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Driver.Env.Types.html#hsc_dflags"><span class="hs-identifier hs-var">hsc_dflags</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683116540"><span class="hs-identifier hs-type">hsc_env</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><a href="#local-6989586621683116628"><span class="hs-identifier hs-type">tcg_env</span></a></span><span>
</span><span id="line-332"></span><span>
</span><span id="line-333"></span><span>               </span><span class="hs-special">;</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.Monad.html#setGblEnv"><span class="hs-identifier hs-type">setGblEnv</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683116628"><span class="hs-identifier hs-type">tcg_env</span></a></span><span>
</span><span id="line-334"></span><span>                 </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span class="hs-comment">-- Compare hi-boot iface (if any) with the real thing</span><span>
</span><span id="line-335"></span><span>                        </span><span class="hs-comment">-- Must be done after processing the exports</span><span>
</span><span id="line-336"></span><span>                        </span><span id="local-6989586621683116642"><span class="annot"><a href="#local-6989586621683116642"><span class="hs-identifier hs-var">tcg_env</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><a href="GHC.Tc.Module.html#checkHiBootIface"><span class="hs-identifier hs-type">checkHiBootIface</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683116628"><span class="hs-identifier hs-type">tcg_env</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683116561"><span class="hs-identifier hs-type">boot_info</span></a></span><span>
</span><span id="line-337"></span><span>                      </span><span class="hs-special">;</span><span> </span><span class="hs-comment">-- The new type env is already available to stuff</span><span>
</span><span id="line-338"></span><span>                        </span><span class="hs-comment">-- slurped from interface files, via</span><span>
</span><span id="line-339"></span><span>                        </span><span class="hs-comment">-- GHC.Tc.Utils.Env.setGlobalTypeEnv. It's important that this</span><span>
</span><span id="line-340"></span><span>                        </span><span class="hs-comment">-- includes the stuff in checkHiBootIface,</span><span>
</span><span id="line-341"></span><span>                        </span><span class="hs-comment">-- because the latter might add new bindings for</span><span>
</span><span id="line-342"></span><span>                        </span><span class="hs-comment">-- boot_dfuns, which may be mentioned in imported</span><span>
</span><span id="line-343"></span><span>                        </span><span class="hs-comment">-- unfoldings.</span><span>
</span><span id="line-344"></span><span>                      </span><span class="hs-special">;</span><span> </span><span class="hs-comment">-- Report unused names</span><span>
</span><span id="line-345"></span><span>                        </span><span class="hs-comment">-- Do this /after/ type inference, so that when reporting</span><span>
</span><span id="line-346"></span><span>                        </span><span class="hs-comment">-- a function with no type signature we can give the</span><span>
</span><span id="line-347"></span><span>                        </span><span class="hs-comment">-- inferred type</span><span>
</span><span id="line-348"></span><span>                      </span><span class="hs-special">;</span><span> </span><span class="annot"><a href="GHC.Rename.Names.html#reportUnusedNames"><span class="hs-identifier hs-type">reportUnusedNames</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683116642"><span class="hs-identifier hs-type">tcg_env</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683116558"><span class="hs-identifier hs-type">hsc_src</span></a></span><span>
</span><span id="line-349"></span><span>                      </span><span class="hs-special">;</span><span> </span><span class="annot"><a href="GHC.Tc.Module.html#reportClashingDefaultImports"><span class="hs-identifier hs-type">reportClashingDefaultImports</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683116612"><span class="hs-identifier hs-type">defaultImportsByClass</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Tc.Types.html#tcg_default"><span class="hs-identifier hs-var">tcg_default</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683116642"><span class="hs-identifier hs-type">tcg_env</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-350"></span><span>
</span><span id="line-351"></span><span>                      </span><span class="hs-comment">-- Rename the module header properly after we have renamed everything else</span><span>
</span><span id="line-352"></span><span>                      </span><span class="hs-special">;</span><span> </span><span id="local-6989586621683116647"><span class="annot"><a href="#local-6989586621683116647"><span class="hs-identifier hs-var">maybe_doc_hdr</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="hs-identifier hs-type">traverse</span></span><span> </span><span class="annot"><a href="GHC.Rename.Doc.html#rnLHsDoc"><span class="hs-identifier hs-type">rnLHsDoc</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683116546"><span class="hs-identifier hs-type">maybe_doc_hdr</span></a></span><span class="hs-special">;</span><span>
</span><span id="line-353"></span><span>                      </span><span class="hs-special">;</span><span> </span><span id="local-6989586621683116650"><span class="annot"><a href="#local-6989586621683116650"><span class="hs-identifier hs-var">tcg_env</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="hs-identifier hs-type">return</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621683116642"><span class="hs-identifier hs-type">tcg_env</span></a></span><span>
</span><span id="line-354"></span><span>                                            </span><span class="hs-special">{</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#tcg_hdr_info"><span class="hs-identifier hs-var">tcg_hdr_info</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621683116647"><span class="hs-identifier hs-type">maybe_doc_hdr</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="#local-6989586621683116547"><span class="hs-identifier hs-type">maybe_mod</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span class="hs-special">)</span><span>
</span><span id="line-355"></span><span>
</span><span id="line-356"></span><span>                      </span><span class="hs-special">;</span><span> </span><span class="hs-comment">-- add extra source files to tcg_dependent_files</span><span>
</span><span id="line-357"></span><span>                        </span><span class="annot"><a href="GHC.Tc.Utils.Monad.html#addDependentFiles"><span class="hs-identifier hs-type">addDependentFiles</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683116552"><span class="hs-identifier hs-type">src_files</span></a></span><span>
</span><span id="line-358"></span><span>                        </span><span class="hs-comment">-- Ensure plugins run with the same tcg_env that we pass in</span><span>
</span><span id="line-359"></span><span>                      </span><span class="hs-special">;</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.Monad.html#setGblEnv"><span class="hs-identifier hs-type">setGblEnv</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683116650"><span class="hs-identifier hs-type">tcg_env</span></a></span><span>
</span><span id="line-360"></span><span>                        </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span id="local-6989586621683116652"><span class="annot"><a href="#local-6989586621683116652"><span class="hs-identifier hs-var">tcg_env</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><a href="GHC.Tc.Module.html#runTypecheckerPlugin"><span class="hs-identifier hs-type">runTypecheckerPlugin</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683116541"><span class="hs-identifier hs-type">mod_sum</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683116650"><span class="hs-identifier hs-type">tcg_env</span></a></span><span>
</span><span id="line-361"></span><span>                             </span><span class="hs-special">;</span><span> </span><span class="hs-comment">-- Dump output and return</span><span>
</span><span id="line-362"></span><span>                               </span><span class="annot"><a href="GHC.Tc.Module.html#tcDump"><span class="hs-identifier hs-type">tcDump</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683116652"><span class="hs-identifier hs-type">tcg_env</span></a></span><span>
</span><span id="line-363"></span><span>                             </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">return</span></span><span> </span><span class="annot"><a href="#local-6989586621683116652"><span class="hs-identifier hs-type">tcg_env</span></a></span><span>
</span><span id="line-364"></span><span>                             </span><span class="hs-special">}</span><span>
</span><span id="line-365"></span><span>                      </span><span class="hs-special">}</span><span>
</span><span id="line-366"></span><span>               </span><span class="hs-special">}</span><span>
</span><span id="line-367"></span><span>        </span><span class="hs-special">}</span><span>
</span><span id="line-368"></span><span>      </span><span class="hs-special">}</span><span>
</span><span id="line-369"></span><span>
</span><span id="line-370"></span><span class="hs-comment">{- Note [Disambiguation of multiple default declarations]

See Note [Named default declarations] in GHC.Tc.Gen.Default

Only a single default declaration can be in effect in any single module for
any particular class.

* Two declarations for the same class explicitly declared in the same module
  are considered a static error.

* Definition: given two default declarations for the same class

  default C (Type_1a , &#8230; , Type_ma)
  default C (Type_1b , &#8230; , Type_nb)

  if the first type sequence Type_1a , &#8230; , Type_ma is a sub-sequence of the
  second sequence Type_1b , &#8230; , Type_nb (i.e., the former can be obtained by
  removing a number of Type_ib items from the latter), we say that the second
  declaration *subsumes* the first one.

* A default declaration in a module takes precedence over any imported default
  declarations for the same class. However the compiler warns the user if an
  imported declaration is not subsumed by the local declaration.

* For any two imported default declarations for the same class where one
  subsumes the other, we ignore the subsumed declaration.

* If a class has neither a local default declaration nor an imported default
  declaration that subsumes all other imported default declarations for the
  class, the conflict between the imports is unresolvable. The effect is to
  ignore all default declarations for the class, so that no declaration is in
  effect in the module. The compiler emits a warning in this case, but no
  error.
-}</span><span>
</span><span id="line-404"></span><span>
</span><span id="line-405"></span><span class="hs-comment">-- See Note [Disambiguation of multiple default declarations]</span><span>
</span><span id="line-406"></span><span class="hs-comment">-- | Warn about any imported default declaration that is not subsumed by either</span><span>
</span><span id="line-407"></span><span class="hs-comment">-- a local or an imported default declaration.</span><span>
</span><span id="line-408"></span><span class="annot"><a href="GHC.Tc.Module.html#reportClashingDefaultImports"><span class="hs-identifier hs-type">reportClashingDefaultImports</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><span class="annot"><span class="hs-identifier hs-type">NonEmpty</span></span><span> </span><span class="annot"><a href="GHC.Types.DefaultEnv.html#ClassDefaults"><span class="hs-identifier hs-type">ClassDefaults</span></a></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Types.DefaultEnv.html#DefaultEnv"><span class="hs-identifier hs-type">DefaultEnv</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#TcM"><span class="hs-identifier hs-type">TcM</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-409"></span><span id="reportClashingDefaultImports"><span class="annot"><span class="annottext">reportClashingDefaultImports :: [NonEmpty ClassDefaults]
-&gt; DefaultEnv -&gt; IOEnv (Env TcGblEnv TcLclEnv) ()
</span><a href="GHC.Tc.Module.html#reportClashingDefaultImports"><span class="hs-identifier hs-var hs-var">reportClashingDefaultImports</span></a></span></span><span> </span><span id="local-6989586621683116655"><span class="annot"><span class="annottext">[NonEmpty ClassDefaults]
</span><a href="#local-6989586621683116655"><span class="hs-identifier hs-var">importsByClass</span></a></span></span><span> </span><span id="local-6989586621683116656"><span class="annot"><span class="annottext">DefaultEnv
</span><a href="#local-6989586621683116656"><span class="hs-identifier hs-var">local</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(NonEmpty ClassDefaults -&gt; IOEnv (Env TcGblEnv TcLclEnv) ())
-&gt; [NonEmpty ClassDefaults] -&gt; IOEnv (Env TcGblEnv TcLclEnv) ()
forall (t :: * -&gt; *) (m :: * -&gt; *) a b.
(Foldable t, Monad m) =&gt;
(a -&gt; m b) -&gt; t a -&gt; m ()
</span><span class="hs-identifier hs-var">mapM_</span></span><span> </span><span class="annot"><span class="annottext">NonEmpty ClassDefaults -&gt; IOEnv (Env TcGblEnv TcLclEnv) ()
</span><a href="#local-6989586621683116658"><span class="hs-identifier hs-var">check</span></a></span><span> </span><span class="annot"><span class="annottext">[NonEmpty ClassDefaults]
</span><a href="#local-6989586621683116655"><span class="hs-identifier hs-var">importsByClass</span></a></span><span>
</span><span id="line-410"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-411"></span><span>    </span><span id="local-6989586621683116658"><span class="annot"><span class="annottext">check :: NonEmpty ClassDefaults -&gt; IOEnv (Env TcGblEnv TcLclEnv) ()
</span><a href="#local-6989586621683116658"><span class="hs-identifier hs-var hs-var">check</span></a></span></span><span> </span><span id="local-6989586621683116659"><span class="annot"><span class="annottext">cds :: NonEmpty ClassDefaults
</span><a href="#local-6989586621683116659"><span class="hs-identifier hs-var">cds</span></a></span></span><span class="hs-glyph">@</span><span class="hs-special">(</span><span class="annot"><a href="GHC.Types.DefaultEnv.html#ClassDefaults"><span class="hs-identifier hs-type">ClassDefaults</span></a></span><span class="hs-special">{</span><span class="annot"><span class="annottext">cd_class :: ClassDefaults -&gt; TyCon
</span><a href="GHC.Types.DefaultEnv.html#cd_class"><span class="hs-identifier hs-var">cd_class</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="local-6989586621683116660"><span class="annot"><span class="annottext">TyCon
</span><a href="#local-6989586621683116660"><span class="hs-identifier hs-var">cls</span></a></span></span><span class="hs-special">}</span><span> </span><span class="annot"><span class="hs-operator hs-type">:|</span></span><span> </span><span class="annot"><span class="annottext">[ClassDefaults]
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-412"></span><span>      </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621683116662"><span class="annot"><span class="annottext">cdLocal :: Maybe ClassDefaults
</span><a href="#local-6989586621683116662"><span class="hs-identifier hs-var hs-var">cdLocal</span></a></span></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">DefaultEnv -&gt; Name -&gt; Maybe ClassDefaults
</span><a href="GHC.Types.DefaultEnv.html#lookupDefaultEnv"><span class="hs-identifier hs-var">lookupDefaultEnv</span></a></span><span> </span><span class="annot"><span class="annottext">DefaultEnv
</span><a href="#local-6989586621683116656"><span class="hs-identifier hs-var">local</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TyCon -&gt; Name
</span><a href="GHC.Core.TyCon.html#tyConName"><span class="hs-identifier hs-var">tyConName</span></a></span><span> </span><span class="annot"><span class="annottext">TyCon
</span><a href="#local-6989586621683116660"><span class="hs-identifier hs-var">cls</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-413"></span><span>      </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">Maybe ClassDefaults
</span><a href="#local-6989586621683116662"><span class="hs-identifier hs-var">cdLocal</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-414"></span><span>        </span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span class="annot"><a href="GHC.Types.DefaultEnv.html#ClassDefaults"><span class="hs-identifier hs-type">ClassDefaults</span></a></span><span class="hs-special">{</span><span class="annot"><span class="annottext">cd_types :: ClassDefaults -&gt; [Type]
</span><a href="GHC.Types.DefaultEnv.html#cd_types"><span class="hs-identifier hs-var">cd_types</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="local-6989586621683116664"><span class="annot"><span class="annottext">[Type]
</span><a href="#local-6989586621683116664"><span class="hs-identifier hs-var">localTypes</span></a></span></span><span class="hs-special">}</span><span>
</span><span id="line-415"></span><span>          </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">(ClassDefaults -&gt; Bool) -&gt; NonEmpty ClassDefaults -&gt; Bool
forall (t :: * -&gt; *) a. Foldable t =&gt; (a -&gt; Bool) -&gt; t a -&gt; Bool
</span><span class="hs-identifier hs-var">all</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">(</span><span class="annot"><span class="annottext">[Type] -&gt; [Type] -&gt; Bool
</span><a href="GHC.Tc.Module.html#isTypeSubsequenceOf"><span class="hs-operator hs-var">`isTypeSubsequenceOf`</span></a></span><span> </span><span class="annot"><span class="annottext">[Type]
</span><a href="#local-6989586621683116664"><span class="hs-identifier hs-var">localTypes</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">([Type] -&gt; Bool)
-&gt; (ClassDefaults -&gt; [Type]) -&gt; ClassDefaults -&gt; Bool
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">ClassDefaults -&gt; [Type]
</span><a href="GHC.Types.DefaultEnv.html#cd_types"><span class="hs-identifier hs-var">cd_types</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">NonEmpty ClassDefaults
</span><a href="#local-6989586621683116659"><span class="hs-identifier hs-var">cds</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">() -&gt; IOEnv (Env TcGblEnv TcLclEnv) ()
forall a. a -&gt; IOEnv (Env TcGblEnv TcLclEnv) a
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">pure</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-416"></span><span>        </span><span class="annot"><span class="annottext">Maybe ClassDefaults
</span><span class="hs-identifier hs-var">Nothing</span></span><span>
</span><span id="line-417"></span><span>          </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Bool
</span><span class="hs-identifier hs-var">not</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">DefaultEnv -&gt; Bool
</span><a href="GHC.Types.DefaultEnv.html#isEmptyDefaultEnv"><span class="hs-identifier hs-var">isEmptyDefaultEnv</span></a></span><span> </span><span class="annot"><span class="annottext">(DefaultEnv -&gt; Bool) -&gt; DefaultEnv -&gt; Bool
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">NonEmpty ClassDefaults -&gt; DefaultEnv
</span><a href="GHC.Tc.Module.html#subsume"><span class="hs-identifier hs-var">subsume</span></a></span><span> </span><span class="annot"><span class="annottext">NonEmpty ClassDefaults
</span><a href="#local-6989586621683116659"><span class="hs-identifier hs-var">cds</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">() -&gt; IOEnv (Env TcGblEnv TcLclEnv) ()
forall a. a -&gt; IOEnv (Env TcGblEnv TcLclEnv) a
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">pure</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-418"></span><span>        </span><span class="annot"><span class="annottext">Maybe ClassDefaults
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-419"></span><span>          </span><span id="local-6989586621683116670"><span class="annot"><a href="#local-6989586621683116670"><span class="hs-identifier hs-var">warn_default</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">WarningFlag -&gt; TcRnIf TcGblEnv TcLclEnv Bool
forall gbl lcl. WarningFlag -&gt; TcRnIf gbl lcl Bool
</span><a href="GHC.Tc.Utils.Monad.html#woptM"><span class="hs-identifier hs-var">woptM</span></a></span><span> </span><span class="annot"><span class="annottext">WarningFlag
</span><a href="GHC.Driver.Flags.html#Opt_WarnTypeDefaults"><span class="hs-identifier hs-var">Opt_WarnTypeDefaults</span></a></span><span>
</span><span id="line-420"></span><span>          </span><span class="annot"><a href="GHC.Tc.Utils.Monad.html#diagnosticTc"><span class="hs-identifier hs-type">diagnosticTc</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683116670"><span class="hs-identifier hs-type">warn_default</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span>
</span><span id="line-421"></span><span>            </span><span class="annot"><a href="GHC.Tc.Errors.Types.html#TcRnWarnClashingDefaultImports"><span class="hs-identifier hs-type">TcRnWarnClashingDefaultImports</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683116660"><span class="hs-identifier hs-type">cls</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Types.DefaultEnv.html#cd_types"><span class="hs-identifier hs-var">cd_types</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">&lt;$&gt;</span></span><span> </span><span class="annot"><a href="#local-6989586621683116662"><span class="hs-identifier hs-type">cdLocal</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><a href="#local-6989586621683116659"><span class="hs-identifier hs-type">cds</span></a></span><span>
</span><span id="line-422"></span><span>
</span><span id="line-423"></span><span class="hs-comment">-- | Collapse a non-empty list of @default@ declarations for the same class to</span><span>
</span><span id="line-424"></span><span class="hs-comment">-- the single declaration among them that subsumes all others, or to no</span><span>
</span><span id="line-425"></span><span class="hs-comment">-- declaration otherwise.</span><span>
</span><span id="line-426"></span><span class="annot"><a href="GHC.Tc.Module.html#subsume"><span class="hs-identifier hs-type">subsume</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">NonEmpty</span></span><span> </span><span class="annot"><a href="GHC.Types.DefaultEnv.html#ClassDefaults"><span class="hs-identifier hs-type">ClassDefaults</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Types.DefaultEnv.html#DefaultEnv"><span class="hs-identifier hs-type">DefaultEnv</span></a></span><span>
</span><span id="line-427"></span><span id="subsume"><span class="annot"><span class="annottext">subsume :: NonEmpty ClassDefaults -&gt; DefaultEnv
</span><a href="GHC.Tc.Module.html#subsume"><span class="hs-identifier hs-var hs-var">subsume</span></a></span></span><span> </span><span class="hs-special">(</span><span id="local-6989586621683116675"><span class="annot"><span class="annottext">ClassDefaults
</span><a href="#local-6989586621683116675"><span class="hs-identifier hs-var">deft</span></a></span></span><span> </span><span class="annot"><span class="hs-operator hs-type">:|</span></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ClassDefaults -&gt; DefaultEnv
</span><a href="GHC.Types.DefaultEnv.html#unitDefaultEnv"><span class="hs-identifier hs-var">unitDefaultEnv</span></a></span><span> </span><span class="annot"><span class="annottext">ClassDefaults
</span><a href="#local-6989586621683116675"><span class="hs-identifier hs-var">deft</span></a></span><span>
</span><span id="line-428"></span><span class="annot"><a href="GHC.Tc.Module.html#subsume"><span class="hs-identifier hs-var">subsume</span></a></span><span> </span><span class="hs-special">(</span><span id="local-6989586621683116676"><span class="annot"><span class="annottext">ClassDefaults
</span><a href="#local-6989586621683116676"><span class="hs-identifier hs-var">deft</span></a></span></span><span> </span><span class="annot"><span class="hs-operator hs-type">:|</span></span><span> </span><span id="local-6989586621683116677"><span class="annot"><span class="annottext">ClassDefaults
</span><a href="#local-6989586621683116677"><span class="hs-identifier hs-var">deft'</span></a></span></span><span> </span><span class="annot"><span class="hs-glyph hs-type">:</span></span><span> </span><span id="local-6989586621683116678"><span class="annot"><span class="annottext">[ClassDefaults]
</span><a href="#local-6989586621683116678"><span class="hs-identifier hs-var">defts</span></a></span></span><span class="hs-special">)</span><span>
</span><span id="line-429"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">ClassDefaults -&gt; [Type]
</span><a href="GHC.Types.DefaultEnv.html#cd_types"><span class="hs-identifier hs-var">cd_types</span></a></span><span> </span><span class="annot"><span class="annottext">ClassDefaults
</span><a href="#local-6989586621683116676"><span class="hs-identifier hs-var">deft</span></a></span><span>  </span><span class="annot"><span class="annottext">[Type] -&gt; [Type] -&gt; Bool
</span><a href="GHC.Tc.Module.html#isTypeSubsequenceOf"><span class="hs-operator hs-var">`isTypeSubsequenceOf`</span></a></span><span> </span><span class="annot"><span class="annottext">ClassDefaults -&gt; [Type]
</span><a href="GHC.Types.DefaultEnv.html#cd_types"><span class="hs-identifier hs-var">cd_types</span></a></span><span> </span><span class="annot"><span class="annottext">ClassDefaults
</span><a href="#local-6989586621683116677"><span class="hs-identifier hs-var">deft'</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">NonEmpty ClassDefaults -&gt; DefaultEnv
</span><a href="GHC.Tc.Module.html#subsume"><span class="hs-identifier hs-var">subsume</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ClassDefaults
</span><a href="#local-6989586621683116677"><span class="hs-identifier hs-var">deft'</span></a></span><span> </span><span class="annot"><span class="annottext">ClassDefaults -&gt; [ClassDefaults] -&gt; NonEmpty ClassDefaults
forall a. a -&gt; [a] -&gt; NonEmpty a
</span><span class="hs-operator hs-var">:|</span></span><span> </span><span class="annot"><span class="annottext">[ClassDefaults]
</span><a href="#local-6989586621683116678"><span class="hs-identifier hs-var">defts</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-430"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">ClassDefaults -&gt; [Type]
</span><a href="GHC.Types.DefaultEnv.html#cd_types"><span class="hs-identifier hs-var">cd_types</span></a></span><span> </span><span class="annot"><span class="annottext">ClassDefaults
</span><a href="#local-6989586621683116677"><span class="hs-identifier hs-var">deft'</span></a></span><span> </span><span class="annot"><span class="annottext">[Type] -&gt; [Type] -&gt; Bool
</span><a href="GHC.Tc.Module.html#isTypeSubsequenceOf"><span class="hs-operator hs-var">`isTypeSubsequenceOf`</span></a></span><span> </span><span class="annot"><span class="annottext">ClassDefaults -&gt; [Type]
</span><a href="GHC.Types.DefaultEnv.html#cd_types"><span class="hs-identifier hs-var">cd_types</span></a></span><span> </span><span class="annot"><span class="annottext">ClassDefaults
</span><a href="#local-6989586621683116676"><span class="hs-identifier hs-var">deft</span></a></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">NonEmpty ClassDefaults -&gt; DefaultEnv
</span><a href="GHC.Tc.Module.html#subsume"><span class="hs-identifier hs-var">subsume</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ClassDefaults
</span><a href="#local-6989586621683116676"><span class="hs-identifier hs-var">deft</span></a></span><span>  </span><span class="annot"><span class="annottext">ClassDefaults -&gt; [ClassDefaults] -&gt; NonEmpty ClassDefaults
forall a. a -&gt; [a] -&gt; NonEmpty a
</span><span class="hs-operator hs-var">:|</span></span><span> </span><span class="annot"><span class="annottext">[ClassDefaults]
</span><a href="#local-6989586621683116678"><span class="hs-identifier hs-var">defts</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-431"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">otherwise</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">DefaultEnv
</span><a href="GHC.Types.DefaultEnv.html#emptyDefaultEnv"><span class="hs-identifier hs-var">emptyDefaultEnv</span></a></span><span>
</span><span id="line-432"></span><span>
</span><span id="line-433"></span><span class="annot"><a href="GHC.Tc.Module.html#isTypeSubsequenceOf"><span class="hs-identifier hs-type">isTypeSubsequenceOf</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#Type"><span class="hs-identifier hs-type">Type</span></a></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#Type"><span class="hs-identifier hs-type">Type</span></a></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Bool</span></span><span>
</span><span id="line-434"></span><span id="isTypeSubsequenceOf"><span class="annot"><span class="annottext">isTypeSubsequenceOf :: [Type] -&gt; [Type] -&gt; Bool
</span><a href="GHC.Tc.Module.html#isTypeSubsequenceOf"><span class="hs-identifier hs-var hs-var">isTypeSubsequenceOf</span></a></span></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><span class="annot"><span class="annottext">[Type]
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">True</span></span><span>
</span><span id="line-435"></span><span class="annot"><a href="GHC.Tc.Module.html#isTypeSubsequenceOf"><span class="hs-identifier hs-var">isTypeSubsequenceOf</span></a></span><span> </span><span class="annot"><span class="annottext">[Type]
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">False</span></span><span>
</span><span id="line-436"></span><span class="annot"><a href="GHC.Tc.Module.html#isTypeSubsequenceOf"><span class="hs-identifier hs-var">isTypeSubsequenceOf</span></a></span><span> </span><span class="hs-special">(</span><span id="local-6989586621683116679"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621683116679"><span class="hs-identifier hs-var">t1</span></a></span></span><span class="annot"><span class="hs-glyph hs-type">:</span></span><span id="local-6989586621683116680"><span class="annot"><span class="annottext">[Type]
</span><a href="#local-6989586621683116680"><span class="hs-identifier hs-var">t1s</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span id="local-6989586621683116681"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621683116681"><span class="hs-identifier hs-var">t2</span></a></span></span><span class="annot"><span class="hs-glyph hs-type">:</span></span><span id="local-6989586621683116682"><span class="annot"><span class="annottext">[Type]
</span><a href="#local-6989586621683116682"><span class="hs-identifier hs-var">t2s</span></a></span></span><span class="hs-special">)</span><span>
</span><span id="line-437"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">HasDebugCallStack =&gt; Type -&gt; Type -&gt; Bool
Type -&gt; Type -&gt; Bool
</span><a href="GHC.Core.TyCo.Compare.html#tcEqType"><span class="hs-identifier hs-var">tcEqType</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621683116679"><span class="hs-identifier hs-var">t1</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621683116681"><span class="hs-identifier hs-var">t2</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[Type] -&gt; [Type] -&gt; Bool
</span><a href="GHC.Tc.Module.html#isTypeSubsequenceOf"><span class="hs-identifier hs-var">isTypeSubsequenceOf</span></a></span><span> </span><span class="annot"><span class="annottext">[Type]
</span><a href="#local-6989586621683116680"><span class="hs-identifier hs-var">t1s</span></a></span><span> </span><span class="annot"><span class="annottext">[Type]
</span><a href="#local-6989586621683116682"><span class="hs-identifier hs-var">t2s</span></a></span><span>
</span><span id="line-438"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">otherwise</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[Type] -&gt; [Type] -&gt; Bool
</span><a href="GHC.Tc.Module.html#isTypeSubsequenceOf"><span class="hs-identifier hs-var">isTypeSubsequenceOf</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621683116679"><span class="hs-identifier hs-var">t1</span></a></span><span class="annot"><span class="annottext">Type -&gt; [Type] -&gt; [Type]
forall a. a -&gt; [a] -&gt; [a]
</span><span class="hs-glyph hs-var">:</span></span><span class="annot"><span class="annottext">[Type]
</span><a href="#local-6989586621683116680"><span class="hs-identifier hs-var">t1s</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[Type]
</span><a href="#local-6989586621683116682"><span class="hs-identifier hs-var">t2s</span></a></span><span>
</span><span id="line-439"></span><span>
</span><span id="line-440"></span><span class="hs-comment">{-
************************************************************************
*                                                                      *
                Import declarations
*                                                                      *
************************************************************************
-}</span><span>
</span><span id="line-447"></span><span>
</span><span id="line-448"></span><span class="annot"><a href="GHC.Tc.Module.html#tcRnImports"><span class="hs-identifier hs-type">tcRnImports</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Driver.Env.Types.html#HscEnv"><span class="hs-identifier hs-type">HscEnv</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="hs-special">(</span><span class="annot"><a href="Language.Haskell.Syntax.ImpExp.html#LImportDecl"><span class="hs-identifier hs-type">LImportDecl</span></a></span><span> </span><span class="annot"><a href="GHC.Hs.Extension.html#GhcPs"><span class="hs-identifier hs-type">GhcPs</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Utils.Outputable.html#SDoc"><span class="hs-identifier hs-type">SDoc</span></a></span><span class="hs-special">)</span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#TcM"><span class="hs-identifier hs-type">TcM</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">[</span><span class="annot"><span class="hs-identifier hs-type">NonEmpty</span></span><span> </span><span class="annot"><a href="GHC.Types.DefaultEnv.html#ClassDefaults"><span class="hs-identifier hs-type">ClassDefaults</span></a></span><span class="hs-special">]</span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#TcGblEnv"><span class="hs-identifier hs-type">TcGblEnv</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-449"></span><span id="tcRnImports"><span class="annot"><span class="annottext">tcRnImports :: HscEnv
-&gt; [(LImportDecl GhcPs, SDoc)]
-&gt; TcM ([NonEmpty ClassDefaults], TcGblEnv)
</span><a href="GHC.Tc.Module.html#tcRnImports"><span class="hs-identifier hs-var hs-var">tcRnImports</span></a></span></span><span> </span><span id="local-6989586621683116684"><span class="annot"><span class="annottext">HscEnv
</span><a href="#local-6989586621683116684"><span class="hs-identifier hs-var">hsc_env</span></a></span></span><span> </span><span id="local-6989586621683116685"><span class="annot"><span class="annottext">[(LImportDecl GhcPs, SDoc)]
</span><a href="#local-6989586621683116685"><span class="hs-identifier hs-var">import_decls</span></a></span></span><span>
</span><span id="line-450"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>  </span><span class="hs-special">{</span><span> </span><span class="hs-special">(</span><span id="local-6989586621683116686"><span class="annot"><a href="#local-6989586621683116686"><span class="hs-identifier hs-var">rn_imports</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621683116687"><span class="annot"><a href="#local-6989586621683116687"><span class="hs-identifier hs-var">imp_user_spec</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621683116688"><span class="annot"><a href="#local-6989586621683116688"><span class="hs-identifier hs-var">rdr_env</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621683116689"><span class="annot"><a href="#local-6989586621683116689"><span class="hs-identifier hs-var">imports</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621683116690"><span class="annot"><a href="#local-6989586621683116690"><span class="hs-identifier hs-var">defaults</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621683116691"><span class="annot"><a href="#local-6989586621683116691"><span class="hs-identifier hs-var">hpc_info</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">[(LImportDecl GhcPs, SDoc)]
-&gt; RnM
     ([LImportDecl (GhcPass 'Renamed)], [ImportUserSpec], GlobalRdrEnv,
      ImportAvails, [(Module, IfaceDefault)], Bool)
</span><a href="GHC.Rename.Names.html#rnImports"><span class="hs-identifier hs-var">rnImports</span></a></span><span> </span><span class="annot"><span class="annottext">[(LImportDecl GhcPs, SDoc)]
</span><a href="#local-6989586621683116685"><span class="hs-identifier hs-var">import_decls</span></a></span><span> </span><span class="hs-special">;</span><span>
</span><span id="line-451"></span><span>
</span><span id="line-452"></span><span>        </span><span class="hs-special">;</span><span> </span><span id="local-6989586621683116693"><span class="annot"><a href="#local-6989586621683116693"><span class="hs-identifier hs-var">this_mod</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><a href="GHC.Unit.Module.html#getModule"><span class="hs-identifier hs-type">getModule</span></a></span><span>
</span><span id="line-453"></span><span>        </span><span class="hs-special">;</span><span> </span><span id="local-6989586621683116695"><span class="annot"><a href="#local-6989586621683116695"><span class="hs-identifier hs-var">gbl_env</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.Monad.html#getGblEnv"><span class="hs-identifier hs-type">getGblEnv</span></a></span><span>
</span><span id="line-454"></span><span>        </span><span class="hs-special">;</span><span> </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621683116696"><span class="annot"><a href="#local-6989586621683116696"><span class="hs-identifier hs-var hs-var">unitId</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">HomeUnit -&gt; UnitId
forall u. GenHomeUnit u -&gt; UnitId
</span><a href="GHC.Unit.Home.html#homeUnitId"><span class="hs-identifier hs-var">homeUnitId</span></a></span><span> </span><span class="annot"><span class="annottext">(HomeUnit -&gt; UnitId) -&gt; HomeUnit -&gt; UnitId
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">HscEnv -&gt; HomeUnit
</span><a href="GHC.Driver.Env.html#hsc_home_unit"><span class="hs-identifier hs-var">hsc_home_unit</span></a></span><span> </span><span class="annot"><span class="annottext">HscEnv
</span><a href="#local-6989586621683116684"><span class="hs-identifier hs-var">hsc_env</span></a></span><span>
</span><span id="line-455"></span><span>              </span><span id="local-6989586621683116698"><span class="annot"><a href="#local-6989586621683116698"><span class="hs-identifier hs-var hs-var">mnwib</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ModuleName -&gt; IsBootInterface -&gt; ModuleNameWithIsBoot
forall mod. mod -&gt; IsBootInterface -&gt; GenWithIsBoot mod
</span><a href="GHC.Unit.Types.html#GWIB"><span class="hs-identifier hs-var">GWIB</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Module -&gt; ModuleName
forall unit. GenModule unit -&gt; ModuleName
</span><a href="GHC.Unit.Types.html#moduleName"><span class="hs-identifier hs-var">moduleName</span></a></span><span> </span><span class="annot"><span class="annottext">Module
</span><a href="#local-6989586621683116693"><span class="hs-identifier hs-var">this_mod</span></a></span><span class="hs-special">)</span><span class="hs-special">(</span><span class="annot"><span class="annottext">HscSource -&gt; IsBootInterface
</span><a href="GHC.Types.SourceFile.html#hscSourceToIsBoot"><span class="hs-identifier hs-var">hscSourceToIsBoot</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TcGblEnv -&gt; HscSource
</span><a href="GHC.Tc.Types.html#tcg_src"><span class="hs-identifier hs-var">tcg_src</span></a></span><span> </span><span class="annot"><span class="annottext">TcGblEnv
</span><a href="#local-6989586621683116695"><span class="hs-identifier hs-var">gbl_env</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-456"></span><span>        </span><span class="hs-special">;</span><span> </span><span class="hs-keyword">let</span><span> </span><span class="hs-special">{</span><span> </span><span class="hs-comment">-- We want instance declarations from all home-package</span><span>
</span><span id="line-457"></span><span>                </span><span class="hs-comment">-- modules below this one, including boot modules, except</span><span>
</span><span id="line-458"></span><span>                </span><span class="hs-comment">-- ourselves.  The 'except ourselves' is so that we don't</span><span>
</span><span id="line-459"></span><span>                </span><span class="hs-comment">-- get the instances from this module's hs-boot file.  This</span><span>
</span><span id="line-460"></span><span>                </span><span class="hs-comment">-- filtering also ensures that we don't see instances from</span><span>
</span><span id="line-461"></span><span>                </span><span class="hs-comment">-- modules batch (@--make@) compiled before this one, but</span><span>
</span><span id="line-462"></span><span>                </span><span class="hs-comment">-- which are not below this one.</span><span>
</span><span id="line-463"></span><span>              </span><span class="hs-special">;</span><span> </span><span class="hs-special">(</span><span id="local-6989586621683116702"><span class="annot"><a href="#local-6989586621683116702"><span class="hs-identifier hs-var">home_insts</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621683116703"><span class="annot"><a href="#local-6989586621683116703"><span class="hs-identifier hs-var">home_fam_insts</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-464"></span><span>
</span><span id="line-465"></span><span>                    </span><span class="annot"><a href="GHC.Driver.Env.html#hptInstancesBelow"><span class="hs-identifier hs-type">hptInstancesBelow</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683116684"><span class="hs-identifier hs-type">hsc_env</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683116696"><span class="hs-identifier hs-type">unitId</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683116698"><span class="hs-identifier hs-type">mnwib</span></a></span><span>
</span><span id="line-466"></span><span>
</span><span id="line-467"></span><span>              </span><span class="hs-special">}</span><span> </span><span class="hs-special">;</span><span>
</span><span id="line-468"></span><span>
</span><span id="line-469"></span><span>                </span><span class="hs-comment">-- Record boot-file info in the EPS, so that it's</span><span>
</span><span id="line-470"></span><span>                </span><span class="hs-comment">-- visible to loadHiBootInterface in tcRnSrcDecls,</span><span>
</span><span id="line-471"></span><span>                </span><span class="hs-comment">-- and any other incrementally-performed imports</span><span>
</span><span id="line-472"></span><span>              </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">when</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Driver.DynFlags.html#isOneShot"><span class="hs-identifier hs-type">isOneShot</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Driver.DynFlags.html#ghcMode"><span class="hs-identifier hs-var">ghcMode</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Driver.Env.Types.html#hsc_dflags"><span class="hs-identifier hs-var">hsc_dflags</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683116684"><span class="hs-identifier hs-type">hsc_env</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span>
</span><span id="line-473"></span><span>                  </span><span class="annot"><a href="GHC.Tc.Utils.Monad.html#updateEps_"><span class="hs-identifier hs-type">updateEps_</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="hs-glyph">\</span><span id="local-6989586621683116708"><span class="annot"><span class="annottext">ExternalPackageState
</span><a href="#local-6989586621683116708"><span class="hs-identifier hs-var">eps</span></a></span></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">ExternalPackageState
</span><a href="#local-6989586621683116708"><span class="hs-identifier hs-var">eps</span></a></span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><a href="GHC.Unit.External.html#eps_is_boot"><span class="hs-identifier hs-var">eps_is_boot</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="GHC.Unit.Module.Deps.html#imp_boot_mods"><span class="hs-identifier hs-var">imp_boot_mods</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683116689"><span class="hs-identifier hs-type">imports</span></a></span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-474"></span><span>               </span><span class="hs-special">}</span><span>
</span><span id="line-475"></span><span>
</span><span id="line-476"></span><span>                </span><span class="hs-comment">-- Type check the imported default declarations</span><span>
</span><span id="line-477"></span><span>        </span><span class="hs-special">;</span><span> </span><span id="local-6989586621683116711"><span class="annot"><a href="#local-6989586621683116711"><span class="hs-identifier hs-var">tc_defaults</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.Monad.html#initIfaceTcRn"><span class="hs-identifier hs-type">initIfaceTcRn</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.IfaceToCore.html#tcIfaceDefaults"><span class="hs-identifier hs-type">tcIfaceDefaults</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683116693"><span class="hs-identifier hs-type">this_mod</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683116690"><span class="hs-identifier hs-type">defaults</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-478"></span><span>                </span><span class="hs-comment">-- Update the gbl env</span><span>
</span><span id="line-479"></span><span>        </span><span class="hs-special">;</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.Monad.html#updGblEnv"><span class="hs-identifier hs-type">updGblEnv</span></a></span><span> </span><span class="hs-special">(</span><span> </span><span class="hs-glyph">\</span><span> </span><span id="local-6989586621683116715"><span class="annot"><span class="annottext">TcGblEnv
</span><a href="#local-6989586621683116715"><span class="hs-identifier hs-var">gbl</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-480"></span><span>            </span><span class="annot"><span class="annottext">TcGblEnv
</span><a href="#local-6989586621683116715"><span class="hs-identifier hs-var">gbl</span></a></span><span> </span><span class="hs-special">{</span><span>
</span><span id="line-481"></span><span>              </span><span class="annot"><a href="GHC.Tc.Types.html#tcg_rdr_env"><span class="hs-identifier hs-var">tcg_rdr_env</span></a></span><span>      </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#tcg_rdr_env"><span class="hs-identifier hs-var">tcg_rdr_env</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683116715"><span class="hs-identifier hs-type">gbl</span></a></span><span> </span><span class="annot"><a href="GHC.Types.Name.Reader.html#plusGlobalRdrEnv"><span class="hs-operator hs-type">`plusGlobalRdrEnv`</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683116688"><span class="hs-identifier hs-type">rdr_env</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-482"></span><span>              </span><span class="annot"><a href="GHC.Tc.Types.html#tcg_imports"><span class="hs-identifier hs-var">tcg_imports</span></a></span><span>      </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#tcg_imports"><span class="hs-identifier hs-var">tcg_imports</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683116715"><span class="hs-identifier hs-type">gbl</span></a></span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#plusImportAvails"><span class="hs-operator hs-type">`plusImportAvails`</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683116689"><span class="hs-identifier hs-type">imports</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-483"></span><span>              </span><span class="annot"><a href="GHC.Tc.Types.html#tcg_import_decls"><span class="hs-identifier hs-var">tcg_import_decls</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="#local-6989586621683116687"><span class="hs-identifier hs-type">imp_user_spec</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-484"></span><span>              </span><span class="annot"><a href="GHC.Tc.Types.html#tcg_rn_imports"><span class="hs-identifier hs-var">tcg_rn_imports</span></a></span><span>   </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="#local-6989586621683116686"><span class="hs-identifier hs-type">rn_imports</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-485"></span><span>              </span><span class="annot"><a href="GHC.Tc.Types.html#tcg_default"><span class="hs-identifier hs-var">tcg_default</span></a></span><span>      </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="hs-identifier hs-type">foldMap</span></span><span> </span><span class="annot"><a href="GHC.Tc.Module.html#subsume"><span class="hs-identifier hs-type">subsume</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683116711"><span class="hs-identifier hs-type">tc_defaults</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-486"></span><span>              </span><span class="annot"><a href="GHC.Tc.Types.html#tcg_inst_env"><span class="hs-identifier hs-var">tcg_inst_env</span></a></span><span>     </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#tcg_inst_env"><span class="hs-identifier hs-var">tcg_inst_env</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683116715"><span class="hs-identifier hs-type">gbl</span></a></span><span> </span><span class="annot"><a href="GHC.Core.InstEnv.html#unionInstEnv"><span class="hs-operator hs-type">`unionInstEnv`</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683116702"><span class="hs-identifier hs-type">home_insts</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-487"></span><span>              </span><span class="annot"><a href="GHC.Tc.Types.html#tcg_fam_inst_env"><span class="hs-identifier hs-var">tcg_fam_inst_env</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="GHC.Core.FamInstEnv.html#extendFamInstEnvList"><span class="hs-identifier hs-type">extendFamInstEnvList</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Tc.Types.html#tcg_fam_inst_env"><span class="hs-identifier hs-var">tcg_fam_inst_env</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683116715"><span class="hs-identifier hs-type">gbl</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-488"></span><span>                                                      </span><span class="annot"><a href="#local-6989586621683116703"><span class="hs-identifier hs-type">home_fam_insts</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-489"></span><span>              </span><span class="annot"><a href="GHC.Tc.Types.html#tcg_hpc"><span class="hs-identifier hs-var">tcg_hpc</span></a></span><span>          </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="#local-6989586621683116691"><span class="hs-identifier hs-type">hpc_info</span></a></span><span>
</span><span id="line-490"></span><span>            </span><span class="hs-special">}</span><span class="hs-special">)</span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span>
</span><span id="line-491"></span><span>
</span><span id="line-492"></span><span>        </span><span class="hs-special">;</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.Monad.html#traceRn"><span class="hs-identifier hs-type">traceRn</span></a></span><span> </span><span class="annot"><span class="hs-string">&quot;rn1&quot;</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-type">ppr</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Unit.Module.Deps.html#imp_direct_dep_mods"><span class="hs-identifier hs-var">imp_direct_dep_mods</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683116689"><span class="hs-identifier hs-type">imports</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-493"></span><span>                </span><span class="hs-comment">-- Fail if there are any errors so far</span><span>
</span><span id="line-494"></span><span>                </span><span class="hs-comment">-- The error printing (if needed) takes advantage</span><span>
</span><span id="line-495"></span><span>                </span><span class="hs-comment">-- of the tcg_env we have now set</span><span>
</span><span id="line-496"></span><span class="hs-comment">--      ; traceIf (text &quot;rdr_env: &quot; &lt;+&gt; ppr rdr_env)</span><span>
</span><span id="line-497"></span><span>        </span><span class="hs-special">;</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.Monad.html#failIfErrsM"><span class="hs-identifier hs-type">failIfErrsM</span></a></span><span>
</span><span id="line-498"></span><span>
</span><span id="line-499"></span><span>                </span><span class="hs-comment">-- Load any orphan-module (including orphan family</span><span>
</span><span id="line-500"></span><span>                </span><span class="hs-comment">-- instance-module) interfaces, so that their rules and</span><span>
</span><span id="line-501"></span><span>                </span><span class="hs-comment">-- instance decls will be found.  But filter out a</span><span>
</span><span id="line-502"></span><span>                </span><span class="hs-comment">-- self hs-boot: these instances will be checked when</span><span>
</span><span id="line-503"></span><span>                </span><span class="hs-comment">-- we define them locally.</span><span>
</span><span id="line-504"></span><span>                </span><span class="hs-comment">-- (We don't need to load non-orphan family instance</span><span>
</span><span id="line-505"></span><span>                </span><span class="hs-comment">-- modules until we either try to use the instances they</span><span>
</span><span id="line-506"></span><span>                </span><span class="hs-comment">-- define, or define our own family instances, at which</span><span>
</span><span id="line-507"></span><span>                </span><span class="hs-comment">-- point we need to check them for consistency.)</span><span>
</span><span id="line-508"></span><span>        </span><span class="hs-special">;</span><span> </span><span class="annot"><a href="GHC.Iface.Load.html#loadModuleInterfaces"><span class="hs-identifier hs-type">loadModuleInterfaces</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Utils.Outputable.html#text"><span class="hs-identifier hs-type">text</span></a></span><span> </span><span class="annot"><span class="hs-string">&quot;Loading orphan modules&quot;</span></span><span class="hs-special">)</span><span>
</span><span id="line-509"></span><span>                               </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">filter</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-operator">/=</span></span><span> </span><span class="annot"><span class="hs-identifier">this_mod</span></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Unit.Module.Deps.html#imp_orphs"><span class="hs-identifier hs-var">imp_orphs</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683116689"><span class="hs-identifier hs-type">imports</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-510"></span><span>
</span><span id="line-511"></span><span>                </span><span class="hs-comment">-- Check type-family consistency between imports.</span><span>
</span><span id="line-512"></span><span>                </span><span class="hs-comment">-- See Note [The type family instance consistency story]</span><span>
</span><span id="line-513"></span><span>        </span><span class="hs-special">;</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.Monad.html#traceRn"><span class="hs-identifier hs-type">traceRn</span></a></span><span> </span><span class="annot"><span class="hs-string">&quot;rn1: checking family instance consistency {&quot;</span></span><span> </span><span class="annot"><a href="GHC.Utils.Outputable.html#empty"><span class="hs-identifier hs-type">empty</span></a></span><span>
</span><span id="line-514"></span><span>        </span><span class="hs-special">;</span><span> </span><span class="hs-keyword">let</span><span> </span><span class="hs-special">{</span><span> </span><span id="local-6989586621683116732"><span class="annot"><a href="#local-6989586621683116732"><span class="hs-identifier hs-var hs-var">dir_imp_mods</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Map Module [ImportedBy] -&gt; [Module]
forall k a. Map k a -&gt; [k]
</span><a href="../../containers-0.7-5a8f/src/Data.Map.Internal.html#keys"><span class="hs-identifier hs-var">M.keys</span></a></span><span>
</span><span id="line-515"></span><span>                             </span><span class="annot"><span class="annottext">(Map Module [ImportedBy] -&gt; [Module])
-&gt; (ImportAvails -&gt; Map Module [ImportedBy])
-&gt; ImportAvails
-&gt; [Module]
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">ImportAvails -&gt; Map Module [ImportedBy]
</span><a href="GHC.Unit.Module.Deps.html#imp_mods"><span class="hs-identifier hs-var">imp_mods</span></a></span><span>
</span><span id="line-516"></span><span>                             </span><span class="annot"><span class="annottext">(ImportAvails -&gt; [Module]) -&gt; ImportAvails -&gt; [Module]
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">ImportAvails
</span><a href="#local-6989586621683116689"><span class="hs-identifier hs-var">imports</span></a></span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-517"></span><span>        </span><span class="hs-special">;</span><span> </span><span id="local-6989586621683116735"><span class="annot"><a href="#local-6989586621683116735"><span class="hs-identifier hs-var">logger</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><a href="GHC.Utils.Logger.html#getLogger"><span class="hs-identifier hs-type">getLogger</span></a></span><span>
</span><span id="line-518"></span><span>        </span><span class="hs-special">;</span><span> </span><span class="annot"><a href="GHC.Utils.Error.html#withTiming"><span class="hs-identifier hs-type">withTiming</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683116735"><span class="hs-identifier hs-type">logger</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Utils.Outputable.html#text"><span class="hs-identifier hs-type">text</span></a></span><span> </span><span class="annot"><span class="hs-string">&quot;ConsistencyCheck&quot;</span></span><span class="annot"><a href="GHC.Utils.Outputable.html#%3C%2B%3E"><span class="hs-operator hs-type">&lt;+&gt;</span></a></span><span class="annot"><a href="GHC.Utils.Outputable.html#brackets"><span class="hs-identifier hs-type">brackets</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-type">ppr</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683116693"><span class="hs-identifier hs-type">this_mod</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">const</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-519"></span><span>            </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="annot"><a href="GHC.Tc.Instance.Family.html#checkFamInstConsistency"><span class="hs-identifier hs-type">checkFamInstConsistency</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683116732"><span class="hs-identifier hs-type">dir_imp_mods</span></a></span><span>
</span><span id="line-520"></span><span>        </span><span class="hs-special">;</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.Monad.html#traceRn"><span class="hs-identifier hs-type">traceRn</span></a></span><span> </span><span class="annot"><span class="hs-string">&quot;rn1: } checking family instance consistency&quot;</span></span><span> </span><span class="annot"><a href="GHC.Utils.Outputable.html#empty"><span class="hs-identifier hs-type">empty</span></a></span><span>
</span><span id="line-521"></span><span>
</span><span id="line-522"></span><span>        </span><span class="hs-special">;</span><span> </span><span id="local-6989586621683116738"><span class="annot"><a href="#local-6989586621683116738"><span class="hs-identifier hs-var">gbl_env</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.Monad.html#getGblEnv"><span class="hs-identifier hs-type">getGblEnv</span></a></span><span>
</span><span id="line-523"></span><span>        </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">return</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621683116711"><span class="hs-identifier hs-type">tc_defaults</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="#local-6989586621683116738"><span class="hs-identifier hs-type">gbl_env</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-524"></span><span>
</span><span id="line-525"></span><span class="hs-comment">{-
************************************************************************
*                                                                      *
        Type-checking the top level of a module
*                                                                      *
************************************************************************
-}</span><span>
</span><span id="line-532"></span><span>
</span><span id="line-533"></span><span class="annot"><a href="GHC.Tc.Module.html#tcRnSrcDecls"><span class="hs-identifier hs-type">tcRnSrcDecls</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Bool</span></span><span>  </span><span class="hs-comment">-- False =&gt; no 'module M(..) where' header at all</span><span>
</span><span id="line-534"></span><span>             </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Maybe</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Parser.Annotation.html#LocatedLI"><span class="hs-identifier hs-type">LocatedLI</span></a></span><span> </span><span class="hs-special">[</span><span class="annot"><a href="Language.Haskell.Syntax.ImpExp.html#LIE"><span class="hs-identifier hs-type">LIE</span></a></span><span> </span><span class="annot"><a href="GHC.Hs.Extension.html#GhcPs"><span class="hs-identifier hs-type">GhcPs</span></a></span><span class="hs-special">]</span><span class="hs-special">)</span><span>
</span><span id="line-535"></span><span>             </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="Language.Haskell.Syntax.Decls.html#LHsDecl"><span class="hs-identifier hs-type">LHsDecl</span></a></span><span> </span><span class="annot"><a href="GHC.Hs.Extension.html#GhcPs"><span class="hs-identifier hs-type">GhcPs</span></a></span><span class="hs-special">]</span><span>               </span><span class="hs-comment">-- Declarations</span><span>
</span><span id="line-536"></span><span>             </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#TcM"><span class="hs-identifier hs-type">TcM</span></a></span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#TcGblEnv"><span class="hs-identifier hs-type">TcGblEnv</span></a></span><span>
</span><span id="line-537"></span><span id="tcRnSrcDecls"><span class="annot"><span class="annottext">tcRnSrcDecls :: Bool
-&gt; Maybe (GenLocated SrcSpanAnnLI [XRec GhcPs (IE GhcPs)])
-&gt; [LHsDecl GhcPs]
-&gt; TcM TcGblEnv
</span><a href="GHC.Tc.Module.html#tcRnSrcDecls"><span class="hs-identifier hs-var hs-var">tcRnSrcDecls</span></a></span></span><span> </span><span id="local-6989586621683116740"><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621683116740"><span class="hs-identifier hs-var">explicit_mod_hdr</span></a></span></span><span> </span><span id="local-6989586621683116741"><span class="annot"><span class="annottext">Maybe (GenLocated SrcSpanAnnLI [XRec GhcPs (IE GhcPs)])
</span><a href="#local-6989586621683116741"><span class="hs-identifier hs-var">export_ies</span></a></span></span><span> </span><span id="local-6989586621683116742"><span class="annot"><span class="annottext">[LHsDecl GhcPs]
</span><a href="#local-6989586621683116742"><span class="hs-identifier hs-var">decls</span></a></span></span><span>
</span><span id="line-538"></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span class="hs-comment">-- Do all the declarations</span><span>
</span><span id="line-539"></span><span>      </span><span class="hs-special">;</span><span> </span><span class="hs-special">(</span><span id="local-6989586621683116743"><span class="annot"><a href="#local-6989586621683116743"><span class="hs-identifier hs-var">tcg_env</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621683116744"><span class="annot"><a href="#local-6989586621683116744"><span class="hs-identifier hs-var">tcl_env</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621683116745"><span class="annot"><a href="#local-6989586621683116745"><span class="hs-identifier hs-var">lie</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">[LHsDecl GhcPs] -&gt; TcM (TcGblEnv, TcLclEnv, WantedConstraints)
</span><a href="GHC.Tc.Module.html#tc_rn_src_decls"><span class="hs-identifier hs-var">tc_rn_src_decls</span></a></span><span> </span><span class="annot"><span class="annottext">[LHsDecl GhcPs]
</span><a href="#local-6989586621683116742"><span class="hs-identifier hs-var">decls</span></a></span><span>
</span><span id="line-540"></span><span>
</span><span id="line-541"></span><span>      </span><span class="hs-comment">------ Simplify constraints ---------</span><span>
</span><span id="line-542"></span><span>      </span><span class="hs-comment">--</span><span>
</span><span id="line-543"></span><span>      </span><span class="hs-comment">-- We do this after checkMainType, so that we use the type</span><span>
</span><span id="line-544"></span><span>      </span><span class="hs-comment">-- info that checkMainType adds</span><span>
</span><span id="line-545"></span><span>      </span><span class="hs-comment">--</span><span>
</span><span id="line-546"></span><span>      </span><span class="hs-comment">-- We do it with both global and local env in scope:</span><span>
</span><span id="line-547"></span><span>      </span><span class="hs-comment">--  * the global env exposes the instances to simplifyTop,</span><span>
</span><span id="line-548"></span><span>      </span><span class="hs-comment">--    and affects how names are rendered in error messages</span><span>
</span><span id="line-549"></span><span>      </span><span class="hs-comment">--  * the local env exposes the local Ids to simplifyTop,</span><span>
</span><span id="line-550"></span><span>      </span><span class="hs-comment">--    so that we get better error messages (monomorphism restriction)</span><span>
</span><span id="line-551"></span><span>      </span><span class="hs-special">;</span><span> </span><span id="local-6989586621683116747"><span class="annot"><a href="#local-6989586621683116747"><span class="hs-identifier hs-var">new_ev_binds</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-pragma">{-# SCC</span><span> </span><span class="hs-pragma">&quot;simplifyTop&quot;</span><span> </span><span class="hs-pragma">#-}</span><span>
</span><span id="line-552"></span><span>                        </span><span class="annot"><a href="GHC.Tc.Utils.Monad.html#restoreEnvs"><span class="hs-identifier hs-type">restoreEnvs</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621683116743"><span class="hs-identifier hs-type">tcg_env</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="#local-6989586621683116744"><span class="hs-identifier hs-type">tcl_env</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span>
</span><span id="line-553"></span><span>                        </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span id="local-6989586621683116749"><span class="annot"><a href="#local-6989586621683116749"><span class="hs-identifier hs-var">lie_main</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><a href="GHC.Tc.Module.html#checkMainType"><span class="hs-identifier hs-type">checkMainType</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683116743"><span class="hs-identifier hs-type">tcg_env</span></a></span><span>
</span><span id="line-554"></span><span>                           </span><span class="hs-special">;</span><span> </span><span class="annot"><a href="GHC.Tc.Solver.html#simplifyTop"><span class="hs-identifier hs-type">simplifyTop</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621683116745"><span class="hs-identifier hs-type">lie</span></a></span><span> </span><span class="annot"><a href="GHC.Tc.Types.Constraint.html#andWC"><span class="hs-operator hs-type">`andWC`</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683116749"><span class="hs-identifier hs-type">lie_main</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-555"></span><span>
</span><span id="line-556"></span><span>        </span><span class="hs-comment">-- Emit Typeable bindings</span><span>
</span><span id="line-557"></span><span>      </span><span class="hs-special">;</span><span> </span><span id="local-6989586621683116753"><span class="annot"><a href="#local-6989586621683116753"><span class="hs-identifier hs-var">tcg_env</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.Monad.html#setGblEnv"><span class="hs-identifier hs-type">setGblEnv</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683116743"><span class="hs-identifier hs-type">tcg_env</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span>
</span><span id="line-558"></span><span>                   </span><span class="annot"><a href="GHC.Tc.Instance.Typeable.html#mkTypeableBinds"><span class="hs-identifier hs-type">mkTypeableBinds</span></a></span><span>
</span><span id="line-559"></span><span>
</span><span id="line-560"></span><span>      </span><span class="hs-special">;</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.Monad.html#traceTc"><span class="hs-identifier hs-type">traceTc</span></a></span><span> </span><span class="annot"><span class="hs-string">&quot;Tc9&quot;</span></span><span> </span><span class="annot"><a href="GHC.Utils.Outputable.html#empty"><span class="hs-identifier hs-type">empty</span></a></span><span>
</span><span id="line-561"></span><span>      </span><span class="hs-special">;</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.Monad.html#failIfErrsM"><span class="hs-identifier hs-type">failIfErrsM</span></a></span><span>    </span><span class="hs-comment">-- Stop now if if there have been errors</span><span>
</span><span id="line-562"></span><span>                       </span><span class="hs-comment">-- Continuing is a waste of time; and we may get debug</span><span>
</span><span id="line-563"></span><span>                       </span><span class="hs-comment">-- warnings when zonking about strangely-typed TyCons!</span><span>
</span><span id="line-564"></span><span>
</span><span id="line-565"></span><span>        </span><span class="hs-comment">-- Zonk the final code.  This must be done last.</span><span>
</span><span id="line-566"></span><span>        </span><span class="hs-comment">-- Even simplifyTop may do some unification.</span><span>
</span><span id="line-567"></span><span>        </span><span class="hs-comment">-- This pass also warns about missing type signatures</span><span>
</span><span id="line-568"></span><span>      </span><span class="hs-special">;</span><span> </span><span class="hs-special">(</span><span id="local-6989586621683116755"><span class="annot"><a href="#local-6989586621683116755"><span class="hs-identifier hs-var">id_env</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621683116756"><span class="annot"><a href="#local-6989586621683116756"><span class="hs-identifier hs-var">ev_binds'</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621683116757"><span class="annot"><a href="#local-6989586621683116757"><span class="hs-identifier hs-var">binds'</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621683116758"><span class="annot"><a href="#local-6989586621683116758"><span class="hs-identifier hs-var">fords'</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621683116759"><span class="annot"><a href="#local-6989586621683116759"><span class="hs-identifier hs-var">imp_specs'</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621683116760"><span class="annot"><a href="#local-6989586621683116760"><span class="hs-identifier hs-var">rules'</span></a></span></span><span class="hs-special">)</span><span>
</span><span id="line-569"></span><span>            </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><a href="GHC.Tc.Module.html#zonkTcGblEnv"><span class="hs-identifier hs-type">zonkTcGblEnv</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683116747"><span class="hs-identifier hs-type">new_ev_binds</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683116753"><span class="hs-identifier hs-type">tcg_env</span></a></span><span>
</span><span id="line-570"></span><span>
</span><span id="line-571"></span><span>      </span><span class="hs-comment">--------- Run finalizers --------------</span><span>
</span><span id="line-572"></span><span>      </span><span class="hs-comment">-- Finalizers must run after constraints are simplified, lest types</span><span>
</span><span id="line-573"></span><span>      </span><span class="hs-comment">--    might not be complete when using reify (see #12777).</span><span>
</span><span id="line-574"></span><span>      </span><span class="hs-comment">-- and also after we zonk the first time because we run typed splices</span><span>
</span><span id="line-575"></span><span>      </span><span class="hs-comment">--    in the zonker which gives rise to the finalisers.</span><span>
</span><span id="line-576"></span><span>      </span><span class="hs-special">;</span><span> </span><span class="hs-keyword">let</span><span> </span><span class="hs-comment">-- init_tcg_env:</span><span>
</span><span id="line-577"></span><span>            </span><span class="hs-comment">--   * Remove accumulated bindings, rules and so on from</span><span>
</span><span id="line-578"></span><span>            </span><span class="hs-comment">--     TcGblEnv.  They are now in ev_binds', binds', etc.</span><span>
</span><span id="line-579"></span><span>            </span><span class="hs-comment">--   * Add the zonked Ids from the value bindings to tcg_type_env</span><span>
</span><span id="line-580"></span><span>            </span><span class="hs-comment">--     Up to now these Ids are only in tcl_env's type-envt</span><span>
</span><span id="line-581"></span><span>            </span><span id="local-6989586621683116762"><span class="annot"><a href="#local-6989586621683116762"><span class="hs-identifier hs-var hs-var">init_tcg_env</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">TcGblEnv
</span><a href="#local-6989586621683116753"><span class="hs-identifier hs-var">tcg_env</span></a></span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#tcg_binds"><span class="hs-identifier hs-var">tcg_binds</span></a></span><span>     </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span>
</span><span id="line-582"></span><span>                                   </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#tcg_ev_binds"><span class="hs-identifier hs-var">tcg_ev_binds</span></a></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="GHC.Data.Bag.html#emptyBag"><span class="hs-identifier hs-type">emptyBag</span></a></span><span>
</span><span id="line-583"></span><span>                                   </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#tcg_imp_specs"><span class="hs-identifier hs-var">tcg_imp_specs</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span>
</span><span id="line-584"></span><span>                                   </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#tcg_rules"><span class="hs-identifier hs-var">tcg_rules</span></a></span><span>     </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span>
</span><span id="line-585"></span><span>                                   </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#tcg_fords"><span class="hs-identifier hs-var">tcg_fords</span></a></span><span>     </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span>
</span><span id="line-586"></span><span>                                   </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#tcg_type_env"><span class="hs-identifier hs-var">tcg_type_env</span></a></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#tcg_type_env"><span class="hs-identifier hs-var">tcg_type_env</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683116753"><span class="hs-identifier hs-type">tcg_env</span></a></span><span>
</span><span id="line-587"></span><span>                                                     </span><span class="annot"><a href="GHC.Types.TypeEnv.html#plusTypeEnv"><span class="hs-operator hs-type">`plusTypeEnv`</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683116755"><span class="hs-identifier hs-type">id_env</span></a></span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-588"></span><span>      </span><span class="hs-special">;</span><span> </span><span class="hs-special">(</span><span id="local-6989586621683116771"><span class="annot"><a href="#local-6989586621683116771"><span class="hs-identifier hs-var">tcg_env</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621683116772"><span class="annot"><a href="#local-6989586621683116772"><span class="hs-identifier hs-var">tcl_env</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.Monad.html#setGblEnv"><span class="hs-identifier hs-type">setGblEnv</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683116762"><span class="hs-identifier hs-type">init_tcg_env</span></a></span><span>
</span><span id="line-589"></span><span>                              </span><span class="annot"><a href="GHC.Tc.Module.html#run_th_modfinalizers"><span class="hs-identifier hs-type">run_th_modfinalizers</span></a></span><span>
</span><span id="line-590"></span><span>      </span><span class="hs-special">;</span><span> </span><span class="annot"><a href="GHC.Tc.Gen.Splice.html#finishTH"><span class="hs-identifier hs-type">finishTH</span></a></span><span>
</span><span id="line-591"></span><span>      </span><span class="hs-special">;</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.Monad.html#traceTc"><span class="hs-identifier hs-type">traceTc</span></a></span><span> </span><span class="annot"><span class="hs-string">&quot;Tc11&quot;</span></span><span> </span><span class="annot"><a href="GHC.Utils.Outputable.html#empty"><span class="hs-identifier hs-type">empty</span></a></span><span>
</span><span id="line-592"></span><span>
</span><span id="line-593"></span><span>      </span><span class="hs-comment">--------- Deal with the exports ----------</span><span>
</span><span id="line-594"></span><span>      </span><span class="hs-comment">-- Can't be done earlier, because the export list must &quot;see&quot;</span><span>
</span><span id="line-595"></span><span>      </span><span class="hs-comment">-- the declarations created by the finalizers</span><span>
</span><span id="line-596"></span><span>      </span><span class="hs-special">;</span><span> </span><span id="local-6989586621683116774"><span class="annot"><a href="#local-6989586621683116774"><span class="hs-identifier hs-var">tcg_env</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.Monad.html#restoreEnvs"><span class="hs-identifier hs-type">restoreEnvs</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621683116771"><span class="hs-identifier hs-type">tcg_env</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="#local-6989586621683116772"><span class="hs-identifier hs-type">tcl_env</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span>
</span><span id="line-597"></span><span>                   </span><span class="annot"><a href="GHC.Tc.Gen.Export.html#rnExports"><span class="hs-identifier hs-type">rnExports</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683116740"><span class="hs-identifier hs-type">explicit_mod_hdr</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683116741"><span class="hs-identifier hs-type">export_ies</span></a></span><span>
</span><span id="line-598"></span><span>
</span><span id="line-599"></span><span>      </span><span class="hs-comment">--------- Emit the ':Main.main = runMainIO main' declaration ----------</span><span>
</span><span id="line-600"></span><span>      </span><span class="hs-comment">-- Do this /after/ rnExports, so that it can consult</span><span>
</span><span id="line-601"></span><span>      </span><span class="hs-comment">-- the tcg_exports created by rnExports</span><span>
</span><span id="line-602"></span><span>      </span><span class="hs-special">;</span><span> </span><span class="hs-special">(</span><span id="local-6989586621683116775"><span class="annot"><a href="#local-6989586621683116775"><span class="hs-identifier hs-var">tcg_env</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621683116776"><span class="annot"><a href="#local-6989586621683116776"><span class="hs-identifier hs-var">main_ev_binds</span></a></span></span><span class="hs-special">)</span><span>
</span><span id="line-603"></span><span>           </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.Monad.html#restoreEnvs"><span class="hs-identifier hs-type">restoreEnvs</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621683116774"><span class="hs-identifier hs-type">tcg_env</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="#local-6989586621683116772"><span class="hs-identifier hs-type">tcl_env</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span>
</span><span id="line-604"></span><span>              </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span class="hs-special">(</span><span id="local-6989586621683116777"><span class="annot"><a href="#local-6989586621683116777"><span class="hs-identifier hs-var">tcg_env</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621683116778"><span class="annot"><a href="#local-6989586621683116778"><span class="hs-identifier hs-var">lie</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><a href="GHC.Tc.Solver.html#captureTopConstraints"><span class="hs-identifier hs-type">captureTopConstraints</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span>
</span><span id="line-605"></span><span>                                     </span><span class="annot"><a href="GHC.Tc.Module.html#checkMain"><span class="hs-identifier hs-type">checkMain</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683116740"><span class="hs-identifier hs-type">explicit_mod_hdr</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683116741"><span class="hs-identifier hs-type">export_ies</span></a></span><span>
</span><span id="line-606"></span><span>                 </span><span class="hs-special">;</span><span> </span><span id="local-6989586621683116781"><span class="annot"><a href="#local-6989586621683116781"><span class="hs-identifier hs-var">ev_binds</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><a href="GHC.Tc.Solver.html#simplifyTop"><span class="hs-identifier hs-type">simplifyTop</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683116778"><span class="hs-identifier hs-type">lie</span></a></span><span>
</span><span id="line-607"></span><span>                 </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">return</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621683116777"><span class="hs-identifier hs-type">tcg_env</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="#local-6989586621683116781"><span class="hs-identifier hs-type">ev_binds</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-608"></span><span>
</span><span id="line-609"></span><span>      </span><span class="hs-special">;</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.Monad.html#failIfErrsM"><span class="hs-identifier hs-type">failIfErrsM</span></a></span><span>    </span><span class="hs-comment">-- Stop now if if there have been errors</span><span>
</span><span id="line-610"></span><span>                       </span><span class="hs-comment">-- Continuing is a waste of time; and we may get debug</span><span>
</span><span id="line-611"></span><span>                       </span><span class="hs-comment">-- warnings when zonking about strangely-typed TyCons!</span><span>
</span><span id="line-612"></span><span>
</span><span id="line-613"></span><span>      </span><span class="hs-comment">---------- Final zonking ---------------</span><span>
</span><span id="line-614"></span><span>      </span><span class="hs-comment">-- Zonk the new bindings arising from running the finalisers,</span><span>
</span><span id="line-615"></span><span>      </span><span class="hs-comment">-- and main. This won't give rise to any more finalisers as you</span><span>
</span><span id="line-616"></span><span>      </span><span class="hs-comment">-- can't nest finalisers inside finalisers.</span><span>
</span><span id="line-617"></span><span>      </span><span class="hs-special">;</span><span> </span><span class="hs-special">(</span><span id="local-6989586621683116782"><span class="annot"><a href="#local-6989586621683116782"><span class="hs-identifier hs-var">id_env_mf</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621683116783"><span class="annot"><a href="#local-6989586621683116783"><span class="hs-identifier hs-var">ev_binds_mf</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621683116784"><span class="annot"><a href="#local-6989586621683116784"><span class="hs-identifier hs-var">binds_mf</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621683116785"><span class="annot"><a href="#local-6989586621683116785"><span class="hs-identifier hs-var">fords_mf</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621683116786"><span class="annot"><a href="#local-6989586621683116786"><span class="hs-identifier hs-var">imp_specs_mf</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621683116787"><span class="annot"><a href="#local-6989586621683116787"><span class="hs-identifier hs-var">rules_mf</span></a></span></span><span class="hs-special">)</span><span>
</span><span id="line-618"></span><span>            </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><a href="GHC.Tc.Module.html#zonkTcGblEnv"><span class="hs-identifier hs-type">zonkTcGblEnv</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683116776"><span class="hs-identifier hs-type">main_ev_binds</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683116775"><span class="hs-identifier hs-type">tcg_env</span></a></span><span>
</span><span id="line-619"></span><span>
</span><span id="line-620"></span><span>      </span><span class="hs-special">;</span><span> </span><span class="hs-keyword">let</span><span> </span><span class="hs-special">{</span><span> </span><span class="hs-glyph">!</span><span id="local-6989586621683116788"><span class="annot"><a href="#local-6989586621683116788"><span class="hs-identifier hs-var hs-var">final_type_env</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">TcGblEnv -&gt; TypeEnv
</span><a href="GHC.Tc.Types.html#tcg_type_env"><span class="hs-identifier hs-var">tcg_type_env</span></a></span><span> </span><span class="annot"><span class="annottext">TcGblEnv
</span><a href="#local-6989586621683116775"><span class="hs-identifier hs-var">tcg_env</span></a></span><span>
</span><span id="line-621"></span><span>                                </span><span class="annot"><span class="annottext">TypeEnv -&gt; TypeEnv -&gt; TypeEnv
</span><a href="GHC.Types.TypeEnv.html#plusTypeEnv"><span class="hs-operator hs-var">`plusTypeEnv`</span></a></span><span> </span><span class="annot"><span class="annottext">TypeEnv
</span><a href="#local-6989586621683116782"><span class="hs-identifier hs-var">id_env_mf</span></a></span><span>
</span><span id="line-622"></span><span>              </span><span class="hs-comment">-- Add the zonked Ids from the value bindings (they were in tcl_env)</span><span>
</span><span id="line-623"></span><span>              </span><span class="hs-comment">-- Force !final_type_env, lest we retain an old reference</span><span>
</span><span id="line-624"></span><span>              </span><span class="hs-comment">-- to the previous tcg_env</span><span>
</span><span id="line-625"></span><span>
</span><span id="line-626"></span><span>            </span><span class="hs-special">;</span><span> </span><span id="local-6989586621683116789"><span class="annot"><a href="#local-6989586621683116789"><span class="hs-identifier hs-var hs-var">tcg_env'</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">TcGblEnv
</span><a href="#local-6989586621683116775"><span class="hs-identifier hs-var">tcg_env</span></a></span><span>
</span><span id="line-627"></span><span>                          </span><span class="hs-special">{</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#tcg_binds"><span class="hs-identifier hs-var">tcg_binds</span></a></span><span>     </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="#local-6989586621683116757"><span class="hs-identifier hs-type">binds'</span></a></span><span>     </span><span class="annot"><span class="hs-operator hs-type">++</span></span><span> </span><span class="annot"><a href="#local-6989586621683116784"><span class="hs-identifier hs-type">binds_mf</span></a></span><span>
</span><span id="line-628"></span><span>                          </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#tcg_ev_binds"><span class="hs-identifier hs-var">tcg_ev_binds</span></a></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="#local-6989586621683116756"><span class="hs-identifier hs-type">ev_binds'</span></a></span><span> </span><span class="annot"><a href="GHC.Data.Bag.html#unionBags"><span class="hs-operator hs-type">`unionBags`</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683116783"><span class="hs-identifier hs-type">ev_binds_mf</span></a></span><span>
</span><span id="line-629"></span><span>                          </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#tcg_imp_specs"><span class="hs-identifier hs-var">tcg_imp_specs</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="#local-6989586621683116759"><span class="hs-identifier hs-type">imp_specs'</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">++</span></span><span> </span><span class="annot"><a href="#local-6989586621683116786"><span class="hs-identifier hs-type">imp_specs_mf</span></a></span><span>
</span><span id="line-630"></span><span>                          </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#tcg_rules"><span class="hs-identifier hs-var">tcg_rules</span></a></span><span>     </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="#local-6989586621683116760"><span class="hs-identifier hs-type">rules'</span></a></span><span>     </span><span class="annot"><span class="hs-operator hs-type">++</span></span><span> </span><span class="annot"><a href="#local-6989586621683116787"><span class="hs-identifier hs-type">rules_mf</span></a></span><span>
</span><span id="line-631"></span><span>                          </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#tcg_fords"><span class="hs-identifier hs-var">tcg_fords</span></a></span><span>     </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="#local-6989586621683116758"><span class="hs-identifier hs-type">fords'</span></a></span><span>     </span><span class="annot"><span class="hs-operator hs-type">++</span></span><span> </span><span class="annot"><a href="#local-6989586621683116785"><span class="hs-identifier hs-type">fords_mf</span></a></span><span> </span><span class="hs-special">}</span><span> </span><span class="hs-special">}</span><span> </span><span class="hs-special">;</span><span>
</span><span id="line-632"></span><span>
</span><span id="line-633"></span><span>      </span><span class="hs-special">;</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.Env.html#setGlobalTypeEnv"><span class="hs-identifier hs-type">setGlobalTypeEnv</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683116789"><span class="hs-identifier hs-type">tcg_env'</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683116788"><span class="hs-identifier hs-type">final_type_env</span></a></span><span>
</span><span id="line-634"></span><span>   </span><span class="hs-special">}</span><span>
</span><span id="line-635"></span><span>
</span><span id="line-636"></span><span class="annot"><a href="GHC.Tc.Module.html#zonkTcGblEnv"><span class="hs-identifier hs-type">zonkTcGblEnv</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Data.Bag.html#Bag"><span class="hs-identifier hs-type">Bag</span></a></span><span> </span><span class="annot"><a href="GHC.Tc.Types.Evidence.html#EvBind"><span class="hs-identifier hs-type">EvBind</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#TcGblEnv"><span class="hs-identifier hs-type">TcGblEnv</span></a></span><span>
</span><span id="line-637"></span><span>             </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#TcM"><span class="hs-identifier hs-type">TcM</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Types.TypeEnv.html#TypeEnv"><span class="hs-identifier hs-type">TypeEnv</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Data.Bag.html#Bag"><span class="hs-identifier hs-type">Bag</span></a></span><span> </span><span class="annot"><a href="GHC.Tc.Types.Evidence.html#EvBind"><span class="hs-identifier hs-type">EvBind</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Language.Haskell.Syntax.Binds.html#LHsBinds"><span class="hs-identifier hs-type">LHsBinds</span></a></span><span> </span><span class="annot"><a href="GHC.Hs.Extension.html#GhcTc"><span class="hs-identifier hs-type">GhcTc</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-638"></span><span>                       </span><span class="hs-special">[</span><span class="annot"><a href="Language.Haskell.Syntax.Decls.html#LForeignDecl"><span class="hs-identifier hs-type">LForeignDecl</span></a></span><span> </span><span class="annot"><a href="GHC.Hs.Extension.html#GhcTc"><span class="hs-identifier hs-type">GhcTc</span></a></span><span class="hs-special">]</span><span class="hs-special">,</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="GHC.Hs.Binds.html#LTcSpecPrag"><span class="hs-identifier hs-type">LTcSpecPrag</span></a></span><span class="hs-special">]</span><span class="hs-special">,</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="Language.Haskell.Syntax.Decls.html#LRuleDecl"><span class="hs-identifier hs-type">LRuleDecl</span></a></span><span> </span><span class="annot"><a href="GHC.Hs.Extension.html#GhcTc"><span class="hs-identifier hs-type">GhcTc</span></a></span><span class="hs-special">]</span><span class="hs-special">)</span><span>
</span><span id="line-639"></span><span id="zonkTcGblEnv"><span class="annot"><span class="annottext">zonkTcGblEnv :: Bag EvBind
-&gt; TcGblEnv
-&gt; TcM
     (TypeEnv, Bag EvBind, LHsBinds GhcTc, [LForeignDecl GhcTc],
      [LTcSpecPrag], [LRuleDecl GhcTc])
</span><a href="GHC.Tc.Module.html#zonkTcGblEnv"><span class="hs-identifier hs-var hs-var">zonkTcGblEnv</span></a></span></span><span> </span><span id="local-6989586621683116792"><span class="annot"><span class="annottext">Bag EvBind
</span><a href="#local-6989586621683116792"><span class="hs-identifier hs-var">ev_binds</span></a></span></span><span> </span><span id="local-6989586621683116793"><span class="annot"><span class="annottext">tcg_env :: TcGblEnv
</span><a href="#local-6989586621683116793"><span class="hs-identifier hs-var">tcg_env</span></a></span></span><span class="hs-glyph">@</span><span class="hs-special">(</span><span class="annot"><a href="GHC.Tc.Types.html#TcGblEnv"><span class="hs-identifier hs-type">TcGblEnv</span></a></span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">tcg_binds :: TcGblEnv -&gt; LHsBinds GhcTc
</span><a href="GHC.Tc.Types.html#tcg_binds"><span class="hs-identifier hs-var">tcg_binds</span></a></span><span>     </span><span class="hs-glyph">=</span><span> </span><span id="local-6989586621683116795"><span class="annot"><span class="annottext">LHsBinds GhcTc
</span><a href="#local-6989586621683116795"><span class="hs-identifier hs-var">binds</span></a></span></span><span>
</span><span id="line-640"></span><span>                                        </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">tcg_ev_binds :: TcGblEnv -&gt; Bag EvBind
</span><a href="GHC.Tc.Types.html#tcg_ev_binds"><span class="hs-identifier hs-var">tcg_ev_binds</span></a></span><span>  </span><span class="hs-glyph">=</span><span> </span><span id="local-6989586621683116796"><span class="annot"><span class="annottext">Bag EvBind
</span><a href="#local-6989586621683116796"><span class="hs-identifier hs-var">cur_ev_binds</span></a></span></span><span>
</span><span id="line-641"></span><span>                                        </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">tcg_imp_specs :: TcGblEnv -&gt; [LTcSpecPrag]
</span><a href="GHC.Tc.Types.html#tcg_imp_specs"><span class="hs-identifier hs-var">tcg_imp_specs</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="local-6989586621683116797"><span class="annot"><span class="annottext">[LTcSpecPrag]
</span><a href="#local-6989586621683116797"><span class="hs-identifier hs-var">imp_specs</span></a></span></span><span>
</span><span id="line-642"></span><span>                                        </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">tcg_rules :: TcGblEnv -&gt; [LRuleDecl GhcTc]
</span><a href="GHC.Tc.Types.html#tcg_rules"><span class="hs-identifier hs-var">tcg_rules</span></a></span><span>     </span><span class="hs-glyph">=</span><span> </span><span id="local-6989586621683116798"><span class="annot"><span class="annottext">[LRuleDecl GhcTc]
</span><a href="#local-6989586621683116798"><span class="hs-identifier hs-var">rules</span></a></span></span><span>
</span><span id="line-643"></span><span>                                        </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">tcg_fords :: TcGblEnv -&gt; [LForeignDecl GhcTc]
</span><a href="GHC.Tc.Types.html#tcg_fords"><span class="hs-identifier hs-var">tcg_fords</span></a></span><span>     </span><span class="hs-glyph">=</span><span> </span><span id="local-6989586621683116799"><span class="annot"><span class="annottext">[LForeignDecl GhcTc]
</span><a href="#local-6989586621683116799"><span class="hs-identifier hs-var">fords</span></a></span></span><span> </span><span class="hs-special">}</span><span class="hs-special">)</span><span>
</span><span id="line-644"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-pragma">{-# SCC</span><span> </span><span class="hs-pragma">&quot;zonkTopDecls&quot;</span><span> </span><span class="hs-pragma">#-}</span><span>
</span><span id="line-645"></span><span>    </span><span class="annot"><span class="annottext">TcGblEnv
-&gt; TcM
     (TypeEnv, Bag EvBind, LHsBinds GhcTc, [LForeignDecl GhcTc],
      [LTcSpecPrag], [LRuleDecl GhcTc])
-&gt; TcM
     (TypeEnv, Bag EvBind, LHsBinds GhcTc, [LForeignDecl GhcTc],
      [LTcSpecPrag], [LRuleDecl GhcTc])
forall gbl' lcl a gbl.
gbl' -&gt; TcRnIf gbl' lcl a -&gt; TcRnIf gbl lcl a
</span><a href="GHC.Tc.Utils.Monad.html#setGblEnv"><span class="hs-identifier hs-var">setGblEnv</span></a></span><span> </span><span class="annot"><span class="annottext">TcGblEnv
</span><a href="#local-6989586621683116793"><span class="hs-identifier hs-var">tcg_env</span></a></span><span> </span><span class="annot"><span class="annottext">(TcM
   (TypeEnv, Bag EvBind, LHsBinds GhcTc, [LForeignDecl GhcTc],
    [LTcSpecPrag], [LRuleDecl GhcTc])
 -&gt; TcM
      (TypeEnv, Bag EvBind, LHsBinds GhcTc, [LForeignDecl GhcTc],
       [LTcSpecPrag], [LRuleDecl GhcTc]))
-&gt; TcM
     (TypeEnv, Bag EvBind, LHsBinds GhcTc, [LForeignDecl GhcTc],
      [LTcSpecPrag], [LRuleDecl GhcTc])
-&gt; TcM
     (TypeEnv, Bag EvBind, LHsBinds GhcTc, [LForeignDecl GhcTc],
      [LTcSpecPrag], [LRuleDecl GhcTc])
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-comment">-- This sets the GlobalRdrEnv which is used when rendering</span><span>
</span><span id="line-646"></span><span>                        </span><span class="hs-comment">--   error messages during zonking (notably levity errors)</span><span>
</span><span id="line-647"></span><span>    </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621683116800"><span class="annot"><span class="annottext">all_ev_binds :: Bag EvBind
</span><a href="#local-6989586621683116800"><span class="hs-identifier hs-var hs-var">all_ev_binds</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Bag EvBind
</span><a href="#local-6989586621683116796"><span class="hs-identifier hs-var">cur_ev_binds</span></a></span><span> </span><span class="annot"><span class="annottext">Bag EvBind -&gt; Bag EvBind -&gt; Bag EvBind
forall a. Bag a -&gt; Bag a -&gt; Bag a
</span><a href="GHC.Data.Bag.html#unionBags"><span class="hs-operator hs-var">`unionBags`</span></a></span><span> </span><span class="annot"><span class="annottext">Bag EvBind
</span><a href="#local-6989586621683116792"><span class="hs-identifier hs-var">ev_binds</span></a></span><span>
</span><span id="line-648"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="annottext">Bag EvBind
-&gt; LHsBinds GhcTc
-&gt; [LRuleDecl GhcTc]
-&gt; [LTcSpecPrag]
-&gt; [LForeignDecl GhcTc]
-&gt; TcM
     (TypeEnv, Bag EvBind, LHsBinds GhcTc, [LForeignDecl GhcTc],
      [LTcSpecPrag], [LRuleDecl GhcTc])
</span><a href="GHC.Tc.Zonk.Type.html#zonkTopDecls"><span class="hs-identifier hs-var">zonkTopDecls</span></a></span><span> </span><span class="annot"><span class="annottext">Bag EvBind
</span><a href="#local-6989586621683116800"><span class="hs-identifier hs-var">all_ev_binds</span></a></span><span> </span><span class="annot"><span class="annottext">LHsBinds GhcTc
</span><a href="#local-6989586621683116795"><span class="hs-identifier hs-var">binds</span></a></span><span> </span><span class="annot"><span class="annottext">[LRuleDecl GhcTc]
</span><a href="#local-6989586621683116798"><span class="hs-identifier hs-var">rules</span></a></span><span> </span><span class="annot"><span class="annottext">[LTcSpecPrag]
</span><a href="#local-6989586621683116797"><span class="hs-identifier hs-var">imp_specs</span></a></span><span> </span><span class="annot"><span class="annottext">[LForeignDecl GhcTc]
</span><a href="#local-6989586621683116799"><span class="hs-identifier hs-var">fords</span></a></span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-649"></span><span>
</span><span id="line-650"></span><span class="hs-comment">-- | Runs TH finalizers and renames and typechecks the top-level declarations</span><span>
</span><span id="line-651"></span><span class="hs-comment">-- that they could introduce.</span><span>
</span><span id="line-652"></span><span class="annot"><a href="GHC.Tc.Module.html#run_th_modfinalizers"><span class="hs-identifier hs-type">run_th_modfinalizers</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#TcM"><span class="hs-identifier hs-type">TcM</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Tc.Types.html#TcGblEnv"><span class="hs-identifier hs-type">TcGblEnv</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Tc.Types.LclEnv.html#TcLclEnv"><span class="hs-identifier hs-type">TcLclEnv</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-653"></span><span id="run_th_modfinalizers"><span class="annot"><span class="annottext">run_th_modfinalizers :: TcRnIf TcGblEnv TcLclEnv (TcGblEnv, TcLclEnv)
</span><a href="GHC.Tc.Module.html#run_th_modfinalizers"><span class="hs-identifier hs-var hs-var">run_th_modfinalizers</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-654"></span><span>  </span><span id="local-6989586621683116802"><span class="annot"><a href="#local-6989586621683116802"><span class="hs-identifier hs-var">th_modfinalizers_var</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">(TcGblEnv -&gt; TcRef [(TcLclEnv, ThModFinalizers)])
-&gt; TcM TcGblEnv
-&gt; IOEnv
     (Env TcGblEnv TcLclEnv) (TcRef [(TcLclEnv, ThModFinalizers)])
forall a b.
(a -&gt; b)
-&gt; IOEnv (Env TcGblEnv TcLclEnv) a
-&gt; IOEnv (Env TcGblEnv TcLclEnv) b
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-identifier hs-var">fmap</span></span><span> </span><span class="annot"><span class="annottext">TcGblEnv -&gt; TcRef [(TcLclEnv, ThModFinalizers)]
</span><a href="GHC.Tc.Types.html#tcg_th_modfinalizers"><span class="hs-identifier hs-var">tcg_th_modfinalizers</span></a></span><span> </span><span class="annot"><span class="annottext">TcM TcGblEnv
forall gbl lcl. TcRnIf gbl lcl gbl
</span><a href="GHC.Tc.Utils.Monad.html#getGblEnv"><span class="hs-identifier hs-var">getGblEnv</span></a></span><span>
</span><span id="line-655"></span><span>  </span><span id="local-6989586621683116804"><span class="annot"><a href="#local-6989586621683116804"><span class="hs-identifier hs-var">th_modfinalizers</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><a href="GHC.Tc.Types.TcRef.html#readTcRef"><span class="hs-identifier hs-type">readTcRef</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683116802"><span class="hs-identifier hs-type">th_modfinalizers_var</span></a></span><span>
</span><span id="line-656"></span><span>  </span><span class="hs-keyword">if</span><span> </span><span class="annot"><span class="hs-identifier hs-type">null</span></span><span> </span><span class="annot"><a href="#local-6989586621683116804"><span class="hs-identifier hs-type">th_modfinalizers</span></a></span><span>
</span><span id="line-657"></span><span>  </span><span class="hs-keyword">then</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.Monad.html#getEnvs"><span class="hs-identifier hs-type">getEnvs</span></a></span><span>
</span><span id="line-658"></span><span>  </span><span class="hs-keyword">else</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-659"></span><span>    </span><span class="annot"><a href="GHC.Tc.Types.TcRef.html#writeTcRef"><span class="hs-identifier hs-type">writeTcRef</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683116802"><span class="hs-identifier hs-type">th_modfinalizers_var</span></a></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span>
</span><span id="line-660"></span><span>    </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621683116809"><span class="annot"><a href="#local-6989586621683116809"><span class="hs-identifier hs-var hs-var">run_finalizer</span></a></span></span><span> </span><span class="hs-special">(</span><span id="local-6989586621683116810"><span class="annot"><span class="annottext">TcLclEnv
</span><a href="#local-6989586621683116810"><span class="hs-identifier hs-var">lcl_env</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621683116811"><span class="annot"><span class="annottext">ThModFinalizers
</span><a href="#local-6989586621683116811"><span class="hs-identifier hs-var">f</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-661"></span><span>            </span><span class="annot"><span class="annottext">TcLclEnv
-&gt; IOEnv (Env TcGblEnv TcLclEnv) ()
-&gt; IOEnv (Env TcGblEnv TcLclEnv) ()
forall gbl a.
TcLclEnv -&gt; TcRnIf gbl TcLclEnv a -&gt; TcRnIf gbl TcLclEnv a
</span><a href="GHC.Tc.Utils.Monad.html#restoreLclEnv"><span class="hs-identifier hs-var">restoreLclEnv</span></a></span><span> </span><span class="annot"><span class="annottext">TcLclEnv
</span><a href="#local-6989586621683116810"><span class="hs-identifier hs-var">lcl_env</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ThModFinalizers -&gt; IOEnv (Env TcGblEnv TcLclEnv) ()
</span><a href="GHC.Tc.Gen.Splice.html#runRemoteModFinalizers"><span class="hs-identifier hs-var">runRemoteModFinalizers</span></a></span><span> </span><span class="annot"><span class="annottext">ThModFinalizers
</span><a href="#local-6989586621683116811"><span class="hs-identifier hs-var">f</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-662"></span><span>
</span><span id="line-663"></span><span>    </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">_</span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621683116813"><span class="annot"><a href="#local-6989586621683116813"><span class="hs-identifier hs-var">lie_th</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><a href="GHC.Tc.Solver.html#captureTopConstraints"><span class="hs-identifier hs-type">captureTopConstraints</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span>
</span><span id="line-664"></span><span>                   </span><span class="annot"><span class="hs-identifier hs-type">mapM_</span></span><span> </span><span class="annot"><a href="#local-6989586621683116809"><span class="hs-identifier hs-type">run_finalizer</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683116804"><span class="hs-identifier hs-type">th_modfinalizers</span></a></span><span>
</span><span id="line-665"></span><span>
</span><span id="line-666"></span><span>      </span><span class="hs-comment">-- Finalizers can add top-level declarations with addTopDecls, so</span><span>
</span><span id="line-667"></span><span>      </span><span class="hs-comment">-- we have to run tc_rn_src_decls to get them</span><span>
</span><span id="line-668"></span><span>    </span><span class="hs-special">(</span><span id="local-6989586621683116814"><span class="annot"><a href="#local-6989586621683116814"><span class="hs-identifier hs-var">tcg_env</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621683116815"><span class="annot"><a href="#local-6989586621683116815"><span class="hs-identifier hs-var">tcl_env</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621683116816"><span class="annot"><a href="#local-6989586621683116816"><span class="hs-identifier hs-var">lie_top_decls</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><a href="GHC.Tc.Module.html#tc_rn_src_decls"><span class="hs-identifier hs-type">tc_rn_src_decls</span></a></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span>
</span><span id="line-669"></span><span>
</span><span id="line-670"></span><span>    </span><span class="annot"><a href="GHC.Tc.Utils.Monad.html#restoreEnvs"><span class="hs-identifier hs-type">restoreEnvs</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621683116814"><span class="hs-identifier hs-type">tcg_env</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="#local-6989586621683116815"><span class="hs-identifier hs-type">tcl_env</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-671"></span><span>      </span><span class="hs-comment">-- Subsequent rounds of finalizers run after any new constraints are</span><span>
</span><span id="line-672"></span><span>      </span><span class="hs-comment">-- simplified, or some types might not be complete when using reify</span><span>
</span><span id="line-673"></span><span>      </span><span class="hs-comment">-- (see #12777).</span><span>
</span><span id="line-674"></span><span>      </span><span id="local-6989586621683116817"><span class="annot"><a href="#local-6989586621683116817"><span class="hs-identifier hs-var">new_ev_binds</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-pragma">{-# SCC</span><span> </span><span class="hs-pragma">&quot;simplifyTop2&quot;</span><span> </span><span class="hs-pragma">#-}</span><span>
</span><span id="line-675"></span><span>                      </span><span class="annot"><a href="GHC.Tc.Solver.html#simplifyTop"><span class="hs-identifier hs-type">simplifyTop</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621683116813"><span class="hs-identifier hs-type">lie_th</span></a></span><span> </span><span class="annot"><a href="GHC.Tc.Types.Constraint.html#andWC"><span class="hs-operator hs-type">`andWC`</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683116816"><span class="hs-identifier hs-type">lie_top_decls</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-676"></span><span>      </span><span class="annot"><a href="GHC.Tc.Utils.Monad.html#addTopEvBinds"><span class="hs-identifier hs-type">addTopEvBinds</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683116817"><span class="hs-identifier hs-type">new_ev_binds</span></a></span><span> </span><span class="annot"><a href="GHC.Tc.Module.html#run_th_modfinalizers"><span class="hs-identifier hs-type">run_th_modfinalizers</span></a></span><span>
</span><span id="line-677"></span><span>        </span><span class="hs-comment">-- addTopDecls can add declarations which add new finalizers.</span><span>
</span><span id="line-678"></span><span>
</span><span id="line-679"></span><span class="annot"><a href="GHC.Tc.Module.html#tc_rn_src_decls"><span class="hs-identifier hs-type">tc_rn_src_decls</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="Language.Haskell.Syntax.Decls.html#LHsDecl"><span class="hs-identifier hs-type">LHsDecl</span></a></span><span> </span><span class="annot"><a href="GHC.Hs.Extension.html#GhcPs"><span class="hs-identifier hs-type">GhcPs</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-680"></span><span>                </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#TcM"><span class="hs-identifier hs-type">TcM</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Tc.Types.html#TcGblEnv"><span class="hs-identifier hs-type">TcGblEnv</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Tc.Types.LclEnv.html#TcLclEnv"><span class="hs-identifier hs-type">TcLclEnv</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Tc.Types.Constraint.html#WantedConstraints"><span class="hs-identifier hs-type">WantedConstraints</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-681"></span><span class="hs-comment">-- Loops around dealing with each top level inter-splice group</span><span>
</span><span id="line-682"></span><span class="hs-comment">-- in turn, until it's dealt with the entire module</span><span>
</span><span id="line-683"></span><span class="hs-comment">-- Never emits constraints; calls captureTopConstraints internally</span><span>
</span><span id="line-684"></span><span id="tc_rn_src_decls"><span class="annot"><span class="annottext">tc_rn_src_decls :: [LHsDecl GhcPs] -&gt; TcM (TcGblEnv, TcLclEnv, WantedConstraints)
</span><a href="GHC.Tc.Module.html#tc_rn_src_decls"><span class="hs-identifier hs-var hs-var">tc_rn_src_decls</span></a></span></span><span> </span><span id="local-6989586621683116819"><span class="annot"><span class="annottext">[LHsDecl GhcPs]
</span><a href="#local-6989586621683116819"><span class="hs-identifier hs-var">ds</span></a></span></span><span>
</span><span id="line-685"></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-pragma">{-# SCC</span><span> </span><span class="hs-pragma">&quot;tc_rn_src_decls&quot;</span><span> </span><span class="hs-pragma">#-}</span><span>
</span><span id="line-686"></span><span>   </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span class="hs-special">(</span><span id="local-6989586621683116820"><span class="annot"><a href="#local-6989586621683116820"><span class="hs-identifier hs-var">first_group</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621683116821"><span class="annot"><a href="#local-6989586621683116821"><span class="hs-identifier hs-var">group_tail</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">[LHsDecl GhcPs]
-&gt; RnM (HsGroup GhcPs, Maybe (SpliceDecl GhcPs, [LHsDecl GhcPs]))
</span><a href="GHC.Rename.Module.html#findSplice"><span class="hs-identifier hs-var">findSplice</span></a></span><span> </span><span class="annot"><span class="annottext">[LHsDecl GhcPs]
</span><a href="#local-6989586621683116819"><span class="hs-identifier hs-var">ds</span></a></span><span>
</span><span id="line-687"></span><span>                </span><span class="hs-comment">-- If ds is [] we get ([], Nothing)</span><span>
</span><span id="line-688"></span><span>
</span><span id="line-689"></span><span>        </span><span class="hs-comment">-- Deal with decls up to, but not including, the first splice</span><span>
</span><span id="line-690"></span><span>      </span><span class="hs-special">;</span><span> </span><span class="hs-special">(</span><span id="local-6989586621683116823"><span class="annot"><a href="#local-6989586621683116823"><span class="hs-identifier hs-var">tcg_env</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621683116824"><span class="annot"><a href="#local-6989586621683116824"><span class="hs-identifier hs-var">rn_decls</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><a href="GHC.Tc.Module.html#rnTopSrcDecls"><span class="hs-identifier hs-type">rnTopSrcDecls</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683116820"><span class="hs-identifier hs-type">first_group</span></a></span><span>
</span><span id="line-691"></span><span>                </span><span class="hs-comment">-- rnTopSrcDecls fails if there are any errors</span><span>
</span><span id="line-692"></span><span>
</span><span id="line-693"></span><span>        </span><span class="hs-comment">-- Get TH-generated top-level declarations and make sure they don't</span><span>
</span><span id="line-694"></span><span>        </span><span class="hs-comment">-- contain any splices since we don't handle that at the moment</span><span>
</span><span id="line-695"></span><span>        </span><span class="hs-comment">--</span><span>
</span><span id="line-696"></span><span>        </span><span class="hs-comment">-- The plumbing here is a bit odd: see #10853</span><span>
</span><span id="line-697"></span><span>      </span><span class="hs-special">;</span><span> </span><span id="local-6989586621683116825"><span class="annot"><a href="#local-6989586621683116825"><span class="hs-identifier hs-var">th_topdecls_var</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="hs-identifier hs-type">fmap</span></span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#tcg_th_topdecls"><span class="hs-identifier hs-var">tcg_th_topdecls</span></a></span><span> </span><span class="annot"><a href="GHC.Tc.Utils.Monad.html#getGblEnv"><span class="hs-identifier hs-type">getGblEnv</span></a></span><span>
</span><span id="line-698"></span><span>      </span><span class="hs-special">;</span><span> </span><span id="local-6989586621683116827"><span class="annot"><a href="#local-6989586621683116827"><span class="hs-identifier hs-var">th_ds</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><a href="GHC.Tc.Types.TcRef.html#readTcRef"><span class="hs-identifier hs-type">readTcRef</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683116825"><span class="hs-identifier hs-type">th_topdecls_var</span></a></span><span>
</span><span id="line-699"></span><span>      </span><span class="hs-special">;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.TcRef.html#writeTcRef"><span class="hs-identifier hs-type">writeTcRef</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683116825"><span class="hs-identifier hs-type">th_topdecls_var</span></a></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span>
</span><span id="line-700"></span><span>
</span><span id="line-701"></span><span>      </span><span class="hs-special">;</span><span> </span><span class="hs-special">(</span><span id="local-6989586621683116828"><span class="annot"><a href="#local-6989586621683116828"><span class="hs-identifier hs-var">tcg_env</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621683116829"><span class="annot"><a href="#local-6989586621683116829"><span class="hs-identifier hs-var">rn_decls</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span>
</span><span id="line-702"></span><span>            </span><span class="hs-keyword">if</span><span> </span><span class="annot"><span class="hs-identifier hs-type">null</span></span><span> </span><span class="annot"><a href="#local-6989586621683116827"><span class="hs-identifier hs-type">th_ds</span></a></span><span>
</span><span id="line-703"></span><span>            </span><span class="hs-keyword">then</span><span> </span><span class="annot"><span class="hs-identifier hs-type">return</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621683116823"><span class="hs-identifier hs-type">tcg_env</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="#local-6989586621683116824"><span class="hs-identifier hs-type">rn_decls</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-704"></span><span>            </span><span class="hs-keyword">else</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span class="hs-special">(</span><span id="local-6989586621683116830"><span class="annot"><a href="#local-6989586621683116830"><span class="hs-identifier hs-var">th_group</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621683116831"><span class="annot"><a href="#local-6989586621683116831"><span class="hs-identifier hs-var">th_group_tail</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><a href="GHC.Rename.Module.html#findSplice"><span class="hs-identifier hs-type">findSplice</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683116827"><span class="hs-identifier hs-type">th_ds</span></a></span><span>
</span><span id="line-705"></span><span>                    </span><span class="hs-special">;</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><a href="#local-6989586621683116831"><span class="hs-identifier hs-type">th_group_tail</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-706"></span><span>                        </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">Maybe (SpliceDecl GhcPs, [GenLocated SrcSpanAnnA (HsDecl GhcPs)])
</span><span class="hs-identifier hs-var">Nothing</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">() -&gt; IOEnv (Env TcGblEnv TcLclEnv) ()
forall a. a -&gt; IOEnv (Env TcGblEnv TcLclEnv) a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-707"></span><span>                        </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Language.Haskell.Syntax.Decls.html#SpliceDecl"><span class="hs-identifier hs-type">SpliceDecl</span></a></span><span> </span><span class="annot"><span class="annottext">XSpliceDecl GhcPs
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Types.SrcLoc.html#L"><span class="hs-identifier hs-type">L</span></a></span><span> </span><span id="local-6989586621683116833"><span class="annot"><span class="annottext">SrcSpanAnnA
</span><a href="#local-6989586621683116833"><span class="hs-identifier hs-var">loc</span></a></span></span><span> </span><span class="annot"><span class="annottext">HsUntypedSplice GhcPs
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">SpliceDecoration
</span><span class="hs-identifier">_</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">[GenLocated SrcSpanAnnA (HsDecl GhcPs)]
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-708"></span><span>                            </span><span class="annot"><span class="annottext">SrcSpanAnnA
-&gt; IOEnv (Env TcGblEnv TcLclEnv) ()
-&gt; IOEnv (Env TcGblEnv TcLclEnv) ()
forall ann a. EpAnn ann -&gt; TcRn a -&gt; TcRn a
</span><a href="GHC.Tc.Utils.Monad.html#setSrcSpanA"><span class="hs-identifier hs-var">setSrcSpanA</span></a></span><span> </span><span class="annot"><span class="annottext">SrcSpanAnnA
</span><a href="#local-6989586621683116833"><span class="hs-identifier hs-var">loc</span></a></span><span> </span><span class="annot"><span class="annottext">(IOEnv (Env TcGblEnv TcLclEnv) ()
 -&gt; IOEnv (Env TcGblEnv TcLclEnv) ())
-&gt; IOEnv (Env TcGblEnv TcLclEnv) ()
-&gt; IOEnv (Env TcGblEnv TcLclEnv) ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">TcRnMessage -&gt; IOEnv (Env TcGblEnv TcLclEnv) ()
</span><a href="GHC.Tc.Utils.Monad.html#addErr"><span class="hs-identifier hs-var">addErr</span></a></span><span> </span><span class="annot"><span class="annottext">(TcRnMessage -&gt; IOEnv (Env TcGblEnv TcLclEnv) ())
-&gt; TcRnMessage -&gt; IOEnv (Env TcGblEnv TcLclEnv) ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-709"></span><span>                            </span><span class="annot"><span class="annottext">THError -&gt; TcRnMessage
</span><a href="GHC.Tc.Errors.Types.html#TcRnTHError"><span class="hs-identifier hs-var">TcRnTHError</span></a></span><span> </span><span class="annot"><span class="annottext">(THError -&gt; TcRnMessage) -&gt; THError -&gt; TcRnMessage
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">AddTopDeclsError -&gt; THError
</span><a href="GHC.Tc.Errors.Types.html#AddTopDeclsError"><span class="hs-identifier hs-var">AddTopDeclsError</span></a></span><span>
</span><span id="line-710"></span><span>                              </span><span class="annot"><span class="annottext">AddTopDeclsError
</span><a href="GHC.Tc.Errors.Types.html#AddTopDeclsUnexpectedDeclarationSplice"><span class="hs-identifier hs-var">AddTopDeclsUnexpectedDeclarationSplice</span></a></span><span>
</span><span id="line-711"></span><span>                        </span><span class="hs-special">}</span><span>
</span><span id="line-712"></span><span>                      </span><span class="hs-comment">-- Rename TH-generated top-level declarations</span><span>
</span><span id="line-713"></span><span>                    </span><span class="hs-special">;</span><span> </span><span class="hs-special">(</span><span id="local-6989586621683116839"><span class="annot"><a href="#local-6989586621683116839"><span class="hs-identifier hs-var">tcg_env</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621683116840"><span class="annot"><a href="#local-6989586621683116840"><span class="hs-identifier hs-var">th_rn_decls</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.Monad.html#setGblEnv"><span class="hs-identifier hs-type">setGblEnv</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683116823"><span class="hs-identifier hs-type">tcg_env</span></a></span><span>
</span><span id="line-714"></span><span>                        </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="annot"><a href="GHC.Tc.Module.html#rnTopSrcDecls"><span class="hs-identifier hs-type">rnTopSrcDecls</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683116830"><span class="hs-identifier hs-type">th_group</span></a></span><span>
</span><span id="line-715"></span><span>
</span><span id="line-716"></span><span>                      </span><span class="hs-comment">-- Dump generated top-level declarations</span><span>
</span><span id="line-717"></span><span>                    </span><span class="hs-special">;</span><span> </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621683116841"><span class="annot"><a href="#local-6989586621683116841"><span class="hs-identifier hs-var hs-var">msg</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;top-level declarations added with 'addTopDecls'&quot;</span></span><span>
</span><span id="line-718"></span><span>                    </span><span class="hs-special">;</span><span> </span><span class="annot"><a href="GHC.Rename.Splice.html#traceSplice"><span class="hs-identifier hs-type">traceSplice</span></a></span><span>
</span><span id="line-719"></span><span>                        </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="annot"><a href="GHC.Rename.Splice.html#SpliceInfo"><span class="hs-identifier hs-type">SpliceInfo</span></a></span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><a href="GHC.Rename.Splice.html#spliceDescription"><span class="hs-identifier hs-var">spliceDescription</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="#local-6989586621683116841"><span class="hs-identifier hs-type">msg</span></a></span><span>
</span><span id="line-720"></span><span>                                     </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Rename.Splice.html#spliceIsDecl"><span class="hs-identifier hs-var">spliceIsDecl</span></a></span><span>    </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="hs-identifier hs-type">True</span></span><span>
</span><span id="line-721"></span><span>                                     </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Rename.Splice.html#spliceSource"><span class="hs-identifier hs-var">spliceSource</span></a></span><span>    </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Nothing</span></span><span>
</span><span id="line-722"></span><span>                                     </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Rename.Splice.html#spliceGenerated"><span class="hs-identifier hs-var">spliceGenerated</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-type">ppr</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683116840"><span class="hs-identifier hs-type">th_rn_decls</span></a></span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-723"></span><span>                    </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">return</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621683116839"><span class="hs-identifier hs-type">tcg_env</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Hs.Decls.html#appendGroups"><span class="hs-identifier hs-type">appendGroups</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683116824"><span class="hs-identifier hs-type">rn_decls</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683116840"><span class="hs-identifier hs-type">th_rn_decls</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-724"></span><span>                    </span><span class="hs-special">}</span><span>
</span><span id="line-725"></span><span>
</span><span id="line-726"></span><span>      </span><span class="hs-comment">-- Type check all declarations</span><span>
</span><span id="line-727"></span><span>      </span><span class="hs-comment">-- NB: set the env **before** captureTopConstraints so that error messages</span><span>
</span><span id="line-728"></span><span>      </span><span class="hs-comment">-- get reported w.r.t. the right GlobalRdrEnv. It is for this reason that</span><span>
</span><span id="line-729"></span><span>      </span><span class="hs-comment">-- the captureTopConstraints must go here, not in tcRnSrcDecls.</span><span>
</span><span id="line-730"></span><span>      </span><span class="hs-special">;</span><span> </span><span class="hs-special">(</span><span class="hs-special">(</span><span id="local-6989586621683116848"><span class="annot"><a href="#local-6989586621683116848"><span class="hs-identifier hs-var">tcg_env</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621683116849"><span class="annot"><a href="#local-6989586621683116849"><span class="hs-identifier hs-var">tcl_env</span></a></span></span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span id="local-6989586621683116850"><span class="annot"><a href="#local-6989586621683116850"><span class="hs-identifier hs-var">lie1</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.Monad.html#setGblEnv"><span class="hs-identifier hs-type">setGblEnv</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683116828"><span class="hs-identifier hs-type">tcg_env</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span>
</span><span id="line-731"></span><span>                                      </span><span class="annot"><a href="GHC.Tc.Solver.html#captureTopConstraints"><span class="hs-identifier hs-type">captureTopConstraints</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span>
</span><span id="line-732"></span><span>                                      </span><span class="annot"><a href="GHC.Tc.Module.html#tcTopSrcDecls"><span class="hs-identifier hs-type">tcTopSrcDecls</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683116829"><span class="hs-identifier hs-type">rn_decls</span></a></span><span>
</span><span id="line-733"></span><span>
</span><span id="line-734"></span><span>        </span><span class="hs-comment">-- If there is no splice, we're nearly done</span><span>
</span><span id="line-735"></span><span>      </span><span class="hs-special">;</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.Monad.html#restoreEnvs"><span class="hs-identifier hs-type">restoreEnvs</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621683116848"><span class="hs-identifier hs-type">tcg_env</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="#local-6989586621683116849"><span class="hs-identifier hs-type">tcl_env</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span>
</span><span id="line-736"></span><span>        </span><span class="hs-keyword">case</span><span> </span><span class="annot"><a href="#local-6989586621683116821"><span class="hs-identifier hs-type">group_tail</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-737"></span><span>          </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">Maybe (SpliceDecl GhcPs, [GenLocated SrcSpanAnnA (HsDecl GhcPs)])
</span><span class="hs-identifier hs-var">Nothing</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">(TcGblEnv, TcLclEnv, WantedConstraints)
-&gt; TcM (TcGblEnv, TcLclEnv, WantedConstraints)
forall a. a -&gt; IOEnv (Env TcGblEnv TcLclEnv) a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TcGblEnv
</span><a href="#local-6989586621683116848"><span class="hs-identifier hs-var">tcg_env</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">TcLclEnv
</span><a href="#local-6989586621683116849"><span class="hs-identifier hs-var">tcl_env</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">WantedConstraints
</span><a href="#local-6989586621683116850"><span class="hs-identifier hs-var">lie1</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-738"></span><span>
</span><span id="line-739"></span><span>            </span><span class="hs-comment">-- If there's a splice, we must carry on</span><span>
</span><span id="line-740"></span><span>          </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Language.Haskell.Syntax.Decls.html#SpliceDecl"><span class="hs-identifier hs-type">SpliceDecl</span></a></span><span> </span><span class="annot"><span class="annottext">XSpliceDecl GhcPs
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Types.SrcLoc.html#L"><span class="hs-identifier hs-type">L</span></a></span><span> </span><span class="annot"><span class="annottext">SrcSpanAnnA
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621683116851"><span class="annot"><span class="annottext">HsUntypedSplice GhcPs
</span><a href="#local-6989586621683116851"><span class="hs-identifier hs-var">splice</span></a></span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">SpliceDecoration
</span><span class="hs-identifier">_</span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621683116852"><span class="annot"><span class="annottext">[GenLocated SrcSpanAnnA (HsDecl GhcPs)]
</span><a href="#local-6989586621683116852"><span class="hs-identifier hs-var">rest_ds</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-741"></span><span>            </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span>
</span><span id="line-742"></span><span>                 </span><span class="hs-comment">-- We need to simplify any constraints from the previous declaration</span><span>
</span><span id="line-743"></span><span>                 </span><span class="hs-comment">-- group, or else we might reify metavariables, as in #16980.</span><span>
</span><span id="line-744"></span><span>               </span><span class="hs-special">;</span><span> </span><span id="local-6989586621683116853"><span class="annot"><a href="#local-6989586621683116853"><span class="hs-identifier hs-var">ev_binds1</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">WantedConstraints -&gt; TcRn (Bag EvBind)
</span><a href="GHC.Tc.Solver.html#simplifyTop"><span class="hs-identifier hs-var">simplifyTop</span></a></span><span> </span><span class="annot"><span class="annottext">WantedConstraints
</span><a href="#local-6989586621683116850"><span class="hs-identifier hs-var">lie1</span></a></span><span>
</span><span id="line-745"></span><span>
</span><span id="line-746"></span><span>                 </span><span class="hs-comment">-- Rename the splice expression, and get its supporting decls</span><span>
</span><span id="line-747"></span><span>               </span><span class="hs-special">;</span><span> </span><span class="hs-special">(</span><span id="local-6989586621683116854"><span class="annot"><a href="#local-6989586621683116854"><span class="hs-identifier hs-var">spliced_decls</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621683116855"><span class="annot"><a href="#local-6989586621683116855"><span class="hs-identifier hs-var">splice_fvs</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><a href="GHC.Rename.Splice.html#rnTopSpliceDecls"><span class="hs-identifier hs-type">rnTopSpliceDecls</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683116851"><span class="hs-identifier hs-type">splice</span></a></span><span>
</span><span id="line-748"></span><span>
</span><span id="line-749"></span><span>                 </span><span class="hs-comment">-- Glue them on the front of the remaining decls and loop</span><span>
</span><span id="line-750"></span><span>               </span><span class="hs-special">;</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.Monad.html#setGblEnv"><span class="hs-identifier hs-type">setGblEnv</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621683116848"><span class="hs-identifier hs-type">tcg_env</span></a></span><span> </span><span class="annot"><a href="GHC.Rename.Module.html#addTcgDUs"><span class="hs-operator hs-type">`addTcgDUs`</span></a></span><span> </span><span class="annot"><a href="GHC.Types.Name.Set.html#usesOnly"><span class="hs-identifier hs-type">usesOnly</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683116855"><span class="hs-identifier hs-type">splice_fvs</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span>
</span><span id="line-751"></span><span>                 </span><span class="annot"><a href="GHC.Tc.Utils.Monad.html#addTopEvBinds"><span class="hs-identifier hs-type">addTopEvBinds</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683116853"><span class="hs-identifier hs-type">ev_binds1</span></a></span><span>                             </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span>
</span><span id="line-752"></span><span>                 </span><span class="annot"><a href="GHC.Tc.Module.html#tc_rn_src_decls"><span class="hs-identifier hs-type">tc_rn_src_decls</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621683116854"><span class="hs-identifier hs-type">spliced_decls</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">++</span></span><span> </span><span class="annot"><a href="#local-6989586621683116852"><span class="hs-identifier hs-type">rest_ds</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-753"></span><span>               </span><span class="hs-special">}</span><span>
</span><span id="line-754"></span><span>          </span><span class="hs-special">}</span><span>
</span><span id="line-755"></span><span>      </span><span class="hs-special">}</span><span>
</span><span id="line-756"></span><span>
</span><span id="line-757"></span><span class="hs-comment">{-
************************************************************************
*                                                                      *
        Compiling hs-boot source files, and
        comparing the hi-boot interface with the real thing
*                                                                      *
************************************************************************
-}</span><span>
</span><span id="line-765"></span><span>
</span><span id="line-766"></span><span class="annot"><a href="GHC.Tc.Module.html#tcRnHsBootDecls"><span class="hs-identifier hs-type">tcRnHsBootDecls</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Types.SourceFile.html#HsBootOrSig"><span class="hs-identifier hs-type">HsBootOrSig</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="Language.Haskell.Syntax.Decls.html#LHsDecl"><span class="hs-identifier hs-type">LHsDecl</span></a></span><span> </span><span class="annot"><a href="GHC.Hs.Extension.html#GhcPs"><span class="hs-identifier hs-type">GhcPs</span></a></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#TcM"><span class="hs-identifier hs-type">TcM</span></a></span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#TcGblEnv"><span class="hs-identifier hs-type">TcGblEnv</span></a></span><span>
</span><span id="line-767"></span><span id="tcRnHsBootDecls"><span class="annot"><span class="annottext">tcRnHsBootDecls :: HsBootOrSig -&gt; [LHsDecl GhcPs] -&gt; TcM TcGblEnv
</span><a href="GHC.Tc.Module.html#tcRnHsBootDecls"><span class="hs-identifier hs-var hs-var">tcRnHsBootDecls</span></a></span></span><span> </span><span id="local-6989586621683116858"><span class="annot"><span class="annottext">HsBootOrSig
</span><a href="#local-6989586621683116858"><span class="hs-identifier hs-var">boot_or_sig</span></a></span></span><span> </span><span id="local-6989586621683116859"><span class="annot"><span class="annottext">[LHsDecl GhcPs]
</span><a href="#local-6989586621683116859"><span class="hs-identifier hs-var">decls</span></a></span></span><span>
</span><span id="line-768"></span><span>   </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span class="hs-special">(</span><span id="local-6989586621683116860"><span class="annot"><a href="#local-6989586621683116860"><span class="hs-identifier hs-var">first_group</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621683116861"><span class="annot"><a href="#local-6989586621683116861"><span class="hs-identifier hs-var">group_tail</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">[LHsDecl GhcPs]
-&gt; RnM (HsGroup GhcPs, Maybe (SpliceDecl GhcPs, [LHsDecl GhcPs]))
</span><a href="GHC.Rename.Module.html#findSplice"><span class="hs-identifier hs-var">findSplice</span></a></span><span> </span><span class="annot"><span class="annottext">[LHsDecl GhcPs]
</span><a href="#local-6989586621683116859"><span class="hs-identifier hs-var">decls</span></a></span><span>
</span><span id="line-769"></span><span>
</span><span id="line-770"></span><span>                </span><span class="hs-comment">-- Rename the declarations</span><span>
</span><span id="line-771"></span><span>        </span><span class="hs-special">;</span><span> </span><span class="hs-special">(</span><span id="local-6989586621683116862"><span class="annot"><a href="#local-6989586621683116862"><span class="hs-identifier hs-var">tcg_env</span></a></span></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Language.Haskell.Syntax.Decls.html#HsGroup"><span class="hs-identifier hs-type">HsGroup</span></a></span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><a href="Language.Haskell.Syntax.Decls.html#hs_tyclds"><span class="hs-identifier hs-var">hs_tyclds</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="local-6989586621683116865"><span class="annot"><a href="#local-6989586621683116865"><span class="hs-identifier hs-var">tycl_decls</span></a></span></span><span>
</span><span id="line-772"></span><span>                            </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Language.Haskell.Syntax.Decls.html#hs_derivds"><span class="hs-identifier hs-var">hs_derivds</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="local-6989586621683116867"><span class="annot"><a href="#local-6989586621683116867"><span class="hs-identifier hs-var">deriv_decls</span></a></span></span><span>
</span><span id="line-773"></span><span>                            </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Language.Haskell.Syntax.Decls.html#hs_fords"><span class="hs-identifier hs-var">hs_fords</span></a></span><span>  </span><span class="hs-glyph">=</span><span> </span><span id="local-6989586621683116869"><span class="annot"><a href="#local-6989586621683116869"><span class="hs-identifier hs-var">for_decls</span></a></span></span><span>
</span><span id="line-774"></span><span>                            </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Language.Haskell.Syntax.Decls.html#hs_defds"><span class="hs-identifier hs-var">hs_defds</span></a></span><span>  </span><span class="hs-glyph">=</span><span> </span><span id="local-6989586621683116871"><span class="annot"><a href="#local-6989586621683116871"><span class="hs-identifier hs-var">def_decls</span></a></span></span><span>
</span><span id="line-775"></span><span>                            </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Language.Haskell.Syntax.Decls.html#hs_ruleds"><span class="hs-identifier hs-var">hs_ruleds</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="local-6989586621683116873"><span class="annot"><a href="#local-6989586621683116873"><span class="hs-identifier hs-var">rule_decls</span></a></span></span><span>
</span><span id="line-776"></span><span>                            </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Language.Haskell.Syntax.Decls.html#hs_annds"><span class="hs-identifier hs-var">hs_annds</span></a></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="hs-identifier">_</span></span><span>
</span><span id="line-777"></span><span>                            </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Language.Haskell.Syntax.Decls.html#hs_valds"><span class="hs-identifier hs-var">hs_valds</span></a></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="Language.Haskell.Syntax.Binds.html#XValBindsLR"><span class="hs-identifier hs-type">XValBindsLR</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Hs.Binds.html#NValBinds"><span class="hs-identifier hs-type">NValBinds</span></a></span><span> </span><span id="local-6989586621683116878"><span class="annot"><a href="#local-6989586621683116878"><span class="hs-identifier hs-var">val_binds</span></a></span></span><span> </span><span id="local-6989586621683116879"><span class="annot"><a href="#local-6989586621683116879"><span class="hs-identifier hs-var">val_sigs</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span class="hs-special">)</span><span>
</span><span id="line-778"></span><span>              </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><a href="GHC.Tc.Module.html#rnTopSrcDecls"><span class="hs-identifier hs-type">rnTopSrcDecls</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683116860"><span class="hs-identifier hs-type">first_group</span></a></span><span>
</span><span id="line-779"></span><span>
</span><span id="line-780"></span><span>        </span><span class="hs-special">;</span><span> </span><span class="hs-special">(</span><span id="local-6989586621683116880"><span class="annot"><a href="#local-6989586621683116880"><span class="hs-identifier hs-var">gbl_env</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621683116881"><span class="annot"><a href="#local-6989586621683116881"><span class="hs-identifier hs-var">lie</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.Monad.html#setGblEnv"><span class="hs-identifier hs-type">setGblEnv</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683116862"><span class="hs-identifier hs-type">tcg_env</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="annot"><a href="GHC.Tc.Solver.html#captureTopConstraints"><span class="hs-identifier hs-type">captureTopConstraints</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span>
</span><span id="line-781"></span><span>              </span><span class="hs-comment">-- NB: setGblEnv **before** captureTopConstraints so that</span><span>
</span><span id="line-782"></span><span>              </span><span class="hs-comment">-- if the latter reports errors, it knows what's in scope</span><span>
</span><span id="line-783"></span><span>
</span><span id="line-784"></span><span>                </span><span class="hs-comment">-- Check for illegal declarations</span><span>
</span><span id="line-785"></span><span>        </span><span class="hs-special">;</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><a href="#local-6989586621683116861"><span class="hs-identifier hs-type">group_tail</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-786"></span><span>             </span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Language.Haskell.Syntax.Decls.html#SpliceDecl"><span class="hs-identifier hs-type">SpliceDecl</span></a></span><span> </span><span class="annot"><span class="annottext">XSpliceDecl GhcPs
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621683116882"><span class="annot"><span class="annottext">XRec GhcPs (HsUntypedSplice GhcPs)
</span><a href="#local-6989586621683116882"><span class="hs-identifier hs-var">d</span></a></span></span><span> </span><span class="annot"><span class="annottext">SpliceDecoration
</span><span class="hs-identifier">_</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">[GenLocated SrcSpanAnnA (HsDecl GhcPs)]
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">HsBootOrSig
-&gt; (NonEmpty (GenLocated SrcSpanAnnA (HsUntypedSplice GhcPs))
    -&gt; BadBootDecls)
-&gt; [GenLocated SrcSpanAnnA (HsUntypedSplice GhcPs)]
-&gt; IOEnv (Env TcGblEnv TcLclEnv) ()
forall decl.
HsBootOrSig
-&gt; (NonEmpty (LocatedA decl) -&gt; BadBootDecls)
-&gt; [LocatedA decl]
-&gt; IOEnv (Env TcGblEnv TcLclEnv) ()
</span><a href="GHC.Rename.Bind.html#rejectBootDecls"><span class="hs-identifier hs-var">rejectBootDecls</span></a></span><span> </span><span class="annot"><span class="annottext">HsBootOrSig
</span><a href="#local-6989586621683116858"><span class="hs-identifier hs-var">boot_or_sig</span></a></span><span> </span><span class="annot"><span class="annottext">NonEmpty (GenLocated SrcSpanAnnA (HsUntypedSplice GhcPs))
-&gt; BadBootDecls
</span><a href="GHC.Tc.Errors.Types.html#BootSpliceDecls"><span class="hs-identifier hs-var">BootSpliceDecls</span></a></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">XRec GhcPs (HsUntypedSplice GhcPs)
GenLocated SrcSpanAnnA (HsUntypedSplice GhcPs)
</span><a href="#local-6989586621683116882"><span class="hs-identifier hs-var">d</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-787"></span><span>             </span><span class="annot"><span class="annottext">Maybe (SpliceDecl GhcPs, [GenLocated SrcSpanAnnA (HsDecl GhcPs)])
</span><span class="hs-identifier hs-var">Nothing</span></span><span>                    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">() -&gt; IOEnv (Env TcGblEnv TcLclEnv) ()
forall a. a -&gt; IOEnv (Env TcGblEnv TcLclEnv) a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-788"></span><span>        </span><span class="hs-special">;</span><span> </span><span class="annot"><a href="GHC.Rename.Bind.html#rejectBootDecls"><span class="hs-identifier hs-type">rejectBootDecls</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683116858"><span class="hs-identifier hs-type">boot_or_sig</span></a></span><span> </span><span class="annot"><a href="GHC.Tc.Errors.Types.html#BootForeignDecls"><span class="hs-identifier hs-type">BootForeignDecls</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683116869"><span class="hs-identifier hs-type">for_decls</span></a></span><span>
</span><span id="line-789"></span><span>        </span><span class="hs-special">;</span><span> </span><span class="annot"><a href="GHC.Rename.Bind.html#rejectBootDecls"><span class="hs-identifier hs-type">rejectBootDecls</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683116858"><span class="hs-identifier hs-type">boot_or_sig</span></a></span><span> </span><span class="annot"><a href="GHC.Tc.Errors.Types.html#BootDefaultDecls"><span class="hs-identifier hs-type">BootDefaultDecls</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683116871"><span class="hs-identifier hs-type">def_decls</span></a></span><span>
</span><span id="line-790"></span><span>        </span><span class="hs-special">;</span><span> </span><span class="annot"><a href="GHC.Rename.Bind.html#rejectBootDecls"><span class="hs-identifier hs-type">rejectBootDecls</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683116858"><span class="hs-identifier hs-type">boot_or_sig</span></a></span><span> </span><span class="annot"><a href="GHC.Tc.Errors.Types.html#BootRuleDecls"><span class="hs-identifier hs-type">BootRuleDecls</span></a></span><span>    </span><span class="annot"><a href="#local-6989586621683116873"><span class="hs-identifier hs-type">rule_decls</span></a></span><span>
</span><span id="line-791"></span><span>
</span><span id="line-792"></span><span>                </span><span class="hs-comment">-- Typecheck type/class/instance decls</span><span>
</span><span id="line-793"></span><span>        </span><span class="hs-special">;</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.Monad.html#traceTc"><span class="hs-identifier hs-type">traceTc</span></a></span><span> </span><span class="annot"><span class="hs-string">&quot;Tc2 (boot)&quot;</span></span><span> </span><span class="annot"><a href="GHC.Utils.Outputable.html#empty"><span class="hs-identifier hs-type">empty</span></a></span><span>
</span><span id="line-794"></span><span>        </span><span class="hs-special">;</span><span> </span><span class="hs-special">(</span><span id="local-6989586621683116887"><span class="annot"><a href="#local-6989586621683116887"><span class="hs-identifier hs-var">tcg_env</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621683116888"><span class="annot"><a href="#local-6989586621683116888"><span class="hs-identifier hs-var">inst_infos</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621683116889"><span class="annot"><a href="#local-6989586621683116889"><span class="hs-identifier hs-var">_deriv_binds</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621683116890"><span class="annot"><a href="#local-6989586621683116890"><span class="hs-identifier hs-var">_th_bndrs</span></a></span></span><span class="hs-special">)</span><span>
</span><span id="line-795"></span><span>             </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><a href="GHC.Tc.Module.html#tcTyClsInstDecls"><span class="hs-identifier hs-type">tcTyClsInstDecls</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683116865"><span class="hs-identifier hs-type">tycl_decls</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683116867"><span class="hs-identifier hs-type">deriv_decls</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683116871"><span class="hs-identifier hs-type">def_decls</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683116878"><span class="hs-identifier hs-type">val_binds</span></a></span><span>
</span><span id="line-796"></span><span>        </span><span class="hs-special">;</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.Monad.html#setGblEnv"><span class="hs-identifier hs-type">setGblEnv</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683116887"><span class="hs-identifier hs-type">tcg_env</span></a></span><span>     </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span>
</span><span id="line-797"></span><span>
</span><span id="line-798"></span><span>        </span><span class="hs-comment">-- Emit Typeable bindings</span><span>
</span><span id="line-799"></span><span>        </span><span class="hs-special">;</span><span> </span><span id="local-6989586621683116892"><span class="annot"><a href="#local-6989586621683116892"><span class="hs-identifier hs-var">tcg_env</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><a href="GHC.Tc.Instance.Typeable.html#mkTypeableBinds"><span class="hs-identifier hs-type">mkTypeableBinds</span></a></span><span>
</span><span id="line-800"></span><span>        </span><span class="hs-special">;</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.Monad.html#setGblEnv"><span class="hs-identifier hs-type">setGblEnv</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683116892"><span class="hs-identifier hs-type">tcg_env</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span>
</span><span id="line-801"></span><span>
</span><span id="line-802"></span><span>                </span><span class="hs-comment">-- Typecheck value declarations</span><span>
</span><span id="line-803"></span><span>        </span><span class="hs-special">;</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.Monad.html#traceTc"><span class="hs-identifier hs-type">traceTc</span></a></span><span> </span><span class="annot"><span class="hs-string">&quot;Tc5&quot;</span></span><span> </span><span class="annot"><a href="GHC.Utils.Outputable.html#empty"><span class="hs-identifier hs-type">empty</span></a></span><span>
</span><span id="line-804"></span><span>        </span><span class="hs-special">;</span><span> </span><span id="local-6989586621683116893"><span class="annot"><a href="#local-6989586621683116893"><span class="hs-identifier hs-var">val_ids</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><a href="GHC.Tc.Gen.Bind.html#tcHsBootSigs"><span class="hs-identifier hs-type">tcHsBootSigs</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683116878"><span class="hs-identifier hs-type">val_binds</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683116879"><span class="hs-identifier hs-type">val_sigs</span></a></span><span>
</span><span id="line-805"></span><span>
</span><span id="line-806"></span><span>                </span><span class="hs-comment">-- Wrap up</span><span>
</span><span id="line-807"></span><span>                </span><span class="hs-comment">-- No simplification or zonking to do</span><span>
</span><span id="line-808"></span><span>        </span><span class="hs-special">;</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.Monad.html#traceTc"><span class="hs-identifier hs-type">traceTc</span></a></span><span> </span><span class="annot"><span class="hs-string">&quot;Tc7a&quot;</span></span><span> </span><span class="annot"><a href="GHC.Utils.Outputable.html#empty"><span class="hs-identifier hs-type">empty</span></a></span><span>
</span><span id="line-809"></span><span>        </span><span class="hs-special">;</span><span> </span><span id="local-6989586621683116895"><span class="annot"><a href="#local-6989586621683116895"><span class="hs-identifier hs-var">gbl_env</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.Monad.html#getGblEnv"><span class="hs-identifier hs-type">getGblEnv</span></a></span><span>
</span><span id="line-810"></span><span>
</span><span id="line-811"></span><span>                </span><span class="hs-comment">-- Make the final type-env</span><span>
</span><span id="line-812"></span><span>                </span><span class="hs-comment">-- Include the dfun_ids so that their type sigs</span><span>
</span><span id="line-813"></span><span>                </span><span class="hs-comment">-- are written into the interface file.</span><span>
</span><span id="line-814"></span><span>        </span><span class="hs-special">;</span><span> </span><span class="hs-keyword">let</span><span> </span><span class="hs-special">{</span><span> </span><span id="local-6989586621683116896"><span class="annot"><a href="#local-6989586621683116896"><span class="hs-identifier hs-var hs-var">type_env0</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">TcGblEnv -&gt; TypeEnv
</span><a href="GHC.Tc.Types.html#tcg_type_env"><span class="hs-identifier hs-var">tcg_type_env</span></a></span><span> </span><span class="annot"><span class="annottext">TcGblEnv
</span><a href="#local-6989586621683116895"><span class="hs-identifier hs-var">gbl_env</span></a></span><span>
</span><span id="line-815"></span><span>              </span><span class="hs-special">;</span><span> </span><span id="local-6989586621683116897"><span class="annot"><a href="#local-6989586621683116897"><span class="hs-identifier hs-var hs-var">type_env1</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">TypeEnv -&gt; [Id] -&gt; TypeEnv
</span><a href="GHC.Types.TypeEnv.html#extendTypeEnvWithIds"><span class="hs-identifier hs-var">extendTypeEnvWithIds</span></a></span><span> </span><span class="annot"><span class="annottext">TypeEnv
</span><a href="#local-6989586621683116896"><span class="hs-identifier hs-var">type_env0</span></a></span><span> </span><span class="annot"><span class="annottext">[Id]
</span><a href="#local-6989586621683116893"><span class="hs-identifier hs-var">val_ids</span></a></span><span>
</span><span id="line-816"></span><span>              </span><span class="hs-special">;</span><span> </span><span id="local-6989586621683116899"><span class="annot"><a href="#local-6989586621683116899"><span class="hs-identifier hs-var hs-var">type_env2</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">TypeEnv -&gt; [Id] -&gt; TypeEnv
</span><a href="GHC.Types.TypeEnv.html#extendTypeEnvWithIds"><span class="hs-identifier hs-var">extendTypeEnvWithIds</span></a></span><span> </span><span class="annot"><span class="annottext">TypeEnv
</span><a href="#local-6989586621683116897"><span class="hs-identifier hs-var">type_env1</span></a></span><span> </span><span class="annot"><span class="annottext">[Id]
</span><a href="#local-6989586621683116900"><span class="hs-identifier hs-var">dfun_ids</span></a></span><span>
</span><span id="line-817"></span><span>              </span><span class="hs-special">;</span><span> </span><span id="local-6989586621683116900"><span class="annot"><a href="#local-6989586621683116900"><span class="hs-identifier hs-var hs-var">dfun_ids</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(InstInfo (GhcPass 'Renamed) -&gt; Id)
-&gt; [InstInfo (GhcPass 'Renamed)] -&gt; [Id]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><span class="hs-identifier hs-var">map</span></span><span> </span><span class="annot"><span class="annottext">InstInfo (GhcPass 'Renamed) -&gt; Id
forall a. InstInfo a -&gt; Id
</span><a href="GHC.Tc.Utils.Env.html#iDFunId"><span class="hs-identifier hs-var">iDFunId</span></a></span><span> </span><span class="annot"><span class="annottext">[InstInfo (GhcPass 'Renamed)]
</span><a href="#local-6989586621683116888"><span class="hs-identifier hs-var">inst_infos</span></a></span><span>
</span><span id="line-818"></span><span>              </span><span class="hs-special">}</span><span>
</span><span id="line-819"></span><span>
</span><span id="line-820"></span><span>        </span><span class="hs-special">;</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.Env.html#setGlobalTypeEnv"><span class="hs-identifier hs-type">setGlobalTypeEnv</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683116895"><span class="hs-identifier hs-type">gbl_env</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683116899"><span class="hs-identifier hs-type">type_env2</span></a></span><span>
</span><span id="line-821"></span><span>   </span><span class="hs-special">}</span><span class="hs-special">}</span><span class="hs-special">}</span><span>
</span><span id="line-822"></span><span>   </span><span class="hs-special">;</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.Monad.html#traceTc"><span class="hs-identifier hs-type">traceTc</span></a></span><span> </span><span class="annot"><span class="hs-string">&quot;boot&quot;</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-type">ppr</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683116881"><span class="hs-identifier hs-type">lie</span></a></span><span class="hs-special">)</span><span class="hs-special">;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">return</span></span><span> </span><span class="annot"><a href="#local-6989586621683116880"><span class="hs-identifier hs-type">gbl_env</span></a></span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-823"></span><span>
</span><span id="line-824"></span><span class="hs-comment">{-
Once we've typechecked the body of the module, we want to compare what
we've found (gathered in a TypeEnv) with the hi-boot details (if any).
-}</span><span>
</span><span id="line-828"></span><span>
</span><span id="line-829"></span><span class="annot"><a href="GHC.Tc.Module.html#checkHiBootIface"><span class="hs-identifier hs-type">checkHiBootIface</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#TcGblEnv"><span class="hs-identifier hs-type">TcGblEnv</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#SelfBootInfo"><span class="hs-identifier hs-type">SelfBootInfo</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#TcM"><span class="hs-identifier hs-type">TcM</span></a></span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#TcGblEnv"><span class="hs-identifier hs-type">TcGblEnv</span></a></span><span>
</span><span id="line-830"></span><span class="hs-comment">-- Compare the hi-boot file for this module (if there is one)</span><span>
</span><span id="line-831"></span><span class="hs-comment">-- with the type environment we've just come up with</span><span>
</span><span id="line-832"></span><span class="hs-comment">-- In the common case where there is no hi-boot file, the list</span><span>
</span><span id="line-833"></span><span class="hs-comment">-- of boot_names is empty.</span><span>
</span><span id="line-834"></span><span>
</span><span id="line-835"></span><span id="checkHiBootIface"><span class="annot"><span class="annottext">checkHiBootIface :: TcGblEnv -&gt; SelfBootInfo -&gt; TcM TcGblEnv
</span><a href="GHC.Tc.Module.html#checkHiBootIface"><span class="hs-identifier hs-var hs-var">checkHiBootIface</span></a></span></span><span> </span><span id="local-6989586621683116902"><span class="annot"><span class="annottext">TcGblEnv
</span><a href="#local-6989586621683116902"><span class="hs-identifier hs-var">tcg_env</span></a></span></span><span> </span><span id="local-6989586621683116903"><span class="annot"><span class="annottext">SelfBootInfo
</span><a href="#local-6989586621683116903"><span class="hs-identifier hs-var">boot_info</span></a></span></span><span>
</span><span id="line-836"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">SelfBootInfo
</span><a href="GHC.Tc.Types.html#NoSelfBoot"><span class="hs-identifier hs-var">NoSelfBoot</span></a></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">SelfBootInfo
</span><a href="#local-6989586621683116903"><span class="hs-identifier hs-var">boot_info</span></a></span><span>  </span><span class="hs-comment">-- Common case</span><span>
</span><span id="line-837"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">TcGblEnv -&gt; TcM TcGblEnv
forall a. a -&gt; IOEnv (Env TcGblEnv TcLclEnv) a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="annot"><span class="annottext">TcGblEnv
</span><a href="#local-6989586621683116902"><span class="hs-identifier hs-var">tcg_env</span></a></span><span>
</span><span id="line-838"></span><span>
</span><span id="line-839"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">HscSource
</span><a href="GHC.Types.SourceFile.html#HsBootFile"><span class="hs-identifier hs-var">HsBootFile</span></a></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">TcGblEnv -&gt; HscSource
</span><a href="GHC.Tc.Types.html#tcg_src"><span class="hs-identifier hs-var">tcg_src</span></a></span><span> </span><span class="annot"><span class="annottext">TcGblEnv
</span><a href="#local-6989586621683116902"><span class="hs-identifier hs-var">tcg_env</span></a></span><span>   </span><span class="hs-comment">-- Current module is already a hs-boot file!</span><span>
</span><span id="line-840"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">TcGblEnv -&gt; TcM TcGblEnv
forall a. a -&gt; IOEnv (Env TcGblEnv TcLclEnv) a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="annot"><span class="annottext">TcGblEnv
</span><a href="#local-6989586621683116902"><span class="hs-identifier hs-var">tcg_env</span></a></span><span>
</span><span id="line-841"></span><span>
</span><span id="line-842"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#SelfBoot"><span class="hs-identifier hs-type">SelfBoot</span></a></span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">sb_mds :: SelfBootInfo -&gt; ModDetails
</span><a href="GHC.Tc.Types.html#sb_mds"><span class="hs-identifier hs-var">sb_mds</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="local-6989586621683116908"><span class="annot"><span class="annottext">ModDetails
</span><a href="#local-6989586621683116908"><span class="hs-identifier hs-var">boot_details</span></a></span></span><span> </span><span class="hs-special">}</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">SelfBootInfo
</span><a href="#local-6989586621683116903"><span class="hs-identifier hs-var">boot_info</span></a></span><span>
</span><span id="line-843"></span><span>  </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#TcGblEnv"><span class="hs-identifier hs-type">TcGblEnv</span></a></span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">tcg_binds :: TcGblEnv -&gt; LHsBinds GhcTc
</span><a href="GHC.Tc.Types.html#tcg_binds"><span class="hs-identifier hs-var">tcg_binds</span></a></span><span>    </span><span class="hs-glyph">=</span><span> </span><span id="local-6989586621683116909"><span class="annot"><span class="annottext">LHsBinds GhcTc
</span><a href="#local-6989586621683116909"><span class="hs-identifier hs-var">binds</span></a></span></span><span>
</span><span id="line-844"></span><span>             </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">tcg_insts :: TcGblEnv -&gt; [ClsInst]
</span><a href="GHC.Tc.Types.html#tcg_insts"><span class="hs-identifier hs-var">tcg_insts</span></a></span><span>    </span><span class="hs-glyph">=</span><span> </span><span id="local-6989586621683116911"><span class="annot"><span class="annottext">[ClsInst]
</span><a href="#local-6989586621683116911"><span class="hs-identifier hs-var">local_insts</span></a></span></span><span>
</span><span id="line-845"></span><span>             </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">tcg_type_env :: TcGblEnv -&gt; TypeEnv
</span><a href="GHC.Tc.Types.html#tcg_type_env"><span class="hs-identifier hs-var">tcg_type_env</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="local-6989586621683116912"><span class="annot"><span class="annottext">TypeEnv
</span><a href="#local-6989586621683116912"><span class="hs-identifier hs-var">local_type_env</span></a></span></span><span>
</span><span id="line-846"></span><span>             </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">tcg_exports :: TcGblEnv -&gt; [AvailInfo]
</span><a href="GHC.Tc.Types.html#tcg_exports"><span class="hs-identifier hs-var">tcg_exports</span></a></span><span>  </span><span class="hs-glyph">=</span><span> </span><span id="local-6989586621683116914"><span class="annot"><span class="annottext">[AvailInfo]
</span><a href="#local-6989586621683116914"><span class="hs-identifier hs-var">local_exports</span></a></span></span><span> </span><span class="hs-special">}</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">TcGblEnv
</span><a href="#local-6989586621683116902"><span class="hs-identifier hs-var">tcg_env</span></a></span><span>
</span><span id="line-847"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>  </span><span class="hs-special">{</span><span> </span><span class="hs-comment">-- This code is tricky, see Note [DFun knot-tying]</span><span>
</span><span id="line-848"></span><span>        </span><span class="hs-special">;</span><span> </span><span id="local-6989586621683116915"><span class="annot"><a href="#local-6989586621683116915"><span class="hs-identifier hs-var">imp_prs</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">[ClsInst] -&gt; TypeEnv -&gt; [AvailInfo] -&gt; ModDetails -&gt; TcM [(Id, Id)]
</span><a href="GHC.Tc.Module.html#checkHiBootIface%27"><span class="hs-identifier hs-var">checkHiBootIface'</span></a></span><span> </span><span class="annot"><span class="annottext">[ClsInst]
</span><a href="#local-6989586621683116911"><span class="hs-identifier hs-var">local_insts</span></a></span><span> </span><span class="annot"><span class="annottext">TypeEnv
</span><a href="#local-6989586621683116912"><span class="hs-identifier hs-var">local_type_env</span></a></span><span>
</span><span id="line-849"></span><span>                                       </span><span class="annot"><span class="annottext">[AvailInfo]
</span><a href="#local-6989586621683116914"><span class="hs-identifier hs-var">local_exports</span></a></span><span> </span><span class="annot"><span class="annottext">ModDetails
</span><a href="#local-6989586621683116908"><span class="hs-identifier hs-var">boot_details</span></a></span><span>
</span><span id="line-850"></span><span>
</span><span id="line-851"></span><span>        </span><span class="hs-comment">-- Now add the impedance-matching boot bindings:</span><span>
</span><span id="line-852"></span><span>        </span><span class="hs-comment">--</span><span>
</span><span id="line-853"></span><span>        </span><span class="hs-comment">--  - dfun bindings  $fxblah = $fblah</span><span>
</span><span id="line-854"></span><span>        </span><span class="hs-comment">--  - record bindings fld{var} = fld{rec field of ..}</span><span>
</span><span id="line-855"></span><span>        </span><span class="hs-comment">--</span><span>
</span><span id="line-856"></span><span>        </span><span class="hs-comment">-- to (a) the type envt, and (b) the top-level bindings</span><span>
</span><span id="line-857"></span><span>        </span><span class="hs-special">;</span><span> </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621683116916"><span class="annot"><a href="#local-6989586621683116916"><span class="hs-identifier hs-var hs-var">boot_impedance_bds</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">((Id, Id) -&gt; Id) -&gt; [(Id, Id)] -&gt; [Id]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><span class="hs-identifier hs-var">map</span></span><span> </span><span class="annot"><span class="annottext">(Id, Id) -&gt; Id
forall a b. (a, b) -&gt; a
</span><span class="hs-identifier hs-var">fst</span></span><span> </span><span class="annot"><span class="annottext">[(Id, Id)]
</span><a href="#local-6989586621683116915"><span class="hs-identifier hs-var">imp_prs</span></a></span><span>
</span><span id="line-858"></span><span>              </span><span id="local-6989586621683116918"><span class="annot"><a href="#local-6989586621683116918"><span class="hs-identifier hs-var hs-var">type_env'</span></a></span></span><span>          </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">TypeEnv -&gt; [Id] -&gt; TypeEnv
</span><a href="GHC.Types.TypeEnv.html#extendTypeEnvWithIds"><span class="hs-identifier hs-var">extendTypeEnvWithIds</span></a></span><span> </span><span class="annot"><span class="annottext">TypeEnv
</span><a href="#local-6989586621683116912"><span class="hs-identifier hs-var">local_type_env</span></a></span><span> </span><span class="annot"><span class="annottext">[Id]
</span><a href="#local-6989586621683116916"><span class="hs-identifier hs-var">boot_impedance_bds</span></a></span><span>
</span><span id="line-859"></span><span>              </span><span id="local-6989586621683116919"><span class="annot"><a href="#local-6989586621683116919"><span class="hs-identifier hs-var hs-var">impedance_binds</span></a></span></span><span>    </span><span class="hs-glyph">=</span><span>  </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">IdP GhcTc -&gt; LHsExpr GhcTc -&gt; LHsBind GhcTc
</span><a href="GHC.Hs.Utils.html#mkVarBind"><span class="hs-identifier hs-var">mkVarBind</span></a></span><span> </span><span class="annot"><span class="annottext">IdP GhcTc
Id
</span><a href="#local-6989586621683116921"><span class="hs-identifier hs-var">boot_id</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">IdP GhcTc -&gt; LHsExpr GhcTc
forall (p :: Pass) a.
IsSrcSpanAnn p a =&gt;
IdP (GhcPass p) -&gt; LHsExpr (GhcPass p)
</span><a href="GHC.Hs.Utils.html#nlHsVar"><span class="hs-identifier hs-var">nlHsVar</span></a></span><span> </span><span class="annot"><span class="annottext">IdP GhcTc
Id
</span><a href="#local-6989586621683116923"><span class="hs-identifier hs-var">id</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-860"></span><span>                                    </span><span class="hs-glyph">|</span><span> </span><span class="hs-special">(</span><span id="local-6989586621683116921"><span class="annot"><span class="annottext">Id
</span><a href="#local-6989586621683116921"><span class="hs-identifier hs-var">boot_id</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621683116923"><span class="annot"><span class="annottext">Id
</span><a href="#local-6989586621683116923"><span class="hs-identifier hs-var">id</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">[(Id, Id)]
</span><a href="#local-6989586621683116915"><span class="hs-identifier hs-var">imp_prs</span></a></span><span> </span><span class="hs-special">]</span><span>
</span><span id="line-861"></span><span>              </span><span id="local-6989586621683116924"><span class="annot"><a href="#local-6989586621683116924"><span class="hs-identifier hs-var hs-var">tcg_env_w_binds</span></a></span></span><span>
</span><span id="line-862"></span><span>                </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">TcGblEnv
</span><a href="#local-6989586621683116902"><span class="hs-identifier hs-var">tcg_env</span></a></span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#tcg_binds"><span class="hs-identifier hs-var">tcg_binds</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="#local-6989586621683116909"><span class="hs-identifier hs-type">binds</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">++</span></span><span> </span><span class="annot"><a href="#local-6989586621683116919"><span class="hs-identifier hs-type">impedance_binds</span></a></span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-863"></span><span>
</span><span id="line-864"></span><span>        </span><span class="hs-special">;</span><span> </span><span class="annot"><a href="#local-6989586621683116918"><span class="hs-identifier hs-type">type_env'</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">`seq`</span></span><span>
</span><span id="line-865"></span><span>             </span><span class="hs-comment">-- Why the seq?  Without, we will put a TypeEnv thunk in</span><span>
</span><span id="line-866"></span><span>             </span><span class="hs-comment">-- tcg_type_env_var.  That thunk will eventually get</span><span>
</span><span id="line-867"></span><span>             </span><span class="hs-comment">-- forced if we are typechecking interfaces, but that</span><span>
</span><span id="line-868"></span><span>             </span><span class="hs-comment">-- is no good if we are trying to typecheck the very</span><span>
</span><span id="line-869"></span><span>             </span><span class="hs-comment">-- DFun we were going to put in.</span><span>
</span><span id="line-870"></span><span>             </span><span class="hs-comment">-- TODO: Maybe setGlobalTypeEnv should be strict.</span><span>
</span><span id="line-871"></span><span>          </span><span class="annot"><a href="GHC.Tc.Utils.Env.html#setGlobalTypeEnv"><span class="hs-identifier hs-type">setGlobalTypeEnv</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683116924"><span class="hs-identifier hs-type">tcg_env_w_binds</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683116918"><span class="hs-identifier hs-type">type_env'</span></a></span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-872"></span><span>
</span><span id="line-873"></span><span class="hs-comment">{- Note [DFun impedance matching]
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
We return a list of &quot;impedance-matching&quot; bindings for the dfuns
defined in the hs-boot file, such as
          $fxEqT = $fEqT
We need these because the module and hi-boot file might differ in
the name it chose for the dfun: the name of a dfun is not
uniquely determined by its type; there might be multiple dfuns
which, individually, would map to the same name (in which case
we have to disambiguate them.)  There's no way for the hi file
to know exactly what disambiguation to use... without looking
at the hi-boot file itself.

In fact, the names will always differ because we always pick names
prefixed with &quot;$fx&quot; for boot dfuns, and &quot;$f&quot; for real dfuns
(so that this impedance matching is always possible).

Note [Record field impedance matching]
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
When a hs-boot file defines a function whose implementation in the hs file
is a record selector, we have to do something similar to Note [DFun impedance matching].

Example:

  -- M.hs-boot
  module M where
    data A
    fld :: A -&gt; ()

  -- M.hs
  module M where
    data A = MkA { fld :: () }

Recall from Note [Record field namespacing] in GHC.Types.Name.Occurrence that
record fields have their own namespaces. This means that M.hs exports the Id
fld{record selector of MkA} :: A -&gt; (), while M.hs-boot exports the Id
fld{variable} :: A -&gt; ().

To remedy this, we add an impedance-matching binding in M.hs:

  fld{variable} :: A -&gt; ()
  fld{variable} = fld{record selector of MkA}

Note that we imperatively need to add a binding for fld{variable} in M.hs, as we
might have an exact Name reference to it (e.g. in a module that imports M.hs-boot).
Not doing so would cause Core Lint errors, at the very least.

These bindings are returned by the check_export in checkHiBootIface', and
added to the DFun impedance-matching bindings.

[Wrinkle: exports]

  We MUST NOT add fld{variable} to the export list of M.hs, as this
  would mean that M.hs exports both a record field and variable with the same
  occNameFS, which would cause ambiguity errors at use-sites.
  It's OK to only export the field name even though the boot-file exported
  the variable: name resolution will take care of that.

Another situation is that we are re-exporting, e.g. (with M as above):

  -- N.hs-boot
  module N ( module M ) where
    import {-# SOURCE #-} M

  -- N.hs
  module N ( module M where )
    import M

In this case, N.hs-boot re-exports the variable fld, and N re-exports the
record field fld, but not the variable fld. We don't need to do anything in
this situation; in particular, don't re-export the variable name from N.hs,
as per [Wrinkle: exports] above.

Note [DFun knot-tying]
~~~~~~~~~~~~~~~~~~~~~~
The 'SelfBootInfo' that is fed into 'checkHiBootIface' comes from
typechecking the hi-boot file that we are presently implementing.
Suppose we are typechecking the module A: when we typecheck the
hi-boot file, whenever we see an identifier A.T, we knot-tie this
identifier to the *local* type environment (via if_rec_types.)  The
contract then is that we don't *look* at 'SelfBootInfo' until we've
finished typechecking the module and updated the type environment with
the new tycons and ids.

This most works well, but there is one problem: DFuns!  We do not want
to look at the mb_insts of the ModDetails in SelfBootInfo, because a
dfun in one of those ClsInsts is gotten (in GHC.IfaceToCore.tcIfaceInst) by a
(lazily evaluated) lookup in the if_rec_types.  We could extend the
type env, do a setGloblaTypeEnv etc; but that all seems very indirect.
It is much more directly simply to extract the DFunIds from the
md_types of the SelfBootInfo.

See #4003, #16038 for why we need to take care here.
-}</span><span>
</span><span id="line-967"></span><span>
</span><span id="line-968"></span><span class="annot"><a href="GHC.Tc.Module.html#checkHiBootIface%27"><span class="hs-identifier hs-type">checkHiBootIface'</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="GHC.Core.InstEnv.html#ClsInst"><span class="hs-identifier hs-type">ClsInst</span></a></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Types.TypeEnv.html#TypeEnv"><span class="hs-identifier hs-type">TypeEnv</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="GHC.Types.Avail.html#AvailInfo"><span class="hs-identifier hs-type">AvailInfo</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-969"></span><span>                  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Unit.Module.ModDetails.html#ModDetails"><span class="hs-identifier hs-type">ModDetails</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#TcM"><span class="hs-identifier hs-type">TcM</span></a></span><span> </span><span class="hs-special">[</span><span class="hs-special">(</span><span class="annot"><a href="GHC.Types.Var.html#Id"><span class="hs-identifier hs-type">Id</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Types.Var.html#Id"><span class="hs-identifier hs-type">Id</span></a></span><span class="hs-special">)</span><span class="hs-special">]</span><span>
</span><span id="line-970"></span><span class="hs-comment">-- Variant which doesn't require a full TcGblEnv; you could get the</span><span>
</span><span id="line-971"></span><span class="hs-comment">-- local components from another ModDetails.</span><span>
</span><span id="line-972"></span><span id="checkHiBootIface%27"><span class="annot"><span class="annottext">checkHiBootIface' :: [ClsInst] -&gt; TypeEnv -&gt; [AvailInfo] -&gt; ModDetails -&gt; TcM [(Id, Id)]
</span><a href="GHC.Tc.Module.html#checkHiBootIface%27"><span class="hs-identifier hs-var hs-var">checkHiBootIface'</span></a></span></span><span>
</span><span id="line-973"></span><span>        </span><span id="local-6989586621683116925"><span class="annot"><span class="annottext">[ClsInst]
</span><a href="#local-6989586621683116925"><span class="hs-identifier hs-var">local_insts</span></a></span></span><span> </span><span id="local-6989586621683116926"><span class="annot"><span class="annottext">TypeEnv
</span><a href="#local-6989586621683116926"><span class="hs-identifier hs-var">local_type_env</span></a></span></span><span> </span><span id="local-6989586621683116927"><span class="annot"><span class="annottext">[AvailInfo]
</span><a href="#local-6989586621683116927"><span class="hs-identifier hs-var">local_exports</span></a></span></span><span>
</span><span id="line-974"></span><span>        </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Unit.Module.ModDetails.html#ModDetails"><span class="hs-identifier hs-type">ModDetails</span></a></span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">md_types :: ModDetails -&gt; TypeEnv
</span><a href="GHC.Unit.Module.ModDetails.html#md_types"><span class="hs-identifier hs-var">md_types</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="local-6989586621683116930"><span class="annot"><span class="annottext">TypeEnv
</span><a href="#local-6989586621683116930"><span class="hs-identifier hs-var">boot_type_env</span></a></span></span><span>
</span><span id="line-975"></span><span>                    </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">md_fam_insts :: ModDetails -&gt; [FamInst]
</span><a href="GHC.Unit.Module.ModDetails.html#md_fam_insts"><span class="hs-identifier hs-var">md_fam_insts</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="local-6989586621683116932"><span class="annot"><span class="annottext">[FamInst]
</span><a href="#local-6989586621683116932"><span class="hs-identifier hs-var">boot_fam_insts</span></a></span></span><span>
</span><span id="line-976"></span><span>                    </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">md_exports :: ModDetails -&gt; [AvailInfo]
</span><a href="GHC.Unit.Module.ModDetails.html#md_exports"><span class="hs-identifier hs-var">md_exports</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="local-6989586621683116934"><span class="annot"><span class="annottext">[AvailInfo]
</span><a href="#local-6989586621683116934"><span class="hs-identifier hs-var">boot_exports</span></a></span></span><span> </span><span class="hs-special">}</span><span class="hs-special">)</span><span>
</span><span id="line-977"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>  </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">String -&gt; SDoc -&gt; IOEnv (Env TcGblEnv TcLclEnv) ()
</span><a href="GHC.Tc.Utils.Monad.html#traceTc"><span class="hs-identifier hs-var">traceTc</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;checkHiBootIface&quot;</span></span><span> </span><span class="annot"><span class="annottext">(SDoc -&gt; IOEnv (Env TcGblEnv TcLclEnv) ())
-&gt; SDoc -&gt; IOEnv (Env TcGblEnv TcLclEnv) ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">[SDoc] -&gt; SDoc
forall doc. IsDoc doc =&gt; [doc] -&gt; doc
</span><a href="GHC.Utils.Outputable.html#vcat"><span class="hs-identifier hs-var">vcat</span></a></span><span>
</span><span id="line-978"></span><span>             </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">TypeEnv -&gt; SDoc
forall a. Outputable a =&gt; a -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="annot"><span class="annottext">TypeEnv
</span><a href="#local-6989586621683116930"><span class="hs-identifier hs-var">boot_type_env</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">[AvailInfo] -&gt; SDoc
forall a. Outputable a =&gt; a -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="annot"><span class="annottext">[AvailInfo]
</span><a href="#local-6989586621683116934"><span class="hs-identifier hs-var">boot_exports</span></a></span><span> </span><span class="hs-special">]</span><span>
</span><span id="line-979"></span><span>
</span><span id="line-980"></span><span>        </span><span class="hs-special">;</span><span> </span><span id="local-6989586621683116936"><span class="annot"><a href="#local-6989586621683116936"><span class="hs-identifier hs-var">gre_env</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">TcRn GlobalRdrEnv
</span><a href="GHC.Tc.Utils.Monad.html#getGlobalRdrEnv"><span class="hs-identifier hs-var">getGlobalRdrEnv</span></a></span><span>
</span><span id="line-981"></span><span>
</span><span id="line-982"></span><span>                </span><span class="hs-comment">-- Check the exports of the boot module, one by one</span><span>
</span><span id="line-983"></span><span>        </span><span class="hs-special">;</span><span> </span><span id="local-6989586621683116938"><span class="annot"><a href="#local-6989586621683116938"><span class="hs-identifier hs-var">fld_prs</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><a href="GHC.Utils.Monad.html#mapMaybeM"><span class="hs-identifier hs-type">mapMaybeM</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621683116940"><span class="hs-identifier hs-type">check_export</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683116936"><span class="hs-identifier hs-type">gre_env</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><a href="#local-6989586621683116934"><span class="hs-identifier hs-type">boot_exports</span></a></span><span>
</span><span id="line-984"></span><span>
</span><span id="line-985"></span><span>                </span><span class="hs-comment">-- Check for no family instances</span><span>
</span><span id="line-986"></span><span>        </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">unless</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">null</span></span><span> </span><span class="annot"><a href="#local-6989586621683116932"><span class="hs-identifier hs-type">boot_fam_insts</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span>
</span><span id="line-987"></span><span>            </span><span class="annot"><a href="GHC.Utils.Panic.Plain.html#panic"><span class="hs-identifier hs-type">panic</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-string">&quot;GHC.Tc.Module.checkHiBootIface: Cannot handle family &quot;</span></span><span> </span><span class="annot"><span class="hs-operator hs-type">++</span></span><span>
</span><span id="line-988"></span><span>                   </span><span class="annot"><span class="hs-string">&quot;instances in boot files yet...&quot;</span></span><span class="hs-special">)</span><span>
</span><span id="line-989"></span><span>            </span><span class="hs-comment">-- FIXME: Why?  The actual comparison is not hard, but what would</span><span>
</span><span id="line-990"></span><span>            </span><span class="hs-comment">--        be the equivalent to the dfun bindings returned for class</span><span>
</span><span id="line-991"></span><span>            </span><span class="hs-comment">--        instances?  We can't easily equate tycons...</span><span>
</span><span id="line-992"></span><span>
</span><span id="line-993"></span><span>                </span><span class="hs-comment">-- Check instance declarations</span><span>
</span><span id="line-994"></span><span>                </span><span class="hs-comment">-- and generate an impedance-matching binding</span><span>
</span><span id="line-995"></span><span>        </span><span class="hs-special">;</span><span> </span><span id="local-6989586621683116943"><span class="annot"><a href="#local-6989586621683116943"><span class="hs-identifier hs-var">dfun_prs</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><a href="GHC.Utils.Monad.html#mapMaybeM"><span class="hs-identifier hs-type">mapMaybeM</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683116944"><span class="hs-identifier hs-type">check_cls_inst</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683116945"><span class="hs-identifier hs-type">boot_dfuns</span></a></span><span>
</span><span id="line-996"></span><span>
</span><span id="line-997"></span><span>        </span><span class="hs-special">;</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.Monad.html#failIfErrsM"><span class="hs-identifier hs-type">failIfErrsM</span></a></span><span>
</span><span id="line-998"></span><span>
</span><span id="line-999"></span><span>        </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">return</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621683116938"><span class="hs-identifier hs-type">fld_prs</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">++</span></span><span> </span><span class="annot"><a href="#local-6989586621683116943"><span class="hs-identifier hs-type">dfun_prs</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-1000"></span><span>
</span><span id="line-1001"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-1002"></span><span>    </span><span id="local-6989586621683116946"><span class="annot"><span class="annottext">boot_dfun_names :: [Name]
</span><a href="#local-6989586621683116946"><span class="hs-identifier hs-var hs-var">boot_dfun_names</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(Id -&gt; Name) -&gt; [Id] -&gt; [Name]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><span class="hs-identifier hs-var">map</span></span><span> </span><span class="annot"><span class="annottext">Id -&gt; Name
</span><a href="GHC.Types.Id.html#idName"><span class="hs-identifier hs-var">idName</span></a></span><span> </span><span class="annot"><span class="annottext">[Id]
</span><a href="#local-6989586621683116945"><span class="hs-identifier hs-var">boot_dfuns</span></a></span><span>
</span><span id="line-1003"></span><span>    </span><span id="local-6989586621683116945"><span class="annot"><span class="annottext">boot_dfuns :: [Id]
</span><a href="#local-6989586621683116945"><span class="hs-identifier hs-var hs-var">boot_dfuns</span></a></span></span><span>      </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(Id -&gt; Bool) -&gt; [Id] -&gt; [Id]
forall a. (a -&gt; Bool) -&gt; [a] -&gt; [a]
</span><span class="hs-identifier hs-var">filter</span></span><span> </span><span class="annot"><span class="annottext">Id -&gt; Bool
</span><a href="GHC.Types.Id.html#isDFunId"><span class="hs-identifier hs-var">isDFunId</span></a></span><span> </span><span class="annot"><span class="annottext">([Id] -&gt; [Id]) -&gt; [Id] -&gt; [Id]
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">TypeEnv -&gt; [Id]
</span><a href="GHC.Types.TypeEnv.html#typeEnvIds"><span class="hs-identifier hs-var">typeEnvIds</span></a></span><span> </span><span class="annot"><span class="annottext">TypeEnv
</span><a href="#local-6989586621683116930"><span class="hs-identifier hs-var">boot_type_env</span></a></span><span>
</span><span id="line-1004"></span><span>       </span><span class="hs-comment">-- NB: boot_dfuns is /not/ defined thus: map instanceDFunId md_insts</span><span>
</span><span id="line-1005"></span><span>       </span><span class="hs-comment">--     We don't want to look at md_insts!</span><span>
</span><span id="line-1006"></span><span>       </span><span class="hs-comment">--     Why not?  See Note [DFun knot-tying]</span><span>
</span><span id="line-1007"></span><span>
</span><span id="line-1008"></span><span>    </span><span id="local-6989586621683116940"><span class="annot"><span class="annottext">check_export :: GlobalRdrEnv
-&gt; AvailInfo -&gt; IOEnv (Env TcGblEnv TcLclEnv) (Maybe (Id, Id))
</span><a href="#local-6989586621683116940"><span class="hs-identifier hs-var hs-var">check_export</span></a></span></span><span> </span><span id="local-6989586621683116950"><span class="annot"><span class="annottext">GlobalRdrEnv
</span><a href="#local-6989586621683116950"><span class="hs-identifier hs-var">gre_env</span></a></span></span><span> </span><span id="local-6989586621683116951"><span class="annot"><span class="annottext">AvailInfo
</span><a href="#local-6989586621683116951"><span class="hs-identifier hs-var">boot_avail</span></a></span></span><span>     </span><span class="hs-comment">-- boot_avail is exported by the boot iface</span><span>
</span><span id="line-1009"></span><span>      </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621683116952"><span class="hs-identifier hs-var">name</span></a></span><span> </span><span class="annot"><span class="annottext">Name -&gt; [Name] -&gt; Bool
forall a. Eq a =&gt; a -&gt; [a] -&gt; Bool
forall (t :: * -&gt; *) a. (Foldable t, Eq a) =&gt; a -&gt; t a -&gt; Bool
</span><span class="hs-operator hs-var">`elem`</span></span><span> </span><span class="annot"><span class="annottext">[Name]
</span><a href="#local-6989586621683116946"><span class="hs-identifier hs-var">boot_dfun_names</span></a></span><span>
</span><span id="line-1010"></span><span>      </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Maybe (Id, Id) -&gt; IOEnv (Env TcGblEnv TcLclEnv) (Maybe (Id, Id))
forall a. a -&gt; IOEnv (Env TcGblEnv TcLclEnv) a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="annot"><span class="annottext">Maybe (Id, Id)
forall a. Maybe a
</span><span class="hs-identifier hs-var">Nothing</span></span><span>
</span><span id="line-1011"></span><span>
</span><span id="line-1012"></span><span>        </span><span class="hs-comment">-- Check that the actual module exports the same thing</span><span>
</span><span id="line-1013"></span><span>      </span><span class="hs-glyph">|</span><span> </span><span id="local-6989586621683116954"><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621683116954"><span class="hs-identifier hs-var">missing_name</span></a></span></span><span class="annot"><span class="hs-glyph hs-type">:</span></span><span class="annot"><span class="annottext">[Name]
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">[Name]
</span><a href="#local-6989586621683116955"><span class="hs-identifier hs-var">missing_names</span></a></span><span>
</span><span id="line-1014"></span><span>      </span><span class="hs-glyph">=</span><span> </span><span class="hs-comment">-- Lookup might have failed because the hs-boot file defines a variable</span><span>
</span><span id="line-1015"></span><span>        </span><span class="hs-comment">-- that is implemented in the hs file as a record selector, which</span><span>
</span><span id="line-1016"></span><span>        </span><span class="hs-comment">-- lives in a different namespace.</span><span>
</span><span id="line-1017"></span><span>        </span><span class="hs-comment">--</span><span>
</span><span id="line-1018"></span><span>        </span><span class="hs-comment">-- See Note [Record field impedance matching].</span><span>
</span><span id="line-1019"></span><span>        </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621683116956"><span class="annot"><span class="annottext">missing_occ :: OccName
</span><a href="#local-6989586621683116956"><span class="hs-identifier hs-var hs-var">missing_occ</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Name -&gt; OccName
</span><a href="GHC.Types.Name.html#nameOccName"><span class="hs-identifier hs-var">nameOccName</span></a></span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621683116954"><span class="hs-identifier hs-var">missing_name</span></a></span><span>
</span><span id="line-1020"></span><span>            </span><span class="annot"><a href="#local-6989586621683116958"><span class="hs-identifier hs-type">mb_ok</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Types.Name.Reader.html#GlobalRdrElt"><span class="hs-identifier hs-type">GlobalRdrElt</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Maybe</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Types.Name.Reader.html#GlobalRdrElt"><span class="hs-identifier hs-type">GlobalRdrElt</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Maybe</span></span><span> </span><span class="annot"><a href="GHC.Types.Var.html#Id"><span class="hs-identifier hs-type">Id</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1021"></span><span>            </span><span id="local-6989586621683116958"><span class="annot"><span class="annottext">mb_ok :: GlobalRdrElt -&gt; Maybe (GlobalRdrElt, Maybe Id)
</span><a href="#local-6989586621683116958"><span class="hs-identifier hs-var hs-var">mb_ok</span></a></span></span><span> </span><span id="local-6989586621683116959"><span class="annot"><span class="annottext">GlobalRdrElt
</span><a href="#local-6989586621683116959"><span class="hs-identifier hs-var">gre</span></a></span></span><span>
</span><span id="line-1022"></span><span>              </span><span class="hs-comment">-- Ensure that this GRE refers to an Id that is exported.</span><span>
</span><span id="line-1023"></span><span>              </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Maybe AvailInfo -&gt; Bool
forall a. Maybe a -&gt; Bool
</span><span class="hs-identifier hs-var">isNothing</span></span><span> </span><span class="annot"><span class="annottext">(Maybe AvailInfo -&gt; Bool) -&gt; Maybe AvailInfo -&gt; Bool
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">NameEnv AvailInfo -&gt; Name -&gt; Maybe AvailInfo
forall a. NameEnv a -&gt; Name -&gt; Maybe a
</span><a href="GHC.Types.Name.Env.html#lookupNameEnv"><span class="hs-identifier hs-var">lookupNameEnv</span></a></span><span> </span><span class="annot"><span class="annottext">NameEnv AvailInfo
</span><a href="#local-6989586621683116962"><span class="hs-identifier hs-var">local_export_env</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">GlobalRdrElt -&gt; Name
forall info. GlobalRdrEltX info -&gt; Name
</span><a href="GHC.Types.Name.Reader.html#greName"><span class="hs-identifier hs-var">greName</span></a></span><span> </span><span class="annot"><span class="annottext">GlobalRdrElt
</span><a href="#local-6989586621683116959"><span class="hs-identifier hs-var">gre</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1024"></span><span>              </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Maybe (GlobalRdrElt, Maybe Id)
forall a. Maybe a
</span><span class="hs-identifier hs-var">Nothing</span></span><span>
</span><span id="line-1025"></span><span>              </span><span class="hs-comment">-- We locally define the field: create an impedance-matching</span><span>
</span><span id="line-1026"></span><span>              </span><span class="hs-comment">-- binding for the variable.</span><span>
</span><span id="line-1027"></span><span>              </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Types.TyThing.html#AnId"><span class="hs-identifier hs-type">AnId</span></a></span><span> </span><span id="local-6989586621683116965"><span class="annot"><span class="annottext">Id
</span><a href="#local-6989586621683116965"><span class="hs-identifier hs-var">id</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">TypeEnv -&gt; Name -&gt; Maybe TyThing
</span><a href="GHC.Types.TypeEnv.html#lookupTypeEnv"><span class="hs-identifier hs-var">lookupTypeEnv</span></a></span><span> </span><span class="annot"><span class="annottext">TypeEnv
</span><a href="#local-6989586621683116926"><span class="hs-identifier hs-var">local_type_env</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">GlobalRdrElt -&gt; Name
forall info. GlobalRdrEltX info -&gt; Name
</span><a href="GHC.Types.Name.Reader.html#greName"><span class="hs-identifier hs-var">greName</span></a></span><span> </span><span class="annot"><span class="annottext">GlobalRdrElt
</span><a href="#local-6989586621683116959"><span class="hs-identifier hs-var">gre</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1028"></span><span>              </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(GlobalRdrElt, Maybe Id) -&gt; Maybe (GlobalRdrElt, Maybe Id)
forall a. a -&gt; Maybe a
</span><span class="hs-identifier hs-var">Just</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">GlobalRdrElt
</span><a href="#local-6989586621683116959"><span class="hs-identifier hs-var">gre</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Id -&gt; Maybe Id
forall a. a -&gt; Maybe a
</span><span class="hs-identifier hs-var">Just</span></span><span> </span><span class="annot"><span class="annottext">Id
</span><a href="#local-6989586621683116965"><span class="hs-identifier hs-var">id</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1029"></span><span>              </span><span class="hs-comment">-- We are re-exporting the field but not the variable: not a problem,</span><span>
</span><span id="line-1030"></span><span>              </span><span class="hs-comment">-- as per [Wrinkle: exports] in Note [Record field impedance matching].</span><span>
</span><span id="line-1031"></span><span>              </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">otherwise</span></span><span>
</span><span id="line-1032"></span><span>              </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(GlobalRdrElt, Maybe Id) -&gt; Maybe (GlobalRdrElt, Maybe Id)
forall a. a -&gt; Maybe a
</span><span class="hs-identifier hs-var">Just</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">GlobalRdrElt
</span><a href="#local-6989586621683116959"><span class="hs-identifier hs-var">gre</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Maybe Id
forall a. Maybe a
</span><span class="hs-identifier hs-var">Nothing</span></span><span class="hs-special">)</span><span>
</span><span id="line-1033"></span><span>            </span><span id="local-6989586621683116967"><span class="annot"><span class="annottext">matching_flds :: [GlobalRdrElt]
</span><a href="#local-6989586621683116967"><span class="hs-identifier hs-var hs-var">matching_flds</span></a></span></span><span>
</span><span id="line-1034"></span><span>              </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">OccName -&gt; Bool
</span><a href="GHC.Types.Name.Occurrence.html#isVarOcc"><span class="hs-identifier hs-var">isVarOcc</span></a></span><span> </span><span class="annot"><span class="annottext">OccName
</span><a href="#local-6989586621683116956"><span class="hs-identifier hs-var">missing_occ</span></a></span><span> </span><span class="hs-comment">-- (This only applies to variables.)</span><span>
</span><span id="line-1035"></span><span>              </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">GlobalRdrEnv -&gt; LookupGRE GREInfo -&gt; [GlobalRdrElt]
forall info.
GlobalRdrEnvX info -&gt; LookupGRE info -&gt; [GlobalRdrEltX info]
</span><a href="GHC.Types.Name.Reader.html#lookupGRE"><span class="hs-identifier hs-var">lookupGRE</span></a></span><span> </span><span class="annot"><span class="annottext">GlobalRdrEnv
</span><a href="#local-6989586621683116950"><span class="hs-identifier hs-var">gre_env</span></a></span><span> </span><span class="annot"><span class="annottext">(LookupGRE GREInfo -&gt; [GlobalRdrElt])
-&gt; LookupGRE GREInfo -&gt; [GlobalRdrElt]
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-1036"></span><span>                </span><span class="annot"><span class="annottext">OccName -&gt; WhichGREs GREInfo -&gt; LookupGRE GREInfo
forall info. OccName -&gt; WhichGREs info -&gt; LookupGRE info
</span><a href="GHC.Types.Name.Reader.html#LookupOccName"><span class="hs-identifier hs-var">LookupOccName</span></a></span><span> </span><span class="annot"><span class="annottext">OccName
</span><a href="#local-6989586621683116956"><span class="hs-identifier hs-var">missing_occ</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">FieldsOrSelectors -&gt; WhichGREs GREInfo
</span><a href="GHC.Types.Name.Reader.html#RelevantGREsFOS"><span class="hs-identifier hs-var">RelevantGREsFOS</span></a></span><span> </span><span class="annot"><span class="annottext">FieldsOrSelectors
</span><a href="GHC.Types.Name.Reader.html#WantField"><span class="hs-identifier hs-var">WantField</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1037"></span><span>              </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">otherwise</span></span><span>
</span><span id="line-1038"></span><span>              </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><span class="hs-comment">-- BootFldReexport T18999_NoDisambiguateRecordFields T16745A</span><span>
</span><span id="line-1039"></span><span>
</span><span id="line-1040"></span><span>        </span><span class="hs-keyword">in</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">(GlobalRdrElt -&gt; Maybe (GlobalRdrElt, Maybe Id))
-&gt; [GlobalRdrElt] -&gt; [(GlobalRdrElt, Maybe Id)]
forall a b. (a -&gt; Maybe b) -&gt; [a] -&gt; [b]
</span><span class="hs-identifier hs-var">mapMaybe</span></span><span> </span><span class="annot"><span class="annottext">GlobalRdrElt -&gt; Maybe (GlobalRdrElt, Maybe Id)
</span><a href="#local-6989586621683116958"><span class="hs-identifier hs-var">mb_ok</span></a></span><span> </span><span class="annot"><span class="annottext">([GlobalRdrElt] -&gt; [(GlobalRdrElt, Maybe Id)])
-&gt; [GlobalRdrElt] -&gt; [(GlobalRdrElt, Maybe Id)]
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">[GlobalRdrElt]
</span><a href="#local-6989586621683116967"><span class="hs-identifier hs-var">matching_flds</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-1041"></span><span>
</span><span id="line-1042"></span><span>          </span><span class="hs-comment">-- At least 2 matches: report an ambiguity error.</span><span>
</span><span id="line-1043"></span><span>          </span><span class="hs-special">(</span><span id="local-6989586621683116974"><span class="annot"><span class="annottext">GlobalRdrElt
</span><a href="#local-6989586621683116974"><span class="hs-identifier hs-var">gre1</span></a></span></span><span class="hs-special">,</span><span class="annot"><span class="annottext">Maybe Id
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span class="annot"><span class="hs-glyph hs-type">:</span></span><span class="hs-special">(</span><span id="local-6989586621683116975"><span class="annot"><span class="annottext">GlobalRdrElt
</span><a href="#local-6989586621683116975"><span class="hs-identifier hs-var">gre2</span></a></span></span><span class="hs-special">,</span><span class="annot"><span class="annottext">Maybe Id
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span class="annot"><span class="hs-glyph hs-type">:</span></span><span id="local-6989586621683116976"><span class="annot"><span class="annottext">[(GlobalRdrElt, Maybe Id)]
</span><a href="#local-6989586621683116976"><span class="hs-identifier hs-var">gres_ids</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-1044"></span><span>           </span><span class="annot"><span class="annottext">SrcSpan -&gt; TcRnMessage -&gt; IOEnv (Env TcGblEnv TcLclEnv) ()
</span><a href="GHC.Tc.Utils.Monad.html#addErrAt"><span class="hs-identifier hs-var">addErrAt</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Name -&gt; SrcSpan
</span><a href="GHC.Types.Name.html#nameSrcSpan"><span class="hs-identifier hs-var">nameSrcSpan</span></a></span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621683116954"><span class="hs-identifier hs-var">missing_name</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(TcRnMessage -&gt; IOEnv (Env TcGblEnv TcLclEnv) ())
-&gt; TcRnMessage -&gt; IOEnv (Env TcGblEnv TcLclEnv) ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-1045"></span><span>             </span><span class="annot"><span class="annottext">GlobalRdrEnv -&gt; RdrName -&gt; NonEmpty GlobalRdrElt -&gt; TcRnMessage
</span><a href="GHC.Rename.Utils.html#mkNameClashErr"><span class="hs-identifier hs-var">mkNameClashErr</span></a></span><span> </span><span class="annot"><span class="annottext">GlobalRdrEnv
</span><a href="#local-6989586621683116950"><span class="hs-identifier hs-var">gre_env</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Name -&gt; RdrName
</span><a href="GHC.Types.Name.Reader.html#nameRdrName"><span class="hs-identifier hs-var">nameRdrName</span></a></span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621683116954"><span class="hs-identifier hs-var">missing_name</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1046"></span><span>               </span><span class="hs-special">(</span><span class="annot"><span class="annottext">GlobalRdrElt
</span><a href="#local-6989586621683116974"><span class="hs-identifier hs-var">gre1</span></a></span><span> </span><span class="annot"><span class="annottext">GlobalRdrElt -&gt; [GlobalRdrElt] -&gt; NonEmpty GlobalRdrElt
forall a. a -&gt; [a] -&gt; NonEmpty a
</span><span class="hs-operator hs-var">NE.:|</span></span><span> </span><span class="annot"><span class="annottext">GlobalRdrElt
</span><a href="#local-6989586621683116975"><span class="hs-identifier hs-var">gre2</span></a></span><span> </span><span class="annot"><span class="annottext">GlobalRdrElt -&gt; [GlobalRdrElt] -&gt; [GlobalRdrElt]
forall a. a -&gt; [a] -&gt; [a]
</span><span class="hs-glyph hs-var">:</span></span><span> </span><span class="annot"><span class="annottext">((GlobalRdrElt, Maybe Id) -&gt; GlobalRdrElt)
-&gt; [(GlobalRdrElt, Maybe Id)] -&gt; [GlobalRdrElt]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><span class="hs-identifier hs-var">map</span></span><span> </span><span class="annot"><span class="annottext">(GlobalRdrElt, Maybe Id) -&gt; GlobalRdrElt
forall a b. (a, b) -&gt; a
</span><span class="hs-identifier hs-var">fst</span></span><span> </span><span class="annot"><span class="annottext">[(GlobalRdrElt, Maybe Id)]
</span><a href="#local-6989586621683116976"><span class="hs-identifier hs-var">gres_ids</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1047"></span><span>           </span><span class="annot"><span class="annottext">Maybe (Id, Id) -&gt; IOEnv (Env TcGblEnv TcLclEnv) (Maybe (Id, Id))
forall a. a -&gt; IOEnv (Env TcGblEnv TcLclEnv) a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="annot"><span class="annottext">Maybe (Id, Id)
forall a. Maybe a
</span><span class="hs-identifier hs-var">Nothing</span></span><span>
</span><span id="line-1048"></span><span>
</span><span id="line-1049"></span><span>          </span><span class="hs-comment">-- Single match: resolve the issue.</span><span>
</span><span id="line-1050"></span><span>          </span><span class="hs-special">[</span><span class="hs-special">(</span><span class="annot"><span class="annottext">GlobalRdrElt
</span><span class="hs-identifier">_</span></span><span class="hs-special">,</span><span id="local-6989586621683116980"><span class="annot"><span class="annottext">Maybe Id
</span><a href="#local-6989586621683116980"><span class="hs-identifier hs-var">mb_fld_id</span></a></span></span><span class="hs-special">)</span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-1051"></span><span>            </span><span class="hs-comment">-- See Note [Record field impedance matching].</span><span>
</span><span id="line-1052"></span><span>            </span><span class="annot"><span class="annottext">Maybe Id
-&gt; (Id -&gt; IOEnv (Env TcGblEnv TcLclEnv) (Id, Id))
-&gt; IOEnv (Env TcGblEnv TcLclEnv) (Maybe (Id, Id))
forall (t :: * -&gt; *) (f :: * -&gt; *) a b.
(Traversable t, Applicative f) =&gt;
t a -&gt; (a -&gt; f b) -&gt; f (t b)
</span><span class="hs-identifier hs-var">for</span></span><span> </span><span class="annot"><span class="annottext">Maybe Id
</span><a href="#local-6989586621683116980"><span class="hs-identifier hs-var">mb_fld_id</span></a></span><span> </span><span class="annot"><span class="annottext">((Id -&gt; IOEnv (Env TcGblEnv TcLclEnv) (Id, Id))
 -&gt; IOEnv (Env TcGblEnv TcLclEnv) (Maybe (Id, Id)))
-&gt; (Id -&gt; IOEnv (Env TcGblEnv TcLclEnv) (Id, Id))
-&gt; IOEnv (Env TcGblEnv TcLclEnv) (Maybe (Id, Id))
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-glyph">\</span><span> </span><span id="local-6989586621683116981"><span class="annot"><span class="annottext">Id
</span><a href="#local-6989586621683116981"><span class="hs-identifier hs-var">fld_id</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-1053"></span><span>              </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621683116982"><span class="annot"><span class="annottext">local_boot_var :: Id
</span><a href="#local-6989586621683116982"><span class="hs-identifier hs-var hs-var">local_boot_var</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-1054"></span><span>                    </span><span class="annot"><span class="annottext">Name -&gt; Type -&gt; Id
</span><a href="GHC.Types.Id.html#mkExportedVanillaId"><span class="hs-identifier hs-var">Id.mkExportedVanillaId</span></a></span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621683116954"><span class="hs-identifier hs-var">missing_name</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Id -&gt; Type
</span><a href="GHC.Types.Id.html#idType"><span class="hs-identifier hs-var">idType</span></a></span><span> </span><span class="annot"><span class="annottext">Id
</span><a href="#local-6989586621683116981"><span class="hs-identifier hs-var">fld_id</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1055"></span><span>              </span><span class="annot"><span class="annottext">(Id, Id) -&gt; IOEnv (Env TcGblEnv TcLclEnv) (Id, Id)
forall a. a -&gt; IOEnv (Env TcGblEnv TcLclEnv) a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Id
</span><a href="#local-6989586621683116982"><span class="hs-identifier hs-var">local_boot_var</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Id
</span><a href="#local-6989586621683116981"><span class="hs-identifier hs-var">fld_id</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1056"></span><span>
</span><span id="line-1057"></span><span>          </span><span class="hs-comment">-- Otherwise: report that the hs file does not export something</span><span>
</span><span id="line-1058"></span><span>          </span><span class="hs-comment">-- that the hs-boot file exports.</span><span>
</span><span id="line-1059"></span><span>          </span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-1060"></span><span>           </span><span class="annot"><span class="annottext">SrcSpan -&gt; TcRnMessage -&gt; IOEnv (Env TcGblEnv TcLclEnv) ()
</span><a href="GHC.Tc.Utils.Monad.html#addErrAt"><span class="hs-identifier hs-var">addErrAt</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Name -&gt; SrcSpan
</span><a href="GHC.Types.Name.html#nameSrcSpan"><span class="hs-identifier hs-var">nameSrcSpan</span></a></span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621683116954"><span class="hs-identifier hs-var">missing_name</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1061"></span><span>             </span><span class="hs-special">(</span><span class="annot"><span class="annottext">HsBootOrSig -&gt; Name -&gt; MissingBootThing -&gt; TcRnMessage
</span><a href="GHC.Tc.Errors.Types.html#missingBootThing"><span class="hs-identifier hs-var">missingBootThing</span></a></span><span> </span><span class="annot"><span class="annottext">HsBootOrSig
</span><a href="GHC.Types.SourceFile.html#HsBoot"><span class="hs-identifier hs-var">HsBoot</span></a></span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621683116954"><span class="hs-identifier hs-var">missing_name</span></a></span><span> </span><span class="annot"><span class="annottext">MissingBootThing
</span><a href="GHC.Tc.Errors.Types.html#MissingBootExport"><span class="hs-identifier hs-var">MissingBootExport</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1062"></span><span>           </span><span class="annot"><span class="annottext">Maybe (Id, Id) -&gt; IOEnv (Env TcGblEnv TcLclEnv) (Maybe (Id, Id))
forall a. a -&gt; IOEnv (Env TcGblEnv TcLclEnv) a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="annot"><span class="annottext">Maybe (Id, Id)
forall a. Maybe a
</span><span class="hs-identifier hs-var">Nothing</span></span><span>
</span><span id="line-1063"></span><span>
</span><span id="line-1064"></span><span>        </span><span class="hs-comment">-- If the boot module does not *define* the thing, we are done</span><span>
</span><span id="line-1065"></span><span>        </span><span class="hs-comment">-- (it simply re-exports it, and names match, so nothing further to do)</span><span>
</span><span id="line-1066"></span><span>      </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Maybe TyThing -&gt; Bool
forall a. Maybe a -&gt; Bool
</span><span class="hs-identifier hs-var">isNothing</span></span><span> </span><span class="annot"><span class="annottext">Maybe TyThing
</span><a href="#local-6989586621683116988"><span class="hs-identifier hs-var">mb_boot_thing</span></a></span><span>
</span><span id="line-1067"></span><span>      </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Maybe (Id, Id) -&gt; IOEnv (Env TcGblEnv TcLclEnv) (Maybe (Id, Id))
forall a. a -&gt; IOEnv (Env TcGblEnv TcLclEnv) a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="annot"><span class="annottext">Maybe (Id, Id)
forall a. Maybe a
</span><span class="hs-identifier hs-var">Nothing</span></span><span>
</span><span id="line-1068"></span><span>
</span><span id="line-1069"></span><span>        </span><span class="hs-comment">-- Check that the actual module also defines the thing, and</span><span>
</span><span id="line-1070"></span><span>        </span><span class="hs-comment">-- then compare the definitions</span><span>
</span><span id="line-1071"></span><span>      </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span id="local-6989586621683116989"><span class="annot"><span class="annottext">TyThing
</span><a href="#local-6989586621683116989"><span class="hs-identifier hs-var">real_thing</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">TypeEnv -&gt; Name -&gt; Maybe TyThing
</span><a href="GHC.Types.TypeEnv.html#lookupTypeEnv"><span class="hs-identifier hs-var">lookupTypeEnv</span></a></span><span> </span><span class="annot"><span class="annottext">TypeEnv
</span><a href="#local-6989586621683116926"><span class="hs-identifier hs-var">local_type_env</span></a></span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621683116952"><span class="hs-identifier hs-var">name</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-1072"></span><span>        </span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span id="local-6989586621683116990"><span class="annot"><span class="annottext">TyThing
</span><a href="#local-6989586621683116990"><span class="hs-identifier hs-var">boot_thing</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Maybe TyThing
</span><a href="#local-6989586621683116988"><span class="hs-identifier hs-var">mb_boot_thing</span></a></span><span>
</span><span id="line-1073"></span><span>      </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="annot"><span class="annottext">HsBootOrSig
-&gt; TyThing -&gt; TyThing -&gt; IOEnv (Env TcGblEnv TcLclEnv) ()
</span><a href="GHC.Tc.Module.html#checkBootDeclM"><span class="hs-identifier hs-var">checkBootDeclM</span></a></span><span> </span><span class="annot"><span class="annottext">HsBootOrSig
</span><a href="GHC.Types.SourceFile.html#HsBoot"><span class="hs-identifier hs-var">HsBoot</span></a></span><span> </span><span class="annot"><span class="annottext">TyThing
</span><a href="#local-6989586621683116990"><span class="hs-identifier hs-var">boot_thing</span></a></span><span> </span><span class="annot"><span class="annottext">TyThing
</span><a href="#local-6989586621683116989"><span class="hs-identifier hs-var">real_thing</span></a></span><span>
</span><span id="line-1074"></span><span>           </span><span class="annot"><span class="annottext">Maybe (Id, Id) -&gt; IOEnv (Env TcGblEnv TcLclEnv) (Maybe (Id, Id))
forall a. a -&gt; IOEnv (Env TcGblEnv TcLclEnv) a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="annot"><span class="annottext">Maybe (Id, Id)
forall a. Maybe a
</span><span class="hs-identifier hs-var">Nothing</span></span><span>
</span><span id="line-1075"></span><span>
</span><span id="line-1076"></span><span>      </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">otherwise</span></span><span>
</span><span id="line-1077"></span><span>      </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="annot"><span class="annottext">TcRnMessage -&gt; IOEnv (Env TcGblEnv TcLclEnv) ()
</span><a href="GHC.Tc.Utils.Monad.html#addErrTc"><span class="hs-identifier hs-var">addErrTc</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">HsBootOrSig -&gt; Name -&gt; MissingBootThing -&gt; TcRnMessage
</span><a href="GHC.Tc.Errors.Types.html#missingBootThing"><span class="hs-identifier hs-var">missingBootThing</span></a></span><span> </span><span class="annot"><span class="annottext">HsBootOrSig
</span><a href="GHC.Types.SourceFile.html#HsBoot"><span class="hs-identifier hs-var">HsBoot</span></a></span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621683116952"><span class="hs-identifier hs-var">name</span></a></span><span> </span><span class="annot"><span class="annottext">MissingBootThing
</span><a href="GHC.Tc.Errors.Types.html#MissingBootDefinition"><span class="hs-identifier hs-var">MissingBootDefinition</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1078"></span><span>           </span><span class="annot"><span class="annottext">Maybe (Id, Id) -&gt; IOEnv (Env TcGblEnv TcLclEnv) (Maybe (Id, Id))
forall a. a -&gt; IOEnv (Env TcGblEnv TcLclEnv) a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="annot"><span class="annottext">Maybe (Id, Id)
forall a. Maybe a
</span><span class="hs-identifier hs-var">Nothing</span></span><span>
</span><span id="line-1079"></span><span>      </span><span class="hs-keyword">where</span><span>
</span><span id="line-1080"></span><span>        </span><span id="local-6989586621683116952"><span class="annot"><span class="annottext">name :: Name
</span><a href="#local-6989586621683116952"><span class="hs-identifier hs-var hs-var">name</span></a></span></span><span>          </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">AvailInfo -&gt; Name
</span><a href="GHC.Types.Avail.html#availName"><span class="hs-identifier hs-var">availName</span></a></span><span> </span><span class="annot"><span class="annottext">AvailInfo
</span><a href="#local-6989586621683116951"><span class="hs-identifier hs-var">boot_avail</span></a></span><span>
</span><span id="line-1081"></span><span>        </span><span id="local-6989586621683116988"><span class="annot"><span class="annottext">mb_boot_thing :: Maybe TyThing
</span><a href="#local-6989586621683116988"><span class="hs-identifier hs-var hs-var">mb_boot_thing</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">TypeEnv -&gt; Name -&gt; Maybe TyThing
</span><a href="GHC.Types.TypeEnv.html#lookupTypeEnv"><span class="hs-identifier hs-var">lookupTypeEnv</span></a></span><span> </span><span class="annot"><span class="annottext">TypeEnv
</span><a href="#local-6989586621683116930"><span class="hs-identifier hs-var">boot_type_env</span></a></span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621683116952"><span class="hs-identifier hs-var">name</span></a></span><span>
</span><span id="line-1082"></span><span>        </span><span id="local-6989586621683116955"><span class="annot"><span class="annottext">missing_names :: [Name]
</span><a href="#local-6989586621683116955"><span class="hs-identifier hs-var hs-var">missing_names</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">NameEnv AvailInfo -&gt; Name -&gt; Maybe AvailInfo
forall a. NameEnv a -&gt; Name -&gt; Maybe a
</span><a href="GHC.Types.Name.Env.html#lookupNameEnv"><span class="hs-identifier hs-var">lookupNameEnv</span></a></span><span> </span><span class="annot"><span class="annottext">NameEnv AvailInfo
</span><a href="#local-6989586621683116962"><span class="hs-identifier hs-var">local_export_env</span></a></span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621683116952"><span class="hs-identifier hs-var">name</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-1083"></span><span>                          </span><span class="annot"><span class="annottext">Maybe AvailInfo
</span><span class="hs-identifier hs-var">Nothing</span></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621683116952"><span class="hs-identifier hs-var">name</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-1084"></span><span>                          </span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span id="local-6989586621683116994"><span class="annot"><span class="annottext">AvailInfo
</span><a href="#local-6989586621683116994"><span class="hs-identifier hs-var">avail</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">AvailInfo -&gt; [Name]
</span><a href="GHC.Types.Avail.html#availNames"><span class="hs-identifier hs-var">availNames</span></a></span><span> </span><span class="annot"><span class="annottext">AvailInfo
</span><a href="#local-6989586621683116951"><span class="hs-identifier hs-var">boot_avail</span></a></span><span>
</span><span id="line-1085"></span><span>                            </span><span class="annot"><span class="annottext">[Name] -&gt; [Name] -&gt; [Name]
forall a. Ord a =&gt; [a] -&gt; [a] -&gt; [a]
</span><a href="GHC.Data.List.SetOps.html#minusList"><span class="hs-operator hs-var">`minusList`</span></a></span><span> </span><span class="annot"><span class="annottext">AvailInfo -&gt; [Name]
</span><a href="GHC.Types.Avail.html#availNames"><span class="hs-identifier hs-var">availNames</span></a></span><span> </span><span class="annot"><span class="annottext">AvailInfo
</span><a href="#local-6989586621683116994"><span class="hs-identifier hs-var">avail</span></a></span><span>
</span><span id="line-1086"></span><span>
</span><span id="line-1087"></span><span>    </span><span class="annot"><a href="#local-6989586621683116962"><span class="hs-identifier hs-type">local_export_env</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Types.Name.Env.html#NameEnv"><span class="hs-identifier hs-type">NameEnv</span></a></span><span> </span><span class="annot"><a href="GHC.Types.Avail.html#AvailInfo"><span class="hs-identifier hs-type">AvailInfo</span></a></span><span>
</span><span id="line-1088"></span><span>    </span><span id="local-6989586621683116962"><span class="annot"><span class="annottext">local_export_env :: NameEnv AvailInfo
</span><a href="#local-6989586621683116962"><span class="hs-identifier hs-var hs-var">local_export_env</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[AvailInfo] -&gt; NameEnv AvailInfo
</span><a href="GHC.Types.Avail.html#availsToNameEnv"><span class="hs-identifier hs-var">availsToNameEnv</span></a></span><span> </span><span class="annot"><span class="annottext">[AvailInfo]
</span><a href="#local-6989586621683116927"><span class="hs-identifier hs-var">local_exports</span></a></span><span>
</span><span id="line-1089"></span><span>
</span><span id="line-1090"></span><span>    </span><span class="annot"><a href="#local-6989586621683116944"><span class="hs-identifier hs-type">check_cls_inst</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Types.Var.html#DFunId"><span class="hs-identifier hs-type">DFunId</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#TcM"><span class="hs-identifier hs-type">TcM</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Maybe</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Types.Var.html#Id"><span class="hs-identifier hs-type">Id</span></a></span><span class="hs-special">,</span><span class="annot"><a href="GHC.Types.Var.html#Id"><span class="hs-identifier hs-type">Id</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-1091"></span><span>        </span><span class="hs-comment">-- Returns a pair of the boot dfun in terms of the equivalent</span><span>
</span><span id="line-1092"></span><span>        </span><span class="hs-comment">-- real dfun. Delicate (like checkBootDecl) because it depends</span><span>
</span><span id="line-1093"></span><span>        </span><span class="hs-comment">-- on the types lining up precisely even to the ordering of</span><span>
</span><span id="line-1094"></span><span>        </span><span class="hs-comment">-- the type variables in the foralls.</span><span>
</span><span id="line-1095"></span><span>    </span><span id="local-6989586621683116944"><span class="annot"><span class="annottext">check_cls_inst :: Id -&gt; IOEnv (Env TcGblEnv TcLclEnv) (Maybe (Id, Id))
</span><a href="#local-6989586621683116944"><span class="hs-identifier hs-var hs-var">check_cls_inst</span></a></span></span><span> </span><span id="local-6989586621683116999"><span class="annot"><span class="annottext">Id
</span><a href="#local-6989586621683116999"><span class="hs-identifier hs-var">boot_dfun</span></a></span></span><span>
</span><span id="line-1096"></span><span>      </span><span class="hs-glyph">|</span><span> </span><span class="hs-special">(</span><span id="local-6989586621683117000"><span class="annot"><span class="annottext">Id
</span><a href="#local-6989586621683117000"><span class="hs-identifier hs-var">real_dfun</span></a></span></span><span> </span><span class="annot"><span class="hs-glyph hs-type">:</span></span><span> </span><span class="annot"><span class="annottext">[Id]
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Id -&gt; [Id]
</span><a href="#local-6989586621683117001"><span class="hs-identifier hs-var">find_real_dfun</span></a></span><span> </span><span class="annot"><span class="annottext">Id
</span><a href="#local-6989586621683116999"><span class="hs-identifier hs-var">boot_dfun</span></a></span><span>
</span><span id="line-1097"></span><span>      </span><span class="hs-special">,</span><span> </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621683117002"><span class="annot"><span class="annottext">dfun_name :: Name
</span><a href="#local-6989586621683117002"><span class="hs-identifier hs-var hs-var">dfun_name</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Id -&gt; Name
</span><a href="GHC.Types.Id.html#idName"><span class="hs-identifier hs-var">idName</span></a></span><span> </span><span class="annot"><span class="annottext">Id
</span><a href="#local-6989586621683116999"><span class="hs-identifier hs-var">boot_dfun</span></a></span><span>
</span><span id="line-1098"></span><span>            </span><span id="local-6989586621683117003"><span class="annot"><span class="annottext">local_boot_dfun :: Id
</span><a href="#local-6989586621683117003"><span class="hs-identifier hs-var hs-var">local_boot_dfun</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Name -&gt; Type -&gt; Id
</span><a href="GHC.Types.Id.html#mkExportedVanillaId"><span class="hs-identifier hs-var">Id.mkExportedVanillaId</span></a></span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621683117002"><span class="hs-identifier hs-var">dfun_name</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Id -&gt; Type
</span><a href="GHC.Types.Id.html#idType"><span class="hs-identifier hs-var">idType</span></a></span><span> </span><span class="annot"><span class="annottext">Id
</span><a href="#local-6989586621683117000"><span class="hs-identifier hs-var">real_dfun</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1099"></span><span>      </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Maybe (Id, Id) -&gt; IOEnv (Env TcGblEnv TcLclEnv) (Maybe (Id, Id))
forall a. a -&gt; IOEnv (Env TcGblEnv TcLclEnv) a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="annot"><span class="annottext">(Maybe (Id, Id) -&gt; IOEnv (Env TcGblEnv TcLclEnv) (Maybe (Id, Id)))
-&gt; Maybe (Id, Id) -&gt; IOEnv (Env TcGblEnv TcLclEnv) (Maybe (Id, Id))
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">(Id, Id) -&gt; Maybe (Id, Id)
forall a. a -&gt; Maybe a
</span><span class="hs-identifier hs-var">Just</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Id
</span><a href="#local-6989586621683117003"><span class="hs-identifier hs-var">local_boot_dfun</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Id
</span><a href="#local-6989586621683117000"><span class="hs-identifier hs-var">real_dfun</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1100"></span><span>          </span><span class="hs-comment">-- Two tricky points here:</span><span>
</span><span id="line-1101"></span><span>          </span><span class="hs-comment">--</span><span>
</span><span id="line-1102"></span><span>          </span><span class="hs-comment">--  * The local_boot_fun should have a Name from the /boot-file/,</span><span>
</span><span id="line-1103"></span><span>          </span><span class="hs-comment">--    but type from the dfun defined in /this module/.</span><span>
</span><span id="line-1104"></span><span>          </span><span class="hs-comment">--    That ensures that the TyCon etc inside the type are</span><span>
</span><span id="line-1105"></span><span>          </span><span class="hs-comment">--    the ones defined in this module, not the ones gotten</span><span>
</span><span id="line-1106"></span><span>          </span><span class="hs-comment">--    from the hi-boot file, which may have a lot less info</span><span>
</span><span id="line-1107"></span><span>          </span><span class="hs-comment">--    (#8743, comment:10).</span><span>
</span><span id="line-1108"></span><span>          </span><span class="hs-comment">--</span><span>
</span><span id="line-1109"></span><span>          </span><span class="hs-comment">--  * The DFunIds from boot_details are /GlobalIds/, because</span><span>
</span><span id="line-1110"></span><span>          </span><span class="hs-comment">--    they come from typechecking M.hi-boot.</span><span>
</span><span id="line-1111"></span><span>          </span><span class="hs-comment">--    But all bindings in this module should be for /LocalIds/,</span><span>
</span><span id="line-1112"></span><span>          </span><span class="hs-comment">--    otherwise dependency analysis fails (#16038). This</span><span>
</span><span id="line-1113"></span><span>          </span><span class="hs-comment">--    is another reason for using mkExportedVanillaId, rather</span><span>
</span><span id="line-1114"></span><span>          </span><span class="hs-comment">--    that modifying boot_dfun, to make local_boot_fun.</span><span>
</span><span id="line-1115"></span><span>          </span><span class="hs-comment">--</span><span>
</span><span id="line-1116"></span><span>          </span><span class="hs-comment">-- See Note [DFun impedance matching].</span><span>
</span><span id="line-1117"></span><span>
</span><span id="line-1118"></span><span>      </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">otherwise</span></span><span>
</span><span id="line-1119"></span><span>      </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">SrcSpan
-&gt; IOEnv (Env TcGblEnv TcLclEnv) (Maybe (Id, Id))
-&gt; IOEnv (Env TcGblEnv TcLclEnv) (Maybe (Id, Id))
forall a. SrcSpan -&gt; TcRn a -&gt; TcRn a
</span><a href="GHC.Tc.Utils.Monad.html#setSrcSpan"><span class="hs-identifier hs-var">setSrcSpan</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Name -&gt; SrcSpan
</span><a href="GHC.Types.Name.html#nameSrcSpan"><span class="hs-identifier hs-var">nameSrcSpan</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Id -&gt; Name
forall a. NamedThing a =&gt; a -&gt; Name
</span><a href="GHC.Types.Name.html#getName"><span class="hs-identifier hs-var">getName</span></a></span><span> </span><span class="annot"><span class="annottext">Id
</span><a href="#local-6989586621683116999"><span class="hs-identifier hs-var">boot_dfun</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(IOEnv (Env TcGblEnv TcLclEnv) (Maybe (Id, Id))
 -&gt; IOEnv (Env TcGblEnv TcLclEnv) (Maybe (Id, Id)))
-&gt; IOEnv (Env TcGblEnv TcLclEnv) (Maybe (Id, Id))
-&gt; IOEnv (Env TcGblEnv TcLclEnv) (Maybe (Id, Id))
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-1120"></span><span>        </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">String -&gt; SDoc -&gt; IOEnv (Env TcGblEnv TcLclEnv) ()
</span><a href="GHC.Tc.Utils.Monad.html#traceTc"><span class="hs-identifier hs-var">traceTc</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;check_cls_inst&quot;</span></span><span> </span><span class="annot"><span class="annottext">(SDoc -&gt; IOEnv (Env TcGblEnv TcLclEnv) ())
-&gt; SDoc -&gt; IOEnv (Env TcGblEnv TcLclEnv) ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">[SDoc] -&gt; SDoc
forall doc. IsDoc doc =&gt; [doc] -&gt; doc
</span><a href="GHC.Utils.Outputable.html#vcat"><span class="hs-identifier hs-var">vcat</span></a></span><span>
</span><span id="line-1121"></span><span>                </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">String -&gt; SDoc
forall doc. IsLine doc =&gt; String -&gt; doc
</span><a href="GHC.Utils.Outputable.html#text"><span class="hs-identifier hs-var">text</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;local_insts&quot;</span></span><span>  </span><span class="annot"><span class="annottext">SDoc -&gt; SDoc -&gt; SDoc
forall doc. IsLine doc =&gt; doc -&gt; doc -&gt; doc
</span><a href="GHC.Utils.Outputable.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a></span><span>
</span><span id="line-1122"></span><span>                     </span><span class="annot"><span class="annottext">[SDoc] -&gt; SDoc
forall doc. IsDoc doc =&gt; [doc] -&gt; doc
</span><a href="GHC.Utils.Outputable.html#vcat"><span class="hs-identifier hs-var">vcat</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(ClsInst -&gt; SDoc) -&gt; [ClsInst] -&gt; [SDoc]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><span class="hs-identifier hs-var">map</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Type -&gt; SDoc
forall a. Outputable a =&gt; a -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="annot"><span class="annottext">(Type -&gt; SDoc) -&gt; (ClsInst -&gt; Type) -&gt; ClsInst -&gt; SDoc
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">Id -&gt; Type
</span><a href="GHC.Types.Id.html#idType"><span class="hs-identifier hs-var">idType</span></a></span><span> </span><span class="annot"><span class="annottext">(Id -&gt; Type) -&gt; (ClsInst -&gt; Id) -&gt; ClsInst -&gt; Type
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">ClsInst -&gt; Id
</span><a href="GHC.Core.InstEnv.html#instanceDFunId"><span class="hs-identifier hs-var">instanceDFunId</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[ClsInst]
</span><a href="#local-6989586621683116925"><span class="hs-identifier hs-var">local_insts</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1123"></span><span>                </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">String -&gt; SDoc
forall doc. IsLine doc =&gt; String -&gt; doc
</span><a href="GHC.Utils.Outputable.html#text"><span class="hs-identifier hs-var">text</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;boot_dfun_ty&quot;</span></span><span> </span><span class="annot"><span class="annottext">SDoc -&gt; SDoc -&gt; SDoc
forall doc. IsLine doc =&gt; doc -&gt; doc -&gt; doc
</span><a href="GHC.Utils.Outputable.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">Type -&gt; SDoc
forall a. Outputable a =&gt; a -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Id -&gt; Type
</span><a href="GHC.Types.Id.html#idType"><span class="hs-identifier hs-var">idType</span></a></span><span> </span><span class="annot"><span class="annottext">Id
</span><a href="#local-6989586621683116999"><span class="hs-identifier hs-var">boot_dfun</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">]</span><span>
</span><span id="line-1124"></span><span>
</span><span id="line-1125"></span><span>           </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="annottext">TcRnMessage -&gt; IOEnv (Env TcGblEnv TcLclEnv) ()
</span><a href="GHC.Tc.Utils.Monad.html#addErrTc"><span class="hs-identifier hs-var">addErrTc</span></a></span><span> </span><span class="annot"><span class="annottext">(TcRnMessage -&gt; IOEnv (Env TcGblEnv TcLclEnv) ())
-&gt; TcRnMessage -&gt; IOEnv (Env TcGblEnv TcLclEnv) ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">HsBootOrSig -&gt; BootMismatch -&gt; TcRnMessage
</span><a href="GHC.Tc.Errors.Types.html#TcRnBootMismatch"><span class="hs-identifier hs-var">TcRnBootMismatch</span></a></span><span> </span><span class="annot"><span class="annottext">HsBootOrSig
</span><a href="GHC.Types.SourceFile.html#HsBoot"><span class="hs-identifier hs-var">HsBoot</span></a></span><span>
</span><span id="line-1126"></span><span>                      </span><span class="annot"><span class="annottext">(BootMismatch -&gt; TcRnMessage) -&gt; BootMismatch -&gt; TcRnMessage
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Id -&gt; BootMismatch
</span><a href="GHC.Tc.Errors.Types.html#MissingBootInstance"><span class="hs-identifier hs-var">MissingBootInstance</span></a></span><span> </span><span class="annot"><span class="annottext">Id
</span><a href="#local-6989586621683116999"><span class="hs-identifier hs-var">boot_dfun</span></a></span><span>
</span><span id="line-1127"></span><span>           </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="annottext">Maybe (Id, Id) -&gt; IOEnv (Env TcGblEnv TcLclEnv) (Maybe (Id, Id))
forall a. a -&gt; IOEnv (Env TcGblEnv TcLclEnv) a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="annot"><span class="annottext">Maybe (Id, Id)
forall a. Maybe a
</span><span class="hs-identifier hs-var">Nothing</span></span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-1128"></span><span>
</span><span id="line-1129"></span><span>    </span><span class="annot"><a href="#local-6989586621683117001"><span class="hs-identifier hs-type">find_real_dfun</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Types.Var.html#DFunId"><span class="hs-identifier hs-type">DFunId</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="GHC.Types.Var.html#DFunId"><span class="hs-identifier hs-type">DFunId</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-1130"></span><span>    </span><span id="local-6989586621683117001"><span class="annot"><span class="annottext">find_real_dfun :: Id -&gt; [Id]
</span><a href="#local-6989586621683117001"><span class="hs-identifier hs-var hs-var">find_real_dfun</span></a></span></span><span> </span><span id="local-6989586621683117008"><span class="annot"><span class="annottext">Id
</span><a href="#local-6989586621683117008"><span class="hs-identifier hs-var">boot_dfun</span></a></span></span><span>
</span><span id="line-1131"></span><span>       </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">Id
</span><a href="#local-6989586621683117009"><span class="hs-identifier hs-var">dfun</span></a></span><span> </span><span class="hs-glyph">|</span><span> </span><span id="local-6989586621683117010"><span class="annot"><span class="annottext">ClsInst
</span><a href="#local-6989586621683117010"><span class="hs-identifier hs-var">inst</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">[ClsInst]
</span><a href="#local-6989586621683116925"><span class="hs-identifier hs-var">local_insts</span></a></span><span>
</span><span id="line-1132"></span><span>               </span><span class="hs-special">,</span><span> </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621683117009"><span class="annot"><span class="annottext">dfun :: Id
</span><a href="#local-6989586621683117009"><span class="hs-identifier hs-var hs-var">dfun</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ClsInst -&gt; Id
</span><a href="GHC.Core.InstEnv.html#instanceDFunId"><span class="hs-identifier hs-var">instanceDFunId</span></a></span><span> </span><span class="annot"><span class="annottext">ClsInst
</span><a href="#local-6989586621683117010"><span class="hs-identifier hs-var">inst</span></a></span><span>
</span><span id="line-1133"></span><span>               </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Id -&gt; Type
</span><a href="GHC.Types.Id.html#idType"><span class="hs-identifier hs-var">idType</span></a></span><span> </span><span class="annot"><span class="annottext">Id
</span><a href="#local-6989586621683117009"><span class="hs-identifier hs-var">dfun</span></a></span><span> </span><span class="annot"><span class="annottext">HasCallStack =&gt; Type -&gt; Type -&gt; Bool
Type -&gt; Type -&gt; Bool
</span><a href="GHC.Core.TyCo.Compare.html#eqType"><span class="hs-operator hs-var">`eqType`</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621683117012"><span class="hs-identifier hs-var">boot_dfun_ty</span></a></span><span> </span><span class="hs-special">]</span><span>
</span><span id="line-1134"></span><span>       </span><span class="hs-keyword">where</span><span>
</span><span id="line-1135"></span><span>          </span><span id="local-6989586621683117012"><span class="annot"><span class="annottext">boot_dfun_ty :: Type
</span><a href="#local-6989586621683117012"><span class="hs-identifier hs-var hs-var">boot_dfun_ty</span></a></span></span><span>   </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Id -&gt; Type
</span><a href="GHC.Types.Id.html#idType"><span class="hs-identifier hs-var">idType</span></a></span><span> </span><span class="annot"><span class="annottext">Id
</span><a href="#local-6989586621683117008"><span class="hs-identifier hs-var">boot_dfun</span></a></span><span>
</span><span id="line-1136"></span><span>
</span><span id="line-1137"></span><span>
</span><span id="line-1138"></span><span class="hs-comment">-- In general, to perform these checks we have to</span><span>
</span><span id="line-1139"></span><span class="hs-comment">-- compare the TyThing from the .hi-boot file to the TyThing</span><span>
</span><span id="line-1140"></span><span class="hs-comment">-- in the current source file.  We must be careful to allow alpha-renaming</span><span>
</span><span id="line-1141"></span><span class="hs-comment">-- where appropriate, and also the boot declaration is allowed to omit</span><span>
</span><span id="line-1142"></span><span class="hs-comment">-- constructors and class methods.</span><span>
</span><span id="line-1143"></span><span class="hs-comment">--</span><span>
</span><span id="line-1144"></span><span class="hs-comment">-- See rnfail055 for a good test of this stuff.</span><span>
</span><span id="line-1145"></span><span>
</span><span id="line-1146"></span><span class="hs-comment">-- | Compares two things for equivalence between boot-file and normal code,</span><span>
</span><span id="line-1147"></span><span class="hs-comment">-- reporting an error if they don't match up.</span><span>
</span><span id="line-1148"></span><span class="annot"><a href="GHC.Tc.Module.html#checkBootDeclM"><span class="hs-identifier hs-type">checkBootDeclM</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Types.SourceFile.html#HsBootOrSig"><span class="hs-identifier hs-type">HsBootOrSig</span></a></span><span>
</span><span id="line-1149"></span><span>               </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Types.TyThing.html#TyThing"><span class="hs-identifier hs-type">TyThing</span></a></span><span> </span><span class="annot"><span class="hs-comment">-- ^ boot thing</span></span><span>
</span><span id="line-1150"></span><span>               </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Types.TyThing.html#TyThing"><span class="hs-identifier hs-type">TyThing</span></a></span><span> </span><span class="annot"><span class="hs-comment">-- ^ real thing</span></span><span>
</span><span id="line-1151"></span><span>               </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#TcM"><span class="hs-identifier hs-type">TcM</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-1152"></span><span id="checkBootDeclM"><span class="annot"><span class="annottext">checkBootDeclM :: HsBootOrSig
-&gt; TyThing -&gt; TyThing -&gt; IOEnv (Env TcGblEnv TcLclEnv) ()
</span><a href="GHC.Tc.Module.html#checkBootDeclM"><span class="hs-identifier hs-var hs-var">checkBootDeclM</span></a></span></span><span> </span><span id="local-6989586621683117013"><span class="annot"><span class="annottext">HsBootOrSig
</span><a href="#local-6989586621683117013"><span class="hs-identifier hs-var">boot_or_sig</span></a></span></span><span> </span><span id="local-6989586621683117014"><span class="annot"><span class="annottext">TyThing
</span><a href="#local-6989586621683117014"><span class="hs-identifier hs-var">boot_thing</span></a></span></span><span> </span><span id="local-6989586621683117015"><span class="annot"><span class="annottext">TyThing
</span><a href="#local-6989586621683117015"><span class="hs-identifier hs-var">real_thing</span></a></span></span><span>
</span><span id="line-1153"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[BootMismatchWhat]
-&gt; (BootMismatchWhat -&gt; IOEnv (Env TcGblEnv TcLclEnv) ())
-&gt; IOEnv (Env TcGblEnv TcLclEnv) ()
forall (t :: * -&gt; *) (f :: * -&gt; *) a b.
(Foldable t, Applicative f) =&gt;
t a -&gt; (a -&gt; f b) -&gt; f ()
</span><span class="hs-identifier hs-var">for_</span></span><span> </span><span class="annot"><span class="annottext">[BootMismatchWhat]
</span><a href="#local-6989586621683117016"><span class="hs-identifier hs-var">boot_errs</span></a></span><span> </span><span class="annot"><span class="annottext">((BootMismatchWhat -&gt; IOEnv (Env TcGblEnv TcLclEnv) ())
 -&gt; IOEnv (Env TcGblEnv TcLclEnv) ())
-&gt; (BootMismatchWhat -&gt; IOEnv (Env TcGblEnv TcLclEnv) ())
-&gt; IOEnv (Env TcGblEnv TcLclEnv) ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-glyph">\</span><span> </span><span id="local-6989586621683117017"><span class="annot"><span class="annottext">BootMismatchWhat
</span><a href="#local-6989586621683117017"><span class="hs-identifier hs-var">boot_err</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-1154"></span><span>      </span><span class="annot"><span class="annottext">SrcSpan -&gt; TcRnMessage -&gt; IOEnv (Env TcGblEnv TcLclEnv) ()
</span><a href="GHC.Tc.Utils.Monad.html#addErrAt"><span class="hs-identifier hs-var">addErrAt</span></a></span><span> </span><span class="annot"><span class="annottext">SrcSpan
</span><a href="#local-6989586621683117018"><span class="hs-identifier hs-var">span</span></a></span><span> </span><span class="annot"><span class="annottext">(TcRnMessage -&gt; IOEnv (Env TcGblEnv TcLclEnv) ())
-&gt; TcRnMessage -&gt; IOEnv (Env TcGblEnv TcLclEnv) ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-1155"></span><span>        </span><span class="annot"><span class="annottext">HsBootOrSig -&gt; BootMismatch -&gt; TcRnMessage
</span><a href="GHC.Tc.Errors.Types.html#TcRnBootMismatch"><span class="hs-identifier hs-var">TcRnBootMismatch</span></a></span><span> </span><span class="annot"><span class="annottext">HsBootOrSig
</span><a href="#local-6989586621683117013"><span class="hs-identifier hs-var">boot_or_sig</span></a></span><span> </span><span class="annot"><span class="annottext">(BootMismatch -&gt; TcRnMessage) -&gt; BootMismatch -&gt; TcRnMessage
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-1156"></span><span>        </span><span class="annot"><span class="annottext">TyThing -&gt; TyThing -&gt; BootMismatchWhat -&gt; BootMismatch
</span><a href="GHC.Tc.Errors.Types.html#BootMismatch"><span class="hs-identifier hs-var">BootMismatch</span></a></span><span> </span><span class="annot"><span class="annottext">TyThing
</span><a href="#local-6989586621683117014"><span class="hs-identifier hs-var">boot_thing</span></a></span><span> </span><span class="annot"><span class="annottext">TyThing
</span><a href="#local-6989586621683117015"><span class="hs-identifier hs-var">real_thing</span></a></span><span> </span><span class="annot"><span class="annottext">BootMismatchWhat
</span><a href="#local-6989586621683117017"><span class="hs-identifier hs-var">boot_err</span></a></span><span>
</span><span id="line-1157"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-1158"></span><span>    </span><span id="local-6989586621683117016"><span class="annot"><span class="annottext">boot_errs :: [BootMismatchWhat]
</span><a href="#local-6989586621683117016"><span class="hs-identifier hs-var hs-var">boot_errs</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Writer [BootMismatchWhat] () -&gt; [BootMismatchWhat]
forall w a. Monoid w =&gt; Writer w a -&gt; w
</span><a href="../../transformers-0.6.1.2-38b1/src/Control.Monad.Trans.Writer.CPS.html#execWriter"><span class="hs-identifier hs-var">execWriter</span></a></span><span> </span><span class="annot"><span class="annottext">(Writer [BootMismatchWhat] () -&gt; [BootMismatchWhat])
-&gt; Writer [BootMismatchWhat] () -&gt; [BootMismatchWhat]
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">HsBootOrSig -&gt; TyThing -&gt; TyThing -&gt; Writer [BootMismatchWhat] ()
</span><a href="GHC.Tc.Module.html#checkBootDecl"><span class="hs-identifier hs-var">checkBootDecl</span></a></span><span> </span><span class="annot"><span class="annottext">HsBootOrSig
</span><a href="#local-6989586621683117013"><span class="hs-identifier hs-var">boot_or_sig</span></a></span><span> </span><span class="annot"><span class="annottext">TyThing
</span><a href="#local-6989586621683117014"><span class="hs-identifier hs-var">boot_thing</span></a></span><span> </span><span class="annot"><span class="annottext">TyThing
</span><a href="#local-6989586621683117015"><span class="hs-identifier hs-var">real_thing</span></a></span><span>
</span><span id="line-1159"></span><span>
</span><span id="line-1160"></span><span>    </span><span class="hs-comment">-- Here we use the span of the boot thing or, if it doesn't have a sensible</span><span>
</span><span id="line-1161"></span><span>    </span><span class="hs-comment">-- span, that of the real thing,</span><span>
</span><span id="line-1162"></span><span>    </span><span id="local-6989586621683117018"><span class="annot"><span class="annottext">span :: SrcSpan
</span><a href="#local-6989586621683117018"><span class="hs-identifier hs-var hs-var">span</span></a></span></span><span>
</span><span id="line-1163"></span><span>      </span><span class="hs-glyph">|</span><span> </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621683117021"><span class="annot"><span class="annottext">span :: SrcSpan
</span><a href="#local-6989586621683117021"><span class="hs-identifier hs-var hs-var">span</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Name -&gt; SrcSpan
</span><a href="GHC.Types.Name.html#nameSrcSpan"><span class="hs-identifier hs-var">nameSrcSpan</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TyThing -&gt; Name
forall a. NamedThing a =&gt; a -&gt; Name
</span><a href="GHC.Types.Name.html#getName"><span class="hs-identifier hs-var">getName</span></a></span><span> </span><span class="annot"><span class="annottext">TyThing
</span><a href="#local-6989586621683117014"><span class="hs-identifier hs-var">boot_thing</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1164"></span><span>      </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">SrcSpan -&gt; Bool
</span><a href="GHC.Types.SrcLoc.html#isGoodSrcSpan"><span class="hs-identifier hs-var">isGoodSrcSpan</span></a></span><span> </span><span class="annot"><span class="annottext">SrcSpan
</span><a href="#local-6989586621683117021"><span class="hs-identifier hs-var">span</span></a></span><span>
</span><span id="line-1165"></span><span>      </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">SrcSpan
</span><a href="#local-6989586621683117021"><span class="hs-identifier hs-var">span</span></a></span><span>
</span><span id="line-1166"></span><span>      </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">otherwise</span></span><span>
</span><span id="line-1167"></span><span>      </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Name -&gt; SrcSpan
</span><a href="GHC.Types.Name.html#nameSrcSpan"><span class="hs-identifier hs-var">nameSrcSpan</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TyThing -&gt; Name
forall a. NamedThing a =&gt; a -&gt; Name
</span><a href="GHC.Types.Name.html#getName"><span class="hs-identifier hs-var">getName</span></a></span><span> </span><span class="annot"><span class="annottext">TyThing
</span><a href="#local-6989586621683117015"><span class="hs-identifier hs-var">real_thing</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1168"></span><span>
</span><span id="line-1169"></span><span class="hs-comment">-- | Writer monad for accumulating errors when comparing an hs-boot or</span><span>
</span><span id="line-1170"></span><span class="hs-comment">-- signature file with its implementing module.</span><span>
</span><span id="line-1171"></span><span class="hs-keyword">type</span><span> </span><span id="BootErrsM"><span class="annot"><a href="GHC.Tc.Module.html#BootErrsM"><span class="hs-identifier hs-var">BootErrsM</span></a></span></span><span> </span><span id="local-6989586621683117023"><span class="annot"><a href="#local-6989586621683117023"><span class="hs-identifier hs-type">err</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="../../transformers-0.6.1.2-38b1/src/Control.Monad.Trans.Writer.CPS.html#Writer"><span class="hs-identifier hs-type">Writer</span></a></span><span> </span><span class="hs-special">[</span><span class="annot"><a href="#local-6989586621683117023"><span class="hs-identifier hs-type">err</span></a></span><span class="hs-special">]</span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-1172"></span><span>
</span><span id="line-1173"></span><span class="hs-comment">-- | If the test in the first parameter is True, succeed.</span><span>
</span><span id="line-1174"></span><span class="hs-comment">-- Otherwise, record the given error.</span><span>
</span><span id="line-1175"></span><span id="local-6989586621683115058"><span class="annot"><a href="GHC.Tc.Module.html#check"><span class="hs-identifier hs-type">check</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Bool</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621683115058"><span class="hs-identifier hs-type">err</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Module.html#BootErrsM"><span class="hs-identifier hs-type">BootErrsM</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683115058"><span class="hs-identifier hs-type">err</span></a></span></span><span>
</span><span id="line-1176"></span><span id="check"><span class="annot"><span class="annottext">check :: forall err. Bool -&gt; err -&gt; BootErrsM err
</span><a href="GHC.Tc.Module.html#check"><span class="hs-identifier hs-var hs-var">check</span></a></span></span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">True</span></span><span>  </span><span class="annot"><span class="annottext">err
</span><span class="hs-identifier">_</span></span><span>   </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">BootErrsM err
forall err. BootErrsM err
</span><a href="GHC.Tc.Module.html#checkSuccess"><span class="hs-identifier hs-var">checkSuccess</span></a></span><span>
</span><span id="line-1177"></span><span class="annot"><a href="GHC.Tc.Module.html#check"><span class="hs-identifier hs-var">check</span></a></span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">False</span></span><span> </span><span id="local-6989586621683117026"><span class="annot"><span class="annottext">err
</span><a href="#local-6989586621683117026"><span class="hs-identifier hs-var">err</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">err -&gt; BootErrsM err
forall err. err -&gt; BootErrsM err
</span><a href="GHC.Tc.Module.html#bootErr"><span class="hs-identifier hs-var">bootErr</span></a></span><span> </span><span class="annot"><span class="annottext">err
</span><a href="#local-6989586621683117026"><span class="hs-identifier hs-var">err</span></a></span><span>
</span><span id="line-1178"></span><span>
</span><span id="line-1179"></span><span class="annot"><span class="hs-comment">-- | Record an error.</span></span><span>
</span><span id="line-1180"></span><span id="local-6989586621683115062"><span class="annot"><a href="GHC.Tc.Module.html#bootErr"><span class="hs-identifier hs-type">bootErr</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="#local-6989586621683115062"><span class="hs-identifier hs-type">err</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Module.html#BootErrsM"><span class="hs-identifier hs-type">BootErrsM</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683115062"><span class="hs-identifier hs-type">err</span></a></span></span><span>
</span><span id="line-1181"></span><span id="bootErr"><span class="annot"><span class="annottext">bootErr :: forall err. err -&gt; BootErrsM err
</span><a href="GHC.Tc.Module.html#bootErr"><span class="hs-identifier hs-var hs-var">bootErr</span></a></span></span><span> </span><span id="local-6989586621683117030"><span class="annot"><span class="annottext">err
</span><a href="#local-6989586621683117030"><span class="hs-identifier hs-var">err</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[err] -&gt; WriterT [err] Identity ()
forall w (m :: * -&gt; *). (Monoid w, Monad m) =&gt; w -&gt; WriterT w m ()
</span><a href="../../transformers-0.6.1.2-38b1/src/Control.Monad.Trans.Writer.CPS.html#tell"><span class="hs-identifier hs-var">tell</span></a></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">err
</span><a href="#local-6989586621683117030"><span class="hs-identifier hs-var">err</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-1182"></span><span>
</span><span id="line-1183"></span><span class="annot"><span class="hs-comment">-- | A convenience synonym for a lack of errors, for @checkBootDecl@ and friends.</span></span><span>
</span><span id="line-1184"></span><span id="local-6989586621683115061"><span class="annot"><a href="GHC.Tc.Module.html#checkSuccess"><span class="hs-identifier hs-type">checkSuccess</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Tc.Module.html#BootErrsM"><span class="hs-identifier hs-type">BootErrsM</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683115061"><span class="hs-identifier hs-type">err</span></a></span></span><span>
</span><span id="line-1185"></span><span id="checkSuccess"><span class="annot"><span class="annottext">checkSuccess :: forall err. BootErrsM err
</span><a href="GHC.Tc.Module.html#checkSuccess"><span class="hs-identifier hs-var hs-var">checkSuccess</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">() -&gt; WriterT [err] Identity ()
forall a. a -&gt; WriterT [err] Identity a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-1186"></span><span>
</span><span id="line-1187"></span><span class="annot"><span class="hs-comment">-- | Map over the error types in an error-accumulating computation.</span></span><span>
</span><span id="line-1188"></span><span id="local-6989586621683115067"><span id="local-6989586621683115068"><span class="annot"><a href="GHC.Tc.Module.html#embedErrs"><span class="hs-identifier hs-type">embedErrs</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621683115067"><span class="hs-identifier hs-type">err1</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621683115068"><span class="hs-identifier hs-type">err2</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Module.html#BootErrsM"><span class="hs-identifier hs-type">BootErrsM</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683115067"><span class="hs-identifier hs-type">err1</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Module.html#BootErrsM"><span class="hs-identifier hs-type">BootErrsM</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683115068"><span class="hs-identifier hs-type">err2</span></a></span></span></span><span>
</span><span id="line-1189"></span><span id="embedErrs"><span class="annot"><span class="annottext">embedErrs :: forall err1 err2.
(err1 -&gt; err2) -&gt; BootErrsM err1 -&gt; BootErrsM err2
</span><a href="GHC.Tc.Module.html#embedErrs"><span class="hs-identifier hs-var hs-var">embedErrs</span></a></span></span><span> </span><span id="local-6989586621683117040"><span class="annot"><span class="annottext">err1 -&gt; err2
</span><a href="#local-6989586621683117040"><span class="hs-identifier hs-var">f</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(((), [err1]) -&gt; ((), [err2]))
-&gt; Writer [err1] () -&gt; Writer [err2] ()
forall w w' a b.
(Monoid w, Monoid w') =&gt;
((a, w) -&gt; (b, w')) -&gt; Writer w a -&gt; Writer w' b
</span><a href="../../transformers-0.6.1.2-38b1/src/Control.Monad.Trans.Writer.CPS.html#mapWriter"><span class="hs-identifier hs-var">mapWriter</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">([err1] -&gt; [err2]) -&gt; ((), [err1]) -&gt; ((), [err2])
forall b c d. (b -&gt; c) -&gt; (d, b) -&gt; (d, c)
forall (a :: * -&gt; * -&gt; *) b c d.
Arrow a =&gt;
a b c -&gt; a (d, b) (d, c)
</span><span class="hs-identifier hs-var">second</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(err1 -&gt; err2) -&gt; [err1] -&gt; [err2]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-identifier hs-var">fmap</span></span><span> </span><span class="annot"><span class="annottext">err1 -&gt; err2
</span><a href="#local-6989586621683117040"><span class="hs-identifier hs-var">f</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-1190"></span><span>
</span><span id="line-1191"></span><span class="annot"><span class="hs-comment">-- | Wrap up a list of errors into a single message.</span></span><span>
</span><span id="line-1192"></span><span id="local-6989586621683115080"><span id="local-6989586621683115081"><span class="annot"><a href="GHC.Tc.Module.html#wrapErrs"><span class="hs-identifier hs-type">wrapErrs</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">NE.NonEmpty</span></span><span> </span><span class="annot"><a href="#local-6989586621683115080"><span class="hs-identifier hs-type">err1</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621683115081"><span class="hs-identifier hs-type">err2</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Module.html#BootErrsM"><span class="hs-identifier hs-type">BootErrsM</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683115080"><span class="hs-identifier hs-type">err1</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Module.html#BootErrsM"><span class="hs-identifier hs-type">BootErrsM</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683115081"><span class="hs-identifier hs-type">err2</span></a></span></span></span><span>
</span><span id="line-1193"></span><span id="wrapErrs"><span class="annot"><span class="annottext">wrapErrs :: forall err1 err2.
(NonEmpty err1 -&gt; err2) -&gt; BootErrsM err1 -&gt; BootErrsM err2
</span><a href="GHC.Tc.Module.html#wrapErrs"><span class="hs-identifier hs-var hs-var">wrapErrs</span></a></span></span><span> </span><span id="local-6989586621683117044"><span class="annot"><span class="annottext">NonEmpty err1 -&gt; err2
</span><a href="#local-6989586621683117044"><span class="hs-identifier hs-var">f</span></a></span></span><span> </span><span id="local-6989586621683117045"><span class="annot"><span class="annottext">BootErrsM err1
</span><a href="#local-6989586621683117045"><span class="hs-identifier hs-var">w</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-1194"></span><span>  </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">BootErrsM err1 -&gt; [err1]
forall w a. Monoid w =&gt; Writer w a -&gt; w
</span><a href="../../transformers-0.6.1.2-38b1/src/Control.Monad.Trans.Writer.CPS.html#execWriter"><span class="hs-identifier hs-var">execWriter</span></a></span><span> </span><span class="annot"><span class="annottext">BootErrsM err1
</span><a href="#local-6989586621683117045"><span class="hs-identifier hs-var">w</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-1195"></span><span>    </span><span class="hs-special">[</span><span class="hs-special">]</span><span>         </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">BootErrsM err2
forall err. BootErrsM err
</span><a href="GHC.Tc.Module.html#checkSuccess"><span class="hs-identifier hs-var">checkSuccess</span></a></span><span>
</span><span id="line-1196"></span><span>    </span><span id="local-6989586621683117046"><span class="annot"><span class="annottext">err1
</span><a href="#local-6989586621683117046"><span class="hs-identifier hs-var">err</span></a></span></span><span> </span><span class="annot"><span class="hs-glyph hs-type">:</span></span><span> </span><span id="local-6989586621683117047"><span class="annot"><span class="annottext">[err1]
</span><a href="#local-6989586621683117047"><span class="hs-identifier hs-var">errs</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">err2 -&gt; BootErrsM err2
forall err. err -&gt; BootErrsM err
</span><a href="GHC.Tc.Module.html#bootErr"><span class="hs-identifier hs-var">bootErr</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">NonEmpty err1 -&gt; err2
</span><a href="#local-6989586621683117044"><span class="hs-identifier hs-var">f</span></a></span><span> </span><span class="annot"><span class="annottext">(NonEmpty err1 -&gt; err2) -&gt; NonEmpty err1 -&gt; err2
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">err1
</span><a href="#local-6989586621683117046"><span class="hs-identifier hs-var">err</span></a></span><span> </span><span class="annot"><span class="annottext">err1 -&gt; [err1] -&gt; NonEmpty err1
forall a. a -&gt; [a] -&gt; NonEmpty a
</span><span class="hs-operator hs-var">:|</span></span><span> </span><span class="annot"><span class="annottext">[err1]
</span><a href="#local-6989586621683117047"><span class="hs-identifier hs-var">errs</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1197"></span><span>
</span><span id="line-1198"></span><span class="hs-comment">-- | Compares the two things for equivalence between boot-file and normal</span><span>
</span><span id="line-1199"></span><span class="hs-comment">-- code. Returns @Nothing@ on success or @Just &quot;some helpful info for user&quot;@</span><span>
</span><span id="line-1200"></span><span class="hs-comment">-- failure. If the difference will be apparent to the user, @Just empty@ is</span><span>
</span><span id="line-1201"></span><span class="hs-comment">-- perfectly suitable.</span><span>
</span><span id="line-1202"></span><span class="annot"><a href="GHC.Tc.Module.html#checkBootDecl"><span class="hs-identifier hs-type">checkBootDecl</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Types.SourceFile.html#HsBootOrSig"><span class="hs-identifier hs-type">HsBootOrSig</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Types.TyThing.html#TyThing"><span class="hs-identifier hs-type">TyThing</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Types.TyThing.html#TyThing"><span class="hs-identifier hs-type">TyThing</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Module.html#BootErrsM"><span class="hs-identifier hs-type">BootErrsM</span></a></span><span> </span><span class="annot"><a href="GHC.Tc.Errors.Types.html#BootMismatchWhat"><span class="hs-identifier hs-type">BootMismatchWhat</span></a></span><span>
</span><span id="line-1203"></span><span>
</span><span id="line-1204"></span><span id="checkBootDecl"><span class="annot"><span class="annottext">checkBootDecl :: HsBootOrSig -&gt; TyThing -&gt; TyThing -&gt; Writer [BootMismatchWhat] ()
</span><a href="GHC.Tc.Module.html#checkBootDecl"><span class="hs-identifier hs-var hs-var">checkBootDecl</span></a></span></span><span> </span><span class="annot"><span class="annottext">HsBootOrSig
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Types.TyThing.html#AnId"><span class="hs-identifier hs-type">AnId</span></a></span><span> </span><span id="local-6989586621683117048"><span class="annot"><span class="annottext">Id
</span><a href="#local-6989586621683117048"><span class="hs-identifier hs-var">id1</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Types.TyThing.html#AnId"><span class="hs-identifier hs-type">AnId</span></a></span><span> </span><span id="local-6989586621683117049"><span class="annot"><span class="annottext">Id
</span><a href="#local-6989586621683117049"><span class="hs-identifier hs-var">id2</span></a></span></span><span class="hs-special">)</span><span>
</span><span id="line-1205"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Bool
-&gt; Writer [BootMismatchWhat] () -&gt; Writer [BootMismatchWhat] ()
forall a. HasCallStack =&gt; Bool -&gt; a -&gt; a
</span><a href="GHC.Utils.Panic.Plain.html#assert"><span class="hs-identifier hs-var">assert</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Id
</span><a href="#local-6989586621683117048"><span class="hs-identifier hs-var">id1</span></a></span><span> </span><span class="annot"><span class="annottext">Id -&gt; Id -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">==</span></span><span> </span><span class="annot"><span class="annottext">Id
</span><a href="#local-6989586621683117049"><span class="hs-identifier hs-var">id2</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(Writer [BootMismatchWhat] () -&gt; Writer [BootMismatchWhat] ())
-&gt; Writer [BootMismatchWhat] () -&gt; Writer [BootMismatchWhat] ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-1206"></span><span>    </span><span class="annot"><span class="annottext">Bool -&gt; BootMismatchWhat -&gt; Writer [BootMismatchWhat] ()
forall err. Bool -&gt; err -&gt; BootErrsM err
</span><a href="GHC.Tc.Module.html#check"><span class="hs-identifier hs-var">check</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Id -&gt; Type
</span><a href="GHC.Types.Id.html#idType"><span class="hs-identifier hs-var">idType</span></a></span><span> </span><span class="annot"><span class="annottext">Id
</span><a href="#local-6989586621683117048"><span class="hs-identifier hs-var">id1</span></a></span><span> </span><span class="annot"><span class="annottext">HasCallStack =&gt; Type -&gt; Type -&gt; Bool
Type -&gt; Type -&gt; Bool
</span><a href="GHC.Core.TyCo.Compare.html#eqType"><span class="hs-operator hs-var">`eqType`</span></a></span><span> </span><span class="annot"><span class="annottext">Id -&gt; Type
</span><a href="GHC.Types.Id.html#idType"><span class="hs-identifier hs-var">idType</span></a></span><span> </span><span class="annot"><span class="annottext">Id
</span><a href="#local-6989586621683117049"><span class="hs-identifier hs-var">id2</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1207"></span><span>          </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Id -&gt; Id -&gt; BootMismatchWhat
</span><a href="GHC.Tc.Errors.Types.html#BootMismatchedIdTypes"><span class="hs-identifier hs-var">BootMismatchedIdTypes</span></a></span><span> </span><span class="annot"><span class="annottext">Id
</span><a href="#local-6989586621683117048"><span class="hs-identifier hs-var">id1</span></a></span><span> </span><span class="annot"><span class="annottext">Id
</span><a href="#local-6989586621683117049"><span class="hs-identifier hs-var">id2</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1208"></span><span>
</span><span id="line-1209"></span><span class="annot"><a href="GHC.Tc.Module.html#checkBootDecl"><span class="hs-identifier hs-var">checkBootDecl</span></a></span><span> </span><span id="local-6989586621683117052"><span class="annot"><span class="annottext">HsBootOrSig
</span><a href="#local-6989586621683117052"><span class="hs-identifier hs-var">boot_or_sig</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Types.TyThing.html#ATyCon"><span class="hs-identifier hs-type">ATyCon</span></a></span><span> </span><span id="local-6989586621683117054"><span class="annot"><span class="annottext">TyCon
</span><a href="#local-6989586621683117054"><span class="hs-identifier hs-var">tc1</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Types.TyThing.html#ATyCon"><span class="hs-identifier hs-type">ATyCon</span></a></span><span> </span><span id="local-6989586621683117055"><span class="annot"><span class="annottext">TyCon
</span><a href="#local-6989586621683117055"><span class="hs-identifier hs-var">tc2</span></a></span></span><span class="hs-special">)</span><span>
</span><span id="line-1210"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(NonEmpty BootTyConMismatch -&gt; BootMismatchWhat)
-&gt; BootErrsM BootTyConMismatch -&gt; Writer [BootMismatchWhat] ()
forall err1 err2.
(NonEmpty err1 -&gt; err2) -&gt; BootErrsM err1 -&gt; BootErrsM err2
</span><a href="GHC.Tc.Module.html#wrapErrs"><span class="hs-identifier hs-var">wrapErrs</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TyCon -&gt; TyCon -&gt; NonEmpty BootTyConMismatch -&gt; BootMismatchWhat
</span><a href="GHC.Tc.Errors.Types.html#BootMismatchedTyCons"><span class="hs-identifier hs-var">BootMismatchedTyCons</span></a></span><span> </span><span class="annot"><span class="annottext">TyCon
</span><a href="#local-6989586621683117054"><span class="hs-identifier hs-var">tc1</span></a></span><span> </span><span class="annot"><span class="annottext">TyCon
</span><a href="#local-6989586621683117055"><span class="hs-identifier hs-var">tc2</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(BootErrsM BootTyConMismatch -&gt; Writer [BootMismatchWhat] ())
-&gt; BootErrsM BootTyConMismatch -&gt; Writer [BootMismatchWhat] ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-1211"></span><span>    </span><span class="annot"><span class="annottext">HsBootOrSig -&gt; TyCon -&gt; TyCon -&gt; BootErrsM BootTyConMismatch
</span><a href="GHC.Tc.Module.html#checkBootTyCon"><span class="hs-identifier hs-var">checkBootTyCon</span></a></span><span> </span><span class="annot"><span class="annottext">HsBootOrSig
</span><a href="#local-6989586621683117052"><span class="hs-identifier hs-var">boot_or_sig</span></a></span><span> </span><span class="annot"><span class="annottext">TyCon
</span><a href="#local-6989586621683117054"><span class="hs-identifier hs-var">tc1</span></a></span><span> </span><span class="annot"><span class="annottext">TyCon
</span><a href="#local-6989586621683117055"><span class="hs-identifier hs-var">tc2</span></a></span><span>
</span><span id="line-1212"></span><span>
</span><span id="line-1213"></span><span class="annot"><a href="GHC.Tc.Module.html#checkBootDecl"><span class="hs-identifier hs-var">checkBootDecl</span></a></span><span> </span><span class="annot"><span class="annottext">HsBootOrSig
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621683117058"><span class="annot"><span class="annottext">TyThing
</span><a href="#local-6989586621683117058"><span class="hs-identifier hs-var">t1</span></a></span></span><span> </span><span id="local-6989586621683117059"><span class="annot"><span class="annottext">TyThing
</span><a href="#local-6989586621683117059"><span class="hs-identifier hs-var">t2</span></a></span></span><span>
</span><span id="line-1214"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">String -&gt; SDoc -&gt; Writer [BootMismatchWhat] ()
forall a. HasCallStack =&gt; String -&gt; SDoc -&gt; a
</span><a href="GHC.Utils.Panic.html#pprPanic"><span class="hs-identifier hs-var">pprPanic</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;checkBootDecl&quot;</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TyThing -&gt; SDoc
forall a. Outputable a =&gt; a -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="annot"><span class="annottext">TyThing
</span><a href="#local-6989586621683117058"><span class="hs-identifier hs-var">t1</span></a></span><span> </span><span class="annot"><span class="annottext">SDoc -&gt; SDoc -&gt; SDoc
forall doc. IsDoc doc =&gt; doc -&gt; doc -&gt; doc
</span><a href="GHC.Utils.Outputable.html#%24%24"><span class="hs-operator hs-var">$$</span></a></span><span> </span><span class="annot"><span class="annottext">TyThing -&gt; SDoc
forall a. Outputable a =&gt; a -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="annot"><span class="annottext">TyThing
</span><a href="#local-6989586621683117059"><span class="hs-identifier hs-var">t2</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1215"></span><span>
</span><span id="line-1216"></span><span class="hs-comment">-- | Run the check provided for every pair of elements in the lists.</span><span>
</span><span id="line-1217"></span><span class="hs-comment">--</span><span>
</span><span id="line-1218"></span><span class="hs-comment">-- Records an error:</span><span>
</span><span id="line-1219"></span><span class="hs-comment">--</span><span>
</span><span id="line-1220"></span><span class="hs-comment">--  - when any two items at the same position in the two lists don't match</span><span>
</span><span id="line-1221"></span><span class="hs-comment">--    according to the given function,</span><span>
</span><span id="line-1222"></span><span class="hs-comment">--  - when the lists are of different lengths.</span><span>
</span><span id="line-1223"></span><span id="local-6989586621683115086"><span id="local-6989586621683115087"><span id="local-6989586621683115089"><span class="annot"><a href="GHC.Tc.Module.html#checkListBy"><span class="hs-identifier hs-type">checkListBy</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621683115086"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621683115086"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Module.html#BootErrsM"><span class="hs-identifier hs-type">BootErrsM</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683115087"><span class="hs-identifier hs-type">err</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="#local-6989586621683115086"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="#local-6989586621683115086"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-1224"></span><span>            </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Tc.Errors.Types.html#BootListMismatches"><span class="hs-identifier hs-type">BootListMismatches</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683115086"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683115087"><span class="hs-identifier hs-type">err</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621683115089"><span class="hs-identifier hs-type">err2</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1225"></span><span>            </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Module.html#BootErrsM"><span class="hs-identifier hs-type">BootErrsM</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683115089"><span class="hs-identifier hs-type">err2</span></a></span></span></span></span><span>
</span><span id="line-1226"></span><span id="checkListBy"><span class="annot"><span class="annottext">checkListBy :: forall a err err2.
(a -&gt; a -&gt; BootErrsM err)
-&gt; [a]
-&gt; [a]
-&gt; (BootListMismatches a err -&gt; err2)
-&gt; BootErrsM err2
</span><a href="GHC.Tc.Module.html#checkListBy"><span class="hs-identifier hs-var hs-var">checkListBy</span></a></span></span><span> </span><span id="local-6989586621683117067"><span class="annot"><span class="annottext">a -&gt; a -&gt; BootErrsM err
</span><a href="#local-6989586621683117067"><span class="hs-identifier hs-var">check_fun</span></a></span></span><span> </span><span id="local-6989586621683117068"><span class="annot"><span class="annottext">[a]
</span><a href="#local-6989586621683117068"><span class="hs-keyword hs-var">as</span></a></span></span><span> </span><span id="local-6989586621683117069"><span class="annot"><span class="annottext">[a]
</span><a href="#local-6989586621683117069"><span class="hs-identifier hs-var">bs</span></a></span></span><span> </span><span id="local-6989586621683117070"><span class="annot"><span class="annottext">BootListMismatches a err -&gt; err2
</span><a href="#local-6989586621683117070"><span class="hs-identifier hs-var">mk_err</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(BootListMismatches a err -&gt; err2)
-&gt; BootErrsM (BootListMismatch a err) -&gt; BootErrsM err2
forall err1 err2.
(NonEmpty err1 -&gt; err2) -&gt; BootErrsM err1 -&gt; BootErrsM err2
</span><a href="GHC.Tc.Module.html#wrapErrs"><span class="hs-identifier hs-var">wrapErrs</span></a></span><span> </span><span class="annot"><span class="annottext">BootListMismatches a err -&gt; err2
</span><a href="#local-6989586621683117070"><span class="hs-identifier hs-var">mk_err</span></a></span><span> </span><span class="annot"><span class="annottext">(BootErrsM (BootListMismatch a err) -&gt; BootErrsM err2)
-&gt; BootErrsM (BootListMismatch a err) -&gt; BootErrsM err2
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Arity -&gt; [a] -&gt; [a] -&gt; BootErrsM (BootListMismatch a err)
</span><a href="#local-6989586621683117071"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="annot"><span class="annottext">Arity
</span><span class="hs-number">1</span></span><span> </span><span class="annot"><span class="annottext">[a]
</span><a href="#local-6989586621683117068"><span class="hs-keyword hs-var">as</span></a></span><span> </span><span class="annot"><span class="annottext">[a]
</span><a href="#local-6989586621683117069"><span class="hs-identifier hs-var">bs</span></a></span><span>
</span><span id="line-1227"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-1228"></span><span>    </span><span id="local-6989586621683117071"><span class="annot"><span class="annottext">go :: Arity -&gt; [a] -&gt; [a] -&gt; BootErrsM (BootListMismatch a err)
</span><a href="#local-6989586621683117071"><span class="hs-identifier hs-var hs-var">go</span></a></span></span><span> </span><span class="annot"><span class="annottext">Arity
</span><span class="hs-identifier">_</span></span><span>  </span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">BootErrsM (BootListMismatch a err)
forall err. BootErrsM err
</span><a href="GHC.Tc.Module.html#checkSuccess"><span class="hs-identifier hs-var">checkSuccess</span></a></span><span>
</span><span id="line-1229"></span><span>    </span><span class="annot"><a href="#local-6989586621683117071"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="hs-glyph">!</span><span id="local-6989586621683117072"><span class="annot"><span class="annottext">Arity
</span><a href="#local-6989586621683117072"><span class="hs-identifier hs-var">i</span></a></span></span><span> </span><span class="hs-special">(</span><span id="local-6989586621683117073"><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621683117073"><span class="hs-identifier hs-var">x</span></a></span></span><span class="annot"><span class="hs-glyph hs-type">:</span></span><span id="local-6989586621683117074"><span class="annot"><span class="annottext">[a]
</span><a href="#local-6989586621683117074"><span class="hs-identifier hs-var">xs</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span id="local-6989586621683117075"><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621683117075"><span class="hs-identifier hs-var">y</span></a></span></span><span class="annot"><span class="hs-glyph hs-type">:</span></span><span id="local-6989586621683117076"><span class="annot"><span class="annottext">[a]
</span><a href="#local-6989586621683117076"><span class="hs-identifier hs-var">ys</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-1230"></span><span>      </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">(err -&gt; BootListMismatch a err)
-&gt; BootErrsM err -&gt; BootErrsM (BootListMismatch a err)
forall err1 err2.
(err1 -&gt; err2) -&gt; BootErrsM err1 -&gt; BootErrsM err2
</span><a href="GHC.Tc.Module.html#embedErrs"><span class="hs-identifier hs-var">embedErrs</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Arity -&gt; a -&gt; a -&gt; err -&gt; BootListMismatch a err
forall item err.
Arity -&gt; item -&gt; item -&gt; err -&gt; BootListMismatch item err
</span><a href="GHC.Tc.Errors.Types.html#MismatchedThing"><span class="hs-identifier hs-var">MismatchedThing</span></a></span><span> </span><span class="annot"><span class="annottext">Arity
</span><a href="#local-6989586621683117072"><span class="hs-identifier hs-var">i</span></a></span><span> </span><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621683117073"><span class="hs-identifier hs-var">x</span></a></span><span> </span><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621683117075"><span class="hs-identifier hs-var">y</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(BootErrsM err -&gt; BootErrsM (BootListMismatch a err))
-&gt; BootErrsM err -&gt; BootErrsM (BootListMismatch a err)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">a -&gt; a -&gt; BootErrsM err
</span><a href="#local-6989586621683117067"><span class="hs-identifier hs-var">check_fun</span></a></span><span> </span><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621683117073"><span class="hs-identifier hs-var">x</span></a></span><span> </span><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621683117075"><span class="hs-identifier hs-var">y</span></a></span><span>
</span><span id="line-1231"></span><span>         </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="annottext">Arity -&gt; [a] -&gt; [a] -&gt; BootErrsM (BootListMismatch a err)
</span><a href="#local-6989586621683117071"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Arity
</span><a href="#local-6989586621683117072"><span class="hs-identifier hs-var">i</span></a></span><span class="annot"><span class="annottext">Arity -&gt; Arity -&gt; Arity
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">+</span></span><span class="annot"><span class="annottext">Arity
</span><span class="hs-number">1</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[a]
</span><a href="#local-6989586621683117074"><span class="hs-identifier hs-var">xs</span></a></span><span> </span><span class="annot"><span class="annottext">[a]
</span><a href="#local-6989586621683117076"><span class="hs-identifier hs-var">ys</span></a></span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-1232"></span><span>    </span><span class="annot"><a href="#local-6989586621683117071"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="annot"><span class="annottext">Arity
</span><span class="hs-identifier">_</span></span><span>  </span><span class="annot"><span class="annottext">[a]
</span><span class="hs-identifier">_</span></span><span>  </span><span class="annot"><span class="annottext">[a]
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">BootListMismatch a err -&gt; BootErrsM (BootListMismatch a err)
forall err. err -&gt; BootErrsM err
</span><a href="GHC.Tc.Module.html#bootErr"><span class="hs-identifier hs-var">bootErr</span></a></span><span> </span><span class="annot"><span class="annottext">BootListMismatch a err
forall item err. BootListMismatch item err
</span><a href="GHC.Tc.Errors.Types.html#MismatchedLength"><span class="hs-identifier hs-var">MismatchedLength</span></a></span><span>
</span><span id="line-1233"></span><span>
</span><span id="line-1234"></span><span class="hs-comment">----------------</span><span>
</span><span id="line-1235"></span><span class="annot"><a href="GHC.Tc.Module.html#checkBootTyCon"><span class="hs-identifier hs-type">checkBootTyCon</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Types.SourceFile.html#HsBootOrSig"><span class="hs-identifier hs-type">HsBootOrSig</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Core.TyCon.html#TyCon"><span class="hs-identifier hs-type">TyCon</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Core.TyCon.html#TyCon"><span class="hs-identifier hs-type">TyCon</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Module.html#BootErrsM"><span class="hs-identifier hs-type">BootErrsM</span></a></span><span> </span><span class="annot"><a href="GHC.Tc.Errors.Types.html#BootTyConMismatch"><span class="hs-identifier hs-type">BootTyConMismatch</span></a></span><span>
</span><span id="line-1236"></span><span id="checkBootTyCon"><span class="annot"><span class="annottext">checkBootTyCon :: HsBootOrSig -&gt; TyCon -&gt; TyCon -&gt; BootErrsM BootTyConMismatch
</span><a href="GHC.Tc.Module.html#checkBootTyCon"><span class="hs-identifier hs-var hs-var">checkBootTyCon</span></a></span></span><span> </span><span id="local-6989586621683117080"><span class="annot"><span class="annottext">HsBootOrSig
</span><a href="#local-6989586621683117080"><span class="hs-identifier hs-var">boot_or_sig</span></a></span></span><span> </span><span id="local-6989586621683117081"><span class="annot"><span class="annottext">TyCon
</span><a href="#local-6989586621683117081"><span class="hs-identifier hs-var">tc1</span></a></span></span><span> </span><span id="local-6989586621683117082"><span class="annot"><span class="annottext">TyCon
</span><a href="#local-6989586621683117082"><span class="hs-identifier hs-var">tc2</span></a></span></span><span>
</span><span id="line-1237"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Bool
</span><span class="hs-identifier hs-var">not</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">HasCallStack =&gt; Type -&gt; Type -&gt; Bool
Type -&gt; Type -&gt; Bool
</span><a href="GHC.Core.TyCo.Compare.html#eqType"><span class="hs-identifier hs-var">eqType</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TyCon -&gt; Type
</span><a href="GHC.Core.TyCon.html#tyConKind"><span class="hs-identifier hs-var">tyConKind</span></a></span><span> </span><span class="annot"><span class="annottext">TyCon
</span><a href="#local-6989586621683117081"><span class="hs-identifier hs-var">tc1</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TyCon -&gt; Type
</span><a href="GHC.Core.TyCon.html#tyConKind"><span class="hs-identifier hs-var">tyConKind</span></a></span><span> </span><span class="annot"><span class="annottext">TyCon
</span><a href="#local-6989586621683117082"><span class="hs-identifier hs-var">tc2</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-1238"></span><span>  </span><span class="hs-comment">-- First off, check the kind</span><span>
</span><span id="line-1239"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">BootTyConMismatch -&gt; BootErrsM BootTyConMismatch
forall err. err -&gt; BootErrsM err
</span><a href="GHC.Tc.Module.html#bootErr"><span class="hs-identifier hs-var">bootErr</span></a></span><span> </span><span class="annot"><span class="annottext">BootTyConMismatch
</span><a href="GHC.Tc.Errors.Types.html#TyConKindMismatch"><span class="hs-identifier hs-var">TyConKindMismatch</span></a></span><span>
</span><span id="line-1240"></span><span>
</span><span id="line-1241"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span id="local-6989586621683117085"><span class="annot"><span class="annottext">Class
</span><a href="#local-6989586621683117085"><span class="hs-identifier hs-var">c1</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">TyCon -&gt; Maybe Class
</span><a href="GHC.Core.TyCon.html#tyConClass_maybe"><span class="hs-identifier hs-var">tyConClass_maybe</span></a></span><span> </span><span class="annot"><span class="annottext">TyCon
</span><a href="#local-6989586621683117081"><span class="hs-identifier hs-var">tc1</span></a></span><span>
</span><span id="line-1242"></span><span>  </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span id="local-6989586621683117087"><span class="annot"><span class="annottext">Class
</span><a href="#local-6989586621683117087"><span class="hs-identifier hs-var">c2</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">TyCon -&gt; Maybe Class
</span><a href="GHC.Core.TyCon.html#tyConClass_maybe"><span class="hs-identifier hs-var">tyConClass_maybe</span></a></span><span> </span><span class="annot"><span class="annottext">TyCon
</span><a href="#local-6989586621683117082"><span class="hs-identifier hs-var">tc2</span></a></span><span>
</span><span id="line-1243"></span><span>  </span><span class="hs-special">,</span><span> </span><span class="hs-keyword">let</span><span> </span><span class="hs-special">(</span><span id="local-6989586621683117088"><span class="annot"><span class="annottext">[Id]
</span><a href="#local-6989586621683117088"><span class="hs-identifier hs-var">clas_tvs1</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621683117089"><span class="annot"><span class="annottext">[FunDep Id]
</span><a href="#local-6989586621683117089"><span class="hs-identifier hs-var">clas_fds1</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621683117090"><span class="annot"><span class="annottext">[Type]
</span><a href="#local-6989586621683117090"><span class="hs-identifier hs-var">sc_theta1</span></a></span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">[Id]
</span><span class="hs-identifier">_</span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621683117091"><span class="annot"><span class="annottext">[ClassATItem]
</span><a href="#local-6989586621683117091"><span class="hs-identifier hs-var">ats1</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621683117092"><span class="annot"><span class="annottext">[ClassOpItem]
</span><a href="#local-6989586621683117092"><span class="hs-identifier hs-var">op_stuff1</span></a></span></span><span class="hs-special">)</span><span>
</span><span id="line-1244"></span><span>          </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Class
-&gt; ([Id], [FunDep Id], [Type], [Id], [ClassATItem], [ClassOpItem])
</span><a href="GHC.Core.Class.html#classExtraBigSig"><span class="hs-identifier hs-var">classExtraBigSig</span></a></span><span> </span><span class="annot"><span class="annottext">Class
</span><a href="#local-6989586621683117085"><span class="hs-identifier hs-var">c1</span></a></span><span>
</span><span id="line-1245"></span><span>        </span><span class="hs-special">(</span><span id="local-6989586621683117094"><span class="annot"><span class="annottext">[Id]
</span><a href="#local-6989586621683117094"><span class="hs-identifier hs-var">clas_tvs2</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621683117095"><span class="annot"><span class="annottext">[FunDep Id]
</span><a href="#local-6989586621683117095"><span class="hs-identifier hs-var">clas_fds2</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621683117096"><span class="annot"><span class="annottext">[Type]
</span><a href="#local-6989586621683117096"><span class="hs-identifier hs-var">sc_theta2</span></a></span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">[Id]
</span><span class="hs-identifier">_</span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621683117097"><span class="annot"><span class="annottext">[ClassATItem]
</span><a href="#local-6989586621683117097"><span class="hs-identifier hs-var">ats2</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621683117098"><span class="annot"><span class="annottext">[ClassOpItem]
</span><a href="#local-6989586621683117098"><span class="hs-identifier hs-var">op_stuff2</span></a></span></span><span class="hs-special">)</span><span>
</span><span id="line-1246"></span><span>          </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Class
-&gt; ([Id], [FunDep Id], [Type], [Id], [ClassATItem], [ClassOpItem])
</span><a href="GHC.Core.Class.html#classExtraBigSig"><span class="hs-identifier hs-var">classExtraBigSig</span></a></span><span> </span><span class="annot"><span class="annottext">Class
</span><a href="#local-6989586621683117087"><span class="hs-identifier hs-var">c2</span></a></span><span>
</span><span id="line-1247"></span><span>  </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span id="local-6989586621683117099"><span class="annot"><span class="annottext">RnEnv2
</span><a href="#local-6989586621683117099"><span class="hs-identifier hs-var">env</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">HasCallStack =&gt; RnEnv2 -&gt; [Id] -&gt; [Id] -&gt; Maybe RnEnv2
RnEnv2 -&gt; [Id] -&gt; [Id] -&gt; Maybe RnEnv2
</span><a href="GHC.Core.TyCo.Compare.html#eqVarBndrs"><span class="hs-identifier hs-var">eqVarBndrs</span></a></span><span> </span><span class="annot"><span class="annottext">RnEnv2
</span><a href="GHC.Tc.Module.html#emptyRnEnv2"><span class="hs-identifier hs-var">emptyRnEnv2</span></a></span><span> </span><span class="annot"><span class="annottext">[Id]
</span><a href="#local-6989586621683117088"><span class="hs-identifier hs-var">clas_tvs1</span></a></span><span> </span><span class="annot"><span class="annottext">[Id]
</span><a href="#local-6989586621683117094"><span class="hs-identifier hs-var">clas_tvs2</span></a></span><span>
</span><span id="line-1248"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">BootErrsM BootTyConMismatch
</span><a href="#local-6989586621683117102"><span class="hs-identifier hs-var">check_roles</span></a></span><span>
</span><span id="line-1249"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="annottext">(BootClassMismatch -&gt; BootTyConMismatch)
-&gt; BootErrsM BootClassMismatch -&gt; BootErrsM BootTyConMismatch
forall err1 err2.
(err1 -&gt; err2) -&gt; BootErrsM err1 -&gt; BootErrsM err2
</span><a href="GHC.Tc.Module.html#embedErrs"><span class="hs-identifier hs-var">embedErrs</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Class -&gt; Class -&gt; BootClassMismatch -&gt; BootTyConMismatch
</span><a href="GHC.Tc.Errors.Types.html#TyConMismatchedClasses"><span class="hs-identifier hs-var">TyConMismatchedClasses</span></a></span><span> </span><span class="annot"><span class="annottext">Class
</span><a href="#local-6989586621683117085"><span class="hs-identifier hs-var">c1</span></a></span><span> </span><span class="annot"><span class="annottext">Class
</span><a href="#local-6989586621683117087"><span class="hs-identifier hs-var">c2</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(BootErrsM BootClassMismatch -&gt; BootErrsM BootTyConMismatch)
-&gt; BootErrsM BootClassMismatch -&gt; BootErrsM BootTyConMismatch
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-1250"></span><span>    </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span class="hs-comment">-- Checks kind of class</span><span>
</span><span id="line-1251"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="annottext">Bool -&gt; BootClassMismatch -&gt; BootErrsM BootClassMismatch
forall err. Bool -&gt; err -&gt; BootErrsM err
</span><a href="GHC.Tc.Module.html#check"><span class="hs-identifier hs-var">check</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(FunDep Id -&gt; FunDep Id -&gt; Bool)
-&gt; [FunDep Id] -&gt; [FunDep Id] -&gt; Bool
forall a b. (a -&gt; b -&gt; Bool) -&gt; [a] -&gt; [b] -&gt; Bool
forall (f :: * -&gt; *) a b.
Eq1 f =&gt;
(a -&gt; b -&gt; Bool) -&gt; f a -&gt; f b -&gt; Bool
</span><a href="../../base-4.21.0.0-ae91/src/Data.Functor.Classes.html#liftEq"><span class="hs-identifier hs-var">liftEq</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">RnEnv2 -&gt; FunDep Id -&gt; FunDep Id -&gt; Bool
</span><a href="GHC.Tc.Module.html#eqFD"><span class="hs-identifier hs-var">eqFD</span></a></span><span> </span><span class="annot"><span class="annottext">RnEnv2
</span><a href="#local-6989586621683117099"><span class="hs-identifier hs-var">env</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[FunDep Id]
</span><a href="#local-6989586621683117089"><span class="hs-identifier hs-var">clas_fds1</span></a></span><span> </span><span class="annot"><span class="annottext">[FunDep Id]
</span><a href="#local-6989586621683117095"><span class="hs-identifier hs-var">clas_fds2</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1252"></span><span>           </span><span class="annot"><span class="annottext">BootClassMismatch
</span><a href="GHC.Tc.Errors.Types.html#MismatchedFunDeps"><span class="hs-identifier hs-var">MismatchedFunDeps</span></a></span><span>
</span><span id="line-1253"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="annottext">Bool -&gt; BootErrsM BootClassMismatch -&gt; BootErrsM BootClassMismatch
forall (f :: * -&gt; *). Applicative f =&gt; Bool -&gt; f () -&gt; f ()
</span><span class="hs-identifier hs-var">unless</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TyCon -&gt; Bool
</span><a href="GHC.Core.TyCon.html#isAbstractTyCon"><span class="hs-identifier hs-var">isAbstractTyCon</span></a></span><span> </span><span class="annot"><span class="annottext">TyCon
</span><a href="#local-6989586621683117081"><span class="hs-identifier hs-var">tc1</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(BootErrsM BootClassMismatch -&gt; BootErrsM BootClassMismatch)
-&gt; BootErrsM BootClassMismatch -&gt; BootErrsM BootClassMismatch
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-1254"></span><span>    </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">Bool -&gt; BootClassMismatch -&gt; BootErrsM BootClassMismatch
forall err. Bool -&gt; err -&gt; BootErrsM err
</span><a href="GHC.Tc.Module.html#check"><span class="hs-identifier hs-var">check</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(Type -&gt; Type -&gt; Bool) -&gt; [Type] -&gt; [Type] -&gt; Bool
forall a b. (a -&gt; b -&gt; Bool) -&gt; [a] -&gt; [b] -&gt; Bool
forall (f :: * -&gt; *) a b.
Eq1 f =&gt;
(a -&gt; b -&gt; Bool) -&gt; f a -&gt; f b -&gt; Bool
</span><a href="../../base-4.21.0.0-ae91/src/Data.Functor.Classes.html#liftEq"><span class="hs-identifier hs-var">liftEq</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">HasCallStack =&gt; RnEnv2 -&gt; Type -&gt; Type -&gt; Bool
RnEnv2 -&gt; Type -&gt; Type -&gt; Bool
</span><a href="GHC.Core.TyCo.Compare.html#eqTypeX"><span class="hs-identifier hs-var">eqTypeX</span></a></span><span> </span><span class="annot"><span class="annottext">RnEnv2
</span><a href="#local-6989586621683117099"><span class="hs-identifier hs-var">env</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[Type]
</span><a href="#local-6989586621683117090"><span class="hs-identifier hs-var">sc_theta1</span></a></span><span> </span><span class="annot"><span class="annottext">[Type]
</span><a href="#local-6989586621683117096"><span class="hs-identifier hs-var">sc_theta2</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1255"></span><span>           </span><span class="annot"><span class="annottext">BootClassMismatch
</span><a href="GHC.Tc.Errors.Types.html#MismatchedSuperclasses"><span class="hs-identifier hs-var">MismatchedSuperclasses</span></a></span><span>
</span><span id="line-1256"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="annottext">(ClassOpItem -&gt; ClassOpItem -&gt; BootErrsM BootMethodMismatch)
-&gt; [ClassOpItem]
-&gt; [ClassOpItem]
-&gt; (BootListMismatches ClassOpItem BootMethodMismatch
    -&gt; BootClassMismatch)
-&gt; BootErrsM BootClassMismatch
forall a err err2.
(a -&gt; a -&gt; BootErrsM err)
-&gt; [a]
-&gt; [a]
-&gt; (BootListMismatches a err -&gt; err2)
-&gt; BootErrsM err2
</span><a href="GHC.Tc.Module.html#checkListBy"><span class="hs-identifier hs-var">checkListBy</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">RnEnv2
-&gt; HsBootOrSig
-&gt; ClassOpItem
-&gt; ClassOpItem
-&gt; BootErrsM BootMethodMismatch
</span><a href="GHC.Tc.Module.html#compatClassOp"><span class="hs-identifier hs-var">compatClassOp</span></a></span><span> </span><span class="annot"><span class="annottext">RnEnv2
</span><a href="#local-6989586621683117099"><span class="hs-identifier hs-var">env</span></a></span><span> </span><span class="annot"><span class="annottext">HsBootOrSig
</span><a href="#local-6989586621683117080"><span class="hs-identifier hs-var">boot_or_sig</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[ClassOpItem]
</span><a href="#local-6989586621683117092"><span class="hs-identifier hs-var">op_stuff1</span></a></span><span> </span><span class="annot"><span class="annottext">[ClassOpItem]
</span><a href="#local-6989586621683117098"><span class="hs-identifier hs-var">op_stuff2</span></a></span><span>
</span><span id="line-1257"></span><span>           </span><span class="annot"><span class="annottext">BootListMismatches ClassOpItem BootMethodMismatch
-&gt; BootClassMismatch
</span><a href="GHC.Tc.Errors.Types.html#MismatchedMethods"><span class="hs-identifier hs-var">MismatchedMethods</span></a></span><span>
</span><span id="line-1258"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="annottext">(ClassATItem -&gt; ClassATItem -&gt; BootErrsM BootATMismatch)
-&gt; [ClassATItem]
-&gt; [ClassATItem]
-&gt; (BootListMismatches ClassATItem BootATMismatch
    -&gt; BootClassMismatch)
-&gt; BootErrsM BootClassMismatch
forall a err err2.
(a -&gt; a -&gt; BootErrsM err)
-&gt; [a]
-&gt; [a]
-&gt; (BootListMismatches a err -&gt; err2)
-&gt; BootErrsM err2
</span><a href="GHC.Tc.Module.html#checkListBy"><span class="hs-identifier hs-var">checkListBy</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">RnEnv2
-&gt; HsBootOrSig
-&gt; ClassATItem
-&gt; ClassATItem
-&gt; BootErrsM BootATMismatch
</span><a href="GHC.Tc.Module.html#compatAT"><span class="hs-identifier hs-var">compatAT</span></a></span><span> </span><span class="annot"><span class="annottext">RnEnv2
</span><a href="#local-6989586621683117099"><span class="hs-identifier hs-var">env</span></a></span><span> </span><span class="annot"><span class="annottext">HsBootOrSig
</span><a href="#local-6989586621683117080"><span class="hs-identifier hs-var">boot_or_sig</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[ClassATItem]
</span><a href="#local-6989586621683117091"><span class="hs-identifier hs-var">ats1</span></a></span><span> </span><span class="annot"><span class="annottext">[ClassATItem]
</span><a href="#local-6989586621683117097"><span class="hs-identifier hs-var">ats2</span></a></span><span>
</span><span id="line-1259"></span><span>           </span><span class="annot"><span class="annottext">BootListMismatches ClassATItem BootATMismatch -&gt; BootClassMismatch
</span><a href="GHC.Tc.Errors.Types.html#MismatchedATs"><span class="hs-identifier hs-var">MismatchedATs</span></a></span><span>
</span><span id="line-1260"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="annottext">Bool -&gt; BootClassMismatch -&gt; BootErrsM BootClassMismatch
forall err. Bool -&gt; err -&gt; BootErrsM err
</span><a href="GHC.Tc.Module.html#check"><span class="hs-identifier hs-var">check</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Class -&gt; ClassMinimalDef
</span><a href="GHC.Core.Class.html#classMinimalDef"><span class="hs-identifier hs-var">classMinimalDef</span></a></span><span> </span><span class="annot"><span class="annottext">Class
</span><a href="#local-6989586621683117085"><span class="hs-identifier hs-var">c1</span></a></span><span> </span><span class="annot"><span class="annottext">ClassMinimalDef -&gt; ClassMinimalDef -&gt; Bool
forall a.
Uniquable a =&gt;
BooleanFormula a -&gt; BooleanFormula a -&gt; Bool
</span><a href="GHC.Data.BooleanFormula.html#implies"><span class="hs-operator hs-var">`BF.implies`</span></a></span><span> </span><span class="annot"><span class="annottext">Class -&gt; ClassMinimalDef
</span><a href="GHC.Core.Class.html#classMinimalDef"><span class="hs-identifier hs-var">classMinimalDef</span></a></span><span> </span><span class="annot"><span class="annottext">Class
</span><a href="#local-6989586621683117087"><span class="hs-identifier hs-var">c2</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1261"></span><span>           </span><span class="annot"><span class="annottext">BootClassMismatch
</span><a href="GHC.Tc.Errors.Types.html#MismatchedMinimalPragmas"><span class="hs-identifier hs-var">MismatchedMinimalPragmas</span></a></span><span>
</span><span id="line-1262"></span><span>       </span><span class="hs-special">}</span><span> </span><span class="hs-special">}</span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-1263"></span><span>
</span><span id="line-1264"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span id="local-6989586621683117116"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621683117116"><span class="hs-identifier hs-var">syn_rhs1</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">TyCon -&gt; Maybe Type
</span><a href="GHC.Core.TyCon.html#synTyConRhs_maybe"><span class="hs-identifier hs-var">synTyConRhs_maybe</span></a></span><span> </span><span class="annot"><span class="annottext">TyCon
</span><a href="#local-6989586621683117081"><span class="hs-identifier hs-var">tc1</span></a></span><span>
</span><span id="line-1265"></span><span>  </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span id="local-6989586621683117118"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621683117118"><span class="hs-identifier hs-var">syn_rhs2</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">TyCon -&gt; Maybe Type
</span><a href="GHC.Core.TyCon.html#synTyConRhs_maybe"><span class="hs-identifier hs-var">synTyConRhs_maybe</span></a></span><span> </span><span class="annot"><span class="annottext">TyCon
</span><a href="#local-6989586621683117082"><span class="hs-identifier hs-var">tc2</span></a></span><span>
</span><span id="line-1266"></span><span>  </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span id="local-6989586621683117119"><span class="annot"><span class="annottext">RnEnv2
</span><a href="#local-6989586621683117119"><span class="hs-identifier hs-var">env</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">HasCallStack =&gt; RnEnv2 -&gt; [Id] -&gt; [Id] -&gt; Maybe RnEnv2
RnEnv2 -&gt; [Id] -&gt; [Id] -&gt; Maybe RnEnv2
</span><a href="GHC.Core.TyCo.Compare.html#eqVarBndrs"><span class="hs-identifier hs-var">eqVarBndrs</span></a></span><span> </span><span class="annot"><span class="annottext">RnEnv2
</span><a href="GHC.Tc.Module.html#emptyRnEnv2"><span class="hs-identifier hs-var">emptyRnEnv2</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TyCon -&gt; [Id]
</span><a href="GHC.Core.TyCon.html#tyConTyVars"><span class="hs-identifier hs-var">tyConTyVars</span></a></span><span> </span><span class="annot"><span class="annottext">TyCon
</span><a href="#local-6989586621683117081"><span class="hs-identifier hs-var">tc1</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TyCon -&gt; [Id]
</span><a href="GHC.Core.TyCon.html#tyConTyVars"><span class="hs-identifier hs-var">tyConTyVars</span></a></span><span> </span><span class="annot"><span class="annottext">TyCon
</span><a href="#local-6989586621683117082"><span class="hs-identifier hs-var">tc2</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1267"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Bool -&gt; BootErrsM BootTyConMismatch -&gt; BootErrsM BootTyConMismatch
forall a. HasCallStack =&gt; Bool -&gt; a -&gt; a
</span><a href="GHC.Utils.Panic.Plain.html#assert"><span class="hs-identifier hs-var">assert</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TyCon
</span><a href="#local-6989586621683117081"><span class="hs-identifier hs-var">tc1</span></a></span><span> </span><span class="annot"><span class="annottext">TyCon -&gt; TyCon -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">==</span></span><span> </span><span class="annot"><span class="annottext">TyCon
</span><a href="#local-6989586621683117082"><span class="hs-identifier hs-var">tc2</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(BootErrsM BootTyConMismatch -&gt; BootErrsM BootTyConMismatch)
-&gt; BootErrsM BootTyConMismatch -&gt; BootErrsM BootTyConMismatch
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-1268"></span><span>  </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">BootErrsM BootTyConMismatch
</span><a href="#local-6989586621683117102"><span class="hs-identifier hs-var">check_roles</span></a></span><span>
</span><span id="line-1269"></span><span>     </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="annottext">Bool -&gt; BootTyConMismatch -&gt; BootErrsM BootTyConMismatch
forall err. Bool -&gt; err -&gt; BootErrsM err
</span><a href="GHC.Tc.Module.html#check"><span class="hs-identifier hs-var">check</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">HasCallStack =&gt; RnEnv2 -&gt; Type -&gt; Type -&gt; Bool
RnEnv2 -&gt; Type -&gt; Type -&gt; Bool
</span><a href="GHC.Core.TyCo.Compare.html#eqTypeX"><span class="hs-identifier hs-var">eqTypeX</span></a></span><span> </span><span class="annot"><span class="annottext">RnEnv2
</span><a href="#local-6989586621683117119"><span class="hs-identifier hs-var">env</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621683117116"><span class="hs-identifier hs-var">syn_rhs1</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621683117118"><span class="hs-identifier hs-var">syn_rhs2</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(BootTyConMismatch -&gt; BootErrsM BootTyConMismatch)
-&gt; BootTyConMismatch -&gt; BootErrsM BootTyConMismatch
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-1270"></span><span>        </span><span class="annot"><span class="annottext">Type -&gt; Type -&gt; BootTyConMismatch
</span><a href="GHC.Tc.Errors.Types.html#TyConSynonymMismatch"><span class="hs-identifier hs-var">TyConSynonymMismatch</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621683117116"><span class="hs-identifier hs-var">syn_rhs1</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621683117118"><span class="hs-identifier hs-var">syn_rhs2</span></a></span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-1271"></span><span>
</span><span id="line-1272"></span><span>  </span><span class="hs-comment">-- This allows abstract 'data T a' to be implemented using 'type T = ...'</span><span>
</span><span id="line-1273"></span><span>  </span><span class="hs-comment">-- and abstract 'class K a' to be implement using 'type K = ...'</span><span>
</span><span id="line-1274"></span><span>  </span><span class="hs-comment">-- See Note [Synonyms implement abstract data]</span><span>
</span><span id="line-1275"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">HsBootOrSig
</span><a href="GHC.Types.SourceFile.html#Hsig"><span class="hs-identifier hs-var">Hsig</span></a></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">HsBootOrSig
</span><a href="#local-6989586621683117080"><span class="hs-identifier hs-var">boot_or_sig</span></a></span><span> </span><span class="hs-comment">-- don't support for hs-boot yet</span><span>
</span><span id="line-1276"></span><span>  </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">TyCon -&gt; Bool
</span><a href="GHC.Core.TyCon.html#isAbstractTyCon"><span class="hs-identifier hs-var">isAbstractTyCon</span></a></span><span> </span><span class="annot"><span class="annottext">TyCon
</span><a href="#local-6989586621683117081"><span class="hs-identifier hs-var">tc1</span></a></span><span>
</span><span id="line-1277"></span><span>  </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span class="hs-special">(</span><span id="local-6989586621683117123"><span class="annot"><span class="annottext">[Id]
</span><a href="#local-6989586621683117123"><span class="hs-identifier hs-var">tvs</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621683117124"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621683117124"><span class="hs-identifier hs-var">ty</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">TyCon -&gt; Maybe ([Id], Type)
</span><a href="GHC.Core.TyCon.html#synTyConDefn_maybe"><span class="hs-identifier hs-var">synTyConDefn_maybe</span></a></span><span> </span><span class="annot"><span class="annottext">TyCon
</span><a href="#local-6989586621683117082"><span class="hs-identifier hs-var">tc2</span></a></span><span>
</span><span id="line-1278"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">TyCon -&gt; TyCon -&gt; [Id] -&gt; Type -&gt; BootErrsM BootTyConMismatch
</span><a href="GHC.Tc.Module.html#checkSynAbsData"><span class="hs-identifier hs-var">checkSynAbsData</span></a></span><span> </span><span class="annot"><span class="annottext">TyCon
</span><a href="#local-6989586621683117081"><span class="hs-identifier hs-var">tc1</span></a></span><span> </span><span class="annot"><span class="annottext">TyCon
</span><a href="#local-6989586621683117082"><span class="hs-identifier hs-var">tc2</span></a></span><span> </span><span class="annot"><span class="annottext">[Id]
</span><a href="#local-6989586621683117123"><span class="hs-identifier hs-var">tvs</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621683117124"><span class="hs-identifier hs-var">ty</span></a></span><span>
</span><span id="line-1279"></span><span>
</span><span id="line-1280"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span id="local-6989586621683117127"><span class="annot"><span class="annottext">FamTyConFlav
</span><a href="#local-6989586621683117127"><span class="hs-identifier hs-var">fam_flav1</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">TyCon -&gt; Maybe FamTyConFlav
</span><a href="GHC.Core.TyCon.html#famTyConFlav_maybe"><span class="hs-identifier hs-var">famTyConFlav_maybe</span></a></span><span> </span><span class="annot"><span class="annottext">TyCon
</span><a href="#local-6989586621683117081"><span class="hs-identifier hs-var">tc1</span></a></span><span>
</span><span id="line-1281"></span><span>  </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span id="local-6989586621683117129"><span class="annot"><span class="annottext">FamTyConFlav
</span><a href="#local-6989586621683117129"><span class="hs-identifier hs-var">fam_flav2</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">TyCon -&gt; Maybe FamTyConFlav
</span><a href="GHC.Core.TyCon.html#famTyConFlav_maybe"><span class="hs-identifier hs-var">famTyConFlav_maybe</span></a></span><span> </span><span class="annot"><span class="annottext">TyCon
</span><a href="#local-6989586621683117082"><span class="hs-identifier hs-var">tc2</span></a></span><span>
</span><span id="line-1282"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Bool -&gt; BootErrsM BootTyConMismatch -&gt; BootErrsM BootTyConMismatch
forall a. HasCallStack =&gt; Bool -&gt; a -&gt; a
</span><a href="GHC.Utils.Panic.Plain.html#assert"><span class="hs-identifier hs-var">assert</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TyCon
</span><a href="#local-6989586621683117081"><span class="hs-identifier hs-var">tc1</span></a></span><span> </span><span class="annot"><span class="annottext">TyCon -&gt; TyCon -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">==</span></span><span> </span><span class="annot"><span class="annottext">TyCon
</span><a href="#local-6989586621683117082"><span class="hs-identifier hs-var">tc2</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(BootErrsM BootTyConMismatch -&gt; BootErrsM BootTyConMismatch)
-&gt; BootErrsM BootTyConMismatch -&gt; BootErrsM BootTyConMismatch
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-1283"></span><span>    </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621683117130"><span class="annot"><span class="annottext">injInfo1 :: Injectivity
</span><a href="#local-6989586621683117130"><span class="hs-identifier hs-var hs-var hs-var">injInfo1</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">TyCon -&gt; Injectivity
</span><a href="GHC.Core.TyCon.html#tyConInjectivityInfo"><span class="hs-identifier hs-var">tyConInjectivityInfo</span></a></span><span> </span><span class="annot"><span class="annottext">TyCon
</span><a href="#local-6989586621683117081"><span class="hs-identifier hs-var">tc1</span></a></span><span>
</span><span id="line-1284"></span><span>             </span><span id="local-6989586621683117132"><span class="annot"><span class="annottext">injInfo2 :: Injectivity
</span><a href="#local-6989586621683117132"><span class="hs-identifier hs-var hs-var hs-var">injInfo2</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">TyCon -&gt; Injectivity
</span><a href="GHC.Core.TyCon.html#tyConInjectivityInfo"><span class="hs-identifier hs-var">tyConInjectivityInfo</span></a></span><span> </span><span class="annot"><span class="annottext">TyCon
</span><a href="#local-6989586621683117082"><span class="hs-identifier hs-var">tc2</span></a></span><span>
</span><span id="line-1285"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="hs-comment">-- check equality of roles, family flavours and injectivity annotations</span><span>
</span><span id="line-1286"></span><span>         </span><span class="hs-comment">-- (NB: Type family roles are always nominal. But the check is</span><span>
</span><span id="line-1287"></span><span>         </span><span class="hs-comment">-- harmless enough.)</span><span>
</span><span id="line-1288"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="annottext">BootErrsM BootTyConMismatch
</span><a href="#local-6989586621683117102"><span class="hs-identifier hs-var">check_roles</span></a></span><span>
</span><span id="line-1289"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="annottext">FamTyConFlav -&gt; FamTyConFlav -&gt; BootErrsM BootTyConMismatch
</span><a href="GHC.Tc.Module.html#compatFamFlav"><span class="hs-identifier hs-var">compatFamFlav</span></a></span><span> </span><span class="annot"><span class="annottext">FamTyConFlav
</span><a href="#local-6989586621683117127"><span class="hs-identifier hs-var">fam_flav1</span></a></span><span> </span><span class="annot"><span class="annottext">FamTyConFlav
</span><a href="#local-6989586621683117129"><span class="hs-identifier hs-var">fam_flav2</span></a></span><span>
</span><span id="line-1290"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="annottext">Bool -&gt; BootTyConMismatch -&gt; BootErrsM BootTyConMismatch
forall err. Bool -&gt; err -&gt; BootErrsM err
</span><a href="GHC.Tc.Module.html#check"><span class="hs-identifier hs-var">check</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Injectivity
</span><a href="#local-6989586621683117130"><span class="hs-identifier hs-var">injInfo1</span></a></span><span> </span><span class="annot"><span class="annottext">Injectivity -&gt; Injectivity -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">==</span></span><span> </span><span class="annot"><span class="annottext">Injectivity
</span><a href="#local-6989586621683117132"><span class="hs-identifier hs-var">injInfo2</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">BootTyConMismatch
</span><a href="GHC.Tc.Errors.Types.html#TyConInjectivityMismatch"><span class="hs-identifier hs-var">TyConInjectivityMismatch</span></a></span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-1291"></span><span>
</span><span id="line-1292"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">TyCon -&gt; Bool
</span><a href="GHC.Core.TyCon.html#isAlgTyCon"><span class="hs-identifier hs-var">isAlgTyCon</span></a></span><span> </span><span class="annot"><span class="annottext">TyCon
</span><a href="#local-6989586621683117081"><span class="hs-identifier hs-var">tc1</span></a></span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Bool -&gt; Bool
</span><span class="hs-operator hs-var">&amp;&amp;</span></span><span> </span><span class="annot"><span class="annottext">TyCon -&gt; Bool
</span><a href="GHC.Core.TyCon.html#isAlgTyCon"><span class="hs-identifier hs-var">isAlgTyCon</span></a></span><span> </span><span class="annot"><span class="annottext">TyCon
</span><a href="#local-6989586621683117082"><span class="hs-identifier hs-var">tc2</span></a></span><span>
</span><span id="line-1293"></span><span>  </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span id="local-6989586621683117137"><span class="annot"><span class="annottext">RnEnv2
</span><a href="#local-6989586621683117137"><span class="hs-identifier hs-var">env</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">HasCallStack =&gt; RnEnv2 -&gt; [Id] -&gt; [Id] -&gt; Maybe RnEnv2
RnEnv2 -&gt; [Id] -&gt; [Id] -&gt; Maybe RnEnv2
</span><a href="GHC.Core.TyCo.Compare.html#eqVarBndrs"><span class="hs-identifier hs-var">eqVarBndrs</span></a></span><span> </span><span class="annot"><span class="annottext">RnEnv2
</span><a href="GHC.Tc.Module.html#emptyRnEnv2"><span class="hs-identifier hs-var">emptyRnEnv2</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TyCon -&gt; [Id]
</span><a href="GHC.Core.TyCon.html#tyConTyVars"><span class="hs-identifier hs-var">tyConTyVars</span></a></span><span> </span><span class="annot"><span class="annottext">TyCon
</span><a href="#local-6989586621683117081"><span class="hs-identifier hs-var">tc1</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TyCon -&gt; [Id]
</span><a href="GHC.Core.TyCon.html#tyConTyVars"><span class="hs-identifier hs-var">tyConTyVars</span></a></span><span> </span><span class="annot"><span class="annottext">TyCon
</span><a href="#local-6989586621683117082"><span class="hs-identifier hs-var">tc2</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1294"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Bool -&gt; BootErrsM BootTyConMismatch -&gt; BootErrsM BootTyConMismatch
forall a. HasCallStack =&gt; Bool -&gt; a -&gt; a
</span><a href="GHC.Utils.Panic.Plain.html#assert"><span class="hs-identifier hs-var">assert</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TyCon
</span><a href="#local-6989586621683117081"><span class="hs-identifier hs-var">tc1</span></a></span><span> </span><span class="annot"><span class="annottext">TyCon -&gt; TyCon -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">==</span></span><span> </span><span class="annot"><span class="annottext">TyCon
</span><a href="#local-6989586621683117082"><span class="hs-identifier hs-var">tc2</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(BootErrsM BootTyConMismatch -&gt; BootErrsM BootTyConMismatch)
-&gt; BootErrsM BootTyConMismatch -&gt; BootErrsM BootTyConMismatch
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-1295"></span><span>  </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">BootErrsM BootTyConMismatch
</span><a href="#local-6989586621683117102"><span class="hs-identifier hs-var">check_roles</span></a></span><span>
</span><span id="line-1296"></span><span>     </span><span class="hs-special">;</span><span> </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621683117138"><span class="annot"><span class="annottext">rhs1 :: AlgTyConRhs
</span><a href="#local-6989586621683117138"><span class="hs-identifier hs-var hs-var">rhs1</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">TyCon -&gt; AlgTyConRhs
</span><a href="GHC.Core.TyCon.html#algTyConRhs"><span class="hs-identifier hs-var">algTyConRhs</span></a></span><span> </span><span class="annot"><span class="annottext">TyCon
</span><a href="#local-6989586621683117081"><span class="hs-identifier hs-var">tc1</span></a></span><span>
</span><span id="line-1297"></span><span>           </span><span id="local-6989586621683117140"><span class="annot"><span class="annottext">rhs2 :: AlgTyConRhs
</span><a href="#local-6989586621683117140"><span class="hs-identifier hs-var hs-var">rhs2</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">TyCon -&gt; AlgTyConRhs
</span><a href="GHC.Core.TyCon.html#algTyConRhs"><span class="hs-identifier hs-var">algTyConRhs</span></a></span><span> </span><span class="annot"><span class="annottext">TyCon
</span><a href="#local-6989586621683117082"><span class="hs-identifier hs-var">tc2</span></a></span><span>
</span><span id="line-1298"></span><span>     </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="annottext">(BootDataMismatch -&gt; BootTyConMismatch)
-&gt; BootErrsM BootDataMismatch -&gt; BootErrsM BootTyConMismatch
forall err1 err2.
(err1 -&gt; err2) -&gt; BootErrsM err1 -&gt; BootErrsM err2
</span><a href="GHC.Tc.Module.html#embedErrs"><span class="hs-identifier hs-var">embedErrs</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">AlgTyConRhs -&gt; AlgTyConRhs -&gt; BootDataMismatch -&gt; BootTyConMismatch
</span><a href="GHC.Tc.Errors.Types.html#TyConMismatchedData"><span class="hs-identifier hs-var">TyConMismatchedData</span></a></span><span> </span><span class="annot"><span class="annottext">AlgTyConRhs
</span><a href="#local-6989586621683117138"><span class="hs-identifier hs-var">rhs1</span></a></span><span> </span><span class="annot"><span class="annottext">AlgTyConRhs
</span><a href="#local-6989586621683117140"><span class="hs-identifier hs-var">rhs2</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(BootErrsM BootDataMismatch -&gt; BootErrsM BootTyConMismatch)
-&gt; BootErrsM BootDataMismatch -&gt; BootErrsM BootTyConMismatch
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-1299"></span><span>  </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">Bool -&gt; BootDataMismatch -&gt; BootErrsM BootDataMismatch
forall err. Bool -&gt; err -&gt; BootErrsM err
</span><a href="GHC.Tc.Module.html#check"><span class="hs-identifier hs-var">check</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(Type -&gt; Type -&gt; Bool) -&gt; [Type] -&gt; [Type] -&gt; Bool
forall a b. (a -&gt; b -&gt; Bool) -&gt; [a] -&gt; [b] -&gt; Bool
forall (f :: * -&gt; *) a b.
Eq1 f =&gt;
(a -&gt; b -&gt; Bool) -&gt; f a -&gt; f b -&gt; Bool
</span><a href="../../base-4.21.0.0-ae91/src/Data.Functor.Classes.html#liftEq"><span class="hs-identifier hs-var">liftEq</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">HasCallStack =&gt; RnEnv2 -&gt; Type -&gt; Type -&gt; Bool
RnEnv2 -&gt; Type -&gt; Type -&gt; Bool
</span><a href="GHC.Core.TyCo.Compare.html#eqTypeX"><span class="hs-identifier hs-var">eqTypeX</span></a></span><span> </span><span class="annot"><span class="annottext">RnEnv2
</span><a href="#local-6989586621683117137"><span class="hs-identifier hs-var">env</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1300"></span><span>                     </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TyCon -&gt; [Type]
</span><a href="GHC.Core.TyCon.html#tyConStupidTheta"><span class="hs-identifier hs-var">tyConStupidTheta</span></a></span><span> </span><span class="annot"><span class="annottext">TyCon
</span><a href="#local-6989586621683117081"><span class="hs-identifier hs-var">tc1</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TyCon -&gt; [Type]
</span><a href="GHC.Core.TyCon.html#tyConStupidTheta"><span class="hs-identifier hs-var">tyConStupidTheta</span></a></span><span> </span><span class="annot"><span class="annottext">TyCon
</span><a href="#local-6989586621683117082"><span class="hs-identifier hs-var">tc2</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-1301"></span><span>                      </span><span class="annot"><span class="annottext">BootDataMismatch
</span><a href="GHC.Tc.Errors.Types.html#MismatchedDatatypeContexts"><span class="hs-identifier hs-var">MismatchedDatatypeContexts</span></a></span><span>
</span><span id="line-1302"></span><span>     </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="annottext">AlgTyConRhs -&gt; AlgTyConRhs -&gt; BootErrsM BootDataMismatch
</span><a href="GHC.Tc.Module.html#compatAlgRhs"><span class="hs-identifier hs-var">compatAlgRhs</span></a></span><span> </span><span class="annot"><span class="annottext">AlgTyConRhs
</span><a href="#local-6989586621683117138"><span class="hs-identifier hs-var">rhs1</span></a></span><span> </span><span class="annot"><span class="annottext">AlgTyConRhs
</span><a href="#local-6989586621683117140"><span class="hs-identifier hs-var">rhs2</span></a></span><span> </span><span class="hs-special">}</span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-1303"></span><span>
</span><span id="line-1304"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">otherwise</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">BootTyConMismatch -&gt; BootErrsM BootTyConMismatch
forall err. err -&gt; BootErrsM err
</span><a href="GHC.Tc.Module.html#bootErr"><span class="hs-identifier hs-var">bootErr</span></a></span><span> </span><span class="annot"><span class="annottext">BootTyConMismatch
</span><a href="GHC.Tc.Errors.Types.html#TyConsVeryDifferent"><span class="hs-identifier hs-var">TyConsVeryDifferent</span></a></span><span>
</span><span id="line-1305"></span><span>                </span><span class="hs-comment">-- two very different types;</span><span>
</span><span id="line-1306"></span><span>                </span><span class="hs-comment">-- should be obvious to the user what the problem is</span><span>
</span><span id="line-1307"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-1308"></span><span>    </span><span id="local-6989586621683117102"><span class="annot"><span class="annottext">check_roles :: BootErrsM BootTyConMismatch
</span><a href="#local-6989586621683117102"><span class="hs-identifier hs-var hs-var">check_roles</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">HsBootOrSig -&gt; TyCon -&gt; [Role] -&gt; BootErrsM BootTyConMismatch
</span><a href="GHC.Tc.Module.html#checkRoles"><span class="hs-identifier hs-var">checkRoles</span></a></span><span> </span><span class="annot"><span class="annottext">HsBootOrSig
</span><a href="#local-6989586621683117080"><span class="hs-identifier hs-var">boot_or_sig</span></a></span><span> </span><span class="annot"><span class="annottext">TyCon
</span><a href="#local-6989586621683117081"><span class="hs-identifier hs-var">tc1</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TyCon -&gt; [Role]
</span><a href="GHC.Core.TyCon.html#tyConRoles"><span class="hs-identifier hs-var">tyConRoles</span></a></span><span> </span><span class="annot"><span class="annottext">TyCon
</span><a href="#local-6989586621683117082"><span class="hs-identifier hs-var">tc2</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1309"></span><span>
</span><span id="line-1310"></span><span>
</span><span id="line-1311"></span><span class="annot"><a href="GHC.Tc.Module.html#emptyRnEnv2"><span class="hs-identifier hs-type">emptyRnEnv2</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Types.Var.Env.html#RnEnv2"><span class="hs-identifier hs-type">RnEnv2</span></a></span><span>
</span><span id="line-1312"></span><span id="emptyRnEnv2"><span class="annot"><span class="annottext">emptyRnEnv2 :: RnEnv2
</span><a href="GHC.Tc.Module.html#emptyRnEnv2"><span class="hs-identifier hs-var hs-var">emptyRnEnv2</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">InScopeSet -&gt; RnEnv2
</span><a href="GHC.Types.Var.Env.html#mkRnEnv2"><span class="hs-identifier hs-var">mkRnEnv2</span></a></span><span> </span><span class="annot"><span class="annottext">InScopeSet
</span><a href="GHC.Types.Var.Env.html#emptyInScopeSet"><span class="hs-identifier hs-var">emptyInScopeSet</span></a></span><span>
</span><span id="line-1313"></span><span>
</span><span id="line-1314"></span><span class="annot"><span class="hs-comment">-- | Check that two class methods have compatible type signatures.</span></span><span>
</span><span id="line-1315"></span><span class="annot"><a href="GHC.Tc.Module.html#compatClassOp"><span class="hs-identifier hs-type">compatClassOp</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Types.Var.Env.html#RnEnv2"><span class="hs-identifier hs-type">RnEnv2</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Types.SourceFile.html#HsBootOrSig"><span class="hs-identifier hs-type">HsBootOrSig</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Core.Class.html#ClassOpItem"><span class="hs-identifier hs-type">ClassOpItem</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Core.Class.html#ClassOpItem"><span class="hs-identifier hs-type">ClassOpItem</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Module.html#BootErrsM"><span class="hs-identifier hs-type">BootErrsM</span></a></span><span> </span><span class="annot"><a href="GHC.Tc.Errors.Types.html#BootMethodMismatch"><span class="hs-identifier hs-type">BootMethodMismatch</span></a></span><span>
</span><span id="line-1316"></span><span id="compatClassOp"><span class="annot"><span class="annottext">compatClassOp :: RnEnv2
-&gt; HsBootOrSig
-&gt; ClassOpItem
-&gt; ClassOpItem
-&gt; BootErrsM BootMethodMismatch
</span><a href="GHC.Tc.Module.html#compatClassOp"><span class="hs-identifier hs-var hs-var">compatClassOp</span></a></span></span><span> </span><span id="local-6989586621683117150"><span class="annot"><span class="annottext">RnEnv2
</span><a href="#local-6989586621683117150"><span class="hs-identifier hs-var">env</span></a></span></span><span> </span><span id="local-6989586621683117151"><span class="annot"><span class="annottext">HsBootOrSig
</span><a href="#local-6989586621683117151"><span class="hs-identifier hs-var">boot_or_sig</span></a></span></span><span> </span><span class="hs-special">(</span><span id="local-6989586621683117152"><span class="annot"><span class="annottext">Id
</span><a href="#local-6989586621683117152"><span class="hs-identifier hs-var">id1</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621683117153"><span class="annot"><span class="annottext">DefMethInfo
</span><a href="#local-6989586621683117153"><span class="hs-identifier hs-var">def_meth1</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span id="local-6989586621683117154"><span class="annot"><span class="annottext">Id
</span><a href="#local-6989586621683117154"><span class="hs-identifier hs-var">id2</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621683117155"><span class="annot"><span class="annottext">DefMethInfo
</span><a href="#local-6989586621683117155"><span class="hs-identifier hs-var">def_meth2</span></a></span></span><span class="hs-special">)</span><span>
</span><span id="line-1317"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">Bool -&gt; BootMethodMismatch -&gt; BootErrsM BootMethodMismatch
forall err. Bool -&gt; err -&gt; BootErrsM err
</span><a href="GHC.Tc.Module.html#check"><span class="hs-identifier hs-var">check</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621683117156"><span class="hs-identifier hs-var">name1</span></a></span><span> </span><span class="annot"><span class="annottext">Name -&gt; Name -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">==</span></span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621683117157"><span class="hs-identifier hs-var">name2</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(BootMethodMismatch -&gt; BootErrsM BootMethodMismatch)
-&gt; BootMethodMismatch -&gt; BootErrsM BootMethodMismatch
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-1318"></span><span>           </span><span class="annot"><span class="annottext">BootMethodMismatch
</span><a href="GHC.Tc.Errors.Types.html#MismatchedMethodNames"><span class="hs-identifier hs-var">MismatchedMethodNames</span></a></span><span>
</span><span id="line-1319"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="annottext">Bool -&gt; BootMethodMismatch -&gt; BootErrsM BootMethodMismatch
forall err. Bool -&gt; err -&gt; BootErrsM err
</span><a href="GHC.Tc.Module.html#check"><span class="hs-identifier hs-var">check</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">HasCallStack =&gt; RnEnv2 -&gt; Type -&gt; Type -&gt; Bool
RnEnv2 -&gt; Type -&gt; Type -&gt; Bool
</span><a href="GHC.Core.TyCo.Compare.html#eqTypeX"><span class="hs-identifier hs-var">eqTypeX</span></a></span><span> </span><span class="annot"><span class="annottext">RnEnv2
</span><a href="#local-6989586621683117150"><span class="hs-identifier hs-var">env</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621683117159"><span class="hs-identifier hs-var">op_ty1</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621683117160"><span class="hs-identifier hs-var">op_ty2</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(BootMethodMismatch -&gt; BootErrsM BootMethodMismatch)
-&gt; BootMethodMismatch -&gt; BootErrsM BootMethodMismatch
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-1320"></span><span>           </span><span class="annot"><span class="annottext">Type -&gt; Type -&gt; BootMethodMismatch
</span><a href="GHC.Tc.Errors.Types.html#MismatchedMethodTypes"><span class="hs-identifier hs-var">MismatchedMethodTypes</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621683117159"><span class="hs-identifier hs-var">op_ty1</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621683117160"><span class="hs-identifier hs-var">op_ty2</span></a></span><span>
</span><span id="line-1321"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">HsBootOrSig
</span><a href="#local-6989586621683117151"><span class="hs-identifier hs-var">boot_or_sig</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-1322"></span><span>           </span><span class="annot"><span class="annottext">HsBootOrSig
</span><a href="GHC.Types.SourceFile.html#HsBoot"><span class="hs-identifier hs-var">HsBoot</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-1323"></span><span>             </span><span class="annot"><span class="annottext">Bool -&gt; BootMethodMismatch -&gt; BootErrsM BootMethodMismatch
forall err. Bool -&gt; err -&gt; BootErrsM err
</span><a href="GHC.Tc.Module.html#check"><span class="hs-identifier hs-var">check</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">((Name, DefMethSpec Type) -&gt; (Name, DefMethSpec Type) -&gt; Bool)
-&gt; DefMethInfo -&gt; DefMethInfo -&gt; Bool
forall a b. (a -&gt; b -&gt; Bool) -&gt; Maybe a -&gt; Maybe b -&gt; Bool
forall (f :: * -&gt; *) a b.
Eq1 f =&gt;
(a -&gt; b -&gt; Bool) -&gt; f a -&gt; f b -&gt; Bool
</span><a href="../../base-4.21.0.0-ae91/src/Data.Functor.Classes.html#liftEq"><span class="hs-identifier hs-var">liftEq</span></a></span><span> </span><span class="annot"><span class="annottext">(Name, DefMethSpec Type) -&gt; (Name, DefMethSpec Type) -&gt; Bool
</span><a href="#local-6989586621683117162"><span class="hs-identifier hs-var">eqDM</span></a></span><span> </span><span class="annot"><span class="annottext">DefMethInfo
</span><a href="#local-6989586621683117153"><span class="hs-identifier hs-var">def_meth1</span></a></span><span> </span><span class="annot"><span class="annottext">DefMethInfo
</span><a href="#local-6989586621683117155"><span class="hs-identifier hs-var">def_meth2</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(BootMethodMismatch -&gt; BootErrsM BootMethodMismatch)
-&gt; BootMethodMismatch -&gt; BootErrsM BootMethodMismatch
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-1324"></span><span>               </span><span class="annot"><span class="annottext">Bool -&gt; BootMethodMismatch
</span><a href="GHC.Tc.Errors.Types.html#MismatchedDefaultMethods"><span class="hs-identifier hs-var">MismatchedDefaultMethods</span></a></span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">False</span></span><span>
</span><span id="line-1325"></span><span>           </span><span class="annot"><span class="annottext">HsBootOrSig
</span><a href="GHC.Types.SourceFile.html#Hsig"><span class="hs-identifier hs-var">Hsig</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-1326"></span><span>             </span><span class="annot"><span class="annottext">Bool -&gt; BootMethodMismatch -&gt; BootErrsM BootMethodMismatch
forall err. Bool -&gt; err -&gt; BootErrsM err
</span><a href="GHC.Tc.Module.html#check"><span class="hs-identifier hs-var">check</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Type -&gt; DefMethInfo -&gt; DefMethInfo -&gt; Bool
</span><a href="#local-6989586621683117164"><span class="hs-identifier hs-var">subDM</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621683117159"><span class="hs-identifier hs-var">op_ty1</span></a></span><span> </span><span class="annot"><span class="annottext">DefMethInfo
</span><a href="#local-6989586621683117153"><span class="hs-identifier hs-var">def_meth1</span></a></span><span> </span><span class="annot"><span class="annottext">DefMethInfo
</span><a href="#local-6989586621683117155"><span class="hs-identifier hs-var">def_meth2</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(BootMethodMismatch -&gt; BootErrsM BootMethodMismatch)
-&gt; BootMethodMismatch -&gt; BootErrsM BootMethodMismatch
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-1327"></span><span>               </span><span class="annot"><span class="annottext">Bool -&gt; BootMethodMismatch
</span><a href="GHC.Tc.Errors.Types.html#MismatchedDefaultMethods"><span class="hs-identifier hs-var">MismatchedDefaultMethods</span></a></span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">True</span></span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-1328"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-1329"></span><span>    </span><span id="local-6989586621683117156"><span class="annot"><span class="annottext">name1 :: Name
</span><a href="#local-6989586621683117156"><span class="hs-identifier hs-var hs-var">name1</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Id -&gt; Name
</span><a href="GHC.Types.Id.html#idName"><span class="hs-identifier hs-var">idName</span></a></span><span> </span><span class="annot"><span class="annottext">Id
</span><a href="#local-6989586621683117152"><span class="hs-identifier hs-var">id1</span></a></span><span>
</span><span id="line-1330"></span><span>    </span><span id="local-6989586621683117157"><span class="annot"><span class="annottext">name2 :: Name
</span><a href="#local-6989586621683117157"><span class="hs-identifier hs-var hs-var">name2</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Id -&gt; Name
</span><a href="GHC.Types.Id.html#idName"><span class="hs-identifier hs-var">idName</span></a></span><span> </span><span class="annot"><span class="annottext">Id
</span><a href="#local-6989586621683117154"><span class="hs-identifier hs-var">id2</span></a></span><span>
</span><span id="line-1331"></span><span>    </span><span id="local-6989586621683117159"><span class="annot"><span class="annottext">op_ty1 :: Type
</span><a href="#local-6989586621683117159"><span class="hs-identifier hs-var hs-var">op_ty1</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Id -&gt; Type
</span><a href="GHC.Core.Predicate.html#classMethodTy"><span class="hs-identifier hs-var">classMethodTy</span></a></span><span> </span><span class="annot"><span class="annottext">Id
</span><a href="#local-6989586621683117152"><span class="hs-identifier hs-var">id1</span></a></span><span>
</span><span id="line-1332"></span><span>    </span><span id="local-6989586621683117160"><span class="annot"><span class="annottext">op_ty2 :: Type
</span><a href="#local-6989586621683117160"><span class="hs-identifier hs-var hs-var">op_ty2</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Id -&gt; Type
</span><a href="GHC.Core.Predicate.html#classMethodTy"><span class="hs-identifier hs-var">classMethodTy</span></a></span><span> </span><span class="annot"><span class="annottext">Id
</span><a href="#local-6989586621683117154"><span class="hs-identifier hs-var">id2</span></a></span><span>
</span><span id="line-1333"></span><span>
</span><span id="line-1334"></span><span>    </span><span id="local-6989586621683117162"><span class="annot"><span class="annottext">eqDM :: (Name, DefMethSpec Type) -&gt; (Name, DefMethSpec Type) -&gt; Bool
</span><a href="#local-6989586621683117162"><span class="hs-identifier hs-var hs-var">eqDM</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Name
</span><span class="hs-identifier">_</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">DefMethSpec Type
</span><a href="GHC.Types.Basic.html#VanillaDM"><span class="hs-identifier hs-var">VanillaDM</span></a></span><span class="hs-special">)</span><span>    </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Name
</span><span class="hs-identifier">_</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">DefMethSpec Type
</span><a href="GHC.Types.Basic.html#VanillaDM"><span class="hs-identifier hs-var">VanillaDM</span></a></span><span class="hs-special">)</span><span>    </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">True</span></span><span>
</span><span id="line-1335"></span><span>    </span><span class="annot"><a href="#local-6989586621683117162"><span class="hs-identifier hs-var">eqDM</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Name
</span><span class="hs-identifier">_</span></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Types.Basic.html#GenericDM"><span class="hs-identifier hs-type">GenericDM</span></a></span><span> </span><span id="local-6989586621683117167"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621683117167"><span class="hs-identifier hs-var">t1</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Name
</span><span class="hs-identifier">_</span></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Types.Basic.html#GenericDM"><span class="hs-identifier hs-type">GenericDM</span></a></span><span> </span><span id="local-6989586621683117168"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621683117168"><span class="hs-identifier hs-var">t2</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">HasCallStack =&gt; RnEnv2 -&gt; Type -&gt; Type -&gt; Bool
RnEnv2 -&gt; Type -&gt; Type -&gt; Bool
</span><a href="GHC.Core.TyCo.Compare.html#eqTypeX"><span class="hs-identifier hs-var">eqTypeX</span></a></span><span> </span><span class="annot"><span class="annottext">RnEnv2
</span><a href="#local-6989586621683117150"><span class="hs-identifier hs-var">env</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621683117167"><span class="hs-identifier hs-var">t1</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621683117168"><span class="hs-identifier hs-var">t2</span></a></span><span>
</span><span id="line-1336"></span><span>    </span><span class="annot"><a href="#local-6989586621683117162"><span class="hs-identifier hs-var">eqDM</span></a></span><span> </span><span class="annot"><span class="annottext">(Name, DefMethSpec Type)
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">(Name, DefMethSpec Type)
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">False</span></span><span>
</span><span id="line-1337"></span><span>
</span><span id="line-1338"></span><span>    </span><span class="hs-comment">-- NB: first argument is from hsig, second is from real impl.</span><span>
</span><span id="line-1339"></span><span>    </span><span class="hs-comment">-- Order of pattern matching matters.</span><span>
</span><span id="line-1340"></span><span>    </span><span id="local-6989586621683117164"><span class="annot"><span class="annottext">subDM :: Type -&gt; DefMethInfo -&gt; DefMethInfo -&gt; Bool
</span><a href="#local-6989586621683117164"><span class="hs-identifier hs-var hs-var">subDM</span></a></span></span><span> </span><span class="annot"><span class="annottext">Type
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">DefMethInfo
</span><span class="hs-identifier hs-var">Nothing</span></span><span> </span><span class="annot"><span class="annottext">DefMethInfo
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">True</span></span><span>
</span><span id="line-1341"></span><span>    </span><span class="annot"><a href="#local-6989586621683117164"><span class="hs-identifier hs-var">subDM</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">DefMethInfo
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">DefMethInfo
</span><span class="hs-identifier hs-var">Nothing</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">False</span></span><span>
</span><span id="line-1342"></span><span>
</span><span id="line-1343"></span><span>    </span><span class="hs-comment">-- If the hsig wrote:</span><span>
</span><span id="line-1344"></span><span>    </span><span class="hs-comment">--</span><span>
</span><span id="line-1345"></span><span>    </span><span class="hs-comment">--   f :: a -&gt; a</span><span>
</span><span id="line-1346"></span><span>    </span><span class="hs-comment">--   default f :: a -&gt; a</span><span>
</span><span id="line-1347"></span><span>    </span><span class="hs-comment">--</span><span>
</span><span id="line-1348"></span><span>    </span><span class="hs-comment">-- this should be validly implementable using an old-fashioned</span><span>
</span><span id="line-1349"></span><span>    </span><span class="hs-comment">-- vanilla default method.</span><span>
</span><span id="line-1350"></span><span>    </span><span class="annot"><a href="#local-6989586621683117164"><span class="hs-identifier hs-var">subDM</span></a></span><span> </span><span id="local-6989586621683117169"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621683117169"><span class="hs-identifier hs-var">t1</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Name
</span><span class="hs-identifier">_</span></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Types.Basic.html#GenericDM"><span class="hs-identifier hs-type">GenericDM</span></a></span><span> </span><span id="local-6989586621683117170"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621683117170"><span class="hs-identifier hs-var">gdm_t1</span></a></span></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Name
</span><span class="hs-identifier">_</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">DefMethSpec Type
</span><a href="GHC.Types.Basic.html#VanillaDM"><span class="hs-identifier hs-var">VanillaDM</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-1351"></span><span>     </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">HasCallStack =&gt; Type -&gt; Type -&gt; Bool
Type -&gt; Type -&gt; Bool
</span><a href="GHC.Core.TyCo.Compare.html#eqType"><span class="hs-identifier hs-var">eqType</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621683117169"><span class="hs-identifier hs-var">t1</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621683117170"><span class="hs-identifier hs-var">gdm_t1</span></a></span><span>   </span><span class="hs-comment">-- Take care (#22476).  Both t1 and gdm_t1 come</span><span>
</span><span id="line-1352"></span><span>                             </span><span class="hs-comment">-- from tc1, so use eqType, and /not/ eqTypeX</span><span>
</span><span id="line-1353"></span><span>
</span><span id="line-1354"></span><span>    </span><span class="hs-comment">-- This case can occur when merging signatures</span><span>
</span><span id="line-1355"></span><span>    </span><span class="annot"><a href="#local-6989586621683117164"><span class="hs-identifier hs-var">subDM</span></a></span><span> </span><span id="local-6989586621683117171"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621683117171"><span class="hs-identifier hs-var">t1</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Name
</span><span class="hs-identifier">_</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">DefMethSpec Type
</span><a href="GHC.Types.Basic.html#VanillaDM"><span class="hs-identifier hs-var">VanillaDM</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Name
</span><span class="hs-identifier">_</span></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Types.Basic.html#GenericDM"><span class="hs-identifier hs-type">GenericDM</span></a></span><span> </span><span id="local-6989586621683117172"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621683117172"><span class="hs-identifier hs-var">t2</span></a></span></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-1356"></span><span>     </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">HasCallStack =&gt; RnEnv2 -&gt; Type -&gt; Type -&gt; Bool
RnEnv2 -&gt; Type -&gt; Type -&gt; Bool
</span><a href="GHC.Core.TyCo.Compare.html#eqTypeX"><span class="hs-identifier hs-var">eqTypeX</span></a></span><span> </span><span class="annot"><span class="annottext">RnEnv2
</span><a href="#local-6989586621683117150"><span class="hs-identifier hs-var">env</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621683117171"><span class="hs-identifier hs-var">t1</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621683117172"><span class="hs-identifier hs-var">t2</span></a></span><span>
</span><span id="line-1357"></span><span>
</span><span id="line-1358"></span><span>    </span><span class="annot"><a href="#local-6989586621683117164"><span class="hs-identifier hs-var">subDM</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Name
</span><span class="hs-identifier">_</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">DefMethSpec Type
</span><a href="GHC.Types.Basic.html#VanillaDM"><span class="hs-identifier hs-var">VanillaDM</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Name
</span><span class="hs-identifier">_</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">DefMethSpec Type
</span><a href="GHC.Types.Basic.html#VanillaDM"><span class="hs-identifier hs-var">VanillaDM</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">True</span></span><span>
</span><span id="line-1359"></span><span>    </span><span class="annot"><a href="#local-6989586621683117164"><span class="hs-identifier hs-var">subDM</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Name
</span><span class="hs-identifier">_</span></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Types.Basic.html#GenericDM"><span class="hs-identifier hs-type">GenericDM</span></a></span><span> </span><span id="local-6989586621683117173"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621683117173"><span class="hs-identifier hs-var">t1</span></a></span></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Name
</span><span class="hs-identifier">_</span></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Types.Basic.html#GenericDM"><span class="hs-identifier hs-type">GenericDM</span></a></span><span> </span><span id="local-6989586621683117174"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621683117174"><span class="hs-identifier hs-var">t2</span></a></span></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-1360"></span><span>     </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">HasCallStack =&gt; RnEnv2 -&gt; Type -&gt; Type -&gt; Bool
RnEnv2 -&gt; Type -&gt; Type -&gt; Bool
</span><a href="GHC.Core.TyCo.Compare.html#eqTypeX"><span class="hs-identifier hs-var">eqTypeX</span></a></span><span> </span><span class="annot"><span class="annottext">RnEnv2
</span><a href="#local-6989586621683117150"><span class="hs-identifier hs-var">env</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621683117173"><span class="hs-identifier hs-var">t1</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621683117174"><span class="hs-identifier hs-var">t2</span></a></span><span>
</span><span id="line-1361"></span><span>
</span><span id="line-1362"></span><span class="annot"><span class="hs-comment">-- | Check that two associated types are compatible.</span></span><span>
</span><span id="line-1363"></span><span class="annot"><a href="GHC.Tc.Module.html#compatAT"><span class="hs-identifier hs-type">compatAT</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Types.Var.Env.html#RnEnv2"><span class="hs-identifier hs-type">RnEnv2</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Types.SourceFile.html#HsBootOrSig"><span class="hs-identifier hs-type">HsBootOrSig</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Core.Class.html#ClassATItem"><span class="hs-identifier hs-type">ClassATItem</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Core.Class.html#ClassATItem"><span class="hs-identifier hs-type">ClassATItem</span></a></span><span>
</span><span id="line-1364"></span><span>         </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Module.html#BootErrsM"><span class="hs-identifier hs-type">BootErrsM</span></a></span><span> </span><span class="annot"><a href="GHC.Tc.Errors.Types.html#BootATMismatch"><span class="hs-identifier hs-type">BootATMismatch</span></a></span><span>
</span><span id="line-1365"></span><span id="compatAT"><span class="annot"><span class="annottext">compatAT :: RnEnv2
-&gt; HsBootOrSig
-&gt; ClassATItem
-&gt; ClassATItem
-&gt; BootErrsM BootATMismatch
</span><a href="GHC.Tc.Module.html#compatAT"><span class="hs-identifier hs-var hs-var">compatAT</span></a></span></span><span> </span><span id="local-6989586621683117175"><span class="annot"><span class="annottext">RnEnv2
</span><a href="#local-6989586621683117175"><span class="hs-identifier hs-var">env</span></a></span></span><span> </span><span id="local-6989586621683117176"><span class="annot"><span class="annottext">HsBootOrSig
</span><a href="#local-6989586621683117176"><span class="hs-identifier hs-var">boot_or_sig</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Core.Class.html#ATI"><span class="hs-identifier hs-type">ATI</span></a></span><span> </span><span id="local-6989586621683117178"><span class="annot"><span class="annottext">TyCon
</span><a href="#local-6989586621683117178"><span class="hs-identifier hs-var">tc1</span></a></span></span><span> </span><span id="local-6989586621683117179"><span class="annot"><span class="annottext">Maybe (Type, TyFamEqnValidityInfo)
</span><a href="#local-6989586621683117179"><span class="hs-identifier hs-var">def_ats1</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Core.Class.html#ATI"><span class="hs-identifier hs-type">ATI</span></a></span><span> </span><span id="local-6989586621683117180"><span class="annot"><span class="annottext">TyCon
</span><a href="#local-6989586621683117180"><span class="hs-identifier hs-var">tc2</span></a></span></span><span> </span><span id="local-6989586621683117181"><span class="annot"><span class="annottext">Maybe (Type, TyFamEqnValidityInfo)
</span><a href="#local-6989586621683117181"><span class="hs-identifier hs-var">def_ats2</span></a></span></span><span class="hs-special">)</span><span>
</span><span id="line-1366"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">(BootTyConMismatch -&gt; BootATMismatch)
-&gt; BootErrsM BootTyConMismatch -&gt; BootErrsM BootATMismatch
forall err1 err2.
(err1 -&gt; err2) -&gt; BootErrsM err1 -&gt; BootErrsM err2
</span><a href="GHC.Tc.Module.html#embedErrs"><span class="hs-identifier hs-var">embedErrs</span></a></span><span> </span><span class="annot"><span class="annottext">BootTyConMismatch -&gt; BootATMismatch
</span><a href="GHC.Tc.Errors.Types.html#MismatchedTyConAT"><span class="hs-identifier hs-var">MismatchedTyConAT</span></a></span><span> </span><span class="annot"><span class="annottext">(BootErrsM BootTyConMismatch -&gt; BootErrsM BootATMismatch)
-&gt; BootErrsM BootTyConMismatch -&gt; BootErrsM BootATMismatch
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-1367"></span><span>           </span><span class="annot"><span class="annottext">HsBootOrSig -&gt; TyCon -&gt; TyCon -&gt; BootErrsM BootTyConMismatch
</span><a href="GHC.Tc.Module.html#checkBootTyCon"><span class="hs-identifier hs-var">checkBootTyCon</span></a></span><span> </span><span class="annot"><span class="annottext">HsBootOrSig
</span><a href="#local-6989586621683117176"><span class="hs-identifier hs-var">boot_or_sig</span></a></span><span> </span><span class="annot"><span class="annottext">TyCon
</span><a href="#local-6989586621683117178"><span class="hs-identifier hs-var">tc1</span></a></span><span> </span><span class="annot"><span class="annottext">TyCon
</span><a href="#local-6989586621683117180"><span class="hs-identifier hs-var">tc2</span></a></span><span>
</span><span id="line-1368"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="annottext">Bool -&gt; BootATMismatch -&gt; BootErrsM BootATMismatch
forall err. Bool -&gt; err -&gt; BootErrsM err
</span><a href="GHC.Tc.Module.html#check"><span class="hs-identifier hs-var">check</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Maybe (Type, TyFamEqnValidityInfo)
-&gt; Maybe (Type, TyFamEqnValidityInfo) -&gt; Bool
</span><a href="#local-6989586621683117183"><span class="hs-identifier hs-var">compatATDef</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe (Type, TyFamEqnValidityInfo)
</span><a href="#local-6989586621683117179"><span class="hs-identifier hs-var">def_ats1</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe (Type, TyFamEqnValidityInfo)
</span><a href="#local-6989586621683117181"><span class="hs-identifier hs-var">def_ats2</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1369"></span><span>           </span><span class="annot"><span class="annottext">BootATMismatch
</span><a href="GHC.Tc.Errors.Types.html#MismatchedATDefaultType"><span class="hs-identifier hs-var">MismatchedATDefaultType</span></a></span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-1370"></span><span>
</span><span id="line-1371"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-1372"></span><span>    </span><span class="hs-comment">-- Ignore the location of the defaults</span><span>
</span><span id="line-1373"></span><span>    </span><span id="local-6989586621683117183"><span class="annot"><span class="annottext">compatATDef :: Maybe (Type, TyFamEqnValidityInfo)
-&gt; Maybe (Type, TyFamEqnValidityInfo) -&gt; Bool
</span><a href="#local-6989586621683117183"><span class="hs-identifier hs-var hs-var">compatATDef</span></a></span></span><span> </span><span class="annot"><span class="annottext">Maybe (Type, TyFamEqnValidityInfo)
</span><span class="hs-identifier hs-var">Nothing</span></span><span>             </span><span class="annot"><span class="annottext">Maybe (Type, TyFamEqnValidityInfo)
</span><span class="hs-identifier hs-var">Nothing</span></span><span>             </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">True</span></span><span>
</span><span id="line-1374"></span><span>    </span><span class="annot"><a href="#local-6989586621683117183"><span class="hs-identifier hs-var">compatATDef</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span class="hs-special">(</span><span id="local-6989586621683117185"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621683117185"><span class="hs-identifier hs-var">ty1</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621683117186"><span class="annot"><span class="annottext">TyFamEqnValidityInfo
</span><a href="#local-6989586621683117186"><span class="hs-identifier hs-var">_loc1</span></a></span></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span class="hs-special">(</span><span id="local-6989586621683117187"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621683117187"><span class="hs-identifier hs-var">ty2</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621683117188"><span class="annot"><span class="annottext">TyFamEqnValidityInfo
</span><a href="#local-6989586621683117188"><span class="hs-identifier hs-var">_loc2</span></a></span></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">HasCallStack =&gt; RnEnv2 -&gt; Type -&gt; Type -&gt; Bool
RnEnv2 -&gt; Type -&gt; Type -&gt; Bool
</span><a href="GHC.Core.TyCo.Compare.html#eqTypeX"><span class="hs-identifier hs-var">eqTypeX</span></a></span><span> </span><span class="annot"><span class="annottext">RnEnv2
</span><a href="#local-6989586621683117175"><span class="hs-identifier hs-var">env</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621683117185"><span class="hs-identifier hs-var">ty1</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621683117187"><span class="hs-identifier hs-var">ty2</span></a></span><span>
</span><span id="line-1375"></span><span>    </span><span class="annot"><a href="#local-6989586621683117183"><span class="hs-identifier hs-var">compatATDef</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe (Type, TyFamEqnValidityInfo)
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">Maybe (Type, TyFamEqnValidityInfo)
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">False</span></span><span>
</span><span id="line-1376"></span><span>
</span><span id="line-1377"></span><span class="annot"><span class="hs-comment">-- | Check that two functional dependencies are the same.</span></span><span>
</span><span id="line-1378"></span><span class="annot"><a href="GHC.Tc.Module.html#eqFD"><span class="hs-identifier hs-type">eqFD</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Types.Var.Env.html#RnEnv2"><span class="hs-identifier hs-type">RnEnv2</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Core.Class.html#FunDep"><span class="hs-identifier hs-type">FunDep</span></a></span><span> </span><span class="annot"><a href="GHC.Types.Var.html#TyVar"><span class="hs-identifier hs-type">TyVar</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Core.Class.html#FunDep"><span class="hs-identifier hs-type">FunDep</span></a></span><span> </span><span class="annot"><a href="GHC.Types.Var.html#TyVar"><span class="hs-identifier hs-type">TyVar</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Bool</span></span><span>
</span><span id="line-1379"></span><span id="eqFD"><span class="annot"><span class="annottext">eqFD :: RnEnv2 -&gt; FunDep Id -&gt; FunDep Id -&gt; Bool
</span><a href="GHC.Tc.Module.html#eqFD"><span class="hs-identifier hs-var hs-var">eqFD</span></a></span></span><span> </span><span id="local-6989586621683117190"><span class="annot"><span class="annottext">RnEnv2
</span><a href="#local-6989586621683117190"><span class="hs-identifier hs-var">env</span></a></span></span><span> </span><span class="hs-special">(</span><span id="local-6989586621683117191"><span class="annot"><span class="annottext">[Id]
</span><a href="#local-6989586621683117191"><span class="hs-identifier hs-var">as1</span></a></span></span><span class="hs-special">,</span><span id="local-6989586621683117192"><span class="annot"><span class="annottext">[Id]
</span><a href="#local-6989586621683117192"><span class="hs-identifier hs-var">bs1</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span id="local-6989586621683117193"><span class="annot"><span class="annottext">[Id]
</span><a href="#local-6989586621683117193"><span class="hs-identifier hs-var">as2</span></a></span></span><span class="hs-special">,</span><span id="local-6989586621683117194"><span class="annot"><span class="annottext">[Id]
</span><a href="#local-6989586621683117194"><span class="hs-identifier hs-var">bs2</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-1380"></span><span>  </span><span class="annot"><span class="annottext">(Type -&gt; Type -&gt; Bool) -&gt; [Type] -&gt; [Type] -&gt; Bool
forall a b. (a -&gt; b -&gt; Bool) -&gt; [a] -&gt; [b] -&gt; Bool
forall (f :: * -&gt; *) a b.
Eq1 f =&gt;
(a -&gt; b -&gt; Bool) -&gt; f a -&gt; f b -&gt; Bool
</span><a href="../../base-4.21.0.0-ae91/src/Data.Functor.Classes.html#liftEq"><span class="hs-identifier hs-var">liftEq</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">HasCallStack =&gt; RnEnv2 -&gt; Type -&gt; Type -&gt; Bool
RnEnv2 -&gt; Type -&gt; Type -&gt; Bool
</span><a href="GHC.Core.TyCo.Compare.html#eqTypeX"><span class="hs-identifier hs-var">eqTypeX</span></a></span><span> </span><span class="annot"><span class="annottext">RnEnv2
</span><a href="#local-6989586621683117190"><span class="hs-identifier hs-var">env</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[Id] -&gt; [Type]
</span><a href="GHC.Core.TyCo.Rep.html#mkTyVarTys"><span class="hs-identifier hs-var">mkTyVarTys</span></a></span><span> </span><span class="annot"><span class="annottext">[Id]
</span><a href="#local-6989586621683117191"><span class="hs-identifier hs-var">as1</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[Id] -&gt; [Type]
</span><a href="GHC.Core.TyCo.Rep.html#mkTyVarTys"><span class="hs-identifier hs-var">mkTyVarTys</span></a></span><span> </span><span class="annot"><span class="annottext">[Id]
</span><a href="#local-6989586621683117193"><span class="hs-identifier hs-var">as2</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Bool -&gt; Bool
</span><span class="hs-operator hs-var">&amp;&amp;</span></span><span>
</span><span id="line-1381"></span><span>  </span><span class="annot"><span class="annottext">(Type -&gt; Type -&gt; Bool) -&gt; [Type] -&gt; [Type] -&gt; Bool
forall a b. (a -&gt; b -&gt; Bool) -&gt; [a] -&gt; [b] -&gt; Bool
forall (f :: * -&gt; *) a b.
Eq1 f =&gt;
(a -&gt; b -&gt; Bool) -&gt; f a -&gt; f b -&gt; Bool
</span><a href="../../base-4.21.0.0-ae91/src/Data.Functor.Classes.html#liftEq"><span class="hs-identifier hs-var">liftEq</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">HasCallStack =&gt; RnEnv2 -&gt; Type -&gt; Type -&gt; Bool
RnEnv2 -&gt; Type -&gt; Type -&gt; Bool
</span><a href="GHC.Core.TyCo.Compare.html#eqTypeX"><span class="hs-identifier hs-var">eqTypeX</span></a></span><span> </span><span class="annot"><span class="annottext">RnEnv2
</span><a href="#local-6989586621683117190"><span class="hs-identifier hs-var">env</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[Id] -&gt; [Type]
</span><a href="GHC.Core.TyCo.Rep.html#mkTyVarTys"><span class="hs-identifier hs-var">mkTyVarTys</span></a></span><span> </span><span class="annot"><span class="annottext">[Id]
</span><a href="#local-6989586621683117192"><span class="hs-identifier hs-var">bs1</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[Id] -&gt; [Type]
</span><a href="GHC.Core.TyCo.Rep.html#mkTyVarTys"><span class="hs-identifier hs-var">mkTyVarTys</span></a></span><span> </span><span class="annot"><span class="annottext">[Id]
</span><a href="#local-6989586621683117194"><span class="hs-identifier hs-var">bs2</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1382"></span><span>
</span><span id="line-1383"></span><span class="annot"><span class="hs-comment">-- | Check compatibility of two type family flavours.</span></span><span>
</span><span id="line-1384"></span><span class="annot"><a href="GHC.Tc.Module.html#compatFamFlav"><span class="hs-identifier hs-type">compatFamFlav</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Core.TyCon.html#FamTyConFlav"><span class="hs-identifier hs-type">FamTyConFlav</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Core.TyCon.html#FamTyConFlav"><span class="hs-identifier hs-type">FamTyConFlav</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Module.html#BootErrsM"><span class="hs-identifier hs-type">BootErrsM</span></a></span><span> </span><span class="annot"><a href="GHC.Tc.Errors.Types.html#BootTyConMismatch"><span class="hs-identifier hs-type">BootTyConMismatch</span></a></span><span>
</span><span id="line-1385"></span><span id="compatFamFlav"><span class="annot"><span class="annottext">compatFamFlav :: FamTyConFlav -&gt; FamTyConFlav -&gt; BootErrsM BootTyConMismatch
</span><a href="GHC.Tc.Module.html#compatFamFlav"><span class="hs-identifier hs-var hs-var">compatFamFlav</span></a></span></span><span> </span><span class="annot"><span class="annottext">FamTyConFlav
</span><a href="GHC.Core.TyCon.html#OpenSynFamilyTyCon"><span class="hs-identifier hs-var">OpenSynFamilyTyCon</span></a></span><span>   </span><span class="annot"><span class="annottext">FamTyConFlav
</span><a href="GHC.Core.TyCon.html#OpenSynFamilyTyCon"><span class="hs-identifier hs-var">OpenSynFamilyTyCon</span></a></span><span>
</span><span id="line-1386"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">BootErrsM BootTyConMismatch
forall err. BootErrsM err
</span><a href="GHC.Tc.Module.html#checkSuccess"><span class="hs-identifier hs-var">checkSuccess</span></a></span><span>
</span><span id="line-1387"></span><span class="annot"><a href="GHC.Tc.Module.html#compatFamFlav"><span class="hs-identifier hs-var">compatFamFlav</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Core.TyCon.html#DataFamilyTyCon"><span class="hs-identifier hs-type">DataFamilyTyCon</span></a></span><span> </span><span class="hs-special">{</span><span class="hs-special">}</span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Core.TyCon.html#DataFamilyTyCon"><span class="hs-identifier hs-type">DataFamilyTyCon</span></a></span><span> </span><span class="hs-special">{</span><span class="hs-special">}</span><span class="hs-special">)</span><span>
</span><span id="line-1388"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">BootErrsM BootTyConMismatch
forall err. BootErrsM err
</span><a href="GHC.Tc.Module.html#checkSuccess"><span class="hs-identifier hs-var">checkSuccess</span></a></span><span>
</span><span id="line-1389"></span><span class="annot"><a href="GHC.Tc.Module.html#compatFamFlav"><span class="hs-identifier hs-var">compatFamFlav</span></a></span><span> </span><span class="annot"><span class="annottext">FamTyConFlav
</span><a href="GHC.Core.TyCon.html#AbstractClosedSynFamilyTyCon"><span class="hs-identifier hs-var">AbstractClosedSynFamilyTyCon</span></a></span><span> </span><span class="annot"><span class="annottext">FamTyConFlav
</span><a href="GHC.Core.TyCon.html#AbstractClosedSynFamilyTyCon"><span class="hs-identifier hs-var">AbstractClosedSynFamilyTyCon</span></a></span><span>
</span><span id="line-1390"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">BootErrsM BootTyConMismatch
forall err. BootErrsM err
</span><a href="GHC.Tc.Module.html#checkSuccess"><span class="hs-identifier hs-var">checkSuccess</span></a></span><span> </span><span class="hs-comment">-- This case only happens for hsig merging.</span><span>
</span><span id="line-1391"></span><span class="annot"><a href="GHC.Tc.Module.html#compatFamFlav"><span class="hs-identifier hs-var">compatFamFlav</span></a></span><span> </span><span class="annot"><span class="annottext">FamTyConFlav
</span><a href="GHC.Core.TyCon.html#AbstractClosedSynFamilyTyCon"><span class="hs-identifier hs-var">AbstractClosedSynFamilyTyCon</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Core.TyCon.html#ClosedSynFamilyTyCon"><span class="hs-identifier hs-type">ClosedSynFamilyTyCon</span></a></span><span> </span><span class="hs-special">{</span><span class="hs-special">}</span><span class="hs-special">)</span><span>
</span><span id="line-1392"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">BootErrsM BootTyConMismatch
forall err. BootErrsM err
</span><a href="GHC.Tc.Module.html#checkSuccess"><span class="hs-identifier hs-var">checkSuccess</span></a></span><span>
</span><span id="line-1393"></span><span class="annot"><a href="GHC.Tc.Module.html#compatFamFlav"><span class="hs-identifier hs-var">compatFamFlav</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Core.TyCon.html#ClosedSynFamilyTyCon"><span class="hs-identifier hs-type">ClosedSynFamilyTyCon</span></a></span><span> </span><span class="hs-special">{</span><span class="hs-special">}</span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">FamTyConFlav
</span><a href="GHC.Core.TyCon.html#AbstractClosedSynFamilyTyCon"><span class="hs-identifier hs-var">AbstractClosedSynFamilyTyCon</span></a></span><span>
</span><span id="line-1394"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">BootErrsM BootTyConMismatch
forall err. BootErrsM err
</span><a href="GHC.Tc.Module.html#checkSuccess"><span class="hs-identifier hs-var">checkSuccess</span></a></span><span>
</span><span id="line-1395"></span><span class="annot"><a href="GHC.Tc.Module.html#compatFamFlav"><span class="hs-identifier hs-var">compatFamFlav</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Core.TyCon.html#ClosedSynFamilyTyCon"><span class="hs-identifier hs-type">ClosedSynFamilyTyCon</span></a></span><span> </span><span id="local-6989586621683117200"><span class="annot"><span class="annottext">Maybe (CoAxiom Branched)
</span><a href="#local-6989586621683117200"><span class="hs-identifier hs-var">ax1</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Core.TyCon.html#ClosedSynFamilyTyCon"><span class="hs-identifier hs-type">ClosedSynFamilyTyCon</span></a></span><span> </span><span id="local-6989586621683117201"><span class="annot"><span class="annottext">Maybe (CoAxiom Branched)
</span><a href="#local-6989586621683117201"><span class="hs-identifier hs-var">ax2</span></a></span></span><span class="hs-special">)</span><span>
</span><span id="line-1396"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Maybe (CoAxiom Branched)
-&gt; Maybe (CoAxiom Branched) -&gt; BootErrsM BootTyConMismatch
forall (br :: BranchFlag) (br1 :: BranchFlag).
Maybe (CoAxiom br)
-&gt; Maybe (CoAxiom br1) -&gt; BootErrsM BootTyConMismatch
</span><a href="GHC.Tc.Module.html#eqClosedFamilyAx"><span class="hs-identifier hs-var">eqClosedFamilyAx</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe (CoAxiom Branched)
</span><a href="#local-6989586621683117200"><span class="hs-identifier hs-var">ax1</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe (CoAxiom Branched)
</span><a href="#local-6989586621683117201"><span class="hs-identifier hs-var">ax2</span></a></span><span>
</span><span id="line-1397"></span><span class="annot"><a href="GHC.Tc.Module.html#compatFamFlav"><span class="hs-identifier hs-var">compatFamFlav</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Core.TyCon.html#BuiltInSynFamTyCon"><span class="hs-identifier hs-type">BuiltInSynFamTyCon</span></a></span><span> </span><span class="hs-special">{</span><span class="hs-special">}</span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Core.TyCon.html#BuiltInSynFamTyCon"><span class="hs-identifier hs-type">BuiltInSynFamTyCon</span></a></span><span> </span><span class="hs-special">{</span><span class="hs-special">}</span><span class="hs-special">)</span><span>
</span><span id="line-1398"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">BootErrsM BootTyConMismatch
forall err. BootErrsM err
</span><a href="GHC.Tc.Module.html#checkSuccess"><span class="hs-identifier hs-var">checkSuccess</span></a></span><span>
</span><span id="line-1399"></span><span class="annot"><a href="GHC.Tc.Module.html#compatFamFlav"><span class="hs-identifier hs-var">compatFamFlav</span></a></span><span> </span><span id="local-6989586621683117204"><span class="annot"><span class="annottext">FamTyConFlav
</span><a href="#local-6989586621683117204"><span class="hs-identifier hs-var">flav1</span></a></span></span><span> </span><span id="local-6989586621683117205"><span class="annot"><span class="annottext">FamTyConFlav
</span><a href="#local-6989586621683117205"><span class="hs-identifier hs-var">flav2</span></a></span></span><span>
</span><span id="line-1400"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">BootTyConMismatch -&gt; BootErrsM BootTyConMismatch
forall err. err -&gt; BootErrsM err
</span><a href="GHC.Tc.Module.html#bootErr"><span class="hs-identifier hs-var">bootErr</span></a></span><span> </span><span class="annot"><span class="annottext">(BootTyConMismatch -&gt; BootErrsM BootTyConMismatch)
-&gt; BootTyConMismatch -&gt; BootErrsM BootTyConMismatch
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">FamTyConFlav -&gt; FamTyConFlav -&gt; BootTyConMismatch
</span><a href="GHC.Tc.Errors.Types.html#TyConFlavourMismatch"><span class="hs-identifier hs-var">TyConFlavourMismatch</span></a></span><span> </span><span class="annot"><span class="annottext">FamTyConFlav
</span><a href="#local-6989586621683117204"><span class="hs-identifier hs-var">flav1</span></a></span><span> </span><span class="annot"><span class="annottext">FamTyConFlav
</span><a href="#local-6989586621683117205"><span class="hs-identifier hs-var">flav2</span></a></span><span>
</span><span id="line-1401"></span><span>
</span><span id="line-1402"></span><span class="annot"><span class="hs-comment">-- | Check that two 'AlgTyConRhs's are compatible.</span></span><span>
</span><span id="line-1403"></span><span class="annot"><a href="GHC.Tc.Module.html#compatAlgRhs"><span class="hs-identifier hs-type">compatAlgRhs</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Core.TyCon.html#AlgTyConRhs"><span class="hs-identifier hs-type">AlgTyConRhs</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Core.TyCon.html#AlgTyConRhs"><span class="hs-identifier hs-type">AlgTyConRhs</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Module.html#BootErrsM"><span class="hs-identifier hs-type">BootErrsM</span></a></span><span> </span><span class="annot"><a href="GHC.Tc.Errors.Types.html#BootDataMismatch"><span class="hs-identifier hs-type">BootDataMismatch</span></a></span><span>
</span><span id="line-1404"></span><span id="compatAlgRhs"><span class="annot"><span class="annottext">compatAlgRhs :: AlgTyConRhs -&gt; AlgTyConRhs -&gt; BootErrsM BootDataMismatch
</span><a href="GHC.Tc.Module.html#compatAlgRhs"><span class="hs-identifier hs-var hs-var">compatAlgRhs</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Core.TyCon.html#AbstractTyCon"><span class="hs-identifier hs-type">AbstractTyCon</span></a></span><span> </span><span class="hs-special">{</span><span class="hs-special">}</span><span class="hs-special">)</span><span> </span><span id="local-6989586621683117208"><span class="annot"><span class="annottext">AlgTyConRhs
</span><a href="#local-6989586621683117208"><span class="hs-identifier hs-var">_rhs2</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-1405"></span><span>  </span><span class="annot"><span class="annottext">BootErrsM BootDataMismatch
forall err. BootErrsM err
</span><a href="GHC.Tc.Module.html#checkSuccess"><span class="hs-identifier hs-var">checkSuccess</span></a></span><span> </span><span class="hs-comment">-- rhs2 is guaranteed to be injective, since it's an AlgTyCon</span><span>
</span><span id="line-1406"></span><span class="annot"><a href="GHC.Tc.Module.html#compatAlgRhs"><span class="hs-identifier hs-var">compatAlgRhs</span></a></span><span>  </span><span id="local-6989586621683117209"><span class="annot"><span class="annottext">tc1 :: AlgTyConRhs
</span><a href="#local-6989586621683117209"><span class="hs-identifier hs-var">tc1</span></a></span></span><span class="hs-glyph">@</span><span class="annot"><a href="GHC.Core.TyCon.html#DataTyCon"><span class="hs-identifier hs-type">DataTyCon</span></a></span><span class="hs-special">{</span><span class="hs-special">}</span><span> </span><span id="local-6989586621683117211"><span class="annot"><span class="annottext">tc2 :: AlgTyConRhs
</span><a href="#local-6989586621683117211"><span class="hs-identifier hs-var">tc2</span></a></span></span><span class="hs-glyph">@</span><span class="annot"><a href="GHC.Core.TyCon.html#DataTyCon"><span class="hs-identifier hs-type">DataTyCon</span></a></span><span class="hs-special">{</span><span class="hs-special">}</span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-1407"></span><span>  </span><span class="annot"><span class="annottext">(DataCon -&gt; DataCon -&gt; BootErrsM BootDataConMismatch)
-&gt; [DataCon]
-&gt; [DataCon]
-&gt; (BootListMismatches DataCon BootDataConMismatch
    -&gt; BootDataMismatch)
-&gt; BootErrsM BootDataMismatch
forall a err err2.
(a -&gt; a -&gt; BootErrsM err)
-&gt; [a]
-&gt; [a]
-&gt; (BootListMismatches a err -&gt; err2)
-&gt; BootErrsM err2
</span><a href="GHC.Tc.Module.html#checkListBy"><span class="hs-identifier hs-var">checkListBy</span></a></span><span> </span><span class="annot"><span class="annottext">DataCon -&gt; DataCon -&gt; BootErrsM BootDataConMismatch
</span><a href="GHC.Tc.Module.html#compatCon"><span class="hs-identifier hs-var">compatCon</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">AlgTyConRhs -&gt; [DataCon]
</span><a href="GHC.Core.TyCon.html#data_cons"><span class="hs-identifier hs-var">data_cons</span></a></span><span> </span><span class="annot"><span class="annottext">AlgTyConRhs
</span><a href="#local-6989586621683117209"><span class="hs-identifier hs-var">tc1</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">AlgTyConRhs -&gt; [DataCon]
</span><a href="GHC.Core.TyCon.html#data_cons"><span class="hs-identifier hs-var">data_cons</span></a></span><span> </span><span class="annot"><span class="annottext">AlgTyConRhs
</span><a href="#local-6989586621683117211"><span class="hs-identifier hs-var">tc2</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">BootListMismatches DataCon BootDataConMismatch -&gt; BootDataMismatch
</span><a href="GHC.Tc.Errors.Types.html#MismatchedConstructors"><span class="hs-identifier hs-var">MismatchedConstructors</span></a></span><span>
</span><span id="line-1408"></span><span class="annot"><a href="GHC.Tc.Module.html#compatAlgRhs"><span class="hs-identifier hs-var">compatAlgRhs</span></a></span><span>  </span><span id="local-6989586621683117215"><span class="annot"><span class="annottext">tc1 :: AlgTyConRhs
</span><a href="#local-6989586621683117215"><span class="hs-identifier hs-var">tc1</span></a></span></span><span class="hs-glyph">@</span><span class="annot"><a href="GHC.Core.TyCon.html#NewTyCon"><span class="hs-identifier hs-type">NewTyCon</span></a></span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">data_con :: AlgTyConRhs -&gt; DataCon
</span><a href="GHC.Core.TyCon.html#data_con"><span class="hs-identifier hs-var">data_con</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="local-6989586621683117218"><span class="annot"><span class="annottext">DataCon
</span><a href="#local-6989586621683117218"><span class="hs-identifier hs-var">dc1</span></a></span></span><span> </span><span class="hs-special">}</span><span> </span><span id="local-6989586621683117219"><span class="annot"><span class="annottext">tc2 :: AlgTyConRhs
</span><a href="#local-6989586621683117219"><span class="hs-identifier hs-var">tc2</span></a></span></span><span class="hs-glyph">@</span><span class="annot"><a href="GHC.Core.TyCon.html#NewTyCon"><span class="hs-identifier hs-type">NewTyCon</span></a></span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">data_con :: AlgTyConRhs -&gt; DataCon
</span><a href="GHC.Core.TyCon.html#data_con"><span class="hs-identifier hs-var">data_con</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="local-6989586621683117220"><span class="annot"><span class="annottext">DataCon
</span><a href="#local-6989586621683117220"><span class="hs-identifier hs-var">dc2</span></a></span></span><span> </span><span class="hs-special">}</span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-1409"></span><span>  </span><span class="annot"><span class="annottext">(BootDataConMismatch -&gt; BootDataMismatch)
-&gt; BootErrsM BootDataConMismatch -&gt; BootErrsM BootDataMismatch
forall err1 err2.
(err1 -&gt; err2) -&gt; BootErrsM err1 -&gt; BootErrsM err2
</span><a href="GHC.Tc.Module.html#embedErrs"><span class="hs-identifier hs-var">embedErrs</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">BootListMismatches DataCon BootDataConMismatch -&gt; BootDataMismatch
</span><a href="GHC.Tc.Errors.Types.html#MismatchedConstructors"><span class="hs-identifier hs-var">MismatchedConstructors</span></a></span><span> </span><span class="annot"><span class="annottext">(BootListMismatches DataCon BootDataConMismatch
 -&gt; BootDataMismatch)
-&gt; (BootDataConMismatch
    -&gt; BootListMismatches DataCon BootDataConMismatch)
-&gt; BootDataConMismatch
-&gt; BootDataMismatch
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">BootListMismatch DataCon BootDataConMismatch
-&gt; BootListMismatches DataCon BootDataConMismatch
forall a. a -&gt; NonEmpty a
</span><a href="../../base-4.21.0.0-ae91/src/Data.List.NonEmpty.html#singleton"><span class="hs-identifier hs-var">NE.singleton</span></a></span><span> </span><span class="annot"><span class="annottext">(BootListMismatch DataCon BootDataConMismatch
 -&gt; BootListMismatches DataCon BootDataConMismatch)
-&gt; (BootDataConMismatch
    -&gt; BootListMismatch DataCon BootDataConMismatch)
-&gt; BootDataConMismatch
-&gt; BootListMismatches DataCon BootDataConMismatch
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">Arity
-&gt; DataCon
-&gt; DataCon
-&gt; BootDataConMismatch
-&gt; BootListMismatch DataCon BootDataConMismatch
forall item err.
Arity -&gt; item -&gt; item -&gt; err -&gt; BootListMismatch item err
</span><a href="GHC.Tc.Errors.Types.html#MismatchedThing"><span class="hs-identifier hs-var">MismatchedThing</span></a></span><span> </span><span class="annot"><span class="annottext">Arity
</span><span class="hs-number">1</span></span><span> </span><span class="annot"><span class="annottext">DataCon
</span><a href="#local-6989586621683117218"><span class="hs-identifier hs-var">dc1</span></a></span><span> </span><span class="annot"><span class="annottext">DataCon
</span><a href="#local-6989586621683117220"><span class="hs-identifier hs-var">dc2</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(BootErrsM BootDataConMismatch -&gt; BootErrsM BootDataMismatch)
-&gt; BootErrsM BootDataConMismatch -&gt; BootErrsM BootDataMismatch
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-1410"></span><span>    </span><span class="annot"><span class="annottext">DataCon -&gt; DataCon -&gt; BootErrsM BootDataConMismatch
</span><a href="GHC.Tc.Module.html#compatCon"><span class="hs-identifier hs-var">compatCon</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">AlgTyConRhs -&gt; DataCon
</span><a href="GHC.Core.TyCon.html#data_con"><span class="hs-identifier hs-var">data_con</span></a></span><span> </span><span class="annot"><span class="annottext">AlgTyConRhs
</span><a href="#local-6989586621683117215"><span class="hs-identifier hs-var">tc1</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">AlgTyConRhs -&gt; DataCon
</span><a href="GHC.Core.TyCon.html#data_con"><span class="hs-identifier hs-var">data_con</span></a></span><span> </span><span class="annot"><span class="annottext">AlgTyConRhs
</span><a href="#local-6989586621683117219"><span class="hs-identifier hs-var">tc2</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1411"></span><span class="annot"><a href="GHC.Tc.Module.html#compatAlgRhs"><span class="hs-identifier hs-var">compatAlgRhs</span></a></span><span> </span><span class="annot"><span class="annottext">AlgTyConRhs
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">AlgTyConRhs
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">BootDataMismatch -&gt; BootErrsM BootDataMismatch
forall err. err -&gt; BootErrsM err
</span><a href="GHC.Tc.Module.html#bootErr"><span class="hs-identifier hs-var">bootErr</span></a></span><span> </span><span class="annot"><span class="annottext">BootDataMismatch
</span><a href="GHC.Tc.Errors.Types.html#MismatchedNewtypeVsData"><span class="hs-identifier hs-var">MismatchedNewtypeVsData</span></a></span><span>
</span><span id="line-1412"></span><span>
</span><span id="line-1413"></span><span class="annot"><span class="hs-comment">-- | Check that two 'DataCon's are compatible.</span></span><span>
</span><span id="line-1414"></span><span class="annot"><a href="GHC.Tc.Module.html#compatCon"><span class="hs-identifier hs-type">compatCon</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Core.DataCon.html#DataCon"><span class="hs-identifier hs-type">DataCon</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Core.DataCon.html#DataCon"><span class="hs-identifier hs-type">DataCon</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Module.html#BootErrsM"><span class="hs-identifier hs-type">BootErrsM</span></a></span><span> </span><span class="annot"><a href="GHC.Tc.Errors.Types.html#BootDataConMismatch"><span class="hs-identifier hs-type">BootDataConMismatch</span></a></span><span>
</span><span id="line-1415"></span><span id="compatCon"><span class="annot"><span class="annottext">compatCon :: DataCon -&gt; DataCon -&gt; BootErrsM BootDataConMismatch
</span><a href="GHC.Tc.Module.html#compatCon"><span class="hs-identifier hs-var hs-var">compatCon</span></a></span></span><span> </span><span id="local-6989586621683117223"><span class="annot"><span class="annottext">DataCon
</span><a href="#local-6989586621683117223"><span class="hs-identifier hs-var">c1</span></a></span></span><span> </span><span id="local-6989586621683117224"><span class="annot"><span class="annottext">DataCon
</span><a href="#local-6989586621683117224"><span class="hs-identifier hs-var">c2</span></a></span></span><span>
</span><span id="line-1416"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">Bool -&gt; BootDataConMismatch -&gt; BootErrsM BootDataConMismatch
forall err. Bool -&gt; err -&gt; BootErrsM err
</span><a href="GHC.Tc.Module.html#check"><span class="hs-identifier hs-var">check</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">DataCon -&gt; Name
</span><a href="GHC.Core.DataCon.html#dataConName"><span class="hs-identifier hs-var">dataConName</span></a></span><span> </span><span class="annot"><span class="annottext">DataCon
</span><a href="#local-6989586621683117223"><span class="hs-identifier hs-var">c1</span></a></span><span> </span><span class="annot"><span class="annottext">Name -&gt; Name -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">==</span></span><span> </span><span class="annot"><span class="annottext">DataCon -&gt; Name
</span><a href="GHC.Core.DataCon.html#dataConName"><span class="hs-identifier hs-var">dataConName</span></a></span><span> </span><span class="annot"><span class="annottext">DataCon
</span><a href="#local-6989586621683117224"><span class="hs-identifier hs-var">c2</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1417"></span><span>           </span><span class="annot"><span class="annottext">BootDataConMismatch
</span><a href="GHC.Tc.Errors.Types.html#MismatchedDataConNames"><span class="hs-identifier hs-var">MismatchedDataConNames</span></a></span><span>
</span><span id="line-1418"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="annottext">Bool -&gt; BootDataConMismatch -&gt; BootErrsM BootDataConMismatch
forall err. Bool -&gt; err -&gt; BootErrsM err
</span><a href="GHC.Tc.Module.html#check"><span class="hs-identifier hs-var">check</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">DataCon -&gt; Bool
</span><a href="GHC.Core.DataCon.html#dataConIsInfix"><span class="hs-identifier hs-var">dataConIsInfix</span></a></span><span> </span><span class="annot"><span class="annottext">DataCon
</span><a href="#local-6989586621683117223"><span class="hs-identifier hs-var">c1</span></a></span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Bool -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">==</span></span><span> </span><span class="annot"><span class="annottext">DataCon -&gt; Bool
</span><a href="GHC.Core.DataCon.html#dataConIsInfix"><span class="hs-identifier hs-var">dataConIsInfix</span></a></span><span> </span><span class="annot"><span class="annottext">DataCon
</span><a href="#local-6989586621683117224"><span class="hs-identifier hs-var">c2</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1419"></span><span>           </span><span class="annot"><span class="annottext">BootDataConMismatch
</span><a href="GHC.Tc.Errors.Types.html#MismatchedDataConFixities"><span class="hs-identifier hs-var">MismatchedDataConFixities</span></a></span><span>
</span><span id="line-1420"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="annottext">Bool -&gt; BootDataConMismatch -&gt; BootErrsM BootDataConMismatch
forall err. Bool -&gt; err -&gt; BootErrsM err
</span><a href="GHC.Tc.Module.html#check"><span class="hs-identifier hs-var">check</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(HsImplBang -&gt; HsImplBang -&gt; Bool)
-&gt; [HsImplBang] -&gt; [HsImplBang] -&gt; Bool
forall a b. (a -&gt; b -&gt; Bool) -&gt; [a] -&gt; [b] -&gt; Bool
forall (f :: * -&gt; *) a b.
Eq1 f =&gt;
(a -&gt; b -&gt; Bool) -&gt; f a -&gt; f b -&gt; Bool
</span><a href="../../base-4.21.0.0-ae91/src/Data.Functor.Classes.html#liftEq"><span class="hs-identifier hs-var">liftEq</span></a></span><span> </span><span class="annot"><span class="annottext">HsImplBang -&gt; HsImplBang -&gt; Bool
</span><a href="GHC.Core.DataCon.html#eqHsBang"><span class="hs-identifier hs-var">eqHsBang</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">DataCon -&gt; [HsImplBang]
</span><a href="GHC.Core.DataCon.html#dataConImplBangs"><span class="hs-identifier hs-var">dataConImplBangs</span></a></span><span> </span><span class="annot"><span class="annottext">DataCon
</span><a href="#local-6989586621683117223"><span class="hs-identifier hs-var">c1</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">DataCon -&gt; [HsImplBang]
</span><a href="GHC.Core.DataCon.html#dataConImplBangs"><span class="hs-identifier hs-var">dataConImplBangs</span></a></span><span> </span><span class="annot"><span class="annottext">DataCon
</span><a href="#local-6989586621683117224"><span class="hs-identifier hs-var">c2</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-1421"></span><span>           </span><span class="annot"><span class="annottext">BootDataConMismatch
</span><a href="GHC.Tc.Errors.Types.html#MismatchedDataConBangs"><span class="hs-identifier hs-var">MismatchedDataConBangs</span></a></span><span>
</span><span id="line-1422"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="annottext">Bool -&gt; BootDataConMismatch -&gt; BootErrsM BootDataConMismatch
forall err. Bool -&gt; err -&gt; BootErrsM err
</span><a href="GHC.Tc.Module.html#check"><span class="hs-identifier hs-var">check</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(FieldLabel -&gt; Name) -&gt; [FieldLabel] -&gt; [Name]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><span class="hs-identifier hs-var">map</span></span><span> </span><span class="annot"><span class="annottext">FieldLabel -&gt; Name
</span><a href="GHC.Types.FieldLabel.html#flSelector"><span class="hs-identifier hs-var">flSelector</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">DataCon -&gt; [FieldLabel]
</span><a href="GHC.Core.DataCon.html#dataConFieldLabels"><span class="hs-identifier hs-var">dataConFieldLabels</span></a></span><span> </span><span class="annot"><span class="annottext">DataCon
</span><a href="#local-6989586621683117223"><span class="hs-identifier hs-var">c1</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[Name] -&gt; [Name] -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">==</span></span><span> </span><span class="annot"><span class="annottext">(FieldLabel -&gt; Name) -&gt; [FieldLabel] -&gt; [Name]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><span class="hs-identifier hs-var">map</span></span><span> </span><span class="annot"><span class="annottext">FieldLabel -&gt; Name
</span><a href="GHC.Types.FieldLabel.html#flSelector"><span class="hs-identifier hs-var">flSelector</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">DataCon -&gt; [FieldLabel]
</span><a href="GHC.Core.DataCon.html#dataConFieldLabels"><span class="hs-identifier hs-var">dataConFieldLabels</span></a></span><span> </span><span class="annot"><span class="annottext">DataCon
</span><a href="#local-6989586621683117224"><span class="hs-identifier hs-var">c2</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-1423"></span><span>           </span><span class="annot"><span class="annottext">BootDataConMismatch
</span><a href="GHC.Tc.Errors.Types.html#MismatchedDataConFieldLabels"><span class="hs-identifier hs-var">MismatchedDataConFieldLabels</span></a></span><span>
</span><span id="line-1424"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="annottext">Bool -&gt; BootDataConMismatch -&gt; BootErrsM BootDataConMismatch
forall err. Bool -&gt; err -&gt; BootErrsM err
</span><a href="GHC.Tc.Module.html#check"><span class="hs-identifier hs-var">check</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">HasCallStack =&gt; Type -&gt; Type -&gt; Bool
Type -&gt; Type -&gt; Bool
</span><a href="GHC.Core.TyCo.Compare.html#eqType"><span class="hs-identifier hs-var">eqType</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">DataCon -&gt; Type
</span><a href="GHC.Core.DataCon.html#dataConWrapperType"><span class="hs-identifier hs-var">dataConWrapperType</span></a></span><span> </span><span class="annot"><span class="annottext">DataCon
</span><a href="#local-6989586621683117223"><span class="hs-identifier hs-var">c1</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">DataCon -&gt; Type
</span><a href="GHC.Core.DataCon.html#dataConWrapperType"><span class="hs-identifier hs-var">dataConWrapperType</span></a></span><span> </span><span class="annot"><span class="annottext">DataCon
</span><a href="#local-6989586621683117224"><span class="hs-identifier hs-var">c2</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-1425"></span><span>           </span><span class="annot"><span class="annottext">BootDataConMismatch
</span><a href="GHC.Tc.Errors.Types.html#MismatchedDataConTypes"><span class="hs-identifier hs-var">MismatchedDataConTypes</span></a></span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-1426"></span><span>
</span><span id="line-1427"></span><span id="local-6989586621683115117"><span id="local-6989586621683115118"><span class="annot"><a href="GHC.Tc.Module.html#eqClosedFamilyAx"><span class="hs-identifier hs-type">eqClosedFamilyAx</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Maybe</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Core.Coercion.Axiom.html#CoAxiom"><span class="hs-identifier hs-type">CoAxiom</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683115117"><span class="hs-identifier hs-type">br</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Maybe</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Core.Coercion.Axiom.html#CoAxiom"><span class="hs-identifier hs-type">CoAxiom</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683115118"><span class="hs-identifier hs-type">br1</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1428"></span><span>                 </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Module.html#BootErrsM"><span class="hs-identifier hs-type">BootErrsM</span></a></span><span> </span><span class="annot"><a href="GHC.Tc.Errors.Types.html#BootTyConMismatch"><span class="hs-identifier hs-type">BootTyConMismatch</span></a></span></span></span><span>
</span><span id="line-1429"></span><span id="eqClosedFamilyAx"><span class="annot"><span class="annottext">eqClosedFamilyAx :: forall (br :: BranchFlag) (br1 :: BranchFlag).
Maybe (CoAxiom br)
-&gt; Maybe (CoAxiom br1) -&gt; BootErrsM BootTyConMismatch
</span><a href="GHC.Tc.Module.html#eqClosedFamilyAx"><span class="hs-identifier hs-var hs-var">eqClosedFamilyAx</span></a></span></span><span> </span><span class="annot"><span class="annottext">Maybe (CoAxiom br)
</span><span class="hs-identifier hs-var">Nothing</span></span><span> </span><span class="annot"><span class="annottext">Maybe (CoAxiom br1)
</span><span class="hs-identifier hs-var">Nothing</span></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">BootErrsM BootTyConMismatch
forall err. BootErrsM err
</span><a href="GHC.Tc.Module.html#checkSuccess"><span class="hs-identifier hs-var">checkSuccess</span></a></span><span>
</span><span id="line-1430"></span><span class="annot"><a href="GHC.Tc.Module.html#eqClosedFamilyAx"><span class="hs-identifier hs-var">eqClosedFamilyAx</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe (CoAxiom br)
</span><span class="hs-identifier hs-var">Nothing</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span class="annot"><span class="annottext">CoAxiom br1
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">BootTyConMismatch -&gt; BootErrsM BootTyConMismatch
forall err. err -&gt; BootErrsM err
</span><a href="GHC.Tc.Module.html#bootErr"><span class="hs-identifier hs-var">bootErr</span></a></span><span> </span><span class="annot"><span class="annottext">(BootTyConMismatch -&gt; BootErrsM BootTyConMismatch)
-&gt; BootTyConMismatch -&gt; BootErrsM BootTyConMismatch
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">BootListMismatches CoAxBranch BootAxiomBranchMismatch
-&gt; BootTyConMismatch
</span><a href="GHC.Tc.Errors.Types.html#TyConAxiomMismatch"><span class="hs-identifier hs-var">TyConAxiomMismatch</span></a></span><span> </span><span class="annot"><span class="annottext">(BootListMismatches CoAxBranch BootAxiomBranchMismatch
 -&gt; BootTyConMismatch)
-&gt; BootListMismatches CoAxBranch BootAxiomBranchMismatch
-&gt; BootTyConMismatch
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">BootListMismatch CoAxBranch BootAxiomBranchMismatch
-&gt; BootListMismatches CoAxBranch BootAxiomBranchMismatch
forall a. a -&gt; NonEmpty a
</span><a href="../../base-4.21.0.0-ae91/src/Data.List.NonEmpty.html#singleton"><span class="hs-identifier hs-var">NE.singleton</span></a></span><span> </span><span class="annot"><span class="annottext">BootListMismatch CoAxBranch BootAxiomBranchMismatch
forall item err. BootListMismatch item err
</span><a href="GHC.Tc.Errors.Types.html#MismatchedLength"><span class="hs-identifier hs-var">MismatchedLength</span></a></span><span>
</span><span id="line-1431"></span><span class="annot"><a href="GHC.Tc.Module.html#eqClosedFamilyAx"><span class="hs-identifier hs-var">eqClosedFamilyAx</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span class="annot"><span class="annottext">CoAxiom br
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Maybe (CoAxiom br1)
</span><span class="hs-identifier hs-var">Nothing</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">BootTyConMismatch -&gt; BootErrsM BootTyConMismatch
forall err. err -&gt; BootErrsM err
</span><a href="GHC.Tc.Module.html#bootErr"><span class="hs-identifier hs-var">bootErr</span></a></span><span> </span><span class="annot"><span class="annottext">(BootTyConMismatch -&gt; BootErrsM BootTyConMismatch)
-&gt; BootTyConMismatch -&gt; BootErrsM BootTyConMismatch
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">BootListMismatches CoAxBranch BootAxiomBranchMismatch
-&gt; BootTyConMismatch
</span><a href="GHC.Tc.Errors.Types.html#TyConAxiomMismatch"><span class="hs-identifier hs-var">TyConAxiomMismatch</span></a></span><span> </span><span class="annot"><span class="annottext">(BootListMismatches CoAxBranch BootAxiomBranchMismatch
 -&gt; BootTyConMismatch)
-&gt; BootListMismatches CoAxBranch BootAxiomBranchMismatch
-&gt; BootTyConMismatch
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">BootListMismatch CoAxBranch BootAxiomBranchMismatch
-&gt; BootListMismatches CoAxBranch BootAxiomBranchMismatch
forall a. a -&gt; NonEmpty a
</span><a href="../../base-4.21.0.0-ae91/src/Data.List.NonEmpty.html#singleton"><span class="hs-identifier hs-var">NE.singleton</span></a></span><span> </span><span class="annot"><span class="annottext">BootListMismatch CoAxBranch BootAxiomBranchMismatch
forall item err. BootListMismatch item err
</span><a href="GHC.Tc.Errors.Types.html#MismatchedLength"><span class="hs-identifier hs-var">MismatchedLength</span></a></span><span>
</span><span id="line-1432"></span><span class="annot"><a href="GHC.Tc.Module.html#eqClosedFamilyAx"><span class="hs-identifier hs-var">eqClosedFamilyAx</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Core.Coercion.Axiom.html#CoAxiom"><span class="hs-identifier hs-type">CoAxiom</span></a></span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">co_ax_branches :: forall (br :: BranchFlag). CoAxiom br -&gt; Branches br
</span><a href="GHC.Core.Coercion.Axiom.html#co_ax_branches"><span class="hs-identifier hs-var">co_ax_branches</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="local-6989586621683117240"><span class="annot"><span class="annottext">Branches br
</span><a href="#local-6989586621683117240"><span class="hs-identifier hs-var">branches1</span></a></span></span><span> </span><span class="hs-special">}</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-1433"></span><span>                 </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Core.Coercion.Axiom.html#CoAxiom"><span class="hs-identifier hs-type">CoAxiom</span></a></span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">co_ax_branches :: forall (br :: BranchFlag). CoAxiom br -&gt; Branches br
</span><a href="GHC.Core.Coercion.Axiom.html#co_ax_branches"><span class="hs-identifier hs-var">co_ax_branches</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="local-6989586621683117241"><span class="annot"><span class="annottext">Branches br1
</span><a href="#local-6989586621683117241"><span class="hs-identifier hs-var">branches2</span></a></span></span><span> </span><span class="hs-special">}</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-1434"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(CoAxBranch -&gt; CoAxBranch -&gt; BootErrsM BootAxiomBranchMismatch)
-&gt; [CoAxBranch]
-&gt; [CoAxBranch]
-&gt; (BootListMismatches CoAxBranch BootAxiomBranchMismatch
    -&gt; BootTyConMismatch)
-&gt; BootErrsM BootTyConMismatch
forall a err err2.
(a -&gt; a -&gt; BootErrsM err)
-&gt; [a]
-&gt; [a]
-&gt; (BootListMismatches a err -&gt; err2)
-&gt; BootErrsM err2
</span><a href="GHC.Tc.Module.html#checkListBy"><span class="hs-identifier hs-var">checkListBy</span></a></span><span> </span><span class="annot"><span class="annottext">CoAxBranch -&gt; CoAxBranch -&gt; BootErrsM BootAxiomBranchMismatch
</span><a href="GHC.Tc.Module.html#eqClosedFamilyBranch"><span class="hs-identifier hs-var">eqClosedFamilyBranch</span></a></span><span> </span><span class="annot"><span class="annottext">[CoAxBranch]
</span><a href="#local-6989586621683117243"><span class="hs-identifier hs-var">branch_list1</span></a></span><span> </span><span class="annot"><span class="annottext">[CoAxBranch]
</span><a href="#local-6989586621683117244"><span class="hs-identifier hs-var">branch_list2</span></a></span><span>
</span><span id="line-1435"></span><span>      </span><span class="annot"><span class="annottext">BootListMismatches CoAxBranch BootAxiomBranchMismatch
-&gt; BootTyConMismatch
</span><a href="GHC.Tc.Errors.Types.html#TyConAxiomMismatch"><span class="hs-identifier hs-var">TyConAxiomMismatch</span></a></span><span>
</span><span id="line-1436"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-1437"></span><span>    </span><span id="local-6989586621683117243"><span class="annot"><span class="annottext">branch_list1 :: [CoAxBranch]
</span><a href="#local-6989586621683117243"><span class="hs-identifier hs-var hs-var">branch_list1</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Branches br -&gt; [CoAxBranch]
forall (br :: BranchFlag). Branches br -&gt; [CoAxBranch]
</span><a href="GHC.Core.Coercion.Axiom.html#fromBranches"><span class="hs-identifier hs-var">fromBranches</span></a></span><span> </span><span class="annot"><span class="annottext">Branches br
</span><a href="#local-6989586621683117240"><span class="hs-identifier hs-var">branches1</span></a></span><span>
</span><span id="line-1438"></span><span>    </span><span id="local-6989586621683117244"><span class="annot"><span class="annottext">branch_list2 :: [CoAxBranch]
</span><a href="#local-6989586621683117244"><span class="hs-identifier hs-var hs-var">branch_list2</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Branches br1 -&gt; [CoAxBranch]
forall (br :: BranchFlag). Branches br -&gt; [CoAxBranch]
</span><a href="GHC.Core.Coercion.Axiom.html#fromBranches"><span class="hs-identifier hs-var">fromBranches</span></a></span><span> </span><span class="annot"><span class="annottext">Branches br1
</span><a href="#local-6989586621683117241"><span class="hs-identifier hs-var">branches2</span></a></span><span>
</span><span id="line-1439"></span><span>
</span><span id="line-1440"></span><span class="annot"><a href="GHC.Tc.Module.html#eqClosedFamilyBranch"><span class="hs-identifier hs-type">eqClosedFamilyBranch</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Core.Coercion.Axiom.html#CoAxBranch"><span class="hs-identifier hs-type">CoAxBranch</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Core.Coercion.Axiom.html#CoAxBranch"><span class="hs-identifier hs-type">CoAxBranch</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Module.html#BootErrsM"><span class="hs-identifier hs-type">BootErrsM</span></a></span><span> </span><span class="annot"><a href="GHC.Tc.Errors.Types.html#BootAxiomBranchMismatch"><span class="hs-identifier hs-type">BootAxiomBranchMismatch</span></a></span><span>
</span><span id="line-1441"></span><span id="eqClosedFamilyBranch"><span class="annot"><span class="annottext">eqClosedFamilyBranch :: CoAxBranch -&gt; CoAxBranch -&gt; BootErrsM BootAxiomBranchMismatch
</span><a href="GHC.Tc.Module.html#eqClosedFamilyBranch"><span class="hs-identifier hs-var hs-var">eqClosedFamilyBranch</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Core.Coercion.Axiom.html#CoAxBranch"><span class="hs-identifier hs-type">CoAxBranch</span></a></span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">cab_tvs :: CoAxBranch -&gt; [Id]
</span><a href="GHC.Core.Coercion.Axiom.html#cab_tvs"><span class="hs-identifier hs-var">cab_tvs</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="local-6989586621683117248"><span class="annot"><span class="annottext">[Id]
</span><a href="#local-6989586621683117248"><span class="hs-identifier hs-var">tvs1</span></a></span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">cab_cvs :: CoAxBranch -&gt; [Id]
</span><a href="GHC.Core.Coercion.Axiom.html#cab_cvs"><span class="hs-identifier hs-var">cab_cvs</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="local-6989586621683117250"><span class="annot"><span class="annottext">[Id]
</span><a href="#local-6989586621683117250"><span class="hs-identifier hs-var">cvs1</span></a></span></span><span>
</span><span id="line-1442"></span><span>                                 </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">cab_lhs :: CoAxBranch -&gt; [Type]
</span><a href="GHC.Core.Coercion.Axiom.html#cab_lhs"><span class="hs-identifier hs-var">cab_lhs</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="local-6989586621683117252"><span class="annot"><span class="annottext">[Type]
</span><a href="#local-6989586621683117252"><span class="hs-identifier hs-var">lhs1</span></a></span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">cab_rhs :: CoAxBranch -&gt; Type
</span><a href="GHC.Core.Coercion.Axiom.html#cab_rhs"><span class="hs-identifier hs-var">cab_rhs</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="local-6989586621683117254"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621683117254"><span class="hs-identifier hs-var">rhs1</span></a></span></span><span> </span><span class="hs-special">}</span><span class="hs-special">)</span><span>
</span><span id="line-1443"></span><span>                     </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Core.Coercion.Axiom.html#CoAxBranch"><span class="hs-identifier hs-type">CoAxBranch</span></a></span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">cab_tvs :: CoAxBranch -&gt; [Id]
</span><a href="GHC.Core.Coercion.Axiom.html#cab_tvs"><span class="hs-identifier hs-var">cab_tvs</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="local-6989586621683117255"><span class="annot"><span class="annottext">[Id]
</span><a href="#local-6989586621683117255"><span class="hs-identifier hs-var">tvs2</span></a></span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">cab_cvs :: CoAxBranch -&gt; [Id]
</span><a href="GHC.Core.Coercion.Axiom.html#cab_cvs"><span class="hs-identifier hs-var">cab_cvs</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="local-6989586621683117256"><span class="annot"><span class="annottext">[Id]
</span><a href="#local-6989586621683117256"><span class="hs-identifier hs-var">cvs2</span></a></span></span><span>
</span><span id="line-1444"></span><span>                                 </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">cab_lhs :: CoAxBranch -&gt; [Type]
</span><a href="GHC.Core.Coercion.Axiom.html#cab_lhs"><span class="hs-identifier hs-var">cab_lhs</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="local-6989586621683117257"><span class="annot"><span class="annottext">[Type]
</span><a href="#local-6989586621683117257"><span class="hs-identifier hs-var">lhs2</span></a></span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">cab_rhs :: CoAxBranch -&gt; Type
</span><a href="GHC.Core.Coercion.Axiom.html#cab_rhs"><span class="hs-identifier hs-var">cab_rhs</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="local-6989586621683117258"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621683117258"><span class="hs-identifier hs-var">rhs2</span></a></span></span><span> </span><span class="hs-special">}</span><span class="hs-special">)</span><span>
</span><span id="line-1445"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span id="local-6989586621683117259"><span class="annot"><span class="annottext">RnEnv2
</span><a href="#local-6989586621683117259"><span class="hs-identifier hs-var">env1</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">HasCallStack =&gt; RnEnv2 -&gt; [Id] -&gt; [Id] -&gt; Maybe RnEnv2
RnEnv2 -&gt; [Id] -&gt; [Id] -&gt; Maybe RnEnv2
</span><a href="GHC.Core.TyCo.Compare.html#eqVarBndrs"><span class="hs-identifier hs-var">eqVarBndrs</span></a></span><span> </span><span class="annot"><span class="annottext">RnEnv2
</span><a href="GHC.Tc.Module.html#emptyRnEnv2"><span class="hs-identifier hs-var">emptyRnEnv2</span></a></span><span> </span><span class="annot"><span class="annottext">[Id]
</span><a href="#local-6989586621683117248"><span class="hs-identifier hs-var">tvs1</span></a></span><span> </span><span class="annot"><span class="annottext">[Id]
</span><a href="#local-6989586621683117255"><span class="hs-identifier hs-var">tvs2</span></a></span><span>
</span><span id="line-1446"></span><span>  </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span id="local-6989586621683117260"><span class="annot"><span class="annottext">RnEnv2
</span><a href="#local-6989586621683117260"><span class="hs-identifier hs-var">env</span></a></span></span><span>  </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">HasCallStack =&gt; RnEnv2 -&gt; [Id] -&gt; [Id] -&gt; Maybe RnEnv2
RnEnv2 -&gt; [Id] -&gt; [Id] -&gt; Maybe RnEnv2
</span><a href="GHC.Core.TyCo.Compare.html#eqVarBndrs"><span class="hs-identifier hs-var">eqVarBndrs</span></a></span><span> </span><span class="annot"><span class="annottext">RnEnv2
</span><a href="#local-6989586621683117259"><span class="hs-identifier hs-var">env1</span></a></span><span>        </span><span class="annot"><span class="annottext">[Id]
</span><a href="#local-6989586621683117250"><span class="hs-identifier hs-var">cvs1</span></a></span><span> </span><span class="annot"><span class="annottext">[Id]
</span><a href="#local-6989586621683117256"><span class="hs-identifier hs-var">cvs2</span></a></span><span>
</span><span id="line-1447"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">Bool
-&gt; BootAxiomBranchMismatch -&gt; BootErrsM BootAxiomBranchMismatch
forall err. Bool -&gt; err -&gt; BootErrsM err
</span><a href="GHC.Tc.Module.html#check"><span class="hs-identifier hs-var">check</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(Type -&gt; Type -&gt; Bool) -&gt; [Type] -&gt; [Type] -&gt; Bool
forall a b. (a -&gt; b -&gt; Bool) -&gt; [a] -&gt; [b] -&gt; Bool
forall (f :: * -&gt; *) a b.
Eq1 f =&gt;
(a -&gt; b -&gt; Bool) -&gt; f a -&gt; f b -&gt; Bool
</span><a href="../../base-4.21.0.0-ae91/src/Data.Functor.Classes.html#liftEq"><span class="hs-identifier hs-var">liftEq</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">HasCallStack =&gt; RnEnv2 -&gt; Type -&gt; Type -&gt; Bool
RnEnv2 -&gt; Type -&gt; Type -&gt; Bool
</span><a href="GHC.Core.TyCo.Compare.html#eqTypeX"><span class="hs-identifier hs-var">eqTypeX</span></a></span><span> </span><span class="annot"><span class="annottext">RnEnv2
</span><a href="#local-6989586621683117260"><span class="hs-identifier hs-var">env</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[Type]
</span><a href="#local-6989586621683117252"><span class="hs-identifier hs-var">lhs1</span></a></span><span> </span><span class="annot"><span class="annottext">[Type]
</span><a href="#local-6989586621683117257"><span class="hs-identifier hs-var">lhs2</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">BootAxiomBranchMismatch
</span><a href="GHC.Tc.Errors.Types.html#MismatchedAxiomLHS"><span class="hs-identifier hs-var">MismatchedAxiomLHS</span></a></span><span>
</span><span id="line-1448"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="annottext">Bool
-&gt; BootAxiomBranchMismatch -&gt; BootErrsM BootAxiomBranchMismatch
forall err. Bool -&gt; err -&gt; BootErrsM err
</span><a href="GHC.Tc.Module.html#check"><span class="hs-identifier hs-var">check</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">HasCallStack =&gt; RnEnv2 -&gt; Type -&gt; Type -&gt; Bool
RnEnv2 -&gt; Type -&gt; Type -&gt; Bool
</span><a href="GHC.Core.TyCo.Compare.html#eqTypeX"><span class="hs-identifier hs-var">eqTypeX</span></a></span><span> </span><span class="annot"><span class="annottext">RnEnv2
</span><a href="#local-6989586621683117260"><span class="hs-identifier hs-var">env</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621683117254"><span class="hs-identifier hs-var">rhs1</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621683117258"><span class="hs-identifier hs-var">rhs2</span></a></span><span class="hs-special">)</span><span>          </span><span class="annot"><span class="annottext">BootAxiomBranchMismatch
</span><a href="GHC.Tc.Errors.Types.html#MismatchedAxiomRHS"><span class="hs-identifier hs-var">MismatchedAxiomRHS</span></a></span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-1449"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">otherwise</span></span><span>
</span><span id="line-1450"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">BootAxiomBranchMismatch -&gt; BootErrsM BootAxiomBranchMismatch
forall err. err -&gt; BootErrsM err
</span><a href="GHC.Tc.Module.html#bootErr"><span class="hs-identifier hs-var">bootErr</span></a></span><span> </span><span class="annot"><span class="annottext">BootAxiomBranchMismatch
</span><a href="GHC.Tc.Errors.Types.html#MismatchedAxiomBinders"><span class="hs-identifier hs-var">MismatchedAxiomBinders</span></a></span><span>
</span><span id="line-1451"></span><span>
</span><span id="line-1452"></span><span class="hs-comment">{- Note [Role subtyping]
~~~~~~~~~~~~~~~~~~~~~~~~
In the current formulation of roles, role subtyping is only OK if the
&quot;abstract&quot; TyCon was not representationally injective.  Among the most
notable examples of non representationally injective TyCons are abstract
data, which can be implemented via newtypes (which are not
representationally injective).  The key example is
in this example from #13140:

     -- In an hsig file
     data T a -- abstract!
     type role T nominal

     -- Elsewhere
     foo :: Coercible (T a) (T b) =&gt; a -&gt; b
     foo x = x

We must NOT allow foo to typecheck, because if we instantiate
T with a concrete data type with a phantom role would cause
Coercible (T a) (T b) to be provable.  Fortunately, if T is not
representationally injective, we cannot make the inference that a ~N b if
T a ~R T b.

Unconditional role subtyping would be possible if we setup
an extra set of roles saying when we can project out coercions
(we call these proj-roles); then it would NOT be valid to instantiate T
with a data type at phantom since the proj-role subtyping check
would fail.  See #13140 for more details.

One consequence of this is we get no role subtyping for non-abstract
data types in signatures. Suppose you have:

     signature A where
         type role T nominal
         data T a = MkT

If you write this, we'll treat T as injective, and make inferences
like T a ~R T b ==&gt; a ~N b (mkSelCo).  But if we can
subsequently replace T with one at phantom role, we would then be able to
infer things like T Int ~R T Bool which is bad news.

We could allow role subtyping here if we didn't treat *any* data types
defined in signatures as injective.  But this would be a bit surprising,
replacing a data type in a module with one in a signature could cause
your code to stop typechecking (whereas if you made the type abstract,
it is more understandable that the type checker knows less).

It would have been best if this was purely a question of defaults
(i.e., a user could explicitly ask for one behavior or another) but
the current role system isn't expressive enough to do this.
Having explicit proj-roles would solve this problem.
-}</span><span>
</span><span id="line-1504"></span><span>
</span><span id="line-1505"></span><span class="annot"><a href="GHC.Tc.Module.html#checkRoles"><span class="hs-identifier hs-type">checkRoles</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Types.SourceFile.html#HsBootOrSig"><span class="hs-identifier hs-type">HsBootOrSig</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Core.TyCon.html#TyCon"><span class="hs-identifier hs-type">TyCon</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="Language.Haskell.Syntax.Basic.html#Role"><span class="hs-identifier hs-type">Role</span></a></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Module.html#BootErrsM"><span class="hs-identifier hs-type">BootErrsM</span></a></span><span> </span><span class="annot"><a href="GHC.Tc.Errors.Types.html#BootTyConMismatch"><span class="hs-identifier hs-type">BootTyConMismatch</span></a></span><span>
</span><span id="line-1506"></span><span id="checkRoles"><span class="annot"><span class="annottext">checkRoles :: HsBootOrSig -&gt; TyCon -&gt; [Role] -&gt; BootErrsM BootTyConMismatch
</span><a href="GHC.Tc.Module.html#checkRoles"><span class="hs-identifier hs-var hs-var">checkRoles</span></a></span></span><span> </span><span id="local-6989586621683117264"><span class="annot"><span class="annottext">HsBootOrSig
</span><a href="#local-6989586621683117264"><span class="hs-identifier hs-var">boot_or_sig</span></a></span></span><span> </span><span id="local-6989586621683117265"><span class="annot"><span class="annottext">TyCon
</span><a href="#local-6989586621683117265"><span class="hs-identifier hs-var">tc1</span></a></span></span><span> </span><span id="local-6989586621683117266"><span class="annot"><span class="annottext">[Role]
</span><a href="#local-6989586621683117266"><span class="hs-identifier hs-var">r2</span></a></span></span><span>
</span><span id="line-1507"></span><span>  </span><span class="hs-glyph">|</span><span>  </span><span class="annot"><span class="annottext">HsBootOrSig
</span><a href="#local-6989586621683117264"><span class="hs-identifier hs-var">boot_or_sig</span></a></span><span> </span><span class="annot"><span class="annottext">HsBootOrSig -&gt; HsBootOrSig -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">==</span></span><span> </span><span class="annot"><span class="annottext">HsBootOrSig
</span><a href="GHC.Types.SourceFile.html#HsBoot"><span class="hs-identifier hs-var">HsBoot</span></a></span><span>
</span><span id="line-1508"></span><span>  </span><span class="annot"><span class="annottext">Bool -&gt; Bool -&gt; Bool
</span><span class="hs-operator hs-var">||</span></span><span> </span><span class="annot"><span class="annottext">TyCon -&gt; Role -&gt; Bool
</span><a href="GHC.Core.TyCon.html#isInjectiveTyCon"><span class="hs-identifier hs-var">isInjectiveTyCon</span></a></span><span> </span><span class="annot"><span class="annottext">TyCon
</span><a href="#local-6989586621683117265"><span class="hs-identifier hs-var">tc1</span></a></span><span> </span><span class="annot"><span class="annottext">Role
</span><a href="Language.Haskell.Syntax.Basic.html#Representational"><span class="hs-identifier hs-var">Representational</span></a></span><span> </span><span class="hs-comment">-- See Note [Role subtyping]</span><span>
</span><span id="line-1509"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Bool -&gt; BootTyConMismatch -&gt; BootErrsM BootTyConMismatch
forall err. Bool -&gt; err -&gt; BootErrsM err
</span><a href="GHC.Tc.Module.html#check"><span class="hs-identifier hs-var">check</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[Role]
</span><a href="#local-6989586621683117270"><span class="hs-identifier hs-var">r1</span></a></span><span> </span><span class="annot"><span class="annottext">[Role] -&gt; [Role] -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">==</span></span><span> </span><span class="annot"><span class="annottext">[Role]
</span><a href="#local-6989586621683117266"><span class="hs-identifier hs-var">r2</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Bool -&gt; BootTyConMismatch
</span><a href="GHC.Tc.Errors.Types.html#TyConRoleMismatch"><span class="hs-identifier hs-var">TyConRoleMismatch</span></a></span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">False</span></span><span class="hs-special">)</span><span>
</span><span id="line-1510"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">otherwise</span></span><span>
</span><span id="line-1511"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Bool -&gt; BootTyConMismatch -&gt; BootErrsM BootTyConMismatch
forall err. Bool -&gt; err -&gt; BootErrsM err
</span><a href="GHC.Tc.Module.html#check"><span class="hs-identifier hs-var">check</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[Role]
</span><a href="#local-6989586621683117266"><span class="hs-identifier hs-var">r2</span></a></span><span> </span><span class="annot"><span class="annottext">[Role] -&gt; [Role] -&gt; Bool
forall {a}. Ord a =&gt; [a] -&gt; [a] -&gt; Bool
</span><a href="#local-6989586621683117272"><span class="hs-operator hs-var">`rolesSubtypeOf`</span></a></span><span> </span><span class="annot"><span class="annottext">[Role]
</span><a href="#local-6989586621683117270"><span class="hs-identifier hs-var">r1</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Bool -&gt; BootTyConMismatch
</span><a href="GHC.Tc.Errors.Types.html#TyConRoleMismatch"><span class="hs-identifier hs-var">TyConRoleMismatch</span></a></span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">True</span></span><span class="hs-special">)</span><span>
</span><span id="line-1512"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-1513"></span><span>
</span><span id="line-1514"></span><span>    </span><span id="local-6989586621683117270"><span class="annot"><span class="annottext">r1 :: [Role]
</span><a href="#local-6989586621683117270"><span class="hs-identifier hs-var hs-var">r1</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">TyCon -&gt; [Role]
</span><a href="GHC.Core.TyCon.html#tyConRoles"><span class="hs-identifier hs-var">tyConRoles</span></a></span><span> </span><span class="annot"><span class="annottext">TyCon
</span><a href="#local-6989586621683117265"><span class="hs-identifier hs-var">tc1</span></a></span><span>
</span><span id="line-1515"></span><span>
</span><span id="line-1516"></span><span>    </span><span id="local-6989586621683117272"><span class="annot"><span class="annottext">rolesSubtypeOf :: [a] -&gt; [a] -&gt; Bool
</span><a href="#local-6989586621683117272"><span class="hs-identifier hs-var hs-var">rolesSubtypeOf</span></a></span></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">True</span></span><span>
</span><span id="line-1517"></span><span>    </span><span class="hs-comment">-- NB: this relation is the OPPOSITE of the subroling relation</span><span>
</span><span id="line-1518"></span><span>    </span><span class="annot"><a href="#local-6989586621683117272"><span class="hs-identifier hs-var">rolesSubtypeOf</span></a></span><span> </span><span class="hs-special">(</span><span id="local-6989586621683117278"><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621683117278"><span class="hs-identifier hs-var">x</span></a></span></span><span class="annot"><span class="hs-glyph hs-type">:</span></span><span id="local-6989586621683117279"><span class="annot"><span class="annottext">[a]
</span><a href="#local-6989586621683117279"><span class="hs-identifier hs-var">xs</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span id="local-6989586621683117280"><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621683117280"><span class="hs-identifier hs-var">y</span></a></span></span><span class="annot"><span class="hs-glyph hs-type">:</span></span><span id="local-6989586621683117281"><span class="annot"><span class="annottext">[a]
</span><a href="#local-6989586621683117281"><span class="hs-identifier hs-var">ys</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621683117278"><span class="hs-identifier hs-var">x</span></a></span><span> </span><span class="annot"><span class="annottext">a -&gt; a -&gt; Bool
forall a. Ord a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">&gt;=</span></span><span> </span><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621683117280"><span class="hs-identifier hs-var">y</span></a></span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Bool -&gt; Bool
</span><span class="hs-operator hs-var">&amp;&amp;</span></span><span> </span><span class="annot"><span class="annottext">[a] -&gt; [a] -&gt; Bool
</span><a href="#local-6989586621683117272"><span class="hs-identifier hs-var">rolesSubtypeOf</span></a></span><span> </span><span class="annot"><span class="annottext">[a]
</span><a href="#local-6989586621683117279"><span class="hs-identifier hs-var">xs</span></a></span><span> </span><span class="annot"><span class="annottext">[a]
</span><a href="#local-6989586621683117281"><span class="hs-identifier hs-var">ys</span></a></span><span>
</span><span id="line-1519"></span><span>    </span><span class="annot"><a href="#local-6989586621683117272"><span class="hs-identifier hs-var">rolesSubtypeOf</span></a></span><span> </span><span class="annot"><span class="annottext">[a]
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">[a]
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">False</span></span><span>
</span><span id="line-1520"></span><span>
</span><span id="line-1521"></span><span class="hs-comment">{- Note [Synonyms implement abstract data]
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
An abstract data type or class can be implemented using a type synonym,
but ONLY if:

  1. T, as a standalone occurrence, is a valid type
     (T is &quot;curryable&quot;), and

  2. T is valid in an instance head.

This gives rise to the following conditions under which we can implement
an abstract data declaration @data T@ using a type synonym @type T tvs = rhs@:

  1. The type synonym T is nullary (tvs is null).

  2. The rhs must not contain any foralls, quantified types, or type family
     applications.
     See 'invalidAbsDataSubTypes' which computes a collection of
     invalid subtypes.

See also 'HowAbstract' and Note [Skolem abstract data].
-}</span><span>
</span><span id="line-1543"></span><span>
</span><span id="line-1544"></span><span class="hs-comment">-- | We are implementing an abstract data declaration of the form @data T@</span><span>
</span><span id="line-1545"></span><span class="hs-comment">-- in a signature file, with a type synonym @type T tvs = rhs@ in the</span><span>
</span><span id="line-1546"></span><span class="hs-comment">-- implementing module.</span><span>
</span><span id="line-1547"></span><span class="hs-comment">--</span><span>
</span><span id="line-1548"></span><span class="hs-comment">-- This function checks that the implementation is valid:</span><span>
</span><span id="line-1549"></span><span class="hs-comment">--</span><span>
</span><span id="line-1550"></span><span class="hs-comment">--  1. the type synonym T is nullary, i.e. tvs is null,</span><span>
</span><span id="line-1551"></span><span class="hs-comment">--  2. rhs doesn't contain any type families, foralls, or qualified types.</span><span>
</span><span id="line-1552"></span><span class="hs-comment">--</span><span>
</span><span id="line-1553"></span><span class="hs-comment">-- See Note [Synonyms implement abstract data]</span><span>
</span><span id="line-1554"></span><span class="annot"><a href="GHC.Tc.Module.html#checkSynAbsData"><span class="hs-identifier hs-type">checkSynAbsData</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Core.TyCon.html#TyCon"><span class="hs-identifier hs-type">TyCon</span></a></span><span>   </span><span class="annot"><span class="hs-comment">-- ^ @tc1@, the abstract data 'TyCon' we are implementing</span></span><span>
</span><span id="line-1555"></span><span>                </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Core.TyCon.html#TyCon"><span class="hs-identifier hs-type">TyCon</span></a></span><span>   </span><span class="hs-comment">-- ^ @tc2@, a type synonym @type T tvs = ty@</span><span>
</span><span id="line-1556"></span><span>                           </span><span class="hs-comment">--   we are using to implement @tc1@</span><span>
</span><span id="line-1557"></span><span>                </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="GHC.Types.Var.html#TyVar"><span class="hs-identifier hs-type">TyVar</span></a></span><span class="hs-special">]</span><span> </span><span class="annot"><span class="hs-comment">-- ^ @tvs@</span></span><span>
</span><span id="line-1558"></span><span>                </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#Type"><span class="hs-identifier hs-type">Type</span></a></span><span>    </span><span class="annot"><span class="hs-comment">-- ^ @ty@</span></span><span>
</span><span id="line-1559"></span><span>                </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Module.html#BootErrsM"><span class="hs-identifier hs-type">BootErrsM</span></a></span><span> </span><span class="annot"><a href="GHC.Tc.Errors.Types.html#BootTyConMismatch"><span class="hs-identifier hs-type">BootTyConMismatch</span></a></span><span>
</span><span id="line-1560"></span><span id="checkSynAbsData"><span class="annot"><span class="annottext">checkSynAbsData :: TyCon -&gt; TyCon -&gt; [Id] -&gt; Type -&gt; BootErrsM BootTyConMismatch
</span><a href="GHC.Tc.Module.html#checkSynAbsData"><span class="hs-identifier hs-var hs-var">checkSynAbsData</span></a></span></span><span> </span><span id="local-6989586621683117282"><span class="annot"><span class="annottext">TyCon
</span><a href="#local-6989586621683117282"><span class="hs-identifier hs-var">tc1</span></a></span></span><span> </span><span id="local-6989586621683117283"><span class="annot"><span class="annottext">TyCon
</span><a href="#local-6989586621683117283"><span class="hs-identifier hs-var">tc2</span></a></span></span><span> </span><span id="local-6989586621683117284"><span class="annot"><span class="annottext">[Id]
</span><a href="#local-6989586621683117284"><span class="hs-identifier hs-var">syn_tvs</span></a></span></span><span> </span><span id="local-6989586621683117285"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621683117285"><span class="hs-identifier hs-var">syn_rhs</span></a></span></span><span>
</span><span id="line-1561"></span><span>  </span><span class="hs-comment">-- We are implementing @data T@ with @type T tvs = rhs@.</span><span>
</span><span id="line-1562"></span><span>  </span><span class="hs-comment">-- Check the conditions of Note [Synonyms implement abstract data].</span><span>
</span><span id="line-1563"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span class="hs-comment">-- (1): T is nullary.</span><span>
</span><span id="line-1564"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="annottext">Bool -&gt; BootTyConMismatch -&gt; BootErrsM BootTyConMismatch
forall err. Bool -&gt; err -&gt; BootErrsM err
</span><a href="GHC.Tc.Module.html#check"><span class="hs-identifier hs-var">check</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[Id] -&gt; Bool
forall a. [a] -&gt; Bool
forall (t :: * -&gt; *) a. Foldable t =&gt; t a -&gt; Bool
</span><span class="hs-identifier hs-var">null</span></span><span> </span><span class="annot"><span class="annottext">[Id]
</span><a href="#local-6989586621683117284"><span class="hs-identifier hs-var">syn_tvs</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(BootTyConMismatch -&gt; BootErrsM BootTyConMismatch)
-&gt; BootTyConMismatch -&gt; BootErrsM BootTyConMismatch
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-1565"></span><span>           </span><span class="annot"><span class="annottext">SynAbstractDataError -&gt; BootTyConMismatch
</span><a href="GHC.Tc.Errors.Types.html#SynAbstractData"><span class="hs-identifier hs-var">SynAbstractData</span></a></span><span> </span><span class="annot"><span class="annottext">SynAbstractDataError
</span><a href="GHC.Tc.Errors.Types.html#SynAbsDataTySynNotNullary"><span class="hs-identifier hs-var">SynAbsDataTySynNotNullary</span></a></span><span>
</span><span id="line-1566"></span><span>         </span><span class="hs-comment">-- (2): the RHS of the type synonym is valid.</span><span>
</span><span id="line-1567"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">Type -&gt; [Type]
</span><a href="GHC.Tc.Module.html#invalidAbsDataSubTypes"><span class="hs-identifier hs-var">invalidAbsDataSubTypes</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621683117285"><span class="hs-identifier hs-var">syn_rhs</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-1568"></span><span>          </span><span class="hs-special">[</span><span class="hs-special">]</span><span>       </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">BootErrsM BootTyConMismatch
forall err. BootErrsM err
</span><a href="GHC.Tc.Module.html#checkSuccess"><span class="hs-identifier hs-var">checkSuccess</span></a></span><span>
</span><span id="line-1569"></span><span>          </span><span id="local-6989586621683117289"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621683117289"><span class="hs-identifier hs-var">err</span></a></span></span><span class="annot"><span class="hs-glyph hs-type">:</span></span><span id="local-6989586621683117290"><span class="annot"><span class="annottext">[Type]
</span><a href="#local-6989586621683117290"><span class="hs-identifier hs-var">errs</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">BootTyConMismatch -&gt; BootErrsM BootTyConMismatch
forall err. err -&gt; BootErrsM err
</span><a href="GHC.Tc.Module.html#bootErr"><span class="hs-identifier hs-var">bootErr</span></a></span><span> </span><span class="annot"><span class="annottext">(BootTyConMismatch -&gt; BootErrsM BootTyConMismatch)
-&gt; BootTyConMismatch -&gt; BootErrsM BootTyConMismatch
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">SynAbstractDataError -&gt; BootTyConMismatch
</span><a href="GHC.Tc.Errors.Types.html#SynAbstractData"><span class="hs-identifier hs-var">SynAbstractData</span></a></span><span> </span><span class="annot"><span class="annottext">(SynAbstractDataError -&gt; BootTyConMismatch)
-&gt; SynAbstractDataError -&gt; BootTyConMismatch
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-1570"></span><span>                      </span><span class="annot"><span class="annottext">NonEmpty Type -&gt; SynAbstractDataError
</span><a href="GHC.Tc.Errors.Types.html#SynAbstractDataInvalidRHS"><span class="hs-identifier hs-var">SynAbstractDataInvalidRHS</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621683117289"><span class="hs-identifier hs-var">err</span></a></span><span> </span><span class="annot"><span class="annottext">Type -&gt; [Type] -&gt; NonEmpty Type
forall a. a -&gt; [a] -&gt; NonEmpty a
</span><span class="hs-operator hs-var">:|</span></span><span> </span><span class="annot"><span class="annottext">[Type]
</span><a href="#local-6989586621683117290"><span class="hs-identifier hs-var">errs</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1571"></span><span>         </span><span class="hs-comment">-- NB: this allows implementing e.g. @data T :: Nat@ with @type T = 3@.</span><span>
</span><span id="line-1572"></span><span>         </span><span class="hs-comment">-- See #15138.</span><span>
</span><span id="line-1573"></span><span>
</span><span id="line-1574"></span><span>  </span><span class="hs-comment">-- TODO: When it's a synonym implementing a class, we really</span><span>
</span><span id="line-1575"></span><span>  </span><span class="hs-comment">-- should check that the fundeps are satisfied, but</span><span>
</span><span id="line-1576"></span><span>  </span><span class="hs-comment">-- there is not an obvious way to do this for a constraint synonym.</span><span>
</span><span id="line-1577"></span><span>  </span><span class="hs-comment">-- So for now, let it all through (it won't cause segfaults, anyway).</span><span>
</span><span id="line-1578"></span><span>  </span><span class="hs-comment">-- Tracked at #12704.</span><span>
</span><span id="line-1579"></span><span>
</span><span id="line-1580"></span><span>         </span><span class="hs-comment">-- ... we also need to check roles.</span><span>
</span><span id="line-1581"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="hs-keyword">if</span><span> </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span class="hs-special">(</span><span id="local-6989586621683117292"><span class="annot"><span class="annottext">TyCon
</span><a href="#local-6989586621683117292"><span class="hs-identifier hs-var">tc2'</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621683117293"><span class="annot"><span class="annottext">[Type]
</span><a href="#local-6989586621683117293"><span class="hs-identifier hs-var">args</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">HasDebugCallStack =&gt; Type -&gt; Maybe (TyCon, [Type])
Type -&gt; Maybe (TyCon, [Type])
</span><a href="GHC.Core.Type.html#tcSplitTyConApp_maybe"><span class="hs-identifier hs-var">tcSplitTyConApp_maybe</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621683117285"><span class="hs-identifier hs-var">syn_rhs</span></a></span><span>
</span><span id="line-1582"></span><span>            </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">[Id] -&gt; Bool
forall a. [a] -&gt; Bool
forall (t :: * -&gt; *) a. Foldable t =&gt; t a -&gt; Bool
</span><span class="hs-identifier hs-var">null</span></span><span> </span><span class="annot"><span class="annottext">[Id]
</span><a href="#local-6989586621683117284"><span class="hs-identifier hs-var">syn_tvs</span></a></span><span> </span><span class="hs-comment">-- Don't report role errors unless the type synonym is nullary</span><span>
</span><span id="line-1583"></span><span>            </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Bool -&gt; BootErrsM BootTyConMismatch -&gt; BootErrsM BootTyConMismatch
forall a. HasCallStack =&gt; Bool -&gt; a -&gt; a
</span><a href="GHC.Utils.Panic.Plain.html#assert"><span class="hs-identifier hs-var">assert</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[Role] -&gt; Bool
forall a. [a] -&gt; Bool
forall (t :: * -&gt; *) a. Foldable t =&gt; t a -&gt; Bool
</span><span class="hs-identifier hs-var">null</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TyCon -&gt; [Role]
</span><a href="GHC.Core.TyCon.html#tyConRoles"><span class="hs-identifier hs-var">tyConRoles</span></a></span><span> </span><span class="annot"><span class="annottext">TyCon
</span><a href="#local-6989586621683117283"><span class="hs-identifier hs-var">tc2</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(BootErrsM BootTyConMismatch -&gt; BootErrsM BootTyConMismatch)
-&gt; BootErrsM BootTyConMismatch -&gt; BootErrsM BootTyConMismatch
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-1584"></span><span>               </span><span class="hs-comment">-- If we have something like:</span><span>
</span><span id="line-1585"></span><span>               </span><span class="hs-comment">--</span><span>
</span><span id="line-1586"></span><span>               </span><span class="hs-comment">--  signature H where</span><span>
</span><span id="line-1587"></span><span>               </span><span class="hs-comment">--      data T a</span><span>
</span><span id="line-1588"></span><span>               </span><span class="hs-comment">--  module H where</span><span>
</span><span id="line-1589"></span><span>               </span><span class="hs-comment">--      data K a b = ...</span><span>
</span><span id="line-1590"></span><span>               </span><span class="hs-comment">--      type T = K Int</span><span>
</span><span id="line-1591"></span><span>               </span><span class="hs-comment">--</span><span>
</span><span id="line-1592"></span><span>               </span><span class="hs-comment">-- we need to drop the first role of K when comparing!</span><span>
</span><span id="line-1593"></span><span>               </span><span class="annot"><span class="annottext">HsBootOrSig -&gt; TyCon -&gt; [Role] -&gt; BootErrsM BootTyConMismatch
</span><a href="GHC.Tc.Module.html#checkRoles"><span class="hs-identifier hs-var">checkRoles</span></a></span><span> </span><span class="annot"><span class="annottext">HsBootOrSig
</span><a href="GHC.Types.SourceFile.html#Hsig"><span class="hs-identifier hs-var">Hsig</span></a></span><span> </span><span class="annot"><span class="annottext">TyCon
</span><a href="#local-6989586621683117282"><span class="hs-identifier hs-var">tc1</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Arity -&gt; [Role] -&gt; [Role]
forall a. Arity -&gt; [a] -&gt; [a]
</span><span class="hs-identifier hs-var">drop</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[Type] -&gt; Arity
forall a. [a] -&gt; Arity
forall (t :: * -&gt; *) a. Foldable t =&gt; t a -&gt; Arity
</span><span class="hs-identifier hs-var">length</span></span><span> </span><span class="annot"><span class="annottext">[Type]
</span><a href="#local-6989586621683117293"><span class="hs-identifier hs-var">args</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TyCon -&gt; [Role]
</span><a href="GHC.Core.TyCon.html#tyConRoles"><span class="hs-identifier hs-var">tyConRoles</span></a></span><span> </span><span class="annot"><span class="annottext">TyCon
</span><a href="#local-6989586621683117292"><span class="hs-identifier hs-var">tc2'</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-1594"></span><span>            </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">otherwise</span></span><span>
</span><span id="line-1595"></span><span>            </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">BootErrsM BootTyConMismatch
forall err. BootErrsM err
</span><a href="GHC.Tc.Module.html#checkSuccess"><span class="hs-identifier hs-var">checkSuccess</span></a></span><span>
</span><span id="line-1596"></span><span>       </span><span class="hs-special">}</span><span>
</span><span id="line-1597"></span><span>
</span><span id="line-1598"></span><span class="hs-comment">{-
    -- Hypothetically, if we were allow to non-nullary type synonyms, here
    -- is how you would check the roles
    if length tvs == length roles1
    then checkRoles roles1 roles2
    else case tcSplitTyConApp_maybe ty of
            Just (tc2', args) -&gt;
                checkRoles Hsig tc1 (drop (length args) (tyConRoles tc2') ++ roles2)
            Nothing -&gt; Just roles_msg
-}</span><span>
</span><span id="line-1608"></span><span>
</span><span id="line-1609"></span><span class="hs-comment">-- | Is this type a valid implementation of abstract data?</span><span>
</span><span id="line-1610"></span><span class="hs-comment">--</span><span>
</span><span id="line-1611"></span><span class="hs-comment">-- Returns a list of invalid sub-types encountered.</span><span>
</span><span id="line-1612"></span><span class="annot"><a href="GHC.Tc.Module.html#invalidAbsDataSubTypes"><span class="hs-identifier hs-type">invalidAbsDataSubTypes</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#Type"><span class="hs-identifier hs-type">Type</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#Type"><span class="hs-identifier hs-type">Type</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-1613"></span><span id="invalidAbsDataSubTypes"><span class="annot"><span class="annottext">invalidAbsDataSubTypes :: Type -&gt; [Type]
</span><a href="GHC.Tc.Module.html#invalidAbsDataSubTypes"><span class="hs-identifier hs-var hs-var">invalidAbsDataSubTypes</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Writer [Type] () -&gt; [Type]
forall w a. Monoid w =&gt; Writer w a -&gt; w
</span><a href="../../transformers-0.6.1.2-38b1/src/Control.Monad.Trans.Writer.CPS.html#execWriter"><span class="hs-identifier hs-var">execWriter</span></a></span><span> </span><span class="annot"><span class="annottext">(Writer [Type] () -&gt; [Type])
-&gt; (Type -&gt; Writer [Type] ()) -&gt; Type -&gt; [Type]
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">Type -&gt; Writer [Type] ()
</span><a href="#local-6989586621683117297"><span class="hs-identifier hs-var">go</span></a></span><span>
</span><span id="line-1614"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-1615"></span><span>    </span><span class="annot"><a href="#local-6989586621683117297"><span class="hs-identifier hs-type">go</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#Type"><span class="hs-identifier hs-type">Type</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="../../transformers-0.6.1.2-38b1/src/Control.Monad.Trans.Writer.CPS.html#Writer"><span class="hs-identifier hs-type">Writer</span></a></span><span> </span><span class="hs-special">[</span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#Type"><span class="hs-identifier hs-type">Type</span></a></span><span class="hs-special">]</span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-1616"></span><span>    </span><span id="local-6989586621683117297"><span class="annot"><span class="annottext">go :: Type -&gt; Writer [Type] ()
</span><a href="#local-6989586621683117297"><span class="hs-identifier hs-var hs-var">go</span></a></span></span><span> </span><span id="local-6989586621683117298"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621683117298"><span class="hs-identifier hs-var">ty</span></a></span></span><span>
</span><span id="line-1617"></span><span>      </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span id="local-6989586621683117299"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621683117299"><span class="hs-identifier hs-var">ty'</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Type -&gt; Maybe Type
</span><a href="GHC.Core.Type.html#coreView"><span class="hs-identifier hs-var">coreView</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621683117298"><span class="hs-identifier hs-var">ty</span></a></span><span>
</span><span id="line-1618"></span><span>      </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Type -&gt; Writer [Type] ()
</span><a href="#local-6989586621683117297"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621683117299"><span class="hs-identifier hs-var">ty'</span></a></span><span>
</span><span id="line-1619"></span><span>    </span><span class="annot"><a href="#local-6989586621683117297"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#TyVarTy"><span class="hs-identifier hs-type">TyVarTy</span></a></span><span class="hs-special">{</span><span class="hs-special">}</span><span>
</span><span id="line-1620"></span><span>      </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Writer [Type] ()
</span><a href="#local-6989586621683117302"><span class="hs-identifier hs-var">ok</span></a></span><span> </span><span class="hs-comment">-- We report an error at the binding site of type variables,</span><span>
</span><span id="line-1621"></span><span>           </span><span class="hs-comment">-- e.g. in the TySyn LHS or in the forall.</span><span>
</span><span id="line-1622"></span><span>           </span><span class="hs-comment">-- It's not useful to report a second error for their occurrences</span><span>
</span><span id="line-1623"></span><span>    </span><span class="annot"><a href="#local-6989586621683117297"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#AppTy"><span class="hs-identifier hs-type">AppTy</span></a></span><span> </span><span id="local-6989586621683117304"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621683117304"><span class="hs-identifier hs-var">t1</span></a></span></span><span> </span><span id="local-6989586621683117305"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621683117305"><span class="hs-identifier hs-var">t2</span></a></span></span><span class="hs-special">)</span><span>
</span><span id="line-1624"></span><span>      </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">Type -&gt; Writer [Type] ()
</span><a href="#local-6989586621683117297"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621683117304"><span class="hs-identifier hs-var">t1</span></a></span><span class="hs-special">;</span><span> </span><span class="annot"><span class="annottext">Type -&gt; Writer [Type] ()
</span><a href="#local-6989586621683117297"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621683117305"><span class="hs-identifier hs-var">t2</span></a></span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-1625"></span><span>    </span><span class="annot"><a href="#local-6989586621683117297"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span id="local-6989586621683117306"><span class="annot"><span class="annottext">ty :: Type
</span><a href="#local-6989586621683117306"><span class="hs-identifier hs-var">ty</span></a></span></span><span class="hs-glyph">@</span><span class="hs-special">(</span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#TyConApp"><span class="hs-identifier hs-type">TyConApp</span></a></span><span> </span><span id="local-6989586621683117308"><span class="annot"><span class="annottext">TyCon
</span><a href="#local-6989586621683117308"><span class="hs-identifier hs-var">tc</span></a></span></span><span> </span><span id="local-6989586621683117309"><span class="annot"><span class="annottext">[Type]
</span><a href="#local-6989586621683117309"><span class="hs-identifier hs-var">tys</span></a></span></span><span class="hs-special">)</span><span>
</span><span id="line-1626"></span><span>      </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">TyCon -&gt; Bool
</span><a href="GHC.Core.TyCon.html#isTypeFamilyTyCon"><span class="hs-identifier hs-var">isTypeFamilyTyCon</span></a></span><span> </span><span class="annot"><span class="annottext">TyCon
</span><a href="#local-6989586621683117308"><span class="hs-identifier hs-var">tc</span></a></span><span>
</span><span id="line-1627"></span><span>      </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Type -&gt; Writer [Type] ()
forall {m :: * -&gt; *} {a}. Monad m =&gt; a -&gt; WriterT [a] m ()
</span><a href="#local-6989586621683117311"><span class="hs-identifier hs-var">invalid</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621683117306"><span class="hs-identifier hs-var">ty</span></a></span><span>
</span><span id="line-1628"></span><span>      </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">otherwise</span></span><span>
</span><span id="line-1629"></span><span>      </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(Type -&gt; Writer [Type] ()) -&gt; [Type] -&gt; Writer [Type] ()
forall (t :: * -&gt; *) (m :: * -&gt; *) a b.
(Foldable t, Monad m) =&gt;
(a -&gt; m b) -&gt; t a -&gt; m ()
</span><span class="hs-identifier hs-var">mapM_</span></span><span> </span><span class="annot"><span class="annottext">Type -&gt; Writer [Type] ()
</span><a href="#local-6989586621683117297"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="annot"><span class="annottext">[Type]
</span><a href="#local-6989586621683117309"><span class="hs-identifier hs-var">tys</span></a></span><span>
</span><span id="line-1630"></span><span>    </span><span class="annot"><a href="#local-6989586621683117297"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span id="local-6989586621683117312"><span class="annot"><span class="annottext">ty :: Type
</span><a href="#local-6989586621683117312"><span class="hs-identifier hs-var">ty</span></a></span></span><span class="hs-glyph">@</span><span class="hs-special">(</span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#ForAllTy"><span class="hs-identifier hs-type">ForAllTy</span></a></span><span class="hs-special">{</span><span class="hs-special">}</span><span class="hs-special">)</span><span>
</span><span id="line-1631"></span><span>      </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Type -&gt; Writer [Type] ()
forall {m :: * -&gt; *} {a}. Monad m =&gt; a -&gt; WriterT [a] m ()
</span><a href="#local-6989586621683117311"><span class="hs-identifier hs-var">invalid</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621683117312"><span class="hs-identifier hs-var">ty</span></a></span><span>
</span><span id="line-1632"></span><span>    </span><span class="annot"><a href="#local-6989586621683117297"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span id="local-6989586621683117314"><span class="annot"><span class="annottext">ty :: Type
</span><a href="#local-6989586621683117314"><span class="hs-identifier hs-var">ty</span></a></span></span><span class="hs-glyph">@</span><span class="hs-special">(</span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#FunTy"><span class="hs-identifier hs-type">FunTy</span></a></span><span> </span><span id="local-6989586621683117316"><span class="annot"><span class="annottext">FunTyFlag
</span><a href="#local-6989586621683117316"><span class="hs-identifier hs-var">af</span></a></span></span><span> </span><span id="local-6989586621683117317"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621683117317"><span class="hs-identifier hs-var">w</span></a></span></span><span> </span><span id="local-6989586621683117318"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621683117318"><span class="hs-identifier hs-var">t1</span></a></span></span><span> </span><span id="local-6989586621683117319"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621683117319"><span class="hs-identifier hs-var">t2</span></a></span></span><span class="hs-special">)</span><span>
</span><span id="line-1633"></span><span>      </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">FunTyFlag
</span><a href="#local-6989586621683117316"><span class="hs-identifier hs-var">af</span></a></span><span> </span><span class="annot"><span class="annottext">FunTyFlag -&gt; FunTyFlag -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">==</span></span><span> </span><span class="annot"><span class="annottext">FunTyFlag
</span><a href="GHC.Types.Var.html#FTF_T_T"><span class="hs-identifier hs-var">FTF_T_T</span></a></span><span>
</span><span id="line-1634"></span><span>      </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">Type -&gt; Writer [Type] ()
</span><a href="#local-6989586621683117297"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621683117317"><span class="hs-identifier hs-var">w</span></a></span><span>
</span><span id="line-1635"></span><span>           </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="annottext">Type -&gt; Writer [Type] ()
</span><a href="#local-6989586621683117297"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">HasDebugCallStack =&gt; Type -&gt; Type
Type -&gt; Type
</span><a href="GHC.Core.Type.html#typeKind"><span class="hs-identifier hs-var">typeKind</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621683117318"><span class="hs-identifier hs-var">t1</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="annottext">Type -&gt; Writer [Type] ()
</span><a href="#local-6989586621683117297"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621683117318"><span class="hs-identifier hs-var">t1</span></a></span><span>
</span><span id="line-1636"></span><span>           </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="annottext">Type -&gt; Writer [Type] ()
</span><a href="#local-6989586621683117297"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">HasDebugCallStack =&gt; Type -&gt; Type
Type -&gt; Type
</span><a href="GHC.Core.Type.html#typeKind"><span class="hs-identifier hs-var">typeKind</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621683117319"><span class="hs-identifier hs-var">t2</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="annottext">Type -&gt; Writer [Type] ()
</span><a href="#local-6989586621683117297"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621683117319"><span class="hs-identifier hs-var">t2</span></a></span><span>
</span><span id="line-1637"></span><span>           </span><span class="hs-special">}</span><span>
</span><span id="line-1638"></span><span>      </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">otherwise</span></span><span>
</span><span id="line-1639"></span><span>      </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Type -&gt; Writer [Type] ()
forall {m :: * -&gt; *} {a}. Monad m =&gt; a -&gt; WriterT [a] m ()
</span><a href="#local-6989586621683117311"><span class="hs-identifier hs-var">invalid</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621683117314"><span class="hs-identifier hs-var">ty</span></a></span><span>
</span><span id="line-1640"></span><span>    </span><span class="annot"><a href="#local-6989586621683117297"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#LitTy"><span class="hs-identifier hs-type">LitTy</span></a></span><span class="hs-special">{</span><span class="hs-special">}</span><span>
</span><span id="line-1641"></span><span>      </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Writer [Type] ()
</span><a href="#local-6989586621683117302"><span class="hs-identifier hs-var">ok</span></a></span><span>
</span><span id="line-1642"></span><span>    </span><span class="annot"><a href="#local-6989586621683117297"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span id="local-6989586621683117323"><span class="annot"><span class="annottext">ty :: Type
</span><a href="#local-6989586621683117323"><span class="hs-identifier hs-var">ty</span></a></span></span><span class="hs-glyph">@</span><span class="hs-special">(</span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#CastTy"><span class="hs-identifier hs-type">CastTy</span></a></span><span class="hs-special">{</span><span class="hs-special">}</span><span class="hs-special">)</span><span>
</span><span id="line-1643"></span><span>      </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Type -&gt; Writer [Type] ()
forall {m :: * -&gt; *} {a}. Monad m =&gt; a -&gt; WriterT [a] m ()
</span><a href="#local-6989586621683117311"><span class="hs-identifier hs-var">invalid</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621683117323"><span class="hs-identifier hs-var">ty</span></a></span><span>
</span><span id="line-1644"></span><span>    </span><span class="annot"><a href="#local-6989586621683117297"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span id="local-6989586621683117325"><span class="annot"><span class="annottext">ty :: Type
</span><a href="#local-6989586621683117325"><span class="hs-identifier hs-var">ty</span></a></span></span><span class="hs-glyph">@</span><span class="hs-special">(</span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#CoercionTy"><span class="hs-identifier hs-type">CoercionTy</span></a></span><span class="hs-special">{</span><span class="hs-special">}</span><span class="hs-special">)</span><span>
</span><span id="line-1645"></span><span>      </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Type -&gt; Writer [Type] ()
forall {m :: * -&gt; *} {a}. Monad m =&gt; a -&gt; WriterT [a] m ()
</span><a href="#local-6989586621683117311"><span class="hs-identifier hs-var">invalid</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621683117325"><span class="hs-identifier hs-var">ty</span></a></span><span>
</span><span id="line-1646"></span><span>
</span><span id="line-1647"></span><span>    </span><span id="local-6989586621683117302"><span class="annot"><span class="annottext">ok :: Writer [Type] ()
</span><a href="#local-6989586621683117302"><span class="hs-identifier hs-var hs-var">ok</span></a></span></span><span>         </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">() -&gt; Writer [Type] ()
forall a. a -&gt; WriterT [Type] Identity a
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">pure</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-1648"></span><span>    </span><span id="local-6989586621683117311"><span class="annot"><span class="annottext">invalid :: a -&gt; WriterT [a] m ()
</span><a href="#local-6989586621683117311"><span class="hs-identifier hs-var hs-var">invalid</span></a></span></span><span> </span><span id="local-6989586621683117339"><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621683117339"><span class="hs-identifier hs-var">ty</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[a] -&gt; WriterT [a] m ()
forall w (m :: * -&gt; *). (Monoid w, Monad m) =&gt; w -&gt; WriterT w m ()
</span><a href="../../transformers-0.6.1.2-38b1/src/Control.Monad.Trans.Writer.CPS.html#tell"><span class="hs-identifier hs-var">tell</span></a></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621683117339"><span class="hs-identifier hs-var">ty</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-1649"></span><span>
</span><span id="line-1650"></span><span class="hs-comment">{-
************************************************************************
*                                                                      *
        Type-checking the top level of a module (continued)
*                                                                      *
************************************************************************
-}</span><span>
</span><span id="line-1657"></span><span>
</span><span id="line-1658"></span><span class="annot"><a href="GHC.Tc.Module.html#rnTopSrcDecls"><span class="hs-identifier hs-type">rnTopSrcDecls</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Language.Haskell.Syntax.Decls.html#HsGroup"><span class="hs-identifier hs-type">HsGroup</span></a></span><span> </span><span class="annot"><a href="GHC.Hs.Extension.html#GhcPs"><span class="hs-identifier hs-type">GhcPs</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#TcM"><span class="hs-identifier hs-type">TcM</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Tc.Types.html#TcGblEnv"><span class="hs-identifier hs-type">TcGblEnv</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Language.Haskell.Syntax.Decls.html#HsGroup"><span class="hs-identifier hs-type">HsGroup</span></a></span><span> </span><span class="annot"><a href="GHC.Hs.Extension.html#GhcRn"><span class="hs-identifier hs-type">GhcRn</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1659"></span><span class="hs-comment">-- Fails if there are any errors</span><span>
</span><span id="line-1660"></span><span id="rnTopSrcDecls"><span class="annot"><span class="annottext">rnTopSrcDecls :: HsGroup GhcPs -&gt; TcM (TcGblEnv, HsGroup (GhcPass 'Renamed))
</span><a href="GHC.Tc.Module.html#rnTopSrcDecls"><span class="hs-identifier hs-var hs-var">rnTopSrcDecls</span></a></span></span><span> </span><span id="local-6989586621683117341"><span class="annot"><span class="annottext">HsGroup GhcPs
</span><a href="#local-6989586621683117341"><span class="hs-identifier hs-var">group</span></a></span></span><span>
</span><span id="line-1661"></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span class="hs-comment">-- Rename the source decls</span><span>
</span><span id="line-1662"></span><span>        </span><span class="annot"><span class="annottext">String -&gt; SDoc -&gt; IOEnv (Env TcGblEnv TcLclEnv) ()
</span><a href="GHC.Tc.Utils.Monad.html#traceRn"><span class="hs-identifier hs-var">traceRn</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;rn12&quot;</span></span><span> </span><span class="annot"><span class="annottext">SDoc
forall doc. IsOutput doc =&gt; doc
</span><a href="GHC.Utils.Outputable.html#empty"><span class="hs-identifier hs-var">empty</span></a></span><span> </span><span class="hs-special">;</span><span>
</span><span id="line-1663"></span><span>        </span><span class="hs-special">(</span><span id="local-6989586621683117342"><span class="annot"><a href="#local-6989586621683117342"><span class="hs-identifier hs-var">tcg_env</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621683117343"><span class="annot"><a href="#local-6989586621683117343"><span class="hs-identifier hs-var">rn_decls</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">TcM (TcGblEnv, HsGroup (GhcPass 'Renamed))
-&gt; TcM (TcGblEnv, HsGroup (GhcPass 'Renamed))
forall r. TcM r -&gt; TcM r
</span><a href="GHC.Tc.Utils.Monad.html#checkNoErrs"><span class="hs-identifier hs-var">checkNoErrs</span></a></span><span> </span><span class="annot"><span class="annottext">(TcM (TcGblEnv, HsGroup (GhcPass 'Renamed))
 -&gt; TcM (TcGblEnv, HsGroup (GhcPass 'Renamed)))
-&gt; TcM (TcGblEnv, HsGroup (GhcPass 'Renamed))
-&gt; TcM (TcGblEnv, HsGroup (GhcPass 'Renamed))
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">HsGroup GhcPs -&gt; TcM (TcGblEnv, HsGroup (GhcPass 'Renamed))
</span><a href="GHC.Rename.Module.html#rnSrcDecls"><span class="hs-identifier hs-var">rnSrcDecls</span></a></span><span> </span><span class="annot"><span class="annottext">HsGroup GhcPs
</span><a href="#local-6989586621683117341"><span class="hs-identifier hs-var">group</span></a></span><span> </span><span class="hs-special">;</span><span>
</span><span id="line-1664"></span><span>        </span><span class="annot"><a href="GHC.Tc.Utils.Monad.html#traceRn"><span class="hs-identifier hs-type">traceRn</span></a></span><span> </span><span class="annot"><span class="hs-string">&quot;rn13&quot;</span></span><span> </span><span class="annot"><a href="GHC.Utils.Outputable.html#empty"><span class="hs-identifier hs-type">empty</span></a></span><span> </span><span class="hs-special">;</span><span>
</span><span id="line-1665"></span><span>        </span><span class="hs-special">(</span><span id="local-6989586621683117346"><span class="annot"><a href="#local-6989586621683117346"><span class="hs-identifier hs-var">tcg_env</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621683117347"><span class="annot"><a href="#local-6989586621683117347"><span class="hs-identifier hs-var">rn_decls</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><a href="GHC.Tc.Module.html#runRenamerPlugin"><span class="hs-identifier hs-type">runRenamerPlugin</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683117342"><span class="hs-identifier hs-type">tcg_env</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683117343"><span class="hs-identifier hs-type">rn_decls</span></a></span><span> </span><span class="hs-special">;</span><span>
</span><span id="line-1666"></span><span>        </span><span class="annot"><a href="GHC.Tc.Utils.Monad.html#traceRn"><span class="hs-identifier hs-type">traceRn</span></a></span><span> </span><span class="annot"><span class="hs-string">&quot;rn13-plugin&quot;</span></span><span> </span><span class="annot"><a href="GHC.Utils.Outputable.html#empty"><span class="hs-identifier hs-type">empty</span></a></span><span> </span><span class="hs-special">;</span><span>
</span><span id="line-1667"></span><span>
</span><span id="line-1668"></span><span>        </span><span class="hs-comment">-- save the renamed syntax, if we want it</span><span>
</span><span id="line-1669"></span><span>        </span><span class="hs-keyword">let</span><span> </span><span class="hs-special">{</span><span> </span><span id="local-6989586621683117349"><span class="annot"><a href="#local-6989586621683117349"><span class="hs-identifier hs-var hs-var">tcg_env'</span></a></span></span><span>
</span><span id="line-1670"></span><span>                </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span id="local-6989586621683117350"><span class="annot"><span class="annottext">HsGroup (GhcPass 'Renamed)
</span><a href="#local-6989586621683117350"><span class="hs-identifier hs-var">grp</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">TcGblEnv -&gt; Maybe (HsGroup (GhcPass 'Renamed))
</span><a href="GHC.Tc.Types.html#tcg_rn_decls"><span class="hs-identifier hs-var">tcg_rn_decls</span></a></span><span> </span><span class="annot"><span class="annottext">TcGblEnv
</span><a href="#local-6989586621683117346"><span class="hs-identifier hs-var">tcg_env</span></a></span><span>
</span><span id="line-1671"></span><span>                  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">TcGblEnv
</span><a href="#local-6989586621683117346"><span class="hs-identifier hs-var">tcg_env</span></a></span><span class="hs-special">{</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#tcg_rn_decls"><span class="hs-identifier hs-var">tcg_rn_decls</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Hs.Decls.html#appendGroups"><span class="hs-identifier hs-type">appendGroups</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683117350"><span class="hs-identifier hs-type">grp</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683117347"><span class="hs-identifier hs-type">rn_decls</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-1672"></span><span>                </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">otherwise</span></span><span>
</span><span id="line-1673"></span><span>                   </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">TcGblEnv
</span><a href="#local-6989586621683117346"><span class="hs-identifier hs-var">tcg_env</span></a></span><span> </span><span class="hs-special">}</span><span class="hs-special">;</span><span>
</span><span id="line-1674"></span><span>
</span><span id="line-1675"></span><span>                </span><span class="hs-comment">-- Dump trace of renaming part</span><span>
</span><span id="line-1676"></span><span>        </span><span class="annot"><a href="GHC.Tc.Module.html#rnDump"><span class="hs-identifier hs-type">rnDump</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683117347"><span class="hs-identifier hs-type">rn_decls</span></a></span><span> </span><span class="hs-special">;</span><span>
</span><span id="line-1677"></span><span>        </span><span class="annot"><span class="hs-identifier hs-type">return</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621683117349"><span class="hs-identifier hs-type">tcg_env'</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="#local-6989586621683117347"><span class="hs-identifier hs-type">rn_decls</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1678"></span><span>   </span><span class="hs-special">}</span><span>
</span><span id="line-1679"></span><span>
</span><span id="line-1680"></span><span class="annot"><a href="GHC.Tc.Module.html#tcTopSrcDecls"><span class="hs-identifier hs-type">tcTopSrcDecls</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Language.Haskell.Syntax.Decls.html#HsGroup"><span class="hs-identifier hs-type">HsGroup</span></a></span><span> </span><span class="annot"><a href="GHC.Hs.Extension.html#GhcRn"><span class="hs-identifier hs-type">GhcRn</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#TcM"><span class="hs-identifier hs-type">TcM</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Tc.Types.html#TcGblEnv"><span class="hs-identifier hs-type">TcGblEnv</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Tc.Types.LclEnv.html#TcLclEnv"><span class="hs-identifier hs-type">TcLclEnv</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1681"></span><span id="tcTopSrcDecls"><span class="annot"><span class="annottext">tcTopSrcDecls :: HsGroup (GhcPass 'Renamed)
-&gt; TcRnIf TcGblEnv TcLclEnv (TcGblEnv, TcLclEnv)
</span><a href="GHC.Tc.Module.html#tcTopSrcDecls"><span class="hs-identifier hs-var hs-var">tcTopSrcDecls</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Language.Haskell.Syntax.Decls.html#HsGroup"><span class="hs-identifier hs-type">HsGroup</span></a></span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">hs_tyclds :: forall p. HsGroup p -&gt; [TyClGroup p]
</span><a href="Language.Haskell.Syntax.Decls.html#hs_tyclds"><span class="hs-identifier hs-var">hs_tyclds</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="local-6989586621683117353"><span class="annot"><span class="annottext">[TyClGroup (GhcPass 'Renamed)]
</span><a href="#local-6989586621683117353"><span class="hs-identifier hs-var">tycl_decls</span></a></span></span><span class="hs-special">,</span><span>
</span><span id="line-1682"></span><span>                         </span><span class="annot"><span class="annottext">hs_derivds :: forall p. HsGroup p -&gt; [LDerivDecl p]
</span><a href="Language.Haskell.Syntax.Decls.html#hs_derivds"><span class="hs-identifier hs-var">hs_derivds</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="local-6989586621683117354"><span class="annot"><span class="annottext">[LDerivDecl (GhcPass 'Renamed)]
</span><a href="#local-6989586621683117354"><span class="hs-identifier hs-var">deriv_decls</span></a></span></span><span class="hs-special">,</span><span>
</span><span id="line-1683"></span><span>                         </span><span class="annot"><span class="annottext">hs_fords :: forall p. HsGroup p -&gt; [LForeignDecl p]
</span><a href="Language.Haskell.Syntax.Decls.html#hs_fords"><span class="hs-identifier hs-var">hs_fords</span></a></span><span>  </span><span class="hs-glyph">=</span><span> </span><span id="local-6989586621683117355"><span class="annot"><span class="annottext">[LForeignDecl (GhcPass 'Renamed)]
</span><a href="#local-6989586621683117355"><span class="hs-identifier hs-var">foreign_decls</span></a></span></span><span class="hs-special">,</span><span>
</span><span id="line-1684"></span><span>                         </span><span class="annot"><span class="annottext">hs_defds :: forall p. HsGroup p -&gt; [LDefaultDecl p]
</span><a href="Language.Haskell.Syntax.Decls.html#hs_defds"><span class="hs-identifier hs-var">hs_defds</span></a></span><span>  </span><span class="hs-glyph">=</span><span> </span><span id="local-6989586621683117356"><span class="annot"><span class="annottext">[LDefaultDecl (GhcPass 'Renamed)]
</span><a href="#local-6989586621683117356"><span class="hs-identifier hs-var">default_decls</span></a></span></span><span class="hs-special">,</span><span>
</span><span id="line-1685"></span><span>                         </span><span class="annot"><span class="annottext">hs_annds :: forall p. HsGroup p -&gt; [LAnnDecl p]
</span><a href="Language.Haskell.Syntax.Decls.html#hs_annds"><span class="hs-identifier hs-var">hs_annds</span></a></span><span>  </span><span class="hs-glyph">=</span><span> </span><span id="local-6989586621683117357"><span class="annot"><span class="annottext">[LAnnDecl (GhcPass 'Renamed)]
</span><a href="#local-6989586621683117357"><span class="hs-identifier hs-var">annotation_decls</span></a></span></span><span class="hs-special">,</span><span>
</span><span id="line-1686"></span><span>                         </span><span class="annot"><span class="annottext">hs_ruleds :: forall p. HsGroup p -&gt; [LRuleDecls p]
</span><a href="Language.Haskell.Syntax.Decls.html#hs_ruleds"><span class="hs-identifier hs-var">hs_ruleds</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="local-6989586621683117358"><span class="annot"><span class="annottext">[LRuleDecls (GhcPass 'Renamed)]
</span><a href="#local-6989586621683117358"><span class="hs-identifier hs-var">rule_decls</span></a></span></span><span class="hs-special">,</span><span>
</span><span id="line-1687"></span><span>                         </span><span class="annot"><span class="annottext">hs_valds :: forall p. HsGroup p -&gt; HsValBinds p
</span><a href="Language.Haskell.Syntax.Decls.html#hs_valds"><span class="hs-identifier hs-var">hs_valds</span></a></span><span>  </span><span class="hs-glyph">=</span><span> </span><span id="local-6989586621683117359"><span class="annot"><span class="annottext">hs_val_binds :: HsValBindsLR (GhcPass 'Renamed) (GhcPass 'Renamed)
</span><a href="#local-6989586621683117359"><span class="hs-identifier hs-var">hs_val_binds</span></a></span></span><span class="hs-glyph">@</span><span class="hs-special">(</span><span class="annot"><a href="Language.Haskell.Syntax.Binds.html#XValBindsLR"><span class="hs-identifier hs-type">XValBindsLR</span></a></span><span>
</span><span id="line-1688"></span><span>                                              </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Hs.Binds.html#NValBinds"><span class="hs-identifier hs-type">NValBinds</span></a></span><span> </span><span id="local-6989586621683117360"><span class="annot"><span class="annottext">[(RecFlag, LHsBinds (GhcPass 'Renamed))]
</span><a href="#local-6989586621683117360"><span class="hs-identifier hs-var">val_binds</span></a></span></span><span> </span><span id="local-6989586621683117361"><span class="annot"><span class="annottext">[LSig (GhcPass 'Renamed)]
</span><a href="#local-6989586621683117361"><span class="hs-identifier hs-var">val_sigs</span></a></span></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span class="hs-special">)</span><span>
</span><span id="line-1689"></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span>         </span><span class="hs-comment">-- Type-check the type and class decls, and all imported decls</span><span>
</span><span id="line-1690"></span><span>                </span><span class="hs-comment">-- The latter come in via tycl_decls</span><span>
</span><span id="line-1691"></span><span>        </span><span class="annot"><span class="annottext">String -&gt; SDoc -&gt; IOEnv (Env TcGblEnv TcLclEnv) ()
</span><a href="GHC.Tc.Utils.Monad.html#traceTc"><span class="hs-identifier hs-var">traceTc</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;Tc2 (src)&quot;</span></span><span> </span><span class="annot"><span class="annottext">SDoc
forall doc. IsOutput doc =&gt; doc
</span><a href="GHC.Utils.Outputable.html#empty"><span class="hs-identifier hs-var">empty</span></a></span><span> </span><span class="hs-special">;</span><span>
</span><span id="line-1692"></span><span>
</span><span id="line-1693"></span><span>                </span><span class="hs-comment">-- Source-language instances, including derivings,</span><span>
</span><span id="line-1694"></span><span>                </span><span class="hs-comment">-- and import the supporting declarations</span><span>
</span><span id="line-1695"></span><span>        </span><span class="annot"><span class="annottext">String -&gt; SDoc -&gt; IOEnv (Env TcGblEnv TcLclEnv) ()
</span><a href="GHC.Tc.Utils.Monad.html#traceTc"><span class="hs-identifier hs-var">traceTc</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;Tc3&quot;</span></span><span> </span><span class="annot"><span class="annottext">SDoc
forall doc. IsOutput doc =&gt; doc
</span><a href="GHC.Utils.Outputable.html#empty"><span class="hs-identifier hs-var">empty</span></a></span><span> </span><span class="hs-special">;</span><span>
</span><span id="line-1696"></span><span>        </span><span class="hs-special">(</span><span id="local-6989586621683117362"><span class="annot"><a href="#local-6989586621683117362"><span class="hs-identifier hs-var">tcg_env</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621683117363"><span class="annot"><a href="#local-6989586621683117363"><span class="hs-identifier hs-var">inst_infos</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621683117364"><span class="annot"><a href="#local-6989586621683117364"><span class="hs-identifier hs-var">th_bndrs</span></a></span></span><span class="hs-special">,</span><span>
</span><span id="line-1697"></span><span>         </span><span class="annot"><a href="Language.Haskell.Syntax.Binds.html#XValBindsLR"><span class="hs-identifier hs-type">XValBindsLR</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Hs.Binds.html#NValBinds"><span class="hs-identifier hs-type">NValBinds</span></a></span><span> </span><span id="local-6989586621683117365"><span class="annot"><a href="#local-6989586621683117365"><span class="hs-identifier hs-var">deriv_binds</span></a></span></span><span> </span><span id="local-6989586621683117366"><span class="annot"><a href="#local-6989586621683117366"><span class="hs-identifier hs-var">deriv_sigs</span></a></span></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-1698"></span><span>            </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">[TyClGroup (GhcPass 'Renamed)]
-&gt; [LDerivDecl (GhcPass 'Renamed)]
-&gt; [LDefaultDecl (GhcPass 'Renamed)]
-&gt; [(RecFlag, LHsBinds (GhcPass 'Renamed))]
-&gt; TcM
     (TcGblEnv, [InstInfo (GhcPass 'Renamed)], ThBindEnv,
      HsValBindsLR (GhcPass 'Renamed) (GhcPass 'Renamed))
</span><a href="GHC.Tc.Module.html#tcTyClsInstDecls"><span class="hs-identifier hs-var">tcTyClsInstDecls</span></a></span><span> </span><span class="annot"><span class="annottext">[TyClGroup (GhcPass 'Renamed)]
</span><a href="#local-6989586621683117353"><span class="hs-identifier hs-var">tycl_decls</span></a></span><span> </span><span class="annot"><span class="annottext">[LDerivDecl (GhcPass 'Renamed)]
</span><a href="#local-6989586621683117354"><span class="hs-identifier hs-var">deriv_decls</span></a></span><span> </span><span class="annot"><span class="annottext">[LDefaultDecl (GhcPass 'Renamed)]
</span><a href="#local-6989586621683117356"><span class="hs-identifier hs-var">default_decls</span></a></span><span> </span><span class="annot"><span class="annottext">[(RecFlag, LHsBinds (GhcPass 'Renamed))]
</span><a href="#local-6989586621683117360"><span class="hs-identifier hs-var">val_binds</span></a></span><span> </span><span class="hs-special">;</span><span>
</span><span id="line-1699"></span><span>
</span><span id="line-1700"></span><span>        </span><span class="annot"><a href="GHC.Tc.Utils.Monad.html#updLclCtxt"><span class="hs-identifier hs-type">updLclCtxt</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span id="local-6989586621683117368"><span class="annot"><span class="annottext">TcLclCtxt
</span><a href="#local-6989586621683117368"><span class="hs-identifier hs-var">tcl_env</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">TcLclCtxt
</span><a href="#local-6989586621683117368"><span class="hs-identifier hs-var">tcl_env</span></a></span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><a href="GHC.Tc.Types.LclEnv.html#tcl_th_bndrs"><span class="hs-identifier hs-var">tcl_th_bndrs</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="#local-6989586621683117364"><span class="hs-identifier hs-type">th_bndrs</span></a></span><span> </span><span class="annot"><a href="GHC.Types.Name.Env.html#plusNameEnv"><span class="hs-operator hs-type">`plusNameEnv`</span></a></span><span> </span><span class="annot"><a href="GHC.Tc.Types.LclEnv.html#tcl_th_bndrs"><span class="hs-identifier hs-var">tcl_th_bndrs</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683117368"><span class="hs-identifier hs-type">tcl_env</span></a></span><span> </span><span class="hs-special">}</span><span class="hs-special">)</span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span>
</span><span id="line-1701"></span><span>        </span><span class="annot"><a href="GHC.Tc.Utils.Monad.html#setGblEnv"><span class="hs-identifier hs-type">setGblEnv</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683117362"><span class="hs-identifier hs-type">tcg_env</span></a></span><span>       </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span>
</span><span id="line-1702"></span><span>
</span><span id="line-1703"></span><span>                </span><span class="hs-comment">-- Foreign import declarations next.</span><span>
</span><span id="line-1704"></span><span>        </span><span class="annot"><a href="GHC.Tc.Utils.Monad.html#traceTc"><span class="hs-identifier hs-type">traceTc</span></a></span><span> </span><span class="annot"><span class="hs-string">&quot;Tc4&quot;</span></span><span> </span><span class="annot"><a href="GHC.Utils.Outputable.html#empty"><span class="hs-identifier hs-type">empty</span></a></span><span> </span><span class="hs-special">;</span><span>
</span><span id="line-1705"></span><span>        </span><span class="hs-special">(</span><span id="local-6989586621683117371"><span class="annot"><a href="#local-6989586621683117371"><span class="hs-identifier hs-var">fi_ids</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621683117372"><span class="annot"><a href="#local-6989586621683117372"><span class="hs-identifier hs-var">fi_decls</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621683117373"><span class="annot"><a href="#local-6989586621683117373"><span class="hs-identifier hs-var">fi_gres</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><a href="GHC.Tc.Gen.Foreign.html#tcForeignImports"><span class="hs-identifier hs-type">tcForeignImports</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683117355"><span class="hs-identifier hs-type">foreign_decls</span></a></span><span> </span><span class="hs-special">;</span><span>
</span><span id="line-1706"></span><span>        </span><span class="annot"><a href="GHC.Tc.Utils.Env.html#tcExtendGlobalValEnv"><span class="hs-identifier hs-type">tcExtendGlobalValEnv</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683117371"><span class="hs-identifier hs-type">fi_ids</span></a></span><span>     </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span>
</span><span id="line-1707"></span><span>
</span><span id="line-1708"></span><span>                </span><span class="hs-comment">-- Value declarations next.</span><span>
</span><span id="line-1709"></span><span>                </span><span class="hs-comment">-- It is important that we check the top-level value bindings</span><span>
</span><span id="line-1710"></span><span>                </span><span class="hs-comment">-- before the GHC-generated derived bindings, since the latter</span><span>
</span><span id="line-1711"></span><span>                </span><span class="hs-comment">-- may be defined in terms of the former. (For instance,</span><span>
</span><span id="line-1712"></span><span>                </span><span class="hs-comment">-- the bindings produced in a Data instance.)</span><span>
</span><span id="line-1713"></span><span>        </span><span class="annot"><a href="GHC.Tc.Utils.Monad.html#traceTc"><span class="hs-identifier hs-type">traceTc</span></a></span><span> </span><span class="annot"><span class="hs-string">&quot;Tc5&quot;</span></span><span> </span><span class="annot"><a href="GHC.Utils.Outputable.html#empty"><span class="hs-identifier hs-type">empty</span></a></span><span> </span><span class="hs-special">;</span><span>
</span><span id="line-1714"></span><span>        </span><span id="local-6989586621683117376"><span class="annot"><a href="#local-6989586621683117376"><span class="hs-identifier hs-var">tc_envs</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><a href="GHC.Tc.Gen.Bind.html#tcTopBinds"><span class="hs-identifier hs-type">tcTopBinds</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683117360"><span class="hs-identifier hs-type">val_binds</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683117361"><span class="hs-identifier hs-type">val_sigs</span></a></span><span class="hs-special">;</span><span>
</span><span id="line-1715"></span><span>        </span><span class="annot"><a href="GHC.Tc.Utils.Monad.html#restoreEnvs"><span class="hs-identifier hs-type">restoreEnvs</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683117376"><span class="hs-identifier hs-type">tc_envs</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span>
</span><span id="line-1716"></span><span>
</span><span id="line-1717"></span><span>                </span><span class="hs-comment">-- Now GHC-generated derived bindings, generics, and selectors</span><span>
</span><span id="line-1718"></span><span>                </span><span class="hs-comment">-- Do not generate warnings from compiler-generated code;</span><span>
</span><span id="line-1719"></span><span>                </span><span class="hs-comment">-- hence the use of discardWarnings</span><span>
</span><span id="line-1720"></span><span>        </span><span id="local-6989586621683117378"><span class="annot"><a href="#local-6989586621683117378"><span class="hs-identifier hs-var">tc_envs</span></a></span></span><span class="hs-glyph">@</span><span class="hs-special">(</span><span id="local-6989586621683117379"><span class="annot"><a href="#local-6989586621683117379"><span class="hs-identifier hs-var">tcg_env</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621683117380"><span class="annot"><a href="#local-6989586621683117380"><span class="hs-identifier hs-var">tcl_env</span></a></span></span><span class="hs-special">)</span><span>
</span><span id="line-1721"></span><span>            </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.Monad.html#discardWarnings"><span class="hs-identifier hs-type">discardWarnings</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Tc.Gen.Bind.html#tcTopBinds"><span class="hs-identifier hs-type">tcTopBinds</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683117365"><span class="hs-identifier hs-type">deriv_binds</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683117366"><span class="hs-identifier hs-type">deriv_sigs</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">;</span><span>
</span><span id="line-1722"></span><span>        </span><span class="annot"><a href="GHC.Tc.Utils.Monad.html#restoreEnvs"><span class="hs-identifier hs-type">restoreEnvs</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683117378"><span class="hs-identifier hs-type">tc_envs</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span>  </span><span class="hs-comment">-- Environment doesn't change now</span><span>
</span><span id="line-1723"></span><span>
</span><span id="line-1724"></span><span>                </span><span class="hs-comment">-- Second pass over class and instance declarations,</span><span>
</span><span id="line-1725"></span><span>                </span><span class="hs-comment">-- now using the kind-checked decls</span><span>
</span><span id="line-1726"></span><span>        </span><span class="annot"><a href="GHC.Tc.Utils.Monad.html#traceTc"><span class="hs-identifier hs-type">traceTc</span></a></span><span> </span><span class="annot"><span class="hs-string">&quot;Tc6&quot;</span></span><span> </span><span class="annot"><a href="GHC.Utils.Outputable.html#empty"><span class="hs-identifier hs-type">empty</span></a></span><span> </span><span class="hs-special">;</span><span>
</span><span id="line-1727"></span><span>        </span><span id="local-6989586621683117382"><span class="annot"><a href="#local-6989586621683117382"><span class="hs-identifier hs-var">inst_binds</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><a href="GHC.Tc.TyCl.Instance.html#tcInstDecls2"><span class="hs-identifier hs-type">tcInstDecls2</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Language.Haskell.Syntax.Decls.html#tyClGroupTyClDecls"><span class="hs-identifier hs-type">tyClGroupTyClDecls</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683117353"><span class="hs-identifier hs-type">tycl_decls</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><a href="#local-6989586621683117363"><span class="hs-identifier hs-type">inst_infos</span></a></span><span> </span><span class="hs-special">;</span><span>
</span><span id="line-1728"></span><span>
</span><span id="line-1729"></span><span>                </span><span class="hs-comment">-- Foreign exports</span><span>
</span><span id="line-1730"></span><span>        </span><span class="annot"><a href="GHC.Tc.Utils.Monad.html#traceTc"><span class="hs-identifier hs-type">traceTc</span></a></span><span> </span><span class="annot"><span class="hs-string">&quot;Tc7&quot;</span></span><span> </span><span class="annot"><a href="GHC.Utils.Outputable.html#empty"><span class="hs-identifier hs-type">empty</span></a></span><span> </span><span class="hs-special">;</span><span>
</span><span id="line-1731"></span><span>        </span><span class="hs-special">(</span><span id="local-6989586621683117385"><span class="annot"><a href="#local-6989586621683117385"><span class="hs-identifier hs-var">foe_binds</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621683117386"><span class="annot"><a href="#local-6989586621683117386"><span class="hs-identifier hs-var">foe_decls</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621683117387"><span class="annot"><a href="#local-6989586621683117387"><span class="hs-identifier hs-var">foe_gres</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><a href="GHC.Tc.Gen.Foreign.html#tcForeignExports"><span class="hs-identifier hs-type">tcForeignExports</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683117355"><span class="hs-identifier hs-type">foreign_decls</span></a></span><span> </span><span class="hs-special">;</span><span>
</span><span id="line-1732"></span><span>
</span><span id="line-1733"></span><span>                </span><span class="hs-comment">-- Annotations</span><span>
</span><span id="line-1734"></span><span>        </span><span id="local-6989586621683117389"><span class="annot"><a href="#local-6989586621683117389"><span class="hs-identifier hs-var">annotations</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><a href="GHC.Tc.Gen.Annotation.html#tcAnnotations"><span class="hs-identifier hs-type">tcAnnotations</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683117357"><span class="hs-identifier hs-type">annotation_decls</span></a></span><span> </span><span class="hs-special">;</span><span>
</span><span id="line-1735"></span><span>
</span><span id="line-1736"></span><span>                </span><span class="hs-comment">-- Rules</span><span>
</span><span id="line-1737"></span><span>        </span><span id="local-6989586621683117391"><span class="annot"><a href="#local-6989586621683117391"><span class="hs-identifier hs-var">rules</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><a href="GHC.Tc.Gen.Rule.html#tcRules"><span class="hs-identifier hs-type">tcRules</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683117358"><span class="hs-identifier hs-type">rule_decls</span></a></span><span> </span><span class="hs-special">;</span><span>
</span><span id="line-1738"></span><span>
</span><span id="line-1739"></span><span>                </span><span class="hs-comment">-- Wrap up</span><span>
</span><span id="line-1740"></span><span>        </span><span class="annot"><a href="GHC.Tc.Utils.Monad.html#traceTc"><span class="hs-identifier hs-type">traceTc</span></a></span><span> </span><span class="annot"><span class="hs-string">&quot;Tc7a&quot;</span></span><span> </span><span class="annot"><a href="GHC.Utils.Outputable.html#empty"><span class="hs-identifier hs-type">empty</span></a></span><span> </span><span class="hs-special">;</span><span>
</span><span id="line-1741"></span><span>        </span><span class="hs-keyword">let</span><span> </span><span class="hs-special">{</span><span> </span><span id="local-6989586621683117393"><span class="annot"><a href="#local-6989586621683117393"><span class="hs-identifier hs-var hs-var">all_binds</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[GenLocated SrcSpanAnnA (HsBindLR GhcTc GhcTc)]
</span><a href="#local-6989586621683117382"><span class="hs-identifier hs-var">inst_binds</span></a></span><span> </span><span class="annot"><span class="annottext">[GenLocated SrcSpanAnnA (HsBindLR GhcTc GhcTc)]
-&gt; [GenLocated SrcSpanAnnA (HsBindLR GhcTc GhcTc)]
-&gt; [GenLocated SrcSpanAnnA (HsBindLR GhcTc GhcTc)]
forall a. [a] -&gt; [a] -&gt; [a]
</span><span class="hs-operator hs-var">++</span></span><span> </span><span class="annot"><span class="annottext">[GenLocated SrcSpanAnnA (HsBindLR GhcTc GhcTc)]
</span><a href="#local-6989586621683117385"><span class="hs-identifier hs-var">foe_binds</span></a></span><span>
</span><span id="line-1742"></span><span>
</span><span id="line-1743"></span><span>            </span><span class="hs-special">;</span><span> </span><span id="local-6989586621683117394"><span class="annot"><a href="#local-6989586621683117394"><span class="hs-identifier hs-var hs-var">fo_gres</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Bag GlobalRdrElt
</span><a href="#local-6989586621683117373"><span class="hs-identifier hs-var">fi_gres</span></a></span><span> </span><span class="annot"><span class="annottext">Bag GlobalRdrElt -&gt; Bag GlobalRdrElt -&gt; Bag GlobalRdrElt
forall a. Bag a -&gt; Bag a -&gt; Bag a
</span><a href="GHC.Data.Bag.html#unionBags"><span class="hs-operator hs-var">`unionBags`</span></a></span><span> </span><span class="annot"><span class="annottext">Bag GlobalRdrElt
</span><a href="#local-6989586621683117387"><span class="hs-identifier hs-var">foe_gres</span></a></span><span>
</span><span id="line-1744"></span><span>            </span><span class="hs-special">;</span><span> </span><span id="local-6989586621683117395"><span class="annot"><a href="#local-6989586621683117395"><span class="hs-identifier hs-var hs-var">fo_fvs</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(GlobalRdrElt -&gt; FreeVars -&gt; FreeVars)
-&gt; FreeVars -&gt; Bag GlobalRdrElt -&gt; FreeVars
forall a b. (a -&gt; b -&gt; b) -&gt; b -&gt; Bag a -&gt; b
forall (t :: * -&gt; *) a b.
Foldable t =&gt;
(a -&gt; b -&gt; b) -&gt; b -&gt; t a -&gt; b
</span><span class="hs-identifier hs-var">foldr</span></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span id="local-6989586621683117397"><span class="annot"><span class="annottext">GlobalRdrElt
</span><a href="#local-6989586621683117397"><span class="hs-identifier hs-var">gre</span></a></span></span><span> </span><span id="local-6989586621683117398"><span class="annot"><span class="annottext">FreeVars
</span><a href="#local-6989586621683117398"><span class="hs-identifier hs-var">fvs</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">FreeVars
</span><a href="#local-6989586621683117398"><span class="hs-identifier hs-var">fvs</span></a></span><span> </span><span class="annot"><span class="annottext">FreeVars -&gt; Name -&gt; FreeVars
</span><a href="GHC.Types.Name.Set.html#addOneFV"><span class="hs-operator hs-var">`addOneFV`</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">GlobalRdrElt -&gt; Name
forall info. GlobalRdrEltX info -&gt; Name
</span><a href="GHC.Types.Name.Reader.html#greName"><span class="hs-identifier hs-var">greName</span></a></span><span> </span><span class="annot"><span class="annottext">GlobalRdrElt
</span><a href="#local-6989586621683117397"><span class="hs-identifier hs-var">gre</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-1745"></span><span>                                </span><span class="annot"><span class="annottext">FreeVars
</span><a href="GHC.Types.Name.Set.html#emptyFVs"><span class="hs-identifier hs-var">emptyFVs</span></a></span><span> </span><span class="annot"><span class="annottext">Bag GlobalRdrElt
</span><a href="#local-6989586621683117394"><span class="hs-identifier hs-var">fo_gres</span></a></span><span>
</span><span id="line-1746"></span><span>
</span><span id="line-1747"></span><span>            </span><span class="hs-special">;</span><span> </span><span id="local-6989586621683117401"><span class="annot"><a href="#local-6989586621683117401"><span class="hs-identifier hs-var hs-var">sig_names</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[Name] -&gt; FreeVars
</span><a href="GHC.Types.Name.Set.html#mkNameSet"><span class="hs-identifier hs-var">mkNameSet</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">CollectFlag (GhcPass 'Renamed)
-&gt; HsValBindsLR (GhcPass 'Renamed) (GhcPass 'Renamed)
-&gt; [IdP (GhcPass 'Renamed)]
forall (idL :: Pass) idR.
CollectPass (GhcPass idL) =&gt;
CollectFlag (GhcPass idL)
-&gt; HsValBindsLR (GhcPass idL) idR -&gt; [IdP (GhcPass idL)]
</span><a href="GHC.Hs.Utils.html#collectHsValBinders"><span class="hs-identifier hs-var">collectHsValBinders</span></a></span><span> </span><span class="annot"><span class="annottext">CollectFlag (GhcPass 'Renamed)
forall p. CollectFlag p
</span><a href="GHC.Hs.Utils.html#CollNoDictBinders"><span class="hs-identifier hs-var">CollNoDictBinders</span></a></span><span> </span><span class="annot"><span class="annottext">HsValBindsLR (GhcPass 'Renamed) (GhcPass 'Renamed)
</span><a href="#local-6989586621683117359"><span class="hs-identifier hs-var">hs_val_binds</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1748"></span><span>                          </span><span class="annot"><span class="annottext">FreeVars -&gt; FreeVars -&gt; FreeVars
</span><a href="GHC.Types.Name.Set.html#minusNameSet"><span class="hs-operator hs-var">`minusNameSet`</span></a></span><span> </span><span class="annot"><span class="annottext">[LSig (GhcPass 'Renamed)] -&gt; FreeVars
</span><a href="GHC.Tc.Utils.Env.html#getTypeSigNames"><span class="hs-identifier hs-var">getTypeSigNames</span></a></span><span> </span><span class="annot"><span class="annottext">[LSig (GhcPass 'Renamed)]
</span><a href="#local-6989586621683117361"><span class="hs-identifier hs-var">val_sigs</span></a></span><span>
</span><span id="line-1749"></span><span>
</span><span id="line-1750"></span><span>                </span><span class="hs-comment">-- Extend the GblEnv with the (as yet un-zonked)</span><span>
</span><span id="line-1751"></span><span>                </span><span class="hs-comment">-- bindings, rules, foreign decls</span><span>
</span><span id="line-1752"></span><span>            </span><span class="hs-special">;</span><span> </span><span id="local-6989586621683117407"><span class="annot"><a href="#local-6989586621683117407"><span class="hs-identifier hs-var hs-var">tcg_env'</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">TcGblEnv
</span><a href="#local-6989586621683117379"><span class="hs-identifier hs-var">tcg_env</span></a></span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#tcg_binds"><span class="hs-identifier hs-var">tcg_binds</span></a></span><span>   </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#tcg_binds"><span class="hs-identifier hs-var">tcg_binds</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683117379"><span class="hs-identifier hs-type">tcg_env</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">++</span></span><span> </span><span class="annot"><a href="#local-6989586621683117393"><span class="hs-identifier hs-type">all_binds</span></a></span><span>
</span><span id="line-1753"></span><span>                                 </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#tcg_sigs"><span class="hs-identifier hs-var">tcg_sigs</span></a></span><span>    </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#tcg_sigs"><span class="hs-identifier hs-var">tcg_sigs</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683117379"><span class="hs-identifier hs-type">tcg_env</span></a></span><span> </span><span class="annot"><a href="GHC.Types.Name.Set.html#unionNameSet"><span class="hs-operator hs-type">`unionNameSet`</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683117401"><span class="hs-identifier hs-type">sig_names</span></a></span><span>
</span><span id="line-1754"></span><span>                                 </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#tcg_rules"><span class="hs-identifier hs-var">tcg_rules</span></a></span><span>   </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#tcg_rules"><span class="hs-identifier hs-var">tcg_rules</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683117379"><span class="hs-identifier hs-type">tcg_env</span></a></span><span>
</span><span id="line-1755"></span><span>                                                      </span><span class="annot"><span class="hs-operator hs-type">++</span></span><span> </span><span class="annot"><a href="GHC.Hs.Decls.html#flattenRuleDecls"><span class="hs-identifier hs-type">flattenRuleDecls</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683117391"><span class="hs-identifier hs-type">rules</span></a></span><span>
</span><span id="line-1756"></span><span>                                 </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#tcg_anns"><span class="hs-identifier hs-var">tcg_anns</span></a></span><span>    </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#tcg_anns"><span class="hs-identifier hs-var">tcg_anns</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683117379"><span class="hs-identifier hs-type">tcg_env</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">++</span></span><span> </span><span class="annot"><a href="#local-6989586621683117389"><span class="hs-identifier hs-type">annotations</span></a></span><span>
</span><span id="line-1757"></span><span>                                 </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#tcg_ann_env"><span class="hs-identifier hs-var">tcg_ann_env</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="GHC.Types.Annotations.html#extendAnnEnvList"><span class="hs-identifier hs-type">extendAnnEnvList</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Tc.Types.html#tcg_ann_env"><span class="hs-identifier hs-var">tcg_ann_env</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683117379"><span class="hs-identifier hs-type">tcg_env</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><a href="#local-6989586621683117389"><span class="hs-identifier hs-type">annotations</span></a></span><span>
</span><span id="line-1758"></span><span>                                 </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#tcg_fords"><span class="hs-identifier hs-var">tcg_fords</span></a></span><span>   </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#tcg_fords"><span class="hs-identifier hs-var">tcg_fords</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683117379"><span class="hs-identifier hs-type">tcg_env</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">++</span></span><span> </span><span class="annot"><a href="#local-6989586621683117386"><span class="hs-identifier hs-type">foe_decls</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">++</span></span><span> </span><span class="annot"><a href="#local-6989586621683117372"><span class="hs-identifier hs-type">fi_decls</span></a></span><span>
</span><span id="line-1759"></span><span>                                 </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#tcg_dus"><span class="hs-identifier hs-var">tcg_dus</span></a></span><span>     </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#tcg_dus"><span class="hs-identifier hs-var">tcg_dus</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683117379"><span class="hs-identifier hs-type">tcg_env</span></a></span><span> </span><span class="annot"><a href="GHC.Types.Name.Set.html#plusDU"><span class="hs-operator hs-type">`plusDU`</span></a></span><span> </span><span class="annot"><a href="GHC.Types.Name.Set.html#usesOnly"><span class="hs-identifier hs-type">usesOnly</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683117395"><span class="hs-identifier hs-type">fo_fvs</span></a></span><span> </span><span class="hs-special">}</span><span> </span><span class="hs-special">}</span><span> </span><span class="hs-special">;</span><span>
</span><span id="line-1760"></span><span>                                 </span><span class="hs-comment">-- tcg_dus: see Note [Newtype constructor usage in foreign declarations]</span><span>
</span><span id="line-1761"></span><span>
</span><span id="line-1762"></span><span>        </span><span class="hs-comment">-- See Note [Newtype constructor usage in foreign declarations]</span><span>
</span><span id="line-1763"></span><span>        </span><span class="annot"><a href="GHC.Rename.Env.html#addUsedGREs"><span class="hs-identifier hs-type">addUsedGREs</span></a></span><span> </span><span class="annot"><a href="GHC.Rename.Utils.html#NoDeprecationWarnings"><span class="hs-identifier hs-type">NoDeprecationWarnings</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Data.Bag.html#bagToList"><span class="hs-identifier hs-type">bagToList</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683117394"><span class="hs-identifier hs-type">fo_gres</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">;</span><span>
</span><span id="line-1764"></span><span>
</span><span id="line-1765"></span><span>        </span><span class="annot"><span class="hs-identifier hs-type">return</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621683117407"><span class="hs-identifier hs-type">tcg_env'</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="#local-6989586621683117380"><span class="hs-identifier hs-type">tcl_env</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1766"></span><span>    </span><span class="hs-special">}</span><span class="hs-special">}</span><span class="hs-special">}</span><span class="hs-special">}</span><span class="hs-special">}</span><span>
</span><span id="line-1767"></span><span>
</span><span id="line-1768"></span><span class="annot"><a href="GHC.Tc.Module.html#tcTopSrcDecls"><span class="hs-identifier hs-var">tcTopSrcDecls</span></a></span><span> </span><span class="annot"><span class="annottext">HsGroup (GhcPass 'Renamed)
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">String -&gt; TcRnIf TcGblEnv TcLclEnv (TcGblEnv, TcLclEnv)
forall a. HasCallStack =&gt; String -&gt; a
</span><a href="GHC.Utils.Panic.Plain.html#panic"><span class="hs-identifier hs-var">panic</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;tcTopSrcDecls: ValBindsIn&quot;</span></span><span>
</span><span id="line-1769"></span><span>
</span><span id="line-1770"></span><span class="hs-comment">---------------------------</span><span>
</span><span id="line-1771"></span><span class="annot"><a href="GHC.Tc.Module.html#tcTyClsInstDecls"><span class="hs-identifier hs-type">tcTyClsInstDecls</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="Language.Haskell.Syntax.Decls.html#TyClGroup"><span class="hs-identifier hs-type">TyClGroup</span></a></span><span> </span><span class="annot"><a href="GHC.Hs.Extension.html#GhcRn"><span class="hs-identifier hs-type">GhcRn</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-1772"></span><span>                 </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="Language.Haskell.Syntax.Decls.html#LDerivDecl"><span class="hs-identifier hs-type">LDerivDecl</span></a></span><span> </span><span class="annot"><a href="GHC.Hs.Extension.html#GhcRn"><span class="hs-identifier hs-type">GhcRn</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-1773"></span><span>                 </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="Language.Haskell.Syntax.Decls.html#LDefaultDecl"><span class="hs-identifier hs-type">LDefaultDecl</span></a></span><span> </span><span class="annot"><a href="GHC.Hs.Extension.html#GhcRn"><span class="hs-identifier hs-type">GhcRn</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-1774"></span><span>                 </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="hs-special">(</span><span class="annot"><a href="GHC.Types.Basic.html#RecFlag"><span class="hs-identifier hs-type">RecFlag</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Language.Haskell.Syntax.Binds.html#LHsBinds"><span class="hs-identifier hs-type">LHsBinds</span></a></span><span> </span><span class="annot"><a href="GHC.Hs.Extension.html#GhcRn"><span class="hs-identifier hs-type">GhcRn</span></a></span><span class="hs-special">)</span><span class="hs-special">]</span><span>
</span><span id="line-1775"></span><span>                 </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#TcM"><span class="hs-identifier hs-type">TcM</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Tc.Types.html#TcGblEnv"><span class="hs-identifier hs-type">TcGblEnv</span></a></span><span class="hs-special">,</span><span>            </span><span class="hs-comment">-- The full inst env</span><span>
</span><span id="line-1776"></span><span>                         </span><span class="hs-special">[</span><span class="annot"><a href="GHC.Tc.Utils.Env.html#InstInfo"><span class="hs-identifier hs-type">InstInfo</span></a></span><span> </span><span class="annot"><a href="GHC.Hs.Extension.html#GhcRn"><span class="hs-identifier hs-type">GhcRn</span></a></span><span class="hs-special">]</span><span class="hs-special">,</span><span>    </span><span class="hs-comment">-- Source-code instance decls to</span><span>
</span><span id="line-1777"></span><span>                                              </span><span class="hs-comment">-- process; contains all dfuns for</span><span>
</span><span id="line-1778"></span><span>                                              </span><span class="hs-comment">-- this module</span><span>
</span><span id="line-1779"></span><span>                          </span><span class="annot"><a href="GHC.Tc.Types.LclEnv.html#ThBindEnv"><span class="hs-identifier hs-type">ThBindEnv</span></a></span><span class="hs-special">,</span><span>          </span><span class="hs-comment">-- TH binding levels</span><span>
</span><span id="line-1780"></span><span>                          </span><span class="annot"><a href="Language.Haskell.Syntax.Binds.html#HsValBinds"><span class="hs-identifier hs-type">HsValBinds</span></a></span><span> </span><span class="annot"><a href="GHC.Hs.Extension.html#GhcRn"><span class="hs-identifier hs-type">GhcRn</span></a></span><span class="hs-special">)</span><span>   </span><span class="hs-comment">-- Supporting bindings for derived</span><span>
</span><span id="line-1781"></span><span>                                              </span><span class="hs-comment">-- instances</span><span>
</span><span id="line-1782"></span><span>
</span><span id="line-1783"></span><span id="tcTyClsInstDecls"><span class="annot"><span class="annottext">tcTyClsInstDecls :: [TyClGroup (GhcPass 'Renamed)]
-&gt; [LDerivDecl (GhcPass 'Renamed)]
-&gt; [LDefaultDecl (GhcPass 'Renamed)]
-&gt; [(RecFlag, LHsBinds (GhcPass 'Renamed))]
-&gt; TcM
     (TcGblEnv, [InstInfo (GhcPass 'Renamed)], ThBindEnv,
      HsValBindsLR (GhcPass 'Renamed) (GhcPass 'Renamed))
</span><a href="GHC.Tc.Module.html#tcTyClsInstDecls"><span class="hs-identifier hs-var hs-var">tcTyClsInstDecls</span></a></span></span><span> </span><span id="local-6989586621683117419"><span class="annot"><span class="annottext">[TyClGroup (GhcPass 'Renamed)]
</span><a href="#local-6989586621683117419"><span class="hs-identifier hs-var">tycl_decls</span></a></span></span><span> </span><span id="local-6989586621683117420"><span class="annot"><span class="annottext">[LDerivDecl (GhcPass 'Renamed)]
</span><a href="#local-6989586621683117420"><span class="hs-identifier hs-var">deriv_decls</span></a></span></span><span> </span><span id="local-6989586621683117421"><span class="annot"><span class="annottext">[LDefaultDecl (GhcPass 'Renamed)]
</span><a href="#local-6989586621683117421"><span class="hs-identifier hs-var">default_decls</span></a></span></span><span> </span><span id="local-6989586621683117422"><span class="annot"><span class="annottext">[(RecFlag, LHsBinds (GhcPass 'Renamed))]
</span><a href="#local-6989586621683117422"><span class="hs-identifier hs-var">binds</span></a></span></span><span>
</span><span id="line-1784"></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[LInstDecl (GhcPass 'Renamed)]
-&gt; TcM
     (TcGblEnv, [InstInfo (GhcPass 'Renamed)], ThBindEnv,
      HsValBindsLR (GhcPass 'Renamed) (GhcPass 'Renamed))
-&gt; TcM
     (TcGblEnv, [InstInfo (GhcPass 'Renamed)], ThBindEnv,
      HsValBindsLR (GhcPass 'Renamed) (GhcPass 'Renamed))
forall a. [LInstDecl (GhcPass 'Renamed)] -&gt; TcM a -&gt; TcM a
</span><a href="GHC.Tc.Utils.Env.html#tcAddDataFamConPlaceholders"><span class="hs-identifier hs-var">tcAddDataFamConPlaceholders</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[TyClGroup (GhcPass 'Renamed)]
</span><a href="#local-6989586621683117419"><span class="hs-identifier hs-var">tycl_decls</span></a></span><span> </span><span class="annot"><span class="annottext">[TyClGroup (GhcPass 'Renamed)]
-&gt; (TyClGroup (GhcPass 'Renamed)
    -&gt; [GenLocated SrcSpanAnnA (InstDecl (GhcPass 'Renamed))])
-&gt; [GenLocated SrcSpanAnnA (InstDecl (GhcPass 'Renamed))]
forall a b. [a] -&gt; (a -&gt; [b]) -&gt; [b]
forall (m :: * -&gt; *) a b. Monad m =&gt; m a -&gt; (a -&gt; m b) -&gt; m b
</span><span class="hs-operator hs-var">&gt;&gt;=</span></span><span> </span><span class="annot"><span class="annottext">TyClGroup (GhcPass 'Renamed) -&gt; [LInstDecl (GhcPass 'Renamed)]
TyClGroup (GhcPass 'Renamed)
-&gt; [GenLocated SrcSpanAnnA (InstDecl (GhcPass 'Renamed))]
forall pass. TyClGroup pass -&gt; [LInstDecl pass]
</span><a href="Language.Haskell.Syntax.Decls.html#group_instds"><span class="hs-identifier hs-var">group_instds</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(TcM
   (TcGblEnv, [InstInfo (GhcPass 'Renamed)], ThBindEnv,
    HsValBindsLR (GhcPass 'Renamed) (GhcPass 'Renamed))
 -&gt; TcM
      (TcGblEnv, [InstInfo (GhcPass 'Renamed)], ThBindEnv,
       HsValBindsLR (GhcPass 'Renamed) (GhcPass 'Renamed)))
-&gt; TcM
     (TcGblEnv, [InstInfo (GhcPass 'Renamed)], ThBindEnv,
      HsValBindsLR (GhcPass 'Renamed) (GhcPass 'Renamed))
-&gt; TcM
     (TcGblEnv, [InstInfo (GhcPass 'Renamed)], ThBindEnv,
      HsValBindsLR (GhcPass 'Renamed) (GhcPass 'Renamed))
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-1785"></span><span>   </span><span class="annot"><span class="annottext">[PatSynBind (GhcPass 'Renamed) (GhcPass 'Renamed)]
-&gt; TcM
     (TcGblEnv, [InstInfo (GhcPass 'Renamed)], ThBindEnv,
      HsValBindsLR (GhcPass 'Renamed) (GhcPass 'Renamed))
-&gt; TcM
     (TcGblEnv, [InstInfo (GhcPass 'Renamed)], ThBindEnv,
      HsValBindsLR (GhcPass 'Renamed) (GhcPass 'Renamed))
forall a.
[PatSynBind (GhcPass 'Renamed) (GhcPass 'Renamed)]
-&gt; TcM a -&gt; TcM a
</span><a href="GHC.Tc.Utils.Env.html#tcAddPatSynPlaceholders"><span class="hs-identifier hs-var">tcAddPatSynPlaceholders</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[(RecFlag, LHsBinds (GhcPass 'Renamed))]
-&gt; [PatSynBind (GhcPass 'Renamed) (GhcPass 'Renamed)]
forall id.
UnXRec id =&gt;
[(RecFlag, LHsBinds id)] -&gt; [PatSynBind id id]
</span><a href="GHC.Hs.Utils.html#getPatSynBinds"><span class="hs-identifier hs-var">getPatSynBinds</span></a></span><span> </span><span class="annot"><span class="annottext">[(RecFlag, LHsBinds (GhcPass 'Renamed))]
</span><a href="#local-6989586621683117422"><span class="hs-identifier hs-var">binds</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(TcM
   (TcGblEnv, [InstInfo (GhcPass 'Renamed)], ThBindEnv,
    HsValBindsLR (GhcPass 'Renamed) (GhcPass 'Renamed))
 -&gt; TcM
      (TcGblEnv, [InstInfo (GhcPass 'Renamed)], ThBindEnv,
       HsValBindsLR (GhcPass 'Renamed) (GhcPass 'Renamed)))
-&gt; TcM
     (TcGblEnv, [InstInfo (GhcPass 'Renamed)], ThBindEnv,
      HsValBindsLR (GhcPass 'Renamed) (GhcPass 'Renamed))
-&gt; TcM
     (TcGblEnv, [InstInfo (GhcPass 'Renamed)], ThBindEnv,
      HsValBindsLR (GhcPass 'Renamed) (GhcPass 'Renamed))
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-1786"></span><span>   </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span class="hs-special">(</span><span id="local-6989586621683117427"><span class="annot"><a href="#local-6989586621683117427"><span class="hs-identifier hs-var">tcg_env</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621683117428"><span class="annot"><a href="#local-6989586621683117428"><span class="hs-identifier hs-var">inst_info</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621683117429"><span class="annot"><a href="#local-6989586621683117429"><span class="hs-identifier hs-var">deriv_info</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621683117430"><span class="annot"><a href="#local-6989586621683117430"><span class="hs-identifier hs-var">th_bndrs</span></a></span></span><span class="hs-special">)</span><span>
</span><span id="line-1787"></span><span>          </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">[TyClGroup (GhcPass 'Renamed)]
-&gt; TcM
     (TcGblEnv, [InstInfo (GhcPass 'Renamed)], [DerivInfo], ThBindEnv)
</span><a href="GHC.Tc.TyCl.html#tcTyAndClassDecls"><span class="hs-identifier hs-var">tcTyAndClassDecls</span></a></span><span> </span><span class="annot"><span class="annottext">[TyClGroup (GhcPass 'Renamed)]
</span><a href="#local-6989586621683117419"><span class="hs-identifier hs-var">tycl_decls</span></a></span><span> </span><span class="hs-special">;</span><span>
</span><span id="line-1788"></span><span>
</span><span id="line-1789"></span><span>      </span><span class="hs-special">;</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.Monad.html#setGblEnv"><span class="hs-identifier hs-type">setGblEnv</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683117427"><span class="hs-identifier hs-type">tcg_env</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span>
</span><span id="line-1790"></span><span>
</span><span id="line-1791"></span><span>          </span><span class="hs-comment">-- With the @TyClDecl@s and @InstDecl@s checked we're ready to</span><span>
</span><span id="line-1792"></span><span>          </span><span class="hs-comment">-- process the deriving clauses, including data family deriving</span><span>
</span><span id="line-1793"></span><span>          </span><span class="hs-comment">-- clauses discovered in @tcTyAndClassDecls@.</span><span>
</span><span id="line-1794"></span><span>          </span><span class="hs-comment">--</span><span>
</span><span id="line-1795"></span><span>          </span><span class="hs-comment">-- But only after we've typechecked 'default' declarations.</span><span>
</span><span id="line-1796"></span><span>          </span><span class="hs-comment">-- See Note [Typechecking default declarations]</span><span>
</span><span id="line-1797"></span><span>          </span><span id="local-6989586621683117432"><span class="annot"><a href="#local-6989586621683117432"><span class="hs-identifier hs-var">defaults</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><a href="GHC.Tc.Gen.Default.html#tcDefaults"><span class="hs-identifier hs-type">tcDefaults</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683117421"><span class="hs-identifier hs-type">default_decls</span></a></span><span> </span><span class="hs-special">;</span><span>
</span><span id="line-1798"></span><span>          </span><span class="annot"><a href="GHC.Tc.Utils.Monad.html#updGblEnv"><span class="hs-identifier hs-type">updGblEnv</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span id="local-6989586621683117434"><span class="annot"><span class="annottext">TcGblEnv
</span><a href="#local-6989586621683117434"><span class="hs-identifier hs-var">gbl</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">TcGblEnv
</span><a href="#local-6989586621683117434"><span class="hs-identifier hs-var">gbl</span></a></span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#tcg_default"><span class="hs-identifier hs-var">tcg_default</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="#local-6989586621683117432"><span class="hs-identifier hs-type">defaults</span></a></span><span> </span><span class="hs-special">}</span><span class="hs-special">)</span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span>
</span><span id="line-1799"></span><span>
</span><span id="line-1800"></span><span>
</span><span id="line-1801"></span><span>          </span><span class="hs-comment">-- Careful to quit now in case there were instance errors, so that</span><span>
</span><span id="line-1802"></span><span>          </span><span class="hs-comment">-- the deriving errors don't pile up as well.</span><span>
</span><span id="line-1803"></span><span>          </span><span class="hs-special">;</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.Monad.html#failIfErrsM"><span class="hs-identifier hs-type">failIfErrsM</span></a></span><span>
</span><span id="line-1804"></span><span>          </span><span class="hs-special">;</span><span> </span><span class="hs-special">(</span><span id="local-6989586621683117435"><span class="annot"><a href="#local-6989586621683117435"><span class="hs-identifier hs-var">tcg_env'</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621683117436"><span class="annot"><a href="#local-6989586621683117436"><span class="hs-identifier hs-var">inst_info'</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621683117437"><span class="annot"><a href="#local-6989586621683117437"><span class="hs-identifier hs-var">val_binds</span></a></span></span><span class="hs-special">)</span><span>
</span><span id="line-1805"></span><span>              </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><a href="GHC.Tc.TyCl.Instance.html#tcInstDeclsDeriv"><span class="hs-identifier hs-type">tcInstDeclsDeriv</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683117429"><span class="hs-identifier hs-type">deriv_info</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683117420"><span class="hs-identifier hs-type">deriv_decls</span></a></span><span>
</span><span id="line-1806"></span><span>          </span><span class="hs-special">;</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.Monad.html#setGblEnv"><span class="hs-identifier hs-type">setGblEnv</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683117435"><span class="hs-identifier hs-type">tcg_env'</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span>
</span><span id="line-1807"></span><span>                </span><span class="annot"><a href="GHC.Tc.Utils.Monad.html#failIfErrsM"><span class="hs-identifier hs-type">failIfErrsM</span></a></span><span>
</span><span id="line-1808"></span><span>              </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">pure</span></span><span> </span><span class="hs-special">(</span><span> </span><span class="annot"><a href="#local-6989586621683117435"><span class="hs-identifier hs-type">tcg_env'</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="#local-6989586621683117436"><span class="hs-identifier hs-type">inst_info'</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">++</span></span><span> </span><span class="annot"><a href="#local-6989586621683117428"><span class="hs-identifier hs-type">inst_info</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="#local-6989586621683117430"><span class="hs-identifier hs-type">th_bndrs</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="#local-6989586621683117437"><span class="hs-identifier hs-type">val_binds</span></a></span><span> </span><span class="hs-special">)</span><span>
</span><span id="line-1809"></span><span>      </span><span class="hs-special">}</span><span class="hs-special">}</span><span class="hs-special">}</span><span class="hs-special">}</span><span>
</span><span id="line-1810"></span><span>
</span><span id="line-1811"></span><span class="annot"><span class="hs-comment">{- *********************************************************************
*                                                                      *
        Checking for 'main'
*                                                                      *
************************************************************************
-}</span></span><span>
</span><span id="line-1817"></span><span>
</span><span id="line-1818"></span><span class="annot"><a href="GHC.Tc.Module.html#checkMainType"><span class="hs-identifier hs-type">checkMainType</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#TcGblEnv"><span class="hs-identifier hs-type">TcGblEnv</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#TcRn"><span class="hs-identifier hs-type">TcRn</span></a></span><span> </span><span class="annot"><a href="GHC.Tc.Types.Constraint.html#WantedConstraints"><span class="hs-identifier hs-type">WantedConstraints</span></a></span><span>
</span><span id="line-1819"></span><span class="hs-comment">-- If this is the Main module, and it defines a function main,</span><span>
</span><span id="line-1820"></span><span class="hs-comment">--   check that its type is of form IO tau.</span><span>
</span><span id="line-1821"></span><span class="hs-comment">-- If not, do nothing</span><span>
</span><span id="line-1822"></span><span class="hs-comment">-- See Note [Dealing with main]</span><span>
</span><span id="line-1823"></span><span id="checkMainType"><span class="annot"><span class="annottext">checkMainType :: TcGblEnv -&gt; TcRn WantedConstraints
</span><a href="GHC.Tc.Module.html#checkMainType"><span class="hs-identifier hs-var hs-var">checkMainType</span></a></span></span><span> </span><span id="local-6989586621683117439"><span class="annot"><span class="annottext">TcGblEnv
</span><a href="#local-6989586621683117439"><span class="hs-identifier hs-var">tcg_env</span></a></span></span><span>
</span><span id="line-1824"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span id="local-6989586621683117440"><span class="annot"><a href="#local-6989586621683117440"><span class="hs-identifier hs-var">hsc_env</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">TcRnIf TcGblEnv TcLclEnv HscEnv
forall gbl lcl. TcRnIf gbl lcl HscEnv
</span><a href="GHC.Tc.Utils.Monad.html#getTopEnv"><span class="hs-identifier hs-var">getTopEnv</span></a></span><span>
</span><span id="line-1825"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="hs-keyword">if</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#tcg_mod"><span class="hs-identifier hs-var">tcg_mod</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683117439"><span class="hs-identifier hs-type">tcg_env</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">/=</span></span><span> </span><span class="annot"><a href="GHC.Driver.Env.html#mainModIs"><span class="hs-identifier hs-type">mainModIs</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Driver.Env.html#hsc_HUE"><span class="hs-identifier hs-type">hsc_HUE</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683117440"><span class="hs-identifier hs-type">hsc_env</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1826"></span><span>         </span><span class="hs-keyword">then</span><span> </span><span class="annot"><span class="hs-identifier hs-type">return</span></span><span> </span><span class="annot"><a href="GHC.Tc.Types.Constraint.html#emptyWC"><span class="hs-identifier hs-type">emptyWC</span></a></span><span> </span><span class="hs-keyword">else</span><span>
</span><span id="line-1827"></span><span>
</span><span id="line-1828"></span><span>    </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span id="local-6989586621683117446"><span class="annot"><a href="#local-6989586621683117446"><span class="hs-identifier hs-var">rdr_env</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.Monad.html#getGlobalRdrEnv"><span class="hs-identifier hs-type">getGlobalRdrEnv</span></a></span><span>
</span><span id="line-1829"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621683117447"><span class="annot"><a href="#local-6989586621683117447"><span class="hs-identifier hs-var hs-var">dflags</span></a></span></span><span>    </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">HscEnv -&gt; DynFlags
</span><a href="GHC.Driver.Env.Types.html#hsc_dflags"><span class="hs-identifier hs-var">hsc_dflags</span></a></span><span> </span><span class="annot"><span class="annottext">HscEnv
</span><a href="#local-6989586621683117440"><span class="hs-identifier hs-var">hsc_env</span></a></span><span>
</span><span id="line-1830"></span><span>             </span><span id="local-6989586621683117448"><span class="annot"><a href="#local-6989586621683117448"><span class="hs-identifier hs-var hs-var">main_occ</span></a></span></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">DynFlags -&gt; OccName
</span><a href="GHC.Tc.Module.html#getMainOcc"><span class="hs-identifier hs-var">getMainOcc</span></a></span><span> </span><span class="annot"><span class="annottext">DynFlags
</span><a href="#local-6989586621683117447"><span class="hs-identifier hs-var">dflags</span></a></span><span>
</span><span id="line-1831"></span><span>             </span><span id="local-6989586621683117450"><span class="annot"><a href="#local-6989586621683117450"><span class="hs-identifier hs-var hs-var">main_gres</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">GlobalRdrEnv -&gt; LookupGRE GREInfo -&gt; [GlobalRdrElt]
forall info.
GlobalRdrEnvX info -&gt; LookupGRE info -&gt; [GlobalRdrEltX info]
</span><a href="GHC.Types.Name.Reader.html#lookupGRE"><span class="hs-identifier hs-var">lookupGRE</span></a></span><span> </span><span class="annot"><span class="annottext">GlobalRdrEnv
</span><a href="#local-6989586621683117446"><span class="hs-identifier hs-var">rdr_env</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">OccName -&gt; WhichGREs GREInfo -&gt; LookupGRE GREInfo
forall info. OccName -&gt; WhichGREs info -&gt; LookupGRE info
</span><a href="GHC.Types.Name.Reader.html#LookupOccName"><span class="hs-identifier hs-var">LookupOccName</span></a></span><span> </span><span class="annot"><span class="annottext">OccName
</span><a href="#local-6989586621683117448"><span class="hs-identifier hs-var">main_occ</span></a></span><span> </span><span class="annot"><span class="annottext">WhichGREs GREInfo
forall info. WhichGREs info
</span><a href="GHC.Types.Name.Reader.html#SameNameSpace"><span class="hs-identifier hs-var">SameNameSpace</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1832"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="hs-identifier hs-type">filter</span></span><span> </span><span class="annot"><a href="GHC.Types.Name.Reader.html#isLocalGRE"><span class="hs-identifier hs-type">isLocalGRE</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683117450"><span class="hs-identifier hs-type">main_gres</span></a></span><span> </span><span class="hs-keyword">of</span><span> </span><span class="hs-special">{</span><span>
</span><span id="line-1833"></span><span>            </span><span class="hs-special">[</span><span class="hs-special">]</span><span>         </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">WantedConstraints -&gt; TcRn WantedConstraints
forall a. a -&gt; IOEnv (Env TcGblEnv TcLclEnv) a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="annot"><span class="annottext">WantedConstraints
</span><a href="GHC.Tc.Types.Constraint.html#emptyWC"><span class="hs-identifier hs-var">emptyWC</span></a></span><span> </span><span class="hs-special">;</span><span>
</span><span id="line-1834"></span><span>            </span><span class="hs-special">(</span><span class="annot"><span class="annottext">GlobalRdrElt
</span><span class="hs-identifier">_</span></span><span class="annot"><span class="hs-glyph hs-type">:</span></span><span class="annot"><span class="annottext">GlobalRdrElt
</span><span class="hs-identifier">_</span></span><span class="annot"><span class="hs-glyph hs-type">:</span></span><span class="annot"><span class="annottext">[GlobalRdrElt]
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">WantedConstraints -&gt; TcRn WantedConstraints
forall a. a -&gt; IOEnv (Env TcGblEnv TcLclEnv) a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="annot"><span class="annottext">WantedConstraints
</span><a href="GHC.Tc.Types.Constraint.html#emptyWC"><span class="hs-identifier hs-var">emptyWC</span></a></span><span> </span><span class="hs-special">;</span><span>
</span><span id="line-1835"></span><span>            </span><span class="hs-special">[</span><span id="local-6989586621683117453"><span class="annot"><span class="annottext">GlobalRdrElt
</span><a href="#local-6989586621683117453"><span class="hs-identifier hs-var">main_gre</span></a></span></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-1836"></span><span>
</span><span id="line-1837"></span><span>    </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621683117454"><span class="annot"><span class="annottext">main_name :: Name
</span><a href="#local-6989586621683117454"><span class="hs-identifier hs-var hs-var hs-var">main_name</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">GlobalRdrElt -&gt; Name
forall info. GlobalRdrEltX info -&gt; Name
</span><a href="GHC.Types.Name.Reader.html#greName"><span class="hs-identifier hs-var">greName</span></a></span><span> </span><span class="annot"><span class="annottext">GlobalRdrElt
</span><a href="#local-6989586621683117453"><span class="hs-identifier hs-var">main_gre</span></a></span><span>
</span><span id="line-1838"></span><span>             </span><span id="local-6989586621683117455"><span class="annot"><span class="annottext">ctxt :: UserTypeCtxt
</span><a href="#local-6989586621683117455"><span class="hs-identifier hs-var hs-var hs-var">ctxt</span></a></span></span><span>      </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Name -&gt; ReportRedundantConstraints -&gt; UserTypeCtxt
</span><a href="GHC.Tc.Types.Origin.html#FunSigCtxt"><span class="hs-identifier hs-var">FunSigCtxt</span></a></span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621683117454"><span class="hs-identifier hs-var">main_name</span></a></span><span> </span><span class="annot"><span class="annottext">ReportRedundantConstraints
</span><a href="GHC.Tc.Types.Origin.html#NoRRC"><span class="hs-identifier hs-var">NoRRC</span></a></span><span>
</span><span id="line-1839"></span><span>       </span><span class="hs-special">;</span><span> </span><span id="local-6989586621683117458"><span class="annot"><a href="#local-6989586621683117458"><span class="hs-identifier hs-var">main_id</span></a></span></span><span>   </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Name -&gt; TcM Id
</span><a href="GHC.Tc.Utils.Env.html#tcLookupId"><span class="hs-identifier hs-var">tcLookupId</span></a></span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621683117454"><span class="hs-identifier hs-var">main_name</span></a></span><span>
</span><span id="line-1840"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="hs-special">(</span><span id="local-6989586621683117460"><span class="annot"><a href="#local-6989586621683117460"><span class="hs-identifier hs-var">io_ty</span></a></span></span><span class="hs-special">,</span><span class="annot"><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><a href="GHC.Tc.Module.html#getIOType"><span class="hs-identifier hs-type">getIOType</span></a></span><span>
</span><span id="line-1841"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621683117462"><span class="annot"><a href="#local-6989586621683117462"><span class="hs-identifier hs-var hs-var">main_ty</span></a></span></span><span>   </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Id -&gt; Type
</span><a href="GHC.Types.Id.html#idType"><span class="hs-identifier hs-var">idType</span></a></span><span> </span><span class="annot"><span class="annottext">Id
</span><a href="#local-6989586621683117458"><span class="hs-identifier hs-var">main_id</span></a></span><span>
</span><span id="line-1842"></span><span>             </span><span id="local-6989586621683117463"><span class="annot"><a href="#local-6989586621683117463"><span class="hs-identifier hs-var hs-var">eq_orig</span></a></span></span><span>   </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="GHC.Tc.Types.Origin.html#TypeEqOrigin"><span class="hs-identifier hs-type">TypeEqOrigin</span></a></span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">uo_actual :: Type
</span><a href="GHC.Tc.Types.Origin.html#uo_actual"><span class="hs-identifier hs-var">uo_actual</span></a></span><span>   </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621683117462"><span class="hs-identifier hs-var">main_ty</span></a></span><span>
</span><span id="line-1843"></span><span>                                      </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">uo_expected :: Type
</span><a href="GHC.Tc.Types.Origin.html#uo_expected"><span class="hs-identifier hs-var">uo_expected</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621683117460"><span class="hs-identifier hs-var">io_ty</span></a></span><span>
</span><span id="line-1844"></span><span>                                      </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">uo_thing :: Maybe TypedThing
</span><a href="GHC.Tc.Types.Origin.html#uo_thing"><span class="hs-identifier hs-var">uo_thing</span></a></span><span>    </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Maybe TypedThing
forall a. Maybe a
</span><span class="hs-identifier hs-var">Nothing</span></span><span>
</span><span id="line-1845"></span><span>                                      </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">uo_visible :: Bool
</span><a href="GHC.Tc.Types.Origin.html#uo_visible"><span class="hs-identifier hs-var">uo_visible</span></a></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">True</span></span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-1846"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">_</span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621683117469"><span class="annot"><a href="#local-6989586621683117469"><span class="hs-identifier hs-var">lie</span></a></span></span><span class="hs-special">)</span><span>  </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><a href="GHC.Tc.Solver.html#captureTopConstraints"><span class="hs-identifier hs-type">captureTopConstraints</span></a></span><span>       </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span>
</span><span id="line-1847"></span><span>                      </span><span class="annot"><a href="GHC.Tc.Module.html#setMainCtxt"><span class="hs-identifier hs-type">setMainCtxt</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683117454"><span class="hs-identifier hs-type">main_name</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683117460"><span class="hs-identifier hs-type">io_ty</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span>
</span><span id="line-1848"></span><span>                      </span><span class="annot"><a href="GHC.Tc.Utils.Unify.html#tcSubTypeSigma"><span class="hs-identifier hs-type">tcSubTypeSigma</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683117463"><span class="hs-identifier hs-type">eq_orig</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683117455"><span class="hs-identifier hs-type">ctxt</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683117462"><span class="hs-identifier hs-type">main_ty</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683117460"><span class="hs-identifier hs-type">io_ty</span></a></span><span>
</span><span id="line-1849"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">return</span></span><span> </span><span class="annot"><a href="#local-6989586621683117469"><span class="hs-identifier hs-type">lie</span></a></span><span> </span><span class="hs-special">}</span><span> </span><span class="hs-special">}</span><span> </span><span class="hs-special">}</span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-1850"></span><span>
</span><span id="line-1851"></span><span class="annot"><a href="GHC.Tc.Module.html#checkMain"><span class="hs-identifier hs-type">checkMain</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Bool</span></span><span>  </span><span class="hs-comment">-- False =&gt; no 'module M(..) where' header at all</span><span>
</span><span id="line-1852"></span><span>          </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Maybe</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Parser.Annotation.html#LocatedLI"><span class="hs-identifier hs-type">LocatedLI</span></a></span><span> </span><span class="hs-special">[</span><span class="annot"><a href="Language.Haskell.Syntax.ImpExp.html#LIE"><span class="hs-identifier hs-type">LIE</span></a></span><span> </span><span class="annot"><a href="GHC.Hs.Extension.html#GhcPs"><span class="hs-identifier hs-type">GhcPs</span></a></span><span class="hs-special">]</span><span class="hs-special">)</span><span>  </span><span class="hs-comment">-- Export specs of Main module</span><span>
</span><span id="line-1853"></span><span>          </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#TcM"><span class="hs-identifier hs-type">TcM</span></a></span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#TcGblEnv"><span class="hs-identifier hs-type">TcGblEnv</span></a></span><span>
</span><span id="line-1854"></span><span class="hs-comment">-- If we are in module Main, check that 'main' is exported,</span><span>
</span><span id="line-1855"></span><span class="hs-comment">-- and generate the runMainIO binding that calls it</span><span>
</span><span id="line-1856"></span><span class="hs-comment">-- See Note [Dealing with main]</span><span>
</span><span id="line-1857"></span><span id="checkMain"><span class="annot"><span class="annottext">checkMain :: Bool
-&gt; Maybe (GenLocated SrcSpanAnnLI [XRec GhcPs (IE GhcPs)])
-&gt; TcM TcGblEnv
</span><a href="GHC.Tc.Module.html#checkMain"><span class="hs-identifier hs-var hs-var">checkMain</span></a></span></span><span> </span><span id="local-6989586621683117471"><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621683117471"><span class="hs-identifier hs-var">explicit_mod_hdr</span></a></span></span><span> </span><span id="local-6989586621683117472"><span class="annot"><span class="annottext">Maybe (GenLocated SrcSpanAnnLI [XRec GhcPs (IE GhcPs)])
</span><a href="#local-6989586621683117472"><span class="hs-identifier hs-var">export_ies</span></a></span></span><span>
</span><span id="line-1858"></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span id="local-6989586621683117473"><span class="annot"><a href="#local-6989586621683117473"><span class="hs-identifier hs-var">hsc_env</span></a></span></span><span>  </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">TcRnIf TcGblEnv TcLclEnv HscEnv
forall gbl lcl. TcRnIf gbl lcl HscEnv
</span><a href="GHC.Tc.Utils.Monad.html#getTopEnv"><span class="hs-identifier hs-var">getTopEnv</span></a></span><span>
</span><span id="line-1859"></span><span>      </span><span class="hs-special">;</span><span> </span><span id="local-6989586621683117474"><span class="annot"><a href="#local-6989586621683117474"><span class="hs-identifier hs-var">tcg_env</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.Monad.html#getGblEnv"><span class="hs-identifier hs-type">getGblEnv</span></a></span><span>
</span><span id="line-1860"></span><span>
</span><span id="line-1861"></span><span>      </span><span class="hs-special">;</span><span> </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621683117475"><span class="annot"><a href="#local-6989586621683117475"><span class="hs-identifier hs-var hs-var">dflags</span></a></span></span><span>      </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">HscEnv -&gt; DynFlags
</span><a href="GHC.Driver.Env.Types.html#hsc_dflags"><span class="hs-identifier hs-var">hsc_dflags</span></a></span><span> </span><span class="annot"><span class="annottext">HscEnv
</span><a href="#local-6989586621683117473"><span class="hs-identifier hs-var">hsc_env</span></a></span><span>
</span><span id="line-1862"></span><span>            </span><span id="local-6989586621683117476"><span class="annot"><a href="#local-6989586621683117476"><span class="hs-identifier hs-var hs-var">main_mod</span></a></span></span><span>    </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">HomeUnitEnv -&gt; Module
</span><a href="GHC.Driver.Env.html#mainModIs"><span class="hs-identifier hs-var">mainModIs</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">HscEnv -&gt; HomeUnitEnv
</span><a href="GHC.Driver.Env.html#hsc_HUE"><span class="hs-identifier hs-var">hsc_HUE</span></a></span><span> </span><span class="annot"><span class="annottext">HscEnv
</span><a href="#local-6989586621683117473"><span class="hs-identifier hs-var">hsc_env</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1863"></span><span>            </span><span id="local-6989586621683117477"><span class="annot"><a href="#local-6989586621683117477"><span class="hs-identifier hs-var hs-var">main_occ</span></a></span></span><span>    </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">DynFlags -&gt; OccName
</span><a href="GHC.Tc.Module.html#getMainOcc"><span class="hs-identifier hs-var">getMainOcc</span></a></span><span> </span><span class="annot"><span class="annottext">DynFlags
</span><a href="#local-6989586621683117475"><span class="hs-identifier hs-var">dflags</span></a></span><span>
</span><span id="line-1864"></span><span>
</span><span id="line-1865"></span><span>            </span><span class="annot"><a href="#local-6989586621683117478"><span class="hs-identifier hs-type">exported_mains</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="GHC.Types.Name.html#Name"><span class="hs-identifier hs-type">Name</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-1866"></span><span>            </span><span class="hs-comment">-- Exported things that are called 'main'</span><span>
</span><span id="line-1867"></span><span>            </span><span id="local-6989586621683117478"><span class="annot"><a href="#local-6989586621683117478"><span class="hs-identifier hs-var hs-var">exported_mains</span></a></span></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621683117479"><span class="hs-identifier hs-var">name</span></a></span><span> </span><span class="hs-glyph">|</span><span> </span><span id="local-6989586621683117480"><span class="annot"><span class="annottext">AvailInfo
</span><a href="#local-6989586621683117480"><span class="hs-identifier hs-var">avail</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">TcGblEnv -&gt; [AvailInfo]
</span><a href="GHC.Tc.Types.html#tcg_exports"><span class="hs-identifier hs-var">tcg_exports</span></a></span><span> </span><span class="annot"><span class="annottext">TcGblEnv
</span><a href="#local-6989586621683117474"><span class="hs-identifier hs-var">tcg_env</span></a></span><span>
</span><span id="line-1868"></span><span>                                     </span><span class="hs-special">,</span><span> </span><span id="local-6989586621683117479"><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621683117479"><span class="hs-identifier hs-var">name</span></a></span></span><span>  </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">AvailInfo -&gt; [Name]
</span><a href="GHC.Types.Avail.html#availNames"><span class="hs-identifier hs-var">availNames</span></a></span><span> </span><span class="annot"><span class="annottext">AvailInfo
</span><a href="#local-6989586621683117480"><span class="hs-identifier hs-var">avail</span></a></span><span>
</span><span id="line-1869"></span><span>                                     </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Name -&gt; OccName
</span><a href="GHC.Types.Name.html#nameOccName"><span class="hs-identifier hs-var">nameOccName</span></a></span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621683117479"><span class="hs-identifier hs-var">name</span></a></span><span> </span><span class="annot"><span class="annottext">OccName -&gt; OccName -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">==</span></span><span> </span><span class="annot"><span class="annottext">OccName
</span><a href="#local-6989586621683117477"><span class="hs-identifier hs-var">main_occ</span></a></span><span> </span><span class="hs-special">]</span><span>
</span><span id="line-1870"></span><span>
</span><span id="line-1871"></span><span>      </span><span class="hs-special">;</span><span> </span><span class="hs-keyword">if</span><span> </span><span class="hs-glyph">|</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#tcg_mod"><span class="hs-identifier hs-var">tcg_mod</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683117474"><span class="hs-identifier hs-type">tcg_env</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">/=</span></span><span> </span><span class="annot"><a href="#local-6989586621683117476"><span class="hs-identifier hs-type">main_mod</span></a></span><span>
</span><span id="line-1872"></span><span>           </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-comment">-- Not the main module</span><span>
</span><span id="line-1873"></span><span>              </span><span class="annot"><span class="hs-identifier hs-type">return</span></span><span> </span><span class="annot"><a href="#local-6989586621683117474"><span class="hs-identifier hs-type">tcg_env</span></a></span><span>
</span><span id="line-1874"></span><span>
</span><span id="line-1875"></span><span>           </span><span class="hs-glyph">|</span><span> </span><span class="hs-special">[</span><span id="local-6989586621683117481"><span class="annot"><a href="#local-6989586621683117481"><span class="hs-identifier hs-var">main_name</span></a></span></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><a href="#local-6989586621683117478"><span class="hs-identifier hs-type">exported_mains</span></a></span><span>
</span><span id="line-1876"></span><span>           </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-comment">-- The module indeed exports a function called 'main'</span><span>
</span><span id="line-1877"></span><span>              </span><span class="annot"><a href="GHC.Tc.Module.html#generateMainBinding"><span class="hs-identifier hs-type">generateMainBinding</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683117474"><span class="hs-identifier hs-type">tcg_env</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683117481"><span class="hs-identifier hs-type">main_name</span></a></span><span>
</span><span id="line-1878"></span><span>
</span><span id="line-1879"></span><span>           </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="hs-identifier hs-type">otherwise</span></span><span>
</span><span id="line-1880"></span><span>           </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Utils.Panic.Plain.html#assert"><span class="hs-identifier hs-type">assert</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">null</span></span><span> </span><span class="annot"><a href="#local-6989586621683117478"><span class="hs-identifier hs-type">exported_mains</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span>
</span><span id="line-1881"></span><span>              </span><span class="hs-comment">-- A fully-checked export list can't contain more</span><span>
</span><span id="line-1882"></span><span>              </span><span class="hs-comment">-- than one function with the same OccName</span><span>
</span><span id="line-1883"></span><span>              </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><a href="#local-6989586621683117483"><span class="hs-identifier hs-type">complain_no_main</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683117475"><span class="hs-identifier hs-type">dflags</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683117476"><span class="hs-identifier hs-type">main_mod</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683117477"><span class="hs-identifier hs-type">main_occ</span></a></span><span>
</span><span id="line-1884"></span><span>                 </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">return</span></span><span> </span><span class="annot"><a href="#local-6989586621683117474"><span class="hs-identifier hs-type">tcg_env</span></a></span><span> </span><span class="hs-special">}</span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-1885"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-1886"></span><span>    </span><span id="local-6989586621683117483"><span class="annot"><span class="annottext">complain_no_main :: DynFlags -&gt; Module -&gt; OccName -&gt; IOEnv (Env TcGblEnv TcLclEnv) ()
</span><a href="#local-6989586621683117483"><span class="hs-identifier hs-var hs-var">complain_no_main</span></a></span></span><span> </span><span id="local-6989586621683117484"><span class="annot"><span class="annottext">DynFlags
</span><a href="#local-6989586621683117484"><span class="hs-identifier hs-var">dflags</span></a></span></span><span> </span><span id="local-6989586621683117485"><span class="annot"><span class="annottext">Module
</span><a href="#local-6989586621683117485"><span class="hs-identifier hs-var">main_mod</span></a></span></span><span> </span><span id="local-6989586621683117486"><span class="annot"><span class="annottext">OccName
</span><a href="#local-6989586621683117486"><span class="hs-identifier hs-var">main_occ</span></a></span></span><span>
</span><span id="line-1887"></span><span>      </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Bool
-&gt; IOEnv (Env TcGblEnv TcLclEnv) ()
-&gt; IOEnv (Env TcGblEnv TcLclEnv) ()
forall (f :: * -&gt; *). Applicative f =&gt; Bool -&gt; f () -&gt; f ()
</span><span class="hs-identifier hs-var">unless</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621683117487"><span class="hs-identifier hs-var">interactive</span></a></span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Bool -&gt; Bool
</span><span class="hs-operator hs-var">&amp;&amp;</span></span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Bool
</span><span class="hs-identifier hs-var">not</span></span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621683117471"><span class="hs-identifier hs-var">explicit_mod_hdr</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(IOEnv (Env TcGblEnv TcLclEnv) ()
 -&gt; IOEnv (Env TcGblEnv TcLclEnv) ())
-&gt; IOEnv (Env TcGblEnv TcLclEnv) ()
-&gt; IOEnv (Env TcGblEnv TcLclEnv) ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-1888"></span><span>        </span><span class="annot"><span class="annottext">TcRnMessage -&gt; IOEnv (Env TcGblEnv TcLclEnv) ()
</span><a href="GHC.Tc.Utils.Monad.html#addErrTc"><span class="hs-identifier hs-var">addErrTc</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Module -&gt; OccName -&gt; TcRnMessage
</span><a href="#local-6989586621683117488"><span class="hs-identifier hs-var">noMainMsg</span></a></span><span> </span><span class="annot"><span class="annottext">Module
</span><a href="#local-6989586621683117485"><span class="hs-identifier hs-var">main_mod</span></a></span><span> </span><span class="annot"><span class="annottext">OccName
</span><a href="#local-6989586621683117486"><span class="hs-identifier hs-var">main_occ</span></a></span><span class="hs-special">)</span><span>          </span><span class="hs-comment">-- #12906</span><span>
</span><span id="line-1889"></span><span>      </span><span class="hs-keyword">where</span><span>
</span><span id="line-1890"></span><span>        </span><span id="local-6989586621683117487"><span class="annot"><span class="annottext">interactive :: Bool
</span><a href="#local-6989586621683117487"><span class="hs-identifier hs-var hs-var">interactive</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">DynFlags -&gt; GhcLink
</span><a href="GHC.Driver.DynFlags.html#ghcLink"><span class="hs-identifier hs-var">ghcLink</span></a></span><span> </span><span class="annot"><span class="annottext">DynFlags
</span><a href="#local-6989586621683117484"><span class="hs-identifier hs-var">dflags</span></a></span><span> </span><span class="annot"><span class="annottext">GhcLink -&gt; GhcLink -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">==</span></span><span> </span><span class="annot"><span class="annottext">GhcLink
</span><a href="GHC.Driver.DynFlags.html#LinkInMemory"><span class="hs-identifier hs-var">LinkInMemory</span></a></span><span>
</span><span id="line-1891"></span><span>        </span><span class="hs-comment">-- Without an explicit module header...</span><span>
</span><span id="line-1892"></span><span>        </span><span class="hs-comment">-- in interactive mode, don't worry about the absence of 'main'.</span><span>
</span><span id="line-1893"></span><span>        </span><span class="hs-comment">-- in other modes, add error message and go on with typechecking.</span><span>
</span><span id="line-1894"></span><span>
</span><span id="line-1895"></span><span>    </span><span id="local-6989586621683117488"><span class="annot"><span class="annottext">noMainMsg :: Module -&gt; OccName -&gt; TcRnMessage
</span><a href="#local-6989586621683117488"><span class="hs-identifier hs-var hs-var">noMainMsg</span></a></span></span><span> </span><span id="local-6989586621683117491"><span class="annot"><span class="annottext">Module
</span><a href="#local-6989586621683117491"><span class="hs-identifier hs-var">main_mod</span></a></span></span><span> </span><span id="local-6989586621683117492"><span class="annot"><span class="annottext">OccName
</span><a href="#local-6989586621683117492"><span class="hs-identifier hs-var">main_occ</span></a></span></span><span>
</span><span id="line-1896"></span><span>      </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Module -&gt; OccName -&gt; TcRnMessage
</span><a href="GHC.Tc.Errors.Types.html#TcRnMissingMain"><span class="hs-identifier hs-var">TcRnMissingMain</span></a></span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621683117494"><span class="hs-identifier hs-var">explicit_export_list</span></a></span><span> </span><span class="annot"><span class="annottext">Module
</span><a href="#local-6989586621683117491"><span class="hs-identifier hs-var">main_mod</span></a></span><span> </span><span class="annot"><span class="annottext">OccName
</span><a href="#local-6989586621683117492"><span class="hs-identifier hs-var">main_occ</span></a></span><span>
</span><span id="line-1897"></span><span>    </span><span id="local-6989586621683117494"><span class="annot"><span class="annottext">explicit_export_list :: Bool
</span><a href="#local-6989586621683117494"><span class="hs-identifier hs-var hs-var">explicit_export_list</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621683117471"><span class="hs-identifier hs-var">explicit_mod_hdr</span></a></span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Bool -&gt; Bool
</span><span class="hs-operator hs-var">&amp;&amp;</span></span><span> </span><span class="annot"><span class="annottext">Maybe (GenLocated SrcSpanAnnLI [GenLocated SrcSpanAnnA (IE GhcPs)])
-&gt; Bool
forall a. Maybe a -&gt; Bool
</span><span class="hs-identifier hs-var">isJust</span></span><span> </span><span class="annot"><span class="annottext">Maybe (GenLocated SrcSpanAnnLI [XRec GhcPs (IE GhcPs)])
Maybe (GenLocated SrcSpanAnnLI [GenLocated SrcSpanAnnA (IE GhcPs)])
</span><a href="#local-6989586621683117472"><span class="hs-identifier hs-var">export_ies</span></a></span><span>
</span><span id="line-1898"></span><span>
</span><span id="line-1899"></span><span class="hs-comment">-- | Get the unqualified name of the function to use as the \&quot;main\&quot; for the main module.</span><span>
</span><span id="line-1900"></span><span class="hs-comment">-- Either returns the default name or the one configured on the command line with -main-is</span><span>
</span><span id="line-1901"></span><span class="annot"><a href="GHC.Tc.Module.html#getMainOcc"><span class="hs-identifier hs-type">getMainOcc</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Driver.DynFlags.html#DynFlags"><span class="hs-identifier hs-type">DynFlags</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Types.Name.Occurrence.html#OccName"><span class="hs-identifier hs-type">OccName</span></a></span><span>
</span><span id="line-1902"></span><span id="getMainOcc"><span class="annot"><span class="annottext">getMainOcc :: DynFlags -&gt; OccName
</span><a href="GHC.Tc.Module.html#getMainOcc"><span class="hs-identifier hs-var hs-var">getMainOcc</span></a></span></span><span> </span><span id="local-6989586621683117495"><span class="annot"><span class="annottext">DynFlags
</span><a href="#local-6989586621683117495"><span class="hs-identifier hs-var">dflags</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">DynFlags -&gt; Maybe String
</span><a href="GHC.Driver.DynFlags.html#mainFunIs"><span class="hs-identifier hs-var">mainFunIs</span></a></span><span> </span><span class="annot"><span class="annottext">DynFlags
</span><a href="#local-6989586621683117495"><span class="hs-identifier hs-var">dflags</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-1903"></span><span>                      </span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span id="local-6989586621683117497"><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621683117497"><span class="hs-identifier hs-var">fn</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">FastString -&gt; OccName
</span><a href="GHC.Types.Name.Occurrence.html#mkVarOccFS"><span class="hs-identifier hs-var">mkVarOccFS</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">String -&gt; FastString
</span><a href="GHC.Data.FastString.html#mkFastString"><span class="hs-identifier hs-var">mkFastString</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621683117497"><span class="hs-identifier hs-var">fn</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1904"></span><span>                      </span><span class="annot"><span class="annottext">Maybe String
</span><span class="hs-identifier hs-var">Nothing</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">FastString -&gt; OccName
</span><a href="GHC.Types.Name.Occurrence.html#mkVarOccFS"><span class="hs-identifier hs-var">mkVarOccFS</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">String -&gt; FastString
</span><a href="GHC.Data.FastString.html#fsLit"><span class="hs-identifier hs-var">fsLit</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;main&quot;</span></span><span class="hs-special">)</span><span>
</span><span id="line-1905"></span><span>
</span><span id="line-1906"></span><span class="annot"><a href="GHC.Tc.Module.html#generateMainBinding"><span class="hs-identifier hs-type">generateMainBinding</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#TcGblEnv"><span class="hs-identifier hs-type">TcGblEnv</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Types.Name.html#Name"><span class="hs-identifier hs-type">Name</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#TcM"><span class="hs-identifier hs-type">TcM</span></a></span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#TcGblEnv"><span class="hs-identifier hs-type">TcGblEnv</span></a></span><span>
</span><span id="line-1907"></span><span class="hs-comment">-- There is a single exported 'main' function, called 'foo' (say),</span><span>
</span><span id="line-1908"></span><span class="hs-comment">-- which may be locally defined or imported</span><span>
</span><span id="line-1909"></span><span class="hs-comment">-- Define and typecheck the binding</span><span>
</span><span id="line-1910"></span><span class="hs-comment">--     :Main.main :: IO res_ty = runMainIO res_ty foo</span><span>
</span><span id="line-1911"></span><span class="hs-comment">-- This wraps the user's main function in the top-level stuff</span><span>
</span><span id="line-1912"></span><span class="hs-comment">-- defined in runMainIO (eg catching otherwise un-caught exceptions)</span><span>
</span><span id="line-1913"></span><span class="hs-comment">-- See Note [Dealing with main]</span><span>
</span><span id="line-1914"></span><span id="generateMainBinding"><span class="annot"><span class="annottext">generateMainBinding :: TcGblEnv -&gt; Name -&gt; TcM TcGblEnv
</span><a href="GHC.Tc.Module.html#generateMainBinding"><span class="hs-identifier hs-var hs-var">generateMainBinding</span></a></span></span><span> </span><span id="local-6989586621683117501"><span class="annot"><span class="annottext">TcGblEnv
</span><a href="#local-6989586621683117501"><span class="hs-identifier hs-var">tcg_env</span></a></span></span><span> </span><span id="local-6989586621683117502"><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621683117502"><span class="hs-identifier hs-var">main_name</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-1915"></span><span>    </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">String -&gt; SDoc -&gt; IOEnv (Env TcGblEnv TcLclEnv) ()
</span><a href="GHC.Tc.Utils.Monad.html#traceTc"><span class="hs-identifier hs-var">traceTc</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;checkMain found&quot;</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Name -&gt; SDoc
forall a. Outputable a =&gt; a -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621683117502"><span class="hs-identifier hs-var">main_name</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1916"></span><span>    </span><span class="hs-special">;</span><span> </span><span class="hs-special">(</span><span id="local-6989586621683117503"><span class="annot"><a href="#local-6989586621683117503"><span class="hs-identifier hs-var">io_ty</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621683117504"><span class="annot"><a href="#local-6989586621683117504"><span class="hs-identifier hs-var">res_ty</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">TcM (Type, Type)
</span><a href="GHC.Tc.Module.html#getIOType"><span class="hs-identifier hs-var">getIOType</span></a></span><span>
</span><span id="line-1917"></span><span>    </span><span class="hs-special">;</span><span> </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621683117505"><span class="annot"><a href="#local-6989586621683117505"><span class="hs-identifier hs-var hs-var">loc</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Name -&gt; SrcSpan
forall a. NamedThing a =&gt; a -&gt; SrcSpan
</span><a href="GHC.Types.Name.html#getSrcSpan"><span class="hs-identifier hs-var">getSrcSpan</span></a></span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621683117502"><span class="hs-identifier hs-var">main_name</span></a></span><span>
</span><span id="line-1918"></span><span>          </span><span id="local-6989586621683117507"><span class="annot"><a href="#local-6989586621683117507"><span class="hs-identifier hs-var hs-var">main_expr_rn</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">SrcSpanAnnA
-&gt; HsExpr (GhcPass 'Renamed)
-&gt; GenLocated SrcSpanAnnA (HsExpr (GhcPass 'Renamed))
forall l e. l -&gt; e -&gt; GenLocated l e
</span><a href="GHC.Types.SrcLoc.html#L"><span class="hs-identifier hs-var">L</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">SrcSpan -&gt; SrcSpanAnnA
forall e. HasAnnotation e =&gt; SrcSpan -&gt; e
</span><a href="GHC.Parser.Annotation.html#noAnnSrcSpan"><span class="hs-identifier hs-var">noAnnSrcSpan</span></a></span><span> </span><span class="annot"><span class="annottext">SrcSpan
</span><a href="#local-6989586621683117505"><span class="hs-identifier hs-var">loc</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">XVar (GhcPass 'Renamed)
-&gt; LIdP (GhcPass 'Renamed) -&gt; HsExpr (GhcPass 'Renamed)
forall p. XVar p -&gt; LIdP p -&gt; HsExpr p
</span><a href="Language.Haskell.Syntax.Expr.html#HsVar"><span class="hs-identifier hs-var">HsVar</span></a></span><span> </span><span class="annot"><span class="annottext">XVar (GhcPass 'Renamed)
NoExtField
</span><a href="Language.Haskell.Syntax.Extension.html#noExtField"><span class="hs-identifier hs-var">noExtField</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">SrcSpanAnnN -&gt; Name -&gt; GenLocated SrcSpanAnnN Name
forall l e. l -&gt; e -&gt; GenLocated l e
</span><a href="GHC.Types.SrcLoc.html#L"><span class="hs-identifier hs-var">L</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">SrcSpan -&gt; SrcSpanAnnN
forall e. HasAnnotation e =&gt; SrcSpan -&gt; e
</span><a href="GHC.Parser.Annotation.html#noAnnSrcSpan"><span class="hs-identifier hs-var">noAnnSrcSpan</span></a></span><span> </span><span class="annot"><span class="annottext">SrcSpan
</span><a href="#local-6989586621683117505"><span class="hs-identifier hs-var">loc</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621683117502"><span class="hs-identifier hs-var">main_name</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-1919"></span><span>    </span><span class="hs-special">;</span><span> </span><span class="hs-special">(</span><span id="local-6989586621683117511"><span class="annot"><a href="#local-6989586621683117511"><span class="hs-identifier hs-var">ev_binds</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621683117512"><span class="annot"><a href="#local-6989586621683117512"><span class="hs-identifier hs-var">main_expr</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><a href="GHC.Tc.Module.html#setMainCtxt"><span class="hs-identifier hs-type">setMainCtxt</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683117502"><span class="hs-identifier hs-type">main_name</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683117503"><span class="hs-identifier hs-type">io_ty</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span>
</span><span id="line-1920"></span><span>                               </span><span class="annot"><a href="GHC.Tc.Gen.Expr.html#tcCheckMonoExpr"><span class="hs-identifier hs-type">tcCheckMonoExpr</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683117507"><span class="hs-identifier hs-type">main_expr_rn</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683117503"><span class="hs-identifier hs-type">io_ty</span></a></span><span>
</span><span id="line-1921"></span><span>
</span><span id="line-1922"></span><span>            </span><span class="hs-comment">-- See Note [Root-main Id]</span><span>
</span><span id="line-1923"></span><span>            </span><span class="hs-comment">-- Construct the binding</span><span>
</span><span id="line-1924"></span><span>            </span><span class="hs-comment">--      :Main.main :: IO res_ty = runMainIO res_ty main</span><span>
</span><span id="line-1925"></span><span>    </span><span class="hs-special">;</span><span> </span><span id="local-6989586621683117514"><span class="annot"><a href="#local-6989586621683117514"><span class="hs-identifier hs-var">run_main_id</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.Env.html#tcLookupId"><span class="hs-identifier hs-type">tcLookupId</span></a></span><span> </span><span class="annot"><a href="GHC.Builtin.Names.html#runMainIOName"><span class="hs-identifier hs-type">runMainIOName</span></a></span><span>
</span><span id="line-1926"></span><span>    </span><span class="hs-special">;</span><span> </span><span class="hs-keyword">let</span><span> </span><span class="hs-special">{</span><span> </span><span id="local-6989586621683117516"><span class="annot"><a href="#local-6989586621683117516"><span class="hs-identifier hs-var hs-var">root_main_name</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>  </span><span class="annot"><span class="annottext">Unique -&gt; Module -&gt; OccName -&gt; SrcSpan -&gt; Name
</span><a href="GHC.Types.Name.html#mkExternalName"><span class="hs-identifier hs-var">mkExternalName</span></a></span><span> </span><span class="annot"><span class="annottext">Unique
</span><a href="GHC.Builtin.Names.html#rootMainKey"><span class="hs-identifier hs-var">rootMainKey</span></a></span><span> </span><span class="annot"><span class="annottext">Module
</span><a href="GHC.Builtin.Names.html#rOOT_MAIN"><span class="hs-identifier hs-var">rOOT_MAIN</span></a></span><span>
</span><span id="line-1927"></span><span>                               </span><span class="hs-special">(</span><span class="annot"><span class="annottext">FastString -&gt; OccName
</span><a href="GHC.Types.Name.Occurrence.html#mkVarOccFS"><span class="hs-identifier hs-var">mkVarOccFS</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">String -&gt; FastString
</span><a href="GHC.Data.FastString.html#fsLit"><span class="hs-identifier hs-var">fsLit</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;main&quot;</span></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-1928"></span><span>                               </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Name -&gt; SrcSpan
forall a. NamedThing a =&gt; a -&gt; SrcSpan
</span><a href="GHC.Types.Name.html#getSrcSpan"><span class="hs-identifier hs-var">getSrcSpan</span></a></span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621683117502"><span class="hs-identifier hs-var">main_name</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1929"></span><span>          </span><span class="hs-special">;</span><span> </span><span id="local-6989586621683117520"><span class="annot"><a href="#local-6989586621683117520"><span class="hs-identifier hs-var hs-var">root_main_id</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Name -&gt; Type -&gt; Id
</span><a href="GHC.Types.Id.html#mkExportedVanillaId"><span class="hs-identifier hs-var">Id.mkExportedVanillaId</span></a></span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621683117516"><span class="hs-identifier hs-var">root_main_name</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621683117503"><span class="hs-identifier hs-var">io_ty</span></a></span><span>
</span><span id="line-1930"></span><span>          </span><span class="hs-special">;</span><span> </span><span id="local-6989586621683117521"><span class="annot"><a href="#local-6989586621683117521"><span class="hs-identifier hs-var hs-var">co</span></a></span></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[Type] -&gt; HsWrapper
</span><a href="GHC.Tc.Types.Evidence.html#mkWpTyApps"><span class="hs-identifier hs-var">mkWpTyApps</span></a></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621683117504"><span class="hs-identifier hs-var">res_ty</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-1931"></span><span>          </span><span class="hs-comment">-- The ev_binds of the `main` function may contain deferred</span><span>
</span><span id="line-1932"></span><span>          </span><span class="hs-comment">-- type errors when type of `main` is not `IO a`. The `ev_binds`</span><span>
</span><span id="line-1933"></span><span>          </span><span class="hs-comment">-- must be put inside `runMainIO` to ensure the deferred type</span><span>
</span><span id="line-1934"></span><span>          </span><span class="hs-comment">-- error can be emitted correctly. See #13838.</span><span>
</span><span id="line-1935"></span><span>          </span><span class="hs-special">;</span><span> </span><span id="local-6989586621683117523"><span class="annot"><a href="#local-6989586621683117523"><span class="hs-identifier hs-var hs-var">rhs</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">LHsExpr GhcTc -&gt; LHsExpr GhcTc -&gt; LHsExpr GhcTc
forall (id :: Pass).
IsPass id =&gt;
LHsExpr (GhcPass id)
-&gt; LHsExpr (GhcPass id) -&gt; LHsExpr (GhcPass id)
</span><a href="GHC.Hs.Utils.html#nlHsApp"><span class="hs-identifier hs-var">nlHsApp</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">HsWrapper -&gt; LHsExpr GhcTc -&gt; LHsExpr GhcTc
</span><a href="GHC.Hs.Utils.html#mkLHsWrap"><span class="hs-identifier hs-var">mkLHsWrap</span></a></span><span> </span><span class="annot"><span class="annottext">HsWrapper
</span><a href="#local-6989586621683117521"><span class="hs-identifier hs-var">co</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">IdP GhcTc -&gt; LHsExpr GhcTc
forall (p :: Pass) a.
IsSrcSpanAnn p a =&gt;
IdP (GhcPass p) -&gt; LHsExpr (GhcPass p)
</span><a href="GHC.Hs.Utils.html#nlHsVar"><span class="hs-identifier hs-var">nlHsVar</span></a></span><span> </span><span class="annot"><span class="annottext">IdP GhcTc
Id
</span><a href="#local-6989586621683117514"><span class="hs-identifier hs-var">run_main_id</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(LHsExpr GhcTc -&gt; LHsExpr GhcTc) -&gt; LHsExpr GhcTc -&gt; LHsExpr GhcTc
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-1936"></span><span>                    </span><span class="annot"><span class="annottext">TcEvBinds -&gt; LHsExpr GhcTc -&gt; LHsExpr GhcTc
</span><a href="GHC.Hs.Utils.html#mkHsDictLet"><span class="hs-identifier hs-var">mkHsDictLet</span></a></span><span> </span><span class="annot"><span class="annottext">TcEvBinds
</span><a href="#local-6989586621683117511"><span class="hs-identifier hs-var">ev_binds</span></a></span><span> </span><span class="annot"><span class="annottext">LHsExpr GhcTc
</span><a href="#local-6989586621683117512"><span class="hs-identifier hs-var">main_expr</span></a></span><span>
</span><span id="line-1937"></span><span>          </span><span class="hs-special">;</span><span> </span><span id="local-6989586621683117527"><span class="annot"><a href="#local-6989586621683117527"><span class="hs-identifier hs-var hs-var">main_bind</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">IdP GhcTc -&gt; LHsExpr GhcTc -&gt; LHsBind GhcTc
</span><a href="GHC.Hs.Utils.html#mkVarBind"><span class="hs-identifier hs-var">mkVarBind</span></a></span><span> </span><span class="annot"><span class="annottext">IdP GhcTc
Id
</span><a href="#local-6989586621683117520"><span class="hs-identifier hs-var">root_main_id</span></a></span><span> </span><span class="annot"><span class="annottext">LHsExpr GhcTc
</span><a href="#local-6989586621683117523"><span class="hs-identifier hs-var">rhs</span></a></span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-1938"></span><span>
</span><span id="line-1939"></span><span>    </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">return</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621683117501"><span class="hs-identifier hs-type">tcg_env</span></a></span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#tcg_main"><span class="hs-identifier hs-var">tcg_main</span></a></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span class="annot"><a href="#local-6989586621683117502"><span class="hs-identifier hs-type">main_name</span></a></span><span>
</span><span id="line-1940"></span><span>                      </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#tcg_binds"><span class="hs-identifier hs-var">tcg_binds</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#tcg_binds"><span class="hs-identifier hs-var">tcg_binds</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683117501"><span class="hs-identifier hs-type">tcg_env</span></a></span><span>
</span><span id="line-1941"></span><span>                                    </span><span class="annot"><span class="hs-operator hs-type">++</span></span><span> </span><span class="hs-special">[</span><span class="annot"><a href="#local-6989586621683117527"><span class="hs-identifier hs-type">main_bind</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-1942"></span><span>                      </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#tcg_dus"><span class="hs-identifier hs-var">tcg_dus</span></a></span><span>   </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#tcg_dus"><span class="hs-identifier hs-var">tcg_dus</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683117501"><span class="hs-identifier hs-type">tcg_env</span></a></span><span>
</span><span id="line-1943"></span><span>                                    </span><span class="annot"><a href="GHC.Types.Name.Set.html#plusDU"><span class="hs-operator hs-type">`plusDU`</span></a></span><span> </span><span class="annot"><a href="GHC.Types.Name.Set.html#usesOnly"><span class="hs-identifier hs-type">usesOnly</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Types.Name.Set.html#unitFV"><span class="hs-identifier hs-type">unitFV</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683117502"><span class="hs-identifier hs-type">main_name</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span class="hs-special">)</span><span>
</span><span id="line-1944"></span><span>                    </span><span class="hs-comment">-- Record the use of 'main', so that we don't</span><span>
</span><span id="line-1945"></span><span>                    </span><span class="hs-comment">-- complain about it being defined but not used</span><span>
</span><span id="line-1946"></span><span>    </span><span class="hs-special">}</span><span>
</span><span id="line-1947"></span><span>
</span><span id="line-1948"></span><span class="annot"><a href="GHC.Tc.Module.html#getIOType"><span class="hs-identifier hs-type">getIOType</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#TcM"><span class="hs-identifier hs-type">TcM</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Tc.Utils.TcType.html#TcType"><span class="hs-identifier hs-type">TcType</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.TcType.html#TcType"><span class="hs-identifier hs-type">TcType</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1949"></span><span class="hs-comment">-- Return (IO alpha, alpha) for fresh alpha</span><span>
</span><span id="line-1950"></span><span id="getIOType"><span class="annot"><span class="annottext">getIOType :: TcM (Type, Type)
</span><a href="GHC.Tc.Module.html#getIOType"><span class="hs-identifier hs-var hs-var">getIOType</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span id="local-6989586621683117531"><span class="annot"><a href="#local-6989586621683117531"><span class="hs-identifier hs-var">ioTyCon</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Name -&gt; TcM TyCon
</span><a href="GHC.Tc.Utils.Env.html#tcLookupTyCon"><span class="hs-identifier hs-var">tcLookupTyCon</span></a></span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="GHC.Builtin.Names.html#ioTyConName"><span class="hs-identifier hs-var">ioTyConName</span></a></span><span>
</span><span id="line-1951"></span><span>               </span><span class="hs-special">;</span><span> </span><span id="local-6989586621683117534"><span class="annot"><a href="#local-6989586621683117534"><span class="hs-identifier hs-var">res_ty</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.TcMType.html#newFlexiTyVarTy"><span class="hs-identifier hs-type">newFlexiTyVarTy</span></a></span><span> </span><span class="annot"><a href="GHC.Builtin.Types.html#liftedTypeKind"><span class="hs-identifier hs-type">liftedTypeKind</span></a></span><span>
</span><span id="line-1952"></span><span>               </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">return</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Core.Type.html#mkTyConApp"><span class="hs-identifier hs-type">mkTyConApp</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683117531"><span class="hs-identifier hs-type">ioTyCon</span></a></span><span> </span><span class="hs-special">[</span><span class="annot"><a href="#local-6989586621683117534"><span class="hs-identifier hs-type">res_ty</span></a></span><span class="hs-special">]</span><span class="hs-special">,</span><span> </span><span class="annot"><a href="#local-6989586621683117534"><span class="hs-identifier hs-type">res_ty</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-1953"></span><span>
</span><span id="line-1954"></span><span id="local-6989586621683115179"><span class="annot"><a href="GHC.Tc.Module.html#setMainCtxt"><span class="hs-identifier hs-type">setMainCtxt</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Types.Name.html#Name"><span class="hs-identifier hs-type">Name</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.TcType.html#TcType"><span class="hs-identifier hs-type">TcType</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#TcM"><span class="hs-identifier hs-type">TcM</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683115179"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#TcM"><span class="hs-identifier hs-type">TcM</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Tc.Types.Evidence.html#TcEvBinds"><span class="hs-identifier hs-type">TcEvBinds</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="#local-6989586621683115179"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">)</span></span><span>
</span><span id="line-1955"></span><span id="setMainCtxt"><span class="annot"><span class="annottext">setMainCtxt :: forall a. Name -&gt; Type -&gt; TcM a -&gt; TcM (TcEvBinds, a)
</span><a href="GHC.Tc.Module.html#setMainCtxt"><span class="hs-identifier hs-var hs-var">setMainCtxt</span></a></span></span><span> </span><span id="local-6989586621683117541"><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621683117541"><span class="hs-identifier hs-var">main_name</span></a></span></span><span> </span><span id="local-6989586621683117542"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621683117542"><span class="hs-identifier hs-var">io_ty</span></a></span></span><span> </span><span id="local-6989586621683117543"><span class="annot"><span class="annottext">TcM a
</span><a href="#local-6989586621683117543"><span class="hs-identifier hs-var">thing_inside</span></a></span></span><span>
</span><span id="line-1956"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">SrcSpan -&gt; TcRn (TcEvBinds, a) -&gt; TcRn (TcEvBinds, a)
forall a. SrcSpan -&gt; TcRn a -&gt; TcRn a
</span><a href="GHC.Tc.Utils.Monad.html#setSrcSpan"><span class="hs-identifier hs-var">setSrcSpan</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Name -&gt; SrcSpan
forall a. NamedThing a =&gt; a -&gt; SrcSpan
</span><a href="GHC.Types.Name.html#getSrcSpan"><span class="hs-identifier hs-var">getSrcSpan</span></a></span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621683117541"><span class="hs-identifier hs-var">main_name</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(TcRn (TcEvBinds, a) -&gt; TcRn (TcEvBinds, a))
-&gt; TcRn (TcEvBinds, a) -&gt; TcRn (TcEvBinds, a)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-1957"></span><span>    </span><span class="annot"><span class="annottext">SDoc -&gt; TcRn (TcEvBinds, a) -&gt; TcRn (TcEvBinds, a)
forall a. SDoc -&gt; TcM a -&gt; TcM a
</span><a href="GHC.Tc.Utils.Monad.html#addErrCtxt"><span class="hs-identifier hs-var">addErrCtxt</span></a></span><span> </span><span class="annot"><span class="annottext">SDoc
</span><a href="#local-6989586621683117545"><span class="hs-identifier hs-var">main_ctxt</span></a></span><span>              </span><span class="annot"><span class="annottext">(TcRn (TcEvBinds, a) -&gt; TcRn (TcEvBinds, a))
-&gt; TcRn (TcEvBinds, a) -&gt; TcRn (TcEvBinds, a)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-1958"></span><span>    </span><span class="annot"><span class="annottext">SkolemInfoAnon -&gt; [Id] -&gt; [Id] -&gt; TcM a -&gt; TcRn (TcEvBinds, a)
forall result.
SkolemInfoAnon
-&gt; [Id] -&gt; [Id] -&gt; TcM result -&gt; TcM (TcEvBinds, result)
</span><a href="GHC.Tc.Utils.Unify.html#checkConstraints"><span class="hs-identifier hs-var">checkConstraints</span></a></span><span> </span><span class="annot"><span class="annottext">SkolemInfoAnon
</span><a href="#local-6989586621683117546"><span class="hs-identifier hs-var">skol_info</span></a></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span>  </span><span class="annot"><span class="annottext">(TcM a -&gt; TcRn (TcEvBinds, a)) -&gt; TcM a -&gt; TcRn (TcEvBinds, a)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>  </span><span class="hs-comment">-- Builds an implication if necessary</span><span>
</span><span id="line-1959"></span><span>    </span><span class="annot"><span class="annottext">TcM a
</span><a href="#local-6989586621683117543"><span class="hs-identifier hs-var">thing_inside</span></a></span><span>                         </span><span class="hs-comment">-- e.g. with -fdefer-type-errors</span><span>
</span><span id="line-1960"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-1961"></span><span>    </span><span id="local-6989586621683117546"><span class="annot"><span class="annottext">skol_info :: SkolemInfoAnon
</span><a href="#local-6989586621683117546"><span class="hs-identifier hs-var hs-var">skol_info</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">UserTypeCtxt -&gt; Type -&gt; [(Name, Id)] -&gt; SkolemInfoAnon
</span><a href="GHC.Tc.Types.Origin.html#SigSkol"><span class="hs-identifier hs-var">SigSkol</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Name -&gt; ReportRedundantConstraints -&gt; UserTypeCtxt
</span><a href="GHC.Tc.Types.Origin.html#FunSigCtxt"><span class="hs-identifier hs-var">FunSigCtxt</span></a></span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621683117541"><span class="hs-identifier hs-var">main_name</span></a></span><span> </span><span class="annot"><span class="annottext">ReportRedundantConstraints
</span><a href="GHC.Tc.Types.Origin.html#NoRRC"><span class="hs-identifier hs-var">NoRRC</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621683117542"><span class="hs-identifier hs-var">io_ty</span></a></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span>
</span><span id="line-1962"></span><span>    </span><span id="local-6989586621683117545"><span class="annot"><span class="annottext">main_ctxt :: SDoc
</span><a href="#local-6989586621683117545"><span class="hs-identifier hs-var hs-var">main_ctxt</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">String -&gt; SDoc
forall doc. IsLine doc =&gt; String -&gt; doc
</span><a href="GHC.Utils.Outputable.html#text"><span class="hs-identifier hs-var">text</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;When checking the type of the&quot;</span></span><span>
</span><span id="line-1963"></span><span>                </span><span class="annot"><span class="annottext">SDoc -&gt; SDoc -&gt; SDoc
forall doc. IsLine doc =&gt; doc -&gt; doc -&gt; doc
</span><a href="GHC.Utils.Outputable.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">OccName -&gt; SDoc
</span><a href="GHC.Types.Name.Occurrence.html#ppMainFn"><span class="hs-identifier hs-var">ppMainFn</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Name -&gt; OccName
</span><a href="GHC.Types.Name.html#nameOccName"><span class="hs-identifier hs-var">nameOccName</span></a></span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621683117541"><span class="hs-identifier hs-var">main_name</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1964"></span><span>
</span><span id="line-1965"></span><span class="hs-comment">{- Note [Dealing with main]
~~~~~~~~~~~~~~~~~~~~~~~~~~~
Dealing with the 'main' declaration is surprisingly tricky. Here are
the moving parts:

* The flag -main-is=M.foo allows you to set the main module to 'M',
  and the main function to 'foo'.  We access them through
      mainModIs  :: HscEnv -&gt; Module     -- returns M
      getMainOcc :: DynFlags -&gt; OccName  -- returns foo
  Of course usually M = Main, and foo = main.

* checkMainType: when typechecking module M, we add an extra check that
    foo :: IO tau, for some type tau.
  This avoids getting ambiguous-type errors from the monomorphism restriction
  applying to things like
      main = return ()
  Note that checkMainType does not consult the export list because
  we have not yet done rnExports (and can't do it until later).

* rnExports: checks the export list.  Very annoyingly, we can only do
  this after running any finalisers, which may add new declarations.
  That's why checkMainType and checkMain have to be separate.

* checkMain: does two things:
  - check that the export list does indeed export something called 'foo'
  - generateMainBinding: generate the root-main binding
       :Main.main = runMainIO M.foo
  See Note [Root-main Id]

An annoying consequence of having both checkMainType and checkMain is
that, when (but only when) -fdefer-type-errors is on, we may report an
ill-typed 'main' twice (as warnings): once in checkMainType and once
in checkMain. See test typecheck/should_fail/T13292.

We have the following tests to check this processing:
----------------+----------------------------------------------------------------------------------+
                |                                  Module Header:                                  |
                +-------------+-------------+-------------+-------------+-------------+------------+
                | module      | module Main | &lt;No Header&gt; | module Main |module       |module Main |
                |  Main(main) |             |             |   (module X)|   Main ()   |  (Sub.main)|
----------------+==================================================================================+
`main` function | ERROR:      | Main.main   | ERROR:      | Main.main   | ERROR:      | Sub.main   |
in Main module  |  Ambiguous  |             |  Ambiguous  |             |  `main` not |            |
and in imported |             |             |             |             |  exported   |            |
module Sub.     | T19397E1    | T16453M0    | T19397E2    | T16453M3    |             | T16453M1   |
                |             |             |             | X = Main    | Remark 2)   |            |
----------------+-------------+-------------+-------------+-------------+-------------+------------+
`main`function  | Sub.main    | ERROR:      | Sub.main    | Sub.main    | ERROR:      | Sub.main   |
only in imported|             | No `main` in|             |             |  `main` not |            |
submodule Sub.  |             |   `Main`    |             |             |  exported   |            |
                | T19397M0    | T16453E1    | T19397M1    | T16453M4    |             | T16453M5   |
                |             |             |             | X = Sub     | Remark 2)   |            |
----------------+-------------+-------------+-------------+-------------+-------------+------------+
`foo` function  | Sub.foo     | ERROR:      | Sub.foo     | Sub.foo     | ERROR:      | Sub.foo    |
in submodule    |             | No `foo` in |             |             |  `foo` not  |            |
Sub.            |             |   `Main`    |             |             |  exported   |            |
GHC option:     |             |             |             |             |             |            |
  -main-is foo  | T19397M2    | T19397E3    | T19397M3    | T19397M4    | T19397E4    | T16453M6   |
                | Remark 1)   |             |             | X = Sub     |             | Remark 3)  |
----------------+-------------+-------------+-------------+-------------+-------------+------------+

Remarks:
* The first line shows the exported `main` function or the error.
* The second line shows the coresponding test case.
* The module `Sub` contains the following functions:
     main :: IO ()
     foo :: IO ()
* Remark 1) Here the header is `Main (foo)`.
* Remark 2) Here we have no extra test case. It would exercise the same code path as `T19397E4`.
* Remark 3) Here the header is `Main (Sub.foo)`.


Note [Root-main Id]
~~~~~~~~~~~~~~~~~~~
The function that the RTS invokes is always :Main.main, which we call
root_main_id.  (Because GHC allows the user to have a module not
called Main as the main module, we can't rely on the main function
being called &quot;Main.main&quot;.  That's why root_main_id has a fixed module
&quot;:Main&quot;.)

This is unusual: it's a LocalId whose Name has a Module from another
module. Tiresomely, we must filter it out again in GHC.Iface.Make, less we
get two defns for 'main' in the interface file!

When using `-fwrite-if-simplified-core` the root_main_id can end up in an interface file.
When the interface is read back in we have to add a special case when creating the
Id because otherwise we would go looking for the :Main module which obviously doesn't
exist. For this logic see GHC.IfaceToCore.mk_top_id.

There is also some similar (probably dead) logic in GHC.Rename.Env which says it
was added for External Core which faced a similar issue.


*********************************************************
*                                                       *
                GHCi stuff
*                                                       *
*********************************************************
-}</span><span>
</span><span id="line-2064"></span><span>
</span><span id="line-2065"></span><span id="local-6989586621683115195"><span class="annot"><a href="GHC.Tc.Module.html#runTcInteractive"><span class="hs-identifier hs-type">runTcInteractive</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Driver.Env.Types.html#HscEnv"><span class="hs-identifier hs-type">HscEnv</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#TcRn"><span class="hs-identifier hs-type">TcRn</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683115195"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Types.Error.html#Messages"><span class="hs-identifier hs-type">Messages</span></a></span><span> </span><span class="annot"><a href="GHC.Tc.Errors.Types.html#TcRnMessage"><span class="hs-identifier hs-type">TcRnMessage</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Maybe</span></span><span> </span><span class="annot"><a href="#local-6989586621683115195"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">)</span></span><span>
</span><span id="line-2066"></span><span class="hs-comment">-- Initialise the tcg_inst_env with instances from all home modules.</span><span>
</span><span id="line-2067"></span><span class="hs-comment">-- This mimics the more selective call to hptInstances in tcRnImports</span><span>
</span><span id="line-2068"></span><span id="runTcInteractive"><span class="annot"><span class="annottext">runTcInteractive :: forall a. HscEnv -&gt; TcRn a -&gt; IO (Messages TcRnMessage, Maybe a)
</span><a href="GHC.Tc.Module.html#runTcInteractive"><span class="hs-identifier hs-var hs-var">runTcInteractive</span></a></span></span><span> </span><span id="local-6989586621683117577"><span class="annot"><span class="annottext">HscEnv
</span><a href="#local-6989586621683117577"><span class="hs-identifier hs-var">hsc_env</span></a></span></span><span> </span><span id="local-6989586621683117578"><span class="annot"><span class="annottext">TcRn a
</span><a href="#local-6989586621683117578"><span class="hs-identifier hs-var">thing_inside</span></a></span></span><span>
</span><span id="line-2069"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">HscEnv -&gt; TcRn a -&gt; IO (Messages TcRnMessage, Maybe a)
forall a. HscEnv -&gt; TcRn a -&gt; IO (Messages TcRnMessage, Maybe a)
</span><a href="GHC.Tc.Utils.Monad.html#initTcInteractive"><span class="hs-identifier hs-var">initTcInteractive</span></a></span><span> </span><span class="annot"><span class="annottext">HscEnv
</span><a href="#local-6989586621683117577"><span class="hs-identifier hs-var">hsc_env</span></a></span><span> </span><span class="annot"><span class="annottext">(TcRn a -&gt; IO (Messages TcRnMessage, Maybe a))
-&gt; TcRn a -&gt; IO (Messages TcRnMessage, Maybe a)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">HscEnv -&gt; TcRn a -&gt; TcRn a
forall a. HscEnv -&gt; TcM a -&gt; TcM a
</span><a href="GHC.Tc.Module.html#withTcPlugins"><span class="hs-identifier hs-var">withTcPlugins</span></a></span><span> </span><span class="annot"><span class="annottext">HscEnv
</span><a href="#local-6989586621683117577"><span class="hs-identifier hs-var">hsc_env</span></a></span><span> </span><span class="annot"><span class="annottext">(TcRn a -&gt; TcRn a) -&gt; TcRn a -&gt; TcRn a
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-2070"></span><span>    </span><span class="annot"><span class="annottext">HscEnv -&gt; TcRn a -&gt; TcRn a
forall a. HscEnv -&gt; TcM a -&gt; TcM a
</span><a href="GHC.Tc.Module.html#withDefaultingPlugins"><span class="hs-identifier hs-var">withDefaultingPlugins</span></a></span><span> </span><span class="annot"><span class="annottext">HscEnv
</span><a href="#local-6989586621683117577"><span class="hs-identifier hs-var">hsc_env</span></a></span><span> </span><span class="annot"><span class="annottext">(TcRn a -&gt; TcRn a) -&gt; TcRn a -&gt; TcRn a
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">HscEnv -&gt; TcRn a -&gt; TcRn a
forall a. HscEnv -&gt; TcM a -&gt; TcM a
</span><a href="GHC.Tc.Module.html#withHoleFitPlugins"><span class="hs-identifier hs-var">withHoleFitPlugins</span></a></span><span> </span><span class="annot"><span class="annottext">HscEnv
</span><a href="#local-6989586621683117577"><span class="hs-identifier hs-var">hsc_env</span></a></span><span> </span><span class="annot"><span class="annottext">(TcRn a -&gt; TcRn a) -&gt; TcRn a -&gt; TcRn a
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-2071"></span><span>    </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">String -&gt; SDoc -&gt; IOEnv (Env TcGblEnv TcLclEnv) ()
</span><a href="GHC.Tc.Utils.Monad.html#traceTc"><span class="hs-identifier hs-var">traceTc</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;setInteractiveContext&quot;</span></span><span> </span><span class="annot"><span class="annottext">(SDoc -&gt; IOEnv (Env TcGblEnv TcLclEnv) ())
-&gt; SDoc -&gt; IOEnv (Env TcGblEnv TcLclEnv) ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-2072"></span><span>            </span><span class="annot"><span class="annottext">[SDoc] -&gt; SDoc
forall doc. IsDoc doc =&gt; [doc] -&gt; doc
</span><a href="GHC.Utils.Outputable.html#vcat"><span class="hs-identifier hs-var">vcat</span></a></span><span> </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">String -&gt; SDoc
forall doc. IsLine doc =&gt; String -&gt; doc
</span><a href="GHC.Utils.Outputable.html#text"><span class="hs-identifier hs-var">text</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;ic_tythings:&quot;</span></span><span> </span><span class="annot"><span class="annottext">SDoc -&gt; SDoc -&gt; SDoc
forall doc. IsLine doc =&gt; doc -&gt; doc -&gt; doc
</span><a href="GHC.Utils.Outputable.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">[SDoc] -&gt; SDoc
forall doc. IsDoc doc =&gt; [doc] -&gt; doc
</span><a href="GHC.Utils.Outputable.html#vcat"><span class="hs-identifier hs-var">vcat</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(TyThing -&gt; SDoc) -&gt; [TyThing] -&gt; [SDoc]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><span class="hs-identifier hs-var">map</span></span><span> </span><span class="annot"><span class="annottext">TyThing -&gt; SDoc
forall a. Outputable a =&gt; a -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">InteractiveContext -&gt; [TyThing]
</span><a href="GHC.Runtime.Context.html#ic_tythings"><span class="hs-identifier hs-var">ic_tythings</span></a></span><span> </span><span class="annot"><span class="annottext">InteractiveContext
</span><a href="#local-6989586621683117581"><span class="hs-identifier hs-var">icxt</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-2073"></span><span>                 </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">String -&gt; SDoc
forall doc. IsLine doc =&gt; String -&gt; doc
</span><a href="GHC.Utils.Outputable.html#text"><span class="hs-identifier hs-var">text</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;ic_insts:&quot;</span></span><span> </span><span class="annot"><span class="annottext">SDoc -&gt; SDoc -&gt; SDoc
forall doc. IsLine doc =&gt; doc -&gt; doc -&gt; doc
</span><a href="GHC.Utils.Outputable.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">[SDoc] -&gt; SDoc
forall doc. IsDoc doc =&gt; [doc] -&gt; doc
</span><a href="GHC.Utils.Outputable.html#vcat"><span class="hs-identifier hs-var">vcat</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(ClsInst -&gt; SDoc) -&gt; [ClsInst] -&gt; [SDoc]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><span class="hs-identifier hs-var">map</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">BindingSite -&gt; Id -&gt; SDoc
forall a. OutputableBndr a =&gt; BindingSite -&gt; a -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#pprBndr"><span class="hs-identifier hs-var">pprBndr</span></a></span><span> </span><span class="annot"><span class="annottext">BindingSite
</span><a href="GHC.Utils.Outputable.html#LetBind"><span class="hs-identifier hs-var">LetBind</span></a></span><span> </span><span class="annot"><span class="annottext">(Id -&gt; SDoc) -&gt; (ClsInst -&gt; Id) -&gt; ClsInst -&gt; SDoc
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">ClsInst -&gt; Id
</span><a href="GHC.Core.InstEnv.html#instanceDFunId"><span class="hs-identifier hs-var">instanceDFunId</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">InstEnv -&gt; [ClsInst]
</span><a href="GHC.Core.InstEnv.html#instEnvElts"><span class="hs-identifier hs-var">instEnvElts</span></a></span><span> </span><span class="annot"><span class="annottext">InstEnv
</span><a href="#local-6989586621683117585"><span class="hs-identifier hs-var">ic_insts</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-2074"></span><span>                 </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">String -&gt; SDoc
forall doc. IsLine doc =&gt; String -&gt; doc
</span><a href="GHC.Utils.Outputable.html#text"><span class="hs-identifier hs-var">text</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;icReaderEnv (LocalDef)&quot;</span></span><span> </span><span class="annot"><span class="annottext">SDoc -&gt; SDoc -&gt; SDoc
forall doc. IsLine doc =&gt; doc -&gt; doc -&gt; doc
</span><a href="GHC.Utils.Outputable.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a></span><span>
</span><span id="line-2075"></span><span>                      </span><span class="annot"><span class="annottext">[SDoc] -&gt; SDoc
forall doc. IsDoc doc =&gt; [doc] -&gt; doc
</span><a href="GHC.Utils.Outputable.html#vcat"><span class="hs-identifier hs-var">vcat</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">([GlobalRdrElt] -&gt; SDoc) -&gt; [[GlobalRdrElt]] -&gt; [SDoc]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><span class="hs-identifier hs-var">map</span></span><span> </span><span class="annot"><span class="annottext">[GlobalRdrElt] -&gt; SDoc
forall a. Outputable a =&gt; a -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">[GlobalRdrElt]
</span><a href="#local-6989586621683117586"><span class="hs-identifier hs-var">local_gres</span></a></span><span> </span><span class="hs-glyph">|</span><span> </span><span id="local-6989586621683117587"><span class="annot"><span class="annottext">[GlobalRdrElt]
</span><a href="#local-6989586621683117587"><span class="hs-identifier hs-var">gres</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">GlobalRdrEnv -&gt; [[GlobalRdrElt]]
forall a. OccEnv a -&gt; [a]
</span><a href="GHC.Types.Name.Occurrence.html#nonDetOccEnvElts"><span class="hs-identifier hs-var">nonDetOccEnvElts</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">InteractiveContext -&gt; GlobalRdrEnv
</span><a href="GHC.Runtime.Context.html#icReaderEnv"><span class="hs-identifier hs-var">icReaderEnv</span></a></span><span> </span><span class="annot"><span class="annottext">InteractiveContext
</span><a href="#local-6989586621683117581"><span class="hs-identifier hs-var">icxt</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-2076"></span><span>                                                 </span><span class="hs-special">,</span><span> </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621683117586"><span class="annot"><span class="annottext">local_gres :: [GlobalRdrElt]
</span><a href="#local-6989586621683117586"><span class="hs-identifier hs-var hs-var">local_gres</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(GlobalRdrElt -&gt; Bool) -&gt; [GlobalRdrElt] -&gt; [GlobalRdrElt]
forall a. (a -&gt; Bool) -&gt; [a] -&gt; [a]
</span><span class="hs-identifier hs-var">filter</span></span><span> </span><span class="annot"><span class="annottext">GlobalRdrElt -&gt; Bool
forall info. GlobalRdrEltX info -&gt; Bool
</span><a href="GHC.Types.Name.Reader.html#isLocalGRE"><span class="hs-identifier hs-var">isLocalGRE</span></a></span><span> </span><span class="annot"><span class="annottext">[GlobalRdrElt]
</span><a href="#local-6989586621683117587"><span class="hs-identifier hs-var">gres</span></a></span><span>
</span><span id="line-2077"></span><span>                                                 </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Bool
</span><span class="hs-identifier hs-var">not</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[GlobalRdrElt] -&gt; Bool
forall a. [a] -&gt; Bool
forall (t :: * -&gt; *) a. Foldable t =&gt; t a -&gt; Bool
</span><span class="hs-identifier hs-var">null</span></span><span> </span><span class="annot"><span class="annottext">[GlobalRdrElt]
</span><a href="#local-6989586621683117586"><span class="hs-identifier hs-var">local_gres</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">]</span><span class="hs-special">)</span><span> </span><span class="hs-special">]</span><span>
</span><span id="line-2078"></span><span>
</span><span id="line-2079"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621683117592"><span class="annot"><span class="annottext">getOrphans :: ModuleName -&gt; PkgQual -&gt; IOEnv (Env TcGblEnv TcLclEnv) [Module]
</span><a href="#local-6989586621683117592"><span class="hs-identifier hs-var hs-var hs-var">getOrphans</span></a></span></span><span> </span><span id="local-6989586621683117593"><span class="annot"><span class="annottext">ModuleName
</span><a href="#local-6989586621683117593"><span class="hs-identifier hs-var">m</span></a></span></span><span> </span><span id="local-6989586621683117594"><span class="annot"><span class="annottext">PkgQual
</span><a href="#local-6989586621683117594"><span class="hs-identifier hs-var">mb_pkg</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(ModIface_ 'ModIfaceFinal -&gt; [Module])
-&gt; IOEnv (Env TcGblEnv TcLclEnv) (ModIface_ 'ModIfaceFinal)
-&gt; IOEnv (Env TcGblEnv TcLclEnv) [Module]
forall a b.
(a -&gt; b)
-&gt; IOEnv (Env TcGblEnv TcLclEnv) a
-&gt; IOEnv (Env TcGblEnv TcLclEnv) b
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-identifier hs-var">fmap</span></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span id="local-6989586621683117595"><span class="annot"><span class="annottext">ModIface_ 'ModIfaceFinal
</span><a href="#local-6989586621683117595"><span class="hs-identifier hs-var">iface</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">ModIface_ 'ModIfaceFinal -&gt; Module
forall (phase :: ModIfacePhase). ModIface_ phase -&gt; Module
</span><a href="GHC.Unit.Module.ModIface.html#mi_module"><span class="hs-identifier hs-var">mi_module</span></a></span><span> </span><span class="annot"><span class="annottext">ModIface_ 'ModIfaceFinal
</span><a href="#local-6989586621683117595"><span class="hs-identifier hs-var">iface</span></a></span><span>
</span><span id="line-2080"></span><span>                                          </span><span class="annot"><span class="annottext">Module -&gt; [Module] -&gt; [Module]
forall a. a -&gt; [a] -&gt; [a]
</span><span class="hs-glyph hs-var">:</span></span><span> </span><span class="annot"><span class="annottext">Dependencies -&gt; [Module]
</span><a href="GHC.Unit.Module.Deps.html#dep_orphs"><span class="hs-identifier hs-var">dep_orphs</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ModIface_ 'ModIfaceFinal -&gt; Dependencies
forall (phase :: ModIfacePhase). ModIface_ phase -&gt; Dependencies
</span><a href="GHC.Unit.Module.ModIface.html#mi_deps"><span class="hs-identifier hs-var">mi_deps</span></a></span><span> </span><span class="annot"><span class="annottext">ModIface_ 'ModIfaceFinal
</span><a href="#local-6989586621683117595"><span class="hs-identifier hs-var">iface</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-2081"></span><span>                                 </span><span class="hs-special">(</span><span class="annot"><span class="annottext">SDoc
-&gt; ModuleName
-&gt; IsBootInterface
-&gt; PkgQual
-&gt; IOEnv (Env TcGblEnv TcLclEnv) (ModIface_ 'ModIfaceFinal)
</span><a href="GHC.Iface.Load.html#loadSrcInterface"><span class="hs-identifier hs-var">loadSrcInterface</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">String -&gt; SDoc
forall doc. IsLine doc =&gt; String -&gt; doc
</span><a href="GHC.Utils.Outputable.html#text"><span class="hs-identifier hs-var">text</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;runTcInteractive&quot;</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">ModuleName
</span><a href="#local-6989586621683117593"><span class="hs-identifier hs-var">m</span></a></span><span>
</span><span id="line-2082"></span><span>                                                   </span><span class="annot"><span class="annottext">IsBootInterface
</span><a href="Language.Haskell.Syntax.ImpExp.html#NotBoot"><span class="hs-identifier hs-var">NotBoot</span></a></span><span> </span><span class="annot"><span class="annottext">PkgQual
</span><a href="#local-6989586621683117594"><span class="hs-identifier hs-var">mb_pkg</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-2083"></span><span>
</span><span id="line-2084"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="hs-glyph">!</span><span id="local-6989586621683117601"><span class="annot"><a href="#local-6989586621683117601"><span class="hs-identifier hs-var">orphs</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">([[Module]] -&gt; [Module])
-&gt; IOEnv (Env TcGblEnv TcLclEnv) [[Module]]
-&gt; IOEnv (Env TcGblEnv TcLclEnv) [Module]
forall a b.
(a -&gt; b)
-&gt; IOEnv (Env TcGblEnv TcLclEnv) a
-&gt; IOEnv (Env TcGblEnv TcLclEnv) b
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-identifier hs-var">fmap</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[Module] -&gt; [Module]
forall a. NFData a =&gt; a -&gt; a
</span><a href="../../deepseq-1.5.1.0-6837/src/Control.DeepSeq.html#force"><span class="hs-identifier hs-var">force</span></a></span><span> </span><span class="annot"><span class="annottext">([Module] -&gt; [Module])
-&gt; ([[Module]] -&gt; [Module]) -&gt; [[Module]] -&gt; [Module]
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">[[Module]] -&gt; [Module]
forall (t :: * -&gt; *) a. Foldable t =&gt; t [a] -&gt; [a]
</span><span class="hs-identifier hs-var">concat</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(IOEnv (Env TcGblEnv TcLclEnv) [[Module]]
 -&gt; IOEnv (Env TcGblEnv TcLclEnv) [Module])
-&gt; ((InteractiveImport -&gt; IOEnv (Env TcGblEnv TcLclEnv) [Module])
    -&gt; IOEnv (Env TcGblEnv TcLclEnv) [[Module]])
-&gt; (InteractiveImport -&gt; IOEnv (Env TcGblEnv TcLclEnv) [Module])
-&gt; IOEnv (Env TcGblEnv TcLclEnv) [Module]
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">[InteractiveImport]
-&gt; (InteractiveImport -&gt; IOEnv (Env TcGblEnv TcLclEnv) [Module])
-&gt; IOEnv (Env TcGblEnv TcLclEnv) [[Module]]
forall (t :: * -&gt; *) (m :: * -&gt; *) a b.
(Traversable t, Monad m) =&gt;
t a -&gt; (a -&gt; m b) -&gt; m (t b)
</span><span class="hs-identifier hs-var">forM</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">InteractiveContext -&gt; [InteractiveImport]
</span><a href="GHC.Runtime.Context.html#ic_imports"><span class="hs-identifier hs-var">ic_imports</span></a></span><span> </span><span class="annot"><span class="annottext">InteractiveContext
</span><a href="#local-6989586621683117581"><span class="hs-identifier hs-var">icxt</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">((InteractiveImport -&gt; IOEnv (Env TcGblEnv TcLclEnv) [Module])
 -&gt; IOEnv (Env TcGblEnv TcLclEnv) [Module])
-&gt; (InteractiveImport -&gt; IOEnv (Env TcGblEnv TcLclEnv) [Module])
-&gt; IOEnv (Env TcGblEnv TcLclEnv) [Module]
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-glyph">\</span><span id="local-6989586621683117606"><span class="annot"><span class="annottext">InteractiveImport
</span><a href="#local-6989586621683117606"><span class="hs-identifier hs-var">i</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-2085"></span><span>            </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">InteractiveImport
</span><a href="#local-6989586621683117606"><span class="hs-identifier hs-var">i</span></a></span><span> </span><span class="hs-keyword">of</span><span>                   </span><span class="hs-comment">-- force above: see #15111</span><span>
</span><span id="line-2086"></span><span>                </span><span class="annot"><a href="GHC.Runtime.Context.html#IIModule"><span class="hs-identifier hs-type">IIModule</span></a></span><span> </span><span id="local-6989586621683117608"><span class="annot"><span class="annottext">ModuleName
</span><a href="#local-6989586621683117608"><span class="hs-identifier hs-var">n</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">ModuleName -&gt; PkgQual -&gt; IOEnv (Env TcGblEnv TcLclEnv) [Module]
</span><a href="#local-6989586621683117592"><span class="hs-identifier hs-var">getOrphans</span></a></span><span> </span><span class="annot"><span class="annottext">ModuleName
</span><a href="#local-6989586621683117608"><span class="hs-identifier hs-var">n</span></a></span><span> </span><span class="annot"><span class="annottext">PkgQual
</span><a href="GHC.Types.PkgQual.html#NoPkgQual"><span class="hs-identifier hs-var">NoPkgQual</span></a></span><span>
</span><span id="line-2087"></span><span>                </span><span class="annot"><a href="GHC.Runtime.Context.html#IIDecl"><span class="hs-identifier hs-type">IIDecl</span></a></span><span> </span><span id="local-6989586621683117611"><span class="annot"><span class="annottext">ImportDecl GhcPs
</span><a href="#local-6989586621683117611"><span class="hs-identifier hs-var">i</span></a></span></span><span>   </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">ModuleName -&gt; PkgQual -&gt; IOEnv (Env TcGblEnv TcLclEnv) [Module]
</span><a href="#local-6989586621683117592"><span class="hs-identifier hs-var">getOrphans</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">GenLocated SrcSpanAnnA ModuleName -&gt; ModuleName
forall l e. GenLocated l e -&gt; e
</span><a href="GHC.Types.SrcLoc.html#unLoc"><span class="hs-identifier hs-var">unLoc</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ImportDecl GhcPs -&gt; XRec GhcPs ModuleName
forall pass. ImportDecl pass -&gt; XRec pass ModuleName
</span><a href="Language.Haskell.Syntax.ImpExp.html#ideclName"><span class="hs-identifier hs-var">ideclName</span></a></span><span> </span><span class="annot"><span class="annottext">ImportDecl GhcPs
</span><a href="#local-6989586621683117611"><span class="hs-identifier hs-var">i</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-2088"></span><span>                                         </span><span class="hs-special">(</span><span class="annot"><span class="annottext">UnitEnv -&gt; ModuleName -&gt; RawPkgQual -&gt; PkgQual
</span><a href="GHC.Rename.Names.html#renameRawPkgQual"><span class="hs-identifier hs-var">renameRawPkgQual</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">HscEnv -&gt; UnitEnv
</span><a href="GHC.Driver.Env.Types.html#hsc_unit_env"><span class="hs-identifier hs-var">hsc_unit_env</span></a></span><span> </span><span class="annot"><span class="annottext">HscEnv
</span><a href="#local-6989586621683117577"><span class="hs-identifier hs-var">hsc_env</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">GenLocated SrcSpanAnnA ModuleName -&gt; ModuleName
forall l e. GenLocated l e -&gt; e
</span><a href="GHC.Types.SrcLoc.html#unLoc"><span class="hs-identifier hs-var">unLoc</span></a></span><span> </span><span class="annot"><span class="annottext">(GenLocated SrcSpanAnnA ModuleName -&gt; ModuleName)
-&gt; GenLocated SrcSpanAnnA ModuleName -&gt; ModuleName
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">ImportDecl GhcPs -&gt; XRec GhcPs ModuleName
forall pass. ImportDecl pass -&gt; XRec pass ModuleName
</span><a href="Language.Haskell.Syntax.ImpExp.html#ideclName"><span class="hs-identifier hs-var">ideclName</span></a></span><span> </span><span class="annot"><span class="annottext">ImportDecl GhcPs
</span><a href="#local-6989586621683117611"><span class="hs-identifier hs-var">i</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ImportDecl GhcPs -&gt; ImportDeclPkgQual GhcPs
forall pass. ImportDecl pass -&gt; ImportDeclPkgQual pass
</span><a href="Language.Haskell.Syntax.ImpExp.html#ideclPkgQual"><span class="hs-identifier hs-var">ideclPkgQual</span></a></span><span> </span><span class="annot"><span class="annottext">ImportDecl GhcPs
</span><a href="#local-6989586621683117611"><span class="hs-identifier hs-var">i</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-2089"></span><span>
</span><span id="line-2090"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621683117612"><span class="annot"><a href="#local-6989586621683117612"><span class="hs-identifier hs-var hs-var">imports</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ImportAvails
</span><a href="GHC.Tc.Types.html#emptyImportAvails"><span class="hs-identifier hs-var">emptyImportAvails</span></a></span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><a href="GHC.Unit.Module.Deps.html#imp_orphs"><span class="hs-identifier hs-var">imp_orphs</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="#local-6989586621683117601"><span class="hs-identifier hs-type">orphs</span></a></span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-2091"></span><span>
</span><span id="line-2092"></span><span>             </span><span id="local-6989586621683117614"><span class="annot"><a href="#local-6989586621683117614"><span class="hs-identifier hs-var hs-var">upd_envs</span></a></span></span><span> </span><span class="hs-special">(</span><span id="local-6989586621683117615"><span class="annot"><span class="annottext">TcGblEnv
</span><a href="#local-6989586621683117615"><span class="hs-identifier hs-var">gbl_env</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621683117616"><span class="annot"><span class="annottext">TcLclEnv
</span><a href="#local-6989586621683117616"><span class="hs-identifier hs-var">lcl_env</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TcGblEnv
</span><a href="#local-6989586621683117617"><span class="hs-identifier hs-var">gbl_env'</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">TcLclEnv
</span><a href="#local-6989586621683117618"><span class="hs-identifier hs-var">lcl_env'</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-2093"></span><span>
</span><span id="line-2094"></span><span>               </span><span class="hs-keyword">where</span><span>
</span><span id="line-2095"></span><span>                 </span><span id="local-6989586621683117617"><span class="annot"><span class="annottext">gbl_env' :: TcGblEnv
</span><a href="#local-6989586621683117617"><span class="hs-identifier hs-var hs-var">gbl_env'</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">TcGblEnv
</span><a href="#local-6989586621683117615"><span class="hs-identifier hs-var">gbl_env</span></a></span><span>
</span><span id="line-2096"></span><span>                   </span><span class="hs-special">{</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#tcg_rdr_env"><span class="hs-identifier hs-var">tcg_rdr_env</span></a></span><span>      </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="GHC.Runtime.Context.html#icReaderEnv"><span class="hs-identifier hs-type">icReaderEnv</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683117581"><span class="hs-identifier hs-type">icxt</span></a></span><span>
</span><span id="line-2097"></span><span>                   </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#tcg_type_env"><span class="hs-identifier hs-var">tcg_type_env</span></a></span><span>     </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="#local-6989586621683117619"><span class="hs-identifier hs-type">type_env</span></a></span><span>
</span><span id="line-2098"></span><span>                   </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#tcg_inst_env"><span class="hs-identifier hs-var">tcg_inst_env</span></a></span><span>     </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#tcg_inst_env"><span class="hs-identifier hs-var">tcg_inst_env</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683117615"><span class="hs-identifier hs-type">gbl_env</span></a></span><span> </span><span class="annot"><a href="GHC.Core.InstEnv.html#unionInstEnv"><span class="hs-operator hs-type">`unionInstEnv`</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683117585"><span class="hs-identifier hs-type">ic_insts</span></a></span><span> </span><span class="annot"><a href="GHC.Core.InstEnv.html#unionInstEnv"><span class="hs-operator hs-type">`unionInstEnv`</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683117620"><span class="hs-identifier hs-type">home_insts</span></a></span><span>
</span><span id="line-2099"></span><span>                   </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#tcg_fam_inst_env"><span class="hs-identifier hs-var">tcg_fam_inst_env</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="GHC.Core.FamInstEnv.html#extendFamInstEnvList"><span class="hs-identifier hs-type">extendFamInstEnvList</span></a></span><span>
</span><span id="line-2100"></span><span>                              </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Core.FamInstEnv.html#extendFamInstEnvList"><span class="hs-identifier hs-type">extendFamInstEnvList</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Tc.Types.html#tcg_fam_inst_env"><span class="hs-identifier hs-var">tcg_fam_inst_env</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683117615"><span class="hs-identifier hs-type">gbl_env</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-2101"></span><span>                                                    </span><span class="annot"><a href="#local-6989586621683117621"><span class="hs-identifier hs-type">ic_finsts</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-2102"></span><span>                              </span><span class="annot"><a href="#local-6989586621683117622"><span class="hs-identifier hs-type">home_fam_insts</span></a></span><span>
</span><span id="line-2103"></span><span>                   </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#tcg_fix_env"><span class="hs-identifier hs-var">tcg_fix_env</span></a></span><span>      </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="GHC.Runtime.Context.html#ic_fix_env"><span class="hs-identifier hs-var">ic_fix_env</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683117581"><span class="hs-identifier hs-type">icxt</span></a></span><span>
</span><span id="line-2104"></span><span>                   </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#tcg_default"><span class="hs-identifier hs-var">tcg_default</span></a></span><span>      </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="GHC.Runtime.Context.html#ic_default"><span class="hs-identifier hs-var">ic_default</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683117581"><span class="hs-identifier hs-type">icxt</span></a></span><span>
</span><span id="line-2105"></span><span>                        </span><span class="hs-comment">-- must calculate imp_orphs of the ImportAvails</span><span>
</span><span id="line-2106"></span><span>                        </span><span class="hs-comment">-- so that instance visibility is done correctly</span><span>
</span><span id="line-2107"></span><span>                   </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#tcg_imports"><span class="hs-identifier hs-var">tcg_imports</span></a></span><span>      </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="#local-6989586621683117612"><span class="hs-identifier hs-type">imports</span></a></span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-2108"></span><span>
</span><span id="line-2109"></span><span>                 </span><span id="local-6989586621683117618"><span class="annot"><span class="annottext">lcl_env' :: TcLclEnv
</span><a href="#local-6989586621683117618"><span class="hs-identifier hs-var hs-var">lcl_env'</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(TcLclCtxt -&gt; TcLclCtxt) -&gt; TcLclEnv -&gt; TcLclEnv
</span><a href="GHC.Tc.Types.LclEnv.html#modifyLclCtxt"><span class="hs-identifier hs-var">modifyLclCtxt</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[(Name, TcTyThing)] -&gt; TcLclCtxt -&gt; TcLclCtxt
</span><a href="GHC.Tc.Utils.Env.html#tcExtendLocalTypeEnv"><span class="hs-identifier hs-var">tcExtendLocalTypeEnv</span></a></span><span> </span><span class="annot"><span class="annottext">[(Name, TcTyThing)]
</span><a href="#local-6989586621683117628"><span class="hs-identifier hs-var">lcl_ids</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">TcLclEnv
</span><a href="#local-6989586621683117616"><span class="hs-identifier hs-var">lcl_env</span></a></span><span>
</span><span id="line-2110"></span><span>
</span><span id="line-2111"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.Monad.html#updEnvs"><span class="hs-identifier hs-type">updEnvs</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683117614"><span class="hs-identifier hs-type">upd_envs</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683117578"><span class="hs-identifier hs-type">thing_inside</span></a></span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-2112"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-2113"></span><span>    </span><span class="hs-special">(</span><span id="local-6989586621683117620"><span class="annot"><span class="annottext">InstEnv
</span><a href="#local-6989586621683117620"><span class="hs-identifier hs-var">home_insts</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621683117622"><span class="annot"><span class="annottext">[FamInst]
</span><a href="#local-6989586621683117622"><span class="hs-identifier hs-var">home_fam_insts</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">HscEnv -&gt; (InstEnv, [FamInst])
</span><a href="GHC.Driver.Env.html#hptAllInstances"><span class="hs-identifier hs-var">hptAllInstances</span></a></span><span> </span><span class="annot"><span class="annottext">HscEnv
</span><a href="#local-6989586621683117577"><span class="hs-identifier hs-var">hsc_env</span></a></span><span>
</span><span id="line-2114"></span><span>
</span><span id="line-2115"></span><span>    </span><span id="local-6989586621683117581"><span class="annot"><span class="annottext">icxt :: InteractiveContext
</span><a href="#local-6989586621683117581"><span class="hs-identifier hs-var hs-var">icxt</span></a></span></span><span>                     </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">HscEnv -&gt; InteractiveContext
</span><a href="GHC.Driver.Env.Types.html#hsc_IC"><span class="hs-identifier hs-var">hsc_IC</span></a></span><span> </span><span class="annot"><span class="annottext">HscEnv
</span><a href="#local-6989586621683117577"><span class="hs-identifier hs-var">hsc_env</span></a></span><span>
</span><span id="line-2116"></span><span>    </span><span class="hs-special">(</span><span id="local-6989586621683117585"><span class="annot"><span class="annottext">InstEnv
</span><a href="#local-6989586621683117585"><span class="hs-identifier hs-var">ic_insts</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621683117621"><span class="annot"><span class="annottext">[FamInst]
</span><a href="#local-6989586621683117621"><span class="hs-identifier hs-var">ic_finsts</span></a></span></span><span class="hs-special">)</span><span>    </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">InteractiveContext -&gt; (InstEnv, [FamInst])
</span><a href="GHC.Runtime.Context.html#ic_instances"><span class="hs-identifier hs-var">ic_instances</span></a></span><span> </span><span class="annot"><span class="annottext">InteractiveContext
</span><a href="#local-6989586621683117581"><span class="hs-identifier hs-var">icxt</span></a></span><span>
</span><span id="line-2117"></span><span>    </span><span class="hs-special">(</span><span id="local-6989586621683117628"><span class="annot"><span class="annottext">[(Name, TcTyThing)]
</span><a href="#local-6989586621683117628"><span class="hs-identifier hs-var">lcl_ids</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621683117633"><span class="annot"><span class="annottext">[TyThing]
</span><a href="#local-6989586621683117633"><span class="hs-identifier hs-var">top_ty_things</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(TyThing -&gt; Either (Name, TcTyThing) TyThing)
-&gt; [TyThing] -&gt; ([(Name, TcTyThing)], [TyThing])
forall a b c. (a -&gt; Either b c) -&gt; [a] -&gt; ([b], [c])
</span><a href="GHC.Utils.Misc.html#partitionWith"><span class="hs-identifier hs-var">partitionWith</span></a></span><span> </span><span class="annot"><span class="annottext">TyThing -&gt; Either (Name, TcTyThing) TyThing
</span><a href="#local-6989586621683117635"><span class="hs-identifier hs-var">is_closed</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">InteractiveContext -&gt; [TyThing]
</span><a href="GHC.Runtime.Context.html#ic_tythings"><span class="hs-identifier hs-var">ic_tythings</span></a></span><span> </span><span class="annot"><span class="annottext">InteractiveContext
</span><a href="#local-6989586621683117581"><span class="hs-identifier hs-var">icxt</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-2118"></span><span>
</span><span id="line-2119"></span><span>    </span><span class="annot"><a href="#local-6989586621683117635"><span class="hs-identifier hs-type">is_closed</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Types.TyThing.html#TyThing"><span class="hs-identifier hs-type">TyThing</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Either</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Types.Name.html#Name"><span class="hs-identifier hs-type">Name</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Tc.Types.BasicTypes.html#TcTyThing"><span class="hs-identifier hs-type">TcTyThing</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><a href="GHC.Types.TyThing.html#TyThing"><span class="hs-identifier hs-type">TyThing</span></a></span><span>
</span><span id="line-2120"></span><span>    </span><span class="hs-comment">-- Put Ids with free type variables (always RuntimeUnks)</span><span>
</span><span id="line-2121"></span><span>    </span><span class="hs-comment">-- in the *local* type environment</span><span>
</span><span id="line-2122"></span><span>    </span><span class="hs-comment">-- See Note [Initialising the type environment for GHCi]</span><span>
</span><span id="line-2123"></span><span>    </span><span id="local-6989586621683117635"><span class="annot"><span class="annottext">is_closed :: TyThing -&gt; Either (Name, TcTyThing) TyThing
</span><a href="#local-6989586621683117635"><span class="hs-identifier hs-var hs-var">is_closed</span></a></span></span><span> </span><span id="local-6989586621683117636"><span class="annot"><span class="annottext">TyThing
</span><a href="#local-6989586621683117636"><span class="hs-identifier hs-var">thing</span></a></span></span><span>
</span><span id="line-2124"></span><span>      </span><span class="hs-glyph">|</span><span> </span><span class="annot"><a href="GHC.Types.TyThing.html#AnId"><span class="hs-identifier hs-type">AnId</span></a></span><span> </span><span id="local-6989586621683117637"><span class="annot"><span class="annottext">Id
</span><a href="#local-6989586621683117637"><span class="hs-identifier hs-var">id</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">TyThing
</span><a href="#local-6989586621683117636"><span class="hs-identifier hs-var">thing</span></a></span><span>
</span><span id="line-2125"></span><span>      </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Bool
</span><span class="hs-identifier hs-var">not</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Id -&gt; Bool
</span><a href="GHC.Tc.Utils.Env.html#isTypeClosedLetBndr"><span class="hs-identifier hs-var">isTypeClosedLetBndr</span></a></span><span> </span><span class="annot"><span class="annottext">Id
</span><a href="#local-6989586621683117637"><span class="hs-identifier hs-var">id</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-2126"></span><span>      </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(Name, TcTyThing) -&gt; Either (Name, TcTyThing) TyThing
forall a b. a -&gt; Either a b
</span><span class="hs-identifier hs-var">Left</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Id -&gt; Name
</span><a href="GHC.Types.Id.html#idName"><span class="hs-identifier hs-var">idName</span></a></span><span> </span><span class="annot"><span class="annottext">Id
</span><a href="#local-6989586621683117637"><span class="hs-identifier hs-var">id</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Tc.Types.BasicTypes.html#ATcId"><span class="hs-identifier hs-type">ATcId</span></a></span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">tct_id :: Id
</span><a href="GHC.Tc.Types.BasicTypes.html#tct_id"><span class="hs-identifier hs-var">tct_id</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Id
</span><a href="#local-6989586621683117637"><span class="hs-identifier hs-var">id</span></a></span><span>
</span><span id="line-2127"></span><span>                               </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">tct_info :: IdBindingInfo
</span><a href="GHC.Tc.Types.BasicTypes.html#tct_info"><span class="hs-identifier hs-var">tct_info</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">IdBindingInfo
</span><a href="GHC.Tc.Types.BasicTypes.html#NotLetBound"><span class="hs-identifier hs-var">NotLetBound</span></a></span><span> </span><span class="hs-special">}</span><span class="hs-special">)</span><span>
</span><span id="line-2128"></span><span>      </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">otherwise</span></span><span>
</span><span id="line-2129"></span><span>      </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">TyThing -&gt; Either (Name, TcTyThing) TyThing
forall a b. b -&gt; Either a b
</span><span class="hs-identifier hs-var">Right</span></span><span> </span><span class="annot"><span class="annottext">TyThing
</span><a href="#local-6989586621683117636"><span class="hs-identifier hs-var">thing</span></a></span><span>
</span><span id="line-2130"></span><span>
</span><span id="line-2131"></span><span>    </span><span id="local-6989586621683117643"><span class="annot"><span class="annottext">type_env1 :: TypeEnv
</span><a href="#local-6989586621683117643"><span class="hs-identifier hs-var hs-var">type_env1</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[TyThing] -&gt; TypeEnv
</span><a href="GHC.Types.TypeEnv.html#mkTypeEnvWithImplicits"><span class="hs-identifier hs-var">mkTypeEnvWithImplicits</span></a></span><span> </span><span class="annot"><span class="annottext">[TyThing]
</span><a href="#local-6989586621683117633"><span class="hs-identifier hs-var">top_ty_things</span></a></span><span>
</span><span id="line-2132"></span><span>    </span><span id="local-6989586621683117619"><span class="annot"><span class="annottext">type_env :: TypeEnv
</span><a href="#local-6989586621683117619"><span class="hs-identifier hs-var hs-var">type_env</span></a></span></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">TypeEnv -&gt; [Id] -&gt; TypeEnv
</span><a href="GHC.Types.TypeEnv.html#extendTypeEnvWithIds"><span class="hs-identifier hs-var">extendTypeEnvWithIds</span></a></span><span> </span><span class="annot"><span class="annottext">TypeEnv
</span><a href="#local-6989586621683117643"><span class="hs-identifier hs-var">type_env1</span></a></span><span>
</span><span id="line-2133"></span><span>              </span><span class="annot"><span class="annottext">([Id] -&gt; TypeEnv) -&gt; [Id] -&gt; TypeEnv
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">(ClsInst -&gt; Id) -&gt; [ClsInst] -&gt; [Id]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><span class="hs-identifier hs-var">map</span></span><span> </span><span class="annot"><span class="annottext">ClsInst -&gt; Id
</span><a href="GHC.Core.InstEnv.html#instanceDFunId"><span class="hs-identifier hs-var">instanceDFunId</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">InstEnv -&gt; [ClsInst]
</span><a href="GHC.Core.InstEnv.html#instEnvElts"><span class="hs-identifier hs-var">instEnvElts</span></a></span><span> </span><span class="annot"><span class="annottext">InstEnv
</span><a href="#local-6989586621683117585"><span class="hs-identifier hs-var">ic_insts</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-2134"></span><span>                </span><span class="hs-comment">-- Putting the dfuns in the type_env</span><span>
</span><span id="line-2135"></span><span>                </span><span class="hs-comment">-- is just to keep Core Lint happy</span><span>
</span><span id="line-2136"></span><span>
</span><span id="line-2137"></span><span class="hs-comment">{- Note [Initialising the type environment for GHCi]
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
Most of the Ids in ic_things, defined by the user in 'let' stmts,
have closed types. E.g.
   ghci&gt; let foo x y = x &amp;&amp; not y

However the GHCi debugger creates top-level bindings for Ids whose
types have free RuntimeUnk skolem variables, standing for unknown
types.  If we don't register these free TyVars as global TyVars then
the typechecker will try to quantify over them and fall over in
skolemiseQuantifiedTyVar. so we must add any free TyVars to the
typechecker's global TyVar set.  That is done by using
tcExtendLocalTypeEnv.

We do this by splitting out the Ids with open types, using 'is_closed'
to do the partition.  The top-level things go in the global TypeEnv;
the open, NotTopLevel, Ids, with free RuntimeUnk tyvars, go in the
local TypeEnv.

Note that we don't extend the local RdrEnv (tcl_rdr); all the in-scope
things are already in the interactive context's GlobalRdrEnv.
Extending the local RdrEnv isn't terrible, but it means there is an
entry for the same Name in both global and local RdrEnvs, and that
lead to duplicate &quot;perhaps you meant...&quot; suggestions (e.g. T5564).

We don't bother with the tcl_th_bndrs environment either.
-}</span><span>
</span><span id="line-2164"></span><span>
</span><span id="line-2165"></span><span class="hs-comment">-- | The returned [Id] is the list of new Ids bound by this statement. It can</span><span>
</span><span id="line-2166"></span><span class="hs-comment">-- be used to extend the InteractiveContext via extendInteractiveContext.</span><span>
</span><span id="line-2167"></span><span class="hs-comment">--</span><span>
</span><span id="line-2168"></span><span class="hs-comment">-- The returned TypecheckedHsExpr is of type IO [ Any ], a list of the bound</span><span>
</span><span id="line-2169"></span><span class="hs-comment">-- values, coerced to Any.</span><span>
</span><span id="line-2170"></span><span class="annot"><a href="GHC.Tc.Module.html#tcRnStmt"><span class="hs-identifier hs-type">tcRnStmt</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Driver.Env.Types.html#HscEnv"><span class="hs-identifier hs-type">HscEnv</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Language.Haskell.Syntax.Expr.html#GhciLStmt"><span class="hs-identifier hs-type">GhciLStmt</span></a></span><span> </span><span class="annot"><a href="GHC.Hs.Extension.html#GhcPs"><span class="hs-identifier hs-type">GhcPs</span></a></span><span>
</span><span id="line-2171"></span><span>         </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Types.Error.html#Messages"><span class="hs-identifier hs-type">Messages</span></a></span><span> </span><span class="annot"><a href="GHC.Tc.Errors.Types.html#TcRnMessage"><span class="hs-identifier hs-type">TcRnMessage</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Maybe</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">[</span><span class="annot"><a href="GHC.Types.Var.html#Id"><span class="hs-identifier hs-type">Id</span></a></span><span class="hs-special">]</span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Language.Haskell.Syntax.Expr.html#LHsExpr"><span class="hs-identifier hs-type">LHsExpr</span></a></span><span> </span><span class="annot"><a href="GHC.Hs.Extension.html#GhcTc"><span class="hs-identifier hs-type">GhcTc</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Types.Fixity.Env.html#FixityEnv"><span class="hs-identifier hs-type">FixityEnv</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-2172"></span><span id="tcRnStmt"><span class="annot"><span class="annottext">tcRnStmt :: HscEnv
-&gt; GhciLStmt GhcPs
-&gt; IO
     (Messages TcRnMessage, Maybe ([Id], LHsExpr GhcTc, FixityEnv))
</span><a href="GHC.Tc.Module.html#tcRnStmt"><span class="hs-identifier hs-var hs-var">tcRnStmt</span></a></span></span><span> </span><span id="local-6989586621683117645"><span class="annot"><span class="annottext">HscEnv
</span><a href="#local-6989586621683117645"><span class="hs-identifier hs-var">hsc_env</span></a></span></span><span> </span><span id="local-6989586621683117646"><span class="annot"><span class="annottext">GhciLStmt GhcPs
</span><a href="#local-6989586621683117646"><span class="hs-identifier hs-var">rdr_stmt</span></a></span></span><span>
</span><span id="line-2173"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">HscEnv
-&gt; TcRn ([Id], LHsExpr GhcTc, FixityEnv)
-&gt; IO
     (Messages TcRnMessage, Maybe ([Id], LHsExpr GhcTc, FixityEnv))
forall a. HscEnv -&gt; TcRn a -&gt; IO (Messages TcRnMessage, Maybe a)
</span><a href="GHC.Tc.Module.html#runTcInteractive"><span class="hs-identifier hs-var">runTcInteractive</span></a></span><span> </span><span class="annot"><span class="annottext">HscEnv
</span><a href="#local-6989586621683117645"><span class="hs-identifier hs-var">hsc_env</span></a></span><span> </span><span class="annot"><span class="annottext">(TcRn ([Id], LHsExpr GhcTc, FixityEnv)
 -&gt; IO
      (Messages TcRnMessage, Maybe ([Id], LHsExpr GhcTc, FixityEnv)))
-&gt; TcRn ([Id], LHsExpr GhcTc, FixityEnv)
-&gt; IO
     (Messages TcRnMessage, Maybe ([Id], LHsExpr GhcTc, FixityEnv))
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span>
</span><span id="line-2174"></span><span>
</span><span id="line-2175"></span><span>    </span><span class="hs-comment">-- The real work is done here</span><span>
</span><span id="line-2176"></span><span>    </span><span class="hs-special">(</span><span class="hs-special">(</span><span id="local-6989586621683117647"><span class="annot"><a href="#local-6989586621683117647"><span class="hs-identifier hs-var">bound_ids</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621683117648"><span class="annot"><a href="#local-6989586621683117648"><span class="hs-identifier hs-var">tc_expr</span></a></span></span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span id="local-6989586621683117649"><span class="annot"><a href="#local-6989586621683117649"><span class="hs-identifier hs-var">fix_env</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">GhciLStmt GhcPs -&gt; TcM (PlanResult, FixityEnv)
</span><a href="GHC.Tc.Module.html#tcUserStmt"><span class="hs-identifier hs-var">tcUserStmt</span></a></span><span> </span><span class="annot"><span class="annottext">GhciLStmt GhcPs
</span><a href="#local-6989586621683117646"><span class="hs-identifier hs-var">rdr_stmt</span></a></span><span> </span><span class="hs-special">;</span><span>
</span><span id="line-2177"></span><span>    </span><span id="local-6989586621683117651"><span class="annot"><a href="#local-6989586621683117651"><span class="hs-identifier hs-var">zonked_expr</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><a href="GHC.Tc.Zonk.Type.html#zonkTopLExpr"><span class="hs-identifier hs-type">zonkTopLExpr</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683117648"><span class="hs-identifier hs-type">tc_expr</span></a></span><span> </span><span class="hs-special">;</span><span>
</span><span id="line-2178"></span><span>    </span><span id="local-6989586621683117653"><span class="annot"><a href="#local-6989586621683117653"><span class="hs-identifier hs-var">zonked_ids</span></a></span></span><span>  </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><a href="GHC.Tc.Zonk.Type.html#zonkTopBndrs"><span class="hs-identifier hs-type">zonkTopBndrs</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683117647"><span class="hs-identifier hs-type">bound_ids</span></a></span><span> </span><span class="hs-special">;</span><span>
</span><span id="line-2179"></span><span>
</span><span id="line-2180"></span><span>    </span><span class="annot"><a href="GHC.Tc.Utils.Monad.html#failIfErrsM"><span class="hs-identifier hs-type">failIfErrsM</span></a></span><span> </span><span class="hs-special">;</span><span>  </span><span class="hs-comment">-- we can't do the next step if there are</span><span>
</span><span id="line-2181"></span><span>                   </span><span class="hs-comment">-- representation polymorphism errors</span><span>
</span><span id="line-2182"></span><span>                   </span><span class="hs-comment">-- test case: ghci/scripts/T13202{,a}</span><span>
</span><span id="line-2183"></span><span>
</span><span id="line-2184"></span><span>        </span><span class="hs-comment">-- None of the Ids should be of unboxed type, because we</span><span>
</span><span id="line-2185"></span><span>        </span><span class="hs-comment">-- cast them all to HValues in the end!</span><span>
</span><span id="line-2186"></span><span>    </span><span class="annot"><span class="hs-identifier hs-type">mapM_</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Tc.Utils.Monad.html#addErr"><span class="hs-identifier hs-type">addErr</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">.</span></span><span> </span><span class="annot"><a href="GHC.Tc.Errors.Types.html#TcRnGhciUnliftedBind"><span class="hs-identifier hs-type">TcRnGhciUnliftedBind</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span>
</span><span id="line-2187"></span><span>      </span><span class="annot"><span class="hs-identifier hs-type">filter</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Core.Type.html#mightBeUnliftedType"><span class="hs-identifier hs-type">mightBeUnliftedType</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">.</span></span><span> </span><span class="annot"><a href="GHC.Types.Id.html#idType"><span class="hs-identifier hs-type">idType</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><a href="#local-6989586621683117653"><span class="hs-identifier hs-type">zonked_ids</span></a></span><span> </span><span class="hs-special">;</span><span>
</span><span id="line-2188"></span><span>
</span><span id="line-2189"></span><span>    </span><span class="annot"><a href="GHC.Tc.Utils.Monad.html#traceTc"><span class="hs-identifier hs-type">traceTc</span></a></span><span> </span><span class="annot"><span class="hs-string">&quot;tcs 1&quot;</span></span><span> </span><span class="annot"><a href="GHC.Utils.Outputable.html#empty"><span class="hs-identifier hs-type">empty</span></a></span><span> </span><span class="hs-special">;</span><span>
</span><span id="line-2190"></span><span>    </span><span id="local-6989586621683117657"><span class="annot"><a href="#local-6989586621683117657"><span class="hs-identifier hs-var">this_mod</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><a href="GHC.Unit.Module.html#getModule"><span class="hs-identifier hs-type">getModule</span></a></span><span> </span><span class="hs-special">;</span><span>
</span><span id="line-2191"></span><span>    </span><span id="local-6989586621683117658"><span class="annot"><a href="#local-6989586621683117658"><span class="hs-identifier hs-var">global_ids</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="hs-identifier hs-type">mapM</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Tc.Module.html#externaliseAndTidyId"><span class="hs-identifier hs-type">externaliseAndTidyId</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683117657"><span class="hs-identifier hs-type">this_mod</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><a href="#local-6989586621683117653"><span class="hs-identifier hs-type">zonked_ids</span></a></span><span> </span><span class="hs-special">;</span><span>
</span><span id="line-2192"></span><span>        </span><span class="hs-comment">-- Note [Interactively-bound Ids in GHCi] in GHC.Driver.Env</span><span>
</span><span id="line-2193"></span><span>
</span><span id="line-2194"></span><span>    </span><span class="annot"><a href="GHC.Tc.Utils.Monad.html#traceOptTcRn"><span class="hs-identifier hs-type">traceOptTcRn</span></a></span><span> </span><span class="annot"><a href="GHC.Driver.Flags.html#Opt_D_dump_tc"><span class="hs-identifier hs-type">Opt_D_dump_tc</span></a></span><span>
</span><span id="line-2195"></span><span>        </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Utils.Outputable.html#vcat"><span class="hs-identifier hs-type">vcat</span></a></span><span> </span><span class="hs-special">[</span><span class="annot"><a href="GHC.Utils.Outputable.html#text"><span class="hs-identifier hs-type">text</span></a></span><span> </span><span class="annot"><span class="hs-string">&quot;Bound Ids&quot;</span></span><span> </span><span class="annot"><a href="GHC.Utils.Outputable.html#%3C%2B%3E"><span class="hs-operator hs-type">&lt;+&gt;</span></a></span><span> </span><span class="annot"><a href="GHC.Utils.Outputable.html#pprWithCommas"><span class="hs-identifier hs-type">pprWithCommas</span></a></span><span> </span><span class="annot"><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-type">ppr</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683117658"><span class="hs-identifier hs-type">global_ids</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-2196"></span><span>               </span><span class="annot"><a href="GHC.Utils.Outputable.html#text"><span class="hs-identifier hs-type">text</span></a></span><span> </span><span class="annot"><span class="hs-string">&quot;Typechecked expr&quot;</span></span><span> </span><span class="annot"><a href="GHC.Utils.Outputable.html#%3C%2B%3E"><span class="hs-operator hs-type">&lt;+&gt;</span></a></span><span> </span><span class="annot"><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-type">ppr</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683117651"><span class="hs-identifier hs-type">zonked_expr</span></a></span><span class="hs-special">]</span><span class="hs-special">)</span><span> </span><span class="hs-special">;</span><span>
</span><span id="line-2197"></span><span>
</span><span id="line-2198"></span><span>    </span><span class="annot"><span class="hs-identifier hs-type">return</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621683117658"><span class="hs-identifier hs-type">global_ids</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="#local-6989586621683117651"><span class="hs-identifier hs-type">zonked_expr</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="#local-6989586621683117649"><span class="hs-identifier hs-type">fix_env</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-2199"></span><span>    </span><span class="hs-special">}</span><span>
</span><span id="line-2200"></span><span>
</span><span id="line-2201"></span><span class="hs-comment">{-
--------------------------------------------------------------------------
                Typechecking Stmts in GHCi

Here is the grand plan, implemented in tcUserStmt

        What you type                   The IO [HValue] that hscStmt returns
        -------------                   ------------------------------------
        let pat = expr          ==&gt;     let pat = expr in return [coerce HVal x, coerce HVal y, ...]
                                        bindings: [x,y,...]

        pat &lt;- expr             ==&gt;     expr &gt;&gt;= \ pat -&gt; return [coerce HVal x, coerce HVal y, ...]
                                        bindings: [x,y,...]

        expr (of IO type)       ==&gt;     expr &gt;&gt;= \ it -&gt; return [coerce HVal it]
          [NB: result not printed]      bindings: [it]

        expr (of non-IO type,   ==&gt;     let it = expr in print it &gt;&gt; return [coerce HVal it]
          result showable)              bindings: [it]

        expr (of non-IO type,
          result not showable)  ==&gt;     error
-}</span><span>
</span><span id="line-2224"></span><span>
</span><span id="line-2225"></span><span class="annot"><span class="hs-comment">-- | A plan is an attempt to lift some code into the IO monad.</span></span><span>
</span><span id="line-2226"></span><span class="hs-keyword">type</span><span> </span><span id="PlanResult"><span class="annot"><a href="GHC.Tc.Module.html#PlanResult"><span class="hs-identifier hs-var">PlanResult</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><span class="hs-special">[</span><span class="annot"><a href="GHC.Types.Var.html#Id"><span class="hs-identifier hs-type">Id</span></a></span><span class="hs-special">]</span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Language.Haskell.Syntax.Expr.html#LHsExpr"><span class="hs-identifier hs-type">LHsExpr</span></a></span><span> </span><span class="annot"><a href="GHC.Hs.Extension.html#GhcTc"><span class="hs-identifier hs-type">GhcTc</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-2227"></span><span class="hs-keyword">type</span><span> </span><span id="Plan"><span class="annot"><a href="GHC.Tc.Module.html#Plan"><span class="hs-identifier hs-var">Plan</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#TcM"><span class="hs-identifier hs-type">TcM</span></a></span><span> </span><span class="annot"><a href="GHC.Tc.Module.html#PlanResult"><span class="hs-identifier hs-type">PlanResult</span></a></span><span>
</span><span id="line-2228"></span><span>
</span><span id="line-2229"></span><span class="hs-comment">-- | Try the plans in order. If one fails (by raising an exn), try the next.</span><span>
</span><span id="line-2230"></span><span class="hs-comment">-- If one succeeds, take it.</span><span>
</span><span id="line-2231"></span><span class="annot"><a href="GHC.Tc.Module.html#runPlans"><span class="hs-identifier hs-type">runPlans</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">NonEmpty</span></span><span> </span><span class="annot"><a href="GHC.Tc.Module.html#Plan"><span class="hs-identifier hs-type">Plan</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Module.html#Plan"><span class="hs-identifier hs-type">Plan</span></a></span><span>
</span><span id="line-2232"></span><span id="runPlans"><span class="annot"><span class="annottext">runPlans :: NonEmpty Plan -&gt; Plan
</span><a href="GHC.Tc.Module.html#runPlans"><span class="hs-identifier hs-var hs-var">runPlans</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(TcM ([Id], GenLocated SrcSpanAnnA (HsExpr GhcTc))
 -&gt; TcM ([Id], GenLocated SrcSpanAnnA (HsExpr GhcTc))
 -&gt; TcM ([Id], GenLocated SrcSpanAnnA (HsExpr GhcTc)))
-&gt; NonEmpty (TcM ([Id], GenLocated SrcSpanAnnA (HsExpr GhcTc)))
-&gt; TcM ([Id], GenLocated SrcSpanAnnA (HsExpr GhcTc))
forall a. (a -&gt; a -&gt; a) -&gt; NonEmpty a -&gt; a
forall (t :: * -&gt; *) a. Foldable t =&gt; (a -&gt; a -&gt; a) -&gt; t a -&gt; a
</span><span class="hs-identifier hs-var">foldr1</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(TcM ([Id], GenLocated SrcSpanAnnA (HsExpr GhcTc))
 -&gt; TcM ([Id], GenLocated SrcSpanAnnA (HsExpr GhcTc))
 -&gt; TcM ([Id], GenLocated SrcSpanAnnA (HsExpr GhcTc)))
-&gt; TcM ([Id], GenLocated SrcSpanAnnA (HsExpr GhcTc))
-&gt; TcM ([Id], GenLocated SrcSpanAnnA (HsExpr GhcTc))
-&gt; TcM ([Id], GenLocated SrcSpanAnnA (HsExpr GhcTc))
forall a b c. (a -&gt; b -&gt; c) -&gt; b -&gt; a -&gt; c
</span><span class="hs-identifier hs-var">flip</span></span><span> </span><span class="annot"><span class="annottext">TcM ([Id], GenLocated SrcSpanAnnA (HsExpr GhcTc))
-&gt; TcM ([Id], GenLocated SrcSpanAnnA (HsExpr GhcTc))
-&gt; TcM ([Id], GenLocated SrcSpanAnnA (HsExpr GhcTc))
forall r. TcM r -&gt; TcM r -&gt; TcM r
</span><a href="GHC.Tc.Utils.Monad.html#tryTcDiscardingErrs"><span class="hs-identifier hs-var">tryTcDiscardingErrs</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-2233"></span><span>
</span><span id="line-2234"></span><span class="hs-comment">-- | Typecheck (and 'lift') a stmt entered by the user in GHCi into the</span><span>
</span><span id="line-2235"></span><span class="hs-comment">-- GHCi 'environment'.</span><span>
</span><span id="line-2236"></span><span class="hs-comment">--</span><span>
</span><span id="line-2237"></span><span class="hs-comment">-- By 'lift' and 'environment we mean that the code is changed to</span><span>
</span><span id="line-2238"></span><span class="hs-comment">-- execute properly in an IO monad. See Note [Interactively-bound Ids</span><span>
</span><span id="line-2239"></span><span class="hs-comment">-- in GHCi] in GHC.Driver.Env for more details. We do this lifting by trying</span><span>
</span><span id="line-2240"></span><span class="hs-comment">-- different ways ('plans') of lifting the code into the IO monad and</span><span>
</span><span id="line-2241"></span><span class="hs-comment">-- type checking each plan until one succeeds.</span><span>
</span><span id="line-2242"></span><span class="annot"><a href="GHC.Tc.Module.html#tcUserStmt"><span class="hs-identifier hs-type">tcUserStmt</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Language.Haskell.Syntax.Expr.html#GhciLStmt"><span class="hs-identifier hs-type">GhciLStmt</span></a></span><span> </span><span class="annot"><a href="GHC.Hs.Extension.html#GhcPs"><span class="hs-identifier hs-type">GhcPs</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#TcM"><span class="hs-identifier hs-type">TcM</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Tc.Module.html#PlanResult"><span class="hs-identifier hs-type">PlanResult</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Types.Fixity.Env.html#FixityEnv"><span class="hs-identifier hs-type">FixityEnv</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-2243"></span><span>
</span><span id="line-2244"></span><span class="hs-comment">-- An expression typed at the prompt is treated very specially</span><span>
</span><span id="line-2245"></span><span id="tcUserStmt"><span class="annot"><span class="annottext">tcUserStmt :: GhciLStmt GhcPs -&gt; TcM (PlanResult, FixityEnv)
</span><a href="GHC.Tc.Module.html#tcUserStmt"><span class="hs-identifier hs-var hs-var">tcUserStmt</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Types.SrcLoc.html#L"><span class="hs-identifier hs-type">L</span></a></span><span> </span><span id="local-6989586621683117668"><span class="annot"><span class="annottext">SrcSpanAnnA
</span><a href="#local-6989586621683117668"><span class="hs-identifier hs-var">loc</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Language.Haskell.Syntax.Expr.html#BodyStmt"><span class="hs-identifier hs-type">BodyStmt</span></a></span><span> </span><span class="annot"><span class="annottext">XBodyStmt GhcPs GhcPs (GenLocated SrcSpanAnnA (HsExpr GhcPs))
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621683117670"><span class="annot"><span class="annottext">GenLocated SrcSpanAnnA (HsExpr GhcPs)
</span><a href="#local-6989586621683117670"><span class="hs-identifier hs-var">expr</span></a></span></span><span> </span><span class="annot"><span class="annottext">SyntaxExpr GhcPs
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">SyntaxExpr GhcPs
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-2246"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>  </span><span class="hs-special">{</span><span> </span><span class="hs-special">(</span><span id="local-6989586621683117671"><span class="annot"><a href="#local-6989586621683117671"><span class="hs-identifier hs-var">rn_expr</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621683117672"><span class="annot"><a href="#local-6989586621683117672"><span class="hs-identifier hs-var">fvs</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">TcM (GenLocated SrcSpanAnnA (HsExpr (GhcPass 'Renamed)), FreeVars)
-&gt; TcM
     (GenLocated SrcSpanAnnA (HsExpr (GhcPass 'Renamed)), FreeVars)
forall r. TcM r -&gt; TcM r
</span><a href="GHC.Tc.Utils.Monad.html#checkNoErrs"><span class="hs-identifier hs-var">checkNoErrs</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">LHsExpr GhcPs -&gt; RnM (LHsExpr (GhcPass 'Renamed), FreeVars)
</span><a href="GHC.Rename.Expr.html#rnLExpr"><span class="hs-identifier hs-var">rnLExpr</span></a></span><span> </span><span class="annot"><span class="annottext">LHsExpr GhcPs
GenLocated SrcSpanAnnA (HsExpr GhcPs)
</span><a href="#local-6989586621683117670"><span class="hs-identifier hs-var">expr</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-2247"></span><span>
</span><span id="line-2248"></span><span>        </span><span class="hs-special">;</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.Monad.html#dumpOptTcRn"><span class="hs-identifier hs-type">dumpOptTcRn</span></a></span><span> </span><span class="annot"><a href="GHC.Driver.Flags.html#Opt_D_dump_rn_ast"><span class="hs-identifier hs-type">Opt_D_dump_rn_ast</span></a></span><span> </span><span class="annot"><span class="hs-string">&quot;Renamer&quot;</span></span><span> </span><span class="annot"><a href="GHC.Utils.Logger.html#FormatHaskell"><span class="hs-identifier hs-type">FormatHaskell</span></a></span><span>
</span><span id="line-2249"></span><span>            </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Hs.Dump.html#showAstData"><span class="hs-identifier hs-type">showAstData</span></a></span><span> </span><span class="annot"><a href="GHC.Hs.Dump.html#NoBlankSrcSpan"><span class="hs-identifier hs-type">NoBlankSrcSpan</span></a></span><span> </span><span class="annot"><a href="GHC.Hs.Dump.html#NoBlankEpAnnotations"><span class="hs-identifier hs-type">NoBlankEpAnnotations</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683117671"><span class="hs-identifier hs-type">rn_expr</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-2250"></span><span>               </span><span class="hs-comment">-- Don't try to typecheck if the renamer fails!</span><span>
</span><span id="line-2251"></span><span>        </span><span class="hs-special">;</span><span> </span><span id="local-6989586621683117680"><span class="annot"><a href="#local-6989586621683117680"><span class="hs-identifier hs-var">ghciStep</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><a href="GHC.Tc.Module.html#getGhciStepIO"><span class="hs-identifier hs-type">getGhciStepIO</span></a></span><span>
</span><span id="line-2252"></span><span>        </span><span class="hs-special">;</span><span> </span><span id="local-6989586621683117682"><span class="annot"><a href="#local-6989586621683117682"><span class="hs-identifier hs-var">uniq</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.Monad.html#newUnique"><span class="hs-identifier hs-type">newUnique</span></a></span><span>
</span><span id="line-2253"></span><span>        </span><span class="hs-special">;</span><span> </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621683117684"><span class="annot"><a href="#local-6989586621683117684"><span class="hs-identifier hs-var hs-var">loc'</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">SrcSpan -&gt; SrcSpanAnnN
forall e. HasAnnotation e =&gt; SrcSpan -&gt; e
</span><a href="GHC.Parser.Annotation.html#noAnnSrcSpan"><span class="hs-identifier hs-var">noAnnSrcSpan</span></a></span><span> </span><span class="annot"><span class="annottext">(SrcSpan -&gt; SrcSpanAnnN) -&gt; SrcSpan -&gt; SrcSpanAnnN
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">SrcSpanAnnA -&gt; SrcSpan
forall a. HasLoc a =&gt; a -&gt; SrcSpan
</span><a href="GHC.Parser.Annotation.html#locA"><span class="hs-identifier hs-var">locA</span></a></span><span> </span><span class="annot"><span class="annottext">SrcSpanAnnA
</span><a href="#local-6989586621683117668"><span class="hs-identifier hs-var">loc</span></a></span><span>
</span><span id="line-2254"></span><span>        </span><span class="hs-special">;</span><span> </span><span id="local-6989586621683117685"><span class="annot"><a href="#local-6989586621683117685"><span class="hs-identifier hs-var">interPrintName</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.Monad.html#getInteractivePrintName"><span class="hs-identifier hs-type">getInteractivePrintName</span></a></span><span>
</span><span id="line-2255"></span><span>        </span><span class="hs-special">;</span><span> </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621683117687"><span class="annot"><a href="#local-6989586621683117687"><span class="hs-identifier hs-var hs-var">fresh_it</span></a></span></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Unique -&gt; SrcSpan -&gt; Name
</span><a href="GHC.Builtin.Names.html#itName"><span class="hs-identifier hs-var">itName</span></a></span><span> </span><span class="annot"><span class="annottext">Unique
</span><a href="#local-6989586621683117682"><span class="hs-identifier hs-var">uniq</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">SrcSpanAnnA -&gt; SrcSpan
forall a. HasLoc a =&gt; a -&gt; SrcSpan
</span><a href="GHC.Parser.Annotation.html#locA"><span class="hs-identifier hs-var">locA</span></a></span><span> </span><span class="annot"><span class="annottext">SrcSpanAnnA
</span><a href="#local-6989586621683117668"><span class="hs-identifier hs-var">loc</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-2256"></span><span>              </span><span id="local-6989586621683117689"><span class="annot"><a href="#local-6989586621683117689"><span class="hs-identifier hs-var hs-var">matches</span></a></span></span><span>   </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">HsMatchContext (LIdP (NoGhcTc (GhcPass 'Renamed)))
-&gt; LocatedE [LPat (GhcPass 'Renamed)]
-&gt; LHsExpr (GhcPass 'Renamed)
-&gt; HsLocalBinds (GhcPass 'Renamed)
-&gt; LMatch (GhcPass 'Renamed) (LHsExpr (GhcPass 'Renamed))
forall (p :: Pass).
IsPass p =&gt;
HsMatchContext (LIdP (NoGhcTc (GhcPass p)))
-&gt; LocatedE [LPat (GhcPass p)]
-&gt; LHsExpr (GhcPass p)
-&gt; HsLocalBinds (GhcPass p)
-&gt; LMatch (GhcPass p) (LHsExpr (GhcPass p))
</span><a href="GHC.Hs.Utils.html#mkMatch"><span class="hs-identifier hs-var">mkMatch</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">GenLocated SrcSpanAnnN Name
-&gt; AnnFunRhs -&gt; HsMatchContext (GenLocated SrcSpanAnnN Name)
forall fn. fn -&gt; AnnFunRhs -&gt; HsMatchContext fn
</span><a href="GHC.Hs.Utils.html#mkPrefixFunRhs"><span class="hs-identifier hs-var">mkPrefixFunRhs</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">SrcSpanAnnN -&gt; Name -&gt; GenLocated SrcSpanAnnN Name
forall l e. l -&gt; e -&gt; GenLocated l e
</span><a href="GHC.Types.SrcLoc.html#L"><span class="hs-identifier hs-var">L</span></a></span><span> </span><span class="annot"><span class="annottext">SrcSpanAnnN
</span><a href="#local-6989586621683117684"><span class="hs-identifier hs-var">loc'</span></a></span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621683117687"><span class="hs-identifier hs-var">fresh_it</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">AnnFunRhs
forall a. NoAnn a =&gt; a
</span><a href="GHC.Parser.Annotation.html#noAnn"><span class="hs-identifier hs-var">noAnn</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[GenLocated SrcSpanAnnA (Pat (GhcPass 'Renamed))]
-&gt; GenLocated
     EpaLocation [GenLocated SrcSpanAnnA (Pat (GhcPass 'Renamed))]
forall e a. HasAnnotation e =&gt; a -&gt; GenLocated e a
</span><a href="GHC.Parser.Annotation.html#noLocA"><span class="hs-identifier hs-var">noLocA</span></a></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">LHsExpr (GhcPass 'Renamed)
GenLocated SrcSpanAnnA (HsExpr (GhcPass 'Renamed))
</span><a href="#local-6989586621683117671"><span class="hs-identifier hs-var">rn_expr</span></a></span><span>
</span><span id="line-2257"></span><span>                                   </span><span class="annot"><span class="annottext">HsLocalBinds (GhcPass 'Renamed)
forall (a :: Pass) (b :: Pass).
HsLocalBindsLR (GhcPass a) (GhcPass b)
</span><a href="GHC.Hs.Binds.html#emptyLocalBinds"><span class="hs-identifier hs-var">emptyLocalBinds</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-2258"></span><span>              </span><span class="hs-comment">-- [it = expr]</span><span>
</span><span id="line-2259"></span><span>              </span><span id="local-6989586621683117694"><span class="annot"><a href="#local-6989586621683117694"><span class="hs-identifier hs-var hs-var">the_bind</span></a></span></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">SrcSpanAnnA
-&gt; HsBindLR (GhcPass 'Renamed) (GhcPass 'Renamed)
-&gt; GenLocated
     SrcSpanAnnA (HsBindLR (GhcPass 'Renamed) (GhcPass 'Renamed))
forall l e. l -&gt; e -&gt; GenLocated l e
</span><a href="GHC.Types.SrcLoc.html#L"><span class="hs-identifier hs-var">L</span></a></span><span> </span><span class="annot"><span class="annottext">SrcSpanAnnA
</span><a href="#local-6989586621683117668"><span class="hs-identifier hs-var">loc</span></a></span><span> </span><span class="annot"><span class="annottext">(HsBindLR (GhcPass 'Renamed) (GhcPass 'Renamed)
 -&gt; GenLocated
      SrcSpanAnnA (HsBindLR (GhcPass 'Renamed) (GhcPass 'Renamed)))
-&gt; HsBindLR (GhcPass 'Renamed) (GhcPass 'Renamed)
-&gt; GenLocated
     SrcSpanAnnA (HsBindLR (GhcPass 'Renamed) (GhcPass 'Renamed))
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Origin
-&gt; GenLocated SrcSpanAnnN Name
-&gt; [LMatch (GhcPass 'Renamed) (LHsExpr (GhcPass 'Renamed))]
-&gt; HsBindLR (GhcPass 'Renamed) (GhcPass 'Renamed)
</span><a href="GHC.Hs.Utils.html#mkTopFunBind"><span class="hs-identifier hs-var">mkTopFunBind</span></a></span><span> </span><span class="annot"><span class="annottext">Origin
</span><a href="GHC.Types.Basic.html#FromSource"><span class="hs-identifier hs-var">FromSource</span></a></span><span>
</span><span id="line-2260"></span><span>                                     </span><span class="hs-special">(</span><span class="annot"><span class="annottext">SrcSpanAnnN -&gt; Name -&gt; GenLocated SrcSpanAnnN Name
forall l e. l -&gt; e -&gt; GenLocated l e
</span><a href="GHC.Types.SrcLoc.html#L"><span class="hs-identifier hs-var">L</span></a></span><span> </span><span class="annot"><span class="annottext">SrcSpanAnnN
</span><a href="#local-6989586621683117684"><span class="hs-identifier hs-var">loc'</span></a></span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621683117687"><span class="hs-identifier hs-var">fresh_it</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[LMatch (GhcPass 'Renamed) (LHsExpr (GhcPass 'Renamed))]
[GenLocated
   SrcSpanAnnA
   (Match
      (GhcPass 'Renamed)
      (GenLocated SrcSpanAnnA (HsExpr (GhcPass 'Renamed))))]
</span><a href="#local-6989586621683117689"><span class="hs-identifier hs-var">matches</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-2261"></span><span>                                         </span><span class="hs-special">{</span><span> </span><span class="annot"><a href="Language.Haskell.Syntax.Binds.html#fun_ext"><span class="hs-identifier hs-var">fun_ext</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="#local-6989586621683117672"><span class="hs-identifier hs-type">fvs</span></a></span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-2262"></span><span>              </span><span class="hs-comment">-- Care here!  In GHCi the expression might have</span><span>
</span><span id="line-2263"></span><span>              </span><span class="hs-comment">-- free variables, and they in turn may have free type variables</span><span>
</span><span id="line-2264"></span><span>              </span><span class="hs-comment">-- (if we are at a breakpoint, say).  We must put those free vars</span><span>
</span><span id="line-2265"></span><span>
</span><span id="line-2266"></span><span>              </span><span class="hs-comment">-- [let it = expr]</span><span>
</span><span id="line-2267"></span><span>              </span><span id="local-6989586621683117698"><span class="annot"><a href="#local-6989586621683117698"><span class="hs-identifier hs-var hs-var">let_stmt</span></a></span></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">SrcSpanAnnA
-&gt; StmtLR
     (GhcPass 'Renamed)
     (GhcPass 'Renamed)
     (GenLocated SrcSpanAnnA (HsExpr (GhcPass 'Renamed)))
-&gt; GenLocated
     SrcSpanAnnA
     (StmtLR
        (GhcPass 'Renamed)
        (GhcPass 'Renamed)
        (GenLocated SrcSpanAnnA (HsExpr (GhcPass 'Renamed))))
forall l e. l -&gt; e -&gt; GenLocated l e
</span><a href="GHC.Types.SrcLoc.html#L"><span class="hs-identifier hs-var">L</span></a></span><span> </span><span class="annot"><span class="annottext">SrcSpanAnnA
</span><a href="#local-6989586621683117668"><span class="hs-identifier hs-var">loc</span></a></span><span> </span><span class="annot"><span class="annottext">(StmtLR
   (GhcPass 'Renamed)
   (GhcPass 'Renamed)
   (GenLocated SrcSpanAnnA (HsExpr (GhcPass 'Renamed)))
 -&gt; GenLocated
      SrcSpanAnnA
      (StmtLR
         (GhcPass 'Renamed)
         (GhcPass 'Renamed)
         (GenLocated SrcSpanAnnA (HsExpr (GhcPass 'Renamed)))))
-&gt; StmtLR
     (GhcPass 'Renamed)
     (GhcPass 'Renamed)
     (GenLocated SrcSpanAnnA (HsExpr (GhcPass 'Renamed)))
-&gt; GenLocated
     SrcSpanAnnA
     (StmtLR
        (GhcPass 'Renamed)
        (GhcPass 'Renamed)
        (GenLocated SrcSpanAnnA (HsExpr (GhcPass 'Renamed))))
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">XLetStmt
  (GhcPass 'Renamed)
  (GhcPass 'Renamed)
  (GenLocated SrcSpanAnnA (HsExpr (GhcPass 'Renamed)))
-&gt; HsLocalBinds (GhcPass 'Renamed)
-&gt; StmtLR
     (GhcPass 'Renamed)
     (GhcPass 'Renamed)
     (GenLocated SrcSpanAnnA (HsExpr (GhcPass 'Renamed)))
forall idL idR body.
XLetStmt idL idR body
-&gt; HsLocalBindsLR idL idR -&gt; StmtLR idL idR body
</span><a href="Language.Haskell.Syntax.Expr.html#LetStmt"><span class="hs-identifier hs-var">LetStmt</span></a></span><span> </span><span class="annot"><span class="annottext">XLetStmt
  (GhcPass 'Renamed)
  (GhcPass 'Renamed)
  (GenLocated SrcSpanAnnA (HsExpr (GhcPass 'Renamed)))
forall a. NoAnn a =&gt; a
</span><a href="GHC.Parser.Annotation.html#noAnn"><span class="hs-identifier hs-var">noAnn</span></a></span><span> </span><span class="annot"><span class="annottext">(HsLocalBinds (GhcPass 'Renamed)
 -&gt; StmtLR
      (GhcPass 'Renamed)
      (GhcPass 'Renamed)
      (GenLocated SrcSpanAnnA (HsExpr (GhcPass 'Renamed))))
-&gt; HsLocalBinds (GhcPass 'Renamed)
-&gt; StmtLR
     (GhcPass 'Renamed)
     (GhcPass 'Renamed)
     (GenLocated SrcSpanAnnA (HsExpr (GhcPass 'Renamed)))
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">XHsValBinds (GhcPass 'Renamed) (GhcPass 'Renamed)
-&gt; HsValBindsLR (GhcPass 'Renamed) (GhcPass 'Renamed)
-&gt; HsLocalBinds (GhcPass 'Renamed)
forall idL idR.
XHsValBinds idL idR
-&gt; HsValBindsLR idL idR -&gt; HsLocalBindsLR idL idR
</span><a href="Language.Haskell.Syntax.Binds.html#HsValBinds"><span class="hs-identifier hs-var">HsValBinds</span></a></span><span> </span><span class="annot"><span class="annottext">XHsValBinds (GhcPass 'Renamed) (GhcPass 'Renamed)
forall a. NoAnn a =&gt; a
</span><a href="GHC.Parser.Annotation.html#noAnn"><span class="hs-identifier hs-var">noAnn</span></a></span><span>
</span><span id="line-2268"></span><span>                           </span><span class="annot"><span class="annottext">(HsValBindsLR (GhcPass 'Renamed) (GhcPass 'Renamed)
 -&gt; HsLocalBinds (GhcPass 'Renamed))
-&gt; HsValBindsLR (GhcPass 'Renamed) (GhcPass 'Renamed)
-&gt; HsLocalBinds (GhcPass 'Renamed)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">XXValBindsLR (GhcPass 'Renamed) (GhcPass 'Renamed)
-&gt; HsValBindsLR (GhcPass 'Renamed) (GhcPass 'Renamed)
forall idL idR. XXValBindsLR idL idR -&gt; HsValBindsLR idL idR
</span><a href="Language.Haskell.Syntax.Binds.html#XValBindsLR"><span class="hs-identifier hs-var">XValBindsLR</span></a></span><span>
</span><span id="line-2269"></span><span>                               </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[(RecFlag, LHsBinds (GhcPass 'Renamed))]
-&gt; [LSig (GhcPass 'Renamed)] -&gt; NHsValBindsLR (GhcPass 'Renamed)
forall idL.
[(RecFlag, LHsBinds idL)]
-&gt; [LSig (GhcPass 'Renamed)] -&gt; NHsValBindsLR idL
</span><a href="GHC.Hs.Binds.html#NValBinds"><span class="hs-identifier hs-var">NValBinds</span></a></span><span> </span><span class="hs-special">[</span><span class="hs-special">(</span><span class="annot"><span class="annottext">RecFlag
</span><a href="GHC.Types.Basic.html#NonRecursive"><span class="hs-identifier hs-var">NonRecursive</span></a></span><span class="hs-special">,</span><span class="hs-special">[</span><span class="annot"><span class="annottext">XRec
  (GhcPass 'Renamed) (HsBindLR (GhcPass 'Renamed) (GhcPass 'Renamed))
GenLocated
  SrcSpanAnnA (HsBindLR (GhcPass 'Renamed) (GhcPass 'Renamed))
</span><a href="#local-6989586621683117694"><span class="hs-identifier hs-var">the_bind</span></a></span><span class="hs-special">]</span><span class="hs-special">)</span><span class="hs-special">]</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span class="hs-special">)</span><span>
</span><span id="line-2270"></span><span>
</span><span id="line-2271"></span><span>              </span><span class="hs-comment">-- [it &lt;- e]</span><span>
</span><span id="line-2272"></span><span>              </span><span id="local-6989586621683117702"><span class="annot"><a href="#local-6989586621683117702"><span class="hs-identifier hs-var hs-var">bind_stmt</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">SrcSpanAnnA
-&gt; StmtLR
     (GhcPass 'Renamed)
     (GhcPass 'Renamed)
     (GenLocated SrcSpanAnnA (HsExpr (GhcPass 'Renamed)))
-&gt; GenLocated
     SrcSpanAnnA
     (StmtLR
        (GhcPass 'Renamed)
        (GhcPass 'Renamed)
        (GenLocated SrcSpanAnnA (HsExpr (GhcPass 'Renamed))))
forall l e. l -&gt; e -&gt; GenLocated l e
</span><a href="GHC.Types.SrcLoc.html#L"><span class="hs-identifier hs-var">L</span></a></span><span> </span><span class="annot"><span class="annottext">SrcSpanAnnA
</span><a href="#local-6989586621683117668"><span class="hs-identifier hs-var">loc</span></a></span><span> </span><span class="annot"><span class="annottext">(StmtLR
   (GhcPass 'Renamed)
   (GhcPass 'Renamed)
   (GenLocated SrcSpanAnnA (HsExpr (GhcPass 'Renamed)))
 -&gt; GenLocated
      SrcSpanAnnA
      (StmtLR
         (GhcPass 'Renamed)
         (GhcPass 'Renamed)
         (GenLocated SrcSpanAnnA (HsExpr (GhcPass 'Renamed)))))
-&gt; StmtLR
     (GhcPass 'Renamed)
     (GhcPass 'Renamed)
     (GenLocated SrcSpanAnnA (HsExpr (GhcPass 'Renamed)))
-&gt; GenLocated
     SrcSpanAnnA
     (StmtLR
        (GhcPass 'Renamed)
        (GhcPass 'Renamed)
        (GenLocated SrcSpanAnnA (HsExpr (GhcPass 'Renamed))))
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">XBindStmt
  (GhcPass 'Renamed)
  (GhcPass 'Renamed)
  (GenLocated SrcSpanAnnA (HsExpr (GhcPass 'Renamed)))
-&gt; LPat (GhcPass 'Renamed)
-&gt; GenLocated SrcSpanAnnA (HsExpr (GhcPass 'Renamed))
-&gt; StmtLR
     (GhcPass 'Renamed)
     (GhcPass 'Renamed)
     (GenLocated SrcSpanAnnA (HsExpr (GhcPass 'Renamed)))
forall idL idR body.
XBindStmt idL idR body -&gt; LPat idL -&gt; body -&gt; StmtLR idL idR body
</span><a href="Language.Haskell.Syntax.Expr.html#BindStmt"><span class="hs-identifier hs-var">BindStmt</span></a></span><span>
</span><span id="line-2273"></span><span>                                       </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Hs.Expr.html#XBindStmtRn"><span class="hs-identifier hs-type">XBindStmtRn</span></a></span><span>
</span><span id="line-2274"></span><span>                                          </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">xbsrn_bindOp :: SyntaxExpr (GhcPass 'Renamed)
</span><a href="GHC.Hs.Expr.html#xbsrn_bindOp"><span class="hs-identifier hs-var">xbsrn_bindOp</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Name -&gt; SyntaxExprRn
</span><a href="GHC.Hs.Expr.html#mkRnSyntaxExpr"><span class="hs-identifier hs-var">mkRnSyntaxExpr</span></a></span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="GHC.Builtin.Names.html#bindIOName"><span class="hs-identifier hs-var">bindIOName</span></a></span><span>
</span><span id="line-2275"></span><span>                                          </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">xbsrn_failOp :: FailOperator (GhcPass 'Renamed)
</span><a href="GHC.Hs.Expr.html#xbsrn_failOp"><span class="hs-identifier hs-var">xbsrn_failOp</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">FailOperator (GhcPass 'Renamed)
Maybe SyntaxExprRn
forall a. Maybe a
</span><span class="hs-identifier hs-var">Nothing</span></span><span>
</span><span id="line-2276"></span><span>                                          </span><span class="hs-special">}</span><span class="hs-special">)</span><span>
</span><span id="line-2277"></span><span>                                       </span><span class="hs-special">(</span><span class="annot"><span class="annottext">SrcSpanAnnA
-&gt; Pat (GhcPass 'Renamed)
-&gt; GenLocated SrcSpanAnnA (Pat (GhcPass 'Renamed))
forall l e. l -&gt; e -&gt; GenLocated l e
</span><a href="GHC.Types.SrcLoc.html#L"><span class="hs-identifier hs-var">L</span></a></span><span> </span><span class="annot"><span class="annottext">SrcSpanAnnA
</span><a href="#local-6989586621683117668"><span class="hs-identifier hs-var">loc</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">XVarPat (GhcPass 'Renamed)
-&gt; LIdP (GhcPass 'Renamed) -&gt; Pat (GhcPass 'Renamed)
forall p. XVarPat p -&gt; LIdP p -&gt; Pat p
</span><a href="Language.Haskell.Syntax.Pat.html#VarPat"><span class="hs-identifier hs-var">VarPat</span></a></span><span> </span><span class="annot"><span class="annottext">XVarPat (GhcPass 'Renamed)
NoExtField
</span><a href="Language.Haskell.Syntax.Extension.html#noExtField"><span class="hs-identifier hs-var">noExtField</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">SrcSpanAnnN -&gt; Name -&gt; GenLocated SrcSpanAnnN Name
forall l e. l -&gt; e -&gt; GenLocated l e
</span><a href="GHC.Types.SrcLoc.html#L"><span class="hs-identifier hs-var">L</span></a></span><span> </span><span class="annot"><span class="annottext">SrcSpanAnnN
</span><a href="#local-6989586621683117684"><span class="hs-identifier hs-var">loc'</span></a></span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621683117687"><span class="hs-identifier hs-var">fresh_it</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-2278"></span><span>                                       </span><span class="hs-special">(</span><span class="annot"><span class="annottext">LHsExpr (GhcPass 'Renamed)
-&gt; LHsExpr (GhcPass 'Renamed) -&gt; LHsExpr (GhcPass 'Renamed)
forall (id :: Pass).
IsPass id =&gt;
LHsExpr (GhcPass id)
-&gt; LHsExpr (GhcPass id) -&gt; LHsExpr (GhcPass id)
</span><a href="GHC.Hs.Utils.html#nlHsApp"><span class="hs-identifier hs-var">nlHsApp</span></a></span><span> </span><span class="annot"><span class="annottext">LHsExpr (GhcPass 'Renamed)
GenLocated SrcSpanAnnA (HsExpr (GhcPass 'Renamed))
</span><a href="#local-6989586621683117680"><span class="hs-identifier hs-var">ghciStep</span></a></span><span> </span><span class="annot"><span class="annottext">LHsExpr (GhcPass 'Renamed)
GenLocated SrcSpanAnnA (HsExpr (GhcPass 'Renamed))
</span><a href="#local-6989586621683117671"><span class="hs-identifier hs-var">rn_expr</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-2279"></span><span>
</span><span id="line-2280"></span><span>              </span><span class="hs-comment">-- [; print it]</span><span>
</span><span id="line-2281"></span><span>              </span><span id="local-6989586621683117710"><span class="annot"><a href="#local-6989586621683117710"><span class="hs-identifier hs-var hs-var">print_it</span></a></span></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">SrcSpanAnnA
-&gt; StmtLR
     (GhcPass 'Renamed)
     (GhcPass 'Renamed)
     (GenLocated SrcSpanAnnA (HsExpr (GhcPass 'Renamed)))
-&gt; GenLocated
     SrcSpanAnnA
     (StmtLR
        (GhcPass 'Renamed)
        (GhcPass 'Renamed)
        (GenLocated SrcSpanAnnA (HsExpr (GhcPass 'Renamed))))
forall l e. l -&gt; e -&gt; GenLocated l e
</span><a href="GHC.Types.SrcLoc.html#L"><span class="hs-identifier hs-var">L</span></a></span><span> </span><span class="annot"><span class="annottext">SrcSpanAnnA
</span><a href="#local-6989586621683117668"><span class="hs-identifier hs-var">loc</span></a></span><span> </span><span class="annot"><span class="annottext">(StmtLR
   (GhcPass 'Renamed)
   (GhcPass 'Renamed)
   (GenLocated SrcSpanAnnA (HsExpr (GhcPass 'Renamed)))
 -&gt; GenLocated
      SrcSpanAnnA
      (StmtLR
         (GhcPass 'Renamed)
         (GhcPass 'Renamed)
         (GenLocated SrcSpanAnnA (HsExpr (GhcPass 'Renamed)))))
-&gt; StmtLR
     (GhcPass 'Renamed)
     (GhcPass 'Renamed)
     (GenLocated SrcSpanAnnA (HsExpr (GhcPass 'Renamed)))
-&gt; GenLocated
     SrcSpanAnnA
     (StmtLR
        (GhcPass 'Renamed)
        (GhcPass 'Renamed)
        (GenLocated SrcSpanAnnA (HsExpr (GhcPass 'Renamed))))
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">XBodyStmt
  (GhcPass 'Renamed)
  (GhcPass 'Renamed)
  (GenLocated SrcSpanAnnA (HsExpr (GhcPass 'Renamed)))
-&gt; GenLocated SrcSpanAnnA (HsExpr (GhcPass 'Renamed))
-&gt; SyntaxExpr (GhcPass 'Renamed)
-&gt; SyntaxExpr (GhcPass 'Renamed)
-&gt; StmtLR
     (GhcPass 'Renamed)
     (GhcPass 'Renamed)
     (GenLocated SrcSpanAnnA (HsExpr (GhcPass 'Renamed)))
forall idL idR body.
XBodyStmt idL idR body
-&gt; body -&gt; SyntaxExpr idR -&gt; SyntaxExpr idR -&gt; StmtLR idL idR body
</span><a href="Language.Haskell.Syntax.Expr.html#BodyStmt"><span class="hs-identifier hs-var">BodyStmt</span></a></span><span> </span><span class="annot"><span class="annottext">XBodyStmt
  (GhcPass 'Renamed)
  (GhcPass 'Renamed)
  (GenLocated SrcSpanAnnA (HsExpr (GhcPass 'Renamed)))
NoExtField
</span><a href="Language.Haskell.Syntax.Extension.html#noExtField"><span class="hs-identifier hs-var">noExtField</span></a></span><span>
</span><span id="line-2282"></span><span>                                           </span><span class="hs-special">(</span><span class="annot"><span class="annottext">LHsExpr (GhcPass 'Renamed)
-&gt; LHsExpr (GhcPass 'Renamed) -&gt; LHsExpr (GhcPass 'Renamed)
forall (id :: Pass).
IsPass id =&gt;
LHsExpr (GhcPass id)
-&gt; LHsExpr (GhcPass id) -&gt; LHsExpr (GhcPass id)
</span><a href="GHC.Hs.Utils.html#nlHsApp"><span class="hs-identifier hs-var">nlHsApp</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">IdP (GhcPass 'Renamed) -&gt; LHsExpr (GhcPass 'Renamed)
forall (p :: Pass) a.
IsSrcSpanAnn p a =&gt;
IdP (GhcPass p) -&gt; LHsExpr (GhcPass p)
</span><a href="GHC.Hs.Utils.html#nlHsVar"><span class="hs-identifier hs-var">nlHsVar</span></a></span><span> </span><span class="annot"><span class="annottext">IdP (GhcPass 'Renamed)
Name
</span><a href="#local-6989586621683117685"><span class="hs-identifier hs-var">interPrintName</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-2283"></span><span>                                           </span><span class="hs-special">(</span><span class="annot"><span class="annottext">IdP (GhcPass 'Renamed) -&gt; LHsExpr (GhcPass 'Renamed)
forall (p :: Pass) a.
IsSrcSpanAnn p a =&gt;
IdP (GhcPass p) -&gt; LHsExpr (GhcPass p)
</span><a href="GHC.Hs.Utils.html#nlHsVar"><span class="hs-identifier hs-var">nlHsVar</span></a></span><span> </span><span class="annot"><span class="annottext">IdP (GhcPass 'Renamed)
Name
</span><a href="#local-6989586621683117687"><span class="hs-identifier hs-var">fresh_it</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-2284"></span><span>                                           </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Name -&gt; SyntaxExprRn
</span><a href="GHC.Hs.Expr.html#mkRnSyntaxExpr"><span class="hs-identifier hs-var">mkRnSyntaxExpr</span></a></span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="GHC.Builtin.Names.html#thenIOName"><span class="hs-identifier hs-var">thenIOName</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-2285"></span><span>                                                  </span><span class="annot"><span class="annottext">SyntaxExpr (GhcPass 'Renamed)
forall (p :: Pass). IsPass p =&gt; SyntaxExpr (GhcPass p)
</span><a href="GHC.Hs.Expr.html#noSyntaxExpr"><span class="hs-identifier hs-var">noSyntaxExpr</span></a></span><span>
</span><span id="line-2286"></span><span>
</span><span id="line-2287"></span><span>              </span><span class="hs-comment">-- NewA</span><span>
</span><span id="line-2288"></span><span>              </span><span id="local-6989586621683117713"><span class="annot"><a href="#local-6989586621683117713"><span class="hs-identifier hs-var hs-var">no_it_a</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">SrcSpanAnnA
-&gt; StmtLR
     (GhcPass 'Renamed)
     (GhcPass 'Renamed)
     (GenLocated SrcSpanAnnA (HsExpr (GhcPass 'Renamed)))
-&gt; GenLocated
     SrcSpanAnnA
     (StmtLR
        (GhcPass 'Renamed)
        (GhcPass 'Renamed)
        (GenLocated SrcSpanAnnA (HsExpr (GhcPass 'Renamed))))
forall l e. l -&gt; e -&gt; GenLocated l e
</span><a href="GHC.Types.SrcLoc.html#L"><span class="hs-identifier hs-var">L</span></a></span><span> </span><span class="annot"><span class="annottext">SrcSpanAnnA
</span><a href="#local-6989586621683117668"><span class="hs-identifier hs-var">loc</span></a></span><span> </span><span class="annot"><span class="annottext">(StmtLR
   (GhcPass 'Renamed)
   (GhcPass 'Renamed)
   (GenLocated SrcSpanAnnA (HsExpr (GhcPass 'Renamed)))
 -&gt; GenLocated
      SrcSpanAnnA
      (StmtLR
         (GhcPass 'Renamed)
         (GhcPass 'Renamed)
         (GenLocated SrcSpanAnnA (HsExpr (GhcPass 'Renamed)))))
-&gt; StmtLR
     (GhcPass 'Renamed)
     (GhcPass 'Renamed)
     (GenLocated SrcSpanAnnA (HsExpr (GhcPass 'Renamed)))
-&gt; GenLocated
     SrcSpanAnnA
     (StmtLR
        (GhcPass 'Renamed)
        (GhcPass 'Renamed)
        (GenLocated SrcSpanAnnA (HsExpr (GhcPass 'Renamed))))
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">XBodyStmt
  (GhcPass 'Renamed)
  (GhcPass 'Renamed)
  (GenLocated SrcSpanAnnA (HsExpr (GhcPass 'Renamed)))
-&gt; GenLocated SrcSpanAnnA (HsExpr (GhcPass 'Renamed))
-&gt; SyntaxExpr (GhcPass 'Renamed)
-&gt; SyntaxExpr (GhcPass 'Renamed)
-&gt; StmtLR
     (GhcPass 'Renamed)
     (GhcPass 'Renamed)
     (GenLocated SrcSpanAnnA (HsExpr (GhcPass 'Renamed)))
forall idL idR body.
XBodyStmt idL idR body
-&gt; body -&gt; SyntaxExpr idR -&gt; SyntaxExpr idR -&gt; StmtLR idL idR body
</span><a href="Language.Haskell.Syntax.Expr.html#BodyStmt"><span class="hs-identifier hs-var">BodyStmt</span></a></span><span> </span><span class="annot"><span class="annottext">XBodyStmt
  (GhcPass 'Renamed)
  (GhcPass 'Renamed)
  (GenLocated SrcSpanAnnA (HsExpr (GhcPass 'Renamed)))
NoExtField
</span><a href="Language.Haskell.Syntax.Extension.html#noExtField"><span class="hs-identifier hs-var">noExtField</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">IdP (GhcPass 'Renamed)
-&gt; [LHsExpr (GhcPass 'Renamed)] -&gt; LHsExpr (GhcPass 'Renamed)
forall (p :: Pass) a.
IsSrcSpanAnn p a =&gt;
IdP (GhcPass p) -&gt; [LHsExpr (GhcPass p)] -&gt; LHsExpr (GhcPass p)
</span><a href="GHC.Hs.Utils.html#nlHsApps"><span class="hs-identifier hs-var">nlHsApps</span></a></span><span> </span><span class="annot"><span class="annottext">IdP (GhcPass 'Renamed)
Name
</span><a href="GHC.Builtin.Names.html#bindIOName"><span class="hs-identifier hs-var">bindIOName</span></a></span><span>
</span><span id="line-2289"></span><span>                                       </span><span class="hs-special">[</span><span class="annot"><span class="annottext">LHsExpr (GhcPass 'Renamed)
GenLocated SrcSpanAnnA (HsExpr (GhcPass 'Renamed))
</span><a href="#local-6989586621683117671"><span class="hs-identifier hs-var">rn_expr</span></a></span><span> </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">IdP (GhcPass 'Renamed) -&gt; LHsExpr (GhcPass 'Renamed)
forall (p :: Pass) a.
IsSrcSpanAnn p a =&gt;
IdP (GhcPass p) -&gt; LHsExpr (GhcPass p)
</span><a href="GHC.Hs.Utils.html#nlHsVar"><span class="hs-identifier hs-var">nlHsVar</span></a></span><span> </span><span class="annot"><span class="annottext">IdP (GhcPass 'Renamed)
Name
</span><a href="#local-6989586621683117685"><span class="hs-identifier hs-var">interPrintName</span></a></span><span class="hs-special">]</span><span class="hs-special">)</span><span>
</span><span id="line-2290"></span><span>                                       </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Name -&gt; SyntaxExprRn
</span><a href="GHC.Hs.Expr.html#mkRnSyntaxExpr"><span class="hs-identifier hs-var">mkRnSyntaxExpr</span></a></span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="GHC.Builtin.Names.html#thenIOName"><span class="hs-identifier hs-var">thenIOName</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-2291"></span><span>                                       </span><span class="annot"><span class="annottext">SyntaxExpr (GhcPass 'Renamed)
forall (p :: Pass). IsPass p =&gt; SyntaxExpr (GhcPass p)
</span><a href="GHC.Hs.Expr.html#noSyntaxExpr"><span class="hs-identifier hs-var">noSyntaxExpr</span></a></span><span>
</span><span id="line-2292"></span><span>
</span><span id="line-2293"></span><span>              </span><span id="local-6989586621683117715"><span class="annot"><a href="#local-6989586621683117715"><span class="hs-identifier hs-var hs-var">no_it_b</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">SrcSpanAnnA
-&gt; StmtLR
     (GhcPass 'Renamed)
     (GhcPass 'Renamed)
     (GenLocated SrcSpanAnnA (HsExpr (GhcPass 'Renamed)))
-&gt; GenLocated
     SrcSpanAnnA
     (StmtLR
        (GhcPass 'Renamed)
        (GhcPass 'Renamed)
        (GenLocated SrcSpanAnnA (HsExpr (GhcPass 'Renamed))))
forall l e. l -&gt; e -&gt; GenLocated l e
</span><a href="GHC.Types.SrcLoc.html#L"><span class="hs-identifier hs-var">L</span></a></span><span> </span><span class="annot"><span class="annottext">SrcSpanAnnA
</span><a href="#local-6989586621683117668"><span class="hs-identifier hs-var">loc</span></a></span><span> </span><span class="annot"><span class="annottext">(StmtLR
   (GhcPass 'Renamed)
   (GhcPass 'Renamed)
   (GenLocated SrcSpanAnnA (HsExpr (GhcPass 'Renamed)))
 -&gt; GenLocated
      SrcSpanAnnA
      (StmtLR
         (GhcPass 'Renamed)
         (GhcPass 'Renamed)
         (GenLocated SrcSpanAnnA (HsExpr (GhcPass 'Renamed)))))
-&gt; StmtLR
     (GhcPass 'Renamed)
     (GhcPass 'Renamed)
     (GenLocated SrcSpanAnnA (HsExpr (GhcPass 'Renamed)))
-&gt; GenLocated
     SrcSpanAnnA
     (StmtLR
        (GhcPass 'Renamed)
        (GhcPass 'Renamed)
        (GenLocated SrcSpanAnnA (HsExpr (GhcPass 'Renamed))))
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">XBodyStmt
  (GhcPass 'Renamed)
  (GhcPass 'Renamed)
  (GenLocated SrcSpanAnnA (HsExpr (GhcPass 'Renamed)))
-&gt; GenLocated SrcSpanAnnA (HsExpr (GhcPass 'Renamed))
-&gt; SyntaxExpr (GhcPass 'Renamed)
-&gt; SyntaxExpr (GhcPass 'Renamed)
-&gt; StmtLR
     (GhcPass 'Renamed)
     (GhcPass 'Renamed)
     (GenLocated SrcSpanAnnA (HsExpr (GhcPass 'Renamed)))
forall idL idR body.
XBodyStmt idL idR body
-&gt; body -&gt; SyntaxExpr idR -&gt; SyntaxExpr idR -&gt; StmtLR idL idR body
</span><a href="Language.Haskell.Syntax.Expr.html#BodyStmt"><span class="hs-identifier hs-var">BodyStmt</span></a></span><span> </span><span class="annot"><span class="annottext">XBodyStmt
  (GhcPass 'Renamed)
  (GhcPass 'Renamed)
  (GenLocated SrcSpanAnnA (HsExpr (GhcPass 'Renamed)))
NoExtField
</span><a href="Language.Haskell.Syntax.Extension.html#noExtField"><span class="hs-identifier hs-var">noExtField</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">GenLocated SrcSpanAnnA (HsExpr (GhcPass 'Renamed))
</span><a href="#local-6989586621683117671"><span class="hs-identifier hs-var">rn_expr</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-2294"></span><span>                                       </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Name -&gt; SyntaxExprRn
</span><a href="GHC.Hs.Expr.html#mkRnSyntaxExpr"><span class="hs-identifier hs-var">mkRnSyntaxExpr</span></a></span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="GHC.Builtin.Names.html#thenIOName"><span class="hs-identifier hs-var">thenIOName</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-2295"></span><span>                                       </span><span class="annot"><span class="annottext">SyntaxExpr (GhcPass 'Renamed)
forall (p :: Pass). IsPass p =&gt; SyntaxExpr (GhcPass p)
</span><a href="GHC.Hs.Expr.html#noSyntaxExpr"><span class="hs-identifier hs-var">noSyntaxExpr</span></a></span><span>
</span><span id="line-2296"></span><span>
</span><span id="line-2297"></span><span>              </span><span id="local-6989586621683117716"><span class="annot"><a href="#local-6989586621683117716"><span class="hs-identifier hs-var hs-var">no_it_c</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">SrcSpanAnnA
-&gt; StmtLR
     (GhcPass 'Renamed)
     (GhcPass 'Renamed)
     (GenLocated SrcSpanAnnA (HsExpr (GhcPass 'Renamed)))
-&gt; GenLocated
     SrcSpanAnnA
     (StmtLR
        (GhcPass 'Renamed)
        (GhcPass 'Renamed)
        (GenLocated SrcSpanAnnA (HsExpr (GhcPass 'Renamed))))
forall l e. l -&gt; e -&gt; GenLocated l e
</span><a href="GHC.Types.SrcLoc.html#L"><span class="hs-identifier hs-var">L</span></a></span><span> </span><span class="annot"><span class="annottext">SrcSpanAnnA
</span><a href="#local-6989586621683117668"><span class="hs-identifier hs-var">loc</span></a></span><span> </span><span class="annot"><span class="annottext">(StmtLR
   (GhcPass 'Renamed)
   (GhcPass 'Renamed)
   (GenLocated SrcSpanAnnA (HsExpr (GhcPass 'Renamed)))
 -&gt; GenLocated
      SrcSpanAnnA
      (StmtLR
         (GhcPass 'Renamed)
         (GhcPass 'Renamed)
         (GenLocated SrcSpanAnnA (HsExpr (GhcPass 'Renamed)))))
-&gt; StmtLR
     (GhcPass 'Renamed)
     (GhcPass 'Renamed)
     (GenLocated SrcSpanAnnA (HsExpr (GhcPass 'Renamed)))
-&gt; GenLocated
     SrcSpanAnnA
     (StmtLR
        (GhcPass 'Renamed)
        (GhcPass 'Renamed)
        (GenLocated SrcSpanAnnA (HsExpr (GhcPass 'Renamed))))
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">XBodyStmt
  (GhcPass 'Renamed)
  (GhcPass 'Renamed)
  (GenLocated SrcSpanAnnA (HsExpr (GhcPass 'Renamed)))
-&gt; GenLocated SrcSpanAnnA (HsExpr (GhcPass 'Renamed))
-&gt; SyntaxExpr (GhcPass 'Renamed)
-&gt; SyntaxExpr (GhcPass 'Renamed)
-&gt; StmtLR
     (GhcPass 'Renamed)
     (GhcPass 'Renamed)
     (GenLocated SrcSpanAnnA (HsExpr (GhcPass 'Renamed)))
forall idL idR body.
XBodyStmt idL idR body
-&gt; body -&gt; SyntaxExpr idR -&gt; SyntaxExpr idR -&gt; StmtLR idL idR body
</span><a href="Language.Haskell.Syntax.Expr.html#BodyStmt"><span class="hs-identifier hs-var">BodyStmt</span></a></span><span> </span><span class="annot"><span class="annottext">XBodyStmt
  (GhcPass 'Renamed)
  (GhcPass 'Renamed)
  (GenLocated SrcSpanAnnA (HsExpr (GhcPass 'Renamed)))
NoExtField
</span><a href="Language.Haskell.Syntax.Extension.html#noExtField"><span class="hs-identifier hs-var">noExtField</span></a></span><span>
</span><span id="line-2298"></span><span>                                      </span><span class="hs-special">(</span><span class="annot"><span class="annottext">LHsExpr (GhcPass 'Renamed)
-&gt; LHsExpr (GhcPass 'Renamed) -&gt; LHsExpr (GhcPass 'Renamed)
forall (id :: Pass).
IsPass id =&gt;
LHsExpr (GhcPass id)
-&gt; LHsExpr (GhcPass id) -&gt; LHsExpr (GhcPass id)
</span><a href="GHC.Hs.Utils.html#nlHsApp"><span class="hs-identifier hs-var">nlHsApp</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">IdP (GhcPass 'Renamed) -&gt; LHsExpr (GhcPass 'Renamed)
forall (p :: Pass) a.
IsSrcSpanAnn p a =&gt;
IdP (GhcPass p) -&gt; LHsExpr (GhcPass p)
</span><a href="GHC.Hs.Utils.html#nlHsVar"><span class="hs-identifier hs-var">nlHsVar</span></a></span><span> </span><span class="annot"><span class="annottext">IdP (GhcPass 'Renamed)
Name
</span><a href="#local-6989586621683117685"><span class="hs-identifier hs-var">interPrintName</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">LHsExpr (GhcPass 'Renamed)
GenLocated SrcSpanAnnA (HsExpr (GhcPass 'Renamed))
</span><a href="#local-6989586621683117671"><span class="hs-identifier hs-var">rn_expr</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-2299"></span><span>                                      </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Name -&gt; SyntaxExprRn
</span><a href="GHC.Hs.Expr.html#mkRnSyntaxExpr"><span class="hs-identifier hs-var">mkRnSyntaxExpr</span></a></span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="GHC.Builtin.Names.html#thenIOName"><span class="hs-identifier hs-var">thenIOName</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-2300"></span><span>                                      </span><span class="annot"><span class="annottext">SyntaxExpr (GhcPass 'Renamed)
forall (p :: Pass). IsPass p =&gt; SyntaxExpr (GhcPass p)
</span><a href="GHC.Hs.Expr.html#noSyntaxExpr"><span class="hs-identifier hs-var">noSyntaxExpr</span></a></span><span>
</span><span id="line-2301"></span><span>
</span><span id="line-2302"></span><span>              </span><span class="hs-comment">-- See Note [GHCi Plans]</span><span>
</span><span id="line-2303"></span><span>
</span><span id="line-2304"></span><span>              </span><span id="local-6989586621683117717"><span class="annot"><a href="#local-6989586621683117717"><span class="hs-identifier hs-var hs-var">it_plans</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-2305"></span><span>                    </span><span class="hs-comment">-- Plan A</span><span>
</span><span id="line-2306"></span><span>                    </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span id="local-6989586621683117718"><span class="annot"><a href="#local-6989586621683117718"><span class="hs-identifier hs-var">stuff</span></a></span></span><span class="hs-glyph">@</span><span class="hs-special">(</span><span class="hs-special">[</span><span id="local-6989586621683117719"><span class="annot"><a href="#local-6989586621683117719"><span class="hs-identifier hs-var">it_id</span></a></span></span><span class="hs-special">]</span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">[GhciLStmt (GhcPass 'Renamed)] -&gt; Plan
</span><a href="GHC.Tc.Module.html#tcGhciStmts"><span class="hs-identifier hs-var">tcGhciStmts</span></a></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">GhciLStmt (GhcPass 'Renamed)
GenLocated
  SrcSpanAnnA
  (StmtLR
     (GhcPass 'Renamed)
     (GhcPass 'Renamed)
     (GenLocated SrcSpanAnnA (HsExpr (GhcPass 'Renamed))))
</span><a href="#local-6989586621683117702"><span class="hs-identifier hs-var">bind_stmt</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">GhciLStmt (GhcPass 'Renamed)
GenLocated
  SrcSpanAnnA
  (StmtLR
     (GhcPass 'Renamed)
     (GhcPass 'Renamed)
     (GenLocated SrcSpanAnnA (HsExpr (GhcPass 'Renamed))))
</span><a href="#local-6989586621683117710"><span class="hs-identifier hs-var">print_it</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-2307"></span><span>                       </span><span class="hs-special">;</span><span> </span><span id="local-6989586621683117721"><span class="annot"><a href="#local-6989586621683117721"><span class="hs-identifier hs-var">it_ty</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.Monad.html#liftZonkM"><span class="hs-identifier hs-type">liftZonkM</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="annot"><a href="GHC.Tc.Zonk.TcType.html#zonkTcType"><span class="hs-identifier hs-type">zonkTcType</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Types.Id.html#idType"><span class="hs-identifier hs-type">idType</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683117719"><span class="hs-identifier hs-type">it_id</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-2308"></span><span>                       </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">when</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Tc.Utils.TcType.html#isUnitTy"><span class="hs-identifier hs-type">isUnitTy</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683117721"><span class="hs-identifier hs-type">it_ty</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><a href="GHC.Data.IOEnv.html#failM"><span class="hs-identifier hs-type">failM</span></a></span><span>
</span><span id="line-2309"></span><span>                       </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">return</span></span><span> </span><span class="annot"><a href="#local-6989586621683117718"><span class="hs-identifier hs-type">stuff</span></a></span><span> </span><span class="hs-special">}</span><span> </span><span class="annot"><span class="annottext">TcM ([Id], GenLocated SrcSpanAnnA (HsExpr GhcTc))
-&gt; [TcM ([Id], GenLocated SrcSpanAnnA (HsExpr GhcTc))]
-&gt; NonEmpty (TcM ([Id], GenLocated SrcSpanAnnA (HsExpr GhcTc)))
forall a. a -&gt; [a] -&gt; NonEmpty a
</span><span class="hs-operator hs-var">:|</span></span><span>
</span><span id="line-2310"></span><span>
</span><span id="line-2311"></span><span>                        </span><span class="hs-comment">-- Plan B; a naked bind statement</span><span>
</span><span id="line-2312"></span><span>                  </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">[GhciLStmt (GhcPass 'Renamed)] -&gt; Plan
</span><a href="GHC.Tc.Module.html#tcGhciStmts"><span class="hs-identifier hs-var">tcGhciStmts</span></a></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">GhciLStmt (GhcPass 'Renamed)
GenLocated
  SrcSpanAnnA
  (StmtLR
     (GhcPass 'Renamed)
     (GhcPass 'Renamed)
     (GenLocated SrcSpanAnnA (HsExpr (GhcPass 'Renamed))))
</span><a href="#local-6989586621683117702"><span class="hs-identifier hs-var">bind_stmt</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-2313"></span><span>
</span><span id="line-2314"></span><span>                        </span><span class="hs-comment">-- Plan C; check that the let-binding is typeable all by itself.</span><span>
</span><span id="line-2315"></span><span>                        </span><span class="hs-comment">-- If not, fail; if so, try to print it.</span><span>
</span><span id="line-2316"></span><span>                        </span><span class="hs-comment">-- The two-step process avoids getting two errors: one from</span><span>
</span><span id="line-2317"></span><span>                        </span><span class="hs-comment">-- the expression itself, and one from the 'print it' part</span><span>
</span><span id="line-2318"></span><span>                        </span><span class="hs-comment">-- This two-step story is very clunky, alas</span><span>
</span><span id="line-2319"></span><span>                  </span><span class="hs-special">,</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">TcM ([Id], GenLocated SrcSpanAnnA (HsExpr GhcTc))
-&gt; TcM ([Id], GenLocated SrcSpanAnnA (HsExpr GhcTc))
forall r. TcM r -&gt; TcM r
</span><a href="GHC.Tc.Utils.Monad.html#checkNoErrs"><span class="hs-identifier hs-var">checkNoErrs</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[GhciLStmt (GhcPass 'Renamed)] -&gt; Plan
</span><a href="GHC.Tc.Module.html#tcGhciStmts"><span class="hs-identifier hs-var">tcGhciStmts</span></a></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">GhciLStmt (GhcPass 'Renamed)
GenLocated
  SrcSpanAnnA
  (StmtLR
     (GhcPass 'Renamed)
     (GhcPass 'Renamed)
     (GenLocated SrcSpanAnnA (HsExpr (GhcPass 'Renamed))))
</span><a href="#local-6989586621683117698"><span class="hs-identifier hs-var">let_stmt</span></a></span><span class="hs-special">]</span><span class="hs-special">)</span><span>
</span><span id="line-2320"></span><span>                                </span><span class="hs-comment">--- checkNoErrs defeats the error recovery of let-bindings</span><span>
</span><span id="line-2321"></span><span>                       </span><span class="hs-special">;</span><span> </span><span class="annot"><a href="GHC.Tc.Module.html#tcGhciStmts"><span class="hs-identifier hs-type">tcGhciStmts</span></a></span><span> </span><span class="hs-special">[</span><span class="annot"><a href="#local-6989586621683117698"><span class="hs-identifier hs-type">let_stmt</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="#local-6989586621683117710"><span class="hs-identifier hs-type">print_it</span></a></span><span class="hs-special">]</span><span> </span><span class="hs-special">}</span><span> </span><span class="hs-special">]</span><span>
</span><span id="line-2322"></span><span>
</span><span id="line-2323"></span><span>              </span><span class="hs-comment">-- Plans where we don't bind &quot;it&quot;</span><span>
</span><span id="line-2324"></span><span>              </span><span id="local-6989586621683117726"><span class="annot"><a href="#local-6989586621683117726"><span class="hs-identifier hs-var hs-var">no_it_plans</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-2325"></span><span>                </span><span class="annot"><span class="annottext">[GhciLStmt (GhcPass 'Renamed)] -&gt; Plan
</span><a href="GHC.Tc.Module.html#tcGhciStmts"><span class="hs-identifier hs-var">tcGhciStmts</span></a></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">GhciLStmt (GhcPass 'Renamed)
GenLocated
  SrcSpanAnnA
  (StmtLR
     (GhcPass 'Renamed)
     (GhcPass 'Renamed)
     (GenLocated SrcSpanAnnA (HsExpr (GhcPass 'Renamed))))
</span><a href="#local-6989586621683117713"><span class="hs-identifier hs-var">no_it_a</span></a></span><span class="hs-special">]</span><span> </span><span class="annot"><span class="annottext">TcM ([Id], GenLocated SrcSpanAnnA (HsExpr GhcTc))
-&gt; [TcM ([Id], GenLocated SrcSpanAnnA (HsExpr GhcTc))]
-&gt; NonEmpty (TcM ([Id], GenLocated SrcSpanAnnA (HsExpr GhcTc)))
forall a. a -&gt; [a] -&gt; NonEmpty a
</span><span class="hs-operator hs-var">:|</span></span><span>
</span><span id="line-2326"></span><span>                </span><span class="annot"><span class="annottext">[GhciLStmt (GhcPass 'Renamed)] -&gt; Plan
</span><a href="GHC.Tc.Module.html#tcGhciStmts"><span class="hs-identifier hs-var">tcGhciStmts</span></a></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">GhciLStmt (GhcPass 'Renamed)
GenLocated
  SrcSpanAnnA
  (StmtLR
     (GhcPass 'Renamed)
     (GhcPass 'Renamed)
     (GenLocated SrcSpanAnnA (HsExpr (GhcPass 'Renamed))))
</span><a href="#local-6989586621683117715"><span class="hs-identifier hs-var">no_it_b</span></a></span><span class="hs-special">]</span><span> </span><span class="annot"><span class="annottext">TcM ([Id], GenLocated SrcSpanAnnA (HsExpr GhcTc))
-&gt; [TcM ([Id], GenLocated SrcSpanAnnA (HsExpr GhcTc))]
-&gt; [TcM ([Id], GenLocated SrcSpanAnnA (HsExpr GhcTc))]
forall a. a -&gt; [a] -&gt; [a]
</span><span class="hs-glyph hs-var">:</span></span><span>
</span><span id="line-2327"></span><span>                </span><span class="annot"><span class="annottext">[GhciLStmt (GhcPass 'Renamed)] -&gt; Plan
</span><a href="GHC.Tc.Module.html#tcGhciStmts"><span class="hs-identifier hs-var">tcGhciStmts</span></a></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">GhciLStmt (GhcPass 'Renamed)
GenLocated
  SrcSpanAnnA
  (StmtLR
     (GhcPass 'Renamed)
     (GhcPass 'Renamed)
     (GenLocated SrcSpanAnnA (HsExpr (GhcPass 'Renamed))))
</span><a href="#local-6989586621683117716"><span class="hs-identifier hs-var">no_it_c</span></a></span><span class="hs-special">]</span><span> </span><span class="annot"><span class="annottext">TcM ([Id], GenLocated SrcSpanAnnA (HsExpr GhcTc))
-&gt; [TcM ([Id], GenLocated SrcSpanAnnA (HsExpr GhcTc))]
-&gt; [TcM ([Id], GenLocated SrcSpanAnnA (HsExpr GhcTc))]
forall a. a -&gt; [a] -&gt; [a]
</span><span class="hs-glyph hs-var">:</span></span><span>
</span><span id="line-2328"></span><span>                </span><span class="hs-special">[</span><span class="hs-special">]</span><span>
</span><span id="line-2329"></span><span>
</span><span id="line-2330"></span><span>        </span><span class="hs-special">;</span><span> </span><span id="local-6989586621683117727"><span class="annot"><a href="#local-6989586621683117727"><span class="hs-identifier hs-var">generate_it</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.Monad.html#goptM"><span class="hs-identifier hs-type">goptM</span></a></span><span> </span><span class="annot"><a href="GHC.Driver.Flags.html#Opt_NoIt"><span class="hs-identifier hs-type">Opt_NoIt</span></a></span><span>
</span><span id="line-2331"></span><span>
</span><span id="line-2332"></span><span>        </span><span class="hs-comment">-- We disable `-fdefer-type-errors` in GHCi for naked expressions.</span><span>
</span><span id="line-2333"></span><span>        </span><span class="hs-comment">-- See Note [Deferred type errors in GHCi]</span><span>
</span><span id="line-2334"></span><span>
</span><span id="line-2335"></span><span>        </span><span class="hs-comment">-- NB: The flag `-fdefer-type-errors` implies `-fdefer-type-holes`</span><span>
</span><span id="line-2336"></span><span>        </span><span class="hs-comment">-- and `-fdefer-out-of-scope-variables`. However the flag</span><span>
</span><span id="line-2337"></span><span>        </span><span class="hs-comment">-- `-fno-defer-type-errors` doesn't imply `-fdefer-type-holes` and</span><span>
</span><span id="line-2338"></span><span>        </span><span class="hs-comment">-- `-fno-defer-out-of-scope-variables`. Thus the later two flags</span><span>
</span><span id="line-2339"></span><span>        </span><span class="hs-comment">-- also need to be unset here.</span><span>
</span><span id="line-2340"></span><span>        </span><span class="hs-special">;</span><span> </span><span id="local-6989586621683117729"><span class="annot"><a href="#local-6989586621683117729"><span class="hs-identifier hs-var">plan</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.Monad.html#unsetGOptM"><span class="hs-identifier hs-type">unsetGOptM</span></a></span><span> </span><span class="annot"><a href="GHC.Driver.Flags.html#Opt_DeferTypeErrors"><span class="hs-identifier hs-type">Opt_DeferTypeErrors</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span>
</span><span id="line-2341"></span><span>                  </span><span class="annot"><a href="GHC.Tc.Utils.Monad.html#unsetGOptM"><span class="hs-identifier hs-type">unsetGOptM</span></a></span><span> </span><span class="annot"><a href="GHC.Driver.Flags.html#Opt_DeferTypedHoles"><span class="hs-identifier hs-type">Opt_DeferTypedHoles</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span>
</span><span id="line-2342"></span><span>                  </span><span class="annot"><a href="GHC.Tc.Utils.Monad.html#unsetGOptM"><span class="hs-identifier hs-type">unsetGOptM</span></a></span><span> </span><span class="annot"><a href="GHC.Driver.Flags.html#Opt_DeferOutOfScopeVariables"><span class="hs-identifier hs-type">Opt_DeferOutOfScopeVariables</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span>
</span><span id="line-2343"></span><span>                    </span><span class="annot"><a href="GHC.Tc.Module.html#runPlans"><span class="hs-identifier hs-type">runPlans</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="hs-keyword">if</span><span> </span><span class="annot"><a href="#local-6989586621683117727"><span class="hs-identifier hs-type">generate_it</span></a></span><span>
</span><span id="line-2344"></span><span>                                 </span><span class="hs-keyword">then</span><span> </span><span class="annot"><a href="#local-6989586621683117726"><span class="hs-identifier hs-type">no_it_plans</span></a></span><span>
</span><span id="line-2345"></span><span>                                 </span><span class="hs-keyword">else</span><span> </span><span class="annot"><a href="#local-6989586621683117717"><span class="hs-identifier hs-type">it_plans</span></a></span><span>
</span><span id="line-2346"></span><span>
</span><span id="line-2347"></span><span>        </span><span class="hs-special">;</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.Monad.html#dumpOptTcRn"><span class="hs-identifier hs-type">dumpOptTcRn</span></a></span><span> </span><span class="annot"><a href="GHC.Driver.Flags.html#Opt_D_dump_tc_ast"><span class="hs-identifier hs-type">Opt_D_dump_tc_ast</span></a></span><span> </span><span class="annot"><span class="hs-string">&quot;Typechecker AST&quot;</span></span><span> </span><span class="annot"><a href="GHC.Utils.Logger.html#FormatHaskell"><span class="hs-identifier hs-type">FormatHaskell</span></a></span><span>
</span><span id="line-2348"></span><span>              </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Hs.Dump.html#showAstData"><span class="hs-identifier hs-type">showAstData</span></a></span><span> </span><span class="annot"><a href="GHC.Hs.Dump.html#NoBlankSrcSpan"><span class="hs-identifier hs-type">NoBlankSrcSpan</span></a></span><span> </span><span class="annot"><a href="GHC.Hs.Dump.html#NoBlankEpAnnotations"><span class="hs-identifier hs-type">NoBlankEpAnnotations</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683117729"><span class="hs-identifier hs-type">plan</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-2349"></span><span>
</span><span id="line-2350"></span><span>        </span><span class="hs-special">;</span><span> </span><span id="local-6989586621683117735"><span class="annot"><a href="#local-6989586621683117735"><span class="hs-identifier hs-var">fix_env</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.Monad.html#getFixityEnv"><span class="hs-identifier hs-type">getFixityEnv</span></a></span><span>
</span><span id="line-2351"></span><span>        </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">return</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621683117729"><span class="hs-identifier hs-type">plan</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="#local-6989586621683117735"><span class="hs-identifier hs-type">fix_env</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-2352"></span><span>
</span><span id="line-2353"></span><span class="hs-comment">{- Note [Deferred type errors in GHCi]
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
In GHCi, we ensure that type errors don't get deferred when type checking the
naked expressions. Deferring type errors here is unhelpful because the
expression gets evaluated right away anyway. It also would potentially emit
two redundant type-error warnings, one from each plan.

#14963 reveals another bug that when deferred type errors is enabled
in GHCi, any reference of imported/loaded variables (directly or indirectly)
in interactively issued naked expressions will cause ghc panic. See more
detailed discussion in #14963.

The interactively issued declarations, statements, as well as the modules
loaded into GHCi, are not affected. That means, for declaration, you could
have

    Prelude&gt; :set -fdefer-type-errors
    Prelude&gt; x :: IO (); x = putStrLn True
    &lt;interactive&gt;:14:26: warning: [-Wdeferred-type-errors]
        ? Couldn't match type &#8216;Bool&#8217; with &#8216;[Char]&#8217;
          Expected type: String
            Actual type: Bool
        ? In the first argument of &#8216;putStrLn&#8217;, namely &#8216;True&#8217;
          In the expression: putStrLn True
          In an equation for &#8216;x&#8217;: x = putStrLn True

But for naked expressions, you will have

    Prelude&gt; :set -fdefer-type-errors
    Prelude&gt; putStrLn True
    &lt;interactive&gt;:2:10: error:
        ? Couldn't match type &#8216;Bool&#8217; with &#8216;[Char]&#8217;
          Expected type: String
            Actual type: Bool
        ? In the first argument of &#8216;putStrLn&#8217;, namely &#8216;True&#8217;
          In the expression: putStrLn True
          In an equation for &#8216;it&#8217;: it = putStrLn True

    Prelude&gt; let x = putStrLn True
    &lt;interactive&gt;:2:18: warning: [-Wdeferred-type-errors]
        ? Couldn't match type &#8216;Bool&#8217; with &#8216;[Char]&#8217;
          Expected type: String
            Actual type: Bool
        ? In the first argument of &#8216;putStrLn&#8217;, namely &#8216;True&#8217;
          In the expression: putStrLn True
          In an equation for &#8216;x&#8217;: x = putStrLn True
-}</span><span>
</span><span id="line-2400"></span><span>
</span><span id="line-2401"></span><span class="annot"><a href="GHC.Tc.Module.html#tcUserStmt"><span class="hs-identifier hs-var">tcUserStmt</span></a></span><span> </span><span id="local-6989586621683117737"><span class="annot"><span class="annottext">rdr_stmt :: GhciLStmt GhcPs
</span><a href="#local-6989586621683117737"><span class="hs-identifier hs-var">rdr_stmt</span></a></span></span><span class="hs-glyph">@</span><span class="hs-special">(</span><span class="annot"><a href="GHC.Types.SrcLoc.html#L"><span class="hs-identifier hs-type">L</span></a></span><span> </span><span id="local-6989586621683117738"><span class="annot"><span class="annottext">SrcSpanAnnA
</span><a href="#local-6989586621683117738"><span class="hs-identifier hs-var">loc</span></a></span></span><span> </span><span class="annot"><span class="annottext">StmtLR GhcPs GhcPs (GenLocated SrcSpanAnnA (HsExpr GhcPs))
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span>
</span><span id="line-2402"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span class="hs-special">(</span><span class="hs-special">(</span><span class="hs-special">[</span><span id="local-6989586621683117739"><span class="annot"><a href="#local-6989586621683117739"><span class="hs-identifier hs-var">rn_stmt</span></a></span></span><span class="hs-special">]</span><span class="hs-special">,</span><span> </span><span id="local-6989586621683117740"><span class="annot"><a href="#local-6989586621683117740"><span class="hs-identifier hs-var">fix_env</span></a></span></span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span id="local-6989586621683117741"><span class="annot"><a href="#local-6989586621683117741"><span class="hs-identifier hs-var">fvs</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">TcM
  (([GenLocated
       SrcSpanAnnA
       (StmtLR
          (GhcPass 'Renamed)
          (GhcPass 'Renamed)
          (GenLocated SrcSpanAnnA (HsExpr (GhcPass 'Renamed))))],
    FixityEnv),
   FreeVars)
-&gt; TcM
     (([GenLocated
          SrcSpanAnnA
          (StmtLR
             (GhcPass 'Renamed)
             (GhcPass 'Renamed)
             (GenLocated SrcSpanAnnA (HsExpr (GhcPass 'Renamed))))],
       FixityEnv),
      FreeVars)
forall r. TcM r -&gt; TcM r
</span><a href="GHC.Tc.Utils.Monad.html#checkNoErrs"><span class="hs-identifier hs-var">checkNoErrs</span></a></span><span> </span><span class="annot"><span class="annottext">(TcM
   (([GenLocated
        SrcSpanAnnA
        (StmtLR
           (GhcPass 'Renamed)
           (GhcPass 'Renamed)
           (GenLocated SrcSpanAnnA (HsExpr (GhcPass 'Renamed))))],
     FixityEnv),
    FreeVars)
 -&gt; TcM
      (([GenLocated
           SrcSpanAnnA
           (StmtLR
              (GhcPass 'Renamed)
              (GhcPass 'Renamed)
              (GenLocated SrcSpanAnnA (HsExpr (GhcPass 'Renamed))))],
        FixityEnv),
       FreeVars))
-&gt; TcM
     (([GenLocated
          SrcSpanAnnA
          (StmtLR
             (GhcPass 'Renamed)
             (GhcPass 'Renamed)
             (GenLocated SrcSpanAnnA (HsExpr (GhcPass 'Renamed))))],
       FixityEnv),
      FreeVars)
-&gt; TcM
     (([GenLocated
          SrcSpanAnnA
          (StmtLR
             (GhcPass 'Renamed)
             (GhcPass 'Renamed)
             (GenLocated SrcSpanAnnA (HsExpr (GhcPass 'Renamed))))],
       FixityEnv),
      FreeVars)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-2403"></span><span>           </span><span class="annot"><span class="annottext">HsStmtContextRn
-&gt; (HsExpr GhcPs -&gt; RnM (HsExpr (GhcPass 'Renamed), FreeVars))
-&gt; [LStmt GhcPs (GenLocated SrcSpanAnnA (HsExpr GhcPs))]
-&gt; ([Name] -&gt; IOEnv (Env TcGblEnv TcLclEnv) (FixityEnv, FreeVars))
-&gt; IOEnv
     (Env TcGblEnv TcLclEnv)
     (([LStmt
          (GhcPass 'Renamed)
          (GenLocated SrcSpanAnnA (HsExpr (GhcPass 'Renamed)))],
       FixityEnv),
      FreeVars)
forall (body :: * -&gt; *) thing.
AnnoBody body =&gt;
HsStmtContextRn
-&gt; (body GhcPs -&gt; RnM (body (GhcPass 'Renamed), FreeVars))
-&gt; [LStmt GhcPs (LocatedA (body GhcPs))]
-&gt; ([Name] -&gt; RnM (thing, FreeVars))
-&gt; RnM
     (([LStmt (GhcPass 'Renamed) (LocatedA (body (GhcPass 'Renamed)))],
       thing),
      FreeVars)
</span><a href="GHC.Rename.Expr.html#rnStmts"><span class="hs-identifier hs-var">rnStmts</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">HsDoFlavour -&gt; HsStmtContext (GenLocated SrcSpanAnnN Name)
forall fn. HsDoFlavour -&gt; HsStmtContext fn
</span><a href="Language.Haskell.Syntax.Expr.html#HsDoStmt"><span class="hs-identifier hs-var">HsDoStmt</span></a></span><span> </span><span class="annot"><span class="annottext">HsDoFlavour
</span><a href="Language.Haskell.Syntax.Expr.html#GhciStmtCtxt"><span class="hs-identifier hs-var">GhciStmtCtxt</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">HsExpr GhcPs -&gt; RnM (HsExpr (GhcPass 'Renamed), FreeVars)
</span><a href="GHC.Rename.Expr.html#rnExpr"><span class="hs-identifier hs-var">rnExpr</span></a></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">GhciLStmt GhcPs
LStmt GhcPs (GenLocated SrcSpanAnnA (HsExpr GhcPs))
</span><a href="#local-6989586621683117737"><span class="hs-identifier hs-var">rdr_stmt</span></a></span><span class="hs-special">]</span><span> </span><span class="annot"><span class="annottext">(([Name] -&gt; IOEnv (Env TcGblEnv TcLclEnv) (FixityEnv, FreeVars))
 -&gt; IOEnv
      (Env TcGblEnv TcLclEnv)
      (([LStmt
           (GhcPass 'Renamed)
           (GenLocated SrcSpanAnnA (HsExpr (GhcPass 'Renamed)))],
        FixityEnv),
       FreeVars))
-&gt; ([Name] -&gt; IOEnv (Env TcGblEnv TcLclEnv) (FixityEnv, FreeVars))
-&gt; IOEnv
     (Env TcGblEnv TcLclEnv)
     (([LStmt
          (GhcPass 'Renamed)
          (GenLocated SrcSpanAnnA (HsExpr (GhcPass 'Renamed)))],
       FixityEnv),
      FreeVars)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-glyph">\</span><span class="annot"><span class="annottext">[Name]
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-2404"></span><span>             </span><span id="local-6989586621683117746"><span class="annot"><a href="#local-6989586621683117746"><span class="hs-identifier hs-var">fix_env</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">TcRn FixityEnv
</span><a href="GHC.Tc.Utils.Monad.html#getFixityEnv"><span class="hs-identifier hs-var">getFixityEnv</span></a></span><span>
</span><span id="line-2405"></span><span>             </span><span class="annot"><span class="hs-identifier hs-type">return</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621683117746"><span class="hs-identifier hs-type">fix_env</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Types.Name.Set.html#emptyFVs"><span class="hs-identifier hs-type">emptyFVs</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-2406"></span><span>            </span><span class="hs-comment">-- Don't try to typecheck if the renamer fails!</span><span>
</span><span id="line-2407"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.Monad.html#traceRn"><span class="hs-identifier hs-type">traceRn</span></a></span><span> </span><span class="annot"><span class="hs-string">&quot;tcRnStmt&quot;</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Utils.Outputable.html#vcat"><span class="hs-identifier hs-type">vcat</span></a></span><span> </span><span class="hs-special">[</span><span class="annot"><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-type">ppr</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683117737"><span class="hs-identifier hs-type">rdr_stmt</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-type">ppr</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683117739"><span class="hs-identifier hs-type">rn_stmt</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-type">ppr</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683117741"><span class="hs-identifier hs-type">fvs</span></a></span><span class="hs-special">]</span><span class="hs-special">)</span><span>
</span><span id="line-2408"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="annot"><a href="GHC.Tc.Module.html#rnDump"><span class="hs-identifier hs-type">rnDump</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683117739"><span class="hs-identifier hs-type">rn_stmt</span></a></span><span> </span><span class="hs-special">;</span><span>
</span><span id="line-2409"></span><span>
</span><span id="line-2410"></span><span>       </span><span class="hs-special">;</span><span> </span><span id="local-6989586621683117747"><span class="annot"><a href="#local-6989586621683117747"><span class="hs-identifier hs-var">ghciStep</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><a href="GHC.Tc.Module.html#getGhciStepIO"><span class="hs-identifier hs-type">getGhciStepIO</span></a></span><span>
</span><span id="line-2411"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621683117748"><span class="annot"><a href="#local-6989586621683117748"><span class="hs-identifier hs-var hs-var">gi_stmt</span></a></span></span><span>
</span><span id="line-2412"></span><span>               </span><span class="hs-glyph">|</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Types.SrcLoc.html#L"><span class="hs-identifier hs-type">L</span></a></span><span> </span><span id="local-6989586621683117749"><span class="annot"><span class="annottext">SrcSpanAnnA
</span><a href="#local-6989586621683117749"><span class="hs-identifier hs-var">loc</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Language.Haskell.Syntax.Expr.html#BindStmt"><span class="hs-identifier hs-type">BindStmt</span></a></span><span> </span><span id="local-6989586621683117750"><span class="annot"><span class="annottext">XBindStmt
  (GhcPass 'Renamed)
  (GhcPass 'Renamed)
  (GenLocated SrcSpanAnnA (HsExpr (GhcPass 'Renamed)))
</span><a href="#local-6989586621683117750"><span class="hs-identifier hs-var">x</span></a></span></span><span> </span><span id="local-6989586621683117751"><span class="annot"><span class="annottext">LPat (GhcPass 'Renamed)
</span><a href="#local-6989586621683117751"><span class="hs-identifier hs-var">pat</span></a></span></span><span> </span><span id="local-6989586621683117752"><span class="annot"><span class="annottext">GenLocated SrcSpanAnnA (HsExpr (GhcPass 'Renamed))
</span><a href="#local-6989586621683117752"><span class="hs-identifier hs-var">expr</span></a></span></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">GenLocated
  SrcSpanAnnA
  (StmtLR
     (GhcPass 'Renamed)
     (GhcPass 'Renamed)
     (GenLocated SrcSpanAnnA (HsExpr (GhcPass 'Renamed))))
</span><a href="#local-6989586621683117739"><span class="hs-identifier hs-var">rn_stmt</span></a></span><span>
</span><span id="line-2413"></span><span>                     </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">SrcSpanAnnA
-&gt; StmtLR
     (GhcPass 'Renamed)
     (GhcPass 'Renamed)
     (GenLocated SrcSpanAnnA (HsExpr (GhcPass 'Renamed)))
-&gt; GenLocated
     SrcSpanAnnA
     (StmtLR
        (GhcPass 'Renamed)
        (GhcPass 'Renamed)
        (GenLocated SrcSpanAnnA (HsExpr (GhcPass 'Renamed))))
forall l e. l -&gt; e -&gt; GenLocated l e
</span><a href="GHC.Types.SrcLoc.html#L"><span class="hs-identifier hs-var">L</span></a></span><span> </span><span class="annot"><span class="annottext">SrcSpanAnnA
</span><a href="#local-6989586621683117749"><span class="hs-identifier hs-var">loc</span></a></span><span> </span><span class="annot"><span class="annottext">(StmtLR
   (GhcPass 'Renamed)
   (GhcPass 'Renamed)
   (GenLocated SrcSpanAnnA (HsExpr (GhcPass 'Renamed)))
 -&gt; GenLocated
      SrcSpanAnnA
      (StmtLR
         (GhcPass 'Renamed)
         (GhcPass 'Renamed)
         (GenLocated SrcSpanAnnA (HsExpr (GhcPass 'Renamed)))))
-&gt; StmtLR
     (GhcPass 'Renamed)
     (GhcPass 'Renamed)
     (GenLocated SrcSpanAnnA (HsExpr (GhcPass 'Renamed)))
-&gt; GenLocated
     SrcSpanAnnA
     (StmtLR
        (GhcPass 'Renamed)
        (GhcPass 'Renamed)
        (GenLocated SrcSpanAnnA (HsExpr (GhcPass 'Renamed))))
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">XBindStmt
  (GhcPass 'Renamed)
  (GhcPass 'Renamed)
  (GenLocated SrcSpanAnnA (HsExpr (GhcPass 'Renamed)))
-&gt; LPat (GhcPass 'Renamed)
-&gt; GenLocated SrcSpanAnnA (HsExpr (GhcPass 'Renamed))
-&gt; StmtLR
     (GhcPass 'Renamed)
     (GhcPass 'Renamed)
     (GenLocated SrcSpanAnnA (HsExpr (GhcPass 'Renamed)))
forall idL idR body.
XBindStmt idL idR body -&gt; LPat idL -&gt; body -&gt; StmtLR idL idR body
</span><a href="Language.Haskell.Syntax.Expr.html#BindStmt"><span class="hs-identifier hs-var">BindStmt</span></a></span><span> </span><span class="annot"><span class="annottext">XBindStmt
  (GhcPass 'Renamed)
  (GhcPass 'Renamed)
  (GenLocated SrcSpanAnnA (HsExpr (GhcPass 'Renamed)))
</span><a href="#local-6989586621683117750"><span class="hs-identifier hs-var">x</span></a></span><span> </span><span class="annot"><span class="annottext">LPat (GhcPass 'Renamed)
</span><a href="#local-6989586621683117751"><span class="hs-identifier hs-var">pat</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">LHsExpr (GhcPass 'Renamed)
-&gt; LHsExpr (GhcPass 'Renamed) -&gt; LHsExpr (GhcPass 'Renamed)
forall (id :: Pass).
IsPass id =&gt;
LHsExpr (GhcPass id)
-&gt; LHsExpr (GhcPass id) -&gt; LHsExpr (GhcPass id)
</span><a href="GHC.Hs.Utils.html#nlHsApp"><span class="hs-identifier hs-var">nlHsApp</span></a></span><span> </span><span class="annot"><span class="annottext">LHsExpr (GhcPass 'Renamed)
GenLocated SrcSpanAnnA (HsExpr (GhcPass 'Renamed))
</span><a href="#local-6989586621683117747"><span class="hs-identifier hs-var">ghciStep</span></a></span><span> </span><span class="annot"><span class="annottext">LHsExpr (GhcPass 'Renamed)
GenLocated SrcSpanAnnA (HsExpr (GhcPass 'Renamed))
</span><a href="#local-6989586621683117752"><span class="hs-identifier hs-var">expr</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-2414"></span><span>               </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">otherwise</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">GenLocated
  SrcSpanAnnA
  (StmtLR
     (GhcPass 'Renamed)
     (GhcPass 'Renamed)
     (GenLocated SrcSpanAnnA (HsExpr (GhcPass 'Renamed))))
</span><a href="#local-6989586621683117739"><span class="hs-identifier hs-var">rn_stmt</span></a></span><span>
</span><span id="line-2415"></span><span>
</span><span id="line-2416"></span><span>       </span><span class="hs-special">;</span><span> </span><span id="local-6989586621683117753"><span class="annot"><a href="#local-6989586621683117753"><span class="hs-identifier hs-var">opt_pr_flag</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.Monad.html#goptM"><span class="hs-identifier hs-type">goptM</span></a></span><span> </span><span class="annot"><a href="GHC.Driver.Flags.html#Opt_PrintBindResult"><span class="hs-identifier hs-type">Opt_PrintBindResult</span></a></span><span>
</span><span id="line-2417"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621683117755"><span class="annot"><a href="#local-6989586621683117755"><span class="hs-identifier hs-var hs-var">print_result_plan</span></a></span></span><span>
</span><span id="line-2418"></span><span>               </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621683117753"><span class="hs-identifier hs-var">opt_pr_flag</span></a></span><span>                         </span><span class="hs-comment">-- The flag says &quot;print result&quot;</span><span>
</span><span id="line-2419"></span><span>               </span><span class="hs-special">,</span><span> </span><span class="hs-special">[</span><span id="local-6989586621683117756"><span class="annot"><span class="annottext">IdP (GhcPass 'Renamed)
</span><a href="#local-6989586621683117756"><span class="hs-identifier hs-var">v</span></a></span></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">CollectFlag (GhcPass 'Renamed)
-&gt; LStmt
     (GhcPass 'Renamed)
     (GenLocated SrcSpanAnnA (HsExpr (GhcPass 'Renamed)))
-&gt; [IdP (GhcPass 'Renamed)]
forall (idL :: Pass) (idR :: Pass) body.
(IsPass idL, IsPass idR, CollectPass (GhcPass idL)) =&gt;
CollectFlag (GhcPass idL)
-&gt; LStmtLR (GhcPass idL) (GhcPass idR) body -&gt; [IdP (GhcPass idL)]
</span><a href="GHC.Hs.Utils.html#collectLStmtBinders"><span class="hs-identifier hs-var">collectLStmtBinders</span></a></span><span> </span><span class="annot"><span class="annottext">CollectFlag (GhcPass 'Renamed)
forall p. CollectFlag p
</span><a href="GHC.Hs.Utils.html#CollNoDictBinders"><span class="hs-identifier hs-var">CollNoDictBinders</span></a></span><span> </span><span class="annot"><span class="annottext">LStmt
  (GhcPass 'Renamed)
  (GenLocated SrcSpanAnnA (HsExpr (GhcPass 'Renamed)))
GenLocated
  SrcSpanAnnA
  (StmtLR
     (GhcPass 'Renamed)
     (GhcPass 'Renamed)
     (GenLocated SrcSpanAnnA (HsExpr (GhcPass 'Renamed))))
</span><a href="#local-6989586621683117748"><span class="hs-identifier hs-var">gi_stmt</span></a></span><span>  </span><span class="hs-comment">-- One binder</span><span>
</span><span id="line-2420"></span><span>               </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">TcM ([Id], GenLocated SrcSpanAnnA (HsExpr GhcTc))
-&gt; Maybe (TcM ([Id], GenLocated SrcSpanAnnA (HsExpr GhcTc)))
forall a. a -&gt; Maybe a
</span><span class="hs-identifier hs-var">Just</span></span><span> </span><span class="annot"><span class="annottext">(TcM ([Id], GenLocated SrcSpanAnnA (HsExpr GhcTc))
 -&gt; Maybe (TcM ([Id], GenLocated SrcSpanAnnA (HsExpr GhcTc))))
-&gt; TcM ([Id], GenLocated SrcSpanAnnA (HsExpr GhcTc))
-&gt; Maybe (TcM ([Id], GenLocated SrcSpanAnnA (HsExpr GhcTc)))
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">GenLocated
  SrcSpanAnnA
  (StmtLR
     (GhcPass 'Renamed)
     (GhcPass 'Renamed)
     (GenLocated SrcSpanAnnA (HsExpr (GhcPass 'Renamed))))
-&gt; Name -&gt; TcM ([Id], GenLocated SrcSpanAnnA (HsExpr GhcTc))
</span><a href="#local-6989586621683117758"><span class="hs-identifier hs-var">mk_print_result_plan</span></a></span><span> </span><span class="annot"><span class="annottext">GenLocated
  SrcSpanAnnA
  (StmtLR
     (GhcPass 'Renamed)
     (GhcPass 'Renamed)
     (GenLocated SrcSpanAnnA (HsExpr (GhcPass 'Renamed))))
</span><a href="#local-6989586621683117748"><span class="hs-identifier hs-var">gi_stmt</span></a></span><span> </span><span class="annot"><span class="annottext">IdP (GhcPass 'Renamed)
Name
</span><a href="#local-6989586621683117756"><span class="hs-identifier hs-var">v</span></a></span><span>
</span><span id="line-2421"></span><span>               </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">otherwise</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Maybe (TcM ([Id], GenLocated SrcSpanAnnA (HsExpr GhcTc)))
forall a. Maybe a
</span><span class="hs-identifier hs-var">Nothing</span></span><span>
</span><span id="line-2422"></span><span>
</span><span id="line-2423"></span><span>        </span><span class="hs-comment">-- The plans are:</span><span>
</span><span id="line-2424"></span><span>        </span><span class="hs-comment">--      [stmt; print v]         if one binder and not v::()</span><span>
</span><span id="line-2425"></span><span>        </span><span class="hs-comment">--      [stmt]                  otherwise</span><span>
</span><span id="line-2426"></span><span>       </span><span class="hs-special">;</span><span> </span><span id="local-6989586621683117759"><span class="annot"><a href="#local-6989586621683117759"><span class="hs-identifier hs-var">plan</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><a href="GHC.Tc.Module.html#runPlans"><span class="hs-identifier hs-type">runPlans</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">maybe</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">id</span></span><span> </span><span class="annot"><a href="../../base-4.21.0.0-ae91/src/Data.List.NonEmpty.html#%3C%7C"><span class="hs-operator hs-type">(NE.&lt;|)</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683117755"><span class="hs-identifier hs-type">print_result_plan</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="annot"><a href="../../base-4.21.0.0-ae91/src/Data.List.NonEmpty.html#singleton"><span class="hs-identifier hs-type">NE.singleton</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="annot"><a href="GHC.Tc.Module.html#tcGhciStmts"><span class="hs-identifier hs-type">tcGhciStmts</span></a></span><span> </span><span class="hs-special">[</span><span class="annot"><a href="#local-6989586621683117748"><span class="hs-identifier hs-type">gi_stmt</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-2427"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">return</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621683117759"><span class="hs-identifier hs-type">plan</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="#local-6989586621683117740"><span class="hs-identifier hs-type">fix_env</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-2428"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-2429"></span><span>    </span><span id="local-6989586621683117758"><span class="annot"><span class="annottext">mk_print_result_plan :: GenLocated
  SrcSpanAnnA
  (StmtLR
     (GhcPass 'Renamed)
     (GhcPass 'Renamed)
     (GenLocated SrcSpanAnnA (HsExpr (GhcPass 'Renamed))))
-&gt; Name -&gt; TcM ([Id], GenLocated SrcSpanAnnA (HsExpr GhcTc))
</span><a href="#local-6989586621683117758"><span class="hs-identifier hs-var hs-var">mk_print_result_plan</span></a></span></span><span> </span><span id="local-6989586621683117763"><span class="annot"><span class="annottext">GenLocated
  SrcSpanAnnA
  (StmtLR
     (GhcPass 'Renamed)
     (GhcPass 'Renamed)
     (GenLocated SrcSpanAnnA (HsExpr (GhcPass 'Renamed))))
</span><a href="#local-6989586621683117763"><span class="hs-identifier hs-var">stmt</span></a></span></span><span> </span><span id="local-6989586621683117764"><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621683117764"><span class="hs-identifier hs-var">v</span></a></span></span><span>
</span><span id="line-2430"></span><span>      </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span id="local-6989586621683117765"><span class="annot"><a href="#local-6989586621683117765"><span class="hs-identifier hs-var">stuff</span></a></span></span><span class="hs-glyph">@</span><span class="hs-special">(</span><span class="hs-special">[</span><span id="local-6989586621683117766"><span class="annot"><a href="#local-6989586621683117766"><span class="hs-identifier hs-var">v_id</span></a></span></span><span class="hs-special">]</span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">[GhciLStmt (GhcPass 'Renamed)] -&gt; Plan
</span><a href="GHC.Tc.Module.html#tcGhciStmts"><span class="hs-identifier hs-var">tcGhciStmts</span></a></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">GhciLStmt (GhcPass 'Renamed)
GenLocated
  SrcSpanAnnA
  (StmtLR
     (GhcPass 'Renamed)
     (GhcPass 'Renamed)
     (GenLocated SrcSpanAnnA (HsExpr (GhcPass 'Renamed))))
</span><a href="#local-6989586621683117763"><span class="hs-identifier hs-var">stmt</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">GhciLStmt (GhcPass 'Renamed)
GenLocated
  SrcSpanAnnA
  (StmtLR
     (GhcPass 'Renamed)
     (GhcPass 'Renamed)
     (GenLocated SrcSpanAnnA (HsExpr (GhcPass 'Renamed))))
</span><a href="#local-6989586621683117767"><span class="hs-identifier hs-var">print_v</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-2431"></span><span>           </span><span class="hs-special">;</span><span> </span><span id="local-6989586621683117768"><span class="annot"><a href="#local-6989586621683117768"><span class="hs-identifier hs-var">v_ty</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.Monad.html#liftZonkM"><span class="hs-identifier hs-type">liftZonkM</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="annot"><a href="GHC.Tc.Zonk.TcType.html#zonkTcType"><span class="hs-identifier hs-type">zonkTcType</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Types.Id.html#idType"><span class="hs-identifier hs-type">idType</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683117766"><span class="hs-identifier hs-type">v_id</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-2432"></span><span>           </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">when</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Tc.Utils.TcType.html#isUnitTy"><span class="hs-identifier hs-type">isUnitTy</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683117768"><span class="hs-identifier hs-type">v_ty</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">||</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">not</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Core.Type.html#isTauTy"><span class="hs-identifier hs-type">isTauTy</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683117768"><span class="hs-identifier hs-type">v_ty</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="annot"><a href="GHC.Data.IOEnv.html#failM"><span class="hs-identifier hs-type">failM</span></a></span><span>
</span><span id="line-2433"></span><span>           </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">return</span></span><span> </span><span class="annot"><a href="#local-6989586621683117765"><span class="hs-identifier hs-type">stuff</span></a></span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-2434"></span><span>      </span><span class="hs-keyword">where</span><span>
</span><span id="line-2435"></span><span>        </span><span id="local-6989586621683117767"><span class="annot"><span class="annottext">print_v :: GenLocated
  SrcSpanAnnA
  (StmtLR
     (GhcPass 'Renamed)
     (GhcPass 'Renamed)
     (GenLocated SrcSpanAnnA (HsExpr (GhcPass 'Renamed))))
</span><a href="#local-6989586621683117767"><span class="hs-identifier hs-var hs-var">print_v</span></a></span></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">SrcSpanAnnA
-&gt; StmtLR
     (GhcPass 'Renamed)
     (GhcPass 'Renamed)
     (GenLocated SrcSpanAnnA (HsExpr (GhcPass 'Renamed)))
-&gt; GenLocated
     SrcSpanAnnA
     (StmtLR
        (GhcPass 'Renamed)
        (GhcPass 'Renamed)
        (GenLocated SrcSpanAnnA (HsExpr (GhcPass 'Renamed))))
forall l e. l -&gt; e -&gt; GenLocated l e
</span><a href="GHC.Types.SrcLoc.html#L"><span class="hs-identifier hs-var">L</span></a></span><span> </span><span class="annot"><span class="annottext">SrcSpanAnnA
</span><a href="#local-6989586621683117738"><span class="hs-identifier hs-var">loc</span></a></span><span> </span><span class="annot"><span class="annottext">(StmtLR
   (GhcPass 'Renamed)
   (GhcPass 'Renamed)
   (GenLocated SrcSpanAnnA (HsExpr (GhcPass 'Renamed)))
 -&gt; GenLocated
      SrcSpanAnnA
      (StmtLR
         (GhcPass 'Renamed)
         (GhcPass 'Renamed)
         (GenLocated SrcSpanAnnA (HsExpr (GhcPass 'Renamed)))))
-&gt; StmtLR
     (GhcPass 'Renamed)
     (GhcPass 'Renamed)
     (GenLocated SrcSpanAnnA (HsExpr (GhcPass 'Renamed)))
-&gt; GenLocated
     SrcSpanAnnA
     (StmtLR
        (GhcPass 'Renamed)
        (GhcPass 'Renamed)
        (GenLocated SrcSpanAnnA (HsExpr (GhcPass 'Renamed))))
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">XBodyStmt
  (GhcPass 'Renamed)
  (GhcPass 'Renamed)
  (GenLocated SrcSpanAnnA (HsExpr (GhcPass 'Renamed)))
-&gt; GenLocated SrcSpanAnnA (HsExpr (GhcPass 'Renamed))
-&gt; SyntaxExpr (GhcPass 'Renamed)
-&gt; SyntaxExpr (GhcPass 'Renamed)
-&gt; StmtLR
     (GhcPass 'Renamed)
     (GhcPass 'Renamed)
     (GenLocated SrcSpanAnnA (HsExpr (GhcPass 'Renamed)))
forall idL idR body.
XBodyStmt idL idR body
-&gt; body -&gt; SyntaxExpr idR -&gt; SyntaxExpr idR -&gt; StmtLR idL idR body
</span><a href="Language.Haskell.Syntax.Expr.html#BodyStmt"><span class="hs-identifier hs-var">BodyStmt</span></a></span><span> </span><span class="annot"><span class="annottext">XBodyStmt
  (GhcPass 'Renamed)
  (GhcPass 'Renamed)
  (GenLocated SrcSpanAnnA (HsExpr (GhcPass 'Renamed)))
NoExtField
</span><a href="Language.Haskell.Syntax.Extension.html#noExtField"><span class="hs-identifier hs-var">noExtField</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">LHsExpr (GhcPass 'Renamed)
-&gt; LHsExpr (GhcPass 'Renamed) -&gt; LHsExpr (GhcPass 'Renamed)
forall (id :: Pass).
IsPass id =&gt;
LHsExpr (GhcPass id)
-&gt; LHsExpr (GhcPass id) -&gt; LHsExpr (GhcPass id)
</span><a href="GHC.Hs.Utils.html#nlHsApp"><span class="hs-identifier hs-var">nlHsApp</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">IdP (GhcPass 'Renamed) -&gt; LHsExpr (GhcPass 'Renamed)
forall (p :: Pass) a.
IsSrcSpanAnn p a =&gt;
IdP (GhcPass p) -&gt; LHsExpr (GhcPass p)
</span><a href="GHC.Hs.Utils.html#nlHsVar"><span class="hs-identifier hs-var">nlHsVar</span></a></span><span> </span><span class="annot"><span class="annottext">IdP (GhcPass 'Renamed)
Name
</span><a href="GHC.Builtin.Names.html#printName"><span class="hs-identifier hs-var">printName</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-2436"></span><span>                                    </span><span class="hs-special">(</span><span class="annot"><span class="annottext">IdP (GhcPass 'Renamed) -&gt; LHsExpr (GhcPass 'Renamed)
forall (p :: Pass) a.
IsSrcSpanAnn p a =&gt;
IdP (GhcPass p) -&gt; LHsExpr (GhcPass p)
</span><a href="GHC.Hs.Utils.html#nlHsVar"><span class="hs-identifier hs-var">nlHsVar</span></a></span><span> </span><span class="annot"><span class="annottext">IdP (GhcPass 'Renamed)
Name
</span><a href="#local-6989586621683117764"><span class="hs-identifier hs-var">v</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-2437"></span><span>                                    </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Name -&gt; SyntaxExprRn
</span><a href="GHC.Hs.Expr.html#mkRnSyntaxExpr"><span class="hs-identifier hs-var">mkRnSyntaxExpr</span></a></span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="GHC.Builtin.Names.html#thenIOName"><span class="hs-identifier hs-var">thenIOName</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">SyntaxExpr (GhcPass 'Renamed)
forall (p :: Pass). IsPass p =&gt; SyntaxExpr (GhcPass p)
</span><a href="GHC.Hs.Expr.html#noSyntaxExpr"><span class="hs-identifier hs-var">noSyntaxExpr</span></a></span><span>
</span><span id="line-2438"></span><span>
</span><span id="line-2439"></span><span class="hs-comment">{-
Note [GHCi Plans]
~~~~~~~~~~~~~~~~~
When a user types an expression in the repl we try to print it in three different
ways. Also, depending on whether -fno-it is set, we bind a variable called `it`
which can be used to refer to the result of the expression subsequently in the repl.

The normal plans are :
  A. [it &lt;- e; print e]     but not if it::()
  B. [it &lt;- e]
  C. [let it = e; print it]

When -fno-it is set, the plans are:
  A. [e &gt;&gt;= print]
  B. [e]
  C. [let it = e in print it]

The reason for -fno-it is explained in #14336. `it` can lead to the repl
leaking memory as it is repeatedly queried.
-}</span><span>
</span><span id="line-2459"></span><span>
</span><span id="line-2460"></span><span class="annot"><a href="GHC.Tc.Module.html#any_lifted"><span class="hs-identifier hs-type">any_lifted</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#Type"><span class="hs-identifier hs-type">Type</span></a></span><span>
</span><span id="line-2461"></span><span id="any_lifted"><span class="annot"><span class="annottext">any_lifted :: Type
</span><a href="GHC.Tc.Module.html#any_lifted"><span class="hs-identifier hs-var hs-var">any_lifted</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Type -&gt; Type
</span><a href="GHC.Builtin.Types.html#anyTypeOfKind"><span class="hs-identifier hs-var">anyTypeOfKind</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="GHC.Builtin.Types.html#liftedTypeKind"><span class="hs-identifier hs-var">liftedTypeKind</span></a></span><span>
</span><span id="line-2462"></span><span>
</span><span id="line-2463"></span><span class="hs-comment">-- | Typecheck the statements given and then return the results of the</span><span>
</span><span id="line-2464"></span><span class="hs-comment">-- statement in the form 'IO [Any]'.</span><span>
</span><span id="line-2465"></span><span class="annot"><a href="GHC.Tc.Module.html#tcGhciStmts"><span class="hs-identifier hs-type">tcGhciStmts</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="Language.Haskell.Syntax.Expr.html#GhciLStmt"><span class="hs-identifier hs-type">GhciLStmt</span></a></span><span> </span><span class="annot"><a href="GHC.Hs.Extension.html#GhcRn"><span class="hs-identifier hs-type">GhcRn</span></a></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#TcM"><span class="hs-identifier hs-type">TcM</span></a></span><span> </span><span class="annot"><a href="GHC.Tc.Module.html#PlanResult"><span class="hs-identifier hs-type">PlanResult</span></a></span><span>
</span><span id="line-2466"></span><span id="tcGhciStmts"><span class="annot"><span class="annottext">tcGhciStmts :: [GhciLStmt (GhcPass 'Renamed)] -&gt; Plan
</span><a href="GHC.Tc.Module.html#tcGhciStmts"><span class="hs-identifier hs-var hs-var">tcGhciStmts</span></a></span></span><span> </span><span id="local-6989586621683117772"><span class="annot"><span class="annottext">[GhciLStmt (GhcPass 'Renamed)]
</span><a href="#local-6989586621683117772"><span class="hs-identifier hs-var">stmts</span></a></span></span><span>
</span><span id="line-2467"></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span id="local-6989586621683117773"><span class="annot"><a href="#local-6989586621683117773"><span class="hs-identifier hs-var">ioTyCon</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Name -&gt; TcM TyCon
</span><a href="GHC.Tc.Utils.Env.html#tcLookupTyCon"><span class="hs-identifier hs-var">tcLookupTyCon</span></a></span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="GHC.Builtin.Names.html#ioTyConName"><span class="hs-identifier hs-var">ioTyConName</span></a></span><span>
</span><span id="line-2468"></span><span>      </span><span class="hs-special">;</span><span> </span><span id="local-6989586621683117774"><span class="annot"><a href="#local-6989586621683117774"><span class="hs-identifier hs-var">ret_id</span></a></span></span><span>  </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.Env.html#tcLookupId"><span class="hs-identifier hs-type">tcLookupId</span></a></span><span> </span><span class="annot"><a href="GHC.Builtin.Names.html#returnIOName"><span class="hs-identifier hs-type">returnIOName</span></a></span><span>             </span><span class="hs-comment">-- return @ IO</span><span>
</span><span id="line-2469"></span><span>      </span><span class="hs-special">;</span><span> </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621683117776"><span class="annot"><a href="#local-6989586621683117776"><span class="hs-identifier hs-var hs-var">ret_ty</span></a></span></span><span>      </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Type -&gt; Type
</span><a href="GHC.Builtin.Types.html#mkListTy"><span class="hs-identifier hs-var">mkListTy</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="GHC.Tc.Module.html#any_lifted"><span class="hs-identifier hs-var">any_lifted</span></a></span><span>
</span><span id="line-2470"></span><span>            </span><span id="local-6989586621683117777"><span class="annot"><a href="#local-6989586621683117777"><span class="hs-identifier hs-var hs-var">io_ret_ty</span></a></span></span><span>   </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">TyCon -&gt; [Type] -&gt; Type
</span><a href="GHC.Core.Type.html#mkTyConApp"><span class="hs-identifier hs-var">mkTyConApp</span></a></span><span> </span><span class="annot"><span class="annottext">TyCon
</span><a href="#local-6989586621683117773"><span class="hs-identifier hs-var">ioTyCon</span></a></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621683117776"><span class="hs-identifier hs-var">ret_ty</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-2471"></span><span>            </span><span id="local-6989586621683117778"><span class="annot"><a href="#local-6989586621683117778"><span class="hs-identifier hs-var hs-var">tc_io_stmts</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">HsStmtContextRn
-&gt; TcStmtChecker HsExpr ExpType
-&gt; [LStmt
      (GhcPass 'Renamed)
      (GenLocated SrcSpanAnnA (HsExpr (GhcPass 'Renamed)))]
-&gt; ExpType
-&gt; (ExpType -&gt; TcM [Id])
-&gt; TcM
     ([LStmt GhcTc (GenLocated SrcSpanAnnA (HsExpr GhcTc))], [Id])
forall (body :: * -&gt; *) rho_type thing.
AnnoBody body =&gt;
HsStmtContextRn
-&gt; TcStmtChecker body rho_type
-&gt; [LStmt (GhcPass 'Renamed) (LocatedA (body (GhcPass 'Renamed)))]
-&gt; rho_type
-&gt; (rho_type -&gt; TcM thing)
-&gt; TcM ([LStmt GhcTc (LocatedA (body GhcTc))], thing)
</span><a href="GHC.Tc.Gen.Match.html#tcStmtsAndThen"><span class="hs-identifier hs-var">tcStmtsAndThen</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">HsDoFlavour -&gt; HsStmtContext (GenLocated SrcSpanAnnN Name)
forall fn. HsDoFlavour -&gt; HsStmtContext fn
</span><a href="Language.Haskell.Syntax.Expr.html#HsDoStmt"><span class="hs-identifier hs-var">HsDoStmt</span></a></span><span> </span><span class="annot"><span class="annottext">HsDoFlavour
</span><a href="Language.Haskell.Syntax.Expr.html#GhciStmtCtxt"><span class="hs-identifier hs-var">GhciStmtCtxt</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">HsStmtContextRn
-&gt; StmtLR
     (GhcPass 'Renamed)
     (GhcPass 'Renamed)
     (GenLocated SrcSpanAnnA (HsExpr (GhcPass 'Renamed)))
-&gt; ExpType
-&gt; (ExpType -&gt; TcM thing)
-&gt; TcM (Stmt GhcTc (GenLocated SrcSpanAnnA (HsExpr GhcTc)), thing)
TcStmtChecker HsExpr ExpType
</span><a href="GHC.Tc.Gen.Match.html#tcDoStmt"><span class="hs-identifier hs-var">tcDoStmt</span></a></span><span> </span><span class="annot"><span class="annottext">[GhciLStmt (GhcPass 'Renamed)]
[LStmt
   (GhcPass 'Renamed)
   (GenLocated SrcSpanAnnA (HsExpr (GhcPass 'Renamed)))]
</span><a href="#local-6989586621683117772"><span class="hs-identifier hs-var">stmts</span></a></span><span>
</span><span id="line-2472"></span><span>                                         </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Type -&gt; ExpType
</span><a href="GHC.Tc.Utils.TcType.html#mkCheckExpType"><span class="hs-identifier hs-var">mkCheckExpType</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621683117777"><span class="hs-identifier hs-var">io_ret_ty</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-2473"></span><span>            </span><span id="local-6989586621683117782"><span class="annot"><a href="#local-6989586621683117782"><span class="hs-identifier hs-var hs-var">names</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">CollectFlag (GhcPass 'Renamed)
-&gt; [LStmt
      (GhcPass 'Renamed)
      (GenLocated SrcSpanAnnA (HsExpr (GhcPass 'Renamed)))]
-&gt; [IdP (GhcPass 'Renamed)]
forall (idL :: Pass) (idR :: Pass) body.
(IsPass idL, IsPass idR, CollectPass (GhcPass idL)) =&gt;
CollectFlag (GhcPass idL)
-&gt; [LStmtLR (GhcPass idL) (GhcPass idR) body]
-&gt; [IdP (GhcPass idL)]
</span><a href="GHC.Hs.Utils.html#collectLStmtsBinders"><span class="hs-identifier hs-var">collectLStmtsBinders</span></a></span><span> </span><span class="annot"><span class="annottext">CollectFlag (GhcPass 'Renamed)
forall p. CollectFlag p
</span><a href="GHC.Hs.Utils.html#CollNoDictBinders"><span class="hs-identifier hs-var">CollNoDictBinders</span></a></span><span> </span><span class="annot"><span class="annottext">[GhciLStmt (GhcPass 'Renamed)]
[LStmt
   (GhcPass 'Renamed)
   (GenLocated SrcSpanAnnA (HsExpr (GhcPass 'Renamed)))]
</span><a href="#local-6989586621683117772"><span class="hs-identifier hs-var">stmts</span></a></span><span>
</span><span id="line-2474"></span><span>
</span><span id="line-2475"></span><span>        </span><span class="hs-comment">-- OK, we're ready to typecheck the stmts</span><span>
</span><span id="line-2476"></span><span>      </span><span class="hs-special">;</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.Monad.html#traceTc"><span class="hs-identifier hs-type">traceTc</span></a></span><span> </span><span class="annot"><span class="hs-string">&quot;GHC.Tc.Module.tcGhciStmts: tc stmts&quot;</span></span><span> </span><span class="annot"><a href="GHC.Utils.Outputable.html#empty"><span class="hs-identifier hs-type">empty</span></a></span><span>
</span><span id="line-2477"></span><span>      </span><span class="hs-special">;</span><span> </span><span class="hs-special">(</span><span class="hs-special">(</span><span id="local-6989586621683117784"><span class="annot"><a href="#local-6989586621683117784"><span class="hs-identifier hs-var">tc_stmts</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621683117785"><span class="annot"><a href="#local-6989586621683117785"><span class="hs-identifier hs-var">ids</span></a></span></span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span id="local-6989586621683117786"><span class="annot"><a href="#local-6989586621683117786"><span class="hs-identifier hs-var">lie</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><a href="GHC.Tc.Solver.html#captureTopConstraints"><span class="hs-identifier hs-type">captureTopConstraints</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span>
</span><span id="line-2478"></span><span>                                  </span><span class="annot"><a href="#local-6989586621683117778"><span class="hs-identifier hs-type">tc_io_stmts</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="hs-glyph">\</span><span> </span><span class="annot"><span class="annottext">ExpType
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-2479"></span><span>                                  </span><span class="annot"><span class="annottext">(Name -&gt; TcM Id) -&gt; [Name] -&gt; TcM [Id]
forall (t :: * -&gt; *) (m :: * -&gt; *) a b.
(Traversable t, Monad m) =&gt;
(a -&gt; m b) -&gt; t a -&gt; m (t b)
forall (m :: * -&gt; *) a b. Monad m =&gt; (a -&gt; m b) -&gt; [a] -&gt; m [b]
</span><span class="hs-identifier hs-var">mapM</span></span><span> </span><span class="annot"><span class="annottext">Name -&gt; TcM Id
</span><a href="GHC.Tc.Utils.Env.html#tcLookupId"><span class="hs-identifier hs-var">tcLookupId</span></a></span><span> </span><span class="annot"><span class="annottext">[IdP (GhcPass 'Renamed)]
[Name]
</span><a href="#local-6989586621683117782"><span class="hs-identifier hs-var">names</span></a></span><span>
</span><span id="line-2480"></span><span>                        </span><span class="hs-comment">-- Look up the names right in the middle,</span><span>
</span><span id="line-2481"></span><span>                        </span><span class="hs-comment">-- where they will all be in scope</span><span>
</span><span id="line-2482"></span><span>
</span><span id="line-2483"></span><span>        </span><span class="hs-comment">-- Simplify the context</span><span>
</span><span id="line-2484"></span><span>      </span><span class="hs-special">;</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.Monad.html#traceTc"><span class="hs-identifier hs-type">traceTc</span></a></span><span> </span><span class="annot"><span class="hs-string">&quot;GHC.Tc.Module.tcGhciStmts: simplify ctxt&quot;</span></span><span> </span><span class="annot"><a href="GHC.Utils.Outputable.html#empty"><span class="hs-identifier hs-type">empty</span></a></span><span>
</span><span id="line-2485"></span><span>      </span><span class="hs-special">;</span><span> </span><span id="local-6989586621683117787"><span class="annot"><a href="#local-6989586621683117787"><span class="hs-identifier hs-var">const_binds</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.Monad.html#checkNoErrs"><span class="hs-identifier hs-type">checkNoErrs</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Tc.Solver.html#simplifyInteractive"><span class="hs-identifier hs-type">simplifyInteractive</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683117786"><span class="hs-identifier hs-type">lie</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-2486"></span><span>                </span><span class="hs-comment">-- checkNoErrs ensures that the plan fails if context redn fails</span><span>
</span><span id="line-2487"></span><span>
</span><span id="line-2488"></span><span>
</span><span id="line-2489"></span><span>      </span><span class="hs-special">;</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.Monad.html#traceTc"><span class="hs-identifier hs-type">traceTc</span></a></span><span> </span><span class="annot"><span class="hs-string">&quot;GHC.Tc.Module.tcGhciStmts: done&quot;</span></span><span> </span><span class="annot"><a href="GHC.Utils.Outputable.html#empty"><span class="hs-identifier hs-type">empty</span></a></span><span>
</span><span id="line-2490"></span><span>
</span><span id="line-2491"></span><span>      </span><span class="hs-comment">-- ret_expr is the expression</span><span>
</span><span id="line-2492"></span><span>      </span><span class="hs-comment">--      returnIO @[Any] [unsafeCoerce# @Any x, ..,  unsafeCoerce# @Any z]</span><span>
</span><span id="line-2493"></span><span>      </span><span class="hs-comment">--</span><span>
</span><span id="line-2494"></span><span>      </span><span class="hs-comment">-- Despite the inconvenience of building the type applications etc,</span><span>
</span><span id="line-2495"></span><span>      </span><span class="hs-comment">-- this *has* to be done in type-annotated post-typecheck form</span><span>
</span><span id="line-2496"></span><span>      </span><span class="hs-comment">-- because we are going to return a list of *polymorphic* values</span><span>
</span><span id="line-2497"></span><span>      </span><span class="hs-comment">-- coerced to type Any. If we built a *source* stmt</span><span>
</span><span id="line-2498"></span><span>      </span><span class="hs-comment">--      return [coerce x, ..., coerce z]</span><span>
</span><span id="line-2499"></span><span>      </span><span class="hs-comment">-- then the type checker would instantiate x..z, and we wouldn't</span><span>
</span><span id="line-2500"></span><span>      </span><span class="hs-comment">-- get their *polymorphic* values.  (And we'd get ambiguity errs</span><span>
</span><span id="line-2501"></span><span>      </span><span class="hs-comment">-- if they were overloaded, since they aren't applied to anything.)</span><span>
</span><span id="line-2502"></span><span>      </span><span class="hs-comment">--</span><span>
</span><span id="line-2503"></span><span>      </span><span class="hs-comment">-- We use Any rather than a dummy type such as () because of</span><span>
</span><span id="line-2504"></span><span>      </span><span class="hs-comment">-- the rules of unsafeCoerce#; see Unsafe/Coerce.hs for the details.</span><span>
</span><span id="line-2505"></span><span>
</span><span id="line-2506"></span><span>      </span><span class="hs-special">;</span><span> </span><span class="annot"><a href="GHC.Types.TyThing.html#AnId"><span class="hs-identifier hs-type">AnId</span></a></span><span> </span><span id="local-6989586621683117789"><span class="annot"><a href="#local-6989586621683117789"><span class="hs-identifier hs-var">unsafe_coerce_id</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.Env.html#tcLookupGlobal"><span class="hs-identifier hs-type">tcLookupGlobal</span></a></span><span> </span><span class="annot"><a href="GHC.Builtin.Names.html#unsafeCoercePrimName"><span class="hs-identifier hs-type">unsafeCoercePrimName</span></a></span><span>
</span><span id="line-2507"></span><span>           </span><span class="hs-comment">-- We use unsafeCoerce# here because of (U11) in</span><span>
</span><span id="line-2508"></span><span>           </span><span class="hs-comment">-- Note [Implementing unsafeCoerce] in base:Unsafe.Coerce</span><span>
</span><span id="line-2509"></span><span>
</span><span id="line-2510"></span><span>      </span><span class="hs-special">;</span><span> </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621683117792"><span class="annot"><a href="#local-6989586621683117792"><span class="hs-identifier hs-var hs-var">ret_expr</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">LHsExpr GhcTc -&gt; LHsExpr GhcTc -&gt; LHsExpr GhcTc
forall (id :: Pass).
IsPass id =&gt;
LHsExpr (GhcPass id)
-&gt; LHsExpr (GhcPass id) -&gt; LHsExpr (GhcPass id)
</span><a href="GHC.Hs.Utils.html#nlHsApp"><span class="hs-identifier hs-var">nlHsApp</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Id -&gt; [Type] -&gt; LHsExpr GhcTc
</span><a href="GHC.Hs.Utils.html#nlHsTyApp"><span class="hs-identifier hs-var">nlHsTyApp</span></a></span><span> </span><span class="annot"><span class="annottext">Id
</span><a href="#local-6989586621683117774"><span class="hs-identifier hs-var">ret_id</span></a></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621683117776"><span class="hs-identifier hs-var">ret_ty</span></a></span><span class="hs-special">]</span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(LHsExpr GhcTc -&gt; LHsExpr GhcTc) -&gt; LHsExpr GhcTc -&gt; LHsExpr GhcTc
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-2511"></span><span>                       </span><span class="annot"><span class="annottext">HsExpr GhcTc -&gt; GenLocated SrcSpanAnnA (HsExpr GhcTc)
forall e a. HasAnnotation e =&gt; a -&gt; GenLocated e a
</span><a href="GHC.Parser.Annotation.html#noLocA"><span class="hs-identifier hs-var">noLocA</span></a></span><span> </span><span class="annot"><span class="annottext">(HsExpr GhcTc -&gt; GenLocated SrcSpanAnnA (HsExpr GhcTc))
-&gt; HsExpr GhcTc -&gt; GenLocated SrcSpanAnnA (HsExpr GhcTc)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">XExplicitList GhcTc -&gt; [LHsExpr GhcTc] -&gt; HsExpr GhcTc
forall p. XExplicitList p -&gt; [LHsExpr p] -&gt; HsExpr p
</span><a href="Language.Haskell.Syntax.Expr.html#ExplicitList"><span class="hs-identifier hs-var">ExplicitList</span></a></span><span> </span><span class="annot"><span class="annottext">XExplicitList GhcTc
Type
</span><a href="GHC.Tc.Module.html#any_lifted"><span class="hs-identifier hs-var">any_lifted</span></a></span><span> </span><span class="annot"><span class="annottext">([LHsExpr GhcTc] -&gt; HsExpr GhcTc)
-&gt; [LHsExpr GhcTc] -&gt; HsExpr GhcTc
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-2512"></span><span>                       </span><span class="annot"><span class="annottext">(Id -&gt; LHsExpr GhcTc) -&gt; [Id] -&gt; [LHsExpr GhcTc]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><span class="hs-identifier hs-var">map</span></span><span> </span><span class="annot"><span class="annottext">Id -&gt; LHsExpr GhcTc
</span><a href="#local-6989586621683117795"><span class="hs-identifier hs-var">mk_item</span></a></span><span> </span><span class="annot"><span class="annottext">[Id]
</span><a href="#local-6989586621683117785"><span class="hs-identifier hs-var">ids</span></a></span><span>
</span><span id="line-2513"></span><span>
</span><span id="line-2514"></span><span>            </span><span id="local-6989586621683117795"><span class="annot"><a href="#local-6989586621683117795"><span class="hs-identifier hs-var hs-var">mk_item</span></a></span></span><span> </span><span id="local-6989586621683117796"><span class="annot"><span class="annottext">Id
</span><a href="#local-6989586621683117796"><span class="hs-identifier hs-var">id</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Id
</span><a href="#local-6989586621683117789"><span class="hs-identifier hs-var">unsafe_coerce_id</span></a></span><span> </span><span class="annot"><span class="annottext">Id -&gt; [Type] -&gt; LHsExpr GhcTc
</span><a href="GHC.Hs.Utils.html#nlHsTyApp"><span class="hs-operator hs-var">`nlHsTyApp`</span></a></span><span> </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">HasDebugCallStack =&gt; Type -&gt; Type
Type -&gt; Type
</span><a href="GHC.Core.Type.html#getRuntimeRep"><span class="hs-identifier hs-var">getRuntimeRep</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Id -&gt; Type
</span><a href="GHC.Types.Id.html#idType"><span class="hs-identifier hs-var">idType</span></a></span><span> </span><span class="annot"><span class="annottext">Id
</span><a href="#local-6989586621683117796"><span class="hs-identifier hs-var">id</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-2515"></span><span>                                                      </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">HasDebugCallStack =&gt; Type -&gt; Type
Type -&gt; Type
</span><a href="GHC.Core.Type.html#getRuntimeRep"><span class="hs-identifier hs-var">getRuntimeRep</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="GHC.Tc.Module.html#any_lifted"><span class="hs-identifier hs-var">any_lifted</span></a></span><span>
</span><span id="line-2516"></span><span>                                                      </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Id -&gt; Type
</span><a href="GHC.Types.Id.html#idType"><span class="hs-identifier hs-var">idType</span></a></span><span> </span><span class="annot"><span class="annottext">Id
</span><a href="#local-6989586621683117796"><span class="hs-identifier hs-var">id</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="GHC.Tc.Module.html#any_lifted"><span class="hs-identifier hs-var">any_lifted</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-2517"></span><span>                                          </span><span class="annot"><span class="annottext">LHsExpr GhcTc -&gt; LHsExpr GhcTc -&gt; LHsExpr GhcTc
forall (id :: Pass).
IsPass id =&gt;
LHsExpr (GhcPass id)
-&gt; LHsExpr (GhcPass id) -&gt; LHsExpr (GhcPass id)
</span><a href="GHC.Hs.Utils.html#nlHsApp"><span class="hs-operator hs-var">`nlHsApp`</span></a></span><span> </span><span class="annot"><span class="annottext">IdP GhcTc -&gt; LHsExpr GhcTc
forall (p :: Pass) a.
IsSrcSpanAnn p a =&gt;
IdP (GhcPass p) -&gt; LHsExpr (GhcPass p)
</span><a href="GHC.Hs.Utils.html#nlHsVar"><span class="hs-identifier hs-var">nlHsVar</span></a></span><span> </span><span class="annot"><span class="annottext">IdP GhcTc
Id
</span><a href="#local-6989586621683117796"><span class="hs-identifier hs-var">id</span></a></span><span>
</span><span id="line-2518"></span><span>            </span><span id="local-6989586621683117798"><span class="annot"><a href="#local-6989586621683117798"><span class="hs-identifier hs-var hs-var">stmts</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[LStmt GhcTc (GenLocated SrcSpanAnnA (HsExpr GhcTc))]
[GenLocated
   SrcSpanAnnA (Stmt GhcTc (GenLocated SrcSpanAnnA (HsExpr GhcTc)))]
</span><a href="#local-6989586621683117784"><span class="hs-identifier hs-var">tc_stmts</span></a></span><span> </span><span class="annot"><span class="annottext">[GenLocated
   SrcSpanAnnA (Stmt GhcTc (GenLocated SrcSpanAnnA (HsExpr GhcTc)))]
-&gt; [GenLocated
      SrcSpanAnnA (Stmt GhcTc (GenLocated SrcSpanAnnA (HsExpr GhcTc)))]
-&gt; [GenLocated
      SrcSpanAnnA (Stmt GhcTc (GenLocated SrcSpanAnnA (HsExpr GhcTc)))]
forall a. [a] -&gt; [a] -&gt; [a]
</span><span class="hs-operator hs-var">++</span></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">Stmt GhcTc (GenLocated SrcSpanAnnA (HsExpr GhcTc))
-&gt; GenLocated
     SrcSpanAnnA (Stmt GhcTc (GenLocated SrcSpanAnnA (HsExpr GhcTc)))
forall e a. HasAnnotation e =&gt; a -&gt; GenLocated e a
</span><a href="GHC.Parser.Annotation.html#noLocA"><span class="hs-identifier hs-var">noLocA</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">GenLocated SrcSpanAnnA (HsExpr GhcTc)
-&gt; Stmt GhcTc (GenLocated SrcSpanAnnA (HsExpr GhcTc))
forall (idR :: Pass) (bodyR :: * -&gt; *) (idL :: Pass).
IsPass idR =&gt;
LocatedA (bodyR (GhcPass idR))
-&gt; StmtLR
     (GhcPass idL) (GhcPass idR) (LocatedA (bodyR (GhcPass idR)))
</span><a href="GHC.Hs.Utils.html#mkLastStmt"><span class="hs-identifier hs-var">mkLastStmt</span></a></span><span> </span><span class="annot"><span class="annottext">LHsExpr GhcTc
GenLocated SrcSpanAnnA (HsExpr GhcTc)
</span><a href="#local-6989586621683117792"><span class="hs-identifier hs-var">ret_expr</span></a></span><span class="hs-special">)</span><span class="hs-special">]</span><span>
</span><span id="line-2519"></span><span>
</span><span id="line-2520"></span><span>      </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">return</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621683117785"><span class="hs-identifier hs-type">ids</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Hs.Utils.html#mkHsDictLet"><span class="hs-identifier hs-type">mkHsDictLet</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Tc.Types.Evidence.html#EvBinds"><span class="hs-identifier hs-type">EvBinds</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683117787"><span class="hs-identifier hs-type">const_binds</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span>
</span><span id="line-2521"></span><span>                     </span><span class="annot"><a href="GHC.Parser.Annotation.html#noLocA"><span class="hs-identifier hs-type">noLocA</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Language.Haskell.Syntax.Expr.html#HsDo"><span class="hs-identifier hs-type">HsDo</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683117777"><span class="hs-identifier hs-type">io_ret_ty</span></a></span><span> </span><span class="annot"><a href="Language.Haskell.Syntax.Expr.html#GhciStmtCtxt"><span class="hs-identifier hs-type">GhciStmtCtxt</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Parser.Annotation.html#noLocA"><span class="hs-identifier hs-type">noLocA</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683117798"><span class="hs-identifier hs-type">stmts</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-2522"></span><span>    </span><span class="hs-special">}</span><span>
</span><span id="line-2523"></span><span>
</span><span id="line-2524"></span><span class="annot"><span class="hs-comment">-- | Generate a typed ghciStepIO expression (ghciStep :: Ty a -&gt; IO a)</span></span><span>
</span><span id="line-2525"></span><span class="annot"><a href="GHC.Tc.Module.html#getGhciStepIO"><span class="hs-identifier hs-type">getGhciStepIO</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#TcM"><span class="hs-identifier hs-type">TcM</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Language.Haskell.Syntax.Expr.html#LHsExpr"><span class="hs-identifier hs-type">LHsExpr</span></a></span><span> </span><span class="annot"><a href="GHC.Hs.Extension.html#GhcRn"><span class="hs-identifier hs-type">GhcRn</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-2526"></span><span id="getGhciStepIO"><span class="annot"><span class="annottext">getGhciStepIO :: TcM (LHsExpr (GhcPass 'Renamed))
</span><a href="GHC.Tc.Module.html#getGhciStepIO"><span class="hs-identifier hs-var hs-var">getGhciStepIO</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-2527"></span><span>    </span><span id="local-6989586621683117802"><span class="annot"><a href="#local-6989586621683117802"><span class="hs-identifier hs-var">ghciTy</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">TcRn Name
</span><a href="GHC.Tc.Utils.Monad.html#getGHCiMonad"><span class="hs-identifier hs-var">getGHCiMonad</span></a></span><span>
</span><span id="line-2528"></span><span>    </span><span id="local-6989586621683117804"><span class="annot"><a href="#local-6989586621683117804"><span class="hs-identifier hs-var">a_tv</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.Monad.html#newName"><span class="hs-identifier hs-type">newName</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Types.Name.Occurrence.html#mkTyVarOccFS"><span class="hs-identifier hs-type">mkTyVarOccFS</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Data.FastString.html#fsLit"><span class="hs-identifier hs-type">fsLit</span></a></span><span> </span><span class="annot"><span class="hs-string">&quot;a&quot;</span></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-2529"></span><span>    </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621683117807"><span class="annot"><a href="#local-6989586621683117807"><span class="hs-identifier hs-var hs-var">ghciM</span></a></span></span><span>   </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">LHsType (GhcPass 'Renamed)
-&gt; LHsType (GhcPass 'Renamed) -&gt; LHsType (GhcPass 'Renamed)
forall (p :: Pass).
LHsType (GhcPass p) -&gt; LHsType (GhcPass p) -&gt; LHsType (GhcPass p)
</span><a href="GHC.Hs.Utils.html#nlHsAppTy"><span class="hs-identifier hs-var">nlHsAppTy</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">PromotionFlag
-&gt; IdP (GhcPass 'Renamed) -&gt; LHsType (GhcPass 'Renamed)
forall (p :: Pass) a.
IsSrcSpanAnn p a =&gt;
PromotionFlag -&gt; IdP (GhcPass p) -&gt; LHsType (GhcPass p)
</span><a href="GHC.Hs.Utils.html#nlHsTyVar"><span class="hs-identifier hs-var">nlHsTyVar</span></a></span><span> </span><span class="annot"><span class="annottext">PromotionFlag
</span><a href="Language.Haskell.Syntax.Type.html#NotPromoted"><span class="hs-identifier hs-var">NotPromoted</span></a></span><span> </span><span class="annot"><span class="annottext">IdP (GhcPass 'Renamed)
Name
</span><a href="#local-6989586621683117802"><span class="hs-identifier hs-var">ghciTy</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">PromotionFlag
-&gt; IdP (GhcPass 'Renamed) -&gt; LHsType (GhcPass 'Renamed)
forall (p :: Pass) a.
IsSrcSpanAnn p a =&gt;
PromotionFlag -&gt; IdP (GhcPass p) -&gt; LHsType (GhcPass p)
</span><a href="GHC.Hs.Utils.html#nlHsTyVar"><span class="hs-identifier hs-var">nlHsTyVar</span></a></span><span> </span><span class="annot"><span class="annottext">PromotionFlag
</span><a href="Language.Haskell.Syntax.Type.html#NotPromoted"><span class="hs-identifier hs-var">NotPromoted</span></a></span><span> </span><span class="annot"><span class="annottext">IdP (GhcPass 'Renamed)
Name
</span><a href="#local-6989586621683117804"><span class="hs-identifier hs-var">a_tv</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-2530"></span><span>        </span><span id="local-6989586621683117811"><span class="annot"><a href="#local-6989586621683117811"><span class="hs-identifier hs-var hs-var">ioM</span></a></span></span><span>     </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">LHsType (GhcPass 'Renamed)
-&gt; LHsType (GhcPass 'Renamed) -&gt; LHsType (GhcPass 'Renamed)
forall (p :: Pass).
LHsType (GhcPass p) -&gt; LHsType (GhcPass p) -&gt; LHsType (GhcPass p)
</span><a href="GHC.Hs.Utils.html#nlHsAppTy"><span class="hs-identifier hs-var">nlHsAppTy</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">PromotionFlag
-&gt; IdP (GhcPass 'Renamed) -&gt; LHsType (GhcPass 'Renamed)
forall (p :: Pass) a.
IsSrcSpanAnn p a =&gt;
PromotionFlag -&gt; IdP (GhcPass p) -&gt; LHsType (GhcPass p)
</span><a href="GHC.Hs.Utils.html#nlHsTyVar"><span class="hs-identifier hs-var">nlHsTyVar</span></a></span><span> </span><span class="annot"><span class="annottext">PromotionFlag
</span><a href="Language.Haskell.Syntax.Type.html#NotPromoted"><span class="hs-identifier hs-var">NotPromoted</span></a></span><span> </span><span class="annot"><span class="annottext">IdP (GhcPass 'Renamed)
Name
</span><a href="GHC.Builtin.Names.html#ioTyConName"><span class="hs-identifier hs-var">ioTyConName</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">PromotionFlag
-&gt; IdP (GhcPass 'Renamed) -&gt; LHsType (GhcPass 'Renamed)
forall (p :: Pass) a.
IsSrcSpanAnn p a =&gt;
PromotionFlag -&gt; IdP (GhcPass p) -&gt; LHsType (GhcPass p)
</span><a href="GHC.Hs.Utils.html#nlHsTyVar"><span class="hs-identifier hs-var">nlHsTyVar</span></a></span><span> </span><span class="annot"><span class="annottext">PromotionFlag
</span><a href="Language.Haskell.Syntax.Type.html#NotPromoted"><span class="hs-identifier hs-var">NotPromoted</span></a></span><span> </span><span class="annot"><span class="annottext">IdP (GhcPass 'Renamed)
Name
</span><a href="#local-6989586621683117804"><span class="hs-identifier hs-var">a_tv</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-2531"></span><span>
</span><span id="line-2532"></span><span>        </span><span class="annot"><a href="#local-6989586621683117812"><span class="hs-identifier hs-type">step_ty</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Language.Haskell.Syntax.Type.html#LHsSigType"><span class="hs-identifier hs-type">LHsSigType</span></a></span><span> </span><span class="annot"><a href="GHC.Hs.Extension.html#GhcRn"><span class="hs-identifier hs-type">GhcRn</span></a></span><span>
</span><span id="line-2533"></span><span>        </span><span id="local-6989586621683117812"><span class="annot"><a href="#local-6989586621683117812"><span class="hs-identifier hs-var hs-var">step_ty</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">HsSigType (GhcPass 'Renamed)
-&gt; GenLocated SrcSpanAnnA (HsSigType (GhcPass 'Renamed))
forall e a. HasAnnotation e =&gt; a -&gt; GenLocated e a
</span><a href="GHC.Parser.Annotation.html#noLocA"><span class="hs-identifier hs-var">noLocA</span></a></span><span> </span><span class="annot"><span class="annottext">(HsSigType (GhcPass 'Renamed)
 -&gt; GenLocated SrcSpanAnnA (HsSigType (GhcPass 'Renamed)))
-&gt; HsSigType (GhcPass 'Renamed)
-&gt; GenLocated SrcSpanAnnA (HsSigType (GhcPass 'Renamed))
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><a href="Language.Haskell.Syntax.Type.html#HsSig"><span class="hs-identifier hs-type">HsSig</span></a></span><span>
</span><span id="line-2534"></span><span>                     </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">sig_bndrs :: HsOuterSigTyVarBndrs (GhcPass 'Renamed)
</span><a href="Language.Haskell.Syntax.Type.html#sig_bndrs"><span class="hs-identifier hs-var">sig_bndrs</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="Language.Haskell.Syntax.Type.html#HsOuterImplicit"><span class="hs-identifier hs-type">HsOuterImplicit</span></a></span><span class="hs-special">{</span><span class="annot"><span class="annottext">hso_ximplicit :: XHsOuterImplicit (GhcPass 'Renamed)
</span><a href="Language.Haskell.Syntax.Type.html#hso_ximplicit"><span class="hs-identifier hs-var">hso_ximplicit</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621683117804"><span class="hs-identifier hs-var">a_tv</span></a></span><span class="hs-special">]</span><span class="hs-special">}</span><span>
</span><span id="line-2535"></span><span>                     </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">sig_ext :: XHsSig (GhcPass 'Renamed)
</span><a href="Language.Haskell.Syntax.Type.html#sig_ext"><span class="hs-identifier hs-var">sig_ext</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">XHsSig (GhcPass 'Renamed)
NoExtField
</span><a href="Language.Haskell.Syntax.Extension.html#noExtField"><span class="hs-identifier hs-var">noExtField</span></a></span><span>
</span><span id="line-2536"></span><span>                     </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">sig_body :: LHsType (GhcPass 'Renamed)
</span><a href="Language.Haskell.Syntax.Type.html#sig_body"><span class="hs-identifier hs-var">sig_body</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">LHsType (GhcPass 'Renamed)
-&gt; LHsType (GhcPass 'Renamed) -&gt; LHsType (GhcPass 'Renamed)
forall (p :: Pass).
IsPass p =&gt;
LHsType (GhcPass p) -&gt; LHsType (GhcPass p) -&gt; LHsType (GhcPass p)
</span><a href="GHC.Hs.Utils.html#nlHsFunTy"><span class="hs-identifier hs-var">nlHsFunTy</span></a></span><span> </span><span class="annot"><span class="annottext">LHsType (GhcPass 'Renamed)
</span><a href="#local-6989586621683117807"><span class="hs-identifier hs-var">ghciM</span></a></span><span> </span><span class="annot"><span class="annottext">LHsType (GhcPass 'Renamed)
</span><a href="#local-6989586621683117811"><span class="hs-identifier hs-var">ioM</span></a></span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-2537"></span><span>
</span><span id="line-2538"></span><span>        </span><span class="annot"><a href="#local-6989586621683117820"><span class="hs-identifier hs-type">stepTy</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Language.Haskell.Syntax.Type.html#LHsSigWcType"><span class="hs-identifier hs-type">LHsSigWcType</span></a></span><span> </span><span class="annot"><a href="GHC.Hs.Extension.html#GhcRn"><span class="hs-identifier hs-type">GhcRn</span></a></span><span>
</span><span id="line-2539"></span><span>        </span><span id="local-6989586621683117820"><span class="annot"><a href="#local-6989586621683117820"><span class="hs-identifier hs-var hs-var">stepTy</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">GenLocated SrcSpanAnnA (HsSigType (GhcPass 'Renamed))
-&gt; HsWildCardBndrs
     (GhcPass 'Renamed)
     (GenLocated SrcSpanAnnA (HsSigType (GhcPass 'Renamed)))
forall thing. thing -&gt; HsWildCardBndrs (GhcPass 'Renamed) thing
</span><a href="GHC.Hs.Type.html#mkEmptyWildCardBndrs"><span class="hs-identifier hs-var">mkEmptyWildCardBndrs</span></a></span><span> </span><span class="annot"><span class="annottext">LHsSigType (GhcPass 'Renamed)
GenLocated SrcSpanAnnA (HsSigType (GhcPass 'Renamed))
</span><a href="#local-6989586621683117812"><span class="hs-identifier hs-var">step_ty</span></a></span><span>
</span><span id="line-2540"></span><span>
</span><span id="line-2541"></span><span>    </span><span class="annot"><span class="hs-identifier hs-type">return</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Parser.Annotation.html#noLocA"><span class="hs-identifier hs-type">noLocA</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="annot"><a href="Language.Haskell.Syntax.Expr.html#ExprWithTySig"><span class="hs-identifier hs-type">ExprWithTySig</span></a></span><span> </span><span class="annot"><a href="Language.Haskell.Syntax.Extension.html#noExtField"><span class="hs-identifier hs-type">noExtField</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Hs.Utils.html#nlHsVar"><span class="hs-identifier hs-type">nlHsVar</span></a></span><span> </span><span class="annot"><a href="GHC.Builtin.Names.html#ghciStepIoMName"><span class="hs-identifier hs-type">ghciStepIoMName</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><a href="#local-6989586621683117820"><span class="hs-identifier hs-type">stepTy</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-2542"></span><span>
</span><span id="line-2543"></span><span class="annot"><a href="GHC.Tc.Module.html#isGHCiMonad"><span class="hs-identifier hs-type">isGHCiMonad</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Driver.Env.Types.html#HscEnv"><span class="hs-identifier hs-type">HscEnv</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">String</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Types.Error.html#Messages"><span class="hs-identifier hs-type">Messages</span></a></span><span> </span><span class="annot"><a href="GHC.Tc.Errors.Types.html#TcRnMessage"><span class="hs-identifier hs-type">TcRnMessage</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Maybe</span></span><span> </span><span class="annot"><a href="GHC.Types.Name.html#Name"><span class="hs-identifier hs-type">Name</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-2544"></span><span id="isGHCiMonad"><span class="annot"><span class="annottext">isGHCiMonad :: HscEnv -&gt; String -&gt; IO (Messages TcRnMessage, Maybe Name)
</span><a href="GHC.Tc.Module.html#isGHCiMonad"><span class="hs-identifier hs-var hs-var">isGHCiMonad</span></a></span></span><span> </span><span id="local-6989586621683117824"><span class="annot"><span class="annottext">HscEnv
</span><a href="#local-6989586621683117824"><span class="hs-identifier hs-var">hsc_env</span></a></span></span><span> </span><span id="local-6989586621683117825"><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621683117825"><span class="hs-identifier hs-var">ty</span></a></span></span><span>
</span><span id="line-2545"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">HscEnv -&gt; TcRn Name -&gt; IO (Messages TcRnMessage, Maybe Name)
forall a. HscEnv -&gt; TcRn a -&gt; IO (Messages TcRnMessage, Maybe a)
</span><a href="GHC.Tc.Module.html#runTcInteractive"><span class="hs-identifier hs-var">runTcInteractive</span></a></span><span> </span><span class="annot"><span class="annottext">HscEnv
</span><a href="#local-6989586621683117824"><span class="hs-identifier hs-var">hsc_env</span></a></span><span> </span><span class="annot"><span class="annottext">(TcRn Name -&gt; IO (Messages TcRnMessage, Maybe Name))
-&gt; TcRn Name -&gt; IO (Messages TcRnMessage, Maybe Name)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-2546"></span><span>        </span><span id="local-6989586621683117826"><span class="annot"><a href="#local-6989586621683117826"><span class="hs-identifier hs-var">rdrEnv</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">TcRn GlobalRdrEnv
</span><a href="GHC.Tc.Utils.Monad.html#getGlobalRdrEnv"><span class="hs-identifier hs-var">getGlobalRdrEnv</span></a></span><span>
</span><span id="line-2547"></span><span>        </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621683117827"><span class="annot"><a href="#local-6989586621683117827"><span class="hs-identifier hs-var hs-var">occIO</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">GlobalRdrEnv -&gt; OccName -&gt; Maybe [GlobalRdrElt]
forall a. OccEnv a -&gt; OccName -&gt; Maybe a
</span><a href="GHC.Types.Name.Occurrence.html#lookupOccEnv"><span class="hs-identifier hs-var">lookupOccEnv</span></a></span><span> </span><span class="annot"><span class="annottext">GlobalRdrEnv
</span><a href="#local-6989586621683117826"><span class="hs-identifier hs-var">rdrEnv</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">NameSpace -&gt; String -&gt; OccName
</span><a href="GHC.Types.Name.Occurrence.html#mkOccName"><span class="hs-identifier hs-var">mkOccName</span></a></span><span> </span><span class="annot"><span class="annottext">NameSpace
</span><a href="GHC.Types.Name.Occurrence.html#tcName"><span class="hs-identifier hs-var">tcName</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621683117825"><span class="hs-identifier hs-var">ty</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-2548"></span><span>        </span><span class="hs-keyword">case</span><span> </span><span class="annot"><a href="#local-6989586621683117827"><span class="hs-identifier hs-type">occIO</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-2549"></span><span>            </span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span class="hs-special">[</span><span id="local-6989586621683117831"><span class="annot"><span class="annottext">GlobalRdrElt
</span><a href="#local-6989586621683117831"><span class="hs-identifier hs-var">n</span></a></span></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-2550"></span><span>                </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621683117832"><span class="annot"><span class="annottext">name :: Name
</span><a href="#local-6989586621683117832"><span class="hs-identifier hs-var hs-var hs-var">name</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">GlobalRdrElt -&gt; Name
forall info. GlobalRdrEltX info -&gt; Name
</span><a href="GHC.Types.Name.Reader.html#greName"><span class="hs-identifier hs-var">greName</span></a></span><span> </span><span class="annot"><span class="annottext">GlobalRdrElt
</span><a href="#local-6989586621683117831"><span class="hs-identifier hs-var">n</span></a></span><span>
</span><span id="line-2551"></span><span>                </span><span id="local-6989586621683117833"><span class="annot"><a href="#local-6989586621683117833"><span class="hs-identifier hs-var">ghciClass</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Name -&gt; TcM Class
</span><a href="GHC.Tc.Utils.Env.html#tcLookupClass"><span class="hs-identifier hs-var">tcLookupClass</span></a></span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="GHC.Builtin.Names.html#ghciIoClassName"><span class="hs-identifier hs-var">ghciIoClassName</span></a></span><span>
</span><span id="line-2552"></span><span>                </span><span id="local-6989586621683117836"><span class="annot"><a href="#local-6989586621683117836"><span class="hs-identifier hs-var">userTyCon</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.Env.html#tcLookupTyCon"><span class="hs-identifier hs-type">tcLookupTyCon</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683117832"><span class="hs-identifier hs-type">name</span></a></span><span>
</span><span id="line-2553"></span><span>                </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621683117837"><span class="annot"><a href="#local-6989586621683117837"><span class="hs-identifier hs-var hs-var">userTy</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">TyCon -&gt; [Type] -&gt; Type
</span><a href="GHC.Core.Type.html#mkTyConApp"><span class="hs-identifier hs-var">mkTyConApp</span></a></span><span> </span><span class="annot"><span class="annottext">TyCon
</span><a href="#local-6989586621683117836"><span class="hs-identifier hs-var">userTyCon</span></a></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span>
</span><span id="line-2554"></span><span>                </span><span class="annot"><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.Env.html#tcLookupInstance"><span class="hs-identifier hs-type">tcLookupInstance</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683117833"><span class="hs-identifier hs-type">ghciClass</span></a></span><span> </span><span class="hs-special">[</span><span class="annot"><a href="#local-6989586621683117837"><span class="hs-identifier hs-type">userTy</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-2555"></span><span>                </span><span class="annot"><span class="hs-identifier hs-type">return</span></span><span> </span><span class="annot"><a href="#local-6989586621683117832"><span class="hs-identifier hs-type">name</span></a></span><span>
</span><span id="line-2556"></span><span>            </span><span class="annot"><span class="annottext">Maybe [GlobalRdrElt]
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">TcRnMessage -&gt; TcRn Name
forall a. TcRnMessage -&gt; TcM a
</span><a href="GHC.Tc.Utils.Monad.html#failWithTc"><span class="hs-identifier hs-var">failWithTc</span></a></span><span> </span><span class="annot"><span class="annottext">(TcRnMessage -&gt; TcRn Name) -&gt; TcRnMessage -&gt; TcRn Name
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">String -&gt; Maybe [GlobalRdrElt] -&gt; TcRnMessage
</span><a href="GHC.Tc.Errors.Types.html#TcRnGhciMonadLookupFail"><span class="hs-identifier hs-var">TcRnGhciMonadLookupFail</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621683117825"><span class="hs-identifier hs-var">ty</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe [GlobalRdrElt]
</span><a href="#local-6989586621683117827"><span class="hs-identifier hs-var">occIO</span></a></span><span>
</span><span id="line-2557"></span><span>
</span><span id="line-2558"></span><span class="annot"><span class="hs-comment">-- | How should we infer a type? See Note [TcRnExprMode]</span></span><span>
</span><span id="line-2559"></span><span class="hs-keyword">data</span><span> </span><span id="TcRnExprMode"><span class="annot"><a href="GHC.Tc.Module.html#TcRnExprMode"><span class="hs-identifier hs-var">TcRnExprMode</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="TM_Inst"><span class="annot"><a href="GHC.Tc.Module.html#TM_Inst"><span class="hs-identifier hs-var">TM_Inst</span></a></span></span><span>     </span><span class="annot"><span class="hs-comment">-- ^ Instantiate inferred quantifiers only (:type)</span></span><span>
</span><span id="line-2560"></span><span>                  </span><span class="hs-glyph">|</span><span> </span><span id="TM_Default"><span class="annot"><a href="GHC.Tc.Module.html#TM_Default"><span class="hs-identifier hs-var">TM_Default</span></a></span></span><span>  </span><span class="hs-comment">-- ^ Instantiate all quantifiers,</span><span>
</span><span id="line-2561"></span><span>                                </span><span class="hs-comment">--   and do eager defaulting (:type +d)</span><span>
</span><span id="line-2562"></span><span>
</span><span id="line-2563"></span><span class="hs-comment">-- | tcRnExpr just finds the type of an expression</span><span>
</span><span id="line-2564"></span><span class="hs-comment">--   for :type</span><span>
</span><span id="line-2565"></span><span class="annot"><a href="GHC.Tc.Module.html#tcRnExpr"><span class="hs-identifier hs-type">tcRnExpr</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Driver.Env.Types.html#HscEnv"><span class="hs-identifier hs-type">HscEnv</span></a></span><span>
</span><span id="line-2566"></span><span>         </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Module.html#TcRnExprMode"><span class="hs-identifier hs-type">TcRnExprMode</span></a></span><span>
</span><span id="line-2567"></span><span>         </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Language.Haskell.Syntax.Expr.html#LHsExpr"><span class="hs-identifier hs-type">LHsExpr</span></a></span><span> </span><span class="annot"><a href="GHC.Hs.Extension.html#GhcPs"><span class="hs-identifier hs-type">GhcPs</span></a></span><span>
</span><span id="line-2568"></span><span>         </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Types.Error.html#Messages"><span class="hs-identifier hs-type">Messages</span></a></span><span> </span><span class="annot"><a href="GHC.Tc.Errors.Types.html#TcRnMessage"><span class="hs-identifier hs-type">TcRnMessage</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Maybe</span></span><span> </span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#Type"><span class="hs-identifier hs-type">Type</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-2569"></span><span id="tcRnExpr"><span class="annot"><span class="annottext">tcRnExpr :: HscEnv
-&gt; TcRnExprMode
-&gt; LHsExpr GhcPs
-&gt; IO (Messages TcRnMessage, Maybe Type)
</span><a href="GHC.Tc.Module.html#tcRnExpr"><span class="hs-identifier hs-var hs-var">tcRnExpr</span></a></span></span><span> </span><span id="local-6989586621683117843"><span class="annot"><span class="annottext">HscEnv
</span><a href="#local-6989586621683117843"><span class="hs-identifier hs-var">hsc_env</span></a></span></span><span> </span><span id="local-6989586621683117844"><span class="annot"><span class="annottext">TcRnExprMode
</span><a href="#local-6989586621683117844"><span class="hs-identifier hs-var">mode</span></a></span></span><span> </span><span id="local-6989586621683117845"><span class="annot"><span class="annottext">LHsExpr GhcPs
</span><a href="#local-6989586621683117845"><span class="hs-identifier hs-var">rdr_expr</span></a></span></span><span>
</span><span id="line-2570"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">HscEnv -&gt; TcM Type -&gt; IO (Messages TcRnMessage, Maybe Type)
forall a. HscEnv -&gt; TcRn a -&gt; IO (Messages TcRnMessage, Maybe a)
</span><a href="GHC.Tc.Module.html#runTcInteractive"><span class="hs-identifier hs-var">runTcInteractive</span></a></span><span> </span><span class="annot"><span class="annottext">HscEnv
</span><a href="#local-6989586621683117843"><span class="hs-identifier hs-var">hsc_env</span></a></span><span> </span><span class="annot"><span class="annottext">(TcM Type -&gt; IO (Messages TcRnMessage, Maybe Type))
-&gt; TcM Type -&gt; IO (Messages TcRnMessage, Maybe Type)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-2571"></span><span>    </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span>
</span><span id="line-2572"></span><span>
</span><span id="line-2573"></span><span>    </span><span class="hs-special">(</span><span id="local-6989586621683117846"><span class="annot"><a href="#local-6989586621683117846"><span class="hs-identifier hs-var">rn_expr</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621683117847"><span class="annot"><a href="#local-6989586621683117847"><span class="hs-identifier hs-var">_fvs</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">LHsExpr GhcPs -&gt; RnM (LHsExpr (GhcPass 'Renamed), FreeVars)
</span><a href="GHC.Rename.Expr.html#rnLExpr"><span class="hs-identifier hs-var">rnLExpr</span></a></span><span> </span><span class="annot"><span class="annottext">LHsExpr GhcPs
</span><a href="#local-6989586621683117845"><span class="hs-identifier hs-var">rdr_expr</span></a></span><span> </span><span class="hs-special">;</span><span>
</span><span id="line-2574"></span><span>    </span><span class="annot"><a href="GHC.Tc.Utils.Monad.html#failIfErrsM"><span class="hs-identifier hs-type">failIfErrsM</span></a></span><span> </span><span class="hs-special">;</span><span>
</span><span id="line-2575"></span><span>
</span><span id="line-2576"></span><span>    </span><span class="hs-comment">-- Typecheck the expression</span><span>
</span><span id="line-2577"></span><span>    </span><span class="hs-special">(</span><span class="hs-special">(</span><span id="local-6989586621683117848"><span class="annot"><a href="#local-6989586621683117848"><span class="hs-identifier hs-var">tclvl</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621683117849"><span class="annot"><a href="#local-6989586621683117849"><span class="hs-identifier hs-var">res_ty</span></a></span></span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span id="local-6989586621683117850"><span class="annot"><a href="#local-6989586621683117850"><span class="hs-identifier hs-var">lie</span></a></span></span><span class="hs-special">)</span><span>
</span><span id="line-2578"></span><span>          </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><a href="GHC.Tc.Solver.html#captureTopConstraints"><span class="hs-identifier hs-type">captureTopConstraints</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span>
</span><span id="line-2579"></span><span>             </span><span class="annot"><a href="GHC.Tc.Utils.Monad.html#pushTcLevelM"><span class="hs-identifier hs-type">pushTcLevelM</span></a></span><span>          </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span>
</span><span id="line-2580"></span><span>             </span><span class="annot"><a href="GHC.Tc.Gen.App.html#tcInferSigma"><span class="hs-identifier hs-type">tcInferSigma</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683117852"><span class="hs-identifier hs-type">inst</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683117846"><span class="hs-identifier hs-type">rn_expr</span></a></span><span> </span><span class="hs-special">;</span><span>
</span><span id="line-2581"></span><span>
</span><span id="line-2582"></span><span>    </span><span class="hs-comment">-- Generalise</span><span>
</span><span id="line-2583"></span><span>    </span><span id="local-6989586621683117853"><span class="annot"><a href="#local-6989586621683117853"><span class="hs-identifier hs-var">uniq</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.Monad.html#newUnique"><span class="hs-identifier hs-type">newUnique</span></a></span><span> </span><span class="hs-special">;</span><span>
</span><span id="line-2584"></span><span>    </span><span class="hs-keyword">let</span><span> </span><span class="hs-special">{</span><span> </span><span id="local-6989586621683117854"><span class="annot"><a href="#local-6989586621683117854"><span class="hs-identifier hs-var hs-var">fresh_it</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Unique -&gt; SrcSpan -&gt; Name
</span><a href="GHC.Builtin.Names.html#itName"><span class="hs-identifier hs-var">itName</span></a></span><span> </span><span class="annot"><span class="annottext">Unique
</span><a href="#local-6989586621683117853"><span class="hs-identifier hs-var">uniq</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">GenLocated SrcSpanAnnA (HsExpr GhcPs) -&gt; SrcSpan
forall a e. HasLoc a =&gt; GenLocated a e -&gt; SrcSpan
</span><a href="GHC.Parser.Annotation.html#getLocA"><span class="hs-identifier hs-var">getLocA</span></a></span><span> </span><span class="annot"><span class="annottext">LHsExpr GhcPs
GenLocated SrcSpanAnnA (HsExpr GhcPs)
</span><a href="#local-6989586621683117845"><span class="hs-identifier hs-var">rdr_expr</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span> </span><span class="hs-special">;</span><span>
</span><span id="line-2585"></span><span>    </span><span class="hs-special">(</span><span class="hs-special">(</span><span id="local-6989586621683117856"><span class="annot"><a href="#local-6989586621683117856"><span class="hs-identifier hs-var">qtvs</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621683117857"><span class="annot"><a href="#local-6989586621683117857"><span class="hs-identifier hs-var">dicts</span></a></span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">_</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span id="local-6989586621683117858"><span class="annot"><a href="#local-6989586621683117858"><span class="hs-identifier hs-var">residual</span></a></span></span><span class="hs-special">)</span><span>
</span><span id="line-2586"></span><span>         </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.Monad.html#captureConstraints"><span class="hs-identifier hs-type">captureConstraints</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span>
</span><span id="line-2587"></span><span>            </span><span class="annot"><a href="GHC.Tc.Solver.html#simplifyInfer"><span class="hs-identifier hs-type">simplifyInfer</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683117848"><span class="hs-identifier hs-type">tclvl</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683117861"><span class="hs-identifier hs-type">infer_mode</span></a></span><span>
</span><span id="line-2588"></span><span>                          </span><span class="hs-special">[</span><span class="hs-special">]</span><span>    </span><span class="hs-comment">{- No sig vars -}</span><span>
</span><span id="line-2589"></span><span>                          </span><span class="hs-special">[</span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621683117854"><span class="hs-identifier hs-type">fresh_it</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="#local-6989586621683117849"><span class="hs-identifier hs-type">res_ty</span></a></span><span class="hs-special">)</span><span class="hs-special">]</span><span>
</span><span id="line-2590"></span><span>                          </span><span class="annot"><a href="#local-6989586621683117850"><span class="hs-identifier hs-type">lie</span></a></span><span> </span><span class="hs-special">;</span><span>
</span><span id="line-2591"></span><span>
</span><span id="line-2592"></span><span>    </span><span class="hs-comment">-- Ignore the dictionary bindings</span><span>
</span><span id="line-2593"></span><span>    </span><span class="annot"><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><a href="#local-6989586621683117862"><span class="hs-identifier hs-type">perhaps_disable_default_warnings</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span>
</span><span id="line-2594"></span><span>         </span><span class="annot"><a href="GHC.Tc.Solver.html#simplifyInteractive"><span class="hs-identifier hs-type">simplifyInteractive</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683117858"><span class="hs-identifier hs-type">residual</span></a></span><span> </span><span class="hs-special">;</span><span>
</span><span id="line-2595"></span><span>
</span><span id="line-2596"></span><span>    </span><span class="hs-keyword">let</span><span> </span><span class="hs-special">{</span><span> </span><span id="local-6989586621683117863"><span class="annot"><a href="#local-6989586621683117863"><span class="hs-identifier hs-var hs-var">all_expr_ty</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[Id] -&gt; Type -&gt; Type
</span><a href="GHC.Core.Type.html#mkInfForAllTys"><span class="hs-identifier hs-var">mkInfForAllTys</span></a></span><span> </span><span class="annot"><span class="annottext">[Id]
</span><a href="#local-6989586621683117856"><span class="hs-identifier hs-var">qtvs</span></a></span><span> </span><span class="annot"><span class="annottext">(Type -&gt; Type) -&gt; Type -&gt; Type
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-2597"></span><span>                        </span><span class="annot"><span class="annottext">[Type] -&gt; Type -&gt; Type
HasDebugCallStack =&gt; [Type] -&gt; Type -&gt; Type
</span><a href="GHC.Tc.Utils.TcType.html#mkPhiTy"><span class="hs-identifier hs-var">mkPhiTy</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(Id -&gt; Type) -&gt; [Id] -&gt; [Type]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><span class="hs-identifier hs-var">map</span></span><span> </span><span class="annot"><span class="annottext">Id -&gt; Type
</span><a href="GHC.Types.Id.html#idType"><span class="hs-identifier hs-var">idType</span></a></span><span> </span><span class="annot"><span class="annottext">[Id]
</span><a href="#local-6989586621683117857"><span class="hs-identifier hs-var">dicts</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621683117849"><span class="hs-identifier hs-var">res_ty</span></a></span><span> </span><span class="hs-special">}</span><span> </span><span class="hs-special">;</span><span>
</span><span id="line-2598"></span><span>    </span><span id="local-6989586621683117866"><span class="annot"><a href="#local-6989586621683117866"><span class="hs-identifier hs-var">ty</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.Monad.html#liftZonkM"><span class="hs-identifier hs-type">liftZonkM</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="annot"><a href="GHC.Tc.Zonk.TcType.html#zonkTcType"><span class="hs-identifier hs-type">zonkTcType</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683117863"><span class="hs-identifier hs-type">all_expr_ty</span></a></span><span> </span><span class="hs-special">;</span><span>
</span><span id="line-2599"></span><span>
</span><span id="line-2600"></span><span>    </span><span class="hs-comment">-- See Note [Normalising the type in :type]</span><span>
</span><span id="line-2601"></span><span>    </span><span id="local-6989586621683117867"><span class="annot"><a href="#local-6989586621683117867"><span class="hs-identifier hs-var">fam_envs</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><a href="GHC.Tc.Instance.Family.html#tcGetFamInstEnvs"><span class="hs-identifier hs-type">tcGetFamInstEnvs</span></a></span><span> </span><span class="hs-special">;</span><span>
</span><span id="line-2602"></span><span>    </span><span class="hs-keyword">let</span><span> </span><span class="hs-special">{</span><span> </span><span id="local-6989586621683117869"><span class="annot"><a href="#local-6989586621683117869"><span class="hs-identifier hs-var hs-var">normalised_type</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Reduction -&gt; Type
</span><a href="GHC.Core.Reduction.html#reductionReducedType"><span class="hs-identifier hs-var">reductionReducedType</span></a></span><span> </span><span class="annot"><span class="annottext">(Reduction -&gt; Type) -&gt; Reduction -&gt; Type
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">FamInstEnvs -&gt; Role -&gt; Type -&gt; Reduction
</span><a href="GHC.Core.FamInstEnv.html#normaliseType"><span class="hs-identifier hs-var">normaliseType</span></a></span><span> </span><span class="annot"><span class="annottext">FamInstEnvs
</span><a href="#local-6989586621683117867"><span class="hs-identifier hs-var">fam_envs</span></a></span><span> </span><span class="annot"><span class="annottext">Role
</span><a href="Language.Haskell.Syntax.Basic.html#Nominal"><span class="hs-identifier hs-var">Nominal</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621683117866"><span class="hs-identifier hs-var">ty</span></a></span><span>
</span><span id="line-2603"></span><span>          </span><span class="hs-comment">-- normaliseType returns a coercion which we discard, so the Role is irrelevant.</span><span>
</span><span id="line-2604"></span><span>        </span><span class="hs-special">;</span><span> </span><span id="local-6989586621683117872"><span class="annot"><a href="#local-6989586621683117872"><span class="hs-identifier hs-var hs-var">final_type</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">if</span><span> </span><span class="annot"><span class="annottext">Type -&gt; Bool
</span><a href="GHC.Tc.Utils.TcType.html#isSigmaTy"><span class="hs-identifier hs-var">isSigmaTy</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621683117849"><span class="hs-identifier hs-var">res_ty</span></a></span><span> </span><span class="hs-keyword">then</span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621683117866"><span class="hs-identifier hs-var">ty</span></a></span><span> </span><span class="hs-keyword">else</span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621683117869"><span class="hs-identifier hs-var">normalised_type</span></a></span><span> </span><span class="hs-special">}</span><span> </span><span class="hs-special">;</span><span>
</span><span id="line-2605"></span><span>    </span><span class="annot"><span class="hs-identifier hs-type">return</span></span><span> </span><span class="annot"><a href="#local-6989586621683117872"><span class="hs-identifier hs-type">final_type</span></a></span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-2606"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-2607"></span><span>    </span><span class="hs-comment">-- Optionally instantiate the type of the expression</span><span>
</span><span id="line-2608"></span><span>    </span><span class="hs-comment">-- See Note [TcRnExprMode]</span><span>
</span><span id="line-2609"></span><span>    </span><span class="hs-special">(</span><span id="local-6989586621683117852"><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621683117852"><span class="hs-identifier hs-var">inst</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621683117861"><span class="annot"><span class="annottext">InferMode
</span><a href="#local-6989586621683117861"><span class="hs-identifier hs-var">infer_mode</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621683117862"><span class="annot"><span class="annottext">TcRn (Bag EvBind) -&gt; TcRn (Bag EvBind)
</span><a href="#local-6989586621683117862"><span class="hs-identifier hs-var">perhaps_disable_default_warnings</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">TcRnExprMode
</span><a href="#local-6989586621683117844"><span class="hs-identifier hs-var">mode</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-2610"></span><span>      </span><span class="annot"><span class="annottext">TcRnExprMode
</span><a href="GHC.Tc.Module.html#TM_Inst"><span class="hs-identifier hs-var">TM_Inst</span></a></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">False</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">InferMode
</span><a href="GHC.Tc.Solver.html#NoRestrictions"><span class="hs-identifier hs-var">NoRestrictions</span></a></span><span class="hs-special">,</span><span>  </span><span class="annot"><span class="annottext">TcRn (Bag EvBind) -&gt; TcRn (Bag EvBind)
forall a. a -&gt; a
</span><span class="hs-identifier hs-var">id</span></span><span class="hs-special">)</span><span>
</span><span id="line-2611"></span><span>      </span><span class="annot"><span class="annottext">TcRnExprMode
</span><a href="GHC.Tc.Module.html#TM_Default"><span class="hs-identifier hs-var">TM_Default</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">True</span></span><span class="hs-special">,</span><span>  </span><span class="annot"><span class="annottext">InferMode
</span><a href="GHC.Tc.Solver.html#EagerDefaulting"><span class="hs-identifier hs-var">EagerDefaulting</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">WarningFlag -&gt; TcRn (Bag EvBind) -&gt; TcRn (Bag EvBind)
forall gbl lcl a.
WarningFlag -&gt; TcRnIf gbl lcl a -&gt; TcRnIf gbl lcl a
</span><a href="GHC.Tc.Utils.Monad.html#unsetWOptM"><span class="hs-identifier hs-var">unsetWOptM</span></a></span><span> </span><span class="annot"><span class="annottext">WarningFlag
</span><a href="GHC.Driver.Flags.html#Opt_WarnTypeDefaults"><span class="hs-identifier hs-var">Opt_WarnTypeDefaults</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-2612"></span><span>
</span><span id="line-2613"></span><span class="hs-comment">{- Note [Implementing :type]
~~~~~~~~~~~~~~~~~~~~~~~~~~~~
Consider   :type const

We want    forall a b. a -&gt; b -&gt; a
and not    forall {a}{b}. a -&gt; b -&gt; a

The latter is what we'd get if we eagerly instantiated and then
re-generalised with Inferred binders.  It makes a difference, because
it tells us we where we can use Visible Type Application (VTA).

And also for   :type const @Int
we want        forall b. Int -&gt; b -&gt; Int
and not        forall {b}. Int -&gt; b -&gt; Int

Solution: use tcInferSigma, which in turn uses tcInferApp, which
has a special case for application chains.

Note [Normalising the type in :type]
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
In :t &lt;expr&gt; we usually normalise the type (to simplify type functions)
before displaying the result.  Reason (see #10321): otherwise we may show
types like
    &lt;expr&gt; :: Vec (1+2) Int
rather than the simpler
    &lt;expr&gt; :: Vec 3 Int
In GHC.Tc.Gen.Bind.mkInferredPolyId we normalise for a very similar reason.

However this normalisation is less helpful when &lt;expr&gt; is just
an identifier, whose user-written type happens to contain type-function
applications.  E.g. (#20974)
    test :: F [Monad, A, B] m =&gt; m ()
where F is a type family.  If we say `:t test`, we'd prefer to see
the type family un-expanded.

We adopt the following ad-hoc solution: if the type inferred for &lt;expr&gt;
(before generalisation, namely res_ty) is a SigmaType (i.e. is not
fully instantiated) then do not normalise; otherwise normalise.
This is not ideal; for example, suppose  x :: F Int.  Then
  :t x
would be normalised because `F Int` is not a SigmaType.  But
anything here is ad-hoc, and it's a user-sought improvement.
-}</span><span>
</span><span id="line-2656"></span><span>
</span><span id="line-2657"></span><span class="hs-comment">--------------------------</span><span>
</span><span id="line-2658"></span><span class="annot"><a href="GHC.Tc.Module.html#tcRnImportDecls"><span class="hs-identifier hs-type">tcRnImportDecls</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Driver.Env.Types.html#HscEnv"><span class="hs-identifier hs-type">HscEnv</span></a></span><span>
</span><span id="line-2659"></span><span>                </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="Language.Haskell.Syntax.ImpExp.html#LImportDecl"><span class="hs-identifier hs-type">LImportDecl</span></a></span><span> </span><span class="annot"><a href="GHC.Hs.Extension.html#GhcPs"><span class="hs-identifier hs-type">GhcPs</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-2660"></span><span>                </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Types.Error.html#Messages"><span class="hs-identifier hs-type">Messages</span></a></span><span> </span><span class="annot"><a href="GHC.Tc.Errors.Types.html#TcRnMessage"><span class="hs-identifier hs-type">TcRnMessage</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Maybe</span></span><span> </span><span class="annot"><a href="GHC.Types.Name.Reader.html#GlobalRdrEnv"><span class="hs-identifier hs-type">GlobalRdrEnv</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-2661"></span><span class="hs-comment">-- Find the new chunk of GlobalRdrEnv created by this list of import</span><span>
</span><span id="line-2662"></span><span class="hs-comment">-- decls.  In contract tcRnImports *extends* the TcGblEnv.</span><span>
</span><span id="line-2663"></span><span id="tcRnImportDecls"><span class="annot"><span class="annottext">tcRnImportDecls :: HscEnv
-&gt; [LImportDecl GhcPs]
-&gt; IO (Messages TcRnMessage, Maybe GlobalRdrEnv)
</span><a href="GHC.Tc.Module.html#tcRnImportDecls"><span class="hs-identifier hs-var hs-var">tcRnImportDecls</span></a></span></span><span> </span><span id="local-6989586621683117877"><span class="annot"><span class="annottext">HscEnv
</span><a href="#local-6989586621683117877"><span class="hs-identifier hs-var">hsc_env</span></a></span></span><span> </span><span id="local-6989586621683117878"><span class="annot"><span class="annottext">[LImportDecl GhcPs]
</span><a href="#local-6989586621683117878"><span class="hs-identifier hs-var">import_decls</span></a></span></span><span>
</span><span id="line-2664"></span><span> </span><span class="hs-glyph">=</span><span>  </span><span class="annot"><span class="annottext">HscEnv
-&gt; TcRn GlobalRdrEnv
-&gt; IO (Messages TcRnMessage, Maybe GlobalRdrEnv)
forall a. HscEnv -&gt; TcRn a -&gt; IO (Messages TcRnMessage, Maybe a)
</span><a href="GHC.Tc.Module.html#runTcInteractive"><span class="hs-identifier hs-var">runTcInteractive</span></a></span><span> </span><span class="annot"><span class="annottext">HscEnv
</span><a href="#local-6989586621683117877"><span class="hs-identifier hs-var">hsc_env</span></a></span><span> </span><span class="annot"><span class="annottext">(TcRn GlobalRdrEnv
 -&gt; IO (Messages TcRnMessage, Maybe GlobalRdrEnv))
-&gt; TcRn GlobalRdrEnv
-&gt; IO (Messages TcRnMessage, Maybe GlobalRdrEnv)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-2665"></span><span>    </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">_</span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621683117879"><span class="annot"><a href="#local-6989586621683117879"><span class="hs-identifier hs-var">gbl_env</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">(TcGblEnv -&gt; TcGblEnv)
-&gt; TcM ([NonEmpty ClassDefaults], TcGblEnv)
-&gt; TcM ([NonEmpty ClassDefaults], TcGblEnv)
forall gbl lcl a.
(gbl -&gt; gbl) -&gt; TcRnIf gbl lcl a -&gt; TcRnIf gbl lcl a
</span><a href="GHC.Tc.Utils.Monad.html#updGblEnv"><span class="hs-identifier hs-var">updGblEnv</span></a></span><span> </span><span class="annot"><span class="annottext">TcGblEnv -&gt; TcGblEnv
</span><a href="#local-6989586621683117880"><span class="hs-identifier hs-var">zap_rdr_env</span></a></span><span> </span><span class="annot"><span class="annottext">(TcM ([NonEmpty ClassDefaults], TcGblEnv)
 -&gt; TcM ([NonEmpty ClassDefaults], TcGblEnv))
-&gt; TcM ([NonEmpty ClassDefaults], TcGblEnv)
-&gt; TcM ([NonEmpty ClassDefaults], TcGblEnv)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-2666"></span><span>                         </span><span class="annot"><span class="annottext">HscEnv
-&gt; [(LImportDecl GhcPs, SDoc)]
-&gt; TcM ([NonEmpty ClassDefaults], TcGblEnv)
</span><a href="GHC.Tc.Module.html#tcRnImports"><span class="hs-identifier hs-var">tcRnImports</span></a></span><span> </span><span class="annot"><span class="annottext">HscEnv
</span><a href="#local-6989586621683117877"><span class="hs-identifier hs-var">hsc_env</span></a></span><span> </span><span class="annot"><span class="annottext">([(LImportDecl GhcPs, SDoc)]
 -&gt; TcM ([NonEmpty ClassDefaults], TcGblEnv))
-&gt; [(LImportDecl GhcPs, SDoc)]
-&gt; TcM ([NonEmpty ClassDefaults], TcGblEnv)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">(GenLocated SrcSpanAnnA (ImportDecl GhcPs)
 -&gt; (LImportDecl GhcPs, SDoc))
-&gt; [GenLocated SrcSpanAnnA (ImportDecl GhcPs)]
-&gt; [(LImportDecl GhcPs, SDoc)]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><span class="hs-identifier hs-var">map</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">,</span><span class="annot"><span class="annottext">String -&gt; SDoc
forall doc. IsLine doc =&gt; String -&gt; doc
</span><a href="GHC.Utils.Outputable.html#text"><span class="hs-identifier hs-var">text</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;is directly imported&quot;</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[LImportDecl GhcPs]
[GenLocated SrcSpanAnnA (ImportDecl GhcPs)]
</span><a href="#local-6989586621683117878"><span class="hs-identifier hs-var">import_decls</span></a></span><span>
</span><span id="line-2667"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">return</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Tc.Types.html#tcg_rdr_env"><span class="hs-identifier hs-var">tcg_rdr_env</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683117879"><span class="hs-identifier hs-type">gbl_env</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-2668"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-2669"></span><span>    </span><span id="local-6989586621683117880"><span class="annot"><span class="annottext">zap_rdr_env :: TcGblEnv -&gt; TcGblEnv
</span><a href="#local-6989586621683117880"><span class="hs-identifier hs-var hs-var">zap_rdr_env</span></a></span></span><span> </span><span id="local-6989586621683117881"><span class="annot"><span class="annottext">TcGblEnv
</span><a href="#local-6989586621683117881"><span class="hs-identifier hs-var">gbl_env</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">TcGblEnv
</span><a href="#local-6989586621683117881"><span class="hs-identifier hs-var">gbl_env</span></a></span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#tcg_rdr_env"><span class="hs-identifier hs-var">tcg_rdr_env</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="GHC.Types.Name.Reader.html#emptyGlobalRdrEnv"><span class="hs-identifier hs-type">emptyGlobalRdrEnv</span></a></span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-2670"></span><span>
</span><span id="line-2671"></span><span class="hs-comment">-- tcRnType just finds the kind of a type</span><span>
</span><span id="line-2672"></span><span class="annot"><a href="GHC.Tc.Module.html#tcRnType"><span class="hs-identifier hs-type">tcRnType</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Driver.Env.Types.html#HscEnv"><span class="hs-identifier hs-type">HscEnv</span></a></span><span>
</span><span id="line-2673"></span><span>         </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Zonk.Env.html#ZonkFlexi"><span class="hs-identifier hs-type">ZonkFlexi</span></a></span><span>
</span><span id="line-2674"></span><span>         </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Bool</span></span><span>        </span><span class="hs-comment">-- Normalise the returned type</span><span>
</span><span id="line-2675"></span><span>         </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Language.Haskell.Syntax.Type.html#LHsType"><span class="hs-identifier hs-type">LHsType</span></a></span><span> </span><span class="annot"><a href="GHC.Hs.Extension.html#GhcPs"><span class="hs-identifier hs-type">GhcPs</span></a></span><span>
</span><span id="line-2676"></span><span>         </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Types.Error.html#Messages"><span class="hs-identifier hs-type">Messages</span></a></span><span> </span><span class="annot"><a href="GHC.Tc.Errors.Types.html#TcRnMessage"><span class="hs-identifier hs-type">TcRnMessage</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Maybe</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#Type"><span class="hs-identifier hs-type">Type</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#Kind"><span class="hs-identifier hs-type">Kind</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-2677"></span><span id="tcRnType"><span class="annot"><span class="annottext">tcRnType :: HscEnv
-&gt; ZonkFlexi
-&gt; Bool
-&gt; LHsType GhcPs
-&gt; IO (Messages TcRnMessage, Maybe (Type, Type))
</span><a href="GHC.Tc.Module.html#tcRnType"><span class="hs-identifier hs-var hs-var">tcRnType</span></a></span></span><span> </span><span id="local-6989586621683117884"><span class="annot"><span class="annottext">HscEnv
</span><a href="#local-6989586621683117884"><span class="hs-identifier hs-var">hsc_env</span></a></span></span><span> </span><span id="local-6989586621683117885"><span class="annot"><span class="annottext">ZonkFlexi
</span><a href="#local-6989586621683117885"><span class="hs-identifier hs-var">flexi</span></a></span></span><span> </span><span id="local-6989586621683117886"><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621683117886"><span class="hs-identifier hs-var">normalise</span></a></span></span><span> </span><span id="local-6989586621683117887"><span class="annot"><span class="annottext">LHsType GhcPs
</span><a href="#local-6989586621683117887"><span class="hs-identifier hs-var">rdr_type</span></a></span></span><span>
</span><span id="line-2678"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">HscEnv
-&gt; TcM (Type, Type)
-&gt; IO (Messages TcRnMessage, Maybe (Type, Type))
forall a. HscEnv -&gt; TcRn a -&gt; IO (Messages TcRnMessage, Maybe a)
</span><a href="GHC.Tc.Module.html#runTcInteractive"><span class="hs-identifier hs-var">runTcInteractive</span></a></span><span> </span><span class="annot"><span class="annottext">HscEnv
</span><a href="#local-6989586621683117884"><span class="hs-identifier hs-var">hsc_env</span></a></span><span> </span><span class="annot"><span class="annottext">(TcM (Type, Type) -&gt; IO (Messages TcRnMessage, Maybe (Type, Type)))
-&gt; TcM (Type, Type)
-&gt; IO (Messages TcRnMessage, Maybe (Type, Type))
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-2679"></span><span>    </span><span class="annot"><span class="annottext">Extension -&gt; TcM (Type, Type) -&gt; TcM (Type, Type)
forall gbl lcl a. Extension -&gt; TcRnIf gbl lcl a -&gt; TcRnIf gbl lcl a
</span><a href="GHC.Tc.Utils.Monad.html#setXOptM"><span class="hs-identifier hs-var">setXOptM</span></a></span><span> </span><span class="annot"><span class="annottext">Extension
</span><span class="hs-identifier hs-var">LangExt.PolyKinds</span></span><span> </span><span class="annot"><span class="annottext">(TcM (Type, Type) -&gt; TcM (Type, Type))
-&gt; TcM (Type, Type) -&gt; TcM (Type, Type)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>   </span><span class="hs-comment">-- See Note [Kind-generalise in tcRnType]</span><span>
</span><span id="line-2680"></span><span>    </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Language.Haskell.Syntax.Type.html#HsWC"><span class="hs-identifier hs-type">HsWC</span></a></span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><a href="Language.Haskell.Syntax.Type.html#hswc_ext"><span class="hs-identifier hs-var">hswc_ext</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="local-6989586621683117892"><span class="annot"><a href="#local-6989586621683117892"><span class="hs-identifier hs-var">wcs</span></a></span></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Language.Haskell.Syntax.Type.html#hswc_body"><span class="hs-identifier hs-var">hswc_body</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="local-6989586621683117894"><span class="annot"><a href="#local-6989586621683117894"><span class="hs-identifier hs-var">rn_sig_type</span></a></span></span><span class="hs-glyph">@</span><span class="hs-special">(</span><span class="annot"><a href="GHC.Types.SrcLoc.html#L"><span class="hs-identifier hs-type">L</span></a></span><span> </span><span class="annot"><span class="hs-identifier">_</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Language.Haskell.Syntax.Type.html#HsSig"><span class="hs-identifier hs-type">HsSig</span></a></span><span class="hs-special">{</span><span class="annot"><a href="Language.Haskell.Syntax.Type.html#sig_bndrs"><span class="hs-identifier hs-var">sig_bndrs</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="local-6989586621683117895"><span class="annot"><a href="#local-6989586621683117895"><span class="hs-identifier hs-var">outer_bndrs</span></a></span></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Language.Haskell.Syntax.Type.html#sig_body"><span class="hs-identifier hs-var">sig_body</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="local-6989586621683117896"><span class="annot"><a href="#local-6989586621683117896"><span class="hs-identifier hs-var">body</span></a></span></span><span> </span><span class="hs-special">}</span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span class="hs-special">,</span><span> </span><span id="local-6989586621683117897"><span class="annot"><a href="#local-6989586621683117897"><span class="hs-identifier hs-var">_fvs</span></a></span></span><span class="hs-special">)</span><span>
</span><span id="line-2681"></span><span>                 </span><span class="hs-comment">-- we are using 'rnHsSigWcType' to bind the unbound type variables</span><span>
</span><span id="line-2682"></span><span>                 </span><span class="hs-comment">-- and in combination with 'tcOuterTKBndrs' we are able to</span><span>
</span><span id="line-2683"></span><span>                 </span><span class="hs-comment">-- implicitly quantify them as if the user wrote 'forall' by</span><span>
</span><span id="line-2684"></span><span>                 </span><span class="hs-comment">-- hand (see #19217). This allows kind check to work in presence</span><span>
</span><span id="line-2685"></span><span>                 </span><span class="hs-comment">-- of free type variables :</span><span>
</span><span id="line-2686"></span><span>                 </span><span class="hs-comment">-- ghci&gt; :k [a]</span><span>
</span><span id="line-2687"></span><span>                 </span><span class="hs-comment">-- [a] :: *</span><span>
</span><span id="line-2688"></span><span>               </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">HsDocContext
-&gt; LHsSigWcType GhcPs
-&gt; RnM (LHsSigWcType (GhcPass 'Renamed), FreeVars)
</span><a href="GHC.Rename.HsType.html#rnHsSigWcType"><span class="hs-identifier hs-var">rnHsSigWcType</span></a></span><span> </span><span class="annot"><span class="annottext">HsDocContext
</span><a href="GHC.Tc.Errors.Types.html#GHCiCtx"><span class="hs-identifier hs-var">GHCiCtx</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">LHsSigType GhcPs -&gt; LHsSigWcType GhcPs
forall thing. thing -&gt; HsWildCardBndrs GhcPs thing
</span><a href="GHC.Hs.Type.html#mkHsWildCardBndrs"><span class="hs-identifier hs-var">mkHsWildCardBndrs</span></a></span><span> </span><span class="annot"><span class="annottext">(LHsSigType GhcPs -&gt; LHsSigWcType GhcPs)
-&gt; LHsSigType GhcPs -&gt; LHsSigWcType GhcPs
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">HsSigType GhcPs -&gt; GenLocated SrcSpanAnnA (HsSigType GhcPs)
forall e a. HasAnnotation e =&gt; a -&gt; GenLocated e a
</span><a href="GHC.Parser.Annotation.html#noLocA"><span class="hs-identifier hs-var">noLocA</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">LHsType GhcPs -&gt; HsSigType GhcPs
</span><a href="GHC.Hs.Type.html#mkHsImplicitSigType"><span class="hs-identifier hs-var">mkHsImplicitSigType</span></a></span><span> </span><span class="annot"><span class="annottext">LHsType GhcPs
</span><a href="#local-6989586621683117887"><span class="hs-identifier hs-var">rdr_type</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-2689"></span><span>                  </span><span class="hs-comment">-- The type can have wild cards, but no implicit</span><span>
</span><span id="line-2690"></span><span>                  </span><span class="hs-comment">-- generalisation; e.g.   :kind (T _)</span><span>
</span><span id="line-2691"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.Monad.html#failIfErrsM"><span class="hs-identifier hs-type">failIfErrsM</span></a></span><span>
</span><span id="line-2692"></span><span>
</span><span id="line-2693"></span><span>        </span><span class="hs-comment">-- We follow Note [Recipe for checking a signature] in GHC.Tc.Gen.HsType here</span><span>
</span><span id="line-2694"></span><span>
</span><span id="line-2695"></span><span>        </span><span class="hs-comment">-- Now kind-check the type</span><span>
</span><span id="line-2696"></span><span>        </span><span class="hs-comment">-- It can have any rank or kind</span><span>
</span><span id="line-2697"></span><span>        </span><span class="hs-comment">-- First bring into scope any wildcards</span><span>
</span><span id="line-2698"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.Monad.html#traceTc"><span class="hs-identifier hs-type">traceTc</span></a></span><span> </span><span class="annot"><span class="hs-string">&quot;tcRnType&quot;</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Utils.Outputable.html#vcat"><span class="hs-identifier hs-type">vcat</span></a></span><span> </span><span class="hs-special">[</span><span class="annot"><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-type">ppr</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683117892"><span class="hs-identifier hs-type">wcs</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-type">ppr</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683117894"><span class="hs-identifier hs-type">rn_sig_type</span></a></span><span class="hs-special">]</span><span class="hs-special">)</span><span>
</span><span id="line-2699"></span><span>       </span><span class="hs-special">;</span><span> </span><span id="local-6989586621683117902"><span class="annot"><a href="#local-6989586621683117902"><span class="hs-identifier hs-var">si</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><a href="GHC.Tc.Types.Origin.html#mkSkolemInfo"><span class="hs-identifier hs-type">mkSkolemInfo</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="annot"><a href="GHC.Tc.Types.Origin.html#SigTypeSkol"><span class="hs-identifier hs-type">SigTypeSkol</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Tc.Types.Origin.html#GhciCtxt"><span class="hs-identifier hs-type">GhciCtxt</span></a></span><span> </span><span class="annot"><span class="hs-identifier hs-type">True</span></span><span class="hs-special">)</span><span>
</span><span id="line-2700"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="hs-special">(</span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">_</span></span><span class="hs-special">,</span><span> </span><span class="hs-special">(</span><span id="local-6989586621683117906"><span class="annot"><a href="#local-6989586621683117906"><span class="hs-identifier hs-var">ty</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621683117907"><span class="annot"><a href="#local-6989586621683117907"><span class="hs-identifier hs-var">kind</span></a></span></span><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span id="local-6989586621683117908"><span class="annot"><a href="#local-6989586621683117908"><span class="hs-identifier hs-var">wanted</span></a></span></span><span class="hs-special">)</span><span>
</span><span id="line-2701"></span><span>               </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><a href="GHC.Tc.Solver.html#captureTopConstraints"><span class="hs-identifier hs-type">captureTopConstraints</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span>
</span><span id="line-2702"></span><span>                  </span><span class="annot"><a href="GHC.Tc.Utils.Monad.html#pushTcLevelM_"><span class="hs-identifier hs-type">pushTcLevelM_</span></a></span><span>         </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span>
</span><span id="line-2703"></span><span>                  </span><span class="annot"><a href="GHC.Tc.Gen.HsType.html#bindNamedWildCardBinders"><span class="hs-identifier hs-type">bindNamedWildCardBinders</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683117892"><span class="hs-identifier hs-type">wcs</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="hs-glyph">\</span><span> </span><span id="local-6989586621683117911"><span class="annot"><span class="annottext">[(Name, Id)]
</span><a href="#local-6989586621683117911"><span class="hs-identifier hs-var">wcs'</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-2704"></span><span>                  </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">((Name, Id) -&gt; IOEnv (Env TcGblEnv TcLclEnv) ())
-&gt; [(Name, Id)] -&gt; IOEnv (Env TcGblEnv TcLclEnv) ()
forall (t :: * -&gt; *) (m :: * -&gt; *) a b.
(Foldable t, Monad m) =&gt;
(a -&gt; m b) -&gt; t a -&gt; m ()
</span><span class="hs-identifier hs-var">mapM_</span></span><span> </span><span class="annot"><span class="annottext">(Name, Id) -&gt; IOEnv (Env TcGblEnv TcLclEnv) ()
</span><a href="GHC.Tc.Utils.Monad.html#emitNamedTypeHole"><span class="hs-identifier hs-var">emitNamedTypeHole</span></a></span><span> </span><span class="annot"><span class="annottext">[(Name, Id)]
</span><a href="#local-6989586621683117911"><span class="hs-identifier hs-var">wcs'</span></a></span><span>
</span><span id="line-2705"></span><span>                     </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="annottext">SkolemInfo
-&gt; HsOuterSigTyVarBndrs (GhcPass 'Renamed)
-&gt; TcM (Type, Type)
-&gt; TcM (HsOuterTyVarBndrs Specificity GhcTc, (Type, Type))
forall flag a.
OutputableBndrFlag flag 'Renamed =&gt;
SkolemInfo
-&gt; HsOuterTyVarBndrs flag (GhcPass 'Renamed)
-&gt; TcM a
-&gt; TcM (HsOuterTyVarBndrs flag GhcTc, a)
</span><a href="GHC.Tc.Gen.HsType.html#tcOuterTKBndrs"><span class="hs-identifier hs-var">tcOuterTKBndrs</span></a></span><span> </span><span class="annot"><span class="annottext">SkolemInfo
</span><a href="#local-6989586621683117902"><span class="hs-identifier hs-var">si</span></a></span><span> </span><span class="annot"><span class="annottext">HsOuterSigTyVarBndrs (GhcPass 'Renamed)
</span><a href="#local-6989586621683117895"><span class="hs-identifier hs-var">outer_bndrs</span></a></span><span> </span><span class="annot"><span class="annottext">(TcM (Type, Type)
 -&gt; TcM (HsOuterTyVarBndrs Specificity GhcTc, (Type, Type)))
-&gt; TcM (Type, Type)
-&gt; TcM (HsOuterTyVarBndrs Specificity GhcTc, (Type, Type))
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">LHsType (GhcPass 'Renamed) -&gt; TcM (Type, Type)
</span><a href="GHC.Tc.Gen.HsType.html#tcInferLHsTypeUnsaturated"><span class="hs-identifier hs-var">tcInferLHsTypeUnsaturated</span></a></span><span> </span><span class="annot"><span class="annottext">LHsType (GhcPass 'Renamed)
</span><a href="#local-6989586621683117896"><span class="hs-identifier hs-var">body</span></a></span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-2706"></span><span>       </span><span class="hs-comment">-- Since all the wanteds are equalities, the returned bindings will be empty</span><span>
</span><span id="line-2707"></span><span>       </span><span class="hs-special">;</span><span> </span><span id="local-6989586621683117915"><span class="annot"><a href="#local-6989586621683117915"><span class="hs-identifier hs-var">empty_binds</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><a href="GHC.Tc.Solver.html#simplifyTop"><span class="hs-identifier hs-type">simplifyTop</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683117908"><span class="hs-identifier hs-type">wanted</span></a></span><span>
</span><span id="line-2708"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="annot"><a href="GHC.Utils.Panic.html#massertPpr"><span class="hs-identifier hs-type">massertPpr</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Data.Bag.html#isEmptyBag"><span class="hs-identifier hs-type">isEmptyBag</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683117915"><span class="hs-identifier hs-type">empty_binds</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-type">ppr</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683117915"><span class="hs-identifier hs-type">empty_binds</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-2709"></span><span>
</span><span id="line-2710"></span><span>       </span><span class="hs-comment">-- Do kind generalisation; see Note [Kind-generalise in tcRnType]</span><span>
</span><span id="line-2711"></span><span>       </span><span class="hs-special">;</span><span> </span><span id="local-6989586621683117918"><span class="annot"><a href="#local-6989586621683117918"><span class="hs-identifier hs-var">kvs</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><a href="GHC.Tc.Gen.HsType.html#kindGeneralizeAll"><span class="hs-identifier hs-type">kindGeneralizeAll</span></a></span><span> </span><span class="annot"><a href="GHC.Tc.Types.Origin.html#unkSkol"><span class="hs-identifier hs-type">unkSkol</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683117907"><span class="hs-identifier hs-type">kind</span></a></span><span>
</span><span id="line-2712"></span><span>
</span><span id="line-2713"></span><span>       </span><span class="hs-special">;</span><span> </span><span id="local-6989586621683117921"><span class="annot"><a href="#local-6989586621683117921"><span class="hs-identifier hs-var">ty</span></a></span></span><span>  </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><a href="GHC.Tc.Zonk.Env.html#initZonkEnv"><span class="hs-identifier hs-type">initZonkEnv</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683117885"><span class="hs-identifier hs-type">flexi</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="annot"><a href="GHC.Tc.Zonk.Type.html#zonkTcTypeToTypeX"><span class="hs-identifier hs-type">zonkTcTypeToTypeX</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683117906"><span class="hs-identifier hs-type">ty</span></a></span><span>
</span><span id="line-2714"></span><span>
</span><span id="line-2715"></span><span>       </span><span class="hs-comment">-- Do validity checking on type</span><span>
</span><span id="line-2716"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="annot"><a href="GHC.Tc.Validity.html#checkValidType"><span class="hs-identifier hs-type">checkValidType</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Tc.Types.Origin.html#GhciCtxt"><span class="hs-identifier hs-type">GhciCtxt</span></a></span><span> </span><span class="annot"><span class="hs-identifier hs-type">True</span></span><span class="hs-special">)</span><span> </span><span class="annot"><a href="#local-6989586621683117921"><span class="hs-identifier hs-type">ty</span></a></span><span>
</span><span id="line-2717"></span><span>
</span><span id="line-2718"></span><span>       </span><span class="hs-comment">-- Optionally (:k vs :k!) normalise the type. Does two things:</span><span>
</span><span id="line-2719"></span><span>       </span><span class="hs-comment">--   normaliseType: expand type-family applications</span><span>
</span><span id="line-2720"></span><span>       </span><span class="hs-comment">--   expandTypeSynonyms: expand type synonyms (#18828)</span><span>
</span><span id="line-2721"></span><span>       </span><span class="hs-special">;</span><span> </span><span id="local-6989586621683117924"><span class="annot"><a href="#local-6989586621683117924"><span class="hs-identifier hs-var">fam_envs</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><a href="GHC.Tc.Instance.Family.html#tcGetFamInstEnvs"><span class="hs-identifier hs-type">tcGetFamInstEnvs</span></a></span><span>
</span><span id="line-2722"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621683117925"><span class="annot"><a href="#local-6989586621683117925"><span class="hs-identifier hs-var hs-var">ty'</span></a></span></span><span> </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621683117886"><span class="hs-identifier hs-var">normalise</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Type -&gt; Type
</span><a href="GHC.Core.Type.html#expandTypeSynonyms"><span class="hs-identifier hs-var">expandTypeSynonyms</span></a></span><span> </span><span class="annot"><span class="annottext">(Type -&gt; Type) -&gt; Type -&gt; Type
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Reduction -&gt; Type
</span><a href="GHC.Core.Reduction.html#reductionReducedType"><span class="hs-identifier hs-var">reductionReducedType</span></a></span><span> </span><span class="annot"><span class="annottext">(Reduction -&gt; Type) -&gt; Reduction -&gt; Type
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-2723"></span><span>                               </span><span class="annot"><span class="annottext">FamInstEnvs -&gt; Role -&gt; Type -&gt; Reduction
</span><a href="GHC.Core.FamInstEnv.html#normaliseType"><span class="hs-identifier hs-var">normaliseType</span></a></span><span> </span><span class="annot"><span class="annottext">FamInstEnvs
</span><a href="#local-6989586621683117924"><span class="hs-identifier hs-var">fam_envs</span></a></span><span> </span><span class="annot"><span class="annottext">Role
</span><a href="Language.Haskell.Syntax.Basic.html#Nominal"><span class="hs-identifier hs-var">Nominal</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621683117921"><span class="hs-identifier hs-var">ty</span></a></span><span>
</span><span id="line-2724"></span><span>                 </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">otherwise</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621683117921"><span class="hs-identifier hs-var">ty</span></a></span><span>
</span><span id="line-2725"></span><span>
</span><span id="line-2726"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.Monad.html#traceTc"><span class="hs-identifier hs-type">traceTc</span></a></span><span> </span><span class="annot"><span class="hs-string">&quot;tcRnExpr&quot;</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Core.TyCo.Ppr.html#debugPprType"><span class="hs-identifier hs-type">debugPprType</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683117921"><span class="hs-identifier hs-type">ty</span></a></span><span> </span><span class="annot"><a href="GHC.Utils.Outputable.html#%24%24"><span class="hs-operator hs-type">$$</span></a></span><span> </span><span class="annot"><a href="GHC.Core.TyCo.Ppr.html#debugPprType"><span class="hs-identifier hs-type">debugPprType</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683117925"><span class="hs-identifier hs-type">ty'</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-2727"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">return</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621683117925"><span class="hs-identifier hs-type">ty'</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Core.Type.html#mkInfForAllTys"><span class="hs-identifier hs-type">mkInfForAllTys</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683117918"><span class="hs-identifier hs-type">kvs</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Core.Type.html#typeKind"><span class="hs-identifier hs-type">typeKind</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683117925"><span class="hs-identifier hs-type">ty'</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-2728"></span><span>
</span><span id="line-2729"></span><span>
</span><span id="line-2730"></span><span class="hs-comment">{- Note [TcRnExprMode]
~~~~~~~~~~~~~~~~~~~~~~
How should we infer a type when a user asks for the type of an expression e
at the GHCi prompt? We offer 2 different possibilities, described below. Each
considers this example, with -fprint-explicit-foralls enabled.  See also
https://github.com/ghc-proposals/ghc-proposals/blob/master/proposals/0179-printing-foralls.rst

:type / TM_Inst

  In this mode, we report the type obtained by instantiating only the
  /inferred/ quantifiers of e's type, solving constraints, and
  re-generalising, as discussed in #11376.

  &gt; :type reverse
  reverse :: forall a. [a] -&gt; [a]

  -- foo :: forall a f b. (Show a, Num b, Foldable f) =&gt; a -&gt; f b -&gt; String
  &gt; :type foo @Int
  forall f b. (Show Int, Num b, Foldable f) =&gt; Int -&gt; f b -&gt; String

  Note that Show Int is still reported, because the solver never got a chance
  to see it.

:type +d / TM_Default

  This mode is for the benefit of users who wish to see instantiations
  of generalized types, and in particular to instantiate Foldable and
  Traversable.  In this mode, all type variables (inferred or
  specified) are instantiated.  Because GHCi uses
  -XExtendedDefaultRules, this means that Foldable and Traversable are
  defaulted.

  &gt; :type +d reverse
  reverse :: forall {a}. [a] -&gt; [a]

  -- foo :: forall a f b. (Show a, Num b, Foldable f) =&gt; a -&gt; f b -&gt; String
  &gt; :type +d foo @Int
  Int -&gt; [Integer] -&gt; String

  Note that this mode can sometimes lead to a type error, if a type variable is
  used with a defaultable class but cannot actually be defaulted:

  bar :: (Num a, Monoid a) =&gt; a -&gt; a
  &gt; :type +d bar
  ** error **

  The error arises because GHC tries to default a but cannot find a concrete
  type in the defaulting list that is both Num and Monoid. (If this list is
  modified to include an element that is both Num and Monoid, the defaulting
  would succeed, of course.)

  Note that the variables and constraints are reordered here, because this
  is possible during regeneralization. Also note that the variables are
  reported as Inferred instead of Specified.

Note [Kind-generalise in tcRnType]
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
We switch on PolyKinds when kind-checking a user type, so that we will
kind-generalise the type, even when PolyKinds is not otherwise on.
This gives the right default behaviour at the GHCi prompt, where if
you say &quot;:k T&quot;, and T has a polymorphic kind, you'd like to see that
polymorphism. Of course.  If T isn't kind-polymorphic you won't get
anything unexpected, but the apparent *loss* of polymorphism, for
types that you know are polymorphic, is quite surprising.  See Trac
#7688 for a discussion.

Note that the goal is to generalise the *kind of the type*, not
the type itself! Example:
  ghci&gt; data SameKind :: k -&gt; k -&gt; Type
  ghci&gt; :k SameKind _

We want to get `k -&gt; Type`, not `Any -&gt; Type`, which is what we would
get without kind-generalisation. Note that `:k SameKind` is OK, as
GHC will not instantiate SameKind here, and so we see its full kind
of `forall k. k -&gt; k -&gt; Type`.

************************************************************************
*                                                                      *
                 tcRnDeclsi
*                                                                      *
************************************************************************

tcRnDeclsi exists to allow class, data, and other declarations in GHCi.
-}</span><span>
</span><span id="line-2814"></span><span>
</span><span id="line-2815"></span><span class="annot"><a href="GHC.Tc.Module.html#tcRnDeclsi"><span class="hs-identifier hs-type">tcRnDeclsi</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Driver.Env.Types.html#HscEnv"><span class="hs-identifier hs-type">HscEnv</span></a></span><span>
</span><span id="line-2816"></span><span>           </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="Language.Haskell.Syntax.Decls.html#LHsDecl"><span class="hs-identifier hs-type">LHsDecl</span></a></span><span> </span><span class="annot"><a href="GHC.Hs.Extension.html#GhcPs"><span class="hs-identifier hs-type">GhcPs</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-2817"></span><span>           </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Types.Error.html#Messages"><span class="hs-identifier hs-type">Messages</span></a></span><span> </span><span class="annot"><a href="GHC.Tc.Errors.Types.html#TcRnMessage"><span class="hs-identifier hs-type">TcRnMessage</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Maybe</span></span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#TcGblEnv"><span class="hs-identifier hs-type">TcGblEnv</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-2818"></span><span id="tcRnDeclsi"><span class="annot"><span class="annottext">tcRnDeclsi :: HscEnv
-&gt; [LHsDecl GhcPs] -&gt; IO (Messages TcRnMessage, Maybe TcGblEnv)
</span><a href="GHC.Tc.Module.html#tcRnDeclsi"><span class="hs-identifier hs-var hs-var">tcRnDeclsi</span></a></span></span><span> </span><span id="local-6989586621683117927"><span class="annot"><span class="annottext">HscEnv
</span><a href="#local-6989586621683117927"><span class="hs-identifier hs-var">hsc_env</span></a></span></span><span> </span><span id="local-6989586621683117928"><span class="annot"><span class="annottext">[LHsDecl GhcPs]
</span><a href="#local-6989586621683117928"><span class="hs-identifier hs-var">local_decls</span></a></span></span><span>
</span><span id="line-2819"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">HscEnv -&gt; TcM TcGblEnv -&gt; IO (Messages TcRnMessage, Maybe TcGblEnv)
forall a. HscEnv -&gt; TcRn a -&gt; IO (Messages TcRnMessage, Maybe a)
</span><a href="GHC.Tc.Module.html#runTcInteractive"><span class="hs-identifier hs-var">runTcInteractive</span></a></span><span> </span><span class="annot"><span class="annottext">HscEnv
</span><a href="#local-6989586621683117927"><span class="hs-identifier hs-var">hsc_env</span></a></span><span> </span><span class="annot"><span class="annottext">(TcM TcGblEnv -&gt; IO (Messages TcRnMessage, Maybe TcGblEnv))
-&gt; TcM TcGblEnv -&gt; IO (Messages TcRnMessage, Maybe TcGblEnv)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-2820"></span><span>    </span><span class="annot"><span class="annottext">Bool
-&gt; Maybe (GenLocated SrcSpanAnnLI [XRec GhcPs (IE GhcPs)])
-&gt; [LHsDecl GhcPs]
-&gt; TcM TcGblEnv
</span><a href="GHC.Tc.Module.html#tcRnSrcDecls"><span class="hs-identifier hs-var">tcRnSrcDecls</span></a></span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">False</span></span><span> </span><span class="annot"><span class="annottext">Maybe (GenLocated SrcSpanAnnLI [XRec GhcPs (IE GhcPs)])
Maybe (GenLocated SrcSpanAnnLI [GenLocated SrcSpanAnnA (IE GhcPs)])
forall a. Maybe a
</span><span class="hs-identifier hs-var">Nothing</span></span><span> </span><span class="annot"><span class="annottext">[LHsDecl GhcPs]
</span><a href="#local-6989586621683117928"><span class="hs-identifier hs-var">local_decls</span></a></span><span>
</span><span id="line-2821"></span><span>
</span><span id="line-2822"></span><span class="annot"><a href="GHC.Tc.Module.html#externaliseAndTidyId"><span class="hs-identifier hs-type">externaliseAndTidyId</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Unit.Types.html#Module"><span class="hs-identifier hs-type">Module</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Types.Var.html#Id"><span class="hs-identifier hs-type">Id</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#TcM"><span class="hs-identifier hs-type">TcM</span></a></span><span> </span><span class="annot"><a href="GHC.Types.Var.html#Id"><span class="hs-identifier hs-type">Id</span></a></span><span>
</span><span id="line-2823"></span><span id="externaliseAndTidyId"><span class="annot"><span class="annottext">externaliseAndTidyId :: Module -&gt; Id -&gt; TcM Id
</span><a href="GHC.Tc.Module.html#externaliseAndTidyId"><span class="hs-identifier hs-var hs-var">externaliseAndTidyId</span></a></span></span><span> </span><span id="local-6989586621683117929"><span class="annot"><span class="annottext">Module
</span><a href="#local-6989586621683117929"><span class="hs-identifier hs-var">this_mod</span></a></span></span><span> </span><span id="local-6989586621683117930"><span class="annot"><span class="annottext">Id
</span><a href="#local-6989586621683117930"><span class="hs-identifier hs-var">id</span></a></span></span><span>
</span><span id="line-2824"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span id="local-6989586621683117931"><span class="annot"><a href="#local-6989586621683117931"><span class="hs-identifier hs-var">name'</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Module -&gt; Name -&gt; TcRn Name
forall m n. Module -&gt; Name -&gt; TcRnIf m n Name
</span><a href="GHC.Iface.Env.html#externaliseName"><span class="hs-identifier hs-var">externaliseName</span></a></span><span> </span><span class="annot"><span class="annottext">Module
</span><a href="#local-6989586621683117929"><span class="hs-identifier hs-var">this_mod</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Id -&gt; Name
</span><a href="GHC.Types.Id.html#idName"><span class="hs-identifier hs-var">idName</span></a></span><span> </span><span class="annot"><span class="annottext">Id
</span><a href="#local-6989586621683117930"><span class="hs-identifier hs-var">id</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-2825"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">return</span></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="annot"><a href="GHC.Types.Var.html#globaliseId"><span class="hs-identifier hs-type">globaliseId</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683117930"><span class="hs-identifier hs-type">id</span></a></span><span>
</span><span id="line-2826"></span><span>                     </span><span class="annot"><a href="GHC.Types.Id.html#setIdName"><span class="hs-operator hs-type">`setIdName`</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683117931"><span class="hs-identifier hs-type">name'</span></a></span><span>
</span><span id="line-2827"></span><span>                     </span><span class="annot"><a href="GHC.Types.Id.html#setIdType"><span class="hs-operator hs-type">`setIdType`</span></a></span><span> </span><span class="annot"><a href="GHC.Core.TyCo.Tidy.html#tidyTopType"><span class="hs-identifier hs-type">tidyTopType</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Types.Id.html#idType"><span class="hs-identifier hs-type">idType</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683117930"><span class="hs-identifier hs-type">id</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-2828"></span><span>
</span><span id="line-2829"></span><span>
</span><span id="line-2830"></span><span class="hs-comment">{-
************************************************************************
*                                                                      *
        More GHCi stuff, to do with browsing and getting info
*                                                                      *
************************************************************************
-}</span><span>
</span><span id="line-2837"></span><span>
</span><span id="line-2838"></span><span class="hs-comment">-- | ASSUMES that the module is either in the 'HomePackageTable' or is</span><span>
</span><span id="line-2839"></span><span class="hs-comment">-- a package module with an interface on disk.  If neither of these is</span><span>
</span><span id="line-2840"></span><span class="hs-comment">-- true, then the result will be an error indicating the interface</span><span>
</span><span id="line-2841"></span><span class="hs-comment">-- could not be found.</span><span>
</span><span id="line-2842"></span><span class="annot"><a href="GHC.Tc.Module.html#getModuleInterface"><span class="hs-identifier hs-type">getModuleInterface</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Driver.Env.Types.html#HscEnv"><span class="hs-identifier hs-type">HscEnv</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Unit.Types.html#Module"><span class="hs-identifier hs-type">Module</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Types.Error.html#Messages"><span class="hs-identifier hs-type">Messages</span></a></span><span> </span><span class="annot"><a href="GHC.Tc.Errors.Types.html#TcRnMessage"><span class="hs-identifier hs-type">TcRnMessage</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Maybe</span></span><span> </span><span class="annot"><a href="GHC.Unit.Module.ModIface.html#ModIface"><span class="hs-identifier hs-type">ModIface</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-2843"></span><span id="getModuleInterface"><span class="annot"><span class="annottext">getModuleInterface :: HscEnv
-&gt; Module
-&gt; IO (Messages TcRnMessage, Maybe (ModIface_ 'ModIfaceFinal))
</span><a href="GHC.Tc.Module.html#getModuleInterface"><span class="hs-identifier hs-var hs-var">getModuleInterface</span></a></span></span><span> </span><span id="local-6989586621683117937"><span class="annot"><span class="annottext">HscEnv
</span><a href="#local-6989586621683117937"><span class="hs-identifier hs-var">hsc_env</span></a></span></span><span> </span><span id="local-6989586621683117938"><span class="annot"><span class="annottext">Module
</span><a href="#local-6989586621683117938"><span class="hs-identifier hs-var">mod</span></a></span></span><span>
</span><span id="line-2844"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">HscEnv
-&gt; IOEnv (Env TcGblEnv TcLclEnv) (ModIface_ 'ModIfaceFinal)
-&gt; IO (Messages TcRnMessage, Maybe (ModIface_ 'ModIfaceFinal))
forall a. HscEnv -&gt; TcRn a -&gt; IO (Messages TcRnMessage, Maybe a)
</span><a href="GHC.Tc.Module.html#runTcInteractive"><span class="hs-identifier hs-var">runTcInteractive</span></a></span><span> </span><span class="annot"><span class="annottext">HscEnv
</span><a href="#local-6989586621683117937"><span class="hs-identifier hs-var">hsc_env</span></a></span><span> </span><span class="annot"><span class="annottext">(IOEnv (Env TcGblEnv TcLclEnv) (ModIface_ 'ModIfaceFinal)
 -&gt; IO (Messages TcRnMessage, Maybe (ModIface_ 'ModIfaceFinal)))
-&gt; IOEnv (Env TcGblEnv TcLclEnv) (ModIface_ 'ModIfaceFinal)
-&gt; IO (Messages TcRnMessage, Maybe (ModIface_ 'ModIfaceFinal))
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-2845"></span><span>    </span><span class="annot"><span class="annottext">SDoc
-&gt; Module
-&gt; IOEnv (Env TcGblEnv TcLclEnv) (ModIface_ 'ModIfaceFinal)
</span><a href="GHC.Iface.Load.html#loadModuleInterface"><span class="hs-identifier hs-var">loadModuleInterface</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">String -&gt; SDoc
forall doc. IsLine doc =&gt; String -&gt; doc
</span><a href="GHC.Utils.Outputable.html#text"><span class="hs-identifier hs-var">text</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;getModuleInterface&quot;</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Module
</span><a href="#local-6989586621683117938"><span class="hs-identifier hs-var">mod</span></a></span><span>
</span><span id="line-2846"></span><span>
</span><span id="line-2847"></span><span class="annot"><a href="GHC.Tc.Module.html#tcRnLookupRdrName"><span class="hs-identifier hs-type">tcRnLookupRdrName</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Driver.Env.Types.html#HscEnv"><span class="hs-identifier hs-type">HscEnv</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Parser.Annotation.html#LocatedN"><span class="hs-identifier hs-type">LocatedN</span></a></span><span> </span><span class="annot"><a href="GHC.Types.Name.Reader.html#RdrName"><span class="hs-identifier hs-type">RdrName</span></a></span><span>
</span><span id="line-2848"></span><span>                  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Types.Error.html#Messages"><span class="hs-identifier hs-type">Messages</span></a></span><span> </span><span class="annot"><a href="GHC.Tc.Errors.Types.html#TcRnMessage"><span class="hs-identifier hs-type">TcRnMessage</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Maybe</span></span><span> </span><span class="hs-special">[</span><span class="annot"><a href="GHC.Types.Name.html#Name"><span class="hs-identifier hs-type">Name</span></a></span><span class="hs-special">]</span><span class="hs-special">)</span><span>
</span><span id="line-2849"></span><span class="annot"><span class="hs-comment">-- ^ Find all the Names that this RdrName could mean, in GHCi</span></span><span>
</span><span id="line-2850"></span><span id="tcRnLookupRdrName"><span class="annot"><span class="annottext">tcRnLookupRdrName :: HscEnv
-&gt; GenLocated SrcSpanAnnN RdrName
-&gt; IO (Messages TcRnMessage, Maybe [Name])
</span><a href="GHC.Tc.Module.html#tcRnLookupRdrName"><span class="hs-identifier hs-var hs-var">tcRnLookupRdrName</span></a></span></span><span> </span><span id="local-6989586621683117941"><span class="annot"><span class="annottext">HscEnv
</span><a href="#local-6989586621683117941"><span class="hs-identifier hs-var">hsc_env</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Types.SrcLoc.html#L"><span class="hs-identifier hs-type">L</span></a></span><span> </span><span id="local-6989586621683117942"><span class="annot"><span class="annottext">SrcSpanAnnN
</span><a href="#local-6989586621683117942"><span class="hs-identifier hs-var">loc</span></a></span></span><span> </span><span id="local-6989586621683117943"><span class="annot"><span class="annottext">RdrName
</span><a href="#local-6989586621683117943"><span class="hs-identifier hs-var">rdr_name</span></a></span></span><span class="hs-special">)</span><span>
</span><span id="line-2851"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">HscEnv -&gt; TcRn [Name] -&gt; IO (Messages TcRnMessage, Maybe [Name])
forall a. HscEnv -&gt; TcRn a -&gt; IO (Messages TcRnMessage, Maybe a)
</span><a href="GHC.Tc.Module.html#runTcInteractive"><span class="hs-identifier hs-var">runTcInteractive</span></a></span><span> </span><span class="annot"><span class="annottext">HscEnv
</span><a href="#local-6989586621683117941"><span class="hs-identifier hs-var">hsc_env</span></a></span><span> </span><span class="annot"><span class="annottext">(TcRn [Name] -&gt; IO (Messages TcRnMessage, Maybe [Name]))
-&gt; TcRn [Name] -&gt; IO (Messages TcRnMessage, Maybe [Name])
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-2852"></span><span>    </span><span class="annot"><span class="annottext">SrcSpanAnnN -&gt; TcRn [Name] -&gt; TcRn [Name]
forall ann a. EpAnn ann -&gt; TcRn a -&gt; TcRn a
</span><a href="GHC.Tc.Utils.Monad.html#setSrcSpanA"><span class="hs-identifier hs-var">setSrcSpanA</span></a></span><span> </span><span class="annot"><span class="annottext">SrcSpanAnnN
</span><a href="#local-6989586621683117942"><span class="hs-identifier hs-var">loc</span></a></span><span>          </span><span class="annot"><span class="annottext">(TcRn [Name] -&gt; TcRn [Name]) -&gt; TcRn [Name] -&gt; TcRn [Name]
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-2853"></span><span>    </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span>   </span><span class="hs-comment">-- If the identifier is a constructor (begins with an</span><span>
</span><span id="line-2854"></span><span>           </span><span class="hs-comment">-- upper-case letter), then we need to consider both</span><span>
</span><span id="line-2855"></span><span>           </span><span class="hs-comment">-- constructor and type class identifiers.</span><span>
</span><span id="line-2856"></span><span>         </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621683117944"><span class="annot"><span class="annottext">rdr_names :: [RdrName]
</span><a href="#local-6989586621683117944"><span class="hs-identifier hs-var hs-var hs-var">rdr_names</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">RdrName -&gt; [RdrName]
</span><a href="GHC.Rename.Env.html#dataTcOccs"><span class="hs-identifier hs-var">dataTcOccs</span></a></span><span> </span><span class="annot"><span class="annottext">RdrName
</span><a href="#local-6989586621683117943"><span class="hs-identifier hs-var">rdr_name</span></a></span><span>
</span><span id="line-2857"></span><span>       </span><span class="hs-special">;</span><span> </span><span id="local-6989586621683117946"><span class="annot"><a href="#local-6989586621683117946"><span class="hs-identifier hs-var">names_s</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">(RdrName -&gt; TcRn [Name])
-&gt; [RdrName] -&gt; IOEnv (Env TcGblEnv TcLclEnv) [[Name]]
forall (t :: * -&gt; *) (m :: * -&gt; *) a b.
(Traversable t, Monad m) =&gt;
(a -&gt; m b) -&gt; t a -&gt; m (t b)
forall (m :: * -&gt; *) a b. Monad m =&gt; (a -&gt; m b) -&gt; [a] -&gt; m [b]
</span><span class="hs-identifier hs-var">mapM</span></span><span> </span><span class="annot"><span class="annottext">RdrName -&gt; TcRn [Name]
</span><a href="GHC.Rename.Env.html#lookupInfoOccRn"><span class="hs-identifier hs-var">lookupInfoOccRn</span></a></span><span> </span><span class="annot"><span class="annottext">[RdrName]
</span><a href="#local-6989586621683117944"><span class="hs-identifier hs-var">rdr_names</span></a></span><span>
</span><span id="line-2858"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621683117948"><span class="annot"><a href="#local-6989586621683117948"><span class="hs-identifier hs-var hs-var">names</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[[Name]] -&gt; [Name]
forall (t :: * -&gt; *) a. Foldable t =&gt; t [a] -&gt; [a]
</span><span class="hs-identifier hs-var">concat</span></span><span> </span><span class="annot"><span class="annottext">[[Name]]
</span><a href="#local-6989586621683117946"><span class="hs-identifier hs-var">names_s</span></a></span><span>
</span><span id="line-2859"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">when</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">null</span></span><span> </span><span class="annot"><a href="#local-6989586621683117948"><span class="hs-identifier hs-type">names</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Tc.Utils.Monad.html#addErrTc"><span class="hs-identifier hs-type">addErrTc</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="annot"><a href="GHC.Tc.Errors.Types.html#mkTcRnNotInScope"><span class="hs-identifier hs-type">mkTcRnNotInScope</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683117943"><span class="hs-identifier hs-type">rdr_name</span></a></span><span> </span><span class="annot"><a href="GHC.Tc.Errors.Types.html#NotInScope"><span class="hs-identifier hs-type">NotInScope</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-2860"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">return</span></span><span> </span><span class="annot"><a href="#local-6989586621683117948"><span class="hs-identifier hs-type">names</span></a></span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-2861"></span><span>
</span><span id="line-2862"></span><span class="annot"><a href="GHC.Tc.Module.html#tcRnLookupName"><span class="hs-identifier hs-type">tcRnLookupName</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Driver.Env.Types.html#HscEnv"><span class="hs-identifier hs-type">HscEnv</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Types.Name.html#Name"><span class="hs-identifier hs-type">Name</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Types.Error.html#Messages"><span class="hs-identifier hs-type">Messages</span></a></span><span> </span><span class="annot"><a href="GHC.Tc.Errors.Types.html#TcRnMessage"><span class="hs-identifier hs-type">TcRnMessage</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Maybe</span></span><span> </span><span class="annot"><a href="GHC.Types.TyThing.html#TyThing"><span class="hs-identifier hs-type">TyThing</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-2863"></span><span id="tcRnLookupName"><span class="annot"><span class="annottext">tcRnLookupName :: HscEnv -&gt; Name -&gt; IO (Messages TcRnMessage, Maybe TyThing)
</span><a href="GHC.Tc.Module.html#tcRnLookupName"><span class="hs-identifier hs-var hs-var">tcRnLookupName</span></a></span></span><span> </span><span id="local-6989586621683117951"><span class="annot"><span class="annottext">HscEnv
</span><a href="#local-6989586621683117951"><span class="hs-identifier hs-var">hsc_env</span></a></span></span><span> </span><span id="local-6989586621683117952"><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621683117952"><span class="hs-identifier hs-var">name</span></a></span></span><span>
</span><span id="line-2864"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">HscEnv -&gt; TcM TyThing -&gt; IO (Messages TcRnMessage, Maybe TyThing)
forall a. HscEnv -&gt; TcRn a -&gt; IO (Messages TcRnMessage, Maybe a)
</span><a href="GHC.Tc.Module.html#runTcInteractive"><span class="hs-identifier hs-var">runTcInteractive</span></a></span><span> </span><span class="annot"><span class="annottext">HscEnv
</span><a href="#local-6989586621683117951"><span class="hs-identifier hs-var">hsc_env</span></a></span><span> </span><span class="annot"><span class="annottext">(TcM TyThing -&gt; IO (Messages TcRnMessage, Maybe TyThing))
-&gt; TcM TyThing -&gt; IO (Messages TcRnMessage, Maybe TyThing)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-2865"></span><span>    </span><span class="annot"><span class="annottext">Name -&gt; TcM TyThing
</span><a href="GHC.Tc.Module.html#tcRnLookupName%27"><span class="hs-identifier hs-var">tcRnLookupName'</span></a></span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621683117952"><span class="hs-identifier hs-var">name</span></a></span><span>
</span><span id="line-2866"></span><span>
</span><span id="line-2867"></span><span class="hs-comment">-- To look up a name we have to look in the local environment (tcl_lcl)</span><span>
</span><span id="line-2868"></span><span class="hs-comment">-- as well as the global environment, which is what tcLookup does.</span><span>
</span><span id="line-2869"></span><span class="hs-comment">-- But we also want a TyThing, so we have to convert:</span><span>
</span><span id="line-2870"></span><span>
</span><span id="line-2871"></span><span class="annot"><a href="GHC.Tc.Module.html#tcRnLookupName%27"><span class="hs-identifier hs-type">tcRnLookupName'</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Types.Name.html#Name"><span class="hs-identifier hs-type">Name</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#TcRn"><span class="hs-identifier hs-type">TcRn</span></a></span><span> </span><span class="annot"><a href="GHC.Types.TyThing.html#TyThing"><span class="hs-identifier hs-type">TyThing</span></a></span><span>
</span><span id="line-2872"></span><span id="tcRnLookupName%27"><span class="annot"><span class="annottext">tcRnLookupName' :: Name -&gt; TcM TyThing
</span><a href="GHC.Tc.Module.html#tcRnLookupName%27"><span class="hs-identifier hs-var hs-var">tcRnLookupName'</span></a></span></span><span> </span><span id="local-6989586621683117954"><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621683117954"><span class="hs-identifier hs-var">name</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-2873"></span><span>   </span><span id="local-6989586621683117955"><span class="annot"><a href="#local-6989586621683117955"><span class="hs-identifier hs-var">tcthing</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Name -&gt; TcM TcTyThing
</span><a href="GHC.Tc.Utils.Env.html#tcLookup"><span class="hs-identifier hs-var">tcLookup</span></a></span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621683117954"><span class="hs-identifier hs-var">name</span></a></span><span>
</span><span id="line-2874"></span><span>   </span><span class="hs-keyword">case</span><span> </span><span class="annot"><a href="#local-6989586621683117955"><span class="hs-identifier hs-type">tcthing</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-2875"></span><span>     </span><span class="annot"><a href="GHC.Tc.Types.BasicTypes.html#AGlobal"><span class="hs-identifier hs-type">AGlobal</span></a></span><span> </span><span id="local-6989586621683117958"><span class="annot"><span class="annottext">TyThing
</span><a href="#local-6989586621683117958"><span class="hs-identifier hs-var">thing</span></a></span></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">TyThing -&gt; TcM TyThing
forall a. a -&gt; IOEnv (Env TcGblEnv TcLclEnv) a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="annot"><span class="annottext">TyThing
</span><a href="#local-6989586621683117958"><span class="hs-identifier hs-var">thing</span></a></span><span>
</span><span id="line-2876"></span><span>     </span><span class="annot"><a href="GHC.Tc.Types.BasicTypes.html#ATcId"><span class="hs-identifier hs-type">ATcId</span></a></span><span class="hs-special">{</span><span class="annot"><span class="annottext">tct_id :: TcTyThing -&gt; Id
</span><a href="GHC.Tc.Types.BasicTypes.html#tct_id"><span class="hs-identifier hs-var">tct_id</span></a></span><span class="hs-glyph">=</span><span id="local-6989586621683117959"><span class="annot"><span class="annottext">Id
</span><a href="#local-6989586621683117959"><span class="hs-identifier hs-var">id</span></a></span></span><span class="hs-special">}</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">TyThing -&gt; TcM TyThing
forall a. a -&gt; IOEnv (Env TcGblEnv TcLclEnv) a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Id -&gt; TyThing
</span><a href="GHC.Types.TyThing.html#AnId"><span class="hs-identifier hs-var">AnId</span></a></span><span> </span><span class="annot"><span class="annottext">Id
</span><a href="#local-6989586621683117959"><span class="hs-identifier hs-var">id</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-2877"></span><span>     </span><span class="annot"><span class="annottext">TcTyThing
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">String -&gt; TcM TyThing
forall a. HasCallStack =&gt; String -&gt; a
</span><a href="GHC.Utils.Panic.Plain.html#panic"><span class="hs-identifier hs-var">panic</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;tcRnLookupName'&quot;</span></span><span>
</span><span id="line-2878"></span><span>
</span><span id="line-2879"></span><span class="annot"><a href="GHC.Tc.Module.html#tcRnGetInfo"><span class="hs-identifier hs-type">tcRnGetInfo</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Driver.Env.Types.html#HscEnv"><span class="hs-identifier hs-type">HscEnv</span></a></span><span>
</span><span id="line-2880"></span><span>            </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Types.Name.html#Name"><span class="hs-identifier hs-type">Name</span></a></span><span>
</span><span id="line-2881"></span><span>            </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="hs-special">(</span><span> </span><span class="annot"><a href="GHC.Types.Error.html#Messages"><span class="hs-identifier hs-type">Messages</span></a></span><span> </span><span class="annot"><a href="GHC.Tc.Errors.Types.html#TcRnMessage"><span class="hs-identifier hs-type">TcRnMessage</span></a></span><span>
</span><span id="line-2882"></span><span>                  </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Maybe</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Types.TyThing.html#TyThing"><span class="hs-identifier hs-type">TyThing</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Language.Haskell.Syntax.Basic.html#Fixity"><span class="hs-identifier hs-type">Fixity</span></a></span><span class="hs-special">,</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="GHC.Core.InstEnv.html#ClsInst"><span class="hs-identifier hs-type">ClsInst</span></a></span><span class="hs-special">]</span><span class="hs-special">,</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="GHC.Core.FamInstEnv.html#FamInst"><span class="hs-identifier hs-type">FamInst</span></a></span><span class="hs-special">]</span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Utils.Outputable.html#SDoc"><span class="hs-identifier hs-type">SDoc</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-2883"></span><span>
</span><span id="line-2884"></span><span class="hs-comment">-- Used to implement :info in GHCi</span><span>
</span><span id="line-2885"></span><span class="hs-comment">--</span><span>
</span><span id="line-2886"></span><span class="hs-comment">-- Look up a RdrName and return all the TyThings it might be</span><span>
</span><span id="line-2887"></span><span class="hs-comment">-- A capitalised RdrName is given to us in the DataName namespace,</span><span>
</span><span id="line-2888"></span><span class="hs-comment">-- but we want to treat it as *both* a data constructor</span><span>
</span><span id="line-2889"></span><span class="hs-comment">--  *and* as a type or class constructor;</span><span>
</span><span id="line-2890"></span><span class="hs-comment">-- hence the call to dataTcOccs, and we return up to two results</span><span>
</span><span id="line-2891"></span><span id="tcRnGetInfo"><span class="annot"><span class="annottext">tcRnGetInfo :: HscEnv
-&gt; Name
-&gt; IO
     (Messages TcRnMessage,
      Maybe (TyThing, Fixity, [ClsInst], [FamInst], SDoc))
</span><a href="GHC.Tc.Module.html#tcRnGetInfo"><span class="hs-identifier hs-var hs-var">tcRnGetInfo</span></a></span></span><span> </span><span id="local-6989586621683117960"><span class="annot"><span class="annottext">HscEnv
</span><a href="#local-6989586621683117960"><span class="hs-identifier hs-var">hsc_env</span></a></span></span><span> </span><span id="local-6989586621683117961"><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621683117961"><span class="hs-identifier hs-var">name</span></a></span></span><span>
</span><span id="line-2892"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">HscEnv
-&gt; TcRn (TyThing, Fixity, [ClsInst], [FamInst], SDoc)
-&gt; IO
     (Messages TcRnMessage,
      Maybe (TyThing, Fixity, [ClsInst], [FamInst], SDoc))
forall a. HscEnv -&gt; TcRn a -&gt; IO (Messages TcRnMessage, Maybe a)
</span><a href="GHC.Tc.Module.html#runTcInteractive"><span class="hs-identifier hs-var">runTcInteractive</span></a></span><span> </span><span class="annot"><span class="annottext">HscEnv
</span><a href="#local-6989586621683117960"><span class="hs-identifier hs-var">hsc_env</span></a></span><span> </span><span class="annot"><span class="annottext">(TcRn (TyThing, Fixity, [ClsInst], [FamInst], SDoc)
 -&gt; IO
      (Messages TcRnMessage,
       Maybe (TyThing, Fixity, [ClsInst], [FamInst], SDoc)))
-&gt; TcRn (TyThing, Fixity, [ClsInst], [FamInst], SDoc)
-&gt; IO
     (Messages TcRnMessage,
      Maybe (TyThing, Fixity, [ClsInst], [FamInst], SDoc))
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-2893"></span><span>    </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">HscEnv -&gt; InteractiveContext -&gt; IOEnv (Env TcGblEnv TcLclEnv) ()
</span><a href="GHC.Tc.Module.html#loadUnqualIfaces"><span class="hs-identifier hs-var">loadUnqualIfaces</span></a></span><span> </span><span class="annot"><span class="annottext">HscEnv
</span><a href="#local-6989586621683117960"><span class="hs-identifier hs-var">hsc_env</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">HscEnv -&gt; InteractiveContext
</span><a href="GHC.Driver.Env.Types.html#hsc_IC"><span class="hs-identifier hs-var">hsc_IC</span></a></span><span> </span><span class="annot"><span class="annottext">HscEnv
</span><a href="#local-6989586621683117960"><span class="hs-identifier hs-var">hsc_env</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-2894"></span><span>           </span><span class="hs-comment">-- Load the interface for all unqualified types and classes</span><span>
</span><span id="line-2895"></span><span>           </span><span class="hs-comment">-- That way we will find all the instance declarations</span><span>
</span><span id="line-2896"></span><span>           </span><span class="hs-comment">-- (Packages have not orphan modules, and we assume that</span><span>
</span><span id="line-2897"></span><span>           </span><span class="hs-comment">--  in the home package all relevant modules are loaded.)</span><span>
</span><span id="line-2898"></span><span>
</span><span id="line-2899"></span><span>       </span><span class="hs-special">;</span><span> </span><span id="local-6989586621683117962"><span class="annot"><a href="#local-6989586621683117962"><span class="hs-identifier hs-var">thing</span></a></span></span><span>  </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Name -&gt; TcM TyThing
</span><a href="GHC.Tc.Module.html#tcRnLookupName%27"><span class="hs-identifier hs-var">tcRnLookupName'</span></a></span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621683117961"><span class="hs-identifier hs-var">name</span></a></span><span>
</span><span id="line-2900"></span><span>       </span><span class="hs-special">;</span><span> </span><span id="local-6989586621683117963"><span class="annot"><a href="#local-6989586621683117963"><span class="hs-identifier hs-var">fixity</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><a href="GHC.Rename.Fixity.html#lookupFixityRn"><span class="hs-identifier hs-type">lookupFixityRn</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683117961"><span class="hs-identifier hs-type">name</span></a></span><span>
</span><span id="line-2901"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="hs-special">(</span><span id="local-6989586621683117964"><span class="annot"><a href="#local-6989586621683117964"><span class="hs-identifier hs-var">cls_insts</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621683117965"><span class="annot"><a href="#local-6989586621683117965"><span class="hs-identifier hs-var">fam_insts</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><a href="GHC.Tc.Module.html#lookupInsts"><span class="hs-identifier hs-type">lookupInsts</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683117962"><span class="hs-identifier hs-type">thing</span></a></span><span>
</span><span id="line-2902"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621683117967"><span class="annot"><a href="#local-6989586621683117967"><span class="hs-identifier hs-var hs-var">info</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Name -&gt; SDoc
</span><a href="GHC.Builtin.Utils.html#lookupKnownNameInfo"><span class="hs-identifier hs-var">lookupKnownNameInfo</span></a></span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621683117961"><span class="hs-identifier hs-var">name</span></a></span><span>
</span><span id="line-2903"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">return</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621683117962"><span class="hs-identifier hs-type">thing</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="#local-6989586621683117963"><span class="hs-identifier hs-type">fixity</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="#local-6989586621683117964"><span class="hs-identifier hs-type">cls_insts</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="#local-6989586621683117965"><span class="hs-identifier hs-type">fam_insts</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="#local-6989586621683117967"><span class="hs-identifier hs-type">info</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-2904"></span><span>
</span><span id="line-2905"></span><span>
</span><span id="line-2906"></span><span class="hs-comment">-- Lookup all class and family instances for a type constructor.</span><span>
</span><span id="line-2907"></span><span class="hs-comment">--</span><span>
</span><span id="line-2908"></span><span class="hs-comment">-- This function filters all instances in the type environment, so there</span><span>
</span><span id="line-2909"></span><span class="hs-comment">-- is a lot of duplicated work if it is called many times in the same</span><span>
</span><span id="line-2910"></span><span class="hs-comment">-- type environment. If this becomes a problem, the NameEnv computed</span><span>
</span><span id="line-2911"></span><span class="hs-comment">-- in GHC.getNameToInstancesIndex could be cached in TcM and both functions</span><span>
</span><span id="line-2912"></span><span class="hs-comment">-- could be changed to consult that index.</span><span>
</span><span id="line-2913"></span><span class="annot"><a href="GHC.Tc.Module.html#lookupInsts"><span class="hs-identifier hs-type">lookupInsts</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Types.TyThing.html#TyThing"><span class="hs-identifier hs-type">TyThing</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#TcM"><span class="hs-identifier hs-type">TcM</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">[</span><span class="annot"><a href="GHC.Core.InstEnv.html#ClsInst"><span class="hs-identifier hs-type">ClsInst</span></a></span><span class="hs-special">]</span><span class="hs-special">,</span><span class="hs-special">[</span><span class="annot"><a href="GHC.Core.FamInstEnv.html#FamInst"><span class="hs-identifier hs-type">FamInst</span></a></span><span class="hs-special">]</span><span class="hs-special">)</span><span>
</span><span id="line-2914"></span><span id="lookupInsts"><span class="annot"><span class="annottext">lookupInsts :: TyThing -&gt; TcM ([ClsInst], [FamInst])
</span><a href="GHC.Tc.Module.html#lookupInsts"><span class="hs-identifier hs-var hs-var">lookupInsts</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Types.TyThing.html#ATyCon"><span class="hs-identifier hs-type">ATyCon</span></a></span><span> </span><span id="local-6989586621683117969"><span class="annot"><span class="annottext">TyCon
</span><a href="#local-6989586621683117969"><span class="hs-identifier hs-var">tc</span></a></span></span><span class="hs-special">)</span><span>
</span><span id="line-2915"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>  </span><span class="hs-special">{</span><span> </span><span class="annot"><a href="GHC.Core.InstEnv.html#InstEnvs"><span class="hs-identifier hs-type">InstEnvs</span></a></span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><a href="GHC.Core.InstEnv.html#ie_global"><span class="hs-identifier hs-var">ie_global</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="local-6989586621683117972"><span class="annot"><a href="#local-6989586621683117972"><span class="hs-identifier hs-var">pkg_ie</span></a></span></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Core.InstEnv.html#ie_local"><span class="hs-identifier hs-var">ie_local</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="local-6989586621683117974"><span class="annot"><a href="#local-6989586621683117974"><span class="hs-identifier hs-var">home_ie</span></a></span></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Core.InstEnv.html#ie_visible"><span class="hs-identifier hs-var">ie_visible</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="local-6989586621683117976"><span class="annot"><a href="#local-6989586621683117976"><span class="hs-identifier hs-var">vis_mods</span></a></span></span><span> </span><span class="hs-special">}</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">TcM InstEnvs
</span><a href="GHC.Tc.Utils.Env.html#tcGetInstEnvs"><span class="hs-identifier hs-var">tcGetInstEnvs</span></a></span><span>
</span><span id="line-2916"></span><span>        </span><span class="hs-special">;</span><span> </span><span class="hs-special">(</span><span id="local-6989586621683117978"><span class="annot"><a href="#local-6989586621683117978"><span class="hs-identifier hs-var">pkg_fie</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621683117979"><span class="annot"><a href="#local-6989586621683117979"><span class="hs-identifier hs-var">home_fie</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><a href="GHC.Tc.Instance.Family.html#tcGetFamInstEnvs"><span class="hs-identifier hs-type">tcGetFamInstEnvs</span></a></span><span>
</span><span id="line-2917"></span><span>                </span><span class="hs-comment">-- Load all instances for all classes that are</span><span>
</span><span id="line-2918"></span><span>                </span><span class="hs-comment">-- in the type environment (which are all the ones</span><span>
</span><span id="line-2919"></span><span>                </span><span class="hs-comment">-- we've seen in any interface file so far)</span><span>
</span><span id="line-2920"></span><span>
</span><span id="line-2921"></span><span>          </span><span class="hs-comment">-- Return only the instances relevant to the given thing, i.e.</span><span>
</span><span id="line-2922"></span><span>          </span><span class="hs-comment">-- the instances whose head contains the thing's name.</span><span>
</span><span id="line-2923"></span><span>        </span><span class="hs-special">;</span><span> </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621683117980"><span class="annot"><a href="#local-6989586621683117980"><span class="hs-identifier hs-var hs-var">cls_insts</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-2924"></span><span>                 </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">ClsInst
</span><a href="#local-6989586621683117981"><span class="hs-identifier hs-var">ispec</span></a></span><span>        </span><span class="hs-comment">-- Search all</span><span>
</span><span id="line-2925"></span><span>                 </span><span class="hs-glyph">|</span><span> </span><span id="local-6989586621683117981"><span class="annot"><span class="annottext">ClsInst
</span><a href="#local-6989586621683117981"><span class="hs-identifier hs-var">ispec</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">InstEnv -&gt; [ClsInst]
</span><a href="GHC.Core.InstEnv.html#instEnvElts"><span class="hs-identifier hs-var">instEnvElts</span></a></span><span> </span><span class="annot"><span class="annottext">InstEnv
</span><a href="#local-6989586621683117974"><span class="hs-identifier hs-var">home_ie</span></a></span><span> </span><span class="annot"><span class="annottext">[ClsInst] -&gt; [ClsInst] -&gt; [ClsInst]
forall a. [a] -&gt; [a] -&gt; [a]
</span><span class="hs-operator hs-var">++</span></span><span> </span><span class="annot"><span class="annottext">InstEnv -&gt; [ClsInst]
</span><a href="GHC.Core.InstEnv.html#instEnvElts"><span class="hs-identifier hs-var">instEnvElts</span></a></span><span> </span><span class="annot"><span class="annottext">InstEnv
</span><a href="#local-6989586621683117972"><span class="hs-identifier hs-var">pkg_ie</span></a></span><span>
</span><span id="line-2926"></span><span>                 </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">VisibleOrphanModules -&gt; ClsInst -&gt; Bool
</span><a href="GHC.Core.InstEnv.html#instIsVisible"><span class="hs-identifier hs-var">instIsVisible</span></a></span><span> </span><span class="annot"><span class="annottext">VisibleOrphanModules
</span><a href="#local-6989586621683117976"><span class="hs-identifier hs-var">vis_mods</span></a></span><span> </span><span class="annot"><span class="annottext">ClsInst
</span><a href="#local-6989586621683117981"><span class="hs-identifier hs-var">ispec</span></a></span><span>
</span><span id="line-2927"></span><span>                 </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621683117983"><span class="hs-identifier hs-var">tc_name</span></a></span><span> </span><span class="annot"><span class="annottext">Name -&gt; FreeVars -&gt; Bool
</span><a href="GHC.Types.Name.Set.html#elemNameSet"><span class="hs-operator hs-var">`elemNameSet`</span></a></span><span> </span><span class="annot"><span class="annottext">ClsInst -&gt; FreeVars
</span><a href="GHC.Core.InstEnv.html#orphNamesOfClsInst"><span class="hs-identifier hs-var">orphNamesOfClsInst</span></a></span><span> </span><span class="annot"><span class="annottext">ClsInst
</span><a href="#local-6989586621683117981"><span class="hs-identifier hs-var">ispec</span></a></span><span> </span><span class="hs-special">]</span><span>
</span><span id="line-2928"></span><span>        </span><span class="hs-special">;</span><span> </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621683117986"><span class="annot"><a href="#local-6989586621683117986"><span class="hs-identifier hs-var hs-var">fam_insts</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-2929"></span><span>                 </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">FamInst
</span><a href="#local-6989586621683117987"><span class="hs-identifier hs-var">fispec</span></a></span><span>
</span><span id="line-2930"></span><span>                 </span><span class="hs-glyph">|</span><span> </span><span id="local-6989586621683117987"><span class="annot"><span class="annottext">FamInst
</span><a href="#local-6989586621683117987"><span class="hs-identifier hs-var">fispec</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">FamInstEnv -&gt; [FamInst]
</span><a href="GHC.Core.FamInstEnv.html#famInstEnvElts"><span class="hs-identifier hs-var">famInstEnvElts</span></a></span><span> </span><span class="annot"><span class="annottext">FamInstEnv
</span><a href="#local-6989586621683117979"><span class="hs-identifier hs-var">home_fie</span></a></span><span> </span><span class="annot"><span class="annottext">[FamInst] -&gt; [FamInst] -&gt; [FamInst]
forall a. [a] -&gt; [a] -&gt; [a]
</span><span class="hs-operator hs-var">++</span></span><span> </span><span class="annot"><span class="annottext">FamInstEnv -&gt; [FamInst]
</span><a href="GHC.Core.FamInstEnv.html#famInstEnvElts"><span class="hs-identifier hs-var">famInstEnvElts</span></a></span><span> </span><span class="annot"><span class="annottext">FamInstEnv
</span><a href="#local-6989586621683117978"><span class="hs-identifier hs-var">pkg_fie</span></a></span><span>
</span><span id="line-2931"></span><span>                 </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621683117983"><span class="hs-identifier hs-var">tc_name</span></a></span><span> </span><span class="annot"><span class="annottext">Name -&gt; FreeVars -&gt; Bool
</span><a href="GHC.Types.Name.Set.html#elemNameSet"><span class="hs-operator hs-var">`elemNameSet`</span></a></span><span> </span><span class="annot"><span class="annottext">FamInst -&gt; FreeVars
</span><a href="GHC.Core.FamInstEnv.html#orphNamesOfFamInst"><span class="hs-identifier hs-var">orphNamesOfFamInst</span></a></span><span> </span><span class="annot"><span class="annottext">FamInst
</span><a href="#local-6989586621683117987"><span class="hs-identifier hs-var">fispec</span></a></span><span> </span><span class="hs-special">]</span><span>
</span><span id="line-2932"></span><span>        </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">return</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621683117980"><span class="hs-identifier hs-type">cls_insts</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="#local-6989586621683117986"><span class="hs-identifier hs-type">fam_insts</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-2933"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-2934"></span><span>    </span><span id="local-6989586621683117983"><span class="annot"><span class="annottext">tc_name :: Name
</span><a href="#local-6989586621683117983"><span class="hs-identifier hs-var hs-var">tc_name</span></a></span></span><span>     </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">TyCon -&gt; Name
</span><a href="GHC.Core.TyCon.html#tyConName"><span class="hs-identifier hs-var">tyConName</span></a></span><span> </span><span class="annot"><span class="annottext">TyCon
</span><a href="#local-6989586621683117969"><span class="hs-identifier hs-var">tc</span></a></span><span>
</span><span id="line-2935"></span><span>
</span><span id="line-2936"></span><span class="annot"><a href="GHC.Tc.Module.html#lookupInsts"><span class="hs-identifier hs-var">lookupInsts</span></a></span><span> </span><span class="annot"><span class="annottext">TyThing
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">([ClsInst], [FamInst]) -&gt; TcM ([ClsInst], [FamInst])
forall a. a -&gt; IOEnv (Env TcGblEnv TcLclEnv) a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">[</span><span class="hs-special">]</span><span class="hs-special">,</span><span class="hs-special">[</span><span class="hs-special">]</span><span class="hs-special">)</span><span>
</span><span id="line-2937"></span><span>
</span><span id="line-2938"></span><span class="annot"><a href="GHC.Tc.Module.html#loadUnqualIfaces"><span class="hs-identifier hs-type">loadUnqualIfaces</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Driver.Env.Types.html#HscEnv"><span class="hs-identifier hs-type">HscEnv</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Runtime.Context.html#InteractiveContext"><span class="hs-identifier hs-type">InteractiveContext</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#TcM"><span class="hs-identifier hs-type">TcM</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-2939"></span><span class="hs-comment">-- Load the interface for everything that is in scope unqualified</span><span>
</span><span id="line-2940"></span><span class="hs-comment">-- This is so that we can accurately report the instances for</span><span>
</span><span id="line-2941"></span><span class="hs-comment">-- something</span><span>
</span><span id="line-2942"></span><span id="loadUnqualIfaces"><span class="annot"><span class="annottext">loadUnqualIfaces :: HscEnv -&gt; InteractiveContext -&gt; IOEnv (Env TcGblEnv TcLclEnv) ()
</span><a href="GHC.Tc.Module.html#loadUnqualIfaces"><span class="hs-identifier hs-var hs-var">loadUnqualIfaces</span></a></span></span><span> </span><span id="local-6989586621683117988"><span class="annot"><span class="annottext">HscEnv
</span><a href="#local-6989586621683117988"><span class="hs-identifier hs-var">hsc_env</span></a></span></span><span> </span><span id="local-6989586621683117989"><span class="annot"><span class="annottext">InteractiveContext
</span><a href="#local-6989586621683117989"><span class="hs-identifier hs-var">ictxt</span></a></span></span><span>
</span><span id="line-2943"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">IfG () -&gt; IOEnv (Env TcGblEnv TcLclEnv) ()
forall a. IfG a -&gt; TcRn a
</span><a href="GHC.Tc.Utils.Monad.html#initIfaceTcRn"><span class="hs-identifier hs-var">initIfaceTcRn</span></a></span><span> </span><span class="annot"><span class="annottext">(IfG () -&gt; IOEnv (Env TcGblEnv TcLclEnv) ())
-&gt; IfG () -&gt; IOEnv (Env TcGblEnv TcLclEnv) ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-2944"></span><span>    </span><span class="annot"><span class="annottext">(Module -&gt; IOEnv (Env IfGblEnv ()) (ModIface_ 'ModIfaceFinal))
-&gt; [Module] -&gt; IfG ()
forall (t :: * -&gt; *) (m :: * -&gt; *) a b.
(Foldable t, Monad m) =&gt;
(a -&gt; m b) -&gt; t a -&gt; m ()
</span><span class="hs-identifier hs-var">mapM_</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">SDoc
-&gt; Module -&gt; IOEnv (Env IfGblEnv ()) (ModIface_ 'ModIfaceFinal)
forall lcl. SDoc -&gt; Module -&gt; IfM lcl (ModIface_ 'ModIfaceFinal)
</span><a href="GHC.Iface.Load.html#loadSysInterface"><span class="hs-identifier hs-var">loadSysInterface</span></a></span><span> </span><span class="annot"><span class="annottext">SDoc
</span><a href="#local-6989586621683117991"><span class="hs-identifier hs-var">doc</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">VisibleOrphanModules -&gt; [Module]
</span><a href="GHC.Unit.Module.Env.html#moduleSetElts"><span class="hs-identifier hs-var">moduleSetElts</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[Module] -&gt; VisibleOrphanModules
</span><a href="GHC.Unit.Module.Env.html#mkModuleSet"><span class="hs-identifier hs-var">mkModuleSet</span></a></span><span> </span><span class="annot"><span class="annottext">[Module]
</span><a href="#local-6989586621683117994"><span class="hs-identifier hs-var">unqual_mods</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-2945"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-2946"></span><span>    </span><span id="local-6989586621683117995"><span class="annot"><span class="annottext">home_unit :: HomeUnit
</span><a href="#local-6989586621683117995"><span class="hs-identifier hs-var hs-var">home_unit</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">HscEnv -&gt; HomeUnit
</span><a href="GHC.Driver.Env.html#hsc_home_unit"><span class="hs-identifier hs-var">hsc_home_unit</span></a></span><span> </span><span class="annot"><span class="annottext">HscEnv
</span><a href="#local-6989586621683117988"><span class="hs-identifier hs-var">hsc_env</span></a></span><span>
</span><span id="line-2947"></span><span>
</span><span id="line-2948"></span><span>    </span><span id="local-6989586621683117994"><span class="annot"><span class="annottext">unqual_mods :: [Module]
</span><a href="#local-6989586621683117994"><span class="hs-identifier hs-var hs-var">unqual_mods</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">HasDebugCallStack =&gt; Name -&gt; Module
Name -&gt; Module
</span><a href="GHC.Types.Name.html#nameModule"><span class="hs-identifier hs-var">nameModule</span></a></span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621683117997"><span class="hs-identifier hs-var">name</span></a></span><span>
</span><span id="line-2949"></span><span>                  </span><span class="hs-glyph">|</span><span> </span><span id="local-6989586621683117998"><span class="annot"><span class="annottext">GlobalRdrElt
</span><a href="#local-6989586621683117998"><span class="hs-identifier hs-var">gre</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">GlobalRdrEnv -&gt; [GlobalRdrElt]
forall info. GlobalRdrEnvX info -&gt; [GlobalRdrEltX info]
</span><a href="GHC.Types.Name.Reader.html#globalRdrEnvElts"><span class="hs-identifier hs-var">globalRdrEnvElts</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">InteractiveContext -&gt; GlobalRdrEnv
</span><a href="GHC.Runtime.Context.html#icReaderEnv"><span class="hs-identifier hs-var">icReaderEnv</span></a></span><span> </span><span class="annot"><span class="annottext">InteractiveContext
</span><a href="#local-6989586621683117989"><span class="hs-identifier hs-var">ictxt</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-2950"></span><span>                  </span><span class="hs-special">,</span><span> </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621683117997"><span class="annot"><span class="annottext">name :: Name
</span><a href="#local-6989586621683117997"><span class="hs-identifier hs-var hs-var">name</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">GlobalRdrElt -&gt; Name
forall info. GlobalRdrEltX info -&gt; Name
</span><a href="GHC.Types.Name.Reader.html#greName"><span class="hs-identifier hs-var">greName</span></a></span><span> </span><span class="annot"><span class="annottext">GlobalRdrElt
</span><a href="#local-6989586621683117998"><span class="hs-identifier hs-var">gre</span></a></span><span>
</span><span id="line-2951"></span><span>                  </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">HomeUnit -&gt; Name -&gt; Bool
</span><a href="GHC.Types.Name.html#nameIsFromExternalPackage"><span class="hs-identifier hs-var">nameIsFromExternalPackage</span></a></span><span> </span><span class="annot"><span class="annottext">HomeUnit
</span><a href="#local-6989586621683117995"><span class="hs-identifier hs-var">home_unit</span></a></span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621683117997"><span class="hs-identifier hs-var">name</span></a></span><span>
</span><span id="line-2952"></span><span>                  </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">OccName -&gt; Bool
</span><a href="GHC.Types.Name.Occurrence.html#isTcOcc"><span class="hs-identifier hs-var">isTcOcc</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Name -&gt; OccName
</span><a href="GHC.Types.Name.html#nameOccName"><span class="hs-identifier hs-var">nameOccName</span></a></span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621683117997"><span class="hs-identifier hs-var">name</span></a></span><span class="hs-special">)</span><span>   </span><span class="hs-comment">-- Types and classes only</span><span>
</span><span id="line-2953"></span><span>                  </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">GlobalRdrElt -&gt; Bool
forall info. GlobalRdrEltX info -&gt; Bool
</span><a href="GHC.Types.Name.Reader.html#unQualOK"><span class="hs-identifier hs-var">unQualOK</span></a></span><span> </span><span class="annot"><span class="annottext">GlobalRdrElt
</span><a href="#local-6989586621683117998"><span class="hs-identifier hs-var">gre</span></a></span><span> </span><span class="hs-special">]</span><span>               </span><span class="hs-comment">-- In scope unqualified</span><span>
</span><span id="line-2954"></span><span>    </span><span id="local-6989586621683117991"><span class="annot"><span class="annottext">doc :: SDoc
</span><a href="#local-6989586621683117991"><span class="hs-identifier hs-var hs-var">doc</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">String -&gt; SDoc
forall doc. IsLine doc =&gt; String -&gt; doc
</span><a href="GHC.Utils.Outputable.html#text"><span class="hs-identifier hs-var">text</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;Need interface for module whose export(s) are in scope unqualified&quot;</span></span><span>
</span><span id="line-2955"></span><span>
</span><span id="line-2956"></span><span>
</span><span id="line-2957"></span><span>
</span><span id="line-2958"></span><span class="hs-comment">{-
************************************************************************
*                                                                      *
                Debugging output
      This is what happens when you do -ddump-types
*                                                                      *
************************************************************************
-}</span><span>
</span><span id="line-2966"></span><span>
</span><span id="line-2967"></span><span class="annot"><span class="hs-comment">-- | Dump, with a banner, if -ddump-rn</span></span><span>
</span><span id="line-2968"></span><span id="local-6989586621683115139"><span class="annot"><a href="GHC.Tc.Module.html#rnDump"><span class="hs-identifier hs-type">rnDump</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Utils.Outputable.html#Outputable"><span class="hs-identifier hs-type">Outputable</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683115139"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Data</span></span><span> </span><span class="annot"><a href="#local-6989586621683115139"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="#local-6989586621683115139"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#TcRn"><span class="hs-identifier hs-type">TcRn</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span></span><span>
</span><span id="line-2969"></span><span id="rnDump"><span class="annot"><span class="annottext">rnDump :: forall a.
(Outputable a, Data a) =&gt;
a -&gt; IOEnv (Env TcGblEnv TcLclEnv) ()
</span><a href="GHC.Tc.Module.html#rnDump"><span class="hs-identifier hs-var hs-var">rnDump</span></a></span></span><span> </span><span id="local-6989586621683118008"><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621683118008"><span class="hs-identifier hs-var">rn</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">DumpFlag
-&gt; String -&gt; DumpFormat -&gt; SDoc -&gt; IOEnv (Env TcGblEnv TcLclEnv) ()
</span><a href="GHC.Tc.Utils.Monad.html#dumpOptTcRn"><span class="hs-identifier hs-var">dumpOptTcRn</span></a></span><span> </span><span class="annot"><span class="annottext">DumpFlag
</span><a href="GHC.Driver.Flags.html#Opt_D_dump_rn"><span class="hs-identifier hs-var">Opt_D_dump_rn</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;Renamer&quot;</span></span><span> </span><span class="annot"><span class="annottext">DumpFormat
</span><a href="GHC.Utils.Logger.html#FormatHaskell"><span class="hs-identifier hs-var">FormatHaskell</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">a -&gt; SDoc
forall a. Outputable a =&gt; a -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621683118008"><span class="hs-identifier hs-var">rn</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-2970"></span><span>
</span><span id="line-2971"></span><span class="annot"><a href="GHC.Tc.Module.html#tcDump"><span class="hs-identifier hs-type">tcDump</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#TcGblEnv"><span class="hs-identifier hs-type">TcGblEnv</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#TcRn"><span class="hs-identifier hs-type">TcRn</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-2972"></span><span id="tcDump"><span class="annot"><span class="annottext">tcDump :: TcGblEnv -&gt; IOEnv (Env TcGblEnv TcLclEnv) ()
</span><a href="GHC.Tc.Module.html#tcDump"><span class="hs-identifier hs-var hs-var">tcDump</span></a></span></span><span> </span><span id="local-6989586621683118010"><span class="annot"><span class="annottext">TcGblEnv
</span><a href="#local-6989586621683118010"><span class="hs-identifier hs-var">env</span></a></span></span><span>
</span><span id="line-2973"></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span id="local-6989586621683118011"><span class="annot"><a href="#local-6989586621683118011"><span class="hs-identifier hs-var">unit_state</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">HasDebugCallStack =&gt; HscEnv -&gt; UnitState
HscEnv -&gt; UnitState
</span><a href="GHC.Driver.Env.html#hsc_units"><span class="hs-identifier hs-var">hsc_units</span></a></span><span> </span><span class="annot"><span class="annottext">(HscEnv -&gt; UnitState)
-&gt; TcRnIf TcGblEnv TcLclEnv HscEnv
-&gt; IOEnv (Env TcGblEnv TcLclEnv) UnitState
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="annot"><span class="annottext">TcRnIf TcGblEnv TcLclEnv HscEnv
forall gbl lcl. TcRnIf gbl lcl HscEnv
</span><a href="GHC.Tc.Utils.Monad.html#getTopEnv"><span class="hs-identifier hs-var">getTopEnv</span></a></span><span> </span><span class="hs-special">;</span><span>
</span><span id="line-2974"></span><span>        </span><span id="local-6989586621683118013"><span class="annot"><a href="#local-6989586621683118013"><span class="hs-identifier hs-var">logger</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><a href="GHC.Utils.Logger.html#getLogger"><span class="hs-identifier hs-type">getLogger</span></a></span><span> </span><span class="hs-special">;</span><span>
</span><span id="line-2975"></span><span>
</span><span id="line-2976"></span><span>        </span><span class="hs-comment">-- Dump short output if -ddump-types or -ddump-tc</span><span>
</span><span id="line-2977"></span><span>        </span><span class="annot"><span class="hs-identifier hs-type">when</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Utils.Logger.html#logHasDumpFlag"><span class="hs-identifier hs-type">logHasDumpFlag</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683118013"><span class="hs-identifier hs-type">logger</span></a></span><span> </span><span class="annot"><a href="GHC.Driver.Flags.html#Opt_D_dump_types"><span class="hs-identifier hs-type">Opt_D_dump_types</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">||</span></span><span> </span><span class="annot"><a href="GHC.Utils.Logger.html#logHasDumpFlag"><span class="hs-identifier hs-type">logHasDumpFlag</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683118013"><span class="hs-identifier hs-type">logger</span></a></span><span> </span><span class="annot"><a href="GHC.Driver.Flags.html#Opt_D_dump_tc"><span class="hs-identifier hs-type">Opt_D_dump_tc</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-2978"></span><span>          </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Tc.Utils.Monad.html#dumpTcRn"><span class="hs-identifier hs-type">dumpTcRn</span></a></span><span> </span><span class="annot"><span class="hs-identifier hs-type">True</span></span><span> </span><span class="annot"><a href="GHC.Driver.Flags.html#Opt_D_dump_types"><span class="hs-identifier hs-type">Opt_D_dump_types</span></a></span><span>
</span><span id="line-2979"></span><span>            </span><span class="annot"><span class="hs-string">&quot;&quot;</span></span><span> </span><span class="annot"><a href="GHC.Utils.Logger.html#FormatText"><span class="hs-identifier hs-type">FormatText</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Unit.State.html#pprWithUnitState"><span class="hs-identifier hs-type">pprWithUnitState</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683118011"><span class="hs-identifier hs-type">unit_state</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683118019"><span class="hs-identifier hs-type">short_dump</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-special">;</span><span>
</span><span id="line-2980"></span><span>
</span><span id="line-2981"></span><span>        </span><span class="hs-comment">-- Dump bindings if -ddump-tc</span><span>
</span><span id="line-2982"></span><span>        </span><span class="annot"><a href="GHC.Tc.Utils.Monad.html#dumpOptTcRn"><span class="hs-identifier hs-type">dumpOptTcRn</span></a></span><span> </span><span class="annot"><a href="GHC.Driver.Flags.html#Opt_D_dump_tc"><span class="hs-identifier hs-type">Opt_D_dump_tc</span></a></span><span> </span><span class="annot"><span class="hs-string">&quot;Typechecker&quot;</span></span><span> </span><span class="annot"><a href="GHC.Utils.Logger.html#FormatHaskell"><span class="hs-identifier hs-type">FormatHaskell</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683118020"><span class="hs-identifier hs-type">full_dump</span></a></span><span class="hs-special">;</span><span>
</span><span id="line-2983"></span><span>
</span><span id="line-2984"></span><span>        </span><span class="hs-comment">-- Dump bindings as an hsSyn AST if -ddump-tc-ast</span><span>
</span><span id="line-2985"></span><span>        </span><span class="annot"><a href="GHC.Tc.Utils.Monad.html#dumpOptTcRn"><span class="hs-identifier hs-type">dumpOptTcRn</span></a></span><span> </span><span class="annot"><a href="GHC.Driver.Flags.html#Opt_D_dump_tc_ast"><span class="hs-identifier hs-type">Opt_D_dump_tc_ast</span></a></span><span> </span><span class="annot"><span class="hs-string">&quot;Typechecker AST&quot;</span></span><span> </span><span class="annot"><a href="GHC.Utils.Logger.html#FormatHaskell"><span class="hs-identifier hs-type">FormatHaskell</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683118021"><span class="hs-identifier hs-type">ast_dump</span></a></span><span>
</span><span id="line-2986"></span><span>   </span><span class="hs-special">}</span><span>
</span><span id="line-2987"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-2988"></span><span>    </span><span id="local-6989586621683118019"><span class="annot"><span class="annottext">short_dump :: SDoc
</span><a href="#local-6989586621683118019"><span class="hs-identifier hs-var hs-var">short_dump</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">TcGblEnv -&gt; SDoc
</span><a href="GHC.Tc.Module.html#pprTcGblEnv"><span class="hs-identifier hs-var">pprTcGblEnv</span></a></span><span> </span><span class="annot"><span class="annottext">TcGblEnv
</span><a href="#local-6989586621683118010"><span class="hs-identifier hs-var">env</span></a></span><span>
</span><span id="line-2989"></span><span>    </span><span id="local-6989586621683118020"><span class="annot"><span class="annottext">full_dump :: SDoc
</span><a href="#local-6989586621683118020"><span class="hs-identifier hs-var hs-var">full_dump</span></a></span></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">LHsBinds GhcTc -&gt; SDoc
forall (idL :: Pass) (idR :: Pass).
(OutputableBndrId idL, OutputableBndrId idR) =&gt;
LHsBindsLR (GhcPass idL) (GhcPass idR) -&gt; SDoc
</span><a href="GHC.Hs.Binds.html#pprLHsBinds"><span class="hs-identifier hs-var">pprLHsBinds</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TcGblEnv -&gt; LHsBinds GhcTc
</span><a href="GHC.Tc.Types.html#tcg_binds"><span class="hs-identifier hs-var">tcg_binds</span></a></span><span> </span><span class="annot"><span class="annottext">TcGblEnv
</span><a href="#local-6989586621683118010"><span class="hs-identifier hs-var">env</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-2990"></span><span>        </span><span class="hs-comment">-- NB: foreign x-d's have undefined's in their types;</span><span>
</span><span id="line-2991"></span><span>        </span><span class="hs-comment">--     hence can't show the tc_fords</span><span>
</span><span id="line-2992"></span><span>    </span><span id="local-6989586621683118021"><span class="annot"><span class="annottext">ast_dump :: SDoc
</span><a href="#local-6989586621683118021"><span class="hs-identifier hs-var hs-var">ast_dump</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">BlankSrcSpan
-&gt; BlankEpAnnotations
-&gt; [GenLocated SrcSpanAnnA (HsBindLR GhcTc GhcTc)]
-&gt; SDoc
forall a. Data a =&gt; BlankSrcSpan -&gt; BlankEpAnnotations -&gt; a -&gt; SDoc
</span><a href="GHC.Hs.Dump.html#showAstData"><span class="hs-identifier hs-var">showAstData</span></a></span><span> </span><span class="annot"><span class="annottext">BlankSrcSpan
</span><a href="GHC.Hs.Dump.html#NoBlankSrcSpan"><span class="hs-identifier hs-var">NoBlankSrcSpan</span></a></span><span> </span><span class="annot"><span class="annottext">BlankEpAnnotations
</span><a href="GHC.Hs.Dump.html#NoBlankEpAnnotations"><span class="hs-identifier hs-var">NoBlankEpAnnotations</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TcGblEnv -&gt; LHsBinds GhcTc
</span><a href="GHC.Tc.Types.html#tcg_binds"><span class="hs-identifier hs-var">tcg_binds</span></a></span><span> </span><span class="annot"><span class="annottext">TcGblEnv
</span><a href="#local-6989586621683118010"><span class="hs-identifier hs-var">env</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-2993"></span><span>
</span><span id="line-2994"></span><span class="hs-comment">-- It's unpleasant having both pprModGuts and pprModDetails here</span><span>
</span><span id="line-2995"></span><span class="annot"><a href="GHC.Tc.Module.html#pprTcGblEnv"><span class="hs-identifier hs-type">pprTcGblEnv</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#TcGblEnv"><span class="hs-identifier hs-type">TcGblEnv</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Utils.Outputable.html#SDoc"><span class="hs-identifier hs-type">SDoc</span></a></span><span>
</span><span id="line-2996"></span><span id="pprTcGblEnv"><span class="annot"><span class="annottext">pprTcGblEnv :: TcGblEnv -&gt; SDoc
</span><a href="GHC.Tc.Module.html#pprTcGblEnv"><span class="hs-identifier hs-var hs-var">pprTcGblEnv</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Tc.Types.html#TcGblEnv"><span class="hs-identifier hs-type">TcGblEnv</span></a></span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">tcg_type_env :: TcGblEnv -&gt; TypeEnv
</span><a href="GHC.Tc.Types.html#tcg_type_env"><span class="hs-identifier hs-var">tcg_type_env</span></a></span><span>  </span><span class="hs-glyph">=</span><span> </span><span id="local-6989586621683118024"><span class="annot"><span class="annottext">TypeEnv
</span><a href="#local-6989586621683118024"><span class="hs-identifier hs-var">type_env</span></a></span></span><span class="hs-special">,</span><span>
</span><span id="line-2997"></span><span>                        </span><span class="annot"><span class="annottext">tcg_insts :: TcGblEnv -&gt; [ClsInst]
</span><a href="GHC.Tc.Types.html#tcg_insts"><span class="hs-identifier hs-var">tcg_insts</span></a></span><span>     </span><span class="hs-glyph">=</span><span> </span><span id="local-6989586621683118025"><span class="annot"><span class="annottext">[ClsInst]
</span><a href="#local-6989586621683118025"><span class="hs-identifier hs-var">insts</span></a></span></span><span class="hs-special">,</span><span>
</span><span id="line-2998"></span><span>                        </span><span class="annot"><span class="annottext">tcg_fam_insts :: TcGblEnv -&gt; [FamInst]
</span><a href="GHC.Tc.Types.html#tcg_fam_insts"><span class="hs-identifier hs-var">tcg_fam_insts</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="local-6989586621683118027"><span class="annot"><span class="annottext">[FamInst]
</span><a href="#local-6989586621683118027"><span class="hs-identifier hs-var">fam_insts</span></a></span></span><span class="hs-special">,</span><span>
</span><span id="line-2999"></span><span>                        </span><span class="annot"><span class="annottext">tcg_rules :: TcGblEnv -&gt; [LRuleDecl GhcTc]
</span><a href="GHC.Tc.Types.html#tcg_rules"><span class="hs-identifier hs-var">tcg_rules</span></a></span><span>     </span><span class="hs-glyph">=</span><span> </span><span id="local-6989586621683118028"><span class="annot"><span class="annottext">[LRuleDecl GhcTc]
</span><a href="#local-6989586621683118028"><span class="hs-identifier hs-var">rules</span></a></span></span><span class="hs-special">,</span><span>
</span><span id="line-3000"></span><span>                        </span><span class="annot"><span class="annottext">tcg_imports :: TcGblEnv -&gt; ImportAvails
</span><a href="GHC.Tc.Types.html#tcg_imports"><span class="hs-identifier hs-var">tcg_imports</span></a></span><span>   </span><span class="hs-glyph">=</span><span> </span><span id="local-6989586621683118029"><span class="annot"><span class="annottext">ImportAvails
</span><a href="#local-6989586621683118029"><span class="hs-identifier hs-var">imports</span></a></span></span><span> </span><span class="hs-special">}</span><span class="hs-special">)</span><span>
</span><span id="line-3001"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(Bool -&gt; SDoc) -&gt; SDoc
forall doc. IsOutput doc =&gt; (Bool -&gt; doc) -&gt; doc
</span><a href="GHC.Utils.Outputable.html#getPprDebug"><span class="hs-identifier hs-var">getPprDebug</span></a></span><span> </span><span class="annot"><span class="annottext">((Bool -&gt; SDoc) -&gt; SDoc) -&gt; (Bool -&gt; SDoc) -&gt; SDoc
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-glyph">\</span><span id="local-6989586621683118031"><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621683118031"><span class="hs-identifier hs-var">debug</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-3002"></span><span>    </span><span class="annot"><span class="annottext">[SDoc] -&gt; SDoc
forall doc. IsDoc doc =&gt; [doc] -&gt; doc
</span><a href="GHC.Utils.Outputable.html#vcat"><span class="hs-identifier hs-var">vcat</span></a></span><span> </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">Bool -&gt; TypeEnv -&gt; SDoc
</span><a href="GHC.Tc.Module.html#ppr_types"><span class="hs-identifier hs-var">ppr_types</span></a></span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621683118031"><span class="hs-identifier hs-var">debug</span></a></span><span> </span><span class="annot"><span class="annottext">TypeEnv
</span><a href="#local-6989586621683118024"><span class="hs-identifier hs-var">type_env</span></a></span><span>
</span><span id="line-3003"></span><span>         </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Bool -&gt; [FamInst] -&gt; TypeEnv -&gt; SDoc
</span><a href="GHC.Tc.Module.html#ppr_tycons"><span class="hs-identifier hs-var">ppr_tycons</span></a></span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621683118031"><span class="hs-identifier hs-var">debug</span></a></span><span> </span><span class="annot"><span class="annottext">[FamInst]
</span><a href="#local-6989586621683118027"><span class="hs-identifier hs-var">fam_insts</span></a></span><span> </span><span class="annot"><span class="annottext">TypeEnv
</span><a href="#local-6989586621683118024"><span class="hs-identifier hs-var">type_env</span></a></span><span>
</span><span id="line-3004"></span><span>         </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Bool -&gt; TypeEnv -&gt; SDoc
</span><a href="GHC.Tc.Module.html#ppr_datacons"><span class="hs-identifier hs-var">ppr_datacons</span></a></span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621683118031"><span class="hs-identifier hs-var">debug</span></a></span><span> </span><span class="annot"><span class="annottext">TypeEnv
</span><a href="#local-6989586621683118024"><span class="hs-identifier hs-var">type_env</span></a></span><span>
</span><span id="line-3005"></span><span>         </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">TypeEnv -&gt; SDoc
</span><a href="GHC.Tc.Module.html#ppr_patsyns"><span class="hs-identifier hs-var">ppr_patsyns</span></a></span><span> </span><span class="annot"><span class="annottext">TypeEnv
</span><a href="#local-6989586621683118024"><span class="hs-identifier hs-var">type_env</span></a></span><span>
</span><span id="line-3006"></span><span>         </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">[ClsInst] -&gt; SDoc
</span><a href="GHC.Tc.Module.html#ppr_insts"><span class="hs-identifier hs-var">ppr_insts</span></a></span><span> </span><span class="annot"><span class="annottext">[ClsInst]
</span><a href="#local-6989586621683118025"><span class="hs-identifier hs-var">insts</span></a></span><span>
</span><span id="line-3007"></span><span>         </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">[FamInst] -&gt; SDoc
</span><a href="GHC.Tc.Module.html#ppr_fam_insts"><span class="hs-identifier hs-var">ppr_fam_insts</span></a></span><span> </span><span class="annot"><span class="annottext">[FamInst]
</span><a href="#local-6989586621683118027"><span class="hs-identifier hs-var">fam_insts</span></a></span><span>
</span><span id="line-3008"></span><span>         </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">[LRuleDecl GhcTc] -&gt; SDoc
</span><a href="GHC.Tc.Module.html#ppr_rules"><span class="hs-identifier hs-var">ppr_rules</span></a></span><span> </span><span class="annot"><span class="annottext">[LRuleDecl GhcTc]
</span><a href="#local-6989586621683118028"><span class="hs-identifier hs-var">rules</span></a></span><span>
</span><span id="line-3009"></span><span>         </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">String -&gt; SDoc
forall doc. IsLine doc =&gt; String -&gt; doc
</span><a href="GHC.Utils.Outputable.html#text"><span class="hs-identifier hs-var">text</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;Dependent modules:&quot;</span></span><span> </span><span class="annot"><span class="annottext">SDoc -&gt; SDoc -&gt; SDoc
forall doc. IsLine doc =&gt; doc -&gt; doc -&gt; doc
</span><a href="GHC.Utils.Outputable.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a></span><span>
</span><span id="line-3010"></span><span>                </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[(InstalledModule, ModuleNameWithIsBoot)] -&gt; SDoc
forall a. Outputable a =&gt; a -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="annot"><span class="annottext">([(InstalledModule, ModuleNameWithIsBoot)] -&gt; SDoc)
-&gt; (InstalledModuleEnv ModuleNameWithIsBoot
    -&gt; [(InstalledModule, ModuleNameWithIsBoot)])
-&gt; InstalledModuleEnv ModuleNameWithIsBoot
-&gt; SDoc
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">[(InstalledModule, ModuleNameWithIsBoot)]
-&gt; [(InstalledModule, ModuleNameWithIsBoot)]
forall a. Ord a =&gt; [a] -&gt; [a]
</span><span class="hs-identifier hs-var">sort</span></span><span> </span><span class="annot"><span class="annottext">([(InstalledModule, ModuleNameWithIsBoot)]
 -&gt; [(InstalledModule, ModuleNameWithIsBoot)])
-&gt; (InstalledModuleEnv ModuleNameWithIsBoot
    -&gt; [(InstalledModule, ModuleNameWithIsBoot)])
-&gt; InstalledModuleEnv ModuleNameWithIsBoot
-&gt; [(InstalledModule, ModuleNameWithIsBoot)]
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">InstalledModuleEnv ModuleNameWithIsBoot
-&gt; [(InstalledModule, ModuleNameWithIsBoot)]
forall a. InstalledModuleEnv a -&gt; [(InstalledModule, a)]
</span><a href="GHC.Unit.Module.Env.html#installedModuleEnvElts"><span class="hs-identifier hs-var">installedModuleEnvElts</span></a></span><span> </span><span class="annot"><span class="annottext">(InstalledModuleEnv ModuleNameWithIsBoot -&gt; SDoc)
-&gt; InstalledModuleEnv ModuleNameWithIsBoot -&gt; SDoc
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">ImportAvails -&gt; InstalledModuleEnv ModuleNameWithIsBoot
</span><a href="GHC.Unit.Module.Deps.html#imp_direct_dep_mods"><span class="hs-identifier hs-var">imp_direct_dep_mods</span></a></span><span> </span><span class="annot"><span class="annottext">ImportAvails
</span><a href="#local-6989586621683118029"><span class="hs-identifier hs-var">imports</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-3011"></span><span>         </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">String -&gt; SDoc
forall doc. IsLine doc =&gt; String -&gt; doc
</span><a href="GHC.Utils.Outputable.html#text"><span class="hs-identifier hs-var">text</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;Dependent packages:&quot;</span></span><span> </span><span class="annot"><span class="annottext">SDoc -&gt; SDoc -&gt; SDoc
forall doc. IsLine doc =&gt; doc -&gt; doc -&gt; doc
</span><a href="GHC.Utils.Outputable.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a></span><span>
</span><span id="line-3012"></span><span>                </span><span class="annot"><span class="annottext">[UnitId] -&gt; SDoc
forall a. Outputable a =&gt; a -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Set UnitId -&gt; [UnitId]
forall a. Set a -&gt; [a]
</span><a href="../../containers-0.7-5a8f/src/Data.Set.Internal.html#toList"><span class="hs-identifier hs-var">S.toList</span></a></span><span> </span><span class="annot"><span class="annottext">(Set UnitId -&gt; [UnitId]) -&gt; Set UnitId -&gt; [UnitId]
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">ImportAvails -&gt; Set UnitId
</span><a href="GHC.Unit.Module.Deps.html#imp_dep_direct_pkgs"><span class="hs-identifier hs-var">imp_dep_direct_pkgs</span></a></span><span> </span><span class="annot"><span class="annottext">ImportAvails
</span><a href="#local-6989586621683118029"><span class="hs-identifier hs-var">imports</span></a></span><span class="hs-special">)</span><span class="hs-special">]</span><span>
</span><span id="line-3013"></span><span>                </span><span class="hs-comment">-- The use of sort is just to reduce unnecessary</span><span>
</span><span id="line-3014"></span><span>                </span><span class="hs-comment">-- wobbling in testsuite output</span><span>
</span><span id="line-3015"></span><span>
</span><span id="line-3016"></span><span class="annot"><a href="GHC.Tc.Module.html#ppr_rules"><span class="hs-identifier hs-type">ppr_rules</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="Language.Haskell.Syntax.Decls.html#LRuleDecl"><span class="hs-identifier hs-type">LRuleDecl</span></a></span><span> </span><span class="annot"><a href="GHC.Hs.Extension.html#GhcTc"><span class="hs-identifier hs-type">GhcTc</span></a></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Utils.Outputable.html#SDoc"><span class="hs-identifier hs-type">SDoc</span></a></span><span>
</span><span id="line-3017"></span><span id="ppr_rules"><span class="annot"><span class="annottext">ppr_rules :: [LRuleDecl GhcTc] -&gt; SDoc
</span><a href="GHC.Tc.Module.html#ppr_rules"><span class="hs-identifier hs-var hs-var">ppr_rules</span></a></span></span><span> </span><span id="local-6989586621683118042"><span class="annot"><span class="annottext">[LRuleDecl GhcTc]
</span><a href="#local-6989586621683118042"><span class="hs-identifier hs-var">rules</span></a></span></span><span>
</span><span id="line-3018"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Bool -&gt; SDoc -&gt; SDoc
forall doc. IsOutput doc =&gt; Bool -&gt; doc -&gt; doc
</span><a href="GHC.Utils.Outputable.html#ppUnless"><span class="hs-identifier hs-var">ppUnless</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[GenLocated SrcSpanAnnA (RuleDecl GhcTc)] -&gt; Bool
forall a. [a] -&gt; Bool
forall (t :: * -&gt; *) a. Foldable t =&gt; t a -&gt; Bool
</span><span class="hs-identifier hs-var">null</span></span><span> </span><span class="annot"><span class="annottext">[LRuleDecl GhcTc]
[GenLocated SrcSpanAnnA (RuleDecl GhcTc)]
</span><a href="#local-6989586621683118042"><span class="hs-identifier hs-var">rules</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(SDoc -&gt; SDoc) -&gt; SDoc -&gt; SDoc
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-3019"></span><span>    </span><span class="annot"><span class="annottext">SDoc -&gt; Arity -&gt; SDoc -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#hang"><span class="hs-identifier hs-var">hang</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">String -&gt; SDoc
forall doc. IsLine doc =&gt; String -&gt; doc
</span><a href="GHC.Utils.Outputable.html#text"><span class="hs-identifier hs-var">text</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;RULES&quot;</span></span><span class="hs-special">)</span><span>
</span><span id="line-3020"></span><span>       </span><span class="annot"><span class="annottext">Arity
</span><span class="hs-number">2</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[SDoc] -&gt; SDoc
forall doc. IsDoc doc =&gt; [doc] -&gt; doc
</span><a href="GHC.Utils.Outputable.html#vcat"><span class="hs-identifier hs-var">vcat</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(GenLocated SrcSpanAnnA (RuleDecl GhcTc) -&gt; SDoc)
-&gt; [GenLocated SrcSpanAnnA (RuleDecl GhcTc)] -&gt; [SDoc]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><span class="hs-identifier hs-var">map</span></span><span> </span><span class="annot"><span class="annottext">GenLocated SrcSpanAnnA (RuleDecl GhcTc) -&gt; SDoc
forall a. Outputable a =&gt; a -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="annot"><span class="annottext">[LRuleDecl GhcTc]
[GenLocated SrcSpanAnnA (RuleDecl GhcTc)]
</span><a href="#local-6989586621683118042"><span class="hs-identifier hs-var">rules</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-3021"></span><span>
</span><span id="line-3022"></span><span class="annot"><a href="GHC.Tc.Module.html#ppr_types"><span class="hs-identifier hs-type">ppr_types</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Bool</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Types.TypeEnv.html#TypeEnv"><span class="hs-identifier hs-type">TypeEnv</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Utils.Outputable.html#SDoc"><span class="hs-identifier hs-type">SDoc</span></a></span><span>
</span><span id="line-3023"></span><span id="ppr_types"><span class="annot"><span class="annottext">ppr_types :: Bool -&gt; TypeEnv -&gt; SDoc
</span><a href="GHC.Tc.Module.html#ppr_types"><span class="hs-identifier hs-var hs-var">ppr_types</span></a></span></span><span> </span><span id="local-6989586621683118045"><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621683118045"><span class="hs-identifier hs-var">debug</span></a></span></span><span> </span><span id="local-6989586621683118046"><span class="annot"><span class="annottext">TypeEnv
</span><a href="#local-6989586621683118046"><span class="hs-identifier hs-var">type_env</span></a></span></span><span>
</span><span id="line-3024"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">String -&gt; (Id -&gt; SDoc) -&gt; [Id] -&gt; SDoc
forall a. String -&gt; (a -&gt; SDoc) -&gt; [a] -&gt; SDoc
</span><a href="GHC.Tc.Module.html#ppr_things"><span class="hs-identifier hs-var">ppr_things</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;TYPE SIGNATURES&quot;</span></span><span> </span><span class="annot"><span class="annottext">Id -&gt; SDoc
</span><a href="#local-6989586621683118048"><span class="hs-identifier hs-var">ppr_sig</span></a></span><span>
</span><span id="line-3025"></span><span>             </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(Id -&gt; Id -&gt; Ordering) -&gt; [Id] -&gt; [Id]
forall a. (a -&gt; a -&gt; Ordering) -&gt; [a] -&gt; [a]
</span><span class="hs-identifier hs-var">sortBy</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(Id -&gt; OccName) -&gt; Id -&gt; Id -&gt; Ordering
forall a b. Ord a =&gt; (b -&gt; a) -&gt; b -&gt; b -&gt; Ordering
</span><span class="hs-identifier hs-var">comparing</span></span><span> </span><span class="annot"><span class="annottext">Id -&gt; OccName
forall a. NamedThing a =&gt; a -&gt; OccName
</span><a href="GHC.Types.Name.html#getOccName"><span class="hs-identifier hs-var">getOccName</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[Id]
</span><a href="#local-6989586621683118051"><span class="hs-identifier hs-var">ids</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-3026"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-3027"></span><span>    </span><span id="local-6989586621683118051"><span class="annot"><span class="annottext">ids :: [Id]
</span><a href="#local-6989586621683118051"><span class="hs-identifier hs-var hs-var">ids</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">Id
</span><a href="#local-6989586621683118052"><span class="hs-identifier hs-var">id</span></a></span><span> </span><span class="hs-glyph">|</span><span> </span><span id="local-6989586621683118052"><span class="annot"><span class="annottext">Id
</span><a href="#local-6989586621683118052"><span class="hs-identifier hs-var">id</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">TypeEnv -&gt; [Id]
</span><a href="GHC.Types.TypeEnv.html#typeEnvIds"><span class="hs-identifier hs-var">typeEnvIds</span></a></span><span> </span><span class="annot"><span class="annottext">TypeEnv
</span><a href="#local-6989586621683118046"><span class="hs-identifier hs-var">type_env</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Id -&gt; Bool
</span><a href="#local-6989586621683118053"><span class="hs-identifier hs-var">want_sig</span></a></span><span> </span><span class="annot"><span class="annottext">Id
</span><a href="#local-6989586621683118052"><span class="hs-identifier hs-var">id</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-3028"></span><span>    </span><span id="local-6989586621683118053"><span class="annot"><span class="annottext">want_sig :: Id -&gt; Bool
</span><a href="#local-6989586621683118053"><span class="hs-identifier hs-var hs-var">want_sig</span></a></span></span><span> </span><span id="local-6989586621683118054"><span class="annot"><span class="annottext">Id
</span><a href="#local-6989586621683118054"><span class="hs-identifier hs-var">id</span></a></span></span><span>
</span><span id="line-3029"></span><span>      </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621683118045"><span class="hs-identifier hs-var">debug</span></a></span><span>     </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">True</span></span><span>
</span><span id="line-3030"></span><span>      </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">otherwise</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Id -&gt; Bool
forall x. NamedThing x =&gt; x -&gt; Bool
</span><a href="GHC.Tc.Module.html#hasTopUserName"><span class="hs-identifier hs-var">hasTopUserName</span></a></span><span> </span><span class="annot"><span class="annottext">Id
</span><a href="#local-6989586621683118054"><span class="hs-identifier hs-var">id</span></a></span><span>
</span><span id="line-3031"></span><span>                    </span><span class="annot"><span class="annottext">Bool -&gt; Bool -&gt; Bool
</span><span class="hs-operator hs-var">&amp;&amp;</span></span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">Id -&gt; IdDetails
</span><a href="GHC.Types.Var.html#idDetails"><span class="hs-identifier hs-var">idDetails</span></a></span><span> </span><span class="annot"><span class="annottext">Id
</span><a href="#local-6989586621683118054"><span class="hs-identifier hs-var">id</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-3032"></span><span>                         </span><span class="annot"><span class="annottext">IdDetails
</span><a href="GHC.Types.Id.Info.html#VanillaId"><span class="hs-identifier hs-var">VanillaId</span></a></span><span>              </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">True</span></span><span>
</span><span id="line-3033"></span><span>                         </span><span class="annot"><a href="GHC.Types.Id.Info.html#WorkerLikeId"><span class="hs-identifier hs-type">WorkerLikeId</span></a></span><span> </span><span class="hs-special">{</span><span class="hs-special">}</span><span>        </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">True</span></span><span>
</span><span id="line-3034"></span><span>                         </span><span class="annot"><a href="GHC.Types.Id.Info.html#RecSelId"><span class="hs-identifier hs-type">RecSelId</span></a></span><span> </span><span class="hs-special">{</span><span class="hs-special">}</span><span>            </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">True</span></span><span>
</span><span id="line-3035"></span><span>                         </span><span class="annot"><a href="GHC.Types.Id.Info.html#ClassOpId"><span class="hs-identifier hs-type">ClassOpId</span></a></span><span> </span><span class="hs-special">{</span><span class="hs-special">}</span><span>           </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">True</span></span><span>
</span><span id="line-3036"></span><span>                         </span><span class="annot"><a href="GHC.Types.Id.Info.html#FCallId"><span class="hs-identifier hs-type">FCallId</span></a></span><span> </span><span class="hs-special">{</span><span class="hs-special">}</span><span>             </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">True</span></span><span>
</span><span id="line-3037"></span><span>                         </span><span class="annot"><span class="annottext">IdDetails
</span><span class="hs-identifier">_</span></span><span>                      </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">False</span></span><span>
</span><span id="line-3038"></span><span>             </span><span class="hs-comment">-- Data cons (workers and wrappers), pattern synonyms,</span><span>
</span><span id="line-3039"></span><span>             </span><span class="hs-comment">-- etc are suppressed (unless -dppr-debug),</span><span>
</span><span id="line-3040"></span><span>             </span><span class="hs-comment">-- because they appear elsewhere</span><span>
</span><span id="line-3041"></span><span>
</span><span id="line-3042"></span><span>    </span><span id="local-6989586621683118048"><span class="annot"><span class="annottext">ppr_sig :: Id -&gt; SDoc
</span><a href="#local-6989586621683118048"><span class="hs-identifier hs-var hs-var">ppr_sig</span></a></span></span><span> </span><span id="local-6989586621683118065"><span class="annot"><span class="annottext">Id
</span><a href="#local-6989586621683118065"><span class="hs-identifier hs-var">id</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">SDoc -&gt; Arity -&gt; SDoc -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#hang"><span class="hs-identifier hs-var">hang</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Id -&gt; SDoc
forall a. OutputableBndr a =&gt; a -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#pprPrefixOcc"><span class="hs-identifier hs-var">pprPrefixOcc</span></a></span><span> </span><span class="annot"><span class="annottext">Id
</span><a href="#local-6989586621683118065"><span class="hs-identifier hs-var">id</span></a></span><span> </span><span class="annot"><span class="annottext">SDoc -&gt; SDoc -&gt; SDoc
forall doc. IsLine doc =&gt; doc -&gt; doc -&gt; doc
</span><a href="GHC.Utils.Outputable.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">SDoc
</span><a href="GHC.Utils.Outputable.html#dcolon"><span class="hs-identifier hs-var">dcolon</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Arity
</span><span class="hs-number">2</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Type -&gt; SDoc
forall a. Outputable a =&gt; a -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Type -&gt; Type
</span><a href="GHC.Core.TyCo.Tidy.html#tidyTopType"><span class="hs-identifier hs-var">tidyTopType</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Id -&gt; Type
</span><a href="GHC.Types.Id.html#idType"><span class="hs-identifier hs-var">idType</span></a></span><span> </span><span class="annot"><span class="annottext">Id
</span><a href="#local-6989586621683118065"><span class="hs-identifier hs-var">id</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-3043"></span><span>
</span><span id="line-3044"></span><span class="annot"><a href="GHC.Tc.Module.html#ppr_tycons"><span class="hs-identifier hs-type">ppr_tycons</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Bool</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="GHC.Core.FamInstEnv.html#FamInst"><span class="hs-identifier hs-type">FamInst</span></a></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Types.TypeEnv.html#TypeEnv"><span class="hs-identifier hs-type">TypeEnv</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Utils.Outputable.html#SDoc"><span class="hs-identifier hs-type">SDoc</span></a></span><span>
</span><span id="line-3045"></span><span id="ppr_tycons"><span class="annot"><span class="annottext">ppr_tycons :: Bool -&gt; [FamInst] -&gt; TypeEnv -&gt; SDoc
</span><a href="GHC.Tc.Module.html#ppr_tycons"><span class="hs-identifier hs-var hs-var">ppr_tycons</span></a></span></span><span> </span><span id="local-6989586621683118068"><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621683118068"><span class="hs-identifier hs-var">debug</span></a></span></span><span> </span><span id="local-6989586621683118069"><span class="annot"><span class="annottext">[FamInst]
</span><a href="#local-6989586621683118069"><span class="hs-identifier hs-var">fam_insts</span></a></span></span><span> </span><span id="local-6989586621683118070"><span class="annot"><span class="annottext">TypeEnv
</span><a href="#local-6989586621683118070"><span class="hs-identifier hs-var">type_env</span></a></span></span><span>
</span><span id="line-3046"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[SDoc] -&gt; SDoc
forall doc. IsDoc doc =&gt; [doc] -&gt; doc
</span><a href="GHC.Utils.Outputable.html#vcat"><span class="hs-identifier hs-var">vcat</span></a></span><span> </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">String -&gt; (TyCon -&gt; SDoc) -&gt; [TyCon] -&gt; SDoc
forall a. String -&gt; (a -&gt; SDoc) -&gt; [a] -&gt; SDoc
</span><a href="GHC.Tc.Module.html#ppr_things"><span class="hs-identifier hs-var">ppr_things</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;TYPE CONSTRUCTORS&quot;</span></span><span> </span><span class="annot"><span class="annottext">TyCon -&gt; SDoc
</span><a href="#local-6989586621683118071"><span class="hs-identifier hs-var">ppr_tc</span></a></span><span> </span><span class="annot"><span class="annottext">[TyCon]
</span><a href="#local-6989586621683118072"><span class="hs-identifier hs-var">tycons</span></a></span><span>
</span><span id="line-3047"></span><span>         </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">String -&gt; (CoAxiom Branched -&gt; SDoc) -&gt; [CoAxiom Branched] -&gt; SDoc
forall a. String -&gt; (a -&gt; SDoc) -&gt; [a] -&gt; SDoc
</span><a href="GHC.Tc.Module.html#ppr_things"><span class="hs-identifier hs-var">ppr_things</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;COERCION AXIOMS&quot;</span></span><span> </span><span class="annot"><span class="annottext">CoAxiom Branched -&gt; SDoc
forall {br :: BranchFlag}. CoAxiom br -&gt; SDoc
</span><a href="#local-6989586621683118073"><span class="hs-identifier hs-var">ppr_ax</span></a></span><span>
</span><span id="line-3048"></span><span>                      </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TypeEnv -&gt; [CoAxiom Branched]
</span><a href="GHC.Types.TypeEnv.html#typeEnvCoAxioms"><span class="hs-identifier hs-var">typeEnvCoAxioms</span></a></span><span> </span><span class="annot"><span class="annottext">TypeEnv
</span><a href="#local-6989586621683118070"><span class="hs-identifier hs-var">type_env</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">]</span><span>
</span><span id="line-3049"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-3050"></span><span>    </span><span id="local-6989586621683118075"><span class="annot"><span class="annottext">fi_tycons :: [TyCon]
</span><a href="#local-6989586621683118075"><span class="hs-identifier hs-var hs-var">fi_tycons</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[FamInst] -&gt; [TyCon]
</span><a href="GHC.Core.FamInstEnv.html#famInstsRepTyCons"><span class="hs-identifier hs-var">famInstsRepTyCons</span></a></span><span> </span><span class="annot"><span class="annottext">[FamInst]
</span><a href="#local-6989586621683118069"><span class="hs-identifier hs-var">fam_insts</span></a></span><span>
</span><span id="line-3051"></span><span>
</span><span id="line-3052"></span><span>    </span><span id="local-6989586621683118072"><span class="annot"><span class="annottext">tycons :: [TyCon]
</span><a href="#local-6989586621683118072"><span class="hs-identifier hs-var hs-var">tycons</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(TyCon -&gt; TyCon -&gt; Ordering) -&gt; [TyCon] -&gt; [TyCon]
forall a. (a -&gt; a -&gt; Ordering) -&gt; [a] -&gt; [a]
</span><span class="hs-identifier hs-var">sortBy</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(TyCon -&gt; OccName) -&gt; TyCon -&gt; TyCon -&gt; Ordering
forall a b. Ord a =&gt; (b -&gt; a) -&gt; b -&gt; b -&gt; Ordering
</span><span class="hs-identifier hs-var">comparing</span></span><span> </span><span class="annot"><span class="annottext">TyCon -&gt; OccName
forall a. NamedThing a =&gt; a -&gt; OccName
</span><a href="GHC.Types.Name.html#getOccName"><span class="hs-identifier hs-var">getOccName</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">([TyCon] -&gt; [TyCon]) -&gt; [TyCon] -&gt; [TyCon]
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-3053"></span><span>             </span><span class="hs-special">[</span><span class="annot"><span class="annottext">TyCon
</span><a href="#local-6989586621683118076"><span class="hs-identifier hs-var">tycon</span></a></span><span> </span><span class="hs-glyph">|</span><span> </span><span id="local-6989586621683118076"><span class="annot"><span class="annottext">TyCon
</span><a href="#local-6989586621683118076"><span class="hs-identifier hs-var">tycon</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">TypeEnv -&gt; [TyCon]
</span><a href="GHC.Types.TypeEnv.html#typeEnvTyCons"><span class="hs-identifier hs-var">typeEnvTyCons</span></a></span><span> </span><span class="annot"><span class="annottext">TypeEnv
</span><a href="#local-6989586621683118070"><span class="hs-identifier hs-var">type_env</span></a></span><span>
</span><span id="line-3054"></span><span>                    </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">TyCon -&gt; Bool
</span><a href="#local-6989586621683118078"><span class="hs-identifier hs-var">want_tycon</span></a></span><span> </span><span class="annot"><span class="annottext">TyCon
</span><a href="#local-6989586621683118076"><span class="hs-identifier hs-var">tycon</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-3055"></span><span>             </span><span class="hs-comment">-- Sort by OccName to reduce unnecessary changes</span><span>
</span><span id="line-3056"></span><span>    </span><span id="local-6989586621683118078"><span class="annot"><span class="annottext">want_tycon :: TyCon -&gt; Bool
</span><a href="#local-6989586621683118078"><span class="hs-identifier hs-var hs-var">want_tycon</span></a></span></span><span> </span><span id="local-6989586621683118079"><span class="annot"><span class="annottext">TyCon
</span><a href="#local-6989586621683118079"><span class="hs-identifier hs-var">tycon</span></a></span></span><span> </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621683118068"><span class="hs-identifier hs-var">debug</span></a></span><span>      </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">True</span></span><span>
</span><span id="line-3057"></span><span>                     </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">otherwise</span></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Name -&gt; Bool
</span><a href="GHC.Types.Name.html#isExternalName"><span class="hs-identifier hs-var">isExternalName</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TyCon -&gt; Name
</span><a href="GHC.Core.TyCon.html#tyConName"><span class="hs-identifier hs-var">tyConName</span></a></span><span> </span><span class="annot"><span class="annottext">TyCon
</span><a href="#local-6989586621683118079"><span class="hs-identifier hs-var">tycon</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Bool -&gt; Bool
</span><span class="hs-operator hs-var">&amp;&amp;</span></span><span>
</span><span id="line-3058"></span><span>                                    </span><span class="annot"><span class="annottext">Bool -&gt; Bool
</span><span class="hs-identifier hs-var">not</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TyCon
</span><a href="#local-6989586621683118079"><span class="hs-identifier hs-var">tycon</span></a></span><span> </span><span class="annot"><span class="annottext">TyCon -&gt; [TyCon] -&gt; Bool
forall a. Eq a =&gt; a -&gt; [a] -&gt; Bool
forall (t :: * -&gt; *) a. (Foldable t, Eq a) =&gt; a -&gt; t a -&gt; Bool
</span><span class="hs-operator hs-var">`elem`</span></span><span> </span><span class="annot"><span class="annottext">[TyCon]
</span><a href="#local-6989586621683118075"><span class="hs-identifier hs-var">fi_tycons</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-3059"></span><span>    </span><span id="local-6989586621683118071"><span class="annot"><span class="annottext">ppr_tc :: TyCon -&gt; SDoc
</span><a href="#local-6989586621683118071"><span class="hs-identifier hs-var hs-var">ppr_tc</span></a></span></span><span> </span><span id="local-6989586621683118081"><span class="annot"><span class="annottext">TyCon
</span><a href="#local-6989586621683118081"><span class="hs-identifier hs-var">tc</span></a></span></span><span>
</span><span id="line-3060"></span><span>       </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[SDoc] -&gt; SDoc
forall doc. IsDoc doc =&gt; [doc] -&gt; doc
</span><a href="GHC.Utils.Outputable.html#vcat"><span class="hs-identifier hs-var">vcat</span></a></span><span> </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">SDoc -&gt; Arity -&gt; SDoc -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#hang"><span class="hs-identifier hs-var">hang</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TyConFlavour TyCon -&gt; SDoc
forall a. Outputable a =&gt; a -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TyCon -&gt; TyConFlavour TyCon
</span><a href="GHC.Core.TyCon.html#tyConFlavour"><span class="hs-identifier hs-var">tyConFlavour</span></a></span><span> </span><span class="annot"><span class="annottext">TyCon
</span><a href="#local-6989586621683118081"><span class="hs-identifier hs-var">tc</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">SDoc -&gt; SDoc -&gt; SDoc
forall doc. IsLine doc =&gt; doc -&gt; doc -&gt; doc
</span><a href="GHC.Utils.Outputable.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">Name -&gt; SDoc
forall a. OutputableBndr a =&gt; a -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#pprPrefixOcc"><span class="hs-identifier hs-var">pprPrefixOcc</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TyCon -&gt; Name
</span><a href="GHC.Core.TyCon.html#tyConName"><span class="hs-identifier hs-var">tyConName</span></a></span><span> </span><span class="annot"><span class="annottext">TyCon
</span><a href="#local-6989586621683118081"><span class="hs-identifier hs-var">tc</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-3061"></span><span>                      </span><span class="annot"><span class="annottext">SDoc -&gt; SDoc -&gt; SDoc
forall doc. IsLine doc =&gt; doc -&gt; doc -&gt; doc
</span><a href="GHC.Utils.Outputable.html#%3C%3E"><span class="hs-operator hs-var">&lt;&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">SDoc -&gt; SDoc
forall doc. IsLine doc =&gt; doc -&gt; doc
</span><a href="GHC.Utils.Outputable.html#braces"><span class="hs-identifier hs-var">braces</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Arity -&gt; SDoc
forall a. Outputable a =&gt; a -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TyCon -&gt; Arity
</span><a href="GHC.Core.TyCon.html#tyConArity"><span class="hs-identifier hs-var">tyConArity</span></a></span><span> </span><span class="annot"><span class="annottext">TyCon
</span><a href="#local-6989586621683118081"><span class="hs-identifier hs-var">tc</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">SDoc -&gt; SDoc -&gt; SDoc
forall doc. IsLine doc =&gt; doc -&gt; doc -&gt; doc
</span><a href="GHC.Utils.Outputable.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">SDoc
</span><a href="GHC.Utils.Outputable.html#dcolon"><span class="hs-identifier hs-var">dcolon</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-3062"></span><span>                   </span><span class="annot"><span class="annottext">Arity
</span><span class="hs-number">2</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Type -&gt; SDoc
forall a. Outputable a =&gt; a -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Type -&gt; Type
</span><a href="GHC.Core.TyCo.Tidy.html#tidyTopType"><span class="hs-identifier hs-var">tidyTopType</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TyCon -&gt; Type
</span><a href="GHC.Core.TyCon.html#tyConKind"><span class="hs-identifier hs-var">tyConKind</span></a></span><span> </span><span class="annot"><span class="annottext">TyCon
</span><a href="#local-6989586621683118081"><span class="hs-identifier hs-var">tc</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-3063"></span><span>              </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Arity -&gt; SDoc -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#nest"><span class="hs-identifier hs-var">nest</span></a></span><span> </span><span class="annot"><span class="annottext">Arity
</span><span class="hs-number">2</span></span><span> </span><span class="annot"><span class="annottext">(SDoc -&gt; SDoc) -&gt; SDoc -&gt; SDoc
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-3064"></span><span>                </span><span class="annot"><span class="annottext">Bool -&gt; SDoc -&gt; SDoc
forall doc. IsOutput doc =&gt; Bool -&gt; doc -&gt; doc
</span><a href="GHC.Utils.Outputable.html#ppWhen"><span class="hs-identifier hs-var">ppWhen</span></a></span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621683118088"><span class="hs-identifier hs-var">show_roles</span></a></span><span> </span><span class="annot"><span class="annottext">(SDoc -&gt; SDoc) -&gt; SDoc -&gt; SDoc
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-3065"></span><span>                </span><span class="annot"><span class="annottext">String -&gt; SDoc
forall doc. IsLine doc =&gt; String -&gt; doc
</span><a href="GHC.Utils.Outputable.html#text"><span class="hs-identifier hs-var">text</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;roles&quot;</span></span><span> </span><span class="annot"><span class="annottext">SDoc -&gt; SDoc -&gt; SDoc
forall doc. IsLine doc =&gt; doc -&gt; doc -&gt; doc
</span><a href="GHC.Utils.Outputable.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[SDoc] -&gt; SDoc
forall doc. IsLine doc =&gt; [doc] -&gt; doc
</span><a href="GHC.Utils.Outputable.html#sep"><span class="hs-identifier hs-var">sep</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(Role -&gt; SDoc) -&gt; [Role] -&gt; [SDoc]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><span class="hs-identifier hs-var">map</span></span><span> </span><span class="annot"><span class="annottext">Role -&gt; SDoc
forall a. Outputable a =&gt; a -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="annot"><span class="annottext">[Role]
</span><a href="#local-6989586621683118090"><span class="hs-identifier hs-var">roles</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-special">]</span><span>
</span><span id="line-3066"></span><span>       </span><span class="hs-keyword">where</span><span>
</span><span id="line-3067"></span><span>         </span><span id="local-6989586621683118088"><span class="annot"><span class="annottext">show_roles :: Bool
</span><a href="#local-6989586621683118088"><span class="hs-identifier hs-var hs-var">show_roles</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621683118068"><span class="hs-identifier hs-var">debug</span></a></span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Bool -&gt; Bool
</span><span class="hs-operator hs-var">||</span></span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Bool
</span><span class="hs-identifier hs-var">not</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(Role -&gt; Bool) -&gt; [Role] -&gt; Bool
forall (t :: * -&gt; *) a. Foldable t =&gt; (a -&gt; Bool) -&gt; t a -&gt; Bool
</span><span class="hs-identifier hs-var">all</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Role -&gt; Role -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">==</span></span><span> </span><span class="annot"><span class="annottext">Role
</span><a href="#local-6989586621683118091"><span class="hs-identifier hs-var">boring_role</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[Role]
</span><a href="#local-6989586621683118090"><span class="hs-identifier hs-var">roles</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-3068"></span><span>         </span><span id="local-6989586621683118090"><span class="annot"><span class="annottext">roles :: [Role]
</span><a href="#local-6989586621683118090"><span class="hs-identifier hs-var hs-var">roles</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">TyCon -&gt; [Role]
</span><a href="GHC.Core.TyCon.html#tyConRoles"><span class="hs-identifier hs-var">tyConRoles</span></a></span><span> </span><span class="annot"><span class="annottext">TyCon
</span><a href="#local-6989586621683118081"><span class="hs-identifier hs-var">tc</span></a></span><span>
</span><span id="line-3069"></span><span>         </span><span id="local-6989586621683118091"><span class="annot"><span class="annottext">boring_role :: Role
</span><a href="#local-6989586621683118091"><span class="hs-identifier hs-var hs-var">boring_role</span></a></span></span><span> </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">TyCon -&gt; Bool
</span><a href="GHC.Core.TyCon.html#isClassTyCon"><span class="hs-identifier hs-var">isClassTyCon</span></a></span><span> </span><span class="annot"><span class="annottext">TyCon
</span><a href="#local-6989586621683118081"><span class="hs-identifier hs-var">tc</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Role
</span><a href="Language.Haskell.Syntax.Basic.html#Nominal"><span class="hs-identifier hs-var">Nominal</span></a></span><span>
</span><span id="line-3070"></span><span>                     </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">otherwise</span></span><span>       </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Role
</span><a href="Language.Haskell.Syntax.Basic.html#Representational"><span class="hs-identifier hs-var">Representational</span></a></span><span>
</span><span id="line-3071"></span><span>            </span><span class="hs-comment">-- Matches the choice in GHC.Iface.Syntax, calls to pprRoles</span><span>
</span><span id="line-3072"></span><span>
</span><span id="line-3073"></span><span>    </span><span id="local-6989586621683118073"><span class="annot"><span class="annottext">ppr_ax :: CoAxiom br -&gt; SDoc
</span><a href="#local-6989586621683118073"><span class="hs-identifier hs-var hs-var">ppr_ax</span></a></span></span><span> </span><span id="local-6989586621683118095"><span class="annot"><span class="annottext">CoAxiom br
</span><a href="#local-6989586621683118095"><span class="hs-identifier hs-var">ax</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">IfaceDecl -&gt; SDoc
forall a. Outputable a =&gt; a -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">CoAxiom br -&gt; IfaceDecl
forall (br :: BranchFlag). CoAxiom br -&gt; IfaceDecl
</span><a href="GHC.Iface.Decl.html#coAxiomToIfaceDecl"><span class="hs-identifier hs-var">coAxiomToIfaceDecl</span></a></span><span> </span><span class="annot"><span class="annottext">CoAxiom br
</span><a href="#local-6989586621683118095"><span class="hs-identifier hs-var">ax</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-3074"></span><span>      </span><span class="hs-comment">-- We go via IfaceDecl rather than using pprCoAxiom</span><span>
</span><span id="line-3075"></span><span>      </span><span class="hs-comment">-- This way we get the full axiom (both LHS and RHS) with</span><span>
</span><span id="line-3076"></span><span>      </span><span class="hs-comment">-- wildcard binders tidied to _1, _2, etc.</span><span>
</span><span id="line-3077"></span><span>
</span><span id="line-3078"></span><span class="annot"><a href="GHC.Tc.Module.html#ppr_datacons"><span class="hs-identifier hs-type">ppr_datacons</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Bool</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Types.TypeEnv.html#TypeEnv"><span class="hs-identifier hs-type">TypeEnv</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Utils.Outputable.html#SDoc"><span class="hs-identifier hs-type">SDoc</span></a></span><span>
</span><span id="line-3079"></span><span id="ppr_datacons"><span class="annot"><span class="annottext">ppr_datacons :: Bool -&gt; TypeEnv -&gt; SDoc
</span><a href="GHC.Tc.Module.html#ppr_datacons"><span class="hs-identifier hs-var hs-var">ppr_datacons</span></a></span></span><span> </span><span id="local-6989586621683118096"><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621683118096"><span class="hs-identifier hs-var">debug</span></a></span></span><span> </span><span id="local-6989586621683118097"><span class="annot"><span class="annottext">TypeEnv
</span><a href="#local-6989586621683118097"><span class="hs-identifier hs-var">type_env</span></a></span></span><span>
</span><span id="line-3080"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">String -&gt; (DataCon -&gt; SDoc) -&gt; [DataCon] -&gt; SDoc
forall a. String -&gt; (a -&gt; SDoc) -&gt; [a] -&gt; SDoc
</span><a href="GHC.Tc.Module.html#ppr_things"><span class="hs-identifier hs-var">ppr_things</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;DATA CONSTRUCTORS&quot;</span></span><span> </span><span class="annot"><span class="annottext">DataCon -&gt; SDoc
</span><a href="#local-6989586621683118098"><span class="hs-identifier hs-var">ppr_dc</span></a></span><span> </span><span class="annot"><span class="annottext">[DataCon]
</span><a href="#local-6989586621683118099"><span class="hs-identifier hs-var">wanted_dcs</span></a></span><span>
</span><span id="line-3081"></span><span>      </span><span class="hs-comment">-- The filter gets rid of class data constructors</span><span>
</span><span id="line-3082"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-3083"></span><span>    </span><span id="local-6989586621683118098"><span class="annot"><span class="annottext">ppr_dc :: DataCon -&gt; SDoc
</span><a href="#local-6989586621683118098"><span class="hs-identifier hs-var hs-var">ppr_dc</span></a></span></span><span> </span><span id="local-6989586621683118105"><span class="annot"><span class="annottext">DataCon
</span><a href="#local-6989586621683118105"><span class="hs-identifier hs-var">dc</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(SDocContext -&gt; Bool) -&gt; (Bool -&gt; SDoc) -&gt; SDoc
forall a. (SDocContext -&gt; a) -&gt; (a -&gt; SDoc) -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#sdocOption"><span class="hs-identifier hs-var">sdocOption</span></a></span><span> </span><span class="annot"><span class="annottext">SDocContext -&gt; Bool
</span><a href="GHC.Utils.Outputable.html#sdocLinearTypes"><span class="hs-identifier hs-var">sdocLinearTypes</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span id="local-6989586621683118108"><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621683118108"><span class="hs-identifier hs-var">show_linear_types</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-3084"></span><span>                </span><span class="annot"><span class="annottext">DataCon -&gt; SDoc
forall a. Outputable a =&gt; a -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="annot"><span class="annottext">DataCon
</span><a href="#local-6989586621683118105"><span class="hs-identifier hs-var">dc</span></a></span><span> </span><span class="annot"><span class="annottext">SDoc -&gt; SDoc -&gt; SDoc
forall doc. IsLine doc =&gt; doc -&gt; doc -&gt; doc
</span><a href="GHC.Utils.Outputable.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">SDoc
</span><a href="GHC.Utils.Outputable.html#dcolon"><span class="hs-identifier hs-var">dcolon</span></a></span><span> </span><span class="annot"><span class="annottext">SDoc -&gt; SDoc -&gt; SDoc
forall doc. IsLine doc =&gt; doc -&gt; doc -&gt; doc
</span><a href="GHC.Utils.Outputable.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">Type -&gt; SDoc
forall a. Outputable a =&gt; a -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Bool -&gt; DataCon -&gt; Type
</span><a href="GHC.Core.DataCon.html#dataConDisplayType"><span class="hs-identifier hs-var">dataConDisplayType</span></a></span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621683118108"><span class="hs-identifier hs-var">show_linear_types</span></a></span><span> </span><span class="annot"><span class="annottext">DataCon
</span><a href="#local-6989586621683118105"><span class="hs-identifier hs-var">dc</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-3085"></span><span>    </span><span id="local-6989586621683118110"><span class="annot"><span class="annottext">all_dcs :: [DataCon]
</span><a href="#local-6989586621683118110"><span class="hs-identifier hs-var hs-var">all_dcs</span></a></span></span><span>    </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">TypeEnv -&gt; [DataCon]
</span><a href="GHC.Types.TypeEnv.html#typeEnvDataCons"><span class="hs-identifier hs-var">typeEnvDataCons</span></a></span><span> </span><span class="annot"><span class="annottext">TypeEnv
</span><a href="#local-6989586621683118097"><span class="hs-identifier hs-var">type_env</span></a></span><span>
</span><span id="line-3086"></span><span>    </span><span id="local-6989586621683118099"><span class="annot"><span class="annottext">wanted_dcs :: [DataCon]
</span><a href="#local-6989586621683118099"><span class="hs-identifier hs-var hs-var">wanted_dcs</span></a></span></span><span> </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621683118096"><span class="hs-identifier hs-var">debug</span></a></span><span>     </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[DataCon]
</span><a href="#local-6989586621683118110"><span class="hs-identifier hs-var">all_dcs</span></a></span><span>
</span><span id="line-3087"></span><span>               </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">otherwise</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(DataCon -&gt; Bool) -&gt; [DataCon] -&gt; [DataCon]
forall a. (a -&gt; Bool) -&gt; [a] -&gt; [a]
</span><a href="GHC.Utils.Misc.html#filterOut"><span class="hs-identifier hs-var">filterOut</span></a></span><span> </span><span class="annot"><span class="annottext">DataCon -&gt; Bool
</span><a href="#local-6989586621683118113"><span class="hs-identifier hs-var">is_cls_dc</span></a></span><span> </span><span class="annot"><span class="annottext">[DataCon]
</span><a href="#local-6989586621683118110"><span class="hs-identifier hs-var">all_dcs</span></a></span><span>
</span><span id="line-3088"></span><span>    </span><span id="local-6989586621683118113"><span class="annot"><span class="annottext">is_cls_dc :: DataCon -&gt; Bool
</span><a href="#local-6989586621683118113"><span class="hs-identifier hs-var hs-var">is_cls_dc</span></a></span></span><span> </span><span id="local-6989586621683118114"><span class="annot"><span class="annottext">DataCon
</span><a href="#local-6989586621683118114"><span class="hs-identifier hs-var">dc</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">TyCon -&gt; Bool
</span><a href="GHC.Core.TyCon.html#isClassTyCon"><span class="hs-identifier hs-var">isClassTyCon</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">DataCon -&gt; TyCon
</span><a href="GHC.Core.DataCon.html#dataConTyCon"><span class="hs-identifier hs-var">dataConTyCon</span></a></span><span> </span><span class="annot"><span class="annottext">DataCon
</span><a href="#local-6989586621683118114"><span class="hs-identifier hs-var">dc</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-3089"></span><span>
</span><span id="line-3090"></span><span class="annot"><a href="GHC.Tc.Module.html#ppr_patsyns"><span class="hs-identifier hs-type">ppr_patsyns</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Types.TypeEnv.html#TypeEnv"><span class="hs-identifier hs-type">TypeEnv</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Utils.Outputable.html#SDoc"><span class="hs-identifier hs-type">SDoc</span></a></span><span>
</span><span id="line-3091"></span><span id="ppr_patsyns"><span class="annot"><span class="annottext">ppr_patsyns :: TypeEnv -&gt; SDoc
</span><a href="GHC.Tc.Module.html#ppr_patsyns"><span class="hs-identifier hs-var hs-var">ppr_patsyns</span></a></span></span><span> </span><span id="local-6989586621683118116"><span class="annot"><span class="annottext">TypeEnv
</span><a href="#local-6989586621683118116"><span class="hs-identifier hs-var">type_env</span></a></span></span><span>
</span><span id="line-3092"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">String -&gt; (PatSyn -&gt; SDoc) -&gt; [PatSyn] -&gt; SDoc
forall a. String -&gt; (a -&gt; SDoc) -&gt; [a] -&gt; SDoc
</span><a href="GHC.Tc.Module.html#ppr_things"><span class="hs-identifier hs-var">ppr_things</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;PATTERN SYNONYMS&quot;</span></span><span> </span><span class="annot"><span class="annottext">PatSyn -&gt; SDoc
</span><a href="#local-6989586621683118117"><span class="hs-identifier hs-var">ppr_ps</span></a></span><span>
</span><span id="line-3093"></span><span>               </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TypeEnv -&gt; [PatSyn]
</span><a href="GHC.Types.TypeEnv.html#typeEnvPatSyns"><span class="hs-identifier hs-var">typeEnvPatSyns</span></a></span><span> </span><span class="annot"><span class="annottext">TypeEnv
</span><a href="#local-6989586621683118116"><span class="hs-identifier hs-var">type_env</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-3094"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-3095"></span><span>    </span><span id="local-6989586621683118117"><span class="annot"><span class="annottext">ppr_ps :: PatSyn -&gt; SDoc
</span><a href="#local-6989586621683118117"><span class="hs-identifier hs-var hs-var">ppr_ps</span></a></span></span><span> </span><span id="local-6989586621683118123"><span class="annot"><span class="annottext">PatSyn
</span><a href="#local-6989586621683118123"><span class="hs-identifier hs-var">ps</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">PatSyn -&gt; SDoc
forall a. OutputableBndr a =&gt; a -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#pprPrefixOcc"><span class="hs-identifier hs-var">pprPrefixOcc</span></a></span><span> </span><span class="annot"><span class="annottext">PatSyn
</span><a href="#local-6989586621683118123"><span class="hs-identifier hs-var">ps</span></a></span><span> </span><span class="annot"><span class="annottext">SDoc -&gt; SDoc -&gt; SDoc
forall doc. IsLine doc =&gt; doc -&gt; doc -&gt; doc
</span><a href="GHC.Utils.Outputable.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">SDoc
</span><a href="GHC.Utils.Outputable.html#dcolon"><span class="hs-identifier hs-var">dcolon</span></a></span><span> </span><span class="annot"><span class="annottext">SDoc -&gt; SDoc -&gt; SDoc
forall doc. IsLine doc =&gt; doc -&gt; doc -&gt; doc
</span><a href="GHC.Utils.Outputable.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">PatSyn -&gt; SDoc
</span><a href="GHC.Core.PatSyn.html#pprPatSynType"><span class="hs-identifier hs-var">pprPatSynType</span></a></span><span> </span><span class="annot"><span class="annottext">PatSyn
</span><a href="#local-6989586621683118123"><span class="hs-identifier hs-var">ps</span></a></span><span>
</span><span id="line-3096"></span><span>
</span><span id="line-3097"></span><span class="annot"><a href="GHC.Tc.Module.html#ppr_insts"><span class="hs-identifier hs-type">ppr_insts</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="GHC.Core.InstEnv.html#ClsInst"><span class="hs-identifier hs-type">ClsInst</span></a></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Utils.Outputable.html#SDoc"><span class="hs-identifier hs-type">SDoc</span></a></span><span>
</span><span id="line-3098"></span><span id="ppr_insts"><span class="annot"><span class="annottext">ppr_insts :: [ClsInst] -&gt; SDoc
</span><a href="GHC.Tc.Module.html#ppr_insts"><span class="hs-identifier hs-var hs-var">ppr_insts</span></a></span></span><span> </span><span id="local-6989586621683118125"><span class="annot"><span class="annottext">[ClsInst]
</span><a href="#local-6989586621683118125"><span class="hs-identifier hs-var">ispecs</span></a></span></span><span>
</span><span id="line-3099"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">String -&gt; (ClsInst -&gt; SDoc) -&gt; [ClsInst] -&gt; SDoc
forall a. String -&gt; (a -&gt; SDoc) -&gt; [a] -&gt; SDoc
</span><a href="GHC.Tc.Module.html#ppr_things"><span class="hs-identifier hs-var">ppr_things</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;CLASS INSTANCES&quot;</span></span><span> </span><span class="annot"><span class="annottext">ClsInst -&gt; SDoc
</span><a href="GHC.Core.InstEnv.html#pprInstance"><span class="hs-identifier hs-var">pprInstance</span></a></span><span> </span><span class="annot"><span class="annottext">[ClsInst]
</span><a href="#local-6989586621683118125"><span class="hs-identifier hs-var">ispecs</span></a></span><span>
</span><span id="line-3100"></span><span>
</span><span id="line-3101"></span><span class="annot"><a href="GHC.Tc.Module.html#ppr_fam_insts"><span class="hs-identifier hs-type">ppr_fam_insts</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="GHC.Core.FamInstEnv.html#FamInst"><span class="hs-identifier hs-type">FamInst</span></a></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Utils.Outputable.html#SDoc"><span class="hs-identifier hs-type">SDoc</span></a></span><span>
</span><span id="line-3102"></span><span id="ppr_fam_insts"><span class="annot"><span class="annottext">ppr_fam_insts :: [FamInst] -&gt; SDoc
</span><a href="GHC.Tc.Module.html#ppr_fam_insts"><span class="hs-identifier hs-var hs-var">ppr_fam_insts</span></a></span></span><span> </span><span id="local-6989586621683118127"><span class="annot"><span class="annottext">[FamInst]
</span><a href="#local-6989586621683118127"><span class="hs-identifier hs-var">fam_insts</span></a></span></span><span>
</span><span id="line-3103"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">String -&gt; (FamInst -&gt; SDoc) -&gt; [FamInst] -&gt; SDoc
forall a. String -&gt; (a -&gt; SDoc) -&gt; [a] -&gt; SDoc
</span><a href="GHC.Tc.Module.html#ppr_things"><span class="hs-identifier hs-var">ppr_things</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;FAMILY INSTANCES&quot;</span></span><span> </span><span class="annot"><span class="annottext">FamInst -&gt; SDoc
</span><a href="GHC.Core.FamInstEnv.html#pprFamInst"><span class="hs-identifier hs-var">pprFamInst</span></a></span><span> </span><span class="annot"><span class="annottext">[FamInst]
</span><a href="#local-6989586621683118127"><span class="hs-identifier hs-var">fam_insts</span></a></span><span>
</span><span id="line-3104"></span><span>
</span><span id="line-3105"></span><span id="local-6989586621683115399"><span class="annot"><a href="GHC.Tc.Module.html#ppr_things"><span class="hs-identifier hs-type">ppr_things</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">String</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621683115399"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Utils.Outputable.html#SDoc"><span class="hs-identifier hs-type">SDoc</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="#local-6989586621683115399"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Utils.Outputable.html#SDoc"><span class="hs-identifier hs-type">SDoc</span></a></span></span><span>
</span><span id="line-3106"></span><span id="ppr_things"><span class="annot"><span class="annottext">ppr_things :: forall a. String -&gt; (a -&gt; SDoc) -&gt; [a] -&gt; SDoc
</span><a href="GHC.Tc.Module.html#ppr_things"><span class="hs-identifier hs-var hs-var">ppr_things</span></a></span></span><span> </span><span id="local-6989586621683118133"><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621683118133"><span class="hs-identifier hs-var">herald</span></a></span></span><span> </span><span id="local-6989586621683118134"><span class="annot"><span class="annottext">a -&gt; SDoc
</span><a href="#local-6989586621683118134"><span class="hs-identifier hs-var">ppr_one</span></a></span></span><span> </span><span id="local-6989586621683118135"><span class="annot"><span class="annottext">[a]
</span><a href="#local-6989586621683118135"><span class="hs-identifier hs-var">things</span></a></span></span><span>
</span><span id="line-3107"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">[a] -&gt; Bool
forall a. [a] -&gt; Bool
forall (t :: * -&gt; *) a. Foldable t =&gt; t a -&gt; Bool
</span><span class="hs-identifier hs-var">null</span></span><span> </span><span class="annot"><span class="annottext">[a]
</span><a href="#local-6989586621683118135"><span class="hs-identifier hs-var">things</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">SDoc
forall doc. IsOutput doc =&gt; doc
</span><a href="GHC.Utils.Outputable.html#empty"><span class="hs-identifier hs-var">empty</span></a></span><span>
</span><span id="line-3108"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">otherwise</span></span><span>   </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">String -&gt; SDoc
forall doc. IsLine doc =&gt; String -&gt; doc
</span><a href="GHC.Utils.Outputable.html#text"><span class="hs-identifier hs-var">text</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621683118133"><span class="hs-identifier hs-var">herald</span></a></span><span> </span><span class="annot"><span class="annottext">SDoc -&gt; SDoc -&gt; SDoc
forall doc. IsDoc doc =&gt; doc -&gt; doc -&gt; doc
</span><a href="GHC.Utils.Outputable.html#%24%24"><span class="hs-operator hs-var">$$</span></a></span><span> </span><span class="annot"><span class="annottext">Arity -&gt; SDoc -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#nest"><span class="hs-identifier hs-var">nest</span></a></span><span> </span><span class="annot"><span class="annottext">Arity
</span><span class="hs-number">2</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[SDoc] -&gt; SDoc
forall doc. IsDoc doc =&gt; [doc] -&gt; doc
</span><a href="GHC.Utils.Outputable.html#vcat"><span class="hs-identifier hs-var">vcat</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(a -&gt; SDoc) -&gt; [a] -&gt; [SDoc]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><span class="hs-identifier hs-var">map</span></span><span> </span><span class="annot"><span class="annottext">a -&gt; SDoc
</span><a href="#local-6989586621683118134"><span class="hs-identifier hs-var">ppr_one</span></a></span><span> </span><span class="annot"><span class="annottext">[a]
</span><a href="#local-6989586621683118135"><span class="hs-identifier hs-var">things</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-3109"></span><span>
</span><span id="line-3110"></span><span id="local-6989586621683115403"><span class="annot"><a href="GHC.Tc.Module.html#hasTopUserName"><span class="hs-identifier hs-type">hasTopUserName</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Types.Name.html#NamedThing"><span class="hs-identifier hs-type">NamedThing</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683115403"><span class="hs-identifier hs-type">x</span></a></span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="#local-6989586621683115403"><span class="hs-identifier hs-type">x</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Bool</span></span></span><span>
</span><span id="line-3111"></span><span class="hs-comment">-- A top-level thing whose name is not &quot;derived&quot;</span><span>
</span><span id="line-3112"></span><span class="hs-comment">-- Thus excluding things like $tcX, from Typeable boilerplate</span><span>
</span><span id="line-3113"></span><span class="hs-comment">-- and C:Coll from class-dictionary data constructors</span><span>
</span><span id="line-3114"></span><span id="hasTopUserName"><span class="annot"><span class="annottext">hasTopUserName :: forall x. NamedThing x =&gt; x -&gt; Bool
</span><a href="GHC.Tc.Module.html#hasTopUserName"><span class="hs-identifier hs-var hs-var">hasTopUserName</span></a></span></span><span> </span><span id="local-6989586621683118138"><span class="annot"><span class="annottext">x
</span><a href="#local-6989586621683118138"><span class="hs-identifier hs-var">x</span></a></span></span><span>
</span><span id="line-3115"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Name -&gt; Bool
</span><a href="GHC.Types.Name.html#isExternalName"><span class="hs-identifier hs-var">isExternalName</span></a></span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621683118139"><span class="hs-identifier hs-var">name</span></a></span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Bool -&gt; Bool
</span><span class="hs-operator hs-var">&amp;&amp;</span></span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Bool
</span><span class="hs-identifier hs-var">not</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">OccName -&gt; Bool
</span><a href="GHC.Types.Name.Occurrence.html#isDerivedOccName"><span class="hs-identifier hs-var">isDerivedOccName</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Name -&gt; OccName
</span><a href="GHC.Types.Name.html#nameOccName"><span class="hs-identifier hs-var">nameOccName</span></a></span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621683118139"><span class="hs-identifier hs-var">name</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-3116"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-3117"></span><span>    </span><span id="local-6989586621683118139"><span class="annot"><span class="annottext">name :: Name
</span><a href="#local-6989586621683118139"><span class="hs-identifier hs-var hs-var">name</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">x -&gt; Name
forall a. NamedThing a =&gt; a -&gt; Name
</span><a href="GHC.Types.Name.html#getName"><span class="hs-identifier hs-var">getName</span></a></span><span> </span><span class="annot"><span class="annottext">x
</span><a href="#local-6989586621683118138"><span class="hs-identifier hs-var">x</span></a></span><span>
</span><span id="line-3118"></span><span>
</span><span id="line-3119"></span><span class="hs-comment">{-
********************************************************************************

Type Checker Plugins

********************************************************************************
-}</span><span>
</span><span id="line-3126"></span><span>
</span><span id="line-3127"></span><span id="local-6989586621683114821"><span class="annot"><a href="GHC.Tc.Module.html#withTcPlugins"><span class="hs-identifier hs-type">withTcPlugins</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Driver.Env.Types.html#HscEnv"><span class="hs-identifier hs-type">HscEnv</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#TcM"><span class="hs-identifier hs-type">TcM</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683114821"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#TcM"><span class="hs-identifier hs-type">TcM</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683114821"><span class="hs-identifier hs-type">a</span></a></span></span><span>
</span><span id="line-3128"></span><span id="withTcPlugins"><span class="annot"><span class="annottext">withTcPlugins :: forall a. HscEnv -&gt; TcM a -&gt; TcM a
</span><a href="GHC.Tc.Module.html#withTcPlugins"><span class="hs-identifier hs-var hs-var">withTcPlugins</span></a></span></span><span> </span><span id="local-6989586621683118150"><span class="annot"><span class="annottext">HscEnv
</span><a href="#local-6989586621683118150"><span class="hs-identifier hs-var">hsc_env</span></a></span></span><span> </span><span id="local-6989586621683118151"><span class="annot"><span class="annottext">TcM a
</span><a href="#local-6989586621683118151"><span class="hs-identifier hs-var">m</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-3129"></span><span>    </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">[Maybe TcPlugin] -&gt; [TcPlugin]
forall a. [Maybe a] -&gt; [a]
</span><span class="hs-identifier hs-var">catMaybes</span></span><span> </span><span class="annot"><span class="annottext">([Maybe TcPlugin] -&gt; [TcPlugin]) -&gt; [Maybe TcPlugin] -&gt; [TcPlugin]
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Plugins
-&gt; (Plugin -&gt; [String] -&gt; Maybe TcPlugin) -&gt; [Maybe TcPlugin]
forall a. Plugins -&gt; (Plugin -&gt; [String] -&gt; a) -&gt; [a]
</span><a href="GHC.Driver.Plugins.html#mapPlugins"><span class="hs-identifier hs-var">mapPlugins</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">HscEnv -&gt; Plugins
</span><a href="GHC.Driver.Env.Types.html#hsc_plugins"><span class="hs-identifier hs-var">hsc_plugins</span></a></span><span> </span><span class="annot"><span class="annottext">HscEnv
</span><a href="#local-6989586621683118150"><span class="hs-identifier hs-var">hsc_env</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Plugin -&gt; [String] -&gt; Maybe TcPlugin
</span><a href="GHC.Driver.Plugins.html#tcPlugin"><span class="hs-identifier hs-var">tcPlugin</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-3130"></span><span>       </span><span class="hs-special">[</span><span class="hs-special">]</span><span>      </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">TcM a
</span><a href="#local-6989586621683118151"><span class="hs-identifier hs-var">m</span></a></span><span>  </span><span class="hs-comment">-- Common fast case</span><span>
</span><span id="line-3131"></span><span>       </span><span id="local-6989586621683118156"><span class="annot"><span class="annottext">[TcPlugin]
</span><a href="#local-6989586621683118156"><span class="hs-identifier hs-var">plugins</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-3132"></span><span>                </span><span class="hs-special">(</span><span id="local-6989586621683118157"><span class="annot"><a href="#local-6989586621683118157"><span class="hs-identifier hs-var">solvers</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621683118158"><span class="annot"><a href="#local-6989586621683118158"><span class="hs-identifier hs-var">rewriters</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621683118159"><span class="annot"><a href="#local-6989586621683118159"><span class="hs-identifier hs-var">stops</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span>
</span><span id="line-3133"></span><span>                  </span><span class="annot"><span class="annottext">[(TcPluginSolver, UniqFM TyCon TcPluginRewriter, TcPluginM ())]
-&gt; ([TcPluginSolver], [UniqFM TyCon TcPluginRewriter],
    [TcPluginM ()])
forall a b c. [(a, b, c)] -&gt; ([a], [b], [c])
</span><span class="hs-identifier hs-var">unzip3</span></span><span> </span><span class="annot"><span class="annottext">([(TcPluginSolver, UniqFM TyCon TcPluginRewriter, TcPluginM ())]
 -&gt; ([TcPluginSolver], [UniqFM TyCon TcPluginRewriter],
     [TcPluginM ()]))
-&gt; IOEnv
     (Env TcGblEnv TcLclEnv)
     [(TcPluginSolver, UniqFM TyCon TcPluginRewriter, TcPluginM ())]
-&gt; IOEnv
     (Env TcGblEnv TcLclEnv)
     ([TcPluginSolver], [UniqFM TyCon TcPluginRewriter], [TcPluginM ()])
forall a b.
(a -&gt; b)
-&gt; IOEnv (Env TcGblEnv TcLclEnv) a
-&gt; IOEnv (Env TcGblEnv TcLclEnv) b
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">`fmap`</span></span><span> </span><span class="annot"><span class="annottext">(TcPlugin
 -&gt; IOEnv
      (Env TcGblEnv TcLclEnv)
      (TcPluginSolver, UniqFM TyCon TcPluginRewriter, TcPluginM ()))
-&gt; [TcPlugin]
-&gt; IOEnv
     (Env TcGblEnv TcLclEnv)
     [(TcPluginSolver, UniqFM TyCon TcPluginRewriter, TcPluginM ())]
forall (t :: * -&gt; *) (m :: * -&gt; *) a b.
(Traversable t, Monad m) =&gt;
(a -&gt; m b) -&gt; t a -&gt; m (t b)
forall (m :: * -&gt; *) a b. Monad m =&gt; (a -&gt; m b) -&gt; [a] -&gt; m [b]
</span><span class="hs-identifier hs-var">mapM</span></span><span> </span><span class="annot"><span class="annottext">TcPlugin
-&gt; IOEnv
     (Env TcGblEnv TcLclEnv)
     (TcPluginSolver, UniqFM TyCon TcPluginRewriter, TcPluginM ())
</span><a href="#local-6989586621683118161"><span class="hs-identifier hs-var">start_plugin</span></a></span><span> </span><span class="annot"><span class="annottext">[TcPlugin]
</span><a href="#local-6989586621683118156"><span class="hs-identifier hs-var">plugins</span></a></span><span>
</span><span id="line-3134"></span><span>                </span><span class="hs-keyword">let</span><span>
</span><span id="line-3135"></span><span>                  </span><span class="annot"><a href="#local-6989586621683118162"><span class="hs-identifier hs-type">rewritersUniqFM</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Types.Unique.FM.html#UniqFM"><span class="hs-identifier hs-type">UniqFM</span></a></span><span> </span><span class="annot"><a href="GHC.Core.TyCon.html#TyCon"><span class="hs-identifier hs-type">TyCon</span></a></span><span> </span><span class="hs-special">[</span><span class="annot"><a href="GHC.Tc.Types.html#TcPluginRewriter"><span class="hs-identifier hs-type">TcPluginRewriter</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-3136"></span><span>                  </span><span class="hs-glyph">!</span><span id="local-6989586621683118162"><span class="annot"><a href="#local-6989586621683118162"><span class="hs-identifier hs-var hs-var">rewritersUniqFM</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[UniqFM TyCon TcPluginRewriter] -&gt; UniqFM TyCon [TcPluginRewriter]
forall {k} (key :: k) elt. [UniqFM key elt] -&gt; UniqFM key [elt]
</span><a href="GHC.Types.Unique.FM.html#sequenceUFMList"><span class="hs-identifier hs-var">sequenceUFMList</span></a></span><span> </span><span class="annot"><span class="annottext">[UniqFM TyCon TcPluginRewriter]
</span><a href="#local-6989586621683118158"><span class="hs-identifier hs-var">rewriters</span></a></span><span>
</span><span id="line-3137"></span><span>                </span><span class="hs-comment">-- The following ensures that tcPluginStop is called even if a type</span><span>
</span><span id="line-3138"></span><span>                </span><span class="hs-comment">-- error occurs during compilation (Fix of #10078)</span><span>
</span><span id="line-3139"></span><span>                </span><span id="local-6989586621683118164"><span class="annot"><a href="#local-6989586621683118164"><span class="hs-identifier hs-var">eitherRes</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><a href="GHC.Data.IOEnv.html#tryM"><span class="hs-identifier hs-type">tryM</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span>
</span><span id="line-3140"></span><span>                  </span><span class="annot"><a href="GHC.Tc.Utils.Monad.html#updGblEnv"><span class="hs-identifier hs-type">updGblEnv</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span id="local-6989586621683118166"><span class="annot"><span class="annottext">TcGblEnv
</span><a href="#local-6989586621683118166"><span class="hs-identifier hs-var">e</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">TcGblEnv
</span><a href="#local-6989586621683118166"><span class="hs-identifier hs-var">e</span></a></span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#tcg_tc_plugin_solvers"><span class="hs-identifier hs-var">tcg_tc_plugin_solvers</span></a></span><span>   </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="#local-6989586621683118157"><span class="hs-identifier hs-type">solvers</span></a></span><span>
</span><span id="line-3141"></span><span>                                     </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#tcg_tc_plugin_rewriters"><span class="hs-identifier hs-var">tcg_tc_plugin_rewriters</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="#local-6989586621683118162"><span class="hs-identifier hs-type">rewritersUniqFM</span></a></span><span> </span><span class="hs-special">}</span><span class="hs-special">)</span><span> </span><span class="annot"><a href="#local-6989586621683118151"><span class="hs-identifier hs-type">m</span></a></span><span>
</span><span id="line-3142"></span><span>                </span><span class="annot"><span class="hs-identifier hs-type">mapM_</span></span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#runTcPluginM"><span class="hs-identifier hs-var">runTcPluginM</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683118159"><span class="hs-identifier hs-type">stops</span></a></span><span>
</span><span id="line-3143"></span><span>                </span><span class="hs-keyword">case</span><span> </span><span class="annot"><a href="#local-6989586621683118164"><span class="hs-identifier hs-type">eitherRes</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-3144"></span><span>                  </span><span class="annot"><span class="hs-identifier hs-type">Left</span></span><span> </span><span class="annot"><span class="annottext">IOEnvFailure
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">TcM a
forall env a. IOEnv env a
</span><a href="GHC.Data.IOEnv.html#failM"><span class="hs-identifier hs-var">failM</span></a></span><span>
</span><span id="line-3145"></span><span>                  </span><span class="annot"><span class="hs-identifier hs-type">Right</span></span><span> </span><span id="local-6989586621683118170"><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621683118170"><span class="hs-identifier hs-var">res</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">a -&gt; TcM a
forall a. a -&gt; IOEnv (Env TcGblEnv TcLclEnv) a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621683118170"><span class="hs-identifier hs-var">res</span></a></span><span>
</span><span id="line-3146"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-3147"></span><span>  </span><span id="local-6989586621683118161"><span class="annot"><span class="annottext">start_plugin :: TcPlugin
-&gt; IOEnv
     (Env TcGblEnv TcLclEnv)
     (TcPluginSolver, UniqFM TyCon TcPluginRewriter, TcPluginM ())
</span><a href="#local-6989586621683118161"><span class="hs-identifier hs-var hs-var">start_plugin</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Tc.Types.html#TcPlugin"><span class="hs-identifier hs-type">TcPlugin</span></a></span><span> </span><span id="local-6989586621683118174"><span class="annot"><span class="annottext">TcPluginM s
</span><a href="#local-6989586621683118174"><span class="hs-identifier hs-var">start</span></a></span></span><span> </span><span id="local-6989586621683118175"><span class="annot"><span class="annottext">s -&gt; TcPluginSolver
</span><a href="#local-6989586621683118175"><span class="hs-identifier hs-var">solve</span></a></span></span><span> </span><span id="local-6989586621683118176"><span class="annot"><span class="annottext">s -&gt; UniqFM TyCon TcPluginRewriter
</span><a href="#local-6989586621683118176"><span class="hs-identifier hs-var">rewrite</span></a></span></span><span> </span><span id="local-6989586621683118177"><span class="annot"><span class="annottext">s -&gt; TcPluginM ()
</span><a href="#local-6989586621683118177"><span class="hs-identifier hs-var">stop</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-3148"></span><span>    </span><span class="hs-keyword">do</span><span> </span><span id="local-6989586621683118178"><span class="annot"><a href="#local-6989586621683118178"><span class="hs-identifier hs-var">s</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">TcPluginM s -&gt; TcM s
forall a. TcPluginM a -&gt; TcM a
</span><a href="GHC.Tc.Types.html#runTcPluginM"><span class="hs-identifier hs-var">runTcPluginM</span></a></span><span> </span><span class="annot"><span class="annottext">TcPluginM s
</span><a href="#local-6989586621683118174"><span class="hs-identifier hs-var">start</span></a></span><span>
</span><span id="line-3149"></span><span>       </span><span class="annot"><span class="hs-identifier hs-type">return</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621683118175"><span class="hs-identifier hs-type">solve</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683118178"><span class="hs-identifier hs-type">s</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="#local-6989586621683118176"><span class="hs-identifier hs-type">rewrite</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683118178"><span class="hs-identifier hs-type">s</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="#local-6989586621683118177"><span class="hs-identifier hs-type">stop</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683118178"><span class="hs-identifier hs-type">s</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-3150"></span><span>
</span><span id="line-3151"></span><span id="local-6989586621683118179"><span class="annot"><a href="GHC.Tc.Module.html#withDefaultingPlugins"><span class="hs-identifier hs-type">withDefaultingPlugins</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Driver.Env.Types.html#HscEnv"><span class="hs-identifier hs-type">HscEnv</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#TcM"><span class="hs-identifier hs-type">TcM</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683118179"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#TcM"><span class="hs-identifier hs-type">TcM</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683118179"><span class="hs-identifier hs-type">a</span></a></span></span><span>
</span><span id="line-3152"></span><span id="withDefaultingPlugins"><span class="annot"><span class="annottext">withDefaultingPlugins :: forall a. HscEnv -&gt; TcM a -&gt; TcM a
</span><a href="GHC.Tc.Module.html#withDefaultingPlugins"><span class="hs-identifier hs-var hs-var">withDefaultingPlugins</span></a></span></span><span> </span><span id="local-6989586621683118187"><span class="annot"><span class="annottext">HscEnv
</span><a href="#local-6989586621683118187"><span class="hs-identifier hs-var">hsc_env</span></a></span></span><span> </span><span id="local-6989586621683118188"><span class="annot"><span class="annottext">TcM a
</span><a href="#local-6989586621683118188"><span class="hs-identifier hs-var">m</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-3153"></span><span>  </span><span class="hs-keyword">do</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">[Maybe DefaultingPlugin] -&gt; [DefaultingPlugin]
forall a. [Maybe a] -&gt; [a]
</span><span class="hs-identifier hs-var">catMaybes</span></span><span> </span><span class="annot"><span class="annottext">([Maybe DefaultingPlugin] -&gt; [DefaultingPlugin])
-&gt; [Maybe DefaultingPlugin] -&gt; [DefaultingPlugin]
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Plugins
-&gt; (Plugin -&gt; [String] -&gt; Maybe DefaultingPlugin)
-&gt; [Maybe DefaultingPlugin]
forall a. Plugins -&gt; (Plugin -&gt; [String] -&gt; a) -&gt; [a]
</span><a href="GHC.Driver.Plugins.html#mapPlugins"><span class="hs-identifier hs-var">mapPlugins</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">HscEnv -&gt; Plugins
</span><a href="GHC.Driver.Env.Types.html#hsc_plugins"><span class="hs-identifier hs-var">hsc_plugins</span></a></span><span> </span><span class="annot"><span class="annottext">HscEnv
</span><a href="#local-6989586621683118187"><span class="hs-identifier hs-var">hsc_env</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Plugin -&gt; [String] -&gt; Maybe DefaultingPlugin
</span><a href="GHC.Driver.Plugins.html#defaultingPlugin"><span class="hs-identifier hs-var">defaultingPlugin</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-3154"></span><span>       </span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">TcM a
</span><a href="#local-6989586621683118188"><span class="hs-identifier hs-var">m</span></a></span><span>  </span><span class="hs-comment">-- Common fast case</span><span>
</span><span id="line-3155"></span><span>       </span><span id="local-6989586621683118190"><span class="annot"><span class="annottext">[DefaultingPlugin]
</span><a href="#local-6989586621683118190"><span class="hs-identifier hs-var">plugins</span></a></span></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">(</span><span id="local-6989586621683118191"><span class="annot"><a href="#local-6989586621683118191"><span class="hs-identifier hs-var">plugins</span></a></span></span><span class="hs-special">,</span><span id="local-6989586621683118192"><span class="annot"><a href="#local-6989586621683118192"><span class="hs-identifier hs-var">stops</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">(DefaultingPlugin
 -&gt; IOEnv (Env TcGblEnv TcLclEnv) (FillDefaulting, TcPluginM ()))
-&gt; [DefaultingPlugin]
-&gt; IOEnv (Env TcGblEnv TcLclEnv) ([FillDefaulting], [TcPluginM ()])
forall (m :: * -&gt; *) a b c.
Applicative m =&gt;
(a -&gt; m (b, c)) -&gt; [a] -&gt; m ([b], [c])
</span><span class="hs-identifier hs-var">mapAndUnzipM</span></span><span> </span><span class="annot"><span class="annottext">DefaultingPlugin
-&gt; IOEnv (Env TcGblEnv TcLclEnv) (FillDefaulting, TcPluginM ())
</span><a href="#local-6989586621683118194"><span class="hs-identifier hs-var">start_plugin</span></a></span><span> </span><span class="annot"><span class="annottext">[DefaultingPlugin]
</span><a href="#local-6989586621683118190"><span class="hs-identifier hs-var">plugins</span></a></span><span>
</span><span id="line-3156"></span><span>                      </span><span class="hs-comment">-- This ensures that dePluginStop is called even if a type</span><span>
</span><span id="line-3157"></span><span>                      </span><span class="hs-comment">-- error occurs during compilation</span><span>
</span><span id="line-3158"></span><span>                      </span><span id="local-6989586621683118195"><span class="annot"><a href="#local-6989586621683118195"><span class="hs-identifier hs-var">eitherRes</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><a href="GHC.Data.IOEnv.html#tryM"><span class="hs-identifier hs-type">tryM</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-3159"></span><span>                        </span><span class="annot"><a href="GHC.Tc.Utils.Monad.html#updGblEnv"><span class="hs-identifier hs-type">updGblEnv</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span id="local-6989586621683118196"><span class="annot"><span class="annottext">TcGblEnv
</span><a href="#local-6989586621683118196"><span class="hs-identifier hs-var">e</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">TcGblEnv
</span><a href="#local-6989586621683118196"><span class="hs-identifier hs-var">e</span></a></span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#tcg_defaulting_plugins"><span class="hs-identifier hs-var">tcg_defaulting_plugins</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="#local-6989586621683118191"><span class="hs-identifier hs-type">plugins</span></a></span><span> </span><span class="hs-special">}</span><span class="hs-special">)</span><span> </span><span class="annot"><a href="#local-6989586621683118188"><span class="hs-identifier hs-type">m</span></a></span><span>
</span><span id="line-3160"></span><span>                      </span><span class="annot"><span class="hs-identifier hs-type">mapM_</span></span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#runTcPluginM"><span class="hs-identifier hs-var">runTcPluginM</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683118192"><span class="hs-identifier hs-type">stops</span></a></span><span>
</span><span id="line-3161"></span><span>                      </span><span class="hs-keyword">case</span><span> </span><span class="annot"><a href="#local-6989586621683118195"><span class="hs-identifier hs-type">eitherRes</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-3162"></span><span>                        </span><span class="annot"><span class="hs-identifier hs-type">Left</span></span><span> </span><span class="annot"><span class="annottext">IOEnvFailure
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">TcM a
forall env a. IOEnv env a
</span><a href="GHC.Data.IOEnv.html#failM"><span class="hs-identifier hs-var">failM</span></a></span><span>
</span><span id="line-3163"></span><span>                        </span><span class="annot"><span class="hs-identifier hs-type">Right</span></span><span> </span><span id="local-6989586621683118198"><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621683118198"><span class="hs-identifier hs-var">res</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">a -&gt; TcM a
forall a. a -&gt; IOEnv (Env TcGblEnv TcLclEnv) a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621683118198"><span class="hs-identifier hs-var">res</span></a></span><span>
</span><span id="line-3164"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-3165"></span><span>  </span><span id="local-6989586621683118194"><span class="annot"><span class="annottext">start_plugin :: DefaultingPlugin
-&gt; IOEnv (Env TcGblEnv TcLclEnv) (FillDefaulting, TcPluginM ())
</span><a href="#local-6989586621683118194"><span class="hs-identifier hs-var hs-var">start_plugin</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Tc.Types.html#DefaultingPlugin"><span class="hs-identifier hs-type">DefaultingPlugin</span></a></span><span> </span><span id="local-6989586621683118202"><span class="annot"><span class="annottext">TcPluginM s
</span><a href="#local-6989586621683118202"><span class="hs-identifier hs-var">start</span></a></span></span><span> </span><span id="local-6989586621683118203"><span class="annot"><span class="annottext">s -&gt; FillDefaulting
</span><a href="#local-6989586621683118203"><span class="hs-identifier hs-var">fill</span></a></span></span><span> </span><span id="local-6989586621683118204"><span class="annot"><span class="annottext">s -&gt; TcPluginM ()
</span><a href="#local-6989586621683118204"><span class="hs-identifier hs-var">stop</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-3166"></span><span>    </span><span class="hs-keyword">do</span><span> </span><span id="local-6989586621683118205"><span class="annot"><a href="#local-6989586621683118205"><span class="hs-identifier hs-var">s</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">TcPluginM s -&gt; TcM s
forall a. TcPluginM a -&gt; TcM a
</span><a href="GHC.Tc.Types.html#runTcPluginM"><span class="hs-identifier hs-var">runTcPluginM</span></a></span><span> </span><span class="annot"><span class="annottext">TcPluginM s
</span><a href="#local-6989586621683118202"><span class="hs-identifier hs-var">start</span></a></span><span>
</span><span id="line-3167"></span><span>       </span><span class="annot"><span class="hs-identifier hs-type">return</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621683118203"><span class="hs-identifier hs-type">fill</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683118205"><span class="hs-identifier hs-type">s</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="#local-6989586621683118204"><span class="hs-identifier hs-type">stop</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683118205"><span class="hs-identifier hs-type">s</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-3168"></span><span>
</span><span id="line-3169"></span><span id="local-6989586621683118206"><span class="annot"><a href="GHC.Tc.Module.html#withHoleFitPlugins"><span class="hs-identifier hs-type">withHoleFitPlugins</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Driver.Env.Types.html#HscEnv"><span class="hs-identifier hs-type">HscEnv</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#TcM"><span class="hs-identifier hs-type">TcM</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683118206"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#TcM"><span class="hs-identifier hs-type">TcM</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683118206"><span class="hs-identifier hs-type">a</span></a></span></span><span>
</span><span id="line-3170"></span><span id="withHoleFitPlugins"><span class="annot"><span class="annottext">withHoleFitPlugins :: forall a. HscEnv -&gt; TcM a -&gt; TcM a
</span><a href="GHC.Tc.Module.html#withHoleFitPlugins"><span class="hs-identifier hs-var hs-var">withHoleFitPlugins</span></a></span></span><span> </span><span id="local-6989586621683118214"><span class="annot"><span class="annottext">HscEnv
</span><a href="#local-6989586621683118214"><span class="hs-identifier hs-var">hsc_env</span></a></span></span><span> </span><span id="local-6989586621683118215"><span class="annot"><span class="annottext">TcM a
</span><a href="#local-6989586621683118215"><span class="hs-identifier hs-var">m</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-3171"></span><span>  </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">[Maybe HoleFitPluginR] -&gt; [HoleFitPluginR]
forall a. [Maybe a] -&gt; [a]
</span><span class="hs-identifier hs-var">catMaybes</span></span><span> </span><span class="annot"><span class="annottext">([Maybe HoleFitPluginR] -&gt; [HoleFitPluginR])
-&gt; [Maybe HoleFitPluginR] -&gt; [HoleFitPluginR]
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Plugins
-&gt; (Plugin -&gt; [String] -&gt; Maybe HoleFitPluginR)
-&gt; [Maybe HoleFitPluginR]
forall a. Plugins -&gt; (Plugin -&gt; [String] -&gt; a) -&gt; [a]
</span><a href="GHC.Driver.Plugins.html#mapPlugins"><span class="hs-identifier hs-var">mapPlugins</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">HscEnv -&gt; Plugins
</span><a href="GHC.Driver.Env.Types.html#hsc_plugins"><span class="hs-identifier hs-var">hsc_plugins</span></a></span><span> </span><span class="annot"><span class="annottext">HscEnv
</span><a href="#local-6989586621683118214"><span class="hs-identifier hs-var">hsc_env</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Plugin -&gt; [String] -&gt; Maybe HoleFitPluginR
</span><a href="GHC.Driver.Plugins.html#holeFitPlugin"><span class="hs-identifier hs-var">holeFitPlugin</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-3172"></span><span>    </span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">TcM a
</span><a href="#local-6989586621683118215"><span class="hs-identifier hs-var">m</span></a></span><span>  </span><span class="hs-comment">-- Common fast case</span><span>
</span><span id="line-3173"></span><span>    </span><span id="local-6989586621683118217"><span class="annot"><span class="annottext">[HoleFitPluginR]
</span><a href="#local-6989586621683118217"><span class="hs-identifier hs-var">plugins</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">(</span><span id="local-6989586621683118218"><span class="annot"><a href="#local-6989586621683118218"><span class="hs-identifier hs-var">plugins</span></a></span></span><span class="hs-special">,</span><span id="local-6989586621683118219"><span class="annot"><a href="#local-6989586621683118219"><span class="hs-identifier hs-var">stops</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">(HoleFitPluginR
 -&gt; IOEnv
      (Env TcGblEnv TcLclEnv)
      (HoleFitPlugin, IOEnv (Env TcGblEnv TcLclEnv) ()))
-&gt; [HoleFitPluginR]
-&gt; IOEnv
     (Env TcGblEnv TcLclEnv)
     ([HoleFitPlugin], [IOEnv (Env TcGblEnv TcLclEnv) ()])
forall (m :: * -&gt; *) a b c.
Applicative m =&gt;
(a -&gt; m (b, c)) -&gt; [a] -&gt; m ([b], [c])
</span><span class="hs-identifier hs-var">mapAndUnzipM</span></span><span> </span><span class="annot"><span class="annottext">HoleFitPluginR
-&gt; IOEnv
     (Env TcGblEnv TcLclEnv)
     (HoleFitPlugin, IOEnv (Env TcGblEnv TcLclEnv) ())
</span><a href="#local-6989586621683118220"><span class="hs-identifier hs-var">start_plugin</span></a></span><span> </span><span class="annot"><span class="annottext">[HoleFitPluginR]
</span><a href="#local-6989586621683118217"><span class="hs-identifier hs-var">plugins</span></a></span><span>
</span><span id="line-3174"></span><span>                  </span><span class="hs-comment">-- This ensures that hfPluginStop is called even if a type</span><span>
</span><span id="line-3175"></span><span>                  </span><span class="hs-comment">-- error occurs during compilation.</span><span>
</span><span id="line-3176"></span><span>                  </span><span id="local-6989586621683118221"><span class="annot"><a href="#local-6989586621683118221"><span class="hs-identifier hs-var">eitherRes</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><a href="GHC.Data.IOEnv.html#tryM"><span class="hs-identifier hs-type">tryM</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span>
</span><span id="line-3177"></span><span>                    </span><span class="annot"><a href="GHC.Tc.Utils.Monad.html#updGblEnv"><span class="hs-identifier hs-type">updGblEnv</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span id="local-6989586621683118222"><span class="annot"><span class="annottext">TcGblEnv
</span><a href="#local-6989586621683118222"><span class="hs-identifier hs-var">e</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">TcGblEnv
</span><a href="#local-6989586621683118222"><span class="hs-identifier hs-var">e</span></a></span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#tcg_hf_plugins"><span class="hs-identifier hs-var">tcg_hf_plugins</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="#local-6989586621683118218"><span class="hs-identifier hs-type">plugins</span></a></span><span> </span><span class="hs-special">}</span><span class="hs-special">)</span><span> </span><span class="annot"><a href="#local-6989586621683118215"><span class="hs-identifier hs-type">m</span></a></span><span>
</span><span id="line-3178"></span><span>                  </span><span class="annot"><span class="hs-identifier hs-type">sequence_</span></span><span> </span><span class="annot"><a href="#local-6989586621683118219"><span class="hs-identifier hs-type">stops</span></a></span><span>
</span><span id="line-3179"></span><span>                  </span><span class="hs-keyword">case</span><span> </span><span class="annot"><a href="#local-6989586621683118221"><span class="hs-identifier hs-type">eitherRes</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-3180"></span><span>                    </span><span class="annot"><span class="hs-identifier hs-type">Left</span></span><span> </span><span class="annot"><span class="annottext">IOEnvFailure
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">TcM a
forall env a. IOEnv env a
</span><a href="GHC.Data.IOEnv.html#failM"><span class="hs-identifier hs-var">failM</span></a></span><span>
</span><span id="line-3181"></span><span>                    </span><span class="annot"><span class="hs-identifier hs-type">Right</span></span><span> </span><span id="local-6989586621683118225"><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621683118225"><span class="hs-identifier hs-var">res</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">a -&gt; TcM a
forall a. a -&gt; IOEnv (Env TcGblEnv TcLclEnv) a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621683118225"><span class="hs-identifier hs-var">res</span></a></span><span>
</span><span id="line-3182"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-3183"></span><span>    </span><span id="local-6989586621683118220"><span class="annot"><span class="annottext">start_plugin :: HoleFitPluginR
-&gt; IOEnv
     (Env TcGblEnv TcLclEnv)
     (HoleFitPlugin, IOEnv (Env TcGblEnv TcLclEnv) ())
</span><a href="#local-6989586621683118220"><span class="hs-identifier hs-var hs-var">start_plugin</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Tc.Errors.Hole.Plugin.html#HoleFitPluginR"><span class="hs-identifier hs-type">HoleFitPluginR</span></a></span><span> </span><span id="local-6989586621683118229"><span class="annot"><span class="annottext">TcM (TcRef s)
</span><a href="#local-6989586621683118229"><span class="hs-identifier hs-var">init</span></a></span></span><span> </span><span id="local-6989586621683118230"><span class="annot"><span class="annottext">TcRef s -&gt; HoleFitPlugin
</span><a href="#local-6989586621683118230"><span class="hs-identifier hs-var">plugin</span></a></span></span><span> </span><span id="local-6989586621683118231"><span class="annot"><span class="annottext">TcRef s -&gt; IOEnv (Env TcGblEnv TcLclEnv) ()
</span><a href="#local-6989586621683118231"><span class="hs-identifier hs-var">stop</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-3184"></span><span>      </span><span class="hs-keyword">do</span><span> </span><span id="local-6989586621683118232"><span class="annot"><a href="#local-6989586621683118232"><span class="hs-identifier hs-var">ref</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">TcM (TcRef s)
</span><a href="#local-6989586621683118229"><span class="hs-identifier hs-var">init</span></a></span><span>
</span><span id="line-3185"></span><span>         </span><span class="annot"><span class="hs-identifier hs-type">return</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621683118230"><span class="hs-identifier hs-type">plugin</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683118232"><span class="hs-identifier hs-type">ref</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="#local-6989586621683118231"><span class="hs-identifier hs-type">stop</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683118232"><span class="hs-identifier hs-type">ref</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-3186"></span><span>
</span><span id="line-3187"></span><span>
</span><span id="line-3188"></span><span class="annot"><a href="GHC.Tc.Module.html#runRenamerPlugin"><span class="hs-identifier hs-type">runRenamerPlugin</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#TcGblEnv"><span class="hs-identifier hs-type">TcGblEnv</span></a></span><span>
</span><span id="line-3189"></span><span>                 </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Language.Haskell.Syntax.Decls.html#HsGroup"><span class="hs-identifier hs-type">HsGroup</span></a></span><span> </span><span class="annot"><a href="GHC.Hs.Extension.html#GhcRn"><span class="hs-identifier hs-type">GhcRn</span></a></span><span>
</span><span id="line-3190"></span><span>                 </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#TcM"><span class="hs-identifier hs-type">TcM</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Tc.Types.html#TcGblEnv"><span class="hs-identifier hs-type">TcGblEnv</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Language.Haskell.Syntax.Decls.html#HsGroup"><span class="hs-identifier hs-type">HsGroup</span></a></span><span> </span><span class="annot"><a href="GHC.Hs.Extension.html#GhcRn"><span class="hs-identifier hs-type">GhcRn</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-3191"></span><span id="runRenamerPlugin"><span class="annot"><span class="annottext">runRenamerPlugin :: TcGblEnv
-&gt; HsGroup (GhcPass 'Renamed)
-&gt; TcM (TcGblEnv, HsGroup (GhcPass 'Renamed))
</span><a href="GHC.Tc.Module.html#runRenamerPlugin"><span class="hs-identifier hs-var hs-var">runRenamerPlugin</span></a></span></span><span> </span><span id="local-6989586621683118233"><span class="annot"><span class="annottext">TcGblEnv
</span><a href="#local-6989586621683118233"><span class="hs-identifier hs-var">gbl_env</span></a></span></span><span> </span><span id="local-6989586621683118234"><span class="annot"><span class="annottext">HsGroup (GhcPass 'Renamed)
</span><a href="#local-6989586621683118234"><span class="hs-identifier hs-var">hs_group</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-3192"></span><span>    </span><span id="local-6989586621683118235"><span class="annot"><a href="#local-6989586621683118235"><span class="hs-identifier hs-var">hsc_env</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">TcRnIf TcGblEnv TcLclEnv HscEnv
forall gbl lcl. TcRnIf gbl lcl HscEnv
</span><a href="GHC.Tc.Utils.Monad.html#getTopEnv"><span class="hs-identifier hs-var">getTopEnv</span></a></span><span>
</span><span id="line-3193"></span><span>    </span><span class="annot"><a href="GHC.Driver.Plugins.html#withPlugins"><span class="hs-identifier hs-type">withPlugins</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Driver.Env.Types.html#hsc_plugins"><span class="hs-identifier hs-var">hsc_plugins</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683118235"><span class="hs-identifier hs-type">hsc_env</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-3194"></span><span>      </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span id="local-6989586621683118237"><span class="annot"><span class="annottext">Plugin
</span><a href="#local-6989586621683118237"><span class="hs-identifier hs-var">p</span></a></span></span><span> </span><span id="local-6989586621683118238"><span class="annot"><span class="annottext">[String]
</span><a href="#local-6989586621683118238"><span class="hs-identifier hs-var">opts</span></a></span></span><span> </span><span class="hs-special">(</span><span id="local-6989586621683118239"><span class="annot"><span class="annottext">TcGblEnv
</span><a href="#local-6989586621683118239"><span class="hs-identifier hs-var">e</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621683118240"><span class="annot"><span class="annottext">HsGroup (GhcPass 'Renamed)
</span><a href="#local-6989586621683118240"><span class="hs-identifier hs-var">g</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span> </span><span class="annot"><span class="annottext">DynFlags -&gt; IOEnv (Env TcGblEnv TcLclEnv) ()
</span><a href="GHC.Tc.Module.html#mark_plugin_unsafe"><span class="hs-identifier hs-var">mark_plugin_unsafe</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">HscEnv -&gt; DynFlags
</span><a href="GHC.Driver.Env.Types.html#hsc_dflags"><span class="hs-identifier hs-var">hsc_dflags</span></a></span><span> </span><span class="annot"><span class="annottext">HscEnv
</span><a href="#local-6989586621683118235"><span class="hs-identifier hs-var">hsc_env</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-3195"></span><span>                            </span><span class="annot"><span class="annottext">IOEnv (Env TcGblEnv TcLclEnv) ()
-&gt; TcM (TcGblEnv, HsGroup (GhcPass 'Renamed))
-&gt; TcM (TcGblEnv, HsGroup (GhcPass 'Renamed))
forall a b.
IOEnv (Env TcGblEnv TcLclEnv) a
-&gt; IOEnv (Env TcGblEnv TcLclEnv) b
-&gt; IOEnv (Env TcGblEnv TcLclEnv) b
forall (m :: * -&gt; *) a b. Monad m =&gt; m a -&gt; m b -&gt; m b
</span><span class="hs-operator hs-var">&gt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">Plugin
-&gt; [String]
-&gt; TcGblEnv
-&gt; HsGroup (GhcPass 'Renamed)
-&gt; TcM (TcGblEnv, HsGroup (GhcPass 'Renamed))
</span><a href="GHC.Driver.Plugins.html#renamedResultAction"><span class="hs-identifier hs-var">renamedResultAction</span></a></span><span> </span><span class="annot"><span class="annottext">Plugin
</span><a href="#local-6989586621683118237"><span class="hs-identifier hs-var">p</span></a></span><span> </span><span class="annot"><span class="annottext">[String]
</span><a href="#local-6989586621683118238"><span class="hs-identifier hs-var">opts</span></a></span><span> </span><span class="annot"><span class="annottext">TcGblEnv
</span><a href="#local-6989586621683118239"><span class="hs-identifier hs-var">e</span></a></span><span> </span><span class="annot"><span class="annottext">HsGroup (GhcPass 'Renamed)
</span><a href="#local-6989586621683118240"><span class="hs-identifier hs-var">g</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-3196"></span><span>      </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621683118233"><span class="hs-identifier hs-type">gbl_env</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="#local-6989586621683118234"><span class="hs-identifier hs-type">hs_group</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-3197"></span><span>
</span><span id="line-3198"></span><span>
</span><span id="line-3199"></span><span class="hs-comment">-- XXX: should this really be a Maybe X?  Check under which circumstances this</span><span>
</span><span id="line-3200"></span><span class="hs-comment">-- can become a Nothing and decide whether this should instead throw an</span><span>
</span><span id="line-3201"></span><span class="hs-comment">-- exception/signal an error.</span><span>
</span><span id="line-3202"></span><span class="hs-keyword">type</span><span> </span><span id="RenamedStuff"><span class="annot"><a href="GHC.Tc.Module.html#RenamedStuff"><span class="hs-identifier hs-var">RenamedStuff</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-3203"></span><span>        </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Maybe</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Language.Haskell.Syntax.Decls.html#HsGroup"><span class="hs-identifier hs-type">HsGroup</span></a></span><span> </span><span class="annot"><a href="GHC.Hs.Extension.html#GhcRn"><span class="hs-identifier hs-type">GhcRn</span></a></span><span class="hs-special">,</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="Language.Haskell.Syntax.ImpExp.html#LImportDecl"><span class="hs-identifier hs-type">LImportDecl</span></a></span><span> </span><span class="annot"><a href="GHC.Hs.Extension.html#GhcRn"><span class="hs-identifier hs-type">GhcRn</span></a></span><span class="hs-special">]</span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Maybe</span></span><span> </span><span class="hs-special">[</span><span class="hs-special">(</span><span class="annot"><a href="Language.Haskell.Syntax.ImpExp.html#LIE"><span class="hs-identifier hs-type">LIE</span></a></span><span> </span><span class="annot"><a href="GHC.Hs.Extension.html#GhcRn"><span class="hs-identifier hs-type">GhcRn</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Types.Avail.html#Avails"><span class="hs-identifier hs-type">Avails</span></a></span><span class="hs-special">)</span><span class="hs-special">]</span><span class="hs-special">,</span><span>
</span><span id="line-3204"></span><span>                </span><span class="annot"><span class="hs-identifier hs-type">Maybe</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Hs.Doc.html#LHsDoc"><span class="hs-identifier hs-type">LHsDoc</span></a></span><span> </span><span class="annot"><a href="GHC.Hs.Extension.html#GhcRn"><span class="hs-identifier hs-type">GhcRn</span></a></span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Maybe</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Language.Haskell.Syntax.Extension.html#XRec"><span class="hs-identifier hs-type">XRec</span></a></span><span> </span><span class="annot"><a href="GHC.Hs.Extension.html#GhcRn"><span class="hs-identifier hs-type">GhcRn</span></a></span><span> </span><span class="annot"><a href="Language.Haskell.Syntax.Module.Name.html#ModuleName"><span class="hs-identifier hs-type">ModuleName</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-3205"></span><span>
</span><span id="line-3206"></span><span class="annot"><span class="hs-comment">-- | Extract the renamed information from TcGblEnv.</span></span><span>
</span><span id="line-3207"></span><span class="annot"><a href="GHC.Tc.Module.html#getRenamedStuff"><span class="hs-identifier hs-type">getRenamedStuff</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#TcGblEnv"><span class="hs-identifier hs-type">TcGblEnv</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Module.html#RenamedStuff"><span class="hs-identifier hs-type">RenamedStuff</span></a></span><span>
</span><span id="line-3208"></span><span id="getRenamedStuff"><span class="annot"><span class="annottext">getRenamedStuff :: TcGblEnv -&gt; RenamedStuff
</span><a href="GHC.Tc.Module.html#getRenamedStuff"><span class="hs-identifier hs-var hs-var">getRenamedStuff</span></a></span></span><span> </span><span id="local-6989586621683118244"><span class="annot"><span class="annottext">TcGblEnv
</span><a href="#local-6989586621683118244"><span class="hs-identifier hs-var">tc_result</span></a></span></span><span>
</span><span id="line-3209"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(HsGroup (GhcPass 'Renamed)
 -&gt; (HsGroup (GhcPass 'Renamed),
     [GenLocated SrcSpanAnnA (ImportDecl (GhcPass 'Renamed))],
     Maybe
       [(GenLocated SrcSpanAnnA (IE (GhcPass 'Renamed)), [AvailInfo])],
     Maybe (GenLocated SrcSpan (HsDoc (GhcPass 'Renamed))),
     Maybe (GenLocated SrcSpanAnnA ModuleName)))
-&gt; Maybe (HsGroup (GhcPass 'Renamed))
-&gt; Maybe
     (HsGroup (GhcPass 'Renamed),
      [GenLocated SrcSpanAnnA (ImportDecl (GhcPass 'Renamed))],
      Maybe
        [(GenLocated SrcSpanAnnA (IE (GhcPass 'Renamed)), [AvailInfo])],
      Maybe (GenLocated SrcSpan (HsDoc (GhcPass 'Renamed))),
      Maybe (GenLocated SrcSpanAnnA ModuleName))
forall a b. (a -&gt; b) -&gt; Maybe a -&gt; Maybe b
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-identifier hs-var">fmap</span></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span id="local-6989586621683118245"><span class="annot"><span class="annottext">HsGroup (GhcPass 'Renamed)
</span><a href="#local-6989586621683118245"><span class="hs-identifier hs-var">decls</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span> </span><span class="annot"><span class="annottext">HsGroup (GhcPass 'Renamed)
</span><a href="#local-6989586621683118245"><span class="hs-identifier hs-var">decls</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">TcGblEnv -&gt; [LImportDecl (GhcPass 'Renamed)]
</span><a href="GHC.Tc.Types.html#tcg_rn_imports"><span class="hs-identifier hs-var">tcg_rn_imports</span></a></span><span> </span><span class="annot"><span class="annottext">TcGblEnv
</span><a href="#local-6989586621683118244"><span class="hs-identifier hs-var">tc_result</span></a></span><span>
</span><span id="line-3210"></span><span>                    </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">TcGblEnv -&gt; Maybe [(LIE (GhcPass 'Renamed), [AvailInfo])]
</span><a href="GHC.Tc.Types.html#tcg_rn_exports"><span class="hs-identifier hs-var">tcg_rn_exports</span></a></span><span> </span><span class="annot"><span class="annottext">TcGblEnv
</span><a href="#local-6989586621683118244"><span class="hs-identifier hs-var">tc_result</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Maybe (GenLocated SrcSpan (HsDoc (GhcPass 'Renamed)))
</span><a href="#local-6989586621683118247"><span class="hs-identifier hs-var">doc_hdr</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Maybe (XRec (GhcPass 'Renamed) ModuleName)
Maybe (GenLocated SrcSpanAnnA ModuleName)
</span><a href="#local-6989586621683118248"><span class="hs-identifier hs-var">name_hdr</span></a></span><span> </span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-3211"></span><span>         </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TcGblEnv -&gt; Maybe (HsGroup (GhcPass 'Renamed))
</span><a href="GHC.Tc.Types.html#tcg_rn_decls"><span class="hs-identifier hs-var">tcg_rn_decls</span></a></span><span> </span><span class="annot"><span class="annottext">TcGblEnv
</span><a href="#local-6989586621683118244"><span class="hs-identifier hs-var">tc_result</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-3212"></span><span>  </span><span class="hs-keyword">where</span><span> </span><span class="hs-special">(</span><span id="local-6989586621683118247"><span class="annot"><span class="annottext">Maybe (GenLocated SrcSpan (HsDoc (GhcPass 'Renamed)))
</span><a href="#local-6989586621683118247"><span class="hs-identifier hs-var">doc_hdr</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621683118248"><span class="annot"><span class="annottext">Maybe (XRec (GhcPass 'Renamed) ModuleName)
</span><a href="#local-6989586621683118248"><span class="hs-identifier hs-var">name_hdr</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">TcGblEnv
-&gt; (Maybe (GenLocated SrcSpan (HsDoc (GhcPass 'Renamed))),
    Maybe (XRec (GhcPass 'Renamed) ModuleName))
</span><a href="GHC.Tc.Types.html#tcg_hdr_info"><span class="hs-identifier hs-var">tcg_hdr_info</span></a></span><span> </span><span class="annot"><span class="annottext">TcGblEnv
</span><a href="#local-6989586621683118244"><span class="hs-identifier hs-var">tc_result</span></a></span><span>
</span><span id="line-3213"></span><span>
</span><span id="line-3214"></span><span class="annot"><a href="GHC.Tc.Module.html#runTypecheckerPlugin"><span class="hs-identifier hs-type">runTypecheckerPlugin</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Unit.Module.ModSummary.html#ModSummary"><span class="hs-identifier hs-type">ModSummary</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#TcGblEnv"><span class="hs-identifier hs-type">TcGblEnv</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#TcM"><span class="hs-identifier hs-type">TcM</span></a></span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#TcGblEnv"><span class="hs-identifier hs-type">TcGblEnv</span></a></span><span>
</span><span id="line-3215"></span><span id="runTypecheckerPlugin"><span class="annot"><span class="annottext">runTypecheckerPlugin :: ModSummary -&gt; TcGblEnv -&gt; TcM TcGblEnv
</span><a href="GHC.Tc.Module.html#runTypecheckerPlugin"><span class="hs-identifier hs-var hs-var">runTypecheckerPlugin</span></a></span></span><span> </span><span id="local-6989586621683118249"><span class="annot"><span class="annottext">ModSummary
</span><a href="#local-6989586621683118249"><span class="hs-identifier hs-var">sum</span></a></span></span><span> </span><span id="local-6989586621683118250"><span class="annot"><span class="annottext">TcGblEnv
</span><a href="#local-6989586621683118250"><span class="hs-identifier hs-var">gbl_env</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-3216"></span><span>    </span><span id="local-6989586621683118251"><span class="annot"><a href="#local-6989586621683118251"><span class="hs-identifier hs-var">hsc_env</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">TcRnIf TcGblEnv TcLclEnv HscEnv
forall gbl lcl. TcRnIf gbl lcl HscEnv
</span><a href="GHC.Tc.Utils.Monad.html#getTopEnv"><span class="hs-identifier hs-var">getTopEnv</span></a></span><span>
</span><span id="line-3217"></span><span>    </span><span class="annot"><a href="GHC.Driver.Plugins.html#withPlugins"><span class="hs-identifier hs-type">withPlugins</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Driver.Env.Types.html#hsc_plugins"><span class="hs-identifier hs-var">hsc_plugins</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683118251"><span class="hs-identifier hs-type">hsc_env</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-3218"></span><span>      </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span id="local-6989586621683118252"><span class="annot"><span class="annottext">Plugin
</span><a href="#local-6989586621683118252"><span class="hs-identifier hs-var">p</span></a></span></span><span> </span><span id="local-6989586621683118253"><span class="annot"><span class="annottext">[String]
</span><a href="#local-6989586621683118253"><span class="hs-identifier hs-var">opts</span></a></span></span><span> </span><span id="local-6989586621683118254"><span class="annot"><span class="annottext">TcGblEnv
</span><a href="#local-6989586621683118254"><span class="hs-identifier hs-var">env</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">DynFlags -&gt; IOEnv (Env TcGblEnv TcLclEnv) ()
</span><a href="GHC.Tc.Module.html#mark_plugin_unsafe"><span class="hs-identifier hs-var">mark_plugin_unsafe</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">HscEnv -&gt; DynFlags
</span><a href="GHC.Driver.Env.Types.html#hsc_dflags"><span class="hs-identifier hs-var">hsc_dflags</span></a></span><span> </span><span class="annot"><span class="annottext">HscEnv
</span><a href="#local-6989586621683118251"><span class="hs-identifier hs-var">hsc_env</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-3219"></span><span>                        </span><span class="annot"><span class="annottext">IOEnv (Env TcGblEnv TcLclEnv) () -&gt; TcM TcGblEnv -&gt; TcM TcGblEnv
forall a b.
IOEnv (Env TcGblEnv TcLclEnv) a
-&gt; IOEnv (Env TcGblEnv TcLclEnv) b
-&gt; IOEnv (Env TcGblEnv TcLclEnv) b
forall (m :: * -&gt; *) a b. Monad m =&gt; m a -&gt; m b -&gt; m b
</span><span class="hs-operator hs-var">&gt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">Plugin -&gt; [String] -&gt; ModSummary -&gt; TcGblEnv -&gt; TcM TcGblEnv
</span><a href="GHC.Driver.Plugins.html#typeCheckResultAction"><span class="hs-identifier hs-var">typeCheckResultAction</span></a></span><span> </span><span class="annot"><span class="annottext">Plugin
</span><a href="#local-6989586621683118252"><span class="hs-identifier hs-var">p</span></a></span><span> </span><span class="annot"><span class="annottext">[String]
</span><a href="#local-6989586621683118253"><span class="hs-identifier hs-var">opts</span></a></span><span> </span><span class="annot"><span class="annottext">ModSummary
</span><a href="#local-6989586621683118249"><span class="hs-identifier hs-var">sum</span></a></span><span> </span><span class="annot"><span class="annottext">TcGblEnv
</span><a href="#local-6989586621683118254"><span class="hs-identifier hs-var">env</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-3220"></span><span>      </span><span class="annot"><a href="#local-6989586621683118250"><span class="hs-identifier hs-type">gbl_env</span></a></span><span>
</span><span id="line-3221"></span><span>
</span><span id="line-3222"></span><span class="annot"><a href="GHC.Tc.Module.html#mark_plugin_unsafe"><span class="hs-identifier hs-type">mark_plugin_unsafe</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Driver.DynFlags.html#DynFlags"><span class="hs-identifier hs-type">DynFlags</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#TcM"><span class="hs-identifier hs-type">TcM</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-3223"></span><span id="mark_plugin_unsafe"><span class="annot"><span class="annottext">mark_plugin_unsafe :: DynFlags -&gt; IOEnv (Env TcGblEnv TcLclEnv) ()
</span><a href="GHC.Tc.Module.html#mark_plugin_unsafe"><span class="hs-identifier hs-var hs-var">mark_plugin_unsafe</span></a></span></span><span> </span><span id="local-6989586621683118256"><span class="annot"><span class="annottext">DynFlags
</span><a href="#local-6989586621683118256"><span class="hs-identifier hs-var">dflags</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Bool
-&gt; IOEnv (Env TcGblEnv TcLclEnv) ()
-&gt; IOEnv (Env TcGblEnv TcLclEnv) ()
forall (f :: * -&gt; *). Applicative f =&gt; Bool -&gt; f () -&gt; f ()
</span><span class="hs-identifier hs-var">unless</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">GeneralFlag -&gt; DynFlags -&gt; Bool
</span><a href="GHC.Driver.DynFlags.html#gopt"><span class="hs-identifier hs-var">gopt</span></a></span><span> </span><span class="annot"><span class="annottext">GeneralFlag
</span><a href="GHC.Driver.Flags.html#Opt_PluginTrustworthy"><span class="hs-identifier hs-var">Opt_PluginTrustworthy</span></a></span><span> </span><span class="annot"><span class="annottext">DynFlags
</span><a href="#local-6989586621683118256"><span class="hs-identifier hs-var">dflags</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(IOEnv (Env TcGblEnv TcLclEnv) ()
 -&gt; IOEnv (Env TcGblEnv TcLclEnv) ())
-&gt; IOEnv (Env TcGblEnv TcLclEnv) ()
-&gt; IOEnv (Env TcGblEnv TcLclEnv) ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-3224"></span><span>  </span><span class="annot"><span class="annottext">Messages TcRnMessage -&gt; IOEnv (Env TcGblEnv TcLclEnv) ()
</span><a href="GHC.Tc.Utils.Monad.html#recordUnsafeInfer"><span class="hs-identifier hs-var">recordUnsafeInfer</span></a></span><span> </span><span class="annot"><span class="annottext">Messages TcRnMessage
</span><a href="#local-6989586621683118260"><span class="hs-identifier hs-var">pluginUnsafe</span></a></span><span>
</span><span id="line-3225"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-3226"></span><span>    </span><span class="hs-glyph">!</span><span id="local-6989586621683118261"><span class="annot"><span class="annottext">diag_opts :: DiagOpts
</span><a href="#local-6989586621683118261"><span class="hs-identifier hs-var hs-var">diag_opts</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">DynFlags -&gt; DiagOpts
</span><a href="GHC.Driver.Config.Diagnostic.html#initDiagOpts"><span class="hs-identifier hs-var">initDiagOpts</span></a></span><span> </span><span class="annot"><span class="annottext">DynFlags
</span><a href="#local-6989586621683118256"><span class="hs-identifier hs-var">dflags</span></a></span><span>
</span><span id="line-3227"></span><span>    </span><span id="local-6989586621683118260"><span class="annot"><span class="annottext">pluginUnsafe :: Messages TcRnMessage
</span><a href="#local-6989586621683118260"><span class="hs-identifier hs-var hs-var">pluginUnsafe</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-3228"></span><span>      </span><span class="annot"><span class="annottext">MsgEnvelope TcRnMessage -&gt; Messages TcRnMessage
forall e. MsgEnvelope e -&gt; Messages e
</span><a href="GHC.Types.Error.html#singleMessage"><span class="hs-identifier hs-var">singleMessage</span></a></span><span> </span><span class="annot"><span class="annottext">(MsgEnvelope TcRnMessage -&gt; Messages TcRnMessage)
-&gt; MsgEnvelope TcRnMessage -&gt; Messages TcRnMessage
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-3229"></span><span>      </span><span class="annot"><span class="annottext">DiagOpts -&gt; SrcSpan -&gt; TcRnMessage -&gt; MsgEnvelope TcRnMessage
forall e. Diagnostic e =&gt; DiagOpts -&gt; SrcSpan -&gt; e -&gt; MsgEnvelope e
</span><a href="GHC.Utils.Error.html#mkPlainMsgEnvelope"><span class="hs-identifier hs-var">mkPlainMsgEnvelope</span></a></span><span> </span><span class="annot"><span class="annottext">DiagOpts
</span><a href="#local-6989586621683118261"><span class="hs-identifier hs-var">diag_opts</span></a></span><span> </span><span class="annot"><span class="annottext">SrcSpan
</span><a href="GHC.Types.SrcLoc.html#noSrcSpan"><span class="hs-identifier hs-var">noSrcSpan</span></a></span><span> </span><span class="annot"><span class="annottext">TcRnMessage
</span><a href="GHC.Tc.Errors.Types.html#TcRnUnsafeDueToPlugin"><span class="hs-identifier hs-var">TcRnUnsafeDueToPlugin</span></a></span><span>
</span><span id="line-3230"></span><span>
</span><span id="line-3231"></span><span>
</span><span id="line-3232"></span><span class="hs-comment">-- Note [Typechecking default declarations]</span><span>
</span><span id="line-3233"></span><span class="hs-comment">-- ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~</span><span>
</span><span id="line-3234"></span><span class="hs-comment">-- Typechecking default declarations requires careful placement:</span><span>
</span><span id="line-3235"></span><span class="hs-comment">--</span><span>
</span><span id="line-3236"></span><span class="hs-comment">-- 1. We must check them after types (tcTyAndClassDecls) because they can refer</span><span>
</span><span id="line-3237"></span><span class="hs-comment">-- to them. E.g.</span><span>
</span><span id="line-3238"></span><span class="hs-comment">--</span><span>
</span><span id="line-3239"></span><span class="hs-comment">--    data T = MkT ...</span><span>
</span><span id="line-3240"></span><span class="hs-comment">--    default(Int, T, Integer)</span><span>
</span><span id="line-3241"></span><span class="hs-comment">--</span><span>
</span><span id="line-3242"></span><span class="hs-comment">--    -- or even (tested by T11974b and T2245)</span><span>
</span><span id="line-3243"></span><span class="hs-comment">--    default(Int, T, Integer)</span><span>
</span><span id="line-3244"></span><span class="hs-comment">--    data T = MkT ...</span><span>
</span><span id="line-3245"></span><span class="hs-comment">--</span><span>
</span><span id="line-3246"></span><span class="hs-comment">-- 2. We must check them before typechecking deriving clauses (tcInstDeclsDeriv)</span><span>
</span><span id="line-3247"></span><span class="hs-comment">-- otherwise we may lookup default default types (Integer, Double) while checking</span><span>
</span><span id="line-3248"></span><span class="hs-comment">-- deriving clauses, ignoring the default declaration.</span><span>
</span><span id="line-3249"></span><span class="hs-comment">--</span><span>
</span><span id="line-3250"></span><span class="hs-comment">-- Before this careful placement (#24566), compiling the following example</span><span>
</span><span id="line-3251"></span><span class="hs-comment">-- (T24566) with &quot;-ddump-if-trace -ddump-tc-trace&quot; showed a call to</span><span>
</span><span id="line-3252"></span><span class="hs-comment">-- `applyDefaultingRules` with default types set to &quot;(Integer,Double)&quot;:</span><span>
</span><span id="line-3253"></span><span class="hs-comment">--</span><span>
</span><span id="line-3254"></span><span class="hs-comment">--     module M where</span><span>
</span><span id="line-3255"></span><span class="hs-comment">--</span><span>
</span><span id="line-3256"></span><span class="hs-comment">--     import GHC.Classes</span><span>
</span><span id="line-3257"></span><span class="hs-comment">--     default ()</span><span>
</span><span id="line-3258"></span><span class="hs-comment">--</span><span>
</span><span id="line-3259"></span><span class="hs-comment">--     data Foo a = Nothing | Just a</span><span>
</span><span id="line-3260"></span><span class="hs-comment">--       deriving (Eq, Ord)</span><span>
</span><span id="line-3261"></span><span class="hs-comment">--</span><span>
</span><span id="line-3262"></span><span class="hs-comment">-- This was an issue while building modules like M in the ghc-internal package</span><span>
</span><span id="line-3263"></span><span class="hs-comment">-- because they would spuriously fail to build if the module defining Integer</span><span>
</span><span id="line-3264"></span><span class="hs-comment">-- (ghc-bignum:GHC.Num.Integer) wasn't compiled yet and its interface not to be</span><span>
</span><span id="line-3265"></span><span class="hs-comment">-- found. The implicit dependency between M and GHC.Num.Integer isn't known to</span><span>
</span><span id="line-3266"></span><span class="hs-comment">-- the build system.</span><span>
</span><span id="line-3267"></span><span class="hs-comment">-- In addition, trying to explicitly avoid the implicit dependency with `default</span><span>
</span><span id="line-3268"></span><span class="hs-comment">-- ()` didn't work, except if *standalone* deriving was used, which was an</span><span>
</span><span id="line-3269"></span><span class="hs-comment">-- inconsistent behavior.</span><span>
</span><span id="line-3270"></span></pre></body></html>