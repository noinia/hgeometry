<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><link rel="stylesheet" type="text/css" href="style.css" /><script type="text/javascript" src="highlight.js"></script></head><body><pre><span class="hs-pragma">{-# LANGUAGE FlexibleContexts #-}</span><span>
</span><span id="line-2"></span><span class="hs-pragma">{-# LANGUAGE LambdaCase #-}</span><span>
</span><span id="line-3"></span><span class="hs-pragma">{-# LANGUAGE TypeFamilies #-}</span><span>
</span><span id="line-4"></span><span>
</span><span id="line-5"></span><span class="hs-comment">{-
(c) The University of Glasgow 2006
(c) The GRASP/AQUA Project, Glasgow University, 1992-1998


Utilities for desugaring

This module exports some utility functions of no great interest.
-}</span><span>
</span><span id="line-14"></span><span>
</span><span id="line-15"></span><span class="annot"><span class="hs-comment">-- | Utility functions for constructing Core syntax, principally for desugaring</span></span><span>
</span><span id="line-16"></span><span class="hs-keyword">module</span><span> </span><span class="annot"><a href="GHC.HsToCore.Utils.html"><span class="hs-identifier">GHC.HsToCore.Utils</span></a></span><span> </span><span class="hs-special">(</span><span>
</span><span id="line-17"></span><span>        </span><span class="annot"><a href="GHC.HsToCore.Monad.html#EquationInfo"><span class="hs-identifier">EquationInfo</span></a></span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span>
</span><span id="line-18"></span><span>        </span><span class="annot"><a href="GHC.HsToCore.Utils.html#firstPat"><span class="hs-identifier">firstPat</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.HsToCore.Utils.html#shiftEqns"><span class="hs-identifier">shiftEqns</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.HsToCore.Utils.html#combineEqnRhss"><span class="hs-identifier">combineEqnRhss</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-19"></span><span>
</span><span id="line-20"></span><span>        </span><span class="annot"><a href="GHC.HsToCore.Monad.html#MatchResult"><span class="hs-identifier">MatchResult</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.HsToCore.Utils.html#CaseAlt"><span class="hs-identifier">CaseAlt</span></a></span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span>
</span><span id="line-21"></span><span>        </span><span class="annot"><a href="GHC.HsToCore.Utils.html#cantFailMatchResult"><span class="hs-identifier">cantFailMatchResult</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.HsToCore.Utils.html#alwaysFailMatchResult"><span class="hs-identifier">alwaysFailMatchResult</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-22"></span><span>        </span><span class="annot"><a href="GHC.HsToCore.Utils.html#extractMatchResult"><span class="hs-identifier">extractMatchResult</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.HsToCore.Utils.html#combineMatchResults"><span class="hs-identifier">combineMatchResults</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-23"></span><span>        </span><span class="annot"><a href="GHC.HsToCore.Utils.html#adjustMatchResultDs"><span class="hs-identifier">adjustMatchResultDs</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-24"></span><span>        </span><span class="annot"><a href="GHC.HsToCore.Utils.html#shareFailureHandler"><span class="hs-identifier">shareFailureHandler</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-25"></span><span>        </span><span class="annot"><a href="GHC.HsToCore.Utils.html#dsHandleMonadicFailure"><span class="hs-identifier">dsHandleMonadicFailure</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-26"></span><span>        </span><span class="annot"><a href="GHC.HsToCore.Utils.html#mkCoLetMatchResult"><span class="hs-identifier">mkCoLetMatchResult</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.HsToCore.Utils.html#mkViewMatchResult"><span class="hs-identifier">mkViewMatchResult</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.HsToCore.Utils.html#mkGuardedMatchResult"><span class="hs-identifier">mkGuardedMatchResult</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-27"></span><span>        </span><span class="annot"><a href="GHC.HsToCore.Utils.html#matchCanFail"><span class="hs-identifier">matchCanFail</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.HsToCore.Utils.html#mkEvalMatchResult"><span class="hs-identifier">mkEvalMatchResult</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-28"></span><span>        </span><span class="annot"><a href="GHC.HsToCore.Utils.html#mkCoPrimCaseMatchResult"><span class="hs-identifier">mkCoPrimCaseMatchResult</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.HsToCore.Utils.html#mkCoAlgCaseMatchResult"><span class="hs-identifier">mkCoAlgCaseMatchResult</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.HsToCore.Utils.html#mkCoSynCaseMatchResult"><span class="hs-identifier">mkCoSynCaseMatchResult</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-29"></span><span>        </span><span class="annot"><a href="GHC.HsToCore.Utils.html#wrapBind"><span class="hs-identifier">wrapBind</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.HsToCore.Utils.html#wrapBinds"><span class="hs-identifier">wrapBinds</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-30"></span><span>
</span><span id="line-31"></span><span>        </span><span class="annot"><a href="GHC.HsToCore.Utils.html#mkErrorAppDs"><span class="hs-identifier">mkErrorAppDs</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.HsToCore.Utils.html#mkCoreAppDs"><span class="hs-identifier">mkCoreAppDs</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.HsToCore.Utils.html#mkCoreAppsDs"><span class="hs-identifier">mkCoreAppsDs</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.HsToCore.Utils.html#mkCastDs"><span class="hs-identifier">mkCastDs</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-32"></span><span>        </span><span class="annot"><a href="GHC.HsToCore.Utils.html#mkFailExpr"><span class="hs-identifier">mkFailExpr</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-33"></span><span>
</span><span id="line-34"></span><span>        </span><span class="annot"><a href="GHC.HsToCore.Utils.html#seqVar"><span class="hs-identifier">seqVar</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-35"></span><span>
</span><span id="line-36"></span><span>        </span><span class="hs-comment">-- LHs tuples</span><span>
</span><span id="line-37"></span><span>        </span><span class="annot"><a href="GHC.HsToCore.Utils.html#mkLHsPatTup"><span class="hs-identifier">mkLHsPatTup</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.HsToCore.Utils.html#mkVanillaTuplePat"><span class="hs-identifier">mkVanillaTuplePat</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-38"></span><span>        </span><span class="annot"><a href="GHC.HsToCore.Utils.html#mkBigLHsVarTupId"><span class="hs-identifier">mkBigLHsVarTupId</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.HsToCore.Utils.html#mkBigLHsTupId"><span class="hs-identifier">mkBigLHsTupId</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.HsToCore.Utils.html#mkBigLHsVarPatTupId"><span class="hs-identifier">mkBigLHsVarPatTupId</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.HsToCore.Utils.html#mkBigLHsPatTupId"><span class="hs-identifier">mkBigLHsPatTupId</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-39"></span><span>
</span><span id="line-40"></span><span>        </span><span class="annot"><a href="GHC.HsToCore.Utils.html#mkSelectorBinds"><span class="hs-identifier">mkSelectorBinds</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-41"></span><span>
</span><span id="line-42"></span><span>        </span><span class="annot"><a href="GHC.HsToCore.Utils.html#selectSimpleMatchVarL"><span class="hs-identifier">selectSimpleMatchVarL</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.HsToCore.Utils.html#selectMatchVars"><span class="hs-identifier">selectMatchVars</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.HsToCore.Utils.html#selectMatchVar"><span class="hs-identifier">selectMatchVar</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-43"></span><span>        </span><span class="annot"><a href="GHC.HsToCore.Utils.html#mkOptTickBox"><span class="hs-identifier">mkOptTickBox</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.HsToCore.Utils.html#mkBinaryTickBox"><span class="hs-identifier">mkBinaryTickBox</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.HsToCore.Utils.html#decideBangHood"><span class="hs-identifier">decideBangHood</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-44"></span><span>        </span><span class="annot"><a href="GHC.HsToCore.Utils.html#isTrueLHsExpr"><span class="hs-identifier">isTrueLHsExpr</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-45"></span><span>
</span><span id="line-46"></span><span>        </span><span class="hs-comment">-- Multiplicity</span><span>
</span><span id="line-47"></span><span>        </span><span class="annot"><a href="GHC.HsToCore.Utils.html#checkMultiplicityCoercions"><span class="hs-identifier">checkMultiplicityCoercions</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-48"></span><span>    </span><span class="hs-special">)</span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-49"></span><span>
</span><span id="line-50"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Prelude.html"><span class="hs-identifier">GHC.Prelude</span></a></span><span>
</span><span id="line-51"></span><span>
</span><span id="line-52"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Language.Haskell.Syntax.Basic.html"><span class="hs-identifier">Language.Haskell.Syntax.Basic</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Language.Haskell.Syntax.Basic.html#Boxity"><span class="hs-identifier">Boxity</span></a></span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-53"></span><span>
</span><span id="line-54"></span><span class="hs-keyword">import</span><span> </span><span class="hs-pragma">{-# SOURCE</span><span> </span><span class="hs-pragma">#-}</span><span> </span><span class="annot"><a href="GHC.HsToCore.Match.html"><span class="hs-identifier">GHC.HsToCore.Match</span></a></span><span> </span><span class="hs-special">(</span><span> </span><span class="annot"><a href="GHC.HsToCore.Match.html#matchSimply"><span class="hs-identifier">matchSimply</span></a></span><span> </span><span class="hs-special">)</span><span>
</span><span id="line-55"></span><span class="hs-keyword">import</span><span> </span><span class="hs-pragma">{-# SOURCE</span><span> </span><span class="hs-pragma">#-}</span><span> </span><span class="annot"><a href="GHC.HsToCore.Expr.html"><span class="hs-identifier">GHC.HsToCore.Expr</span></a></span><span>  </span><span class="hs-special">(</span><span> </span><span class="annot"><a href="GHC.HsToCore.Expr.html#dsLExpr"><span class="hs-identifier">dsLExpr</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.HsToCore.Expr.html#dsSyntaxExpr"><span class="hs-identifier">dsSyntaxExpr</span></a></span><span> </span><span class="hs-special">)</span><span>
</span><span id="line-56"></span><span>
</span><span id="line-57"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Hs.html"><span class="hs-identifier">GHC.Hs</span></a></span><span>
</span><span id="line-58"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Hs.Syn.Type.html"><span class="hs-identifier">GHC.Hs.Syn.Type</span></a></span><span>
</span><span id="line-59"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Core.html"><span class="hs-identifier">GHC.Core</span></a></span><span>
</span><span id="line-60"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.HsToCore.Monad.html"><span class="hs-identifier">GHC.HsToCore.Monad</span></a></span><span>
</span><span id="line-61"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.HsToCore.Errors.Types.html"><span class="hs-identifier">GHC.HsToCore.Errors.Types</span></a></span><span>
</span><span id="line-62"></span><span>
</span><span id="line-63"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Core.Utils.html"><span class="hs-identifier">GHC.Core.Utils</span></a></span><span>
</span><span id="line-64"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Core.Make.html"><span class="hs-identifier">GHC.Core.Make</span></a></span><span>
</span><span id="line-65"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Types.Id.Make.html"><span class="hs-identifier">GHC.Types.Id.Make</span></a></span><span>
</span><span id="line-66"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Types.Id.html"><span class="hs-identifier">GHC.Types.Id</span></a></span><span>
</span><span id="line-67"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Types.Literal.html"><span class="hs-identifier">GHC.Types.Literal</span></a></span><span>
</span><span id="line-68"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Core.TyCon.html"><span class="hs-identifier">GHC.Core.TyCon</span></a></span><span>
</span><span id="line-69"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Core.DataCon.html"><span class="hs-identifier">GHC.Core.DataCon</span></a></span><span>
</span><span id="line-70"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Core.PatSyn.html"><span class="hs-identifier">GHC.Core.PatSyn</span></a></span><span>
</span><span id="line-71"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Core.Type.html"><span class="hs-identifier">GHC.Core.Type</span></a></span><span>
</span><span id="line-72"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Core.Coercion.html"><span class="hs-identifier">GHC.Core.Coercion</span></a></span><span>
</span><span id="line-73"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Core.TyCo.Rep.html"><span class="hs-identifier">GHC.Core.TyCo.Rep</span></a></span><span class="hs-special">(</span><span> </span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#Scaled"><span class="hs-identifier">Scaled</span></a></span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span> </span><span class="hs-special">)</span><span>
</span><span id="line-74"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Builtin.Types.html"><span class="hs-identifier">GHC.Builtin.Types</span></a></span><span>
</span><span id="line-75"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Core.ConLike.html"><span class="hs-identifier">GHC.Core.ConLike</span></a></span><span>
</span><span id="line-76"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Types.Unique.Set.html"><span class="hs-identifier">GHC.Types.Unique.Set</span></a></span><span>
</span><span id="line-77"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Types.Unique.Supply.html"><span class="hs-identifier">GHC.Types.Unique.Supply</span></a></span><span>
</span><span id="line-78"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Unit.Module.html"><span class="hs-identifier">GHC.Unit.Module</span></a></span><span>
</span><span id="line-79"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Builtin.Names.html"><span class="hs-identifier">GHC.Builtin.Names</span></a></span><span>
</span><span id="line-80"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Types.Name.html"><span class="hs-identifier">GHC.Types.Name</span></a></span><span class="hs-special">(</span><span> </span><span class="annot"><a href="GHC.Types.Name.html#isInternalName"><span class="hs-identifier">isInternalName</span></a></span><span> </span><span class="hs-special">)</span><span>
</span><span id="line-81"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Utils.Outputable.html"><span class="hs-identifier">GHC.Utils.Outputable</span></a></span><span>
</span><span id="line-82"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Utils.Panic.html"><span class="hs-identifier">GHC.Utils.Panic</span></a></span><span>
</span><span id="line-83"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Types.SrcLoc.html"><span class="hs-identifier">GHC.Types.SrcLoc</span></a></span><span>
</span><span id="line-84"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Types.Tickish.html"><span class="hs-identifier">GHC.Types.Tickish</span></a></span><span>
</span><span id="line-85"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Utils.Misc.html"><span class="hs-identifier">GHC.Utils.Misc</span></a></span><span>
</span><span id="line-86"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Driver.DynFlags.html"><span class="hs-identifier">GHC.Driver.DynFlags</span></a></span><span>
</span><span id="line-87"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Driver.Ppr.html"><span class="hs-identifier">GHC.Driver.Ppr</span></a></span><span>
</span><span id="line-88"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><a href="../../ghc-boot-9.12.2-1a37/src/GHC.LanguageExtensions.html"><span class="hs-identifier">GHC.LanguageExtensions</span></a></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">LangExt</span></span><span>
</span><span id="line-89"></span><span>
</span><span id="line-90"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Rename.Env.html"><span class="hs-identifier">GHC.Rename.Env</span></a></span><span> </span><span class="hs-special">(</span><span> </span><span class="annot"><a href="GHC.Rename.Env.html#irrefutableConLikeTc"><span class="hs-identifier">irrefutableConLikeTc</span></a></span><span> </span><span class="hs-special">)</span><span>
</span><span id="line-91"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Tc.Types.Evidence.html"><span class="hs-identifier">GHC.Tc.Types.Evidence</span></a></span><span>
</span><span id="line-92"></span><span>
</span><span id="line-93"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="../../base-4.21.0.0-ae91/src/Control.Monad.html"><span class="hs-identifier">Control.Monad</span></a></span><span>    </span><span class="hs-special">(</span><span> </span><span class="annot"><span class="hs-identifier">unless</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">zipWithM</span></span><span> </span><span class="hs-special">)</span><span>
</span><span id="line-94"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="../../base-4.21.0.0-ae91/src/Data.List.NonEmpty.html"><span class="hs-identifier">Data.List.NonEmpty</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">NonEmpty</span></span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-95"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="../../base-4.21.0.0-ae91/src/Data.Maybe.html"><span class="hs-identifier">Data.Maybe</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">maybeToList</span></span><span class="hs-special">)</span><span>
</span><span id="line-96"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><a href="../../base-4.21.0.0-ae91/src/Data.List.NonEmpty.html"><span class="hs-identifier">Data.List.NonEmpty</span></a></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">NEL</span></span><span>
</span><span id="line-97"></span><span>
</span><span id="line-98"></span><span class="hs-comment">{-
************************************************************************
*                                                                      *
\subsection{ Selecting match variables}
*                                                                      *
************************************************************************

We're about to match against some patterns.  We want to make some
@Ids@ to use as match variables.  If a pattern has an @Id@ readily at
hand, which should indeed be bound to the pattern as a whole, then use it;
otherwise, make one up. The multiplicity argument is chosen as the multiplicity
of the variable if it is made up.
-}</span><span>
</span><span id="line-111"></span><span>
</span><span id="line-112"></span><span class="annot"><a href="GHC.HsToCore.Utils.html#selectSimpleMatchVarL"><span class="hs-identifier hs-type">selectSimpleMatchVarL</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#Mult"><span class="hs-identifier hs-type">Mult</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Language.Haskell.Syntax.Pat.html#LPat"><span class="hs-identifier hs-type">LPat</span></a></span><span> </span><span class="annot"><a href="GHC.Hs.Extension.html#GhcTc"><span class="hs-identifier hs-type">GhcTc</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.HsToCore.Types.html#DsM"><span class="hs-identifier hs-type">DsM</span></a></span><span> </span><span class="annot"><a href="GHC.Types.Var.html#Id"><span class="hs-identifier hs-type">Id</span></a></span><span>
</span><span id="line-113"></span><span class="hs-comment">-- Postcondition: the returned Id has an Internal Name</span><span>
</span><span id="line-114"></span><span id="selectSimpleMatchVarL"><span class="annot"><span class="annottext">selectSimpleMatchVarL :: Mult -&gt; XRec GhcTc (Pat GhcTc) -&gt; DsM Var
</span><a href="GHC.HsToCore.Utils.html#selectSimpleMatchVarL"><span class="hs-identifier hs-var hs-var">selectSimpleMatchVarL</span></a></span></span><span> </span><span id="local-6989586621683122563"><span class="annot"><span class="annottext">Mult
</span><a href="#local-6989586621683122563"><span class="hs-identifier hs-var">w</span></a></span></span><span> </span><span id="local-6989586621683122564"><span class="annot"><span class="annottext">XRec GhcTc (Pat GhcTc)
</span><a href="#local-6989586621683122564"><span class="hs-identifier hs-var">pat</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Mult -&gt; Pat GhcTc -&gt; DsM Var
</span><a href="GHC.HsToCore.Utils.html#selectMatchVar"><span class="hs-identifier hs-var">selectMatchVar</span></a></span><span> </span><span class="annot"><span class="annottext">Mult
</span><a href="#local-6989586621683122563"><span class="hs-identifier hs-var">w</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">GenLocated SrcSpanAnnA (Pat GhcTc) -&gt; Pat GhcTc
forall l e. GenLocated l e -&gt; e
</span><a href="GHC.Types.SrcLoc.html#unLoc"><span class="hs-identifier hs-var">unLoc</span></a></span><span> </span><span class="annot"><span class="annottext">XRec GhcTc (Pat GhcTc)
GenLocated SrcSpanAnnA (Pat GhcTc)
</span><a href="#local-6989586621683122564"><span class="hs-identifier hs-var">pat</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-115"></span><span>
</span><span id="line-116"></span><span class="hs-comment">-- (selectMatchVars ps tys) chooses variables of type tys</span><span>
</span><span id="line-117"></span><span class="hs-comment">-- to use for matching ps against.  If the pattern is a variable,</span><span>
</span><span id="line-118"></span><span class="hs-comment">-- we try to use that, to save inventing lots of fresh variables.</span><span>
</span><span id="line-119"></span><span class="hs-comment">--</span><span>
</span><span id="line-120"></span><span class="hs-comment">-- OLD, but interesting note:</span><span>
</span><span id="line-121"></span><span class="hs-comment">--    But even if it is a variable, its type might not match.  Consider</span><span>
</span><span id="line-122"></span><span class="hs-comment">--      data T a where</span><span>
</span><span id="line-123"></span><span class="hs-comment">--        T1 :: Int -&gt; T Int</span><span>
</span><span id="line-124"></span><span class="hs-comment">--        T2 :: a   -&gt; T a</span><span>
</span><span id="line-125"></span><span class="hs-comment">--</span><span>
</span><span id="line-126"></span><span class="hs-comment">--      f :: T a -&gt; a -&gt; Int</span><span>
</span><span id="line-127"></span><span class="hs-comment">--      f (T1 i) (x::Int) = x</span><span>
</span><span id="line-128"></span><span class="hs-comment">--      f (T2 i) (y::a)   = 0</span><span>
</span><span id="line-129"></span><span class="hs-comment">--    Then we must not choose (x::Int) as the matching variable!</span><span>
</span><span id="line-130"></span><span class="hs-comment">-- And nowadays we won't, because the (x::Int) will be wrapped in a CoPat</span><span>
</span><span id="line-131"></span><span>
</span><span id="line-132"></span><span class="annot"><a href="GHC.HsToCore.Utils.html#selectMatchVars"><span class="hs-identifier hs-type">selectMatchVars</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><span class="hs-special">(</span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#Mult"><span class="hs-identifier hs-type">Mult</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Language.Haskell.Syntax.Pat.html#Pat"><span class="hs-identifier hs-type">Pat</span></a></span><span> </span><span class="annot"><a href="GHC.Hs.Extension.html#GhcTc"><span class="hs-identifier hs-type">GhcTc</span></a></span><span class="hs-special">)</span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.HsToCore.Types.html#DsM"><span class="hs-identifier hs-type">DsM</span></a></span><span> </span><span class="hs-special">[</span><span class="annot"><a href="GHC.Types.Var.html#Id"><span class="hs-identifier hs-type">Id</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-133"></span><span class="hs-comment">-- Postcondition: the returned Ids have Internal Names</span><span>
</span><span id="line-134"></span><span id="selectMatchVars"><span class="annot"><span class="annottext">selectMatchVars :: [(Mult, Pat GhcTc)] -&gt; DsM [Var]
</span><a href="GHC.HsToCore.Utils.html#selectMatchVars"><span class="hs-identifier hs-var hs-var">selectMatchVars</span></a></span></span><span> </span><span id="local-6989586621683122566"><span class="annot"><span class="annottext">[(Mult, Pat GhcTc)]
</span><a href="#local-6989586621683122566"><span class="hs-identifier hs-var">ps</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">((Mult, Pat GhcTc) -&gt; DsM Var) -&gt; [(Mult, Pat GhcTc)] -&gt; DsM [Var]
forall (t :: * -&gt; *) (m :: * -&gt; *) a b.
(Traversable t, Monad m) =&gt;
(a -&gt; m b) -&gt; t a -&gt; m (t b)
forall (m :: * -&gt; *) a b. Monad m =&gt; (a -&gt; m b) -&gt; [a] -&gt; m [b]
</span><span class="hs-identifier hs-var">mapM</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(Mult -&gt; Pat GhcTc -&gt; DsM Var) -&gt; (Mult, Pat GhcTc) -&gt; DsM Var
forall a b c. (a -&gt; b -&gt; c) -&gt; (a, b) -&gt; c
</span><span class="hs-identifier hs-var">uncurry</span></span><span> </span><span class="annot"><span class="annottext">Mult -&gt; Pat GhcTc -&gt; DsM Var
</span><a href="GHC.HsToCore.Utils.html#selectMatchVar"><span class="hs-identifier hs-var">selectMatchVar</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[(Mult, Pat GhcTc)]
</span><a href="#local-6989586621683122566"><span class="hs-identifier hs-var">ps</span></a></span><span>
</span><span id="line-135"></span><span>
</span><span id="line-136"></span><span class="annot"><a href="GHC.HsToCore.Utils.html#selectMatchVar"><span class="hs-identifier hs-type">selectMatchVar</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#Mult"><span class="hs-identifier hs-type">Mult</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Language.Haskell.Syntax.Pat.html#Pat"><span class="hs-identifier hs-type">Pat</span></a></span><span> </span><span class="annot"><a href="GHC.Hs.Extension.html#GhcTc"><span class="hs-identifier hs-type">GhcTc</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.HsToCore.Types.html#DsM"><span class="hs-identifier hs-type">DsM</span></a></span><span> </span><span class="annot"><a href="GHC.Types.Var.html#Id"><span class="hs-identifier hs-type">Id</span></a></span><span>
</span><span id="line-137"></span><span class="hs-comment">-- Postcondition: the returned Id has an Internal Name</span><span>
</span><span id="line-138"></span><span id="selectMatchVar"><span class="annot"><span class="annottext">selectMatchVar :: Mult -&gt; Pat GhcTc -&gt; DsM Var
</span><a href="GHC.HsToCore.Utils.html#selectMatchVar"><span class="hs-identifier hs-var hs-var">selectMatchVar</span></a></span></span><span> </span><span id="local-6989586621683122569"><span class="annot"><span class="annottext">Mult
</span><a href="#local-6989586621683122569"><span class="hs-identifier hs-var">w</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Language.Haskell.Syntax.Pat.html#BangPat"><span class="hs-identifier hs-type">BangPat</span></a></span><span> </span><span class="annot"><span class="annottext">XBangPat GhcTc
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621683122571"><span class="annot"><span class="annottext">XRec GhcTc (Pat GhcTc)
</span><a href="#local-6989586621683122571"><span class="hs-identifier hs-var">pat</span></a></span></span><span class="hs-special">)</span><span>    </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Mult -&gt; Pat GhcTc -&gt; DsM Var
</span><a href="GHC.HsToCore.Utils.html#selectMatchVar"><span class="hs-identifier hs-var">selectMatchVar</span></a></span><span> </span><span class="annot"><span class="annottext">Mult
</span><a href="#local-6989586621683122569"><span class="hs-identifier hs-var">w</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">GenLocated SrcSpanAnnA (Pat GhcTc) -&gt; Pat GhcTc
forall l e. GenLocated l e -&gt; e
</span><a href="GHC.Types.SrcLoc.html#unLoc"><span class="hs-identifier hs-var">unLoc</span></a></span><span> </span><span class="annot"><span class="annottext">XRec GhcTc (Pat GhcTc)
GenLocated SrcSpanAnnA (Pat GhcTc)
</span><a href="#local-6989586621683122571"><span class="hs-identifier hs-var">pat</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-139"></span><span class="annot"><a href="GHC.HsToCore.Utils.html#selectMatchVar"><span class="hs-identifier hs-var">selectMatchVar</span></a></span><span> </span><span id="local-6989586621683122572"><span class="annot"><span class="annottext">Mult
</span><a href="#local-6989586621683122572"><span class="hs-identifier hs-var">w</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Language.Haskell.Syntax.Pat.html#LazyPat"><span class="hs-identifier hs-type">LazyPat</span></a></span><span> </span><span class="annot"><span class="annottext">XLazyPat GhcTc
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621683122574"><span class="annot"><span class="annottext">XRec GhcTc (Pat GhcTc)
</span><a href="#local-6989586621683122574"><span class="hs-identifier hs-var">pat</span></a></span></span><span class="hs-special">)</span><span>    </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Mult -&gt; Pat GhcTc -&gt; DsM Var
</span><a href="GHC.HsToCore.Utils.html#selectMatchVar"><span class="hs-identifier hs-var">selectMatchVar</span></a></span><span> </span><span class="annot"><span class="annottext">Mult
</span><a href="#local-6989586621683122572"><span class="hs-identifier hs-var">w</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">GenLocated SrcSpanAnnA (Pat GhcTc) -&gt; Pat GhcTc
forall l e. GenLocated l e -&gt; e
</span><a href="GHC.Types.SrcLoc.html#unLoc"><span class="hs-identifier hs-var">unLoc</span></a></span><span> </span><span class="annot"><span class="annottext">XRec GhcTc (Pat GhcTc)
GenLocated SrcSpanAnnA (Pat GhcTc)
</span><a href="#local-6989586621683122574"><span class="hs-identifier hs-var">pat</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-140"></span><span class="annot"><a href="GHC.HsToCore.Utils.html#selectMatchVar"><span class="hs-identifier hs-var">selectMatchVar</span></a></span><span> </span><span id="local-6989586621683122575"><span class="annot"><span class="annottext">Mult
</span><a href="#local-6989586621683122575"><span class="hs-identifier hs-var">w</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Language.Haskell.Syntax.Pat.html#ParPat"><span class="hs-identifier hs-type">ParPat</span></a></span><span> </span><span class="annot"><span class="annottext">XParPat GhcTc
</span><span class="hs-identifier">_</span></span><span>  </span><span id="local-6989586621683122577"><span class="annot"><span class="annottext">XRec GhcTc (Pat GhcTc)
</span><a href="#local-6989586621683122577"><span class="hs-identifier hs-var">pat</span></a></span></span><span class="hs-special">)</span><span>    </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Mult -&gt; Pat GhcTc -&gt; DsM Var
</span><a href="GHC.HsToCore.Utils.html#selectMatchVar"><span class="hs-identifier hs-var">selectMatchVar</span></a></span><span> </span><span class="annot"><span class="annottext">Mult
</span><a href="#local-6989586621683122575"><span class="hs-identifier hs-var">w</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">GenLocated SrcSpanAnnA (Pat GhcTc) -&gt; Pat GhcTc
forall l e. GenLocated l e -&gt; e
</span><a href="GHC.Types.SrcLoc.html#unLoc"><span class="hs-identifier hs-var">unLoc</span></a></span><span> </span><span class="annot"><span class="annottext">XRec GhcTc (Pat GhcTc)
GenLocated SrcSpanAnnA (Pat GhcTc)
</span><a href="#local-6989586621683122577"><span class="hs-identifier hs-var">pat</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-141"></span><span class="annot"><a href="GHC.HsToCore.Utils.html#selectMatchVar"><span class="hs-identifier hs-var">selectMatchVar</span></a></span><span> </span><span id="local-6989586621683122578"><span class="annot"><span class="annottext">Mult
</span><a href="#local-6989586621683122578"><span class="hs-identifier hs-var">_w</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Language.Haskell.Syntax.Pat.html#VarPat"><span class="hs-identifier hs-type">VarPat</span></a></span><span> </span><span class="annot"><span class="annottext">XVarPat GhcTc
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621683122580"><span class="annot"><span class="annottext">LIdP GhcTc
</span><a href="#local-6989586621683122580"><span class="hs-identifier hs-var">var</span></a></span></span><span class="hs-special">)</span><span>    </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Var -&gt; DsM Var
forall a. a -&gt; IOEnv (Env DsGblEnv DsLclEnv) a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Var -&gt; Var
</span><a href="GHC.Types.Id.html#localiseId"><span class="hs-identifier hs-var">localiseId</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">GenLocated SrcSpanAnnN Var -&gt; Var
forall l e. GenLocated l e -&gt; e
</span><a href="GHC.Types.SrcLoc.html#unLoc"><span class="hs-identifier hs-var">unLoc</span></a></span><span> </span><span class="annot"><span class="annottext">LIdP GhcTc
GenLocated SrcSpanAnnN Var
</span><a href="#local-6989586621683122580"><span class="hs-identifier hs-var">var</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-142"></span><span>                                  </span><span class="hs-comment">-- Note [Localise pattern binders]</span><span>
</span><span id="line-143"></span><span>                                  </span><span class="hs-comment">--</span><span>
</span><span id="line-144"></span><span>                                  </span><span class="hs-comment">-- Remark: when the pattern is a variable (or</span><span>
</span><span id="line-145"></span><span>                                  </span><span class="hs-comment">-- an @-pattern), then w is the same as the</span><span>
</span><span id="line-146"></span><span>                                  </span><span class="hs-comment">-- multiplicity stored within the variable</span><span>
</span><span id="line-147"></span><span>                                  </span><span class="hs-comment">-- itself. It's easier to pull it from the</span><span>
</span><span id="line-148"></span><span>                                  </span><span class="hs-comment">-- variable, so we ignore the multiplicity.</span><span>
</span><span id="line-149"></span><span class="annot"><a href="GHC.HsToCore.Utils.html#selectMatchVar"><span class="hs-identifier hs-var">selectMatchVar</span></a></span><span> </span><span id="local-6989586621683122582"><span class="annot"><span class="annottext">Mult
</span><a href="#local-6989586621683122582"><span class="hs-identifier hs-var">_w</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Language.Haskell.Syntax.Pat.html#AsPat"><span class="hs-identifier hs-type">AsPat</span></a></span><span> </span><span class="annot"><span class="annottext">XAsPat GhcTc
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621683122584"><span class="annot"><span class="annottext">LIdP GhcTc
</span><a href="#local-6989586621683122584"><span class="hs-identifier hs-var">var</span></a></span></span><span> </span><span class="annot"><span class="annottext">XRec GhcTc (Pat GhcTc)
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Bool -&gt; DsM Var -&gt; DsM Var
forall a. HasCallStack =&gt; Bool -&gt; a -&gt; a
</span><a href="GHC.Utils.Panic.Plain.html#assert"><span class="hs-identifier hs-var">assert</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Mult -&gt; Bool
</span><a href="GHC.Core.Type.html#isManyTy"><span class="hs-identifier hs-var">isManyTy</span></a></span><span> </span><span class="annot"><span class="annottext">Mult
</span><a href="#local-6989586621683122582"><span class="hs-identifier hs-var">_w</span></a></span><span> </span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Var -&gt; DsM Var
forall a. a -&gt; IOEnv (Env DsGblEnv DsLclEnv) a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Var -&gt; Var
</span><a href="GHC.Types.Id.html#localiseId"><span class="hs-identifier hs-var">localiseId</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">GenLocated SrcSpanAnnN Var -&gt; Var
forall l e. GenLocated l e -&gt; e
</span><a href="GHC.Types.SrcLoc.html#unLoc"><span class="hs-identifier hs-var">unLoc</span></a></span><span> </span><span class="annot"><span class="annottext">LIdP GhcTc
GenLocated SrcSpanAnnN Var
</span><a href="#local-6989586621683122584"><span class="hs-identifier hs-var">var</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-150"></span><span class="annot"><a href="GHC.HsToCore.Utils.html#selectMatchVar"><span class="hs-identifier hs-var">selectMatchVar</span></a></span><span> </span><span id="local-6989586621683122587"><span class="annot"><span class="annottext">Mult
</span><a href="#local-6989586621683122587"><span class="hs-identifier hs-var">w</span></a></span></span><span> </span><span id="local-6989586621683122588"><span class="annot"><span class="annottext">Pat GhcTc
</span><a href="#local-6989586621683122588"><span class="hs-identifier hs-var">other_pat</span></a></span></span><span>        </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Scaled Mult -&gt; DsM Var
</span><a href="GHC.HsToCore.Monad.html#newSysLocalDs"><span class="hs-identifier hs-var">newSysLocalDs</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Mult -&gt; Mult -&gt; Scaled Mult
forall a. Mult -&gt; a -&gt; Scaled a
</span><a href="GHC.Core.TyCo.Rep.html#Scaled"><span class="hs-identifier hs-var">Scaled</span></a></span><span> </span><span class="annot"><span class="annottext">Mult
</span><a href="#local-6989586621683122587"><span class="hs-identifier hs-var">w</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Pat GhcTc -&gt; Mult
</span><a href="GHC.Hs.Syn.Type.html#hsPatType"><span class="hs-identifier hs-var">hsPatType</span></a></span><span> </span><span class="annot"><span class="annottext">Pat GhcTc
</span><a href="#local-6989586621683122588"><span class="hs-identifier hs-var">other_pat</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-151"></span><span>
</span><span id="line-152"></span><span class="hs-comment">{- Note [Localise pattern binders]
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
Consider     module M where
               [Just a] = e
After renaming it looks like
             module M where
               [Just M.a] = e

We don't generalise, since it's a pattern binding, monomorphic, etc,
so after desugaring we may get something like
             M.a = case e of (v:_) -&gt;
                   case v of Just M.a -&gt; M.a
Notice the &quot;M.a&quot; in the pattern; after all, it was in the original
pattern.  However, after optimisation those pattern binders can become
let-binders, and then end up floated to top level.  They have a
different *unique* by then (the simplifier is good about maintaining
proper scoping), but it's BAD to have two top-level bindings with the
External Name M.a, because that turns into two linker symbols for M.a.
It's quite rare for this to actually *happen* -- the only case I know
of is tc003 compiled with the 'hpc' way -- but that only makes it
all the more annoying.

To avoid this, we craftily call 'localiseId' in the desugarer, which
simply turns the External Name for the Id into an Internal one, but
doesn't change the unique.  So the desugarer produces this:
             M.a{r8} = case e of (v:_) -&gt;
                       case v of Just a{r8} -&gt; M.a{r8}
The unique is still 'r8', but the binding site in the pattern
is now an Internal Name.  Now the simplifier's usual mechanisms
will propagate that Name to all the occurrence sites, as well as
un-shadowing it, so we'll get
             M.a{r8} = case e of (v:_) -&gt;
                       case v of Just a{s77} -&gt; a{s77}
In fact, even GHC.Core.Subst.simplOptExpr will do this, and simpleOptExpr
runs on the output of the desugarer, so all is well by the end of
the desugaring pass.

See also Note [Match Ids] in GHC.HsToCore.Match

************************************************************************
*                                                                      *
* type synonym EquationInfo and access functions for its pieces        *
*                                                                      *
************************************************************************
\subsection[EquationInfo-synonym]{@EquationInfo@: a useful synonym}

The ``equation info'' used by @match@ is relatively complicated and
worthy of a type synonym and a few handy functions.
-}</span><span>
</span><span id="line-201"></span><span>
</span><span id="line-202"></span><span class="annot"><a href="GHC.HsToCore.Utils.html#firstPat"><span class="hs-identifier hs-type">firstPat</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.HsToCore.Monad.html#EquationInfoNE"><span class="hs-identifier hs-type">EquationInfoNE</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Language.Haskell.Syntax.Pat.html#Pat"><span class="hs-identifier hs-type">Pat</span></a></span><span> </span><span class="annot"><a href="GHC.Hs.Extension.html#GhcTc"><span class="hs-identifier hs-type">GhcTc</span></a></span><span>
</span><span id="line-203"></span><span id="firstPat"><span class="annot"><span class="annottext">firstPat :: EquationInfoNE -&gt; Pat GhcTc
</span><a href="GHC.HsToCore.Utils.html#firstPat"><span class="hs-identifier hs-var hs-var">firstPat</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.HsToCore.Monad.html#EqnMatch"><span class="hs-identifier hs-type">EqnMatch</span></a></span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">eqn_pat :: EquationInfoNE -&gt; XRec GhcTc (Pat GhcTc)
</span><a href="GHC.HsToCore.Monad.html#eqn_pat"><span class="hs-identifier hs-var">eqn_pat</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="local-6989586621683122594"><span class="annot"><span class="annottext">XRec GhcTc (Pat GhcTc)
</span><a href="#local-6989586621683122594"><span class="hs-identifier hs-var">pat</span></a></span></span><span> </span><span class="hs-special">}</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">GenLocated SrcSpanAnnA (Pat GhcTc) -&gt; Pat GhcTc
forall l e. GenLocated l e -&gt; e
</span><a href="GHC.Types.SrcLoc.html#unLoc"><span class="hs-identifier hs-var">unLoc</span></a></span><span> </span><span class="annot"><span class="annottext">XRec GhcTc (Pat GhcTc)
GenLocated SrcSpanAnnA (Pat GhcTc)
</span><a href="#local-6989586621683122594"><span class="hs-identifier hs-var">pat</span></a></span><span>
</span><span id="line-204"></span><span class="annot"><a href="GHC.HsToCore.Utils.html#firstPat"><span class="hs-identifier hs-var">firstPat</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.HsToCore.Monad.html#EqnDone"><span class="hs-identifier hs-type">EqnDone</span></a></span><span> </span><span class="hs-special">{</span><span class="hs-special">}</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[Char] -&gt; Pat GhcTc
forall a. HasCallStack =&gt; [Char] -&gt; a
</span><span class="hs-identifier hs-var">error</span></span><span> </span><span class="annot"><span class="annottext">[Char]
</span><span class="hs-string">&quot;firstPat: no patterns&quot;</span></span><span>
</span><span id="line-205"></span><span>
</span><span id="line-206"></span><span id="local-6989586621683122144"><span class="annot"><a href="GHC.HsToCore.Utils.html#shiftEqns"><span class="hs-identifier hs-type">shiftEqns</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Functor</span></span><span> </span><span class="annot"><a href="#local-6989586621683122144"><span class="hs-identifier hs-type">f</span></a></span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="#local-6989586621683122144"><span class="hs-identifier hs-type">f</span></a></span><span> </span><span class="annot"><a href="GHC.HsToCore.Monad.html#EquationInfoNE"><span class="hs-identifier hs-type">EquationInfoNE</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621683122144"><span class="hs-identifier hs-type">f</span></a></span><span> </span><span class="annot"><a href="GHC.HsToCore.Monad.html#EquationInfo"><span class="hs-identifier hs-type">EquationInfo</span></a></span></span><span>
</span><span id="line-207"></span><span class="hs-comment">-- Drop the first pattern in each equation</span><span>
</span><span id="line-208"></span><span id="shiftEqns"><span class="annot"><span class="annottext">shiftEqns :: forall (f :: * -&gt; *).
Functor f =&gt;
f EquationInfoNE -&gt; f EquationInfoNE
</span><a href="GHC.HsToCore.Utils.html#shiftEqns"><span class="hs-identifier hs-var hs-var">shiftEqns</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(EquationInfoNE -&gt; EquationInfoNE)
-&gt; f EquationInfoNE -&gt; f EquationInfoNE
forall a b. (a -&gt; b) -&gt; f a -&gt; f b
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-identifier hs-var">fmap</span></span><span> </span><span class="annot"><span class="annottext">EquationInfoNE -&gt; EquationInfoNE
</span><a href="GHC.HsToCore.Monad.html#eqn_rest"><span class="hs-identifier hs-var">eqn_rest</span></a></span><span>
</span><span id="line-209"></span><span>
</span><span id="line-210"></span><span class="annot"><a href="GHC.HsToCore.Utils.html#combineEqnRhss"><span class="hs-identifier hs-type">combineEqnRhss</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">NonEmpty</span></span><span> </span><span class="annot"><a href="GHC.HsToCore.Monad.html#EquationInfo"><span class="hs-identifier hs-type">EquationInfo</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.HsToCore.Types.html#DsM"><span class="hs-identifier hs-type">DsM</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.HsToCore.Monad.html#MatchResult"><span class="hs-identifier hs-type">MatchResult</span></a></span><span> </span><span class="annot"><a href="GHC.Core.html#CoreExpr"><span class="hs-identifier hs-type">CoreExpr</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-211"></span><span id="combineEqnRhss"><span class="annot"><span class="annottext">combineEqnRhss :: NonEmpty EquationInfoNE -&gt; DsM (MatchResult CoreExpr)
</span><a href="GHC.HsToCore.Utils.html#combineEqnRhss"><span class="hs-identifier hs-var hs-var">combineEqnRhss</span></a></span></span><span> </span><span id="local-6989586621683122600"><span class="annot"><span class="annottext">NonEmpty EquationInfoNE
</span><a href="#local-6989586621683122600"><span class="hs-identifier hs-var">eqns</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">MatchResult CoreExpr -&gt; DsM (MatchResult CoreExpr)
forall a. a -&gt; IOEnv (Env DsGblEnv DsLclEnv) a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="annot"><span class="annottext">(MatchResult CoreExpr -&gt; DsM (MatchResult CoreExpr))
-&gt; MatchResult CoreExpr -&gt; DsM (MatchResult CoreExpr)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">(MatchResult CoreExpr
 -&gt; MatchResult CoreExpr -&gt; MatchResult CoreExpr)
-&gt; [MatchResult CoreExpr] -&gt; MatchResult CoreExpr
forall a. (a -&gt; a -&gt; a) -&gt; [a] -&gt; a
forall (t :: * -&gt; *) a. Foldable t =&gt; (a -&gt; a -&gt; a) -&gt; t a -&gt; a
</span><span class="hs-identifier hs-var">foldr1</span></span><span> </span><span class="annot"><span class="annottext">MatchResult CoreExpr
-&gt; MatchResult CoreExpr -&gt; MatchResult CoreExpr
</span><a href="GHC.HsToCore.Utils.html#combineMatchResults"><span class="hs-identifier hs-var">combineMatchResults</span></a></span><span> </span><span class="annot"><span class="annottext">([MatchResult CoreExpr] -&gt; MatchResult CoreExpr)
-&gt; [MatchResult CoreExpr] -&gt; MatchResult CoreExpr
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">(EquationInfoNE -&gt; MatchResult CoreExpr)
-&gt; [EquationInfoNE] -&gt; [MatchResult CoreExpr]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><span class="hs-identifier hs-var">map</span></span><span> </span><span class="annot"><span class="annottext">EquationInfoNE -&gt; MatchResult CoreExpr
</span><a href="GHC.HsToCore.Monad.html#eqnMatchResult"><span class="hs-identifier hs-var">eqnMatchResult</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">NonEmpty EquationInfoNE -&gt; [EquationInfoNE]
forall a. NonEmpty a -&gt; [a]
</span><a href="../../base-4.21.0.0-ae91/src/Data.List.NonEmpty.html#toList"><span class="hs-identifier hs-var">NEL.toList</span></a></span><span> </span><span class="annot"><span class="annottext">NonEmpty EquationInfoNE
</span><a href="#local-6989586621683122600"><span class="hs-identifier hs-var">eqns</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-212"></span><span>
</span><span id="line-213"></span><span class="hs-comment">-- Functions on MatchResult CoreExprs</span><span>
</span><span id="line-214"></span><span>
</span><span id="line-215"></span><span id="local-6989586621683122159"><span class="annot"><a href="GHC.HsToCore.Utils.html#matchCanFail"><span class="hs-identifier hs-type">matchCanFail</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.HsToCore.Monad.html#MatchResult"><span class="hs-identifier hs-type">MatchResult</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683122159"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Bool</span></span></span><span>
</span><span id="line-216"></span><span id="matchCanFail"><span class="annot"><span class="annottext">matchCanFail :: forall a. MatchResult a -&gt; Bool
</span><a href="GHC.HsToCore.Utils.html#matchCanFail"><span class="hs-identifier hs-var hs-var">matchCanFail</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.HsToCore.Monad.html#MR_Fallible"><span class="hs-identifier hs-type">MR_Fallible</span></a></span><span> </span><span class="hs-special">{</span><span class="hs-special">}</span><span class="hs-special">)</span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">True</span></span><span>
</span><span id="line-217"></span><span class="annot"><a href="GHC.HsToCore.Utils.html#matchCanFail"><span class="hs-identifier hs-var">matchCanFail</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.HsToCore.Monad.html#MR_Infallible"><span class="hs-identifier hs-type">MR_Infallible</span></a></span><span> </span><span class="hs-special">{</span><span class="hs-special">}</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">False</span></span><span>
</span><span id="line-218"></span><span>
</span><span id="line-219"></span><span class="annot"><a href="GHC.HsToCore.Utils.html#alwaysFailMatchResult"><span class="hs-identifier hs-type">alwaysFailMatchResult</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.HsToCore.Monad.html#MatchResult"><span class="hs-identifier hs-type">MatchResult</span></a></span><span> </span><span class="annot"><a href="GHC.Core.html#CoreExpr"><span class="hs-identifier hs-type">CoreExpr</span></a></span><span>
</span><span id="line-220"></span><span id="alwaysFailMatchResult"><span class="annot"><span class="annottext">alwaysFailMatchResult :: MatchResult CoreExpr
</span><a href="GHC.HsToCore.Utils.html#alwaysFailMatchResult"><span class="hs-identifier hs-var hs-var">alwaysFailMatchResult</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(CoreExpr -&gt; DsM CoreExpr) -&gt; MatchResult CoreExpr
forall a. (CoreExpr -&gt; DsM a) -&gt; MatchResult a
</span><a href="GHC.HsToCore.Monad.html#MR_Fallible"><span class="hs-identifier hs-var">MR_Fallible</span></a></span><span> </span><span class="annot"><span class="annottext">((CoreExpr -&gt; DsM CoreExpr) -&gt; MatchResult CoreExpr)
-&gt; (CoreExpr -&gt; DsM CoreExpr) -&gt; MatchResult CoreExpr
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-glyph">\</span><span id="local-6989586621683122606"><span class="annot"><span class="annottext">CoreExpr
</span><a href="#local-6989586621683122606"><span class="hs-identifier hs-var">fail</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">CoreExpr -&gt; DsM CoreExpr
forall a. a -&gt; IOEnv (Env DsGblEnv DsLclEnv) a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="annot"><span class="annottext">CoreExpr
</span><a href="#local-6989586621683122606"><span class="hs-identifier hs-var">fail</span></a></span><span>
</span><span id="line-221"></span><span>
</span><span id="line-222"></span><span class="annot"><a href="GHC.HsToCore.Utils.html#cantFailMatchResult"><span class="hs-identifier hs-type">cantFailMatchResult</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Core.html#CoreExpr"><span class="hs-identifier hs-type">CoreExpr</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.HsToCore.Monad.html#MatchResult"><span class="hs-identifier hs-type">MatchResult</span></a></span><span> </span><span class="annot"><a href="GHC.Core.html#CoreExpr"><span class="hs-identifier hs-type">CoreExpr</span></a></span><span>
</span><span id="line-223"></span><span id="cantFailMatchResult"><span class="annot"><span class="annottext">cantFailMatchResult :: CoreExpr -&gt; MatchResult CoreExpr
</span><a href="GHC.HsToCore.Utils.html#cantFailMatchResult"><span class="hs-identifier hs-var hs-var">cantFailMatchResult</span></a></span></span><span> </span><span id="local-6989586621683122607"><span class="annot"><span class="annottext">CoreExpr
</span><a href="#local-6989586621683122607"><span class="hs-identifier hs-var">expr</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">DsM CoreExpr -&gt; MatchResult CoreExpr
forall a. DsM a -&gt; MatchResult a
</span><a href="GHC.HsToCore.Monad.html#MR_Infallible"><span class="hs-identifier hs-var">MR_Infallible</span></a></span><span> </span><span class="annot"><span class="annottext">(DsM CoreExpr -&gt; MatchResult CoreExpr)
-&gt; DsM CoreExpr -&gt; MatchResult CoreExpr
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">CoreExpr -&gt; DsM CoreExpr
forall a. a -&gt; IOEnv (Env DsGblEnv DsLclEnv) a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="annot"><span class="annottext">CoreExpr
</span><a href="#local-6989586621683122607"><span class="hs-identifier hs-var">expr</span></a></span><span>
</span><span id="line-224"></span><span>
</span><span id="line-225"></span><span class="annot"><a href="GHC.HsToCore.Utils.html#extractMatchResult"><span class="hs-identifier hs-type">extractMatchResult</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.HsToCore.Monad.html#MatchResult"><span class="hs-identifier hs-type">MatchResult</span></a></span><span> </span><span class="annot"><a href="GHC.Core.html#CoreExpr"><span class="hs-identifier hs-type">CoreExpr</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Core.html#CoreExpr"><span class="hs-identifier hs-type">CoreExpr</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.HsToCore.Types.html#DsM"><span class="hs-identifier hs-type">DsM</span></a></span><span> </span><span class="annot"><a href="GHC.Core.html#CoreExpr"><span class="hs-identifier hs-type">CoreExpr</span></a></span><span>
</span><span id="line-226"></span><span id="extractMatchResult"><span class="annot"><span class="annottext">extractMatchResult :: MatchResult CoreExpr -&gt; CoreExpr -&gt; DsM CoreExpr
</span><a href="GHC.HsToCore.Utils.html#extractMatchResult"><span class="hs-identifier hs-var hs-var">extractMatchResult</span></a></span></span><span> </span><span id="local-6989586621683122608"><span class="annot"><span class="annottext">MatchResult CoreExpr
</span><a href="#local-6989586621683122608"><span class="hs-identifier hs-var">match_result</span></a></span></span><span> </span><span id="local-6989586621683122609"><span class="annot"><span class="annottext">CoreExpr
</span><a href="#local-6989586621683122609"><span class="hs-identifier hs-var">failure_expr</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-227"></span><span>  </span><span class="annot"><span class="annottext">CoreExpr -&gt; MatchResult CoreExpr -&gt; DsM CoreExpr
forall a. CoreExpr -&gt; MatchResult a -&gt; DsM a
</span><a href="GHC.HsToCore.Monad.html#runMatchResult"><span class="hs-identifier hs-var">runMatchResult</span></a></span><span>
</span><span id="line-228"></span><span>    </span><span class="annot"><span class="annottext">CoreExpr
</span><a href="#local-6989586621683122609"><span class="hs-identifier hs-var">failure_expr</span></a></span><span>
</span><span id="line-229"></span><span>    </span><span class="hs-special">(</span><span class="annot"><span class="annottext">MatchResult CoreExpr -&gt; MatchResult CoreExpr
</span><a href="GHC.HsToCore.Utils.html#shareFailureHandler"><span class="hs-identifier hs-var">shareFailureHandler</span></a></span><span> </span><span class="annot"><span class="annottext">MatchResult CoreExpr
</span><a href="#local-6989586621683122608"><span class="hs-identifier hs-var">match_result</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-230"></span><span>
</span><span id="line-231"></span><span class="annot"><a href="GHC.HsToCore.Utils.html#combineMatchResults"><span class="hs-identifier hs-type">combineMatchResults</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.HsToCore.Monad.html#MatchResult"><span class="hs-identifier hs-type">MatchResult</span></a></span><span> </span><span class="annot"><a href="GHC.Core.html#CoreExpr"><span class="hs-identifier hs-type">CoreExpr</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.HsToCore.Monad.html#MatchResult"><span class="hs-identifier hs-type">MatchResult</span></a></span><span> </span><span class="annot"><a href="GHC.Core.html#CoreExpr"><span class="hs-identifier hs-type">CoreExpr</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.HsToCore.Monad.html#MatchResult"><span class="hs-identifier hs-type">MatchResult</span></a></span><span> </span><span class="annot"><a href="GHC.Core.html#CoreExpr"><span class="hs-identifier hs-type">CoreExpr</span></a></span><span>
</span><span id="line-232"></span><span id="combineMatchResults"><span class="annot"><span class="annottext">combineMatchResults :: MatchResult CoreExpr
-&gt; MatchResult CoreExpr -&gt; MatchResult CoreExpr
</span><a href="GHC.HsToCore.Utils.html#combineMatchResults"><span class="hs-identifier hs-var hs-var">combineMatchResults</span></a></span></span><span> </span><span id="local-6989586621683122611"><span class="annot"><span class="annottext">match_result1 :: MatchResult CoreExpr
</span><a href="#local-6989586621683122611"><span class="hs-identifier hs-var">match_result1</span></a></span></span><span class="hs-glyph">@</span><span class="hs-special">(</span><span class="annot"><a href="GHC.HsToCore.Monad.html#MR_Infallible"><span class="hs-identifier hs-type">MR_Infallible</span></a></span><span> </span><span class="annot"><span class="annottext">DsM CoreExpr
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">MatchResult CoreExpr
</span><span class="hs-identifier">_</span></span><span>
</span><span id="line-233"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">MatchResult CoreExpr
</span><a href="#local-6989586621683122611"><span class="hs-identifier hs-var">match_result1</span></a></span><span>
</span><span id="line-234"></span><span class="annot"><a href="GHC.HsToCore.Utils.html#combineMatchResults"><span class="hs-identifier hs-var">combineMatchResults</span></a></span><span> </span><span id="local-6989586621683122612"><span class="annot"><span class="annottext">MatchResult CoreExpr
</span><a href="#local-6989586621683122612"><span class="hs-identifier hs-var">match_result1</span></a></span></span><span> </span><span id="local-6989586621683122613"><span class="annot"><span class="annottext">MatchResult CoreExpr
</span><a href="#local-6989586621683122613"><span class="hs-identifier hs-var">match_result2</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-235"></span><span>  </span><span class="hs-comment">-- if the first pattern needs a failure handler (i.e. if it is fallible),</span><span>
</span><span id="line-236"></span><span>  </span><span class="hs-comment">-- make it let-bind it bind it with `shareFailureHandler`.</span><span>
</span><span id="line-237"></span><span>  </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">MatchResult CoreExpr -&gt; MatchResult CoreExpr
</span><a href="GHC.HsToCore.Utils.html#shareFailureHandler"><span class="hs-identifier hs-var">shareFailureHandler</span></a></span><span> </span><span class="annot"><span class="annottext">MatchResult CoreExpr
</span><a href="#local-6989586621683122612"><span class="hs-identifier hs-var">match_result1</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-238"></span><span>    </span><span class="annot"><a href="GHC.HsToCore.Monad.html#MR_Infallible"><span class="hs-identifier hs-type">MR_Infallible</span></a></span><span> </span><span class="annot"><span class="annottext">DsM CoreExpr
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">MatchResult CoreExpr
</span><a href="#local-6989586621683122612"><span class="hs-identifier hs-var">match_result1</span></a></span><span>
</span><span id="line-239"></span><span>    </span><span class="annot"><a href="GHC.HsToCore.Monad.html#MR_Fallible"><span class="hs-identifier hs-type">MR_Fallible</span></a></span><span> </span><span id="local-6989586621683122614"><span class="annot"><span class="annottext">CoreExpr -&gt; DsM CoreExpr
</span><a href="#local-6989586621683122614"><span class="hs-identifier hs-var">body_fn1</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">(CoreExpr -&gt; DsM CoreExpr) -&gt; MatchResult CoreExpr
forall a. (CoreExpr -&gt; DsM a) -&gt; MatchResult a
</span><a href="GHC.HsToCore.Monad.html#MR_Fallible"><span class="hs-identifier hs-var">MR_Fallible</span></a></span><span> </span><span class="annot"><span class="annottext">((CoreExpr -&gt; DsM CoreExpr) -&gt; MatchResult CoreExpr)
-&gt; (CoreExpr -&gt; DsM CoreExpr) -&gt; MatchResult CoreExpr
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-glyph">\</span><span id="local-6989586621683122615"><span class="annot"><span class="annottext">CoreExpr
</span><a href="#local-6989586621683122615"><span class="hs-identifier hs-var">fail_expr</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-240"></span><span>      </span><span class="hs-comment">-- Before actually failing, try the next match arm.</span><span>
</span><span id="line-241"></span><span>      </span><span class="annot"><span class="annottext">CoreExpr -&gt; DsM CoreExpr
</span><a href="#local-6989586621683122614"><span class="hs-identifier hs-var">body_fn1</span></a></span><span> </span><span class="annot"><span class="annottext">(CoreExpr -&gt; DsM CoreExpr) -&gt; DsM CoreExpr -&gt; DsM CoreExpr
forall (m :: * -&gt; *) a b. Monad m =&gt; (a -&gt; m b) -&gt; m a -&gt; m b
</span><span class="hs-operator hs-var">=&lt;&lt;</span></span><span> </span><span class="annot"><span class="annottext">CoreExpr -&gt; MatchResult CoreExpr -&gt; DsM CoreExpr
forall a. CoreExpr -&gt; MatchResult a -&gt; DsM a
</span><a href="GHC.HsToCore.Monad.html#runMatchResult"><span class="hs-identifier hs-var">runMatchResult</span></a></span><span> </span><span class="annot"><span class="annottext">CoreExpr
</span><a href="#local-6989586621683122615"><span class="hs-identifier hs-var">fail_expr</span></a></span><span> </span><span class="annot"><span class="annottext">MatchResult CoreExpr
</span><a href="#local-6989586621683122613"><span class="hs-identifier hs-var">match_result2</span></a></span><span>
</span><span id="line-242"></span><span>
</span><span id="line-243"></span><span id="local-6989586621683122166"><span id="local-6989586621683122167"><span class="annot"><a href="GHC.HsToCore.Utils.html#adjustMatchResultDs"><span class="hs-identifier hs-type">adjustMatchResultDs</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621683122166"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.HsToCore.Types.html#DsM"><span class="hs-identifier hs-type">DsM</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683122167"><span class="hs-identifier hs-type">b</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.HsToCore.Monad.html#MatchResult"><span class="hs-identifier hs-type">MatchResult</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683122166"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.HsToCore.Monad.html#MatchResult"><span class="hs-identifier hs-type">MatchResult</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683122167"><span class="hs-identifier hs-type">b</span></a></span></span></span><span>
</span><span id="line-244"></span><span id="adjustMatchResultDs"><span class="annot"><span class="annottext">adjustMatchResultDs :: forall a b. (a -&gt; DsM b) -&gt; MatchResult a -&gt; MatchResult b
</span><a href="GHC.HsToCore.Utils.html#adjustMatchResultDs"><span class="hs-identifier hs-var hs-var">adjustMatchResultDs</span></a></span></span><span> </span><span id="local-6989586621683122619"><span class="annot"><span class="annottext">a -&gt; DsM b
</span><a href="#local-6989586621683122619"><span class="hs-identifier hs-var">encl_fn</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-glyph">\</span><span class="hs-glyph">case</span><span>
</span><span id="line-245"></span><span>  </span><span class="annot"><a href="GHC.HsToCore.Monad.html#MR_Infallible"><span class="hs-identifier hs-type">MR_Infallible</span></a></span><span> </span><span id="local-6989586621683122620"><span class="annot"><span class="annottext">DsM a
</span><a href="#local-6989586621683122620"><span class="hs-identifier hs-var">body_fn</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">DsM b -&gt; MatchResult b
forall a. DsM a -&gt; MatchResult a
</span><a href="GHC.HsToCore.Monad.html#MR_Infallible"><span class="hs-identifier hs-var">MR_Infallible</span></a></span><span> </span><span class="annot"><span class="annottext">(DsM b -&gt; MatchResult b) -&gt; DsM b -&gt; MatchResult b
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-246"></span><span>    </span><span class="annot"><span class="annottext">a -&gt; DsM b
</span><a href="#local-6989586621683122619"><span class="hs-identifier hs-var">encl_fn</span></a></span><span> </span><span class="annot"><span class="annottext">(a -&gt; DsM b) -&gt; DsM a -&gt; DsM b
forall (m :: * -&gt; *) a b. Monad m =&gt; (a -&gt; m b) -&gt; m a -&gt; m b
</span><span class="hs-operator hs-var">=&lt;&lt;</span></span><span> </span><span class="annot"><span class="annottext">DsM a
</span><a href="#local-6989586621683122620"><span class="hs-identifier hs-var">body_fn</span></a></span><span>
</span><span id="line-247"></span><span>  </span><span class="annot"><a href="GHC.HsToCore.Monad.html#MR_Fallible"><span class="hs-identifier hs-type">MR_Fallible</span></a></span><span> </span><span id="local-6989586621683122621"><span class="annot"><span class="annottext">CoreExpr -&gt; DsM a
</span><a href="#local-6989586621683122621"><span class="hs-identifier hs-var">body_fn</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">(CoreExpr -&gt; DsM b) -&gt; MatchResult b
forall a. (CoreExpr -&gt; DsM a) -&gt; MatchResult a
</span><a href="GHC.HsToCore.Monad.html#MR_Fallible"><span class="hs-identifier hs-var">MR_Fallible</span></a></span><span> </span><span class="annot"><span class="annottext">((CoreExpr -&gt; DsM b) -&gt; MatchResult b)
-&gt; (CoreExpr -&gt; DsM b) -&gt; MatchResult b
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-glyph">\</span><span id="local-6989586621683122622"><span class="annot"><span class="annottext">CoreExpr
</span><a href="#local-6989586621683122622"><span class="hs-identifier hs-var">fail</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-248"></span><span>    </span><span class="annot"><span class="annottext">a -&gt; DsM b
</span><a href="#local-6989586621683122619"><span class="hs-identifier hs-var">encl_fn</span></a></span><span> </span><span class="annot"><span class="annottext">(a -&gt; DsM b) -&gt; DsM a -&gt; DsM b
forall (m :: * -&gt; *) a b. Monad m =&gt; (a -&gt; m b) -&gt; m a -&gt; m b
</span><span class="hs-operator hs-var">=&lt;&lt;</span></span><span> </span><span class="annot"><span class="annottext">CoreExpr -&gt; DsM a
</span><a href="#local-6989586621683122621"><span class="hs-identifier hs-var">body_fn</span></a></span><span> </span><span class="annot"><span class="annottext">CoreExpr
</span><a href="#local-6989586621683122622"><span class="hs-identifier hs-var">fail</span></a></span><span>
</span><span id="line-249"></span><span>
</span><span id="line-250"></span><span class="annot"><a href="GHC.HsToCore.Utils.html#wrapBinds"><span class="hs-identifier hs-type">wrapBinds</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><span class="hs-special">(</span><span class="annot"><a href="GHC.Types.Var.html#Var"><span class="hs-identifier hs-type">Var</span></a></span><span class="hs-special">,</span><span class="annot"><a href="GHC.Types.Var.html#Var"><span class="hs-identifier hs-type">Var</span></a></span><span class="hs-special">)</span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Core.html#CoreExpr"><span class="hs-identifier hs-type">CoreExpr</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Core.html#CoreExpr"><span class="hs-identifier hs-type">CoreExpr</span></a></span><span>
</span><span id="line-251"></span><span id="wrapBinds"><span class="annot"><span class="annottext">wrapBinds :: [(Var, Var)] -&gt; CoreExpr -&gt; CoreExpr
</span><a href="GHC.HsToCore.Utils.html#wrapBinds"><span class="hs-identifier hs-var hs-var">wrapBinds</span></a></span></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><span id="local-6989586621683122623"><span class="annot"><span class="annottext">CoreExpr
</span><a href="#local-6989586621683122623"><span class="hs-identifier hs-var">e</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">CoreExpr
</span><a href="#local-6989586621683122623"><span class="hs-identifier hs-var">e</span></a></span><span>
</span><span id="line-252"></span><span class="annot"><a href="GHC.HsToCore.Utils.html#wrapBinds"><span class="hs-identifier hs-var">wrapBinds</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">(</span><span id="local-6989586621683122624"><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621683122624"><span class="hs-identifier hs-var">new</span></a></span></span><span class="hs-special">,</span><span id="local-6989586621683122625"><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621683122625"><span class="hs-identifier hs-var">old</span></a></span></span><span class="hs-special">)</span><span class="annot"><span class="hs-glyph hs-type">:</span></span><span id="local-6989586621683122626"><span class="annot"><span class="annottext">[(Var, Var)]
</span><a href="#local-6989586621683122626"><span class="hs-identifier hs-var">prs</span></a></span></span><span class="hs-special">)</span><span> </span><span id="local-6989586621683122627"><span class="annot"><span class="annottext">CoreExpr
</span><a href="#local-6989586621683122627"><span class="hs-identifier hs-var">e</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Var -&gt; Var -&gt; CoreExpr -&gt; CoreExpr
</span><a href="GHC.HsToCore.Utils.html#wrapBind"><span class="hs-identifier hs-var">wrapBind</span></a></span><span> </span><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621683122624"><span class="hs-identifier hs-var">new</span></a></span><span> </span><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621683122625"><span class="hs-identifier hs-var">old</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[(Var, Var)] -&gt; CoreExpr -&gt; CoreExpr
</span><a href="GHC.HsToCore.Utils.html#wrapBinds"><span class="hs-identifier hs-var">wrapBinds</span></a></span><span> </span><span class="annot"><span class="annottext">[(Var, Var)]
</span><a href="#local-6989586621683122626"><span class="hs-identifier hs-var">prs</span></a></span><span> </span><span class="annot"><span class="annottext">CoreExpr
</span><a href="#local-6989586621683122627"><span class="hs-identifier hs-var">e</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-253"></span><span>
</span><span id="line-254"></span><span class="annot"><a href="GHC.HsToCore.Utils.html#wrapBind"><span class="hs-identifier hs-type">wrapBind</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Types.Var.html#Var"><span class="hs-identifier hs-type">Var</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Types.Var.html#Var"><span class="hs-identifier hs-type">Var</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Core.html#CoreExpr"><span class="hs-identifier hs-type">CoreExpr</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Core.html#CoreExpr"><span class="hs-identifier hs-type">CoreExpr</span></a></span><span>
</span><span id="line-255"></span><span id="wrapBind"><span class="annot"><span class="annottext">wrapBind :: Var -&gt; Var -&gt; CoreExpr -&gt; CoreExpr
</span><a href="GHC.HsToCore.Utils.html#wrapBind"><span class="hs-identifier hs-var hs-var">wrapBind</span></a></span></span><span> </span><span id="local-6989586621683122628"><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621683122628"><span class="hs-identifier hs-var">new</span></a></span></span><span> </span><span id="local-6989586621683122629"><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621683122629"><span class="hs-identifier hs-var">old</span></a></span></span><span> </span><span id="local-6989586621683122630"><span class="annot"><span class="annottext">CoreExpr
</span><a href="#local-6989586621683122630"><span class="hs-identifier hs-var">body</span></a></span></span><span>   </span><span class="hs-comment">-- NB: this function must deal with term</span><span>
</span><span id="line-256"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621683122628"><span class="hs-identifier hs-var">new</span></a></span><span class="annot"><span class="annottext">Var -&gt; Var -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">==</span></span><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621683122629"><span class="hs-identifier hs-var">old</span></a></span><span>    </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">CoreExpr
</span><a href="#local-6989586621683122630"><span class="hs-identifier hs-var">body</span></a></span><span>  </span><span class="hs-comment">-- variables, type variables or coercion variables</span><span>
</span><span id="line-257"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">otherwise</span></span><span>   </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Bind Var -&gt; CoreExpr -&gt; CoreExpr
forall b. Bind b -&gt; Expr b -&gt; Expr b
</span><a href="GHC.Core.html#Let"><span class="hs-identifier hs-var">Let</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Var -&gt; CoreExpr -&gt; Bind Var
forall b. b -&gt; Expr b -&gt; Bind b
</span><a href="GHC.Core.html#NonRec"><span class="hs-identifier hs-var">NonRec</span></a></span><span> </span><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621683122628"><span class="hs-identifier hs-var">new</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Var -&gt; CoreExpr
forall b. Var -&gt; Expr b
</span><a href="GHC.Core.html#varToCoreExpr"><span class="hs-identifier hs-var">varToCoreExpr</span></a></span><span> </span><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621683122629"><span class="hs-identifier hs-var">old</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">CoreExpr
</span><a href="#local-6989586621683122630"><span class="hs-identifier hs-var">body</span></a></span><span>
</span><span id="line-258"></span><span>
</span><span id="line-259"></span><span class="hs-comment">-- Used to force variables when desugaring strict binders. It's crucial that the</span><span>
</span><span id="line-260"></span><span class="hs-comment">-- variable is shadowed by the case binder. See Wrinkle 1 in</span><span>
</span><span id="line-261"></span><span class="hs-comment">-- Note [Desugar Strict binds] in GHC.HsToCore.Binds.</span><span>
</span><span id="line-262"></span><span class="annot"><a href="GHC.HsToCore.Utils.html#seqVar"><span class="hs-identifier hs-type">seqVar</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Types.Var.html#Var"><span class="hs-identifier hs-type">Var</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Core.html#CoreExpr"><span class="hs-identifier hs-type">CoreExpr</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Core.html#CoreExpr"><span class="hs-identifier hs-type">CoreExpr</span></a></span><span>
</span><span id="line-263"></span><span id="seqVar"><span class="annot"><span class="annottext">seqVar :: Var -&gt; CoreExpr -&gt; CoreExpr
</span><a href="GHC.HsToCore.Utils.html#seqVar"><span class="hs-identifier hs-var hs-var">seqVar</span></a></span></span><span> </span><span id="local-6989586621683122634"><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621683122634"><span class="hs-identifier hs-var">var</span></a></span></span><span> </span><span id="local-6989586621683122635"><span class="annot"><span class="annottext">CoreExpr
</span><a href="#local-6989586621683122635"><span class="hs-identifier hs-var">body</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">CoreExpr -&gt; Var -&gt; CoreExpr -&gt; CoreExpr
</span><a href="GHC.Core.Utils.html#mkDefaultCase"><span class="hs-identifier hs-var">mkDefaultCase</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Var -&gt; CoreExpr
forall b. Var -&gt; Expr b
</span><a href="GHC.Core.html#Var"><span class="hs-identifier hs-var">Var</span></a></span><span> </span><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621683122634"><span class="hs-identifier hs-var">var</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621683122634"><span class="hs-identifier hs-var">var</span></a></span><span> </span><span class="annot"><span class="annottext">CoreExpr
</span><a href="#local-6989586621683122635"><span class="hs-identifier hs-var">body</span></a></span><span>
</span><span id="line-264"></span><span>
</span><span id="line-265"></span><span class="annot"><a href="GHC.HsToCore.Utils.html#mkCoLetMatchResult"><span class="hs-identifier hs-type">mkCoLetMatchResult</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Core.html#CoreBind"><span class="hs-identifier hs-type">CoreBind</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.HsToCore.Monad.html#MatchResult"><span class="hs-identifier hs-type">MatchResult</span></a></span><span> </span><span class="annot"><a href="GHC.Core.html#CoreExpr"><span class="hs-identifier hs-type">CoreExpr</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.HsToCore.Monad.html#MatchResult"><span class="hs-identifier hs-type">MatchResult</span></a></span><span> </span><span class="annot"><a href="GHC.Core.html#CoreExpr"><span class="hs-identifier hs-type">CoreExpr</span></a></span><span>
</span><span id="line-266"></span><span id="mkCoLetMatchResult"><span class="annot"><span class="annottext">mkCoLetMatchResult :: Bind Var -&gt; MatchResult CoreExpr -&gt; MatchResult CoreExpr
</span><a href="GHC.HsToCore.Utils.html#mkCoLetMatchResult"><span class="hs-identifier hs-var hs-var">mkCoLetMatchResult</span></a></span></span><span> </span><span id="local-6989586621683122639"><span class="annot"><span class="annottext">Bind Var
</span><a href="#local-6989586621683122639"><span class="hs-identifier hs-var">bind</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(CoreExpr -&gt; CoreExpr)
-&gt; MatchResult CoreExpr -&gt; MatchResult CoreExpr
forall a b. (a -&gt; b) -&gt; MatchResult a -&gt; MatchResult b
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-identifier hs-var">fmap</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Bind Var -&gt; CoreExpr -&gt; CoreExpr
</span><a href="GHC.Core.Make.html#mkCoreLet"><span class="hs-identifier hs-var">mkCoreLet</span></a></span><span> </span><span class="annot"><span class="annottext">Bind Var
</span><a href="#local-6989586621683122639"><span class="hs-identifier hs-var">bind</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-267"></span><span>
</span><span id="line-268"></span><span class="hs-comment">-- (mkViewMatchResult var' viewExpr mr) makes the expression</span><span>
</span><span id="line-269"></span><span class="hs-comment">-- let var' = viewExpr in mr</span><span>
</span><span id="line-270"></span><span class="annot"><a href="GHC.HsToCore.Utils.html#mkViewMatchResult"><span class="hs-identifier hs-type">mkViewMatchResult</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Types.Var.html#Id"><span class="hs-identifier hs-type">Id</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Core.html#CoreExpr"><span class="hs-identifier hs-type">CoreExpr</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.HsToCore.Monad.html#MatchResult"><span class="hs-identifier hs-type">MatchResult</span></a></span><span> </span><span class="annot"><a href="GHC.Core.html#CoreExpr"><span class="hs-identifier hs-type">CoreExpr</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.HsToCore.Monad.html#MatchResult"><span class="hs-identifier hs-type">MatchResult</span></a></span><span> </span><span class="annot"><a href="GHC.Core.html#CoreExpr"><span class="hs-identifier hs-type">CoreExpr</span></a></span><span>
</span><span id="line-271"></span><span id="mkViewMatchResult"><span class="annot"><span class="annottext">mkViewMatchResult :: Var -&gt; CoreExpr -&gt; MatchResult CoreExpr -&gt; MatchResult CoreExpr
</span><a href="GHC.HsToCore.Utils.html#mkViewMatchResult"><span class="hs-identifier hs-var hs-var">mkViewMatchResult</span></a></span></span><span> </span><span id="local-6989586621683122641"><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621683122641"><span class="hs-identifier hs-var">var'</span></a></span></span><span> </span><span id="local-6989586621683122642"><span class="annot"><span class="annottext">CoreExpr
</span><a href="#local-6989586621683122642"><span class="hs-identifier hs-var">viewExpr</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(CoreExpr -&gt; CoreExpr)
-&gt; MatchResult CoreExpr -&gt; MatchResult CoreExpr
forall a b. (a -&gt; b) -&gt; MatchResult a -&gt; MatchResult b
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-identifier hs-var">fmap</span></span><span> </span><span class="annot"><span class="annottext">((CoreExpr -&gt; CoreExpr)
 -&gt; MatchResult CoreExpr -&gt; MatchResult CoreExpr)
-&gt; (CoreExpr -&gt; CoreExpr)
-&gt; MatchResult CoreExpr
-&gt; MatchResult CoreExpr
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Bind Var -&gt; CoreExpr -&gt; CoreExpr
</span><a href="GHC.Core.Make.html#mkCoreLet"><span class="hs-identifier hs-var">mkCoreLet</span></a></span><span> </span><span class="annot"><span class="annottext">(Bind Var -&gt; CoreExpr -&gt; CoreExpr)
-&gt; Bind Var -&gt; CoreExpr -&gt; CoreExpr
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Var -&gt; CoreExpr -&gt; Bind Var
forall b. b -&gt; Expr b -&gt; Bind b
</span><a href="GHC.Core.html#NonRec"><span class="hs-identifier hs-var">NonRec</span></a></span><span> </span><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621683122641"><span class="hs-identifier hs-var">var'</span></a></span><span> </span><span class="annot"><span class="annottext">CoreExpr
</span><a href="#local-6989586621683122642"><span class="hs-identifier hs-var">viewExpr</span></a></span><span>
</span><span id="line-272"></span><span>
</span><span id="line-273"></span><span class="annot"><a href="GHC.HsToCore.Utils.html#mkEvalMatchResult"><span class="hs-identifier hs-type">mkEvalMatchResult</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Types.Var.html#Id"><span class="hs-identifier hs-type">Id</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#Type"><span class="hs-identifier hs-type">Type</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.HsToCore.Monad.html#MatchResult"><span class="hs-identifier hs-type">MatchResult</span></a></span><span> </span><span class="annot"><a href="GHC.Core.html#CoreExpr"><span class="hs-identifier hs-type">CoreExpr</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.HsToCore.Monad.html#MatchResult"><span class="hs-identifier hs-type">MatchResult</span></a></span><span> </span><span class="annot"><a href="GHC.Core.html#CoreExpr"><span class="hs-identifier hs-type">CoreExpr</span></a></span><span>
</span><span id="line-274"></span><span id="mkEvalMatchResult"><span class="annot"><span class="annottext">mkEvalMatchResult :: Var -&gt; Mult -&gt; MatchResult CoreExpr -&gt; MatchResult CoreExpr
</span><a href="GHC.HsToCore.Utils.html#mkEvalMatchResult"><span class="hs-identifier hs-var hs-var">mkEvalMatchResult</span></a></span></span><span> </span><span id="local-6989586621683122644"><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621683122644"><span class="hs-identifier hs-var">var</span></a></span></span><span> </span><span id="local-6989586621683122645"><span class="annot"><span class="annottext">Mult
</span><a href="#local-6989586621683122645"><span class="hs-identifier hs-var">ty</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(CoreExpr -&gt; CoreExpr)
-&gt; MatchResult CoreExpr -&gt; MatchResult CoreExpr
forall a b. (a -&gt; b) -&gt; MatchResult a -&gt; MatchResult b
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-identifier hs-var">fmap</span></span><span> </span><span class="annot"><span class="annottext">((CoreExpr -&gt; CoreExpr)
 -&gt; MatchResult CoreExpr -&gt; MatchResult CoreExpr)
-&gt; (CoreExpr -&gt; CoreExpr)
-&gt; MatchResult CoreExpr
-&gt; MatchResult CoreExpr
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-glyph">\</span><span id="local-6989586621683122646"><span class="annot"><span class="annottext">CoreExpr
</span><a href="#local-6989586621683122646"><span class="hs-identifier hs-var">e</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-275"></span><span>  </span><span class="annot"><span class="annottext">CoreExpr -&gt; Var -&gt; Mult -&gt; [Alt Var] -&gt; CoreExpr
forall b. Expr b -&gt; b -&gt; Mult -&gt; [Alt b] -&gt; Expr b
</span><a href="GHC.Core.html#Case"><span class="hs-identifier hs-var">Case</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Var -&gt; CoreExpr
forall b. Var -&gt; Expr b
</span><a href="GHC.Core.html#Var"><span class="hs-identifier hs-var">Var</span></a></span><span> </span><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621683122644"><span class="hs-identifier hs-var">var</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621683122644"><span class="hs-identifier hs-var">var</span></a></span><span> </span><span class="annot"><span class="annottext">Mult
</span><a href="#local-6989586621683122645"><span class="hs-identifier hs-var">ty</span></a></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">AltCon -&gt; [Var] -&gt; CoreExpr -&gt; Alt Var
forall b. AltCon -&gt; [b] -&gt; Expr b -&gt; Alt b
</span><a href="GHC.Core.html#Alt"><span class="hs-identifier hs-var">Alt</span></a></span><span> </span><span class="annot"><span class="annottext">AltCon
</span><a href="GHC.Core.html#DEFAULT"><span class="hs-identifier hs-var">DEFAULT</span></a></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><span class="annot"><span class="annottext">CoreExpr
</span><a href="#local-6989586621683122646"><span class="hs-identifier hs-var">e</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-276"></span><span>
</span><span id="line-277"></span><span class="annot"><a href="GHC.HsToCore.Utils.html#mkGuardedMatchResult"><span class="hs-identifier hs-type">mkGuardedMatchResult</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Core.html#CoreExpr"><span class="hs-identifier hs-type">CoreExpr</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.HsToCore.Monad.html#MatchResult"><span class="hs-identifier hs-type">MatchResult</span></a></span><span> </span><span class="annot"><a href="GHC.Core.html#CoreExpr"><span class="hs-identifier hs-type">CoreExpr</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.HsToCore.Monad.html#MatchResult"><span class="hs-identifier hs-type">MatchResult</span></a></span><span> </span><span class="annot"><a href="GHC.Core.html#CoreExpr"><span class="hs-identifier hs-type">CoreExpr</span></a></span><span>
</span><span id="line-278"></span><span id="mkGuardedMatchResult"><span class="annot"><span class="annottext">mkGuardedMatchResult :: CoreExpr -&gt; MatchResult CoreExpr -&gt; MatchResult CoreExpr
</span><a href="GHC.HsToCore.Utils.html#mkGuardedMatchResult"><span class="hs-identifier hs-var hs-var">mkGuardedMatchResult</span></a></span></span><span> </span><span id="local-6989586621683122650"><span class="annot"><span class="annottext">CoreExpr
</span><a href="#local-6989586621683122650"><span class="hs-identifier hs-var">pred_expr</span></a></span></span><span> </span><span id="local-6989586621683122651"><span class="annot"><span class="annottext">MatchResult CoreExpr
</span><a href="#local-6989586621683122651"><span class="hs-identifier hs-var">mr</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(CoreExpr -&gt; DsM CoreExpr) -&gt; MatchResult CoreExpr
forall a. (CoreExpr -&gt; DsM a) -&gt; MatchResult a
</span><a href="GHC.HsToCore.Monad.html#MR_Fallible"><span class="hs-identifier hs-var">MR_Fallible</span></a></span><span> </span><span class="annot"><span class="annottext">((CoreExpr -&gt; DsM CoreExpr) -&gt; MatchResult CoreExpr)
-&gt; (CoreExpr -&gt; DsM CoreExpr) -&gt; MatchResult CoreExpr
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-glyph">\</span><span id="local-6989586621683122652"><span class="annot"><span class="annottext">CoreExpr
</span><a href="#local-6989586621683122652"><span class="hs-identifier hs-var">fail</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-279"></span><span>  </span><span id="local-6989586621683122653"><span class="annot"><a href="#local-6989586621683122653"><span class="hs-identifier hs-var">body</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">CoreExpr -&gt; MatchResult CoreExpr -&gt; DsM CoreExpr
forall a. CoreExpr -&gt; MatchResult a -&gt; DsM a
</span><a href="GHC.HsToCore.Monad.html#runMatchResult"><span class="hs-identifier hs-var">runMatchResult</span></a></span><span> </span><span class="annot"><span class="annottext">CoreExpr
</span><a href="#local-6989586621683122652"><span class="hs-identifier hs-var">fail</span></a></span><span> </span><span class="annot"><span class="annottext">MatchResult CoreExpr
</span><a href="#local-6989586621683122651"><span class="hs-identifier hs-var">mr</span></a></span><span>
</span><span id="line-280"></span><span>  </span><span class="annot"><span class="hs-identifier hs-type">return</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Core.Make.html#mkIfThenElse"><span class="hs-identifier hs-type">mkIfThenElse</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683122650"><span class="hs-identifier hs-type">pred_expr</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683122653"><span class="hs-identifier hs-type">body</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683122652"><span class="hs-identifier hs-type">fail</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-281"></span><span>
</span><span id="line-282"></span><span class="annot"><a href="GHC.HsToCore.Utils.html#mkCoPrimCaseMatchResult"><span class="hs-identifier hs-type">mkCoPrimCaseMatchResult</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Types.Var.html#Id"><span class="hs-identifier hs-type">Id</span></a></span><span>                  </span><span class="hs-comment">-- Scrutinee</span><span>
</span><span id="line-283"></span><span>                        </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#Type"><span class="hs-identifier hs-type">Type</span></a></span><span>                      </span><span class="hs-comment">-- Type of the case</span><span>
</span><span id="line-284"></span><span>                        </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="hs-special">(</span><span class="annot"><a href="GHC.Types.Literal.html#Literal"><span class="hs-identifier hs-type">Literal</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.HsToCore.Monad.html#MatchResult"><span class="hs-identifier hs-type">MatchResult</span></a></span><span> </span><span class="annot"><a href="GHC.Core.html#CoreExpr"><span class="hs-identifier hs-type">CoreExpr</span></a></span><span class="hs-special">)</span><span class="hs-special">]</span><span>  </span><span class="hs-comment">-- Alternatives</span><span>
</span><span id="line-285"></span><span>                        </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.HsToCore.Monad.html#MatchResult"><span class="hs-identifier hs-type">MatchResult</span></a></span><span> </span><span class="annot"><a href="GHC.Core.html#CoreExpr"><span class="hs-identifier hs-type">CoreExpr</span></a></span><span>               </span><span class="hs-comment">-- Literals are all unlifted</span><span>
</span><span id="line-286"></span><span id="mkCoPrimCaseMatchResult"><span class="annot"><span class="annottext">mkCoPrimCaseMatchResult :: Var
-&gt; Mult
-&gt; [(Literal, MatchResult CoreExpr)]
-&gt; MatchResult CoreExpr
</span><a href="GHC.HsToCore.Utils.html#mkCoPrimCaseMatchResult"><span class="hs-identifier hs-var hs-var">mkCoPrimCaseMatchResult</span></a></span></span><span> </span><span id="local-6989586621683122655"><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621683122655"><span class="hs-identifier hs-var">var</span></a></span></span><span> </span><span id="local-6989586621683122656"><span class="annot"><span class="annottext">Mult
</span><a href="#local-6989586621683122656"><span class="hs-identifier hs-var">ty</span></a></span></span><span> </span><span id="local-6989586621683122657"><span class="annot"><span class="annottext">[(Literal, MatchResult CoreExpr)]
</span><a href="#local-6989586621683122657"><span class="hs-identifier hs-var">match_alts</span></a></span></span><span>
</span><span id="line-287"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(CoreExpr -&gt; DsM CoreExpr) -&gt; MatchResult CoreExpr
forall a. (CoreExpr -&gt; DsM a) -&gt; MatchResult a
</span><a href="GHC.HsToCore.Monad.html#MR_Fallible"><span class="hs-identifier hs-var">MR_Fallible</span></a></span><span> </span><span class="annot"><span class="annottext">CoreExpr -&gt; DsM CoreExpr
</span><a href="#local-6989586621683122658"><span class="hs-identifier hs-var">mk_case</span></a></span><span>
</span><span id="line-288"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-289"></span><span>    </span><span id="local-6989586621683122658"><span class="annot"><span class="annottext">mk_case :: CoreExpr -&gt; DsM CoreExpr
</span><a href="#local-6989586621683122658"><span class="hs-identifier hs-var hs-var">mk_case</span></a></span></span><span> </span><span id="local-6989586621683122659"><span class="annot"><span class="annottext">CoreExpr
</span><a href="#local-6989586621683122659"><span class="hs-identifier hs-var">fail</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-290"></span><span>        </span><span id="local-6989586621683122660"><span class="annot"><a href="#local-6989586621683122660"><span class="hs-identifier hs-var">alts</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">((Literal, MatchResult CoreExpr)
 -&gt; IOEnv (Env DsGblEnv DsLclEnv) (Alt Var))
-&gt; [(Literal, MatchResult CoreExpr)]
-&gt; IOEnv (Env DsGblEnv DsLclEnv) [Alt Var]
forall (t :: * -&gt; *) (m :: * -&gt; *) a b.
(Traversable t, Monad m) =&gt;
(a -&gt; m b) -&gt; t a -&gt; m (t b)
forall (m :: * -&gt; *) a b. Monad m =&gt; (a -&gt; m b) -&gt; [a] -&gt; m [b]
</span><span class="hs-identifier hs-var">mapM</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">CoreExpr
-&gt; (Literal, MatchResult CoreExpr)
-&gt; IOEnv (Env DsGblEnv DsLclEnv) (Alt Var)
forall {b}.
CoreExpr
-&gt; (Literal, MatchResult (Expr b))
-&gt; IOEnv (Env DsGblEnv DsLclEnv) (Alt b)
</span><a href="#local-6989586621683122661"><span class="hs-identifier hs-var">mk_alt</span></a></span><span> </span><span class="annot"><span class="annottext">CoreExpr
</span><a href="#local-6989586621683122659"><span class="hs-identifier hs-var">fail</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[(Literal, MatchResult CoreExpr)]
</span><a href="#local-6989586621683122662"><span class="hs-identifier hs-var">sorted_alts</span></a></span><span>
</span><span id="line-291"></span><span>        </span><span class="annot"><span class="hs-identifier hs-type">return</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Core.html#Case"><span class="hs-identifier hs-type">Case</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Core.html#Var"><span class="hs-identifier hs-type">Var</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683122655"><span class="hs-identifier hs-type">var</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><a href="#local-6989586621683122655"><span class="hs-identifier hs-type">var</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683122656"><span class="hs-identifier hs-type">ty</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Core.html#Alt"><span class="hs-identifier hs-type">Alt</span></a></span><span> </span><span class="annot"><a href="GHC.Core.html#DEFAULT"><span class="hs-identifier hs-type">DEFAULT</span></a></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><span class="annot"><a href="#local-6989586621683122659"><span class="hs-identifier hs-type">fail</span></a></span><span> </span><span class="annot"><span class="hs-glyph hs-type">:</span></span><span> </span><span class="annot"><a href="#local-6989586621683122660"><span class="hs-identifier hs-type">alts</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-292"></span><span>
</span><span id="line-293"></span><span>    </span><span id="local-6989586621683122662"><span class="annot"><span class="annottext">sorted_alts :: [(Literal, MatchResult CoreExpr)]
</span><a href="#local-6989586621683122662"><span class="hs-identifier hs-var hs-var">sorted_alts</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">((Literal, MatchResult CoreExpr) -&gt; Literal)
-&gt; [(Literal, MatchResult CoreExpr)]
-&gt; [(Literal, MatchResult CoreExpr)]
forall b a. Ord b =&gt; (a -&gt; b) -&gt; [a] -&gt; [a]
</span><span class="hs-identifier hs-var">sortWith</span></span><span> </span><span class="annot"><span class="annottext">(Literal, MatchResult CoreExpr) -&gt; Literal
forall a b. (a, b) -&gt; a
</span><span class="hs-identifier hs-var">fst</span></span><span> </span><span class="annot"><span class="annottext">[(Literal, MatchResult CoreExpr)]
</span><a href="#local-6989586621683122657"><span class="hs-identifier hs-var">match_alts</span></a></span><span>       </span><span class="hs-comment">-- Right order for a Case</span><span>
</span><span id="line-294"></span><span>    </span><span id="local-6989586621683122661"><span class="annot"><span class="annottext">mk_alt :: CoreExpr
-&gt; (Literal, MatchResult (Expr b))
-&gt; IOEnv (Env DsGblEnv DsLclEnv) (Alt b)
</span><a href="#local-6989586621683122661"><span class="hs-identifier hs-var hs-var">mk_alt</span></a></span></span><span> </span><span id="local-6989586621683122669"><span class="annot"><span class="annottext">CoreExpr
</span><a href="#local-6989586621683122669"><span class="hs-identifier hs-var">fail</span></a></span></span><span> </span><span class="hs-special">(</span><span id="local-6989586621683122670"><span class="annot"><span class="annottext">Literal
</span><a href="#local-6989586621683122670"><span class="hs-identifier hs-var">lit</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621683122671"><span class="annot"><span class="annottext">MatchResult (Expr b)
</span><a href="#local-6989586621683122671"><span class="hs-identifier hs-var">mr</span></a></span></span><span class="hs-special">)</span><span>
</span><span id="line-295"></span><span>       </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Bool
-&gt; IOEnv (Env DsGblEnv DsLclEnv) (Alt b)
-&gt; IOEnv (Env DsGblEnv DsLclEnv) (Alt b)
forall a. HasCallStack =&gt; Bool -&gt; a -&gt; a
</span><a href="GHC.Utils.Panic.Plain.html#assert"><span class="hs-identifier hs-var">assert</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Bool -&gt; Bool
</span><span class="hs-identifier hs-var">not</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Literal -&gt; Bool
</span><a href="GHC.Types.Literal.html#litIsLifted"><span class="hs-identifier hs-var">litIsLifted</span></a></span><span> </span><span class="annot"><span class="annottext">Literal
</span><a href="#local-6989586621683122670"><span class="hs-identifier hs-var">lit</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(IOEnv (Env DsGblEnv DsLclEnv) (Alt b)
 -&gt; IOEnv (Env DsGblEnv DsLclEnv) (Alt b))
-&gt; IOEnv (Env DsGblEnv DsLclEnv) (Alt b)
-&gt; IOEnv (Env DsGblEnv DsLclEnv) (Alt b)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-296"></span><span>         </span><span class="hs-keyword">do</span><span> </span><span id="local-6989586621683122674"><span class="annot"><a href="#local-6989586621683122674"><span class="hs-identifier hs-var">body</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">CoreExpr -&gt; MatchResult (Expr b) -&gt; DsM (Expr b)
forall a. CoreExpr -&gt; MatchResult a -&gt; DsM a
</span><a href="GHC.HsToCore.Monad.html#runMatchResult"><span class="hs-identifier hs-var">runMatchResult</span></a></span><span> </span><span class="annot"><span class="annottext">CoreExpr
</span><a href="#local-6989586621683122669"><span class="hs-identifier hs-var">fail</span></a></span><span> </span><span class="annot"><span class="annottext">MatchResult (Expr b)
</span><a href="#local-6989586621683122671"><span class="hs-identifier hs-var">mr</span></a></span><span>
</span><span id="line-297"></span><span>            </span><span class="annot"><span class="hs-identifier hs-type">return</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Core.html#Alt"><span class="hs-identifier hs-type">Alt</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Core.html#LitAlt"><span class="hs-identifier hs-type">LitAlt</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683122670"><span class="hs-identifier hs-type">lit</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><span class="annot"><a href="#local-6989586621683122674"><span class="hs-identifier hs-type">body</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-298"></span><span>
</span><span id="line-299"></span><span class="hs-keyword">data</span><span> </span><span id="CaseAlt"><span class="annot"><a href="GHC.HsToCore.Utils.html#CaseAlt"><span class="hs-identifier hs-var">CaseAlt</span></a></span></span><span> </span><span id="local-6989586621683122184"><span class="annot"><a href="#local-6989586621683122184"><span class="hs-identifier hs-type">a</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="MkCaseAlt"><span class="annot"><a href="GHC.HsToCore.Utils.html#MkCaseAlt"><span class="hs-identifier hs-var">MkCaseAlt</span></a></span></span><span class="hs-special">{</span><span> </span><span id="alt_pat"><span class="annot"><span class="annottext">forall a. CaseAlt a -&gt; a
</span><a href="GHC.HsToCore.Utils.html#alt_pat"><span class="hs-identifier hs-var hs-var">alt_pat</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="#local-6989586621683122184"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-300"></span><span>                            </span><span id="alt_bndrs"><span class="annot"><span class="annottext">forall a. CaseAlt a -&gt; [Var]
</span><a href="GHC.HsToCore.Utils.html#alt_bndrs"><span class="hs-identifier hs-var hs-var">alt_bndrs</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="GHC.Types.Var.html#Var"><span class="hs-identifier hs-type">Var</span></a></span><span class="hs-special">]</span><span class="hs-special">,</span><span>
</span><span id="line-301"></span><span>                            </span><span id="alt_wrapper"><span class="annot"><span class="annottext">forall a. CaseAlt a -&gt; HsWrapper
</span><a href="GHC.HsToCore.Utils.html#alt_wrapper"><span class="hs-identifier hs-var hs-var">alt_wrapper</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Tc.Types.Evidence.html#HsWrapper"><span class="hs-identifier hs-type">HsWrapper</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-302"></span><span>                            </span><span id="alt_result"><span class="annot"><span class="annottext">forall a. CaseAlt a -&gt; MatchResult CoreExpr
</span><a href="GHC.HsToCore.Utils.html#alt_result"><span class="hs-identifier hs-var hs-var">alt_result</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.HsToCore.Monad.html#MatchResult"><span class="hs-identifier hs-type">MatchResult</span></a></span><span> </span><span class="annot"><a href="GHC.Core.html#CoreExpr"><span class="hs-identifier hs-type">CoreExpr</span></a></span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-303"></span><span>
</span><span id="line-304"></span><span class="annot"><a href="GHC.HsToCore.Utils.html#mkCoAlgCaseMatchResult"><span class="hs-identifier hs-type">mkCoAlgCaseMatchResult</span></a></span><span>
</span><span id="line-305"></span><span>  </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Types.Var.html#Id"><span class="hs-identifier hs-type">Id</span></a></span><span> </span><span class="annot"><span class="hs-comment">-- ^ Scrutinee</span></span><span>
</span><span id="line-306"></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#Type"><span class="hs-identifier hs-type">Type</span></a></span><span> </span><span class="annot"><span class="hs-comment">-- ^ Type of exp</span></span><span>
</span><span id="line-307"></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">NonEmpty</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.HsToCore.Utils.html#CaseAlt"><span class="hs-identifier hs-type">CaseAlt</span></a></span><span> </span><span class="annot"><a href="GHC.Core.DataCon.html#DataCon"><span class="hs-identifier hs-type">DataCon</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="hs-comment">-- ^ Alternatives (bndrs *include* tyvars, dicts)</span></span><span>
</span><span id="line-308"></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.HsToCore.Monad.html#MatchResult"><span class="hs-identifier hs-type">MatchResult</span></a></span><span> </span><span class="annot"><a href="GHC.Core.html#CoreExpr"><span class="hs-identifier hs-type">CoreExpr</span></a></span><span>
</span><span id="line-309"></span><span id="mkCoAlgCaseMatchResult"><span class="annot"><span class="annottext">mkCoAlgCaseMatchResult :: Var -&gt; Mult -&gt; NonEmpty (CaseAlt DataCon) -&gt; MatchResult CoreExpr
</span><a href="GHC.HsToCore.Utils.html#mkCoAlgCaseMatchResult"><span class="hs-identifier hs-var hs-var">mkCoAlgCaseMatchResult</span></a></span></span><span> </span><span id="local-6989586621683122681"><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621683122681"><span class="hs-identifier hs-var">var</span></a></span></span><span> </span><span id="local-6989586621683122682"><span class="annot"><span class="annottext">Mult
</span><a href="#local-6989586621683122682"><span class="hs-identifier hs-var">ty</span></a></span></span><span> </span><span id="local-6989586621683122683"><span class="annot"><span class="annottext">NonEmpty (CaseAlt DataCon)
</span><a href="#local-6989586621683122683"><span class="hs-identifier hs-var">match_alts</span></a></span></span><span>
</span><span id="line-310"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621683122684"><span class="hs-identifier hs-var">isNewtype</span></a></span><span>  </span><span class="hs-comment">-- Newtype case; use a let</span><span>
</span><span id="line-311"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Bool -&gt; MatchResult CoreExpr -&gt; MatchResult CoreExpr
forall a. HasCallStack =&gt; Bool -&gt; a -&gt; a
</span><a href="GHC.Utils.Panic.Plain.html#assert"><span class="hs-identifier hs-var">assert</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[CaseAlt DataCon] -&gt; Bool
forall a. [a] -&gt; Bool
forall (t :: * -&gt; *) a. Foldable t =&gt; t a -&gt; Bool
</span><span class="hs-identifier hs-var">null</span></span><span> </span><span class="annot"><span class="annottext">[CaseAlt DataCon]
</span><a href="#local-6989586621683122686"><span class="hs-identifier hs-var">match_alts_tail</span></a></span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Bool -&gt; Bool
</span><span class="hs-operator hs-var">&amp;&amp;</span></span><span> </span><span class="annot"><span class="annottext">[Var] -&gt; Bool
forall a. [a] -&gt; Bool
forall (t :: * -&gt; *) a. Foldable t =&gt; t a -&gt; Bool
</span><span class="hs-identifier hs-var">null</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[Var] -&gt; [Var]
forall a. HasCallStack =&gt; [a] -&gt; [a]
</span><a href="GHC.Prelude.Basic.html#tail"><span class="hs-identifier hs-var">tail</span></a></span><span> </span><span class="annot"><span class="annottext">[Var]
</span><a href="#local-6989586621683122689"><span class="hs-identifier hs-var">arg_ids1</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(MatchResult CoreExpr -&gt; MatchResult CoreExpr)
-&gt; MatchResult CoreExpr -&gt; MatchResult CoreExpr
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-312"></span><span>    </span><span class="annot"><span class="annottext">Bind Var -&gt; MatchResult CoreExpr -&gt; MatchResult CoreExpr
</span><a href="GHC.HsToCore.Utils.html#mkCoLetMatchResult"><span class="hs-identifier hs-var">mkCoLetMatchResult</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Var -&gt; CoreExpr -&gt; Bind Var
forall b. b -&gt; Expr b -&gt; Bind b
</span><a href="GHC.Core.html#NonRec"><span class="hs-identifier hs-var">NonRec</span></a></span><span> </span><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621683122690"><span class="hs-identifier hs-var">arg_id1</span></a></span><span> </span><span class="annot"><span class="annottext">CoreExpr
</span><a href="#local-6989586621683122691"><span class="hs-identifier hs-var">newtype_rhs</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">MatchResult CoreExpr
</span><a href="#local-6989586621683122692"><span class="hs-identifier hs-var">match_result1</span></a></span><span>
</span><span id="line-313"></span><span>
</span><span id="line-314"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">otherwise</span></span><span>
</span><span id="line-315"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Var -&gt; Mult -&gt; NonEmpty (CaseAlt DataCon) -&gt; MatchResult CoreExpr
</span><a href="GHC.HsToCore.Utils.html#mkDataConCase"><span class="hs-identifier hs-var">mkDataConCase</span></a></span><span> </span><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621683122681"><span class="hs-identifier hs-var">var</span></a></span><span> </span><span class="annot"><span class="annottext">Mult
</span><a href="#local-6989586621683122682"><span class="hs-identifier hs-var">ty</span></a></span><span> </span><span class="annot"><span class="annottext">NonEmpty (CaseAlt DataCon)
</span><a href="#local-6989586621683122683"><span class="hs-identifier hs-var">match_alts</span></a></span><span>
</span><span id="line-316"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-317"></span><span>    </span><span id="local-6989586621683122684"><span class="annot"><span class="annottext">isNewtype :: Bool
</span><a href="#local-6989586621683122684"><span class="hs-identifier hs-var hs-var">isNewtype</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">TyCon -&gt; Bool
</span><a href="GHC.Core.TyCon.html#isNewTyCon"><span class="hs-identifier hs-var">isNewTyCon</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">DataCon -&gt; TyCon
</span><a href="GHC.Core.DataCon.html#dataConTyCon"><span class="hs-identifier hs-var">dataConTyCon</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">CaseAlt DataCon -&gt; DataCon
forall a. CaseAlt a -&gt; a
</span><a href="GHC.HsToCore.Utils.html#alt_pat"><span class="hs-identifier hs-var">alt_pat</span></a></span><span> </span><span class="annot"><span class="annottext">CaseAlt DataCon
</span><a href="#local-6989586621683122696"><span class="hs-identifier hs-var">alt1</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-318"></span><span>
</span><span id="line-319"></span><span>        </span><span class="hs-comment">-- [Interesting: because of GADTs, we can't rely on the type of</span><span>
</span><span id="line-320"></span><span>        </span><span class="hs-comment">--  the scrutinised Id to be sufficiently refined to have a TyCon in it]</span><span>
</span><span id="line-321"></span><span>
</span><span id="line-322"></span><span>    </span><span id="local-6989586621683122696"><span class="annot"><span class="annottext">alt1 :: CaseAlt DataCon
</span><a href="#local-6989586621683122696"><span class="hs-identifier hs-var">alt1</span></a></span></span><span class="hs-glyph">@</span><span class="annot"><a href="GHC.HsToCore.Utils.html#MkCaseAlt"><span class="hs-identifier hs-type">MkCaseAlt</span></a></span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">alt_bndrs :: forall a. CaseAlt a -&gt; [Var]
</span><a href="GHC.HsToCore.Utils.html#alt_bndrs"><span class="hs-identifier hs-var">alt_bndrs</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="local-6989586621683122689"><span class="annot"><span class="annottext">[Var]
</span><a href="#local-6989586621683122689"><span class="hs-identifier hs-var">arg_ids1</span></a></span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">alt_result :: forall a. CaseAlt a -&gt; MatchResult CoreExpr
</span><a href="GHC.HsToCore.Utils.html#alt_result"><span class="hs-identifier hs-var">alt_result</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="local-6989586621683122692"><span class="annot"><span class="annottext">MatchResult CoreExpr
</span><a href="#local-6989586621683122692"><span class="hs-identifier hs-var">match_result1</span></a></span></span><span> </span><span class="hs-special">}</span><span> </span><span class="annot"><span class="hs-operator hs-type">:|</span></span><span> </span><span id="local-6989586621683122686"><span class="annot"><span class="annottext">[CaseAlt DataCon]
</span><a href="#local-6989586621683122686"><span class="hs-identifier hs-var">match_alts_tail</span></a></span></span><span>
</span><span id="line-323"></span><span>      </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">NonEmpty (CaseAlt DataCon)
</span><a href="#local-6989586621683122683"><span class="hs-identifier hs-var">match_alts</span></a></span><span>
</span><span id="line-324"></span><span>    </span><span class="hs-comment">-- Stuff for newtype</span><span>
</span><span id="line-325"></span><span>    </span><span id="local-6989586621683122690"><span class="annot"><span class="annottext">arg_id1 :: Var
</span><a href="#local-6989586621683122690"><span class="hs-identifier hs-var hs-var">arg_id1</span></a></span></span><span>       </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Var -&gt; Var
forall a. HasCallStack =&gt; Bool -&gt; a -&gt; a
</span><a href="GHC.Utils.Panic.Plain.html#assert"><span class="hs-identifier hs-var">assert</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[Var] -&gt; Bool
forall (f :: * -&gt; *) a. Foldable f =&gt; f a -&gt; Bool
</span><a href="GHC.Utils.Misc.html#notNull"><span class="hs-identifier hs-var">notNull</span></a></span><span> </span><span class="annot"><span class="annottext">[Var]
</span><a href="#local-6989586621683122689"><span class="hs-identifier hs-var">arg_ids1</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(Var -&gt; Var) -&gt; Var -&gt; Var
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">[Var] -&gt; Var
forall a. HasCallStack =&gt; [a] -&gt; a
</span><a href="GHC.Prelude.Basic.html#head"><span class="hs-identifier hs-var">head</span></a></span><span> </span><span class="annot"><span class="annottext">[Var]
</span><a href="#local-6989586621683122689"><span class="hs-identifier hs-var">arg_ids1</span></a></span><span>
</span><span id="line-326"></span><span>    </span><span id="local-6989586621683122700"><span class="annot"><span class="annottext">var_ty :: Mult
</span><a href="#local-6989586621683122700"><span class="hs-identifier hs-var hs-var">var_ty</span></a></span></span><span>        </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Var -&gt; Mult
</span><a href="GHC.Types.Id.html#idType"><span class="hs-identifier hs-var">idType</span></a></span><span> </span><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621683122681"><span class="hs-identifier hs-var">var</span></a></span><span>
</span><span id="line-327"></span><span>    </span><span class="hs-special">(</span><span id="local-6989586621683122702"><span class="annot"><span class="annottext">TyCon
</span><a href="#local-6989586621683122702"><span class="hs-identifier hs-var">tc</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621683122703"><span class="annot"><span class="annottext">[Mult]
</span><a href="#local-6989586621683122703"><span class="hs-identifier hs-var">ty_args</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Mult -&gt; (TyCon, [Mult])
</span><a href="GHC.Core.Type.html#tcSplitTyConApp"><span class="hs-identifier hs-var">tcSplitTyConApp</span></a></span><span> </span><span class="annot"><span class="annottext">Mult
</span><a href="#local-6989586621683122700"><span class="hs-identifier hs-var">var_ty</span></a></span><span>      </span><span class="hs-comment">-- Don't look through newtypes</span><span>
</span><span id="line-328"></span><span>                                                </span><span class="hs-comment">-- (not that splitTyConApp does, these days)</span><span>
</span><span id="line-329"></span><span>    </span><span id="local-6989586621683122691"><span class="annot"><span class="annottext">newtype_rhs :: CoreExpr
</span><a href="#local-6989586621683122691"><span class="hs-identifier hs-var hs-var">newtype_rhs</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">TyCon -&gt; [Mult] -&gt; CoreExpr -&gt; CoreExpr
</span><a href="GHC.Types.Id.Make.html#unwrapNewTypeBody"><span class="hs-identifier hs-var">unwrapNewTypeBody</span></a></span><span> </span><span class="annot"><span class="annottext">TyCon
</span><a href="#local-6989586621683122702"><span class="hs-identifier hs-var">tc</span></a></span><span> </span><span class="annot"><span class="annottext">[Mult]
</span><a href="#local-6989586621683122703"><span class="hs-identifier hs-var">ty_args</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Var -&gt; CoreExpr
forall b. Var -&gt; Expr b
</span><a href="GHC.Core.html#Var"><span class="hs-identifier hs-var">Var</span></a></span><span> </span><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621683122681"><span class="hs-identifier hs-var">var</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-330"></span><span>
</span><span id="line-331"></span><span class="annot"><a href="GHC.HsToCore.Utils.html#mkCoSynCaseMatchResult"><span class="hs-identifier hs-type">mkCoSynCaseMatchResult</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Types.Var.html#Id"><span class="hs-identifier hs-type">Id</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#Type"><span class="hs-identifier hs-type">Type</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.HsToCore.Utils.html#CaseAlt"><span class="hs-identifier hs-type">CaseAlt</span></a></span><span> </span><span class="annot"><a href="GHC.Core.PatSyn.html#PatSyn"><span class="hs-identifier hs-type">PatSyn</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.HsToCore.Monad.html#MatchResult"><span class="hs-identifier hs-type">MatchResult</span></a></span><span> </span><span class="annot"><a href="GHC.Core.html#CoreExpr"><span class="hs-identifier hs-type">CoreExpr</span></a></span><span>
</span><span id="line-332"></span><span id="mkCoSynCaseMatchResult"><span class="annot"><span class="annottext">mkCoSynCaseMatchResult :: Var -&gt; Mult -&gt; CaseAlt PatSyn -&gt; MatchResult CoreExpr
</span><a href="GHC.HsToCore.Utils.html#mkCoSynCaseMatchResult"><span class="hs-identifier hs-var hs-var">mkCoSynCaseMatchResult</span></a></span></span><span> </span><span id="local-6989586621683122706"><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621683122706"><span class="hs-identifier hs-var">var</span></a></span></span><span> </span><span id="local-6989586621683122707"><span class="annot"><span class="annottext">Mult
</span><a href="#local-6989586621683122707"><span class="hs-identifier hs-var">ty</span></a></span></span><span> </span><span id="local-6989586621683122708"><span class="annot"><span class="annottext">CaseAlt PatSyn
</span><a href="#local-6989586621683122708"><span class="hs-identifier hs-var">alt</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(CoreExpr -&gt; DsM CoreExpr) -&gt; MatchResult CoreExpr
forall a. (CoreExpr -&gt; DsM a) -&gt; MatchResult a
</span><a href="GHC.HsToCore.Monad.html#MR_Fallible"><span class="hs-identifier hs-var">MR_Fallible</span></a></span><span> </span><span class="annot"><span class="annottext">((CoreExpr -&gt; DsM CoreExpr) -&gt; MatchResult CoreExpr)
-&gt; (CoreExpr -&gt; DsM CoreExpr) -&gt; MatchResult CoreExpr
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Var -&gt; Mult -&gt; CaseAlt PatSyn -&gt; CoreExpr -&gt; DsM CoreExpr
</span><a href="GHC.HsToCore.Utils.html#mkPatSynCase"><span class="hs-identifier hs-var">mkPatSynCase</span></a></span><span> </span><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621683122706"><span class="hs-identifier hs-var">var</span></a></span><span> </span><span class="annot"><span class="annottext">Mult
</span><a href="#local-6989586621683122707"><span class="hs-identifier hs-var">ty</span></a></span><span> </span><span class="annot"><span class="annottext">CaseAlt PatSyn
</span><a href="#local-6989586621683122708"><span class="hs-identifier hs-var">alt</span></a></span><span>
</span><span id="line-333"></span><span>
</span><span id="line-334"></span><span class="annot"><a href="GHC.HsToCore.Utils.html#mkPatSynCase"><span class="hs-identifier hs-type">mkPatSynCase</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Types.Var.html#Id"><span class="hs-identifier hs-type">Id</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#Type"><span class="hs-identifier hs-type">Type</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.HsToCore.Utils.html#CaseAlt"><span class="hs-identifier hs-type">CaseAlt</span></a></span><span> </span><span class="annot"><a href="GHC.Core.PatSyn.html#PatSyn"><span class="hs-identifier hs-type">PatSyn</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Core.html#CoreExpr"><span class="hs-identifier hs-type">CoreExpr</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.HsToCore.Types.html#DsM"><span class="hs-identifier hs-type">DsM</span></a></span><span> </span><span class="annot"><a href="GHC.Core.html#CoreExpr"><span class="hs-identifier hs-type">CoreExpr</span></a></span><span>
</span><span id="line-335"></span><span id="mkPatSynCase"><span class="annot"><span class="annottext">mkPatSynCase :: Var -&gt; Mult -&gt; CaseAlt PatSyn -&gt; CoreExpr -&gt; DsM CoreExpr
</span><a href="GHC.HsToCore.Utils.html#mkPatSynCase"><span class="hs-identifier hs-var hs-var">mkPatSynCase</span></a></span></span><span> </span><span id="local-6989586621683122710"><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621683122710"><span class="hs-identifier hs-var">var</span></a></span></span><span> </span><span id="local-6989586621683122711"><span class="annot"><span class="annottext">Mult
</span><a href="#local-6989586621683122711"><span class="hs-identifier hs-var">ty</span></a></span></span><span> </span><span id="local-6989586621683122712"><span class="annot"><span class="annottext">CaseAlt PatSyn
</span><a href="#local-6989586621683122712"><span class="hs-identifier hs-var">alt</span></a></span></span><span> </span><span id="local-6989586621683122713"><span class="annot"><span class="annottext">CoreExpr
</span><a href="#local-6989586621683122713"><span class="hs-identifier hs-var">fail</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-336"></span><span>    </span><span id="local-6989586621683122714"><span class="annot"><a href="#local-6989586621683122714"><span class="hs-identifier hs-var">matcher_id</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Name -&gt; DsM Var
</span><a href="GHC.HsToCore.Monad.html#dsLookupGlobalId"><span class="hs-identifier hs-var">dsLookupGlobalId</span></a></span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621683122716"><span class="hs-identifier hs-var">matcher_name</span></a></span><span>
</span><span id="line-337"></span><span>    </span><span id="local-6989586621683122717"><span class="annot"><a href="#local-6989586621683122717"><span class="hs-identifier hs-var">matcher</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><a href="GHC.HsToCore.Expr.html#dsLExpr"><span class="hs-identifier hs-type">dsLExpr</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="annot"><a href="GHC.Hs.Utils.html#mkLHsWrap"><span class="hs-identifier hs-type">mkLHsWrap</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683122719"><span class="hs-identifier hs-type">wrapper</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span>
</span><span id="line-338"></span><span>                         </span><span class="annot"><a href="GHC.Hs.Utils.html#nlHsTyApp"><span class="hs-identifier hs-type">nlHsTyApp</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683122714"><span class="hs-identifier hs-type">matcher_id</span></a></span><span> </span><span class="hs-special">[</span><span class="annot"><a href="GHC.Core.Type.html#getRuntimeRep"><span class="hs-identifier hs-type">getRuntimeRep</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683122711"><span class="hs-identifier hs-type">ty</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="#local-6989586621683122711"><span class="hs-identifier hs-type">ty</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-339"></span><span>    </span><span id="local-6989586621683122722"><span class="annot"><a href="#local-6989586621683122722"><span class="hs-identifier hs-var">cont</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><a href="GHC.Core.Make.html#mkCoreLams"><span class="hs-identifier hs-type">mkCoreLams</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683122724"><span class="hs-identifier hs-type">bndrs</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">&lt;$&gt;</span></span><span> </span><span class="annot"><a href="GHC.HsToCore.Monad.html#runMatchResult"><span class="hs-identifier hs-type">runMatchResult</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683122713"><span class="hs-identifier hs-type">fail</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683122726"><span class="hs-identifier hs-type">match_result</span></a></span><span>
</span><span id="line-340"></span><span>    </span><span class="annot"><span class="hs-identifier hs-type">return</span></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="annot"><a href="GHC.HsToCore.Utils.html#mkCoreAppsDs"><span class="hs-identifier hs-type">mkCoreAppsDs</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Utils.Outputable.html#text"><span class="hs-identifier hs-type">text</span></a></span><span> </span><span class="annot"><span class="hs-string">&quot;patsyn&quot;</span></span><span> </span><span class="annot"><a href="GHC.Utils.Outputable.html#%3C%2B%3E"><span class="hs-operator hs-type">&lt;+&gt;</span></a></span><span> </span><span class="annot"><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-type">ppr</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683122710"><span class="hs-identifier hs-type">var</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><a href="#local-6989586621683122717"><span class="hs-identifier hs-type">matcher</span></a></span><span> </span><span class="hs-special">[</span><span class="annot"><a href="GHC.Core.html#Var"><span class="hs-identifier hs-type">Var</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683122710"><span class="hs-identifier hs-type">var</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="#local-6989586621683122730"><span class="hs-identifier hs-type">ensure_unstrict</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683122722"><span class="hs-identifier hs-type">cont</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Core.html#Lam"><span class="hs-identifier hs-type">Lam</span></a></span><span> </span><span class="annot"><a href="GHC.Types.Id.Make.html#voidArgId"><span class="hs-identifier hs-type">voidArgId</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683122713"><span class="hs-identifier hs-type">fail</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-341"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-342"></span><span>    </span><span class="annot"><a href="GHC.HsToCore.Utils.html#MkCaseAlt"><span class="hs-identifier hs-type">MkCaseAlt</span></a></span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">alt_pat :: forall a. CaseAlt a -&gt; a
</span><a href="GHC.HsToCore.Utils.html#alt_pat"><span class="hs-identifier hs-var">alt_pat</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="local-6989586621683122733"><span class="annot"><span class="annottext">PatSyn
</span><a href="#local-6989586621683122733"><span class="hs-identifier hs-var">psyn</span></a></span></span><span class="hs-special">,</span><span>
</span><span id="line-343"></span><span>               </span><span class="annot"><span class="annottext">alt_bndrs :: forall a. CaseAlt a -&gt; [Var]
</span><a href="GHC.HsToCore.Utils.html#alt_bndrs"><span class="hs-identifier hs-var">alt_bndrs</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="local-6989586621683122724"><span class="annot"><span class="annottext">[Var]
</span><a href="#local-6989586621683122724"><span class="hs-identifier hs-var">bndrs</span></a></span></span><span class="hs-special">,</span><span>
</span><span id="line-344"></span><span>               </span><span class="annot"><span class="annottext">alt_wrapper :: forall a. CaseAlt a -&gt; HsWrapper
</span><a href="GHC.HsToCore.Utils.html#alt_wrapper"><span class="hs-identifier hs-var">alt_wrapper</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="local-6989586621683122719"><span class="annot"><span class="annottext">HsWrapper
</span><a href="#local-6989586621683122719"><span class="hs-identifier hs-var">wrapper</span></a></span></span><span class="hs-special">,</span><span>
</span><span id="line-345"></span><span>               </span><span class="annot"><span class="annottext">alt_result :: forall a. CaseAlt a -&gt; MatchResult CoreExpr
</span><a href="GHC.HsToCore.Utils.html#alt_result"><span class="hs-identifier hs-var">alt_result</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="local-6989586621683122726"><span class="annot"><span class="annottext">MatchResult CoreExpr
</span><a href="#local-6989586621683122726"><span class="hs-identifier hs-var">match_result</span></a></span></span><span class="hs-special">}</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">CaseAlt PatSyn
</span><a href="#local-6989586621683122712"><span class="hs-identifier hs-var">alt</span></a></span><span>
</span><span id="line-346"></span><span>    </span><span class="hs-special">(</span><span id="local-6989586621683122716"><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621683122716"><span class="hs-identifier hs-var">matcher_name</span></a></span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Mult
</span><span class="hs-identifier">_</span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621683122734"><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621683122734"><span class="hs-identifier hs-var">needs_void_lam</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">PatSyn -&gt; (Name, Mult, Bool)
</span><a href="GHC.Core.PatSyn.html#patSynMatcher"><span class="hs-identifier hs-var">patSynMatcher</span></a></span><span> </span><span class="annot"><span class="annottext">PatSyn
</span><a href="#local-6989586621683122733"><span class="hs-identifier hs-var">psyn</span></a></span><span>
</span><span id="line-347"></span><span>
</span><span id="line-348"></span><span>    </span><span class="hs-comment">-- See Note [Matchers and builders for pattern synonyms] in GHC.Core.PatSyn</span><span>
</span><span id="line-349"></span><span>    </span><span class="hs-comment">-- on these extra Void# arguments</span><span>
</span><span id="line-350"></span><span>    </span><span id="local-6989586621683122730"><span class="annot"><span class="annottext">ensure_unstrict :: CoreExpr -&gt; CoreExpr
</span><a href="#local-6989586621683122730"><span class="hs-identifier hs-var hs-var">ensure_unstrict</span></a></span></span><span> </span><span id="local-6989586621683122736"><span class="annot"><span class="annottext">CoreExpr
</span><a href="#local-6989586621683122736"><span class="hs-identifier hs-var">cont</span></a></span></span><span> </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621683122734"><span class="hs-identifier hs-var">needs_void_lam</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Var -&gt; CoreExpr -&gt; CoreExpr
forall b. b -&gt; Expr b -&gt; Expr b
</span><a href="GHC.Core.html#Lam"><span class="hs-identifier hs-var">Lam</span></a></span><span> </span><span class="annot"><span class="annottext">Var
</span><a href="GHC.Types.Id.Make.html#voidArgId"><span class="hs-identifier hs-var">voidArgId</span></a></span><span> </span><span class="annot"><span class="annottext">CoreExpr
</span><a href="#local-6989586621683122736"><span class="hs-identifier hs-var">cont</span></a></span><span>
</span><span id="line-351"></span><span>                         </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">otherwise</span></span><span>      </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">CoreExpr
</span><a href="#local-6989586621683122736"><span class="hs-identifier hs-var">cont</span></a></span><span>
</span><span id="line-352"></span><span>
</span><span id="line-353"></span><span class="annot"><a href="GHC.HsToCore.Utils.html#mkDataConCase"><span class="hs-identifier hs-type">mkDataConCase</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Types.Var.html#Id"><span class="hs-identifier hs-type">Id</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#Type"><span class="hs-identifier hs-type">Type</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">NonEmpty</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.HsToCore.Utils.html#CaseAlt"><span class="hs-identifier hs-type">CaseAlt</span></a></span><span> </span><span class="annot"><a href="GHC.Core.DataCon.html#DataCon"><span class="hs-identifier hs-type">DataCon</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.HsToCore.Monad.html#MatchResult"><span class="hs-identifier hs-type">MatchResult</span></a></span><span> </span><span class="annot"><a href="GHC.Core.html#CoreExpr"><span class="hs-identifier hs-type">CoreExpr</span></a></span><span>
</span><span id="line-354"></span><span id="mkDataConCase"><span class="annot"><span class="annottext">mkDataConCase :: Var -&gt; Mult -&gt; NonEmpty (CaseAlt DataCon) -&gt; MatchResult CoreExpr
</span><a href="GHC.HsToCore.Utils.html#mkDataConCase"><span class="hs-identifier hs-var hs-var">mkDataConCase</span></a></span></span><span> </span><span id="local-6989586621683122737"><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621683122737"><span class="hs-identifier hs-var">var</span></a></span></span><span> </span><span id="local-6989586621683122738"><span class="annot"><span class="annottext">Mult
</span><a href="#local-6989586621683122738"><span class="hs-identifier hs-var">ty</span></a></span></span><span> </span><span id="local-6989586621683122739"><span class="annot"><span class="annottext">alts :: NonEmpty (CaseAlt DataCon)
</span><a href="#local-6989586621683122739"><span class="hs-identifier hs-var">alts</span></a></span></span><span class="hs-glyph">@</span><span class="hs-special">(</span><span id="local-6989586621683122740"><span class="annot"><span class="annottext">CaseAlt DataCon
</span><a href="#local-6989586621683122740"><span class="hs-identifier hs-var">alt1</span></a></span></span><span> </span><span class="annot"><span class="hs-operator hs-type">:|</span></span><span> </span><span class="annot"><span class="annottext">[CaseAlt DataCon]
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span>
</span><span id="line-355"></span><span>    </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(Maybe (Alt Var) -&gt; [Alt Var] -&gt; CoreExpr)
-&gt; MatchResult (Maybe (Alt Var))
-&gt; MatchResult [Alt Var]
-&gt; MatchResult CoreExpr
forall a b c.
(a -&gt; b -&gt; c) -&gt; MatchResult a -&gt; MatchResult b -&gt; MatchResult c
forall (f :: * -&gt; *) a b c.
Applicative f =&gt;
(a -&gt; b -&gt; c) -&gt; f a -&gt; f b -&gt; f c
</span><span class="hs-identifier hs-var">liftA2</span></span><span> </span><span class="annot"><span class="annottext">Maybe (Alt Var) -&gt; [Alt Var] -&gt; CoreExpr
</span><a href="#local-6989586621683122742"><span class="hs-identifier hs-var">mk_case</span></a></span><span> </span><span class="annot"><span class="annottext">MatchResult (Maybe (Alt Var))
</span><a href="#local-6989586621683122743"><span class="hs-identifier hs-var">mk_default</span></a></span><span> </span><span class="annot"><span class="annottext">MatchResult [Alt Var]
</span><a href="#local-6989586621683122744"><span class="hs-identifier hs-var">mk_alts</span></a></span><span>
</span><span id="line-356"></span><span>    </span><span class="hs-comment">-- The liftA2 combines the failability of all the alternatives and the default</span><span>
</span><span id="line-357"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-358"></span><span>    </span><span id="local-6989586621683122745"><span class="annot"><span class="annottext">con1 :: DataCon
</span><a href="#local-6989586621683122745"><span class="hs-identifier hs-var hs-var">con1</span></a></span></span><span>          </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">CaseAlt DataCon -&gt; DataCon
forall a. CaseAlt a -&gt; a
</span><a href="GHC.HsToCore.Utils.html#alt_pat"><span class="hs-identifier hs-var">alt_pat</span></a></span><span> </span><span class="annot"><span class="annottext">CaseAlt DataCon
</span><a href="#local-6989586621683122740"><span class="hs-identifier hs-var">alt1</span></a></span><span>
</span><span id="line-359"></span><span>    </span><span id="local-6989586621683122746"><span class="annot"><span class="annottext">tycon :: TyCon
</span><a href="#local-6989586621683122746"><span class="hs-identifier hs-var hs-var">tycon</span></a></span></span><span>         </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">DataCon -&gt; TyCon
</span><a href="GHC.Core.DataCon.html#dataConTyCon"><span class="hs-identifier hs-var">dataConTyCon</span></a></span><span> </span><span class="annot"><span class="annottext">DataCon
</span><a href="#local-6989586621683122745"><span class="hs-identifier hs-var">con1</span></a></span><span>
</span><span id="line-360"></span><span>    </span><span id="local-6989586621683122747"><span class="annot"><span class="annottext">data_cons :: [DataCon]
</span><a href="#local-6989586621683122747"><span class="hs-identifier hs-var hs-var">data_cons</span></a></span></span><span>     </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">TyCon -&gt; [DataCon]
</span><a href="GHC.Core.TyCon.html#tyConDataCons"><span class="hs-identifier hs-var">tyConDataCons</span></a></span><span> </span><span class="annot"><span class="annottext">TyCon
</span><a href="#local-6989586621683122746"><span class="hs-identifier hs-var">tycon</span></a></span><span>
</span><span id="line-361"></span><span>
</span><span id="line-362"></span><span>    </span><span class="annot"><a href="#local-6989586621683122749"><span class="hs-identifier hs-type">sorted_alts</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><span> </span><span class="annot"><a href="GHC.HsToCore.Utils.html#CaseAlt"><span class="hs-identifier hs-type">CaseAlt</span></a></span><span> </span><span class="annot"><a href="GHC.Core.DataCon.html#DataCon"><span class="hs-identifier hs-type">DataCon</span></a></span><span> </span><span class="hs-special">]</span><span>
</span><span id="line-363"></span><span>    </span><span id="local-6989586621683122749"><span class="annot"><span class="annottext">sorted_alts :: [CaseAlt DataCon]
</span><a href="#local-6989586621683122749"><span class="hs-identifier hs-var hs-var">sorted_alts</span></a></span></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(CaseAlt DataCon -&gt; ConTag)
-&gt; [CaseAlt DataCon] -&gt; [CaseAlt DataCon]
forall b a. Ord b =&gt; (a -&gt; b) -&gt; [a] -&gt; [a]
</span><span class="hs-identifier hs-var">sortWith</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">DataCon -&gt; ConTag
</span><a href="GHC.Core.DataCon.html#dataConTag"><span class="hs-identifier hs-var">dataConTag</span></a></span><span> </span><span class="annot"><span class="annottext">(DataCon -&gt; ConTag)
-&gt; (CaseAlt DataCon -&gt; DataCon) -&gt; CaseAlt DataCon -&gt; ConTag
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">CaseAlt DataCon -&gt; DataCon
forall a. CaseAlt a -&gt; a
</span><a href="GHC.HsToCore.Utils.html#alt_pat"><span class="hs-identifier hs-var">alt_pat</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">([CaseAlt DataCon] -&gt; [CaseAlt DataCon])
-&gt; [CaseAlt DataCon] -&gt; [CaseAlt DataCon]
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">NonEmpty (CaseAlt DataCon) -&gt; [CaseAlt DataCon]
forall a. NonEmpty a -&gt; [a]
</span><a href="../../base-4.21.0.0-ae91/src/Data.List.NonEmpty.html#toList"><span class="hs-identifier hs-var">NEL.toList</span></a></span><span> </span><span class="annot"><span class="annottext">NonEmpty (CaseAlt DataCon)
</span><a href="#local-6989586621683122739"><span class="hs-identifier hs-var">alts</span></a></span><span>
</span><span id="line-364"></span><span>
</span><span id="line-365"></span><span>    </span><span id="local-6989586621683122752"><span class="annot"><span class="annottext">var_ty :: Mult
</span><a href="#local-6989586621683122752"><span class="hs-identifier hs-var hs-var">var_ty</span></a></span></span><span>       </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Var -&gt; Mult
</span><a href="GHC.Types.Id.html#idType"><span class="hs-identifier hs-var">idType</span></a></span><span> </span><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621683122737"><span class="hs-identifier hs-var">var</span></a></span><span>
</span><span id="line-366"></span><span>    </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TyCon
</span><span class="hs-identifier">_</span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621683122753"><span class="annot"><span class="annottext">[Mult]
</span><a href="#local-6989586621683122753"><span class="hs-identifier hs-var">ty_args</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Mult -&gt; (TyCon, [Mult])
</span><a href="GHC.Core.Type.html#tcSplitTyConApp"><span class="hs-identifier hs-var">tcSplitTyConApp</span></a></span><span> </span><span class="annot"><span class="annottext">Mult
</span><a href="#local-6989586621683122752"><span class="hs-identifier hs-var">var_ty</span></a></span><span> </span><span class="hs-comment">-- Don't look through newtypes</span><span>
</span><span id="line-367"></span><span>                                          </span><span class="hs-comment">-- (not that splitTyConApp does, these days)</span><span>
</span><span id="line-368"></span><span>
</span><span id="line-369"></span><span>    </span><span class="annot"><a href="#local-6989586621683122742"><span class="hs-identifier hs-type">mk_case</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Maybe</span></span><span> </span><span class="annot"><a href="GHC.Core.html#CoreAlt"><span class="hs-identifier hs-type">CoreAlt</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="GHC.Core.html#CoreAlt"><span class="hs-identifier hs-type">CoreAlt</span></a></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Core.html#CoreExpr"><span class="hs-identifier hs-type">CoreExpr</span></a></span><span>
</span><span id="line-370"></span><span>    </span><span id="local-6989586621683122742"><span class="annot"><span class="annottext">mk_case :: Maybe (Alt Var) -&gt; [Alt Var] -&gt; CoreExpr
</span><a href="#local-6989586621683122742"><span class="hs-identifier hs-var hs-var">mk_case</span></a></span></span><span> </span><span id="local-6989586621683122755"><span class="annot"><span class="annottext">Maybe (Alt Var)
</span><a href="#local-6989586621683122755"><span class="hs-identifier hs-var">def</span></a></span></span><span> </span><span id="local-6989586621683122756"><span class="annot"><span class="annottext">[Alt Var]
</span><a href="#local-6989586621683122756"><span class="hs-identifier hs-var">alts</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">CoreExpr -&gt; Scaled Mult -&gt; Mult -&gt; [Alt Var] -&gt; CoreExpr
</span><a href="GHC.Core.Make.html#mkWildCase"><span class="hs-identifier hs-var">mkWildCase</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Var -&gt; CoreExpr
forall b. Var -&gt; Expr b
</span><a href="GHC.Core.html#Var"><span class="hs-identifier hs-var">Var</span></a></span><span> </span><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621683122737"><span class="hs-identifier hs-var">var</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Var -&gt; Scaled Mult
</span><a href="GHC.Types.Id.html#idScaledType"><span class="hs-identifier hs-var">idScaledType</span></a></span><span> </span><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621683122737"><span class="hs-identifier hs-var">var</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Mult
</span><a href="#local-6989586621683122738"><span class="hs-identifier hs-var">ty</span></a></span><span> </span><span class="annot"><span class="annottext">([Alt Var] -&gt; CoreExpr) -&gt; [Alt Var] -&gt; CoreExpr
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-371"></span><span>      </span><span class="annot"><span class="annottext">Maybe (Alt Var) -&gt; [Alt Var]
forall a. Maybe a -&gt; [a]
</span><span class="hs-identifier hs-var">maybeToList</span></span><span> </span><span class="annot"><span class="annottext">Maybe (Alt Var)
</span><a href="#local-6989586621683122755"><span class="hs-identifier hs-var">def</span></a></span><span> </span><span class="annot"><span class="annottext">[Alt Var] -&gt; [Alt Var] -&gt; [Alt Var]
forall a. [a] -&gt; [a] -&gt; [a]
</span><span class="hs-operator hs-var">++</span></span><span> </span><span class="annot"><span class="annottext">[Alt Var]
</span><a href="#local-6989586621683122756"><span class="hs-identifier hs-var">alts</span></a></span><span>
</span><span id="line-372"></span><span>
</span><span id="line-373"></span><span>    </span><span class="annot"><a href="#local-6989586621683122744"><span class="hs-identifier hs-type">mk_alts</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.HsToCore.Monad.html#MatchResult"><span class="hs-identifier hs-type">MatchResult</span></a></span><span> </span><span class="hs-special">[</span><span class="annot"><a href="GHC.Core.html#CoreAlt"><span class="hs-identifier hs-type">CoreAlt</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-374"></span><span>    </span><span id="local-6989586621683122744"><span class="annot"><span class="annottext">mk_alts :: MatchResult [Alt Var]
</span><a href="#local-6989586621683122744"><span class="hs-identifier hs-var hs-var">mk_alts</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(CaseAlt DataCon -&gt; MatchResult (Alt Var))
-&gt; [CaseAlt DataCon] -&gt; MatchResult [Alt Var]
forall (t :: * -&gt; *) (f :: * -&gt; *) a b.
(Traversable t, Applicative f) =&gt;
(a -&gt; f b) -&gt; t a -&gt; f (t b)
forall (f :: * -&gt; *) a b.
Applicative f =&gt;
(a -&gt; f b) -&gt; [a] -&gt; f [b]
</span><span class="hs-identifier hs-var">traverse</span></span><span> </span><span class="annot"><span class="annottext">CaseAlt DataCon -&gt; MatchResult (Alt Var)
</span><a href="#local-6989586621683122760"><span class="hs-identifier hs-var">mk_alt</span></a></span><span> </span><span class="annot"><span class="annottext">[CaseAlt DataCon]
</span><a href="#local-6989586621683122749"><span class="hs-identifier hs-var">sorted_alts</span></a></span><span>
</span><span id="line-375"></span><span>
</span><span id="line-376"></span><span>    </span><span class="annot"><a href="#local-6989586621683122760"><span class="hs-identifier hs-type">mk_alt</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.HsToCore.Utils.html#CaseAlt"><span class="hs-identifier hs-type">CaseAlt</span></a></span><span> </span><span class="annot"><a href="GHC.Core.DataCon.html#DataCon"><span class="hs-identifier hs-type">DataCon</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.HsToCore.Monad.html#MatchResult"><span class="hs-identifier hs-type">MatchResult</span></a></span><span> </span><span class="annot"><a href="GHC.Core.html#CoreAlt"><span class="hs-identifier hs-type">CoreAlt</span></a></span><span>
</span><span id="line-377"></span><span>    </span><span id="local-6989586621683122760"><span class="annot"><span class="annottext">mk_alt :: CaseAlt DataCon -&gt; MatchResult (Alt Var)
</span><a href="#local-6989586621683122760"><span class="hs-identifier hs-var hs-var">mk_alt</span></a></span></span><span> </span><span class="annot"><a href="GHC.HsToCore.Utils.html#MkCaseAlt"><span class="hs-identifier hs-type">MkCaseAlt</span></a></span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">alt_pat :: forall a. CaseAlt a -&gt; a
</span><a href="GHC.HsToCore.Utils.html#alt_pat"><span class="hs-identifier hs-var">alt_pat</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="local-6989586621683122761"><span class="annot"><span class="annottext">DataCon
</span><a href="#local-6989586621683122761"><span class="hs-identifier hs-var">con</span></a></span></span><span>
</span><span id="line-378"></span><span>                     </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">alt_bndrs :: forall a. CaseAlt a -&gt; [Var]
</span><a href="GHC.HsToCore.Utils.html#alt_bndrs"><span class="hs-identifier hs-var">alt_bndrs</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="local-6989586621683122762"><span class="annot"><span class="annottext">[Var]
</span><a href="#local-6989586621683122762"><span class="hs-identifier hs-var">args</span></a></span></span><span>
</span><span id="line-379"></span><span>                     </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">alt_result :: forall a. CaseAlt a -&gt; MatchResult CoreExpr
</span><a href="GHC.HsToCore.Utils.html#alt_result"><span class="hs-identifier hs-var">alt_result</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="local-6989586621683122763"><span class="annot"><span class="annottext">MatchResult CoreExpr
</span><a href="#local-6989586621683122763"><span class="hs-identifier hs-var">match_result</span></a></span></span><span> </span><span class="hs-special">}</span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-380"></span><span>      </span><span class="annot"><span class="annottext">((CoreExpr -&gt; IOEnv (Env DsGblEnv DsLclEnv) (Alt Var))
 -&gt; MatchResult CoreExpr -&gt; MatchResult (Alt Var))
-&gt; MatchResult CoreExpr
-&gt; (CoreExpr -&gt; IOEnv (Env DsGblEnv DsLclEnv) (Alt Var))
-&gt; MatchResult (Alt Var)
forall a b c. (a -&gt; b -&gt; c) -&gt; b -&gt; a -&gt; c
</span><span class="hs-identifier hs-var">flip</span></span><span> </span><span class="annot"><span class="annottext">(CoreExpr -&gt; IOEnv (Env DsGblEnv DsLclEnv) (Alt Var))
-&gt; MatchResult CoreExpr -&gt; MatchResult (Alt Var)
forall a b. (a -&gt; DsM b) -&gt; MatchResult a -&gt; MatchResult b
</span><a href="GHC.HsToCore.Utils.html#adjustMatchResultDs"><span class="hs-identifier hs-var">adjustMatchResultDs</span></a></span><span> </span><span class="annot"><span class="annottext">MatchResult CoreExpr
</span><a href="#local-6989586621683122763"><span class="hs-identifier hs-var">match_result</span></a></span><span> </span><span class="annot"><span class="annottext">((CoreExpr -&gt; IOEnv (Env DsGblEnv DsLclEnv) (Alt Var))
 -&gt; MatchResult (Alt Var))
-&gt; (CoreExpr -&gt; IOEnv (Env DsGblEnv DsLclEnv) (Alt Var))
-&gt; MatchResult (Alt Var)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-glyph">\</span><span id="local-6989586621683122765"><span class="annot"><span class="annottext">CoreExpr
</span><a href="#local-6989586621683122765"><span class="hs-identifier hs-var">body</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-381"></span><span>        </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">DataCon -&gt; Maybe DataConBoxer
</span><a href="GHC.Core.DataCon.html#dataConBoxer"><span class="hs-identifier hs-var">dataConBoxer</span></a></span><span> </span><span class="annot"><span class="annottext">DataCon
</span><a href="#local-6989586621683122761"><span class="hs-identifier hs-var">con</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-382"></span><span>          </span><span class="annot"><span class="annottext">Maybe DataConBoxer
</span><span class="hs-identifier hs-var">Nothing</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Alt Var -&gt; IOEnv (Env DsGblEnv DsLclEnv) (Alt Var)
forall a. a -&gt; IOEnv (Env DsGblEnv DsLclEnv) a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">AltCon -&gt; [Var] -&gt; CoreExpr -&gt; Alt Var
forall b. AltCon -&gt; [b] -&gt; Expr b -&gt; Alt b
</span><a href="GHC.Core.html#Alt"><span class="hs-identifier hs-var">Alt</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">DataCon -&gt; AltCon
</span><a href="GHC.Core.html#DataAlt"><span class="hs-identifier hs-var">DataAlt</span></a></span><span> </span><span class="annot"><span class="annottext">DataCon
</span><a href="#local-6989586621683122761"><span class="hs-identifier hs-var">con</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[Var]
</span><a href="#local-6989586621683122762"><span class="hs-identifier hs-var">args</span></a></span><span> </span><span class="annot"><span class="annottext">CoreExpr
</span><a href="#local-6989586621683122765"><span class="hs-identifier hs-var">body</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-383"></span><span>          </span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Types.Id.Make.html#DCB"><span class="hs-identifier hs-type">DCB</span></a></span><span> </span><span id="local-6989586621683122769"><span class="annot"><span class="annottext">[Mult] -&gt; [Var] -&gt; UniqSM ([Var], [Bind Var])
</span><a href="#local-6989586621683122769"><span class="hs-identifier hs-var">boxer</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-384"></span><span>            </span><span id="local-6989586621683122770"><span class="annot"><a href="#local-6989586621683122770"><span class="hs-identifier hs-var">us</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">TcRnIf DsGblEnv DsLclEnv UniqSupply
forall gbl lcl. TcRnIf gbl lcl UniqSupply
</span><a href="GHC.Tc.Utils.Monad.html#newUniqueSupply"><span class="hs-identifier hs-var">newUniqueSupply</span></a></span><span>
</span><span id="line-385"></span><span>            </span><span class="hs-keyword">let</span><span> </span><span class="hs-special">(</span><span id="local-6989586621683122772"><span class="annot"><a href="#local-6989586621683122772"><span class="hs-identifier hs-var">rep_ids</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621683122773"><span class="annot"><a href="#local-6989586621683122773"><span class="hs-identifier hs-var">binds</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="GHC.Types.Unique.Supply.html#initUs_"><span class="hs-identifier hs-type">initUs_</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683122770"><span class="hs-identifier hs-type">us</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621683122769"><span class="hs-identifier hs-type">boxer</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683122753"><span class="hs-identifier hs-type">ty_args</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683122762"><span class="hs-identifier hs-type">args</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-386"></span><span>            </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621683122775"><span class="annot"><a href="#local-6989586621683122775"><span class="hs-identifier hs-var hs-var">rep_ids'</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(Var -&gt; Var) -&gt; [Var] -&gt; [Var]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><span class="hs-identifier hs-var">map</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Mult -&gt; Var -&gt; Var
</span><a href="GHC.Types.Id.html#scaleVarBy"><span class="hs-identifier hs-var">scaleVarBy</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Var -&gt; Mult
</span><a href="GHC.Types.Id.html#idMult"><span class="hs-identifier hs-var">idMult</span></a></span><span> </span><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621683122737"><span class="hs-identifier hs-var">var</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[Var]
</span><a href="#local-6989586621683122772"><span class="hs-identifier hs-var">rep_ids</span></a></span><span>
</span><span id="line-387"></span><span>              </span><span class="hs-comment">-- Upholds the invariant that the binders of a case expression</span><span>
</span><span id="line-388"></span><span>              </span><span class="hs-comment">-- must be scaled by the case multiplicity. See Note [Case</span><span>
</span><span id="line-389"></span><span>              </span><span class="hs-comment">-- expression invariants] in CoreSyn.</span><span>
</span><span id="line-390"></span><span>            </span><span class="annot"><span class="hs-identifier hs-type">return</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Core.html#Alt"><span class="hs-identifier hs-type">Alt</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Core.html#DataAlt"><span class="hs-identifier hs-type">DataAlt</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683122761"><span class="hs-identifier hs-type">con</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><a href="#local-6989586621683122775"><span class="hs-identifier hs-type">rep_ids'</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Core.html#mkLets"><span class="hs-identifier hs-type">mkLets</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683122773"><span class="hs-identifier hs-type">binds</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683122765"><span class="hs-identifier hs-type">body</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-391"></span><span>
</span><span id="line-392"></span><span>    </span><span class="annot"><a href="#local-6989586621683122743"><span class="hs-identifier hs-type">mk_default</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.HsToCore.Monad.html#MatchResult"><span class="hs-identifier hs-type">MatchResult</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Maybe</span></span><span> </span><span class="annot"><a href="GHC.Core.html#CoreAlt"><span class="hs-identifier hs-type">CoreAlt</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-393"></span><span>    </span><span id="local-6989586621683122743"><span class="annot"><span class="annottext">mk_default :: MatchResult (Maybe (Alt Var))
</span><a href="#local-6989586621683122743"><span class="hs-identifier hs-var hs-var">mk_default</span></a></span></span><span>
</span><span id="line-394"></span><span>      </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621683122779"><span class="hs-identifier hs-var">exhaustive_case</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">DsM (Maybe (Alt Var)) -&gt; MatchResult (Maybe (Alt Var))
forall a. DsM a -&gt; MatchResult a
</span><a href="GHC.HsToCore.Monad.html#MR_Infallible"><span class="hs-identifier hs-var">MR_Infallible</span></a></span><span> </span><span class="annot"><span class="annottext">(DsM (Maybe (Alt Var)) -&gt; MatchResult (Maybe (Alt Var)))
-&gt; DsM (Maybe (Alt Var)) -&gt; MatchResult (Maybe (Alt Var))
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Maybe (Alt Var) -&gt; DsM (Maybe (Alt Var))
forall a. a -&gt; IOEnv (Env DsGblEnv DsLclEnv) a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="annot"><span class="annottext">Maybe (Alt Var)
forall a. Maybe a
</span><span class="hs-identifier hs-var">Nothing</span></span><span>
</span><span id="line-395"></span><span>      </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">otherwise</span></span><span>       </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(CoreExpr -&gt; DsM (Maybe (Alt Var)))
-&gt; MatchResult (Maybe (Alt Var))
forall a. (CoreExpr -&gt; DsM a) -&gt; MatchResult a
</span><a href="GHC.HsToCore.Monad.html#MR_Fallible"><span class="hs-identifier hs-var">MR_Fallible</span></a></span><span> </span><span class="annot"><span class="annottext">((CoreExpr -&gt; DsM (Maybe (Alt Var)))
 -&gt; MatchResult (Maybe (Alt Var)))
-&gt; (CoreExpr -&gt; DsM (Maybe (Alt Var)))
-&gt; MatchResult (Maybe (Alt Var))
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-glyph">\</span><span id="local-6989586621683122780"><span class="annot"><span class="annottext">CoreExpr
</span><a href="#local-6989586621683122780"><span class="hs-identifier hs-var">fail</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Maybe (Alt Var) -&gt; DsM (Maybe (Alt Var))
forall a. a -&gt; IOEnv (Env DsGblEnv DsLclEnv) a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="annot"><span class="annottext">(Maybe (Alt Var) -&gt; DsM (Maybe (Alt Var)))
-&gt; Maybe (Alt Var) -&gt; DsM (Maybe (Alt Var))
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Alt Var -&gt; Maybe (Alt Var)
forall a. a -&gt; Maybe a
</span><span class="hs-identifier hs-var">Just</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">AltCon -&gt; [Var] -&gt; CoreExpr -&gt; Alt Var
forall b. AltCon -&gt; [b] -&gt; Expr b -&gt; Alt b
</span><a href="GHC.Core.html#Alt"><span class="hs-identifier hs-var">Alt</span></a></span><span> </span><span class="annot"><span class="annottext">AltCon
</span><a href="GHC.Core.html#DEFAULT"><span class="hs-identifier hs-var">DEFAULT</span></a></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><span class="annot"><span class="annottext">CoreExpr
</span><a href="#local-6989586621683122780"><span class="hs-identifier hs-var">fail</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-396"></span><span>
</span><span id="line-397"></span><span>    </span><span id="local-6989586621683122782"><span class="annot"><span class="annottext">mentioned_constructors :: UniqSet DataCon
</span><a href="#local-6989586621683122782"><span class="hs-identifier hs-var hs-var">mentioned_constructors</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[DataCon] -&gt; UniqSet DataCon
forall a. Uniquable a =&gt; [a] -&gt; UniqSet a
</span><a href="GHC.Types.Unique.Set.html#mkUniqSet"><span class="hs-identifier hs-var">mkUniqSet</span></a></span><span> </span><span class="annot"><span class="annottext">([DataCon] -&gt; UniqSet DataCon) -&gt; [DataCon] -&gt; UniqSet DataCon
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">(CaseAlt DataCon -&gt; DataCon) -&gt; [CaseAlt DataCon] -&gt; [DataCon]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><span class="hs-identifier hs-var">map</span></span><span> </span><span class="annot"><span class="annottext">CaseAlt DataCon -&gt; DataCon
forall a. CaseAlt a -&gt; a
</span><a href="GHC.HsToCore.Utils.html#alt_pat"><span class="hs-identifier hs-var">alt_pat</span></a></span><span> </span><span class="annot"><span class="annottext">[CaseAlt DataCon]
</span><a href="#local-6989586621683122749"><span class="hs-identifier hs-var">sorted_alts</span></a></span><span>
</span><span id="line-398"></span><span>    </span><span id="local-6989586621683122784"><span class="annot"><span class="annottext">un_mentioned_constructors :: UniqSet DataCon
</span><a href="#local-6989586621683122784"><span class="hs-identifier hs-var hs-var">un_mentioned_constructors</span></a></span></span><span>
</span><span id="line-399"></span><span>        </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[DataCon] -&gt; UniqSet DataCon
forall a. Uniquable a =&gt; [a] -&gt; UniqSet a
</span><a href="GHC.Types.Unique.Set.html#mkUniqSet"><span class="hs-identifier hs-var">mkUniqSet</span></a></span><span> </span><span class="annot"><span class="annottext">[DataCon]
</span><a href="#local-6989586621683122747"><span class="hs-identifier hs-var">data_cons</span></a></span><span> </span><span class="annot"><span class="annottext">UniqSet DataCon -&gt; UniqSet DataCon -&gt; UniqSet DataCon
forall a. UniqSet a -&gt; UniqSet a -&gt; UniqSet a
</span><a href="GHC.Types.Unique.Set.html#minusUniqSet"><span class="hs-operator hs-var">`minusUniqSet`</span></a></span><span> </span><span class="annot"><span class="annottext">UniqSet DataCon
</span><a href="#local-6989586621683122782"><span class="hs-identifier hs-var">mentioned_constructors</span></a></span><span>
</span><span id="line-400"></span><span>    </span><span id="local-6989586621683122779"><span class="annot"><span class="annottext">exhaustive_case :: Bool
</span><a href="#local-6989586621683122779"><span class="hs-identifier hs-var hs-var">exhaustive_case</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">UniqSet DataCon -&gt; Bool
forall a. UniqSet a -&gt; Bool
</span><a href="GHC.Types.Unique.Set.html#isEmptyUniqSet"><span class="hs-identifier hs-var">isEmptyUniqSet</span></a></span><span> </span><span class="annot"><span class="annottext">UniqSet DataCon
</span><a href="#local-6989586621683122784"><span class="hs-identifier hs-var">un_mentioned_constructors</span></a></span><span>
</span><span id="line-401"></span><span>
</span><span id="line-402"></span><span class="hs-comment">{-
************************************************************************
*                                                                      *
\subsection{Desugarer's versions of some Core functions}
*                                                                      *
************************************************************************
-}</span><span>
</span><span id="line-409"></span><span>
</span><span id="line-410"></span><span class="annot"><a href="GHC.HsToCore.Utils.html#mkErrorAppDs"><span class="hs-identifier hs-type">mkErrorAppDs</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Types.Var.html#Id"><span class="hs-identifier hs-type">Id</span></a></span><span>              </span><span class="hs-comment">-- The error function</span><span>
</span><span id="line-411"></span><span>             </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#Type"><span class="hs-identifier hs-type">Type</span></a></span><span>            </span><span class="hs-comment">-- Type to which it should be applied</span><span>
</span><span id="line-412"></span><span>             </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Utils.Outputable.html#SDoc"><span class="hs-identifier hs-type">SDoc</span></a></span><span>            </span><span class="hs-comment">-- The error message string to pass</span><span>
</span><span id="line-413"></span><span>             </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.HsToCore.Types.html#DsM"><span class="hs-identifier hs-type">DsM</span></a></span><span> </span><span class="annot"><a href="GHC.Core.html#CoreExpr"><span class="hs-identifier hs-type">CoreExpr</span></a></span><span>
</span><span id="line-414"></span><span>
</span><span id="line-415"></span><span id="mkErrorAppDs"><span class="annot"><span class="annottext">mkErrorAppDs :: Var -&gt; Mult -&gt; SDoc -&gt; DsM CoreExpr
</span><a href="GHC.HsToCore.Utils.html#mkErrorAppDs"><span class="hs-identifier hs-var hs-var">mkErrorAppDs</span></a></span></span><span> </span><span id="local-6989586621683122787"><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621683122787"><span class="hs-identifier hs-var">err_id</span></a></span></span><span> </span><span id="local-6989586621683122788"><span class="annot"><span class="annottext">Mult
</span><a href="#local-6989586621683122788"><span class="hs-identifier hs-var">ty</span></a></span></span><span> </span><span id="local-6989586621683122789"><span class="annot"><span class="annottext">SDoc
</span><a href="#local-6989586621683122789"><span class="hs-identifier hs-var">msg</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-416"></span><span>    </span><span id="local-6989586621683122790"><span class="annot"><a href="#local-6989586621683122790"><span class="hs-identifier hs-var">src_loc</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">DsM SrcSpan
</span><a href="GHC.HsToCore.Monad.html#getSrcSpanDs"><span class="hs-identifier hs-var">getSrcSpanDs</span></a></span><span>
</span><span id="line-417"></span><span>    </span><span id="local-6989586621683122792"><span class="annot"><a href="#local-6989586621683122792"><span class="hs-identifier hs-var">dflags</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><a href="GHC.Driver.DynFlags.html#getDynFlags"><span class="hs-identifier hs-type">getDynFlags</span></a></span><span>
</span><span id="line-418"></span><span>    </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621683122794"><span class="annot"><a href="#local-6989586621683122794"><span class="hs-identifier hs-var hs-var">full_msg</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">DynFlags -&gt; SDoc -&gt; [Char]
</span><a href="GHC.Driver.Ppr.html#showSDoc"><span class="hs-identifier hs-var">showSDoc</span></a></span><span> </span><span class="annot"><span class="annottext">DynFlags
</span><a href="#local-6989586621683122792"><span class="hs-identifier hs-var">dflags</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[SDoc] -&gt; SDoc
forall doc. IsLine doc =&gt; [doc] -&gt; doc
</span><a href="GHC.Utils.Outputable.html#hcat"><span class="hs-identifier hs-var">hcat</span></a></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">SrcSpan -&gt; SDoc
forall a. Outputable a =&gt; a -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="annot"><span class="annottext">SrcSpan
</span><a href="#local-6989586621683122790"><span class="hs-identifier hs-var">src_loc</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">SDoc
forall doc. IsLine doc =&gt; doc
</span><a href="GHC.Utils.Outputable.html#vbar"><span class="hs-identifier hs-var">vbar</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">SDoc
</span><a href="#local-6989586621683122789"><span class="hs-identifier hs-var">msg</span></a></span><span class="hs-special">]</span><span class="hs-special">)</span><span>
</span><span id="line-419"></span><span>        </span><span id="local-6989586621683122798"><span class="annot"><a href="#local-6989586621683122798"><span class="hs-identifier hs-var hs-var">fail_expr</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Var -&gt; Mult -&gt; [Char] -&gt; CoreExpr
</span><a href="GHC.Core.Make.html#mkRuntimeErrorApp"><span class="hs-identifier hs-var">mkRuntimeErrorApp</span></a></span><span> </span><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621683122787"><span class="hs-identifier hs-var">err_id</span></a></span><span> </span><span class="annot"><span class="annottext">Mult
</span><a href="GHC.Builtin.Types.html#unitTy"><span class="hs-identifier hs-var">unitTy</span></a></span><span> </span><span class="annot"><span class="annottext">[Char]
</span><a href="#local-6989586621683122794"><span class="hs-identifier hs-var">full_msg</span></a></span><span>
</span><span id="line-420"></span><span>    </span><span class="annot"><span class="hs-identifier hs-type">return</span></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="annot"><a href="GHC.Core.Make.html#mkWildCase"><span class="hs-identifier hs-type">mkWildCase</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683122798"><span class="hs-identifier hs-type">fail_expr</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Core.Type.html#unrestricted"><span class="hs-identifier hs-type">unrestricted</span></a></span><span> </span><span class="annot"><a href="GHC.Builtin.Types.html#unitTy"><span class="hs-identifier hs-type">unitTy</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><a href="#local-6989586621683122788"><span class="hs-identifier hs-type">ty</span></a></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span>
</span><span id="line-421"></span><span>    </span><span class="hs-comment">-- See Note [Incompleteness and linearity]</span><span>
</span><span id="line-422"></span><span>
</span><span id="line-423"></span><span class="hs-comment">{-
Note [Incompleteness and linearity]
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
The default branch of an incomplete pattern match is compiled to a call
to 'error'.
Because of linearity, we wrap it with an empty case. Example:

f :: a %1 -&gt; Bool -&gt; a
f x True = False

Adding 'f x False = error &quot;Non-exhaustive pattern...&quot;' would violate
the linearity of x.
Instead, we use 'f x False = case error &quot;Non-exhaustive pattern...&quot; :: () of {}'.
This case expression accounts for linear variables by assigning bottom usage
(See Note [Bottom as a usage] in GHC.Core.Multiplicity).
This is done in mkErrorAppDs, called from mkFailExpr.
We use '()' instead of the original return type ('a' in this case)
because there might be representation polymorphism, e.g. in

g :: forall (a :: TYPE r). (() -&gt; a) %1 -&gt; Bool -&gt; a
g x True = x ()

adding 'g x False = case error &quot;Non-exhaustive pattern&quot; :: a of {}'
would create an illegal representation-polymorphic case binder.
This is important for pattern synonym matchers, which often look like this 'g'.

Similarly, a hole
h :: a %1 -&gt; a
h x = _
is desugared to 'case error &quot;Hole&quot; :: () of {}'. Test: LinearHole.

Instead of () we could use Data.Void.Void, but that would require
moving Void to GHC.Types: partial pattern matching is used in modules
that are compiled before Data.Void.
We can use () even though it has a constructor, because
Note [Case expression invariants] point 4 in GHC.Core is satisfied
when the scrutinee is bottoming.

You might wonder if this change slows down compilation, but the
performance testsuite did not show up any regressions.

For uniformity, calls to 'error' in both cases are wrapped even if -XLinearTypes
is disabled.
-}</span><span>
</span><span id="line-467"></span><span>
</span><span id="line-468"></span><span class="annot"><a href="GHC.HsToCore.Utils.html#mkFailExpr"><span class="hs-identifier hs-type">mkFailExpr</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Hs.Expr.html#HsMatchContextRn"><span class="hs-identifier hs-type">HsMatchContextRn</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#Type"><span class="hs-identifier hs-type">Type</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.HsToCore.Types.html#DsM"><span class="hs-identifier hs-type">DsM</span></a></span><span> </span><span class="annot"><a href="GHC.Core.html#CoreExpr"><span class="hs-identifier hs-type">CoreExpr</span></a></span><span>
</span><span id="line-469"></span><span id="mkFailExpr"><span class="annot"><span class="annottext">mkFailExpr :: HsMatchContextRn -&gt; Mult -&gt; DsM CoreExpr
</span><a href="GHC.HsToCore.Utils.html#mkFailExpr"><span class="hs-identifier hs-var hs-var">mkFailExpr</span></a></span></span><span> </span><span id="local-6989586621683122802"><span class="annot"><span class="annottext">HsMatchContextRn
</span><a href="#local-6989586621683122802"><span class="hs-identifier hs-var">ctxt</span></a></span></span><span> </span><span id="local-6989586621683122803"><span class="annot"><span class="annottext">Mult
</span><a href="#local-6989586621683122803"><span class="hs-identifier hs-var">ty</span></a></span></span><span>
</span><span id="line-470"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Var -&gt; Mult -&gt; SDoc -&gt; DsM CoreExpr
</span><a href="GHC.HsToCore.Utils.html#mkErrorAppDs"><span class="hs-identifier hs-var">mkErrorAppDs</span></a></span><span> </span><span class="annot"><span class="annottext">Var
</span><a href="GHC.Core.Make.html#pAT_ERROR_ID"><span class="hs-identifier hs-var">pAT_ERROR_ID</span></a></span><span> </span><span class="annot"><span class="annottext">Mult
</span><a href="#local-6989586621683122803"><span class="hs-identifier hs-var">ty</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">HsMatchContext (GenLocated SrcSpanAnnN Name) -&gt; SDoc
forall fn. Outputable fn =&gt; HsMatchContext fn -&gt; SDoc
</span><a href="GHC.Hs.Expr.html#matchContextErrString"><span class="hs-identifier hs-var">matchContextErrString</span></a></span><span> </span><span class="annot"><span class="annottext">HsMatchContextRn
HsMatchContext (GenLocated SrcSpanAnnN Name)
</span><a href="#local-6989586621683122802"><span class="hs-identifier hs-var">ctxt</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-471"></span><span>
</span><span id="line-472"></span><span class="hs-comment">{-
'mkCoreAppDs' and 'mkCoreAppsDs' handle the special-case desugaring of 'seq'.

Note [Desugaring seq]
~~~~~~~~~~~~~~~~~~~~~

There are a few subtleties in the desugaring of `seq`:

 1. (as described in #1031)

    Consider,
       f x y = x `seq` (y `seq` (# x,y #))

    Because the argument to the outer 'seq' has an unlifted type, we'll use
    call-by-value, and compile it as if we had

       f x y = case (y `seq` (# x,y #)) of v -&gt; x `seq` v

    But that is bad, because we now evaluate y before x!

    Seq is very, very special!  So we recognise it right here, and desugar to
            case x of _ -&gt; case y of _ -&gt; (# x,y #)

 2. (as described in #2273)

    Consider
       let chp = case b of { True -&gt; fst x; False -&gt; 0 }
       in chp `seq` ...chp...
    Here the seq is designed to plug the space leak of retaining (snd x)
    for too long.

    If we rely on the ordinary inlining of seq, we'll get
       let chp = case b of { True -&gt; fst x; False -&gt; 0 }
       case chp of _ { I# -&gt; ...chp... }

    But since chp is cheap, and the case is an alluring context, we'll
    inline chp into the case scrutinee.  Now there is only one use of chp,
    so we'll inline a second copy.  Alas, we've now ruined the purpose of
    the seq, by re-introducing the space leak:
        case (case b of {True -&gt; fst x; False -&gt; 0}) of
          I# _ -&gt; ...case b of {True -&gt; fst x; False -&gt; 0}...

    We can try to avoid doing this by ensuring that the binder-swap in the
    case happens, so we get this at an early stage:
       case chp of chp2 { I# -&gt; ...chp2... }
    But this is fragile.  The real culprit is the source program.  Perhaps we
    should have said explicitly
       let !chp2 = chp in ...chp2...

    But that's painful.  So the code here does a little hack to make seq
    more robust: a saturated application of 'seq' is turned *directly* into
    the case expression, thus:
       x  `seq` e2 ==&gt; case x of x -&gt; e2    -- Note shadowing!
       e1 `seq` e2 ==&gt; case x of _ -&gt; e2

    So we desugar our example to:
       let chp = case b of { True -&gt; fst x; False -&gt; 0 }
       case chp of chp { I# -&gt; ...chp... }
    And now all is well.

    The reason it's a hack is because if you define mySeq=seq, the hack
    won't work on mySeq.

 3. (as described in #2409)

    The isInternalName ensures that we don't turn
            True `seq` e
    into
            case True of True { ... }
    which stupidly tries to bind the datacon 'True'.
-}</span><span>
</span><span id="line-543"></span><span>
</span><span id="line-544"></span><span class="hs-comment">-- NB: Make sure the argument is not representation-polymorphic</span><span>
</span><span id="line-545"></span><span class="annot"><a href="GHC.HsToCore.Utils.html#mkCoreAppDs"><span class="hs-identifier hs-type">mkCoreAppDs</span></a></span><span>  </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Utils.Outputable.html#SDoc"><span class="hs-identifier hs-type">SDoc</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Core.html#CoreExpr"><span class="hs-identifier hs-type">CoreExpr</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Core.html#CoreExpr"><span class="hs-identifier hs-type">CoreExpr</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Core.html#CoreExpr"><span class="hs-identifier hs-type">CoreExpr</span></a></span><span>
</span><span id="line-546"></span><span id="mkCoreAppDs"><span class="annot"><span class="annottext">mkCoreAppDs :: SDoc -&gt; CoreExpr -&gt; CoreExpr -&gt; CoreExpr
</span><a href="GHC.HsToCore.Utils.html#mkCoreAppDs"><span class="hs-identifier hs-var hs-var">mkCoreAppDs</span></a></span></span><span> </span><span class="annot"><span class="annottext">SDoc
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Core.html#Var"><span class="hs-identifier hs-type">Var</span></a></span><span> </span><span id="local-6989586621683122806"><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621683122806"><span class="hs-identifier hs-var">f</span></a></span></span><span> </span><span class="annot"><a href="GHC.Core.html#App"><span class="hs-operator hs-type">`App`</span></a></span><span> </span><span class="annot"><a href="GHC.Core.html#Type"><span class="hs-identifier hs-type">Type</span></a></span><span> </span><span id="local-6989586621683122809"><span class="annot"><span class="annottext">Mult
</span><a href="#local-6989586621683122809"><span class="hs-identifier hs-var">_r</span></a></span></span><span> </span><span class="annot"><a href="GHC.Core.html#App"><span class="hs-operator hs-type">`App`</span></a></span><span> </span><span class="annot"><a href="GHC.Core.html#Type"><span class="hs-identifier hs-type">Type</span></a></span><span> </span><span id="local-6989586621683122810"><span class="annot"><span class="annottext">Mult
</span><a href="#local-6989586621683122810"><span class="hs-identifier hs-var">ty1</span></a></span></span><span> </span><span class="annot"><a href="GHC.Core.html#App"><span class="hs-operator hs-type">`App`</span></a></span><span> </span><span class="annot"><a href="GHC.Core.html#Type"><span class="hs-identifier hs-type">Type</span></a></span><span> </span><span id="local-6989586621683122811"><span class="annot"><span class="annottext">Mult
</span><a href="#local-6989586621683122811"><span class="hs-identifier hs-var">ty2</span></a></span></span><span> </span><span class="annot"><a href="GHC.Core.html#App"><span class="hs-operator hs-type">`App`</span></a></span><span> </span><span id="local-6989586621683122812"><span class="annot"><span class="annottext">CoreExpr
</span><a href="#local-6989586621683122812"><span class="hs-identifier hs-var">arg1</span></a></span></span><span class="hs-special">)</span><span> </span><span id="local-6989586621683122813"><span class="annot"><span class="annottext">CoreExpr
</span><a href="#local-6989586621683122813"><span class="hs-identifier hs-var">arg2</span></a></span></span><span>
</span><span id="line-547"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621683122806"><span class="hs-identifier hs-var">f</span></a></span><span> </span><span class="annot"><span class="annottext">Var -&gt; Unique -&gt; Bool
forall a. Uniquable a =&gt; a -&gt; Unique -&gt; Bool
</span><a href="GHC.Types.Unique.html#hasKey"><span class="hs-operator hs-var">`hasKey`</span></a></span><span> </span><span class="annot"><span class="annottext">Unique
</span><a href="GHC.Builtin.Names.html#seqIdKey"><span class="hs-identifier hs-var">seqIdKey</span></a></span><span>            </span><span class="hs-comment">-- Note [Desugaring seq], points (1) and (2)</span><span>
</span><span id="line-548"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">CoreExpr -&gt; Var -&gt; Mult -&gt; [Alt Var] -&gt; CoreExpr
forall b. Expr b -&gt; b -&gt; Mult -&gt; [Alt b] -&gt; Expr b
</span><a href="GHC.Core.html#Case"><span class="hs-identifier hs-var">Case</span></a></span><span> </span><span class="annot"><span class="annottext">CoreExpr
</span><a href="#local-6989586621683122812"><span class="hs-identifier hs-var">arg1</span></a></span><span> </span><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621683122816"><span class="hs-identifier hs-var">case_bndr</span></a></span><span> </span><span class="annot"><span class="annottext">Mult
</span><a href="#local-6989586621683122811"><span class="hs-identifier hs-var">ty2</span></a></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">AltCon -&gt; [Var] -&gt; CoreExpr -&gt; Alt Var
forall b. AltCon -&gt; [b] -&gt; Expr b -&gt; Alt b
</span><a href="GHC.Core.html#Alt"><span class="hs-identifier hs-var">Alt</span></a></span><span> </span><span class="annot"><span class="annottext">AltCon
</span><a href="GHC.Core.html#DEFAULT"><span class="hs-identifier hs-var">DEFAULT</span></a></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><span class="annot"><span class="annottext">CoreExpr
</span><a href="#local-6989586621683122813"><span class="hs-identifier hs-var">arg2</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-549"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-550"></span><span>    </span><span id="local-6989586621683122816"><span class="annot"><span class="annottext">case_bndr :: Var
</span><a href="#local-6989586621683122816"><span class="hs-identifier hs-var hs-var">case_bndr</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">CoreExpr
</span><a href="#local-6989586621683122812"><span class="hs-identifier hs-var">arg1</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-551"></span><span>                   </span><span class="annot"><a href="GHC.Core.html#Var"><span class="hs-identifier hs-type">Var</span></a></span><span> </span><span id="local-6989586621683122817"><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621683122817"><span class="hs-identifier hs-var">v1</span></a></span></span><span> </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Name -&gt; Bool
</span><a href="GHC.Types.Name.html#isInternalName"><span class="hs-identifier hs-var">isInternalName</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Var -&gt; Name
</span><a href="GHC.Types.Id.html#idName"><span class="hs-identifier hs-var">idName</span></a></span><span> </span><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621683122817"><span class="hs-identifier hs-var">v1</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-552"></span><span>                          </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621683122817"><span class="hs-identifier hs-var">v1</span></a></span><span>        </span><span class="hs-comment">-- Note [Desugaring seq], points (2) and (3)</span><span>
</span><span id="line-553"></span><span>                   </span><span class="annot"><span class="annottext">CoreExpr
</span><span class="hs-identifier">_</span></span><span>      </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Mult -&gt; Mult -&gt; Var
</span><a href="GHC.Core.Make.html#mkWildValBinder"><span class="hs-identifier hs-var">mkWildValBinder</span></a></span><span> </span><span class="annot"><span class="annottext">Mult
</span><a href="GHC.Core.Type.html#ManyTy"><span class="hs-identifier hs-var">ManyTy</span></a></span><span> </span><span class="annot"><span class="annottext">Mult
</span><a href="#local-6989586621683122810"><span class="hs-identifier hs-var">ty1</span></a></span><span>
</span><span id="line-554"></span><span>
</span><span id="line-555"></span><span class="annot"><a href="GHC.HsToCore.Utils.html#mkCoreAppDs"><span class="hs-identifier hs-var">mkCoreAppDs</span></a></span><span> </span><span class="annot"><span class="annottext">SDoc
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Core.html#Var"><span class="hs-identifier hs-type">Var</span></a></span><span> </span><span id="local-6989586621683122821"><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621683122821"><span class="hs-identifier hs-var">f</span></a></span></span><span> </span><span class="annot"><a href="GHC.Core.html#App"><span class="hs-operator hs-type">`App`</span></a></span><span> </span><span class="annot"><a href="GHC.Core.html#Type"><span class="hs-identifier hs-type">Type</span></a></span><span> </span><span id="local-6989586621683122822"><span class="annot"><span class="annottext">Mult
</span><a href="#local-6989586621683122822"><span class="hs-identifier hs-var">_r</span></a></span></span><span class="hs-special">)</span><span> </span><span id="local-6989586621683122823"><span class="annot"><span class="annottext">CoreExpr
</span><a href="#local-6989586621683122823"><span class="hs-identifier hs-var">arg</span></a></span></span><span>
</span><span id="line-556"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621683122821"><span class="hs-identifier hs-var">f</span></a></span><span> </span><span class="annot"><span class="annottext">Var -&gt; Unique -&gt; Bool
forall a. Uniquable a =&gt; a -&gt; Unique -&gt; Bool
</span><a href="GHC.Types.Unique.html#hasKey"><span class="hs-operator hs-var">`hasKey`</span></a></span><span> </span><span class="annot"><span class="annottext">Unique
</span><a href="GHC.Builtin.Names.html#noinlineIdKey"><span class="hs-identifier hs-var">noinlineIdKey</span></a></span><span>   </span><span class="hs-comment">-- See Note [noinlineId magic] in GHC.Types.Id.Make</span><span>
</span><span id="line-557"></span><span>  </span><span class="hs-special">,</span><span> </span><span class="hs-special">(</span><span id="local-6989586621683122825"><span class="annot"><span class="annottext">CoreExpr
</span><a href="#local-6989586621683122825"><span class="hs-identifier hs-var">fun</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621683122826"><span class="annot"><span class="annottext">[CoreExpr]
</span><a href="#local-6989586621683122826"><span class="hs-identifier hs-var">args</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">CoreExpr -&gt; (CoreExpr, [CoreExpr])
forall b. Expr b -&gt; (Expr b, [Expr b])
</span><a href="GHC.Core.html#collectArgs"><span class="hs-identifier hs-var">collectArgs</span></a></span><span> </span><span class="annot"><span class="annottext">CoreExpr
</span><a href="#local-6989586621683122823"><span class="hs-identifier hs-var">arg</span></a></span><span>
</span><span id="line-558"></span><span>  </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Bool
</span><span class="hs-identifier hs-var">not</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[CoreExpr] -&gt; Bool
forall a. [a] -&gt; Bool
forall (t :: * -&gt; *) a. Foldable t =&gt; t a -&gt; Bool
</span><span class="hs-identifier hs-var">null</span></span><span> </span><span class="annot"><span class="annottext">[CoreExpr]
</span><a href="#local-6989586621683122826"><span class="hs-identifier hs-var">args</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-559"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Var -&gt; CoreExpr
forall b. Var -&gt; Expr b
</span><a href="GHC.Core.html#Var"><span class="hs-identifier hs-var">Var</span></a></span><span> </span><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621683122821"><span class="hs-identifier hs-var">f</span></a></span><span> </span><span class="annot"><span class="annottext">CoreExpr -&gt; CoreExpr -&gt; CoreExpr
forall b. Expr b -&gt; Expr b -&gt; Expr b
</span><a href="GHC.Core.html#App"><span class="hs-operator hs-var">`App`</span></a></span><span> </span><span class="annot"><span class="annottext">Mult -&gt; CoreExpr
forall b. Mult -&gt; Expr b
</span><a href="GHC.Core.html#Type"><span class="hs-identifier hs-var">Type</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">HasDebugCallStack =&gt; CoreExpr -&gt; Mult
CoreExpr -&gt; Mult
</span><a href="GHC.Core.Utils.html#exprType"><span class="hs-identifier hs-var">exprType</span></a></span><span> </span><span class="annot"><span class="annottext">CoreExpr
</span><a href="#local-6989586621683122825"><span class="hs-identifier hs-var">fun</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">CoreExpr -&gt; CoreExpr -&gt; CoreExpr
forall b. Expr b -&gt; Expr b -&gt; Expr b
</span><a href="GHC.Core.html#App"><span class="hs-operator hs-var">`App`</span></a></span><span> </span><span class="annot"><span class="annottext">CoreExpr
</span><a href="#local-6989586621683122825"><span class="hs-identifier hs-var">fun</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-560"></span><span>    </span><span class="annot"><span class="annottext">CoreExpr -&gt; [CoreExpr] -&gt; CoreExpr
</span><a href="GHC.Core.Make.html#mkCoreApps"><span class="hs-operator hs-var">`mkCoreApps`</span></a></span><span> </span><span class="annot"><span class="annottext">[CoreExpr]
</span><a href="#local-6989586621683122826"><span class="hs-identifier hs-var">args</span></a></span><span>
</span><span id="line-561"></span><span>
</span><span id="line-562"></span><span class="annot"><a href="GHC.HsToCore.Utils.html#mkCoreAppDs"><span class="hs-identifier hs-var">mkCoreAppDs</span></a></span><span> </span><span id="local-6989586621683122830"><span class="annot"><span class="annottext">SDoc
</span><a href="#local-6989586621683122830"><span class="hs-identifier hs-var">s</span></a></span></span><span> </span><span id="local-6989586621683122831"><span class="annot"><span class="annottext">CoreExpr
</span><a href="#local-6989586621683122831"><span class="hs-identifier hs-var">fun</span></a></span></span><span> </span><span id="local-6989586621683122832"><span class="annot"><span class="annottext">CoreExpr
</span><a href="#local-6989586621683122832"><span class="hs-identifier hs-var">arg</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">SDoc -&gt; CoreExpr -&gt; CoreExpr -&gt; CoreExpr
</span><a href="GHC.Core.Make.html#mkCoreApp"><span class="hs-identifier hs-var">mkCoreApp</span></a></span><span> </span><span class="annot"><span class="annottext">SDoc
</span><a href="#local-6989586621683122830"><span class="hs-identifier hs-var">s</span></a></span><span> </span><span class="annot"><span class="annottext">CoreExpr
</span><a href="#local-6989586621683122831"><span class="hs-identifier hs-var">fun</span></a></span><span> </span><span class="annot"><span class="annottext">CoreExpr
</span><a href="#local-6989586621683122832"><span class="hs-identifier hs-var">arg</span></a></span><span>  </span><span class="hs-comment">-- The rest is done in GHC.Core.Make</span><span>
</span><span id="line-563"></span><span>
</span><span id="line-564"></span><span class="hs-comment">-- NB: No argument can be representation-polymorphic</span><span>
</span><span id="line-565"></span><span class="annot"><a href="GHC.HsToCore.Utils.html#mkCoreAppsDs"><span class="hs-identifier hs-type">mkCoreAppsDs</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Utils.Outputable.html#SDoc"><span class="hs-identifier hs-type">SDoc</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Core.html#CoreExpr"><span class="hs-identifier hs-type">CoreExpr</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="GHC.Core.html#CoreExpr"><span class="hs-identifier hs-type">CoreExpr</span></a></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Core.html#CoreExpr"><span class="hs-identifier hs-type">CoreExpr</span></a></span><span>
</span><span id="line-566"></span><span id="mkCoreAppsDs"><span class="annot"><span class="annottext">mkCoreAppsDs :: SDoc -&gt; CoreExpr -&gt; [CoreExpr] -&gt; CoreExpr
</span><a href="GHC.HsToCore.Utils.html#mkCoreAppsDs"><span class="hs-identifier hs-var hs-var">mkCoreAppsDs</span></a></span></span><span> </span><span id="local-6989586621683122834"><span class="annot"><span class="annottext">SDoc
</span><a href="#local-6989586621683122834"><span class="hs-identifier hs-var">s</span></a></span></span><span> </span><span id="local-6989586621683122835"><span class="annot"><span class="annottext">CoreExpr
</span><a href="#local-6989586621683122835"><span class="hs-identifier hs-var">fun</span></a></span></span><span> </span><span id="local-6989586621683122836"><span class="annot"><span class="annottext">[CoreExpr]
</span><a href="#local-6989586621683122836"><span class="hs-identifier hs-var">args</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(CoreExpr -&gt; CoreExpr -&gt; CoreExpr)
-&gt; CoreExpr -&gt; [CoreExpr] -&gt; CoreExpr
forall b a. (b -&gt; a -&gt; b) -&gt; b -&gt; [a] -&gt; b
forall (t :: * -&gt; *) b a.
Foldable t =&gt;
(b -&gt; a -&gt; b) -&gt; b -&gt; t a -&gt; b
</span><span class="hs-identifier hs-var">foldl'</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">SDoc -&gt; CoreExpr -&gt; CoreExpr -&gt; CoreExpr
</span><a href="GHC.HsToCore.Utils.html#mkCoreAppDs"><span class="hs-identifier hs-var">mkCoreAppDs</span></a></span><span> </span><span class="annot"><span class="annottext">SDoc
</span><a href="#local-6989586621683122834"><span class="hs-identifier hs-var">s</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">CoreExpr
</span><a href="#local-6989586621683122835"><span class="hs-identifier hs-var">fun</span></a></span><span> </span><span class="annot"><span class="annottext">[CoreExpr]
</span><a href="#local-6989586621683122836"><span class="hs-identifier hs-var">args</span></a></span><span>
</span><span id="line-567"></span><span>
</span><span id="line-568"></span><span class="annot"><a href="GHC.HsToCore.Utils.html#mkCastDs"><span class="hs-identifier hs-type">mkCastDs</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Core.html#CoreExpr"><span class="hs-identifier hs-type">CoreExpr</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#Coercion"><span class="hs-identifier hs-type">Coercion</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Core.html#CoreExpr"><span class="hs-identifier hs-type">CoreExpr</span></a></span><span>
</span><span id="line-569"></span><span class="hs-comment">-- We define a desugarer-specific version of GHC.Core.Utils.mkCast,</span><span>
</span><span id="line-570"></span><span class="hs-comment">-- because in the immediate output of the desugarer, we can have</span><span>
</span><span id="line-571"></span><span class="hs-comment">-- apparently-mis-matched coercions:  E.g.</span><span>
</span><span id="line-572"></span><span class="hs-comment">--     let a = b</span><span>
</span><span id="line-573"></span><span class="hs-comment">--     in (x :: a) |&gt; (co :: b ~ Int)</span><span>
</span><span id="line-574"></span><span class="hs-comment">-- Lint know about type-bindings for let and does not complain</span><span>
</span><span id="line-575"></span><span class="hs-comment">-- So here we do not make the assertion checks that we make in</span><span>
</span><span id="line-576"></span><span class="hs-comment">-- GHC.Core.Utils.mkCast; and we do less peephole optimisation too</span><span>
</span><span id="line-577"></span><span id="mkCastDs"><span class="annot"><span class="annottext">mkCastDs :: CoreExpr -&gt; Coercion -&gt; CoreExpr
</span><a href="GHC.HsToCore.Utils.html#mkCastDs"><span class="hs-identifier hs-var hs-var">mkCastDs</span></a></span></span><span> </span><span id="local-6989586621683122838"><span class="annot"><span class="annottext">CoreExpr
</span><a href="#local-6989586621683122838"><span class="hs-identifier hs-var">e</span></a></span></span><span> </span><span id="local-6989586621683122839"><span class="annot"><span class="annottext">Coercion
</span><a href="#local-6989586621683122839"><span class="hs-identifier hs-var">co</span></a></span></span><span> </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Coercion -&gt; Bool
</span><a href="GHC.Core.Coercion.html#isReflCo"><span class="hs-identifier hs-var">isReflCo</span></a></span><span> </span><span class="annot"><span class="annottext">Coercion
</span><a href="#local-6989586621683122839"><span class="hs-identifier hs-var">co</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">CoreExpr
</span><a href="#local-6989586621683122838"><span class="hs-identifier hs-var">e</span></a></span><span>
</span><span id="line-578"></span><span>              </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">otherwise</span></span><span>   </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">CoreExpr -&gt; Coercion -&gt; CoreExpr
forall b. Expr b -&gt; Coercion -&gt; Expr b
</span><a href="GHC.Core.html#Cast"><span class="hs-identifier hs-var">Cast</span></a></span><span> </span><span class="annot"><span class="annottext">CoreExpr
</span><a href="#local-6989586621683122838"><span class="hs-identifier hs-var">e</span></a></span><span> </span><span class="annot"><span class="annottext">Coercion
</span><a href="#local-6989586621683122839"><span class="hs-identifier hs-var">co</span></a></span><span>
</span><span id="line-579"></span><span>
</span><span id="line-580"></span><span class="hs-comment">{-
************************************************************************
*                                                                      *
               Tuples and selector bindings
*                                                                      *
************************************************************************

This is used in various places to do with lazy patterns.
For each binder $b$ in the pattern, we create a binding:
\begin{verbatim}
    b = case v of pat' -&gt; b'
\end{verbatim}
where @pat'@ is @pat@ with each binder @b@ cloned into @b'@.

ToDo: making these bindings should really depend on whether there's
much work to be done per binding.  If the pattern is complex, it
should be de-mangled once, into a tuple (and then selected from).
Otherwise the demangling can be in-line in the bindings (as here).

Boring!  Boring!  One error message per binder.  The above ToDo is
even more helpful.  Something very similar happens for pattern-bound
expressions.

Note [mkSelectorBinds]
~~~~~~~~~~~~~~~~~~~~~~
mkSelectorBinds is used to desugar a pattern binding {p = e},
in a binding group:
  let { ...; p = e; ... } in body
where p binds x,y (this list of binders can be empty).

mkSelectorBinds is also used to desugar irrefutable patterns, which is the
pattern syntax equivalent of a lazy pattern binding:
   f (~(a:as)) = rhs    ==&gt;    f x = let (a:as) = x in rhs

There are three cases.

------ Special case (A) -------
  For a pattern that is just a variable,
     let !x = e in body
  ==&gt;
     let x = e in x `seq` body
  So we return the binding, with 'x' as the variable to seq.

------ Special case (B) -------
  For a pattern that is essentially just a tuple:
      * A product type, so cannot fail
      * Boxed, so that it can be matched lazily
      * Only one level, so that
          - generating multiple matches is fine
          - seq'ing it evaluates the same as matching it
  Then instead we generate
       { v = e
       ; x = case v of p -&gt; x
       ; y = case v of p -&gt; y }
  with 'v' as the variable to force

------ General case (C) -------
  In the general case we generate these bindings:
       let { ...; p = e; ... } in body
  ==&gt;
       let { t = case e of p -&gt; (x,y)
           ; x = case t of (x,y) -&gt; x
           ; y = case t of (x,y) -&gt; y }
       in t `seq` body

  Note that we return 't' as the variable to force if the pattern
  is strict (i.e. with -XStrict or an outermost-bang-pattern)

  Note that (C) /includes/ the situation where

   * The pattern binds exactly one variable
        let !(Just (Just x)) = e in body
     ==&gt;
       let { t = case e of Just (Just v) -&gt; Solo v
           ; v = case t of Solo v -&gt; v }
       in t `seq` body
    The 'Solo' is a one-tuple; see Note [One-tuples] in GHC.Builtin.Types
    Note that forcing 't' makes the pattern match happen,
    but does not force 'v'.  That's why we call `mkBigCoreVarTupSolo`
    in `mkSelectorBinds`

  * The pattern binds no variables
        let !(True,False) = e in body
    ==&gt;
        let t = case e of (True,False) -&gt; ()
        in t `seq` body


------ Examples ----------
  *   !(_, (_, a)) = e
    ==&gt;
      t = case e of (_, (_, a)) -&gt; Solo a
      a = case t of Solo a -&gt; a

    Note that
     - Forcing 't' will force the pattern to match fully;
       e.g. will diverge if (snd e) is bottom
     - But 'a' itself is not forced; it is wrapped in a one-tuple
       (see Note [One-tuples] in GHC.Builtin.Types)

  *   !(Just x) = e
    ==&gt;
      t = case e of Just x -&gt; Solo x
      x = case t of Solo x -&gt; x

    Again, forcing 't' will fail if 'e' yields Nothing.

Note that even though this is rather general, the special cases
work out well:

* One binder, not -XStrict:

    let Just (Just v) = e in body
  ==&gt;
    let t = case e of Just (Just v) -&gt; Solo v
        v = case t of Solo v -&gt; v
    in body
  ==&gt;
    let v = case (case e of Just (Just v) -&gt; Solo v) of
              Solo v -&gt; v
    in body
  ==&gt;
    let v = case e of Just (Just v) -&gt; v
    in body

* Non-recursive, -XStrict
     let p = e in body
  ==&gt;
     let { t = case e of p -&gt; (x,y)
         ; x = case t of (x,y) -&gt; x
         ; y = case t of (x,y) -&gt; x }
     in t `seq` body
  ==&gt; {inline seq, float x,y bindings inwards}
     let t = case e of p -&gt; (x,y) in
     case t of t' -&gt;
     let { x = case t' of (x,y) -&gt; x
         ; y = case t' of (x,y) -&gt; x } in
     body
  ==&gt; {inline t, do case of case}
     case e of p -&gt;
     let t = (x,y) in
     let { x = case t' of (x,y) -&gt; x
         ; y = case t' of (x,y) -&gt; x } in
     body
  ==&gt; {case-cancellation, drop dead code}
     case e of p -&gt; body

* Special case (B) is there to avoid fruitlessly taking the tuple
  apart and rebuilding it. For example, consider
     { K x y = e }
  where K is a product constructor.  Then general case (A) does:
     { t = case e of K x y -&gt; (x,y)
     ; x = case t of (x,y) -&gt; x
     ; y = case t of (x,y) -&gt; y }
  In the lazy case we can't optimise out this fruitless taking apart
  and rebuilding.  Instead (B) builds
     { v = e
     ; x = case v of K x y -&gt; x
     ; y = case v of K x y -&gt; y }
  which is better.
-}</span><span>
</span><span id="line-741"></span><span class="hs-comment">-- Remark: pattern selectors only occur in unrestricted patterns so we are free</span><span>
</span><span id="line-742"></span><span class="hs-comment">-- to select Many as the multiplicity of every let-expression introduced.</span><span>
</span><span id="line-743"></span><span class="annot"><a href="GHC.HsToCore.Utils.html#mkSelectorBinds"><span class="hs-identifier hs-type">mkSelectorBinds</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><span class="hs-special">[</span><span class="annot"><a href="GHC.Types.Tickish.html#CoreTickish"><span class="hs-identifier hs-type">CoreTickish</span></a></span><span class="hs-special">]</span><span class="hs-special">]</span><span>       </span><span class="annot"><span class="hs-comment">-- ^ ticks to add, possibly</span></span><span>
</span><span id="line-744"></span><span>                </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Language.Haskell.Syntax.Pat.html#LPat"><span class="hs-identifier hs-type">LPat</span></a></span><span> </span><span class="annot"><a href="GHC.Hs.Extension.html#GhcTc"><span class="hs-identifier hs-type">GhcTc</span></a></span><span>            </span><span class="annot"><span class="hs-comment">-- ^ The pattern</span></span><span>
</span><span id="line-745"></span><span>                </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Hs.Expr.html#HsMatchContextRn"><span class="hs-identifier hs-type">HsMatchContextRn</span></a></span><span>      </span><span class="annot"><span class="hs-comment">-- ^ Where the pattern occurs</span></span><span>
</span><span id="line-746"></span><span>                </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Core.html#CoreExpr"><span class="hs-identifier hs-type">CoreExpr</span></a></span><span>              </span><span class="annot"><span class="hs-comment">-- ^ Expression to which the pattern is bound</span></span><span>
</span><span id="line-747"></span><span>                </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.HsToCore.Types.html#DsM"><span class="hs-identifier hs-type">DsM</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Types.Var.html#Id"><span class="hs-identifier hs-type">Id</span></a></span><span class="hs-special">,</span><span class="hs-special">[</span><span class="hs-special">(</span><span class="annot"><a href="GHC.Types.Var.html#Id"><span class="hs-identifier hs-type">Id</span></a></span><span class="hs-special">,</span><span class="annot"><a href="GHC.Core.html#CoreExpr"><span class="hs-identifier hs-type">CoreExpr</span></a></span><span class="hs-special">)</span><span class="hs-special">]</span><span class="hs-special">)</span><span>
</span><span id="line-748"></span><span>                </span><span class="hs-comment">-- ^ Id the rhs is bound to, for desugaring strict</span><span>
</span><span id="line-749"></span><span>                </span><span class="hs-comment">-- binds (see Note [Desugar Strict binds] in &quot;GHC.HsToCore.Binds&quot;)</span><span>
</span><span id="line-750"></span><span>                </span><span class="hs-comment">-- and all the desugared binds</span><span>
</span><span id="line-751"></span><span>
</span><span id="line-752"></span><span id="mkSelectorBinds"><span class="annot"><span class="annottext">mkSelectorBinds :: [[CoreTickish]]
-&gt; XRec GhcTc (Pat GhcTc)
-&gt; HsMatchContextRn
-&gt; CoreExpr
-&gt; DsM (Var, [(Var, CoreExpr)])
</span><a href="GHC.HsToCore.Utils.html#mkSelectorBinds"><span class="hs-identifier hs-var hs-var">mkSelectorBinds</span></a></span></span><span> </span><span id="local-6989586621683122842"><span class="annot"><span class="annottext">[[CoreTickish]]
</span><a href="#local-6989586621683122842"><span class="hs-identifier hs-var">ticks</span></a></span></span><span> </span><span id="local-6989586621683122843"><span class="annot"><span class="annottext">XRec GhcTc (Pat GhcTc)
</span><a href="#local-6989586621683122843"><span class="hs-identifier hs-var">pat</span></a></span></span><span> </span><span id="local-6989586621683122844"><span class="annot"><span class="annottext">HsMatchContextRn
</span><a href="#local-6989586621683122844"><span class="hs-identifier hs-var">ctx</span></a></span></span><span> </span><span id="local-6989586621683122845"><span class="annot"><span class="annottext">CoreExpr
</span><a href="#local-6989586621683122845"><span class="hs-identifier hs-var">val_expr</span></a></span></span><span>
</span><span id="line-753"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span class="annot"><a href="GHC.Types.SrcLoc.html#L"><span class="hs-identifier hs-type">L</span></a></span><span> </span><span class="annot"><span class="annottext">SrcSpanAnnA
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Language.Haskell.Syntax.Pat.html#VarPat"><span class="hs-identifier hs-type">VarPat</span></a></span><span> </span><span class="annot"><span class="annottext">XVarPat GhcTc
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Types.SrcLoc.html#L"><span class="hs-identifier hs-type">L</span></a></span><span> </span><span class="annot"><span class="annottext">SrcSpanAnnN
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621683122847"><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621683122847"><span class="hs-identifier hs-var">v</span></a></span></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">XRec GhcTc (Pat GhcTc)
</span><a href="#local-6989586621683122848"><span class="hs-identifier hs-var">pat'</span></a></span><span>     </span><span class="hs-comment">-- Special case (A)</span><span>
</span><span id="line-754"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(Var, [(Var, CoreExpr)]) -&gt; DsM (Var, [(Var, CoreExpr)])
forall a. a -&gt; IOEnv (Env DsGblEnv DsLclEnv) a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621683122847"><span class="hs-identifier hs-var">v</span></a></span><span class="hs-special">,</span><span> </span><span class="hs-special">[</span><span class="hs-special">(</span><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621683122847"><span class="hs-identifier hs-var">v</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">CoreExpr
</span><a href="#local-6989586621683122845"><span class="hs-identifier hs-var">val_expr</span></a></span><span class="hs-special">)</span><span class="hs-special">]</span><span class="hs-special">)</span><span>
</span><span id="line-755"></span><span>
</span><span id="line-756"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">XRec GhcTc (Pat GhcTc) -&gt; Bool
</span><a href="GHC.HsToCore.Utils.html#is_flat_prod_lpat"><span class="hs-identifier hs-var">is_flat_prod_lpat</span></a></span><span> </span><span class="annot"><span class="annottext">XRec GhcTc (Pat GhcTc)
</span><a href="#local-6989586621683122848"><span class="hs-identifier hs-var">pat'</span></a></span><span>           </span><span class="hs-comment">-- Special case (B)</span><span>
</span><span id="line-757"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621683122850"><span class="annot"><span class="annottext">pat_ty :: Mult
</span><a href="#local-6989586621683122850"><span class="hs-identifier hs-var hs-var hs-var">pat_ty</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">XRec GhcTc (Pat GhcTc) -&gt; Mult
</span><a href="GHC.Hs.Syn.Type.html#hsLPatType"><span class="hs-identifier hs-var">hsLPatType</span></a></span><span> </span><span class="annot"><span class="annottext">XRec GhcTc (Pat GhcTc)
</span><a href="#local-6989586621683122848"><span class="hs-identifier hs-var">pat'</span></a></span><span>
</span><span id="line-758"></span><span>       </span><span class="hs-special">;</span><span> </span><span id="local-6989586621683122852"><span class="annot"><a href="#local-6989586621683122852"><span class="hs-identifier hs-var">val_var</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Mult -&gt; DsM Var
</span><a href="GHC.HsToCore.Monad.html#newSysLocalMDs"><span class="hs-identifier hs-var">newSysLocalMDs</span></a></span><span> </span><span class="annot"><span class="annottext">Mult
</span><a href="#local-6989586621683122850"><span class="hs-identifier hs-var">pat_ty</span></a></span><span>
</span><span id="line-759"></span><span>
</span><span id="line-760"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621683122854"><span class="annot"><a href="#local-6989586621683122854"><span class="hs-identifier hs-var hs-var">mk_bind</span></a></span></span><span> </span><span id="local-6989586621683122855"><span class="annot"><span class="annottext">[CoreTickish]
</span><a href="#local-6989586621683122855"><span class="hs-identifier hs-var">tick</span></a></span></span><span> </span><span id="local-6989586621683122856"><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621683122856"><span class="hs-identifier hs-var">bndr_var</span></a></span></span><span>
</span><span id="line-761"></span><span>               </span><span class="hs-comment">-- (mk_bind sv bv)  generates  bv = case sv of { pat -&gt; bv }</span><span>
</span><span id="line-762"></span><span>               </span><span class="hs-comment">-- Remember, 'pat' binds 'bv'</span><span>
</span><span id="line-763"></span><span>               </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span id="local-6989586621683122857"><span class="annot"><a href="#local-6989586621683122857"><span class="hs-identifier hs-var">rhs_expr</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">CoreExpr
-&gt; HsMatchContextRn
-&gt; Mult
-&gt; XRec GhcTc (Pat GhcTc)
-&gt; CoreExpr
-&gt; CoreExpr
-&gt; DsM CoreExpr
</span><a href="GHC.HsToCore.Match.html#matchSimply"><span class="hs-identifier hs-var">matchSimply</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Var -&gt; CoreExpr
forall b. Var -&gt; Expr b
</span><a href="GHC.Core.html#Var"><span class="hs-identifier hs-var">Var</span></a></span><span> </span><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621683122852"><span class="hs-identifier hs-var">val_var</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">HsMatchContextRn
</span><a href="#local-6989586621683122844"><span class="hs-identifier hs-var">ctx</span></a></span><span> </span><span class="annot"><span class="annottext">Mult
</span><a href="GHC.Core.Type.html#ManyTy"><span class="hs-identifier hs-var">ManyTy</span></a></span><span> </span><span class="annot"><span class="annottext">XRec GhcTc (Pat GhcTc)
</span><a href="#local-6989586621683122848"><span class="hs-identifier hs-var">pat'</span></a></span><span>
</span><span id="line-764"></span><span>                                       </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Var -&gt; CoreExpr
forall b. Var -&gt; Expr b
</span><a href="GHC.Core.html#Var"><span class="hs-identifier hs-var">Var</span></a></span><span> </span><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621683122856"><span class="hs-identifier hs-var">bndr_var</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-765"></span><span>                                       </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Var -&gt; CoreExpr
forall b. Var -&gt; Expr b
</span><a href="GHC.Core.html#Var"><span class="hs-identifier hs-var">Var</span></a></span><span> </span><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621683122856"><span class="hs-identifier hs-var">bndr_var</span></a></span><span class="hs-special">)</span><span>  </span><span class="hs-comment">-- Neat hack</span><span>
</span><span id="line-766"></span><span>                      </span><span class="hs-comment">-- Neat hack: since 'pat' can't fail, the</span><span>
</span><span id="line-767"></span><span>                      </span><span class="hs-comment">-- &quot;fail-expr&quot; passed to matchSimply is not</span><span>
</span><span id="line-768"></span><span>                      </span><span class="hs-comment">-- used. But it /is/ used for its type, and for</span><span>
</span><span id="line-769"></span><span>                      </span><span class="hs-comment">-- that bndr_var is just the ticket.</span><span>
</span><span id="line-770"></span><span>                    </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">return</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621683122856"><span class="hs-identifier hs-type">bndr_var</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.HsToCore.Utils.html#mkOptTickBox"><span class="hs-identifier hs-type">mkOptTickBox</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683122855"><span class="hs-identifier hs-type">tick</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683122857"><span class="hs-identifier hs-type">rhs_expr</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-771"></span><span>
</span><span id="line-772"></span><span>       </span><span class="hs-special">;</span><span> </span><span id="local-6989586621683122858"><span class="annot"><a href="#local-6989586621683122858"><span class="hs-identifier hs-var">binds</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="hs-identifier hs-type">zipWithM</span></span><span> </span><span class="annot"><a href="#local-6989586621683122854"><span class="hs-identifier hs-type">mk_bind</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683122859"><span class="hs-identifier hs-type">ticks'</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683122860"><span class="hs-identifier hs-type">binders</span></a></span><span>
</span><span id="line-773"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">return</span></span><span> </span><span class="hs-special">(</span><span> </span><span class="annot"><a href="#local-6989586621683122852"><span class="hs-identifier hs-type">val_var</span></a></span><span class="hs-special">,</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621683122852"><span class="hs-identifier hs-type">val_var</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="#local-6989586621683122845"><span class="hs-identifier hs-type">val_expr</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="hs-glyph hs-type">:</span></span><span> </span><span class="annot"><a href="#local-6989586621683122858"><span class="hs-identifier hs-type">binds</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-774"></span><span>
</span><span id="line-775"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">otherwise</span></span><span>                          </span><span class="hs-comment">-- General case (C)</span><span>
</span><span id="line-776"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span id="local-6989586621683122861"><span class="annot"><a href="#local-6989586621683122861"><span class="hs-identifier hs-var">tuple_var</span></a></span></span><span>  </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Mult -&gt; DsM Var
</span><a href="GHC.HsToCore.Monad.html#newSysLocalMDs"><span class="hs-identifier hs-var">newSysLocalMDs</span></a></span><span> </span><span class="annot"><span class="annottext">Mult
</span><a href="#local-6989586621683122862"><span class="hs-identifier hs-var">tuple_ty</span></a></span><span>
</span><span id="line-777"></span><span>       </span><span class="hs-special">;</span><span> </span><span id="local-6989586621683122863"><span class="annot"><a href="#local-6989586621683122863"><span class="hs-identifier hs-var">error_expr</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><a href="GHC.HsToCore.Utils.html#mkErrorAppDs"><span class="hs-identifier hs-type">mkErrorAppDs</span></a></span><span> </span><span class="annot"><a href="GHC.Core.Make.html#pAT_ERROR_ID"><span class="hs-identifier hs-type">pAT_ERROR_ID</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683122862"><span class="hs-identifier hs-type">tuple_ty</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-type">ppr</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683122848"><span class="hs-identifier hs-type">pat'</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-778"></span><span>       </span><span class="hs-special">;</span><span> </span><span id="local-6989586621683122864"><span class="annot"><a href="#local-6989586621683122864"><span class="hs-identifier hs-var">tuple_expr</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><a href="GHC.HsToCore.Match.html#matchSimply"><span class="hs-identifier hs-type">matchSimply</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683122845"><span class="hs-identifier hs-type">val_expr</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683122844"><span class="hs-identifier hs-type">ctx</span></a></span><span> </span><span class="annot"><a href="GHC.Core.Type.html#ManyTy"><span class="hs-identifier hs-type">ManyTy</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683122843"><span class="hs-identifier hs-type">pat</span></a></span><span>
</span><span id="line-779"></span><span>                                   </span><span class="annot"><a href="#local-6989586621683122865"><span class="hs-identifier hs-type">local_tuple</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683122863"><span class="hs-identifier hs-type">error_expr</span></a></span><span>
</span><span id="line-780"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621683122866"><span class="annot"><a href="#local-6989586621683122866"><span class="hs-identifier hs-var hs-var">mk_tup_bind</span></a></span></span><span> </span><span id="local-6989586621683122867"><span class="annot"><span class="annottext">[CoreTickish]
</span><a href="#local-6989586621683122867"><span class="hs-identifier hs-var">tick</span></a></span></span><span> </span><span id="local-6989586621683122868"><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621683122868"><span class="hs-identifier hs-var">binder</span></a></span></span><span>
</span><span id="line-781"></span><span>               </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621683122868"><span class="hs-identifier hs-var">binder</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">[CoreTickish] -&gt; CoreExpr -&gt; CoreExpr
</span><a href="GHC.HsToCore.Utils.html#mkOptTickBox"><span class="hs-identifier hs-var">mkOptTickBox</span></a></span><span> </span><span class="annot"><span class="annottext">[CoreTickish]
</span><a href="#local-6989586621683122867"><span class="hs-identifier hs-var">tick</span></a></span><span> </span><span class="annot"><span class="annottext">(CoreExpr -&gt; CoreExpr) -&gt; CoreExpr -&gt; CoreExpr
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-782"></span><span>                          </span><span class="annot"><span class="annottext">[Var] -&gt; Var -&gt; Var -&gt; CoreExpr -&gt; CoreExpr
</span><a href="GHC.Core.Make.html#mkBigTupleSelectorSolo"><span class="hs-identifier hs-var">mkBigTupleSelectorSolo</span></a></span><span> </span><span class="annot"><span class="annottext">[Var]
</span><a href="#local-6989586621683122870"><span class="hs-identifier hs-var">local_binders</span></a></span><span> </span><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621683122868"><span class="hs-identifier hs-var">binder</span></a></span><span>
</span><span id="line-783"></span><span>                                           </span><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621683122861"><span class="hs-identifier hs-var">tuple_var</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Var -&gt; CoreExpr
forall b. Var -&gt; Expr b
</span><a href="GHC.Core.html#Var"><span class="hs-identifier hs-var">Var</span></a></span><span> </span><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621683122861"><span class="hs-identifier hs-var">tuple_var</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-784"></span><span>             </span><span id="local-6989586621683122871"><span class="annot"><a href="#local-6989586621683122871"><span class="hs-identifier hs-var hs-var">tup_binds</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">([CoreTickish] -&gt; Var -&gt; (Var, CoreExpr))
-&gt; [[CoreTickish]] -&gt; [Var] -&gt; [(Var, CoreExpr)]
forall a b c. (a -&gt; b -&gt; c) -&gt; [a] -&gt; [b] -&gt; [c]
</span><span class="hs-identifier hs-var">zipWith</span></span><span> </span><span class="annot"><span class="annottext">[CoreTickish] -&gt; Var -&gt; (Var, CoreExpr)
</span><a href="#local-6989586621683122866"><span class="hs-identifier hs-var">mk_tup_bind</span></a></span><span> </span><span class="annot"><span class="annottext">[[CoreTickish]]
</span><a href="#local-6989586621683122859"><span class="hs-identifier hs-var">ticks'</span></a></span><span> </span><span class="annot"><span class="annottext">[IdP GhcTc]
[Var]
</span><a href="#local-6989586621683122860"><span class="hs-identifier hs-var">binders</span></a></span><span>
</span><span id="line-785"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">return</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621683122861"><span class="hs-identifier hs-type">tuple_var</span></a></span><span class="hs-special">,</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621683122861"><span class="hs-identifier hs-type">tuple_var</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="#local-6989586621683122864"><span class="hs-identifier hs-type">tuple_expr</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="hs-glyph hs-type">:</span></span><span> </span><span class="annot"><a href="#local-6989586621683122871"><span class="hs-identifier hs-type">tup_binds</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-786"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-787"></span><span>    </span><span id="local-6989586621683122848"><span class="annot"><span class="annottext">pat' :: XRec GhcTc (Pat GhcTc)
</span><a href="#local-6989586621683122848"><span class="hs-identifier hs-var hs-var">pat'</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">XRec GhcTc (Pat GhcTc) -&gt; XRec GhcTc (Pat GhcTc)
forall (p :: Pass). LPat (GhcPass p) -&gt; LPat (GhcPass p)
</span><a href="GHC.HsToCore.Utils.html#strip_bangs"><span class="hs-identifier hs-var">strip_bangs</span></a></span><span> </span><span class="annot"><span class="annottext">XRec GhcTc (Pat GhcTc)
</span><a href="#local-6989586621683122843"><span class="hs-identifier hs-var">pat</span></a></span><span>
</span><span id="line-788"></span><span>           </span><span class="hs-comment">-- Strip the bangs before looking for case (A) or (B)</span><span>
</span><span id="line-789"></span><span>           </span><span class="hs-comment">-- The incoming pattern may well have a bang on it</span><span>
</span><span id="line-790"></span><span>
</span><span id="line-791"></span><span>    </span><span id="local-6989586621683122860"><span class="annot"><span class="annottext">binders :: [IdP GhcTc]
</span><a href="#local-6989586621683122860"><span class="hs-identifier hs-var hs-var">binders</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">CollectFlag GhcTc -&gt; XRec GhcTc (Pat GhcTc) -&gt; [IdP GhcTc]
forall p. CollectPass p =&gt; CollectFlag p -&gt; LPat p -&gt; [IdP p]
</span><a href="GHC.Hs.Utils.html#collectPatBinders"><span class="hs-identifier hs-var">collectPatBinders</span></a></span><span> </span><span class="annot"><span class="annottext">CollectFlag GhcTc
forall p. CollectFlag p
</span><a href="GHC.Hs.Utils.html#CollNoDictBinders"><span class="hs-identifier hs-var">CollNoDictBinders</span></a></span><span> </span><span class="annot"><span class="annottext">XRec GhcTc (Pat GhcTc)
</span><a href="#local-6989586621683122848"><span class="hs-identifier hs-var">pat'</span></a></span><span>
</span><span id="line-792"></span><span>    </span><span id="local-6989586621683122859"><span class="annot"><span class="annottext">ticks' :: [[CoreTickish]]
</span><a href="#local-6989586621683122859"><span class="hs-identifier hs-var hs-var">ticks'</span></a></span></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[[CoreTickish]]
</span><a href="#local-6989586621683122842"><span class="hs-identifier hs-var">ticks</span></a></span><span> </span><span class="annot"><span class="annottext">[[CoreTickish]] -&gt; [[CoreTickish]] -&gt; [[CoreTickish]]
forall a. [a] -&gt; [a] -&gt; [a]
</span><span class="hs-operator hs-var">++</span></span><span> </span><span class="annot"><span class="annottext">[CoreTickish] -&gt; [[CoreTickish]]
forall a. a -&gt; [a]
</span><span class="hs-identifier hs-var">repeat</span></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span>
</span><span id="line-793"></span><span>
</span><span id="line-794"></span><span>    </span><span id="local-6989586621683122870"><span class="annot"><span class="annottext">local_binders :: [Var]
</span><a href="#local-6989586621683122870"><span class="hs-identifier hs-var hs-var">local_binders</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(Var -&gt; Var) -&gt; [Var] -&gt; [Var]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><span class="hs-identifier hs-var">map</span></span><span> </span><span class="annot"><span class="annottext">Var -&gt; Var
</span><a href="GHC.Types.Id.html#localiseId"><span class="hs-identifier hs-var">localiseId</span></a></span><span> </span><span class="annot"><span class="annottext">[IdP GhcTc]
[Var]
</span><a href="#local-6989586621683122860"><span class="hs-identifier hs-var">binders</span></a></span><span>      </span><span class="hs-comment">-- See Note [Localise pattern binders]</span><span>
</span><span id="line-795"></span><span>    </span><span id="local-6989586621683122865"><span class="annot"><span class="annottext">local_tuple :: CoreExpr
</span><a href="#local-6989586621683122865"><span class="hs-identifier hs-var hs-var">local_tuple</span></a></span></span><span>   </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[Var] -&gt; CoreExpr
</span><a href="GHC.Core.Make.html#mkBigCoreVarTupSolo"><span class="hs-identifier hs-var">mkBigCoreVarTupSolo</span></a></span><span> </span><span class="annot"><span class="annottext">[IdP GhcTc]
[Var]
</span><a href="#local-6989586621683122860"><span class="hs-identifier hs-var">binders</span></a></span><span>
</span><span id="line-796"></span><span>    </span><span id="local-6989586621683122862"><span class="annot"><span class="annottext">tuple_ty :: Mult
</span><a href="#local-6989586621683122862"><span class="hs-identifier hs-var hs-var">tuple_ty</span></a></span></span><span>      </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">HasDebugCallStack =&gt; CoreExpr -&gt; Mult
CoreExpr -&gt; Mult
</span><a href="GHC.Core.Utils.html#exprType"><span class="hs-identifier hs-var">exprType</span></a></span><span> </span><span class="annot"><span class="annottext">CoreExpr
</span><a href="#local-6989586621683122865"><span class="hs-identifier hs-var">local_tuple</span></a></span><span>
</span><span id="line-797"></span><span>
</span><span id="line-798"></span><span id="local-6989586621683122254"><span class="annot"><a href="GHC.HsToCore.Utils.html#strip_bangs"><span class="hs-identifier hs-type">strip_bangs</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Language.Haskell.Syntax.Pat.html#LPat"><span class="hs-identifier hs-type">LPat</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Hs.Extension.html#GhcPass"><span class="hs-identifier hs-type">GhcPass</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683122254"><span class="hs-identifier hs-type">p</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Language.Haskell.Syntax.Pat.html#LPat"><span class="hs-identifier hs-type">LPat</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Hs.Extension.html#GhcPass"><span class="hs-identifier hs-type">GhcPass</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683122254"><span class="hs-identifier hs-type">p</span></a></span><span class="hs-special">)</span></span><span>
</span><span id="line-799"></span><span class="hs-comment">-- Remove outermost bangs and parens</span><span>
</span><span id="line-800"></span><span id="strip_bangs"><span class="annot"><span class="annottext">strip_bangs :: forall (p :: Pass). LPat (GhcPass p) -&gt; LPat (GhcPass p)
</span><a href="GHC.HsToCore.Utils.html#strip_bangs"><span class="hs-identifier hs-var hs-var">strip_bangs</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Types.SrcLoc.html#L"><span class="hs-identifier hs-type">L</span></a></span><span> </span><span class="annot"><span class="annottext">SrcSpanAnnA
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Language.Haskell.Syntax.Pat.html#ParPat"><span class="hs-identifier hs-type">ParPat</span></a></span><span> </span><span class="annot"><span class="annottext">XParPat (GhcPass p)
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621683122878"><span class="annot"><span class="annottext">LPat (GhcPass p)
</span><a href="#local-6989586621683122878"><span class="hs-identifier hs-var">p</span></a></span></span><span class="hs-special">)</span><span class="hs-special">)</span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">LPat (GhcPass p) -&gt; LPat (GhcPass p)
forall (p :: Pass). LPat (GhcPass p) -&gt; LPat (GhcPass p)
</span><a href="GHC.HsToCore.Utils.html#strip_bangs"><span class="hs-identifier hs-var">strip_bangs</span></a></span><span> </span><span class="annot"><span class="annottext">LPat (GhcPass p)
</span><a href="#local-6989586621683122878"><span class="hs-identifier hs-var">p</span></a></span><span>
</span><span id="line-801"></span><span class="annot"><a href="GHC.HsToCore.Utils.html#strip_bangs"><span class="hs-identifier hs-var">strip_bangs</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Types.SrcLoc.html#L"><span class="hs-identifier hs-type">L</span></a></span><span> </span><span class="annot"><span class="annottext">SrcSpanAnnA
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Language.Haskell.Syntax.Pat.html#BangPat"><span class="hs-identifier hs-type">BangPat</span></a></span><span> </span><span class="annot"><span class="annottext">XBangPat (GhcPass p)
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621683122879"><span class="annot"><span class="annottext">LPat (GhcPass p)
</span><a href="#local-6989586621683122879"><span class="hs-identifier hs-var">p</span></a></span></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">LPat (GhcPass p) -&gt; LPat (GhcPass p)
forall (p :: Pass). LPat (GhcPass p) -&gt; LPat (GhcPass p)
</span><a href="GHC.HsToCore.Utils.html#strip_bangs"><span class="hs-identifier hs-var">strip_bangs</span></a></span><span> </span><span class="annot"><span class="annottext">LPat (GhcPass p)
</span><a href="#local-6989586621683122879"><span class="hs-identifier hs-var">p</span></a></span><span>
</span><span id="line-802"></span><span class="annot"><a href="GHC.HsToCore.Utils.html#strip_bangs"><span class="hs-identifier hs-var">strip_bangs</span></a></span><span> </span><span id="local-6989586621683122880"><span class="annot"><span class="annottext">LPat (GhcPass p)
</span><a href="#local-6989586621683122880"><span class="hs-identifier hs-var">lp</span></a></span></span><span>                  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">LPat (GhcPass p)
</span><a href="#local-6989586621683122880"><span class="hs-identifier hs-var">lp</span></a></span><span>
</span><span id="line-803"></span><span>
</span><span id="line-804"></span><span class="annot"><a href="GHC.HsToCore.Utils.html#is_flat_prod_lpat"><span class="hs-identifier hs-type">is_flat_prod_lpat</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Language.Haskell.Syntax.Pat.html#LPat"><span class="hs-identifier hs-type">LPat</span></a></span><span> </span><span class="annot"><a href="GHC.Hs.Extension.html#GhcTc"><span class="hs-identifier hs-type">GhcTc</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Bool</span></span><span>
</span><span id="line-805"></span><span class="hs-comment">-- Pattern is equivalent to a flat, boxed, lifted tuple</span><span>
</span><span id="line-806"></span><span id="is_flat_prod_lpat"><span class="annot"><span class="annottext">is_flat_prod_lpat :: XRec GhcTc (Pat GhcTc) -&gt; Bool
</span><a href="GHC.HsToCore.Utils.html#is_flat_prod_lpat"><span class="hs-identifier hs-var hs-var">is_flat_prod_lpat</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Pat GhcTc -&gt; Bool
</span><a href="GHC.HsToCore.Utils.html#is_flat_prod_pat"><span class="hs-identifier hs-var">is_flat_prod_pat</span></a></span><span> </span><span class="annot"><span class="annottext">(Pat GhcTc -&gt; Bool)
-&gt; (GenLocated SrcSpanAnnA (Pat GhcTc) -&gt; Pat GhcTc)
-&gt; GenLocated SrcSpanAnnA (Pat GhcTc)
-&gt; Bool
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">GenLocated SrcSpanAnnA (Pat GhcTc) -&gt; Pat GhcTc
forall l e. GenLocated l e -&gt; e
</span><a href="GHC.Types.SrcLoc.html#unLoc"><span class="hs-identifier hs-var">unLoc</span></a></span><span>
</span><span id="line-807"></span><span>
</span><span id="line-808"></span><span class="annot"><a href="GHC.HsToCore.Utils.html#is_flat_prod_pat"><span class="hs-identifier hs-type">is_flat_prod_pat</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Language.Haskell.Syntax.Pat.html#Pat"><span class="hs-identifier hs-type">Pat</span></a></span><span> </span><span class="annot"><a href="GHC.Hs.Extension.html#GhcTc"><span class="hs-identifier hs-type">GhcTc</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Bool</span></span><span>
</span><span id="line-809"></span><span id="is_flat_prod_pat"><span class="annot"><span class="annottext">is_flat_prod_pat :: Pat GhcTc -&gt; Bool
</span><a href="GHC.HsToCore.Utils.html#is_flat_prod_pat"><span class="hs-identifier hs-var hs-var">is_flat_prod_pat</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Language.Haskell.Syntax.Pat.html#ParPat"><span class="hs-identifier hs-type">ParPat</span></a></span><span> </span><span class="annot"><span class="annottext">XParPat GhcTc
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621683122882"><span class="annot"><span class="annottext">XRec GhcTc (Pat GhcTc)
</span><a href="#local-6989586621683122882"><span class="hs-identifier hs-var">p</span></a></span></span><span class="hs-special">)</span><span>          </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">XRec GhcTc (Pat GhcTc) -&gt; Bool
</span><a href="GHC.HsToCore.Utils.html#is_flat_prod_lpat"><span class="hs-identifier hs-var">is_flat_prod_lpat</span></a></span><span> </span><span class="annot"><span class="annottext">XRec GhcTc (Pat GhcTc)
</span><a href="#local-6989586621683122882"><span class="hs-identifier hs-var">p</span></a></span><span>
</span><span id="line-810"></span><span class="annot"><a href="GHC.HsToCore.Utils.html#is_flat_prod_pat"><span class="hs-identifier hs-var">is_flat_prod_pat</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Language.Haskell.Syntax.Pat.html#TuplePat"><span class="hs-identifier hs-type">TuplePat</span></a></span><span> </span><span class="annot"><span class="annottext">XTuplePat GhcTc
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621683122884"><span class="annot"><span class="annottext">[XRec GhcTc (Pat GhcTc)]
</span><a href="#local-6989586621683122884"><span class="hs-identifier hs-var">ps</span></a></span></span><span> </span><span class="annot"><span class="annottext">Boxity
</span><a href="Language.Haskell.Syntax.Basic.html#Boxed"><span class="hs-identifier hs-var">Boxed</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(GenLocated SrcSpanAnnA (Pat GhcTc) -&gt; Bool)
-&gt; [GenLocated SrcSpanAnnA (Pat GhcTc)] -&gt; Bool
forall (t :: * -&gt; *) a. Foldable t =&gt; (a -&gt; Bool) -&gt; t a -&gt; Bool
</span><span class="hs-identifier hs-var">all</span></span><span> </span><span class="annot"><span class="annottext">XRec GhcTc (Pat GhcTc) -&gt; Bool
GenLocated SrcSpanAnnA (Pat GhcTc) -&gt; Bool
forall (p :: Pass). LPat (GhcPass p) -&gt; Bool
</span><a href="GHC.HsToCore.Utils.html#is_triv_lpat"><span class="hs-identifier hs-var">is_triv_lpat</span></a></span><span> </span><span class="annot"><span class="annottext">[XRec GhcTc (Pat GhcTc)]
[GenLocated SrcSpanAnnA (Pat GhcTc)]
</span><a href="#local-6989586621683122884"><span class="hs-identifier hs-var">ps</span></a></span><span>
</span><span id="line-811"></span><span class="annot"><a href="GHC.HsToCore.Utils.html#is_flat_prod_pat"><span class="hs-identifier hs-var">is_flat_prod_pat</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Language.Haskell.Syntax.Pat.html#ConPat"><span class="hs-identifier hs-type">ConPat</span></a></span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">pat_con :: forall p. Pat p -&gt; XRec p (ConLikeP p)
</span><a href="Language.Haskell.Syntax.Pat.html#pat_con"><span class="hs-identifier hs-var">pat_con</span></a></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="GHC.Types.SrcLoc.html#L"><span class="hs-identifier hs-type">L</span></a></span><span> </span><span class="annot"><span class="annottext">SrcSpanAnnN
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621683122890"><span class="annot"><span class="annottext">ConLike
</span><a href="#local-6989586621683122890"><span class="hs-identifier hs-var">pcon</span></a></span></span><span>
</span><span id="line-812"></span><span>                         </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">pat_args :: forall p. Pat p -&gt; HsConPatDetails p
</span><a href="Language.Haskell.Syntax.Pat.html#pat_args"><span class="hs-identifier hs-var">pat_args</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="local-6989586621683122892"><span class="annot"><span class="annottext">HsConPatDetails GhcTc
</span><a href="#local-6989586621683122892"><span class="hs-identifier hs-var">ps</span></a></span></span><span class="hs-special">}</span><span class="hs-special">)</span><span>
</span><span id="line-813"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span class="annot"><a href="GHC.Core.ConLike.html#RealDataCon"><span class="hs-identifier hs-type">RealDataCon</span></a></span><span> </span><span id="local-6989586621683122894"><span class="annot"><span class="annottext">DataCon
</span><a href="#local-6989586621683122894"><span class="hs-identifier hs-var">con</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">ConLike
</span><a href="#local-6989586621683122890"><span class="hs-identifier hs-var">pcon</span></a></span><span>
</span><span id="line-814"></span><span>  </span><span class="hs-special">,</span><span> </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621683122895"><span class="annot"><span class="annottext">tc :: TyCon
</span><a href="#local-6989586621683122895"><span class="hs-identifier hs-var hs-var">tc</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">DataCon -&gt; TyCon
</span><a href="GHC.Core.DataCon.html#dataConTyCon"><span class="hs-identifier hs-var">dataConTyCon</span></a></span><span> </span><span class="annot"><span class="annottext">DataCon
</span><a href="#local-6989586621683122894"><span class="hs-identifier hs-var">con</span></a></span><span>
</span><span id="line-815"></span><span>  </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span class="annot"><span class="annottext">DataCon
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">TyCon -&gt; Maybe DataCon
</span><a href="GHC.Core.TyCon.html#tyConSingleDataCon_maybe"><span class="hs-identifier hs-var">tyConSingleDataCon_maybe</span></a></span><span> </span><span class="annot"><span class="annottext">TyCon
</span><a href="#local-6989586621683122895"><span class="hs-identifier hs-var">tc</span></a></span><span>
</span><span id="line-816"></span><span>  </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">TyCon -&gt; Bool
</span><a href="GHC.Core.TyCon.html#isLiftedAlgTyCon"><span class="hs-identifier hs-var">isLiftedAlgTyCon</span></a></span><span> </span><span class="annot"><span class="annottext">TyCon
</span><a href="#local-6989586621683122895"><span class="hs-identifier hs-var">tc</span></a></span><span>
</span><span id="line-817"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(GenLocated SrcSpanAnnA (Pat GhcTc) -&gt; Bool)
-&gt; [GenLocated SrcSpanAnnA (Pat GhcTc)] -&gt; Bool
forall (t :: * -&gt; *) a. Foldable t =&gt; (a -&gt; Bool) -&gt; t a -&gt; Bool
</span><span class="hs-identifier hs-var">all</span></span><span> </span><span class="annot"><span class="annottext">XRec GhcTc (Pat GhcTc) -&gt; Bool
GenLocated SrcSpanAnnA (Pat GhcTc) -&gt; Bool
forall (p :: Pass). LPat (GhcPass p) -&gt; Bool
</span><a href="GHC.HsToCore.Utils.html#is_triv_lpat"><span class="hs-identifier hs-var">is_triv_lpat</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">HsConPatDetails GhcTc -&gt; [XRec GhcTc (Pat GhcTc)]
forall p. UnXRec p =&gt; HsConPatDetails p -&gt; [LPat p]
</span><a href="Language.Haskell.Syntax.Pat.html#hsConPatArgs"><span class="hs-identifier hs-var">hsConPatArgs</span></a></span><span> </span><span class="annot"><span class="annottext">HsConPatDetails GhcTc
</span><a href="#local-6989586621683122892"><span class="hs-identifier hs-var">ps</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-818"></span><span class="annot"><a href="GHC.HsToCore.Utils.html#is_flat_prod_pat"><span class="hs-identifier hs-var">is_flat_prod_pat</span></a></span><span> </span><span class="annot"><span class="annottext">Pat GhcTc
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">False</span></span><span>
</span><span id="line-819"></span><span>
</span><span id="line-820"></span><span id="local-6989586621683122265"><span class="annot"><a href="GHC.HsToCore.Utils.html#is_triv_lpat"><span class="hs-identifier hs-type">is_triv_lpat</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Language.Haskell.Syntax.Pat.html#LPat"><span class="hs-identifier hs-type">LPat</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Hs.Extension.html#GhcPass"><span class="hs-identifier hs-type">GhcPass</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683122265"><span class="hs-identifier hs-type">p</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Bool</span></span></span><span>
</span><span id="line-821"></span><span id="is_triv_lpat"><span class="annot"><span class="annottext">is_triv_lpat :: forall (p :: Pass). LPat (GhcPass p) -&gt; Bool
</span><a href="GHC.HsToCore.Utils.html#is_triv_lpat"><span class="hs-identifier hs-var hs-var">is_triv_lpat</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Pat (GhcPass p) -&gt; Bool
forall (p :: Pass). Pat (GhcPass p) -&gt; Bool
</span><a href="GHC.HsToCore.Utils.html#is_triv_pat"><span class="hs-identifier hs-var">is_triv_pat</span></a></span><span> </span><span class="annot"><span class="annottext">(Pat (GhcPass p) -&gt; Bool)
-&gt; (GenLocated SrcSpanAnnA (Pat (GhcPass p)) -&gt; Pat (GhcPass p))
-&gt; GenLocated SrcSpanAnnA (Pat (GhcPass p))
-&gt; Bool
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">GenLocated SrcSpanAnnA (Pat (GhcPass p)) -&gt; Pat (GhcPass p)
forall l e. GenLocated l e -&gt; e
</span><a href="GHC.Types.SrcLoc.html#unLoc"><span class="hs-identifier hs-var">unLoc</span></a></span><span>
</span><span id="line-822"></span><span>
</span><span id="line-823"></span><span id="local-6989586621683122272"><span class="annot"><a href="GHC.HsToCore.Utils.html#is_triv_pat"><span class="hs-identifier hs-type">is_triv_pat</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Language.Haskell.Syntax.Pat.html#Pat"><span class="hs-identifier hs-type">Pat</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Hs.Extension.html#GhcPass"><span class="hs-identifier hs-type">GhcPass</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683122272"><span class="hs-identifier hs-type">p</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Bool</span></span></span><span>
</span><span id="line-824"></span><span id="is_triv_pat"><span class="annot"><span class="annottext">is_triv_pat :: forall (p :: Pass). Pat (GhcPass p) -&gt; Bool
</span><a href="GHC.HsToCore.Utils.html#is_triv_pat"><span class="hs-identifier hs-var hs-var">is_triv_pat</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Language.Haskell.Syntax.Pat.html#VarPat"><span class="hs-identifier hs-type">VarPat</span></a></span><span> </span><span class="hs-special">{</span><span class="hs-special">}</span><span class="hs-special">)</span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">True</span></span><span>
</span><span id="line-825"></span><span class="annot"><a href="GHC.HsToCore.Utils.html#is_triv_pat"><span class="hs-identifier hs-var">is_triv_pat</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Language.Haskell.Syntax.Pat.html#WildPat"><span class="hs-identifier hs-type">WildPat</span></a></span><span class="hs-special">{</span><span class="hs-special">}</span><span class="hs-special">)</span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">True</span></span><span>
</span><span id="line-826"></span><span class="annot"><a href="GHC.HsToCore.Utils.html#is_triv_pat"><span class="hs-identifier hs-var">is_triv_pat</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Language.Haskell.Syntax.Pat.html#ParPat"><span class="hs-identifier hs-type">ParPat</span></a></span><span> </span><span class="annot"><span class="annottext">XParPat (GhcPass p)
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621683122901"><span class="annot"><span class="annottext">LPat (GhcPass p)
</span><a href="#local-6989586621683122901"><span class="hs-identifier hs-var">p</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">LPat (GhcPass p) -&gt; Bool
forall (p :: Pass). LPat (GhcPass p) -&gt; Bool
</span><a href="GHC.HsToCore.Utils.html#is_triv_lpat"><span class="hs-identifier hs-var">is_triv_lpat</span></a></span><span> </span><span class="annot"><span class="annottext">LPat (GhcPass p)
</span><a href="#local-6989586621683122901"><span class="hs-identifier hs-var">p</span></a></span><span>
</span><span id="line-827"></span><span class="annot"><a href="GHC.HsToCore.Utils.html#is_triv_pat"><span class="hs-identifier hs-var">is_triv_pat</span></a></span><span> </span><span class="annot"><span class="annottext">Pat (GhcPass p)
</span><span class="hs-identifier">_</span></span><span>            </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">False</span></span><span>
</span><span id="line-828"></span><span>
</span><span id="line-829"></span><span>
</span><span id="line-830"></span><span class="annot"><span class="hs-comment">{- *********************************************************************
*                                                                      *
  Creating big tuples and their types for full Haskell expressions.
  They work over *Ids*, and create tuples replete with their types,
  which is whey they are not in GHC.Hs.Utils.
*                                                                      *
********************************************************************* -}</span></span><span>
</span><span id="line-837"></span><span>
</span><span id="line-838"></span><span class="annot"><a href="GHC.HsToCore.Utils.html#mkLHsPatTup"><span class="hs-identifier hs-type">mkLHsPatTup</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="Language.Haskell.Syntax.Pat.html#LPat"><span class="hs-identifier hs-type">LPat</span></a></span><span> </span><span class="annot"><a href="GHC.Hs.Extension.html#GhcTc"><span class="hs-identifier hs-type">GhcTc</span></a></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Language.Haskell.Syntax.Pat.html#LPat"><span class="hs-identifier hs-type">LPat</span></a></span><span> </span><span class="annot"><a href="GHC.Hs.Extension.html#GhcTc"><span class="hs-identifier hs-type">GhcTc</span></a></span><span>
</span><span id="line-839"></span><span id="mkLHsPatTup"><span class="annot"><span class="annottext">mkLHsPatTup :: [XRec GhcTc (Pat GhcTc)] -&gt; XRec GhcTc (Pat GhcTc)
</span><a href="GHC.HsToCore.Utils.html#mkLHsPatTup"><span class="hs-identifier hs-var hs-var">mkLHsPatTup</span></a></span></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span>     </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Pat GhcTc -&gt; GenLocated SrcSpanAnnA (Pat GhcTc)
forall e a. HasAnnotation e =&gt; a -&gt; GenLocated e a
</span><a href="GHC.Parser.Annotation.html#noLocA"><span class="hs-identifier hs-var">noLocA</span></a></span><span> </span><span class="annot"><span class="annottext">(Pat GhcTc -&gt; GenLocated SrcSpanAnnA (Pat GhcTc))
-&gt; Pat GhcTc -&gt; GenLocated SrcSpanAnnA (Pat GhcTc)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">[XRec GhcTc (Pat GhcTc)] -&gt; Boxity -&gt; Pat GhcTc
</span><a href="GHC.HsToCore.Utils.html#mkVanillaTuplePat"><span class="hs-identifier hs-var">mkVanillaTuplePat</span></a></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><span class="annot"><span class="annottext">Boxity
</span><a href="Language.Haskell.Syntax.Basic.html#Boxed"><span class="hs-identifier hs-var">Boxed</span></a></span><span>
</span><span id="line-840"></span><span class="annot"><a href="GHC.HsToCore.Utils.html#mkLHsPatTup"><span class="hs-identifier hs-var">mkLHsPatTup</span></a></span><span> </span><span class="hs-special">[</span><span id="local-6989586621683122903"><span class="annot"><span class="annottext">XRec GhcTc (Pat GhcTc)
</span><a href="#local-6989586621683122903"><span class="hs-identifier hs-var">lpat</span></a></span></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">XRec GhcTc (Pat GhcTc)
</span><a href="#local-6989586621683122903"><span class="hs-identifier hs-var">lpat</span></a></span><span>
</span><span id="line-841"></span><span class="annot"><a href="GHC.HsToCore.Utils.html#mkLHsPatTup"><span class="hs-identifier hs-var">mkLHsPatTup</span></a></span><span> </span><span id="local-6989586621683122904"><span class="annot"><span class="annottext">lpats :: [XRec GhcTc (Pat GhcTc)]
</span><a href="#local-6989586621683122904"><span class="hs-identifier hs-var">lpats</span></a></span></span><span class="hs-glyph">@</span><span class="hs-special">(</span><span class="annot"><a href="GHC.Types.SrcLoc.html#L"><span class="hs-identifier hs-type">L</span></a></span><span> </span><span id="local-6989586621683122905"><span class="annot"><span class="annottext">SrcSpanAnnA
</span><a href="#local-6989586621683122905"><span class="hs-identifier hs-var">l</span></a></span></span><span> </span><span class="annot"><span class="annottext">Pat GhcTc
</span><span class="hs-identifier">_</span></span><span class="annot"><span class="hs-glyph hs-type">:</span></span><span class="annot"><span class="annottext">[XRec GhcTc (Pat GhcTc)]
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">SrcSpanAnnA -&gt; Pat GhcTc -&gt; GenLocated SrcSpanAnnA (Pat GhcTc)
forall l e. l -&gt; e -&gt; GenLocated l e
</span><a href="GHC.Types.SrcLoc.html#L"><span class="hs-identifier hs-var">L</span></a></span><span> </span><span class="annot"><span class="annottext">SrcSpanAnnA
</span><a href="#local-6989586621683122905"><span class="hs-identifier hs-var">l</span></a></span><span> </span><span class="annot"><span class="annottext">(Pat GhcTc -&gt; GenLocated SrcSpanAnnA (Pat GhcTc))
-&gt; Pat GhcTc -&gt; GenLocated SrcSpanAnnA (Pat GhcTc)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-842"></span><span>                     </span><span class="annot"><span class="annottext">[XRec GhcTc (Pat GhcTc)] -&gt; Boxity -&gt; Pat GhcTc
</span><a href="GHC.HsToCore.Utils.html#mkVanillaTuplePat"><span class="hs-identifier hs-var">mkVanillaTuplePat</span></a></span><span> </span><span class="annot"><span class="annottext">[XRec GhcTc (Pat GhcTc)]
</span><a href="#local-6989586621683122904"><span class="hs-identifier hs-var">lpats</span></a></span><span> </span><span class="annot"><span class="annottext">Boxity
</span><a href="Language.Haskell.Syntax.Basic.html#Boxed"><span class="hs-identifier hs-var">Boxed</span></a></span><span>
</span><span id="line-843"></span><span>
</span><span id="line-844"></span><span class="annot"><a href="GHC.HsToCore.Utils.html#mkVanillaTuplePat"><span class="hs-identifier hs-type">mkVanillaTuplePat</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="Language.Haskell.Syntax.Pat.html#LPat"><span class="hs-identifier hs-type">LPat</span></a></span><span> </span><span class="annot"><a href="GHC.Hs.Extension.html#GhcTc"><span class="hs-identifier hs-type">GhcTc</span></a></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Language.Haskell.Syntax.Basic.html#Boxity"><span class="hs-identifier hs-type">Boxity</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Language.Haskell.Syntax.Pat.html#Pat"><span class="hs-identifier hs-type">Pat</span></a></span><span> </span><span class="annot"><a href="GHC.Hs.Extension.html#GhcTc"><span class="hs-identifier hs-type">GhcTc</span></a></span><span>
</span><span id="line-845"></span><span class="hs-comment">-- A vanilla tuple pattern simply gets its type from its sub-patterns</span><span>
</span><span id="line-846"></span><span id="mkVanillaTuplePat"><span class="annot"><span class="annottext">mkVanillaTuplePat :: [XRec GhcTc (Pat GhcTc)] -&gt; Boxity -&gt; Pat GhcTc
</span><a href="GHC.HsToCore.Utils.html#mkVanillaTuplePat"><span class="hs-identifier hs-var hs-var">mkVanillaTuplePat</span></a></span></span><span> </span><span id="local-6989586621683122906"><span class="annot"><span class="annottext">[XRec GhcTc (Pat GhcTc)]
</span><a href="#local-6989586621683122906"><span class="hs-identifier hs-var">pats</span></a></span></span><span> </span><span id="local-6989586621683122907"><span class="annot"><span class="annottext">Boxity
</span><a href="#local-6989586621683122907"><span class="hs-identifier hs-var">box</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">XTuplePat GhcTc -&gt; [XRec GhcTc (Pat GhcTc)] -&gt; Boxity -&gt; Pat GhcTc
forall p. XTuplePat p -&gt; [LPat p] -&gt; Boxity -&gt; Pat p
</span><a href="Language.Haskell.Syntax.Pat.html#TuplePat"><span class="hs-identifier hs-var">TuplePat</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(GenLocated SrcSpanAnnA (Pat GhcTc) -&gt; Mult)
-&gt; [GenLocated SrcSpanAnnA (Pat GhcTc)] -&gt; [Mult]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><span class="hs-identifier hs-var">map</span></span><span> </span><span class="annot"><span class="annottext">XRec GhcTc (Pat GhcTc) -&gt; Mult
GenLocated SrcSpanAnnA (Pat GhcTc) -&gt; Mult
</span><a href="GHC.Hs.Syn.Type.html#hsLPatType"><span class="hs-identifier hs-var">hsLPatType</span></a></span><span> </span><span class="annot"><span class="annottext">[XRec GhcTc (Pat GhcTc)]
[GenLocated SrcSpanAnnA (Pat GhcTc)]
</span><a href="#local-6989586621683122906"><span class="hs-identifier hs-var">pats</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[XRec GhcTc (Pat GhcTc)]
</span><a href="#local-6989586621683122906"><span class="hs-identifier hs-var">pats</span></a></span><span> </span><span class="annot"><span class="annottext">Boxity
</span><a href="#local-6989586621683122907"><span class="hs-identifier hs-var">box</span></a></span><span>
</span><span id="line-847"></span><span>
</span><span id="line-848"></span><span class="hs-comment">-- The Big equivalents for the source tuple expressions</span><span>
</span><span id="line-849"></span><span class="annot"><a href="GHC.HsToCore.Utils.html#mkBigLHsVarTupId"><span class="hs-identifier hs-type">mkBigLHsVarTupId</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="GHC.Types.Var.html#Id"><span class="hs-identifier hs-type">Id</span></a></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Language.Haskell.Syntax.Expr.html#LHsExpr"><span class="hs-identifier hs-type">LHsExpr</span></a></span><span> </span><span class="annot"><a href="GHC.Hs.Extension.html#GhcTc"><span class="hs-identifier hs-type">GhcTc</span></a></span><span>
</span><span id="line-850"></span><span id="mkBigLHsVarTupId"><span class="annot"><span class="annottext">mkBigLHsVarTupId :: [Var] -&gt; LHsExpr GhcTc
</span><a href="GHC.HsToCore.Utils.html#mkBigLHsVarTupId"><span class="hs-identifier hs-var hs-var">mkBigLHsVarTupId</span></a></span></span><span> </span><span id="local-6989586621683122908"><span class="annot"><span class="annottext">[Var]
</span><a href="#local-6989586621683122908"><span class="hs-identifier hs-var">ids</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[LHsExpr GhcTc] -&gt; LHsExpr GhcTc
</span><a href="GHC.HsToCore.Utils.html#mkBigLHsTupId"><span class="hs-identifier hs-var">mkBigLHsTupId</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(Var -&gt; GenLocated SrcSpanAnnA (HsExpr GhcTc))
-&gt; [Var] -&gt; [GenLocated SrcSpanAnnA (HsExpr GhcTc)]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><span class="hs-identifier hs-var">map</span></span><span> </span><span class="annot"><span class="annottext">IdP GhcTc -&gt; LHsExpr GhcTc
Var -&gt; GenLocated SrcSpanAnnA (HsExpr GhcTc)
forall (p :: Pass) a.
IsSrcSpanAnn p a =&gt;
IdP (GhcPass p) -&gt; LHsExpr (GhcPass p)
</span><a href="GHC.Hs.Utils.html#nlHsVar"><span class="hs-identifier hs-var">nlHsVar</span></a></span><span> </span><span class="annot"><span class="annottext">[Var]
</span><a href="#local-6989586621683122908"><span class="hs-identifier hs-var">ids</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-851"></span><span>
</span><span id="line-852"></span><span class="annot"><a href="GHC.HsToCore.Utils.html#mkBigLHsTupId"><span class="hs-identifier hs-type">mkBigLHsTupId</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="Language.Haskell.Syntax.Expr.html#LHsExpr"><span class="hs-identifier hs-type">LHsExpr</span></a></span><span> </span><span class="annot"><a href="GHC.Hs.Extension.html#GhcTc"><span class="hs-identifier hs-type">GhcTc</span></a></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Language.Haskell.Syntax.Expr.html#LHsExpr"><span class="hs-identifier hs-type">LHsExpr</span></a></span><span> </span><span class="annot"><a href="GHC.Hs.Extension.html#GhcTc"><span class="hs-identifier hs-type">GhcTc</span></a></span><span>
</span><span id="line-853"></span><span id="mkBigLHsTupId"><span class="annot"><span class="annottext">mkBigLHsTupId :: [LHsExpr GhcTc] -&gt; LHsExpr GhcTc
</span><a href="GHC.HsToCore.Utils.html#mkBigLHsTupId"><span class="hs-identifier hs-var hs-var">mkBigLHsTupId</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">([GenLocated SrcSpanAnnA (HsExpr GhcTc)]
 -&gt; GenLocated SrcSpanAnnA (HsExpr GhcTc))
-&gt; [GenLocated SrcSpanAnnA (HsExpr GhcTc)]
-&gt; GenLocated SrcSpanAnnA (HsExpr GhcTc)
forall a. ([a] -&gt; a) -&gt; [a] -&gt; a
</span><a href="GHC.Core.Make.html#mkChunkified"><span class="hs-identifier hs-var">mkChunkified</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span id="local-6989586621683122911"><span class="annot"><span class="annottext">[GenLocated SrcSpanAnnA (HsExpr GhcTc)]
</span><a href="#local-6989586621683122911"><span class="hs-identifier hs-var">e</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">[LHsExpr GhcTc] -&gt; XExplicitTuple GhcTc -&gt; LHsExpr GhcTc
forall (p :: Pass).
[LHsExpr (GhcPass p)]
-&gt; XExplicitTuple (GhcPass p) -&gt; LHsExpr (GhcPass p)
</span><a href="GHC.Hs.Utils.html#mkLHsTupleExpr"><span class="hs-identifier hs-var">mkLHsTupleExpr</span></a></span><span> </span><span class="annot"><span class="annottext">[LHsExpr GhcTc]
[GenLocated SrcSpanAnnA (HsExpr GhcTc)]
</span><a href="#local-6989586621683122911"><span class="hs-identifier hs-var">e</span></a></span><span> </span><span class="annot"><span class="annottext">XExplicitTuple GhcTc
NoExtField
</span><a href="Language.Haskell.Syntax.Extension.html#noExtField"><span class="hs-identifier hs-var">noExtField</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-854"></span><span>
</span><span id="line-855"></span><span class="hs-comment">-- The Big equivalents for the source tuple patterns</span><span>
</span><span id="line-856"></span><span class="annot"><a href="GHC.HsToCore.Utils.html#mkBigLHsVarPatTupId"><span class="hs-identifier hs-type">mkBigLHsVarPatTupId</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="GHC.Types.Var.html#Id"><span class="hs-identifier hs-type">Id</span></a></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Language.Haskell.Syntax.Pat.html#LPat"><span class="hs-identifier hs-type">LPat</span></a></span><span> </span><span class="annot"><a href="GHC.Hs.Extension.html#GhcTc"><span class="hs-identifier hs-type">GhcTc</span></a></span><span>
</span><span id="line-857"></span><span id="mkBigLHsVarPatTupId"><span class="annot"><span class="annottext">mkBigLHsVarPatTupId :: [Var] -&gt; XRec GhcTc (Pat GhcTc)
</span><a href="GHC.HsToCore.Utils.html#mkBigLHsVarPatTupId"><span class="hs-identifier hs-var hs-var">mkBigLHsVarPatTupId</span></a></span></span><span> </span><span id="local-6989586621683122914"><span class="annot"><span class="annottext">[Var]
</span><a href="#local-6989586621683122914"><span class="hs-identifier hs-var">bs</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[XRec GhcTc (Pat GhcTc)] -&gt; XRec GhcTc (Pat GhcTc)
</span><a href="GHC.HsToCore.Utils.html#mkBigLHsPatTupId"><span class="hs-identifier hs-var">mkBigLHsPatTupId</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(Var -&gt; GenLocated SrcSpanAnnA (Pat GhcTc))
-&gt; [Var] -&gt; [GenLocated SrcSpanAnnA (Pat GhcTc)]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><span class="hs-identifier hs-var">map</span></span><span> </span><span class="annot"><span class="annottext">IdP GhcTc -&gt; XRec GhcTc (Pat GhcTc)
Var -&gt; GenLocated SrcSpanAnnA (Pat GhcTc)
forall (p :: Pass) a.
IsSrcSpanAnn p a =&gt;
IdP (GhcPass p) -&gt; LPat (GhcPass p)
</span><a href="GHC.Hs.Utils.html#nlVarPat"><span class="hs-identifier hs-var">nlVarPat</span></a></span><span> </span><span class="annot"><span class="annottext">[Var]
</span><a href="#local-6989586621683122914"><span class="hs-identifier hs-var">bs</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-858"></span><span>
</span><span id="line-859"></span><span class="annot"><a href="GHC.HsToCore.Utils.html#mkBigLHsPatTupId"><span class="hs-identifier hs-type">mkBigLHsPatTupId</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="Language.Haskell.Syntax.Pat.html#LPat"><span class="hs-identifier hs-type">LPat</span></a></span><span> </span><span class="annot"><a href="GHC.Hs.Extension.html#GhcTc"><span class="hs-identifier hs-type">GhcTc</span></a></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Language.Haskell.Syntax.Pat.html#LPat"><span class="hs-identifier hs-type">LPat</span></a></span><span> </span><span class="annot"><a href="GHC.Hs.Extension.html#GhcTc"><span class="hs-identifier hs-type">GhcTc</span></a></span><span>
</span><span id="line-860"></span><span id="mkBigLHsPatTupId"><span class="annot"><span class="annottext">mkBigLHsPatTupId :: [XRec GhcTc (Pat GhcTc)] -&gt; XRec GhcTc (Pat GhcTc)
</span><a href="GHC.HsToCore.Utils.html#mkBigLHsPatTupId"><span class="hs-identifier hs-var hs-var">mkBigLHsPatTupId</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">([GenLocated SrcSpanAnnA (Pat GhcTc)]
 -&gt; GenLocated SrcSpanAnnA (Pat GhcTc))
-&gt; [GenLocated SrcSpanAnnA (Pat GhcTc)]
-&gt; GenLocated SrcSpanAnnA (Pat GhcTc)
forall a. ([a] -&gt; a) -&gt; [a] -&gt; a
</span><a href="GHC.Core.Make.html#mkChunkified"><span class="hs-identifier hs-var">mkChunkified</span></a></span><span> </span><span class="annot"><span class="annottext">[XRec GhcTc (Pat GhcTc)] -&gt; XRec GhcTc (Pat GhcTc)
[GenLocated SrcSpanAnnA (Pat GhcTc)]
-&gt; GenLocated SrcSpanAnnA (Pat GhcTc)
</span><a href="GHC.HsToCore.Utils.html#mkLHsPatTup"><span class="hs-identifier hs-var">mkLHsPatTup</span></a></span><span>
</span><span id="line-861"></span><span>
</span><span id="line-862"></span><span class="hs-comment">{-
************************************************************************
*                                                                      *
        Code for pattern-matching and other failures
*                                                                      *
************************************************************************

Generally, we handle pattern matching failure like this: let-bind a
fail-variable, and use that variable if the thing fails:
\begin{verbatim}
        let fail.33 = error &quot;Help&quot;
        in
        case x of
                p1 -&gt; ...
                p2 -&gt; fail.33
                p3 -&gt; fail.33
                p4 -&gt; ...
\end{verbatim}
Then
\begin{itemize}
\item
If the case can't fail, then there'll be no mention of @fail.33@, and the
simplifier will later discard it.

\item
If it can fail in only one way, then the simplifier will inline it.

\item
Only if it is used more than once will the let-binding remain.
\end{itemize}

There's a problem when the result of the case expression is of
unboxed type.  Then the type of @fail.33@ is unboxed too, and
there is every chance that someone will change the let into a case:
\begin{verbatim}
        case error &quot;Help&quot; of
          fail.33 -&gt; case ....
\end{verbatim}

which is of course utterly wrong.  Rather than drop the condition that
only boxed types can be let-bound, we just turn the fail into a function
for the primitive case:
\begin{verbatim}
        let fail.33 :: Void -&gt; Int#
            fail.33 = \_ -&gt; error &quot;Help&quot;
        in
        case x of
                p1 -&gt; ...
                p2 -&gt; fail.33 void
                p3 -&gt; fail.33 void
                p4 -&gt; ...
\end{verbatim}

Now @fail.33@ is a function, so it can be let-bound.

We would *like* to use join points here; in fact, these &quot;fail variables&quot; are
paradigmatic join points! Sadly, this breaks pattern synonyms, which desugar as
CPS functions - i.e. they take &quot;join points&quot; as parameters. It's not impossible
to imagine extending our type system to allow passing join points around (very
carefully), but we certainly don't support it now.

99.99% of the time, the fail variables wind up as join points in short order
anyway, and the Void# doesn't do much harm.
-}</span><span>
</span><span id="line-926"></span><span>
</span><span id="line-927"></span><span class="annot"><a href="GHC.HsToCore.Utils.html#mkFailurePair"><span class="hs-identifier hs-type">mkFailurePair</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Core.html#CoreExpr"><span class="hs-identifier hs-type">CoreExpr</span></a></span><span>       </span><span class="hs-comment">-- Result type of the whole case expression</span><span>
</span><span id="line-928"></span><span>              </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.HsToCore.Types.html#DsM"><span class="hs-identifier hs-type">DsM</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Core.html#CoreBind"><span class="hs-identifier hs-type">CoreBind</span></a></span><span class="hs-special">,</span><span> </span><span class="hs-comment">-- Binds the newly-created fail variable</span><span>
</span><span id="line-929"></span><span>                                </span><span class="hs-comment">-- to \ _ -&gt; expression</span><span>
</span><span id="line-930"></span><span>                      </span><span class="annot"><a href="GHC.Core.html#CoreExpr"><span class="hs-identifier hs-type">CoreExpr</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-comment">-- Fail variable applied to (# #)</span><span>
</span><span id="line-931"></span><span class="hs-comment">-- See Note [Failure thunks and CPR]</span><span>
</span><span id="line-932"></span><span id="mkFailurePair"><span class="annot"><span class="annottext">mkFailurePair :: CoreExpr -&gt; DsM (Bind Var, CoreExpr)
</span><a href="GHC.HsToCore.Utils.html#mkFailurePair"><span class="hs-identifier hs-var hs-var">mkFailurePair</span></a></span></span><span> </span><span id="local-6989586621683122917"><span class="annot"><span class="annottext">CoreExpr
</span><a href="#local-6989586621683122917"><span class="hs-identifier hs-var">expr</span></a></span></span><span>
</span><span id="line-933"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span id="local-6989586621683122918"><span class="annot"><a href="#local-6989586621683122918"><span class="hs-identifier hs-var">fail_fun_var</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Mult -&gt; DsM Var
</span><a href="GHC.HsToCore.Monad.html#newFailLocalMDs"><span class="hs-identifier hs-var">newFailLocalMDs</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Mult
</span><a href="GHC.Builtin.Types.html#unboxedUnitTy"><span class="hs-identifier hs-var">unboxedUnitTy</span></a></span><span> </span><span class="annot"><span class="annottext">HasDebugCallStack =&gt; Mult -&gt; Mult -&gt; Mult
Mult -&gt; Mult -&gt; Mult
</span><a href="GHC.Core.TyCo.Rep.html#mkVisFunTyMany"><span class="hs-operator hs-var">`mkVisFunTyMany`</span></a></span><span> </span><span class="annot"><span class="annottext">Mult
</span><a href="#local-6989586621683122922"><span class="hs-identifier hs-var">ty</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-934"></span><span>       </span><span class="hs-special">;</span><span> </span><span id="local-6989586621683122923"><span class="annot"><a href="#local-6989586621683122923"><span class="hs-identifier hs-var">fail_fun_arg</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><a href="GHC.HsToCore.Monad.html#newSysLocalMDs"><span class="hs-identifier hs-type">newSysLocalMDs</span></a></span><span> </span><span class="annot"><a href="GHC.Builtin.Types.html#unboxedUnitTy"><span class="hs-identifier hs-type">unboxedUnitTy</span></a></span><span>
</span><span id="line-935"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621683122924"><span class="annot"><a href="#local-6989586621683122924"><span class="hs-identifier hs-var hs-var">real_arg</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Var -&gt; Var
</span><a href="GHC.Types.Id.html#setOneShotLambda"><span class="hs-identifier hs-var">setOneShotLambda</span></a></span><span> </span><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621683122923"><span class="hs-identifier hs-var">fail_fun_arg</span></a></span><span>
</span><span id="line-936"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">return</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Core.html#NonRec"><span class="hs-identifier hs-type">NonRec</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683122918"><span class="hs-identifier hs-type">fail_fun_var</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Core.html#Lam"><span class="hs-identifier hs-type">Lam</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683122924"><span class="hs-identifier hs-type">real_arg</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683122917"><span class="hs-identifier hs-type">expr</span></a></span><span class="hs-special">)</span><span class="hs-special">,</span><span>
</span><span id="line-937"></span><span>                 </span><span class="annot"><a href="GHC.Core.html#App"><span class="hs-identifier hs-type">App</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Core.html#Var"><span class="hs-identifier hs-type">Var</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683122918"><span class="hs-identifier hs-type">fail_fun_var</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><a href="GHC.Types.Id.Make.html#unboxedUnitExpr"><span class="hs-identifier hs-type">unboxedUnitExpr</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-938"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-939"></span><span>    </span><span id="local-6989586621683122922"><span class="annot"><span class="annottext">ty :: Mult
</span><a href="#local-6989586621683122922"><span class="hs-identifier hs-var hs-var">ty</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">HasDebugCallStack =&gt; CoreExpr -&gt; Mult
CoreExpr -&gt; Mult
</span><a href="GHC.Core.Utils.html#exprType"><span class="hs-identifier hs-var">exprType</span></a></span><span> </span><span class="annot"><span class="annottext">CoreExpr
</span><a href="#local-6989586621683122917"><span class="hs-identifier hs-var">expr</span></a></span><span>
</span><span id="line-940"></span><span>
</span><span id="line-941"></span><span class="hs-comment">-- Uses '@mkFailurePair@' to bind the failure case. Infallible matches have</span><span>
</span><span id="line-942"></span><span class="hs-comment">-- neither a failure arg or failure &quot;hole&quot;, so nothing is let-bound, and no</span><span>
</span><span id="line-943"></span><span class="hs-comment">-- extraneous Core is produced.</span><span>
</span><span id="line-944"></span><span class="annot"><a href="GHC.HsToCore.Utils.html#shareFailureHandler"><span class="hs-identifier hs-type">shareFailureHandler</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.HsToCore.Monad.html#MatchResult"><span class="hs-identifier hs-type">MatchResult</span></a></span><span> </span><span class="annot"><a href="GHC.Core.html#CoreExpr"><span class="hs-identifier hs-type">CoreExpr</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.HsToCore.Monad.html#MatchResult"><span class="hs-identifier hs-type">MatchResult</span></a></span><span> </span><span class="annot"><a href="GHC.Core.html#CoreExpr"><span class="hs-identifier hs-type">CoreExpr</span></a></span><span>
</span><span id="line-945"></span><span id="shareFailureHandler"><span class="annot"><span class="annottext">shareFailureHandler :: MatchResult CoreExpr -&gt; MatchResult CoreExpr
</span><a href="GHC.HsToCore.Utils.html#shareFailureHandler"><span class="hs-identifier hs-var hs-var">shareFailureHandler</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-glyph">\</span><span class="hs-glyph">case</span><span>
</span><span id="line-946"></span><span>  </span><span id="local-6989586621683122927"><span class="annot"><span class="annottext">mr :: MatchResult CoreExpr
</span><a href="#local-6989586621683122927"><span class="hs-identifier hs-var">mr</span></a></span></span><span class="hs-glyph">@</span><span class="hs-special">(</span><span class="annot"><a href="GHC.HsToCore.Monad.html#MR_Infallible"><span class="hs-identifier hs-type">MR_Infallible</span></a></span><span> </span><span class="annot"><span class="annottext">DsM CoreExpr
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">MatchResult CoreExpr
</span><a href="#local-6989586621683122927"><span class="hs-identifier hs-var">mr</span></a></span><span>
</span><span id="line-947"></span><span>  </span><span class="annot"><a href="GHC.HsToCore.Monad.html#MR_Fallible"><span class="hs-identifier hs-type">MR_Fallible</span></a></span><span> </span><span id="local-6989586621683122928"><span class="annot"><span class="annottext">CoreExpr -&gt; DsM CoreExpr
</span><a href="#local-6989586621683122928"><span class="hs-identifier hs-var">match_fn</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">(CoreExpr -&gt; DsM CoreExpr) -&gt; MatchResult CoreExpr
forall a. (CoreExpr -&gt; DsM a) -&gt; MatchResult a
</span><a href="GHC.HsToCore.Monad.html#MR_Fallible"><span class="hs-identifier hs-var">MR_Fallible</span></a></span><span> </span><span class="annot"><span class="annottext">((CoreExpr -&gt; DsM CoreExpr) -&gt; MatchResult CoreExpr)
-&gt; (CoreExpr -&gt; DsM CoreExpr) -&gt; MatchResult CoreExpr
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-glyph">\</span><span id="local-6989586621683122929"><span class="annot"><span class="annottext">CoreExpr
</span><a href="#local-6989586621683122929"><span class="hs-identifier hs-var">fail_expr</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-948"></span><span>    </span><span class="hs-special">(</span><span id="local-6989586621683122930"><span class="annot"><a href="#local-6989586621683122930"><span class="hs-identifier hs-var">fail_bind</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621683122931"><span class="annot"><a href="#local-6989586621683122931"><span class="hs-identifier hs-var">shared_failure_handler</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">CoreExpr -&gt; DsM (Bind Var, CoreExpr)
</span><a href="GHC.HsToCore.Utils.html#mkFailurePair"><span class="hs-identifier hs-var">mkFailurePair</span></a></span><span> </span><span class="annot"><span class="annottext">CoreExpr
</span><a href="#local-6989586621683122929"><span class="hs-identifier hs-var">fail_expr</span></a></span><span>
</span><span id="line-949"></span><span>    </span><span id="local-6989586621683122932"><span class="annot"><a href="#local-6989586621683122932"><span class="hs-identifier hs-var">body</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><a href="#local-6989586621683122928"><span class="hs-identifier hs-type">match_fn</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683122931"><span class="hs-identifier hs-type">shared_failure_handler</span></a></span><span>
</span><span id="line-950"></span><span>    </span><span class="hs-comment">-- Never unboxed, per the above, so always OK for `let` not `case`.</span><span>
</span><span id="line-951"></span><span>    </span><span class="annot"><span class="hs-identifier hs-type">return</span></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="annot"><a href="GHC.Core.html#Let"><span class="hs-identifier hs-type">Let</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683122930"><span class="hs-identifier hs-type">fail_bind</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683122932"><span class="hs-identifier hs-type">body</span></a></span><span>
</span><span id="line-952"></span><span>
</span><span id="line-953"></span><span class="hs-comment">{-
Note [Failure thunks and CPR]
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
(This note predates join points as formal entities (hence the quotation marks).
We can't use actual join points here (see above); if we did, this would also
solve the CPR problem, since join points don't get CPR'd. See Note [Don't w/w
join points for CPR] in GHC.Core.Opt.WorkWrap.)

When we make a failure point we ensure that it
does not look like a thunk. Example:

   let fail = \rw -&gt; error &quot;urk&quot;
   in case x of
        [] -&gt; fail realWorld#
        (y:ys) -&gt; case ys of
                    [] -&gt; fail realWorld#
                    (z:zs) -&gt; (y,z)

Reason: we know that a failure point is always a &quot;join point&quot; and is
entered at most once.  Adding a dummy 'realWorld' token argument makes
it clear that sharing is not an issue.  And that in turn makes it more
CPR-friendly.  This matters a lot: if you don't get it right, you lose
the tail call property.  For example, see #3403.
-}</span><span>
</span><span id="line-977"></span><span>
</span><span id="line-978"></span><span class="annot"><a href="GHC.HsToCore.Utils.html#dsHandleMonadicFailure"><span class="hs-identifier hs-type">dsHandleMonadicFailure</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Language.Haskell.Syntax.Expr.html#HsDoFlavour"><span class="hs-identifier hs-type">HsDoFlavour</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Language.Haskell.Syntax.Pat.html#LPat"><span class="hs-identifier hs-type">LPat</span></a></span><span> </span><span class="annot"><a href="GHC.Hs.Extension.html#GhcTc"><span class="hs-identifier hs-type">GhcTc</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#Type"><span class="hs-identifier hs-type">Type</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.HsToCore.Monad.html#MatchResult"><span class="hs-identifier hs-type">MatchResult</span></a></span><span> </span><span class="annot"><a href="GHC.Core.html#CoreExpr"><span class="hs-identifier hs-type">CoreExpr</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Language.Haskell.Syntax.Expr.html#FailOperator"><span class="hs-identifier hs-type">FailOperator</span></a></span><span> </span><span class="annot"><a href="GHC.Hs.Extension.html#GhcTc"><span class="hs-identifier hs-type">GhcTc</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.HsToCore.Types.html#DsM"><span class="hs-identifier hs-type">DsM</span></a></span><span> </span><span class="annot"><a href="GHC.Core.html#CoreExpr"><span class="hs-identifier hs-type">CoreExpr</span></a></span><span>
</span><span id="line-979"></span><span>    </span><span class="hs-comment">-- In an ApplicativeDo expression, pattern-match failure just calls the</span><span>
</span><span id="line-980"></span><span>    </span><span class="hs-comment">-- monadic 'fail' rather than throwing an exception.</span><span>
</span><span id="line-981"></span><span id="dsHandleMonadicFailure"><span class="annot"><span class="annottext">dsHandleMonadicFailure :: HsDoFlavour
-&gt; XRec GhcTc (Pat GhcTc)
-&gt; Mult
-&gt; MatchResult CoreExpr
-&gt; FailOperator GhcTc
-&gt; DsM CoreExpr
</span><a href="GHC.HsToCore.Utils.html#dsHandleMonadicFailure"><span class="hs-identifier hs-var hs-var">dsHandleMonadicFailure</span></a></span></span><span> </span><span id="local-6989586621683122933"><span class="annot"><span class="annottext">HsDoFlavour
</span><a href="#local-6989586621683122933"><span class="hs-identifier hs-var">ctx</span></a></span></span><span> </span><span id="local-6989586621683122934"><span class="annot"><span class="annottext">XRec GhcTc (Pat GhcTc)
</span><a href="#local-6989586621683122934"><span class="hs-identifier hs-var">pat</span></a></span></span><span> </span><span id="local-6989586621683122935"><span class="annot"><span class="annottext">Mult
</span><a href="#local-6989586621683122935"><span class="hs-identifier hs-var">res_ty</span></a></span></span><span> </span><span id="local-6989586621683122936"><span class="annot"><span class="annottext">MatchResult CoreExpr
</span><a href="#local-6989586621683122936"><span class="hs-identifier hs-var">match</span></a></span></span><span> </span><span id="local-6989586621683122937"><span class="annot"><span class="annottext">FailOperator GhcTc
</span><a href="#local-6989586621683122937"><span class="hs-identifier hs-var">m_fail_op</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-982"></span><span>  </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">MatchResult CoreExpr -&gt; MatchResult CoreExpr
</span><a href="GHC.HsToCore.Utils.html#shareFailureHandler"><span class="hs-identifier hs-var">shareFailureHandler</span></a></span><span> </span><span class="annot"><span class="annottext">MatchResult CoreExpr
</span><a href="#local-6989586621683122936"><span class="hs-identifier hs-var">match</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-983"></span><span>    </span><span class="annot"><a href="GHC.HsToCore.Monad.html#MR_Infallible"><span class="hs-identifier hs-type">MR_Infallible</span></a></span><span> </span><span id="local-6989586621683122938"><span class="annot"><span class="annottext">DsM CoreExpr
</span><a href="#local-6989586621683122938"><span class="hs-identifier hs-var">body</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">DsM CoreExpr
</span><a href="#local-6989586621683122938"><span class="hs-identifier hs-var">body</span></a></span><span>
</span><span id="line-984"></span><span>    </span><span class="annot"><a href="GHC.HsToCore.Monad.html#MR_Fallible"><span class="hs-identifier hs-type">MR_Fallible</span></a></span><span> </span><span id="local-6989586621683122939"><span class="annot"><span class="annottext">CoreExpr -&gt; DsM CoreExpr
</span><a href="#local-6989586621683122939"><span class="hs-identifier hs-var">body</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-985"></span><span>      </span><span id="local-6989586621683122940"><span class="annot"><a href="#local-6989586621683122940"><span class="hs-identifier hs-var">dflags</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">IOEnv (Env DsGblEnv DsLclEnv) DynFlags
forall (m :: * -&gt; *). HasDynFlags m =&gt; m DynFlags
</span><a href="GHC.Driver.DynFlags.html#getDynFlags"><span class="hs-identifier hs-var">getDynFlags</span></a></span><span>
</span><span id="line-986"></span><span>      </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621683122941"><span class="annot"><a href="#local-6989586621683122941"><span class="hs-identifier hs-var hs-var">strict</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Extension -&gt; DynFlags -&gt; Bool
</span><a href="GHC.Driver.DynFlags.html#xopt"><span class="hs-identifier hs-var">xopt</span></a></span><span> </span><span class="annot"><span class="annottext">Extension
</span><span class="hs-identifier hs-var">LangExt.Strict</span></span><span> </span><span class="annot"><span class="annottext">DynFlags
</span><a href="#local-6989586621683122940"><span class="hs-identifier hs-var">dflags</span></a></span><span>
</span><span id="line-987"></span><span>      </span><span id="local-6989586621683122944"><span class="annot"><a href="#local-6989586621683122944"><span class="hs-identifier hs-var">comps</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><a href="GHC.HsToCore.Monad.html#dsGetCompleteMatches"><span class="hs-identifier hs-type">dsGetCompleteMatches</span></a></span><span>
</span><span id="line-988"></span><span>      </span><span id="local-6989586621683122946"><span class="annot"><a href="#local-6989586621683122946"><span class="hs-identifier hs-var">fail_expr</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><a href="#local-6989586621683122937"><span class="hs-identifier hs-type">m_fail_op</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-989"></span><span>        </span><span class="hs-comment">-- Note that (non-monadic) list comprehension, pattern guards, etc could</span><span>
</span><span id="line-990"></span><span>        </span><span class="hs-comment">-- have fallible bindings without an explicit failure op, but this is</span><span>
</span><span id="line-991"></span><span>        </span><span class="hs-comment">-- handled elsewhere. See Note [Failing pattern matches in Stmts] the</span><span>
</span><span id="line-992"></span><span>        </span><span class="hs-comment">-- breakdown of regular and special binds.</span><span>
</span><span id="line-993"></span><span>        </span><span class="hs-comment">-- It *is* possible to land here for infallible Or patterns in</span><span>
</span><span id="line-994"></span><span>        </span><span class="hs-comment">-- ApplicativeDo, because their desugaring to ViewPatterns leads</span><span>
</span><span id="line-995"></span><span>        </span><span class="hs-comment">-- to a MR_Fallible match. But irrefutability is easily asserted:</span><span>
</span><span id="line-996"></span><span>        </span><span class="annot"><span class="annottext">FailOperator GhcTc
</span><span class="hs-identifier hs-var">Nothing</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-997"></span><span>          </span><span class="annot"><span class="annottext">Bool -&gt; SDoc -&gt; IOEnv (Env DsGblEnv DsLclEnv) ()
forall (m :: * -&gt; *).
(HasCallStack, Applicative m) =&gt;
Bool -&gt; SDoc -&gt; m ()
</span><a href="GHC.Utils.Panic.html#massertPpr"><span class="hs-identifier hs-var">massertPpr</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Bool -&gt; (ConLikeP GhcTc -&gt; Bool) -&gt; XRec GhcTc (Pat GhcTc) -&gt; Bool
forall (p :: Pass).
IsPass p =&gt;
Bool -&gt; (ConLikeP (GhcPass p) -&gt; Bool) -&gt; LPat (GhcPass p) -&gt; Bool
</span><a href="GHC.Hs.Pat.html#isIrrefutableHsPat"><span class="hs-identifier hs-var">isIrrefutableHsPat</span></a></span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621683122941"><span class="hs-identifier hs-var">strict</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">DsCompleteMatches -&gt; ConLike -&gt; Bool
forall con.
NamedThing con =&gt;
[CompleteMatchX con] -&gt; ConLike -&gt; Bool
</span><a href="GHC.Rename.Env.html#irrefutableConLikeTc"><span class="hs-identifier hs-var">irrefutableConLikeTc</span></a></span><span> </span><span class="annot"><span class="annottext">DsCompleteMatches
</span><a href="#local-6989586621683122944"><span class="hs-identifier hs-var">comps</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">XRec GhcTc (Pat GhcTc)
</span><a href="#local-6989586621683122934"><span class="hs-identifier hs-var">pat</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(SDoc -&gt; IOEnv (Env DsGblEnv DsLclEnv) ())
-&gt; SDoc -&gt; IOEnv (Env DsGblEnv DsLclEnv) ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-998"></span><span>            </span><span class="annot"><span class="annottext">[Char] -&gt; SDoc
forall doc. IsLine doc =&gt; [Char] -&gt; doc
</span><a href="GHC.Utils.Outputable.html#text"><span class="hs-identifier hs-var">text</span></a></span><span> </span><span class="annot"><span class="annottext">[Char]
</span><span class="hs-string">&quot;Pattern match:&quot;</span></span><span> </span><span class="annot"><span class="annottext">SDoc -&gt; SDoc -&gt; SDoc
forall doc. IsLine doc =&gt; doc -&gt; doc -&gt; doc
</span><a href="GHC.Utils.Outputable.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">GenLocated SrcSpanAnnA (Pat GhcTc) -&gt; SDoc
forall a. Outputable a =&gt; a -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="annot"><span class="annottext">XRec GhcTc (Pat GhcTc)
GenLocated SrcSpanAnnA (Pat GhcTc)
</span><a href="#local-6989586621683122934"><span class="hs-identifier hs-var">pat</span></a></span><span> </span><span class="annot"><span class="annottext">SDoc -&gt; SDoc -&gt; SDoc
forall doc. IsLine doc =&gt; doc -&gt; doc -&gt; doc
</span><a href="GHC.Utils.Outputable.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a></span><span>
</span><span id="line-999"></span><span>            </span><span class="annot"><span class="annottext">[Char] -&gt; SDoc
forall doc. IsLine doc =&gt; [Char] -&gt; doc
</span><a href="GHC.Utils.Outputable.html#text"><span class="hs-identifier hs-var">text</span></a></span><span> </span><span class="annot"><span class="annottext">[Char]
</span><span class="hs-string">&quot;is failable, and fail_expr was left unset&quot;</span></span><span>
</span><span id="line-1000"></span><span>          </span><span class="hs-comment">-- In this case we likely desugar the pattern-match in something like</span><span>
</span><span id="line-1001"></span><span>          </span><span class="hs-comment">--   do (~True; False) &lt;- m; stmts</span><span>
</span><span id="line-1002"></span><span>          </span><span class="hs-comment">-- just presume a fail_expr like in the desugaring of lambdas;</span><span>
</span><span id="line-1003"></span><span>          </span><span class="hs-comment">-- that's the non-ApplicativeDo code path</span><span>
</span><span id="line-1004"></span><span>          </span><span class="annot"><span class="annottext">Var -&gt; Mult -&gt; SDoc -&gt; DsM CoreExpr
</span><a href="GHC.HsToCore.Utils.html#mkErrorAppDs"><span class="hs-identifier hs-var">mkErrorAppDs</span></a></span><span> </span><span class="annot"><span class="annottext">Var
</span><a href="GHC.Core.Make.html#pAT_ERROR_ID"><span class="hs-identifier hs-var">pAT_ERROR_ID</span></a></span><span> </span><span class="annot"><span class="annottext">Mult
</span><a href="#local-6989586621683122935"><span class="hs-identifier hs-var">res_ty</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">HsDoFlavour -&gt; SDoc
</span><a href="GHC.Hs.Expr.html#matchDoContextErrString"><span class="hs-identifier hs-var">matchDoContextErrString</span></a></span><span> </span><span class="annot"><span class="annottext">HsDoFlavour
</span><a href="#local-6989586621683122933"><span class="hs-identifier hs-var">ctx</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1005"></span><span>        </span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span id="local-6989586621683122950"><span class="annot"><span class="annottext">SyntaxExpr GhcTc
</span><a href="#local-6989586621683122950"><span class="hs-identifier hs-var">fail_op</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-1006"></span><span>          </span><span id="local-6989586621683122951"><span class="annot"><a href="#local-6989586621683122951"><span class="hs-identifier hs-var">fail_msg</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">[Char] -&gt; DsM CoreExpr
forall (m :: * -&gt; *). MonadThings m =&gt; [Char] -&gt; m CoreExpr
</span><a href="GHC.Core.Make.html#mkStringExpr"><span class="hs-identifier hs-var">mkStringExpr</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">DynFlags
-&gt; HsDoFlavour -&gt; GenLocated SrcSpanAnnA (Pat GhcTc) -&gt; [Char]
forall e. DynFlags -&gt; HsDoFlavour -&gt; LocatedA e -&gt; [Char]
</span><a href="GHC.HsToCore.Utils.html#mk_fail_msg"><span class="hs-identifier hs-var">mk_fail_msg</span></a></span><span> </span><span class="annot"><span class="annottext">DynFlags
</span><a href="#local-6989586621683122940"><span class="hs-identifier hs-var">dflags</span></a></span><span> </span><span class="annot"><span class="annottext">HsDoFlavour
</span><a href="#local-6989586621683122933"><span class="hs-identifier hs-var">ctx</span></a></span><span> </span><span class="annot"><span class="annottext">XRec GhcTc (Pat GhcTc)
GenLocated SrcSpanAnnA (Pat GhcTc)
</span><a href="#local-6989586621683122934"><span class="hs-identifier hs-var">pat</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1007"></span><span>          </span><span class="annot"><a href="GHC.HsToCore.Expr.html#dsSyntaxExpr"><span class="hs-identifier hs-type">dsSyntaxExpr</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683122950"><span class="hs-identifier hs-type">fail_op</span></a></span><span> </span><span class="hs-special">[</span><span class="annot"><a href="#local-6989586621683122951"><span class="hs-identifier hs-type">fail_msg</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-1008"></span><span>      </span><span class="annot"><a href="#local-6989586621683122939"><span class="hs-identifier hs-type">body</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683122946"><span class="hs-identifier hs-type">fail_expr</span></a></span><span>
</span><span id="line-1009"></span><span>
</span><span id="line-1010"></span><span id="local-6989586621683122297"><span class="annot"><a href="GHC.HsToCore.Utils.html#mk_fail_msg"><span class="hs-identifier hs-type">mk_fail_msg</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Driver.DynFlags.html#DynFlags"><span class="hs-identifier hs-type">DynFlags</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Language.Haskell.Syntax.Expr.html#HsDoFlavour"><span class="hs-identifier hs-type">HsDoFlavour</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Parser.Annotation.html#LocatedA"><span class="hs-identifier hs-type">LocatedA</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683122297"><span class="hs-identifier hs-type">e</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">String</span></span></span><span>
</span><span id="line-1011"></span><span id="mk_fail_msg"><span class="annot"><span class="annottext">mk_fail_msg :: forall e. DynFlags -&gt; HsDoFlavour -&gt; LocatedA e -&gt; [Char]
</span><a href="GHC.HsToCore.Utils.html#mk_fail_msg"><span class="hs-identifier hs-var hs-var">mk_fail_msg</span></a></span></span><span> </span><span id="local-6989586621683122964"><span class="annot"><span class="annottext">DynFlags
</span><a href="#local-6989586621683122964"><span class="hs-identifier hs-var">dflags</span></a></span></span><span> </span><span id="local-6989586621683122965"><span class="annot"><span class="annottext">HsDoFlavour
</span><a href="#local-6989586621683122965"><span class="hs-identifier hs-var">ctx</span></a></span></span><span> </span><span id="local-6989586621683122966"><span class="annot"><span class="annottext">LocatedA e
</span><a href="#local-6989586621683122966"><span class="hs-identifier hs-var">pat</span></a></span></span><span>
</span><span id="line-1012"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">DynFlags -&gt; SDoc -&gt; [Char]
forall a. Outputable a =&gt; DynFlags -&gt; a -&gt; [Char]
</span><a href="GHC.Driver.Ppr.html#showPpr"><span class="hs-identifier hs-var">showPpr</span></a></span><span> </span><span class="annot"><span class="annottext">DynFlags
</span><a href="#local-6989586621683122964"><span class="hs-identifier hs-var">dflags</span></a></span><span> </span><span class="annot"><span class="annottext">(SDoc -&gt; [Char]) -&gt; SDoc -&gt; [Char]
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">[Char] -&gt; SDoc
forall doc. IsLine doc =&gt; [Char] -&gt; doc
</span><a href="GHC.Utils.Outputable.html#text"><span class="hs-identifier hs-var">text</span></a></span><span> </span><span class="annot"><span class="annottext">[Char]
</span><span class="hs-string">&quot;Pattern match failure in&quot;</span></span><span> </span><span class="annot"><span class="annottext">SDoc -&gt; SDoc -&gt; SDoc
forall doc. IsLine doc =&gt; doc -&gt; doc -&gt; doc
</span><a href="GHC.Utils.Outputable.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">HsDoFlavour -&gt; SDoc
</span><a href="GHC.Hs.Expr.html#pprHsDoFlavour"><span class="hs-identifier hs-var">pprHsDoFlavour</span></a></span><span> </span><span class="annot"><span class="annottext">HsDoFlavour
</span><a href="#local-6989586621683122965"><span class="hs-identifier hs-var">ctx</span></a></span><span>
</span><span id="line-1013"></span><span>                   </span><span class="annot"><span class="annottext">SDoc -&gt; SDoc -&gt; SDoc
forall doc. IsLine doc =&gt; doc -&gt; doc -&gt; doc
</span><a href="GHC.Utils.Outputable.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">[Char] -&gt; SDoc
forall doc. IsLine doc =&gt; [Char] -&gt; doc
</span><a href="GHC.Utils.Outputable.html#text"><span class="hs-identifier hs-var">text</span></a></span><span> </span><span class="annot"><span class="annottext">[Char]
</span><span class="hs-string">&quot;at&quot;</span></span><span> </span><span class="annot"><span class="annottext">SDoc -&gt; SDoc -&gt; SDoc
forall doc. IsLine doc =&gt; doc -&gt; doc -&gt; doc
</span><a href="GHC.Utils.Outputable.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">SrcSpan -&gt; SDoc
forall a. Outputable a =&gt; a -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">LocatedA e -&gt; SrcSpan
forall a e. HasLoc a =&gt; GenLocated a e -&gt; SrcSpan
</span><a href="GHC.Parser.Annotation.html#getLocA"><span class="hs-identifier hs-var">getLocA</span></a></span><span> </span><span class="annot"><span class="annottext">LocatedA e
</span><a href="#local-6989586621683122966"><span class="hs-identifier hs-var">pat</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1014"></span><span>
</span><span id="line-1015"></span><span class="annot"><span class="hs-comment">{- *********************************************************************
*                                                                      *
              Ticks
*                                                                      *
********************************************************************* -}</span></span><span>
</span><span id="line-1020"></span><span>
</span><span id="line-1021"></span><span class="annot"><a href="GHC.HsToCore.Utils.html#mkOptTickBox"><span class="hs-identifier hs-type">mkOptTickBox</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="GHC.Types.Tickish.html#CoreTickish"><span class="hs-identifier hs-type">CoreTickish</span></a></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Core.html#CoreExpr"><span class="hs-identifier hs-type">CoreExpr</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Core.html#CoreExpr"><span class="hs-identifier hs-type">CoreExpr</span></a></span><span>
</span><span id="line-1022"></span><span id="mkOptTickBox"><span class="annot"><span class="annottext">mkOptTickBox :: [CoreTickish] -&gt; CoreExpr -&gt; CoreExpr
</span><a href="GHC.HsToCore.Utils.html#mkOptTickBox"><span class="hs-identifier hs-var hs-var">mkOptTickBox</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(CoreExpr -&gt; [CoreTickish] -&gt; CoreExpr)
-&gt; [CoreTickish] -&gt; CoreExpr -&gt; CoreExpr
forall a b c. (a -&gt; b -&gt; c) -&gt; b -&gt; a -&gt; c
</span><span class="hs-identifier hs-var">flip</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(CoreTickish -&gt; CoreExpr -&gt; CoreExpr)
-&gt; CoreExpr -&gt; [CoreTickish] -&gt; CoreExpr
forall a b. (a -&gt; b -&gt; b) -&gt; b -&gt; [a] -&gt; b
forall (t :: * -&gt; *) a b.
Foldable t =&gt;
(a -&gt; b -&gt; b) -&gt; b -&gt; t a -&gt; b
</span><span class="hs-identifier hs-var">foldr</span></span><span> </span><span class="annot"><span class="annottext">CoreTickish -&gt; CoreExpr -&gt; CoreExpr
forall b. CoreTickish -&gt; Expr b -&gt; Expr b
</span><a href="GHC.Core.html#Tick"><span class="hs-identifier hs-var">Tick</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1023"></span><span>
</span><span id="line-1024"></span><span class="annot"><a href="GHC.HsToCore.Utils.html#mkBinaryTickBox"><span class="hs-identifier hs-type">mkBinaryTickBox</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Int</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Int</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Core.html#CoreExpr"><span class="hs-identifier hs-type">CoreExpr</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.HsToCore.Types.html#DsM"><span class="hs-identifier hs-type">DsM</span></a></span><span> </span><span class="annot"><a href="GHC.Core.html#CoreExpr"><span class="hs-identifier hs-type">CoreExpr</span></a></span><span>
</span><span id="line-1025"></span><span id="mkBinaryTickBox"><span class="annot"><span class="annottext">mkBinaryTickBox :: ConTag -&gt; ConTag -&gt; CoreExpr -&gt; DsM CoreExpr
</span><a href="GHC.HsToCore.Utils.html#mkBinaryTickBox"><span class="hs-identifier hs-var hs-var">mkBinaryTickBox</span></a></span></span><span> </span><span id="local-6989586621683122972"><span class="annot"><span class="annottext">ConTag
</span><a href="#local-6989586621683122972"><span class="hs-identifier hs-var">ixT</span></a></span></span><span> </span><span id="local-6989586621683122973"><span class="annot"><span class="annottext">ConTag
</span><a href="#local-6989586621683122973"><span class="hs-identifier hs-var">ixF</span></a></span></span><span> </span><span id="local-6989586621683122974"><span class="annot"><span class="annottext">CoreExpr
</span><a href="#local-6989586621683122974"><span class="hs-identifier hs-var">e</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-1026"></span><span>       </span><span id="local-6989586621683122975"><span class="annot"><a href="#local-6989586621683122975"><span class="hs-identifier hs-var">this_mod</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">IOEnv (Env DsGblEnv DsLclEnv) Module
forall (m :: * -&gt; *). HasModule m =&gt; m Module
</span><a href="GHC.Unit.Module.html#getModule"><span class="hs-identifier hs-var">getModule</span></a></span><span>
</span><span id="line-1027"></span><span>       </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621683122977"><span class="annot"><a href="#local-6989586621683122977"><span class="hs-identifier hs-var hs-var">trueBox</span></a></span></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">CoreTickish -&gt; CoreExpr -&gt; CoreExpr
forall b. CoreTickish -&gt; Expr b -&gt; Expr b
</span><a href="GHC.Core.html#Tick"><span class="hs-identifier hs-var">Tick</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Module -&gt; ConTag -&gt; CoreTickish
forall (pass :: TickishPass). Module -&gt; ConTag -&gt; GenTickish pass
</span><a href="GHC.Types.Tickish.html#HpcTick"><span class="hs-identifier hs-var">HpcTick</span></a></span><span> </span><span class="annot"><span class="annottext">Module
</span><a href="#local-6989586621683122975"><span class="hs-identifier hs-var">this_mod</span></a></span><span> </span><span class="annot"><span class="annottext">ConTag
</span><a href="#local-6989586621683122972"><span class="hs-identifier hs-var">ixT</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Var -&gt; CoreExpr
forall b. Var -&gt; Expr b
</span><a href="GHC.Core.html#Var"><span class="hs-identifier hs-var">Var</span></a></span><span> </span><span class="annot"><span class="annottext">Var
</span><a href="GHC.Builtin.Types.html#trueDataConId"><span class="hs-identifier hs-var">trueDataConId</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1028"></span><span>           </span><span id="local-6989586621683122980"><span class="annot"><a href="#local-6989586621683122980"><span class="hs-identifier hs-var hs-var">falseBox</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">CoreTickish -&gt; CoreExpr -&gt; CoreExpr
forall b. CoreTickish -&gt; Expr b -&gt; Expr b
</span><a href="GHC.Core.html#Tick"><span class="hs-identifier hs-var">Tick</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Module -&gt; ConTag -&gt; CoreTickish
forall (pass :: TickishPass). Module -&gt; ConTag -&gt; GenTickish pass
</span><a href="GHC.Types.Tickish.html#HpcTick"><span class="hs-identifier hs-var">HpcTick</span></a></span><span> </span><span class="annot"><span class="annottext">Module
</span><a href="#local-6989586621683122975"><span class="hs-identifier hs-var">this_mod</span></a></span><span> </span><span class="annot"><span class="annottext">ConTag
</span><a href="#local-6989586621683122973"><span class="hs-identifier hs-var">ixF</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Var -&gt; CoreExpr
forall b. Var -&gt; Expr b
</span><a href="GHC.Core.html#Var"><span class="hs-identifier hs-var">Var</span></a></span><span> </span><span class="annot"><span class="annottext">Var
</span><a href="GHC.Builtin.Types.html#falseDataConId"><span class="hs-identifier hs-var">falseDataConId</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1029"></span><span>       </span><span class="annot"><span class="hs-identifier hs-type">return</span></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="annot"><a href="GHC.Core.Make.html#mkIfThenElse"><span class="hs-identifier hs-type">mkIfThenElse</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683122974"><span class="hs-identifier hs-type">e</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683122977"><span class="hs-identifier hs-type">trueBox</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683122980"><span class="hs-identifier hs-type">falseBox</span></a></span><span>
</span><span id="line-1030"></span><span>
</span><span id="line-1031"></span><span>
</span><span id="line-1032"></span><span>
</span><span id="line-1033"></span><span class="annot"><span class="hs-comment">-- *******************************************************************</span></span><span>
</span><span id="line-1034"></span><span>
</span><span id="line-1035"></span><span class="hs-comment">{- Note [decideBangHood]
~~~~~~~~~~~~~~~~~~~~~~~~
With -XStrict we may make /outermost/ patterns more strict.
E.g.
       let (Just x) = e in ...
          ==&gt;
       let !(Just x) = e in ...
and
       f x = e
          ==&gt;
       f !x = e

This adjustment is done by decideBangHood,

  * Just before constructing an EqnInfo, in GHC.HsToCore.Match
      (matchWrapper and matchSinglePat)

  * When desugaring a pattern-binding in GHC.HsToCore.Binds.dsHsBind

Note that it is /not/ done recursively.  See the -XStrict
spec in the user manual.

Specifically:
   ~pat    =&gt; pat    -- when -XStrict (even if pat = ~pat')
   !pat    =&gt; !pat   -- always
   pat     =&gt; !pat   -- when -XStrict
   pat     =&gt; pat    -- otherwise
-}</span><span>
</span><span id="line-1063"></span><span>
</span><span id="line-1064"></span><span>
</span><span id="line-1065"></span><span class="hs-comment">-- | Use -XStrict to add a ! or remove a ~</span><span>
</span><span id="line-1066"></span><span class="hs-comment">-- See Note [decideBangHood]</span><span>
</span><span id="line-1067"></span><span class="annot"><a href="GHC.HsToCore.Utils.html#decideBangHood"><span class="hs-identifier hs-type">decideBangHood</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Driver.DynFlags.html#DynFlags"><span class="hs-identifier hs-type">DynFlags</span></a></span><span>
</span><span id="line-1068"></span><span>               </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Language.Haskell.Syntax.Pat.html#LPat"><span class="hs-identifier hs-type">LPat</span></a></span><span> </span><span class="annot"><a href="GHC.Hs.Extension.html#GhcTc"><span class="hs-identifier hs-type">GhcTc</span></a></span><span>  </span><span class="annot"><span class="hs-comment">-- ^ Original pattern</span></span><span>
</span><span id="line-1069"></span><span>               </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Language.Haskell.Syntax.Pat.html#LPat"><span class="hs-identifier hs-type">LPat</span></a></span><span> </span><span class="annot"><a href="GHC.Hs.Extension.html#GhcTc"><span class="hs-identifier hs-type">GhcTc</span></a></span><span>  </span><span class="hs-comment">-- Pattern with bang if necessary</span><span>
</span><span id="line-1070"></span><span id="decideBangHood"><span class="annot"><span class="annottext">decideBangHood :: DynFlags -&gt; XRec GhcTc (Pat GhcTc) -&gt; XRec GhcTc (Pat GhcTc)
</span><a href="GHC.HsToCore.Utils.html#decideBangHood"><span class="hs-identifier hs-var hs-var">decideBangHood</span></a></span></span><span> </span><span id="local-6989586621683122982"><span class="annot"><span class="annottext">DynFlags
</span><a href="#local-6989586621683122982"><span class="hs-identifier hs-var">dflags</span></a></span></span><span> </span><span id="local-6989586621683122983"><span class="annot"><span class="annottext">XRec GhcTc (Pat GhcTc)
</span><a href="#local-6989586621683122983"><span class="hs-identifier hs-var">lpat</span></a></span></span><span>
</span><span id="line-1071"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Bool
</span><span class="hs-identifier hs-var">not</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Extension -&gt; DynFlags -&gt; Bool
</span><a href="GHC.Driver.DynFlags.html#xopt"><span class="hs-identifier hs-var">xopt</span></a></span><span> </span><span class="annot"><span class="annottext">Extension
</span><span class="hs-identifier hs-var">LangExt.Strict</span></span><span> </span><span class="annot"><span class="annottext">DynFlags
</span><a href="#local-6989586621683122982"><span class="hs-identifier hs-var">dflags</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1072"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">XRec GhcTc (Pat GhcTc)
</span><a href="#local-6989586621683122983"><span class="hs-identifier hs-var">lpat</span></a></span><span>
</span><span id="line-1073"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">otherwise</span></span><span>   </span><span class="hs-comment">--  -XStrict</span><span>
</span><span id="line-1074"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">GenLocated SrcSpanAnnA (Pat GhcTc)
-&gt; GenLocated SrcSpanAnnA (Pat GhcTc)
forall {p} {l}.
(XRec p (Pat p) ~ GenLocated l (Pat p), XBangPat p ~ NoExtField) =&gt;
GenLocated l (Pat p) -&gt; GenLocated l (Pat p)
</span><a href="#local-6989586621683122984"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="annot"><span class="annottext">XRec GhcTc (Pat GhcTc)
GenLocated SrcSpanAnnA (Pat GhcTc)
</span><a href="#local-6989586621683122983"><span class="hs-identifier hs-var">lpat</span></a></span><span>
</span><span id="line-1075"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-1076"></span><span>    </span><span id="local-6989586621683122984"><span class="annot"><span class="annottext">go :: GenLocated l (Pat p) -&gt; GenLocated l (Pat p)
</span><a href="#local-6989586621683122984"><span class="hs-identifier hs-var hs-var">go</span></a></span></span><span> </span><span id="local-6989586621683122989"><span class="annot"><span class="annottext">lp :: GenLocated l (Pat p)
</span><a href="#local-6989586621683122989"><span class="hs-identifier hs-var">lp</span></a></span></span><span class="hs-glyph">@</span><span class="hs-special">(</span><span class="annot"><a href="GHC.Types.SrcLoc.html#L"><span class="hs-identifier hs-type">L</span></a></span><span> </span><span id="local-6989586621683122990"><span class="annot"><span class="annottext">l
</span><a href="#local-6989586621683122990"><span class="hs-identifier hs-var">l</span></a></span></span><span> </span><span id="local-6989586621683122991"><span class="annot"><span class="annottext">Pat p
</span><a href="#local-6989586621683122991"><span class="hs-identifier hs-var">p</span></a></span></span><span class="hs-special">)</span><span>
</span><span id="line-1077"></span><span>      </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">Pat p
</span><a href="#local-6989586621683122991"><span class="hs-identifier hs-var">p</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-1078"></span><span>           </span><span class="annot"><a href="Language.Haskell.Syntax.Pat.html#ParPat"><span class="hs-identifier hs-type">ParPat</span></a></span><span> </span><span id="local-6989586621683122992"><span class="annot"><span class="annottext">XParPat p
</span><a href="#local-6989586621683122992"><span class="hs-identifier hs-var">x</span></a></span></span><span> </span><span id="local-6989586621683122993"><span class="annot"><span class="annottext">XRec p (Pat p)
</span><a href="#local-6989586621683122993"><span class="hs-identifier hs-var">p</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">l -&gt; Pat p -&gt; GenLocated l (Pat p)
forall l e. l -&gt; e -&gt; GenLocated l e
</span><a href="GHC.Types.SrcLoc.html#L"><span class="hs-identifier hs-var">L</span></a></span><span> </span><span class="annot"><span class="annottext">l
</span><a href="#local-6989586621683122990"><span class="hs-identifier hs-var">l</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">XParPat p -&gt; XRec p (Pat p) -&gt; Pat p
forall p. XParPat p -&gt; LPat p -&gt; Pat p
</span><a href="Language.Haskell.Syntax.Pat.html#ParPat"><span class="hs-identifier hs-var">ParPat</span></a></span><span> </span><span class="annot"><span class="annottext">XParPat p
</span><a href="#local-6989586621683122992"><span class="hs-identifier hs-var">x</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">GenLocated l (Pat p) -&gt; GenLocated l (Pat p)
</span><a href="#local-6989586621683122984"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="annot"><span class="annottext">XRec p (Pat p)
GenLocated l (Pat p)
</span><a href="#local-6989586621683122993"><span class="hs-identifier hs-var">p</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-1079"></span><span>           </span><span class="annot"><a href="Language.Haskell.Syntax.Pat.html#LazyPat"><span class="hs-identifier hs-type">LazyPat</span></a></span><span> </span><span class="annot"><span class="annottext">XLazyPat p
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621683122994"><span class="annot"><span class="annottext">XRec p (Pat p)
</span><a href="#local-6989586621683122994"><span class="hs-identifier hs-var">lp'</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">XRec p (Pat p)
GenLocated l (Pat p)
</span><a href="#local-6989586621683122994"><span class="hs-identifier hs-var">lp'</span></a></span><span>
</span><span id="line-1080"></span><span>           </span><span class="annot"><a href="Language.Haskell.Syntax.Pat.html#BangPat"><span class="hs-identifier hs-type">BangPat</span></a></span><span> </span><span class="annot"><span class="annottext">XBangPat p
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">XRec p (Pat p)
</span><span class="hs-identifier">_</span></span><span>   </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">GenLocated l (Pat p)
</span><a href="#local-6989586621683122989"><span class="hs-identifier hs-var">lp</span></a></span><span>
</span><span id="line-1081"></span><span>           </span><span class="annot"><span class="annottext">Pat p
</span><span class="hs-identifier">_</span></span><span>             </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">l -&gt; Pat p -&gt; GenLocated l (Pat p)
forall l e. l -&gt; e -&gt; GenLocated l e
</span><a href="GHC.Types.SrcLoc.html#L"><span class="hs-identifier hs-var">L</span></a></span><span> </span><span class="annot"><span class="annottext">l
</span><a href="#local-6989586621683122990"><span class="hs-identifier hs-var">l</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">XBangPat p -&gt; XRec p (Pat p) -&gt; Pat p
forall p. XBangPat p -&gt; LPat p -&gt; Pat p
</span><a href="Language.Haskell.Syntax.Pat.html#BangPat"><span class="hs-identifier hs-var">BangPat</span></a></span><span> </span><span class="annot"><span class="annottext">XBangPat p
NoExtField
</span><a href="Language.Haskell.Syntax.Extension.html#noExtField"><span class="hs-identifier hs-var">noExtField</span></a></span><span> </span><span class="annot"><span class="annottext">XRec p (Pat p)
GenLocated l (Pat p)
</span><a href="#local-6989586621683122989"><span class="hs-identifier hs-var">lp</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1082"></span><span>
</span><span id="line-1083"></span><span class="annot"><a href="GHC.HsToCore.Utils.html#isTrueLHsExpr"><span class="hs-identifier hs-type">isTrueLHsExpr</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Language.Haskell.Syntax.Expr.html#LHsExpr"><span class="hs-identifier hs-type">LHsExpr</span></a></span><span> </span><span class="annot"><a href="GHC.Hs.Extension.html#GhcTc"><span class="hs-identifier hs-type">GhcTc</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Maybe</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Core.html#CoreExpr"><span class="hs-identifier hs-type">CoreExpr</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.HsToCore.Types.html#DsM"><span class="hs-identifier hs-type">DsM</span></a></span><span> </span><span class="annot"><a href="GHC.Core.html#CoreExpr"><span class="hs-identifier hs-type">CoreExpr</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1084"></span><span>
</span><span id="line-1085"></span><span class="hs-comment">-- Returns Just {..} if we're sure that the expression is True</span><span>
</span><span id="line-1086"></span><span class="hs-comment">-- I.e.   * 'True' datacon</span><span>
</span><span id="line-1087"></span><span class="hs-comment">--        * 'otherwise' Id</span><span>
</span><span id="line-1088"></span><span class="hs-comment">--        * Trivial wrappings of these</span><span>
</span><span id="line-1089"></span><span class="hs-comment">-- The arguments to Just are any HsTicks that we have found,</span><span>
</span><span id="line-1090"></span><span class="hs-comment">-- because we still want to tick then, even it they are always evaluated.</span><span>
</span><span id="line-1091"></span><span id="isTrueLHsExpr"><span class="annot"><span class="annottext">isTrueLHsExpr :: LHsExpr GhcTc -&gt; Maybe (CoreExpr -&gt; DsM CoreExpr)
</span><a href="GHC.HsToCore.Utils.html#isTrueLHsExpr"><span class="hs-identifier hs-var hs-var">isTrueLHsExpr</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Types.SrcLoc.html#L"><span class="hs-identifier hs-type">L</span></a></span><span> </span><span class="annot"><span class="annottext">SrcSpanAnnA
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Language.Haskell.Syntax.Expr.html#HsVar"><span class="hs-identifier hs-type">HsVar</span></a></span><span> </span><span class="annot"><span class="annottext">XVar GhcTc
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Types.SrcLoc.html#L"><span class="hs-identifier hs-type">L</span></a></span><span> </span><span class="annot"><span class="annottext">SrcSpanAnnN
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621683122996"><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621683122996"><span class="hs-identifier hs-var">v</span></a></span></span><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-1092"></span><span>  </span><span class="hs-glyph">|</span><span>  </span><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621683122996"><span class="hs-identifier hs-var">v</span></a></span><span> </span><span class="annot"><span class="annottext">Var -&gt; Unique -&gt; Bool
forall a. Uniquable a =&gt; a -&gt; Unique -&gt; Bool
</span><a href="GHC.Types.Unique.html#hasKey"><span class="hs-operator hs-var">`hasKey`</span></a></span><span> </span><span class="annot"><span class="annottext">Unique
</span><a href="GHC.Builtin.Names.html#otherwiseIdKey"><span class="hs-identifier hs-var">otherwiseIdKey</span></a></span><span>
</span><span id="line-1093"></span><span>     </span><span class="annot"><span class="annottext">Bool -&gt; Bool -&gt; Bool
</span><span class="hs-operator hs-var">||</span></span><span> </span><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621683122996"><span class="hs-identifier hs-var">v</span></a></span><span> </span><span class="annot"><span class="annottext">Var -&gt; Unique -&gt; Bool
forall a. Uniquable a =&gt; a -&gt; Unique -&gt; Bool
</span><a href="GHC.Types.Unique.html#hasKey"><span class="hs-operator hs-var">`hasKey`</span></a></span><span> </span><span class="annot"><span class="annottext">Var -&gt; Unique
forall a. Uniquable a =&gt; a -&gt; Unique
</span><a href="GHC.Types.Unique.html#getUnique"><span class="hs-identifier hs-var">getUnique</span></a></span><span> </span><span class="annot"><span class="annottext">Var
</span><a href="GHC.Builtin.Types.html#trueDataConId"><span class="hs-identifier hs-var">trueDataConId</span></a></span><span>
</span><span id="line-1094"></span><span>                                              </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(CoreExpr -&gt; DsM CoreExpr) -&gt; Maybe (CoreExpr -&gt; DsM CoreExpr)
forall a. a -&gt; Maybe a
</span><span class="hs-identifier hs-var">Just</span></span><span> </span><span class="annot"><span class="annottext">CoreExpr -&gt; DsM CoreExpr
forall a. a -&gt; IOEnv (Env DsGblEnv DsLclEnv) a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span>
</span><span id="line-1095"></span><span>        </span><span class="hs-comment">-- trueDataConId doesn't have the same unique as trueDataCon</span><span>
</span><span id="line-1096"></span><span class="annot"><a href="GHC.HsToCore.Utils.html#isTrueLHsExpr"><span class="hs-identifier hs-var">isTrueLHsExpr</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Types.SrcLoc.html#L"><span class="hs-identifier hs-type">L</span></a></span><span> </span><span class="annot"><span class="annottext">SrcSpanAnnA
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Language.Haskell.Syntax.Expr.html#XExpr"><span class="hs-identifier hs-type">XExpr</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Hs.Expr.html#ConLikeTc"><span class="hs-identifier hs-type">ConLikeTc</span></a></span><span> </span><span id="local-6989586621683123002"><span class="annot"><span class="annottext">ConLike
</span><a href="#local-6989586621683123002"><span class="hs-identifier hs-var">con</span></a></span></span><span> </span><span class="annot"><span class="annottext">[Var]
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">[Scaled Mult]
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-1097"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">ConLike
</span><a href="#local-6989586621683123002"><span class="hs-identifier hs-var">con</span></a></span><span> </span><span class="annot"><span class="annottext">ConLike -&gt; Unique -&gt; Bool
forall a. Uniquable a =&gt; a -&gt; Unique -&gt; Bool
</span><a href="GHC.Types.Unique.html#hasKey"><span class="hs-operator hs-var">`hasKey`</span></a></span><span> </span><span class="annot"><span class="annottext">DataCon -&gt; Unique
forall a. Uniquable a =&gt; a -&gt; Unique
</span><a href="GHC.Types.Unique.html#getUnique"><span class="hs-identifier hs-var">getUnique</span></a></span><span> </span><span class="annot"><span class="annottext">DataCon
</span><a href="GHC.Builtin.Types.html#trueDataCon"><span class="hs-identifier hs-var">trueDataCon</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(CoreExpr -&gt; DsM CoreExpr) -&gt; Maybe (CoreExpr -&gt; DsM CoreExpr)
forall a. a -&gt; Maybe a
</span><span class="hs-identifier hs-var">Just</span></span><span> </span><span class="annot"><span class="annottext">CoreExpr -&gt; DsM CoreExpr
forall a. a -&gt; IOEnv (Env DsGblEnv DsLclEnv) a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span>
</span><span id="line-1098"></span><span class="annot"><a href="GHC.HsToCore.Utils.html#isTrueLHsExpr"><span class="hs-identifier hs-var">isTrueLHsExpr</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Types.SrcLoc.html#L"><span class="hs-identifier hs-type">L</span></a></span><span> </span><span class="annot"><span class="annottext">SrcSpanAnnA
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Language.Haskell.Syntax.Expr.html#XExpr"><span class="hs-identifier hs-type">XExpr</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Hs.Expr.html#HsTick"><span class="hs-identifier hs-type">HsTick</span></a></span><span> </span><span id="local-6989586621683123005"><span class="annot"><span class="annottext">CoreTickish
</span><a href="#local-6989586621683123005"><span class="hs-identifier hs-var">tickish</span></a></span></span><span> </span><span id="local-6989586621683123006"><span class="annot"><span class="annottext">LHsExpr GhcTc
</span><a href="#local-6989586621683123006"><span class="hs-identifier hs-var">e</span></a></span></span><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-1099"></span><span>    </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span id="local-6989586621683123007"><span class="annot"><span class="annottext">CoreExpr -&gt; DsM CoreExpr
</span><a href="#local-6989586621683123007"><span class="hs-identifier hs-var">ticks</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">LHsExpr GhcTc -&gt; Maybe (CoreExpr -&gt; DsM CoreExpr)
</span><a href="GHC.HsToCore.Utils.html#isTrueLHsExpr"><span class="hs-identifier hs-var">isTrueLHsExpr</span></a></span><span> </span><span class="annot"><span class="annottext">LHsExpr GhcTc
</span><a href="#local-6989586621683123006"><span class="hs-identifier hs-var">e</span></a></span><span>
</span><span id="line-1100"></span><span>    </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(CoreExpr -&gt; DsM CoreExpr) -&gt; Maybe (CoreExpr -&gt; DsM CoreExpr)
forall a. a -&gt; Maybe a
</span><span class="hs-identifier hs-var">Just</span></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span id="local-6989586621683123008"><span class="annot"><span class="annottext">CoreExpr
</span><a href="#local-6989586621683123008"><span class="hs-identifier hs-var">x</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span> </span><span id="local-6989586621683123009"><span class="annot"><a href="#local-6989586621683123009"><span class="hs-identifier hs-var">wrapped</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">CoreExpr -&gt; DsM CoreExpr
</span><a href="#local-6989586621683123007"><span class="hs-identifier hs-var">ticks</span></a></span><span> </span><span class="annot"><span class="annottext">CoreExpr
</span><a href="#local-6989586621683123008"><span class="hs-identifier hs-var">x</span></a></span><span>
</span><span id="line-1101"></span><span>                     </span><span class="annot"><span class="hs-identifier hs-type">return</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Core.html#Tick"><span class="hs-identifier hs-type">Tick</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683123005"><span class="hs-identifier hs-type">tickish</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683123009"><span class="hs-identifier hs-type">wrapped</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-1102"></span><span>   </span><span class="hs-comment">-- This encodes that the result is constant True for Hpc tick purposes;</span><span>
</span><span id="line-1103"></span><span>   </span><span class="hs-comment">-- which is specifically what isTrueLHsExpr is trying to find out.</span><span>
</span><span id="line-1104"></span><span class="annot"><a href="GHC.HsToCore.Utils.html#isTrueLHsExpr"><span class="hs-identifier hs-var">isTrueLHsExpr</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Types.SrcLoc.html#L"><span class="hs-identifier hs-type">L</span></a></span><span> </span><span class="annot"><span class="annottext">SrcSpanAnnA
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Language.Haskell.Syntax.Expr.html#XExpr"><span class="hs-identifier hs-type">XExpr</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Hs.Expr.html#HsBinTick"><span class="hs-identifier hs-type">HsBinTick</span></a></span><span> </span><span id="local-6989586621683123011"><span class="annot"><span class="annottext">ConTag
</span><a href="#local-6989586621683123011"><span class="hs-identifier hs-var">ixT</span></a></span></span><span> </span><span class="annot"><span class="annottext">ConTag
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621683123012"><span class="annot"><span class="annottext">LHsExpr GhcTc
</span><a href="#local-6989586621683123012"><span class="hs-identifier hs-var">e</span></a></span></span><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-1105"></span><span>    </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span id="local-6989586621683123013"><span class="annot"><span class="annottext">CoreExpr -&gt; DsM CoreExpr
</span><a href="#local-6989586621683123013"><span class="hs-identifier hs-var">ticks</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">LHsExpr GhcTc -&gt; Maybe (CoreExpr -&gt; DsM CoreExpr)
</span><a href="GHC.HsToCore.Utils.html#isTrueLHsExpr"><span class="hs-identifier hs-var">isTrueLHsExpr</span></a></span><span> </span><span class="annot"><span class="annottext">LHsExpr GhcTc
</span><a href="#local-6989586621683123012"><span class="hs-identifier hs-var">e</span></a></span><span>
</span><span id="line-1106"></span><span>    </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(CoreExpr -&gt; DsM CoreExpr) -&gt; Maybe (CoreExpr -&gt; DsM CoreExpr)
forall a. a -&gt; Maybe a
</span><span class="hs-identifier hs-var">Just</span></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span id="local-6989586621683123014"><span class="annot"><span class="annottext">CoreExpr
</span><a href="#local-6989586621683123014"><span class="hs-identifier hs-var">x</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span> </span><span id="local-6989586621683123015"><span class="annot"><a href="#local-6989586621683123015"><span class="hs-identifier hs-var">e</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">CoreExpr -&gt; DsM CoreExpr
</span><a href="#local-6989586621683123013"><span class="hs-identifier hs-var">ticks</span></a></span><span> </span><span class="annot"><span class="annottext">CoreExpr
</span><a href="#local-6989586621683123014"><span class="hs-identifier hs-var">x</span></a></span><span>
</span><span id="line-1107"></span><span>                     </span><span id="local-6989586621683123016"><span class="annot"><a href="#local-6989586621683123016"><span class="hs-identifier hs-var">this_mod</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><a href="GHC.Unit.Module.html#getModule"><span class="hs-identifier hs-type">getModule</span></a></span><span>
</span><span id="line-1108"></span><span>                     </span><span class="annot"><span class="hs-identifier hs-type">return</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Core.html#Tick"><span class="hs-identifier hs-type">Tick</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Types.Tickish.html#HpcTick"><span class="hs-identifier hs-type">HpcTick</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683123016"><span class="hs-identifier hs-type">this_mod</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683123011"><span class="hs-identifier hs-type">ixT</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><a href="#local-6989586621683123015"><span class="hs-identifier hs-type">e</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-1109"></span><span>
</span><span id="line-1110"></span><span class="annot"><a href="GHC.HsToCore.Utils.html#isTrueLHsExpr"><span class="hs-identifier hs-var">isTrueLHsExpr</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Types.SrcLoc.html#L"><span class="hs-identifier hs-type">L</span></a></span><span> </span><span class="annot"><span class="annottext">SrcSpanAnnA
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Language.Haskell.Syntax.Expr.html#HsPar"><span class="hs-identifier hs-type">HsPar</span></a></span><span> </span><span class="annot"><span class="annottext">XPar GhcTc
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621683123018"><span class="annot"><span class="annottext">LHsExpr GhcTc
</span><a href="#local-6989586621683123018"><span class="hs-identifier hs-var">e</span></a></span></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">LHsExpr GhcTc -&gt; Maybe (CoreExpr -&gt; DsM CoreExpr)
</span><a href="GHC.HsToCore.Utils.html#isTrueLHsExpr"><span class="hs-identifier hs-var">isTrueLHsExpr</span></a></span><span> </span><span class="annot"><span class="annottext">LHsExpr GhcTc
</span><a href="#local-6989586621683123018"><span class="hs-identifier hs-var">e</span></a></span><span>
</span><span id="line-1111"></span><span class="annot"><a href="GHC.HsToCore.Utils.html#isTrueLHsExpr"><span class="hs-identifier hs-var">isTrueLHsExpr</span></a></span><span> </span><span class="annot"><span class="annottext">LHsExpr GhcTc
</span><span class="hs-identifier">_</span></span><span>                 </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Maybe (CoreExpr -&gt; DsM CoreExpr)
forall a. Maybe a
</span><span class="hs-identifier hs-var">Nothing</span></span><span>
</span><span id="line-1112"></span><span>
</span><span id="line-1113"></span><span class="hs-comment">-- See Note [Coercions returned from tcSubMult] in GHC.Tc.Utils.Unify.</span><span>
</span><span id="line-1114"></span><span class="annot"><a href="GHC.HsToCore.Utils.html#checkMultiplicityCoercions"><span class="hs-identifier hs-type">checkMultiplicityCoercions</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Tc.Types.Evidence.html#MultiplicityCheckCoercions"><span class="hs-identifier hs-type">MultiplicityCheckCoercions</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.HsToCore.Types.html#DsM"><span class="hs-identifier hs-type">DsM</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-1115"></span><span id="checkMultiplicityCoercions"><span class="annot"><span class="annottext">checkMultiplicityCoercions :: MultiplicityCheckCoercions -&gt; IOEnv (Env DsGblEnv DsLclEnv) ()
</span><a href="GHC.HsToCore.Utils.html#checkMultiplicityCoercions"><span class="hs-identifier hs-var hs-var">checkMultiplicityCoercions</span></a></span></span><span> </span><span id="local-6989586621683123019"><span class="annot"><span class="annottext">MultiplicityCheckCoercions
</span><a href="#local-6989586621683123019"><span class="hs-identifier hs-var">cos</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-1116"></span><span>  </span><span class="annot"><span class="annottext">Bool
-&gt; IOEnv (Env DsGblEnv DsLclEnv) ()
-&gt; IOEnv (Env DsGblEnv DsLclEnv) ()
forall (f :: * -&gt; *). Applicative f =&gt; Bool -&gt; f () -&gt; f ()
</span><span class="hs-identifier hs-var">unless</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(Coercion -&gt; Bool) -&gt; MultiplicityCheckCoercions -&gt; Bool
forall (t :: * -&gt; *) a. Foldable t =&gt; (a -&gt; Bool) -&gt; t a -&gt; Bool
</span><span class="hs-identifier hs-var">all</span></span><span> </span><span class="annot"><span class="annottext">Coercion -&gt; Bool
</span><a href="GHC.Core.Coercion.html#isReflexiveCo"><span class="hs-identifier hs-var">isReflexiveCo</span></a></span><span> </span><span class="annot"><span class="annottext">MultiplicityCheckCoercions
</span><a href="#local-6989586621683123019"><span class="hs-identifier hs-var">cos</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(IOEnv (Env DsGblEnv DsLclEnv) ()
 -&gt; IOEnv (Env DsGblEnv DsLclEnv) ())
-&gt; IOEnv (Env DsGblEnv DsLclEnv) ()
-&gt; IOEnv (Env DsGblEnv DsLclEnv) ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-1117"></span><span>    </span><span class="annot"><span class="annottext">DsMessage -&gt; IOEnv (Env DsGblEnv DsLclEnv) ()
</span><a href="GHC.HsToCore.Monad.html#diagnosticDs"><span class="hs-identifier hs-var">diagnosticDs</span></a></span><span> </span><span class="annot"><span class="annottext">DsMessage
</span><a href="GHC.HsToCore.Errors.Types.html#DsMultiplicityCoercionsNotSupported"><span class="hs-identifier hs-var">DsMultiplicityCoercionsNotSupported</span></a></span><span>
</span><span id="line-1118"></span></pre></body></html>