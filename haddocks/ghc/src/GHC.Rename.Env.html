<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><link rel="stylesheet" type="text/css" href="style.css" /><script type="text/javascript" src="highlight.js"></script></head><body><pre><span class="hs-pragma">{-# LANGUAGE FlexibleContexts #-}</span><span>
</span><span id="line-2"></span><span class="hs-pragma">{-# LANGUAGE GADTs            #-}</span><span>
</span><span id="line-3"></span><span class="hs-pragma">{-# LANGUAGE MultiWayIf       #-}</span><span>
</span><span id="line-4"></span><span class="hs-pragma">{-# LANGUAGE TypeApplications #-}</span><span>
</span><span id="line-5"></span><span class="hs-pragma">{-# LANGUAGE TupleSections    #-}</span><span>
</span><span id="line-6"></span><span>
</span><span id="line-7"></span><span class="hs-comment">{-
(c) The GRASP/AQUA Project, Glasgow University, 1992-2006

GHC.Rename.Env contains functions which convert RdrNames into Names.

-}</span><span>
</span><span id="line-13"></span><span>
</span><span id="line-14"></span><span class="hs-keyword">module</span><span> </span><span class="annot"><a href="GHC.Rename.Env.html"><span class="hs-identifier">GHC.Rename.Env</span></a></span><span> </span><span class="hs-special">(</span><span>
</span><span id="line-15"></span><span>        </span><span class="annot"><a href="GHC.Rename.Env.html#newTopSrcBinder"><span class="hs-identifier">newTopSrcBinder</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-16"></span><span>
</span><span id="line-17"></span><span>        </span><span class="annot"><a href="GHC.Rename.Env.html#lookupLocatedTopBndrRn"><span class="hs-identifier">lookupLocatedTopBndrRn</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Rename.Env.html#lookupLocatedTopBndrRnN"><span class="hs-identifier">lookupLocatedTopBndrRnN</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Rename.Env.html#lookupTopBndrRn"><span class="hs-identifier">lookupTopBndrRn</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-18"></span><span>        </span><span class="annot"><a href="GHC.Rename.Env.html#lookupLocatedTopConstructorRn"><span class="hs-identifier">lookupLocatedTopConstructorRn</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Rename.Env.html#lookupLocatedTopConstructorRnN"><span class="hs-identifier">lookupLocatedTopConstructorRnN</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-19"></span><span>
</span><span id="line-20"></span><span>        </span><span class="annot"><a href="GHC.Rename.Env.html#lookupLocatedOccRn"><span class="hs-identifier">lookupLocatedOccRn</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Rename.Env.html#lookupLocatedOccRnConstr"><span class="hs-identifier">lookupLocatedOccRnConstr</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Rename.Env.html#lookupLocatedOccRnRecField"><span class="hs-identifier">lookupLocatedOccRnRecField</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-21"></span><span>        </span><span class="annot"><a href="GHC.Rename.Env.html#lookupLocatedOccRnNone"><span class="hs-identifier">lookupLocatedOccRnNone</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-22"></span><span>        </span><span class="annot"><a href="GHC.Rename.Env.html#lookupOccRn"><span class="hs-identifier">lookupOccRn</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Rename.Env.html#lookupOccRn_maybe"><span class="hs-identifier">lookupOccRn_maybe</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Rename.Env.html#lookupSameOccRn_maybe"><span class="hs-identifier">lookupSameOccRn_maybe</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-23"></span><span>        </span><span class="annot"><a href="GHC.Rename.Env.html#lookupLocalOccRn_maybe"><span class="hs-identifier">lookupLocalOccRn_maybe</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Rename.Env.html#lookupInfoOccRn"><span class="hs-identifier">lookupInfoOccRn</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-24"></span><span>        </span><span class="annot"><a href="GHC.Rename.Env.html#lookupLocalOccThLvl_maybe"><span class="hs-identifier">lookupLocalOccThLvl_maybe</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Rename.Env.html#lookupLocalOccRn"><span class="hs-identifier">lookupLocalOccRn</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-25"></span><span>        </span><span class="annot"><a href="GHC.Rename.Env.html#lookupTypeOccRn"><span class="hs-identifier">lookupTypeOccRn</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-26"></span><span>        </span><span class="annot"><a href="GHC.Rename.Env.html#lookupGlobalOccRn"><span class="hs-identifier">lookupGlobalOccRn</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Rename.Env.html#lookupGlobalOccRn_maybe"><span class="hs-identifier">lookupGlobalOccRn_maybe</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-27"></span><span>
</span><span id="line-28"></span><span>        </span><span class="annot"><a href="GHC.Rename.Env.html#lookupExprOccRn"><span class="hs-identifier">lookupExprOccRn</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-29"></span><span>        </span><span class="annot"><a href="GHC.Rename.Env.html#lookupRecFieldOcc"><span class="hs-identifier">lookupRecFieldOcc</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-30"></span><span>        </span><span class="annot"><a href="GHC.Rename.Env.html#lookupRecUpdFields"><span class="hs-identifier">lookupRecUpdFields</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-31"></span><span>        </span><span class="annot"><a href="GHC.Rename.Env.html#getFieldUpdLbl"><span class="hs-identifier">getFieldUpdLbl</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-32"></span><span>        </span><span class="annot"><a href="GHC.Rename.Env.html#getUpdFieldLbls"><span class="hs-identifier">getUpdFieldLbls</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-33"></span><span>
</span><span id="line-34"></span><span>        </span><span class="annot"><a href="GHC.Rename.Env.html#ChildLookupResult"><span class="hs-identifier">ChildLookupResult</span></a></span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span>
</span><span id="line-35"></span><span>        </span><span class="annot"><a href="GHC.Rename.Env.html#lookupSubBndrOcc_helper"><span class="hs-identifier">lookupSubBndrOcc_helper</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-36"></span><span>
</span><span id="line-37"></span><span>        </span><span class="annot"><a href="GHC.Rename.Env.html#HsSigCtxt"><span class="hs-identifier">HsSigCtxt</span></a></span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Rename.Env.html#lookupLocalTcNames"><span class="hs-identifier">lookupLocalTcNames</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Rename.Env.html#lookupSigOccRn"><span class="hs-identifier">lookupSigOccRn</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Rename.Env.html#lookupSigOccRnN"><span class="hs-identifier">lookupSigOccRnN</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-38"></span><span>        </span><span class="annot"><a href="GHC.Rename.Env.html#lookupSigCtxtOccRn"><span class="hs-identifier">lookupSigCtxtOccRn</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-39"></span><span>
</span><span id="line-40"></span><span>        </span><span class="annot"><a href="GHC.Rename.Env.html#lookupInstDeclBndr"><span class="hs-identifier">lookupInstDeclBndr</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Rename.Env.html#lookupFamInstName"><span class="hs-identifier">lookupFamInstName</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-41"></span><span>        </span><span class="annot"><a href="GHC.Rename.Env.html#lookupConstructorInfo"><span class="hs-identifier">lookupConstructorInfo</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Rename.Env.html#lookupConstructorFields"><span class="hs-identifier">lookupConstructorFields</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-42"></span><span>        </span><span class="annot"><a href="GHC.Rename.Env.html#lookupGREInfo"><span class="hs-identifier">lookupGREInfo</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-43"></span><span>
</span><span id="line-44"></span><span>        </span><span class="annot"><a href="GHC.Rename.Env.html#irrefutableConLikeRn"><span class="hs-identifier">irrefutableConLikeRn</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Rename.Env.html#irrefutableConLikeTc"><span class="hs-identifier">irrefutableConLikeTc</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-45"></span><span>
</span><span id="line-46"></span><span>        </span><span class="annot"><a href="GHC.Rename.Env.html#lookupGreAvailRn"><span class="hs-identifier">lookupGreAvailRn</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-47"></span><span>
</span><span id="line-48"></span><span>        </span><span class="hs-comment">-- Rebindable Syntax</span><span>
</span><span id="line-49"></span><span>        </span><span class="annot"><a href="GHC.Rename.Env.html#lookupSyntax"><span class="hs-identifier">lookupSyntax</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Rename.Env.html#lookupSyntaxExpr"><span class="hs-identifier">lookupSyntaxExpr</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Rename.Env.html#lookupSyntaxNames"><span class="hs-identifier">lookupSyntaxNames</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-50"></span><span>        </span><span class="annot"><a href="GHC.Rename.Env.html#lookupSyntaxName"><span class="hs-identifier">lookupSyntaxName</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-51"></span><span>        </span><span class="annot"><a href="GHC.Rename.Env.html#lookupIfThenElse"><span class="hs-identifier">lookupIfThenElse</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-52"></span><span>
</span><span id="line-53"></span><span>        </span><span class="hs-comment">-- QualifiedDo</span><span>
</span><span id="line-54"></span><span>        </span><span class="annot"><a href="GHC.Rename.Env.html#lookupQualifiedDoExpr"><span class="hs-identifier">lookupQualifiedDoExpr</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Rename.Env.html#lookupQualifiedDo"><span class="hs-identifier">lookupQualifiedDo</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-55"></span><span>        </span><span class="annot"><a href="GHC.Rename.Env.html#lookupQualifiedDoName"><span class="hs-identifier">lookupQualifiedDoName</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Rename.Env.html#lookupNameWithQualifier"><span class="hs-identifier">lookupNameWithQualifier</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-56"></span><span>
</span><span id="line-57"></span><span>        </span><span class="hs-comment">-- Constructing usage information</span><span>
</span><span id="line-58"></span><span>        </span><span class="annot"><a href="GHC.Rename.Utils.html#DeprecationWarnings"><span class="hs-identifier">DeprecationWarnings</span></a></span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span>
</span><span id="line-59"></span><span>        </span><span class="annot"><a href="GHC.Rename.Env.html#addUsedGRE"><span class="hs-identifier">addUsedGRE</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Rename.Env.html#addUsedGREs"><span class="hs-identifier">addUsedGREs</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Rename.Env.html#addUsedDataCons"><span class="hs-identifier">addUsedDataCons</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-60"></span><span>
</span><span id="line-61"></span><span>        </span><span class="annot"><a href="GHC.Rename.Env.html#dataTcOccs"><span class="hs-identifier">dataTcOccs</span></a></span><span class="hs-special">,</span><span> </span><span class="hs-comment">--TODO: Move this somewhere, into utils?</span><span>
</span><span id="line-62"></span><span>
</span><span id="line-63"></span><span>    </span><span class="hs-special">)</span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-64"></span><span>
</span><span id="line-65"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Prelude.html"><span class="hs-identifier">GHC.Prelude</span></a></span><span>
</span><span id="line-66"></span><span>
</span><span id="line-67"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Language.Haskell.Syntax.Basic.html"><span class="hs-identifier">Language.Haskell.Syntax.Basic</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Language.Haskell.Syntax.Basic.html#FieldLabelString"><span class="hs-identifier">FieldLabelString</span></a></span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-68"></span><span>
</span><span id="line-69"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Iface.Load.html"><span class="hs-identifier">GHC.Iface.Load</span></a></span><span>
</span><span id="line-70"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Iface.Env.html"><span class="hs-identifier">GHC.Iface.Env</span></a></span><span>
</span><span id="line-71"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Hs.html"><span class="hs-identifier">GHC.Hs</span></a></span><span>
</span><span id="line-72"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Types.Name.Reader.html"><span class="hs-identifier">GHC.Types.Name.Reader</span></a></span><span>
</span><span id="line-73"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Tc.Errors.Types.html"><span class="hs-identifier">GHC.Tc.Errors.Types</span></a></span><span>
</span><span id="line-74"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Tc.Errors.Ppr.html"><span class="hs-identifier">GHC.Tc.Errors.Ppr</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Tc.Errors.Ppr.html#pprScopeError"><span class="hs-identifier">pprScopeError</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-75"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.Env.html"><span class="hs-identifier">GHC.Tc.Utils.Env</span></a></span><span>
</span><span id="line-76"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Tc.Types.LclEnv.html"><span class="hs-identifier">GHC.Tc.Types.LclEnv</span></a></span><span>
</span><span id="line-77"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.Monad.html"><span class="hs-identifier">GHC.Tc.Utils.Monad</span></a></span><span>
</span><span id="line-78"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Parser.PostProcess.html"><span class="hs-identifier">GHC.Parser.PostProcess</span></a></span><span> </span><span class="hs-special">(</span><span> </span><span class="annot"><a href="GHC.Parser.PostProcess.html#setRdrNameSpace"><span class="hs-identifier">setRdrNameSpace</span></a></span><span> </span><span class="hs-special">)</span><span>
</span><span id="line-79"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Builtin.Types.html"><span class="hs-identifier">GHC.Builtin.Types</span></a></span><span>
</span><span id="line-80"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Types.Name.html"><span class="hs-identifier">GHC.Types.Name</span></a></span><span>
</span><span id="line-81"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Types.Name.Set.html"><span class="hs-identifier">GHC.Types.Name.Set</span></a></span><span>
</span><span id="line-82"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Types.Name.Env.html"><span class="hs-identifier">GHC.Types.Name.Env</span></a></span><span>
</span><span id="line-83"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Types.Avail.html"><span class="hs-identifier">GHC.Types.Avail</span></a></span><span>
</span><span id="line-84"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Types.Hint.html"><span class="hs-identifier">GHC.Types.Hint</span></a></span><span>
</span><span id="line-85"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Types.Error.html"><span class="hs-identifier">GHC.Types.Error</span></a></span><span>
</span><span id="line-86"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Unit.Module.html"><span class="hs-identifier">GHC.Unit.Module</span></a></span><span>
</span><span id="line-87"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Unit.Module.ModIface.html"><span class="hs-identifier">GHC.Unit.Module.ModIface</span></a></span><span>
</span><span id="line-88"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Core.ConLike.html"><span class="hs-identifier">GHC.Core.ConLike</span></a></span><span>
</span><span id="line-89"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Core.DataCon.html"><span class="hs-identifier">GHC.Core.DataCon</span></a></span><span>
</span><span id="line-90"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Core.TyCon.html"><span class="hs-identifier">GHC.Core.TyCon</span></a></span><span>
</span><span id="line-91"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Builtin.Names.html"><span class="hs-identifier">GHC.Builtin.Names</span></a></span><span class="hs-special">(</span><span> </span><span class="annot"><a href="GHC.Builtin.Names.html#rOOT_MAIN"><span class="hs-identifier">rOOT_MAIN</span></a></span><span> </span><span class="hs-special">)</span><span>
</span><span id="line-92"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Types.Basic.html"><span class="hs-identifier">GHC.Types.Basic</span></a></span><span>  </span><span class="hs-special">(</span><span> </span><span class="annot"><a href="GHC.Types.Basic.html#TopLevelFlag"><span class="hs-identifier">TopLevelFlag</span></a></span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Types.Basic.html#TupleSort"><span class="hs-identifier">TupleSort</span></a></span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Types.Basic.html#tupleSortBoxity"><span class="hs-identifier">tupleSortBoxity</span></a></span><span> </span><span class="hs-special">)</span><span>
</span><span id="line-93"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Types.TyThing.html"><span class="hs-identifier">GHC.Types.TyThing</span></a></span><span> </span><span class="hs-special">(</span><span> </span><span class="annot"><a href="GHC.Types.TyThing.html#tyThingGREInfo"><span class="hs-identifier">tyThingGREInfo</span></a></span><span> </span><span class="hs-special">)</span><span>
</span><span id="line-94"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Types.SrcLoc.html"><span class="hs-identifier">GHC.Types.SrcLoc</span></a></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">SrcLoc</span></span><span>
</span><span id="line-95"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Utils.Outputable.html"><span class="hs-identifier">GHC.Utils.Outputable</span></a></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">Outputable</span></span><span>
</span><span id="line-96"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Types.Unique.FM.html"><span class="hs-identifier">GHC.Types.Unique.FM</span></a></span><span>
</span><span id="line-97"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Types.Unique.DSet.html"><span class="hs-identifier">GHC.Types.Unique.DSet</span></a></span><span>
</span><span id="line-98"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Types.Unique.Set.html"><span class="hs-identifier">GHC.Types.Unique.Set</span></a></span><span>
</span><span id="line-99"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Utils.Misc.html"><span class="hs-identifier">GHC.Utils.Misc</span></a></span><span>
</span><span id="line-100"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Utils.Panic.html"><span class="hs-identifier">GHC.Utils.Panic</span></a></span><span>
</span><span id="line-101"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Data.Maybe.html"><span class="hs-identifier">GHC.Data.Maybe</span></a></span><span>
</span><span id="line-102"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Driver.Env.html"><span class="hs-identifier">GHC.Driver.Env</span></a></span><span>
</span><span id="line-103"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Driver.Session.html"><span class="hs-identifier">GHC.Driver.Session</span></a></span><span>
</span><span id="line-104"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Data.FastString.html"><span class="hs-identifier">GHC.Data.FastString</span></a></span><span>
</span><span id="line-105"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Data.List.SetOps.html"><span class="hs-identifier">GHC.Data.List.SetOps</span></a></span><span> </span><span class="hs-special">(</span><span> </span><span class="annot"><a href="GHC.Data.List.SetOps.html#minusList"><span class="hs-identifier">minusList</span></a></span><span> </span><span class="hs-special">)</span><span>
</span><span id="line-106"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><a href="../../ghc-boot-9.12.2-1a37/src/GHC.LanguageExtensions.html"><span class="hs-identifier">GHC.LanguageExtensions</span></a></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">LangExt</span></span><span>
</span><span id="line-107"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Rename.Unbound.html"><span class="hs-identifier">GHC.Rename.Unbound</span></a></span><span>
</span><span id="line-108"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Rename.Utils.html"><span class="hs-identifier">GHC.Rename.Utils</span></a></span><span>
</span><span id="line-109"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Data.Bag.html"><span class="hs-identifier">GHC.Data.Bag</span></a></span><span>
</span><span id="line-110"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Types.CompleteMatch.html"><span class="hs-identifier">GHC.Types.CompleteMatch</span></a></span><span>
</span><span id="line-111"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Types.PkgQual.html"><span class="hs-identifier">GHC.Types.PkgQual</span></a></span><span>
</span><span id="line-112"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Types.GREInfo.html"><span class="hs-identifier">GHC.Types.GREInfo</span></a></span><span>
</span><span id="line-113"></span><span>
</span><span id="line-114"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="../../base-4.21.0.0-ae91/src/Control.Arrow.html"><span class="hs-identifier">Control.Arrow</span></a></span><span>    </span><span class="hs-special">(</span><span> </span><span class="annot"><span class="hs-identifier">first</span></span><span> </span><span class="hs-special">)</span><span>
</span><span id="line-115"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="../../base-4.21.0.0-ae91/src/Control.Monad.html"><span class="hs-identifier">Control.Monad</span></a></span><span>
</span><span id="line-116"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="../../base-4.21.0.0-ae91/src/Data.Either.html"><span class="hs-identifier">Data.Either</span></a></span><span>      </span><span class="hs-special">(</span><span> </span><span class="annot"><span class="hs-identifier">partitionEithers</span></span><span> </span><span class="hs-special">)</span><span>
</span><span id="line-117"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="../../base-4.21.0.0-ae91/src/Data.Function.html"><span class="hs-identifier">Data.Function</span></a></span><span>    </span><span class="hs-special">(</span><span> </span><span class="annot"><span class="hs-identifier">on</span></span><span> </span><span class="hs-special">)</span><span>
</span><span id="line-118"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="../../base-4.21.0.0-ae91/src/Data.List.html"><span class="hs-identifier">Data.List</span></a></span><span>        </span><span class="hs-special">(</span><span> </span><span class="annot"><span class="hs-identifier">find</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">partition</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">groupBy</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">sortBy</span></span><span> </span><span class="hs-special">)</span><span>
</span><span id="line-119"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><a href="../../base-4.21.0.0-ae91/src/Data.List.NonEmpty.html"><span class="hs-identifier">Data.List.NonEmpty</span></a></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">NE</span></span><span>
</span><span id="line-120"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><a href="../../base-4.21.0.0-ae91/src/Data.Semigroup.html"><span class="hs-identifier">Data.Semigroup</span></a></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">Semi</span></span><span>
</span><span id="line-121"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="../../base-4.21.0.0-ae91/src/System.IO.Unsafe.html"><span class="hs-identifier">System.IO.Unsafe</span></a></span><span> </span><span class="hs-special">(</span><span> </span><span class="annot"><span class="hs-identifier">unsafePerformIO</span></span><span> </span><span class="hs-special">)</span><span>
</span><span id="line-122"></span><span>
</span><span id="line-123"></span><span class="hs-comment">{-
*********************************************************
*                                                      *
                Source-code binders
*                                                      *
*********************************************************

Note [Signature lazy interface loading]
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~

GHC's lazy interface loading can be a bit confusing, so this Note is an
empirical description of what happens in one interesting case. When
compiling a signature module against an its implementation, we do NOT
load interface files associated with its names until after the type
checking phase.  For example:

    module ASig where
        data T
        f :: T -&gt; T

Suppose we compile this with -sig-of &quot;A is ASig&quot;:

    module B where
        data T = T
        f T = T

    module A(module B) where
        import B

During type checking, we'll load A.hi because we need to know what the
RdrEnv for the module is, but we DO NOT load the interface for B.hi!
It's wholly unnecessary: our local definition 'data T' in ASig is all
the information we need to finish type checking.  This is contrast to
type checking of ordinary Haskell files, in which we would not have the
local definition &quot;data T&quot; and would need to consult B.hi immediately.
(Also, this situation never occurs for hs-boot files, since you're not
allowed to reexport from another module.)

After type checking, we then check that the types we provided are
consistent with the backing implementation (in checkHiBootOrHsigIface).
At this point, B.hi is loaded, because we need something to compare
against.

I discovered this behavior when trying to figure out why type class
instances for Data.Map weren't in the EPS when I was type checking a
test very much like ASig (sigof02dm): the associated interface hadn't
been loaded yet!  (The larger issue is a moot point, since an instance
declared in a signature can never be a duplicate.)

This behavior might change in the future.  Consider this
alternate module B:

    module B where
        {-# DEPRECATED T, f &quot;Don't use&quot; #-}
        data T = T
        f T = T

One might conceivably want to report deprecation warnings when compiling
ASig with -sig-of B, in which case we need to look at B.hi to find the
deprecation warnings during renaming.  At the moment, you don't get any
warning until you use the identifier further downstream.  This would
require adjusting addUsedGRE so that during signature compilation,
we do not report deprecation warnings for LocalDef.  See also
Note [Handling of deprecations] in GHC.Rename.Utils
-}</span><span>
</span><span id="line-188"></span><span>
</span><span id="line-189"></span><span class="annot"><a href="GHC.Rename.Env.html#newTopSrcBinder"><span class="hs-identifier hs-type">newTopSrcBinder</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Parser.Annotation.html#LocatedN"><span class="hs-identifier hs-type">LocatedN</span></a></span><span> </span><span class="annot"><a href="GHC.Types.Name.Reader.html#RdrName"><span class="hs-identifier hs-type">RdrName</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#RnM"><span class="hs-identifier hs-type">RnM</span></a></span><span> </span><span class="annot"><a href="GHC.Types.Name.html#Name"><span class="hs-identifier hs-type">Name</span></a></span><span>
</span><span id="line-190"></span><span id="newTopSrcBinder"><span class="annot"><span class="annottext">newTopSrcBinder :: LocatedN RdrName -&gt; RnM Name
</span><a href="GHC.Rename.Env.html#newTopSrcBinder"><span class="hs-identifier hs-var hs-var">newTopSrcBinder</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Types.SrcLoc.html#L"><span class="hs-identifier hs-type">L</span></a></span><span> </span><span id="local-6989586621683035282"><span class="annot"><span class="annottext">SrcSpanAnnN
</span><a href="#local-6989586621683035282"><span class="hs-identifier hs-var">loc</span></a></span></span><span> </span><span id="local-6989586621683035283"><span class="annot"><span class="annottext">RdrName
</span><a href="#local-6989586621683035283"><span class="hs-identifier hs-var">rdr_name</span></a></span></span><span class="hs-special">)</span><span>
</span><span id="line-191"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span id="local-6989586621683035284"><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621683035284"><span class="hs-identifier hs-var">name</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">RdrName -&gt; Maybe Name
</span><a href="GHC.Types.Name.Reader.html#isExact_maybe"><span class="hs-identifier hs-var">isExact_maybe</span></a></span><span> </span><span class="annot"><span class="annottext">RdrName
</span><a href="#local-6989586621683035283"><span class="hs-identifier hs-var">rdr_name</span></a></span><span>
</span><span id="line-192"></span><span>  </span><span class="hs-glyph">=</span><span>     </span><span class="hs-comment">-- This is here to catch</span><span>
</span><span id="line-193"></span><span>        </span><span class="hs-comment">--   (a) Exact-name binders created by Template Haskell</span><span>
</span><span id="line-194"></span><span>        </span><span class="hs-comment">--   (b) The PrelBase defn of (say) [] and similar, for which</span><span>
</span><span id="line-195"></span><span>        </span><span class="hs-comment">--       the parser reads the special syntax and returns an Exact RdrName</span><span>
</span><span id="line-196"></span><span>        </span><span class="hs-comment">-- We are at a binding site for the name, so check first that it</span><span>
</span><span id="line-197"></span><span>        </span><span class="hs-comment">-- the current module is the correct one; otherwise GHC can get</span><span>
</span><span id="line-198"></span><span>        </span><span class="hs-comment">-- very confused indeed. This test rejects code like</span><span>
</span><span id="line-199"></span><span>        </span><span class="hs-comment">--      data T = (,) Int Int</span><span>
</span><span id="line-200"></span><span>        </span><span class="hs-comment">-- unless we are in GHC.Tup</span><span>
</span><span id="line-201"></span><span>    </span><span class="hs-keyword">if</span><span> </span><span class="annot"><span class="annottext">Name -&gt; Bool
</span><a href="GHC.Types.Name.html#isExternalName"><span class="hs-identifier hs-var">isExternalName</span></a></span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621683035284"><span class="hs-identifier hs-var">name</span></a></span><span> </span><span class="hs-keyword">then</span><span>
</span><span id="line-202"></span><span>      </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span id="local-6989586621683035287"><span class="annot"><a href="#local-6989586621683035287"><span class="hs-identifier hs-var">this_mod</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">IOEnv (Env TcGblEnv TcLclEnv) Module
forall (m :: * -&gt; *). HasModule m =&gt; m Module
</span><a href="GHC.Unit.Module.html#getModule"><span class="hs-identifier hs-var">getModule</span></a></span><span>
</span><span id="line-203"></span><span>         </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">unless</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621683035287"><span class="hs-identifier hs-type">this_mod</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">==</span></span><span> </span><span class="annot"><a href="GHC.Types.Name.html#nameModule"><span class="hs-identifier hs-type">nameModule</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683035284"><span class="hs-identifier hs-type">name</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-204"></span><span>                  </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Tc.Utils.Monad.html#addErrAt"><span class="hs-identifier hs-type">addErrAt</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Parser.Annotation.html#locA"><span class="hs-identifier hs-type">locA</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683035282"><span class="hs-identifier hs-type">loc</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Tc.Errors.Types.html#TcRnBindingOfExistingName"><span class="hs-identifier hs-type">TcRnBindingOfExistingName</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683035283"><span class="hs-identifier hs-type">rdr_name</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-205"></span><span>         </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">return</span></span><span> </span><span class="annot"><a href="#local-6989586621683035284"><span class="hs-identifier hs-type">name</span></a></span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-206"></span><span>    </span><span class="hs-keyword">else</span><span>   </span><span class="hs-comment">-- See Note [Binders in Template Haskell] in &quot;GHC.ThToHs&quot;</span><span>
</span><span id="line-207"></span><span>      </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span id="local-6989586621683035294"><span class="annot"><a href="#local-6989586621683035294"><span class="hs-identifier hs-var">this_mod</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">IOEnv (Env TcGblEnv TcLclEnv) Module
forall (m :: * -&gt; *). HasModule m =&gt; m Module
</span><a href="GHC.Unit.Module.html#getModule"><span class="hs-identifier hs-var">getModule</span></a></span><span>
</span><span id="line-208"></span><span>         </span><span class="hs-special">;</span><span> </span><span class="annot"><a href="GHC.Iface.Env.html#externaliseName"><span class="hs-identifier hs-type">externaliseName</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683035294"><span class="hs-identifier hs-type">this_mod</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683035284"><span class="hs-identifier hs-type">name</span></a></span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-209"></span><span>
</span><span id="line-210"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span class="hs-special">(</span><span id="local-6989586621683035296"><span class="annot"><span class="annottext">Module
</span><a href="#local-6989586621683035296"><span class="hs-identifier hs-var">rdr_mod</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621683035297"><span class="annot"><span class="annottext">OccName
</span><a href="#local-6989586621683035297"><span class="hs-identifier hs-var">rdr_occ</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">RdrName -&gt; Maybe (Module, OccName)
</span><a href="GHC.Types.Name.Reader.html#isOrig_maybe"><span class="hs-identifier hs-var">isOrig_maybe</span></a></span><span> </span><span class="annot"><span class="annottext">RdrName
</span><a href="#local-6989586621683035283"><span class="hs-identifier hs-var">rdr_name</span></a></span><span>
</span><span id="line-211"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>  </span><span class="hs-special">{</span><span> </span><span id="local-6989586621683035299"><span class="annot"><a href="#local-6989586621683035299"><span class="hs-identifier hs-var">this_mod</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">IOEnv (Env TcGblEnv TcLclEnv) Module
forall (m :: * -&gt; *). HasModule m =&gt; m Module
</span><a href="GHC.Unit.Module.html#getModule"><span class="hs-identifier hs-var">getModule</span></a></span><span>
</span><span id="line-212"></span><span>        </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">unless</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621683035296"><span class="hs-identifier hs-type">rdr_mod</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">==</span></span><span> </span><span class="annot"><a href="#local-6989586621683035299"><span class="hs-identifier hs-type">this_mod</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">||</span></span><span> </span><span class="annot"><a href="#local-6989586621683035296"><span class="hs-identifier hs-type">rdr_mod</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">==</span></span><span> </span><span class="annot"><a href="GHC.Builtin.Names.html#rOOT_MAIN"><span class="hs-identifier hs-type">rOOT_MAIN</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-213"></span><span>                 </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Tc.Utils.Monad.html#addErrAt"><span class="hs-identifier hs-type">addErrAt</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Parser.Annotation.html#locA"><span class="hs-identifier hs-type">locA</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683035282"><span class="hs-identifier hs-type">loc</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Tc.Errors.Types.html#TcRnBindingOfExistingName"><span class="hs-identifier hs-type">TcRnBindingOfExistingName</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683035283"><span class="hs-identifier hs-type">rdr_name</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-214"></span><span>        </span><span class="hs-comment">-- When reading External Core we get Orig names as binders,</span><span>
</span><span id="line-215"></span><span>        </span><span class="hs-comment">-- but they should agree with the module gotten from the monad</span><span>
</span><span id="line-216"></span><span>        </span><span class="hs-comment">--</span><span>
</span><span id="line-217"></span><span>        </span><span class="hs-comment">-- We can get built-in syntax showing up here too, sadly.  If you type</span><span>
</span><span id="line-218"></span><span>        </span><span class="hs-comment">--      data T = (,,,)</span><span>
</span><span id="line-219"></span><span>        </span><span class="hs-comment">-- the constructor is parsed as a type, and then GHC.Parser.PostProcess.tyConToDataCon</span><span>
</span><span id="line-220"></span><span>        </span><span class="hs-comment">-- uses setRdrNameSpace to make it into a data constructors.  At that point</span><span>
</span><span id="line-221"></span><span>        </span><span class="hs-comment">-- the nice Exact name for the TyCon gets swizzled to an Orig name.</span><span>
</span><span id="line-222"></span><span>        </span><span class="hs-comment">-- Hence the TcRnBindingOfExistingName error message.</span><span>
</span><span id="line-223"></span><span>        </span><span class="hs-comment">--</span><span>
</span><span id="line-224"></span><span>
</span><span id="line-225"></span><span>        </span><span class="hs-comment">-- MP 2022: I suspect this code path is never called for `rOOT_MAIN` anymore</span><span>
</span><span id="line-226"></span><span>        </span><span class="hs-comment">-- because External Core has been removed but we instead have some similar logic for</span><span>
</span><span id="line-227"></span><span>        </span><span class="hs-comment">-- serialising whole programs into interface files in GHC.IfaceToCore.mk_top_id.</span><span>
</span><span id="line-228"></span><span>
</span><span id="line-229"></span><span>        </span><span class="hs-comment">-- Except for the &quot;:Main.main = ...&quot; definition inserted into</span><span>
</span><span id="line-230"></span><span>        </span><span class="hs-comment">-- the Main module; ugh!</span><span>
</span><span id="line-231"></span><span>
</span><span id="line-232"></span><span>        </span><span class="hs-comment">-- Because of this latter case, we call newGlobalBinder with a module from</span><span>
</span><span id="line-233"></span><span>        </span><span class="hs-comment">-- the RdrName, not from the environment.  In principle, it'd be fine to</span><span>
</span><span id="line-234"></span><span>        </span><span class="hs-comment">-- have an arbitrary mixture of external core definitions in a single module,</span><span>
</span><span id="line-235"></span><span>        </span><span class="hs-comment">-- (apart from module-initialisation issues, perhaps).</span><span>
</span><span id="line-236"></span><span>        </span><span class="hs-special">;</span><span> </span><span class="annot"><a href="GHC.Iface.Env.html#newGlobalBinder"><span class="hs-identifier hs-type">newGlobalBinder</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683035296"><span class="hs-identifier hs-type">rdr_mod</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683035297"><span class="hs-identifier hs-type">rdr_occ</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Parser.Annotation.html#locA"><span class="hs-identifier hs-type">locA</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683035282"><span class="hs-identifier hs-type">loc</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-237"></span><span>
</span><span id="line-238"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">otherwise</span></span><span>
</span><span id="line-239"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>  </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">Bool
-&gt; IOEnv (Env TcGblEnv TcLclEnv) ()
-&gt; IOEnv (Env TcGblEnv TcLclEnv) ()
forall (f :: * -&gt; *). Applicative f =&gt; Bool -&gt; f () -&gt; f ()
</span><span class="hs-identifier hs-var">when</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">RdrName -&gt; Bool
</span><a href="GHC.Types.Name.Reader.html#isQual"><span class="hs-identifier hs-var">isQual</span></a></span><span> </span><span class="annot"><span class="annottext">RdrName
</span><a href="#local-6989586621683035283"><span class="hs-identifier hs-var">rdr_name</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-240"></span><span>                 </span><span class="hs-special">(</span><span class="annot"><span class="annottext">SrcSpan -&gt; TcRnMessage -&gt; IOEnv (Env TcGblEnv TcLclEnv) ()
</span><a href="GHC.Tc.Utils.Monad.html#addErrAt"><span class="hs-identifier hs-var">addErrAt</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">SrcSpanAnnN -&gt; SrcSpan
forall a. HasLoc a =&gt; a -&gt; SrcSpan
</span><a href="GHC.Parser.Annotation.html#locA"><span class="hs-identifier hs-var">locA</span></a></span><span> </span><span class="annot"><span class="annottext">SrcSpanAnnN
</span><a href="#local-6989586621683035282"><span class="hs-identifier hs-var">loc</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">RdrName -&gt; TcRnMessage
</span><a href="GHC.Rename.Utils.html#badQualBndrErr"><span class="hs-identifier hs-var">badQualBndrErr</span></a></span><span> </span><span class="annot"><span class="annottext">RdrName
</span><a href="#local-6989586621683035283"><span class="hs-identifier hs-var">rdr_name</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-241"></span><span>                </span><span class="hs-comment">-- Binders should not be qualified; if they are, and with a different</span><span>
</span><span id="line-242"></span><span>                </span><span class="hs-comment">-- module name, we get a confusing &quot;M.T is not in scope&quot; error later</span><span>
</span><span id="line-243"></span><span>
</span><span id="line-244"></span><span>        </span><span class="hs-special">;</span><span> </span><span id="local-6989586621683035305"><span class="annot"><a href="#local-6989586621683035305"><span class="hs-identifier hs-var">stage</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">TcM ThStage
</span><a href="GHC.Tc.Utils.Monad.html#getStage"><span class="hs-identifier hs-var">getStage</span></a></span><span>
</span><span id="line-245"></span><span>        </span><span class="hs-special">;</span><span> </span><span class="hs-keyword">if</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.Env.html#isBrackStage"><span class="hs-identifier hs-type">isBrackStage</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683035305"><span class="hs-identifier hs-type">stage</span></a></span><span> </span><span class="hs-keyword">then</span><span>
</span><span id="line-246"></span><span>                </span><span class="hs-comment">-- We are inside a TH bracket, so make an *Internal* name</span><span>
</span><span id="line-247"></span><span>                </span><span class="hs-comment">-- See Note [Top-level Names in Template Haskell decl quotes] in GHC.Rename.Names</span><span>
</span><span id="line-248"></span><span>             </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span id="local-6989586621683035308"><span class="annot"><a href="#local-6989586621683035308"><span class="hs-identifier hs-var">uniq</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.Monad.html#newUnique"><span class="hs-identifier hs-type">newUnique</span></a></span><span>
</span><span id="line-249"></span><span>                </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">return</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Types.Name.html#mkInternalName"><span class="hs-identifier hs-type">mkInternalName</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683035308"><span class="hs-identifier hs-type">uniq</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Types.Name.Reader.html#rdrNameOcc"><span class="hs-identifier hs-type">rdrNameOcc</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683035283"><span class="hs-identifier hs-type">rdr_name</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Parser.Annotation.html#locA"><span class="hs-identifier hs-type">locA</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683035282"><span class="hs-identifier hs-type">loc</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-250"></span><span>          </span><span class="hs-keyword">else</span><span>
</span><span id="line-251"></span><span>             </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span id="local-6989586621683035312"><span class="annot"><a href="#local-6989586621683035312"><span class="hs-identifier hs-var">this_mod</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><a href="GHC.Unit.Module.html#getModule"><span class="hs-identifier hs-type">getModule</span></a></span><span>
</span><span id="line-252"></span><span>                </span><span class="hs-special">;</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.Monad.html#traceRn"><span class="hs-identifier hs-type">traceRn</span></a></span><span> </span><span class="annot"><span class="hs-string">&quot;newTopSrcBinder&quot;</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-type">ppr</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683035312"><span class="hs-identifier hs-type">this_mod</span></a></span><span> </span><span class="annot"><a href="GHC.Utils.Outputable.html#%24%24"><span class="hs-operator hs-type">$$</span></a></span><span> </span><span class="annot"><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-type">ppr</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683035283"><span class="hs-identifier hs-type">rdr_name</span></a></span><span> </span><span class="annot"><a href="GHC.Utils.Outputable.html#%24%24"><span class="hs-operator hs-type">$$</span></a></span><span> </span><span class="annot"><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-type">ppr</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Parser.Annotation.html#locA"><span class="hs-identifier hs-type">locA</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683035282"><span class="hs-identifier hs-type">loc</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-253"></span><span>                </span><span class="hs-special">;</span><span> </span><span class="annot"><a href="GHC.Iface.Env.html#newGlobalBinder"><span class="hs-identifier hs-type">newGlobalBinder</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683035312"><span class="hs-identifier hs-type">this_mod</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Types.Name.Reader.html#rdrNameOcc"><span class="hs-identifier hs-type">rdrNameOcc</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683035283"><span class="hs-identifier hs-type">rdr_name</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Parser.Annotation.html#locA"><span class="hs-identifier hs-type">locA</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683035282"><span class="hs-identifier hs-type">loc</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-254"></span><span>        </span><span class="hs-special">}</span><span>
</span><span id="line-255"></span><span>
</span><span id="line-256"></span><span class="hs-comment">{-
*********************************************************
*                                                      *
        Source code occurrences
*                                                      *
*********************************************************

Looking up a name in the GHC.Rename.Env.

Note [Type and class operator definitions]
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
We want to reject all of these unless we have -XTypeOperators (#3265)
   data a :*: b  = ...
   class a :*: b where ...
   data (:*:) a b  = ....
   class (:*:) a b where ...
The latter two mean that we are not just looking for a
*syntactically-infix* declaration, but one that uses an operator
OccName.  We use OccName.isSymOcc to detect that case, which isn't
terribly efficient, but there seems to be no better way.
-}</span><span>
</span><span id="line-277"></span><span>
</span><span id="line-278"></span><span class="hs-comment">-- Can be made to not be exposed</span><span>
</span><span id="line-279"></span><span class="hs-comment">-- Only used unwrapped in rnAnnProvenance</span><span>
</span><span id="line-280"></span><span class="annot"><a href="GHC.Rename.Env.html#lookupTopBndrRn"><span class="hs-identifier hs-type">lookupTopBndrRn</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Rename.Unbound.html#WhatLooking"><span class="hs-identifier hs-type">WhatLooking</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Types.Name.Reader.html#RdrName"><span class="hs-identifier hs-type">RdrName</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#RnM"><span class="hs-identifier hs-type">RnM</span></a></span><span> </span><span class="annot"><a href="GHC.Types.Name.html#Name"><span class="hs-identifier hs-type">Name</span></a></span><span>
</span><span id="line-281"></span><span class="hs-comment">-- Look up a top-level source-code binder.   We may be looking up an unqualified 'f',</span><span>
</span><span id="line-282"></span><span class="hs-comment">-- and there may be several imported 'f's too, which must not confuse us.</span><span>
</span><span id="line-283"></span><span class="hs-comment">-- For example, this is OK:</span><span>
</span><span id="line-284"></span><span class="hs-comment">--      import Foo( f )</span><span>
</span><span id="line-285"></span><span class="hs-comment">--      infix 9 f       -- The 'f' here does not need to be qualified</span><span>
</span><span id="line-286"></span><span class="hs-comment">--      f x = x         -- Nor here, of course</span><span>
</span><span id="line-287"></span><span class="hs-comment">-- So we have to filter out the non-local ones.</span><span>
</span><span id="line-288"></span><span class="hs-comment">--</span><span>
</span><span id="line-289"></span><span class="hs-comment">-- A separate function (importsFromLocalDecls) reports duplicate top level</span><span>
</span><span id="line-290"></span><span class="hs-comment">-- decls, so here it's safe just to choose an arbitrary one.</span><span>
</span><span id="line-291"></span><span id="lookupTopBndrRn"><span class="annot"><span class="annottext">lookupTopBndrRn :: WhatLooking -&gt; RdrName -&gt; RnM Name
</span><a href="GHC.Rename.Env.html#lookupTopBndrRn"><span class="hs-identifier hs-var hs-var">lookupTopBndrRn</span></a></span></span><span> </span><span id="local-6989586621683035316"><span class="annot"><span class="annottext">WhatLooking
</span><a href="#local-6989586621683035316"><span class="hs-identifier hs-var">which_suggest</span></a></span></span><span> </span><span id="local-6989586621683035317"><span class="annot"><span class="annottext">RdrName
</span><a href="#local-6989586621683035317"><span class="hs-identifier hs-var">rdr_name</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-292"></span><span>  </span><span class="annot"><span class="annottext">RdrName -&gt; (GlobalRdrElt -&gt; Name) -&gt; RnM Name -&gt; RnM Name
forall r. RdrName -&gt; (GlobalRdrElt -&gt; r) -&gt; RnM r -&gt; RnM r
</span><a href="GHC.Rename.Env.html#lookupExactOrOrig"><span class="hs-identifier hs-var">lookupExactOrOrig</span></a></span><span> </span><span class="annot"><span class="annottext">RdrName
</span><a href="#local-6989586621683035317"><span class="hs-identifier hs-var">rdr_name</span></a></span><span> </span><span class="annot"><span class="annottext">GlobalRdrElt -&gt; Name
forall info. GlobalRdrEltX info -&gt; Name
</span><a href="GHC.Types.Name.Reader.html#greName"><span class="hs-identifier hs-var">greName</span></a></span><span> </span><span class="annot"><span class="annottext">(RnM Name -&gt; RnM Name) -&gt; RnM Name -&gt; RnM Name
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-293"></span><span>    </span><span class="hs-keyword">do</span><span>  </span><span class="hs-special">{</span><span>  </span><span class="hs-comment">-- Check for operators in type or class declarations</span><span>
</span><span id="line-294"></span><span>           </span><span class="hs-comment">-- See Note [Type and class operator definitions]</span><span>
</span><span id="line-295"></span><span>          </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621683035320"><span class="annot"><span class="annottext">occ :: OccName
</span><a href="#local-6989586621683035320"><span class="hs-identifier hs-var hs-var hs-var">occ</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">RdrName -&gt; OccName
</span><a href="GHC.Types.Name.Reader.html#rdrNameOcc"><span class="hs-identifier hs-var">rdrNameOcc</span></a></span><span> </span><span class="annot"><span class="annottext">RdrName
</span><a href="#local-6989586621683035317"><span class="hs-identifier hs-var">rdr_name</span></a></span><span>
</span><span id="line-296"></span><span>        </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="annottext">Bool
-&gt; IOEnv (Env TcGblEnv TcLclEnv) ()
-&gt; IOEnv (Env TcGblEnv TcLclEnv) ()
forall (f :: * -&gt; *). Applicative f =&gt; Bool -&gt; f () -&gt; f ()
</span><span class="hs-identifier hs-var">when</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">OccName -&gt; Bool
</span><a href="GHC.Types.Name.Occurrence.html#isTcOcc"><span class="hs-identifier hs-var">isTcOcc</span></a></span><span> </span><span class="annot"><span class="annottext">OccName
</span><a href="#local-6989586621683035320"><span class="hs-identifier hs-var">occ</span></a></span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Bool -&gt; Bool
</span><span class="hs-operator hs-var">&amp;&amp;</span></span><span> </span><span class="annot"><span class="annottext">OccName -&gt; Bool
</span><a href="GHC.Types.Name.Occurrence.html#isSymOcc"><span class="hs-identifier hs-var">isSymOcc</span></a></span><span> </span><span class="annot"><span class="annottext">OccName
</span><a href="#local-6989586621683035320"><span class="hs-identifier hs-var">occ</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-297"></span><span>               </span><span class="hs-special">(</span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span id="local-6989586621683035324"><span class="annot"><a href="#local-6989586621683035324"><span class="hs-identifier hs-var">op_ok</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Extension -&gt; TcRnIf TcGblEnv TcLclEnv Bool
forall gbl lcl. Extension -&gt; TcRnIf gbl lcl Bool
</span><a href="GHC.Tc.Utils.Monad.html#xoptM"><span class="hs-identifier hs-var">xoptM</span></a></span><span> </span><span class="annot"><span class="annottext">Extension
</span><span class="hs-identifier hs-var">LangExt.TypeOperators</span></span><span>
</span><span id="line-298"></span><span>                   </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">unless</span></span><span> </span><span class="annot"><a href="#local-6989586621683035324"><span class="hs-identifier hs-type">op_ok</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Tc.Utils.Monad.html#addErr"><span class="hs-identifier hs-type">addErr</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Tc.Errors.Types.html#TcRnIllegalTypeOperatorDecl"><span class="hs-identifier hs-type">TcRnIllegalTypeOperatorDecl</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683035317"><span class="hs-identifier hs-type">rdr_name</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span class="hs-special">)</span><span>
</span><span id="line-299"></span><span>        </span><span class="hs-special">;</span><span> </span><span id="local-6989586621683035329"><span class="annot"><a href="#local-6989586621683035329"><span class="hs-identifier hs-var">env</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">TcRn GlobalRdrEnv
</span><a href="GHC.Tc.Utils.Monad.html#getGlobalRdrEnv"><span class="hs-identifier hs-var">getGlobalRdrEnv</span></a></span><span>
</span><span id="line-300"></span><span>        </span><span class="hs-special">;</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="hs-identifier hs-type">filter</span></span><span> </span><span class="annot"><a href="GHC.Types.Name.Reader.html#isLocalGRE"><span class="hs-identifier hs-type">isLocalGRE</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Types.Name.Reader.html#lookupGRE"><span class="hs-identifier hs-type">lookupGRE</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683035329"><span class="hs-identifier hs-type">env</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="annot"><a href="GHC.Types.Name.Reader.html#LookupRdrName"><span class="hs-identifier hs-type">LookupRdrName</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683035317"><span class="hs-identifier hs-type">rdr_name</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="annot"><a href="GHC.Types.Name.Reader.html#RelevantGREsFOS"><span class="hs-identifier hs-type">RelevantGREsFOS</span></a></span><span> </span><span class="annot"><a href="GHC.Types.Name.Reader.html#WantNormal"><span class="hs-identifier hs-type">WantNormal</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-301"></span><span>            </span><span class="hs-special">[</span><span id="local-6989586621683035336"><span class="annot"><span class="annottext">GlobalRdrElt
</span><a href="#local-6989586621683035336"><span class="hs-identifier hs-var">gre</span></a></span></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Name -&gt; RnM Name
forall a. a -&gt; IOEnv (Env TcGblEnv TcLclEnv) a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">GlobalRdrElt -&gt; Name
forall info. GlobalRdrEltX info -&gt; Name
</span><a href="GHC.Types.Name.Reader.html#greName"><span class="hs-identifier hs-var">greName</span></a></span><span> </span><span class="annot"><span class="annottext">GlobalRdrElt
</span><a href="#local-6989586621683035336"><span class="hs-identifier hs-var">gre</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-302"></span><span>            </span><span class="annot"><span class="annottext">[GlobalRdrElt]
</span><span class="hs-identifier">_</span></span><span>     </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-comment">-- Ambiguous (can't happen) or unbound</span><span>
</span><span id="line-303"></span><span>                        </span><span class="annot"><span class="annottext">String -&gt; SDoc -&gt; IOEnv (Env TcGblEnv TcLclEnv) ()
</span><a href="GHC.Tc.Utils.Monad.html#traceRn"><span class="hs-identifier hs-var">traceRn</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;lookupTopBndrRN fail&quot;</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">RdrName -&gt; SDoc
forall a. Outputable a =&gt; a -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="annot"><span class="annottext">RdrName
</span><a href="#local-6989586621683035317"><span class="hs-identifier hs-var">rdr_name</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-304"></span><span>                        </span><span class="annot"><span class="annottext">LookingFor -&gt; RdrName -&gt; RnM Name
</span><a href="GHC.Rename.Unbound.html#unboundName"><span class="hs-identifier hs-var">unboundName</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">WhatLooking -&gt; WhereLooking -&gt; LookingFor
</span><a href="GHC.Rename.Unbound.html#LF"><span class="hs-identifier hs-var">LF</span></a></span><span> </span><span class="annot"><span class="annottext">WhatLooking
</span><a href="#local-6989586621683035316"><span class="hs-identifier hs-var">which_suggest</span></a></span><span> </span><span class="annot"><span class="annottext">WhereLooking
</span><a href="GHC.Rename.Unbound.html#WL_LocalTop"><span class="hs-identifier hs-var">WL_LocalTop</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">RdrName
</span><a href="#local-6989586621683035317"><span class="hs-identifier hs-var">rdr_name</span></a></span><span>
</span><span id="line-305"></span><span>    </span><span class="hs-special">}</span><span>
</span><span id="line-306"></span><span>
</span><span id="line-307"></span><span class="annot"><a href="GHC.Rename.Env.html#lookupLocatedTopConstructorRn"><span class="hs-identifier hs-type">lookupLocatedTopConstructorRn</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Types.SrcLoc.html#Located"><span class="hs-identifier hs-type">Located</span></a></span><span> </span><span class="annot"><a href="GHC.Types.Name.Reader.html#RdrName"><span class="hs-identifier hs-type">RdrName</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#RnM"><span class="hs-identifier hs-type">RnM</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Types.SrcLoc.html#Located"><span class="hs-identifier hs-type">Located</span></a></span><span> </span><span class="annot"><a href="GHC.Types.Name.html#Name"><span class="hs-identifier hs-type">Name</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-308"></span><span id="lookupLocatedTopConstructorRn"><span class="annot"><span class="annottext">lookupLocatedTopConstructorRn :: Located RdrName -&gt; RnM (Located Name)
</span><a href="GHC.Rename.Env.html#lookupLocatedTopConstructorRn"><span class="hs-identifier hs-var hs-var">lookupLocatedTopConstructorRn</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(RdrName -&gt; RnM Name) -&gt; Located RdrName -&gt; RnM (Located Name)
forall t a b.
HasLoc t =&gt;
(a -&gt; TcM b) -&gt; GenLocated t a -&gt; TcM (Located b)
</span><a href="GHC.Tc.Utils.Monad.html#wrapLocM"><span class="hs-identifier hs-var">wrapLocM</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">WhatLooking -&gt; RdrName -&gt; RnM Name
</span><a href="GHC.Rename.Env.html#lookupTopBndrRn"><span class="hs-identifier hs-var">lookupTopBndrRn</span></a></span><span> </span><span class="annot"><span class="annottext">WhatLooking
</span><a href="GHC.Rename.Unbound.html#WL_Constructor"><span class="hs-identifier hs-var">WL_Constructor</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-309"></span><span>
</span><span id="line-310"></span><span class="annot"><a href="GHC.Rename.Env.html#lookupLocatedTopConstructorRnN"><span class="hs-identifier hs-type">lookupLocatedTopConstructorRnN</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Parser.Annotation.html#LocatedN"><span class="hs-identifier hs-type">LocatedN</span></a></span><span> </span><span class="annot"><a href="GHC.Types.Name.Reader.html#RdrName"><span class="hs-identifier hs-type">RdrName</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#RnM"><span class="hs-identifier hs-type">RnM</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Parser.Annotation.html#LocatedN"><span class="hs-identifier hs-type">LocatedN</span></a></span><span> </span><span class="annot"><a href="GHC.Types.Name.html#Name"><span class="hs-identifier hs-type">Name</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-311"></span><span id="lookupLocatedTopConstructorRnN"><span class="annot"><span class="annottext">lookupLocatedTopConstructorRnN :: LocatedN RdrName -&gt; RnM (LocatedN Name)
</span><a href="GHC.Rename.Env.html#lookupLocatedTopConstructorRnN"><span class="hs-identifier hs-var hs-var">lookupLocatedTopConstructorRnN</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(RdrName -&gt; RnM Name) -&gt; LocatedN RdrName -&gt; RnM (LocatedN Name)
forall a b ann.
(a -&gt; TcM b)
-&gt; GenLocated (EpAnn ann) a -&gt; TcRn (GenLocated (EpAnn ann) b)
</span><a href="GHC.Tc.Utils.Monad.html#wrapLocMA"><span class="hs-identifier hs-var">wrapLocMA</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">WhatLooking -&gt; RdrName -&gt; RnM Name
</span><a href="GHC.Rename.Env.html#lookupTopBndrRn"><span class="hs-identifier hs-var">lookupTopBndrRn</span></a></span><span> </span><span class="annot"><span class="annottext">WhatLooking
</span><a href="GHC.Rename.Unbound.html#WL_Constructor"><span class="hs-identifier hs-var">WL_Constructor</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-312"></span><span>
</span><span id="line-313"></span><span class="annot"><a href="GHC.Rename.Env.html#lookupLocatedTopBndrRn"><span class="hs-identifier hs-type">lookupLocatedTopBndrRn</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Types.SrcLoc.html#Located"><span class="hs-identifier hs-type">Located</span></a></span><span> </span><span class="annot"><a href="GHC.Types.Name.Reader.html#RdrName"><span class="hs-identifier hs-type">RdrName</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#RnM"><span class="hs-identifier hs-type">RnM</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Types.SrcLoc.html#Located"><span class="hs-identifier hs-type">Located</span></a></span><span> </span><span class="annot"><a href="GHC.Types.Name.html#Name"><span class="hs-identifier hs-type">Name</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-314"></span><span id="lookupLocatedTopBndrRn"><span class="annot"><span class="annottext">lookupLocatedTopBndrRn :: Located RdrName -&gt; RnM (Located Name)
</span><a href="GHC.Rename.Env.html#lookupLocatedTopBndrRn"><span class="hs-identifier hs-var hs-var">lookupLocatedTopBndrRn</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(RdrName -&gt; RnM Name) -&gt; Located RdrName -&gt; RnM (Located Name)
forall t a b.
HasLoc t =&gt;
(a -&gt; TcM b) -&gt; GenLocated t a -&gt; TcM (Located b)
</span><a href="GHC.Tc.Utils.Monad.html#wrapLocM"><span class="hs-identifier hs-var">wrapLocM</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">WhatLooking -&gt; RdrName -&gt; RnM Name
</span><a href="GHC.Rename.Env.html#lookupTopBndrRn"><span class="hs-identifier hs-var">lookupTopBndrRn</span></a></span><span> </span><span class="annot"><span class="annottext">WhatLooking
</span><a href="GHC.Rename.Unbound.html#WL_Anything"><span class="hs-identifier hs-var">WL_Anything</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-315"></span><span>
</span><span id="line-316"></span><span class="annot"><a href="GHC.Rename.Env.html#lookupLocatedTopBndrRnN"><span class="hs-identifier hs-type">lookupLocatedTopBndrRnN</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Parser.Annotation.html#LocatedN"><span class="hs-identifier hs-type">LocatedN</span></a></span><span> </span><span class="annot"><a href="GHC.Types.Name.Reader.html#RdrName"><span class="hs-identifier hs-type">RdrName</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#RnM"><span class="hs-identifier hs-type">RnM</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Parser.Annotation.html#LocatedN"><span class="hs-identifier hs-type">LocatedN</span></a></span><span> </span><span class="annot"><a href="GHC.Types.Name.html#Name"><span class="hs-identifier hs-type">Name</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-317"></span><span id="lookupLocatedTopBndrRnN"><span class="annot"><span class="annottext">lookupLocatedTopBndrRnN :: LocatedN RdrName -&gt; RnM (LocatedN Name)
</span><a href="GHC.Rename.Env.html#lookupLocatedTopBndrRnN"><span class="hs-identifier hs-var hs-var">lookupLocatedTopBndrRnN</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(RdrName -&gt; RnM Name) -&gt; LocatedN RdrName -&gt; RnM (LocatedN Name)
forall a b ann.
(a -&gt; TcM b)
-&gt; GenLocated (EpAnn ann) a -&gt; TcRn (GenLocated (EpAnn ann) b)
</span><a href="GHC.Tc.Utils.Monad.html#wrapLocMA"><span class="hs-identifier hs-var">wrapLocMA</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">WhatLooking -&gt; RdrName -&gt; RnM Name
</span><a href="GHC.Rename.Env.html#lookupTopBndrRn"><span class="hs-identifier hs-var">lookupTopBndrRn</span></a></span><span> </span><span class="annot"><span class="annottext">WhatLooking
</span><a href="GHC.Rename.Unbound.html#WL_Anything"><span class="hs-identifier hs-var">WL_Anything</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-318"></span><span>
</span><span id="line-319"></span><span class="hs-comment">-- | Lookup an @Exact@ @RdrName@. See Note [Looking up Exact RdrNames].</span><span>
</span><span id="line-320"></span><span class="hs-comment">-- This never adds an error, but it may return one, see</span><span>
</span><span id="line-321"></span><span class="hs-comment">-- Note [Errors in lookup functions]</span><span>
</span><span id="line-322"></span><span class="annot"><a href="GHC.Rename.Env.html#lookupExactOcc_either"><span class="hs-identifier hs-type">lookupExactOcc_either</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Types.Name.html#Name"><span class="hs-identifier hs-type">Name</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#RnM"><span class="hs-identifier hs-type">RnM</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Either</span></span><span> </span><span class="annot"><a href="GHC.Tc.Errors.Types.html#NotInScopeError"><span class="hs-identifier hs-type">NotInScopeError</span></a></span><span> </span><span class="annot"><a href="GHC.Types.Name.Reader.html#GlobalRdrElt"><span class="hs-identifier hs-type">GlobalRdrElt</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-323"></span><span id="lookupExactOcc_either"><span class="annot"><span class="annottext">lookupExactOcc_either :: Name -&gt; RnM (Either NotInScopeError GlobalRdrElt)
</span><a href="GHC.Rename.Env.html#lookupExactOcc_either"><span class="hs-identifier hs-var hs-var">lookupExactOcc_either</span></a></span></span><span> </span><span id="local-6989586621683035345"><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621683035345"><span class="hs-identifier hs-var">name</span></a></span></span><span>
</span><span id="line-324"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span id="local-6989586621683035346"><span class="annot"><span class="annottext">TyThing
</span><a href="#local-6989586621683035346"><span class="hs-identifier hs-var">thing</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Name -&gt; Maybe TyThing
</span><a href="GHC.Types.Name.html#wiredInNameTyThing_maybe"><span class="hs-identifier hs-var">wiredInNameTyThing_maybe</span></a></span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621683035345"><span class="hs-identifier hs-var">name</span></a></span><span>
</span><span id="line-325"></span><span>  </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span class="hs-special">(</span><span id="local-6989586621683035348"><span class="annot"><span class="annottext">TyCon
</span><a href="#local-6989586621683035348"><span class="hs-identifier hs-var">tycon</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621683035349"><span class="annot"><span class="annottext">TupleSort -&gt; GREInfo
</span><a href="#local-6989586621683035349"><span class="hs-identifier hs-var">mkInfo</span></a></span></span><span class="hs-special">)</span><span>
</span><span id="line-326"></span><span>      </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">TyThing
</span><a href="#local-6989586621683035346"><span class="hs-identifier hs-var">thing</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-327"></span><span>          </span><span class="annot"><a href="GHC.Types.TyThing.html#ATyCon"><span class="hs-identifier hs-type">ATyCon</span></a></span><span> </span><span id="local-6989586621683035351"><span class="annot"><span class="annottext">TyCon
</span><a href="#local-6989586621683035351"><span class="hs-identifier hs-var">tc</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-328"></span><span>            </span><span class="annot"><span class="annottext">(TyCon, TupleSort -&gt; GREInfo)
-&gt; Maybe (TyCon, TupleSort -&gt; GREInfo)
forall a. a -&gt; Maybe a
</span><span class="hs-identifier hs-var">Just</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TyCon
</span><a href="#local-6989586621683035351"><span class="hs-identifier hs-var">tc</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">TyConFlavour Name -&gt; GREInfo
</span><a href="GHC.Types.GREInfo.html#IAmTyCon"><span class="hs-identifier hs-var">IAmTyCon</span></a></span><span> </span><span class="annot"><span class="annottext">(TyConFlavour Name -&gt; GREInfo)
-&gt; (TupleSort -&gt; TyConFlavour Name) -&gt; TupleSort -&gt; GREInfo
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">Boxity -&gt; TyConFlavour Name
forall tc. Boxity -&gt; TyConFlavour tc
</span><a href="GHC.Types.Basic.html#TupleFlavour"><span class="hs-identifier hs-var">TupleFlavour</span></a></span><span> </span><span class="annot"><span class="annottext">(Boxity -&gt; TyConFlavour Name)
-&gt; (TupleSort -&gt; Boxity) -&gt; TupleSort -&gt; TyConFlavour Name
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">TupleSort -&gt; Boxity
</span><a href="GHC.Types.Basic.html#tupleSortBoxity"><span class="hs-identifier hs-var">tupleSortBoxity</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-329"></span><span>          </span><span class="annot"><a href="GHC.Types.TyThing.html#AConLike"><span class="hs-identifier hs-type">AConLike</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Core.ConLike.html#RealDataCon"><span class="hs-identifier hs-type">RealDataCon</span></a></span><span> </span><span id="local-6989586621683035357"><span class="annot"><span class="annottext">DataCon
</span><a href="#local-6989586621683035357"><span class="hs-identifier hs-var">dc</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-330"></span><span>            </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621683035358"><span class="annot"><span class="annottext">tc :: TyCon
</span><a href="#local-6989586621683035358"><span class="hs-identifier hs-var hs-var">tc</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">DataCon -&gt; TyCon
</span><a href="GHC.Core.DataCon.html#dataConTyCon"><span class="hs-identifier hs-var">dataConTyCon</span></a></span><span> </span><span class="annot"><span class="annottext">DataCon
</span><a href="#local-6989586621683035357"><span class="hs-identifier hs-var">dc</span></a></span><span>
</span><span id="line-331"></span><span>            </span><span class="hs-keyword">in</span><span> </span><span class="annot"><span class="annottext">(TyCon, TupleSort -&gt; GREInfo)
-&gt; Maybe (TyCon, TupleSort -&gt; GREInfo)
forall a. a -&gt; Maybe a
</span><span class="hs-identifier hs-var">Just</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TyCon
</span><a href="#local-6989586621683035358"><span class="hs-identifier hs-var">tc</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">ConInfo -&gt; GREInfo
</span><a href="GHC.Types.GREInfo.html#IAmConLike"><span class="hs-identifier hs-var">IAmConLike</span></a></span><span> </span><span class="annot"><span class="annottext">(ConInfo -&gt; GREInfo)
-&gt; (TupleSort -&gt; ConInfo) -&gt; TupleSort -&gt; GREInfo
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span> </span><span class="annot"><span class="annottext">TupleSort
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">ConLikeInfo -&gt; Arity -&gt; [FieldLabel] -&gt; ConInfo
</span><a href="GHC.Types.GREInfo.html#mkConInfo"><span class="hs-identifier hs-var">mkConInfo</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[Name] -&gt; ConLikeInfo
</span><a href="GHC.Types.GREInfo.html#ConIsData"><span class="hs-identifier hs-var">ConIsData</span></a></span><span> </span><span class="annot"><span class="annottext">([Name] -&gt; ConLikeInfo) -&gt; [Name] -&gt; ConLikeInfo
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">(DataCon -&gt; Name) -&gt; [DataCon] -&gt; [Name]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><span class="hs-identifier hs-var">map</span></span><span> </span><span class="annot"><span class="annottext">DataCon -&gt; Name
</span><a href="GHC.Core.DataCon.html#dataConName"><span class="hs-identifier hs-var">dataConName</span></a></span><span> </span><span class="annot"><span class="annottext">([DataCon] -&gt; [Name]) -&gt; [DataCon] -&gt; [Name]
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">TyCon -&gt; [DataCon]
</span><a href="GHC.Core.TyCon.html#tyConDataCons"><span class="hs-identifier hs-var">tyConDataCons</span></a></span><span> </span><span class="annot"><span class="annottext">TyCon
</span><a href="#local-6989586621683035358"><span class="hs-identifier hs-var">tc</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">DataCon -&gt; Arity
</span><a href="GHC.Core.DataCon.html#dataConSourceArity"><span class="hs-identifier hs-var">dataConSourceArity</span></a></span><span> </span><span class="annot"><span class="annottext">DataCon
</span><a href="#local-6989586621683035357"><span class="hs-identifier hs-var">dc</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-332"></span><span>          </span><span class="annot"><span class="annottext">TyThing
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Maybe (TyCon, TupleSort -&gt; GREInfo)
forall a. Maybe a
</span><span class="hs-identifier hs-var">Nothing</span></span><span>
</span><span id="line-333"></span><span>  </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span id="local-6989586621683035366"><span class="annot"><span class="annottext">TupleSort
</span><a href="#local-6989586621683035366"><span class="hs-identifier hs-var">tupleSort</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">TyCon -&gt; Maybe TupleSort
</span><a href="GHC.Core.TyCon.html#tyConTuple_maybe"><span class="hs-identifier hs-var">tyConTuple_maybe</span></a></span><span> </span><span class="annot"><span class="annottext">TyCon
</span><a href="#local-6989586621683035348"><span class="hs-identifier hs-var">tycon</span></a></span><span>
</span><span id="line-334"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621683035368"><span class="annot"><span class="annottext">tupArity :: Arity
</span><a href="#local-6989586621683035368"><span class="hs-identifier hs-var hs-var hs-var">tupArity</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">TupleSort
</span><a href="#local-6989586621683035366"><span class="hs-identifier hs-var">tupleSort</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-335"></span><span>               </span><span class="hs-comment">-- Unboxed tuples have twice as many arguments because of the</span><span>
</span><span id="line-336"></span><span>               </span><span class="hs-comment">-- 'RuntimeRep's (#17837)</span><span>
</span><span id="line-337"></span><span>               </span><span class="annot"><span class="annottext">TupleSort
</span><a href="GHC.Types.Basic.html#UnboxedTuple"><span class="hs-identifier hs-var">UnboxedTuple</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">TyCon -&gt; Arity
</span><a href="GHC.Core.TyCon.html#tyConArity"><span class="hs-identifier hs-var">tyConArity</span></a></span><span> </span><span class="annot"><span class="annottext">TyCon
</span><a href="#local-6989586621683035348"><span class="hs-identifier hs-var">tycon</span></a></span><span> </span><span class="annot"><span class="annottext">Arity -&gt; Arity -&gt; Arity
forall a. Integral a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">`div`</span></span><span> </span><span class="annot"><span class="annottext">Arity
</span><span class="hs-number">2</span></span><span>
</span><span id="line-338"></span><span>               </span><span class="annot"><span class="annottext">TupleSort
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">TyCon -&gt; Arity
</span><a href="GHC.Core.TyCon.html#tyConArity"><span class="hs-identifier hs-var">tyConArity</span></a></span><span> </span><span class="annot"><span class="annottext">TyCon
</span><a href="#local-6989586621683035348"><span class="hs-identifier hs-var">tycon</span></a></span><span>
</span><span id="line-339"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621683035372"><span class="annot"><span class="annottext">info :: GREInfo
</span><a href="#local-6989586621683035372"><span class="hs-identifier hs-var hs-var hs-var">info</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">TupleSort -&gt; GREInfo
</span><a href="#local-6989586621683035349"><span class="hs-identifier hs-var">mkInfo</span></a></span><span> </span><span class="annot"><span class="annottext">TupleSort
</span><a href="#local-6989586621683035366"><span class="hs-identifier hs-var">tupleSort</span></a></span><span>
</span><span id="line-340"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="annottext">Arity -&gt; IOEnv (Env TcGblEnv TcLclEnv) ()
</span><a href="GHC.Rename.Utils.html#checkTupSize"><span class="hs-identifier hs-var">checkTupSize</span></a></span><span> </span><span class="annot"><span class="annottext">Arity
</span><a href="#local-6989586621683035368"><span class="hs-identifier hs-var">tupArity</span></a></span><span>
</span><span id="line-341"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="annottext">Either NotInScopeError GlobalRdrElt
-&gt; RnM (Either NotInScopeError GlobalRdrElt)
forall a. a -&gt; IOEnv (Env TcGblEnv TcLclEnv) a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="annot"><span class="annottext">(Either NotInScopeError GlobalRdrElt
 -&gt; RnM (Either NotInScopeError GlobalRdrElt))
-&gt; Either NotInScopeError GlobalRdrElt
-&gt; RnM (Either NotInScopeError GlobalRdrElt)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">GlobalRdrElt -&gt; Either NotInScopeError GlobalRdrElt
forall a b. b -&gt; Either a b
</span><span class="hs-identifier hs-var">Right</span></span><span> </span><span class="annot"><span class="annottext">(GlobalRdrElt -&gt; Either NotInScopeError GlobalRdrElt)
-&gt; GlobalRdrElt -&gt; Either NotInScopeError GlobalRdrElt
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Name -&gt; GREInfo -&gt; GlobalRdrElt
</span><a href="GHC.Types.Name.Reader.html#mkExactGRE"><span class="hs-identifier hs-var">mkExactGRE</span></a></span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621683035345"><span class="hs-identifier hs-var">name</span></a></span><span> </span><span class="annot"><span class="annottext">GREInfo
</span><a href="#local-6989586621683035372"><span class="hs-identifier hs-var">info</span></a></span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-342"></span><span>
</span><span id="line-343"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Name -&gt; Bool
</span><a href="GHC.Types.Name.html#isExternalName"><span class="hs-identifier hs-var">isExternalName</span></a></span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621683035345"><span class="hs-identifier hs-var">name</span></a></span><span>
</span><span id="line-344"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span id="local-6989586621683035375"><span class="annot"><a href="#local-6989586621683035375"><span class="hs-identifier hs-var">info</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Name -&gt; RnM GREInfo
</span><a href="GHC.Rename.Env.html#lookupExternalExactName"><span class="hs-identifier hs-var">lookupExternalExactName</span></a></span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621683035345"><span class="hs-identifier hs-var">name</span></a></span><span>
</span><span id="line-345"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">return</span></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Right</span></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="annot"><a href="GHC.Types.Name.Reader.html#mkExactGRE"><span class="hs-identifier hs-type">mkExactGRE</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683035345"><span class="hs-identifier hs-type">name</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683035375"><span class="hs-identifier hs-type">info</span></a></span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-346"></span><span>
</span><span id="line-347"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">otherwise</span></span><span>
</span><span id="line-348"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Name -&gt; RnM (Either NotInScopeError GlobalRdrElt)
</span><a href="GHC.Rename.Env.html#lookupLocalExactGRE"><span class="hs-identifier hs-var">lookupLocalExactGRE</span></a></span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621683035345"><span class="hs-identifier hs-var">name</span></a></span><span>
</span><span id="line-349"></span><span>
</span><span id="line-350"></span><span class="annot"><a href="GHC.Rename.Env.html#lookupExternalExactName"><span class="hs-identifier hs-type">lookupExternalExactName</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Types.Name.html#Name"><span class="hs-identifier hs-type">Name</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#RnM"><span class="hs-identifier hs-type">RnM</span></a></span><span> </span><span class="annot"><a href="GHC.Types.GREInfo.html#GREInfo"><span class="hs-identifier hs-type">GREInfo</span></a></span><span>
</span><span id="line-351"></span><span id="lookupExternalExactName"><span class="annot"><span class="annottext">lookupExternalExactName :: Name -&gt; RnM GREInfo
</span><a href="GHC.Rename.Env.html#lookupExternalExactName"><span class="hs-identifier hs-var hs-var">lookupExternalExactName</span></a></span></span><span> </span><span id="local-6989586621683035378"><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621683035378"><span class="hs-identifier hs-var">name</span></a></span></span><span>
</span><span id="line-352"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span id="local-6989586621683035379"><span class="annot"><a href="#local-6989586621683035379"><span class="hs-identifier hs-var">thing</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span>
</span><span id="line-353"></span><span>           </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">Name -&gt; Maybe TyThing
</span><a href="GHC.Types.Name.html#wiredInNameTyThing_maybe"><span class="hs-identifier hs-var">wiredInNameTyThing_maybe</span></a></span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621683035378"><span class="hs-identifier hs-var">name</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-354"></span><span>             </span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span id="local-6989586621683035380"><span class="annot"><span class="annottext">TyThing
</span><a href="#local-6989586621683035380"><span class="hs-identifier hs-var">thing</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">TyThing -&gt; IOEnv (Env TcGblEnv TcLclEnv) TyThing
forall a. a -&gt; IOEnv (Env TcGblEnv TcLclEnv) a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="annot"><span class="annottext">TyThing
</span><a href="#local-6989586621683035380"><span class="hs-identifier hs-var">thing</span></a></span><span>
</span><span id="line-355"></span><span>             </span><span class="annot"><span class="annottext">Maybe TyThing
</span><span class="hs-identifier">_</span></span><span>          </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Name -&gt; IOEnv (Env TcGblEnv TcLclEnv) TyThing
</span><a href="GHC.Tc.Utils.Env.html#tcLookupGlobal"><span class="hs-identifier hs-var">tcLookupGlobal</span></a></span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621683035378"><span class="hs-identifier hs-var">name</span></a></span><span>
</span><span id="line-356"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">return</span></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="annot"><a href="GHC.Types.TyThing.html#tyThingGREInfo"><span class="hs-identifier hs-type">tyThingGREInfo</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683035379"><span class="hs-identifier hs-type">thing</span></a></span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-357"></span><span>
</span><span id="line-358"></span><span class="annot"><a href="GHC.Rename.Env.html#lookupLocalExactGRE"><span class="hs-identifier hs-type">lookupLocalExactGRE</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Types.Name.html#Name"><span class="hs-identifier hs-type">Name</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#RnM"><span class="hs-identifier hs-type">RnM</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Either</span></span><span> </span><span class="annot"><a href="GHC.Tc.Errors.Types.html#NotInScopeError"><span class="hs-identifier hs-type">NotInScopeError</span></a></span><span> </span><span class="annot"><a href="GHC.Types.Name.Reader.html#GlobalRdrElt"><span class="hs-identifier hs-type">GlobalRdrElt</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-359"></span><span id="lookupLocalExactGRE"><span class="annot"><span class="annottext">lookupLocalExactGRE :: Name -&gt; RnM (Either NotInScopeError GlobalRdrElt)
</span><a href="GHC.Rename.Env.html#lookupLocalExactGRE"><span class="hs-identifier hs-var hs-var">lookupLocalExactGRE</span></a></span></span><span> </span><span id="local-6989586621683035382"><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621683035382"><span class="hs-identifier hs-var">name</span></a></span></span><span>
</span><span id="line-360"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span id="local-6989586621683035383"><span class="annot"><a href="#local-6989586621683035383"><span class="hs-identifier hs-var">env</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">TcRn GlobalRdrEnv
</span><a href="GHC.Tc.Utils.Monad.html#getGlobalRdrEnv"><span class="hs-identifier hs-var">getGlobalRdrEnv</span></a></span><span>
</span><span id="line-361"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621683035384"><span class="annot"><a href="#local-6989586621683035384"><span class="hs-identifier hs-var hs-var">lk</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="GHC.Types.Name.Reader.html#LookupExactName"><span class="hs-identifier hs-type">LookupExactName</span></a></span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">lookupExactName :: Name
</span><a href="GHC.Types.Name.Reader.html#lookupExactName"><span class="hs-identifier hs-var">lookupExactName</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621683035382"><span class="hs-identifier hs-var">name</span></a></span><span>
</span><span id="line-362"></span><span>                                  </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">lookInAllNameSpaces :: Bool
</span><a href="GHC.Types.Name.Reader.html#lookInAllNameSpaces"><span class="hs-identifier hs-var">lookInAllNameSpaces</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">True</span></span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-363"></span><span>             </span><span class="hs-comment">-- We want to check for clashes where the same Unique</span><span>
</span><span id="line-364"></span><span>             </span><span class="hs-comment">-- occurs in two different NameSpaces, as per</span><span>
</span><span id="line-365"></span><span>             </span><span class="hs-comment">-- Note [Template Haskell ambiguity]. So we</span><span>
</span><span id="line-366"></span><span>             </span><span class="hs-comment">-- check ALL namespaces, not just the NameSpace of the Name.</span><span>
</span><span id="line-367"></span><span>             </span><span class="hs-comment">-- See test cases T9066, T11809.</span><span>
</span><span id="line-368"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><a href="GHC.Types.Name.Reader.html#lookupGRE"><span class="hs-identifier hs-type">lookupGRE</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683035383"><span class="hs-identifier hs-type">env</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683035384"><span class="hs-identifier hs-type">lk</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-369"></span><span>           </span><span class="hs-special">[</span><span id="local-6989586621683035388"><span class="annot"><span class="annottext">GlobalRdrElt
</span><a href="#local-6989586621683035388"><span class="hs-identifier hs-var">gre</span></a></span></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Either NotInScopeError GlobalRdrElt
-&gt; RnM (Either NotInScopeError GlobalRdrElt)
forall a. a -&gt; IOEnv (Env TcGblEnv TcLclEnv) a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">GlobalRdrElt -&gt; Either NotInScopeError GlobalRdrElt
forall a b. b -&gt; Either a b
</span><span class="hs-identifier hs-var">Right</span></span><span> </span><span class="annot"><span class="annottext">GlobalRdrElt
</span><a href="#local-6989586621683035388"><span class="hs-identifier hs-var">gre</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-370"></span><span>
</span><span id="line-371"></span><span>           </span><span class="hs-special">[</span><span class="hs-special">]</span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-comment">-- See Note [Splicing Exact names]</span><span>
</span><span id="line-372"></span><span>                    </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span id="local-6989586621683035389"><span class="annot"><a href="#local-6989586621683035389"><span class="hs-identifier hs-var">lcl_env</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">RnM LocalRdrEnv
</span><a href="GHC.Tc.Utils.Monad.html#getLocalRdrEnv"><span class="hs-identifier hs-var">getLocalRdrEnv</span></a></span><span>
</span><span id="line-373"></span><span>                       </span><span class="hs-special">;</span><span> </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621683035391"><span class="annot"><a href="#local-6989586621683035391"><span class="hs-identifier hs-var hs-var">gre</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Parent -&gt; Name -&gt; GlobalRdrElt
</span><a href="GHC.Types.Name.Reader.html#mkLocalVanillaGRE"><span class="hs-identifier hs-var">mkLocalVanillaGRE</span></a></span><span> </span><span class="annot"><span class="annottext">Parent
</span><a href="GHC.Types.Name.Reader.html#NoParent"><span class="hs-identifier hs-var">NoParent</span></a></span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621683035382"><span class="hs-identifier hs-var">name</span></a></span><span> </span><span class="hs-comment">-- LocalRdrEnv only contains Vanilla things</span><span>
</span><span id="line-374"></span><span>                       </span><span class="hs-special">;</span><span> </span><span class="hs-keyword">if</span><span> </span><span class="annot"><a href="#local-6989586621683035382"><span class="hs-identifier hs-type">name</span></a></span><span> </span><span class="annot"><a href="GHC.Types.Name.Reader.html#inLocalRdrEnvScope"><span class="hs-operator hs-type">`inLocalRdrEnvScope`</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683035389"><span class="hs-identifier hs-type">lcl_env</span></a></span><span>
</span><span id="line-375"></span><span>                         </span><span class="hs-keyword">then</span><span> </span><span class="annot"><span class="hs-identifier hs-type">return</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Right</span></span><span> </span><span class="annot"><a href="#local-6989586621683035391"><span class="hs-identifier hs-type">gre</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-376"></span><span>                         </span><span class="hs-keyword">else</span><span>
</span><span id="line-377"></span><span>                         </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span id="local-6989586621683035395"><span class="annot"><a href="#local-6989586621683035395"><span class="hs-identifier hs-var">th_topnames_var</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="hs-identifier hs-type">fmap</span></span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#tcg_th_topnames"><span class="hs-identifier hs-var">tcg_th_topnames</span></a></span><span> </span><span class="annot"><a href="GHC.Tc.Utils.Monad.html#getGblEnv"><span class="hs-identifier hs-type">getGblEnv</span></a></span><span>
</span><span id="line-378"></span><span>                            </span><span class="hs-special">;</span><span> </span><span id="local-6989586621683035398"><span class="annot"><a href="#local-6989586621683035398"><span class="hs-identifier hs-var">th_topnames</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><a href="GHC.Tc.Types.TcRef.html#readTcRef"><span class="hs-identifier hs-type">readTcRef</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683035395"><span class="hs-identifier hs-type">th_topnames_var</span></a></span><span>
</span><span id="line-379"></span><span>                            </span><span class="hs-special">;</span><span> </span><span class="hs-keyword">if</span><span> </span><span class="annot"><a href="#local-6989586621683035382"><span class="hs-identifier hs-type">name</span></a></span><span> </span><span class="annot"><a href="GHC.Types.Name.Set.html#elemNameSet"><span class="hs-operator hs-type">`elemNameSet`</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683035398"><span class="hs-identifier hs-type">th_topnames</span></a></span><span>
</span><span id="line-380"></span><span>                              </span><span class="hs-keyword">then</span><span> </span><span class="annot"><span class="hs-identifier hs-type">return</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Right</span></span><span> </span><span class="annot"><a href="#local-6989586621683035391"><span class="hs-identifier hs-type">gre</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-381"></span><span>                              </span><span class="hs-keyword">else</span><span> </span><span class="annot"><span class="hs-identifier hs-type">return</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Left</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Tc.Errors.Types.html#NoExactName"><span class="hs-identifier hs-type">NoExactName</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683035382"><span class="hs-identifier hs-type">name</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-382"></span><span>                            </span><span class="hs-special">}</span><span>
</span><span id="line-383"></span><span>                       </span><span class="hs-special">}</span><span>
</span><span id="line-384"></span><span>
</span><span id="line-385"></span><span>           </span><span id="local-6989586621683035402"><span class="annot"><span class="annottext">[GlobalRdrElt]
</span><a href="#local-6989586621683035402"><span class="hs-identifier hs-var">gres</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Either NotInScopeError GlobalRdrElt
-&gt; RnM (Either NotInScopeError GlobalRdrElt)
forall a. a -&gt; IOEnv (Env TcGblEnv TcLclEnv) a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">NotInScopeError -&gt; Either NotInScopeError GlobalRdrElt
forall a b. a -&gt; Either a b
</span><span class="hs-identifier hs-var">Left</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[GlobalRdrElt] -&gt; NotInScopeError
</span><a href="GHC.Tc.Errors.Types.html#SameName"><span class="hs-identifier hs-var">SameName</span></a></span><span> </span><span class="annot"><span class="annottext">[GlobalRdrElt]
</span><a href="#local-6989586621683035402"><span class="hs-identifier hs-var">gres</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-386"></span><span>           </span><span class="hs-comment">-- Ugh!  See Note [Template Haskell ambiguity] }</span><span>
</span><span id="line-387"></span><span>
</span><span id="line-388"></span><span class="hs-comment">-----------------------------------------------</span><span>
</span><span id="line-389"></span><span class="annot"><a href="GHC.Rename.Env.html#lookupInstDeclBndr"><span class="hs-identifier hs-type">lookupInstDeclBndr</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Types.Name.html#Name"><span class="hs-identifier hs-type">Name</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Utils.Outputable.html#SDoc"><span class="hs-identifier hs-type">SDoc</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Types.Name.Reader.html#RdrName"><span class="hs-identifier hs-type">RdrName</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#RnM"><span class="hs-identifier hs-type">RnM</span></a></span><span> </span><span class="annot"><a href="GHC.Types.Name.html#Name"><span class="hs-identifier hs-type">Name</span></a></span><span>
</span><span id="line-390"></span><span class="hs-comment">-- This is called on the method name on the left-hand side of an</span><span>
</span><span id="line-391"></span><span class="hs-comment">-- instance declaration binding. eg.  instance Functor T where</span><span>
</span><span id="line-392"></span><span class="hs-comment">--                                       fmap = ...</span><span>
</span><span id="line-393"></span><span class="hs-comment">--                                       ^^^^ called on this</span><span>
</span><span id="line-394"></span><span class="hs-comment">-- Regardless of how many unqualified fmaps are in scope, we want</span><span>
</span><span id="line-395"></span><span class="hs-comment">-- the one that comes from the Functor class.</span><span>
</span><span id="line-396"></span><span class="hs-comment">--</span><span>
</span><span id="line-397"></span><span class="hs-comment">-- Furthermore, note that we take no account of whether the</span><span>
</span><span id="line-398"></span><span class="hs-comment">-- name is only in scope qualified.  I.e. even if method op is</span><span>
</span><span id="line-399"></span><span class="hs-comment">-- in scope as M.op, we still allow plain 'op' on the LHS of</span><span>
</span><span id="line-400"></span><span class="hs-comment">-- an instance decl</span><span>
</span><span id="line-401"></span><span class="hs-comment">--</span><span>
</span><span id="line-402"></span><span class="hs-comment">-- The &quot;what&quot; parameter says &quot;method&quot; or &quot;associated type&quot;,</span><span>
</span><span id="line-403"></span><span class="hs-comment">-- depending on what we are looking up</span><span>
</span><span id="line-404"></span><span id="lookupInstDeclBndr"><span class="annot"><span class="annottext">lookupInstDeclBndr :: Name -&gt; SDoc -&gt; RdrName -&gt; RnM Name
</span><a href="GHC.Rename.Env.html#lookupInstDeclBndr"><span class="hs-identifier hs-var hs-var">lookupInstDeclBndr</span></a></span></span><span> </span><span id="local-6989586621683035404"><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621683035404"><span class="hs-identifier hs-var">cls</span></a></span></span><span> </span><span id="local-6989586621683035405"><span class="annot"><span class="annottext">SDoc
</span><a href="#local-6989586621683035405"><span class="hs-identifier hs-var">what</span></a></span></span><span> </span><span id="local-6989586621683035406"><span class="annot"><span class="annottext">RdrName
</span><a href="#local-6989586621683035406"><span class="hs-identifier hs-var">rdr</span></a></span></span><span>
</span><span id="line-405"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">Bool
-&gt; IOEnv (Env TcGblEnv TcLclEnv) ()
-&gt; IOEnv (Env TcGblEnv TcLclEnv) ()
forall (f :: * -&gt; *). Applicative f =&gt; Bool -&gt; f () -&gt; f ()
</span><span class="hs-identifier hs-var">when</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">RdrName -&gt; Bool
</span><a href="GHC.Types.Name.Reader.html#isQual"><span class="hs-identifier hs-var">isQual</span></a></span><span> </span><span class="annot"><span class="annottext">RdrName
</span><a href="#local-6989586621683035406"><span class="hs-identifier hs-var">rdr</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-406"></span><span>              </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TcRnMessage -&gt; IOEnv (Env TcGblEnv TcLclEnv) ()
</span><a href="GHC.Tc.Utils.Monad.html#addErr"><span class="hs-identifier hs-var">addErr</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">RdrName -&gt; TcRnMessage
</span><a href="GHC.Rename.Utils.html#badQualBndrErr"><span class="hs-identifier hs-var">badQualBndrErr</span></a></span><span> </span><span class="annot"><span class="annottext">RdrName
</span><a href="#local-6989586621683035406"><span class="hs-identifier hs-var">rdr</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-407"></span><span>                </span><span class="hs-comment">-- In an instance decl you aren't allowed</span><span>
</span><span id="line-408"></span><span>                </span><span class="hs-comment">-- to use a qualified name for the method</span><span>
</span><span id="line-409"></span><span>                </span><span class="hs-comment">-- (Although it'd make perfect sense.)</span><span>
</span><span id="line-410"></span><span>       </span><span class="hs-special">;</span><span> </span><span id="local-6989586621683035407"><span class="annot"><a href="#local-6989586621683035407"><span class="hs-identifier hs-var">mb_name</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">DeprecationWarnings
-&gt; Name -&gt; SDoc -&gt; RdrName -&gt; RnM (Either NotInScopeError Name)
</span><a href="GHC.Rename.Env.html#lookupSubBndrOcc"><span class="hs-identifier hs-var">lookupSubBndrOcc</span></a></span><span>
</span><span id="line-411"></span><span>                          </span><span class="annot"><span class="annottext">DeprecationWarnings
</span><a href="GHC.Rename.Utils.html#NoDeprecationWarnings"><span class="hs-identifier hs-var">NoDeprecationWarnings</span></a></span><span>
</span><span id="line-412"></span><span>                                </span><span class="hs-comment">-- we don't give deprecated</span><span>
</span><span id="line-413"></span><span>                                </span><span class="hs-comment">-- warnings when a deprecated class</span><span>
</span><span id="line-414"></span><span>                                </span><span class="hs-comment">-- method is defined. We only warn</span><span>
</span><span id="line-415"></span><span>                                </span><span class="hs-comment">-- when it's used</span><span>
</span><span id="line-416"></span><span>                          </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621683035404"><span class="hs-identifier hs-var">cls</span></a></span><span> </span><span class="annot"><span class="annottext">SDoc
</span><a href="#local-6989586621683035410"><span class="hs-identifier hs-var">doc</span></a></span><span> </span><span class="annot"><span class="annottext">RdrName
</span><a href="#local-6989586621683035406"><span class="hs-identifier hs-var">rdr</span></a></span><span>
</span><span id="line-417"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><a href="#local-6989586621683035407"><span class="hs-identifier hs-type">mb_name</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-418"></span><span>           </span><span class="annot"><span class="hs-identifier hs-type">Left</span></span><span> </span><span id="local-6989586621683035411"><span class="annot"><span class="annottext">NotInScopeError
</span><a href="#local-6989586621683035411"><span class="hs-identifier hs-var">err</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">TcRnMessage -&gt; IOEnv (Env TcGblEnv TcLclEnv) ()
</span><a href="GHC.Tc.Utils.Monad.html#addErr"><span class="hs-identifier hs-var">addErr</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">RdrName -&gt; NotInScopeError -&gt; TcRnMessage
</span><a href="GHC.Tc.Errors.Types.html#mkTcRnNotInScope"><span class="hs-identifier hs-var">mkTcRnNotInScope</span></a></span><span> </span><span class="annot"><span class="annottext">RdrName
</span><a href="#local-6989586621683035406"><span class="hs-identifier hs-var">rdr</span></a></span><span> </span><span class="annot"><span class="annottext">NotInScopeError
</span><a href="#local-6989586621683035411"><span class="hs-identifier hs-var">err</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-419"></span><span>                          </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="annottext">Name -&gt; RnM Name
forall a. a -&gt; IOEnv (Env TcGblEnv TcLclEnv) a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">RdrName -&gt; Name
</span><a href="GHC.Rename.Unbound.html#mkUnboundNameRdr"><span class="hs-identifier hs-var">mkUnboundNameRdr</span></a></span><span> </span><span class="annot"><span class="annottext">RdrName
</span><a href="#local-6989586621683035406"><span class="hs-identifier hs-var">rdr</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-420"></span><span>           </span><span class="annot"><span class="hs-identifier hs-type">Right</span></span><span> </span><span id="local-6989586621683035414"><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621683035414"><span class="hs-identifier hs-var">nm</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Name -&gt; RnM Name
forall a. a -&gt; IOEnv (Env TcGblEnv TcLclEnv) a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621683035414"><span class="hs-identifier hs-var">nm</span></a></span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-421"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-422"></span><span>    </span><span id="local-6989586621683035410"><span class="annot"><span class="annottext">doc :: SDoc
</span><a href="#local-6989586621683035410"><span class="hs-identifier hs-var hs-var">doc</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">SDoc
</span><a href="#local-6989586621683035405"><span class="hs-identifier hs-var">what</span></a></span><span> </span><span class="annot"><span class="annottext">SDoc -&gt; SDoc -&gt; SDoc
forall doc. IsLine doc =&gt; doc -&gt; doc -&gt; doc
</span><a href="GHC.Utils.Outputable.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">String -&gt; SDoc
forall doc. IsLine doc =&gt; String -&gt; doc
</span><a href="GHC.Utils.Outputable.html#text"><span class="hs-identifier hs-var">text</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;of class&quot;</span></span><span> </span><span class="annot"><span class="annottext">SDoc -&gt; SDoc -&gt; SDoc
forall doc. IsLine doc =&gt; doc -&gt; doc -&gt; doc
</span><a href="GHC.Utils.Outputable.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">SDoc -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#quotes"><span class="hs-identifier hs-var">quotes</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Name -&gt; SDoc
forall a. Outputable a =&gt; a -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621683035404"><span class="hs-identifier hs-var">cls</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-423"></span><span>
</span><span id="line-424"></span><span class="hs-comment">-----------------------------------------------</span><span>
</span><span id="line-425"></span><span class="annot"><a href="GHC.Rename.Env.html#lookupFamInstName"><span class="hs-identifier hs-type">lookupFamInstName</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Maybe</span></span><span> </span><span class="annot"><a href="GHC.Types.Name.html#Name"><span class="hs-identifier hs-type">Name</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Parser.Annotation.html#LocatedN"><span class="hs-identifier hs-type">LocatedN</span></a></span><span> </span><span class="annot"><a href="GHC.Types.Name.Reader.html#RdrName"><span class="hs-identifier hs-type">RdrName</span></a></span><span>
</span><span id="line-426"></span><span>                  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#RnM"><span class="hs-identifier hs-type">RnM</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Parser.Annotation.html#LocatedN"><span class="hs-identifier hs-type">LocatedN</span></a></span><span> </span><span class="annot"><a href="GHC.Types.Name.html#Name"><span class="hs-identifier hs-type">Name</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-427"></span><span class="hs-comment">-- Used for TyData and TySynonym family instances only,</span><span>
</span><span id="line-428"></span><span class="hs-comment">-- See Note [Family instance binders]</span><span>
</span><span id="line-429"></span><span id="lookupFamInstName"><span class="annot"><span class="annottext">lookupFamInstName :: Maybe Name -&gt; LocatedN RdrName -&gt; RnM (LocatedN Name)
</span><a href="GHC.Rename.Env.html#lookupFamInstName"><span class="hs-identifier hs-var hs-var">lookupFamInstName</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span id="local-6989586621683035418"><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621683035418"><span class="hs-identifier hs-var">cls</span></a></span></span><span class="hs-special">)</span><span> </span><span id="local-6989586621683035419"><span class="annot"><span class="annottext">LocatedN RdrName
</span><a href="#local-6989586621683035419"><span class="hs-identifier hs-var">tc_rdr</span></a></span></span><span>  </span><span class="hs-comment">-- Associated type; c.f GHC.Rename.Bind.rnMethodBind</span><span>
</span><span id="line-430"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(RdrName -&gt; RnM Name) -&gt; LocatedN RdrName -&gt; RnM (LocatedN Name)
forall a b ann.
(a -&gt; TcM b)
-&gt; GenLocated (EpAnn ann) a -&gt; TcRn (GenLocated (EpAnn ann) b)
</span><a href="GHC.Tc.Utils.Monad.html#wrapLocMA"><span class="hs-identifier hs-var">wrapLocMA</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Name -&gt; SDoc -&gt; RdrName -&gt; RnM Name
</span><a href="GHC.Rename.Env.html#lookupInstDeclBndr"><span class="hs-identifier hs-var">lookupInstDeclBndr</span></a></span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621683035418"><span class="hs-identifier hs-var">cls</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">String -&gt; SDoc
forall doc. IsLine doc =&gt; String -&gt; doc
</span><a href="GHC.Utils.Outputable.html#text"><span class="hs-identifier hs-var">text</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;associated type&quot;</span></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">LocatedN RdrName
</span><a href="#local-6989586621683035419"><span class="hs-identifier hs-var">tc_rdr</span></a></span><span>
</span><span id="line-431"></span><span class="annot"><a href="GHC.Rename.Env.html#lookupFamInstName"><span class="hs-identifier hs-var">lookupFamInstName</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe Name
</span><span class="hs-identifier hs-var">Nothing</span></span><span> </span><span id="local-6989586621683035420"><span class="annot"><span class="annottext">LocatedN RdrName
</span><a href="#local-6989586621683035420"><span class="hs-identifier hs-var">tc_rdr</span></a></span></span><span>     </span><span class="hs-comment">-- Family instance; tc_rdr is an *occurrence*</span><span>
</span><span id="line-432"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">LocatedN RdrName -&gt; RnM (LocatedN Name)
forall ann.
GenLocated (EpAnn ann) RdrName
-&gt; TcRn (GenLocated (EpAnn ann) Name)
</span><a href="GHC.Rename.Env.html#lookupLocatedOccRnConstr"><span class="hs-identifier hs-var">lookupLocatedOccRnConstr</span></a></span><span> </span><span class="annot"><span class="annottext">LocatedN RdrName
</span><a href="#local-6989586621683035420"><span class="hs-identifier hs-var">tc_rdr</span></a></span><span>
</span><span id="line-433"></span><span>
</span><span id="line-434"></span><span class="hs-comment">-----------------------------------------------</span><span>
</span><span id="line-435"></span><span class="annot"><a href="GHC.Rename.Env.html#lookupConstructorFields"><span class="hs-identifier hs-type">lookupConstructorFields</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Utils.Misc.html#HasDebugCallStack"><span class="hs-identifier hs-type">HasDebugCallStack</span></a></span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="GHC.Types.Name.html#Name"><span class="hs-identifier hs-type">Name</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#RnM"><span class="hs-identifier hs-type">RnM</span></a></span><span> </span><span class="hs-special">[</span><span class="annot"><a href="GHC.Types.FieldLabel.html#FieldLabel"><span class="hs-identifier hs-type">FieldLabel</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-436"></span><span id="lookupConstructorFields"><span class="annot"><span class="annottext">lookupConstructorFields :: HasDebugCallStack =&gt; Name -&gt; RnM [FieldLabel]
</span><a href="GHC.Rename.Env.html#lookupConstructorFields"><span class="hs-identifier hs-var hs-var">lookupConstructorFields</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(ConInfo -&gt; [FieldLabel])
-&gt; IOEnv (Env TcGblEnv TcLclEnv) ConInfo -&gt; RnM [FieldLabel]
forall a b.
(a -&gt; b)
-&gt; IOEnv (Env TcGblEnv TcLclEnv) a
-&gt; IOEnv (Env TcGblEnv TcLclEnv) b
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-identifier hs-var">fmap</span></span><span> </span><span class="annot"><span class="annottext">ConInfo -&gt; [FieldLabel]
</span><a href="GHC.Types.GREInfo.html#conInfoFields"><span class="hs-identifier hs-var">conInfoFields</span></a></span><span> </span><span class="annot"><span class="annottext">(IOEnv (Env TcGblEnv TcLclEnv) ConInfo -&gt; RnM [FieldLabel])
-&gt; (Name -&gt; IOEnv (Env TcGblEnv TcLclEnv) ConInfo)
-&gt; Name
-&gt; RnM [FieldLabel]
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">HasDebugCallStack =&gt; Name -&gt; IOEnv (Env TcGblEnv TcLclEnv) ConInfo
Name -&gt; IOEnv (Env TcGblEnv TcLclEnv) ConInfo
</span><a href="GHC.Rename.Env.html#lookupConstructorInfo"><span class="hs-identifier hs-var">lookupConstructorInfo</span></a></span><span>
</span><span id="line-437"></span><span>
</span><span id="line-438"></span><span class="annot"><span class="hs-comment">-- | Look up the arity and record fields of a constructor.</span></span><span>
</span><span id="line-439"></span><span class="annot"><a href="GHC.Rename.Env.html#lookupConstructorInfo"><span class="hs-identifier hs-type">lookupConstructorInfo</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Utils.Misc.html#HasDebugCallStack"><span class="hs-identifier hs-type">HasDebugCallStack</span></a></span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="GHC.Types.Name.html#Name"><span class="hs-identifier hs-type">Name</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#RnM"><span class="hs-identifier hs-type">RnM</span></a></span><span> </span><span class="annot"><a href="GHC.Types.GREInfo.html#ConInfo"><span class="hs-identifier hs-type">ConInfo</span></a></span><span>
</span><span id="line-440"></span><span id="lookupConstructorInfo"><span class="annot"><span class="annottext">lookupConstructorInfo :: HasDebugCallStack =&gt; Name -&gt; IOEnv (Env TcGblEnv TcLclEnv) ConInfo
</span><a href="GHC.Rename.Env.html#lookupConstructorInfo"><span class="hs-identifier hs-var hs-var">lookupConstructorInfo</span></a></span></span><span> </span><span id="local-6989586621683035436"><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621683035436"><span class="hs-identifier hs-var">con_name</span></a></span></span><span>
</span><span id="line-441"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span id="local-6989586621683035437"><span class="annot"><a href="#local-6989586621683035437"><span class="hs-identifier hs-var">info</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">HasDebugCallStack =&gt; Name -&gt; RnM GREInfo
Name -&gt; RnM GREInfo
</span><a href="GHC.Rename.Env.html#lookupGREInfo_GRE"><span class="hs-identifier hs-var">lookupGREInfo_GRE</span></a></span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621683035436"><span class="hs-identifier hs-var">con_name</span></a></span><span>
</span><span id="line-442"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><a href="#local-6989586621683035437"><span class="hs-identifier hs-type">info</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-443"></span><span>            </span><span class="annot"><a href="GHC.Types.GREInfo.html#IAmConLike"><span class="hs-identifier hs-type">IAmConLike</span></a></span><span> </span><span id="local-6989586621683035439"><span class="annot"><span class="annottext">ConInfo
</span><a href="#local-6989586621683035439"><span class="hs-identifier hs-var">con_info</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">ConInfo -&gt; IOEnv (Env TcGblEnv TcLclEnv) ConInfo
forall a. a -&gt; IOEnv (Env TcGblEnv TcLclEnv) a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="annot"><span class="annottext">ConInfo
</span><a href="#local-6989586621683035439"><span class="hs-identifier hs-var">con_info</span></a></span><span>
</span><span id="line-444"></span><span>            </span><span class="annot"><span class="annottext">GREInfo
</span><a href="GHC.Types.GREInfo.html#UnboundGRE"><span class="hs-identifier hs-var">UnboundGRE</span></a></span><span>          </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">ConInfo -&gt; IOEnv (Env TcGblEnv TcLclEnv) ConInfo
forall a. a -&gt; IOEnv (Env TcGblEnv TcLclEnv) a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="annot"><span class="annottext">(ConInfo -&gt; IOEnv (Env TcGblEnv TcLclEnv) ConInfo)
-&gt; ConInfo -&gt; IOEnv (Env TcGblEnv TcLclEnv) ConInfo
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">ConLikeInfo -&gt; ConFieldInfo -&gt; ConInfo
</span><a href="GHC.Types.GREInfo.html#ConInfo"><span class="hs-identifier hs-var">ConInfo</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[Name] -&gt; ConLikeInfo
</span><a href="GHC.Types.GREInfo.html#ConIsData"><span class="hs-identifier hs-var">ConIsData</span></a></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">ConFieldInfo
</span><a href="GHC.Types.GREInfo.html#ConHasPositionalArgs"><span class="hs-identifier hs-var">ConHasPositionalArgs</span></a></span><span>
</span><span id="line-445"></span><span>            </span><span class="annot"><a href="GHC.Types.GREInfo.html#IAmTyCon"><span class="hs-identifier hs-type">IAmTyCon</span></a></span><span> </span><span class="hs-special">{</span><span class="hs-special">}</span><span>         </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">WhatLooking -&gt; Name -&gt; IOEnv (Env TcGblEnv TcLclEnv) ConInfo
forall a. WhatLooking -&gt; Name -&gt; TcM a
</span><a href="GHC.Tc.Utils.Env.html#failIllegalTyCon"><span class="hs-identifier hs-var">failIllegalTyCon</span></a></span><span> </span><span class="annot"><span class="annottext">WhatLooking
</span><a href="GHC.Rename.Unbound.html#WL_Constructor"><span class="hs-identifier hs-var">WL_Constructor</span></a></span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621683035436"><span class="hs-identifier hs-var">con_name</span></a></span><span>
</span><span id="line-446"></span><span>            </span><span class="annot"><span class="annottext">GREInfo
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">String -&gt; SDoc -&gt; IOEnv (Env TcGblEnv TcLclEnv) ConInfo
forall a. HasCallStack =&gt; String -&gt; SDoc -&gt; a
</span><a href="GHC.Utils.Panic.html#pprPanic"><span class="hs-identifier hs-var">pprPanic</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;lookupConstructorInfo: not a ConLike&quot;</span></span><span> </span><span class="annot"><span class="annottext">(SDoc -&gt; IOEnv (Env TcGblEnv TcLclEnv) ConInfo)
-&gt; SDoc -&gt; IOEnv (Env TcGblEnv TcLclEnv) ConInfo
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-447"></span><span>                      </span><span class="annot"><span class="annottext">[SDoc] -&gt; SDoc
forall doc. IsDoc doc =&gt; [doc] -&gt; doc
</span><a href="GHC.Utils.Outputable.html#vcat"><span class="hs-identifier hs-var">vcat</span></a></span><span> </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">String -&gt; SDoc
forall doc. IsLine doc =&gt; String -&gt; doc
</span><a href="GHC.Utils.Outputable.html#text"><span class="hs-identifier hs-var">text</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;name:&quot;</span></span><span> </span><span class="annot"><span class="annottext">SDoc -&gt; SDoc -&gt; SDoc
forall doc. IsLine doc =&gt; doc -&gt; doc -&gt; doc
</span><a href="GHC.Utils.Outputable.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">Name -&gt; SDoc
forall a. Outputable a =&gt; a -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621683035436"><span class="hs-identifier hs-var">con_name</span></a></span><span> </span><span class="hs-special">]</span><span>
</span><span id="line-448"></span><span>       </span><span class="hs-special">}</span><span>
</span><span id="line-449"></span><span>
</span><span id="line-450"></span><span class="hs-comment">-- In CPS style as `RnM r` is monadic</span><span>
</span><span id="line-451"></span><span class="hs-comment">-- Reports an error if the name is an Exact or Orig and it can't find the name</span><span>
</span><span id="line-452"></span><span class="hs-comment">-- Otherwise if it is not an Exact or Orig, returns k</span><span>
</span><span id="line-453"></span><span id="local-6989586621683034503"><span class="annot"><a href="GHC.Rename.Env.html#lookupExactOrOrig"><span class="hs-identifier hs-type">lookupExactOrOrig</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Types.Name.Reader.html#RdrName"><span class="hs-identifier hs-type">RdrName</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Types.Name.Reader.html#GlobalRdrElt"><span class="hs-identifier hs-type">GlobalRdrElt</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621683034503"><span class="hs-identifier hs-type">r</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#RnM"><span class="hs-identifier hs-type">RnM</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683034503"><span class="hs-identifier hs-type">r</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#RnM"><span class="hs-identifier hs-type">RnM</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683034503"><span class="hs-identifier hs-type">r</span></a></span></span><span>
</span><span id="line-454"></span><span id="lookupExactOrOrig"><span class="annot"><span class="annottext">lookupExactOrOrig :: forall r. RdrName -&gt; (GlobalRdrElt -&gt; r) -&gt; RnM r -&gt; RnM r
</span><a href="GHC.Rename.Env.html#lookupExactOrOrig"><span class="hs-identifier hs-var hs-var">lookupExactOrOrig</span></a></span></span><span> </span><span id="local-6989586621683035450"><span class="annot"><span class="annottext">RdrName
</span><a href="#local-6989586621683035450"><span class="hs-identifier hs-var">rdr_name</span></a></span></span><span> </span><span id="local-6989586621683035451"><span class="annot"><span class="annottext">GlobalRdrElt -&gt; r
</span><a href="#local-6989586621683035451"><span class="hs-identifier hs-var">res</span></a></span></span><span> </span><span id="local-6989586621683035452"><span class="annot"><span class="annottext">RnM r
</span><a href="#local-6989586621683035452"><span class="hs-identifier hs-var">k</span></a></span></span><span>
</span><span id="line-455"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span id="local-6989586621683035453"><span class="annot"><a href="#local-6989586621683035453"><span class="hs-identifier hs-var">men</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">RdrName -&gt; RnM ExactOrOrigResult
</span><a href="GHC.Rename.Env.html#lookupExactOrOrig_base"><span class="hs-identifier hs-var">lookupExactOrOrig_base</span></a></span><span> </span><span class="annot"><span class="annottext">RdrName
</span><a href="#local-6989586621683035450"><span class="hs-identifier hs-var">rdr_name</span></a></span><span>
</span><span id="line-456"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><a href="#local-6989586621683035453"><span class="hs-identifier hs-type">men</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-457"></span><span>          </span><span class="annot"><a href="GHC.Rename.Env.html#FoundExactOrOrig"><span class="hs-identifier hs-type">FoundExactOrOrig</span></a></span><span> </span><span id="local-6989586621683035456"><span class="annot"><span class="annottext">GlobalRdrElt
</span><a href="#local-6989586621683035456"><span class="hs-identifier hs-var">gre</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">r -&gt; RnM r
forall a. a -&gt; IOEnv (Env TcGblEnv TcLclEnv) a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="annot"><span class="annottext">(r -&gt; RnM r) -&gt; r -&gt; RnM r
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">GlobalRdrElt -&gt; r
</span><a href="#local-6989586621683035451"><span class="hs-identifier hs-var">res</span></a></span><span> </span><span class="annot"><span class="annottext">GlobalRdrElt
</span><a href="#local-6989586621683035456"><span class="hs-identifier hs-var">gre</span></a></span><span>
</span><span id="line-458"></span><span>          </span><span class="annot"><span class="annottext">ExactOrOrigResult
</span><a href="GHC.Rename.Env.html#NotExactOrOrig"><span class="hs-identifier hs-var">NotExactOrOrig</span></a></span><span>       </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">RnM r
</span><a href="#local-6989586621683035452"><span class="hs-identifier hs-var">k</span></a></span><span>
</span><span id="line-459"></span><span>          </span><span class="annot"><a href="GHC.Rename.Env.html#ExactOrOrigError"><span class="hs-identifier hs-type">ExactOrOrigError</span></a></span><span> </span><span id="local-6989586621683035459"><span class="annot"><span class="annottext">NotInScopeError
</span><a href="#local-6989586621683035459"><span class="hs-identifier hs-var">e</span></a></span></span><span>   </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-460"></span><span>            </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">TcRnMessage -&gt; IOEnv (Env TcGblEnv TcLclEnv) ()
</span><a href="GHC.Tc.Utils.Monad.html#addErr"><span class="hs-identifier hs-var">addErr</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">RdrName -&gt; NotInScopeError -&gt; TcRnMessage
</span><a href="GHC.Tc.Errors.Types.html#mkTcRnNotInScope"><span class="hs-identifier hs-var">mkTcRnNotInScope</span></a></span><span> </span><span class="annot"><span class="annottext">RdrName
</span><a href="#local-6989586621683035450"><span class="hs-identifier hs-var">rdr_name</span></a></span><span> </span><span class="annot"><span class="annottext">NotInScopeError
</span><a href="#local-6989586621683035459"><span class="hs-identifier hs-var">e</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-461"></span><span>               </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="annottext">r -&gt; RnM r
forall a. a -&gt; IOEnv (Env TcGblEnv TcLclEnv) a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="annot"><span class="annottext">(r -&gt; RnM r) -&gt; r -&gt; RnM r
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">GlobalRdrElt -&gt; r
</span><a href="#local-6989586621683035451"><span class="hs-identifier hs-var">res</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">RdrName -&gt; GlobalRdrElt
</span><a href="GHC.Rename.Unbound.html#mkUnboundGRERdr"><span class="hs-identifier hs-var">mkUnboundGRERdr</span></a></span><span> </span><span class="annot"><span class="annottext">RdrName
</span><a href="#local-6989586621683035450"><span class="hs-identifier hs-var">rdr_name</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-462"></span><span>
</span><span id="line-463"></span><span class="hs-comment">-- Variant of 'lookupExactOrOrig' that does not report an error</span><span>
</span><span id="line-464"></span><span class="hs-comment">-- See Note [Errors in lookup functions]</span><span>
</span><span id="line-465"></span><span class="hs-comment">-- Calls k if the name is neither an Exact nor Orig</span><span>
</span><span id="line-466"></span><span id="local-6989586621683034570"><span class="annot"><a href="GHC.Rename.Env.html#lookupExactOrOrig_maybe"><span class="hs-identifier hs-type">lookupExactOrOrig_maybe</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Types.Name.Reader.html#RdrName"><span class="hs-identifier hs-type">RdrName</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Maybe</span></span><span> </span><span class="annot"><a href="GHC.Types.Name.Reader.html#GlobalRdrElt"><span class="hs-identifier hs-type">GlobalRdrElt</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621683034570"><span class="hs-identifier hs-type">r</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#RnM"><span class="hs-identifier hs-type">RnM</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683034570"><span class="hs-identifier hs-type">r</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#RnM"><span class="hs-identifier hs-type">RnM</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683034570"><span class="hs-identifier hs-type">r</span></a></span></span><span>
</span><span id="line-467"></span><span id="lookupExactOrOrig_maybe"><span class="annot"><span class="annottext">lookupExactOrOrig_maybe :: forall r. RdrName -&gt; (Maybe GlobalRdrElt -&gt; r) -&gt; RnM r -&gt; RnM r
</span><a href="GHC.Rename.Env.html#lookupExactOrOrig_maybe"><span class="hs-identifier hs-var hs-var">lookupExactOrOrig_maybe</span></a></span></span><span> </span><span id="local-6989586621683035465"><span class="annot"><span class="annottext">RdrName
</span><a href="#local-6989586621683035465"><span class="hs-identifier hs-var">rdr_name</span></a></span></span><span> </span><span id="local-6989586621683035466"><span class="annot"><span class="annottext">Maybe GlobalRdrElt -&gt; r
</span><a href="#local-6989586621683035466"><span class="hs-identifier hs-var">res</span></a></span></span><span> </span><span id="local-6989586621683035467"><span class="annot"><span class="annottext">RnM r
</span><a href="#local-6989586621683035467"><span class="hs-identifier hs-var">k</span></a></span></span><span>
</span><span id="line-468"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span id="local-6989586621683035468"><span class="annot"><a href="#local-6989586621683035468"><span class="hs-identifier hs-var">men</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">RdrName -&gt; RnM ExactOrOrigResult
</span><a href="GHC.Rename.Env.html#lookupExactOrOrig_base"><span class="hs-identifier hs-var">lookupExactOrOrig_base</span></a></span><span> </span><span class="annot"><span class="annottext">RdrName
</span><a href="#local-6989586621683035465"><span class="hs-identifier hs-var">rdr_name</span></a></span><span>
</span><span id="line-469"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><a href="#local-6989586621683035468"><span class="hs-identifier hs-type">men</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-470"></span><span>           </span><span class="annot"><a href="GHC.Rename.Env.html#FoundExactOrOrig"><span class="hs-identifier hs-type">FoundExactOrOrig</span></a></span><span> </span><span id="local-6989586621683035469"><span class="annot"><span class="annottext">GlobalRdrElt
</span><a href="#local-6989586621683035469"><span class="hs-identifier hs-var">gre</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">r -&gt; RnM r
forall a. a -&gt; IOEnv (Env TcGblEnv TcLclEnv) a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Maybe GlobalRdrElt -&gt; r
</span><a href="#local-6989586621683035466"><span class="hs-identifier hs-var">res</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">GlobalRdrElt -&gt; Maybe GlobalRdrElt
forall a. a -&gt; Maybe a
</span><span class="hs-identifier hs-var">Just</span></span><span> </span><span class="annot"><span class="annottext">GlobalRdrElt
</span><a href="#local-6989586621683035469"><span class="hs-identifier hs-var">gre</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-471"></span><span>           </span><span class="annot"><a href="GHC.Rename.Env.html#ExactOrOrigError"><span class="hs-identifier hs-type">ExactOrOrigError</span></a></span><span> </span><span class="annot"><span class="annottext">NotInScopeError
</span><span class="hs-identifier">_</span></span><span>   </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">r -&gt; RnM r
forall a. a -&gt; IOEnv (Env TcGblEnv TcLclEnv) a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Maybe GlobalRdrElt -&gt; r
</span><a href="#local-6989586621683035466"><span class="hs-identifier hs-var">res</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe GlobalRdrElt
forall a. Maybe a
</span><span class="hs-identifier hs-var">Nothing</span></span><span class="hs-special">)</span><span>
</span><span id="line-472"></span><span>           </span><span class="annot"><span class="annottext">ExactOrOrigResult
</span><a href="GHC.Rename.Env.html#NotExactOrOrig"><span class="hs-identifier hs-var">NotExactOrOrig</span></a></span><span>       </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">RnM r
</span><a href="#local-6989586621683035467"><span class="hs-identifier hs-var">k</span></a></span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-473"></span><span>
</span><span id="line-474"></span><span class="hs-keyword">data</span><span> </span><span id="ExactOrOrigResult"><span class="annot"><a href="GHC.Rename.Env.html#ExactOrOrigResult"><span class="hs-identifier hs-var">ExactOrOrigResult</span></a></span></span><span>
</span><span id="line-475"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span id="FoundExactOrOrig"><span class="annot"><a href="GHC.Rename.Env.html#FoundExactOrOrig"><span class="hs-identifier hs-var">FoundExactOrOrig</span></a></span></span><span> </span><span class="annot"><a href="GHC.Types.Name.Reader.html#GlobalRdrElt"><span class="hs-identifier hs-type">GlobalRdrElt</span></a></span><span>
</span><span id="line-476"></span><span>    </span><span class="annot"><span class="hs-comment">-- ^ Found an Exact Or Orig Name</span></span><span>
</span><span id="line-477"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span id="ExactOrOrigError"><span class="annot"><a href="GHC.Rename.Env.html#ExactOrOrigError"><span class="hs-identifier hs-var">ExactOrOrigError</span></a></span></span><span> </span><span class="annot"><a href="GHC.Tc.Errors.Types.html#NotInScopeError"><span class="hs-identifier hs-type">NotInScopeError</span></a></span><span>
</span><span id="line-478"></span><span>    </span><span class="hs-comment">-- ^ The RdrName was an Exact</span><span>
</span><span id="line-479"></span><span>     </span><span class="hs-comment">-- or Orig, but there was an</span><span>
</span><span id="line-480"></span><span>     </span><span class="hs-comment">-- error looking up the Name</span><span>
</span><span id="line-481"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span id="NotExactOrOrig"><span class="annot"><a href="GHC.Rename.Env.html#NotExactOrOrig"><span class="hs-identifier hs-var">NotExactOrOrig</span></a></span></span><span>
</span><span id="line-482"></span><span>    </span><span class="annot"><span class="hs-comment">-- ^ The RdrName is neither an Exact nor Orig</span></span><span>
</span><span id="line-483"></span><span>
</span><span id="line-484"></span><span class="hs-comment">-- Does the actual looking up an Exact or Orig name, see 'ExactOrOrigResult'</span><span>
</span><span id="line-485"></span><span class="annot"><a href="GHC.Rename.Env.html#lookupExactOrOrig_base"><span class="hs-identifier hs-type">lookupExactOrOrig_base</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Types.Name.Reader.html#RdrName"><span class="hs-identifier hs-type">RdrName</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#RnM"><span class="hs-identifier hs-type">RnM</span></a></span><span> </span><span class="annot"><a href="GHC.Rename.Env.html#ExactOrOrigResult"><span class="hs-identifier hs-type">ExactOrOrigResult</span></a></span><span>
</span><span id="line-486"></span><span id="lookupExactOrOrig_base"><span class="annot"><span class="annottext">lookupExactOrOrig_base :: RdrName -&gt; RnM ExactOrOrigResult
</span><a href="GHC.Rename.Env.html#lookupExactOrOrig_base"><span class="hs-identifier hs-var hs-var">lookupExactOrOrig_base</span></a></span></span><span> </span><span id="local-6989586621683035470"><span class="annot"><span class="annottext">RdrName
</span><a href="#local-6989586621683035470"><span class="hs-identifier hs-var">rdr_name</span></a></span></span><span>
</span><span id="line-487"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span id="local-6989586621683035471"><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621683035471"><span class="hs-identifier hs-var">n</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">RdrName -&gt; Maybe Name
</span><a href="GHC.Types.Name.Reader.html#isExact_maybe"><span class="hs-identifier hs-var">isExact_maybe</span></a></span><span> </span><span class="annot"><span class="annottext">RdrName
</span><a href="#local-6989586621683035470"><span class="hs-identifier hs-var">rdr_name</span></a></span><span>   </span><span class="hs-comment">-- This happens in derived code</span><span>
</span><span id="line-488"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Either NotInScopeError GlobalRdrElt -&gt; ExactOrOrigResult
</span><a href="#local-6989586621683035472"><span class="hs-identifier hs-var">cvtEither</span></a></span><span> </span><span class="annot"><span class="annottext">(Either NotInScopeError GlobalRdrElt -&gt; ExactOrOrigResult)
-&gt; RnM (Either NotInScopeError GlobalRdrElt)
-&gt; RnM ExactOrOrigResult
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="annot"><span class="annottext">Name -&gt; RnM (Either NotInScopeError GlobalRdrElt)
</span><a href="GHC.Rename.Env.html#lookupExactOcc_either"><span class="hs-identifier hs-var">lookupExactOcc_either</span></a></span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621683035471"><span class="hs-identifier hs-var">n</span></a></span><span>
</span><span id="line-489"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span class="hs-special">(</span><span id="local-6989586621683035474"><span class="annot"><span class="annottext">Module
</span><a href="#local-6989586621683035474"><span class="hs-identifier hs-var">rdr_mod</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621683035475"><span class="annot"><span class="annottext">OccName
</span><a href="#local-6989586621683035475"><span class="hs-identifier hs-var">rdr_occ</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">RdrName -&gt; Maybe (Module, OccName)
</span><a href="GHC.Types.Name.Reader.html#isOrig_maybe"><span class="hs-identifier hs-var">isOrig_maybe</span></a></span><span> </span><span class="annot"><span class="annottext">RdrName
</span><a href="#local-6989586621683035470"><span class="hs-identifier hs-var">rdr_name</span></a></span><span>
</span><span id="line-490"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span id="local-6989586621683035476"><span class="annot"><a href="#local-6989586621683035476"><span class="hs-identifier hs-var">nm</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Module -&gt; OccName -&gt; RnM Name
forall a b. Module -&gt; OccName -&gt; TcRnIf a b Name
</span><a href="GHC.Iface.Env.html#lookupOrig"><span class="hs-identifier hs-var">lookupOrig</span></a></span><span> </span><span class="annot"><span class="annottext">Module
</span><a href="#local-6989586621683035474"><span class="hs-identifier hs-var">rdr_mod</span></a></span><span> </span><span class="annot"><span class="annottext">OccName
</span><a href="#local-6989586621683035475"><span class="hs-identifier hs-var">rdr_occ</span></a></span><span>
</span><span id="line-491"></span><span>
</span><span id="line-492"></span><span>       </span><span class="hs-special">;</span><span> </span><span id="local-6989586621683035478"><span class="annot"><a href="#local-6989586621683035478"><span class="hs-identifier hs-var">this_mod</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><a href="GHC.Unit.Module.html#getModule"><span class="hs-identifier hs-type">getModule</span></a></span><span>
</span><span id="line-493"></span><span>       </span><span class="hs-special">;</span><span> </span><span id="local-6989586621683035479"><span class="annot"><a href="#local-6989586621683035479"><span class="hs-identifier hs-var">mb_gre</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span>
</span><span id="line-494"></span><span>         </span><span class="hs-keyword">if</span><span> </span><span class="annot"><a href="GHC.Types.Name.html#nameIsLocalOrFrom"><span class="hs-identifier hs-type">nameIsLocalOrFrom</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683035478"><span class="hs-identifier hs-type">this_mod</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683035476"><span class="hs-identifier hs-type">nm</span></a></span><span>
</span><span id="line-495"></span><span>         </span><span class="hs-keyword">then</span><span> </span><span class="annot"><a href="GHC.Rename.Env.html#lookupLocalExactGRE"><span class="hs-identifier hs-type">lookupLocalExactGRE</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683035476"><span class="hs-identifier hs-type">nm</span></a></span><span>
</span><span id="line-496"></span><span>         </span><span class="hs-keyword">else</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span id="local-6989586621683035481"><span class="annot"><a href="#local-6989586621683035481"><span class="hs-identifier hs-var">info</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><a href="GHC.Rename.Env.html#lookupExternalExactName"><span class="hs-identifier hs-type">lookupExternalExactName</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683035476"><span class="hs-identifier hs-type">nm</span></a></span><span>
</span><span id="line-497"></span><span>                 </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">return</span></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Right</span></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="annot"><a href="GHC.Types.Name.Reader.html#mkExactGRE"><span class="hs-identifier hs-type">mkExactGRE</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683035476"><span class="hs-identifier hs-type">nm</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683035481"><span class="hs-identifier hs-type">info</span></a></span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-498"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">return</span></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><a href="#local-6989586621683035479"><span class="hs-identifier hs-type">mb_gre</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-499"></span><span>          </span><span class="annot"><span class="hs-identifier hs-type">Left</span></span><span>  </span><span id="local-6989586621683035482"><span class="annot"><span class="annottext">NotInScopeError
</span><a href="#local-6989586621683035482"><span class="hs-identifier hs-var">err</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">NotInScopeError -&gt; ExactOrOrigResult
</span><a href="GHC.Rename.Env.html#ExactOrOrigError"><span class="hs-identifier hs-var">ExactOrOrigError</span></a></span><span> </span><span class="annot"><span class="annottext">NotInScopeError
</span><a href="#local-6989586621683035482"><span class="hs-identifier hs-var">err</span></a></span><span>
</span><span id="line-500"></span><span>          </span><span class="annot"><span class="hs-identifier hs-type">Right</span></span><span> </span><span id="local-6989586621683035483"><span class="annot"><span class="annottext">GlobalRdrElt
</span><a href="#local-6989586621683035483"><span class="hs-identifier hs-var">gre</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">GlobalRdrElt -&gt; ExactOrOrigResult
</span><a href="GHC.Rename.Env.html#FoundExactOrOrig"><span class="hs-identifier hs-var">FoundExactOrOrig</span></a></span><span> </span><span class="annot"><span class="annottext">GlobalRdrElt
</span><a href="#local-6989586621683035483"><span class="hs-identifier hs-var">gre</span></a></span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-501"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">otherwise</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ExactOrOrigResult -&gt; RnM ExactOrOrigResult
forall a. a -&gt; IOEnv (Env TcGblEnv TcLclEnv) a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="annot"><span class="annottext">ExactOrOrigResult
</span><a href="GHC.Rename.Env.html#NotExactOrOrig"><span class="hs-identifier hs-var">NotExactOrOrig</span></a></span><span>
</span><span id="line-502"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-503"></span><span>    </span><span id="local-6989586621683035472"><span class="annot"><span class="annottext">cvtEither :: Either NotInScopeError GlobalRdrElt -&gt; ExactOrOrigResult
</span><a href="#local-6989586621683035472"><span class="hs-identifier hs-var hs-var">cvtEither</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Left</span></span><span> </span><span id="local-6989586621683035484"><span class="annot"><span class="annottext">NotInScopeError
</span><a href="#local-6989586621683035484"><span class="hs-identifier hs-var">e</span></a></span></span><span class="hs-special">)</span><span>    </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">NotInScopeError -&gt; ExactOrOrigResult
</span><a href="GHC.Rename.Env.html#ExactOrOrigError"><span class="hs-identifier hs-var">ExactOrOrigError</span></a></span><span> </span><span class="annot"><span class="annottext">NotInScopeError
</span><a href="#local-6989586621683035484"><span class="hs-identifier hs-var">e</span></a></span><span>
</span><span id="line-504"></span><span>    </span><span class="annot"><a href="#local-6989586621683035472"><span class="hs-identifier hs-var">cvtEither</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Right</span></span><span> </span><span id="local-6989586621683035485"><span class="annot"><span class="annottext">GlobalRdrElt
</span><a href="#local-6989586621683035485"><span class="hs-identifier hs-var">gre</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">GlobalRdrElt -&gt; ExactOrOrigResult
</span><a href="GHC.Rename.Env.html#FoundExactOrOrig"><span class="hs-identifier hs-var">FoundExactOrOrig</span></a></span><span> </span><span class="annot"><span class="annottext">GlobalRdrElt
</span><a href="#local-6989586621683035485"><span class="hs-identifier hs-var">gre</span></a></span><span>
</span><span id="line-505"></span><span>
</span><span id="line-506"></span><span class="hs-comment">{- Note [Errors in lookup functions]
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
Many of these lookup functions will attach an error if it can't find the Name it
is trying to lookup. However there are also _maybe and _either variants for many
of these functions.

These variants should *not* attach any errors, as there are
places where we want to attempt looking up a name, but it's not the end of the
world if we don't find it.

For example, see lookupThName_maybe: It calls lookupOccRn_maybe multiple
times for varying names in different namespaces. lookupOccRn_maybe should
therefore never attach an error, instead just return a Nothing.

For these _maybe/_either variant functions then, avoid calling further lookup
functions that can attach errors and instead call their _maybe/_either
counterparts.
-}</span><span>
</span><span id="line-524"></span><span>
</span><span id="line-525"></span><span class="hs-comment">-----------------------------------------------</span><span>
</span><span id="line-526"></span><span class="hs-comment">-- | Look up an occurrence of a field in record construction or pattern</span><span>
</span><span id="line-527"></span><span class="hs-comment">-- matching (but not update).</span><span>
</span><span id="line-528"></span><span class="hs-comment">--</span><span>
</span><span id="line-529"></span><span class="hs-comment">-- If -XDisambiguateRecordFields is off, then we will pass 'Nothing' for the</span><span>
</span><span id="line-530"></span><span class="hs-comment">-- 'DataCon' 'Name', i.e. we don't use the data constructor for disambiguation.</span><span>
</span><span id="line-531"></span><span class="hs-comment">-- See Note [DisambiguateRecordFields] and Note [NoFieldSelectors].</span><span>
</span><span id="line-532"></span><span class="annot"><a href="GHC.Rename.Env.html#lookupRecFieldOcc"><span class="hs-identifier hs-type">lookupRecFieldOcc</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Maybe</span></span><span> </span><span class="annot"><a href="GHC.Types.Name.html#Name"><span class="hs-identifier hs-type">Name</span></a></span><span> </span><span class="hs-comment">-- Nothing  =&gt; just look it up as usual</span><span>
</span><span id="line-533"></span><span>                                </span><span class="hs-comment">-- Just con =&gt; use data con to disambiguate</span><span>
</span><span id="line-534"></span><span>                  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Types.Name.Reader.html#RdrName"><span class="hs-identifier hs-type">RdrName</span></a></span><span>
</span><span id="line-535"></span><span>                  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#RnM"><span class="hs-identifier hs-type">RnM</span></a></span><span> </span><span class="annot"><a href="GHC.Types.Name.html#Name"><span class="hs-identifier hs-type">Name</span></a></span><span>
</span><span id="line-536"></span><span id="lookupRecFieldOcc"><span class="annot"><span class="annottext">lookupRecFieldOcc :: Maybe Name -&gt; RdrName -&gt; RnM Name
</span><a href="GHC.Rename.Env.html#lookupRecFieldOcc"><span class="hs-identifier hs-var hs-var">lookupRecFieldOcc</span></a></span></span><span> </span><span id="local-6989586621683035486"><span class="annot"><span class="annottext">Maybe Name
</span><a href="#local-6989586621683035486"><span class="hs-identifier hs-var">mb_con</span></a></span></span><span> </span><span id="local-6989586621683035487"><span class="annot"><span class="annottext">RdrName
</span><a href="#local-6989586621683035487"><span class="hs-identifier hs-var">rdr_name</span></a></span></span><span>
</span><span id="line-537"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span id="local-6989586621683035488"><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621683035488"><span class="hs-identifier hs-var">con</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Maybe Name
</span><a href="#local-6989586621683035486"><span class="hs-identifier hs-var">mb_con</span></a></span><span>
</span><span id="line-538"></span><span>  </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Name -&gt; Bool
</span><a href="GHC.Builtin.Names.html#isUnboundName"><span class="hs-identifier hs-var">isUnboundName</span></a></span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621683035488"><span class="hs-identifier hs-var">con</span></a></span><span>  </span><span class="hs-comment">-- Avoid error cascade</span><span>
</span><span id="line-539"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Name -&gt; RnM Name
forall a. a -&gt; IOEnv (Env TcGblEnv TcLclEnv) a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="annot"><span class="annottext">(Name -&gt; RnM Name) -&gt; Name -&gt; RnM Name
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Name -&gt; Name
</span><a href="#local-6989586621683035490"><span class="hs-identifier hs-var">mk_unbound_rec_fld</span></a></span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621683035488"><span class="hs-identifier hs-var">con</span></a></span><span>
</span><span id="line-540"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span id="local-6989586621683035491"><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621683035491"><span class="hs-identifier hs-var">con</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Maybe Name
</span><a href="#local-6989586621683035486"><span class="hs-identifier hs-var">mb_con</span></a></span><span>
</span><span id="line-541"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621683035492"><span class="annot"><span class="annottext">lbl :: FieldLabelString
</span><a href="#local-6989586621683035492"><span class="hs-identifier hs-var hs-var hs-var">lbl</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">FastString -&gt; FieldLabelString
</span><a href="Language.Haskell.Syntax.Basic.html#FieldLabelString"><span class="hs-identifier hs-var">FieldLabelString</span></a></span><span> </span><span class="annot"><span class="annottext">(FastString -&gt; FieldLabelString) -&gt; FastString -&gt; FieldLabelString
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">OccName -&gt; FastString
</span><a href="GHC.Types.Name.Occurrence.html#occNameFS"><span class="hs-identifier hs-var">occNameFS</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">RdrName -&gt; OccName
</span><a href="GHC.Types.Name.Reader.html#rdrNameOcc"><span class="hs-identifier hs-var">rdrNameOcc</span></a></span><span> </span><span class="annot"><span class="annottext">RdrName
</span><a href="#local-6989586621683035487"><span class="hs-identifier hs-var">rdr_name</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-542"></span><span>       </span><span class="hs-special">;</span><span> </span><span id="local-6989586621683035495"><span class="annot"><a href="#local-6989586621683035495"><span class="hs-identifier hs-var">mb_nm</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">RdrName
-&gt; (GlobalRdrElt -&gt; Maybe Name)
-&gt; RnM (Maybe Name)
-&gt; RnM (Maybe Name)
forall r. RdrName -&gt; (GlobalRdrElt -&gt; r) -&gt; RnM r -&gt; RnM r
</span><a href="GHC.Rename.Env.html#lookupExactOrOrig"><span class="hs-identifier hs-var">lookupExactOrOrig</span></a></span><span> </span><span class="annot"><span class="annottext">RdrName
</span><a href="#local-6989586621683035487"><span class="hs-identifier hs-var">rdr_name</span></a></span><span> </span><span class="annot"><span class="annottext">GlobalRdrElt -&gt; Maybe Name
</span><a href="#local-6989586621683035496"><span class="hs-identifier hs-var">ensure_recfld</span></a></span><span> </span><span class="annot"><span class="annottext">(RnM (Maybe Name) -&gt; RnM (Maybe Name))
-&gt; RnM (Maybe Name) -&gt; RnM (Maybe Name)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>  </span><span class="hs-comment">-- See Note [Record field names and Template Haskell]</span><span>
</span><span id="line-543"></span><span>            </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span id="local-6989586621683035497"><span class="annot"><a href="#local-6989586621683035497"><span class="hs-identifier hs-var">flds</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">HasDebugCallStack =&gt; Name -&gt; RnM [FieldLabel]
Name -&gt; RnM [FieldLabel]
</span><a href="GHC.Rename.Env.html#lookupConstructorFields"><span class="hs-identifier hs-var">lookupConstructorFields</span></a></span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621683035491"><span class="hs-identifier hs-var">con</span></a></span><span>
</span><span id="line-544"></span><span>               </span><span class="hs-special">;</span><span> </span><span id="local-6989586621683035498"><span class="annot"><a href="#local-6989586621683035498"><span class="hs-identifier hs-var">env</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.Monad.html#getGlobalRdrEnv"><span class="hs-identifier hs-type">getGlobalRdrEnv</span></a></span><span>
</span><span id="line-545"></span><span>               </span><span class="hs-special">;</span><span> </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621683035499"><span class="annot"><a href="#local-6989586621683035499"><span class="hs-identifier hs-var hs-var">mb_gre</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span id="local-6989586621683035500"><span class="annot"><a href="#local-6989586621683035500"><span class="hs-identifier hs-var">fl</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">(FieldLabel -&gt; Bool) -&gt; [FieldLabel] -&gt; Maybe FieldLabel
forall (t :: * -&gt; *) a. Foldable t =&gt; (a -&gt; Bool) -&gt; t a -&gt; Maybe a
</span><span class="hs-identifier hs-var">find</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">(</span><span class="annot"><span class="annottext">FieldLabelString -&gt; FieldLabelString -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">==</span></span><span> </span><span class="annot"><span class="annottext">FieldLabelString
</span><a href="#local-6989586621683035492"><span class="hs-identifier hs-var">lbl</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(FieldLabelString -&gt; Bool)
-&gt; (FieldLabel -&gt; FieldLabelString) -&gt; FieldLabel -&gt; Bool
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">FieldLabel -&gt; FieldLabelString
</span><a href="GHC.Types.FieldLabel.html#flLabel"><span class="hs-identifier hs-var">flLabel</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[FieldLabel]
</span><a href="#local-6989586621683035497"><span class="hs-identifier hs-var">flds</span></a></span><span>
</span><span id="line-546"></span><span>                                 </span><span class="hs-comment">-- We have the label, now check it is in scope.  If</span><span>
</span><span id="line-547"></span><span>                                 </span><span class="hs-comment">-- there is a qualifier, use pickGREs to check that</span><span>
</span><span id="line-548"></span><span>                                 </span><span class="hs-comment">-- the qualifier is correct, and return the filtered</span><span>
</span><span id="line-549"></span><span>                                 </span><span class="hs-comment">-- GRE so we get import usage right (see #17853).</span><span>
</span><span id="line-550"></span><span>                                 </span><span id="local-6989586621683035502"><span class="annot"><a href="#local-6989586621683035502"><span class="hs-identifier hs-var">gre</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><a href="GHC.Types.Name.Reader.html#lookupGRE_FieldLabel"><span class="hs-identifier hs-type">lookupGRE_FieldLabel</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683035498"><span class="hs-identifier hs-type">env</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683035500"><span class="hs-identifier hs-type">fl</span></a></span><span>
</span><span id="line-551"></span><span>                                 </span><span class="hs-keyword">if</span><span> </span><span class="annot"><a href="GHC.Types.Name.Reader.html#isQual"><span class="hs-identifier hs-type">isQual</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683035487"><span class="hs-identifier hs-type">rdr_name</span></a></span><span>
</span><span id="line-552"></span><span>                                 </span><span class="hs-keyword">then</span><span> </span><span class="annot"><span class="hs-identifier hs-type">listToMaybe</span></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="annot"><a href="GHC.Types.Name.Reader.html#pickGREs"><span class="hs-identifier hs-type">pickGREs</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683035487"><span class="hs-identifier hs-type">rdr_name</span></a></span><span> </span><span class="hs-special">[</span><span class="annot"><a href="#local-6989586621683035502"><span class="hs-identifier hs-type">gre</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-553"></span><span>                                 </span><span class="hs-keyword">else</span><span> </span><span class="annot"><span class="hs-identifier hs-type">return</span></span><span> </span><span class="annot"><a href="#local-6989586621683035502"><span class="hs-identifier hs-type">gre</span></a></span><span>
</span><span id="line-554"></span><span>               </span><span class="hs-special">;</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.Monad.html#traceRn"><span class="hs-identifier hs-type">traceRn</span></a></span><span> </span><span class="annot"><span class="hs-string">&quot;lookupRecFieldOcc&quot;</span></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span>
</span><span id="line-555"></span><span>                   </span><span class="annot"><a href="GHC.Utils.Outputable.html#vcat"><span class="hs-identifier hs-type">vcat</span></a></span><span> </span><span class="hs-special">[</span><span> </span><span class="annot"><a href="GHC.Utils.Outputable.html#text"><span class="hs-identifier hs-type">text</span></a></span><span> </span><span class="annot"><span class="hs-string">&quot;mb_con:&quot;</span></span><span> </span><span class="annot"><a href="GHC.Utils.Outputable.html#%3C%2B%3E"><span class="hs-operator hs-type">&lt;+&gt;</span></a></span><span> </span><span class="annot"><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-type">ppr</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683035486"><span class="hs-identifier hs-type">mb_con</span></a></span><span>
</span><span id="line-556"></span><span>                        </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Utils.Outputable.html#text"><span class="hs-identifier hs-type">text</span></a></span><span> </span><span class="annot"><span class="hs-string">&quot;rdr_name:&quot;</span></span><span> </span><span class="annot"><a href="GHC.Utils.Outputable.html#%3C%2B%3E"><span class="hs-operator hs-type">&lt;+&gt;</span></a></span><span> </span><span class="annot"><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-type">ppr</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683035487"><span class="hs-identifier hs-type">rdr_name</span></a></span><span>
</span><span id="line-557"></span><span>                        </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Utils.Outputable.html#text"><span class="hs-identifier hs-type">text</span></a></span><span> </span><span class="annot"><span class="hs-string">&quot;flds:&quot;</span></span><span> </span><span class="annot"><a href="GHC.Utils.Outputable.html#%3C%2B%3E"><span class="hs-operator hs-type">&lt;+&gt;</span></a></span><span> </span><span class="annot"><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-type">ppr</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683035497"><span class="hs-identifier hs-type">flds</span></a></span><span>
</span><span id="line-558"></span><span>                        </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Utils.Outputable.html#text"><span class="hs-identifier hs-type">text</span></a></span><span> </span><span class="annot"><span class="hs-string">&quot;mb_gre:&quot;</span></span><span> </span><span class="annot"><a href="GHC.Utils.Outputable.html#%3C%2B%3E"><span class="hs-operator hs-type">&lt;+&gt;</span></a></span><span> </span><span class="annot"><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-type">ppr</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683035499"><span class="hs-identifier hs-type">mb_gre</span></a></span><span> </span><span class="hs-special">]</span><span>
</span><span id="line-559"></span><span>               </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">mapM_</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Rename.Env.html#addUsedGRE"><span class="hs-identifier hs-type">addUsedGRE</span></a></span><span> </span><span class="annot"><a href="GHC.Rename.Utils.html#AllDeprecationWarnings"><span class="hs-identifier hs-type">AllDeprecationWarnings</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><a href="#local-6989586621683035499"><span class="hs-identifier hs-type">mb_gre</span></a></span><span>
</span><span id="line-560"></span><span>               </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">return</span></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="annot"><a href="GHC.Types.FieldLabel.html#flSelector"><span class="hs-identifier hs-var">flSelector</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">.</span></span><span> </span><span class="annot"><a href="GHC.Types.Name.Reader.html#fieldGRELabel"><span class="hs-identifier hs-type">fieldGRELabel</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">&lt;$&gt;</span></span><span> </span><span class="annot"><a href="#local-6989586621683035499"><span class="hs-identifier hs-type">mb_gre</span></a></span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-561"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><a href="#local-6989586621683035495"><span class="hs-identifier hs-type">mb_nm</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-562"></span><span>          </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">Maybe Name
</span><span class="hs-identifier hs-var">Nothing</span></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">TcRnMessage -&gt; IOEnv (Env TcGblEnv TcLclEnv) ()
</span><a href="GHC.Tc.Utils.Monad.html#addErr"><span class="hs-identifier hs-var">addErr</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Name -&gt; FieldLabelString -&gt; TcRnMessage
</span><a href="GHC.Rename.Utils.html#badFieldConErr"><span class="hs-identifier hs-var">badFieldConErr</span></a></span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621683035491"><span class="hs-identifier hs-var">con</span></a></span><span> </span><span class="annot"><span class="annottext">FieldLabelString
</span><a href="#local-6989586621683035492"><span class="hs-identifier hs-var">lbl</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-563"></span><span>                           </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="annottext">Name -&gt; RnM Name
forall a. a -&gt; IOEnv (Env TcGblEnv TcLclEnv) a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="annot"><span class="annottext">(Name -&gt; RnM Name) -&gt; Name -&gt; RnM Name
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Name -&gt; Name
</span><a href="#local-6989586621683035490"><span class="hs-identifier hs-var">mk_unbound_rec_fld</span></a></span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621683035491"><span class="hs-identifier hs-var">con</span></a></span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-564"></span><span>          </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span id="local-6989586621683035511"><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621683035511"><span class="hs-identifier hs-var">nm</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Name -&gt; RnM Name
forall a. a -&gt; IOEnv (Env TcGblEnv TcLclEnv) a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621683035511"><span class="hs-identifier hs-var">nm</span></a></span><span> </span><span class="hs-special">}</span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-565"></span><span>
</span><span id="line-566"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">otherwise</span></span><span>  </span><span class="hs-comment">-- Can't use the data constructor to disambiguate</span><span>
</span><span id="line-567"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">WhichGREs GREInfo -&gt; RdrName -&gt; RnM Name
</span><a href="GHC.Rename.Env.html#lookupGlobalOccRn%27"><span class="hs-identifier hs-var">lookupGlobalOccRn'</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">FieldsOrSelectors -&gt; WhichGREs GREInfo
</span><a href="GHC.Types.Name.Reader.html#RelevantGREsFOS"><span class="hs-identifier hs-var">RelevantGREsFOS</span></a></span><span> </span><span class="annot"><span class="annottext">FieldsOrSelectors
</span><a href="GHC.Types.Name.Reader.html#WantField"><span class="hs-identifier hs-var">WantField</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">RdrName
</span><a href="#local-6989586621683035487"><span class="hs-identifier hs-var">rdr_name</span></a></span><span>
</span><span id="line-568"></span><span>    </span><span class="hs-comment">-- This use of Global is right as we are looking up a selector,</span><span>
</span><span id="line-569"></span><span>    </span><span class="hs-comment">-- which can only be defined at the top level.</span><span>
</span><span id="line-570"></span><span>
</span><span id="line-571"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-572"></span><span>    </span><span class="hs-comment">-- When lookup fails, make an unbound name with the right record field</span><span>
</span><span id="line-573"></span><span>    </span><span class="hs-comment">-- namespace, as that's what we expect to be returned</span><span>
</span><span id="line-574"></span><span>    </span><span class="hs-comment">-- from 'lookupRecFieldOcc'. See T14307.</span><span>
</span><span id="line-575"></span><span>    </span><span id="local-6989586621683035490"><span class="annot"><span class="annottext">mk_unbound_rec_fld :: Name -&gt; Name
</span><a href="#local-6989586621683035490"><span class="hs-identifier hs-var hs-var">mk_unbound_rec_fld</span></a></span></span><span> </span><span id="local-6989586621683035514"><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621683035514"><span class="hs-identifier hs-var">con</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">OccName -&gt; Name
</span><a href="GHC.Builtin.Names.html#mkUnboundName"><span class="hs-identifier hs-var">mkUnboundName</span></a></span><span> </span><span class="annot"><span class="annottext">(OccName -&gt; Name) -&gt; OccName -&gt; Name
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-576"></span><span>      </span><span class="annot"><span class="annottext">FastString -&gt; FastString -&gt; OccName
</span><a href="GHC.Types.Name.Occurrence.html#mkRecFieldOccFS"><span class="hs-identifier hs-var">mkRecFieldOccFS</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Name -&gt; FastString
forall a. NamedThing a =&gt; a -&gt; FastString
</span><a href="GHC.Types.Name.html#getOccFS"><span class="hs-identifier hs-var">getOccFS</span></a></span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621683035514"><span class="hs-identifier hs-var">con</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">OccName -&gt; FastString
</span><a href="GHC.Types.Name.Occurrence.html#occNameFS"><span class="hs-identifier hs-var">occNameFS</span></a></span><span> </span><span class="annot"><span class="annottext">OccName
</span><a href="#local-6989586621683035518"><span class="hs-identifier hs-var">occ</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-577"></span><span>    </span><span id="local-6989586621683035518"><span class="annot"><span class="annottext">occ :: OccName
</span><a href="#local-6989586621683035518"><span class="hs-identifier hs-var hs-var">occ</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">RdrName -&gt; OccName
</span><a href="GHC.Types.Name.Reader.html#rdrNameOcc"><span class="hs-identifier hs-var">rdrNameOcc</span></a></span><span> </span><span class="annot"><span class="annottext">RdrName
</span><a href="#local-6989586621683035487"><span class="hs-identifier hs-var">rdr_name</span></a></span><span>
</span><span id="line-578"></span><span>
</span><span id="line-579"></span><span>    </span><span class="annot"><a href="#local-6989586621683035496"><span class="hs-identifier hs-type">ensure_recfld</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Types.Name.Reader.html#GlobalRdrElt"><span class="hs-identifier hs-type">GlobalRdrElt</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Maybe</span></span><span> </span><span class="annot"><a href="GHC.Types.Name.html#Name"><span class="hs-identifier hs-type">Name</span></a></span><span>
</span><span id="line-580"></span><span>    </span><span id="local-6989586621683035496"><span class="annot"><span class="annottext">ensure_recfld :: GlobalRdrElt -&gt; Maybe Name
</span><a href="#local-6989586621683035496"><span class="hs-identifier hs-var hs-var">ensure_recfld</span></a></span></span><span> </span><span id="local-6989586621683035519"><span class="annot"><span class="annottext">GlobalRdrElt
</span><a href="#local-6989586621683035519"><span class="hs-identifier hs-var">gre</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Maybe ()
forall (f :: * -&gt; *). Alternative f =&gt; Bool -&gt; f ()
</span><span class="hs-identifier hs-var">guard</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">GlobalRdrElt -&gt; Bool
forall info. GlobalRdrEltX info -&gt; Bool
</span><a href="GHC.Types.Name.Reader.html#isRecFldGRE"><span class="hs-identifier hs-var">isRecFldGRE</span></a></span><span> </span><span class="annot"><span class="annottext">GlobalRdrElt
</span><a href="#local-6989586621683035519"><span class="hs-identifier hs-var">gre</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-581"></span><span>                           </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="annottext">Name -&gt; Maybe Name
forall a. a -&gt; Maybe a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="annot"><span class="annottext">(Name -&gt; Maybe Name) -&gt; Name -&gt; Maybe Name
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">GlobalRdrElt -&gt; Name
forall info. GlobalRdrEltX info -&gt; Name
</span><a href="GHC.Types.Name.Reader.html#greName"><span class="hs-identifier hs-var">greName</span></a></span><span> </span><span class="annot"><span class="annottext">GlobalRdrElt
</span><a href="#local-6989586621683035519"><span class="hs-identifier hs-var">gre</span></a></span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-582"></span><span>
</span><span id="line-583"></span><span class="hs-comment">{- Note [DisambiguateRecordFields]
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
When we are looking up record fields in record construction or pattern
matching, we can take advantage of the data constructor name to
resolve fields that would otherwise be ambiguous (provided the
-XDisambiguateRecordFields flag is on).

For example, consider:

   data S = MkS { x :: Int }
   data T = MkT { x :: Int }

   e = MkS { x = 3 }

When we are renaming the occurrence of `x` in `e`, instead of looking
`x` up directly (and finding both fields), lookupRecFieldOcc will
search the fields of `MkS` to find the only possible `x` the user can
mean.

Of course, we still have to check the field is in scope, using
lookupGRE_FieldLabel.  The handling of qualified imports is slightly
subtle: the occurrence may be unqualified even if the field is
imported only qualified (but if the occurrence is qualified, the
qualifier must be correct). For example:

   module A where
     data S = MkS { x :: Int }
     data T = MkT { x :: Int }

   module B where
     import qualified A (S(..))
     import A (T(MkT))

     e1 = MkT   { x = 3 }   -- x not in scope, so fail
     e2 = A.MkS { B.x = 3 } -- module qualifier is wrong, so fail
     e3 = A.MkS { x = 3 }   -- x in scope (lack of module qualifier permitted)

In case `e1`, lookupGRE_FieldLabel will return Nothing.  In case `e2`,
lookupGRE_FieldLabel will return the GRE for `A.x`, but then the guard
will fail because the field RdrName `B.x` is qualified and pickGREs
rejects the GRE.  In case `e3`, lookupGRE_FieldLabel will return the
GRE for `A.x` and the guard will succeed because the field RdrName `x`
is unqualified.


Note [DisambiguateRecordFields for updates]
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
When we are looking up record fields in record update, we can take advantage of
the fact that we know we are looking for a field, even though we do not know the
data constructor name (as in Note [DisambiguateRecordFields]), provided the
-XDisambiguateRecordFields flag is on.

For example, consider:

  module N where
    f = ()

  {-# LANGUAGE DisambiguateRecordFields #-}
  module M where
    import N (f)
    data T = MkT { f :: Int }
    t = MkT { f = 1 }  -- unambiguous because MkT determines which field we mean
    u = t { f = 2 }    -- unambiguous because we ignore the non-field 'f'

We filter out non-fields in lookupFieldGREs by using isRecFldGRE, which allows
us to accept the above program.
Of course, if a record update has two fields in scope with the same name,
it is still ambiguous.

We also look up the non-fields with the same textual name

  1. to throw an error if the user hasn't enabled DisambiguateRecordFields,
  2. in order to improve the error message when a user mistakenly tries to use
     a non-field in a record update:

        f = ()
        e x = x { f = () }

Unlike with constructors or pattern-matching, we do not allow the module
qualifier to be omitted from the field names, because we do not have a
data constructor to use to determine the appropriate qualifier.

This is all done in the function lookupFieldGREs, which is called by
GHC.Rename.Pat.rnHsRecUpdFields, which deals with record updates.

Note [Record field names and Template Haskell]
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
Consider (#12130):

   module Foo where
     import M
     b = $(funny)

   module M(funny) where
     data T = MkT { x :: Int }
     funny :: Q Exp
     funny = [| MkT { x = 3 } |]

When we splice, `MkT` is not lexically in scope, so
lookupGRE_FieldLabel will fail.  But there is no need for
disambiguation anyway, because `x` is an original name, and
lookupGlobalOccRn will find it.
-}</span><span>
</span><span id="line-686"></span><span>
</span><span id="line-687"></span><span class="annot"><span class="hs-comment">-- | Used in export lists to lookup the children.</span></span><span>
</span><span id="line-688"></span><span class="annot"><a href="GHC.Rename.Env.html#lookupSubBndrOcc_helper"><span class="hs-identifier hs-type">lookupSubBndrOcc_helper</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Bool</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Rename.Utils.html#DeprecationWarnings"><span class="hs-identifier hs-type">DeprecationWarnings</span></a></span><span>
</span><span id="line-689"></span><span>                        </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Types.Name.html#Name"><span class="hs-identifier hs-type">Name</span></a></span><span>
</span><span id="line-690"></span><span>                        </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Types.Name.Reader.html#RdrName"><span class="hs-identifier hs-type">RdrName</span></a></span><span> </span><span class="annot"><span class="hs-comment">-- ^ thing we are looking up</span></span><span>
</span><span id="line-691"></span><span>                        </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Types.Name.Reader.html#LookupChild"><span class="hs-identifier hs-type">LookupChild</span></a></span><span> </span><span class="hs-comment">-- ^ how to look it up (e.g. which</span><span>
</span><span id="line-692"></span><span>                                       </span><span class="hs-comment">-- 'NameSpace's to look in)</span><span>
</span><span id="line-693"></span><span>                        </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#RnM"><span class="hs-identifier hs-type">RnM</span></a></span><span> </span><span class="annot"><a href="GHC.Rename.Env.html#ChildLookupResult"><span class="hs-identifier hs-type">ChildLookupResult</span></a></span><span>
</span><span id="line-694"></span><span id="lookupSubBndrOcc_helper"><span class="annot"><span class="annottext">lookupSubBndrOcc_helper :: Bool
-&gt; DeprecationWarnings
-&gt; Name
-&gt; RdrName
-&gt; LookupChild
-&gt; RnM ChildLookupResult
</span><a href="GHC.Rename.Env.html#lookupSubBndrOcc_helper"><span class="hs-identifier hs-var hs-var">lookupSubBndrOcc_helper</span></a></span></span><span> </span><span id="local-6989586621683035521"><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621683035521"><span class="hs-identifier hs-var">must_have_parent</span></a></span></span><span> </span><span id="local-6989586621683035522"><span class="annot"><span class="annottext">DeprecationWarnings
</span><a href="#local-6989586621683035522"><span class="hs-identifier hs-var">warn_if_deprec</span></a></span></span><span> </span><span id="local-6989586621683035523"><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621683035523"><span class="hs-identifier hs-var">parent</span></a></span></span><span> </span><span id="local-6989586621683035524"><span class="annot"><span class="annottext">RdrName
</span><a href="#local-6989586621683035524"><span class="hs-identifier hs-var">rdr_name</span></a></span></span><span> </span><span id="local-6989586621683035525"><span class="annot"><span class="annottext">LookupChild
</span><a href="#local-6989586621683035525"><span class="hs-identifier hs-var">how_lkup</span></a></span></span><span>
</span><span id="line-695"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Name -&gt; Bool
</span><a href="GHC.Builtin.Names.html#isUnboundName"><span class="hs-identifier hs-var">isUnboundName</span></a></span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621683035523"><span class="hs-identifier hs-var">parent</span></a></span><span>
</span><span id="line-696"></span><span>    </span><span class="hs-comment">-- Avoid an error cascade</span><span>
</span><span id="line-697"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ChildLookupResult -&gt; RnM ChildLookupResult
forall a. a -&gt; IOEnv (Env TcGblEnv TcLclEnv) a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">GlobalRdrElt -&gt; ChildLookupResult
</span><a href="GHC.Rename.Env.html#FoundChild"><span class="hs-identifier hs-var">FoundChild</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">RdrName -&gt; GlobalRdrElt
</span><a href="GHC.Rename.Unbound.html#mkUnboundGRERdr"><span class="hs-identifier hs-var">mkUnboundGRERdr</span></a></span><span> </span><span class="annot"><span class="annottext">RdrName
</span><a href="#local-6989586621683035524"><span class="hs-identifier hs-var">rdr_name</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-698"></span><span>
</span><span id="line-699"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">otherwise</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-700"></span><span>  </span><span id="local-6989586621683035527"><span class="annot"><a href="#local-6989586621683035527"><span class="hs-identifier hs-var">gre_env</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">TcRn GlobalRdrEnv
</span><a href="GHC.Tc.Utils.Monad.html#getGlobalRdrEnv"><span class="hs-identifier hs-var">getGlobalRdrEnv</span></a></span><span>
</span><span id="line-701"></span><span>  </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621683035528"><span class="annot"><a href="#local-6989586621683035528"><span class="hs-identifier hs-var hs-var">original_gres</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">GlobalRdrEnv -&gt; LookupGRE GREInfo -&gt; [GlobalRdrElt]
forall info.
GlobalRdrEnvX info -&gt; LookupGRE info -&gt; [GlobalRdrEltX info]
</span><a href="GHC.Types.Name.Reader.html#lookupGRE"><span class="hs-identifier hs-var">lookupGRE</span></a></span><span> </span><span class="annot"><span class="annottext">GlobalRdrEnv
</span><a href="#local-6989586621683035527"><span class="hs-identifier hs-var">gre_env</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">OccName -&gt; LookupChild -&gt; LookupGRE GREInfo
forall info. OccName -&gt; LookupChild -&gt; LookupGRE info
</span><a href="GHC.Types.Name.Reader.html#LookupChildren"><span class="hs-identifier hs-var">LookupChildren</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">RdrName -&gt; OccName
</span><a href="GHC.Types.Name.Reader.html#rdrNameOcc"><span class="hs-identifier hs-var">rdrNameOcc</span></a></span><span> </span><span class="annot"><span class="annottext">RdrName
</span><a href="#local-6989586621683035524"><span class="hs-identifier hs-var">rdr_name</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">LookupChild
</span><a href="#local-6989586621683035525"><span class="hs-identifier hs-var">how_lkup</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-702"></span><span>      </span><span id="local-6989586621683035530"><span class="annot"><a href="#local-6989586621683035530"><span class="hs-identifier hs-var hs-var">picked_gres</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[GlobalRdrElt] -&gt; DisambigInfo
</span><a href="#local-6989586621683035531"><span class="hs-identifier hs-var">pick_gres</span></a></span><span> </span><span class="annot"><span class="annottext">[GlobalRdrElt]
</span><a href="#local-6989586621683035528"><span class="hs-identifier hs-var">original_gres</span></a></span><span>
</span><span id="line-703"></span><span>  </span><span class="hs-comment">-- The remaining GREs are things that we *could* export here.</span><span>
</span><span id="line-704"></span><span>  </span><span class="hs-comment">-- Note that this includes things which have `NoParent`;</span><span>
</span><span id="line-705"></span><span>  </span><span class="hs-comment">-- those are sorted in `checkPatSynParent`.</span><span>
</span><span id="line-706"></span><span>  </span><span class="annot"><a href="GHC.Tc.Utils.Monad.html#traceRn"><span class="hs-identifier hs-type">traceRn</span></a></span><span> </span><span class="annot"><span class="hs-string">&quot;parent&quot;</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-type">ppr</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683035523"><span class="hs-identifier hs-type">parent</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-707"></span><span>  </span><span class="annot"><a href="GHC.Tc.Utils.Monad.html#traceRn"><span class="hs-identifier hs-type">traceRn</span></a></span><span> </span><span class="annot"><span class="hs-string">&quot;lookupExportChild original_gres:&quot;</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-type">ppr</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683035528"><span class="hs-identifier hs-type">original_gres</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-708"></span><span>  </span><span class="annot"><a href="GHC.Tc.Utils.Monad.html#traceRn"><span class="hs-identifier hs-type">traceRn</span></a></span><span> </span><span class="annot"><span class="hs-string">&quot;lookupExportChild picked_gres:&quot;</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-type">ppr</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683035530"><span class="hs-identifier hs-type">picked_gres</span></a></span><span> </span><span class="annot"><a href="GHC.Utils.Outputable.html#%24%24"><span class="hs-operator hs-type">$$</span></a></span><span> </span><span class="annot"><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-type">ppr</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683035521"><span class="hs-identifier hs-type">must_have_parent</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-709"></span><span>  </span><span class="hs-keyword">case</span><span> </span><span class="annot"><a href="#local-6989586621683035530"><span class="hs-identifier hs-type">picked_gres</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-710"></span><span>    </span><span class="annot"><span class="annottext">DisambigInfo
</span><a href="GHC.Rename.Env.html#NoOccurrence"><span class="hs-identifier hs-var">NoOccurrence</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-711"></span><span>      </span><span class="annot"><span class="annottext">[GlobalRdrElt] -&gt; RnM ChildLookupResult
</span><a href="#local-6989586621683035533"><span class="hs-identifier hs-var">noMatchingParentErr</span></a></span><span> </span><span class="annot"><span class="annottext">[GlobalRdrElt]
</span><a href="#local-6989586621683035528"><span class="hs-identifier hs-var">original_gres</span></a></span><span>
</span><span id="line-712"></span><span>    </span><span class="annot"><a href="GHC.Rename.Env.html#UniqueOccurrence"><span class="hs-identifier hs-type">UniqueOccurrence</span></a></span><span> </span><span id="local-6989586621683035535"><span class="annot"><span class="annottext">GlobalRdrElt
</span><a href="#local-6989586621683035535"><span class="hs-identifier hs-var">g</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-713"></span><span>      </span><span class="hs-keyword">if</span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621683035521"><span class="hs-identifier hs-var">must_have_parent</span></a></span><span>
</span><span id="line-714"></span><span>      </span><span class="hs-keyword">then</span><span> </span><span class="annot"><span class="annottext">[GlobalRdrElt] -&gt; RnM ChildLookupResult
</span><a href="#local-6989586621683035533"><span class="hs-identifier hs-var">noMatchingParentErr</span></a></span><span> </span><span class="annot"><span class="annottext">[GlobalRdrElt]
</span><a href="#local-6989586621683035528"><span class="hs-identifier hs-var">original_gres</span></a></span><span>
</span><span id="line-715"></span><span>      </span><span class="hs-keyword">else</span><span> </span><span class="annot"><span class="annottext">GlobalRdrElt -&gt; RnM ChildLookupResult
</span><a href="#local-6989586621683035536"><span class="hs-identifier hs-var">checkFld</span></a></span><span> </span><span class="annot"><span class="annottext">GlobalRdrElt
</span><a href="#local-6989586621683035535"><span class="hs-identifier hs-var">g</span></a></span><span>
</span><span id="line-716"></span><span>    </span><span class="annot"><a href="GHC.Rename.Env.html#DisambiguatedOccurrence"><span class="hs-identifier hs-type">DisambiguatedOccurrence</span></a></span><span> </span><span id="local-6989586621683035538"><span class="annot"><span class="annottext">GlobalRdrElt
</span><a href="#local-6989586621683035538"><span class="hs-identifier hs-var">g</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-717"></span><span>      </span><span class="annot"><span class="annottext">GlobalRdrElt -&gt; RnM ChildLookupResult
</span><a href="#local-6989586621683035536"><span class="hs-identifier hs-var">checkFld</span></a></span><span> </span><span class="annot"><span class="annottext">GlobalRdrElt
</span><a href="#local-6989586621683035538"><span class="hs-identifier hs-var">g</span></a></span><span>
</span><span id="line-718"></span><span>    </span><span class="annot"><a href="GHC.Rename.Env.html#AmbiguousOccurrence"><span class="hs-identifier hs-type">AmbiguousOccurrence</span></a></span><span> </span><span id="local-6989586621683035540"><span class="annot"><span class="annottext">NonEmpty GlobalRdrElt
</span><a href="#local-6989586621683035540"><span class="hs-identifier hs-var">gres</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-719"></span><span>      </span><span class="annot"><span class="annottext">NonEmpty GlobalRdrElt -&gt; RnM ChildLookupResult
</span><a href="#local-6989586621683035541"><span class="hs-identifier hs-var">mkNameClashErr</span></a></span><span> </span><span class="annot"><span class="annottext">NonEmpty GlobalRdrElt
</span><a href="#local-6989586621683035540"><span class="hs-identifier hs-var">gres</span></a></span><span>
</span><span id="line-720"></span><span>    </span><span class="hs-keyword">where</span><span>
</span><span id="line-721"></span><span>        </span><span class="annot"><a href="#local-6989586621683035536"><span class="hs-identifier hs-type">checkFld</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Types.Name.Reader.html#GlobalRdrElt"><span class="hs-identifier hs-type">GlobalRdrElt</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#RnM"><span class="hs-identifier hs-type">RnM</span></a></span><span> </span><span class="annot"><a href="GHC.Rename.Env.html#ChildLookupResult"><span class="hs-identifier hs-type">ChildLookupResult</span></a></span><span>
</span><span id="line-722"></span><span>        </span><span id="local-6989586621683035536"><span class="annot"><span class="annottext">checkFld :: GlobalRdrElt -&gt; RnM ChildLookupResult
</span><a href="#local-6989586621683035536"><span class="hs-identifier hs-var hs-var">checkFld</span></a></span></span><span> </span><span id="local-6989586621683035542"><span class="annot"><span class="annottext">GlobalRdrElt
</span><a href="#local-6989586621683035542"><span class="hs-identifier hs-var">g</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-723"></span><span>          </span><span class="annot"><span class="annottext">DeprecationWarnings
-&gt; GlobalRdrElt -&gt; IOEnv (Env TcGblEnv TcLclEnv) ()
</span><a href="GHC.Rename.Env.html#addUsedGRE"><span class="hs-identifier hs-var">addUsedGRE</span></a></span><span> </span><span class="annot"><span class="annottext">DeprecationWarnings
</span><a href="#local-6989586621683035522"><span class="hs-identifier hs-var">warn_if_deprec</span></a></span><span> </span><span class="annot"><span class="annottext">GlobalRdrElt
</span><a href="#local-6989586621683035542"><span class="hs-identifier hs-var">g</span></a></span><span>
</span><span id="line-724"></span><span>          </span><span class="annot"><span class="annottext">ChildLookupResult -&gt; RnM ChildLookupResult
forall a. a -&gt; IOEnv (Env TcGblEnv TcLclEnv) a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="annot"><span class="annottext">(ChildLookupResult -&gt; RnM ChildLookupResult)
-&gt; ChildLookupResult -&gt; RnM ChildLookupResult
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">GlobalRdrElt -&gt; ChildLookupResult
</span><a href="GHC.Rename.Env.html#FoundChild"><span class="hs-identifier hs-var">FoundChild</span></a></span><span> </span><span class="annot"><span class="annottext">GlobalRdrElt
</span><a href="#local-6989586621683035542"><span class="hs-identifier hs-var">g</span></a></span><span>
</span><span id="line-725"></span><span>
</span><span id="line-726"></span><span>        </span><span class="hs-comment">-- Called when we find no matching GREs after disambiguation but</span><span>
</span><span id="line-727"></span><span>        </span><span class="hs-comment">-- there are three situations where this happens.</span><span>
</span><span id="line-728"></span><span>        </span><span class="hs-comment">-- 1. There were none to begin with.</span><span>
</span><span id="line-729"></span><span>        </span><span class="hs-comment">-- 2. None of the matching ones were the parent but</span><span>
</span><span id="line-730"></span><span>        </span><span class="hs-comment">--  a. They were from an overloaded record field so we can report</span><span>
</span><span id="line-731"></span><span>        </span><span class="hs-comment">--     a better error</span><span>
</span><span id="line-732"></span><span>        </span><span class="hs-comment">--  b. The original lookup was actually ambiguous.</span><span>
</span><span id="line-733"></span><span>        </span><span class="hs-comment">--     For example, the case where overloading is off and two</span><span>
</span><span id="line-734"></span><span>        </span><span class="hs-comment">--     record fields are in scope from different record</span><span>
</span><span id="line-735"></span><span>        </span><span class="hs-comment">--     constructors, neither of which is the parent.</span><span>
</span><span id="line-736"></span><span>        </span><span class="annot"><a href="#local-6989586621683035533"><span class="hs-identifier hs-type">noMatchingParentErr</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="GHC.Types.Name.Reader.html#GlobalRdrElt"><span class="hs-identifier hs-type">GlobalRdrElt</span></a></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#RnM"><span class="hs-identifier hs-type">RnM</span></a></span><span> </span><span class="annot"><a href="GHC.Rename.Env.html#ChildLookupResult"><span class="hs-identifier hs-type">ChildLookupResult</span></a></span><span>
</span><span id="line-737"></span><span>        </span><span id="local-6989586621683035533"><span class="annot"><span class="annottext">noMatchingParentErr :: [GlobalRdrElt] -&gt; RnM ChildLookupResult
</span><a href="#local-6989586621683035533"><span class="hs-identifier hs-var hs-var">noMatchingParentErr</span></a></span></span><span> </span><span id="local-6989586621683035543"><span class="annot"><span class="annottext">[GlobalRdrElt]
</span><a href="#local-6989586621683035543"><span class="hs-identifier hs-var">original_gres</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-738"></span><span>          </span><span class="annot"><span class="annottext">String -&gt; SDoc -&gt; IOEnv (Env TcGblEnv TcLclEnv) ()
</span><a href="GHC.Tc.Utils.Monad.html#traceRn"><span class="hs-identifier hs-var">traceRn</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;npe&quot;</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[GlobalRdrElt] -&gt; SDoc
forall a. Outputable a =&gt; a -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="annot"><span class="annottext">[GlobalRdrElt]
</span><a href="#local-6989586621683035543"><span class="hs-identifier hs-var">original_gres</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-739"></span><span>          </span><span id="local-6989586621683035544"><span class="annot"><a href="#local-6989586621683035544"><span class="hs-identifier hs-var">dup_fields_ok</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Extension -&gt; TcRnIf TcGblEnv TcLclEnv Bool
forall gbl lcl. Extension -&gt; TcRnIf gbl lcl Bool
</span><a href="GHC.Tc.Utils.Monad.html#xoptM"><span class="hs-identifier hs-var">xoptM</span></a></span><span> </span><span class="annot"><span class="annottext">Extension
</span><span class="hs-identifier hs-var">LangExt.DuplicateRecordFields</span></span><span>
</span><span id="line-740"></span><span>          </span><span class="hs-keyword">case</span><span> </span><span class="annot"><a href="#local-6989586621683035543"><span class="hs-identifier hs-type">original_gres</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-741"></span><span>            </span><span class="hs-special">[</span><span class="hs-special">]</span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">ChildLookupResult -&gt; RnM ChildLookupResult
forall a. a -&gt; IOEnv (Env TcGblEnv TcLclEnv) a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="annot"><span class="annottext">ChildLookupResult
</span><a href="GHC.Rename.Env.html#NameNotFound"><span class="hs-identifier hs-var">NameNotFound</span></a></span><span>
</span><span id="line-742"></span><span>            </span><span class="hs-special">[</span><span id="local-6989586621683035547"><span class="annot"><span class="annottext">GlobalRdrElt
</span><a href="#local-6989586621683035547"><span class="hs-identifier hs-var">g</span></a></span></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">ChildLookupResult -&gt; RnM ChildLookupResult
forall a. a -&gt; IOEnv (Env TcGblEnv TcLclEnv) a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="annot"><span class="annottext">(ChildLookupResult -&gt; RnM ChildLookupResult)
-&gt; ChildLookupResult -&gt; RnM ChildLookupResult
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Name -&gt; GlobalRdrElt -&gt; [Name] -&gt; ChildLookupResult
</span><a href="GHC.Rename.Env.html#IncorrectParent"><span class="hs-identifier hs-var">IncorrectParent</span></a></span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621683035523"><span class="hs-identifier hs-var">parent</span></a></span><span> </span><span class="annot"><span class="annottext">GlobalRdrElt
</span><a href="#local-6989586621683035547"><span class="hs-identifier hs-var">g</span></a></span><span>
</span><span id="line-743"></span><span>                              </span><span class="hs-special">[</span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621683035549"><span class="hs-identifier hs-var">p</span></a></span><span> </span><span class="hs-glyph">|</span><span> </span><span class="annot"><a href="GHC.Types.Name.Reader.html#ParentIs"><span class="hs-identifier hs-type">ParentIs</span></a></span><span> </span><span id="local-6989586621683035549"><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621683035549"><span class="hs-identifier hs-var">p</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">GlobalRdrElt -&gt; Parent
forall info. GlobalRdrEltX info -&gt; Parent
</span><a href="GHC.Types.Name.Reader.html#greParent"><span class="hs-identifier hs-var">greParent</span></a></span><span> </span><span class="annot"><span class="annottext">GlobalRdrElt
</span><a href="#local-6989586621683035547"><span class="hs-identifier hs-var">g</span></a></span><span class="hs-special">]</span><span class="hs-special">]</span><span>
</span><span id="line-744"></span><span>            </span><span id="local-6989586621683035552"><span class="annot"><span class="annottext">gss :: [GlobalRdrElt]
</span><a href="#local-6989586621683035552"><span class="hs-identifier hs-var">gss</span></a></span></span><span class="hs-glyph">@</span><span class="hs-special">(</span><span id="local-6989586621683035553"><span class="annot"><span class="annottext">GlobalRdrElt
</span><a href="#local-6989586621683035553"><span class="hs-identifier hs-var">g</span></a></span></span><span class="annot"><span class="hs-glyph hs-type">:</span></span><span id="local-6989586621683035554"><span class="annot"><span class="annottext">gss' :: [GlobalRdrElt]
</span><a href="#local-6989586621683035554"><span class="hs-identifier hs-var">gss'</span></a></span></span><span class="hs-glyph">@</span><span class="hs-special">(</span><span class="annot"><span class="annottext">GlobalRdrElt
</span><span class="hs-identifier">_</span></span><span class="annot"><span class="hs-glyph hs-type">:</span></span><span class="annot"><span class="annottext">[GlobalRdrElt]
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-745"></span><span>              </span><span class="hs-keyword">if</span><span> </span><span class="annot"><span class="annottext">(GlobalRdrElt -&gt; Bool) -&gt; [GlobalRdrElt] -&gt; Bool
forall (t :: * -&gt; *) a. Foldable t =&gt; (a -&gt; Bool) -&gt; t a -&gt; Bool
</span><span class="hs-identifier hs-var">all</span></span><span> </span><span class="annot"><span class="annottext">GlobalRdrElt -&gt; Bool
forall info. GlobalRdrEltX info -&gt; Bool
</span><a href="GHC.Types.Name.Reader.html#isRecFldGRE"><span class="hs-identifier hs-var">isRecFldGRE</span></a></span><span> </span><span class="annot"><span class="annottext">[GlobalRdrElt]
</span><a href="#local-6989586621683035552"><span class="hs-identifier hs-var">gss</span></a></span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Bool -&gt; Bool
</span><span class="hs-operator hs-var">&amp;&amp;</span></span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621683035544"><span class="hs-identifier hs-var">dup_fields_ok</span></a></span><span>
</span><span id="line-746"></span><span>              </span><span class="hs-keyword">then</span><span> </span><span class="annot"><span class="annottext">ChildLookupResult -&gt; RnM ChildLookupResult
forall a. a -&gt; IOEnv (Env TcGblEnv TcLclEnv) a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="annot"><span class="annottext">(ChildLookupResult -&gt; RnM ChildLookupResult)
-&gt; ChildLookupResult -&gt; RnM ChildLookupResult
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-747"></span><span>                    </span><span class="annot"><span class="annottext">Name -&gt; GlobalRdrElt -&gt; [Name] -&gt; ChildLookupResult
</span><a href="GHC.Rename.Env.html#IncorrectParent"><span class="hs-identifier hs-var">IncorrectParent</span></a></span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621683035523"><span class="hs-identifier hs-var">parent</span></a></span><span> </span><span class="annot"><span class="annottext">GlobalRdrElt
</span><a href="#local-6989586621683035553"><span class="hs-identifier hs-var">g</span></a></span><span>
</span><span id="line-748"></span><span>                      </span><span class="hs-special">[</span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621683035556"><span class="hs-identifier hs-var">p</span></a></span><span> </span><span class="hs-glyph">|</span><span> </span><span id="local-6989586621683035557"><span class="annot"><span class="annottext">GlobalRdrElt
</span><a href="#local-6989586621683035557"><span class="hs-identifier hs-var">x</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">[GlobalRdrElt]
</span><a href="#local-6989586621683035552"><span class="hs-identifier hs-var">gss</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Types.Name.Reader.html#ParentIs"><span class="hs-identifier hs-type">ParentIs</span></a></span><span> </span><span id="local-6989586621683035556"><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621683035556"><span class="hs-identifier hs-var">p</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">GlobalRdrElt -&gt; Parent
forall info. GlobalRdrEltX info -&gt; Parent
</span><a href="GHC.Types.Name.Reader.html#greParent"><span class="hs-identifier hs-var">greParent</span></a></span><span> </span><span class="annot"><span class="annottext">GlobalRdrElt
</span><a href="#local-6989586621683035557"><span class="hs-identifier hs-var">x</span></a></span><span class="hs-special">]</span><span class="hs-special">]</span><span>
</span><span id="line-749"></span><span>              </span><span class="hs-keyword">else</span><span> </span><span class="annot"><span class="annottext">NonEmpty GlobalRdrElt -&gt; RnM ChildLookupResult
</span><a href="#local-6989586621683035541"><span class="hs-identifier hs-var">mkNameClashErr</span></a></span><span> </span><span class="annot"><span class="annottext">(NonEmpty GlobalRdrElt -&gt; RnM ChildLookupResult)
-&gt; NonEmpty GlobalRdrElt -&gt; RnM ChildLookupResult
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">GlobalRdrElt
</span><a href="#local-6989586621683035553"><span class="hs-identifier hs-var">g</span></a></span><span> </span><span class="annot"><span class="annottext">GlobalRdrElt -&gt; [GlobalRdrElt] -&gt; NonEmpty GlobalRdrElt
forall a. a -&gt; [a] -&gt; NonEmpty a
</span><span class="hs-operator hs-var">NE.:|</span></span><span> </span><span class="annot"><span class="annottext">[GlobalRdrElt]
</span><a href="#local-6989586621683035554"><span class="hs-identifier hs-var">gss'</span></a></span><span>
</span><span id="line-750"></span><span>
</span><span id="line-751"></span><span>        </span><span class="annot"><a href="#local-6989586621683035541"><span class="hs-identifier hs-type">mkNameClashErr</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">NE.NonEmpty</span></span><span> </span><span class="annot"><a href="GHC.Types.Name.Reader.html#GlobalRdrElt"><span class="hs-identifier hs-type">GlobalRdrElt</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#RnM"><span class="hs-identifier hs-type">RnM</span></a></span><span> </span><span class="annot"><a href="GHC.Rename.Env.html#ChildLookupResult"><span class="hs-identifier hs-type">ChildLookupResult</span></a></span><span>
</span><span id="line-752"></span><span>        </span><span id="local-6989586621683035541"><span class="annot"><span class="annottext">mkNameClashErr :: NonEmpty GlobalRdrElt -&gt; RnM ChildLookupResult
</span><a href="#local-6989586621683035541"><span class="hs-identifier hs-var hs-var">mkNameClashErr</span></a></span></span><span> </span><span id="local-6989586621683035559"><span class="annot"><span class="annottext">NonEmpty GlobalRdrElt
</span><a href="#local-6989586621683035559"><span class="hs-identifier hs-var">gres</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-753"></span><span>          </span><span class="annot"><span class="annottext">RdrName
-&gt; NonEmpty GlobalRdrElt -&gt; IOEnv (Env TcGblEnv TcLclEnv) ()
</span><a href="GHC.Rename.Utils.html#addNameClashErrRn"><span class="hs-identifier hs-var">addNameClashErrRn</span></a></span><span> </span><span class="annot"><span class="annottext">RdrName
</span><a href="#local-6989586621683035524"><span class="hs-identifier hs-var">rdr_name</span></a></span><span> </span><span class="annot"><span class="annottext">NonEmpty GlobalRdrElt
</span><a href="#local-6989586621683035559"><span class="hs-identifier hs-var">gres</span></a></span><span>
</span><span id="line-754"></span><span>          </span><span class="annot"><span class="annottext">ChildLookupResult -&gt; RnM ChildLookupResult
forall a. a -&gt; IOEnv (Env TcGblEnv TcLclEnv) a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">GlobalRdrElt -&gt; ChildLookupResult
</span><a href="GHC.Rename.Env.html#FoundChild"><span class="hs-identifier hs-var">FoundChild</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">NonEmpty GlobalRdrElt -&gt; GlobalRdrElt
forall a. NonEmpty a -&gt; a
</span><a href="../../base-4.21.0.0-ae91/src/Data.List.NonEmpty.html#head"><span class="hs-identifier hs-var">NE.head</span></a></span><span> </span><span class="annot"><span class="annottext">NonEmpty GlobalRdrElt
</span><a href="#local-6989586621683035559"><span class="hs-identifier hs-var">gres</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-755"></span><span>
</span><span id="line-756"></span><span>        </span><span class="annot"><a href="#local-6989586621683035531"><span class="hs-identifier hs-type">pick_gres</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="GHC.Types.Name.Reader.html#GlobalRdrElt"><span class="hs-identifier hs-type">GlobalRdrElt</span></a></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Rename.Env.html#DisambigInfo"><span class="hs-identifier hs-type">DisambigInfo</span></a></span><span>
</span><span id="line-757"></span><span>        </span><span class="hs-comment">-- For Unqual, find GREs that are in scope qualified or unqualified</span><span>
</span><span id="line-758"></span><span>        </span><span class="hs-comment">-- For Qual,   find GREs that are in scope with that qualification</span><span>
</span><span id="line-759"></span><span>        </span><span id="local-6989586621683035531"><span class="annot"><span class="annottext">pick_gres :: [GlobalRdrElt] -&gt; DisambigInfo
</span><a href="#local-6989586621683035531"><span class="hs-identifier hs-var hs-var">pick_gres</span></a></span></span><span> </span><span id="local-6989586621683035562"><span class="annot"><span class="annottext">[GlobalRdrElt]
</span><a href="#local-6989586621683035562"><span class="hs-identifier hs-var">gres</span></a></span></span><span>
</span><span id="line-760"></span><span>          </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">RdrName -&gt; Bool
</span><a href="GHC.Types.Name.Reader.html#isUnqual"><span class="hs-identifier hs-var">isUnqual</span></a></span><span> </span><span class="annot"><span class="annottext">RdrName
</span><a href="#local-6989586621683035524"><span class="hs-identifier hs-var">rdr_name</span></a></span><span>
</span><span id="line-761"></span><span>          </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[DisambigInfo] -&gt; DisambigInfo
forall a. Monoid a =&gt; [a] -&gt; a
</span><span class="hs-identifier hs-var">mconcat</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(GlobalRdrElt -&gt; DisambigInfo) -&gt; [GlobalRdrElt] -&gt; [DisambigInfo]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><span class="hs-identifier hs-var">map</span></span><span> </span><span class="annot"><span class="annottext">GlobalRdrElt -&gt; DisambigInfo
</span><a href="#local-6989586621683035564"><span class="hs-identifier hs-var">right_parent</span></a></span><span> </span><span class="annot"><span class="annottext">[GlobalRdrElt]
</span><a href="#local-6989586621683035562"><span class="hs-identifier hs-var">gres</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-762"></span><span>          </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">otherwise</span></span><span>
</span><span id="line-763"></span><span>          </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[DisambigInfo] -&gt; DisambigInfo
forall a. Monoid a =&gt; [a] -&gt; a
</span><span class="hs-identifier hs-var">mconcat</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(GlobalRdrElt -&gt; DisambigInfo) -&gt; [GlobalRdrElt] -&gt; [DisambigInfo]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><span class="hs-identifier hs-var">map</span></span><span> </span><span class="annot"><span class="annottext">GlobalRdrElt -&gt; DisambigInfo
</span><a href="#local-6989586621683035564"><span class="hs-identifier hs-var">right_parent</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">RdrName -&gt; [GlobalRdrElt] -&gt; [GlobalRdrElt]
forall info.
RdrName -&gt; [GlobalRdrEltX info] -&gt; [GlobalRdrEltX info]
</span><a href="GHC.Types.Name.Reader.html#pickGREs"><span class="hs-identifier hs-var">pickGREs</span></a></span><span> </span><span class="annot"><span class="annottext">RdrName
</span><a href="#local-6989586621683035524"><span class="hs-identifier hs-var">rdr_name</span></a></span><span> </span><span class="annot"><span class="annottext">[GlobalRdrElt]
</span><a href="#local-6989586621683035562"><span class="hs-identifier hs-var">gres</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-764"></span><span>
</span><span id="line-765"></span><span>        </span><span class="annot"><a href="#local-6989586621683035564"><span class="hs-identifier hs-type">right_parent</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Types.Name.Reader.html#GlobalRdrElt"><span class="hs-identifier hs-type">GlobalRdrElt</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Rename.Env.html#DisambigInfo"><span class="hs-identifier hs-type">DisambigInfo</span></a></span><span>
</span><span id="line-766"></span><span>        </span><span id="local-6989586621683035564"><span class="annot"><span class="annottext">right_parent :: GlobalRdrElt -&gt; DisambigInfo
</span><a href="#local-6989586621683035564"><span class="hs-identifier hs-var hs-var">right_parent</span></a></span></span><span> </span><span id="local-6989586621683035565"><span class="annot"><span class="annottext">GlobalRdrElt
</span><a href="#local-6989586621683035565"><span class="hs-identifier hs-var">gre</span></a></span></span><span>
</span><span id="line-767"></span><span>          </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">GlobalRdrElt -&gt; Parent
forall info. GlobalRdrEltX info -&gt; Parent
</span><a href="GHC.Types.Name.Reader.html#greParent"><span class="hs-identifier hs-var">greParent</span></a></span><span> </span><span class="annot"><span class="annottext">GlobalRdrElt
</span><a href="#local-6989586621683035565"><span class="hs-identifier hs-var">gre</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-768"></span><span>              </span><span class="annot"><a href="GHC.Types.Name.Reader.html#ParentIs"><span class="hs-identifier hs-type">ParentIs</span></a></span><span> </span><span id="local-6989586621683035566"><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621683035566"><span class="hs-identifier hs-var">cur_parent</span></a></span></span><span>
</span><span id="line-769"></span><span>                 </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621683035523"><span class="hs-identifier hs-var">parent</span></a></span><span> </span><span class="annot"><span class="annottext">Name -&gt; Name -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">==</span></span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621683035566"><span class="hs-identifier hs-var">cur_parent</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">GlobalRdrElt -&gt; DisambigInfo
</span><a href="GHC.Rename.Env.html#DisambiguatedOccurrence"><span class="hs-identifier hs-var">DisambiguatedOccurrence</span></a></span><span> </span><span class="annot"><span class="annottext">GlobalRdrElt
</span><a href="#local-6989586621683035565"><span class="hs-identifier hs-var">gre</span></a></span><span>
</span><span id="line-770"></span><span>                 </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">otherwise</span></span><span>            </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">DisambigInfo
</span><a href="GHC.Rename.Env.html#NoOccurrence"><span class="hs-identifier hs-var">NoOccurrence</span></a></span><span>
</span><span id="line-771"></span><span>              </span><span class="annot"><span class="annottext">Parent
</span><a href="GHC.Types.Name.Reader.html#NoParent"><span class="hs-identifier hs-var">NoParent</span></a></span><span>                  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">GlobalRdrElt -&gt; DisambigInfo
</span><a href="GHC.Rename.Env.html#UniqueOccurrence"><span class="hs-identifier hs-var">UniqueOccurrence</span></a></span><span> </span><span class="annot"><span class="annottext">GlobalRdrElt
</span><a href="#local-6989586621683035565"><span class="hs-identifier hs-var">gre</span></a></span><span>
</span><span id="line-772"></span><span class="hs-pragma">{-# INLINEABLE</span><span> </span><span class="annot"><a href="GHC.Rename.Env.html#lookupSubBndrOcc_helper"><span class="hs-pragma hs-type">lookupSubBndrOcc_helper</span></a></span><span> </span><span class="hs-pragma">#-}</span><span>
</span><span id="line-773"></span><span>
</span><span id="line-774"></span><span class="hs-comment">-- | This domain specific datatype is used to record why we decided it was</span><span>
</span><span id="line-775"></span><span class="hs-comment">-- possible that a GRE could be exported with a parent.</span><span>
</span><span id="line-776"></span><span class="hs-keyword">data</span><span> </span><span id="DisambigInfo"><span class="annot"><a href="GHC.Rename.Env.html#DisambigInfo"><span class="hs-identifier hs-var">DisambigInfo</span></a></span></span><span>
</span><span id="line-777"></span><span>       </span><span class="hs-glyph">=</span><span> </span><span id="NoOccurrence"><span class="annot"><a href="GHC.Rename.Env.html#NoOccurrence"><span class="hs-identifier hs-var">NoOccurrence</span></a></span></span><span>
</span><span id="line-778"></span><span>          </span><span class="annot"><span class="hs-comment">-- ^ The GRE could not be found, or it has the wrong parent.</span></span><span>
</span><span id="line-779"></span><span>       </span><span class="hs-glyph">|</span><span> </span><span id="UniqueOccurrence"><span class="annot"><a href="GHC.Rename.Env.html#UniqueOccurrence"><span class="hs-identifier hs-var">UniqueOccurrence</span></a></span></span><span> </span><span class="annot"><a href="GHC.Types.Name.Reader.html#GlobalRdrElt"><span class="hs-identifier hs-type">GlobalRdrElt</span></a></span><span>
</span><span id="line-780"></span><span>          </span><span class="annot"><span class="hs-comment">-- ^ The GRE has no parent. It could be a pattern synonym.</span></span><span>
</span><span id="line-781"></span><span>       </span><span class="hs-glyph">|</span><span> </span><span id="DisambiguatedOccurrence"><span class="annot"><a href="GHC.Rename.Env.html#DisambiguatedOccurrence"><span class="hs-identifier hs-var">DisambiguatedOccurrence</span></a></span></span><span> </span><span class="annot"><a href="GHC.Types.Name.Reader.html#GlobalRdrElt"><span class="hs-identifier hs-type">GlobalRdrElt</span></a></span><span>
</span><span id="line-782"></span><span>          </span><span class="annot"><span class="hs-comment">-- ^ The parent of the GRE is the correct parent.</span></span><span>
</span><span id="line-783"></span><span>       </span><span class="hs-glyph">|</span><span> </span><span id="AmbiguousOccurrence"><span class="annot"><a href="GHC.Rename.Env.html#AmbiguousOccurrence"><span class="hs-identifier hs-var">AmbiguousOccurrence</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">NE.NonEmpty</span></span><span> </span><span class="annot"><a href="GHC.Types.Name.Reader.html#GlobalRdrElt"><span class="hs-identifier hs-type">GlobalRdrElt</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-784"></span><span>          </span><span class="hs-comment">-- ^ The GRE is ambiguous.</span><span>
</span><span id="line-785"></span><span>          </span><span class="hs-comment">--</span><span>
</span><span id="line-786"></span><span>          </span><span class="hs-comment">-- For example, two normal identifiers with the same name are in</span><span>
</span><span id="line-787"></span><span>          </span><span class="hs-comment">-- scope. They will both be resolved to &quot;UniqueOccurrence&quot; and the</span><span>
</span><span id="line-788"></span><span>          </span><span class="hs-comment">-- monoid will combine them to this failing case.</span><span>
</span><span id="line-789"></span><span>
</span><span id="line-790"></span><span class="hs-keyword">instance</span><span> </span><span class="annot"><a href="GHC.Utils.Outputable.html#Outputable"><span class="hs-identifier hs-type">Outputable</span></a></span><span> </span><span class="annot"><a href="GHC.Rename.Env.html#DisambigInfo"><span class="hs-identifier hs-type">DisambigInfo</span></a></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-791"></span><span>  </span><span id="local-6989586621683035579"><span class="annot"><span class="annottext">ppr :: DisambigInfo -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var hs-var hs-var">ppr</span></a></span></span><span> </span><span class="annot"><span class="annottext">DisambigInfo
</span><a href="GHC.Rename.Env.html#NoOccurrence"><span class="hs-identifier hs-var">NoOccurrence</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">String -&gt; SDoc
forall doc. IsLine doc =&gt; String -&gt; doc
</span><a href="GHC.Utils.Outputable.html#text"><span class="hs-identifier hs-var">text</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;NoOccurrence&quot;</span></span><span>
</span><span id="line-792"></span><span>  </span><span class="annot"><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Rename.Env.html#UniqueOccurrence"><span class="hs-identifier hs-type">UniqueOccurrence</span></a></span><span> </span><span id="local-6989586621683035580"><span class="annot"><span class="annottext">GlobalRdrElt
</span><a href="#local-6989586621683035580"><span class="hs-identifier hs-var">gre</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">String -&gt; SDoc
forall doc. IsLine doc =&gt; String -&gt; doc
</span><a href="GHC.Utils.Outputable.html#text"><span class="hs-identifier hs-var">text</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;UniqueOccurrence:&quot;</span></span><span> </span><span class="annot"><span class="annottext">SDoc -&gt; SDoc -&gt; SDoc
forall doc. IsLine doc =&gt; doc -&gt; doc -&gt; doc
</span><a href="GHC.Utils.Outputable.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">GlobalRdrElt -&gt; SDoc
forall a. Outputable a =&gt; a -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="annot"><span class="annottext">GlobalRdrElt
</span><a href="#local-6989586621683035580"><span class="hs-identifier hs-var">gre</span></a></span><span>
</span><span id="line-793"></span><span>  </span><span class="annot"><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Rename.Env.html#DisambiguatedOccurrence"><span class="hs-identifier hs-type">DisambiguatedOccurrence</span></a></span><span> </span><span id="local-6989586621683035581"><span class="annot"><span class="annottext">GlobalRdrElt
</span><a href="#local-6989586621683035581"><span class="hs-identifier hs-var">gre</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">String -&gt; SDoc
forall doc. IsLine doc =&gt; String -&gt; doc
</span><a href="GHC.Utils.Outputable.html#text"><span class="hs-identifier hs-var">text</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;DiambiguatedOccurrence:&quot;</span></span><span> </span><span class="annot"><span class="annottext">SDoc -&gt; SDoc -&gt; SDoc
forall doc. IsLine doc =&gt; doc -&gt; doc -&gt; doc
</span><a href="GHC.Utils.Outputable.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">GlobalRdrElt -&gt; SDoc
forall a. Outputable a =&gt; a -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="annot"><span class="annottext">GlobalRdrElt
</span><a href="#local-6989586621683035581"><span class="hs-identifier hs-var">gre</span></a></span><span>
</span><span id="line-794"></span><span>  </span><span class="annot"><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Rename.Env.html#AmbiguousOccurrence"><span class="hs-identifier hs-type">AmbiguousOccurrence</span></a></span><span> </span><span id="local-6989586621683035582"><span class="annot"><span class="annottext">NonEmpty GlobalRdrElt
</span><a href="#local-6989586621683035582"><span class="hs-identifier hs-var">gres</span></a></span></span><span class="hs-special">)</span><span>    </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">String -&gt; SDoc
forall doc. IsLine doc =&gt; String -&gt; doc
</span><a href="GHC.Utils.Outputable.html#text"><span class="hs-identifier hs-var">text</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;Ambiguous:&quot;</span></span><span> </span><span class="annot"><span class="annottext">SDoc -&gt; SDoc -&gt; SDoc
forall doc. IsLine doc =&gt; doc -&gt; doc -&gt; doc
</span><a href="GHC.Utils.Outputable.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">NonEmpty GlobalRdrElt -&gt; SDoc
forall a. Outputable a =&gt; a -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="annot"><span class="annottext">NonEmpty GlobalRdrElt
</span><a href="#local-6989586621683035582"><span class="hs-identifier hs-var">gres</span></a></span><span>
</span><span id="line-795"></span><span>
</span><span id="line-796"></span><span class="hs-keyword">instance</span><span> </span><span id="local-6989586621683035585"><span id="local-6989586621683035589"><span class="annot"><span class="hs-identifier hs-type">Semi.Semigroup</span></span><span> </span><span class="annot"><a href="GHC.Rename.Env.html#DisambigInfo"><span class="hs-identifier hs-type">DisambigInfo</span></a></span></span></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-797"></span><span>  </span><span class="hs-comment">-- These are the key lines: we prefer disambiguated occurrences to other</span><span>
</span><span id="line-798"></span><span>  </span><span class="hs-comment">-- names.</span><span>
</span><span id="line-799"></span><span>  </span><span class="annot"><span class="annottext">DisambigInfo
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621683035596"><span class="annot"><span class="annottext">&lt;&gt; :: DisambigInfo -&gt; DisambigInfo -&gt; DisambigInfo
</span><span class="hs-operator hs-var hs-var hs-var">&lt;&gt;</span></span></span><span> </span><span class="annot"><a href="GHC.Rename.Env.html#DisambiguatedOccurrence"><span class="hs-identifier hs-type">DisambiguatedOccurrence</span></a></span><span> </span><span id="local-6989586621683035597"><span class="annot"><span class="annottext">GlobalRdrElt
</span><a href="#local-6989586621683035597"><span class="hs-identifier hs-var">g'</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">GlobalRdrElt -&gt; DisambigInfo
</span><a href="GHC.Rename.Env.html#DisambiguatedOccurrence"><span class="hs-identifier hs-var">DisambiguatedOccurrence</span></a></span><span> </span><span class="annot"><span class="annottext">GlobalRdrElt
</span><a href="#local-6989586621683035597"><span class="hs-identifier hs-var">g'</span></a></span><span>
</span><span id="line-800"></span><span>  </span><span class="annot"><a href="GHC.Rename.Env.html#DisambiguatedOccurrence"><span class="hs-identifier hs-type">DisambiguatedOccurrence</span></a></span><span> </span><span id="local-6989586621683035598"><span class="annot"><span class="annottext">GlobalRdrElt
</span><a href="#local-6989586621683035598"><span class="hs-identifier hs-var">g'</span></a></span></span><span> </span><span class="annot"><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">DisambigInfo
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">GlobalRdrElt -&gt; DisambigInfo
</span><a href="GHC.Rename.Env.html#DisambiguatedOccurrence"><span class="hs-identifier hs-var">DisambiguatedOccurrence</span></a></span><span> </span><span class="annot"><span class="annottext">GlobalRdrElt
</span><a href="#local-6989586621683035598"><span class="hs-identifier hs-var">g'</span></a></span><span>
</span><span id="line-801"></span><span>
</span><span id="line-802"></span><span>  </span><span class="annot"><span class="annottext">DisambigInfo
</span><a href="GHC.Rename.Env.html#NoOccurrence"><span class="hs-identifier hs-var">NoOccurrence</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span id="local-6989586621683035599"><span class="annot"><span class="annottext">DisambigInfo
</span><a href="#local-6989586621683035599"><span class="hs-identifier hs-var">m</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">DisambigInfo
</span><a href="#local-6989586621683035599"><span class="hs-identifier hs-var">m</span></a></span><span>
</span><span id="line-803"></span><span>  </span><span id="local-6989586621683035600"><span class="annot"><span class="annottext">DisambigInfo
</span><a href="#local-6989586621683035600"><span class="hs-identifier hs-var">m</span></a></span></span><span> </span><span class="annot"><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">DisambigInfo
</span><a href="GHC.Rename.Env.html#NoOccurrence"><span class="hs-identifier hs-var">NoOccurrence</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">DisambigInfo
</span><a href="#local-6989586621683035600"><span class="hs-identifier hs-var">m</span></a></span><span>
</span><span id="line-804"></span><span>  </span><span class="annot"><a href="GHC.Rename.Env.html#UniqueOccurrence"><span class="hs-identifier hs-type">UniqueOccurrence</span></a></span><span> </span><span id="local-6989586621683035601"><span class="annot"><span class="annottext">GlobalRdrElt
</span><a href="#local-6989586621683035601"><span class="hs-identifier hs-var">g</span></a></span></span><span> </span><span class="annot"><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><a href="GHC.Rename.Env.html#UniqueOccurrence"><span class="hs-identifier hs-type">UniqueOccurrence</span></a></span><span> </span><span id="local-6989586621683035602"><span class="annot"><span class="annottext">GlobalRdrElt
</span><a href="#local-6989586621683035602"><span class="hs-identifier hs-var">g'</span></a></span></span><span>
</span><span id="line-805"></span><span>    </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">NonEmpty GlobalRdrElt -&gt; DisambigInfo
</span><a href="GHC.Rename.Env.html#AmbiguousOccurrence"><span class="hs-identifier hs-var">AmbiguousOccurrence</span></a></span><span> </span><span class="annot"><span class="annottext">(NonEmpty GlobalRdrElt -&gt; DisambigInfo)
-&gt; NonEmpty GlobalRdrElt -&gt; DisambigInfo
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">GlobalRdrElt
</span><a href="#local-6989586621683035601"><span class="hs-identifier hs-var">g</span></a></span><span> </span><span class="annot"><span class="annottext">GlobalRdrElt -&gt; [GlobalRdrElt] -&gt; NonEmpty GlobalRdrElt
forall a. a -&gt; [a] -&gt; NonEmpty a
</span><span class="hs-operator hs-var">NE.:|</span></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">GlobalRdrElt
</span><a href="#local-6989586621683035602"><span class="hs-identifier hs-var">g'</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-806"></span><span>  </span><span class="annot"><a href="GHC.Rename.Env.html#UniqueOccurrence"><span class="hs-identifier hs-type">UniqueOccurrence</span></a></span><span> </span><span id="local-6989586621683035603"><span class="annot"><span class="annottext">GlobalRdrElt
</span><a href="#local-6989586621683035603"><span class="hs-identifier hs-var">g</span></a></span></span><span> </span><span class="annot"><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><a href="GHC.Rename.Env.html#AmbiguousOccurrence"><span class="hs-identifier hs-type">AmbiguousOccurrence</span></a></span><span> </span><span id="local-6989586621683035604"><span class="annot"><span class="annottext">NonEmpty GlobalRdrElt
</span><a href="#local-6989586621683035604"><span class="hs-identifier hs-var">gs</span></a></span></span><span>
</span><span id="line-807"></span><span>    </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">NonEmpty GlobalRdrElt -&gt; DisambigInfo
</span><a href="GHC.Rename.Env.html#AmbiguousOccurrence"><span class="hs-identifier hs-var">AmbiguousOccurrence</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">GlobalRdrElt
</span><a href="#local-6989586621683035603"><span class="hs-identifier hs-var">g</span></a></span><span> </span><span class="annot"><span class="annottext">GlobalRdrElt -&gt; NonEmpty GlobalRdrElt -&gt; NonEmpty GlobalRdrElt
forall a. a -&gt; NonEmpty a -&gt; NonEmpty a
</span><a href="../../base-4.21.0.0-ae91/src/Data.List.NonEmpty.html#cons"><span class="hs-operator hs-var">`NE.cons`</span></a></span><span> </span><span class="annot"><span class="annottext">NonEmpty GlobalRdrElt
</span><a href="#local-6989586621683035604"><span class="hs-identifier hs-var">gs</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-808"></span><span>  </span><span class="annot"><a href="GHC.Rename.Env.html#AmbiguousOccurrence"><span class="hs-identifier hs-type">AmbiguousOccurrence</span></a></span><span> </span><span id="local-6989586621683035606"><span class="annot"><span class="annottext">NonEmpty GlobalRdrElt
</span><a href="#local-6989586621683035606"><span class="hs-identifier hs-var">gs</span></a></span></span><span> </span><span class="annot"><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><a href="GHC.Rename.Env.html#UniqueOccurrence"><span class="hs-identifier hs-type">UniqueOccurrence</span></a></span><span> </span><span id="local-6989586621683035607"><span class="annot"><span class="annottext">GlobalRdrElt
</span><a href="#local-6989586621683035607"><span class="hs-identifier hs-var">g'</span></a></span></span><span>
</span><span id="line-809"></span><span>    </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">NonEmpty GlobalRdrElt -&gt; DisambigInfo
</span><a href="GHC.Rename.Env.html#AmbiguousOccurrence"><span class="hs-identifier hs-var">AmbiguousOccurrence</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">GlobalRdrElt
</span><a href="#local-6989586621683035607"><span class="hs-identifier hs-var">g'</span></a></span><span> </span><span class="annot"><span class="annottext">GlobalRdrElt -&gt; NonEmpty GlobalRdrElt -&gt; NonEmpty GlobalRdrElt
forall a. a -&gt; NonEmpty a -&gt; NonEmpty a
</span><a href="../../base-4.21.0.0-ae91/src/Data.List.NonEmpty.html#cons"><span class="hs-operator hs-var">`NE.cons`</span></a></span><span> </span><span class="annot"><span class="annottext">NonEmpty GlobalRdrElt
</span><a href="#local-6989586621683035606"><span class="hs-identifier hs-var">gs</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-810"></span><span>  </span><span class="annot"><a href="GHC.Rename.Env.html#AmbiguousOccurrence"><span class="hs-identifier hs-type">AmbiguousOccurrence</span></a></span><span> </span><span id="local-6989586621683035608"><span class="annot"><span class="annottext">NonEmpty GlobalRdrElt
</span><a href="#local-6989586621683035608"><span class="hs-identifier hs-var">gs</span></a></span></span><span> </span><span class="annot"><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><a href="GHC.Rename.Env.html#AmbiguousOccurrence"><span class="hs-identifier hs-type">AmbiguousOccurrence</span></a></span><span> </span><span id="local-6989586621683035609"><span class="annot"><span class="annottext">NonEmpty GlobalRdrElt
</span><a href="#local-6989586621683035609"><span class="hs-identifier hs-var">gs'</span></a></span></span><span>
</span><span id="line-811"></span><span>    </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">NonEmpty GlobalRdrElt -&gt; DisambigInfo
</span><a href="GHC.Rename.Env.html#AmbiguousOccurrence"><span class="hs-identifier hs-var">AmbiguousOccurrence</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">NonEmpty GlobalRdrElt
</span><a href="#local-6989586621683035608"><span class="hs-identifier hs-var">gs</span></a></span><span> </span><span class="annot"><span class="annottext">NonEmpty GlobalRdrElt
-&gt; NonEmpty GlobalRdrElt -&gt; NonEmpty GlobalRdrElt
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">Semi.&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">NonEmpty GlobalRdrElt
</span><a href="#local-6989586621683035609"><span class="hs-identifier hs-var">gs'</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-812"></span><span>
</span><span id="line-813"></span><span class="hs-keyword">instance</span><span> </span><span id="local-6989586621683035615"><span class="annot"><span class="hs-identifier hs-type">Monoid</span></span><span> </span><span class="annot"><a href="GHC.Rename.Env.html#DisambigInfo"><span class="hs-identifier hs-type">DisambigInfo</span></a></span></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-814"></span><span>  </span><span id="local-6989586621683035618"><span class="annot"><span class="annottext">mempty :: DisambigInfo
</span><span class="hs-identifier hs-var hs-var hs-var">mempty</span></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">DisambigInfo
</span><a href="GHC.Rename.Env.html#NoOccurrence"><span class="hs-identifier hs-var">NoOccurrence</span></a></span><span>
</span><span id="line-815"></span><span>  </span><span id="local-6989586621683035620"><span class="annot"><span class="annottext">mappend :: DisambigInfo -&gt; DisambigInfo -&gt; DisambigInfo
</span><span class="hs-identifier hs-var hs-var hs-var">mappend</span></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">DisambigInfo -&gt; DisambigInfo -&gt; DisambigInfo
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">(Semi.&lt;&gt;)</span></span><span>
</span><span id="line-816"></span><span>
</span><span id="line-817"></span><span class="hs-comment">-- Lookup SubBndrOcc can never be ambiguous</span><span>
</span><span id="line-818"></span><span class="hs-comment">--</span><span>
</span><span id="line-819"></span><span class="hs-comment">-- Records the result of looking up a child.</span><span>
</span><span id="line-820"></span><span class="hs-keyword">data</span><span> </span><span id="ChildLookupResult"><span class="annot"><a href="GHC.Rename.Env.html#ChildLookupResult"><span class="hs-identifier hs-var">ChildLookupResult</span></a></span></span><span>
</span><span id="line-821"></span><span>      </span><span class="annot"><span class="hs-comment">-- | We couldn't find a suitable name</span></span><span>
</span><span id="line-822"></span><span>      </span><span class="hs-glyph">=</span><span> </span><span id="NameNotFound"><span class="annot"><a href="GHC.Rename.Env.html#NameNotFound"><span class="hs-identifier hs-var">NameNotFound</span></a></span></span><span>
</span><span id="line-823"></span><span>      </span><span class="annot"><span class="hs-comment">-- | The child has an incorrect parent</span></span><span>
</span><span id="line-824"></span><span>      </span><span class="hs-glyph">|</span><span> </span><span id="IncorrectParent"><span class="annot"><a href="GHC.Rename.Env.html#IncorrectParent"><span class="hs-identifier hs-var">IncorrectParent</span></a></span></span><span> </span><span class="annot"><a href="GHC.Types.Name.html#Name"><span class="hs-identifier hs-type">Name</span></a></span><span>          </span><span class="annot"><span class="hs-comment">-- ^ parent</span></span><span>
</span><span id="line-825"></span><span>                        </span><span class="annot"><a href="GHC.Types.Name.Reader.html#GlobalRdrElt"><span class="hs-identifier hs-type">GlobalRdrElt</span></a></span><span>  </span><span class="annot"><span class="hs-comment">-- ^ child we were looking for</span></span><span>
</span><span id="line-826"></span><span>                        </span><span class="hs-special">[</span><span class="annot"><a href="GHC.Types.Name.html#Name"><span class="hs-identifier hs-type">Name</span></a></span><span class="hs-special">]</span><span>        </span><span class="hs-comment">-- ^ list of possible parents</span><span>
</span><span id="line-827"></span><span>      </span><span class="hs-comment">-- | We resolved to a child</span><span>
</span><span id="line-828"></span><span>      </span><span class="hs-glyph">|</span><span> </span><span id="FoundChild"><span class="annot"><a href="GHC.Rename.Env.html#FoundChild"><span class="hs-identifier hs-var">FoundChild</span></a></span></span><span> </span><span class="annot"><a href="GHC.Types.Name.Reader.html#GlobalRdrElt"><span class="hs-identifier hs-type">GlobalRdrElt</span></a></span><span>
</span><span id="line-829"></span><span>
</span><span id="line-830"></span><span class="hs-keyword">instance</span><span> </span><span class="annot"><a href="GHC.Utils.Outputable.html#Outputable"><span class="hs-identifier hs-type">Outputable</span></a></span><span> </span><span class="annot"><a href="GHC.Rename.Env.html#ChildLookupResult"><span class="hs-identifier hs-type">ChildLookupResult</span></a></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-831"></span><span>  </span><span id="local-6989586621683035636"><span class="annot"><span class="annottext">ppr :: ChildLookupResult -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var hs-var hs-var">ppr</span></a></span></span><span> </span><span class="annot"><span class="annottext">ChildLookupResult
</span><a href="GHC.Rename.Env.html#NameNotFound"><span class="hs-identifier hs-var">NameNotFound</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">String -&gt; SDoc
forall doc. IsLine doc =&gt; String -&gt; doc
</span><a href="GHC.Utils.Outputable.html#text"><span class="hs-identifier hs-var">text</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;NameNotFound&quot;</span></span><span>
</span><span id="line-832"></span><span>  </span><span class="annot"><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Rename.Env.html#FoundChild"><span class="hs-identifier hs-type">FoundChild</span></a></span><span> </span><span id="local-6989586621683035637"><span class="annot"><span class="annottext">GlobalRdrElt
</span><a href="#local-6989586621683035637"><span class="hs-identifier hs-var">n</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">String -&gt; SDoc
forall doc. IsLine doc =&gt; String -&gt; doc
</span><a href="GHC.Utils.Outputable.html#text"><span class="hs-identifier hs-var">text</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;Found:&quot;</span></span><span> </span><span class="annot"><span class="annottext">SDoc -&gt; SDoc -&gt; SDoc
forall doc. IsLine doc =&gt; doc -&gt; doc -&gt; doc
</span><a href="GHC.Utils.Outputable.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">Parent -&gt; SDoc
forall a. Outputable a =&gt; a -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">GlobalRdrElt -&gt; Parent
forall info. GlobalRdrEltX info -&gt; Parent
</span><a href="GHC.Types.Name.Reader.html#greParent"><span class="hs-identifier hs-var">greParent</span></a></span><span> </span><span class="annot"><span class="annottext">GlobalRdrElt
</span><a href="#local-6989586621683035637"><span class="hs-identifier hs-var">n</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">SDoc -&gt; SDoc -&gt; SDoc
forall doc. IsLine doc =&gt; doc -&gt; doc -&gt; doc
</span><a href="GHC.Utils.Outputable.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">GlobalRdrElt -&gt; SDoc
forall a. Outputable a =&gt; a -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="annot"><span class="annottext">GlobalRdrElt
</span><a href="#local-6989586621683035637"><span class="hs-identifier hs-var">n</span></a></span><span>
</span><span id="line-833"></span><span>  </span><span class="annot"><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Rename.Env.html#IncorrectParent"><span class="hs-identifier hs-type">IncorrectParent</span></a></span><span> </span><span id="local-6989586621683035638"><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621683035638"><span class="hs-identifier hs-var">p</span></a></span></span><span> </span><span id="local-6989586621683035639"><span class="annot"><span class="annottext">GlobalRdrElt
</span><a href="#local-6989586621683035639"><span class="hs-identifier hs-var">g</span></a></span></span><span> </span><span id="local-6989586621683035640"><span class="annot"><span class="annottext">[Name]
</span><a href="#local-6989586621683035640"><span class="hs-identifier hs-var">ns</span></a></span></span><span class="hs-special">)</span><span>
</span><span id="line-834"></span><span>    </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">String -&gt; SDoc
forall doc. IsLine doc =&gt; String -&gt; doc
</span><a href="GHC.Utils.Outputable.html#text"><span class="hs-identifier hs-var">text</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;IncorrectParent&quot;</span></span><span>
</span><span id="line-835"></span><span>      </span><span class="annot"><span class="annottext">SDoc -&gt; SDoc -&gt; SDoc
forall doc. IsLine doc =&gt; doc -&gt; doc -&gt; doc
</span><a href="GHC.Utils.Outputable.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">[SDoc] -&gt; SDoc
forall doc. IsLine doc =&gt; [doc] -&gt; doc
</span><a href="GHC.Utils.Outputable.html#hsep"><span class="hs-identifier hs-var">hsep</span></a></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">Name -&gt; SDoc
forall a. Outputable a =&gt; a -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621683035638"><span class="hs-identifier hs-var">p</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Name -&gt; SDoc
forall a. Outputable a =&gt; a -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="annot"><span class="annottext">(Name -&gt; SDoc) -&gt; Name -&gt; SDoc
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">GlobalRdrElt -&gt; Name
forall info. GlobalRdrEltX info -&gt; Name
</span><a href="GHC.Types.Name.Reader.html#greName"><span class="hs-identifier hs-var">greName</span></a></span><span> </span><span class="annot"><span class="annottext">GlobalRdrElt
</span><a href="#local-6989586621683035639"><span class="hs-identifier hs-var">g</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">[Name] -&gt; SDoc
forall a. Outputable a =&gt; a -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="annot"><span class="annottext">[Name]
</span><a href="#local-6989586621683035640"><span class="hs-identifier hs-var">ns</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-836"></span><span>
</span><span id="line-837"></span><span class="annot"><a href="GHC.Rename.Env.html#lookupSubBndrOcc"><span class="hs-identifier hs-type">lookupSubBndrOcc</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Rename.Utils.html#DeprecationWarnings"><span class="hs-identifier hs-type">DeprecationWarnings</span></a></span><span>
</span><span id="line-838"></span><span>                 </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Types.Name.html#Name"><span class="hs-identifier hs-type">Name</span></a></span><span>     </span><span class="hs-comment">-- Parent</span><span>
</span><span id="line-839"></span><span>                 </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Utils.Outputable.html#SDoc"><span class="hs-identifier hs-type">SDoc</span></a></span><span>
</span><span id="line-840"></span><span>                 </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Types.Name.Reader.html#RdrName"><span class="hs-identifier hs-type">RdrName</span></a></span><span>
</span><span id="line-841"></span><span>                 </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#RnM"><span class="hs-identifier hs-type">RnM</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Either</span></span><span> </span><span class="annot"><a href="GHC.Tc.Errors.Types.html#NotInScopeError"><span class="hs-identifier hs-type">NotInScopeError</span></a></span><span> </span><span class="annot"><a href="GHC.Types.Name.html#Name"><span class="hs-identifier hs-type">Name</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-842"></span><span class="hs-comment">-- ^ Find all the things the 'RdrName' maps to,</span><span>
</span><span id="line-843"></span><span class="hs-comment">-- and pick the one with the right 'Parent' 'Name'.</span><span>
</span><span id="line-844"></span><span id="lookupSubBndrOcc"><span class="annot"><span class="annottext">lookupSubBndrOcc :: DeprecationWarnings
-&gt; Name -&gt; SDoc -&gt; RdrName -&gt; RnM (Either NotInScopeError Name)
</span><a href="GHC.Rename.Env.html#lookupSubBndrOcc"><span class="hs-identifier hs-var hs-var">lookupSubBndrOcc</span></a></span></span><span> </span><span id="local-6989586621683035642"><span class="annot"><span class="annottext">DeprecationWarnings
</span><a href="#local-6989586621683035642"><span class="hs-identifier hs-var">warn_if_deprec</span></a></span></span><span> </span><span id="local-6989586621683035643"><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621683035643"><span class="hs-identifier hs-var">the_parent</span></a></span></span><span> </span><span id="local-6989586621683035644"><span class="annot"><span class="annottext">SDoc
</span><a href="#local-6989586621683035644"><span class="hs-identifier hs-var">doc</span></a></span></span><span> </span><span id="local-6989586621683035645"><span class="annot"><span class="annottext">RdrName
</span><a href="#local-6989586621683035645"><span class="hs-identifier hs-var">rdr_name</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-845"></span><span>  </span><span class="annot"><span class="annottext">RdrName
-&gt; (GlobalRdrElt -&gt; Either NotInScopeError Name)
-&gt; RnM (Either NotInScopeError Name)
-&gt; RnM (Either NotInScopeError Name)
forall r. RdrName -&gt; (GlobalRdrElt -&gt; r) -&gt; RnM r -&gt; RnM r
</span><a href="GHC.Rename.Env.html#lookupExactOrOrig"><span class="hs-identifier hs-var">lookupExactOrOrig</span></a></span><span> </span><span class="annot"><span class="annottext">RdrName
</span><a href="#local-6989586621683035645"><span class="hs-identifier hs-var">rdr_name</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Name -&gt; Either NotInScopeError Name
forall a b. b -&gt; Either a b
</span><span class="hs-identifier hs-var">Right</span></span><span> </span><span class="annot"><span class="annottext">(Name -&gt; Either NotInScopeError Name)
-&gt; (GlobalRdrElt -&gt; Name)
-&gt; GlobalRdrElt
-&gt; Either NotInScopeError Name
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">GlobalRdrElt -&gt; Name
forall info. GlobalRdrEltX info -&gt; Name
</span><a href="GHC.Types.Name.Reader.html#greName"><span class="hs-identifier hs-var">greName</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(RnM (Either NotInScopeError Name)
 -&gt; RnM (Either NotInScopeError Name))
-&gt; RnM (Either NotInScopeError Name)
-&gt; RnM (Either NotInScopeError Name)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-846"></span><span>    </span><span class="hs-comment">-- This happens for built-in classes, see mod052 for example</span><span>
</span><span id="line-847"></span><span>    </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span id="local-6989586621683035646"><span class="annot"><a href="#local-6989586621683035646"><span class="hs-identifier hs-var">child</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Bool
-&gt; DeprecationWarnings
-&gt; Name
-&gt; RdrName
-&gt; LookupChild
-&gt; RnM ChildLookupResult
</span><a href="GHC.Rename.Env.html#lookupSubBndrOcc_helper"><span class="hs-identifier hs-var">lookupSubBndrOcc_helper</span></a></span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">True</span></span><span> </span><span class="annot"><span class="annottext">DeprecationWarnings
</span><a href="#local-6989586621683035642"><span class="hs-identifier hs-var">warn_if_deprec</span></a></span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621683035643"><span class="hs-identifier hs-var">the_parent</span></a></span><span> </span><span class="annot"><span class="annottext">RdrName
</span><a href="#local-6989586621683035645"><span class="hs-identifier hs-var">rdr_name</span></a></span><span> </span><span class="annot"><span class="annottext">LookupChild
</span><a href="#local-6989586621683035647"><span class="hs-identifier hs-var">what_lkup</span></a></span><span>
</span><span id="line-848"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">return</span></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><a href="#local-6989586621683035646"><span class="hs-identifier hs-type">child</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-849"></span><span>           </span><span class="annot"><a href="GHC.Rename.Env.html#FoundChild"><span class="hs-identifier hs-type">FoundChild</span></a></span><span> </span><span id="local-6989586621683035648"><span class="annot"><span class="annottext">GlobalRdrElt
</span><a href="#local-6989586621683035648"><span class="hs-identifier hs-var">g</span></a></span></span><span>       </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Name -&gt; Either NotInScopeError Name
forall a b. b -&gt; Either a b
</span><span class="hs-identifier hs-var">Right</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">GlobalRdrElt -&gt; Name
forall info. GlobalRdrEltX info -&gt; Name
</span><a href="GHC.Types.Name.Reader.html#greName"><span class="hs-identifier hs-var">greName</span></a></span><span> </span><span class="annot"><span class="annottext">GlobalRdrElt
</span><a href="#local-6989586621683035648"><span class="hs-identifier hs-var">g</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-850"></span><span>           </span><span class="annot"><span class="annottext">ChildLookupResult
</span><a href="GHC.Rename.Env.html#NameNotFound"><span class="hs-identifier hs-var">NameNotFound</span></a></span><span>       </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">NotInScopeError -&gt; Either NotInScopeError Name
forall a b. a -&gt; Either a b
</span><span class="hs-identifier hs-var">Left</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">SDoc -&gt; NotInScopeError
</span><a href="GHC.Tc.Errors.Types.html#UnknownSubordinate"><span class="hs-identifier hs-var">UnknownSubordinate</span></a></span><span> </span><span class="annot"><span class="annottext">SDoc
</span><a href="#local-6989586621683035644"><span class="hs-identifier hs-var">doc</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-851"></span><span>           </span><span class="annot"><a href="GHC.Rename.Env.html#IncorrectParent"><span class="hs-identifier hs-type">IncorrectParent</span></a></span><span> </span><span class="hs-special">{</span><span class="hs-special">}</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">NotInScopeError -&gt; Either NotInScopeError Name
forall a b. a -&gt; Either a b
</span><span class="hs-identifier hs-var">Left</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">SDoc -&gt; NotInScopeError
</span><a href="GHC.Tc.Errors.Types.html#UnknownSubordinate"><span class="hs-identifier hs-var">UnknownSubordinate</span></a></span><span> </span><span class="annot"><span class="annottext">SDoc
</span><a href="#local-6989586621683035644"><span class="hs-identifier hs-var">doc</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-852"></span><span>       </span><span class="hs-comment">-- See [Mismatched class methods and associated type families]</span><span>
</span><span id="line-853"></span><span>       </span><span class="hs-comment">-- in TcInstDecls.</span><span>
</span><span id="line-854"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-855"></span><span>    </span><span id="local-6989586621683035647"><span class="annot"><span class="annottext">what_lkup :: LookupChild
</span><a href="#local-6989586621683035647"><span class="hs-identifier hs-var hs-var">what_lkup</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="GHC.Types.Name.Reader.html#LookupChild"><span class="hs-identifier hs-type">LookupChild</span></a></span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">wantedParent :: Name
</span><a href="GHC.Types.Name.Reader.html#wantedParent"><span class="hs-identifier hs-var">wantedParent</span></a></span><span>        </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621683035643"><span class="hs-identifier hs-var">the_parent</span></a></span><span>
</span><span id="line-856"></span><span>                            </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">lookupDataConFirst :: Bool
</span><a href="GHC.Types.Name.Reader.html#lookupDataConFirst"><span class="hs-identifier hs-var">lookupDataConFirst</span></a></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">False</span></span><span>
</span><span id="line-857"></span><span>                            </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">prioritiseParent :: Bool
</span><a href="GHC.Types.Name.Reader.html#prioritiseParent"><span class="hs-identifier hs-var">prioritiseParent</span></a></span><span>    </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">True</span></span><span> </span><span class="hs-comment">-- See T23664.</span><span>
</span><span id="line-858"></span><span>                            </span><span class="hs-special">}</span><span>
</span><span id="line-859"></span><span class="hs-comment">{-
Note [Family instance binders]
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
Consider
  data family F a
  data instance F T = X1 | X2

The 'data instance' decl has an *occurrence* of F (and T), and *binds*
X1 and X2.  (This is unlike a normal data type declaration which would
bind F too.)  So we want an AvailTC F [X1,X2].

Now consider a similar pair:
  class C a where
    data G a
  instance C S where
    data G S = Y1 | Y2

The 'data G S' *binds* Y1 and Y2, and has an *occurrence* of G.

But there is a small complication: in an instance decl, we don't use
qualified names on the LHS; instead we use the class to disambiguate.
Thus:
  module M where
    import Blib( G )
    class C a where
      data G a
    instance C S where
      data G S = Y1 | Y2
Even though there are two G's in scope (M.G and Blib.G), the occurrence
of 'G' in the 'instance C S' decl is unambiguous, because C has only
one associated type called G. This is exactly what happens for methods,
and it is only consistent to do the same thing for types. That's the
role of the function lookupTcdName; the (Maybe Name) give the class of
the enclosing instance decl, if any.

Note [Looking up Exact RdrNames]
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
Exact RdrNames are generated by:

* Template Haskell (See Note [Binders in Template Haskell] in GHC.ThToHs)
* Derived instances (See Note [Auxiliary binders] in GHC.Tc.Deriv.Generate)

For data types and classes have Exact system Names in the binding
positions for constructors, TyCons etc.  For example
    [d| data T = MkT Int |]
when we splice in and convert to HsSyn RdrName, we'll get
    data (Exact (system Name &quot;T&quot;)) = (Exact (system Name &quot;MkT&quot;)) ...
These System names are generated by GHC.ThToHs.thRdrName

But, constructors and the like need External Names, not System Names!
So we do the following

 * In GHC.Rename.Env.newTopSrcBinder we spot Exact RdrNames that wrap a
   non-External Name, and make an External name for it. This is
   the name that goes in the GlobalRdrEnv

 * When looking up an occurrence of an Exact name, done in
   GHC.Rename.Env.lookupExactOcc, we find the Name with the right unique in the
   GlobalRdrEnv, and use the one from the envt -- it will be an
   External Name in the case of the data type/constructor above.

 * Exact names are also use for purely local binders generated
   by TH, such as    \x_33. x_33
   Both binder and occurrence are Exact RdrNames.  The occurrence
   gets looked up in the LocalRdrEnv by GHC.Rename.Env.lookupOccRn, and
   misses, because lookupLocalRdrEnv always returns Nothing for
   an Exact Name.  Now we fall through to lookupExactOcc, which
   will find the Name is not in the GlobalRdrEnv, so we just use
   the Exact supplied Name.

Note [Splicing Exact names]
~~~~~~~~~~~~~~~~~~~~~~~~~~~
Consider the splice $(do { x &lt;- newName &quot;x&quot;; return (VarE x) })
This will generate a (HsExpr RdrName) term that mentions the
Exact RdrName &quot;x_56&quot; (or whatever), but does not bind it.  So
when looking such Exact names we want to check that it's in scope,
otherwise the type checker will get confused.  To do this we need to
keep track of all the Names in scope, and the LocalRdrEnv does just that;
we consult it with RdrName.inLocalRdrEnvScope.

There is another wrinkle.  With TH and -XDataKinds, consider
   $( [d| data Nat = Zero
          data T = MkT (Proxy 'Zero)  |] )
After splicing, but before renaming we get this:
   data Nat_77{tc} = Zero_78{d}
   data T_79{tc} = MkT_80{d} (Proxy 'Zero_78{tc})  |] )
The occurrence of 'Zero in the data type for T has the right unique,
but it has a TcClsName name-space in its OccName.  (This is set by
the ctxt_ns argument of Convert.thRdrName.)  When we check that is
in scope in the GlobalRdrEnv, we need to look up the DataName namespace
too.  (An alternative would be to make the GlobalRdrEnv also have
a Name -&gt; GRE mapping.)

Note [Template Haskell ambiguity]
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
The GlobalRdrEnv invariant says that if
  occ -&gt; [gre1, ..., gren]
then the gres have distinct Names (INVARIANT 1 of GlobalRdrEnv).
This is guaranteed by extendGlobalRdrEnvRn (the dups check in add_gre).

So how can we get multiple gres in lookupExactOcc_maybe?  Because in
TH we might use the same TH NameU in two different name spaces.
eg (#7241):
   $(newName &quot;Foo&quot; &gt;&gt;= \o -&gt; return [DataD [] o [] [RecC o []] [''Show]])
Here we generate a type constructor and data constructor with the same
unique, but different name spaces.

It'd be nicer to rule this out in extendGlobalRdrEnvRn, but that would
mean looking up the OccName in every name-space, just in case, and that
seems a bit brutal.  So it's just done here on lookup.  But we might
need to revisit that choice.

Note [Usage for sub-bndrs]
~~~~~~~~~~~~~~~~~~~~~~~~~~
If you have this
   import qualified M( C( f ) )
   instance M.C T where
     f x = x
then is the qualified import M.f used?  Obviously yes.
But the RdrName used in the instance decl is unqualified.  In effect,
we fill in the qualification by looking for f's whose class is M.C
But when adding to the UsedRdrNames we must make that qualification
explicit (saying &quot;used  M.f&quot;), otherwise we get &quot;Redundant import of M.f&quot;.

So we make up a suitable (fake) RdrName.  But be careful
   import qualified M
   import M( C(f) )
   instance C T where
     f x = x
Here we want to record a use of 'f', not of 'M.f', otherwise
we'll miss the fact that the qualified import is redundant.

--------------------------------------------------
--              Occurrences
--------------------------------------------------
-}</span><span>
</span><span id="line-995"></span><span>
</span><span id="line-996"></span><span>
</span><span id="line-997"></span><span id="local-6989586621683035654"><span class="annot"><a href="GHC.Rename.Env.html#lookupLocatedOccRn"><span class="hs-identifier hs-type">lookupLocatedOccRn</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Types.SrcLoc.html#GenLocated"><span class="hs-identifier hs-type">GenLocated</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Parser.Annotation.html#EpAnn"><span class="hs-identifier hs-type">EpAnn</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683035654"><span class="hs-identifier hs-type">ann</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><a href="GHC.Types.Name.Reader.html#RdrName"><span class="hs-identifier hs-type">RdrName</span></a></span><span>
</span><span id="line-998"></span><span>                   </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#TcRn"><span class="hs-identifier hs-type">TcRn</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Types.SrcLoc.html#GenLocated"><span class="hs-identifier hs-type">GenLocated</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Parser.Annotation.html#EpAnn"><span class="hs-identifier hs-type">EpAnn</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683035654"><span class="hs-identifier hs-type">ann</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><a href="GHC.Types.Name.html#Name"><span class="hs-identifier hs-type">Name</span></a></span><span class="hs-special">)</span></span><span>
</span><span id="line-999"></span><span id="lookupLocatedOccRn"><span class="annot"><span class="annottext">lookupLocatedOccRn :: forall ann.
GenLocated (EpAnn ann) RdrName
-&gt; TcRn (GenLocated (EpAnn ann) Name)
</span><a href="GHC.Rename.Env.html#lookupLocatedOccRn"><span class="hs-identifier hs-var hs-var">lookupLocatedOccRn</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(RdrName -&gt; RnM Name)
-&gt; GenLocated (EpAnn ann) RdrName
-&gt; TcRn (GenLocated (EpAnn ann) Name)
forall a b ann.
(a -&gt; TcM b)
-&gt; GenLocated (EpAnn ann) a -&gt; TcRn (GenLocated (EpAnn ann) b)
</span><a href="GHC.Tc.Utils.Monad.html#wrapLocMA"><span class="hs-identifier hs-var">wrapLocMA</span></a></span><span> </span><span class="annot"><span class="annottext">RdrName -&gt; RnM Name
</span><a href="GHC.Rename.Env.html#lookupOccRn"><span class="hs-identifier hs-var">lookupOccRn</span></a></span><span>
</span><span id="line-1000"></span><span>
</span><span id="line-1001"></span><span id="local-6989586621683034564"><span class="annot"><a href="GHC.Rename.Env.html#lookupLocatedOccRnConstr"><span class="hs-identifier hs-type">lookupLocatedOccRnConstr</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Types.SrcLoc.html#GenLocated"><span class="hs-identifier hs-type">GenLocated</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Parser.Annotation.html#EpAnn"><span class="hs-identifier hs-type">EpAnn</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683034564"><span class="hs-identifier hs-type">ann</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><a href="GHC.Types.Name.Reader.html#RdrName"><span class="hs-identifier hs-type">RdrName</span></a></span><span>
</span><span id="line-1002"></span><span>                         </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#TcRn"><span class="hs-identifier hs-type">TcRn</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Types.SrcLoc.html#GenLocated"><span class="hs-identifier hs-type">GenLocated</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Parser.Annotation.html#EpAnn"><span class="hs-identifier hs-type">EpAnn</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683034564"><span class="hs-identifier hs-type">ann</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><a href="GHC.Types.Name.html#Name"><span class="hs-identifier hs-type">Name</span></a></span><span class="hs-special">)</span></span><span>
</span><span id="line-1003"></span><span id="lookupLocatedOccRnConstr"><span class="annot"><span class="annottext">lookupLocatedOccRnConstr :: forall ann.
GenLocated (EpAnn ann) RdrName
-&gt; TcRn (GenLocated (EpAnn ann) Name)
</span><a href="GHC.Rename.Env.html#lookupLocatedOccRnConstr"><span class="hs-identifier hs-var hs-var">lookupLocatedOccRnConstr</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(RdrName -&gt; RnM Name)
-&gt; GenLocated (EpAnn ann) RdrName
-&gt; TcRn (GenLocated (EpAnn ann) Name)
forall a b ann.
(a -&gt; TcM b)
-&gt; GenLocated (EpAnn ann) a -&gt; TcRn (GenLocated (EpAnn ann) b)
</span><a href="GHC.Tc.Utils.Monad.html#wrapLocMA"><span class="hs-identifier hs-var">wrapLocMA</span></a></span><span> </span><span class="annot"><span class="annottext">RdrName -&gt; RnM Name
</span><a href="GHC.Rename.Env.html#lookupOccRnConstr"><span class="hs-identifier hs-var">lookupOccRnConstr</span></a></span><span>
</span><span id="line-1004"></span><span>
</span><span id="line-1005"></span><span id="local-6989586621683035656"><span class="annot"><a href="GHC.Rename.Env.html#lookupLocatedOccRnRecField"><span class="hs-identifier hs-type">lookupLocatedOccRnRecField</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Types.SrcLoc.html#GenLocated"><span class="hs-identifier hs-type">GenLocated</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Parser.Annotation.html#EpAnn"><span class="hs-identifier hs-type">EpAnn</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683035656"><span class="hs-identifier hs-type">ann</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><a href="GHC.Types.Name.Reader.html#RdrName"><span class="hs-identifier hs-type">RdrName</span></a></span><span>
</span><span id="line-1006"></span><span>                           </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#TcRn"><span class="hs-identifier hs-type">TcRn</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Types.SrcLoc.html#GenLocated"><span class="hs-identifier hs-type">GenLocated</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Parser.Annotation.html#EpAnn"><span class="hs-identifier hs-type">EpAnn</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683035656"><span class="hs-identifier hs-type">ann</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><a href="GHC.Types.Name.html#Name"><span class="hs-identifier hs-type">Name</span></a></span><span class="hs-special">)</span></span><span>
</span><span id="line-1007"></span><span id="lookupLocatedOccRnRecField"><span class="annot"><span class="annottext">lookupLocatedOccRnRecField :: forall ann.
GenLocated (EpAnn ann) RdrName
-&gt; TcRn (GenLocated (EpAnn ann) Name)
</span><a href="GHC.Rename.Env.html#lookupLocatedOccRnRecField"><span class="hs-identifier hs-var hs-var">lookupLocatedOccRnRecField</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(RdrName -&gt; RnM Name)
-&gt; GenLocated (EpAnn ann) RdrName
-&gt; TcRn (GenLocated (EpAnn ann) Name)
forall a b ann.
(a -&gt; TcM b)
-&gt; GenLocated (EpAnn ann) a -&gt; TcRn (GenLocated (EpAnn ann) b)
</span><a href="GHC.Tc.Utils.Monad.html#wrapLocMA"><span class="hs-identifier hs-var">wrapLocMA</span></a></span><span> </span><span class="annot"><span class="annottext">RdrName -&gt; RnM Name
</span><a href="GHC.Rename.Env.html#lookupOccRnRecField"><span class="hs-identifier hs-var">lookupOccRnRecField</span></a></span><span>
</span><span id="line-1008"></span><span>
</span><span id="line-1009"></span><span id="local-6989586621683035658"><span class="annot"><a href="GHC.Rename.Env.html#lookupLocatedOccRnNone"><span class="hs-identifier hs-type">lookupLocatedOccRnNone</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Types.SrcLoc.html#GenLocated"><span class="hs-identifier hs-type">GenLocated</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Parser.Annotation.html#EpAnn"><span class="hs-identifier hs-type">EpAnn</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683035658"><span class="hs-identifier hs-type">ann</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><a href="GHC.Types.Name.Reader.html#RdrName"><span class="hs-identifier hs-type">RdrName</span></a></span><span>
</span><span id="line-1010"></span><span>                       </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#TcRn"><span class="hs-identifier hs-type">TcRn</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Types.SrcLoc.html#GenLocated"><span class="hs-identifier hs-type">GenLocated</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Parser.Annotation.html#EpAnn"><span class="hs-identifier hs-type">EpAnn</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683035658"><span class="hs-identifier hs-type">ann</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><a href="GHC.Types.Name.html#Name"><span class="hs-identifier hs-type">Name</span></a></span><span class="hs-special">)</span></span><span>
</span><span id="line-1011"></span><span id="lookupLocatedOccRnNone"><span class="annot"><span class="annottext">lookupLocatedOccRnNone :: forall ann.
GenLocated (EpAnn ann) RdrName
-&gt; TcRn (GenLocated (EpAnn ann) Name)
</span><a href="GHC.Rename.Env.html#lookupLocatedOccRnNone"><span class="hs-identifier hs-var hs-var">lookupLocatedOccRnNone</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(RdrName -&gt; RnM Name)
-&gt; GenLocated (EpAnn ann) RdrName
-&gt; TcRn (GenLocated (EpAnn ann) Name)
forall a b ann.
(a -&gt; TcM b)
-&gt; GenLocated (EpAnn ann) a -&gt; TcRn (GenLocated (EpAnn ann) b)
</span><a href="GHC.Tc.Utils.Monad.html#wrapLocMA"><span class="hs-identifier hs-var">wrapLocMA</span></a></span><span> </span><span class="annot"><span class="annottext">RdrName -&gt; RnM Name
</span><a href="GHC.Rename.Env.html#lookupOccRnNone"><span class="hs-identifier hs-var">lookupOccRnNone</span></a></span><span>
</span><span id="line-1012"></span><span>
</span><span id="line-1013"></span><span class="annot"><a href="GHC.Rename.Env.html#lookupLocalOccRn_maybe"><span class="hs-identifier hs-type">lookupLocalOccRn_maybe</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Types.Name.Reader.html#RdrName"><span class="hs-identifier hs-type">RdrName</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#RnM"><span class="hs-identifier hs-type">RnM</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Maybe</span></span><span> </span><span class="annot"><a href="GHC.Types.Name.html#Name"><span class="hs-identifier hs-type">Name</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1014"></span><span class="hs-comment">-- Just look in the local environment</span><span>
</span><span id="line-1015"></span><span id="lookupLocalOccRn_maybe"><span class="annot"><span class="annottext">lookupLocalOccRn_maybe :: RdrName -&gt; RnM (Maybe Name)
</span><a href="GHC.Rename.Env.html#lookupLocalOccRn_maybe"><span class="hs-identifier hs-var hs-var">lookupLocalOccRn_maybe</span></a></span></span><span> </span><span id="local-6989586621683035660"><span class="annot"><span class="annottext">RdrName
</span><a href="#local-6989586621683035660"><span class="hs-identifier hs-var">rdr_name</span></a></span></span><span>
</span><span id="line-1016"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span id="local-6989586621683035661"><span class="annot"><a href="#local-6989586621683035661"><span class="hs-identifier hs-var">local_env</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">RnM LocalRdrEnv
</span><a href="GHC.Tc.Utils.Monad.html#getLocalRdrEnv"><span class="hs-identifier hs-var">getLocalRdrEnv</span></a></span><span>
</span><span id="line-1017"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">return</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Types.Name.Reader.html#lookupLocalRdrEnv"><span class="hs-identifier hs-type">lookupLocalRdrEnv</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683035661"><span class="hs-identifier hs-type">local_env</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683035660"><span class="hs-identifier hs-type">rdr_name</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-1018"></span><span>
</span><span id="line-1019"></span><span class="annot"><a href="GHC.Rename.Env.html#lookupLocalOccThLvl_maybe"><span class="hs-identifier hs-type">lookupLocalOccThLvl_maybe</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Types.Name.html#Name"><span class="hs-identifier hs-type">Name</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#RnM"><span class="hs-identifier hs-type">RnM</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Maybe</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Types.Basic.html#TopLevelFlag"><span class="hs-identifier hs-type">TopLevelFlag</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Tc.Types.TH.html#ThLevel"><span class="hs-identifier hs-type">ThLevel</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-1020"></span><span class="hs-comment">-- Just look in the local environment</span><span>
</span><span id="line-1021"></span><span id="lookupLocalOccThLvl_maybe"><span class="annot"><span class="annottext">lookupLocalOccThLvl_maybe :: Name -&gt; RnM (Maybe (TopLevelFlag, Arity))
</span><a href="GHC.Rename.Env.html#lookupLocalOccThLvl_maybe"><span class="hs-identifier hs-var hs-var">lookupLocalOccThLvl_maybe</span></a></span></span><span> </span><span id="local-6989586621683035664"><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621683035664"><span class="hs-identifier hs-var">name</span></a></span></span><span>
</span><span id="line-1022"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span id="local-6989586621683035665"><span class="annot"><a href="#local-6989586621683035665"><span class="hs-identifier hs-var">lcl_env</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">TcRnIf TcGblEnv TcLclEnv TcLclEnv
forall gbl lcl. TcRnIf gbl lcl lcl
</span><a href="GHC.Tc.Utils.Monad.html#getLclEnv"><span class="hs-identifier hs-var">getLclEnv</span></a></span><span>
</span><span id="line-1023"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">return</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Types.Name.Env.html#lookupNameEnv"><span class="hs-identifier hs-type">lookupNameEnv</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Tc.Types.LclEnv.html#getLclEnvThBndrs"><span class="hs-identifier hs-type">getLclEnvThBndrs</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683035665"><span class="hs-identifier hs-type">lcl_env</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><a href="#local-6989586621683035664"><span class="hs-identifier hs-type">name</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-1024"></span><span>
</span><span id="line-1025"></span><span class="hs-comment">-- lookupOccRn' looks up an occurrence of a RdrName, and uses its argument to</span><span>
</span><span id="line-1026"></span><span class="hs-comment">-- determine what kind of suggestions should be displayed if it is not in scope</span><span>
</span><span id="line-1027"></span><span class="annot"><a href="GHC.Rename.Env.html#lookupOccRn%27"><span class="hs-identifier hs-type">lookupOccRn'</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Rename.Unbound.html#WhatLooking"><span class="hs-identifier hs-type">WhatLooking</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Types.Name.Reader.html#RdrName"><span class="hs-identifier hs-type">RdrName</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#RnM"><span class="hs-identifier hs-type">RnM</span></a></span><span> </span><span class="annot"><a href="GHC.Types.Name.html#Name"><span class="hs-identifier hs-type">Name</span></a></span><span>
</span><span id="line-1028"></span><span id="lookupOccRn%27"><span class="annot"><span class="annottext">lookupOccRn' :: WhatLooking -&gt; RdrName -&gt; RnM Name
</span><a href="GHC.Rename.Env.html#lookupOccRn%27"><span class="hs-identifier hs-var hs-var">lookupOccRn'</span></a></span></span><span> </span><span id="local-6989586621683035670"><span class="annot"><span class="annottext">WhatLooking
</span><a href="#local-6989586621683035670"><span class="hs-identifier hs-var">which_suggest</span></a></span></span><span> </span><span id="local-6989586621683035671"><span class="annot"><span class="annottext">RdrName
</span><a href="#local-6989586621683035671"><span class="hs-identifier hs-var">rdr_name</span></a></span></span><span>
</span><span id="line-1029"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span id="local-6989586621683035672"><span class="annot"><a href="#local-6989586621683035672"><span class="hs-identifier hs-var">mb_gre</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">RdrName -&gt; RnM (Maybe GlobalRdrElt)
</span><a href="GHC.Rename.Env.html#lookupOccRn_maybe"><span class="hs-identifier hs-var">lookupOccRn_maybe</span></a></span><span> </span><span class="annot"><span class="annottext">RdrName
</span><a href="#local-6989586621683035671"><span class="hs-identifier hs-var">rdr_name</span></a></span><span>
</span><span id="line-1030"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><a href="#local-6989586621683035672"><span class="hs-identifier hs-type">mb_gre</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-1031"></span><span>           </span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span id="local-6989586621683035673"><span class="annot"><span class="annottext">GlobalRdrElt
</span><a href="#local-6989586621683035673"><span class="hs-identifier hs-var">gre</span></a></span></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Name -&gt; RnM Name
forall a. a -&gt; IOEnv (Env TcGblEnv TcLclEnv) a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="annot"><span class="annottext">(Name -&gt; RnM Name) -&gt; Name -&gt; RnM Name
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">GlobalRdrElt -&gt; Name
forall info. GlobalRdrEltX info -&gt; Name
</span><a href="GHC.Types.Name.Reader.html#greName"><span class="hs-identifier hs-var">greName</span></a></span><span> </span><span class="annot"><span class="annottext">GlobalRdrElt
</span><a href="#local-6989586621683035673"><span class="hs-identifier hs-var">gre</span></a></span><span>
</span><span id="line-1032"></span><span>           </span><span class="annot"><span class="annottext">Maybe GlobalRdrElt
</span><span class="hs-identifier hs-var">Nothing</span></span><span>   </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">WhatLooking -&gt; RdrName -&gt; RnM Name
</span><a href="GHC.Rename.Unbound.html#reportUnboundName%27"><span class="hs-identifier hs-var">reportUnboundName'</span></a></span><span> </span><span class="annot"><span class="annottext">WhatLooking
</span><a href="#local-6989586621683035670"><span class="hs-identifier hs-var">which_suggest</span></a></span><span> </span><span class="annot"><span class="annottext">RdrName
</span><a href="#local-6989586621683035671"><span class="hs-identifier hs-var">rdr_name</span></a></span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-1033"></span><span>
</span><span id="line-1034"></span><span class="hs-comment">-- lookupOccRn looks up an occurrence of a RdrName and displays suggestions if</span><span>
</span><span id="line-1035"></span><span class="hs-comment">-- it is not in scope</span><span>
</span><span id="line-1036"></span><span class="annot"><a href="GHC.Rename.Env.html#lookupOccRn"><span class="hs-identifier hs-type">lookupOccRn</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Types.Name.Reader.html#RdrName"><span class="hs-identifier hs-type">RdrName</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#RnM"><span class="hs-identifier hs-type">RnM</span></a></span><span> </span><span class="annot"><a href="GHC.Types.Name.html#Name"><span class="hs-identifier hs-type">Name</span></a></span><span>
</span><span id="line-1037"></span><span id="lookupOccRn"><span class="annot"><span class="annottext">lookupOccRn :: RdrName -&gt; RnM Name
</span><a href="GHC.Rename.Env.html#lookupOccRn"><span class="hs-identifier hs-var hs-var">lookupOccRn</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">WhatLooking -&gt; RdrName -&gt; RnM Name
</span><a href="GHC.Rename.Env.html#lookupOccRn%27"><span class="hs-identifier hs-var">lookupOccRn'</span></a></span><span> </span><span class="annot"><span class="annottext">WhatLooking
</span><a href="GHC.Rename.Unbound.html#WL_Anything"><span class="hs-identifier hs-var">WL_Anything</span></a></span><span>
</span><span id="line-1038"></span><span>
</span><span id="line-1039"></span><span class="hs-comment">-- | Look up an occurrence of a 'RdrName'.</span><span>
</span><span id="line-1040"></span><span class="hs-comment">--</span><span>
</span><span id="line-1041"></span><span class="hs-comment">-- Displays constructors and pattern synonyms as suggestions if</span><span>
</span><span id="line-1042"></span><span class="hs-comment">-- it is not in scope.</span><span>
</span><span id="line-1043"></span><span class="hs-comment">--</span><span>
</span><span id="line-1044"></span><span class="hs-comment">-- See Note [lookupOccRnConstr]</span><span>
</span><span id="line-1045"></span><span class="annot"><a href="GHC.Rename.Env.html#lookupOccRnConstr"><span class="hs-identifier hs-type">lookupOccRnConstr</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Types.Name.Reader.html#RdrName"><span class="hs-identifier hs-type">RdrName</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#RnM"><span class="hs-identifier hs-type">RnM</span></a></span><span> </span><span class="annot"><a href="GHC.Types.Name.html#Name"><span class="hs-identifier hs-type">Name</span></a></span><span>
</span><span id="line-1046"></span><span id="lookupOccRnConstr"><span class="annot"><span class="annottext">lookupOccRnConstr :: RdrName -&gt; RnM Name
</span><a href="GHC.Rename.Env.html#lookupOccRnConstr"><span class="hs-identifier hs-var hs-var">lookupOccRnConstr</span></a></span></span><span> </span><span id="local-6989586621683035675"><span class="annot"><span class="annottext">RdrName
</span><a href="#local-6989586621683035675"><span class="hs-identifier hs-var">rdr_name</span></a></span></span><span>
</span><span id="line-1047"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span id="local-6989586621683035676"><span class="annot"><a href="#local-6989586621683035676"><span class="hs-identifier hs-var">mb_gre</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">RdrName -&gt; RnM (Maybe GlobalRdrElt)
</span><a href="GHC.Rename.Env.html#lookupOccRn_maybe"><span class="hs-identifier hs-var">lookupOccRn_maybe</span></a></span><span> </span><span class="annot"><span class="annottext">RdrName
</span><a href="#local-6989586621683035675"><span class="hs-identifier hs-var">rdr_name</span></a></span><span>
</span><span id="line-1048"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><a href="#local-6989586621683035676"><span class="hs-identifier hs-type">mb_gre</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-1049"></span><span>           </span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span id="local-6989586621683035677"><span class="annot"><span class="annottext">GlobalRdrElt
</span><a href="#local-6989586621683035677"><span class="hs-identifier hs-var">gre</span></a></span></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Name -&gt; RnM Name
forall a. a -&gt; IOEnv (Env TcGblEnv TcLclEnv) a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="annot"><span class="annottext">(Name -&gt; RnM Name) -&gt; Name -&gt; RnM Name
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">GlobalRdrElt -&gt; Name
forall info. GlobalRdrEltX info -&gt; Name
</span><a href="GHC.Types.Name.Reader.html#greName"><span class="hs-identifier hs-var">greName</span></a></span><span> </span><span class="annot"><span class="annottext">GlobalRdrElt
</span><a href="#local-6989586621683035677"><span class="hs-identifier hs-var">gre</span></a></span><span>
</span><span id="line-1050"></span><span>           </span><span class="annot"><span class="annottext">Maybe GlobalRdrElt
</span><span class="hs-identifier hs-var">Nothing</span></span><span>   </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-1051"></span><span>            </span><span class="hs-special">{</span><span> </span><span id="local-6989586621683035678"><span class="annot"><a href="#local-6989586621683035678"><span class="hs-identifier hs-var">mb_ty_gre</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">RdrName -&gt; RnM (Maybe GlobalRdrElt)
</span><a href="GHC.Rename.Env.html#lookup_promoted"><span class="hs-identifier hs-var">lookup_promoted</span></a></span><span> </span><span class="annot"><span class="annottext">RdrName
</span><a href="#local-6989586621683035675"><span class="hs-identifier hs-var">rdr_name</span></a></span><span>
</span><span id="line-1052"></span><span>            </span><span class="hs-special">;</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><a href="#local-6989586621683035678"><span class="hs-identifier hs-type">mb_ty_gre</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-1053"></span><span>              </span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span id="local-6989586621683035680"><span class="annot"><span class="annottext">GlobalRdrElt
</span><a href="#local-6989586621683035680"><span class="hs-identifier hs-var">gre</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Name -&gt; RnM Name
forall a. a -&gt; IOEnv (Env TcGblEnv TcLclEnv) a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="annot"><span class="annottext">(Name -&gt; RnM Name) -&gt; Name -&gt; RnM Name
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">GlobalRdrElt -&gt; Name
forall info. GlobalRdrEltX info -&gt; Name
</span><a href="GHC.Types.Name.Reader.html#greName"><span class="hs-identifier hs-var">greName</span></a></span><span> </span><span class="annot"><span class="annottext">GlobalRdrElt
</span><a href="#local-6989586621683035680"><span class="hs-identifier hs-var">gre</span></a></span><span>
</span><span id="line-1054"></span><span>              </span><span class="annot"><span class="annottext">Maybe GlobalRdrElt
</span><span class="hs-identifier hs-var">Nothing</span></span><span> </span><span class="hs-glyph">-&gt;</span><span>  </span><span class="annot"><span class="annottext">WhatLooking -&gt; RdrName -&gt; RnM Name
</span><a href="GHC.Rename.Unbound.html#reportUnboundName%27"><span class="hs-identifier hs-var">reportUnboundName'</span></a></span><span> </span><span class="annot"><span class="annottext">WhatLooking
</span><a href="GHC.Rename.Unbound.html#WL_Constructor"><span class="hs-identifier hs-var">WL_Constructor</span></a></span><span> </span><span class="annot"><span class="annottext">RdrName
</span><a href="#local-6989586621683035675"><span class="hs-identifier hs-var">rdr_name</span></a></span><span class="hs-special">}</span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-1055"></span><span>
</span><span id="line-1056"></span><span class="hs-comment">{- Note [lookupOccRnConstr]
~~~~~~~~~~~~~~~~~~~~~~~~~~~
lookupOccRnConstr looks up a data constructor or pattern synonym. Simple.

However, there is a fallback to the type level when the lookup fails.
This is required to implement a pat-to-type transformation
(See Note [Pattern to type (P2T) conversion] in GHC.Tc.Gen.Pat)

Consider this example:

  data VisProxy a where VP :: forall a -&gt; VisProxy a

  f :: VisProxy Int -&gt; ()
  f (VP Int) = ()

Here `Int` is actually a type, but it occurs in a position in which we expect
a data constructor.

In all other cases we just use this additional lookup for better
error messaging (See Note [Promotion]).
-}</span><span>
</span><span id="line-1077"></span><span>
</span><span id="line-1078"></span><span class="hs-comment">-- lookupOccRnRecField looks up an occurrence of a RdrName and displays</span><span>
</span><span id="line-1079"></span><span class="hs-comment">-- record fields as suggestions if it is not in scope</span><span>
</span><span id="line-1080"></span><span class="annot"><a href="GHC.Rename.Env.html#lookupOccRnRecField"><span class="hs-identifier hs-type">lookupOccRnRecField</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Types.Name.Reader.html#RdrName"><span class="hs-identifier hs-type">RdrName</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#RnM"><span class="hs-identifier hs-type">RnM</span></a></span><span> </span><span class="annot"><a href="GHC.Types.Name.html#Name"><span class="hs-identifier hs-type">Name</span></a></span><span>
</span><span id="line-1081"></span><span id="lookupOccRnRecField"><span class="annot"><span class="annottext">lookupOccRnRecField :: RdrName -&gt; RnM Name
</span><a href="GHC.Rename.Env.html#lookupOccRnRecField"><span class="hs-identifier hs-var hs-var">lookupOccRnRecField</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">WhatLooking -&gt; RdrName -&gt; RnM Name
</span><a href="GHC.Rename.Env.html#lookupOccRn%27"><span class="hs-identifier hs-var">lookupOccRn'</span></a></span><span> </span><span class="annot"><span class="annottext">WhatLooking
</span><a href="GHC.Rename.Unbound.html#WL_RecField"><span class="hs-identifier hs-var">WL_RecField</span></a></span><span>
</span><span id="line-1082"></span><span>
</span><span id="line-1083"></span><span class="hs-comment">-- lookupOccRnRecField looks up an occurrence of a RdrName and displays</span><span>
</span><span id="line-1084"></span><span class="hs-comment">-- no suggestions if it is not in scope</span><span>
</span><span id="line-1085"></span><span class="annot"><a href="GHC.Rename.Env.html#lookupOccRnNone"><span class="hs-identifier hs-type">lookupOccRnNone</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Types.Name.Reader.html#RdrName"><span class="hs-identifier hs-type">RdrName</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#RnM"><span class="hs-identifier hs-type">RnM</span></a></span><span> </span><span class="annot"><a href="GHC.Types.Name.html#Name"><span class="hs-identifier hs-type">Name</span></a></span><span>
</span><span id="line-1086"></span><span id="lookupOccRnNone"><span class="annot"><span class="annottext">lookupOccRnNone :: RdrName -&gt; RnM Name
</span><a href="GHC.Rename.Env.html#lookupOccRnNone"><span class="hs-identifier hs-var hs-var">lookupOccRnNone</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">WhatLooking -&gt; RdrName -&gt; RnM Name
</span><a href="GHC.Rename.Env.html#lookupOccRn%27"><span class="hs-identifier hs-var">lookupOccRn'</span></a></span><span> </span><span class="annot"><span class="annottext">WhatLooking
</span><a href="GHC.Rename.Unbound.html#WL_None"><span class="hs-identifier hs-var">WL_None</span></a></span><span>
</span><span id="line-1087"></span><span>
</span><span id="line-1088"></span><span class="hs-comment">-- Only used in one place, to rename pattern synonym binders.</span><span>
</span><span id="line-1089"></span><span class="hs-comment">-- See Note [Renaming pattern synonym variables] in GHC.Rename.Bind</span><span>
</span><span id="line-1090"></span><span class="annot"><a href="GHC.Rename.Env.html#lookupLocalOccRn"><span class="hs-identifier hs-type">lookupLocalOccRn</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Types.Name.Reader.html#RdrName"><span class="hs-identifier hs-type">RdrName</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#RnM"><span class="hs-identifier hs-type">RnM</span></a></span><span> </span><span class="annot"><a href="GHC.Types.Name.html#Name"><span class="hs-identifier hs-type">Name</span></a></span><span>
</span><span id="line-1091"></span><span id="lookupLocalOccRn"><span class="annot"><span class="annottext">lookupLocalOccRn :: RdrName -&gt; RnM Name
</span><a href="GHC.Rename.Env.html#lookupLocalOccRn"><span class="hs-identifier hs-var hs-var">lookupLocalOccRn</span></a></span></span><span> </span><span id="local-6989586621683035683"><span class="annot"><span class="annottext">RdrName
</span><a href="#local-6989586621683035683"><span class="hs-identifier hs-var">rdr_name</span></a></span></span><span>
</span><span id="line-1092"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span id="local-6989586621683035684"><span class="annot"><a href="#local-6989586621683035684"><span class="hs-identifier hs-var">mb_name</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">RdrName -&gt; RnM (Maybe Name)
</span><a href="GHC.Rename.Env.html#lookupLocalOccRn_maybe"><span class="hs-identifier hs-var">lookupLocalOccRn_maybe</span></a></span><span> </span><span class="annot"><span class="annottext">RdrName
</span><a href="#local-6989586621683035683"><span class="hs-identifier hs-var">rdr_name</span></a></span><span>
</span><span id="line-1093"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><a href="#local-6989586621683035684"><span class="hs-identifier hs-type">mb_name</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-1094"></span><span>           </span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span id="local-6989586621683035685"><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621683035685"><span class="hs-identifier hs-var">name</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Name -&gt; RnM Name
forall a. a -&gt; IOEnv (Env TcGblEnv TcLclEnv) a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621683035685"><span class="hs-identifier hs-var">name</span></a></span><span>
</span><span id="line-1095"></span><span>           </span><span class="annot"><span class="annottext">Maybe Name
</span><span class="hs-identifier hs-var">Nothing</span></span><span>   </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">LookingFor -&gt; RdrName -&gt; RnM Name
</span><a href="GHC.Rename.Unbound.html#unboundName"><span class="hs-identifier hs-var">unboundName</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">WhatLooking -&gt; WhereLooking -&gt; LookingFor
</span><a href="GHC.Rename.Unbound.html#LF"><span class="hs-identifier hs-var">LF</span></a></span><span> </span><span class="annot"><span class="annottext">WhatLooking
</span><a href="GHC.Rename.Unbound.html#WL_Anything"><span class="hs-identifier hs-var">WL_Anything</span></a></span><span> </span><span class="annot"><span class="annottext">WhereLooking
</span><a href="GHC.Rename.Unbound.html#WL_LocalOnly"><span class="hs-identifier hs-var">WL_LocalOnly</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">RdrName
</span><a href="#local-6989586621683035683"><span class="hs-identifier hs-var">rdr_name</span></a></span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-1096"></span><span>
</span><span id="line-1097"></span><span class="hs-comment">-- lookupTypeOccRn looks up an optionally promoted RdrName.</span><span>
</span><span id="line-1098"></span><span class="hs-comment">-- Used for looking up type variables.</span><span>
</span><span id="line-1099"></span><span class="annot"><a href="GHC.Rename.Env.html#lookupTypeOccRn"><span class="hs-identifier hs-type">lookupTypeOccRn</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Types.Name.Reader.html#RdrName"><span class="hs-identifier hs-type">RdrName</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#RnM"><span class="hs-identifier hs-type">RnM</span></a></span><span> </span><span class="annot"><a href="GHC.Types.Name.html#Name"><span class="hs-identifier hs-type">Name</span></a></span><span>
</span><span id="line-1100"></span><span class="hs-comment">-- see Note [Demotion]</span><span>
</span><span id="line-1101"></span><span id="lookupTypeOccRn"><span class="annot"><span class="annottext">lookupTypeOccRn :: RdrName -&gt; RnM Name
</span><a href="GHC.Rename.Env.html#lookupTypeOccRn"><span class="hs-identifier hs-var hs-var">lookupTypeOccRn</span></a></span></span><span> </span><span id="local-6989586621683035687"><span class="annot"><span class="annottext">RdrName
</span><a href="#local-6989586621683035687"><span class="hs-identifier hs-var">rdr_name</span></a></span></span><span>
</span><span id="line-1102"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span id="local-6989586621683035688"><span class="annot"><a href="#local-6989586621683035688"><span class="hs-identifier hs-var">mb_gre</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">RdrName -&gt; RnM (Maybe GlobalRdrElt)
</span><a href="GHC.Rename.Env.html#lookupOccRn_maybe"><span class="hs-identifier hs-var">lookupOccRn_maybe</span></a></span><span> </span><span class="annot"><span class="annottext">RdrName
</span><a href="#local-6989586621683035687"><span class="hs-identifier hs-var">rdr_name</span></a></span><span>
</span><span id="line-1103"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><a href="#local-6989586621683035688"><span class="hs-identifier hs-type">mb_gre</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-1104"></span><span>             </span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span id="local-6989586621683035689"><span class="annot"><span class="annottext">GlobalRdrElt
</span><a href="#local-6989586621683035689"><span class="hs-identifier hs-var">gre</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Name -&gt; RnM Name
forall a. a -&gt; IOEnv (Env TcGblEnv TcLclEnv) a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="annot"><span class="annottext">(Name -&gt; RnM Name) -&gt; Name -&gt; RnM Name
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">GlobalRdrElt -&gt; Name
forall info. GlobalRdrEltX info -&gt; Name
</span><a href="GHC.Types.Name.Reader.html#greName"><span class="hs-identifier hs-var">greName</span></a></span><span> </span><span class="annot"><span class="annottext">GlobalRdrElt
</span><a href="#local-6989586621683035689"><span class="hs-identifier hs-var">gre</span></a></span><span>
</span><span id="line-1105"></span><span>             </span><span class="annot"><span class="annottext">Maybe GlobalRdrElt
</span><span class="hs-identifier hs-var">Nothing</span></span><span>   </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-1106"></span><span>               </span><span class="hs-keyword">if</span><span> </span><span class="annot"><span class="annottext">RdrName -&gt; OccName
forall name. HasOccName name =&gt; name -&gt; OccName
</span><a href="GHC.Types.Name.Occurrence.html#occName"><span class="hs-identifier hs-var">occName</span></a></span><span> </span><span class="annot"><span class="annottext">RdrName
</span><a href="#local-6989586621683035687"><span class="hs-identifier hs-var">rdr_name</span></a></span><span> </span><span class="annot"><span class="annottext">OccName -&gt; OccName -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">==</span></span><span> </span><span class="annot"><span class="annottext">RdrName -&gt; OccName
forall name. HasOccName name =&gt; name -&gt; OccName
</span><a href="GHC.Types.Name.Occurrence.html#occName"><span class="hs-identifier hs-var">occName</span></a></span><span> </span><span class="annot"><span class="annottext">RdrName
</span><a href="GHC.Builtin.Types.html#eqTyCon_RDR"><span class="hs-identifier hs-var">eqTyCon_RDR</span></a></span><span> </span><span class="hs-comment">-- See Note [eqTyCon (~) compatibility fallback]</span><span>
</span><span id="line-1107"></span><span>               </span><span class="hs-keyword">then</span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="GHC.Builtin.Types.html#eqTyConName"><span class="hs-identifier hs-var">eqTyConName</span></a></span><span> </span><span class="annot"><span class="annottext">Name -&gt; IOEnv (Env TcGblEnv TcLclEnv) () -&gt; RnM Name
forall a b.
a
-&gt; IOEnv (Env TcGblEnv TcLclEnv) b
-&gt; IOEnv (Env TcGblEnv TcLclEnv) a
forall (f :: * -&gt; *) a b. Functor f =&gt; a -&gt; f b -&gt; f a
</span><span class="hs-operator hs-var">&lt;$</span></span><span> </span><span class="annot"><span class="annottext">TcRnMessage -&gt; IOEnv (Env TcGblEnv TcLclEnv) ()
</span><a href="GHC.Tc.Utils.Monad.html#addDiagnostic"><span class="hs-identifier hs-var">addDiagnostic</span></a></span><span> </span><span class="annot"><span class="annottext">TcRnMessage
</span><a href="GHC.Tc.Errors.Types.html#TcRnTypeEqualityOutOfScope"><span class="hs-identifier hs-var">TcRnTypeEqualityOutOfScope</span></a></span><span>
</span><span id="line-1108"></span><span>               </span><span class="hs-keyword">else</span><span> </span><span class="annot"><span class="annottext">RdrName -&gt; RnM Name
</span><a href="GHC.Rename.Env.html#lookup_demoted"><span class="hs-identifier hs-var">lookup_demoted</span></a></span><span> </span><span class="annot"><span class="annottext">RdrName
</span><a href="#local-6989586621683035687"><span class="hs-identifier hs-var">rdr_name</span></a></span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-1109"></span><span>
</span><span id="line-1110"></span><span class="hs-comment">{- Note [eqTyCon (~) compatibility fallback]
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
Before GHC Proposal #371, the (~) type operator used in type equality
constraints (a~b) was considered built-in syntax.

This had two implications:

1. Users could use it without importing it from Data.Type.Equality or Prelude.
2. TypeOperators were not required to use it (it was guarded behind TypeFamilies/GADTs instead)

To ease migration and minimize breakage, we continue to support those usages
but emit appropriate warnings.
-}</span><span>
</span><span id="line-1123"></span><span>
</span><span id="line-1124"></span><span class="hs-comment">-- Used when looking up a term name (varName or dataName) in a type</span><span>
</span><span id="line-1125"></span><span class="annot"><a href="GHC.Rename.Env.html#lookup_demoted"><span class="hs-identifier hs-type">lookup_demoted</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Types.Name.Reader.html#RdrName"><span class="hs-identifier hs-type">RdrName</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#RnM"><span class="hs-identifier hs-type">RnM</span></a></span><span> </span><span class="annot"><a href="GHC.Types.Name.html#Name"><span class="hs-identifier hs-type">Name</span></a></span><span>
</span><span id="line-1126"></span><span id="lookup_demoted"><span class="annot"><span class="annottext">lookup_demoted :: RdrName -&gt; RnM Name
</span><a href="GHC.Rename.Env.html#lookup_demoted"><span class="hs-identifier hs-var hs-var">lookup_demoted</span></a></span></span><span> </span><span id="local-6989586621683035697"><span class="annot"><span class="annottext">RdrName
</span><a href="#local-6989586621683035697"><span class="hs-identifier hs-var">rdr_name</span></a></span></span><span>
</span><span id="line-1127"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span id="local-6989586621683035698"><span class="annot"><span class="annottext">RdrName
</span><a href="#local-6989586621683035698"><span class="hs-identifier hs-var">demoted_rdr</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">RdrName -&gt; Maybe RdrName
</span><a href="GHC.Types.Name.Reader.html#demoteRdrName"><span class="hs-identifier hs-var">demoteRdrName</span></a></span><span> </span><span class="annot"><span class="annottext">RdrName
</span><a href="#local-6989586621683035697"><span class="hs-identifier hs-var">rdr_name</span></a></span><span>
</span><span id="line-1128"></span><span>    </span><span class="hs-comment">-- Maybe it's the name of a *data* constructor</span><span>
</span><span id="line-1129"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span id="local-6989586621683035700"><span class="annot"><a href="#local-6989586621683035700"><span class="hs-identifier hs-var">data_kinds</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Extension -&gt; TcRnIf TcGblEnv TcLclEnv Bool
forall gbl lcl. Extension -&gt; TcRnIf gbl lcl Bool
</span><a href="GHC.Tc.Utils.Monad.html#xoptM"><span class="hs-identifier hs-var">xoptM</span></a></span><span> </span><span class="annot"><span class="annottext">Extension
</span><span class="hs-identifier hs-var">LangExt.DataKinds</span></span><span>
</span><span id="line-1130"></span><span>       </span><span class="hs-special">;</span><span> </span><span id="local-6989586621683035702"><span class="annot"><a href="#local-6989586621683035702"><span class="hs-identifier hs-var">star_is_type</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.Monad.html#xoptM"><span class="hs-identifier hs-type">xoptM</span></a></span><span> </span><span class="annot"><span class="hs-identifier hs-type">LangExt.StarIsType</span></span><span>
</span><span id="line-1131"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621683035704"><span class="annot"><a href="#local-6989586621683035704"><span class="hs-identifier hs-var hs-var">is_star_type</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">if</span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621683035702"><span class="hs-identifier hs-var">star_is_type</span></a></span><span> </span><span class="hs-keyword">then</span><span> </span><span class="annot"><span class="annottext">StarIsType
</span><a href="GHC.Types.Hint.html#StarIsType"><span class="hs-identifier hs-var">StarIsType</span></a></span><span> </span><span class="hs-keyword">else</span><span> </span><span class="annot"><span class="annottext">StarIsType
</span><a href="GHC.Types.Hint.html#StarIsNotType"><span class="hs-identifier hs-var">StarIsNotType</span></a></span><span>
</span><span id="line-1132"></span><span>             </span><span id="local-6989586621683035707"><span class="annot"><a href="#local-6989586621683035707"><span class="hs-identifier hs-var hs-var">star_is_type_hints</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">StarIsType -&gt; RdrName -&gt; [GhcHint]
</span><a href="GHC.Types.Hint.html#noStarIsTypeHints"><span class="hs-identifier hs-var">noStarIsTypeHints</span></a></span><span> </span><span class="annot"><span class="annottext">StarIsType
</span><a href="#local-6989586621683035704"><span class="hs-identifier hs-var">is_star_type</span></a></span><span> </span><span class="annot"><span class="annottext">RdrName
</span><a href="#local-6989586621683035697"><span class="hs-identifier hs-var">rdr_name</span></a></span><span>
</span><span id="line-1133"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="hs-keyword">if</span><span> </span><span class="annot"><a href="#local-6989586621683035700"><span class="hs-identifier hs-type">data_kinds</span></a></span><span>
</span><span id="line-1134"></span><span>            </span><span class="hs-keyword">then</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span id="local-6989586621683035709"><span class="annot"><a href="#local-6989586621683035709"><span class="hs-identifier hs-var">mb_demoted_gre</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><a href="GHC.Rename.Env.html#lookupOccRn_maybe"><span class="hs-identifier hs-type">lookupOccRn_maybe</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683035698"><span class="hs-identifier hs-type">demoted_rdr</span></a></span><span>
</span><span id="line-1135"></span><span>                    </span><span class="hs-special">;</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><a href="#local-6989586621683035709"><span class="hs-identifier hs-type">mb_demoted_gre</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-1136"></span><span>                        </span><span class="annot"><span class="annottext">Maybe GlobalRdrElt
</span><span class="hs-identifier hs-var">Nothing</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">LookingFor -&gt; RdrName -&gt; [GhcHint] -&gt; RnM Name
</span><a href="GHC.Rename.Unbound.html#unboundNameX"><span class="hs-identifier hs-var">unboundNameX</span></a></span><span> </span><span class="annot"><span class="annottext">LookingFor
</span><a href="#local-6989586621683035711"><span class="hs-identifier hs-var">looking_for</span></a></span><span> </span><span class="annot"><span class="annottext">RdrName
</span><a href="#local-6989586621683035697"><span class="hs-identifier hs-var">rdr_name</span></a></span><span> </span><span class="annot"><span class="annottext">[GhcHint]
</span><a href="#local-6989586621683035707"><span class="hs-identifier hs-var">star_is_type_hints</span></a></span><span>
</span><span id="line-1137"></span><span>                        </span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span id="local-6989586621683035712"><span class="annot"><span class="annottext">GlobalRdrElt
</span><a href="#local-6989586621683035712"><span class="hs-identifier hs-var">demoted_gre</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Name -&gt; RnM Name
forall a. a -&gt; IOEnv (Env TcGblEnv TcLclEnv) a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="annot"><span class="annottext">(Name -&gt; RnM Name) -&gt; Name -&gt; RnM Name
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">GlobalRdrElt -&gt; Name
forall info. GlobalRdrEltX info -&gt; Name
</span><a href="GHC.Types.Name.Reader.html#greName"><span class="hs-identifier hs-var">greName</span></a></span><span> </span><span class="annot"><span class="annottext">GlobalRdrElt
</span><a href="#local-6989586621683035712"><span class="hs-identifier hs-var">demoted_gre</span></a></span><span class="hs-special">}</span><span>
</span><span id="line-1138"></span><span>            </span><span class="hs-keyword">else</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span class="hs-comment">-- We need to check if a data constructor of this name is</span><span>
</span><span id="line-1139"></span><span>                      </span><span class="hs-comment">-- in scope to give good error messages. However, we do</span><span>
</span><span id="line-1140"></span><span>                      </span><span class="hs-comment">-- not want to give an additional error if the data</span><span>
</span><span id="line-1141"></span><span>                      </span><span class="hs-comment">-- constructor happens to be out of scope! See #13947.</span><span>
</span><span id="line-1142"></span><span>                      </span><span id="local-6989586621683035713"><span class="annot"><a href="#local-6989586621683035713"><span class="hs-identifier hs-var">mb_demoted_name</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.Monad.html#discardErrs"><span class="hs-identifier hs-type">discardErrs</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span>
</span><span id="line-1143"></span><span>                                         </span><span class="annot"><a href="GHC.Rename.Env.html#lookupOccRn_maybe"><span class="hs-identifier hs-type">lookupOccRn_maybe</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683035698"><span class="hs-identifier hs-type">demoted_rdr</span></a></span><span>
</span><span id="line-1144"></span><span>                    </span><span class="hs-special">;</span><span> </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621683035715"><span class="annot"><a href="#local-6989586621683035715"><span class="hs-identifier hs-var hs-var">suggestion</span></a></span></span><span> </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Maybe GlobalRdrElt -&gt; Bool
forall a. Maybe a -&gt; Bool
</span><span class="hs-identifier hs-var">isJust</span></span><span> </span><span class="annot"><span class="annottext">Maybe GlobalRdrElt
</span><a href="#local-6989586621683035713"><span class="hs-identifier hs-var">mb_demoted_name</span></a></span><span>
</span><span id="line-1145"></span><span>                                     </span><span class="hs-special">,</span><span> </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621683035720"><span class="annot"><span class="annottext">additional :: SDoc
</span><a href="#local-6989586621683035720"><span class="hs-identifier hs-var hs-var">additional</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">String -&gt; SDoc
forall doc. IsLine doc =&gt; String -&gt; doc
</span><a href="GHC.Utils.Outputable.html#text"><span class="hs-identifier hs-var">text</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;to refer to the data constructor of that name?&quot;</span></span><span>
</span><span id="line-1146"></span><span>                                     </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">LanguageExtensionHint -&gt; GhcHint
</span><a href="GHC.Types.Hint.html#SuggestExtension"><span class="hs-identifier hs-var">SuggestExtension</span></a></span><span> </span><span class="annot"><span class="annottext">(LanguageExtensionHint -&gt; GhcHint)
-&gt; LanguageExtensionHint -&gt; GhcHint
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">SDoc -&gt; Extension -&gt; LanguageExtensionHint
</span><a href="GHC.Types.Hint.html#SuggestSingleExtension"><span class="hs-identifier hs-var">SuggestSingleExtension</span></a></span><span> </span><span class="annot"><span class="annottext">SDoc
</span><a href="#local-6989586621683035720"><span class="hs-identifier hs-var">additional</span></a></span><span> </span><span class="annot"><span class="annottext">Extension
</span><span class="hs-identifier hs-var">LangExt.DataKinds</span></span><span class="hs-special">]</span><span>
</span><span id="line-1147"></span><span>                                     </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">otherwise</span></span><span>
</span><span id="line-1148"></span><span>                                     </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[GhcHint]
</span><a href="#local-6989586621683035707"><span class="hs-identifier hs-var">star_is_type_hints</span></a></span><span>
</span><span id="line-1149"></span><span>                    </span><span class="hs-special">;</span><span> </span><span class="annot"><a href="GHC.Rename.Unbound.html#unboundNameX"><span class="hs-identifier hs-type">unboundNameX</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683035711"><span class="hs-identifier hs-type">looking_for</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683035697"><span class="hs-identifier hs-type">rdr_name</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683035715"><span class="hs-identifier hs-type">suggestion</span></a></span><span> </span><span class="hs-special">}</span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-1150"></span><span>
</span><span id="line-1151"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">RdrName -&gt; Bool
</span><a href="GHC.Types.Name.Reader.html#isQual"><span class="hs-identifier hs-var">isQual</span></a></span><span> </span><span class="annot"><span class="annottext">RdrName
</span><a href="#local-6989586621683035697"><span class="hs-identifier hs-var">rdr_name</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-1152"></span><span>    </span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span id="local-6989586621683035723"><span class="annot"><span class="annottext">RdrName
</span><a href="#local-6989586621683035723"><span class="hs-identifier hs-var">demoted_rdr_name</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">RdrName -&gt; Maybe RdrName
</span><a href="GHC.Types.Name.Reader.html#demoteRdrNameTv"><span class="hs-identifier hs-var">demoteRdrNameTv</span></a></span><span> </span><span class="annot"><span class="annottext">RdrName
</span><a href="#local-6989586621683035697"><span class="hs-identifier hs-var">rdr_name</span></a></span><span>
</span><span id="line-1153"></span><span>    </span><span class="hs-comment">-- Definitely an illegal term variable, as type variables are never exported.</span><span>
</span><span id="line-1154"></span><span>    </span><span class="hs-comment">-- See Note [Demotion of unqualified variables] (W2)</span><span>
</span><span id="line-1155"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">RdrName -&gt; RdrName -&gt; RnM Name
</span><a href="GHC.Rename.Env.html#report_qualified_term_in_types"><span class="hs-identifier hs-var">report_qualified_term_in_types</span></a></span><span> </span><span class="annot"><span class="annottext">RdrName
</span><a href="#local-6989586621683035697"><span class="hs-identifier hs-var">rdr_name</span></a></span><span> </span><span class="annot"><span class="annottext">RdrName
</span><a href="#local-6989586621683035723"><span class="hs-identifier hs-var">demoted_rdr_name</span></a></span><span>
</span><span id="line-1156"></span><span>
</span><span id="line-1157"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">RdrName -&gt; Bool
</span><a href="GHC.Types.Name.Reader.html#isUnqual"><span class="hs-identifier hs-var">isUnqual</span></a></span><span> </span><span class="annot"><span class="annottext">RdrName
</span><a href="#local-6989586621683035697"><span class="hs-identifier hs-var">rdr_name</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-1158"></span><span>    </span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span id="local-6989586621683035726"><span class="annot"><span class="annottext">RdrName
</span><a href="#local-6989586621683035726"><span class="hs-identifier hs-var">demoted_rdr_name</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">RdrName -&gt; Maybe RdrName
</span><a href="GHC.Types.Name.Reader.html#demoteRdrNameTv"><span class="hs-identifier hs-var">demoteRdrNameTv</span></a></span><span> </span><span class="annot"><span class="annottext">RdrName
</span><a href="#local-6989586621683035697"><span class="hs-identifier hs-var">rdr_name</span></a></span><span>
</span><span id="line-1159"></span><span>    </span><span class="hs-comment">-- See Note [Demotion of unqualified variables]</span><span>
</span><span id="line-1160"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span id="local-6989586621683035727"><span class="annot"><a href="#local-6989586621683035727"><span class="hs-identifier hs-var">required_type_arguments</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Extension -&gt; TcRnIf TcGblEnv TcLclEnv Bool
forall gbl lcl. Extension -&gt; TcRnIf gbl lcl Bool
</span><a href="GHC.Tc.Utils.Monad.html#xoptM"><span class="hs-identifier hs-var">xoptM</span></a></span><span> </span><span class="annot"><span class="annottext">Extension
</span><span class="hs-identifier hs-var">LangExt.RequiredTypeArguments</span></span><span>
</span><span id="line-1161"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="hs-keyword">if</span><span> </span><span class="annot"><a href="#local-6989586621683035727"><span class="hs-identifier hs-type">required_type_arguments</span></a></span><span>
</span><span id="line-1162"></span><span>         </span><span class="hs-keyword">then</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span id="local-6989586621683035729"><span class="annot"><a href="#local-6989586621683035729"><span class="hs-identifier hs-var">mb_demoted_gre</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><a href="GHC.Rename.Env.html#lookupOccRn_maybe"><span class="hs-identifier hs-type">lookupOccRn_maybe</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683035726"><span class="hs-identifier hs-type">demoted_rdr_name</span></a></span><span>
</span><span id="line-1163"></span><span>                 </span><span class="hs-special">;</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><a href="#local-6989586621683035729"><span class="hs-identifier hs-type">mb_demoted_gre</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-1164"></span><span>                     </span><span class="annot"><span class="annottext">Maybe GlobalRdrElt
</span><span class="hs-identifier hs-var">Nothing</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">LookingFor -&gt; RdrName -&gt; RnM Name
</span><a href="GHC.Rename.Unbound.html#unboundName"><span class="hs-identifier hs-var">unboundName</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">WhatLooking -&gt; WhereLooking -&gt; LookingFor
</span><a href="GHC.Rename.Unbound.html#LF"><span class="hs-identifier hs-var">LF</span></a></span><span> </span><span class="annot"><span class="annottext">WhatLooking
</span><a href="GHC.Rename.Unbound.html#WL_Anything"><span class="hs-identifier hs-var">WL_Anything</span></a></span><span> </span><span class="annot"><span class="annottext">WhereLooking
</span><a href="GHC.Rename.Unbound.html#WL_Anywhere"><span class="hs-identifier hs-var">WL_Anywhere</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">RdrName
</span><a href="#local-6989586621683035697"><span class="hs-identifier hs-var">rdr_name</span></a></span><span>
</span><span id="line-1165"></span><span>                     </span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span id="local-6989586621683035731"><span class="annot"><span class="annottext">GlobalRdrElt
</span><a href="#local-6989586621683035731"><span class="hs-identifier hs-var">demoted_gre</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Name -&gt; RnM Name
forall a. a -&gt; IOEnv (Env TcGblEnv TcLclEnv) a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="annot"><span class="annottext">(Name -&gt; RnM Name) -&gt; Name -&gt; RnM Name
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">GlobalRdrElt -&gt; Name
forall info. GlobalRdrEltX info -&gt; Name
</span><a href="GHC.Types.Name.Reader.html#greName"><span class="hs-identifier hs-var">greName</span></a></span><span> </span><span class="annot"><span class="annottext">GlobalRdrElt
</span><a href="#local-6989586621683035731"><span class="hs-identifier hs-var">demoted_gre</span></a></span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-1166"></span><span>         </span><span class="hs-keyword">else</span><span> </span><span class="annot"><a href="GHC.Rename.Unbound.html#unboundName"><span class="hs-identifier hs-type">unboundName</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683035711"><span class="hs-identifier hs-type">looking_for</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683035697"><span class="hs-identifier hs-type">rdr_name</span></a></span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-1167"></span><span>
</span><span id="line-1168"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">otherwise</span></span><span>
</span><span id="line-1169"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">LookingFor -&gt; RdrName -&gt; RnM Name
</span><a href="GHC.Rename.Unbound.html#unboundName"><span class="hs-identifier hs-var">unboundName</span></a></span><span> </span><span class="annot"><span class="annottext">LookingFor
</span><a href="#local-6989586621683035711"><span class="hs-identifier hs-var">looking_for</span></a></span><span> </span><span class="annot"><span class="annottext">RdrName
</span><a href="#local-6989586621683035697"><span class="hs-identifier hs-var">rdr_name</span></a></span><span>
</span><span id="line-1170"></span><span>
</span><span id="line-1171"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-1172"></span><span>    </span><span id="local-6989586621683035711"><span class="annot"><span class="annottext">looking_for :: LookingFor
</span><a href="#local-6989586621683035711"><span class="hs-identifier hs-var hs-var">looking_for</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">WhatLooking -&gt; WhereLooking -&gt; LookingFor
</span><a href="GHC.Rename.Unbound.html#LF"><span class="hs-identifier hs-var">LF</span></a></span><span> </span><span class="annot"><span class="annottext">WhatLooking
</span><a href="GHC.Rename.Unbound.html#WL_Constructor"><span class="hs-identifier hs-var">WL_Constructor</span></a></span><span> </span><span class="annot"><span class="annottext">WhereLooking
</span><a href="GHC.Rename.Unbound.html#WL_Anywhere"><span class="hs-identifier hs-var">WL_Anywhere</span></a></span><span>
</span><span id="line-1173"></span><span>
</span><span id="line-1174"></span><span class="hs-comment">{- Note [Demotion of unqualified variables]
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
Under RequiredTypeArguments, a term-level variable name (i.e. a name whose
`occNameSpace` is `varName` as opposed to `tvName`) does not necessarily denote
a term variable. It can actually stand for a type:

  {-# LANGUAGE RequiredTypeArguments #-}
  idv :: forall a -&gt; a -&gt; a     -- Note the &quot;forall a -&gt;&quot; in the type
  idv  t  (x :: t) = id @t x    -- #23739
  --   ^        ^        ^
  --  varName  tvName  tvName   -- NameSpace (GHC.Types.Name.Occurrence)

The variable `t` is an alias for the type variable `a`, so it's valid to use it
in type-level contexts. The only problem is that the namespaces do not match.
Demotion allows us to connect the `tvName` usages to the `varName` binding.

Demotion of an RdrName means that we change its namespace from tvName/tcClsName
to varName/dataName. Suppose we are looking up an occurrence of a variable `a`
in a type (in `lookupTypeOccRn`). The parser gave `a` a `tvName` occurrence,
so we try looking that up first.  If that fails, and RequiredTypeArguments is
on, then &quot;demote&quot; it to the `varName` namespace with `demoteRdrNameTv` and look
that up instead. If that succeeds, use it.

(W1) Wrinkle 1
  As a side effect of demotion, the renamer accepts all these examples:
    t = True         -- Ordinary term-level binding
    x = Proxy @t     -- (1) Bad usage in a HsExpr
    type T = t       -- (2) Bad usage in a TyClDecl
    f :: t -&gt; t      -- (3) Bad usage in a SigDecl

  However, GHC doesn't promote arbitrary terms to types. See the &quot;T2T-Mapping&quot;
  section of GHC Proposal #281: &quot;In the type checking environment, the variable
  must stand for a type variable&quot;. Even though the renamer accepts these
  constructs, the type checker has to reject the uses of `t` shown above.

  All three examples are rejected with the `TermVariablePE` promotion error.
  The error is generated by `tcTyVar` (GHC.Tc.Gen.HsType)
      tcTyVar :: Name -&gt; TcM (TcType, TcKind)
  The first thing `tcTyVar` does is call the `tcLookup` helper (GHC.Tc.Utils.Env)
  to find the variable in the type checking environment
      tcLookup :: Name -&gt; TcM TcTyThing
  What happens next depends on the example in question.

  * In the HsExpr example (1), `tcLookup` finds `ATcId` that corresponds to
    the `t = True` binding. The `ATcId` is then then turned into an error by
    the following clause in `tcTyVar`:
       ATcId{} -&gt; promotionErr name TermVariablePE

  * In the TyClDecl example (2) and the SigDecl example (3), we don't have
    `ATcId` in the environment just yet because type declarations and signatures
    are type-checked /before/ term-level bindings.

    This means that `tcLookup` fails to find `t` in the local environment and
    calls `tcLookupGlobal` (GHC.Tc.Utils.Env)
        tcLookupGlobal :: Name -&gt; TcM TyThing

    The global environment does not contain `t` either, so `tcLookupGlobal`
    calls `notFound` (GHC.Tc.Utils.Env)
        notFound :: Name -&gt; TcM TyThing

    At this point GHC would normally generate a panic: if the variable is
    neither in the local nor in the global environment, then it shouldn't have
    passed the renamer. Unfortunately, this expectation is tiresome and
    expensive to maintain, so we add a special case in `notFound` instead.
    If the namespace of the variable is `varName`, the only explanation other
    than a bug in GHC is that the user tried to use a term variable in a type
    context. Hence the following clause in `notFound`:
      _ | isTermVarOrFieldNameSpace (nameNameSpace name) -&gt;
          failWithTc $ TcRnUnpromotableThing name TermVariablePE

(W2) Wrinkle 2
   Only unqualified variable names are demoted, e.g. `f` but not `M.f`.
   The reason is that type variables are never bound to a qualified name:
   they can't be bound at the top level of a module, nor can they be
   exported or imported, so a qualified occurrence `M.f` must refer to a
   term-level definition and is never legal at the type level.
   Demotion of qualified names would not allow us to accept any new programs.
   We use this fact to generate better suggestions in error messages,
   see `report_qualified_term_in_types`.
-}</span><span>
</span><span id="line-1254"></span><span>
</span><span id="line-1255"></span><span class="hs-comment">-- Report a qualified variable name in a type signature:</span><span>
</span><span id="line-1256"></span><span class="hs-comment">--   badSig :: Prelude.head</span><span>
</span><span id="line-1257"></span><span class="hs-comment">--             ^^^^^^^^^^^</span><span>
</span><span id="line-1258"></span><span class="annot"><a href="GHC.Rename.Env.html#report_qualified_term_in_types"><span class="hs-identifier hs-type">report_qualified_term_in_types</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Types.Name.Reader.html#RdrName"><span class="hs-identifier hs-type">RdrName</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Types.Name.Reader.html#RdrName"><span class="hs-identifier hs-type">RdrName</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#RnM"><span class="hs-identifier hs-type">RnM</span></a></span><span> </span><span class="annot"><a href="GHC.Types.Name.html#Name"><span class="hs-identifier hs-type">Name</span></a></span><span>
</span><span id="line-1259"></span><span id="report_qualified_term_in_types"><span class="annot"><span class="annottext">report_qualified_term_in_types :: RdrName -&gt; RdrName -&gt; RnM Name
</span><a href="GHC.Rename.Env.html#report_qualified_term_in_types"><span class="hs-identifier hs-var hs-var">report_qualified_term_in_types</span></a></span></span><span> </span><span id="local-6989586621683035732"><span class="annot"><span class="annottext">RdrName
</span><a href="#local-6989586621683035732"><span class="hs-identifier hs-var">rdr_name</span></a></span></span><span> </span><span id="local-6989586621683035733"><span class="annot"><span class="annottext">RdrName
</span><a href="#local-6989586621683035733"><span class="hs-identifier hs-var">demoted_rdr_name</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-1260"></span><span>  </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span id="local-6989586621683035734"><span class="annot"><a href="#local-6989586621683035734"><span class="hs-identifier hs-var">mName</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">WhichGREs GREInfo -&gt; RdrName -&gt; RnM (Maybe GlobalRdrElt)
</span><a href="GHC.Rename.Env.html#lookupGlobalOccRn_maybe"><span class="hs-identifier hs-var">lookupGlobalOccRn_maybe</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">FieldsOrSelectors -&gt; WhichGREs GREInfo
</span><a href="GHC.Types.Name.Reader.html#RelevantGREsFOS"><span class="hs-identifier hs-var">RelevantGREsFOS</span></a></span><span> </span><span class="annot"><span class="annottext">FieldsOrSelectors
</span><a href="GHC.Types.Name.Reader.html#WantNormal"><span class="hs-identifier hs-var">WantNormal</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">RdrName
</span><a href="#local-6989586621683035733"><span class="hs-identifier hs-var">demoted_rdr_name</span></a></span><span>
</span><span id="line-1261"></span><span>     </span><span class="hs-special">;</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><a href="#local-6989586621683035734"><span class="hs-identifier hs-type">mName</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-1262"></span><span>         </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span class="annot"><span class="annottext">GlobalRdrElt
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">LookingFor -&gt; RdrName -&gt; RdrName -&gt; [GhcHint] -&gt; RnM Name
</span><a href="GHC.Rename.Unbound.html#termNameInType"><span class="hs-identifier hs-var">termNameInType</span></a></span><span> </span><span class="annot"><span class="annottext">LookingFor
</span><a href="#local-6989586621683035736"><span class="hs-identifier hs-var">looking_for</span></a></span><span> </span><span class="annot"><span class="annottext">RdrName
</span><a href="#local-6989586621683035732"><span class="hs-identifier hs-var">rdr_name</span></a></span><span> </span><span class="annot"><span class="annottext">RdrName
</span><a href="#local-6989586621683035733"><span class="hs-identifier hs-var">demoted_rdr_name</span></a></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span>
</span><span id="line-1263"></span><span>         </span><span class="annot"><span class="annottext">Maybe GlobalRdrElt
</span><span class="hs-identifier hs-var">Nothing</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">LookingFor -&gt; RdrName -&gt; RdrName -&gt; RnM Name
</span><a href="GHC.Rename.Unbound.html#unboundTermNameInTypes"><span class="hs-identifier hs-var">unboundTermNameInTypes</span></a></span><span> </span><span class="annot"><span class="annottext">LookingFor
</span><a href="#local-6989586621683035736"><span class="hs-identifier hs-var">looking_for</span></a></span><span> </span><span class="annot"><span class="annottext">RdrName
</span><a href="#local-6989586621683035732"><span class="hs-identifier hs-var">rdr_name</span></a></span><span> </span><span class="annot"><span class="annottext">RdrName
</span><a href="#local-6989586621683035733"><span class="hs-identifier hs-var">demoted_rdr_name</span></a></span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-1264"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-1265"></span><span>    </span><span id="local-6989586621683035736"><span class="annot"><span class="annottext">looking_for :: LookingFor
</span><a href="#local-6989586621683035736"><span class="hs-identifier hs-var hs-var">looking_for</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">WhatLooking -&gt; WhereLooking -&gt; LookingFor
</span><a href="GHC.Rename.Unbound.html#LF"><span class="hs-identifier hs-var">LF</span></a></span><span> </span><span class="annot"><span class="annottext">WhatLooking
</span><a href="GHC.Rename.Unbound.html#WL_Constructor"><span class="hs-identifier hs-var">WL_Constructor</span></a></span><span> </span><span class="annot"><span class="annottext">WhereLooking
</span><a href="GHC.Rename.Unbound.html#WL_Global"><span class="hs-identifier hs-var">WL_Global</span></a></span><span>
</span><span id="line-1266"></span><span>
</span><span id="line-1267"></span><span class="hs-comment">-- If the given RdrName can be promoted to the type level and its promoted variant is in scope,</span><span>
</span><span id="line-1268"></span><span class="hs-comment">-- lookup_promoted returns the corresponding type-level Name.</span><span>
</span><span id="line-1269"></span><span class="hs-comment">-- Otherwise, the function returns Nothing.</span><span>
</span><span id="line-1270"></span><span class="hs-comment">-- See Note [Promotion] below.</span><span>
</span><span id="line-1271"></span><span class="annot"><a href="GHC.Rename.Env.html#lookup_promoted"><span class="hs-identifier hs-type">lookup_promoted</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Types.Name.Reader.html#RdrName"><span class="hs-identifier hs-type">RdrName</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#RnM"><span class="hs-identifier hs-type">RnM</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Maybe</span></span><span> </span><span class="annot"><a href="GHC.Types.Name.Reader.html#GlobalRdrElt"><span class="hs-identifier hs-type">GlobalRdrElt</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1272"></span><span id="lookup_promoted"><span class="annot"><span class="annottext">lookup_promoted :: RdrName -&gt; RnM (Maybe GlobalRdrElt)
</span><a href="GHC.Rename.Env.html#lookup_promoted"><span class="hs-identifier hs-var hs-var">lookup_promoted</span></a></span></span><span> </span><span id="local-6989586621683035739"><span class="annot"><span class="annottext">RdrName
</span><a href="#local-6989586621683035739"><span class="hs-identifier hs-var">rdr_name</span></a></span></span><span>
</span><span id="line-1273"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span id="local-6989586621683035740"><span class="annot"><span class="annottext">RdrName
</span><a href="#local-6989586621683035740"><span class="hs-identifier hs-var">promoted_rdr</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">RdrName -&gt; Maybe RdrName
</span><a href="GHC.Types.Name.Reader.html#promoteRdrName"><span class="hs-identifier hs-var">promoteRdrName</span></a></span><span> </span><span class="annot"><span class="annottext">RdrName
</span><a href="#local-6989586621683035739"><span class="hs-identifier hs-var">rdr_name</span></a></span><span>
</span><span id="line-1274"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">RdrName -&gt; RnM (Maybe GlobalRdrElt)
</span><a href="GHC.Rename.Env.html#lookupOccRn_maybe"><span class="hs-identifier hs-var">lookupOccRn_maybe</span></a></span><span> </span><span class="annot"><span class="annottext">RdrName
</span><a href="#local-6989586621683035740"><span class="hs-identifier hs-var">promoted_rdr</span></a></span><span>
</span><span id="line-1275"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">otherwise</span></span><span>
</span><span id="line-1276"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Maybe GlobalRdrElt -&gt; RnM (Maybe GlobalRdrElt)
forall a. a -&gt; IOEnv (Env TcGblEnv TcLclEnv) a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="annot"><span class="annottext">Maybe GlobalRdrElt
forall a. Maybe a
</span><span class="hs-identifier hs-var">Nothing</span></span><span>
</span><span id="line-1277"></span><span>
</span><span id="line-1278"></span><span class="hs-comment">{- Note [Demotion]
~~~~~~~~~~~~~~~~~~
When the user writes:
  data Nat = Zero | Succ Nat
  foo :: f Zero -&gt; Int

'Zero' in the type signature of 'foo' is parsed as:
  HsTyVar (&quot;Zero&quot;, TcClsName)

When the renamer hits this occurrence of 'Zero' it's going to realise
that it's not in scope. But because it is renaming a type, it knows
that 'Zero' might be a promoted data constructor, so it will demote
its namespace to DataName and do a second lookup.

The final result (after the renamer) will be:
  HsTyVar (&quot;Zero&quot;, DataName)

Another case of demotion happens when the user tries to
use a qualified term at the type level:

  f :: Prelude.id -&gt; Int

This signature passes the parser to be caught by the renamer.
It allows the compiler to create more informative error messages.

'Prelude.id' in the type signature is parsed as
  HsTyVar (&quot;id&quot;, TvName)

To separate the case of a typo from the case of an
intentional attempt to use an imported term's name the compiler demotes
the namespace to VarName (using 'demoteTvNameSpace') and does a lookup.

The same type of demotion happens when the compiler needs to check
if a name of a type variable has already been used for a term that is in scope.
We need to do it to check if a user should change the name
to make his code compatible with the RequiredTypeArguments extension.

Note [Promotion]
~~~~~~~~~~~~~~~
When the user mentions a type constructor or a type variable in a
term-level context, then we report that a value identifier was expected
instead of a type-level one. That makes error messages more precise.
Previously, such errors contained only the info that a given value was out of scope (#18740).
We promote the namespace of RdrName and look up after that
(see the functions promotedRdrName and lookup_promoted).

In particular, we have the following error message
  &#8226; Illegal term-level use of the type constructor &#8216;Int&#8217;
      imported from &#8216;Prelude&#8217; (and originally defined in &#8216;GHC.Types&#8217;)
  &#8226; In the first argument of &#8216;id&#8217;, namely &#8216;Int&#8217;
    In the expression: id Int
    In an equation for &#8216;x&#8217;: x = id Int

when the user writes the following declaration

  x = id Int
-}</span><span>
</span><span id="line-1335"></span><span>
</span><span id="line-1336"></span><span id="local-6989586621683034619"><span class="annot"><a href="GHC.Rename.Env.html#lookupOccRnX_maybe"><span class="hs-identifier hs-type">lookupOccRnX_maybe</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Types.Name.Reader.html#RdrName"><span class="hs-identifier hs-type">RdrName</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#RnM"><span class="hs-identifier hs-type">RnM</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Maybe</span></span><span> </span><span class="annot"><a href="#local-6989586621683034619"><span class="hs-identifier hs-type">r</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Types.Name.Reader.html#GlobalRdrElt"><span class="hs-identifier hs-type">GlobalRdrElt</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#RnM"><span class="hs-identifier hs-type">RnM</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683034619"><span class="hs-identifier hs-type">r</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Types.Name.Reader.html#RdrName"><span class="hs-identifier hs-type">RdrName</span></a></span><span>
</span><span id="line-1337"></span><span>                   </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#RnM"><span class="hs-identifier hs-type">RnM</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Maybe</span></span><span> </span><span class="annot"><a href="#local-6989586621683034619"><span class="hs-identifier hs-type">r</span></a></span><span class="hs-special">)</span></span><span>
</span><span id="line-1338"></span><span id="lookupOccRnX_maybe"><span class="annot"><span class="annottext">lookupOccRnX_maybe :: forall r.
(RdrName -&gt; RnM (Maybe r))
-&gt; (GlobalRdrElt -&gt; RnM r) -&gt; RdrName -&gt; RnM (Maybe r)
</span><a href="GHC.Rename.Env.html#lookupOccRnX_maybe"><span class="hs-identifier hs-var hs-var">lookupOccRnX_maybe</span></a></span></span><span> </span><span id="local-6989586621683035748"><span class="annot"><span class="annottext">RdrName -&gt; RnM (Maybe r)
</span><a href="#local-6989586621683035748"><span class="hs-identifier hs-var">globalLookup</span></a></span></span><span> </span><span id="local-6989586621683035749"><span class="annot"><span class="annottext">GlobalRdrElt -&gt; RnM r
</span><a href="#local-6989586621683035749"><span class="hs-identifier hs-var">wrapper</span></a></span></span><span> </span><span id="local-6989586621683035750"><span class="annot"><span class="annottext">RdrName
</span><a href="#local-6989586621683035750"><span class="hs-identifier hs-var">rdr_name</span></a></span></span><span>
</span><span id="line-1339"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">MaybeT (IOEnv (Env TcGblEnv TcLclEnv)) r -&gt; RnM (Maybe r)
forall (m :: * -&gt; *) a. MaybeT m a -&gt; m (Maybe a)
</span><a href="../../transformers-0.6.1.2-38b1/src/Control.Monad.Trans.Maybe.html#runMaybeT"><span class="hs-identifier hs-var">runMaybeT</span></a></span><span> </span><span class="annot"><span class="annottext">(MaybeT (IOEnv (Env TcGblEnv TcLclEnv)) r -&gt; RnM (Maybe r))
-&gt; ([RnM (Maybe r)] -&gt; MaybeT (IOEnv (Env TcGblEnv TcLclEnv)) r)
-&gt; [RnM (Maybe r)]
-&gt; RnM (Maybe r)
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">[MaybeT (IOEnv (Env TcGblEnv TcLclEnv)) r]
-&gt; MaybeT (IOEnv (Env TcGblEnv TcLclEnv)) r
forall (t :: * -&gt; *) (m :: * -&gt; *) a.
(Foldable t, MonadPlus m) =&gt;
t (m a) -&gt; m a
</span><span class="hs-identifier hs-var">msum</span></span><span> </span><span class="annot"><span class="annottext">([MaybeT (IOEnv (Env TcGblEnv TcLclEnv)) r]
 -&gt; MaybeT (IOEnv (Env TcGblEnv TcLclEnv)) r)
-&gt; ([RnM (Maybe r)] -&gt; [MaybeT (IOEnv (Env TcGblEnv TcLclEnv)) r])
-&gt; [RnM (Maybe r)]
-&gt; MaybeT (IOEnv (Env TcGblEnv TcLclEnv)) r
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">(RnM (Maybe r) -&gt; MaybeT (IOEnv (Env TcGblEnv TcLclEnv)) r)
-&gt; [RnM (Maybe r)] -&gt; [MaybeT (IOEnv (Env TcGblEnv TcLclEnv)) r]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><span class="hs-identifier hs-var">map</span></span><span> </span><span class="annot"><span class="annottext">RnM (Maybe r) -&gt; MaybeT (IOEnv (Env TcGblEnv TcLclEnv)) r
forall (m :: * -&gt; *) a. m (Maybe a) -&gt; MaybeT m a
</span><a href="../../transformers-0.6.1.2-38b1/src/Control.Monad.Trans.Maybe.html#MaybeT"><span class="hs-identifier hs-var">MaybeT</span></a></span><span> </span><span class="annot"><span class="annottext">([RnM (Maybe r)] -&gt; RnM (Maybe r))
-&gt; [RnM (Maybe r)] -&gt; RnM (Maybe r)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-1340"></span><span>      </span><span class="hs-special">[</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span id="local-6989586621683035754"><span class="annot"><a href="#local-6989586621683035754"><span class="hs-identifier hs-var">res</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">RdrName -&gt; RnM (Maybe Name)
</span><a href="GHC.Rename.Env.html#lookupLocalOccRn_maybe"><span class="hs-identifier hs-var">lookupLocalOccRn_maybe</span></a></span><span> </span><span class="annot"><span class="annottext">RdrName
</span><a href="#local-6989586621683035750"><span class="hs-identifier hs-var">rdr_name</span></a></span><span>
</span><span id="line-1341"></span><span>           </span><span class="hs-special">;</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><a href="#local-6989586621683035754"><span class="hs-identifier hs-type">res</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-1342"></span><span>           </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">Maybe Name
</span><span class="hs-identifier hs-var">Nothing</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Maybe r -&gt; RnM (Maybe r)
forall a. a -&gt; IOEnv (Env TcGblEnv TcLclEnv) a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="annot"><span class="annottext">Maybe r
forall a. Maybe a
</span><span class="hs-identifier hs-var">Nothing</span></span><span>
</span><span id="line-1343"></span><span>           </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span id="local-6989586621683035755"><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621683035755"><span class="hs-identifier hs-var">nm</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-1344"></span><span>           </span><span class="hs-comment">-- Elements in the LocalRdrEnv are always Vanilla GREs</span><span>
</span><span id="line-1345"></span><span>        </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621683035756"><span class="annot"><span class="annottext">gre :: GlobalRdrElt
</span><a href="#local-6989586621683035756"><span class="hs-identifier hs-var hs-var">gre</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Parent -&gt; Name -&gt; GlobalRdrElt
</span><a href="GHC.Types.Name.Reader.html#mkLocalVanillaGRE"><span class="hs-identifier hs-var">mkLocalVanillaGRE</span></a></span><span> </span><span class="annot"><span class="annottext">Parent
</span><a href="GHC.Types.Name.Reader.html#NoParent"><span class="hs-identifier hs-var">NoParent</span></a></span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621683035755"><span class="hs-identifier hs-var">nm</span></a></span><span>
</span><span id="line-1346"></span><span>           </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="annottext">r -&gt; Maybe r
forall a. a -&gt; Maybe a
</span><span class="hs-identifier hs-var">Just</span></span><span> </span><span class="annot"><span class="annottext">(r -&gt; Maybe r) -&gt; RnM r -&gt; RnM (Maybe r)
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="annot"><span class="annottext">GlobalRdrElt -&gt; RnM r
</span><a href="#local-6989586621683035749"><span class="hs-identifier hs-var">wrapper</span></a></span><span> </span><span class="annot"><span class="annottext">GlobalRdrElt
</span><a href="#local-6989586621683035756"><span class="hs-identifier hs-var">gre</span></a></span><span> </span><span class="hs-special">}</span><span> </span><span class="hs-special">}</span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-1347"></span><span>      </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">RdrName -&gt; RnM (Maybe r)
</span><a href="#local-6989586621683035748"><span class="hs-identifier hs-var">globalLookup</span></a></span><span> </span><span class="annot"><span class="annottext">RdrName
</span><a href="#local-6989586621683035750"><span class="hs-identifier hs-var">rdr_name</span></a></span><span> </span><span class="hs-special">]</span><span>
</span><span id="line-1348"></span><span>
</span><span id="line-1349"></span><span class="annot"><a href="GHC.Rename.Env.html#lookupOccRn_maybe"><span class="hs-identifier hs-type">lookupOccRn_maybe</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Types.Name.Reader.html#RdrName"><span class="hs-identifier hs-type">RdrName</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#RnM"><span class="hs-identifier hs-type">RnM</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Maybe</span></span><span> </span><span class="annot"><a href="GHC.Types.Name.Reader.html#GlobalRdrElt"><span class="hs-identifier hs-type">GlobalRdrElt</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1350"></span><span id="lookupOccRn_maybe"><span class="annot"><span class="annottext">lookupOccRn_maybe :: RdrName -&gt; RnM (Maybe GlobalRdrElt)
</span><a href="GHC.Rename.Env.html#lookupOccRn_maybe"><span class="hs-identifier hs-var hs-var">lookupOccRn_maybe</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-1351"></span><span>  </span><span class="annot"><span class="annottext">(RdrName -&gt; RnM (Maybe GlobalRdrElt))
-&gt; (GlobalRdrElt -&gt; RnM GlobalRdrElt)
-&gt; RdrName
-&gt; RnM (Maybe GlobalRdrElt)
forall r.
(RdrName -&gt; RnM (Maybe r))
-&gt; (GlobalRdrElt -&gt; RnM r) -&gt; RdrName -&gt; RnM (Maybe r)
</span><a href="GHC.Rename.Env.html#lookupOccRnX_maybe"><span class="hs-identifier hs-var">lookupOccRnX_maybe</span></a></span><span>
</span><span id="line-1352"></span><span>    </span><span class="hs-special">(</span><span class="annot"><span class="annottext">WhichGREs GREInfo -&gt; RdrName -&gt; RnM (Maybe GlobalRdrElt)
</span><a href="GHC.Rename.Env.html#lookupGlobalOccRn_maybe"><span class="hs-identifier hs-var">lookupGlobalOccRn_maybe</span></a></span><span> </span><span class="annot"><span class="annottext">(WhichGREs GREInfo -&gt; RdrName -&gt; RnM (Maybe GlobalRdrElt))
-&gt; WhichGREs GREInfo -&gt; RdrName -&gt; RnM (Maybe GlobalRdrElt)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">FieldsOrSelectors -&gt; WhichGREs GREInfo
</span><a href="GHC.Types.Name.Reader.html#RelevantGREsFOS"><span class="hs-identifier hs-var">RelevantGREsFOS</span></a></span><span> </span><span class="annot"><span class="annottext">FieldsOrSelectors
</span><a href="GHC.Types.Name.Reader.html#WantNormal"><span class="hs-identifier hs-var">WantNormal</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1353"></span><span>    </span><span class="annot"><span class="annottext">GlobalRdrElt -&gt; RnM GlobalRdrElt
forall a. a -&gt; IOEnv (Env TcGblEnv TcLclEnv) a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span>
</span><span id="line-1354"></span><span>
</span><span id="line-1355"></span><span class="hs-comment">-- Used outside this module only by TH name reification (lookupName, lookupThName_maybe)</span><span>
</span><span id="line-1356"></span><span class="annot"><a href="GHC.Rename.Env.html#lookupSameOccRn_maybe"><span class="hs-identifier hs-type">lookupSameOccRn_maybe</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Types.Name.Reader.html#RdrName"><span class="hs-identifier hs-type">RdrName</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#RnM"><span class="hs-identifier hs-type">RnM</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Maybe</span></span><span> </span><span class="annot"><a href="GHC.Types.Name.html#Name"><span class="hs-identifier hs-type">Name</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1357"></span><span id="lookupSameOccRn_maybe"><span class="annot"><span class="annottext">lookupSameOccRn_maybe :: RdrName -&gt; RnM (Maybe Name)
</span><a href="GHC.Rename.Env.html#lookupSameOccRn_maybe"><span class="hs-identifier hs-var hs-var">lookupSameOccRn_maybe</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-1358"></span><span>  </span><span class="annot"><span class="annottext">(RdrName -&gt; RnM (Maybe Name))
-&gt; (GlobalRdrElt -&gt; RnM Name) -&gt; RdrName -&gt; RnM (Maybe Name)
forall r.
(RdrName -&gt; RnM (Maybe r))
-&gt; (GlobalRdrElt -&gt; RnM r) -&gt; RdrName -&gt; RnM (Maybe r)
</span><a href="GHC.Rename.Env.html#lookupOccRnX_maybe"><span class="hs-identifier hs-var">lookupOccRnX_maybe</span></a></span><span>
</span><span id="line-1359"></span><span>    </span><span class="hs-special">(</span><span class="annot"><span class="annottext">RnM (Maybe GlobalRdrElt) -&gt; RnM (Maybe Name)
</span><a href="#local-6989586621683035757"><span class="hs-identifier hs-var">get_name</span></a></span><span> </span><span class="annot"><span class="annottext">(RnM (Maybe GlobalRdrElt) -&gt; RnM (Maybe Name))
-&gt; (RdrName -&gt; RnM (Maybe GlobalRdrElt))
-&gt; RdrName
-&gt; RnM (Maybe Name)
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="annot"><span class="annottext">WhichGREs GREInfo -&gt; RdrName -&gt; RnM (Maybe GlobalRdrElt)
</span><a href="GHC.Rename.Env.html#lookupGlobalOccRn_maybe"><span class="hs-identifier hs-var">lookupGlobalOccRn_maybe</span></a></span><span> </span><span class="annot"><span class="annottext">WhichGREs GREInfo
forall info. WhichGREs info
</span><a href="GHC.Types.Name.Reader.html#SameNameSpace"><span class="hs-identifier hs-var">SameNameSpace</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1360"></span><span>    </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Name -&gt; RnM Name
forall a. a -&gt; IOEnv (Env TcGblEnv TcLclEnv) a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="annot"><span class="annottext">(Name -&gt; RnM Name)
-&gt; (GlobalRdrElt -&gt; Name) -&gt; GlobalRdrElt -&gt; RnM Name
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">GlobalRdrElt -&gt; Name
forall info. GlobalRdrEltX info -&gt; Name
</span><a href="GHC.Types.Name.Reader.html#greName"><span class="hs-identifier hs-var">greName</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1361"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-1362"></span><span>    </span><span class="annot"><a href="#local-6989586621683035757"><span class="hs-identifier hs-type">get_name</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#RnM"><span class="hs-identifier hs-type">RnM</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Maybe</span></span><span> </span><span class="annot"><a href="GHC.Types.Name.Reader.html#GlobalRdrElt"><span class="hs-identifier hs-type">GlobalRdrElt</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#RnM"><span class="hs-identifier hs-type">RnM</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Maybe</span></span><span> </span><span class="annot"><a href="GHC.Types.Name.html#Name"><span class="hs-identifier hs-type">Name</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1363"></span><span>    </span><span id="local-6989586621683035757"><span class="annot"><span class="annottext">get_name :: RnM (Maybe GlobalRdrElt) -&gt; RnM (Maybe Name)
</span><a href="#local-6989586621683035757"><span class="hs-identifier hs-var hs-var">get_name</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(Maybe GlobalRdrElt -&gt; Maybe Name)
-&gt; RnM (Maybe GlobalRdrElt) -&gt; RnM (Maybe Name)
forall a b.
(a -&gt; b)
-&gt; IOEnv (Env TcGblEnv TcLclEnv) a
-&gt; IOEnv (Env TcGblEnv TcLclEnv) b
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-identifier hs-var">fmap</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(GlobalRdrElt -&gt; Name) -&gt; Maybe GlobalRdrElt -&gt; Maybe Name
forall a b. (a -&gt; b) -&gt; Maybe a -&gt; Maybe b
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-identifier hs-var">fmap</span></span><span> </span><span class="annot"><span class="annottext">GlobalRdrElt -&gt; Name
forall info. GlobalRdrEltX info -&gt; Name
</span><a href="GHC.Types.Name.Reader.html#greName"><span class="hs-identifier hs-var">greName</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1364"></span><span>
</span><span id="line-1365"></span><span class="hs-comment">-- | Look up a 'RdrName' used as a variable in an expression.</span><span>
</span><span id="line-1366"></span><span class="hs-comment">--</span><span>
</span><span id="line-1367"></span><span class="hs-comment">-- This may be a local variable, global variable, or one or more record selector</span><span>
</span><span id="line-1368"></span><span class="hs-comment">-- functions.  It will not return record fields created with the</span><span>
</span><span id="line-1369"></span><span class="hs-comment">-- @NoFieldSelectors@ extension (see Note [NoFieldSelectors]).</span><span>
</span><span id="line-1370"></span><span class="hs-comment">--</span><span>
</span><span id="line-1371"></span><span class="hs-comment">-- If the name is not in scope at the term level, but its promoted equivalent is</span><span>
</span><span id="line-1372"></span><span class="hs-comment">-- in scope at the type level, the lookup will succeed (so that the type-checker</span><span>
</span><span id="line-1373"></span><span class="hs-comment">-- can report a more informative error later).  See Note [Promotion].</span><span>
</span><span id="line-1374"></span><span class="hs-comment">--</span><span>
</span><span id="line-1375"></span><span class="annot"><a href="GHC.Rename.Env.html#lookupExprOccRn"><span class="hs-identifier hs-type">lookupExprOccRn</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Types.Name.Reader.html#RdrName"><span class="hs-identifier hs-type">RdrName</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#RnM"><span class="hs-identifier hs-type">RnM</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Maybe</span></span><span> </span><span class="annot"><a href="GHC.Types.Name.Reader.html#GlobalRdrElt"><span class="hs-identifier hs-type">GlobalRdrElt</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1376"></span><span id="lookupExprOccRn"><span class="annot"><span class="annottext">lookupExprOccRn :: RdrName -&gt; RnM (Maybe GlobalRdrElt)
</span><a href="GHC.Rename.Env.html#lookupExprOccRn"><span class="hs-identifier hs-var hs-var">lookupExprOccRn</span></a></span></span><span> </span><span id="local-6989586621683035759"><span class="annot"><span class="annottext">RdrName
</span><a href="#local-6989586621683035759"><span class="hs-identifier hs-var">rdr_name</span></a></span></span><span>
</span><span id="line-1377"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span id="local-6989586621683035760"><span class="annot"><a href="#local-6989586621683035760"><span class="hs-identifier hs-var">mb_name</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">(RdrName -&gt; RnM (Maybe GlobalRdrElt))
-&gt; (GlobalRdrElt -&gt; RnM GlobalRdrElt)
-&gt; RdrName
-&gt; RnM (Maybe GlobalRdrElt)
forall r.
(RdrName -&gt; RnM (Maybe r))
-&gt; (GlobalRdrElt -&gt; RnM r) -&gt; RdrName -&gt; RnM (Maybe r)
</span><a href="GHC.Rename.Env.html#lookupOccRnX_maybe"><span class="hs-identifier hs-var">lookupOccRnX_maybe</span></a></span><span>
</span><span id="line-1378"></span><span>                      </span><span class="annot"><span class="annottext">RdrName -&gt; RnM (Maybe GlobalRdrElt)
</span><a href="GHC.Rename.Env.html#lookupGlobalOccRn_overloaded"><span class="hs-identifier hs-var">lookupGlobalOccRn_overloaded</span></a></span><span>
</span><span id="line-1379"></span><span>                      </span><span class="annot"><span class="annottext">GlobalRdrElt -&gt; RnM GlobalRdrElt
forall a. a -&gt; IOEnv (Env TcGblEnv TcLclEnv) a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span>
</span><span id="line-1380"></span><span>                      </span><span class="annot"><span class="annottext">RdrName
</span><a href="#local-6989586621683035759"><span class="hs-identifier hs-var">rdr_name</span></a></span><span>
</span><span id="line-1381"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><a href="#local-6989586621683035760"><span class="hs-identifier hs-type">mb_name</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-1382"></span><span>           </span><span class="annot"><span class="annottext">Maybe GlobalRdrElt
</span><span class="hs-identifier hs-var">Nothing</span></span><span>   </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">RdrName -&gt; RnM (Maybe GlobalRdrElt)
</span><a href="GHC.Rename.Env.html#lookup_promoted"><span class="hs-identifier hs-var">lookup_promoted</span></a></span><span> </span><span class="annot"><span class="annottext">RdrName
</span><a href="#local-6989586621683035759"><span class="hs-identifier hs-var">rdr_name</span></a></span><span>
</span><span id="line-1383"></span><span>                        </span><span class="hs-comment">-- See Note [Promotion].</span><span>
</span><span id="line-1384"></span><span>                        </span><span class="hs-comment">-- We try looking up the name as a</span><span>
</span><span id="line-1385"></span><span>                        </span><span class="hs-comment">-- type constructor or type variable, if</span><span>
</span><span id="line-1386"></span><span>                        </span><span class="hs-comment">-- we failed to look up the name at the term level.</span><span>
</span><span id="line-1387"></span><span>           </span><span id="local-6989586621683035762"><span class="annot"><span class="annottext">Maybe GlobalRdrElt
</span><a href="#local-6989586621683035762"><span class="hs-identifier hs-var">p</span></a></span></span><span>         </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Maybe GlobalRdrElt -&gt; RnM (Maybe GlobalRdrElt)
forall a. a -&gt; IOEnv (Env TcGblEnv TcLclEnv) a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="annot"><span class="annottext">Maybe GlobalRdrElt
</span><a href="#local-6989586621683035762"><span class="hs-identifier hs-var">p</span></a></span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-1388"></span><span>
</span><span id="line-1389"></span><span class="annot"><a href="GHC.Rename.Env.html#lookupGlobalOccRn_maybe"><span class="hs-identifier hs-type">lookupGlobalOccRn_maybe</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Types.Name.Reader.html#WhichGREs"><span class="hs-identifier hs-type">WhichGREs</span></a></span><span> </span><span class="annot"><a href="GHC.Types.GREInfo.html#GREInfo"><span class="hs-identifier hs-type">GREInfo</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Types.Name.Reader.html#RdrName"><span class="hs-identifier hs-type">RdrName</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#RnM"><span class="hs-identifier hs-type">RnM</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Maybe</span></span><span> </span><span class="annot"><a href="GHC.Types.Name.Reader.html#GlobalRdrElt"><span class="hs-identifier hs-type">GlobalRdrElt</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1390"></span><span class="hs-comment">-- Looks up a RdrName occurrence in the top-level</span><span>
</span><span id="line-1391"></span><span class="hs-comment">-- environment, including using lookupQualifiedNameGHCi</span><span>
</span><span id="line-1392"></span><span class="hs-comment">-- for the GHCi case, but first tries to find an Exact or Orig name.</span><span>
</span><span id="line-1393"></span><span class="hs-comment">-- No filter function; does not report an error on failure</span><span>
</span><span id="line-1394"></span><span class="hs-comment">-- See Note [Errors in lookup functions]</span><span>
</span><span id="line-1395"></span><span class="hs-comment">-- Uses addUsedRdrName to record use and deprecations</span><span>
</span><span id="line-1396"></span><span class="hs-comment">--</span><span>
</span><span id="line-1397"></span><span class="hs-comment">-- Used directly only by getLocalNonValBinders (new_assoc).</span><span>
</span><span id="line-1398"></span><span id="lookupGlobalOccRn_maybe"><span class="annot"><span class="annottext">lookupGlobalOccRn_maybe :: WhichGREs GREInfo -&gt; RdrName -&gt; RnM (Maybe GlobalRdrElt)
</span><a href="GHC.Rename.Env.html#lookupGlobalOccRn_maybe"><span class="hs-identifier hs-var hs-var">lookupGlobalOccRn_maybe</span></a></span></span><span> </span><span id="local-6989586621683035763"><span class="annot"><span class="annottext">WhichGREs GREInfo
</span><a href="#local-6989586621683035763"><span class="hs-identifier hs-var">which_gres</span></a></span></span><span> </span><span id="local-6989586621683035764"><span class="annot"><span class="annottext">RdrName
</span><a href="#local-6989586621683035764"><span class="hs-identifier hs-var">rdr_name</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-1399"></span><span>  </span><span class="annot"><span class="annottext">RdrName
-&gt; (Maybe GlobalRdrElt -&gt; Maybe GlobalRdrElt)
-&gt; RnM (Maybe GlobalRdrElt)
-&gt; RnM (Maybe GlobalRdrElt)
forall r. RdrName -&gt; (Maybe GlobalRdrElt -&gt; r) -&gt; RnM r -&gt; RnM r
</span><a href="GHC.Rename.Env.html#lookupExactOrOrig_maybe"><span class="hs-identifier hs-var">lookupExactOrOrig_maybe</span></a></span><span> </span><span class="annot"><span class="annottext">RdrName
</span><a href="#local-6989586621683035764"><span class="hs-identifier hs-var">rdr_name</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe GlobalRdrElt -&gt; Maybe GlobalRdrElt
forall a. a -&gt; a
</span><span class="hs-identifier hs-var">id</span></span><span> </span><span class="annot"><span class="annottext">(RnM (Maybe GlobalRdrElt) -&gt; RnM (Maybe GlobalRdrElt))
-&gt; RnM (Maybe GlobalRdrElt) -&gt; RnM (Maybe GlobalRdrElt)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-1400"></span><span>    </span><span class="annot"><span class="annottext">WhichGREs GREInfo -&gt; RdrName -&gt; RnM (Maybe GlobalRdrElt)
</span><a href="GHC.Rename.Env.html#lookupGlobalOccRn_base"><span class="hs-identifier hs-var">lookupGlobalOccRn_base</span></a></span><span> </span><span class="annot"><span class="annottext">WhichGREs GREInfo
</span><a href="#local-6989586621683035763"><span class="hs-identifier hs-var">which_gres</span></a></span><span> </span><span class="annot"><span class="annottext">RdrName
</span><a href="#local-6989586621683035764"><span class="hs-identifier hs-var">rdr_name</span></a></span><span>
</span><span id="line-1401"></span><span>
</span><span id="line-1402"></span><span class="annot"><a href="GHC.Rename.Env.html#lookupGlobalOccRn"><span class="hs-identifier hs-type">lookupGlobalOccRn</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Types.Name.Reader.html#RdrName"><span class="hs-identifier hs-type">RdrName</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#RnM"><span class="hs-identifier hs-type">RnM</span></a></span><span> </span><span class="annot"><a href="GHC.Types.Name.html#Name"><span class="hs-identifier hs-type">Name</span></a></span><span>
</span><span id="line-1403"></span><span class="hs-comment">-- lookupGlobalOccRn is like lookupOccRn, except that it looks in the global</span><span>
</span><span id="line-1404"></span><span class="hs-comment">-- environment.  Adds an error message if the RdrName is not in scope.</span><span>
</span><span id="line-1405"></span><span class="hs-comment">-- You usually want to use &quot;lookupOccRn&quot; which also looks in the local</span><span>
</span><span id="line-1406"></span><span class="hs-comment">-- environment.</span><span>
</span><span id="line-1407"></span><span class="hs-comment">--</span><span>
</span><span id="line-1408"></span><span class="hs-comment">-- Used by exports_from_avail</span><span>
</span><span id="line-1409"></span><span id="lookupGlobalOccRn"><span class="annot"><span class="annottext">lookupGlobalOccRn :: RdrName -&gt; RnM Name
</span><a href="GHC.Rename.Env.html#lookupGlobalOccRn"><span class="hs-identifier hs-var hs-var">lookupGlobalOccRn</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">WhichGREs GREInfo -&gt; RdrName -&gt; RnM Name
</span><a href="GHC.Rename.Env.html#lookupGlobalOccRn%27"><span class="hs-identifier hs-var">lookupGlobalOccRn'</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">FieldsOrSelectors -&gt; WhichGREs GREInfo
</span><a href="GHC.Types.Name.Reader.html#RelevantGREsFOS"><span class="hs-identifier hs-var">RelevantGREsFOS</span></a></span><span> </span><span class="annot"><span class="annottext">FieldsOrSelectors
</span><a href="GHC.Types.Name.Reader.html#WantNormal"><span class="hs-identifier hs-var">WantNormal</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1410"></span><span>
</span><span id="line-1411"></span><span class="annot"><a href="GHC.Rename.Env.html#lookupGlobalOccRn%27"><span class="hs-identifier hs-type">lookupGlobalOccRn'</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Types.Name.Reader.html#WhichGREs"><span class="hs-identifier hs-type">WhichGREs</span></a></span><span> </span><span class="annot"><a href="GHC.Types.GREInfo.html#GREInfo"><span class="hs-identifier hs-type">GREInfo</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Types.Name.Reader.html#RdrName"><span class="hs-identifier hs-type">RdrName</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#RnM"><span class="hs-identifier hs-type">RnM</span></a></span><span> </span><span class="annot"><a href="GHC.Types.Name.html#Name"><span class="hs-identifier hs-type">Name</span></a></span><span>
</span><span id="line-1412"></span><span id="lookupGlobalOccRn%27"><span class="annot"><span class="annottext">lookupGlobalOccRn' :: WhichGREs GREInfo -&gt; RdrName -&gt; RnM Name
</span><a href="GHC.Rename.Env.html#lookupGlobalOccRn%27"><span class="hs-identifier hs-var hs-var">lookupGlobalOccRn'</span></a></span></span><span> </span><span id="local-6989586621683035767"><span class="annot"><span class="annottext">WhichGREs GREInfo
</span><a href="#local-6989586621683035767"><span class="hs-identifier hs-var">which_gres</span></a></span></span><span> </span><span id="local-6989586621683035768"><span class="annot"><span class="annottext">RdrName
</span><a href="#local-6989586621683035768"><span class="hs-identifier hs-var">rdr_name</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-1413"></span><span>  </span><span class="annot"><span class="annottext">RdrName -&gt; (GlobalRdrElt -&gt; Name) -&gt; RnM Name -&gt; RnM Name
forall r. RdrName -&gt; (GlobalRdrElt -&gt; r) -&gt; RnM r -&gt; RnM r
</span><a href="GHC.Rename.Env.html#lookupExactOrOrig"><span class="hs-identifier hs-var">lookupExactOrOrig</span></a></span><span> </span><span class="annot"><span class="annottext">RdrName
</span><a href="#local-6989586621683035768"><span class="hs-identifier hs-var">rdr_name</span></a></span><span> </span><span class="annot"><span class="annottext">GlobalRdrElt -&gt; Name
forall info. GlobalRdrEltX info -&gt; Name
</span><a href="GHC.Types.Name.Reader.html#greName"><span class="hs-identifier hs-var">greName</span></a></span><span> </span><span class="annot"><span class="annottext">(RnM Name -&gt; RnM Name) -&gt; RnM Name -&gt; RnM Name
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-1414"></span><span>    </span><span id="local-6989586621683035769"><span class="annot"><a href="#local-6989586621683035769"><span class="hs-identifier hs-var">mb_gre</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">WhichGREs GREInfo -&gt; RdrName -&gt; RnM (Maybe GlobalRdrElt)
</span><a href="GHC.Rename.Env.html#lookupGlobalOccRn_base"><span class="hs-identifier hs-var">lookupGlobalOccRn_base</span></a></span><span> </span><span class="annot"><span class="annottext">WhichGREs GREInfo
</span><a href="#local-6989586621683035767"><span class="hs-identifier hs-var">which_gres</span></a></span><span> </span><span class="annot"><span class="annottext">RdrName
</span><a href="#local-6989586621683035768"><span class="hs-identifier hs-var">rdr_name</span></a></span><span>
</span><span id="line-1415"></span><span>    </span><span class="hs-keyword">case</span><span> </span><span class="annot"><a href="#local-6989586621683035769"><span class="hs-identifier hs-type">mb_gre</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-1416"></span><span>      </span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span id="local-6989586621683035770"><span class="annot"><span class="annottext">GlobalRdrElt
</span><a href="#local-6989586621683035770"><span class="hs-identifier hs-var">gre</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Name -&gt; RnM Name
forall a. a -&gt; IOEnv (Env TcGblEnv TcLclEnv) a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">GlobalRdrElt -&gt; Name
forall info. GlobalRdrEltX info -&gt; Name
</span><a href="GHC.Types.Name.Reader.html#greName"><span class="hs-identifier hs-var">greName</span></a></span><span> </span><span class="annot"><span class="annottext">GlobalRdrElt
</span><a href="#local-6989586621683035770"><span class="hs-identifier hs-var">gre</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1417"></span><span>      </span><span class="annot"><span class="annottext">Maybe GlobalRdrElt
</span><span class="hs-identifier hs-var">Nothing</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">String -&gt; SDoc -&gt; IOEnv (Env TcGblEnv TcLclEnv) ()
</span><a href="GHC.Tc.Utils.Monad.html#traceRn"><span class="hs-identifier hs-var">traceRn</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;lookupGlobalOccRn&quot;</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">RdrName -&gt; SDoc
forall a. Outputable a =&gt; a -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="annot"><span class="annottext">RdrName
</span><a href="#local-6989586621683035768"><span class="hs-identifier hs-var">rdr_name</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1418"></span><span>                    </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="annottext">LookingFor -&gt; RdrName -&gt; RnM Name
</span><a href="GHC.Rename.Unbound.html#unboundName"><span class="hs-identifier hs-var">unboundName</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">WhatLooking -&gt; WhereLooking -&gt; LookingFor
</span><a href="GHC.Rename.Unbound.html#LF"><span class="hs-identifier hs-var">LF</span></a></span><span> </span><span class="annot"><span class="annottext">WhatLooking
</span><a href="#local-6989586621683035771"><span class="hs-identifier hs-var">which_suggest</span></a></span><span> </span><span class="annot"><span class="annottext">WhereLooking
</span><a href="GHC.Rename.Unbound.html#WL_Global"><span class="hs-identifier hs-var">WL_Global</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">RdrName
</span><a href="#local-6989586621683035768"><span class="hs-identifier hs-var">rdr_name</span></a></span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-1419"></span><span>        </span><span class="hs-keyword">where</span><span> </span><span id="local-6989586621683035771"><span class="annot"><span class="annottext">which_suggest :: WhatLooking
</span><a href="#local-6989586621683035771"><span class="hs-identifier hs-var hs-var">which_suggest</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">WhichGREs GREInfo -&gt; FieldsOrSelectors
</span><a href="GHC.Types.Name.Reader.html#includeFieldSelectors"><span class="hs-identifier hs-var">includeFieldSelectors</span></a></span><span> </span><span class="annot"><span class="annottext">WhichGREs GREInfo
</span><a href="#local-6989586621683035767"><span class="hs-identifier hs-var">which_gres</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-1420"></span><span>                </span><span class="annot"><span class="annottext">FieldsOrSelectors
</span><a href="GHC.Types.Name.Reader.html#WantBoth"><span class="hs-identifier hs-var">WantBoth</span></a></span><span>   </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">WhatLooking
</span><a href="GHC.Rename.Unbound.html#WL_RecField"><span class="hs-identifier hs-var">WL_RecField</span></a></span><span>
</span><span id="line-1421"></span><span>                </span><span class="annot"><span class="annottext">FieldsOrSelectors
</span><a href="GHC.Types.Name.Reader.html#WantField"><span class="hs-identifier hs-var">WantField</span></a></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">WhatLooking
</span><a href="GHC.Rename.Unbound.html#WL_RecField"><span class="hs-identifier hs-var">WL_RecField</span></a></span><span>
</span><span id="line-1422"></span><span>                </span><span class="annot"><span class="annottext">FieldsOrSelectors
</span><a href="GHC.Types.Name.Reader.html#WantNormal"><span class="hs-identifier hs-var">WantNormal</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">WhatLooking
</span><a href="GHC.Rename.Unbound.html#WL_Anything"><span class="hs-identifier hs-var">WL_Anything</span></a></span><span>
</span><span id="line-1423"></span><span>
</span><span id="line-1424"></span><span class="hs-comment">-- Looks up a RdrName occurrence in the GlobalRdrEnv and with</span><span>
</span><span id="line-1425"></span><span class="hs-comment">-- lookupQualifiedNameGHCi. Does not try to find an Exact or Orig name first.</span><span>
</span><span id="line-1426"></span><span class="hs-comment">-- lookupQualifiedNameGHCi here is used when we're in GHCi and a name like</span><span>
</span><span id="line-1427"></span><span class="hs-comment">-- 'Data.Map.elems' is typed, even if you didn't import Data.Map</span><span>
</span><span id="line-1428"></span><span class="annot"><a href="GHC.Rename.Env.html#lookupGlobalOccRn_base"><span class="hs-identifier hs-type">lookupGlobalOccRn_base</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Types.Name.Reader.html#WhichGREs"><span class="hs-identifier hs-type">WhichGREs</span></a></span><span> </span><span class="annot"><a href="GHC.Types.GREInfo.html#GREInfo"><span class="hs-identifier hs-type">GREInfo</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Types.Name.Reader.html#RdrName"><span class="hs-identifier hs-type">RdrName</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#RnM"><span class="hs-identifier hs-type">RnM</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Maybe</span></span><span> </span><span class="annot"><a href="GHC.Types.Name.Reader.html#GlobalRdrElt"><span class="hs-identifier hs-type">GlobalRdrElt</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1429"></span><span id="lookupGlobalOccRn_base"><span class="annot"><span class="annottext">lookupGlobalOccRn_base :: WhichGREs GREInfo -&gt; RdrName -&gt; RnM (Maybe GlobalRdrElt)
</span><a href="GHC.Rename.Env.html#lookupGlobalOccRn_base"><span class="hs-identifier hs-var hs-var">lookupGlobalOccRn_base</span></a></span></span><span> </span><span id="local-6989586621683035774"><span class="annot"><span class="annottext">WhichGREs GREInfo
</span><a href="#local-6989586621683035774"><span class="hs-identifier hs-var">which_gres</span></a></span></span><span> </span><span id="local-6989586621683035775"><span class="annot"><span class="annottext">RdrName
</span><a href="#local-6989586621683035775"><span class="hs-identifier hs-var">rdr_name</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-1430"></span><span>    </span><span class="annot"><span class="annottext">MaybeT (IOEnv (Env TcGblEnv TcLclEnv)) GlobalRdrElt
-&gt; RnM (Maybe GlobalRdrElt)
forall (m :: * -&gt; *) a. MaybeT m a -&gt; m (Maybe a)
</span><a href="../../transformers-0.6.1.2-38b1/src/Control.Monad.Trans.Maybe.html#runMaybeT"><span class="hs-identifier hs-var">runMaybeT</span></a></span><span> </span><span class="annot"><span class="annottext">(MaybeT (IOEnv (Env TcGblEnv TcLclEnv)) GlobalRdrElt
 -&gt; RnM (Maybe GlobalRdrElt))
-&gt; ([RnM (Maybe GlobalRdrElt)]
    -&gt; MaybeT (IOEnv (Env TcGblEnv TcLclEnv)) GlobalRdrElt)
-&gt; [RnM (Maybe GlobalRdrElt)]
-&gt; RnM (Maybe GlobalRdrElt)
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">[MaybeT (IOEnv (Env TcGblEnv TcLclEnv)) GlobalRdrElt]
-&gt; MaybeT (IOEnv (Env TcGblEnv TcLclEnv)) GlobalRdrElt
forall (t :: * -&gt; *) (m :: * -&gt; *) a.
(Foldable t, MonadPlus m) =&gt;
t (m a) -&gt; m a
</span><span class="hs-identifier hs-var">msum</span></span><span> </span><span class="annot"><span class="annottext">([MaybeT (IOEnv (Env TcGblEnv TcLclEnv)) GlobalRdrElt]
 -&gt; MaybeT (IOEnv (Env TcGblEnv TcLclEnv)) GlobalRdrElt)
-&gt; ([RnM (Maybe GlobalRdrElt)]
    -&gt; [MaybeT (IOEnv (Env TcGblEnv TcLclEnv)) GlobalRdrElt])
-&gt; [RnM (Maybe GlobalRdrElt)]
-&gt; MaybeT (IOEnv (Env TcGblEnv TcLclEnv)) GlobalRdrElt
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">(RnM (Maybe GlobalRdrElt)
 -&gt; MaybeT (IOEnv (Env TcGblEnv TcLclEnv)) GlobalRdrElt)
-&gt; [RnM (Maybe GlobalRdrElt)]
-&gt; [MaybeT (IOEnv (Env TcGblEnv TcLclEnv)) GlobalRdrElt]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><span class="hs-identifier hs-var">map</span></span><span> </span><span class="annot"><span class="annottext">RnM (Maybe GlobalRdrElt)
-&gt; MaybeT (IOEnv (Env TcGblEnv TcLclEnv)) GlobalRdrElt
forall (m :: * -&gt; *) a. m (Maybe a) -&gt; MaybeT m a
</span><a href="../../transformers-0.6.1.2-38b1/src/Control.Monad.Trans.Maybe.html#MaybeT"><span class="hs-identifier hs-var">MaybeT</span></a></span><span> </span><span class="annot"><span class="annottext">([RnM (Maybe GlobalRdrElt)] -&gt; RnM (Maybe GlobalRdrElt))
-&gt; [RnM (Maybe GlobalRdrElt)] -&gt; RnM (Maybe GlobalRdrElt)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-1431"></span><span>    </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">WhichGREs GREInfo -&gt; RdrName -&gt; RnM (Maybe GlobalRdrElt)
</span><a href="GHC.Rename.Env.html#lookupGreRn_maybe"><span class="hs-identifier hs-var">lookupGreRn_maybe</span></a></span><span> </span><span class="annot"><span class="annottext">WhichGREs GREInfo
</span><a href="#local-6989586621683035774"><span class="hs-identifier hs-var">which_gres</span></a></span><span> </span><span class="annot"><span class="annottext">RdrName
</span><a href="#local-6989586621683035775"><span class="hs-identifier hs-var">rdr_name</span></a></span><span>
</span><span id="line-1432"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">FieldsOrSelectors -&gt; RdrName -&gt; RnM (Maybe GlobalRdrElt)
</span><a href="GHC.Rename.Env.html#lookupOneQualifiedNameGHCi"><span class="hs-identifier hs-var">lookupOneQualifiedNameGHCi</span></a></span><span> </span><span class="annot"><span class="annottext">FieldsOrSelectors
</span><a href="#local-6989586621683035778"><span class="hs-identifier hs-var">fos</span></a></span><span> </span><span class="annot"><span class="annottext">RdrName
</span><a href="#local-6989586621683035775"><span class="hs-identifier hs-var">rdr_name</span></a></span><span> </span><span class="hs-special">]</span><span>
</span><span id="line-1433"></span><span>                      </span><span class="hs-comment">-- This test is not expensive,</span><span>
</span><span id="line-1434"></span><span>                      </span><span class="hs-comment">-- and only happens for failed lookups</span><span>
</span><span id="line-1435"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-1436"></span><span>    </span><span id="local-6989586621683035778"><span class="annot"><span class="annottext">fos :: FieldsOrSelectors
</span><a href="#local-6989586621683035778"><span class="hs-identifier hs-var hs-var">fos</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">WhichGREs GREInfo
</span><a href="#local-6989586621683035774"><span class="hs-identifier hs-var">which_gres</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-1437"></span><span>      </span><span class="annot"><a href="GHC.Types.Name.Reader.html#RelevantGREs"><span class="hs-identifier hs-type">RelevantGREs</span></a></span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">includeFieldSelectors :: WhichGREs GREInfo -&gt; FieldsOrSelectors
</span><a href="GHC.Types.Name.Reader.html#includeFieldSelectors"><span class="hs-identifier hs-var">includeFieldSelectors</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="local-6989586621683035781"><span class="annot"><span class="annottext">FieldsOrSelectors
</span><a href="#local-6989586621683035781"><span class="hs-identifier hs-var">sel</span></a></span></span><span> </span><span class="hs-special">}</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">FieldsOrSelectors
</span><a href="#local-6989586621683035781"><span class="hs-identifier hs-var">sel</span></a></span><span>
</span><span id="line-1438"></span><span>      </span><span class="annot"><span class="annottext">WhichGREs GREInfo
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">if</span><span> </span><span class="annot"><span class="annottext">OccName -&gt; Bool
</span><a href="GHC.Types.Name.Occurrence.html#isFieldOcc"><span class="hs-identifier hs-var">isFieldOcc</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">RdrName -&gt; OccName
</span><a href="GHC.Types.Name.Reader.html#rdrNameOcc"><span class="hs-identifier hs-var">rdrNameOcc</span></a></span><span> </span><span class="annot"><span class="annottext">RdrName
</span><a href="#local-6989586621683035775"><span class="hs-identifier hs-var">rdr_name</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1439"></span><span>           </span><span class="hs-keyword">then</span><span> </span><span class="annot"><span class="annottext">FieldsOrSelectors
</span><a href="GHC.Types.Name.Reader.html#WantField"><span class="hs-identifier hs-var">WantField</span></a></span><span>
</span><span id="line-1440"></span><span>           </span><span class="hs-keyword">else</span><span> </span><span class="annot"><span class="annottext">FieldsOrSelectors
</span><a href="GHC.Types.Name.Reader.html#WantNormal"><span class="hs-identifier hs-var">WantNormal</span></a></span><span>
</span><span id="line-1441"></span><span>
</span><span id="line-1442"></span><span class="hs-comment">-- | Lookup a 'Name' in the 'GlobalRdrEnv', falling back to looking up</span><span>
</span><span id="line-1443"></span><span class="hs-comment">-- in the type environment it if fails.</span><span>
</span><span id="line-1444"></span><span class="annot"><a href="GHC.Rename.Env.html#lookupGREInfo_GRE"><span class="hs-identifier hs-type">lookupGREInfo_GRE</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Utils.Misc.html#HasDebugCallStack"><span class="hs-identifier hs-type">HasDebugCallStack</span></a></span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="GHC.Types.Name.html#Name"><span class="hs-identifier hs-type">Name</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#RnM"><span class="hs-identifier hs-type">RnM</span></a></span><span> </span><span class="annot"><a href="GHC.Types.GREInfo.html#GREInfo"><span class="hs-identifier hs-type">GREInfo</span></a></span><span>
</span><span id="line-1445"></span><span id="lookupGREInfo_GRE"><span class="annot"><span class="annottext">lookupGREInfo_GRE :: HasDebugCallStack =&gt; Name -&gt; RnM GREInfo
</span><a href="GHC.Rename.Env.html#lookupGREInfo_GRE"><span class="hs-identifier hs-var hs-var">lookupGREInfo_GRE</span></a></span></span><span> </span><span id="local-6989586621683035790"><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621683035790"><span class="hs-identifier hs-var">name</span></a></span></span><span>
</span><span id="line-1446"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span id="local-6989586621683035791"><span class="annot"><a href="#local-6989586621683035791"><span class="hs-identifier hs-var">rdr_env</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">TcRn GlobalRdrEnv
</span><a href="GHC.Tc.Utils.Monad.html#getGlobalRdrEnv"><span class="hs-identifier hs-var">getGlobalRdrEnv</span></a></span><span>
</span><span id="line-1447"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><a href="GHC.Types.Name.Reader.html#lookupGRE_Name"><span class="hs-identifier hs-type">lookupGRE_Name</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683035791"><span class="hs-identifier hs-type">rdr_env</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683035790"><span class="hs-identifier hs-type">name</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-1448"></span><span>          </span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span class="hs-special">(</span><span> </span><span class="annot"><a href="GHC.Types.Name.Reader.html#GRE"><span class="hs-identifier hs-type">GRE</span></a></span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">gre_info :: forall info. GlobalRdrEltX info -&gt; info
</span><a href="GHC.Types.Name.Reader.html#gre_info"><span class="hs-identifier hs-var">gre_info</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="local-6989586621683035795"><span class="annot"><span class="annottext">GREInfo
</span><a href="#local-6989586621683035795"><span class="hs-identifier hs-var">info</span></a></span></span><span> </span><span class="hs-special">}</span><span> </span><span class="hs-special">)</span><span>
</span><span id="line-1449"></span><span>            </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">GREInfo -&gt; RnM GREInfo
forall a. a -&gt; IOEnv (Env TcGblEnv TcLclEnv) a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="annot"><span class="annottext">GREInfo
</span><a href="#local-6989586621683035795"><span class="hs-identifier hs-var">info</span></a></span><span>
</span><span id="line-1450"></span><span>          </span><span class="annot"><span class="annottext">Maybe GlobalRdrElt
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span id="local-6989586621683035796"><span class="annot"><a href="#local-6989586621683035796"><span class="hs-identifier hs-var">hsc_env</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">TcRnIf TcGblEnv TcLclEnv HscEnv
forall gbl lcl. TcRnIf gbl lcl HscEnv
</span><a href="GHC.Tc.Utils.Monad.html#getTopEnv"><span class="hs-identifier hs-var">getTopEnv</span></a></span><span>
</span><span id="line-1451"></span><span>                  </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">return</span></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="annot"><a href="GHC.Rename.Env.html#lookupGREInfo"><span class="hs-identifier hs-type">lookupGREInfo</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683035796"><span class="hs-identifier hs-type">hsc_env</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683035790"><span class="hs-identifier hs-type">name</span></a></span><span> </span><span class="hs-special">}</span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-1452"></span><span>  </span><span class="hs-comment">-- Just looking in the GlobalRdrEnv is insufficient, as we also</span><span>
</span><span id="line-1453"></span><span>  </span><span class="hs-comment">-- need to handle qualified imports in GHCi; see e.g. T9815ghci.</span><span>
</span><span id="line-1454"></span><span>
</span><span id="line-1455"></span><span class="annot"><a href="GHC.Rename.Env.html#lookupInfoOccRn"><span class="hs-identifier hs-type">lookupInfoOccRn</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Types.Name.Reader.html#RdrName"><span class="hs-identifier hs-type">RdrName</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#RnM"><span class="hs-identifier hs-type">RnM</span></a></span><span> </span><span class="hs-special">[</span><span class="annot"><a href="GHC.Types.Name.html#Name"><span class="hs-identifier hs-type">Name</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-1456"></span><span class="hs-comment">-- ^ lookupInfoOccRn is intended for use in GHCi's &quot;:info&quot; command</span><span>
</span><span id="line-1457"></span><span class="hs-comment">-- It finds all the GREs that RdrName could mean, not complaining</span><span>
</span><span id="line-1458"></span><span class="hs-comment">-- about ambiguity, but rather returning them all (c.f. #9881).</span><span>
</span><span id="line-1459"></span><span class="hs-comment">--</span><span>
</span><span id="line-1460"></span><span class="hs-comment">-- lookupInfoOccRn is also used in situations where we check for</span><span>
</span><span id="line-1461"></span><span class="hs-comment">-- at least one definition of the RdrName, not complaining about</span><span>
</span><span id="line-1462"></span><span class="hs-comment">-- multiple definitions (see #17832).</span><span>
</span><span id="line-1463"></span><span id="lookupInfoOccRn"><span class="annot"><span class="annottext">lookupInfoOccRn :: RdrName -&gt; RnM [Name]
</span><a href="GHC.Rename.Env.html#lookupInfoOccRn"><span class="hs-identifier hs-var hs-var">lookupInfoOccRn</span></a></span></span><span> </span><span id="local-6989586621683035798"><span class="annot"><span class="annottext">RdrName
</span><a href="#local-6989586621683035798"><span class="hs-identifier hs-var">rdr_name</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-1464"></span><span>  </span><span class="annot"><span class="annottext">RdrName -&gt; (GlobalRdrElt -&gt; [Name]) -&gt; RnM [Name] -&gt; RnM [Name]
forall r. RdrName -&gt; (GlobalRdrElt -&gt; r) -&gt; RnM r -&gt; RnM r
</span><a href="GHC.Rename.Env.html#lookupExactOrOrig"><span class="hs-identifier hs-var">lookupExactOrOrig</span></a></span><span> </span><span class="annot"><span class="annottext">RdrName
</span><a href="#local-6989586621683035798"><span class="hs-identifier hs-var">rdr_name</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span> </span><span id="local-6989586621683035799"><span class="annot"><span class="annottext">GlobalRdrElt
</span><a href="#local-6989586621683035799"><span class="hs-identifier hs-var">gre</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">GlobalRdrElt -&gt; Name
forall info. GlobalRdrEltX info -&gt; Name
</span><a href="GHC.Types.Name.Reader.html#greName"><span class="hs-identifier hs-var">greName</span></a></span><span> </span><span class="annot"><span class="annottext">GlobalRdrElt
</span><a href="#local-6989586621683035799"><span class="hs-identifier hs-var">gre</span></a></span><span class="hs-special">]</span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(RnM [Name] -&gt; RnM [Name]) -&gt; RnM [Name] -&gt; RnM [Name]
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-1465"></span><span>    </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span id="local-6989586621683035800"><span class="annot"><a href="#local-6989586621683035800"><span class="hs-identifier hs-var">rdr_env</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">TcRn GlobalRdrEnv
</span><a href="GHC.Tc.Utils.Monad.html#getGlobalRdrEnv"><span class="hs-identifier hs-var">getGlobalRdrEnv</span></a></span><span>
</span><span id="line-1466"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621683035801"><span class="annot"><a href="#local-6989586621683035801"><span class="hs-identifier hs-var hs-var">nms</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(GlobalRdrElt -&gt; Name) -&gt; [GlobalRdrElt] -&gt; [Name]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><span class="hs-identifier hs-var">map</span></span><span> </span><span class="annot"><span class="annottext">GlobalRdrElt -&gt; Name
forall info. GlobalRdrEltX info -&gt; Name
</span><a href="GHC.Types.Name.Reader.html#greName"><span class="hs-identifier hs-var">greName</span></a></span><span> </span><span class="annot"><span class="annottext">([GlobalRdrElt] -&gt; [Name]) -&gt; [GlobalRdrElt] -&gt; [Name]
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">GlobalRdrEnv -&gt; LookupGRE GREInfo -&gt; [GlobalRdrElt]
forall info.
GlobalRdrEnvX info -&gt; LookupGRE info -&gt; [GlobalRdrEltX info]
</span><a href="GHC.Types.Name.Reader.html#lookupGRE"><span class="hs-identifier hs-var">lookupGRE</span></a></span><span> </span><span class="annot"><span class="annottext">GlobalRdrEnv
</span><a href="#local-6989586621683035800"><span class="hs-identifier hs-var">rdr_env</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">RdrName -&gt; WhichGREs GREInfo -&gt; LookupGRE GREInfo
forall info. RdrName -&gt; WhichGREs info -&gt; LookupGRE info
</span><a href="GHC.Types.Name.Reader.html#LookupRdrName"><span class="hs-identifier hs-var">LookupRdrName</span></a></span><span> </span><span class="annot"><span class="annottext">RdrName
</span><a href="#local-6989586621683035798"><span class="hs-identifier hs-var">rdr_name</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">FieldsOrSelectors -&gt; WhichGREs GREInfo
</span><a href="GHC.Types.Name.Reader.html#RelevantGREsFOS"><span class="hs-identifier hs-var">RelevantGREsFOS</span></a></span><span> </span><span class="annot"><span class="annottext">FieldsOrSelectors
</span><a href="GHC.Types.Name.Reader.html#WantBoth"><span class="hs-identifier hs-var">WantBoth</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-1467"></span><span>       </span><span class="hs-special">;</span><span> </span><span id="local-6989586621683035802"><span class="annot"><a href="#local-6989586621683035802"><span class="hs-identifier hs-var">qual_nms</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="hs-identifier hs-type">map</span></span><span> </span><span class="annot"><a href="GHC.Types.Name.Reader.html#greName"><span class="hs-identifier hs-type">greName</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">&lt;$&gt;</span></span><span> </span><span class="annot"><a href="GHC.Rename.Env.html#lookupQualifiedNameGHCi"><span class="hs-identifier hs-type">lookupQualifiedNameGHCi</span></a></span><span> </span><span class="annot"><a href="GHC.Types.Name.Reader.html#WantBoth"><span class="hs-identifier hs-type">WantBoth</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683035798"><span class="hs-identifier hs-type">rdr_name</span></a></span><span>
</span><span id="line-1468"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">return</span></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="annot"><a href="#local-6989586621683035801"><span class="hs-identifier hs-type">nms</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">++</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621683035802"><span class="hs-identifier hs-type">qual_nms</span></a></span><span> </span><span class="annot"><a href="GHC.Data.List.SetOps.html#minusList"><span class="hs-operator hs-type">`minusList`</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683035801"><span class="hs-identifier hs-type">nms</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-1469"></span><span>
</span><span id="line-1470"></span><span class="hs-comment">-- | Look up all record field names, available in the 'GlobalRdrEnv',</span><span>
</span><span id="line-1471"></span><span class="hs-comment">-- that a given 'RdrName' might refer to.</span><span>
</span><span id="line-1472"></span><span class="hs-comment">-- (Also includes implicit qualified imports in GHCi).</span><span>
</span><span id="line-1473"></span><span class="hs-comment">--</span><span>
</span><span id="line-1474"></span><span class="hs-comment">-- Throws an error if no fields are found.</span><span>
</span><span id="line-1475"></span><span class="hs-comment">--</span><span>
</span><span id="line-1476"></span><span class="hs-comment">-- See Note [DisambiguateRecordFields for updates].</span><span>
</span><span id="line-1477"></span><span class="annot"><a href="GHC.Rename.Env.html#lookupFieldGREs"><span class="hs-identifier hs-type">lookupFieldGREs</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Types.Name.Reader.html#GlobalRdrEnv"><span class="hs-identifier hs-type">GlobalRdrEnv</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Parser.Annotation.html#LocatedN"><span class="hs-identifier hs-type">LocatedN</span></a></span><span> </span><span class="annot"><a href="GHC.Types.Name.Reader.html#RdrName"><span class="hs-identifier hs-type">RdrName</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#RnM"><span class="hs-identifier hs-type">RnM</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">NE.NonEmpty</span></span><span> </span><span class="annot"><a href="GHC.Types.Name.Reader.html#FieldGlobalRdrElt"><span class="hs-identifier hs-type">FieldGlobalRdrElt</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1478"></span><span id="lookupFieldGREs"><span class="annot"><span class="annottext">lookupFieldGREs :: GlobalRdrEnv -&gt; LocatedN RdrName -&gt; RnM (NonEmpty GlobalRdrElt)
</span><a href="GHC.Rename.Env.html#lookupFieldGREs"><span class="hs-identifier hs-var hs-var">lookupFieldGREs</span></a></span></span><span> </span><span id="local-6989586621683035806"><span class="annot"><span class="annottext">GlobalRdrEnv
</span><a href="#local-6989586621683035806"><span class="hs-identifier hs-var">env</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Types.SrcLoc.html#L"><span class="hs-identifier hs-type">L</span></a></span><span> </span><span id="local-6989586621683035807"><span class="annot"><span class="annottext">SrcSpanAnnN
</span><a href="#local-6989586621683035807"><span class="hs-identifier hs-var">loc</span></a></span></span><span> </span><span id="local-6989586621683035808"><span class="annot"><span class="annottext">RdrName
</span><a href="#local-6989586621683035808"><span class="hs-identifier hs-var">rdr</span></a></span></span><span class="hs-special">)</span><span>
</span><span id="line-1479"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">SrcSpanAnnN
-&gt; RnM (NonEmpty GlobalRdrElt) -&gt; RnM (NonEmpty GlobalRdrElt)
forall ann a. EpAnn ann -&gt; TcRn a -&gt; TcRn a
</span><a href="GHC.Tc.Utils.Monad.html#setSrcSpanA"><span class="hs-identifier hs-var">setSrcSpanA</span></a></span><span> </span><span class="annot"><span class="annottext">SrcSpanAnnN
</span><a href="#local-6989586621683035807"><span class="hs-identifier hs-var">loc</span></a></span><span>
</span><span id="line-1480"></span><span>  </span><span class="annot"><span class="annottext">(RnM (NonEmpty GlobalRdrElt) -&gt; RnM (NonEmpty GlobalRdrElt))
-&gt; RnM (NonEmpty GlobalRdrElt) -&gt; RnM (NonEmpty GlobalRdrElt)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span id="local-6989586621683035810"><span class="annot"><a href="#local-6989586621683035810"><span class="hs-identifier hs-var">res</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">RdrName
-&gt; (GlobalRdrElt -&gt; [GlobalRdrElt])
-&gt; IOEnv (Env TcGblEnv TcLclEnv) [GlobalRdrElt]
-&gt; IOEnv (Env TcGblEnv TcLclEnv) [GlobalRdrElt]
forall r. RdrName -&gt; (GlobalRdrElt -&gt; r) -&gt; RnM r -&gt; RnM r
</span><a href="GHC.Rename.Env.html#lookupExactOrOrig"><span class="hs-identifier hs-var">lookupExactOrOrig</span></a></span><span> </span><span class="annot"><span class="annottext">RdrName
</span><a href="#local-6989586621683035808"><span class="hs-identifier hs-var">rdr</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span> </span><span id="local-6989586621683035811"><span class="annot"><span class="annottext">GlobalRdrElt
</span><a href="#local-6989586621683035811"><span class="hs-identifier hs-var">gre</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Maybe GlobalRdrElt -&gt; [GlobalRdrElt]
forall a. Maybe a -&gt; [a]
</span><span class="hs-identifier hs-var">maybeToList</span></span><span> </span><span class="annot"><span class="annottext">(Maybe GlobalRdrElt -&gt; [GlobalRdrElt])
-&gt; Maybe GlobalRdrElt -&gt; [GlobalRdrElt]
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">GlobalRdrElt -&gt; Maybe GlobalRdrElt
</span><a href="GHC.Types.Name.Reader.html#fieldGRE_maybe"><span class="hs-identifier hs-var">fieldGRE_maybe</span></a></span><span> </span><span class="annot"><span class="annottext">GlobalRdrElt
</span><a href="#local-6989586621683035811"><span class="hs-identifier hs-var">gre</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(IOEnv (Env TcGblEnv TcLclEnv) [GlobalRdrElt]
 -&gt; IOEnv (Env TcGblEnv TcLclEnv) [GlobalRdrElt])
-&gt; IOEnv (Env TcGblEnv TcLclEnv) [GlobalRdrElt]
-&gt; IOEnv (Env TcGblEnv TcLclEnv) [GlobalRdrElt]
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-1481"></span><span>           </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span class="hs-keyword">let</span><span> </span><span class="hs-special">(</span><span id="local-6989586621683035814"><span class="annot"><span class="annottext">[GlobalRdrElt]
</span><a href="#local-6989586621683035814"><span class="hs-identifier hs-var hs-var">env_fld_gres</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621683035815"><span class="annot"><span class="annottext">[GlobalRdrElt]
</span><a href="#local-6989586621683035815"><span class="hs-identifier hs-var hs-var">env_var_gres</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-1482"></span><span>                      </span><span class="annot"><span class="annottext">(GlobalRdrElt -&gt; Bool)
-&gt; [GlobalRdrElt] -&gt; ([GlobalRdrElt], [GlobalRdrElt])
forall a. (a -&gt; Bool) -&gt; [a] -&gt; ([a], [a])
</span><span class="hs-identifier hs-var">partition</span></span><span> </span><span class="annot"><span class="annottext">GlobalRdrElt -&gt; Bool
forall info. GlobalRdrEltX info -&gt; Bool
</span><a href="GHC.Types.Name.Reader.html#isRecFldGRE"><span class="hs-identifier hs-var">isRecFldGRE</span></a></span><span> </span><span class="annot"><span class="annottext">([GlobalRdrElt] -&gt; ([GlobalRdrElt], [GlobalRdrElt]))
-&gt; [GlobalRdrElt] -&gt; ([GlobalRdrElt], [GlobalRdrElt])
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-1483"></span><span>                      </span><span class="annot"><span class="annottext">GlobalRdrEnv -&gt; LookupGRE GREInfo -&gt; [GlobalRdrElt]
forall info.
GlobalRdrEnvX info -&gt; LookupGRE info -&gt; [GlobalRdrEltX info]
</span><a href="GHC.Types.Name.Reader.html#lookupGRE"><span class="hs-identifier hs-var">lookupGRE</span></a></span><span> </span><span class="annot"><span class="annottext">GlobalRdrEnv
</span><a href="#local-6989586621683035806"><span class="hs-identifier hs-var">env</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">RdrName -&gt; WhichGREs GREInfo -&gt; LookupGRE GREInfo
forall info. RdrName -&gt; WhichGREs info -&gt; LookupGRE info
</span><a href="GHC.Types.Name.Reader.html#LookupRdrName"><span class="hs-identifier hs-var">LookupRdrName</span></a></span><span> </span><span class="annot"><span class="annottext">RdrName
</span><a href="#local-6989586621683035808"><span class="hs-identifier hs-var">rdr</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">FieldsOrSelectors -&gt; WhichGREs GREInfo
</span><a href="GHC.Types.Name.Reader.html#RelevantGREsFOS"><span class="hs-identifier hs-var">RelevantGREsFOS</span></a></span><span> </span><span class="annot"><span class="annottext">FieldsOrSelectors
</span><a href="GHC.Types.Name.Reader.html#WantBoth"><span class="hs-identifier hs-var">WantBoth</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-1484"></span><span>
</span><span id="line-1485"></span><span>              </span><span class="hs-comment">-- Handle implicit qualified imports in GHCi. See T10439.</span><span>
</span><span id="line-1486"></span><span>              </span><span class="hs-special">;</span><span> </span><span id="local-6989586621683035816"><span class="annot"><a href="#local-6989586621683035816"><span class="hs-identifier hs-var">ghci_gres</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">HasDebugCallStack =&gt;
FieldsOrSelectors
-&gt; RdrName -&gt; IOEnv (Env TcGblEnv TcLclEnv) [GlobalRdrElt]
FieldsOrSelectors
-&gt; RdrName -&gt; IOEnv (Env TcGblEnv TcLclEnv) [GlobalRdrElt]
</span><a href="GHC.Rename.Env.html#lookupQualifiedNameGHCi"><span class="hs-identifier hs-var">lookupQualifiedNameGHCi</span></a></span><span> </span><span class="annot"><span class="annottext">FieldsOrSelectors
</span><a href="GHC.Types.Name.Reader.html#WantBoth"><span class="hs-identifier hs-var">WantBoth</span></a></span><span> </span><span class="annot"><span class="annottext">RdrName
</span><a href="#local-6989586621683035808"><span class="hs-identifier hs-var">rdr</span></a></span><span>
</span><span id="line-1487"></span><span>              </span><span class="hs-special">;</span><span> </span><span class="hs-keyword">let</span><span> </span><span class="hs-special">(</span><span id="local-6989586621683035817"><span class="annot"><a href="#local-6989586621683035817"><span class="hs-identifier hs-var">ghci_fld_gres</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621683035818"><span class="annot"><a href="#local-6989586621683035818"><span class="hs-identifier hs-var">ghci_var_gres</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-1488"></span><span>                      </span><span class="annot"><span class="hs-identifier hs-type">partition</span></span><span> </span><span class="annot"><a href="GHC.Types.Name.Reader.html#isRecFldGRE"><span class="hs-identifier hs-type">isRecFldGRE</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span>
</span><span id="line-1489"></span><span>                      </span><span class="annot"><a href="#local-6989586621683035816"><span class="hs-identifier hs-type">ghci_gres</span></a></span><span>
</span><span id="line-1490"></span><span>
</span><span id="line-1491"></span><span>              </span><span class="hs-special">;</span><span> </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621683035819"><span class="annot"><a href="#local-6989586621683035819"><span class="hs-identifier hs-var hs-var">fld_gres</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[GlobalRdrElt]
</span><a href="#local-6989586621683035817"><span class="hs-identifier hs-var">ghci_fld_gres</span></a></span><span> </span><span class="annot"><span class="annottext">[GlobalRdrElt] -&gt; [GlobalRdrElt] -&gt; [GlobalRdrElt]
forall a. [a] -&gt; [a] -&gt; [a]
</span><span class="hs-operator hs-var">++</span></span><span> </span><span class="annot"><span class="annottext">[GlobalRdrElt]
</span><a href="#local-6989586621683035814"><span class="hs-identifier hs-var">env_fld_gres</span></a></span><span>
</span><span id="line-1492"></span><span>                    </span><span id="local-6989586621683035820"><span class="annot"><a href="#local-6989586621683035820"><span class="hs-identifier hs-var hs-var">var_gres</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[GlobalRdrElt]
</span><a href="#local-6989586621683035818"><span class="hs-identifier hs-var">ghci_var_gres</span></a></span><span> </span><span class="annot"><span class="annottext">[GlobalRdrElt] -&gt; [GlobalRdrElt] -&gt; [GlobalRdrElt]
forall a. [a] -&gt; [a] -&gt; [a]
</span><span class="hs-operator hs-var">++</span></span><span> </span><span class="annot"><span class="annottext">[GlobalRdrElt]
</span><a href="#local-6989586621683035815"><span class="hs-identifier hs-var">env_var_gres</span></a></span><span>
</span><span id="line-1493"></span><span>
</span><span id="line-1494"></span><span>              </span><span class="hs-comment">-- Add an error for ambiguity when -XDisambiguateRecordFields is off.</span><span>
</span><span id="line-1495"></span><span>              </span><span class="hs-comment">--</span><span>
</span><span id="line-1496"></span><span>              </span><span class="hs-comment">-- See Note [DisambiguateRecordFields for updates].</span><span>
</span><span id="line-1497"></span><span>              </span><span class="hs-special">;</span><span> </span><span id="local-6989586621683035821"><span class="annot"><a href="#local-6989586621683035821"><span class="hs-identifier hs-var">disamb_ok</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.Monad.html#xoptM"><span class="hs-identifier hs-type">xoptM</span></a></span><span> </span><span class="annot"><span class="hs-identifier hs-type">LangExt.DisambiguateRecordFields</span></span><span>
</span><span id="line-1498"></span><span>              </span><span class="hs-special">;</span><span>  </span><span class="hs-keyword">if</span><span> </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="hs-identifier hs-type">not</span></span><span> </span><span class="annot"><a href="#local-6989586621683035821"><span class="hs-identifier hs-type">disamb_ok</span></a></span><span>
</span><span id="line-1499"></span><span>                    </span><span class="hs-special">,</span><span> </span><span id="local-6989586621683035824"><span class="annot"><a href="#local-6989586621683035824"><span class="hs-identifier hs-var">gre1</span></a></span></span><span> </span><span class="annot"><span class="hs-glyph hs-type">:</span></span><span> </span><span id="local-6989586621683035825"><span class="annot"><a href="#local-6989586621683035825"><span class="hs-identifier hs-var">gre2</span></a></span></span><span> </span><span class="annot"><span class="hs-glyph hs-type">:</span></span><span> </span><span id="local-6989586621683035826"><span class="annot"><a href="#local-6989586621683035826"><span class="hs-identifier hs-var">others</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><a href="#local-6989586621683035819"><span class="hs-identifier hs-type">fld_gres</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">++</span></span><span> </span><span class="annot"><a href="#local-6989586621683035820"><span class="hs-identifier hs-type">var_gres</span></a></span><span>
</span><span id="line-1500"></span><span>                    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.Monad.html#addErrTc"><span class="hs-identifier hs-type">addErrTc</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="annot"><a href="GHC.Tc.Errors.Types.html#TcRnAmbiguousFieldInUpdate"><span class="hs-identifier hs-type">TcRnAmbiguousFieldInUpdate</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621683035824"><span class="hs-identifier hs-type">gre1</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="#local-6989586621683035825"><span class="hs-identifier hs-type">gre2</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="#local-6989586621683035826"><span class="hs-identifier hs-type">others</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1501"></span><span>                    </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="hs-identifier hs-type">otherwise</span></span><span>
</span><span id="line-1502"></span><span>                    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">return</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-1503"></span><span>              </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">return</span></span><span> </span><span class="annot"><a href="#local-6989586621683035819"><span class="hs-identifier hs-type">fld_gres</span></a></span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-1504"></span><span>
</span><span id="line-1505"></span><span>       </span><span class="hs-comment">-- Add an error if lookup failed.</span><span>
</span><span id="line-1506"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><a href="#local-6989586621683035810"><span class="hs-identifier hs-type">res</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-1507"></span><span>          </span><span id="local-6989586621683035829"><span class="annot"><span class="annottext">GlobalRdrElt
</span><a href="#local-6989586621683035829"><span class="hs-identifier hs-var">gre</span></a></span></span><span> </span><span class="annot"><span class="hs-glyph hs-type">:</span></span><span> </span><span id="local-6989586621683035830"><span class="annot"><span class="annottext">[GlobalRdrElt]
</span><a href="#local-6989586621683035830"><span class="hs-identifier hs-var">gres</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">NonEmpty GlobalRdrElt -&gt; RnM (NonEmpty GlobalRdrElt)
forall a. a -&gt; IOEnv (Env TcGblEnv TcLclEnv) a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="annot"><span class="annottext">(NonEmpty GlobalRdrElt -&gt; RnM (NonEmpty GlobalRdrElt))
-&gt; NonEmpty GlobalRdrElt -&gt; RnM (NonEmpty GlobalRdrElt)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">GlobalRdrElt
</span><a href="#local-6989586621683035829"><span class="hs-identifier hs-var">gre</span></a></span><span> </span><span class="annot"><span class="annottext">GlobalRdrElt -&gt; [GlobalRdrElt] -&gt; NonEmpty GlobalRdrElt
forall a. a -&gt; [a] -&gt; NonEmpty a
</span><span class="hs-operator hs-var">NE.:|</span></span><span> </span><span class="annot"><span class="annottext">[GlobalRdrElt]
</span><a href="#local-6989586621683035830"><span class="hs-identifier hs-var">gres</span></a></span><span>
</span><span id="line-1508"></span><span>          </span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span class="hs-special">(</span><span id="local-6989586621683035831"><span class="annot"><a href="#local-6989586621683035831"><span class="hs-identifier hs-var">imp_errs</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621683035832"><span class="annot"><a href="#local-6989586621683035832"><span class="hs-identifier hs-var">hints</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span>
</span><span id="line-1509"></span><span>                       </span><span class="annot"><span class="annottext">LocalRdrEnv
-&gt; WhatLooking -&gt; RdrName -&gt; RnM ([ImportError], [GhcHint])
</span><a href="GHC.Rename.Unbound.html#unknownNameSuggestions"><span class="hs-identifier hs-var">unknownNameSuggestions</span></a></span><span> </span><span class="annot"><span class="annottext">LocalRdrEnv
</span><a href="GHC.Types.Name.Reader.html#emptyLocalRdrEnv"><span class="hs-identifier hs-var">emptyLocalRdrEnv</span></a></span><span> </span><span class="annot"><span class="annottext">WhatLooking
</span><a href="GHC.Rename.Unbound.html#WL_RecField"><span class="hs-identifier hs-var">WL_RecField</span></a></span><span> </span><span class="annot"><span class="annottext">RdrName
</span><a href="#local-6989586621683035808"><span class="hs-identifier hs-var">rdr</span></a></span><span>
</span><span id="line-1510"></span><span>                   </span><span class="hs-special">;</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.Monad.html#failWithTc"><span class="hs-identifier hs-type">failWithTc</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span>
</span><span id="line-1511"></span><span>                       </span><span class="annot"><a href="GHC.Tc.Errors.Types.html#TcRnNotInScope"><span class="hs-identifier hs-type">TcRnNotInScope</span></a></span><span> </span><span class="annot"><a href="GHC.Tc.Errors.Types.html#NotARecordField"><span class="hs-identifier hs-type">NotARecordField</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683035808"><span class="hs-identifier hs-type">rdr</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683035831"><span class="hs-identifier hs-type">imp_errs</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683035832"><span class="hs-identifier hs-type">hints</span></a></span><span> </span><span class="hs-special">}</span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-1512"></span><span>
</span><span id="line-1513"></span><span class="hs-comment">-- | Look up a 'RdrName', which might refer to an overloaded record field.</span><span>
</span><span id="line-1514"></span><span class="hs-comment">--</span><span>
</span><span id="line-1515"></span><span class="hs-comment">-- Don't allow any ambiguity: emit a name-clash error if there are multiple</span><span>
</span><span id="line-1516"></span><span class="hs-comment">-- matching GREs.</span><span>
</span><span id="line-1517"></span><span class="annot"><a href="GHC.Rename.Env.html#lookupGlobalOccRn_overloaded"><span class="hs-identifier hs-type">lookupGlobalOccRn_overloaded</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Types.Name.Reader.html#RdrName"><span class="hs-identifier hs-type">RdrName</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#RnM"><span class="hs-identifier hs-type">RnM</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Maybe</span></span><span> </span><span class="annot"><a href="GHC.Types.Name.Reader.html#GlobalRdrElt"><span class="hs-identifier hs-type">GlobalRdrElt</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1518"></span><span id="lookupGlobalOccRn_overloaded"><span class="annot"><span class="annottext">lookupGlobalOccRn_overloaded :: RdrName -&gt; RnM (Maybe GlobalRdrElt)
</span><a href="GHC.Rename.Env.html#lookupGlobalOccRn_overloaded"><span class="hs-identifier hs-var hs-var">lookupGlobalOccRn_overloaded</span></a></span></span><span> </span><span id="local-6989586621683035838"><span class="annot"><span class="annottext">RdrName
</span><a href="#local-6989586621683035838"><span class="hs-identifier hs-var">rdr_name</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-1519"></span><span>  </span><span class="annot"><span class="annottext">RdrName
-&gt; (Maybe GlobalRdrElt -&gt; Maybe GlobalRdrElt)
-&gt; RnM (Maybe GlobalRdrElt)
-&gt; RnM (Maybe GlobalRdrElt)
forall r. RdrName -&gt; (Maybe GlobalRdrElt -&gt; r) -&gt; RnM r -&gt; RnM r
</span><a href="GHC.Rename.Env.html#lookupExactOrOrig_maybe"><span class="hs-identifier hs-var">lookupExactOrOrig_maybe</span></a></span><span> </span><span class="annot"><span class="annottext">RdrName
</span><a href="#local-6989586621683035838"><span class="hs-identifier hs-var">rdr_name</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe GlobalRdrElt -&gt; Maybe GlobalRdrElt
forall a. a -&gt; a
</span><span class="hs-identifier hs-var">id</span></span><span> </span><span class="annot"><span class="annottext">(RnM (Maybe GlobalRdrElt) -&gt; RnM (Maybe GlobalRdrElt))
-&gt; RnM (Maybe GlobalRdrElt) -&gt; RnM (Maybe GlobalRdrElt)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-1520"></span><span>    </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span id="local-6989586621683035839"><span class="annot"><a href="#local-6989586621683035839"><span class="hs-identifier hs-var">res</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">WhichGREs GREInfo
-&gt; RdrName -&gt; DeprecationWarnings -&gt; RnM GreLookupResult
</span><a href="GHC.Rename.Env.html#lookupGreRn_helper"><span class="hs-identifier hs-var">lookupGreRn_helper</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">FieldsOrSelectors -&gt; WhichGREs GREInfo
</span><a href="GHC.Types.Name.Reader.html#RelevantGREsFOS"><span class="hs-identifier hs-var">RelevantGREsFOS</span></a></span><span> </span><span class="annot"><span class="annottext">FieldsOrSelectors
</span><a href="GHC.Types.Name.Reader.html#WantNormal"><span class="hs-identifier hs-var">WantNormal</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">RdrName
</span><a href="#local-6989586621683035838"><span class="hs-identifier hs-var">rdr_name</span></a></span><span> </span><span class="annot"><span class="annottext">DeprecationWarnings
</span><a href="GHC.Rename.Utils.html#AllDeprecationWarnings"><span class="hs-identifier hs-var">AllDeprecationWarnings</span></a></span><span>
</span><span id="line-1521"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><a href="#local-6989586621683035839"><span class="hs-identifier hs-type">res</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-1522"></span><span>           </span><span class="annot"><span class="annottext">GreLookupResult
</span><a href="GHC.Rename.Env.html#GreNotFound"><span class="hs-identifier hs-var">GreNotFound</span></a></span><span>        </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">FieldsOrSelectors -&gt; RdrName -&gt; RnM (Maybe GlobalRdrElt)
</span><a href="GHC.Rename.Env.html#lookupOneQualifiedNameGHCi"><span class="hs-identifier hs-var">lookupOneQualifiedNameGHCi</span></a></span><span> </span><span class="annot"><span class="annottext">FieldsOrSelectors
</span><a href="GHC.Types.Name.Reader.html#WantNormal"><span class="hs-identifier hs-var">WantNormal</span></a></span><span> </span><span class="annot"><span class="annottext">RdrName
</span><a href="#local-6989586621683035838"><span class="hs-identifier hs-var">rdr_name</span></a></span><span>
</span><span id="line-1523"></span><span>           </span><span class="annot"><a href="GHC.Rename.Env.html#OneNameMatch"><span class="hs-identifier hs-type">OneNameMatch</span></a></span><span> </span><span id="local-6989586621683035843"><span class="annot"><span class="annottext">GlobalRdrElt
</span><a href="#local-6989586621683035843"><span class="hs-identifier hs-var">gre</span></a></span></span><span>   </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Maybe GlobalRdrElt -&gt; RnM (Maybe GlobalRdrElt)
forall a. a -&gt; IOEnv (Env TcGblEnv TcLclEnv) a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="annot"><span class="annottext">(Maybe GlobalRdrElt -&gt; RnM (Maybe GlobalRdrElt))
-&gt; Maybe GlobalRdrElt -&gt; RnM (Maybe GlobalRdrElt)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">GlobalRdrElt -&gt; Maybe GlobalRdrElt
forall a. a -&gt; Maybe a
</span><span class="hs-identifier hs-var">Just</span></span><span> </span><span class="annot"><span class="annottext">GlobalRdrElt
</span><a href="#local-6989586621683035843"><span class="hs-identifier hs-var">gre</span></a></span><span>
</span><span id="line-1524"></span><span>           </span><span class="annot"><a href="GHC.Rename.Env.html#MultipleNames"><span class="hs-identifier hs-type">MultipleNames</span></a></span><span> </span><span id="local-6989586621683035845"><span class="annot"><span class="annottext">gres :: NonEmpty GlobalRdrElt
</span><a href="#local-6989586621683035845"><span class="hs-identifier hs-var">gres</span></a></span></span><span class="hs-glyph">@</span><span class="hs-special">(</span><span id="local-6989586621683035846"><span class="annot"><span class="annottext">GlobalRdrElt
</span><a href="#local-6989586621683035846"><span class="hs-identifier hs-var">gre</span></a></span></span><span> </span><span class="annot"><span class="hs-operator hs-type">NE.:|</span></span><span> </span><span class="annot"><span class="annottext">[GlobalRdrElt]
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-1525"></span><span>              </span><span class="annot"><span class="annottext">RdrName
-&gt; NonEmpty GlobalRdrElt -&gt; IOEnv (Env TcGblEnv TcLclEnv) ()
</span><a href="GHC.Rename.Utils.html#addNameClashErrRn"><span class="hs-identifier hs-var">addNameClashErrRn</span></a></span><span> </span><span class="annot"><span class="annottext">RdrName
</span><a href="#local-6989586621683035838"><span class="hs-identifier hs-var">rdr_name</span></a></span><span> </span><span class="annot"><span class="annottext">NonEmpty GlobalRdrElt
</span><a href="#local-6989586621683035845"><span class="hs-identifier hs-var">gres</span></a></span><span>
</span><span id="line-1526"></span><span>              </span><span class="annot"><span class="annottext">Maybe GlobalRdrElt -&gt; RnM (Maybe GlobalRdrElt)
forall a. a -&gt; IOEnv (Env TcGblEnv TcLclEnv) a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">GlobalRdrElt -&gt; Maybe GlobalRdrElt
forall a. a -&gt; Maybe a
</span><span class="hs-identifier hs-var">Just</span></span><span> </span><span class="annot"><span class="annottext">GlobalRdrElt
</span><a href="#local-6989586621683035846"><span class="hs-identifier hs-var">gre</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-1527"></span><span>
</span><span id="line-1528"></span><span id="local-6989586621683034645"><span id="local-6989586621683034647"><span class="annot"><a href="GHC.Rename.Env.html#getFieldUpdLbl"><span class="hs-identifier hs-type">getFieldUpdLbl</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Hs.Extension.html#IsPass"><span class="hs-identifier hs-type">IsPass</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683034645"><span class="hs-identifier hs-type">p</span></a></span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="Language.Haskell.Syntax.Pat.html#LHsRecUpdField"><span class="hs-identifier hs-type">LHsRecUpdField</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Hs.Extension.html#GhcPass"><span class="hs-identifier hs-type">GhcPass</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683034645"><span class="hs-identifier hs-type">p</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><a href="#local-6989586621683034647"><span class="hs-identifier hs-type">q</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Parser.Annotation.html#LocatedN"><span class="hs-identifier hs-type">LocatedN</span></a></span><span> </span><span class="annot"><a href="GHC.Types.Name.Reader.html#RdrName"><span class="hs-identifier hs-type">RdrName</span></a></span></span></span><span>
</span><span id="line-1529"></span><span id="getFieldUpdLbl"><span class="annot"><span class="annottext">getFieldUpdLbl :: forall (p :: Pass) q.
IsPass p =&gt;
LHsRecUpdField (GhcPass p) q -&gt; LocatedN RdrName
</span><a href="GHC.Rename.Env.html#getFieldUpdLbl"><span class="hs-identifier hs-var hs-var">getFieldUpdLbl</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">FieldOcc (GhcPass p) -&gt; LocatedN RdrName
forall (p :: Pass).
IsPass p =&gt;
FieldOcc (GhcPass p) -&gt; LocatedN RdrName
</span><a href="GHC.Hs.Type.html#fieldOccLRdrName"><span class="hs-identifier hs-var">fieldOccLRdrName</span></a></span><span> </span><span class="annot"><span class="annottext">(FieldOcc (GhcPass p) -&gt; LocatedN RdrName)
-&gt; (GenLocated
      SrcSpanAnnA
      (HsFieldBind
         (GenLocated SrcSpanAnnA (FieldOcc (GhcPass p))) (LHsExpr q))
    -&gt; FieldOcc (GhcPass p))
-&gt; GenLocated
     SrcSpanAnnA
     (HsFieldBind
        (GenLocated SrcSpanAnnA (FieldOcc (GhcPass p))) (LHsExpr q))
-&gt; LocatedN RdrName
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">GenLocated SrcSpanAnnA (FieldOcc (GhcPass p))
-&gt; FieldOcc (GhcPass p)
forall l e. GenLocated l e -&gt; e
</span><a href="GHC.Types.SrcLoc.html#unLoc"><span class="hs-identifier hs-var">unLoc</span></a></span><span> </span><span class="annot"><span class="annottext">(GenLocated SrcSpanAnnA (FieldOcc (GhcPass p))
 -&gt; FieldOcc (GhcPass p))
-&gt; (GenLocated
      SrcSpanAnnA
      (HsFieldBind
         (GenLocated SrcSpanAnnA (FieldOcc (GhcPass p))) (LHsExpr q))
    -&gt; GenLocated SrcSpanAnnA (FieldOcc (GhcPass p)))
-&gt; GenLocated
     SrcSpanAnnA
     (HsFieldBind
        (GenLocated SrcSpanAnnA (FieldOcc (GhcPass p))) (LHsExpr q))
-&gt; FieldOcc (GhcPass p)
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">HsFieldBind
  (GenLocated SrcSpanAnnA (FieldOcc (GhcPass p))) (LHsExpr q)
-&gt; GenLocated SrcSpanAnnA (FieldOcc (GhcPass p))
forall lhs rhs. HsFieldBind lhs rhs -&gt; lhs
</span><a href="Language.Haskell.Syntax.Pat.html#hfbLHS"><span class="hs-identifier hs-var">hfbLHS</span></a></span><span> </span><span class="annot"><span class="annottext">(HsFieldBind
   (GenLocated SrcSpanAnnA (FieldOcc (GhcPass p))) (LHsExpr q)
 -&gt; GenLocated SrcSpanAnnA (FieldOcc (GhcPass p)))
-&gt; (GenLocated
      SrcSpanAnnA
      (HsFieldBind
         (GenLocated SrcSpanAnnA (FieldOcc (GhcPass p))) (LHsExpr q))
    -&gt; HsFieldBind
         (GenLocated SrcSpanAnnA (FieldOcc (GhcPass p))) (LHsExpr q))
-&gt; GenLocated
     SrcSpanAnnA
     (HsFieldBind
        (GenLocated SrcSpanAnnA (FieldOcc (GhcPass p))) (LHsExpr q))
-&gt; GenLocated SrcSpanAnnA (FieldOcc (GhcPass p))
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">GenLocated
  SrcSpanAnnA
  (HsFieldBind
     (GenLocated SrcSpanAnnA (FieldOcc (GhcPass p))) (LHsExpr q))
-&gt; HsFieldBind
     (GenLocated SrcSpanAnnA (FieldOcc (GhcPass p))) (LHsExpr q)
forall l e. GenLocated l e -&gt; e
</span><a href="GHC.Types.SrcLoc.html#unLoc"><span class="hs-identifier hs-var">unLoc</span></a></span><span>
</span><span id="line-1530"></span><span>
</span><span id="line-1531"></span><span class="hs-comment">-- | Returns all possible collections of field labels for the given</span><span>
</span><span id="line-1532"></span><span class="hs-comment">-- record update.</span><span>
</span><span id="line-1533"></span><span class="hs-comment">--</span><span>
</span><span id="line-1534"></span><span class="hs-comment">--   Example:</span><span>
</span><span id="line-1535"></span><span class="hs-comment">--</span><span>
</span><span id="line-1536"></span><span class="hs-comment">--       data D = MkD { fld1 :: Int, fld2 :: Bool }</span><span>
</span><span id="line-1537"></span><span class="hs-comment">--       data E = MkE1 { fld1 :: Int, fld2 :: Bool, fld3 :: Char }</span><span>
</span><span id="line-1538"></span><span class="hs-comment">--              | MkE2 { fld1 :: Int, fld2 :: Bool }</span><span>
</span><span id="line-1539"></span><span class="hs-comment">--       data F = MkF1 { fld1 :: Int } | MkF2 { fld2 :: Bool }</span><span>
</span><span id="line-1540"></span><span class="hs-comment">--</span><span>
</span><span id="line-1541"></span><span class="hs-comment">--       f r = r { fld1 = a, fld2 = b }</span><span>
</span><span id="line-1542"></span><span class="hs-comment">--</span><span>
</span><span id="line-1543"></span><span class="hs-comment">--     This function will return:</span><span>
</span><span id="line-1544"></span><span class="hs-comment">--</span><span>
</span><span id="line-1545"></span><span class="hs-comment">--       [ [ D.fld1, D.fld2 ] -- could be a record update at type D</span><span>
</span><span id="line-1546"></span><span class="hs-comment">--       , [ E.fld1, E.fld2 ] -- could be a record update at type E</span><span>
</span><span id="line-1547"></span><span class="hs-comment">--       ] -- cannot be a record update at type F: no constructor has both</span><span>
</span><span id="line-1548"></span><span class="hs-comment">--         -- of the fields fld1 and fld2</span><span>
</span><span id="line-1549"></span><span class="hs-comment">--</span><span>
</span><span id="line-1550"></span><span class="hs-comment">-- If there are no valid parents for the record update,</span><span>
</span><span id="line-1551"></span><span class="hs-comment">-- throws a 'TcRnBadRecordUpdate' error.</span><span>
</span><span id="line-1552"></span><span class="annot"><a href="GHC.Rename.Env.html#lookupRecUpdFields"><span class="hs-identifier hs-type">lookupRecUpdFields</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">NE.NonEmpty</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Language.Haskell.Syntax.Pat.html#LHsRecUpdField"><span class="hs-identifier hs-type">LHsRecUpdField</span></a></span><span> </span><span class="annot"><a href="GHC.Hs.Extension.html#GhcPs"><span class="hs-identifier hs-type">GhcPs</span></a></span><span> </span><span class="annot"><a href="GHC.Hs.Extension.html#GhcPs"><span class="hs-identifier hs-type">GhcPs</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1553"></span><span>                   </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#RnM"><span class="hs-identifier hs-type">RnM</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">NE.NonEmpty</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Hs.Expr.html#HsRecUpdParent"><span class="hs-identifier hs-type">HsRecUpdParent</span></a></span><span> </span><span class="annot"><a href="GHC.Hs.Extension.html#GhcRn"><span class="hs-identifier hs-type">GhcRn</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-1554"></span><span id="lookupRecUpdFields"><span class="annot"><span class="annottext">lookupRecUpdFields :: NonEmpty (LHsRecUpdField GhcPs GhcPs)
-&gt; RnM (NonEmpty (HsRecUpdParent GhcRn))
</span><a href="GHC.Rename.Env.html#lookupRecUpdFields"><span class="hs-identifier hs-var hs-var">lookupRecUpdFields</span></a></span></span><span> </span><span id="local-6989586621683035853"><span class="annot"><span class="annottext">NonEmpty (LHsRecUpdField GhcPs GhcPs)
</span><a href="#local-6989586621683035853"><span class="hs-identifier hs-var">flds</span></a></span></span><span>
</span><span id="line-1555"></span><span class="hs-comment">-- See Note [Disambiguating record updates] in GHC.Rename.Pat.</span><span>
</span><span id="line-1556"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span class="hs-comment">-- Retrieve the possible GlobalRdrElts that each field could refer to.</span><span>
</span><span id="line-1557"></span><span>       </span><span class="hs-special">;</span><span> </span><span id="local-6989586621683035854"><span class="annot"><a href="#local-6989586621683035854"><span class="hs-identifier hs-var">gre_env</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">TcRn GlobalRdrEnv
</span><a href="GHC.Tc.Utils.Monad.html#getGlobalRdrEnv"><span class="hs-identifier hs-var">getGlobalRdrEnv</span></a></span><span>
</span><span id="line-1558"></span><span>       </span><span class="hs-special">;</span><span> </span><span id="local-6989586621683035855"><span class="annot"><a href="#local-6989586621683035855"><span class="hs-identifier hs-var">fld1_gres</span></a></span></span><span> </span><span class="annot"><span class="hs-operator hs-type">NE.:|</span></span><span> </span><span id="local-6989586621683035856"><span class="annot"><a href="#local-6989586621683035856"><span class="hs-identifier hs-var">other_flds_gres</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="hs-identifier hs-type">mapM</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Rename.Env.html#lookupFieldGREs"><span class="hs-identifier hs-type">lookupFieldGREs</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683035854"><span class="hs-identifier hs-type">gre_env</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">.</span></span><span> </span><span class="annot"><a href="GHC.Rename.Env.html#getFieldUpdLbl"><span class="hs-identifier hs-type">getFieldUpdLbl</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><a href="#local-6989586621683035853"><span class="hs-identifier hs-type">flds</span></a></span><span>
</span><span id="line-1559"></span><span>         </span><span class="hs-comment">-- Take an intersection: we are only interested in constructors</span><span>
</span><span id="line-1560"></span><span>         </span><span class="hs-comment">-- which have all of the fields.</span><span>
</span><span id="line-1561"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621683035858"><span class="annot"><a href="#local-6989586621683035858"><span class="hs-identifier hs-var hs-var">possible_GREs</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">NonEmpty GlobalRdrElt
-&gt; [NonEmpty GlobalRdrElt] -&gt; [HsRecUpdParent GhcRn]
</span><a href="#local-6989586621683035859"><span class="hs-identifier hs-var">intersect_by_cons</span></a></span><span> </span><span class="annot"><span class="annottext">NonEmpty GlobalRdrElt
</span><a href="#local-6989586621683035855"><span class="hs-identifier hs-var">fld1_gres</span></a></span><span> </span><span class="annot"><span class="annottext">[NonEmpty GlobalRdrElt]
</span><a href="#local-6989586621683035856"><span class="hs-identifier hs-var">other_flds_gres</span></a></span><span>
</span><span id="line-1562"></span><span>
</span><span id="line-1563"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.Monad.html#traceRn"><span class="hs-identifier hs-type">traceRn</span></a></span><span> </span><span class="annot"><span class="hs-string">&quot;lookupRecUpdFields&quot;</span></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span>
</span><span id="line-1564"></span><span>           </span><span class="annot"><a href="GHC.Utils.Outputable.html#vcat"><span class="hs-identifier hs-type">vcat</span></a></span><span> </span><span class="hs-special">[</span><span> </span><span class="annot"><a href="GHC.Utils.Outputable.html#text"><span class="hs-identifier hs-type">text</span></a></span><span> </span><span class="annot"><span class="hs-string">&quot;flds:&quot;</span></span><span> </span><span class="annot"><a href="GHC.Utils.Outputable.html#%3C%2B%3E"><span class="hs-operator hs-type">&lt;+&gt;</span></a></span><span> </span><span class="annot"><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-type">ppr</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">fmap</span></span><span> </span><span class="annot"><a href="GHC.Rename.Env.html#getFieldUpdLbl"><span class="hs-identifier hs-type">getFieldUpdLbl</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683035853"><span class="hs-identifier hs-type">flds</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1565"></span><span>                </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Utils.Outputable.html#text"><span class="hs-identifier hs-type">text</span></a></span><span> </span><span class="annot"><span class="hs-string">&quot;possible_GREs:&quot;</span></span><span> </span><span class="annot"><a href="GHC.Utils.Outputable.html#%3C%2B%3E"><span class="hs-operator hs-type">&lt;+&gt;</span></a></span><span>
</span><span id="line-1566"></span><span>                    </span><span class="annot"><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-type">ppr</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">map</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">fmap</span></span><span> </span><span class="annot"><a href="GHC.Types.Name.Reader.html#greName"><span class="hs-identifier hs-type">greName</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">.</span></span><span> </span><span class="annot"><a href="GHC.Hs.Expr.html#rnRecUpdLabels"><span class="hs-identifier hs-var">rnRecUpdLabels</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><a href="#local-6989586621683035858"><span class="hs-identifier hs-type">possible_GREs</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">]</span><span>
</span><span id="line-1567"></span><span>
</span><span id="line-1568"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><a href="#local-6989586621683035858"><span class="hs-identifier hs-type">possible_GREs</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-1569"></span><span>
</span><span id="line-1570"></span><span>          </span><span class="hs-comment">-- There is at least one parent: we can proceed.</span><span>
</span><span id="line-1571"></span><span>          </span><span class="hs-comment">-- The typechecker might be able to finish disambiguating.</span><span>
</span><span id="line-1572"></span><span>          </span><span class="hs-comment">-- See Note [Type-directed record disambiguation] in GHC.Rename.Pat.</span><span>
</span><span id="line-1573"></span><span>       </span><span class="hs-special">{</span><span> </span><span id="local-6989586621683035861"><span class="annot"><span class="annottext">HsRecUpdParent GhcRn
</span><a href="#local-6989586621683035861"><span class="hs-identifier hs-var">p1</span></a></span></span><span class="annot"><span class="hs-glyph hs-type">:</span></span><span id="local-6989586621683035862"><span class="annot"><span class="annottext">[HsRecUpdParent GhcRn]
</span><a href="#local-6989586621683035862"><span class="hs-identifier hs-var">ps</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">NonEmpty (HsRecUpdParent GhcRn)
-&gt; RnM (NonEmpty (HsRecUpdParent GhcRn))
forall a. a -&gt; IOEnv (Env TcGblEnv TcLclEnv) a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">HsRecUpdParent GhcRn
</span><a href="#local-6989586621683035861"><span class="hs-identifier hs-var">p1</span></a></span><span> </span><span class="annot"><span class="annottext">HsRecUpdParent GhcRn
-&gt; [HsRecUpdParent GhcRn] -&gt; NonEmpty (HsRecUpdParent GhcRn)
forall a. a -&gt; [a] -&gt; NonEmpty a
</span><span class="hs-operator hs-var">NE.:|</span></span><span> </span><span class="annot"><span class="annottext">[HsRecUpdParent GhcRn]
</span><a href="#local-6989586621683035862"><span class="hs-identifier hs-var">ps</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1574"></span><span>
</span><span id="line-1575"></span><span>          </span><span class="hs-comment">-- There are no possible parents for the record update: compute</span><span>
</span><span id="line-1576"></span><span>          </span><span class="hs-comment">-- a minimum set of fields which does not belong to any data constructor,</span><span>
</span><span id="line-1577"></span><span>          </span><span class="hs-comment">-- to report an informative error to the user.</span><span>
</span><span id="line-1578"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="annottext">[HsRecUpdParent GhcRn]
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-1579"></span><span>          </span><span class="hs-keyword">let</span><span>
</span><span id="line-1580"></span><span>            </span><span class="hs-comment">-- The constructors which have the first field.</span><span>
</span><span id="line-1581"></span><span>            </span><span class="annot"><a href="#local-6989586621683035863"><span class="hs-identifier hs-type">fld1_cons</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Types.Unique.Set.html#UniqSet"><span class="hs-identifier hs-type">UniqSet</span></a></span><span> </span><span class="annot"><a href="GHC.Types.GREInfo.html#ConLikeName"><span class="hs-identifier hs-type">ConLikeName</span></a></span><span>
</span><span id="line-1582"></span><span>            </span><span id="local-6989586621683035863"><span class="annot"><span class="annottext">fld1_cons :: UniqSet ConLikeName
</span><a href="#local-6989586621683035863"><span class="hs-identifier hs-var hs-var">fld1_cons</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[UniqSet ConLikeName] -&gt; UniqSet ConLikeName
forall a. [UniqSet a] -&gt; UniqSet a
</span><a href="GHC.Types.Unique.Set.html#unionManyUniqSets"><span class="hs-identifier hs-var">unionManyUniqSets</span></a></span><span>
</span><span id="line-1583"></span><span>                      </span><span class="annot"><span class="annottext">([UniqSet ConLikeName] -&gt; UniqSet ConLikeName)
-&gt; [UniqSet ConLikeName] -&gt; UniqSet ConLikeName
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">NonEmpty (UniqSet ConLikeName) -&gt; [UniqSet ConLikeName]
forall a. NonEmpty a -&gt; [a]
</span><a href="../../base-4.21.0.0-ae91/src/Data.List.NonEmpty.html#toList"><span class="hs-identifier hs-var">NE.toList</span></a></span><span>
</span><span id="line-1584"></span><span>                      </span><span class="annot"><span class="annottext">(NonEmpty (UniqSet ConLikeName) -&gt; [UniqSet ConLikeName])
-&gt; NonEmpty (UniqSet ConLikeName) -&gt; [UniqSet ConLikeName]
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">(GlobalRdrElt -&gt; UniqSet ConLikeName)
-&gt; NonEmpty GlobalRdrElt -&gt; NonEmpty (UniqSet ConLikeName)
forall a b. (a -&gt; b) -&gt; NonEmpty a -&gt; NonEmpty b
</span><a href="../../base-4.21.0.0-ae91/src/Data.List.NonEmpty.html#map"><span class="hs-identifier hs-var">NE.map</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">RecFieldInfo -&gt; UniqSet ConLikeName
</span><a href="GHC.Types.GREInfo.html#recFieldCons"><span class="hs-identifier hs-var">recFieldCons</span></a></span><span> </span><span class="annot"><span class="annottext">(RecFieldInfo -&gt; UniqSet ConLikeName)
-&gt; (GlobalRdrElt -&gt; RecFieldInfo)
-&gt; GlobalRdrElt
-&gt; UniqSet ConLikeName
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">HasDebugCallStack =&gt; GlobalRdrElt -&gt; RecFieldInfo
GlobalRdrElt -&gt; RecFieldInfo
</span><a href="GHC.Types.Name.Reader.html#fieldGREInfo"><span class="hs-identifier hs-var">fieldGREInfo</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">NonEmpty GlobalRdrElt
</span><a href="#local-6989586621683035855"><span class="hs-identifier hs-var">fld1_gres</span></a></span><span>
</span><span id="line-1585"></span><span>            </span><span class="hs-comment">-- The field labels of the constructors which have the first field.</span><span>
</span><span id="line-1586"></span><span>            </span><span class="annot"><a href="#local-6989586621683035869"><span class="hs-identifier hs-type">fld1_cons_fields</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Types.Unique.FM.html#UniqFM"><span class="hs-identifier hs-type">UniqFM</span></a></span><span> </span><span class="annot"><a href="GHC.Types.GREInfo.html#ConLikeName"><span class="hs-identifier hs-type">ConLikeName</span></a></span><span> </span><span class="hs-special">[</span><span class="annot"><a href="GHC.Types.FieldLabel.html#FieldLabel"><span class="hs-identifier hs-type">FieldLabel</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-1587"></span><span>            </span><span id="local-6989586621683035869"><span class="annot"><span class="annottext">fld1_cons_fields :: UniqFM ConLikeName [FieldLabel]
</span><a href="#local-6989586621683035869"><span class="hs-identifier hs-var hs-var">fld1_cons_fields</span></a></span></span><span>
</span><span id="line-1588"></span><span>              </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(ConLikeName -&gt; [FieldLabel])
-&gt; UniqFM ConLikeName ConLikeName
-&gt; UniqFM ConLikeName [FieldLabel]
forall a b.
(a -&gt; b) -&gt; UniqFM ConLikeName a -&gt; UniqFM ConLikeName b
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-identifier hs-var">fmap</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">GlobalRdrEnv -&gt; ConLikeName -&gt; [FieldLabel]
</span><a href="#local-6989586621683035870"><span class="hs-identifier hs-var">lkp_con_fields</span></a></span><span> </span><span class="annot"><span class="annottext">GlobalRdrEnv
</span><a href="#local-6989586621683035854"><span class="hs-identifier hs-var">gre_env</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1589"></span><span>              </span><span class="annot"><span class="annottext">(UniqFM ConLikeName ConLikeName -&gt; UniqFM ConLikeName [FieldLabel])
-&gt; UniqFM ConLikeName ConLikeName
-&gt; UniqFM ConLikeName [FieldLabel]
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">UniqSet ConLikeName -&gt; UniqFM ConLikeName ConLikeName
forall a. UniqSet a -&gt; UniqFM a a
</span><a href="GHC.Types.Unique.Set.html#getUniqSet"><span class="hs-identifier hs-var">getUniqSet</span></a></span><span> </span><span class="annot"><span class="annottext">UniqSet ConLikeName
</span><a href="#local-6989586621683035863"><span class="hs-identifier hs-var">fld1_cons</span></a></span><span>
</span><span id="line-1590"></span><span>          </span><span class="hs-keyword">in</span><span> </span><span class="annot"><span class="annottext">TcRnMessage -&gt; RnM (NonEmpty (HsRecUpdParent GhcRn))
forall a. TcRnMessage -&gt; TcM a
</span><a href="GHC.Tc.Utils.Monad.html#failWithTc"><span class="hs-identifier hs-var">failWithTc</span></a></span><span> </span><span class="annot"><span class="annottext">(TcRnMessage -&gt; RnM (NonEmpty (HsRecUpdParent GhcRn)))
-&gt; TcRnMessage -&gt; RnM (NonEmpty (HsRecUpdParent GhcRn))
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">[LHsRecUpdField GhcPs GhcPs]
-&gt; UniqFM ConLikeName [FieldLabel] -&gt; TcRnMessage
forall (p :: Pass) q.
OutputableBndrId p =&gt;
[LHsRecUpdField (GhcPass p) q]
-&gt; UniqFM ConLikeName [FieldLabel] -&gt; TcRnMessage
</span><a href="GHC.Rename.Env.html#badFieldsUpd"><span class="hs-identifier hs-var">badFieldsUpd</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">NonEmpty
  (GenLocated
     SrcSpanAnnA
     (HsFieldBind
        (GenLocated SrcSpanAnnA (FieldOcc GhcPs))
        (XRec GhcPs (HsExpr GhcPs))))
-&gt; [GenLocated
      SrcSpanAnnA
      (HsFieldBind
         (GenLocated SrcSpanAnnA (FieldOcc GhcPs))
         (XRec GhcPs (HsExpr GhcPs)))]
forall a. NonEmpty a -&gt; [a]
</span><a href="../../base-4.21.0.0-ae91/src/Data.List.NonEmpty.html#toList"><span class="hs-identifier hs-var">NE.toList</span></a></span><span> </span><span class="annot"><span class="annottext">NonEmpty (LHsRecUpdField GhcPs GhcPs)
NonEmpty
  (GenLocated
     SrcSpanAnnA
     (HsFieldBind
        (GenLocated SrcSpanAnnA (FieldOcc GhcPs))
        (XRec GhcPs (HsExpr GhcPs))))
</span><a href="#local-6989586621683035853"><span class="hs-identifier hs-var">flds</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">UniqFM ConLikeName [FieldLabel]
</span><a href="#local-6989586621683035869"><span class="hs-identifier hs-var">fld1_cons_fields</span></a></span><span> </span><span class="hs-special">}</span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-1591"></span><span>
</span><span id="line-1592"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-1593"></span><span>    </span><span class="annot"><a href="#local-6989586621683035859"><span class="hs-identifier hs-type">intersect_by_cons</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">NE.NonEmpty</span></span><span> </span><span class="annot"><a href="GHC.Types.Name.Reader.html#FieldGlobalRdrElt"><span class="hs-identifier hs-type">FieldGlobalRdrElt</span></a></span><span>
</span><span id="line-1594"></span><span>                      </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><span class="hs-identifier hs-type">NE.NonEmpty</span></span><span> </span><span class="annot"><a href="GHC.Types.Name.Reader.html#FieldGlobalRdrElt"><span class="hs-identifier hs-type">FieldGlobalRdrElt</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-1595"></span><span>                      </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="GHC.Hs.Expr.html#HsRecUpdParent"><span class="hs-identifier hs-type">HsRecUpdParent</span></a></span><span> </span><span class="annot"><a href="GHC.Hs.Extension.html#GhcRn"><span class="hs-identifier hs-type">GhcRn</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-1596"></span><span>    </span><span id="local-6989586621683035859"><span class="annot"><span class="annottext">intersect_by_cons :: NonEmpty GlobalRdrElt
-&gt; [NonEmpty GlobalRdrElt] -&gt; [HsRecUpdParent GhcRn]
</span><a href="#local-6989586621683035859"><span class="hs-identifier hs-var hs-var">intersect_by_cons</span></a></span></span><span> </span><span id="local-6989586621683035873"><span class="annot"><span class="annottext">NonEmpty GlobalRdrElt
</span><a href="#local-6989586621683035873"><span class="hs-identifier hs-var">this</span></a></span></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-1597"></span><span>      </span><span class="annot"><span class="annottext">(GlobalRdrElt -&gt; HsRecUpdParent GhcRn)
-&gt; [GlobalRdrElt] -&gt; [HsRecUpdParent GhcRn]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><span class="hs-identifier hs-var">map</span></span><span>
</span><span id="line-1598"></span><span>        </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span> </span><span id="local-6989586621683035874"><span class="annot"><span class="annottext">GlobalRdrElt
</span><a href="#local-6989586621683035874"><span class="hs-identifier hs-var">fld</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">NonEmpty GlobalRdrElt
-&gt; UniqSet ConLikeName -&gt; HsRecUpdParent GhcRn
</span><a href="GHC.Hs.Expr.html#RnRecUpdParent"><span class="hs-identifier hs-var">RnRecUpdParent</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">GlobalRdrElt
</span><a href="#local-6989586621683035874"><span class="hs-identifier hs-var">fld</span></a></span><span> </span><span class="annot"><span class="annottext">GlobalRdrElt -&gt; [GlobalRdrElt] -&gt; NonEmpty GlobalRdrElt
forall a. a -&gt; [a] -&gt; NonEmpty a
</span><span class="hs-operator hs-var">NE.:|</span></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">RecFieldInfo -&gt; UniqSet ConLikeName
</span><a href="GHC.Types.GREInfo.html#recFieldCons"><span class="hs-identifier hs-var">recFieldCons</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">HasDebugCallStack =&gt; GlobalRdrElt -&gt; RecFieldInfo
GlobalRdrElt -&gt; RecFieldInfo
</span><a href="GHC.Types.Name.Reader.html#fieldGREInfo"><span class="hs-identifier hs-var">fieldGREInfo</span></a></span><span> </span><span class="annot"><span class="annottext">GlobalRdrElt
</span><a href="#local-6989586621683035874"><span class="hs-identifier hs-var">fld</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-1599"></span><span>        </span><span class="hs-special">(</span><span class="annot"><span class="annottext">NonEmpty GlobalRdrElt -&gt; [GlobalRdrElt]
forall a. NonEmpty a -&gt; [a]
</span><a href="../../base-4.21.0.0-ae91/src/Data.List.NonEmpty.html#toList"><span class="hs-identifier hs-var">NE.toList</span></a></span><span> </span><span class="annot"><span class="annottext">NonEmpty GlobalRdrElt
</span><a href="#local-6989586621683035873"><span class="hs-identifier hs-var">this</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1600"></span><span>    </span><span class="annot"><a href="#local-6989586621683035859"><span class="hs-identifier hs-var">intersect_by_cons</span></a></span><span> </span><span id="local-6989586621683035876"><span class="annot"><span class="annottext">NonEmpty GlobalRdrElt
</span><a href="#local-6989586621683035876"><span class="hs-identifier hs-var">this</span></a></span></span><span> </span><span class="hs-special">(</span><span id="local-6989586621683035877"><span class="annot"><span class="annottext">NonEmpty GlobalRdrElt
</span><a href="#local-6989586621683035877"><span class="hs-identifier hs-var">new</span></a></span></span><span> </span><span class="annot"><span class="hs-glyph hs-type">:</span></span><span> </span><span id="local-6989586621683035878"><span class="annot"><span class="annottext">[NonEmpty GlobalRdrElt]
</span><a href="#local-6989586621683035878"><span class="hs-identifier hs-var">rest</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-1601"></span><span>      </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">NonEmpty GlobalRdrElt
-&gt; UniqSet ConLikeName -&gt; HsRecUpdParent GhcRn
</span><a href="GHC.Hs.Expr.html#RnRecUpdParent"><span class="hs-identifier hs-var">RnRecUpdParent</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">GlobalRdrElt
</span><a href="#local-6989586621683035879"><span class="hs-identifier hs-var">this_fld</span></a></span><span> </span><span class="annot"><span class="annottext">GlobalRdrElt -&gt; NonEmpty GlobalRdrElt -&gt; NonEmpty GlobalRdrElt
forall a. a -&gt; NonEmpty a -&gt; NonEmpty a
</span><a href="../../base-4.21.0.0-ae91/src/Data.List.NonEmpty.html#%3C%7C"><span class="hs-operator hs-var">NE.&lt;|</span></a></span><span> </span><span class="annot"><span class="annottext">NonEmpty GlobalRdrElt
</span><a href="#local-6989586621683035881"><span class="hs-identifier hs-var">next_flds</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">UniqSet ConLikeName
</span><a href="#local-6989586621683035882"><span class="hs-identifier hs-var">both_cons</span></a></span><span>
</span><span id="line-1602"></span><span>      </span><span class="hs-glyph">|</span><span> </span><span id="local-6989586621683035879"><span class="annot"><span class="annottext">GlobalRdrElt
</span><a href="#local-6989586621683035879"><span class="hs-identifier hs-var">this_fld</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">NonEmpty GlobalRdrElt -&gt; [GlobalRdrElt]
forall a. NonEmpty a -&gt; [a]
</span><a href="../../base-4.21.0.0-ae91/src/Data.List.NonEmpty.html#toList"><span class="hs-identifier hs-var">NE.toList</span></a></span><span> </span><span class="annot"><span class="annottext">NonEmpty GlobalRdrElt
</span><a href="#local-6989586621683035876"><span class="hs-identifier hs-var">this</span></a></span><span>
</span><span id="line-1603"></span><span>      </span><span class="hs-special">,</span><span> </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621683035883"><span class="annot"><span class="annottext">this_cons :: UniqSet ConLikeName
</span><a href="#local-6989586621683035883"><span class="hs-identifier hs-var hs-var">this_cons</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">RecFieldInfo -&gt; UniqSet ConLikeName
</span><a href="GHC.Types.GREInfo.html#recFieldCons"><span class="hs-identifier hs-var">recFieldCons</span></a></span><span> </span><span class="annot"><span class="annottext">(RecFieldInfo -&gt; UniqSet ConLikeName)
-&gt; RecFieldInfo -&gt; UniqSet ConLikeName
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">HasDebugCallStack =&gt; GlobalRdrElt -&gt; RecFieldInfo
GlobalRdrElt -&gt; RecFieldInfo
</span><a href="GHC.Types.Name.Reader.html#fieldGREInfo"><span class="hs-identifier hs-var">fieldGREInfo</span></a></span><span> </span><span class="annot"><span class="annottext">GlobalRdrElt
</span><a href="#local-6989586621683035879"><span class="hs-identifier hs-var">this_fld</span></a></span><span>
</span><span id="line-1604"></span><span>      </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Hs.Expr.html#RnRecUpdParent"><span class="hs-identifier hs-type">RnRecUpdParent</span></a></span><span> </span><span id="local-6989586621683035881"><span class="annot"><span class="annottext">NonEmpty GlobalRdrElt
</span><a href="#local-6989586621683035881"><span class="hs-identifier hs-var">next_flds</span></a></span></span><span> </span><span id="local-6989586621683035884"><span class="annot"><span class="annottext">UniqSet ConLikeName
</span><a href="#local-6989586621683035884"><span class="hs-identifier hs-var">next_cons</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">NonEmpty GlobalRdrElt
-&gt; [NonEmpty GlobalRdrElt] -&gt; [HsRecUpdParent GhcRn]
</span><a href="#local-6989586621683035859"><span class="hs-identifier hs-var">intersect_by_cons</span></a></span><span> </span><span class="annot"><span class="annottext">NonEmpty GlobalRdrElt
</span><a href="#local-6989586621683035877"><span class="hs-identifier hs-var">new</span></a></span><span> </span><span class="annot"><span class="annottext">[NonEmpty GlobalRdrElt]
</span><a href="#local-6989586621683035878"><span class="hs-identifier hs-var">rest</span></a></span><span>
</span><span id="line-1605"></span><span>      </span><span class="hs-special">,</span><span> </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621683035882"><span class="annot"><span class="annottext">both_cons :: UniqSet ConLikeName
</span><a href="#local-6989586621683035882"><span class="hs-identifier hs-var hs-var">both_cons</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">UniqSet ConLikeName
</span><a href="#local-6989586621683035884"><span class="hs-identifier hs-var">next_cons</span></a></span><span> </span><span class="annot"><span class="annottext">UniqSet ConLikeName -&gt; UniqSet ConLikeName -&gt; UniqSet ConLikeName
forall a. UniqSet a -&gt; UniqSet a -&gt; UniqSet a
</span><a href="GHC.Types.Unique.Set.html#intersectUniqSets"><span class="hs-operator hs-var">`intersectUniqSets`</span></a></span><span> </span><span class="annot"><span class="annottext">UniqSet ConLikeName
</span><a href="#local-6989586621683035883"><span class="hs-identifier hs-var">this_cons</span></a></span><span>
</span><span id="line-1606"></span><span>      </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Bool
</span><span class="hs-identifier hs-var">not</span></span><span> </span><span class="annot"><span class="annottext">(Bool -&gt; Bool) -&gt; Bool -&gt; Bool
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">UniqSet ConLikeName -&gt; Bool
forall a. UniqSet a -&gt; Bool
</span><a href="GHC.Types.Unique.Set.html#isEmptyUniqSet"><span class="hs-identifier hs-var">isEmptyUniqSet</span></a></span><span> </span><span class="annot"><span class="annottext">UniqSet ConLikeName
</span><a href="#local-6989586621683035882"><span class="hs-identifier hs-var">both_cons</span></a></span><span>
</span><span id="line-1607"></span><span>      </span><span class="hs-special">]</span><span>
</span><span id="line-1608"></span><span>
</span><span id="line-1609"></span><span>    </span><span class="annot"><a href="#local-6989586621683035870"><span class="hs-identifier hs-type">lkp_con_fields</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Types.Name.Reader.html#GlobalRdrEnv"><span class="hs-identifier hs-type">GlobalRdrEnv</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Types.GREInfo.html#ConLikeName"><span class="hs-identifier hs-type">ConLikeName</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="GHC.Types.FieldLabel.html#FieldLabel"><span class="hs-identifier hs-type">FieldLabel</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-1610"></span><span>    </span><span id="local-6989586621683035870"><span class="annot"><span class="annottext">lkp_con_fields :: GlobalRdrEnv -&gt; ConLikeName -&gt; [FieldLabel]
</span><a href="#local-6989586621683035870"><span class="hs-identifier hs-var hs-var">lkp_con_fields</span></a></span></span><span> </span><span id="local-6989586621683035887"><span class="annot"><span class="annottext">GlobalRdrEnv
</span><a href="#local-6989586621683035887"><span class="hs-identifier hs-var">gre_env</span></a></span></span><span> </span><span id="local-6989586621683035888"><span class="annot"><span class="annottext">ConLikeName
</span><a href="#local-6989586621683035888"><span class="hs-identifier hs-var">con</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-1611"></span><span>      </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">FieldLabel
</span><a href="#local-6989586621683035889"><span class="hs-identifier hs-var">fl</span></a></span><span>
</span><span id="line-1612"></span><span>      </span><span class="hs-glyph">|</span><span> </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621683035890"><span class="annot"><span class="annottext">nm :: Name
</span><a href="#local-6989586621683035890"><span class="hs-identifier hs-var hs-var">nm</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ConLikeName -&gt; Name
</span><a href="GHC.Types.GREInfo.html#conLikeName_Name"><span class="hs-identifier hs-var">conLikeName_Name</span></a></span><span> </span><span class="annot"><span class="annottext">ConLikeName
</span><a href="#local-6989586621683035888"><span class="hs-identifier hs-var">con</span></a></span><span>
</span><span id="line-1613"></span><span>      </span><span class="hs-special">,</span><span> </span><span id="local-6989586621683035892"><span class="annot"><span class="annottext">GlobalRdrElt
</span><a href="#local-6989586621683035892"><span class="hs-identifier hs-var">gre</span></a></span></span><span>      </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Maybe GlobalRdrElt -&gt; [GlobalRdrElt]
forall a. Maybe a -&gt; [a]
</span><span class="hs-identifier hs-var">maybeToList</span></span><span> </span><span class="annot"><span class="annottext">(Maybe GlobalRdrElt -&gt; [GlobalRdrElt])
-&gt; Maybe GlobalRdrElt -&gt; [GlobalRdrElt]
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">GlobalRdrEnv -&gt; Name -&gt; Maybe GlobalRdrElt
forall info.
Outputable info =&gt;
GlobalRdrEnvX info -&gt; Name -&gt; Maybe (GlobalRdrEltX info)
</span><a href="GHC.Types.Name.Reader.html#lookupGRE_Name"><span class="hs-identifier hs-var">lookupGRE_Name</span></a></span><span> </span><span class="annot"><span class="annottext">GlobalRdrEnv
</span><a href="#local-6989586621683035887"><span class="hs-identifier hs-var">gre_env</span></a></span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621683035890"><span class="hs-identifier hs-var">nm</span></a></span><span>
</span><span id="line-1614"></span><span>      </span><span class="hs-special">,</span><span> </span><span id="local-6989586621683035893"><span class="annot"><span class="annottext">ConInfo
</span><a href="#local-6989586621683035893"><span class="hs-identifier hs-var">con_info</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Maybe ConInfo -&gt; [ConInfo]
forall a. Maybe a -&gt; [a]
</span><span class="hs-identifier hs-var">maybeToList</span></span><span> </span><span class="annot"><span class="annottext">(Maybe ConInfo -&gt; [ConInfo]) -&gt; Maybe ConInfo -&gt; [ConInfo]
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">HasDebugCallStack =&gt; GlobalRdrElt -&gt; Maybe ConInfo
GlobalRdrElt -&gt; Maybe ConInfo
</span><a href="GHC.Types.Name.Reader.html#recFieldConLike_maybe"><span class="hs-identifier hs-var">recFieldConLike_maybe</span></a></span><span> </span><span class="annot"><span class="annottext">GlobalRdrElt
</span><a href="#local-6989586621683035892"><span class="hs-identifier hs-var">gre</span></a></span><span>
</span><span id="line-1615"></span><span>      </span><span class="hs-special">,</span><span> </span><span id="local-6989586621683035889"><span class="annot"><span class="annottext">FieldLabel
</span><a href="#local-6989586621683035889"><span class="hs-identifier hs-var">fl</span></a></span></span><span>       </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">ConInfo -&gt; [FieldLabel]
</span><a href="GHC.Types.GREInfo.html#conInfoFields"><span class="hs-identifier hs-var">conInfoFields</span></a></span><span> </span><span class="annot"><span class="annottext">ConInfo
</span><a href="#local-6989586621683035893"><span class="hs-identifier hs-var">con_info</span></a></span><span> </span><span class="hs-special">]</span><span>
</span><span id="line-1616"></span><span>
</span><span id="line-1617"></span><span class="annot"><span class="hs-comment">{-**********************************************************************
*                                                                      *
                      Record field errors
*                                                                      *
**********************************************************************-}</span></span><span>
</span><span id="line-1622"></span><span>
</span><span id="line-1623"></span><span class="annot"><a href="GHC.Rename.Env.html#getUpdFieldLbls"><span class="hs-identifier hs-type">getUpdFieldLbls</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-keyword">forall</span><span> </span><span id="local-6989586621683034680"><span class="annot"><a href="#local-6989586621683034680"><span class="hs-identifier hs-type">p</span></a></span></span><span> </span><span id="local-6989586621683034681"><span class="annot"><a href="#local-6989586621683034681"><span class="hs-identifier hs-type">q</span></a></span></span><span class="hs-operator">.</span><span> </span><span class="annot"><a href="GHC.Hs.Extension.html#IsPass"><span class="hs-identifier hs-type">IsPass</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683034680"><span class="hs-identifier hs-type">p</span></a></span><span>
</span><span id="line-1624"></span><span>                </span><span class="hs-glyph">=&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="Language.Haskell.Syntax.Pat.html#LHsRecUpdField"><span class="hs-identifier hs-type">LHsRecUpdField</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Hs.Extension.html#GhcPass"><span class="hs-identifier hs-type">GhcPass</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683034680"><span class="hs-identifier hs-type">p</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><a href="#local-6989586621683034681"><span class="hs-identifier hs-type">q</span></a></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="GHC.Types.Name.Reader.html#RdrName"><span class="hs-identifier hs-type">RdrName</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-1625"></span><span id="getUpdFieldLbls"><span class="annot"><span class="annottext">getUpdFieldLbls :: forall (p :: Pass) q.
IsPass p =&gt;
[LHsRecUpdField (GhcPass p) q] -&gt; [RdrName]
</span><a href="GHC.Rename.Env.html#getUpdFieldLbls"><span class="hs-identifier hs-var hs-var">getUpdFieldLbls</span></a></span></span><span>
</span><span id="line-1626"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(LHsRecUpdField (GhcPass p) q -&gt; RdrName)
-&gt; [LHsRecUpdField (GhcPass p) q] -&gt; [RdrName]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><span class="hs-identifier hs-var">map</span></span><span> </span><span class="annot"><span class="annottext">((LHsRecUpdField (GhcPass p) q -&gt; RdrName)
 -&gt; [LHsRecUpdField (GhcPass p) q] -&gt; [RdrName])
-&gt; (LHsRecUpdField (GhcPass p) q -&gt; RdrName)
-&gt; [LHsRecUpdField (GhcPass p) q]
-&gt; [RdrName]
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">FieldOcc (GhcPass p) -&gt; RdrName
forall (p :: Pass). IsPass p =&gt; FieldOcc (GhcPass p) -&gt; RdrName
</span><a href="GHC.Hs.Type.html#fieldOccRdrName"><span class="hs-identifier hs-var">fieldOccRdrName</span></a></span><span>
</span><span id="line-1627"></span><span>        </span><span class="annot"><span class="annottext">(FieldOcc (GhcPass p) -&gt; RdrName)
-&gt; (LHsRecUpdField (GhcPass p) q -&gt; FieldOcc (GhcPass p))
-&gt; LHsRecUpdField (GhcPass p) q
-&gt; RdrName
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">forall p a. UnXRec p =&gt; XRec p a -&gt; a
</span><a href="Language.Haskell.Syntax.Extension.html#unXRec"><span class="hs-identifier hs-var">unXRec</span></a></span><span> </span><span class="hs-glyph">@</span><span class="hs-special">(</span><span class="annot"><a href="GHC.Hs.Extension.html#GhcPass"><span class="hs-identifier hs-type">GhcPass</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683034680"><span class="hs-identifier hs-type">p</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1628"></span><span>        </span><span class="annot"><span class="annottext">(GenLocated SrcSpanAnnA (FieldOcc (GhcPass p))
 -&gt; FieldOcc (GhcPass p))
-&gt; (GenLocated
      SrcSpanAnnA
      (HsFieldBind
         (GenLocated SrcSpanAnnA (FieldOcc (GhcPass p)))
         (XRec q (HsExpr q)))
    -&gt; GenLocated SrcSpanAnnA (FieldOcc (GhcPass p)))
-&gt; GenLocated
     SrcSpanAnnA
     (HsFieldBind
        (GenLocated SrcSpanAnnA (FieldOcc (GhcPass p)))
        (XRec q (HsExpr q)))
-&gt; FieldOcc (GhcPass p)
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">HsFieldBind
  (GenLocated SrcSpanAnnA (FieldOcc (GhcPass p))) (XRec q (HsExpr q))
-&gt; GenLocated SrcSpanAnnA (FieldOcc (GhcPass p))
forall lhs rhs. HsFieldBind lhs rhs -&gt; lhs
</span><a href="Language.Haskell.Syntax.Pat.html#hfbLHS"><span class="hs-identifier hs-var">hfbLHS</span></a></span><span>
</span><span id="line-1629"></span><span>        </span><span class="annot"><span class="annottext">(HsFieldBind
   (GenLocated SrcSpanAnnA (FieldOcc (GhcPass p))) (XRec q (HsExpr q))
 -&gt; GenLocated SrcSpanAnnA (FieldOcc (GhcPass p)))
-&gt; (GenLocated
      SrcSpanAnnA
      (HsFieldBind
         (GenLocated SrcSpanAnnA (FieldOcc (GhcPass p)))
         (XRec q (HsExpr q)))
    -&gt; HsFieldBind
         (GenLocated SrcSpanAnnA (FieldOcc (GhcPass p)))
         (XRec q (HsExpr q)))
-&gt; GenLocated
     SrcSpanAnnA
     (HsFieldBind
        (GenLocated SrcSpanAnnA (FieldOcc (GhcPass p)))
        (XRec q (HsExpr q)))
-&gt; GenLocated SrcSpanAnnA (FieldOcc (GhcPass p))
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">forall p a. UnXRec p =&gt; XRec p a -&gt; a
</span><a href="Language.Haskell.Syntax.Extension.html#unXRec"><span class="hs-identifier hs-var">unXRec</span></a></span><span> </span><span class="hs-glyph">@</span><span class="hs-special">(</span><span class="annot"><a href="GHC.Hs.Extension.html#GhcPass"><span class="hs-identifier hs-type">GhcPass</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683034680"><span class="hs-identifier hs-type">p</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1630"></span><span>
</span><span id="line-1631"></span><span class="hs-comment">-- | Create an error message when there is no single 'ConLike' which</span><span>
</span><span id="line-1632"></span><span class="hs-comment">-- has all of the required fields for a record update.</span><span>
</span><span id="line-1633"></span><span class="hs-comment">--</span><span>
</span><span id="line-1634"></span><span class="hs-comment">-- This boils down the problem to a smaller set of fields, to avoid</span><span>
</span><span id="line-1635"></span><span class="hs-comment">-- the error message containing a lot of uninformative field names that</span><span>
</span><span id="line-1636"></span><span class="hs-comment">-- aren't really relevant to the problem.</span><span>
</span><span id="line-1637"></span><span class="hs-comment">--</span><span>
</span><span id="line-1638"></span><span class="hs-comment">-- NB: this error message should only be triggered when all the field names</span><span>
</span><span id="line-1639"></span><span class="hs-comment">-- are in scope (i.e. each individual field name does belong to some</span><span>
</span><span id="line-1640"></span><span class="hs-comment">-- constructor in scope).</span><span>
</span><span id="line-1641"></span><span id="local-6989586621683034675"><span id="local-6989586621683034676"><span class="annot"><a href="GHC.Rename.Env.html#badFieldsUpd"><span class="hs-identifier hs-type">badFieldsUpd</span></a></span><span>
</span><span id="line-1642"></span><span>  </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Hs.Extension.html#OutputableBndrId"><span class="hs-identifier hs-type">OutputableBndrId</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683034675"><span class="hs-identifier hs-type">p</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1643"></span><span>  </span><span class="hs-glyph">=&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="Language.Haskell.Syntax.Pat.html#LHsRecUpdField"><span class="hs-identifier hs-type">LHsRecUpdField</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Hs.Extension.html#GhcPass"><span class="hs-identifier hs-type">GhcPass</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683034675"><span class="hs-identifier hs-type">p</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><a href="#local-6989586621683034676"><span class="hs-identifier hs-type">q</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-1644"></span><span>               </span><span class="annot"><span class="hs-comment">-- ^ Field names that don't belong to a single datacon</span></span><span>
</span><span id="line-1645"></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Types.Unique.FM.html#UniqFM"><span class="hs-identifier hs-type">UniqFM</span></a></span><span> </span><span class="annot"><a href="GHC.Types.GREInfo.html#ConLikeName"><span class="hs-identifier hs-type">ConLikeName</span></a></span><span> </span><span class="hs-special">[</span><span class="annot"><a href="GHC.Types.FieldLabel.html#FieldLabel"><span class="hs-identifier hs-type">FieldLabel</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-1646"></span><span>      </span><span class="hs-comment">-- ^ The list of field labels for each constructor.</span><span>
</span><span id="line-1647"></span><span>      </span><span class="hs-comment">-- (These are the constructors in which the first field occurs.)</span><span>
</span><span id="line-1648"></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Errors.Types.html#TcRnMessage"><span class="hs-identifier hs-type">TcRnMessage</span></a></span></span></span><span>
</span><span id="line-1649"></span><span id="badFieldsUpd"><span class="annot"><span class="annottext">badFieldsUpd :: forall (p :: Pass) q.
OutputableBndrId p =&gt;
[LHsRecUpdField (GhcPass p) q]
-&gt; UniqFM ConLikeName [FieldLabel] -&gt; TcRnMessage
</span><a href="GHC.Rename.Env.html#badFieldsUpd"><span class="hs-identifier hs-var hs-var">badFieldsUpd</span></a></span></span><span> </span><span id="local-6989586621683035909"><span class="annot"><span class="annottext">[LHsRecUpdField (GhcPass p) q]
</span><a href="#local-6989586621683035909"><span class="hs-identifier hs-var">rbinds</span></a></span></span><span> </span><span id="local-6989586621683035910"><span class="annot"><span class="annottext">UniqFM ConLikeName [FieldLabel]
</span><a href="#local-6989586621683035910"><span class="hs-identifier hs-var">fld1_cons_fields</span></a></span></span><span>
</span><span id="line-1650"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[RdrName] -&gt; BadRecordUpdateReason -&gt; TcRnMessage
</span><a href="GHC.Tc.Errors.Types.html#TcRnBadRecordUpdate"><span class="hs-identifier hs-var">TcRnBadRecordUpdate</span></a></span><span>
</span><span id="line-1651"></span><span>      </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[LHsRecUpdField (GhcPass p) q] -&gt; [RdrName]
forall (p :: Pass) q.
IsPass p =&gt;
[LHsRecUpdField (GhcPass p) q] -&gt; [RdrName]
</span><a href="GHC.Rename.Env.html#getUpdFieldLbls"><span class="hs-identifier hs-var">getUpdFieldLbls</span></a></span><span> </span><span class="annot"><span class="annottext">[LHsRecUpdField (GhcPass p) q]
</span><a href="#local-6989586621683035909"><span class="hs-identifier hs-var">rbinds</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1652"></span><span>      </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[FieldLabelString] -&gt; BadRecordUpdateReason
</span><a href="GHC.Tc.Errors.Types.html#NoConstructorHasAllFields"><span class="hs-identifier hs-var">NoConstructorHasAllFields</span></a></span><span> </span><span class="annot"><span class="annottext">[FieldLabelString]
</span><a href="#local-6989586621683035912"><span class="hs-identifier hs-var">conflictingFields</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1653"></span><span>          </span><span class="hs-comment">-- See Note [Finding the conflicting fields]</span><span>
</span><span id="line-1654"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-1655"></span><span>    </span><span class="hs-comment">-- A (preferably small) set of fields such that no constructor contains</span><span>
</span><span id="line-1656"></span><span>    </span><span class="hs-comment">-- all of them.  See Note [Finding the conflicting fields]</span><span>
</span><span id="line-1657"></span><span>    </span><span id="local-6989586621683035912"><span class="annot"><span class="annottext">conflictingFields :: [FieldLabelString]
</span><a href="#local-6989586621683035912"><span class="hs-identifier hs-var hs-var">conflictingFields</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">[(FieldLabelString, [Bool])]
</span><a href="#local-6989586621683035919"><span class="hs-identifier hs-var">nonMembers</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-1658"></span><span>        </span><span class="hs-comment">-- nonMember belongs to a different type.</span><span>
</span><span id="line-1659"></span><span>        </span><span class="hs-special">(</span><span id="local-6989586621683035920"><span class="annot"><span class="annottext">FieldLabelString
</span><a href="#local-6989586621683035920"><span class="hs-identifier hs-var">nonMember</span></a></span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">[Bool]
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="hs-glyph hs-type">:</span></span><span> </span><span class="annot"><span class="annottext">[(FieldLabelString, [Bool])]
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">FieldLabelString
</span><a href="#local-6989586621683035921"><span class="hs-identifier hs-var">aMember</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">FieldLabelString
</span><a href="#local-6989586621683035920"><span class="hs-identifier hs-var">nonMember</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-1660"></span><span>        </span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">let</span><span>
</span><span id="line-1661"></span><span>            </span><span class="hs-comment">-- All of rbinds belong to one type. In this case, repeatedly add</span><span>
</span><span id="line-1662"></span><span>            </span><span class="hs-comment">-- a field to the set until no constructor contains the set.</span><span>
</span><span id="line-1663"></span><span>
</span><span id="line-1664"></span><span>            </span><span class="hs-comment">-- Each field, together with a list indicating which constructors</span><span>
</span><span id="line-1665"></span><span>            </span><span class="hs-comment">-- have all the fields so far.</span><span>
</span><span id="line-1666"></span><span>            </span><span class="annot"><a href="#local-6989586621683035922"><span class="hs-identifier hs-type">growingSets</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><span class="hs-special">(</span><span class="annot"><a href="Language.Haskell.Syntax.Basic.html#FieldLabelString"><span class="hs-identifier hs-type">FieldLabelString</span></a></span><span class="hs-special">,</span><span> </span><span class="hs-special">[</span><span class="annot"><span class="hs-identifier hs-type">Bool</span></span><span class="hs-special">]</span><span class="hs-special">)</span><span class="hs-special">]</span><span>
</span><span id="line-1667"></span><span>            </span><span id="local-6989586621683035922"><span class="annot"><span class="annottext">growingSets :: [(FieldLabelString, [Bool])]
</span><a href="#local-6989586621683035922"><span class="hs-identifier hs-var hs-var">growingSets</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">((FieldLabelString, [Bool])
 -&gt; (FieldLabelString, [Bool]) -&gt; (FieldLabelString, [Bool]))
-&gt; [(FieldLabelString, [Bool])] -&gt; [(FieldLabelString, [Bool])]
forall a. (a -&gt; a -&gt; a) -&gt; [a] -&gt; [a]
</span><span class="hs-identifier hs-var">scanl1</span></span><span> </span><span class="annot"><span class="annottext">(FieldLabelString, [Bool])
-&gt; (FieldLabelString, [Bool]) -&gt; (FieldLabelString, [Bool])
forall {a} {a}. (a, [Bool]) -&gt; (a, [Bool]) -&gt; (a, [Bool])
</span><a href="#local-6989586621683035924"><span class="hs-identifier hs-var">combine</span></a></span><span> </span><span class="annot"><span class="annottext">[(FieldLabelString, [Bool])]
</span><a href="#local-6989586621683035925"><span class="hs-identifier hs-var">membership</span></a></span><span>
</span><span id="line-1668"></span><span>            </span><span id="local-6989586621683035924"><span class="annot"><span class="annottext">combine :: (a, [Bool]) -&gt; (a, [Bool]) -&gt; (a, [Bool])
</span><a href="#local-6989586621683035924"><span class="hs-identifier hs-var hs-var">combine</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">a
</span><span class="hs-identifier">_</span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621683035926"><span class="annot"><span class="annottext">[Bool]
</span><a href="#local-6989586621683035926"><span class="hs-identifier hs-var">setMem</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span id="local-6989586621683035927"><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621683035927"><span class="hs-identifier hs-var">field</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621683035928"><span class="annot"><span class="annottext">[Bool]
</span><a href="#local-6989586621683035928"><span class="hs-identifier hs-var">fldMem</span></a></span></span><span class="hs-special">)</span><span>
</span><span id="line-1669"></span><span>              </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621683035927"><span class="hs-identifier hs-var">field</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">(Bool -&gt; Bool -&gt; Bool) -&gt; [Bool] -&gt; [Bool] -&gt; [Bool]
forall a b c. (a -&gt; b -&gt; c) -&gt; [a] -&gt; [b] -&gt; [c]
</span><span class="hs-identifier hs-var">zipWith</span></span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Bool -&gt; Bool
</span><span class="hs-operator hs-var">(&amp;&amp;)</span></span><span> </span><span class="annot"><span class="annottext">[Bool]
</span><a href="#local-6989586621683035926"><span class="hs-identifier hs-var">setMem</span></a></span><span> </span><span class="annot"><span class="annottext">[Bool]
</span><a href="#local-6989586621683035928"><span class="hs-identifier hs-var">fldMem</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1670"></span><span>            </span><span class="hs-keyword">in</span><span>
</span><span id="line-1671"></span><span>            </span><span class="hs-comment">-- Fields that don't change the membership status of the set</span><span>
</span><span id="line-1672"></span><span>            </span><span class="hs-comment">-- are redundant and can be dropped.</span><span>
</span><span id="line-1673"></span><span>            </span><span class="annot"><span class="annottext">([(FieldLabelString, [Bool])] -&gt; FieldLabelString)
-&gt; [[(FieldLabelString, [Bool])]] -&gt; [FieldLabelString]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><span class="hs-identifier hs-var">map</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(FieldLabelString, [Bool]) -&gt; FieldLabelString
forall a b. (a, b) -&gt; a
</span><span class="hs-identifier hs-var">fst</span></span><span> </span><span class="annot"><span class="annottext">((FieldLabelString, [Bool]) -&gt; FieldLabelString)
-&gt; ([(FieldLabelString, [Bool])] -&gt; (FieldLabelString, [Bool]))
-&gt; [(FieldLabelString, [Bool])]
-&gt; FieldLabelString
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">[(FieldLabelString, [Bool])] -&gt; (FieldLabelString, [Bool])
forall a. HasCallStack =&gt; [a] -&gt; a
</span><a href="GHC.Prelude.Basic.html#head"><span class="hs-identifier hs-var">head</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">([[(FieldLabelString, [Bool])]] -&gt; [FieldLabelString])
-&gt; [[(FieldLabelString, [Bool])]] -&gt; [FieldLabelString]
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">((FieldLabelString, [Bool]) -&gt; (FieldLabelString, [Bool]) -&gt; Bool)
-&gt; [(FieldLabelString, [Bool])] -&gt; [[(FieldLabelString, [Bool])]]
forall a. (a -&gt; a -&gt; Bool) -&gt; [a] -&gt; [[a]]
</span><span class="hs-identifier hs-var">groupBy</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[Bool] -&gt; [Bool] -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">(==)</span></span><span> </span><span class="annot"><span class="annottext">([Bool] -&gt; [Bool] -&gt; Bool)
-&gt; ((FieldLabelString, [Bool]) -&gt; [Bool])
-&gt; (FieldLabelString, [Bool])
-&gt; (FieldLabelString, [Bool])
-&gt; Bool
forall b c a. (b -&gt; b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; a -&gt; c
</span><span class="hs-operator hs-var">`on`</span></span><span> </span><span class="annot"><span class="annottext">(FieldLabelString, [Bool]) -&gt; [Bool]
forall a b. (a, b) -&gt; b
</span><span class="hs-identifier hs-var">snd</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[(FieldLabelString, [Bool])]
</span><a href="#local-6989586621683035922"><span class="hs-identifier hs-var">growingSets</span></a></span><span>
</span><span id="line-1674"></span><span>
</span><span id="line-1675"></span><span>    </span><span id="local-6989586621683035921"><span class="annot"><span class="annottext">aMember :: FieldLabelString
</span><a href="#local-6989586621683035921"><span class="hs-identifier hs-var hs-var">aMember</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Bool
-&gt; ((FieldLabelString, [Bool]) -&gt; FieldLabelString)
-&gt; (FieldLabelString, [Bool])
-&gt; FieldLabelString
forall a. HasCallStack =&gt; Bool -&gt; a -&gt; a
</span><a href="GHC.Utils.Panic.Plain.html#assert"><span class="hs-identifier hs-var">assert</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Bool -&gt; Bool
</span><span class="hs-identifier hs-var">not</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[(FieldLabelString, [Bool])] -&gt; Bool
forall a. [a] -&gt; Bool
forall (t :: * -&gt; *) a. Foldable t =&gt; t a -&gt; Bool
</span><span class="hs-identifier hs-var">null</span></span><span> </span><span class="annot"><span class="annottext">[(FieldLabelString, [Bool])]
</span><a href="#local-6989586621683035940"><span class="hs-identifier hs-var">members</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(FieldLabelString, [Bool]) -&gt; FieldLabelString
forall a b. (a, b) -&gt; a
</span><span class="hs-identifier hs-var">fst</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[(FieldLabelString, [Bool])] -&gt; (FieldLabelString, [Bool])
forall a. HasCallStack =&gt; [a] -&gt; a
</span><a href="GHC.Prelude.Basic.html#head"><span class="hs-identifier hs-var">head</span></a></span><span> </span><span class="annot"><span class="annottext">[(FieldLabelString, [Bool])]
</span><a href="#local-6989586621683035940"><span class="hs-identifier hs-var">members</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1676"></span><span>    </span><span class="hs-special">(</span><span id="local-6989586621683035940"><span class="annot"><span class="annottext">[(FieldLabelString, [Bool])]
</span><a href="#local-6989586621683035940"><span class="hs-identifier hs-var">members</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621683035919"><span class="annot"><span class="annottext">[(FieldLabelString, [Bool])]
</span><a href="#local-6989586621683035919"><span class="hs-identifier hs-var">nonMembers</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">((FieldLabelString, [Bool]) -&gt; Bool)
-&gt; [(FieldLabelString, [Bool])]
-&gt; ([(FieldLabelString, [Bool])], [(FieldLabelString, [Bool])])
forall a. (a -&gt; Bool) -&gt; [a] -&gt; ([a], [a])
</span><span class="hs-identifier hs-var">partition</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[Bool] -&gt; Bool
forall (t :: * -&gt; *). Foldable t =&gt; t Bool -&gt; Bool
</span><span class="hs-identifier hs-var">or</span></span><span> </span><span class="annot"><span class="annottext">([Bool] -&gt; Bool)
-&gt; ((FieldLabelString, [Bool]) -&gt; [Bool])
-&gt; (FieldLabelString, [Bool])
-&gt; Bool
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">(FieldLabelString, [Bool]) -&gt; [Bool]
forall a b. (a, b) -&gt; b
</span><span class="hs-identifier hs-var">snd</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[(FieldLabelString, [Bool])]
</span><a href="#local-6989586621683035925"><span class="hs-identifier hs-var">membership</span></a></span><span>
</span><span id="line-1677"></span><span>
</span><span id="line-1678"></span><span>    </span><span class="hs-comment">-- For each field, which constructors contain the field?</span><span>
</span><span id="line-1679"></span><span>    </span><span class="annot"><a href="#local-6989586621683035925"><span class="hs-identifier hs-type">membership</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><span class="hs-special">(</span><span class="annot"><a href="Language.Haskell.Syntax.Basic.html#FieldLabelString"><span class="hs-identifier hs-type">FieldLabelString</span></a></span><span class="hs-special">,</span><span> </span><span class="hs-special">[</span><span class="annot"><span class="hs-identifier hs-type">Bool</span></span><span class="hs-special">]</span><span class="hs-special">)</span><span class="hs-special">]</span><span>
</span><span id="line-1680"></span><span>    </span><span id="local-6989586621683035925"><span class="annot"><span class="annottext">membership :: [(FieldLabelString, [Bool])]
</span><a href="#local-6989586621683035925"><span class="hs-identifier hs-var hs-var">membership</span></a></span></span><span>
</span><span id="line-1681"></span><span>      </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[(FieldLabelString, [Bool])] -&gt; [(FieldLabelString, [Bool])]
forall {a}. [(a, [Bool])] -&gt; [(a, [Bool])]
</span><a href="#local-6989586621683035943"><span class="hs-identifier hs-var">sortMembership</span></a></span><span> </span><span class="annot"><span class="annottext">([(FieldLabelString, [Bool])] -&gt; [(FieldLabelString, [Bool])])
-&gt; [(FieldLabelString, [Bool])] -&gt; [(FieldLabelString, [Bool])]
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-1682"></span><span>        </span><span class="annot"><span class="annottext">(GenLocated
   SrcSpanAnnA
   (HsFieldBind
      (GenLocated SrcSpanAnnA (FieldOcc (GhcPass p)))
      (XRec q (HsExpr q)))
 -&gt; (FieldLabelString, [Bool]))
-&gt; [GenLocated
      SrcSpanAnnA
      (HsFieldBind
         (GenLocated SrcSpanAnnA (FieldOcc (GhcPass p)))
         (XRec q (HsExpr q)))]
-&gt; [(FieldLabelString, [Bool])]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><span class="hs-identifier hs-var">map</span></span><span>
</span><span id="line-1683"></span><span>          </span><span class="hs-special">(</span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span id="local-6989586621683035944"><span class="annot"><span class="annottext">FieldLabelString
</span><a href="#local-6989586621683035944"><span class="hs-identifier hs-var">fld</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">FieldLabelString
</span><a href="#local-6989586621683035944"><span class="hs-identifier hs-var">fld</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">(UniqSet FieldLabelString -&gt; Bool)
-&gt; [UniqSet FieldLabelString] -&gt; [Bool]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><span class="hs-identifier hs-var">map</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">FieldLabelString
</span><a href="#local-6989586621683035944"><span class="hs-identifier hs-var">fld</span></a></span><span> </span><span class="annot"><span class="annottext">FieldLabelString -&gt; UniqSet FieldLabelString -&gt; Bool
forall a. Uniquable a =&gt; a -&gt; UniqSet a -&gt; Bool
</span><a href="GHC.Types.Unique.Set.html#elementOfUniqSet"><span class="hs-operator hs-var">`elementOfUniqSet`</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[UniqSet FieldLabelString]
</span><a href="#local-6989586621683035946"><span class="hs-identifier hs-var">fieldLabelSets</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-1684"></span><span>          </span><span class="annot"><span class="annottext">(FieldLabelString -&gt; (FieldLabelString, [Bool]))
-&gt; (GenLocated
      SrcSpanAnnA
      (HsFieldBind
         (GenLocated SrcSpanAnnA (FieldOcc (GhcPass p)))
         (XRec q (HsExpr q)))
    -&gt; FieldLabelString)
-&gt; GenLocated
     SrcSpanAnnA
     (HsFieldBind
        (GenLocated SrcSpanAnnA (FieldOcc (GhcPass p)))
        (XRec q (HsExpr q)))
-&gt; (FieldLabelString, [Bool])
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">FastString -&gt; FieldLabelString
</span><a href="Language.Haskell.Syntax.Basic.html#FieldLabelString"><span class="hs-identifier hs-var">FieldLabelString</span></a></span><span> </span><span class="annot"><span class="annottext">(FastString -&gt; FieldLabelString)
-&gt; (GenLocated
      SrcSpanAnnA
      (HsFieldBind
         (GenLocated SrcSpanAnnA (FieldOcc (GhcPass p)))
         (XRec q (HsExpr q)))
    -&gt; FastString)
-&gt; GenLocated
     SrcSpanAnnA
     (HsFieldBind
        (GenLocated SrcSpanAnnA (FieldOcc (GhcPass p)))
        (XRec q (HsExpr q)))
-&gt; FieldLabelString
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">OccName -&gt; FastString
</span><a href="GHC.Types.Name.Occurrence.html#occNameFS"><span class="hs-identifier hs-var">occNameFS</span></a></span><span> </span><span class="annot"><span class="annottext">(OccName -&gt; FastString)
-&gt; (GenLocated
      SrcSpanAnnA
      (HsFieldBind
         (GenLocated SrcSpanAnnA (FieldOcc (GhcPass p)))
         (XRec q (HsExpr q)))
    -&gt; OccName)
-&gt; GenLocated
     SrcSpanAnnA
     (HsFieldBind
        (GenLocated SrcSpanAnnA (FieldOcc (GhcPass p)))
        (XRec q (HsExpr q)))
-&gt; FastString
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">RdrName -&gt; OccName
</span><a href="GHC.Types.Name.Reader.html#rdrNameOcc"><span class="hs-identifier hs-var">rdrNameOcc</span></a></span><span> </span><span class="annot"><span class="annottext">(RdrName -&gt; OccName)
-&gt; (GenLocated
      SrcSpanAnnA
      (HsFieldBind
         (GenLocated SrcSpanAnnA (FieldOcc (GhcPass p)))
         (XRec q (HsExpr q)))
    -&gt; RdrName)
-&gt; GenLocated
     SrcSpanAnnA
     (HsFieldBind
        (GenLocated SrcSpanAnnA (FieldOcc (GhcPass p)))
        (XRec q (HsExpr q)))
-&gt; OccName
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">LocatedN RdrName -&gt; RdrName
forall l e. GenLocated l e -&gt; e
</span><a href="GHC.Types.SrcLoc.html#unLoc"><span class="hs-identifier hs-var">unLoc</span></a></span><span> </span><span class="annot"><span class="annottext">(LocatedN RdrName -&gt; RdrName)
-&gt; (GenLocated
      SrcSpanAnnA
      (HsFieldBind
         (GenLocated SrcSpanAnnA (FieldOcc (GhcPass p)))
         (XRec q (HsExpr q)))
    -&gt; LocatedN RdrName)
-&gt; GenLocated
     SrcSpanAnnA
     (HsFieldBind
        (GenLocated SrcSpanAnnA (FieldOcc (GhcPass p)))
        (XRec q (HsExpr q)))
-&gt; RdrName
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">LHsRecUpdField (GhcPass p) q -&gt; LocatedN RdrName
GenLocated
  SrcSpanAnnA
  (HsFieldBind
     (GenLocated SrcSpanAnnA (FieldOcc (GhcPass p)))
     (XRec q (HsExpr q)))
-&gt; LocatedN RdrName
forall (p :: Pass) q.
IsPass p =&gt;
LHsRecUpdField (GhcPass p) q -&gt; LocatedN RdrName
</span><a href="GHC.Rename.Env.html#getFieldUpdLbl"><span class="hs-identifier hs-var">getFieldUpdLbl</span></a></span><span> </span><span class="hs-special">)</span><span>
</span><span id="line-1685"></span><span>          </span><span class="annot"><span class="annottext">[LHsRecUpdField (GhcPass p) q]
[GenLocated
   SrcSpanAnnA
   (HsFieldBind
      (GenLocated SrcSpanAnnA (FieldOcc (GhcPass p)))
      (XRec q (HsExpr q)))]
</span><a href="#local-6989586621683035909"><span class="hs-identifier hs-var">rbinds</span></a></span><span>
</span><span id="line-1686"></span><span>
</span><span id="line-1687"></span><span>    </span><span class="annot"><a href="#local-6989586621683035946"><span class="hs-identifier hs-type">fieldLabelSets</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="GHC.Types.Unique.Set.html#UniqSet"><span class="hs-identifier hs-type">UniqSet</span></a></span><span> </span><span class="annot"><a href="Language.Haskell.Syntax.Basic.html#FieldLabelString"><span class="hs-identifier hs-type">FieldLabelString</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-1688"></span><span>    </span><span id="local-6989586621683035946"><span class="annot"><span class="annottext">fieldLabelSets :: [UniqSet FieldLabelString]
</span><a href="#local-6989586621683035946"><span class="hs-identifier hs-var hs-var">fieldLabelSets</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">([FieldLabel] -&gt; UniqSet FieldLabelString)
-&gt; [[FieldLabel]] -&gt; [UniqSet FieldLabelString]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><span class="hs-identifier hs-var">map</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[FieldLabelString] -&gt; UniqSet FieldLabelString
forall a. Uniquable a =&gt; [a] -&gt; UniqSet a
</span><a href="GHC.Types.Unique.Set.html#mkUniqSet"><span class="hs-identifier hs-var">mkUniqSet</span></a></span><span> </span><span class="annot"><span class="annottext">([FieldLabelString] -&gt; UniqSet FieldLabelString)
-&gt; ([FieldLabel] -&gt; [FieldLabelString])
-&gt; [FieldLabel]
-&gt; UniqSet FieldLabelString
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">(FieldLabel -&gt; FieldLabelString)
-&gt; [FieldLabel] -&gt; [FieldLabelString]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><span class="hs-identifier hs-var">map</span></span><span> </span><span class="annot"><span class="annottext">FieldLabel -&gt; FieldLabelString
</span><a href="GHC.Types.FieldLabel.html#flLabel"><span class="hs-identifier hs-var">flLabel</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">([[FieldLabel]] -&gt; [UniqSet FieldLabelString])
-&gt; [[FieldLabel]] -&gt; [UniqSet FieldLabelString]
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">UniqFM ConLikeName [FieldLabel] -&gt; [[FieldLabel]]
forall {k} (key :: k) elt. UniqFM key elt -&gt; [elt]
</span><a href="GHC.Types.Unique.FM.html#nonDetEltsUFM"><span class="hs-identifier hs-var">nonDetEltsUFM</span></a></span><span> </span><span class="annot"><span class="annottext">UniqFM ConLikeName [FieldLabel]
</span><a href="#local-6989586621683035910"><span class="hs-identifier hs-var">fld1_cons_fields</span></a></span><span>
</span><span id="line-1689"></span><span>
</span><span id="line-1690"></span><span>    </span><span class="hs-comment">-- Sort in order of increasing number of True, so that a smaller</span><span>
</span><span id="line-1691"></span><span>    </span><span class="hs-comment">-- conflicting set can be found.</span><span>
</span><span id="line-1692"></span><span>    </span><span id="local-6989586621683035943"><span class="annot"><span class="annottext">sortMembership :: [(a, [Bool])] -&gt; [(a, [Bool])]
</span><a href="#local-6989586621683035943"><span class="hs-identifier hs-var hs-var">sortMembership</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-1693"></span><span>      </span><span class="annot"><span class="annottext">((Arity, (a, [Bool])) -&gt; (a, [Bool]))
-&gt; [(Arity, (a, [Bool]))] -&gt; [(a, [Bool])]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><span class="hs-identifier hs-var">map</span></span><span> </span><span class="annot"><span class="annottext">(Arity, (a, [Bool])) -&gt; (a, [Bool])
forall a b. (a, b) -&gt; b
</span><span class="hs-identifier hs-var">snd</span></span><span> </span><span class="annot"><span class="annottext">([(Arity, (a, [Bool]))] -&gt; [(a, [Bool])])
-&gt; ([(a, [Bool])] -&gt; [(Arity, (a, [Bool]))])
-&gt; [(a, [Bool])]
-&gt; [(a, [Bool])]
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span>
</span><span id="line-1694"></span><span>      </span><span class="annot"><span class="annottext">((Arity, (a, [Bool])) -&gt; (Arity, (a, [Bool])) -&gt; Ordering)
-&gt; [(Arity, (a, [Bool]))] -&gt; [(Arity, (a, [Bool]))]
forall a. (a -&gt; a -&gt; Ordering) -&gt; [a] -&gt; [a]
</span><span class="hs-identifier hs-var">sortBy</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Arity -&gt; Arity -&gt; Ordering
forall a. Ord a =&gt; a -&gt; a -&gt; Ordering
</span><span class="hs-identifier hs-var">compare</span></span><span> </span><span class="annot"><span class="annottext">(Arity -&gt; Arity -&gt; Ordering)
-&gt; ((Arity, (a, [Bool])) -&gt; Arity)
-&gt; (Arity, (a, [Bool]))
-&gt; (Arity, (a, [Bool]))
-&gt; Ordering
forall b c a. (b -&gt; b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; a -&gt; c
</span><span class="hs-operator hs-var">`on`</span></span><span> </span><span class="annot"><span class="annottext">(Arity, (a, [Bool])) -&gt; Arity
forall a b. (a, b) -&gt; a
</span><span class="hs-identifier hs-var">fst</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">([(Arity, (a, [Bool]))] -&gt; [(Arity, (a, [Bool]))])
-&gt; ([(a, [Bool])] -&gt; [(Arity, (a, [Bool]))])
-&gt; [(a, [Bool])]
-&gt; [(Arity, (a, [Bool]))]
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span>
</span><span id="line-1695"></span><span>      </span><span class="annot"><span class="annottext">((a, [Bool]) -&gt; (Arity, (a, [Bool])))
-&gt; [(a, [Bool])] -&gt; [(Arity, (a, [Bool]))]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><span class="hs-identifier hs-var">map</span></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span> </span><span id="local-6989586621683035952"><span class="annot"><span class="annottext">item :: (a, [Bool])
</span><a href="#local-6989586621683035952"><span class="hs-identifier hs-var">item</span></a></span></span><span class="hs-glyph">@</span><span class="hs-special">(</span><span class="annot"><span class="annottext">a
</span><span class="hs-identifier">_</span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621683035953"><span class="annot"><span class="annottext">[Bool]
</span><a href="#local-6989586621683035953"><span class="hs-identifier hs-var">membershipRow</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[Bool] -&gt; Arity
</span><a href="#local-6989586621683035954"><span class="hs-identifier hs-var">countTrue</span></a></span><span> </span><span class="annot"><span class="annottext">[Bool]
</span><a href="#local-6989586621683035953"><span class="hs-identifier hs-var">membershipRow</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">(a, [Bool])
</span><a href="#local-6989586621683035952"><span class="hs-identifier hs-var">item</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-1696"></span><span>
</span><span id="line-1697"></span><span>    </span><span id="local-6989586621683035954"><span class="annot"><span class="annottext">countTrue :: [Bool] -&gt; Arity
</span><a href="#local-6989586621683035954"><span class="hs-identifier hs-var hs-var">countTrue</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(Bool -&gt; Bool) -&gt; [Bool] -&gt; Arity
forall a. (a -&gt; Bool) -&gt; [a] -&gt; Arity
</span><a href="GHC.Utils.Misc.html#count"><span class="hs-identifier hs-var">count</span></a></span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Bool
forall a. a -&gt; a
</span><span class="hs-identifier hs-var">id</span></span><span>
</span><span id="line-1698"></span><span>
</span><span id="line-1699"></span><span class="hs-comment">{-
Note [Finding the conflicting fields]
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
Suppose we have
  data A = A {a0, a1 :: Int}
         | B {b0, b1 :: Int}
and we see a record update
  x { a0 = 3, a1 = 2, b0 = 4, b1 = 5 }
Then we'd like to find the smallest subset of fields that no
constructor has all of.  Here, say, {a0,b0}, or {a0,b1}, etc.
We don't really want to report that no constructor has all of
{a0,a1,b0,b1}, because when there are hundreds of fields it's
hard to see what was really wrong.

We may need more than two fields, though; eg
  data T = A { x,y :: Int, v::Int }
         | B { y,z :: Int, v::Int }
         | C { z,x :: Int, v::Int }
with update
   r { x=e1, y=e2, z=e3 }, we

Finding the smallest subset is hard, so the code here makes
a decent stab, no more.  See #7989.
-}</span><span>
</span><span id="line-1723"></span><span>
</span><span id="line-1724"></span><span class="hs-comment">--------------------------------------------------</span><span>
</span><span id="line-1725"></span><span class="hs-comment">--      Lookup in the Global RdrEnv of the module</span><span>
</span><span id="line-1726"></span><span class="hs-comment">--------------------------------------------------</span><span>
</span><span id="line-1727"></span><span>
</span><span id="line-1728"></span><span class="hs-keyword">data</span><span> </span><span id="GreLookupResult"><span class="annot"><a href="GHC.Rename.Env.html#GreLookupResult"><span class="hs-identifier hs-var">GreLookupResult</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="GreNotFound"><span class="annot"><a href="GHC.Rename.Env.html#GreNotFound"><span class="hs-identifier hs-var">GreNotFound</span></a></span></span><span>
</span><span id="line-1729"></span><span>                     </span><span class="hs-glyph">|</span><span> </span><span id="OneNameMatch"><span class="annot"><a href="GHC.Rename.Env.html#OneNameMatch"><span class="hs-identifier hs-var">OneNameMatch</span></a></span></span><span> </span><span class="annot"><a href="GHC.Types.Name.Reader.html#GlobalRdrElt"><span class="hs-identifier hs-type">GlobalRdrElt</span></a></span><span>
</span><span id="line-1730"></span><span>                     </span><span class="hs-glyph">|</span><span> </span><span id="MultipleNames"><span class="annot"><a href="GHC.Rename.Env.html#MultipleNames"><span class="hs-identifier hs-var">MultipleNames</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">NE.NonEmpty</span></span><span> </span><span class="annot"><a href="GHC.Types.Name.Reader.html#GlobalRdrElt"><span class="hs-identifier hs-type">GlobalRdrElt</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1731"></span><span>
</span><span id="line-1732"></span><span class="annot"><a href="GHC.Rename.Env.html#lookupGreRn_maybe"><span class="hs-identifier hs-type">lookupGreRn_maybe</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Types.Name.Reader.html#WhichGREs"><span class="hs-identifier hs-type">WhichGREs</span></a></span><span> </span><span class="annot"><a href="GHC.Types.GREInfo.html#GREInfo"><span class="hs-identifier hs-type">GREInfo</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Types.Name.Reader.html#RdrName"><span class="hs-identifier hs-type">RdrName</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#RnM"><span class="hs-identifier hs-type">RnM</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Maybe</span></span><span> </span><span class="annot"><a href="GHC.Types.Name.Reader.html#GlobalRdrElt"><span class="hs-identifier hs-type">GlobalRdrElt</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1733"></span><span class="hs-comment">-- Look up the RdrName in the GlobalRdrEnv</span><span>
</span><span id="line-1734"></span><span class="hs-comment">--   Exactly one binding: records it as &quot;used&quot;, return (Just gre)</span><span>
</span><span id="line-1735"></span><span class="hs-comment">--   No bindings:         return Nothing</span><span>
</span><span id="line-1736"></span><span class="hs-comment">--   Many bindings:       report &quot;ambiguous&quot;, return an arbitrary (Just gre)</span><span>
</span><span id="line-1737"></span><span class="hs-comment">-- Uses addUsedRdrName to record use and deprecations</span><span>
</span><span id="line-1738"></span><span id="lookupGreRn_maybe"><span class="annot"><span class="annottext">lookupGreRn_maybe :: WhichGREs GREInfo -&gt; RdrName -&gt; RnM (Maybe GlobalRdrElt)
</span><a href="GHC.Rename.Env.html#lookupGreRn_maybe"><span class="hs-identifier hs-var hs-var">lookupGreRn_maybe</span></a></span></span><span> </span><span id="local-6989586621683035956"><span class="annot"><span class="annottext">WhichGREs GREInfo
</span><a href="#local-6989586621683035956"><span class="hs-identifier hs-var">which_gres</span></a></span></span><span> </span><span id="local-6989586621683035957"><span class="annot"><span class="annottext">RdrName
</span><a href="#local-6989586621683035957"><span class="hs-identifier hs-var">rdr_name</span></a></span></span><span>
</span><span id="line-1739"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-1740"></span><span>      </span><span id="local-6989586621683035958"><span class="annot"><a href="#local-6989586621683035958"><span class="hs-identifier hs-var">res</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">WhichGREs GREInfo
-&gt; RdrName -&gt; DeprecationWarnings -&gt; RnM GreLookupResult
</span><a href="GHC.Rename.Env.html#lookupGreRn_helper"><span class="hs-identifier hs-var">lookupGreRn_helper</span></a></span><span> </span><span class="annot"><span class="annottext">WhichGREs GREInfo
</span><a href="#local-6989586621683035956"><span class="hs-identifier hs-var">which_gres</span></a></span><span> </span><span class="annot"><span class="annottext">RdrName
</span><a href="#local-6989586621683035957"><span class="hs-identifier hs-var">rdr_name</span></a></span><span> </span><span class="annot"><span class="annottext">DeprecationWarnings
</span><a href="GHC.Rename.Utils.html#AllDeprecationWarnings"><span class="hs-identifier hs-var">AllDeprecationWarnings</span></a></span><span>
</span><span id="line-1741"></span><span>      </span><span class="hs-keyword">case</span><span> </span><span class="annot"><a href="#local-6989586621683035958"><span class="hs-identifier hs-type">res</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-1742"></span><span>        </span><span class="annot"><a href="GHC.Rename.Env.html#OneNameMatch"><span class="hs-identifier hs-type">OneNameMatch</span></a></span><span> </span><span id="local-6989586621683035959"><span class="annot"><span class="annottext">GlobalRdrElt
</span><a href="#local-6989586621683035959"><span class="hs-identifier hs-var">gre</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span>  </span><span class="annot"><span class="annottext">Maybe GlobalRdrElt -&gt; RnM (Maybe GlobalRdrElt)
forall a. a -&gt; IOEnv (Env TcGblEnv TcLclEnv) a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="annot"><span class="annottext">(Maybe GlobalRdrElt -&gt; RnM (Maybe GlobalRdrElt))
-&gt; Maybe GlobalRdrElt -&gt; RnM (Maybe GlobalRdrElt)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">GlobalRdrElt -&gt; Maybe GlobalRdrElt
forall a. a -&gt; Maybe a
</span><span class="hs-identifier hs-var">Just</span></span><span> </span><span class="annot"><span class="annottext">GlobalRdrElt
</span><a href="#local-6989586621683035959"><span class="hs-identifier hs-var">gre</span></a></span><span>
</span><span id="line-1743"></span><span>        </span><span class="annot"><a href="GHC.Rename.Env.html#MultipleNames"><span class="hs-identifier hs-type">MultipleNames</span></a></span><span> </span><span id="local-6989586621683035960"><span class="annot"><span class="annottext">NonEmpty GlobalRdrElt
</span><a href="#local-6989586621683035960"><span class="hs-identifier hs-var">gres</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-1744"></span><span>          </span><span class="annot"><span class="annottext">String -&gt; SDoc -&gt; IOEnv (Env TcGblEnv TcLclEnv) ()
</span><a href="GHC.Tc.Utils.Monad.html#traceRn"><span class="hs-identifier hs-var">traceRn</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;lookupGreRn_maybe:NameClash&quot;</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">NonEmpty GlobalRdrElt -&gt; SDoc
forall a. Outputable a =&gt; a -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="annot"><span class="annottext">NonEmpty GlobalRdrElt
</span><a href="#local-6989586621683035960"><span class="hs-identifier hs-var">gres</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1745"></span><span>          </span><span class="annot"><span class="annottext">RdrName
-&gt; NonEmpty GlobalRdrElt -&gt; IOEnv (Env TcGblEnv TcLclEnv) ()
</span><a href="GHC.Rename.Utils.html#addNameClashErrRn"><span class="hs-identifier hs-var">addNameClashErrRn</span></a></span><span> </span><span class="annot"><span class="annottext">RdrName
</span><a href="#local-6989586621683035957"><span class="hs-identifier hs-var">rdr_name</span></a></span><span> </span><span class="annot"><span class="annottext">NonEmpty GlobalRdrElt
</span><a href="#local-6989586621683035960"><span class="hs-identifier hs-var">gres</span></a></span><span>
</span><span id="line-1746"></span><span>          </span><span class="annot"><span class="annottext">Maybe GlobalRdrElt -&gt; RnM (Maybe GlobalRdrElt)
forall a. a -&gt; IOEnv (Env TcGblEnv TcLclEnv) a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="annot"><span class="annottext">(Maybe GlobalRdrElt -&gt; RnM (Maybe GlobalRdrElt))
-&gt; Maybe GlobalRdrElt -&gt; RnM (Maybe GlobalRdrElt)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">GlobalRdrElt -&gt; Maybe GlobalRdrElt
forall a. a -&gt; Maybe a
</span><span class="hs-identifier hs-var">Just</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">NonEmpty GlobalRdrElt -&gt; GlobalRdrElt
forall a. NonEmpty a -&gt; a
</span><a href="../../base-4.21.0.0-ae91/src/Data.List.NonEmpty.html#head"><span class="hs-identifier hs-var">NE.head</span></a></span><span> </span><span class="annot"><span class="annottext">NonEmpty GlobalRdrElt
</span><a href="#local-6989586621683035960"><span class="hs-identifier hs-var">gres</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1747"></span><span>        </span><span class="annot"><span class="annottext">GreLookupResult
</span><a href="GHC.Rename.Env.html#GreNotFound"><span class="hs-identifier hs-var">GreNotFound</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Maybe GlobalRdrElt -&gt; RnM (Maybe GlobalRdrElt)
forall a. a -&gt; IOEnv (Env TcGblEnv TcLclEnv) a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="annot"><span class="annottext">Maybe GlobalRdrElt
forall a. Maybe a
</span><span class="hs-identifier hs-var">Nothing</span></span><span>
</span><span id="line-1748"></span><span>
</span><span id="line-1749"></span><span class="hs-comment">{-

Note [ Unbound vs Ambiguous Names ]
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
lookupGreRn_maybe deals with failures in two different ways. If a name
is unbound then we return a `Nothing` but if the name is ambiguous
then we raise an error and return a dummy name.

The reason for this is that when we call `lookupGreRn_maybe` we are
speculatively looking for whatever we are looking up. If we don't find it,
then we might have been looking for the wrong thing and can keep trying.
On the other hand, if we find a clash then there is no way to recover as
we found the thing we were looking for but can no longer resolve which
the correct one is.

One example of this is in `lookupTypeOccRn` which first looks in the type
constructor namespace before looking in the data constructor namespace to
deal with `DataKinds`.

There is however, as always, one exception to this scheme. If we find
an ambiguous occurrence of a record selector and DuplicateRecordFields
is enabled then we defer the selection until the typechecker.

-}</span><span>
</span><span id="line-1773"></span><span>
</span><span id="line-1774"></span><span>
</span><span id="line-1775"></span><span class="hs-comment">-- Internal Function</span><span>
</span><span id="line-1776"></span><span class="annot"><a href="GHC.Rename.Env.html#lookupGreRn_helper"><span class="hs-identifier hs-type">lookupGreRn_helper</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Types.Name.Reader.html#WhichGREs"><span class="hs-identifier hs-type">WhichGREs</span></a></span><span> </span><span class="annot"><a href="GHC.Types.GREInfo.html#GREInfo"><span class="hs-identifier hs-type">GREInfo</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Types.Name.Reader.html#RdrName"><span class="hs-identifier hs-type">RdrName</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Rename.Utils.html#DeprecationWarnings"><span class="hs-identifier hs-type">DeprecationWarnings</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#RnM"><span class="hs-identifier hs-type">RnM</span></a></span><span> </span><span class="annot"><a href="GHC.Rename.Env.html#GreLookupResult"><span class="hs-identifier hs-type">GreLookupResult</span></a></span><span>
</span><span id="line-1777"></span><span id="lookupGreRn_helper"><span class="annot"><span class="annottext">lookupGreRn_helper :: WhichGREs GREInfo
-&gt; RdrName -&gt; DeprecationWarnings -&gt; RnM GreLookupResult
</span><a href="GHC.Rename.Env.html#lookupGreRn_helper"><span class="hs-identifier hs-var hs-var">lookupGreRn_helper</span></a></span></span><span> </span><span id="local-6989586621683035961"><span class="annot"><span class="annottext">WhichGREs GREInfo
</span><a href="#local-6989586621683035961"><span class="hs-identifier hs-var">which_gres</span></a></span></span><span> </span><span id="local-6989586621683035962"><span class="annot"><span class="annottext">RdrName
</span><a href="#local-6989586621683035962"><span class="hs-identifier hs-var">rdr_name</span></a></span></span><span> </span><span id="local-6989586621683035963"><span class="annot"><span class="annottext">DeprecationWarnings
</span><a href="#local-6989586621683035963"><span class="hs-identifier hs-var">warn_if_deprec</span></a></span></span><span>
</span><span id="line-1778"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>  </span><span class="hs-special">{</span><span> </span><span id="local-6989586621683035964"><span class="annot"><a href="#local-6989586621683035964"><span class="hs-identifier hs-var">env</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">TcRn GlobalRdrEnv
</span><a href="GHC.Tc.Utils.Monad.html#getGlobalRdrEnv"><span class="hs-identifier hs-var">getGlobalRdrEnv</span></a></span><span>
</span><span id="line-1779"></span><span>        </span><span class="hs-special">;</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><a href="GHC.Types.Name.Reader.html#lookupGRE"><span class="hs-identifier hs-type">lookupGRE</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683035964"><span class="hs-identifier hs-type">env</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Types.Name.Reader.html#LookupRdrName"><span class="hs-identifier hs-type">LookupRdrName</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683035962"><span class="hs-identifier hs-type">rdr_name</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683035961"><span class="hs-identifier hs-type">which_gres</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-1780"></span><span>            </span><span class="hs-special">[</span><span class="hs-special">]</span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">GreLookupResult -&gt; RnM GreLookupResult
forall a. a -&gt; IOEnv (Env TcGblEnv TcLclEnv) a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="annot"><span class="annottext">GreLookupResult
</span><a href="GHC.Rename.Env.html#GreNotFound"><span class="hs-identifier hs-var">GreNotFound</span></a></span><span>
</span><span id="line-1781"></span><span>            </span><span class="hs-special">[</span><span id="local-6989586621683035965"><span class="annot"><span class="annottext">GlobalRdrElt
</span><a href="#local-6989586621683035965"><span class="hs-identifier hs-var">gre</span></a></span></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">DeprecationWarnings
-&gt; GlobalRdrElt -&gt; IOEnv (Env TcGblEnv TcLclEnv) ()
</span><a href="GHC.Rename.Env.html#addUsedGRE"><span class="hs-identifier hs-var">addUsedGRE</span></a></span><span> </span><span class="annot"><span class="annottext">DeprecationWarnings
</span><a href="#local-6989586621683035963"><span class="hs-identifier hs-var">warn_if_deprec</span></a></span><span> </span><span class="annot"><span class="annottext">GlobalRdrElt
</span><a href="#local-6989586621683035965"><span class="hs-identifier hs-var">gre</span></a></span><span>
</span><span id="line-1782"></span><span>                        </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="annottext">GreLookupResult -&gt; RnM GreLookupResult
forall a. a -&gt; IOEnv (Env TcGblEnv TcLclEnv) a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">GlobalRdrElt -&gt; GreLookupResult
</span><a href="GHC.Rename.Env.html#OneNameMatch"><span class="hs-identifier hs-var">OneNameMatch</span></a></span><span> </span><span class="annot"><span class="annottext">GlobalRdrElt
</span><a href="#local-6989586621683035965"><span class="hs-identifier hs-var">gre</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-1783"></span><span>            </span><span class="hs-comment">-- Don't record usage for ambiguous names</span><span>
</span><span id="line-1784"></span><span>            </span><span class="hs-comment">-- until we know which is meant</span><span>
</span><span id="line-1785"></span><span>            </span><span class="hs-special">(</span><span id="local-6989586621683035966"><span class="annot"><span class="annottext">GlobalRdrElt
</span><a href="#local-6989586621683035966"><span class="hs-identifier hs-var">gre</span></a></span></span><span class="annot"><span class="hs-glyph hs-type">:</span></span><span id="local-6989586621683035967"><span class="annot"><span class="annottext">[GlobalRdrElt]
</span><a href="#local-6989586621683035967"><span class="hs-identifier hs-var">others</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">GreLookupResult -&gt; RnM GreLookupResult
forall a. a -&gt; IOEnv (Env TcGblEnv TcLclEnv) a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">NonEmpty GlobalRdrElt -&gt; GreLookupResult
</span><a href="GHC.Rename.Env.html#MultipleNames"><span class="hs-identifier hs-var">MultipleNames</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">GlobalRdrElt
</span><a href="#local-6989586621683035966"><span class="hs-identifier hs-var">gre</span></a></span><span> </span><span class="annot"><span class="annottext">GlobalRdrElt -&gt; [GlobalRdrElt] -&gt; NonEmpty GlobalRdrElt
forall a. a -&gt; [a] -&gt; NonEmpty a
</span><span class="hs-operator hs-var">NE.:|</span></span><span> </span><span class="annot"><span class="annottext">[GlobalRdrElt]
</span><a href="#local-6989586621683035967"><span class="hs-identifier hs-var">others</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-1786"></span><span>
</span><span id="line-1787"></span><span class="annot"><a href="GHC.Rename.Env.html#lookupGreAvailRn"><span class="hs-identifier hs-type">lookupGreAvailRn</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Types.Name.Reader.html#RdrName"><span class="hs-identifier hs-type">RdrName</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#RnM"><span class="hs-identifier hs-type">RnM</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Maybe</span></span><span> </span><span class="annot"><a href="GHC.Types.Name.Reader.html#GlobalRdrElt"><span class="hs-identifier hs-type">GlobalRdrElt</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1788"></span><span class="hs-comment">-- Used in export lists</span><span>
</span><span id="line-1789"></span><span class="hs-comment">-- If not found or ambiguous, add error message, and fake with UnboundName</span><span>
</span><span id="line-1790"></span><span class="hs-comment">-- Uses addUsedRdrName to record use and deprecations</span><span>
</span><span id="line-1791"></span><span id="lookupGreAvailRn"><span class="annot"><span class="annottext">lookupGreAvailRn :: RdrName -&gt; RnM (Maybe GlobalRdrElt)
</span><a href="GHC.Rename.Env.html#lookupGreAvailRn"><span class="hs-identifier hs-var hs-var">lookupGreAvailRn</span></a></span></span><span> </span><span id="local-6989586621683035968"><span class="annot"><span class="annottext">RdrName
</span><a href="#local-6989586621683035968"><span class="hs-identifier hs-var">rdr_name</span></a></span></span><span>
</span><span id="line-1792"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-1793"></span><span>      </span><span id="local-6989586621683035969"><span class="annot"><a href="#local-6989586621683035969"><span class="hs-identifier hs-var">mb_gre</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">WhichGREs GREInfo
-&gt; RdrName -&gt; DeprecationWarnings -&gt; RnM GreLookupResult
</span><a href="GHC.Rename.Env.html#lookupGreRn_helper"><span class="hs-identifier hs-var">lookupGreRn_helper</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">FieldsOrSelectors -&gt; WhichGREs GREInfo
</span><a href="GHC.Types.Name.Reader.html#RelevantGREsFOS"><span class="hs-identifier hs-var">RelevantGREsFOS</span></a></span><span> </span><span class="annot"><span class="annottext">FieldsOrSelectors
</span><a href="GHC.Types.Name.Reader.html#WantNormal"><span class="hs-identifier hs-var">WantNormal</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">RdrName
</span><a href="#local-6989586621683035968"><span class="hs-identifier hs-var">rdr_name</span></a></span><span> </span><span class="annot"><span class="annottext">DeprecationWarnings
</span><a href="GHC.Rename.Utils.html#ExportDeprecationWarnings"><span class="hs-identifier hs-var">ExportDeprecationWarnings</span></a></span><span>
</span><span id="line-1794"></span><span>      </span><span class="hs-keyword">case</span><span> </span><span class="annot"><a href="#local-6989586621683035969"><span class="hs-identifier hs-type">mb_gre</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-1795"></span><span>        </span><span class="annot"><span class="annottext">GreLookupResult
</span><a href="GHC.Rename.Env.html#GreNotFound"><span class="hs-identifier hs-var">GreNotFound</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-1796"></span><span>          </span><span class="hs-keyword">do</span><span>
</span><span id="line-1797"></span><span>            </span><span class="annot"><span class="annottext">String -&gt; SDoc -&gt; IOEnv (Env TcGblEnv TcLclEnv) ()
</span><a href="GHC.Tc.Utils.Monad.html#traceRn"><span class="hs-identifier hs-var">traceRn</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;lookupGreAvailRn&quot;</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">RdrName -&gt; SDoc
forall a. Outputable a =&gt; a -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="annot"><span class="annottext">RdrName
</span><a href="#local-6989586621683035968"><span class="hs-identifier hs-var">rdr_name</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1798"></span><span>            </span><span class="annot"><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">LookingFor -&gt; RdrName -&gt; RnM Name
</span><a href="GHC.Rename.Unbound.html#unboundName"><span class="hs-identifier hs-var">unboundName</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">WhatLooking -&gt; WhereLooking -&gt; LookingFor
</span><a href="GHC.Rename.Unbound.html#LF"><span class="hs-identifier hs-var">LF</span></a></span><span> </span><span class="annot"><span class="annottext">WhatLooking
</span><a href="GHC.Rename.Unbound.html#WL_Anything"><span class="hs-identifier hs-var">WL_Anything</span></a></span><span> </span><span class="annot"><span class="annottext">WhereLooking
</span><a href="GHC.Rename.Unbound.html#WL_Global"><span class="hs-identifier hs-var">WL_Global</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">RdrName
</span><a href="#local-6989586621683035968"><span class="hs-identifier hs-var">rdr_name</span></a></span><span>
</span><span id="line-1799"></span><span>            </span><span class="annot"><span class="hs-identifier hs-type">return</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Nothing</span></span><span>
</span><span id="line-1800"></span><span>        </span><span class="annot"><a href="GHC.Rename.Env.html#MultipleNames"><span class="hs-identifier hs-type">MultipleNames</span></a></span><span> </span><span id="local-6989586621683035971"><span class="annot"><span class="annottext">NonEmpty GlobalRdrElt
</span><a href="#local-6989586621683035971"><span class="hs-identifier hs-var">gres</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-1801"></span><span>          </span><span class="hs-keyword">do</span><span>
</span><span id="line-1802"></span><span>            </span><span class="annot"><span class="annottext">RdrName
-&gt; NonEmpty GlobalRdrElt -&gt; IOEnv (Env TcGblEnv TcLclEnv) ()
</span><a href="GHC.Rename.Utils.html#addNameClashErrRn"><span class="hs-identifier hs-var">addNameClashErrRn</span></a></span><span> </span><span class="annot"><span class="annottext">RdrName
</span><a href="#local-6989586621683035968"><span class="hs-identifier hs-var">rdr_name</span></a></span><span> </span><span class="annot"><span class="annottext">NonEmpty GlobalRdrElt
</span><a href="#local-6989586621683035971"><span class="hs-identifier hs-var">gres</span></a></span><span>
</span><span id="line-1803"></span><span>            </span><span class="annot"><span class="annottext">Maybe GlobalRdrElt -&gt; RnM (Maybe GlobalRdrElt)
forall a. a -&gt; IOEnv (Env TcGblEnv TcLclEnv) a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="annot"><span class="annottext">Maybe GlobalRdrElt
forall a. Maybe a
</span><span class="hs-identifier hs-var">Nothing</span></span><span>
</span><span id="line-1804"></span><span>              </span><span class="hs-comment">-- Prevent error cascade</span><span>
</span><span id="line-1805"></span><span>        </span><span class="annot"><a href="GHC.Rename.Env.html#OneNameMatch"><span class="hs-identifier hs-type">OneNameMatch</span></a></span><span> </span><span id="local-6989586621683035972"><span class="annot"><span class="annottext">GlobalRdrElt
</span><a href="#local-6989586621683035972"><span class="hs-identifier hs-var">gre</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-1806"></span><span>          </span><span class="annot"><span class="annottext">Maybe GlobalRdrElt -&gt; RnM (Maybe GlobalRdrElt)
forall a. a -&gt; IOEnv (Env TcGblEnv TcLclEnv) a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="annot"><span class="annottext">(Maybe GlobalRdrElt -&gt; RnM (Maybe GlobalRdrElt))
-&gt; Maybe GlobalRdrElt -&gt; RnM (Maybe GlobalRdrElt)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">GlobalRdrElt -&gt; Maybe GlobalRdrElt
forall a. a -&gt; Maybe a
</span><span class="hs-identifier hs-var">Just</span></span><span> </span><span class="annot"><span class="annottext">GlobalRdrElt
</span><a href="#local-6989586621683035972"><span class="hs-identifier hs-var">gre</span></a></span><span>
</span><span id="line-1807"></span><span>
</span><span id="line-1808"></span><span class="hs-comment">{-
*********************************************************
*                                                      *
                Deprecations
*                                                      *
*********************************************************

Note [Using isImportedGRE in addUsedGRE]
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
In addUsedGRE, we want to add any used imported GREs to the tcg_used_gres field,
so that we can emit appropriate warnings (see GHC.Rename.Names.warnUnusedImportDecls).

We want to do this for GREs that were brought into scope through imports. As per
Note [GlobalRdrElt provenance] in GHC.Types.Name.Reader, this means we should
check that gre_imp is non-empty. Checking that gre_lcl is False is INCORRECT,
because we might have obtained the GRE by an Exact or Orig direct reference,
in which case we have both gre_lcl = False and gre_imp = emptyBag.

Geting this wrong can lead to panics in e.g. bestImport, see #23240.
-}</span><span>
</span><span id="line-1828"></span><span>
</span><span id="line-1829"></span><span class="annot"><a href="GHC.Rename.Env.html#addUsedDataCons"><span class="hs-identifier hs-type">addUsedDataCons</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Types.Name.Reader.html#GlobalRdrEnv"><span class="hs-identifier hs-type">GlobalRdrEnv</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Core.TyCon.html#TyCon"><span class="hs-identifier hs-type">TyCon</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#RnM"><span class="hs-identifier hs-type">RnM</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-1830"></span><span class="hs-comment">-- Remember use of in-scope data constructors (#7969)</span><span>
</span><span id="line-1831"></span><span id="addUsedDataCons"><span class="annot"><span class="annottext">addUsedDataCons :: GlobalRdrEnv -&gt; TyCon -&gt; IOEnv (Env TcGblEnv TcLclEnv) ()
</span><a href="GHC.Rename.Env.html#addUsedDataCons"><span class="hs-identifier hs-var hs-var">addUsedDataCons</span></a></span></span><span> </span><span id="local-6989586621683035973"><span class="annot"><span class="annottext">GlobalRdrEnv
</span><a href="#local-6989586621683035973"><span class="hs-identifier hs-var">rdr_env</span></a></span></span><span> </span><span id="local-6989586621683035974"><span class="annot"><span class="annottext">TyCon
</span><a href="#local-6989586621683035974"><span class="hs-identifier hs-var">tycon</span></a></span></span><span>
</span><span id="line-1832"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">DeprecationWarnings
-&gt; [GlobalRdrElt] -&gt; IOEnv (Env TcGblEnv TcLclEnv) ()
</span><a href="GHC.Rename.Env.html#addUsedGREs"><span class="hs-identifier hs-var">addUsedGREs</span></a></span><span> </span><span class="annot"><span class="annottext">DeprecationWarnings
</span><a href="GHC.Rename.Utils.html#NoDeprecationWarnings"><span class="hs-identifier hs-var">NoDeprecationWarnings</span></a></span><span>
</span><span id="line-1833"></span><span>      </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">GlobalRdrElt
</span><a href="#local-6989586621683035975"><span class="hs-identifier hs-var">gre</span></a></span><span>
</span><span id="line-1834"></span><span>      </span><span class="hs-glyph">|</span><span> </span><span id="local-6989586621683035976"><span class="annot"><span class="annottext">DataCon
</span><a href="#local-6989586621683035976"><span class="hs-identifier hs-var">dc</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">TyCon -&gt; [DataCon]
</span><a href="GHC.Core.TyCon.html#tyConDataCons"><span class="hs-identifier hs-var">tyConDataCons</span></a></span><span> </span><span class="annot"><span class="annottext">TyCon
</span><a href="#local-6989586621683035974"><span class="hs-identifier hs-var">tycon</span></a></span><span>
</span><span id="line-1835"></span><span>      </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span id="local-6989586621683035975"><span class="annot"><span class="annottext">GlobalRdrElt
</span><a href="#local-6989586621683035975"><span class="hs-identifier hs-var">gre</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">GlobalRdrEnv -&gt; Name -&gt; Maybe GlobalRdrElt
forall info.
Outputable info =&gt;
GlobalRdrEnvX info -&gt; Name -&gt; Maybe (GlobalRdrEltX info)
</span><a href="GHC.Types.Name.Reader.html#lookupGRE_Name"><span class="hs-identifier hs-var">lookupGRE_Name</span></a></span><span> </span><span class="annot"><span class="annottext">GlobalRdrEnv
</span><a href="#local-6989586621683035973"><span class="hs-identifier hs-var">rdr_env</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">DataCon -&gt; Name
</span><a href="GHC.Core.DataCon.html#dataConName"><span class="hs-identifier hs-var">dataConName</span></a></span><span> </span><span class="annot"><span class="annottext">DataCon
</span><a href="#local-6989586621683035976"><span class="hs-identifier hs-var">dc</span></a></span><span class="hs-special">)</span><span class="hs-special">]</span><span> </span><span class="hs-special">]</span><span>
</span><span id="line-1836"></span><span>
</span><span id="line-1837"></span><span class="annot"><a href="GHC.Rename.Env.html#addUsedGRE"><span class="hs-identifier hs-type">addUsedGRE</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Rename.Utils.html#DeprecationWarnings"><span class="hs-identifier hs-type">DeprecationWarnings</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Types.Name.Reader.html#GlobalRdrElt"><span class="hs-identifier hs-type">GlobalRdrElt</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#RnM"><span class="hs-identifier hs-type">RnM</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-1838"></span><span class="hs-comment">-- Called for both local and imported things</span><span>
</span><span id="line-1839"></span><span class="hs-comment">-- Add usage *and* warn if deprecated</span><span>
</span><span id="line-1840"></span><span id="addUsedGRE"><span class="annot"><span class="annottext">addUsedGRE :: DeprecationWarnings
-&gt; GlobalRdrElt -&gt; IOEnv (Env TcGblEnv TcLclEnv) ()
</span><a href="GHC.Rename.Env.html#addUsedGRE"><span class="hs-identifier hs-var hs-var">addUsedGRE</span></a></span></span><span> </span><span id="local-6989586621683035977"><span class="annot"><span class="annottext">DeprecationWarnings
</span><a href="#local-6989586621683035977"><span class="hs-identifier hs-var">warn_if_deprec</span></a></span></span><span> </span><span id="local-6989586621683035978"><span class="annot"><span class="annottext">GlobalRdrElt
</span><a href="#local-6989586621683035978"><span class="hs-identifier hs-var">gre</span></a></span></span><span>
</span><span id="line-1841"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">DeprecationWarnings
-&gt; [GlobalRdrElt] -&gt; IOEnv (Env TcGblEnv TcLclEnv) ()
</span><a href="GHC.Rename.Utils.html#warnIfDeprecated"><span class="hs-identifier hs-var">warnIfDeprecated</span></a></span><span> </span><span class="annot"><span class="annottext">DeprecationWarnings
</span><a href="#local-6989586621683035977"><span class="hs-identifier hs-var">warn_if_deprec</span></a></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">GlobalRdrElt
</span><a href="#local-6989586621683035978"><span class="hs-identifier hs-var">gre</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-1842"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="annottext">Bool
-&gt; IOEnv (Env TcGblEnv TcLclEnv) ()
-&gt; IOEnv (Env TcGblEnv TcLclEnv) ()
forall (f :: * -&gt; *). Applicative f =&gt; Bool -&gt; f () -&gt; f ()
</span><span class="hs-identifier hs-var">when</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">GlobalRdrElt -&gt; Bool
forall info. GlobalRdrEltX info -&gt; Bool
</span><a href="GHC.Types.Name.Reader.html#isImportedGRE"><span class="hs-identifier hs-var">isImportedGRE</span></a></span><span> </span><span class="annot"><span class="annottext">GlobalRdrElt
</span><a href="#local-6989586621683035978"><span class="hs-identifier hs-var">gre</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(IOEnv (Env TcGblEnv TcLclEnv) ()
 -&gt; IOEnv (Env TcGblEnv TcLclEnv) ())
-&gt; IOEnv (Env TcGblEnv TcLclEnv) ()
-&gt; IOEnv (Env TcGblEnv TcLclEnv) ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-comment">-- See Note [Using isImportedGRE in addUsedGRE]</span><span>
</span><span id="line-1843"></span><span>         </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span id="local-6989586621683035981"><span class="annot"><a href="#local-6989586621683035981"><span class="hs-identifier hs-var">env</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">IOEnv (Env TcGblEnv TcLclEnv) TcGblEnv
forall gbl lcl. TcRnIf gbl lcl gbl
</span><a href="GHC.Tc.Utils.Monad.html#getGblEnv"><span class="hs-identifier hs-var">getGblEnv</span></a></span><span>
</span><span id="line-1844"></span><span>             </span><span class="hs-comment">-- Do not report the GREInfo (#23424)</span><span>
</span><span id="line-1845"></span><span>            </span><span class="hs-special">;</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.Monad.html#traceRn"><span class="hs-identifier hs-type">traceRn</span></a></span><span> </span><span class="annot"><span class="hs-string">&quot;addUsedGRE&quot;</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-type">ppr</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="annot"><a href="GHC.Types.Name.Reader.html#greName"><span class="hs-identifier hs-type">greName</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683035978"><span class="hs-identifier hs-type">gre</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1846"></span><span>            </span><span class="hs-special">;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.TcRef.html#updTcRef"><span class="hs-identifier hs-type">updTcRef</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Tc.Types.html#tcg_used_gres"><span class="hs-identifier hs-var">tcg_used_gres</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683035981"><span class="hs-identifier hs-type">env</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">gre</span></span><span> </span><span class="annot"><span class="hs-glyph">:</span></span><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-1847"></span><span>
</span><span id="line-1848"></span><span class="annot"><a href="GHC.Rename.Env.html#addUsedGREs"><span class="hs-identifier hs-type">addUsedGREs</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Rename.Utils.html#DeprecationWarnings"><span class="hs-identifier hs-type">DeprecationWarnings</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="GHC.Types.Name.Reader.html#GlobalRdrElt"><span class="hs-identifier hs-type">GlobalRdrElt</span></a></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#RnM"><span class="hs-identifier hs-type">RnM</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-1849"></span><span class="hs-comment">-- Record uses of any *imported* GREs</span><span>
</span><span id="line-1850"></span><span class="hs-comment">-- Used for recording used sub-bndrs</span><span>
</span><span id="line-1851"></span><span class="hs-comment">-- NB: no call to warnIfDeprecated; see Note [Handling of deprecations] in GHC.Rename.Utils</span><span>
</span><span id="line-1852"></span><span id="addUsedGREs"><span class="annot"><span class="annottext">addUsedGREs :: DeprecationWarnings
-&gt; [GlobalRdrElt] -&gt; IOEnv (Env TcGblEnv TcLclEnv) ()
</span><a href="GHC.Rename.Env.html#addUsedGREs"><span class="hs-identifier hs-var hs-var">addUsedGREs</span></a></span></span><span> </span><span id="local-6989586621683035984"><span class="annot"><span class="annottext">DeprecationWarnings
</span><a href="#local-6989586621683035984"><span class="hs-identifier hs-var">warn_if_deprec</span></a></span></span><span> </span><span id="local-6989586621683035985"><span class="annot"><span class="annottext">[GlobalRdrElt]
</span><a href="#local-6989586621683035985"><span class="hs-identifier hs-var">gres</span></a></span></span><span>
</span><span id="line-1853"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">DeprecationWarnings
-&gt; [GlobalRdrElt] -&gt; IOEnv (Env TcGblEnv TcLclEnv) ()
</span><a href="GHC.Rename.Utils.html#warnIfDeprecated"><span class="hs-identifier hs-var">warnIfDeprecated</span></a></span><span> </span><span class="annot"><span class="annottext">DeprecationWarnings
</span><a href="#local-6989586621683035984"><span class="hs-identifier hs-var">warn_if_deprec</span></a></span><span> </span><span class="annot"><span class="annottext">[GlobalRdrElt]
</span><a href="#local-6989586621683035985"><span class="hs-identifier hs-var">gres</span></a></span><span>
</span><span id="line-1854"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="annottext">Bool
-&gt; IOEnv (Env TcGblEnv TcLclEnv) ()
-&gt; IOEnv (Env TcGblEnv TcLclEnv) ()
forall (f :: * -&gt; *). Applicative f =&gt; Bool -&gt; f () -&gt; f ()
</span><span class="hs-identifier hs-var">unless</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[GlobalRdrElt] -&gt; Bool
forall a. [a] -&gt; Bool
forall (t :: * -&gt; *) a. Foldable t =&gt; t a -&gt; Bool
</span><span class="hs-identifier hs-var">null</span></span><span> </span><span class="annot"><span class="annottext">[GlobalRdrElt]
</span><a href="#local-6989586621683035986"><span class="hs-identifier hs-var">imp_gres</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(IOEnv (Env TcGblEnv TcLclEnv) ()
 -&gt; IOEnv (Env TcGblEnv TcLclEnv) ())
-&gt; IOEnv (Env TcGblEnv TcLclEnv) ()
-&gt; IOEnv (Env TcGblEnv TcLclEnv) ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-1855"></span><span>         </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span id="local-6989586621683035987"><span class="annot"><a href="#local-6989586621683035987"><span class="hs-identifier hs-var">env</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">IOEnv (Env TcGblEnv TcLclEnv) TcGblEnv
forall gbl lcl. TcRnIf gbl lcl gbl
</span><a href="GHC.Tc.Utils.Monad.html#getGblEnv"><span class="hs-identifier hs-var">getGblEnv</span></a></span><span>
</span><span id="line-1856"></span><span>              </span><span class="hs-comment">-- Do not report the GREInfo (#23424)</span><span>
</span><span id="line-1857"></span><span>            </span><span class="hs-special">;</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.Monad.html#traceRn"><span class="hs-identifier hs-type">traceRn</span></a></span><span> </span><span class="annot"><span class="hs-string">&quot;addUsedGREs&quot;</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-type">ppr</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">map</span></span><span> </span><span class="annot"><a href="GHC.Types.Name.Reader.html#greName"><span class="hs-identifier hs-type">greName</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683035986"><span class="hs-identifier hs-type">imp_gres</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1858"></span><span>            </span><span class="hs-special">;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.TcRef.html#updTcRef"><span class="hs-identifier hs-type">updTcRef</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Tc.Types.html#tcg_used_gres"><span class="hs-identifier hs-var">tcg_used_gres</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683035987"><span class="hs-identifier hs-type">env</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">imp_gres</span></span><span> </span><span class="annot"><span class="hs-operator">++</span></span><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-1859"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-1860"></span><span>    </span><span id="local-6989586621683035986"><span class="annot"><span class="annottext">imp_gres :: [GlobalRdrElt]
</span><a href="#local-6989586621683035986"><span class="hs-identifier hs-var hs-var">imp_gres</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(GlobalRdrElt -&gt; Bool) -&gt; [GlobalRdrElt] -&gt; [GlobalRdrElt]
forall a. (a -&gt; Bool) -&gt; [a] -&gt; [a]
</span><span class="hs-identifier hs-var">filter</span></span><span> </span><span class="annot"><span class="annottext">GlobalRdrElt -&gt; Bool
forall info. GlobalRdrEltX info -&gt; Bool
</span><a href="GHC.Types.Name.Reader.html#isImportedGRE"><span class="hs-identifier hs-var">isImportedGRE</span></a></span><span> </span><span class="annot"><span class="annottext">[GlobalRdrElt]
</span><a href="#local-6989586621683035985"><span class="hs-identifier hs-var">gres</span></a></span><span>
</span><span id="line-1861"></span><span>    </span><span class="hs-comment">-- See Note [Using isImportedGRE in addUsedGRE]</span><span>
</span><span id="line-1862"></span><span>
</span><span id="line-1863"></span><span class="hs-comment">{-
Note [Used names with interface not loaded]
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
It's (just) possible to find a used
Name whose interface hasn't been loaded:

a) It might be a WiredInName; in that case we may not load
   its interface (although we could).

b) It might be GHC.Real.fromRational, or GHC.Num.fromInteger
   These are seen as &quot;used&quot; by the renamer (if -XRebindableSyntax)
   is on), but the typechecker may discard their uses
   if in fact the in-scope fromRational is GHC.Read.fromRational,
   (see tcPat.tcOverloadedLit), and the typechecker sees that the type
   is fixed, say, to GHC.Base.Float (see Inst.lookupSimpleInst).
   In that obscure case it won't force the interface in.

In both cases we simply don't permit deprecations;
this is, after all, wired-in stuff.


*********************************************************
*                                                      *
                GHCi support
*                                                      *
*********************************************************

A qualified name on the command line can refer to any module at
all: we try to load the interface if we don't already have it, just
as if there was an &quot;import qualified M&quot; declaration for every
module.

For example, writing `Data.List.sort` will load the interface file for
`Data.List` as if the user had written `import qualified Data.List`.

If we fail we just return Nothing, rather than bleating
about &quot;attempting to use module &#8216;D&#8217; (./D.hs) which is not loaded&quot;
which is what loadSrcInterface does.

It is enabled by default and disabled by the flag
`-fno-implicit-import-qualified`.

Note [Safe Haskell and GHCi]
~~~~~~~~~~~~~~~~~~~~~~~~~~~~
We DON'T do this Safe Haskell as we need to check imports. We can
and should instead check the qualified import but at the moment
this requires some refactoring so leave as a TODO

Note [DuplicateRecordFields and -fimplicit-import-qualified]
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
When DuplicateRecordFields is used, a single module can export the same OccName
multiple times, for example:

  module M where
    data S = MkS { foo :: Int }
    data T = MkT { foo :: Int }

Now if we refer to M.foo via -fimplicit-import-qualified, we need to report an
ambiguity error.

-}</span><span>
</span><span id="line-1924"></span><span>
</span><span id="line-1925"></span><span class="hs-comment">-- | Like 'lookupQualifiedNameGHCi' but returning at most one name, reporting an</span><span>
</span><span id="line-1926"></span><span class="hs-comment">-- ambiguity error if there are more than one.</span><span>
</span><span id="line-1927"></span><span class="annot"><a href="GHC.Rename.Env.html#lookupOneQualifiedNameGHCi"><span class="hs-identifier hs-type">lookupOneQualifiedNameGHCi</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Types.Name.Reader.html#FieldsOrSelectors"><span class="hs-identifier hs-type">FieldsOrSelectors</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Types.Name.Reader.html#RdrName"><span class="hs-identifier hs-type">RdrName</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#RnM"><span class="hs-identifier hs-type">RnM</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Maybe</span></span><span> </span><span class="annot"><a href="GHC.Types.Name.Reader.html#GlobalRdrElt"><span class="hs-identifier hs-type">GlobalRdrElt</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1928"></span><span id="lookupOneQualifiedNameGHCi"><span class="annot"><span class="annottext">lookupOneQualifiedNameGHCi :: FieldsOrSelectors -&gt; RdrName -&gt; RnM (Maybe GlobalRdrElt)
</span><a href="GHC.Rename.Env.html#lookupOneQualifiedNameGHCi"><span class="hs-identifier hs-var hs-var">lookupOneQualifiedNameGHCi</span></a></span></span><span> </span><span id="local-6989586621683035988"><span class="annot"><span class="annottext">FieldsOrSelectors
</span><a href="#local-6989586621683035988"><span class="hs-identifier hs-var">fos</span></a></span></span><span> </span><span id="local-6989586621683035989"><span class="annot"><span class="annottext">RdrName
</span><a href="#local-6989586621683035989"><span class="hs-identifier hs-var">rdr_name</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-1929"></span><span>    </span><span id="local-6989586621683035990"><span class="annot"><a href="#local-6989586621683035990"><span class="hs-identifier hs-var">all_gres</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">HasDebugCallStack =&gt;
FieldsOrSelectors
-&gt; RdrName -&gt; IOEnv (Env TcGblEnv TcLclEnv) [GlobalRdrElt]
FieldsOrSelectors
-&gt; RdrName -&gt; IOEnv (Env TcGblEnv TcLclEnv) [GlobalRdrElt]
</span><a href="GHC.Rename.Env.html#lookupQualifiedNameGHCi"><span class="hs-identifier hs-var">lookupQualifiedNameGHCi</span></a></span><span> </span><span class="annot"><span class="annottext">FieldsOrSelectors
</span><a href="#local-6989586621683035988"><span class="hs-identifier hs-var">fos</span></a></span><span> </span><span class="annot"><span class="annottext">RdrName
</span><a href="#local-6989586621683035989"><span class="hs-identifier hs-var">rdr_name</span></a></span><span>
</span><span id="line-1930"></span><span>    </span><span class="hs-keyword">case</span><span> </span><span class="annot"><a href="#local-6989586621683035990"><span class="hs-identifier hs-type">all_gres</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-1931"></span><span>      </span><span class="hs-special">[</span><span class="hs-special">]</span><span>         </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Maybe GlobalRdrElt -&gt; RnM (Maybe GlobalRdrElt)
forall a. a -&gt; IOEnv (Env TcGblEnv TcLclEnv) a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="annot"><span class="annottext">Maybe GlobalRdrElt
forall a. Maybe a
</span><span class="hs-identifier hs-var">Nothing</span></span><span>
</span><span id="line-1932"></span><span>      </span><span class="hs-special">[</span><span id="local-6989586621683035991"><span class="annot"><span class="annottext">GlobalRdrElt
</span><a href="#local-6989586621683035991"><span class="hs-identifier hs-var">gre</span></a></span></span><span class="hs-special">]</span><span>      </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Maybe GlobalRdrElt -&gt; RnM (Maybe GlobalRdrElt)
forall a. a -&gt; IOEnv (Env TcGblEnv TcLclEnv) a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="annot"><span class="annottext">(Maybe GlobalRdrElt -&gt; RnM (Maybe GlobalRdrElt))
-&gt; Maybe GlobalRdrElt -&gt; RnM (Maybe GlobalRdrElt)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">GlobalRdrElt -&gt; Maybe GlobalRdrElt
forall a. a -&gt; Maybe a
</span><span class="hs-identifier hs-var">Just</span></span><span> </span><span class="annot"><span class="annottext">(GlobalRdrElt -&gt; Maybe GlobalRdrElt)
-&gt; GlobalRdrElt -&gt; Maybe GlobalRdrElt
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">GlobalRdrElt
</span><a href="#local-6989586621683035991"><span class="hs-identifier hs-var">gre</span></a></span><span>
</span><span id="line-1933"></span><span>      </span><span class="hs-special">(</span><span id="local-6989586621683035992"><span class="annot"><span class="annottext">GlobalRdrElt
</span><a href="#local-6989586621683035992"><span class="hs-identifier hs-var">gre</span></a></span></span><span class="annot"><span class="hs-glyph hs-type">:</span></span><span id="local-6989586621683035993"><span class="annot"><span class="annottext">[GlobalRdrElt]
</span><a href="#local-6989586621683035993"><span class="hs-identifier hs-var">gres</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-1934"></span><span>        </span><span class="hs-keyword">do</span><span> </span><span class="annot"><span class="annottext">RdrName
-&gt; NonEmpty GlobalRdrElt -&gt; IOEnv (Env TcGblEnv TcLclEnv) ()
</span><a href="GHC.Rename.Utils.html#addNameClashErrRn"><span class="hs-identifier hs-var">addNameClashErrRn</span></a></span><span> </span><span class="annot"><span class="annottext">RdrName
</span><a href="#local-6989586621683035989"><span class="hs-identifier hs-var">rdr_name</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">GlobalRdrElt
</span><a href="#local-6989586621683035992"><span class="hs-identifier hs-var">gre</span></a></span><span> </span><span class="annot"><span class="annottext">GlobalRdrElt -&gt; [GlobalRdrElt] -&gt; NonEmpty GlobalRdrElt
forall a. a -&gt; [a] -&gt; NonEmpty a
</span><span class="hs-operator hs-var">NE.:|</span></span><span> </span><span class="annot"><span class="annottext">[GlobalRdrElt]
</span><a href="#local-6989586621683035993"><span class="hs-identifier hs-var">gres</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1935"></span><span>           </span><span class="annot"><span class="annottext">Maybe GlobalRdrElt -&gt; RnM (Maybe GlobalRdrElt)
forall a. a -&gt; IOEnv (Env TcGblEnv TcLclEnv) a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">GlobalRdrElt -&gt; Maybe GlobalRdrElt
forall a. a -&gt; Maybe a
</span><span class="hs-identifier hs-var">Just</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">OccName -&gt; GlobalRdrElt
</span><a href="GHC.Rename.Unbound.html#mkUnboundGRE"><span class="hs-identifier hs-var">mkUnboundGRE</span></a></span><span> </span><span class="annot"><span class="annottext">(OccName -&gt; GlobalRdrElt) -&gt; OccName -&gt; GlobalRdrElt
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">GlobalRdrElt -&gt; OccName
forall info. GlobalRdrEltX info -&gt; OccName
</span><a href="GHC.Types.Name.Reader.html#greOccName"><span class="hs-identifier hs-var">greOccName</span></a></span><span> </span><span class="annot"><span class="annottext">GlobalRdrElt
</span><a href="#local-6989586621683035992"><span class="hs-identifier hs-var">gre</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-1936"></span><span>             </span><span class="hs-comment">-- (Use mkUnboundGRE to get the correct namespace)</span><span>
</span><span id="line-1937"></span><span>
</span><span id="line-1938"></span><span class="hs-comment">-- | Look up *all* the names to which the 'RdrName' may refer in GHCi (using</span><span>
</span><span id="line-1939"></span><span class="hs-comment">-- @-fimplicit-import-qualified@).  This will normally be zero or one, but may</span><span>
</span><span id="line-1940"></span><span class="hs-comment">-- be more in the presence of @DuplicateRecordFields@.</span><span>
</span><span id="line-1941"></span><span class="annot"><a href="GHC.Rename.Env.html#lookupQualifiedNameGHCi"><span class="hs-identifier hs-type">lookupQualifiedNameGHCi</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Utils.Misc.html#HasDebugCallStack"><span class="hs-identifier hs-type">HasDebugCallStack</span></a></span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="GHC.Types.Name.Reader.html#FieldsOrSelectors"><span class="hs-identifier hs-type">FieldsOrSelectors</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Types.Name.Reader.html#RdrName"><span class="hs-identifier hs-type">RdrName</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#RnM"><span class="hs-identifier hs-type">RnM</span></a></span><span> </span><span class="hs-special">[</span><span class="annot"><a href="GHC.Types.Name.Reader.html#GlobalRdrElt"><span class="hs-identifier hs-type">GlobalRdrElt</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-1942"></span><span id="lookupQualifiedNameGHCi"><span class="annot"><span class="annottext">lookupQualifiedNameGHCi :: HasDebugCallStack =&gt;
FieldsOrSelectors
-&gt; RdrName -&gt; IOEnv (Env TcGblEnv TcLclEnv) [GlobalRdrElt]
</span><a href="GHC.Rename.Env.html#lookupQualifiedNameGHCi"><span class="hs-identifier hs-var hs-var">lookupQualifiedNameGHCi</span></a></span></span><span> </span><span id="local-6989586621683036023"><span class="annot"><span class="annottext">FieldsOrSelectors
</span><a href="#local-6989586621683036023"><span class="hs-identifier hs-var">fos</span></a></span></span><span> </span><span id="local-6989586621683036024"><span class="annot"><span class="annottext">RdrName
</span><a href="#local-6989586621683036024"><span class="hs-identifier hs-var">rdr_name</span></a></span></span><span>
</span><span id="line-1943"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-comment">-- We want to behave as we would for a source file import here,</span><span>
</span><span id="line-1944"></span><span>    </span><span class="hs-comment">-- and respect hiddenness of modules/packages, hence loadSrcInterface.</span><span>
</span><span id="line-1945"></span><span>    </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span id="local-6989586621683036025"><span class="annot"><a href="#local-6989586621683036025"><span class="hs-identifier hs-var">dflags</span></a></span></span><span>  </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">IOEnv (Env TcGblEnv TcLclEnv) DynFlags
forall (m :: * -&gt; *). HasDynFlags m =&gt; m DynFlags
</span><a href="GHC.Driver.DynFlags.html#getDynFlags"><span class="hs-identifier hs-var">getDynFlags</span></a></span><span>
</span><span id="line-1946"></span><span>       </span><span class="hs-special">;</span><span> </span><span id="local-6989586621683036027"><span class="annot"><a href="#local-6989586621683036027"><span class="hs-identifier hs-var">is_ghci</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.Monad.html#getIsGHCi"><span class="hs-identifier hs-type">getIsGHCi</span></a></span><span>
</span><span id="line-1947"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="annot"><a href="#local-6989586621683036029"><span class="hs-identifier hs-type">go_for_it</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683036025"><span class="hs-identifier hs-type">dflags</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683036027"><span class="hs-identifier hs-type">is_ghci</span></a></span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-1948"></span><span>
</span><span id="line-1949"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-1950"></span><span>    </span><span id="local-6989586621683036029"><span class="annot"><span class="annottext">go_for_it :: DynFlags -&gt; Bool -&gt; IOEnv (Env TcGblEnv TcLclEnv) [GlobalRdrElt]
</span><a href="#local-6989586621683036029"><span class="hs-identifier hs-var hs-var">go_for_it</span></a></span></span><span> </span><span id="local-6989586621683036030"><span class="annot"><span class="annottext">DynFlags
</span><a href="#local-6989586621683036030"><span class="hs-identifier hs-var">dflags</span></a></span></span><span> </span><span id="local-6989586621683036031"><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621683036031"><span class="hs-identifier hs-var">is_ghci</span></a></span></span><span>
</span><span id="line-1951"></span><span>      </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span class="hs-special">(</span><span id="local-6989586621683036032"><span class="annot"><span class="annottext">ModuleName
</span><a href="#local-6989586621683036032"><span class="hs-identifier hs-var">mod_name</span></a></span></span><span class="hs-special">,</span><span id="local-6989586621683036033"><span class="annot"><span class="annottext">OccName
</span><a href="#local-6989586621683036033"><span class="hs-identifier hs-var">occ</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">RdrName -&gt; Maybe (ModuleName, OccName)
</span><a href="GHC.Types.Name.Reader.html#isQual_maybe"><span class="hs-identifier hs-var">isQual_maybe</span></a></span><span> </span><span class="annot"><span class="annottext">RdrName
</span><a href="#local-6989586621683036024"><span class="hs-identifier hs-var">rdr_name</span></a></span><span>
</span><span id="line-1952"></span><span>      </span><span class="hs-special">,</span><span> </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621683036035"><span class="annot"><span class="annottext">ns :: NameSpace
</span><a href="#local-6989586621683036035"><span class="hs-identifier hs-var hs-var">ns</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">OccName -&gt; NameSpace
</span><a href="GHC.Types.Name.Occurrence.html#occNameSpace"><span class="hs-identifier hs-var">occNameSpace</span></a></span><span> </span><span class="annot"><span class="annottext">OccName
</span><a href="#local-6989586621683036033"><span class="hs-identifier hs-var">occ</span></a></span><span>
</span><span id="line-1953"></span><span>      </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621683036031"><span class="hs-identifier hs-var">is_ghci</span></a></span><span>
</span><span id="line-1954"></span><span>      </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">GeneralFlag -&gt; DynFlags -&gt; Bool
</span><a href="GHC.Driver.DynFlags.html#gopt"><span class="hs-identifier hs-var">gopt</span></a></span><span> </span><span class="annot"><span class="annottext">GeneralFlag
</span><a href="GHC.Driver.Flags.html#Opt_ImplicitImportQualified"><span class="hs-identifier hs-var">Opt_ImplicitImportQualified</span></a></span><span> </span><span class="annot"><span class="annottext">DynFlags
</span><a href="#local-6989586621683036030"><span class="hs-identifier hs-var">dflags</span></a></span><span>   </span><span class="hs-comment">-- Enables this GHCi behaviour</span><span>
</span><span id="line-1955"></span><span>      </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Bool
</span><span class="hs-identifier hs-var">not</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">DynFlags -&gt; Bool
</span><a href="GHC.Driver.Session.html#safeDirectImpsReq"><span class="hs-identifier hs-var">safeDirectImpsReq</span></a></span><span> </span><span class="annot"><span class="annottext">DynFlags
</span><a href="#local-6989586621683036030"><span class="hs-identifier hs-var">dflags</span></a></span><span class="hs-special">)</span><span>            </span><span class="hs-comment">-- See Note [Safe Haskell and GHCi]</span><span>
</span><span id="line-1956"></span><span>      </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span id="local-6989586621683036040"><span class="annot"><a href="#local-6989586621683036040"><span class="hs-identifier hs-var">res</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">SDoc
-&gt; ModuleName
-&gt; IsBootInterface
-&gt; PkgQual
-&gt; RnM (MaybeErr MissingInterfaceError ModIface)
</span><a href="GHC.Iface.Load.html#loadSrcInterface_maybe"><span class="hs-identifier hs-var">loadSrcInterface_maybe</span></a></span><span> </span><span class="annot"><span class="annottext">SDoc
</span><a href="#local-6989586621683036042"><span class="hs-identifier hs-var">doc</span></a></span><span> </span><span class="annot"><span class="annottext">ModuleName
</span><a href="#local-6989586621683036032"><span class="hs-identifier hs-var">mod_name</span></a></span><span> </span><span class="annot"><span class="annottext">IsBootInterface
</span><a href="Language.Haskell.Syntax.ImpExp.html#NotBoot"><span class="hs-identifier hs-var">NotBoot</span></a></span><span> </span><span class="annot"><span class="annottext">PkgQual
</span><a href="GHC.Types.PkgQual.html#NoPkgQual"><span class="hs-identifier hs-var">NoPkgQual</span></a></span><span>
</span><span id="line-1957"></span><span>           </span><span class="hs-special">;</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><a href="#local-6989586621683036040"><span class="hs-identifier hs-type">res</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-1958"></span><span>                </span><span class="annot"><a href="GHC.Data.Maybe.html#Succeeded"><span class="hs-identifier hs-type">Succeeded</span></a></span><span> </span><span id="local-6989586621683036046"><span class="annot"><span class="annottext">ModIface
</span><a href="#local-6989586621683036046"><span class="hs-identifier hs-var">iface</span></a></span></span><span>
</span><span id="line-1959"></span><span>                  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span id="local-6989586621683036047"><span class="annot"><a href="#local-6989586621683036047"><span class="hs-identifier hs-var">hsc_env</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">TcRnIf TcGblEnv TcLclEnv HscEnv
forall gbl lcl. TcRnIf gbl lcl HscEnv
</span><a href="GHC.Tc.Utils.Monad.html#getTopEnv"><span class="hs-identifier hs-var">getTopEnv</span></a></span><span>
</span><span id="line-1960"></span><span>                        </span><span class="hs-special">;</span><span> </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621683036048"><span class="annot"><a href="#local-6989586621683036048"><span class="hs-identifier hs-var hs-var">gres</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-1961"></span><span>                                </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">GlobalRdrElt
</span><a href="#local-6989586621683036049"><span class="hs-identifier hs-var">gre</span></a></span><span>
</span><span id="line-1962"></span><span>                                </span><span class="hs-glyph">|</span><span> </span><span id="local-6989586621683036050"><span class="annot"><span class="annottext">IfaceExport
</span><a href="#local-6989586621683036050"><span class="hs-identifier hs-var">avail</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">ModIface -&gt; [IfaceExport]
forall (phase :: ModIfacePhase). ModIface_ phase -&gt; [IfaceExport]
</span><a href="GHC.Unit.Module.ModIface.html#mi_exports"><span class="hs-identifier hs-var">mi_exports</span></a></span><span> </span><span class="annot"><span class="annottext">ModIface
</span><a href="#local-6989586621683036046"><span class="hs-identifier hs-var">iface</span></a></span><span>
</span><span id="line-1963"></span><span>                                </span><span class="hs-special">,</span><span> </span><span id="local-6989586621683036052"><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621683036052"><span class="hs-identifier hs-var">gname</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">IfaceExport -&gt; [Name]
</span><a href="GHC.Types.Avail.html#availNames"><span class="hs-identifier hs-var">availNames</span></a></span><span> </span><span class="annot"><span class="annottext">IfaceExport
</span><a href="#local-6989586621683036050"><span class="hs-identifier hs-var">avail</span></a></span><span>
</span><span id="line-1964"></span><span>                                </span><span class="hs-special">,</span><span> </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621683036054"><span class="annot"><span class="annottext">lk_occ :: OccName
</span><a href="#local-6989586621683036054"><span class="hs-identifier hs-var hs-var">lk_occ</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Name -&gt; OccName
forall name. HasOccName name =&gt; name -&gt; OccName
</span><a href="GHC.Types.Name.Occurrence.html#occName"><span class="hs-identifier hs-var">occName</span></a></span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621683036052"><span class="hs-identifier hs-var">gname</span></a></span><span>
</span><span id="line-1965"></span><span>                                      </span><span id="local-6989586621683036055"><span class="annot"><span class="annottext">lk_ns :: NameSpace
</span><a href="#local-6989586621683036055"><span class="hs-identifier hs-var hs-var">lk_ns</span></a></span></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">OccName -&gt; NameSpace
</span><a href="GHC.Types.Name.Occurrence.html#occNameSpace"><span class="hs-identifier hs-var">occNameSpace</span></a></span><span> </span><span class="annot"><span class="annottext">OccName
</span><a href="#local-6989586621683036054"><span class="hs-identifier hs-var">lk_occ</span></a></span><span>
</span><span id="line-1966"></span><span>                                </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">OccName -&gt; FastString
</span><a href="GHC.Types.Name.Occurrence.html#occNameFS"><span class="hs-identifier hs-var">occNameFS</span></a></span><span> </span><span class="annot"><span class="annottext">OccName
</span><a href="#local-6989586621683036033"><span class="hs-identifier hs-var">occ</span></a></span><span> </span><span class="annot"><span class="annottext">FastString -&gt; FastString -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">==</span></span><span> </span><span class="annot"><span class="annottext">OccName -&gt; FastString
</span><a href="GHC.Types.Name.Occurrence.html#occNameFS"><span class="hs-identifier hs-var">occNameFS</span></a></span><span> </span><span class="annot"><span class="annottext">OccName
</span><a href="#local-6989586621683036054"><span class="hs-identifier hs-var">lk_occ</span></a></span><span>
</span><span id="line-1967"></span><span>                                </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">NameSpace
</span><a href="#local-6989586621683036035"><span class="hs-identifier hs-var">ns</span></a></span><span> </span><span class="annot"><span class="annottext">NameSpace -&gt; NameSpace -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">==</span></span><span> </span><span class="annot"><span class="annottext">NameSpace
</span><a href="#local-6989586621683036055"><span class="hs-identifier hs-var">lk_ns</span></a></span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Bool -&gt; Bool
</span><span class="hs-operator hs-var">||</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">NameSpace
</span><a href="#local-6989586621683036035"><span class="hs-identifier hs-var">ns</span></a></span><span> </span><span class="annot"><span class="annottext">NameSpace -&gt; NameSpace -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">==</span></span><span> </span><span class="annot"><span class="annottext">NameSpace
</span><a href="GHC.Types.Name.Occurrence.html#varName"><span class="hs-identifier hs-var">varName</span></a></span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Bool -&gt; Bool
</span><span class="hs-operator hs-var">&amp;&amp;</span></span><span> </span><span class="annot"><span class="annottext">NameSpace -&gt; Bool
</span><a href="GHC.Types.Name.Occurrence.html#isFieldNameSpace"><span class="hs-identifier hs-var">isFieldNameSpace</span></a></span><span> </span><span class="annot"><span class="annottext">NameSpace
</span><a href="#local-6989586621683036055"><span class="hs-identifier hs-var">lk_ns</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1968"></span><span>                                </span><span class="hs-special">,</span><span> </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621683036058"><span class="annot"><span class="annottext">mod :: Module
</span><a href="#local-6989586621683036058"><span class="hs-identifier hs-var hs-var">mod</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ModIface -&gt; Module
forall (phase :: ModIfacePhase). ModIface_ phase -&gt; Module
</span><a href="GHC.Unit.Module.ModIface.html#mi_module"><span class="hs-identifier hs-var">mi_module</span></a></span><span> </span><span class="annot"><span class="annottext">ModIface
</span><a href="#local-6989586621683036046"><span class="hs-identifier hs-var">iface</span></a></span><span>
</span><span id="line-1969"></span><span>                                      </span><span id="local-6989586621683036049"><span class="annot"><span class="annottext">gre :: GlobalRdrElt
</span><a href="#local-6989586621683036049"><span class="hs-identifier hs-var hs-var">gre</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Module -&gt; HscEnv -&gt; Name -&gt; GlobalRdrElt
</span><a href="#local-6989586621683036060"><span class="hs-identifier hs-var">lookupGRE_PTE</span></a></span><span> </span><span class="annot"><span class="annottext">Module
</span><a href="#local-6989586621683036058"><span class="hs-identifier hs-var">mod</span></a></span><span> </span><span class="annot"><span class="annottext">HscEnv
</span><a href="#local-6989586621683036047"><span class="hs-identifier hs-var">hsc_env</span></a></span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621683036052"><span class="hs-identifier hs-var">gname</span></a></span><span>
</span><span id="line-1970"></span><span>                                </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">FieldsOrSelectors -&gt; GlobalRdrElt -&gt; Bool
</span><a href="GHC.Types.Name.Reader.html#allowGRE"><span class="hs-identifier hs-var">allowGRE</span></a></span><span> </span><span class="annot"><span class="annottext">FieldsOrSelectors
</span><a href="#local-6989586621683036023"><span class="hs-identifier hs-var">fos</span></a></span><span> </span><span class="annot"><span class="annottext">GlobalRdrElt
</span><a href="#local-6989586621683036049"><span class="hs-identifier hs-var">gre</span></a></span><span>
</span><span id="line-1971"></span><span>                                  </span><span class="hs-comment">-- Include a field if it has a selector or we are looking for all fields;</span><span>
</span><span id="line-1972"></span><span>                                  </span><span class="hs-comment">-- see Note [NoFieldSelectors].</span><span>
</span><span id="line-1973"></span><span>                                </span><span class="hs-special">]</span><span>
</span><span id="line-1974"></span><span>                        </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">return</span></span><span> </span><span class="annot"><a href="#local-6989586621683036048"><span class="hs-identifier hs-type">gres</span></a></span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-1975"></span><span>
</span><span id="line-1976"></span><span>                </span><span class="annot"><span class="annottext">MaybeErr MissingInterfaceError ModIface
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-comment">-- Either we couldn't load the interface, or</span><span>
</span><span id="line-1977"></span><span>                     </span><span class="hs-comment">-- we could but we didn't find the name in it</span><span>
</span><span id="line-1978"></span><span>                     </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">String -&gt; SDoc -&gt; IOEnv (Env TcGblEnv TcLclEnv) ()
</span><a href="GHC.Tc.Utils.Monad.html#traceRn"><span class="hs-identifier hs-var">traceRn</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;lookupQualifiedNameGHCi&quot;</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">RdrName -&gt; SDoc
forall a. Outputable a =&gt; a -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="annot"><span class="annottext">RdrName
</span><a href="#local-6989586621683036024"><span class="hs-identifier hs-var">rdr_name</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1979"></span><span>                        </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="annottext">[GlobalRdrElt] -&gt; IOEnv (Env TcGblEnv TcLclEnv) [GlobalRdrElt]
forall a. a -&gt; IOEnv (Env TcGblEnv TcLclEnv) a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><span class="hs-special">}</span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-1980"></span><span>
</span><span id="line-1981"></span><span>      </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">otherwise</span></span><span>
</span><span id="line-1982"></span><span>      </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">String -&gt; SDoc -&gt; IOEnv (Env TcGblEnv TcLclEnv) ()
</span><a href="GHC.Tc.Utils.Monad.html#traceRn"><span class="hs-identifier hs-var">traceRn</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;lookupQualifiedNameGHCi: off&quot;</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">RdrName -&gt; SDoc
forall a. Outputable a =&gt; a -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="annot"><span class="annottext">RdrName
</span><a href="#local-6989586621683036024"><span class="hs-identifier hs-var">rdr_name</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1983"></span><span>           </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="annottext">[GlobalRdrElt] -&gt; IOEnv (Env TcGblEnv TcLclEnv) [GlobalRdrElt]
forall a. a -&gt; IOEnv (Env TcGblEnv TcLclEnv) a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-1984"></span><span>
</span><span id="line-1985"></span><span>    </span><span id="local-6989586621683036042"><span class="annot"><span class="annottext">doc :: SDoc
</span><a href="#local-6989586621683036042"><span class="hs-identifier hs-var hs-var">doc</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">String -&gt; SDoc
forall doc. IsLine doc =&gt; String -&gt; doc
</span><a href="GHC.Utils.Outputable.html#text"><span class="hs-identifier hs-var">text</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;Need to find&quot;</span></span><span> </span><span class="annot"><span class="annottext">SDoc -&gt; SDoc -&gt; SDoc
forall doc. IsLine doc =&gt; doc -&gt; doc -&gt; doc
</span><a href="GHC.Utils.Outputable.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">RdrName -&gt; SDoc
forall a. Outputable a =&gt; a -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="annot"><span class="annottext">RdrName
</span><a href="#local-6989586621683036024"><span class="hs-identifier hs-var">rdr_name</span></a></span><span>
</span><span id="line-1986"></span><span>
</span><span id="line-1987"></span><span>    </span><span class="hs-comment">-- Lookup a Name for an implicit qualified import in GHCi</span><span>
</span><span id="line-1988"></span><span>    </span><span class="hs-comment">-- in the given PackageTypeEnv.</span><span>
</span><span id="line-1989"></span><span>    </span><span class="annot"><a href="#local-6989586621683036060"><span class="hs-identifier hs-type">lookupGRE_PTE</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Unit.Types.html#Module"><span class="hs-identifier hs-type">Module</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Driver.Env.Types.html#HscEnv"><span class="hs-identifier hs-type">HscEnv</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Types.Name.html#Name"><span class="hs-identifier hs-type">Name</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Types.Name.Reader.html#GlobalRdrElt"><span class="hs-identifier hs-type">GlobalRdrElt</span></a></span><span>
</span><span id="line-1990"></span><span>    </span><span id="local-6989586621683036060"><span class="annot"><span class="annottext">lookupGRE_PTE :: Module -&gt; HscEnv -&gt; Name -&gt; GlobalRdrElt
</span><a href="#local-6989586621683036060"><span class="hs-identifier hs-var hs-var">lookupGRE_PTE</span></a></span></span><span> </span><span id="local-6989586621683036062"><span class="annot"><span class="annottext">Module
</span><a href="#local-6989586621683036062"><span class="hs-identifier hs-var">mod</span></a></span></span><span> </span><span id="local-6989586621683036063"><span class="annot"><span class="annottext">HscEnv
</span><a href="#local-6989586621683036063"><span class="hs-identifier hs-var">hsc_env</span></a></span></span><span> </span><span id="local-6989586621683036064"><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621683036064"><span class="hs-identifier hs-var">nm</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-1991"></span><span>      </span><span class="hs-comment">-- Fake a GRE so we can report a sensible name clash error if</span><span>
</span><span id="line-1992"></span><span>      </span><span class="hs-comment">-- -fimplicit-import-qualified is used with a module that exports the same</span><span>
</span><span id="line-1993"></span><span>      </span><span class="hs-comment">-- field name multiple times (see</span><span>
</span><span id="line-1994"></span><span>      </span><span class="hs-comment">-- Note [DuplicateRecordFields and -fimplicit-import-qualified]).</span><span>
</span><span id="line-1995"></span><span>      </span><span class="annot"><a href="GHC.Types.Name.Reader.html#GRE"><span class="hs-identifier hs-type">GRE</span></a></span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">gre_name :: Name
</span><a href="GHC.Types.Name.Reader.html#gre_name"><span class="hs-identifier hs-var">gre_name</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621683036064"><span class="hs-identifier hs-var">nm</span></a></span><span>
</span><span id="line-1996"></span><span>          </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">gre_par :: Parent
</span><a href="GHC.Types.Name.Reader.html#gre_par"><span class="hs-identifier hs-var">gre_par</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Parent
</span><a href="GHC.Types.Name.Reader.html#NoParent"><span class="hs-identifier hs-var">NoParent</span></a></span><span>
</span><span id="line-1997"></span><span>          </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">gre_lcl :: Bool
</span><a href="GHC.Types.Name.Reader.html#gre_lcl"><span class="hs-identifier hs-var">gre_lcl</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">False</span></span><span>
</span><span id="line-1998"></span><span>          </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">gre_imp :: Bag ImportSpec
</span><a href="GHC.Types.Name.Reader.html#gre_imp"><span class="hs-identifier hs-var">gre_imp</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ImportSpec -&gt; Bag ImportSpec
forall a. a -&gt; Bag a
</span><a href="GHC.Data.Bag.html#unitBag"><span class="hs-identifier hs-var">unitBag</span></a></span><span> </span><span class="annot"><span class="annottext">ImportSpec
</span><a href="#local-6989586621683036070"><span class="hs-identifier hs-var">is</span></a></span><span>
</span><span id="line-1999"></span><span>          </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">gre_info :: GREInfo
</span><a href="GHC.Types.Name.Reader.html#gre_info"><span class="hs-identifier hs-var">gre_info</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">GREInfo
</span><a href="#local-6989586621683036071"><span class="hs-identifier hs-var">info</span></a></span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-2000"></span><span>        </span><span class="hs-keyword">where</span><span>
</span><span id="line-2001"></span><span>          </span><span id="local-6989586621683036071"><span class="annot"><span class="annottext">info :: GREInfo
</span><a href="#local-6989586621683036071"><span class="hs-identifier hs-var hs-var">info</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">HasDebugCallStack =&gt; HscEnv -&gt; Name -&gt; GREInfo
HscEnv -&gt; Name -&gt; GREInfo
</span><a href="GHC.Rename.Env.html#lookupGREInfo"><span class="hs-identifier hs-var">lookupGREInfo</span></a></span><span> </span><span class="annot"><span class="annottext">HscEnv
</span><a href="#local-6989586621683036063"><span class="hs-identifier hs-var">hsc_env</span></a></span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621683036064"><span class="hs-identifier hs-var">nm</span></a></span><span>
</span><span id="line-2002"></span><span>          </span><span id="local-6989586621683036072"><span class="annot"><span class="annottext">spec :: ImpDeclSpec
</span><a href="#local-6989586621683036072"><span class="hs-identifier hs-var hs-var">spec</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="GHC.Types.Name.Reader.html#ImpDeclSpec"><span class="hs-identifier hs-type">ImpDeclSpec</span></a></span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">is_mod :: Module
</span><a href="GHC.Types.Name.Reader.html#is_mod"><span class="hs-identifier hs-var">is_mod</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Module
</span><a href="#local-6989586621683036062"><span class="hs-identifier hs-var">mod</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">is_as :: ModuleName
</span><a href="GHC.Types.Name.Reader.html#is_as"><span class="hs-identifier hs-var">is_as</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Module -&gt; ModuleName
forall unit. GenModule unit -&gt; ModuleName
</span><a href="GHC.Unit.Types.html#moduleName"><span class="hs-identifier hs-var">moduleName</span></a></span><span> </span><span class="annot"><span class="annottext">Module
</span><a href="#local-6989586621683036062"><span class="hs-identifier hs-var">mod</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">is_pkg_qual :: PkgQual
</span><a href="GHC.Types.Name.Reader.html#is_pkg_qual"><span class="hs-identifier hs-var">is_pkg_qual</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">PkgQual
</span><a href="GHC.Types.PkgQual.html#NoPkgQual"><span class="hs-identifier hs-var">NoPkgQual</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">is_qual :: Bool
</span><a href="GHC.Types.Name.Reader.html#is_qual"><span class="hs-identifier hs-var">is_qual</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">True</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">is_isboot :: IsBootInterface
</span><a href="GHC.Types.Name.Reader.html#is_isboot"><span class="hs-identifier hs-var">is_isboot</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">IsBootInterface
</span><a href="Language.Haskell.Syntax.ImpExp.html#NotBoot"><span class="hs-identifier hs-var">NotBoot</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">is_dloc :: SrcSpan
</span><a href="GHC.Types.Name.Reader.html#is_dloc"><span class="hs-identifier hs-var">is_dloc</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">SrcSpan
</span><a href="GHC.Types.SrcLoc.html#noSrcSpan"><span class="hs-identifier hs-var">noSrcSpan</span></a></span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-2003"></span><span>          </span><span id="local-6989586621683036070"><span class="annot"><span class="annottext">is :: ImportSpec
</span><a href="#local-6989586621683036070"><span class="hs-identifier hs-var hs-var">is</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="GHC.Types.Name.Reader.html#ImpSpec"><span class="hs-identifier hs-type">ImpSpec</span></a></span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">is_decl :: ImpDeclSpec
</span><a href="GHC.Types.Name.Reader.html#is_decl"><span class="hs-identifier hs-var">is_decl</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ImpDeclSpec
</span><a href="#local-6989586621683036072"><span class="hs-identifier hs-var">spec</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">is_item :: ImpItemSpec
</span><a href="GHC.Types.Name.Reader.html#is_item"><span class="hs-identifier hs-var">is_item</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ImpItemSpec
</span><a href="GHC.Types.Name.Reader.html#ImpAll"><span class="hs-identifier hs-var">ImpAll</span></a></span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-2004"></span><span>
</span><span id="line-2005"></span><span class="hs-comment">-- | Look up the 'GREInfo' associated with the given 'Name'</span><span>
</span><span id="line-2006"></span><span class="hs-comment">-- by looking up in the type environment.</span><span>
</span><span id="line-2007"></span><span class="annot"><a href="GHC.Rename.Env.html#lookupGREInfo"><span class="hs-identifier hs-type">lookupGREInfo</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Utils.Misc.html#HasDebugCallStack"><span class="hs-identifier hs-type">HasDebugCallStack</span></a></span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="GHC.Driver.Env.Types.html#HscEnv"><span class="hs-identifier hs-type">HscEnv</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Types.Name.html#Name"><span class="hs-identifier hs-type">Name</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Types.GREInfo.html#GREInfo"><span class="hs-identifier hs-type">GREInfo</span></a></span><span>
</span><span id="line-2008"></span><span id="lookupGREInfo"><span class="annot"><span class="annottext">lookupGREInfo :: HasDebugCallStack =&gt; HscEnv -&gt; Name -&gt; GREInfo
</span><a href="GHC.Rename.Env.html#lookupGREInfo"><span class="hs-identifier hs-var hs-var">lookupGREInfo</span></a></span></span><span> </span><span id="local-6989586621683036101"><span class="annot"><span class="annottext">HscEnv
</span><a href="#local-6989586621683036101"><span class="hs-identifier hs-var">hsc_env</span></a></span></span><span> </span><span id="local-6989586621683036102"><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621683036102"><span class="hs-identifier hs-var">nm</span></a></span></span><span>
</span><span id="line-2009"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span id="local-6989586621683036103"><span class="annot"><span class="annottext">TyThing
</span><a href="#local-6989586621683036103"><span class="hs-identifier hs-var">ty_thing</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Name -&gt; Maybe TyThing
</span><a href="GHC.Types.Name.html#wiredInNameTyThing_maybe"><span class="hs-identifier hs-var">wiredInNameTyThing_maybe</span></a></span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621683036102"><span class="hs-identifier hs-var">nm</span></a></span><span>
</span><span id="line-2010"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">TyThing -&gt; GREInfo
</span><a href="GHC.Types.TyThing.html#tyThingGREInfo"><span class="hs-identifier hs-var">tyThingGREInfo</span></a></span><span> </span><span class="annot"><span class="annottext">TyThing
</span><a href="#local-6989586621683036103"><span class="hs-identifier hs-var">ty_thing</span></a></span><span>
</span><span id="line-2011"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">otherwise</span></span><span>
</span><span id="line-2012"></span><span>  </span><span class="hs-comment">-- Create a thunk which, when forced, loads the interface</span><span>
</span><span id="line-2013"></span><span>  </span><span class="hs-comment">-- and looks up the TyThing in the type environment.</span><span>
</span><span id="line-2014"></span><span>  </span><span class="hs-comment">--</span><span>
</span><span id="line-2015"></span><span>  </span><span class="hs-comment">-- See Note [Retrieving the GREInfo from interfaces] in GHC.Types.GREInfo.</span><span>
</span><span id="line-2016"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">Name -&gt; Maybe Module
</span><a href="GHC.Types.Name.html#nameModule_maybe"><span class="hs-identifier hs-var">nameModule_maybe</span></a></span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621683036102"><span class="hs-identifier hs-var">nm</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-2017"></span><span>      </span><span class="annot"><span class="annottext">Maybe Module
</span><span class="hs-identifier hs-var">Nothing</span></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">GREInfo
</span><a href="GHC.Types.GREInfo.html#UnboundGRE"><span class="hs-identifier hs-var">UnboundGRE</span></a></span><span>
</span><span id="line-2018"></span><span>      </span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span id="local-6989586621683036105"><span class="annot"><span class="annottext">Module
</span><a href="#local-6989586621683036105"><span class="hs-identifier hs-var">mod</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-2019"></span><span>        </span><span class="annot"><span class="annottext">IO GREInfo -&gt; GREInfo
forall a. IO a -&gt; a
</span><span class="hs-identifier hs-var">unsafePerformIO</span></span><span> </span><span class="annot"><span class="annottext">(IO GREInfo -&gt; GREInfo) -&gt; IO GREInfo -&gt; GREInfo
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-2020"></span><span>          </span><span class="annot"><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">HscEnv
-&gt; IfG (MaybeErr MissingInterfaceError ModIface)
-&gt; IO (MaybeErr MissingInterfaceError ModIface)
forall a. HscEnv -&gt; IfG a -&gt; IO a
</span><a href="GHC.Tc.Utils.Monad.html#initIfaceLoad"><span class="hs-identifier hs-var">initIfaceLoad</span></a></span><span> </span><span class="annot"><span class="annottext">HscEnv
</span><a href="#local-6989586621683036101"><span class="hs-identifier hs-var">hsc_env</span></a></span><span> </span><span class="annot"><span class="annottext">(IfG (MaybeErr MissingInterfaceError ModIface)
 -&gt; IO (MaybeErr MissingInterfaceError ModIface))
-&gt; IfG (MaybeErr MissingInterfaceError ModIface)
-&gt; IO (MaybeErr MissingInterfaceError ModIface)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-2021"></span><span>               </span><span class="annot"><span class="annottext">SDoc
-&gt; Module
-&gt; WhereFrom
-&gt; IfG (MaybeErr MissingInterfaceError ModIface)
forall lcl.
SDoc
-&gt; Module
-&gt; WhereFrom
-&gt; IfM lcl (MaybeErr MissingInterfaceError ModIface)
</span><a href="GHC.Iface.Load.html#loadInterface"><span class="hs-identifier hs-var">loadInterface</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">String -&gt; SDoc
forall doc. IsLine doc =&gt; String -&gt; doc
</span><a href="GHC.Utils.Outputable.html#text"><span class="hs-identifier hs-var">text</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;lookupGREInfo&quot;</span></span><span> </span><span class="annot"><span class="annottext">SDoc -&gt; SDoc -&gt; SDoc
forall doc. IsLine doc =&gt; doc -&gt; doc -&gt; doc
</span><a href="GHC.Utils.Outputable.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">SDoc -&gt; SDoc
forall doc. IsLine doc =&gt; doc -&gt; doc
</span><a href="GHC.Utils.Outputable.html#parens"><span class="hs-identifier hs-var">parens</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Name -&gt; SDoc
forall a. Outputable a =&gt; a -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621683036102"><span class="hs-identifier hs-var">nm</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-2022"></span><span>                 </span><span class="annot"><span class="annottext">Module
</span><a href="#local-6989586621683036105"><span class="hs-identifier hs-var">mod</span></a></span><span> </span><span class="annot"><span class="annottext">WhereFrom
</span><a href="GHC.Iface.Load.html#ImportBySystem"><span class="hs-identifier hs-var">ImportBySystem</span></a></span><span>
</span><span id="line-2023"></span><span>          </span><span id="local-6989586621683036110"><span class="annot"><a href="#local-6989586621683036110"><span class="hs-identifier hs-var">mb_ty_thing</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><a href="GHC.Driver.Env.html#lookupType"><span class="hs-identifier hs-type">lookupType</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683036101"><span class="hs-identifier hs-type">hsc_env</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683036102"><span class="hs-identifier hs-type">nm</span></a></span><span>
</span><span id="line-2024"></span><span>          </span><span class="hs-keyword">case</span><span> </span><span class="annot"><a href="#local-6989586621683036110"><span class="hs-identifier hs-type">mb_ty_thing</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-2025"></span><span>            </span><span class="annot"><span class="annottext">Maybe TyThing
</span><span class="hs-identifier hs-var">Nothing</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-2026"></span><span>              </span><span class="annot"><span class="annottext">String -&gt; SDoc -&gt; IO GREInfo
forall a. HasCallStack =&gt; String -&gt; SDoc -&gt; a
</span><a href="GHC.Utils.Panic.html#pprPanic"><span class="hs-identifier hs-var">pprPanic</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;lookupGREInfo&quot;</span></span><span> </span><span class="annot"><span class="annottext">(SDoc -&gt; IO GREInfo) -&gt; SDoc -&gt; IO GREInfo
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-2027"></span><span>                      </span><span class="annot"><span class="annottext">[SDoc] -&gt; SDoc
forall doc. IsDoc doc =&gt; [doc] -&gt; doc
</span><a href="GHC.Utils.Outputable.html#vcat"><span class="hs-identifier hs-var">vcat</span></a></span><span> </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">String -&gt; SDoc
forall doc. IsLine doc =&gt; String -&gt; doc
</span><a href="GHC.Utils.Outputable.html#text"><span class="hs-identifier hs-var">text</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;lookup failed:&quot;</span></span><span> </span><span class="annot"><span class="annottext">SDoc -&gt; SDoc -&gt; SDoc
forall doc. IsLine doc =&gt; doc -&gt; doc -&gt; doc
</span><a href="GHC.Utils.Outputable.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">Name -&gt; SDoc
forall a. Outputable a =&gt; a -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621683036102"><span class="hs-identifier hs-var">nm</span></a></span><span> </span><span class="hs-special">]</span><span>
</span><span id="line-2028"></span><span>            </span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span id="local-6989586621683036112"><span class="annot"><span class="annottext">TyThing
</span><a href="#local-6989586621683036112"><span class="hs-identifier hs-var">ty_thing</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">GREInfo -&gt; IO GREInfo
forall a. a -&gt; IO a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="annot"><span class="annottext">(GREInfo -&gt; IO GREInfo) -&gt; GREInfo -&gt; IO GREInfo
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">TyThing -&gt; GREInfo
</span><a href="GHC.Types.TyThing.html#tyThingGREInfo"><span class="hs-identifier hs-var">tyThingGREInfo</span></a></span><span> </span><span class="annot"><span class="annottext">TyThing
</span><a href="#local-6989586621683036112"><span class="hs-identifier hs-var">ty_thing</span></a></span><span>
</span><span id="line-2029"></span><span>
</span><span id="line-2030"></span><span class="hs-comment">{-
Note [Looking up signature names]
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
lookupSigOccRn is used for type signatures and pragmas
Is this valid?
  module A
        import M( f )
        f :: Int -&gt; Int
        f x = x
It's clear that the 'f' in the signature must refer to A.f
The Haskell98 report does not stipulate this, but it will!
So we must treat the 'f' in the signature in the same way
as the binding occurrence of 'f', using lookupBndrRn

However, consider this case:
        import M( f )
        f :: Int -&gt; Int
        g x = x
We don't want to say 'f' is out of scope; instead, we want to
return the imported 'f', so that later on the renamer will
correctly report &quot;misplaced type sig&quot;.

Note [Signatures for top level things]
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
data HsSigCtxt = ... | TopSigCtxt NameSet | ....

* The NameSet says what is bound in this group of bindings.
  We can't use isLocalGRE from the GlobalRdrEnv, because of this:
       f x = x
       $( ...some TH splice... )
       f :: Int -&gt; Int
  When we encounter the signature for 'f', the binding for 'f'
  will be in the GlobalRdrEnv, and will be a LocalDef. Yet the
  signature is mis-placed

* For type signatures the NameSet should be the names bound by the
  value bindings; for fixity declarations, the NameSet should also
  include class sigs and record selectors

      infix 3 `f`          -- Yes, ok
      f :: C a =&gt; a -&gt; a   -- No, not ok
      class C a where
        f :: a -&gt; a
-}</span><span>
</span><span id="line-2074"></span><span>
</span><span id="line-2075"></span><span class="hs-keyword">data</span><span> </span><span id="HsSigCtxt"><span class="annot"><a href="GHC.Rename.Env.html#HsSigCtxt"><span class="hs-identifier hs-var">HsSigCtxt</span></a></span></span><span>
</span><span id="line-2076"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span id="TopSigCtxt"><span class="annot"><a href="GHC.Rename.Env.html#TopSigCtxt"><span class="hs-identifier hs-var">TopSigCtxt</span></a></span></span><span> </span><span class="annot"><a href="GHC.Types.Name.Set.html#NameSet"><span class="hs-identifier hs-type">NameSet</span></a></span><span>       </span><span class="hs-comment">-- At top level, binding these names</span><span>
</span><span id="line-2077"></span><span>                             </span><span class="hs-comment">-- See Note [Signatures for top level things]</span><span>
</span><span id="line-2078"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span id="LocalBindCtxt"><span class="annot"><a href="GHC.Rename.Env.html#LocalBindCtxt"><span class="hs-identifier hs-var">LocalBindCtxt</span></a></span></span><span> </span><span class="annot"><a href="GHC.Types.Name.Set.html#NameSet"><span class="hs-identifier hs-type">NameSet</span></a></span><span>    </span><span class="hs-comment">-- In a local binding, binding these names</span><span>
</span><span id="line-2079"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span id="ClsDeclCtxt"><span class="annot"><a href="GHC.Rename.Env.html#ClsDeclCtxt"><span class="hs-identifier hs-var">ClsDeclCtxt</span></a></span></span><span>   </span><span class="annot"><a href="GHC.Types.Name.html#Name"><span class="hs-identifier hs-type">Name</span></a></span><span>       </span><span class="hs-comment">-- Class decl for this class</span><span>
</span><span id="line-2080"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span id="InstDeclCtxt"><span class="annot"><a href="GHC.Rename.Env.html#InstDeclCtxt"><span class="hs-identifier hs-var">InstDeclCtxt</span></a></span></span><span>  </span><span class="annot"><a href="GHC.Types.Name.Set.html#NameSet"><span class="hs-identifier hs-type">NameSet</span></a></span><span>    </span><span class="hs-comment">-- Instance decl whose user-written method</span><span>
</span><span id="line-2081"></span><span>                             </span><span class="hs-comment">-- bindings are for these methods</span><span>
</span><span id="line-2082"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span id="HsBootCtxt"><span class="annot"><a href="GHC.Rename.Env.html#HsBootCtxt"><span class="hs-identifier hs-var">HsBootCtxt</span></a></span></span><span> </span><span class="annot"><a href="GHC.Types.Name.Set.html#NameSet"><span class="hs-identifier hs-type">NameSet</span></a></span><span>       </span><span class="hs-comment">-- Top level of a hs-boot file, binding these names</span><span>
</span><span id="line-2083"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span id="RoleAnnotCtxt"><span class="annot"><a href="GHC.Rename.Env.html#RoleAnnotCtxt"><span class="hs-identifier hs-var">RoleAnnotCtxt</span></a></span></span><span> </span><span class="annot"><a href="GHC.Types.Name.Set.html#NameSet"><span class="hs-identifier hs-type">NameSet</span></a></span><span>    </span><span class="hs-comment">-- A role annotation, with the names of all types</span><span>
</span><span id="line-2084"></span><span>                             </span><span class="hs-comment">-- in the group</span><span>
</span><span id="line-2085"></span><span>
</span><span id="line-2086"></span><span class="hs-keyword">instance</span><span> </span><span class="annot"><a href="GHC.Utils.Outputable.html#Outputable"><span class="hs-identifier hs-type">Outputable</span></a></span><span> </span><span class="annot"><a href="GHC.Rename.Env.html#HsSigCtxt"><span class="hs-identifier hs-type">HsSigCtxt</span></a></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-2087"></span><span>    </span><span id="local-6989586621683036140"><span class="annot"><span class="annottext">ppr :: HsSigCtxt -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var hs-var hs-var">ppr</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Rename.Env.html#TopSigCtxt"><span class="hs-identifier hs-type">TopSigCtxt</span></a></span><span> </span><span id="local-6989586621683036141"><span class="annot"><span class="annottext">NameSet
</span><a href="#local-6989586621683036141"><span class="hs-identifier hs-var">ns</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">String -&gt; SDoc
forall doc. IsLine doc =&gt; String -&gt; doc
</span><a href="GHC.Utils.Outputable.html#text"><span class="hs-identifier hs-var">text</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;TopSigCtxt&quot;</span></span><span> </span><span class="annot"><span class="annottext">SDoc -&gt; SDoc -&gt; SDoc
forall doc. IsLine doc =&gt; doc -&gt; doc -&gt; doc
</span><a href="GHC.Utils.Outputable.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">NameSet -&gt; SDoc
forall a. Outputable a =&gt; a -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="annot"><span class="annottext">NameSet
</span><a href="#local-6989586621683036141"><span class="hs-identifier hs-var">ns</span></a></span><span>
</span><span id="line-2088"></span><span>    </span><span class="annot"><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Rename.Env.html#LocalBindCtxt"><span class="hs-identifier hs-type">LocalBindCtxt</span></a></span><span> </span><span id="local-6989586621683036142"><span class="annot"><span class="annottext">NameSet
</span><a href="#local-6989586621683036142"><span class="hs-identifier hs-var">ns</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">String -&gt; SDoc
forall doc. IsLine doc =&gt; String -&gt; doc
</span><a href="GHC.Utils.Outputable.html#text"><span class="hs-identifier hs-var">text</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;LocalBindCtxt&quot;</span></span><span> </span><span class="annot"><span class="annottext">SDoc -&gt; SDoc -&gt; SDoc
forall doc. IsLine doc =&gt; doc -&gt; doc -&gt; doc
</span><a href="GHC.Utils.Outputable.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">NameSet -&gt; SDoc
forall a. Outputable a =&gt; a -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="annot"><span class="annottext">NameSet
</span><a href="#local-6989586621683036142"><span class="hs-identifier hs-var">ns</span></a></span><span>
</span><span id="line-2089"></span><span>    </span><span class="annot"><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Rename.Env.html#ClsDeclCtxt"><span class="hs-identifier hs-type">ClsDeclCtxt</span></a></span><span> </span><span id="local-6989586621683036143"><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621683036143"><span class="hs-identifier hs-var">n</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">String -&gt; SDoc
forall doc. IsLine doc =&gt; String -&gt; doc
</span><a href="GHC.Utils.Outputable.html#text"><span class="hs-identifier hs-var">text</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;ClsDeclCtxt&quot;</span></span><span> </span><span class="annot"><span class="annottext">SDoc -&gt; SDoc -&gt; SDoc
forall doc. IsLine doc =&gt; doc -&gt; doc -&gt; doc
</span><a href="GHC.Utils.Outputable.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">Name -&gt; SDoc
forall a. Outputable a =&gt; a -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621683036143"><span class="hs-identifier hs-var">n</span></a></span><span>
</span><span id="line-2090"></span><span>    </span><span class="annot"><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Rename.Env.html#InstDeclCtxt"><span class="hs-identifier hs-type">InstDeclCtxt</span></a></span><span> </span><span id="local-6989586621683036144"><span class="annot"><span class="annottext">NameSet
</span><a href="#local-6989586621683036144"><span class="hs-identifier hs-var">ns</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">String -&gt; SDoc
forall doc. IsLine doc =&gt; String -&gt; doc
</span><a href="GHC.Utils.Outputable.html#text"><span class="hs-identifier hs-var">text</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;InstDeclCtxt&quot;</span></span><span> </span><span class="annot"><span class="annottext">SDoc -&gt; SDoc -&gt; SDoc
forall doc. IsLine doc =&gt; doc -&gt; doc -&gt; doc
</span><a href="GHC.Utils.Outputable.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">NameSet -&gt; SDoc
forall a. Outputable a =&gt; a -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="annot"><span class="annottext">NameSet
</span><a href="#local-6989586621683036144"><span class="hs-identifier hs-var">ns</span></a></span><span>
</span><span id="line-2091"></span><span>    </span><span class="annot"><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Rename.Env.html#HsBootCtxt"><span class="hs-identifier hs-type">HsBootCtxt</span></a></span><span> </span><span id="local-6989586621683036145"><span class="annot"><span class="annottext">NameSet
</span><a href="#local-6989586621683036145"><span class="hs-identifier hs-var">ns</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">String -&gt; SDoc
forall doc. IsLine doc =&gt; String -&gt; doc
</span><a href="GHC.Utils.Outputable.html#text"><span class="hs-identifier hs-var">text</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;HsBootCtxt&quot;</span></span><span> </span><span class="annot"><span class="annottext">SDoc -&gt; SDoc -&gt; SDoc
forall doc. IsLine doc =&gt; doc -&gt; doc -&gt; doc
</span><a href="GHC.Utils.Outputable.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">NameSet -&gt; SDoc
forall a. Outputable a =&gt; a -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="annot"><span class="annottext">NameSet
</span><a href="#local-6989586621683036145"><span class="hs-identifier hs-var">ns</span></a></span><span>
</span><span id="line-2092"></span><span>    </span><span class="annot"><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Rename.Env.html#RoleAnnotCtxt"><span class="hs-identifier hs-type">RoleAnnotCtxt</span></a></span><span> </span><span id="local-6989586621683036146"><span class="annot"><span class="annottext">NameSet
</span><a href="#local-6989586621683036146"><span class="hs-identifier hs-var">ns</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">String -&gt; SDoc
forall doc. IsLine doc =&gt; String -&gt; doc
</span><a href="GHC.Utils.Outputable.html#text"><span class="hs-identifier hs-var">text</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;RoleAnnotCtxt&quot;</span></span><span> </span><span class="annot"><span class="annottext">SDoc -&gt; SDoc -&gt; SDoc
forall doc. IsLine doc =&gt; doc -&gt; doc -&gt; doc
</span><a href="GHC.Utils.Outputable.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">NameSet -&gt; SDoc
forall a. Outputable a =&gt; a -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="annot"><span class="annottext">NameSet
</span><a href="#local-6989586621683036146"><span class="hs-identifier hs-var">ns</span></a></span><span>
</span><span id="line-2093"></span><span>
</span><span id="line-2094"></span><span class="annot"><a href="GHC.Rename.Env.html#lookupSigOccRn"><span class="hs-identifier hs-type">lookupSigOccRn</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Rename.Env.html#HsSigCtxt"><span class="hs-identifier hs-type">HsSigCtxt</span></a></span><span>
</span><span id="line-2095"></span><span>               </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Language.Haskell.Syntax.Binds.html#Sig"><span class="hs-identifier hs-type">Sig</span></a></span><span> </span><span class="annot"><a href="GHC.Hs.Extension.html#GhcPs"><span class="hs-identifier hs-type">GhcPs</span></a></span><span>
</span><span id="line-2096"></span><span>               </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Parser.Annotation.html#LocatedA"><span class="hs-identifier hs-type">LocatedA</span></a></span><span> </span><span class="annot"><a href="GHC.Types.Name.Reader.html#RdrName"><span class="hs-identifier hs-type">RdrName</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#RnM"><span class="hs-identifier hs-type">RnM</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Parser.Annotation.html#LocatedA"><span class="hs-identifier hs-type">LocatedA</span></a></span><span> </span><span class="annot"><a href="GHC.Types.Name.html#Name"><span class="hs-identifier hs-type">Name</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-2097"></span><span id="lookupSigOccRn"><span class="annot"><span class="annottext">lookupSigOccRn :: HsSigCtxt -&gt; Sig GhcPs -&gt; LocatedA RdrName -&gt; RnM (LocatedA Name)
</span><a href="GHC.Rename.Env.html#lookupSigOccRn"><span class="hs-identifier hs-var hs-var">lookupSigOccRn</span></a></span></span><span> </span><span id="local-6989586621683036147"><span class="annot"><span class="annottext">HsSigCtxt
</span><a href="#local-6989586621683036147"><span class="hs-identifier hs-var">ctxt</span></a></span></span><span> </span><span id="local-6989586621683036148"><span class="annot"><span class="annottext">Sig GhcPs
</span><a href="#local-6989586621683036148"><span class="hs-identifier hs-var">sig</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">HsSigCtxt -&gt; SDoc -&gt; LocatedA RdrName -&gt; RnM (LocatedA Name)
forall ann.
HsSigCtxt
-&gt; SDoc
-&gt; GenLocated (EpAnn ann) RdrName
-&gt; RnM (GenLocated (EpAnn ann) Name)
</span><a href="GHC.Rename.Env.html#lookupSigCtxtOccRn"><span class="hs-identifier hs-var">lookupSigCtxtOccRn</span></a></span><span> </span><span class="annot"><span class="annottext">HsSigCtxt
</span><a href="#local-6989586621683036147"><span class="hs-identifier hs-var">ctxt</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Sig GhcPs -&gt; SDoc
forall (p :: Pass). IsPass p =&gt; Sig (GhcPass p) -&gt; SDoc
</span><a href="GHC.Hs.Binds.html#hsSigDoc"><span class="hs-identifier hs-var">hsSigDoc</span></a></span><span> </span><span class="annot"><span class="annottext">Sig GhcPs
</span><a href="#local-6989586621683036148"><span class="hs-identifier hs-var">sig</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-2098"></span><span>
</span><span id="line-2099"></span><span class="annot"><a href="GHC.Rename.Env.html#lookupSigOccRnN"><span class="hs-identifier hs-type">lookupSigOccRnN</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Rename.Env.html#HsSigCtxt"><span class="hs-identifier hs-type">HsSigCtxt</span></a></span><span>
</span><span id="line-2100"></span><span>               </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Language.Haskell.Syntax.Binds.html#Sig"><span class="hs-identifier hs-type">Sig</span></a></span><span> </span><span class="annot"><a href="GHC.Hs.Extension.html#GhcPs"><span class="hs-identifier hs-type">GhcPs</span></a></span><span>
</span><span id="line-2101"></span><span>               </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Parser.Annotation.html#LocatedN"><span class="hs-identifier hs-type">LocatedN</span></a></span><span> </span><span class="annot"><a href="GHC.Types.Name.Reader.html#RdrName"><span class="hs-identifier hs-type">RdrName</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#RnM"><span class="hs-identifier hs-type">RnM</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Parser.Annotation.html#LocatedN"><span class="hs-identifier hs-type">LocatedN</span></a></span><span> </span><span class="annot"><a href="GHC.Types.Name.html#Name"><span class="hs-identifier hs-type">Name</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-2102"></span><span id="lookupSigOccRnN"><span class="annot"><span class="annottext">lookupSigOccRnN :: HsSigCtxt -&gt; Sig GhcPs -&gt; LocatedN RdrName -&gt; RnM (LocatedN Name)
</span><a href="GHC.Rename.Env.html#lookupSigOccRnN"><span class="hs-identifier hs-var hs-var">lookupSigOccRnN</span></a></span></span><span> </span><span id="local-6989586621683036150"><span class="annot"><span class="annottext">HsSigCtxt
</span><a href="#local-6989586621683036150"><span class="hs-identifier hs-var">ctxt</span></a></span></span><span> </span><span id="local-6989586621683036151"><span class="annot"><span class="annottext">Sig GhcPs
</span><a href="#local-6989586621683036151"><span class="hs-identifier hs-var">sig</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">HsSigCtxt -&gt; SDoc -&gt; LocatedN RdrName -&gt; RnM (LocatedN Name)
forall ann.
HsSigCtxt
-&gt; SDoc
-&gt; GenLocated (EpAnn ann) RdrName
-&gt; RnM (GenLocated (EpAnn ann) Name)
</span><a href="GHC.Rename.Env.html#lookupSigCtxtOccRn"><span class="hs-identifier hs-var">lookupSigCtxtOccRn</span></a></span><span> </span><span class="annot"><span class="annottext">HsSigCtxt
</span><a href="#local-6989586621683036150"><span class="hs-identifier hs-var">ctxt</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Sig GhcPs -&gt; SDoc
forall (p :: Pass). IsPass p =&gt; Sig (GhcPass p) -&gt; SDoc
</span><a href="GHC.Hs.Binds.html#hsSigDoc"><span class="hs-identifier hs-var">hsSigDoc</span></a></span><span> </span><span class="annot"><span class="annottext">Sig GhcPs
</span><a href="#local-6989586621683036151"><span class="hs-identifier hs-var">sig</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-2103"></span><span>
</span><span id="line-2104"></span><span class="annot"><span class="hs-comment">-- | Lookup a name in relation to the names in a 'HsSigCtxt'</span></span><span>
</span><span id="line-2105"></span><span id="local-6989586621683034762"><span class="annot"><a href="GHC.Rename.Env.html#lookupSigCtxtOccRn"><span class="hs-identifier hs-type">lookupSigCtxtOccRn</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Rename.Env.html#HsSigCtxt"><span class="hs-identifier hs-type">HsSigCtxt</span></a></span><span>
</span><span id="line-2106"></span><span>                   </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Utils.Outputable.html#SDoc"><span class="hs-identifier hs-type">SDoc</span></a></span><span>         </span><span class="hs-comment">-- ^ description of thing we're looking up,</span><span>
</span><span id="line-2107"></span><span>                                   </span><span class="hs-comment">-- like &quot;type family&quot;</span><span>
</span><span id="line-2108"></span><span>                   </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Types.SrcLoc.html#GenLocated"><span class="hs-identifier hs-type">GenLocated</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Parser.Annotation.html#EpAnn"><span class="hs-identifier hs-type">EpAnn</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683034762"><span class="hs-identifier hs-type">ann</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><a href="GHC.Types.Name.Reader.html#RdrName"><span class="hs-identifier hs-type">RdrName</span></a></span><span>
</span><span id="line-2109"></span><span>                   </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#RnM"><span class="hs-identifier hs-type">RnM</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Types.SrcLoc.html#GenLocated"><span class="hs-identifier hs-type">GenLocated</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Parser.Annotation.html#EpAnn"><span class="hs-identifier hs-type">EpAnn</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683034762"><span class="hs-identifier hs-type">ann</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><a href="GHC.Types.Name.html#Name"><span class="hs-identifier hs-type">Name</span></a></span><span class="hs-special">)</span></span><span>
</span><span id="line-2110"></span><span id="lookupSigCtxtOccRn"><span class="annot"><span class="annottext">lookupSigCtxtOccRn :: forall ann.
HsSigCtxt
-&gt; SDoc
-&gt; GenLocated (EpAnn ann) RdrName
-&gt; RnM (GenLocated (EpAnn ann) Name)
</span><a href="GHC.Rename.Env.html#lookupSigCtxtOccRn"><span class="hs-identifier hs-var hs-var">lookupSigCtxtOccRn</span></a></span></span><span> </span><span id="local-6989586621683036166"><span class="annot"><span class="annottext">HsSigCtxt
</span><a href="#local-6989586621683036166"><span class="hs-identifier hs-var">ctxt</span></a></span></span><span> </span><span id="local-6989586621683036167"><span class="annot"><span class="annottext">SDoc
</span><a href="#local-6989586621683036167"><span class="hs-identifier hs-var">what</span></a></span></span><span>
</span><span id="line-2111"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(RdrName -&gt; RnM Name)
-&gt; GenLocated (EpAnn ann) RdrName
-&gt; TcRn (GenLocated (EpAnn ann) Name)
forall a b ann.
(a -&gt; TcM b)
-&gt; GenLocated (EpAnn ann) a -&gt; TcRn (GenLocated (EpAnn ann) b)
</span><a href="GHC.Tc.Utils.Monad.html#wrapLocMA"><span class="hs-identifier hs-var">wrapLocMA</span></a></span><span> </span><span class="annot"><span class="annottext">((RdrName -&gt; RnM Name)
 -&gt; GenLocated (EpAnn ann) RdrName
 -&gt; TcRn (GenLocated (EpAnn ann) Name))
-&gt; (RdrName -&gt; RnM Name)
-&gt; GenLocated (EpAnn ann) RdrName
-&gt; TcRn (GenLocated (EpAnn ann) Name)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-glyph">\</span><span> </span><span id="local-6989586621683036168"><span class="annot"><span class="annottext">RdrName
</span><a href="#local-6989586621683036168"><span class="hs-identifier hs-var">rdr_name</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-2112"></span><span>    </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621683036169"><span class="annot"><span class="annottext">also_try_tycons :: Bool
</span><a href="#local-6989586621683036169"><span class="hs-identifier hs-var hs-var hs-var">also_try_tycons</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">False</span></span><span>
</span><span id="line-2113"></span><span>       </span><span class="hs-special">;</span><span> </span><span id="local-6989586621683036170"><span class="annot"><a href="#local-6989586621683036170"><span class="hs-identifier hs-var">mb_names</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">HsSigCtxt
-&gt; SDoc
-&gt; RdrName
-&gt; Bool
-&gt; NamespaceSpecifier
-&gt; RnM (NonEmpty (Either NotInScopeError Name))
</span><a href="GHC.Rename.Env.html#lookupBindGroupOcc"><span class="hs-identifier hs-var">lookupBindGroupOcc</span></a></span><span> </span><span class="annot"><span class="annottext">HsSigCtxt
</span><a href="#local-6989586621683036166"><span class="hs-identifier hs-var">ctxt</span></a></span><span> </span><span class="annot"><span class="annottext">SDoc
</span><a href="#local-6989586621683036167"><span class="hs-identifier hs-var">what</span></a></span><span> </span><span class="annot"><span class="annottext">RdrName
</span><a href="#local-6989586621683036168"><span class="hs-identifier hs-var">rdr_name</span></a></span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621683036169"><span class="hs-identifier hs-var">also_try_tycons</span></a></span><span> </span><span class="annot"><span class="annottext">NamespaceSpecifier
</span><a href="GHC.Hs.Binds.html#NoNamespaceSpecifier"><span class="hs-identifier hs-var">NoNamespaceSpecifier</span></a></span><span>
</span><span id="line-2114"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><a href="#local-6989586621683036170"><span class="hs-identifier hs-type">mb_names</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-2115"></span><span>           </span><span class="annot"><span class="hs-identifier hs-type">Right</span></span><span> </span><span id="local-6989586621683036173"><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621683036173"><span class="hs-identifier hs-var">name</span></a></span></span><span> </span><span class="annot"><span class="hs-operator hs-type">NE.:|</span></span><span> </span><span id="local-6989586621683036174"><span class="annot"><span class="annottext">[Either NotInScopeError Name]
</span><a href="#local-6989586621683036174"><span class="hs-identifier hs-var">rest</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-2116"></span><span>             </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">Bool -&gt; SDoc -&gt; IOEnv (Env TcGblEnv TcLclEnv) ()
forall (m :: * -&gt; *).
(HasCallStack, Applicative m) =&gt;
Bool -&gt; SDoc -&gt; m ()
</span><a href="GHC.Utils.Panic.html#massertPpr"><span class="hs-identifier hs-var">massertPpr</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[Either NotInScopeError Name] -&gt; Bool
forall a. [a] -&gt; Bool
forall (t :: * -&gt; *) a. Foldable t =&gt; t a -&gt; Bool
</span><span class="hs-identifier hs-var">null</span></span><span> </span><span class="annot"><span class="annottext">[Either NotInScopeError Name]
</span><a href="#local-6989586621683036174"><span class="hs-identifier hs-var">rest</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(SDoc -&gt; IOEnv (Env TcGblEnv TcLclEnv) ())
-&gt; SDoc -&gt; IOEnv (Env TcGblEnv TcLclEnv) ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-2117"></span><span>                    </span><span class="annot"><span class="annottext">[SDoc] -&gt; SDoc
forall doc. IsDoc doc =&gt; [doc] -&gt; doc
</span><a href="GHC.Utils.Outputable.html#vcat"><span class="hs-identifier hs-var">vcat</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">String -&gt; SDoc
forall doc. IsLine doc =&gt; String -&gt; doc
</span><a href="GHC.Utils.Outputable.html#text"><span class="hs-identifier hs-var">text</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;lookupSigCtxtOccRn&quot;</span></span><span> </span><span class="annot"><span class="annottext">SDoc -&gt; SDoc -&gt; SDoc
forall doc. IsLine doc =&gt; doc -&gt; doc -&gt; doc
</span><a href="GHC.Utils.Outputable.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">Name -&gt; SDoc
forall a. Outputable a =&gt; a -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621683036173"><span class="hs-identifier hs-var">name</span></a></span><span> </span><span class="annot"><span class="annottext">SDoc -&gt; [SDoc] -&gt; [SDoc]
forall a. a -&gt; [a] -&gt; [a]
</span><span class="hs-glyph hs-var">:</span></span><span> </span><span class="annot"><span class="annottext">(Either NotInScopeError Name -&gt; SDoc)
-&gt; [Either NotInScopeError Name] -&gt; [SDoc]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><span class="hs-identifier hs-var">map</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(NotInScopeError -&gt; SDoc)
-&gt; (Name -&gt; SDoc) -&gt; Either NotInScopeError Name -&gt; SDoc
forall a c b. (a -&gt; c) -&gt; (b -&gt; c) -&gt; Either a b -&gt; c
</span><span class="hs-identifier hs-var">either</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">RdrName -&gt; NotInScopeError -&gt; SDoc
</span><a href="GHC.Tc.Errors.Ppr.html#pprScopeError"><span class="hs-identifier hs-var">pprScopeError</span></a></span><span> </span><span class="annot"><span class="annottext">RdrName
</span><a href="#local-6989586621683036168"><span class="hs-identifier hs-var">rdr_name</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Name -&gt; SDoc
forall a. Outputable a =&gt; a -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[Either NotInScopeError Name]
</span><a href="#local-6989586621683036174"><span class="hs-identifier hs-var">rest</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-2118"></span><span>                </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="annottext">Name -&gt; RnM Name
forall a. a -&gt; IOEnv (Env TcGblEnv TcLclEnv) a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621683036173"><span class="hs-identifier hs-var">name</span></a></span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-2119"></span><span>           </span><span class="annot"><span class="hs-identifier hs-type">Left</span></span><span> </span><span id="local-6989586621683036177"><span class="annot"><span class="annottext">NotInScopeError
</span><a href="#local-6989586621683036177"><span class="hs-identifier hs-var">err</span></a></span></span><span> </span><span class="annot"><span class="hs-operator hs-type">NE.:|</span></span><span> </span><span class="annot"><span class="annottext">[Either NotInScopeError Name]
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-2120"></span><span>             </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">TcRnMessage -&gt; IOEnv (Env TcGblEnv TcLclEnv) ()
</span><a href="GHC.Tc.Utils.Monad.html#addErr"><span class="hs-identifier hs-var">addErr</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">RdrName -&gt; NotInScopeError -&gt; TcRnMessage
</span><a href="GHC.Tc.Errors.Types.html#mkTcRnNotInScope"><span class="hs-identifier hs-var">mkTcRnNotInScope</span></a></span><span> </span><span class="annot"><span class="annottext">RdrName
</span><a href="#local-6989586621683036168"><span class="hs-identifier hs-var">rdr_name</span></a></span><span> </span><span class="annot"><span class="annottext">NotInScopeError
</span><a href="#local-6989586621683036177"><span class="hs-identifier hs-var">err</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-2121"></span><span>                </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="annottext">Name -&gt; RnM Name
forall a. a -&gt; IOEnv (Env TcGblEnv TcLclEnv) a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">RdrName -&gt; Name
</span><a href="GHC.Rename.Unbound.html#mkUnboundNameRdr"><span class="hs-identifier hs-var">mkUnboundNameRdr</span></a></span><span> </span><span class="annot"><span class="annottext">RdrName
</span><a href="#local-6989586621683036168"><span class="hs-identifier hs-var">rdr_name</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-2122"></span><span>       </span><span class="hs-special">}</span><span>
</span><span id="line-2123"></span><span>
</span><span id="line-2124"></span><span class="annot"><a href="GHC.Rename.Env.html#lookupBindGroupOcc"><span class="hs-identifier hs-type">lookupBindGroupOcc</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Rename.Env.html#HsSigCtxt"><span class="hs-identifier hs-type">HsSigCtxt</span></a></span><span>
</span><span id="line-2125"></span><span>                   </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Utils.Outputable.html#SDoc"><span class="hs-identifier hs-type">SDoc</span></a></span><span>
</span><span id="line-2126"></span><span>                   </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Types.Name.Reader.html#RdrName"><span class="hs-identifier hs-type">RdrName</span></a></span><span> </span><span class="annot"><span class="hs-comment">-- ^ what to look up</span></span><span>
</span><span id="line-2127"></span><span>                   </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Bool</span></span><span> </span><span class="hs-comment">-- ^ if the 'RdrName' we are looking up is in</span><span>
</span><span id="line-2128"></span><span>                           </span><span class="hs-comment">-- a value 'NameSpace', should we also look up</span><span>
</span><span id="line-2129"></span><span>                           </span><span class="hs-comment">-- in the type constructor 'NameSpace'?</span><span>
</span><span id="line-2130"></span><span>                   </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Hs.Binds.html#NamespaceSpecifier"><span class="hs-identifier hs-type">NamespaceSpecifier</span></a></span><span>
</span><span id="line-2131"></span><span>                   </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#RnM"><span class="hs-identifier hs-type">RnM</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">NE.NonEmpty</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Either</span></span><span> </span><span class="annot"><a href="GHC.Tc.Errors.Types.html#NotInScopeError"><span class="hs-identifier hs-type">NotInScopeError</span></a></span><span> </span><span class="annot"><a href="GHC.Types.Name.html#Name"><span class="hs-identifier hs-type">Name</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-2132"></span><span class="hs-comment">-- ^ Looks up the 'RdrName', expecting it to resolve to one of the</span><span>
</span><span id="line-2133"></span><span class="hs-comment">-- bound names currently in scope. If not, return an appropriate error message.</span><span>
</span><span id="line-2134"></span><span class="hs-comment">--</span><span>
</span><span id="line-2135"></span><span class="hs-comment">-- See Note [Looking up signature names].</span><span>
</span><span id="line-2136"></span><span id="lookupBindGroupOcc"><span class="annot"><span class="annottext">lookupBindGroupOcc :: HsSigCtxt
-&gt; SDoc
-&gt; RdrName
-&gt; Bool
-&gt; NamespaceSpecifier
-&gt; RnM (NonEmpty (Either NotInScopeError Name))
</span><a href="GHC.Rename.Env.html#lookupBindGroupOcc"><span class="hs-identifier hs-var hs-var">lookupBindGroupOcc</span></a></span></span><span> </span><span id="local-6989586621683036178"><span class="annot"><span class="annottext">HsSigCtxt
</span><a href="#local-6989586621683036178"><span class="hs-identifier hs-var">ctxt</span></a></span></span><span> </span><span id="local-6989586621683036179"><span class="annot"><span class="annottext">SDoc
</span><a href="#local-6989586621683036179"><span class="hs-identifier hs-var">what</span></a></span></span><span> </span><span id="local-6989586621683036180"><span class="annot"><span class="annottext">RdrName
</span><a href="#local-6989586621683036180"><span class="hs-identifier hs-var">rdr_name</span></a></span></span><span> </span><span id="local-6989586621683036181"><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621683036181"><span class="hs-identifier hs-var">also_try_tycon_ns</span></a></span></span><span> </span><span id="local-6989586621683036182"><span class="annot"><span class="annottext">NamespaceSpecifier
</span><a href="#local-6989586621683036182"><span class="hs-identifier hs-var">ns_spec</span></a></span></span><span>
</span><span id="line-2137"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span id="local-6989586621683036183"><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621683036183"><span class="hs-identifier hs-var">n</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">RdrName -&gt; Maybe Name
</span><a href="GHC.Types.Name.Reader.html#isExact_maybe"><span class="hs-identifier hs-var">isExact_maybe</span></a></span><span> </span><span class="annot"><span class="annottext">RdrName
</span><a href="#local-6989586621683036180"><span class="hs-identifier hs-var">rdr_name</span></a></span><span>
</span><span id="line-2138"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span id="local-6989586621683036184"><span class="annot"><a href="#local-6989586621683036184"><span class="hs-identifier hs-var">mb_gre</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Name -&gt; RnM (Either NotInScopeError GlobalRdrElt)
</span><a href="GHC.Rename.Env.html#lookupExactOcc_either"><span class="hs-identifier hs-var">lookupExactOcc_either</span></a></span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621683036183"><span class="hs-identifier hs-var">n</span></a></span><span>
</span><span id="line-2139"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">return</span></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><a href="#local-6989586621683036184"><span class="hs-identifier hs-type">mb_gre</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-2140"></span><span>          </span><span class="annot"><span class="hs-identifier hs-type">Left</span></span><span> </span><span id="local-6989586621683036185"><span class="annot"><span class="annottext">NotInScopeError
</span><a href="#local-6989586621683036185"><span class="hs-identifier hs-var">err</span></a></span></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Either NotInScopeError Name
-&gt; NonEmpty (Either NotInScopeError Name)
forall a. a -&gt; NonEmpty a
</span><a href="../../base-4.21.0.0-ae91/src/Data.List.NonEmpty.html#singleton"><span class="hs-identifier hs-var">NE.singleton</span></a></span><span> </span><span class="annot"><span class="annottext">(Either NotInScopeError Name
 -&gt; NonEmpty (Either NotInScopeError Name))
-&gt; Either NotInScopeError Name
-&gt; NonEmpty (Either NotInScopeError Name)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">NotInScopeError -&gt; Either NotInScopeError Name
forall a b. a -&gt; Either a b
</span><span class="hs-identifier hs-var">Left</span></span><span> </span><span class="annot"><span class="annottext">NotInScopeError
</span><a href="#local-6989586621683036185"><span class="hs-identifier hs-var">err</span></a></span><span>
</span><span id="line-2141"></span><span>          </span><span class="annot"><span class="hs-identifier hs-type">Right</span></span><span> </span><span id="local-6989586621683036187"><span class="annot"><span class="annottext">GlobalRdrElt
</span><a href="#local-6989586621683036187"><span class="hs-identifier hs-var">gre</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">NotInScopeError
-&gt; GlobalRdrElt -&gt; NonEmpty (Either NotInScopeError Name)
</span><a href="#local-6989586621683036188"><span class="hs-identifier hs-var">finish</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Name -&gt; NotInScopeError
</span><a href="GHC.Tc.Errors.Types.html#NoExactName"><span class="hs-identifier hs-var">NoExactName</span></a></span><span> </span><span class="annot"><span class="annottext">(Name -&gt; NotInScopeError) -&gt; Name -&gt; NotInScopeError
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">GlobalRdrElt -&gt; Name
forall info. GlobalRdrEltX info -&gt; Name
</span><a href="GHC.Types.Name.Reader.html#greName"><span class="hs-identifier hs-var">greName</span></a></span><span> </span><span class="annot"><span class="annottext">GlobalRdrElt
</span><a href="#local-6989586621683036187"><span class="hs-identifier hs-var">gre</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">GlobalRdrElt
</span><a href="#local-6989586621683036187"><span class="hs-identifier hs-var">gre</span></a></span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-2142"></span><span>      </span><span class="hs-comment">-- Maybe we should check the side conditions</span><span>
</span><span id="line-2143"></span><span>      </span><span class="hs-comment">-- but it's a pain, and Exact things only show</span><span>
</span><span id="line-2144"></span><span>      </span><span class="hs-comment">-- up when you know what you are doing</span><span>
</span><span id="line-2145"></span><span>
</span><span id="line-2146"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span class="hs-special">(</span><span id="local-6989586621683036189"><span class="annot"><span class="annottext">Module
</span><a href="#local-6989586621683036189"><span class="hs-identifier hs-var">rdr_mod</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621683036190"><span class="annot"><span class="annottext">OccName
</span><a href="#local-6989586621683036190"><span class="hs-identifier hs-var">rdr_occ</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">RdrName -&gt; Maybe (Module, OccName)
</span><a href="GHC.Types.Name.Reader.html#isOrig_maybe"><span class="hs-identifier hs-var">isOrig_maybe</span></a></span><span> </span><span class="annot"><span class="annottext">RdrName
</span><a href="#local-6989586621683036180"><span class="hs-identifier hs-var">rdr_name</span></a></span><span>
</span><span id="line-2147"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">Either NotInScopeError Name
-&gt; NonEmpty (Either NotInScopeError Name)
forall a. a -&gt; NonEmpty a
</span><a href="../../base-4.21.0.0-ae91/src/Data.List.NonEmpty.html#singleton"><span class="hs-identifier hs-var">NE.singleton</span></a></span><span> </span><span class="annot"><span class="annottext">(Either NotInScopeError Name
 -&gt; NonEmpty (Either NotInScopeError Name))
-&gt; (Name -&gt; Either NotInScopeError Name)
-&gt; Name
-&gt; NonEmpty (Either NotInScopeError Name)
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">Name -&gt; Either NotInScopeError Name
forall a b. b -&gt; Either a b
</span><span class="hs-identifier hs-var">Right</span></span><span> </span><span class="annot"><span class="annottext">(Name -&gt; NonEmpty (Either NotInScopeError Name))
-&gt; RnM Name -&gt; RnM (NonEmpty (Either NotInScopeError Name))
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="annot"><span class="annottext">Module -&gt; OccName -&gt; RnM Name
forall a b. Module -&gt; OccName -&gt; TcRnIf a b Name
</span><a href="GHC.Iface.Env.html#lookupOrig"><span class="hs-identifier hs-var">lookupOrig</span></a></span><span> </span><span class="annot"><span class="annottext">Module
</span><a href="#local-6989586621683036189"><span class="hs-identifier hs-var">rdr_mod</span></a></span><span> </span><span class="annot"><span class="annottext">OccName
</span><a href="#local-6989586621683036190"><span class="hs-identifier hs-var">rdr_occ</span></a></span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-2148"></span><span>
</span><span id="line-2149"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">otherwise</span></span><span>
</span><span id="line-2150"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">HsSigCtxt
</span><a href="#local-6989586621683036178"><span class="hs-identifier hs-var">ctxt</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-2151"></span><span>      </span><span class="annot"><a href="GHC.Rename.Env.html#HsBootCtxt"><span class="hs-identifier hs-type">HsBootCtxt</span></a></span><span> </span><span id="local-6989586621683036191"><span class="annot"><span class="annottext">NameSet
</span><a href="#local-6989586621683036191"><span class="hs-identifier hs-var">ns</span></a></span></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">(Name -&gt; Bool) -&gt; RnM (NonEmpty (Either NotInScopeError Name))
</span><a href="#local-6989586621683036192"><span class="hs-identifier hs-var">lookup_top</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">NameSet -&gt; Name -&gt; Bool
</span><a href="#local-6989586621683036193"><span class="hs-identifier hs-var">elem_name_set_with_namespace</span></a></span><span> </span><span class="annot"><span class="annottext">NameSet
</span><a href="#local-6989586621683036191"><span class="hs-identifier hs-var">ns</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-2152"></span><span>      </span><span class="annot"><a href="GHC.Rename.Env.html#TopSigCtxt"><span class="hs-identifier hs-type">TopSigCtxt</span></a></span><span> </span><span id="local-6989586621683036194"><span class="annot"><span class="annottext">NameSet
</span><a href="#local-6989586621683036194"><span class="hs-identifier hs-var">ns</span></a></span></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">(Name -&gt; Bool) -&gt; RnM (NonEmpty (Either NotInScopeError Name))
</span><a href="#local-6989586621683036192"><span class="hs-identifier hs-var">lookup_top</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">NameSet -&gt; Name -&gt; Bool
</span><a href="#local-6989586621683036193"><span class="hs-identifier hs-var">elem_name_set_with_namespace</span></a></span><span> </span><span class="annot"><span class="annottext">NameSet
</span><a href="#local-6989586621683036194"><span class="hs-identifier hs-var">ns</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-2153"></span><span>      </span><span class="annot"><a href="GHC.Rename.Env.html#RoleAnnotCtxt"><span class="hs-identifier hs-type">RoleAnnotCtxt</span></a></span><span> </span><span id="local-6989586621683036195"><span class="annot"><span class="annottext">NameSet
</span><a href="#local-6989586621683036195"><span class="hs-identifier hs-var">ns</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">(Name -&gt; Bool) -&gt; RnM (NonEmpty (Either NotInScopeError Name))
</span><a href="#local-6989586621683036192"><span class="hs-identifier hs-var">lookup_top</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">NameSet -&gt; Name -&gt; Bool
</span><a href="#local-6989586621683036193"><span class="hs-identifier hs-var">elem_name_set_with_namespace</span></a></span><span> </span><span class="annot"><span class="annottext">NameSet
</span><a href="#local-6989586621683036195"><span class="hs-identifier hs-var">ns</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-2154"></span><span>      </span><span class="annot"><a href="GHC.Rename.Env.html#LocalBindCtxt"><span class="hs-identifier hs-type">LocalBindCtxt</span></a></span><span> </span><span id="local-6989586621683036196"><span class="annot"><span class="annottext">NameSet
</span><a href="#local-6989586621683036196"><span class="hs-identifier hs-var">ns</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">NameSet -&gt; RnM (NonEmpty (Either NotInScopeError Name))
</span><a href="#local-6989586621683036197"><span class="hs-identifier hs-var">lookup_group</span></a></span><span> </span><span class="annot"><span class="annottext">NameSet
</span><a href="#local-6989586621683036196"><span class="hs-identifier hs-var">ns</span></a></span><span>
</span><span id="line-2155"></span><span>      </span><span class="annot"><a href="GHC.Rename.Env.html#ClsDeclCtxt"><span class="hs-identifier hs-type">ClsDeclCtxt</span></a></span><span>  </span><span id="local-6989586621683036198"><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621683036198"><span class="hs-identifier hs-var">cls</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Name -&gt; RnM (NonEmpty (Either NotInScopeError Name))
</span><a href="#local-6989586621683036199"><span class="hs-identifier hs-var">lookup_cls_op</span></a></span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621683036198"><span class="hs-identifier hs-var">cls</span></a></span><span>
</span><span id="line-2156"></span><span>      </span><span class="annot"><a href="GHC.Rename.Env.html#InstDeclCtxt"><span class="hs-identifier hs-type">InstDeclCtxt</span></a></span><span> </span><span id="local-6989586621683036200"><span class="annot"><span class="annottext">NameSet
</span><a href="#local-6989586621683036200"><span class="hs-identifier hs-var">ns</span></a></span></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">if</span><span> </span><span class="annot"><span class="annottext">(Name -&gt; Bool) -&gt; NameSet -&gt; Bool
forall a. (a -&gt; Bool) -&gt; UniqSet a -&gt; Bool
</span><a href="GHC.Types.Unique.Set.html#uniqSetAny"><span class="hs-identifier hs-var">uniqSetAny</span></a></span><span> </span><span class="annot"><span class="annottext">Name -&gt; Bool
</span><a href="GHC.Builtin.Names.html#isUnboundName"><span class="hs-identifier hs-var">isUnboundName</span></a></span><span> </span><span class="annot"><span class="annottext">NameSet
</span><a href="#local-6989586621683036200"><span class="hs-identifier hs-var">ns</span></a></span><span> </span><span class="hs-comment">-- #16610</span><span>
</span><span id="line-2157"></span><span>                          </span><span class="hs-keyword">then</span><span> </span><span class="annot"><span class="annottext">NonEmpty (Either NotInScopeError Name)
-&gt; RnM (NonEmpty (Either NotInScopeError Name))
forall a. a -&gt; IOEnv (Env TcGblEnv TcLclEnv) a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="annot"><span class="annottext">(NonEmpty (Either NotInScopeError Name)
 -&gt; RnM (NonEmpty (Either NotInScopeError Name)))
-&gt; NonEmpty (Either NotInScopeError Name)
-&gt; RnM (NonEmpty (Either NotInScopeError Name))
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Either NotInScopeError Name
-&gt; NonEmpty (Either NotInScopeError Name)
forall a. a -&gt; NonEmpty a
</span><a href="../../base-4.21.0.0-ae91/src/Data.List.NonEmpty.html#singleton"><span class="hs-identifier hs-var">NE.singleton</span></a></span><span> </span><span class="annot"><span class="annottext">(Either NotInScopeError Name
 -&gt; NonEmpty (Either NotInScopeError Name))
-&gt; Either NotInScopeError Name
-&gt; NonEmpty (Either NotInScopeError Name)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Name -&gt; Either NotInScopeError Name
forall a b. b -&gt; Either a b
</span><span class="hs-identifier hs-var">Right</span></span><span> </span><span class="annot"><span class="annottext">(Name -&gt; Either NotInScopeError Name)
-&gt; Name -&gt; Either NotInScopeError Name
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">RdrName -&gt; Name
</span><a href="GHC.Rename.Unbound.html#mkUnboundNameRdr"><span class="hs-identifier hs-var">mkUnboundNameRdr</span></a></span><span> </span><span class="annot"><span class="annottext">RdrName
</span><a href="#local-6989586621683036180"><span class="hs-identifier hs-var">rdr_name</span></a></span><span>
</span><span id="line-2158"></span><span>                          </span><span class="hs-keyword">else</span><span> </span><span class="annot"><span class="annottext">(Name -&gt; Bool) -&gt; RnM (NonEmpty (Either NotInScopeError Name))
</span><a href="#local-6989586621683036192"><span class="hs-identifier hs-var">lookup_top</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">NameSet -&gt; Name -&gt; Bool
</span><a href="#local-6989586621683036193"><span class="hs-identifier hs-var">elem_name_set_with_namespace</span></a></span><span> </span><span class="annot"><span class="annottext">NameSet
</span><a href="#local-6989586621683036200"><span class="hs-identifier hs-var">ns</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-2159"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-2160"></span><span>    </span><span id="local-6989586621683036193"><span class="annot"><span class="annottext">elem_name_set_with_namespace :: NameSet -&gt; Name -&gt; Bool
</span><a href="#local-6989586621683036193"><span class="hs-identifier hs-var hs-var">elem_name_set_with_namespace</span></a></span></span><span> </span><span id="local-6989586621683036202"><span class="annot"><span class="annottext">NameSet
</span><a href="#local-6989586621683036202"><span class="hs-identifier hs-var">ns</span></a></span></span><span> </span><span id="local-6989586621683036203"><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621683036203"><span class="hs-identifier hs-var">n</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Name -&gt; Bool
</span><a href="#local-6989586621683036204"><span class="hs-identifier hs-var">check_namespace</span></a></span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621683036203"><span class="hs-identifier hs-var">n</span></a></span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Bool -&gt; Bool
</span><span class="hs-operator hs-var">&amp;&amp;</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621683036203"><span class="hs-identifier hs-var">n</span></a></span><span> </span><span class="annot"><span class="annottext">Name -&gt; NameSet -&gt; Bool
</span><a href="GHC.Types.Name.Set.html#elemNameSet"><span class="hs-operator hs-var">`elemNameSet`</span></a></span><span> </span><span class="annot"><span class="annottext">NameSet
</span><a href="#local-6989586621683036202"><span class="hs-identifier hs-var">ns</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-2161"></span><span>
</span><span id="line-2162"></span><span>    </span><span id="local-6989586621683036204"><span class="annot"><span class="annottext">check_namespace :: Name -&gt; Bool
</span><a href="#local-6989586621683036204"><span class="hs-identifier hs-var hs-var">check_namespace</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">NamespaceSpecifier -&gt; NameSpace -&gt; Bool
</span><a href="GHC.Hs.Binds.html#coveredByNamespaceSpecifier"><span class="hs-identifier hs-var">coveredByNamespaceSpecifier</span></a></span><span> </span><span class="annot"><span class="annottext">NamespaceSpecifier
</span><a href="#local-6989586621683036182"><span class="hs-identifier hs-var">ns_spec</span></a></span><span> </span><span class="annot"><span class="annottext">(NameSpace -&gt; Bool) -&gt; (Name -&gt; NameSpace) -&gt; Name -&gt; Bool
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">Name -&gt; NameSpace
</span><a href="GHC.Types.Name.html#nameNameSpace"><span class="hs-identifier hs-var">nameNameSpace</span></a></span><span>
</span><span id="line-2163"></span><span>
</span><span id="line-2164"></span><span>    </span><span id="local-6989586621683036207"><span class="annot"><span class="annottext">namespace :: NameSpace
</span><a href="#local-6989586621683036207"><span class="hs-identifier hs-var hs-var">namespace</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">OccName -&gt; NameSpace
</span><a href="GHC.Types.Name.Occurrence.html#occNameSpace"><span class="hs-identifier hs-var">occNameSpace</span></a></span><span> </span><span class="annot"><span class="annottext">OccName
</span><a href="#local-6989586621683036208"><span class="hs-identifier hs-var">occ</span></a></span><span>
</span><span id="line-2165"></span><span>    </span><span id="local-6989586621683036208"><span class="annot"><span class="annottext">occ :: OccName
</span><a href="#local-6989586621683036208"><span class="hs-identifier hs-var hs-var">occ</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">RdrName -&gt; OccName
</span><a href="GHC.Types.Name.Reader.html#rdrNameOcc"><span class="hs-identifier hs-var">rdrNameOcc</span></a></span><span> </span><span class="annot"><span class="annottext">RdrName
</span><a href="#local-6989586621683036180"><span class="hs-identifier hs-var">rdr_name</span></a></span><span>
</span><span id="line-2166"></span><span>    </span><span id="local-6989586621683036209"><span class="annot"><span class="annottext">relevant_gres :: WhichGREs GREInfo
</span><a href="#local-6989586621683036209"><span class="hs-identifier hs-var hs-var">relevant_gres</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-2167"></span><span>      </span><span class="annot"><a href="GHC.Types.Name.Reader.html#RelevantGREs"><span class="hs-identifier hs-type">RelevantGREs</span></a></span><span>
</span><span id="line-2168"></span><span>        </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">includeFieldSelectors :: FieldsOrSelectors
</span><a href="GHC.Types.Name.Reader.html#includeFieldSelectors"><span class="hs-identifier hs-var">includeFieldSelectors</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">FieldsOrSelectors
</span><a href="GHC.Types.Name.Reader.html#WantBoth"><span class="hs-identifier hs-var">WantBoth</span></a></span><span>
</span><span id="line-2169"></span><span>        </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">lookupVariablesForFields :: Bool
</span><a href="GHC.Types.Name.Reader.html#lookupVariablesForFields"><span class="hs-identifier hs-var">lookupVariablesForFields</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">True</span></span><span>
</span><span id="line-2170"></span><span>        </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">lookupTyConsAsWell :: Bool
</span><a href="GHC.Types.Name.Reader.html#lookupTyConsAsWell"><span class="hs-identifier hs-var">lookupTyConsAsWell</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621683036181"><span class="hs-identifier hs-var">also_try_tycon_ns</span></a></span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-2171"></span><span>    </span><span id="local-6989586621683036212"><span class="annot"><span class="annottext">ok_gre :: GlobalRdrElt -&gt; Bool
</span><a href="#local-6989586621683036212"><span class="hs-identifier hs-var hs-var">ok_gre</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">WhichGREs GREInfo -&gt; NameSpace -&gt; GlobalRdrElt -&gt; Bool
</span><a href="GHC.Types.Name.Reader.html#greIsRelevant"><span class="hs-identifier hs-var">greIsRelevant</span></a></span><span> </span><span class="annot"><span class="annottext">WhichGREs GREInfo
</span><a href="#local-6989586621683036209"><span class="hs-identifier hs-var">relevant_gres</span></a></span><span> </span><span class="annot"><span class="annottext">NameSpace
</span><a href="#local-6989586621683036207"><span class="hs-identifier hs-var">namespace</span></a></span><span>
</span><span id="line-2172"></span><span>
</span><span id="line-2173"></span><span>    </span><span id="local-6989586621683036188"><span class="annot"><span class="annottext">finish :: NotInScopeError
-&gt; GlobalRdrElt -&gt; NonEmpty (Either NotInScopeError Name)
</span><a href="#local-6989586621683036188"><span class="hs-identifier hs-var hs-var">finish</span></a></span></span><span> </span><span id="local-6989586621683036214"><span class="annot"><span class="annottext">NotInScopeError
</span><a href="#local-6989586621683036214"><span class="hs-identifier hs-var">err</span></a></span></span><span> </span><span id="local-6989586621683036215"><span class="annot"><span class="annottext">GlobalRdrElt
</span><a href="#local-6989586621683036215"><span class="hs-identifier hs-var">gre</span></a></span></span><span>
</span><span id="line-2174"></span><span>      </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">GlobalRdrElt -&gt; Bool
</span><a href="#local-6989586621683036212"><span class="hs-identifier hs-var">ok_gre</span></a></span><span> </span><span class="annot"><span class="annottext">GlobalRdrElt
</span><a href="#local-6989586621683036215"><span class="hs-identifier hs-var">gre</span></a></span><span>
</span><span id="line-2175"></span><span>      </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Either NotInScopeError Name
-&gt; NonEmpty (Either NotInScopeError Name)
forall a. a -&gt; NonEmpty a
</span><a href="../../base-4.21.0.0-ae91/src/Data.List.NonEmpty.html#singleton"><span class="hs-identifier hs-var">NE.singleton</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Name -&gt; Either NotInScopeError Name
forall a b. b -&gt; Either a b
</span><span class="hs-identifier hs-var">Right</span></span><span> </span><span class="annot"><span class="annottext">(Name -&gt; Either NotInScopeError Name)
-&gt; Name -&gt; Either NotInScopeError Name
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">GlobalRdrElt -&gt; Name
forall info. GlobalRdrEltX info -&gt; Name
</span><a href="GHC.Types.Name.Reader.html#greName"><span class="hs-identifier hs-var">greName</span></a></span><span> </span><span class="annot"><span class="annottext">GlobalRdrElt
</span><a href="#local-6989586621683036215"><span class="hs-identifier hs-var">gre</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-2176"></span><span>      </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">otherwise</span></span><span>
</span><span id="line-2177"></span><span>      </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Either NotInScopeError Name
-&gt; NonEmpty (Either NotInScopeError Name)
forall a. a -&gt; NonEmpty a
</span><a href="../../base-4.21.0.0-ae91/src/Data.List.NonEmpty.html#singleton"><span class="hs-identifier hs-var">NE.singleton</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">NotInScopeError -&gt; Either NotInScopeError Name
forall a b. a -&gt; Either a b
</span><span class="hs-identifier hs-var">Left</span></span><span> </span><span class="annot"><span class="annottext">NotInScopeError
</span><a href="#local-6989586621683036214"><span class="hs-identifier hs-var">err</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-2178"></span><span>
</span><span id="line-2179"></span><span>    </span><span id="local-6989586621683036199"><span class="annot"><span class="annottext">lookup_cls_op :: Name -&gt; RnM (NonEmpty (Either NotInScopeError Name))
</span><a href="#local-6989586621683036199"><span class="hs-identifier hs-var hs-var">lookup_cls_op</span></a></span></span><span> </span><span id="local-6989586621683036216"><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621683036216"><span class="hs-identifier hs-var">cls</span></a></span></span><span>
</span><span id="line-2180"></span><span>      </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Either NotInScopeError Name
-&gt; NonEmpty (Either NotInScopeError Name)
forall a. a -&gt; NonEmpty a
</span><a href="../../base-4.21.0.0-ae91/src/Data.List.NonEmpty.html#singleton"><span class="hs-identifier hs-var">NE.singleton</span></a></span><span> </span><span class="annot"><span class="annottext">(Either NotInScopeError Name
 -&gt; NonEmpty (Either NotInScopeError Name))
-&gt; RnM (Either NotInScopeError Name)
-&gt; RnM (NonEmpty (Either NotInScopeError Name))
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="annot"><span class="annottext">DeprecationWarnings
-&gt; Name -&gt; SDoc -&gt; RdrName -&gt; RnM (Either NotInScopeError Name)
</span><a href="GHC.Rename.Env.html#lookupSubBndrOcc"><span class="hs-identifier hs-var">lookupSubBndrOcc</span></a></span><span> </span><span class="annot"><span class="annottext">DeprecationWarnings
</span><a href="GHC.Rename.Utils.html#AllDeprecationWarnings"><span class="hs-identifier hs-var">AllDeprecationWarnings</span></a></span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621683036216"><span class="hs-identifier hs-var">cls</span></a></span><span> </span><span class="annot"><span class="annottext">SDoc
</span><a href="#local-6989586621683036217"><span class="hs-identifier hs-var">doc</span></a></span><span> </span><span class="annot"><span class="annottext">RdrName
</span><a href="#local-6989586621683036180"><span class="hs-identifier hs-var">rdr_name</span></a></span><span>
</span><span id="line-2181"></span><span>      </span><span class="hs-keyword">where</span><span>
</span><span id="line-2182"></span><span>        </span><span id="local-6989586621683036217"><span class="annot"><span class="annottext">doc :: SDoc
</span><a href="#local-6989586621683036217"><span class="hs-identifier hs-var hs-var">doc</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">String -&gt; SDoc
forall doc. IsLine doc =&gt; String -&gt; doc
</span><a href="GHC.Utils.Outputable.html#text"><span class="hs-identifier hs-var">text</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;method of class&quot;</span></span><span> </span><span class="annot"><span class="annottext">SDoc -&gt; SDoc -&gt; SDoc
forall doc. IsLine doc =&gt; doc -&gt; doc -&gt; doc
</span><a href="GHC.Utils.Outputable.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">SDoc -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#quotes"><span class="hs-identifier hs-var">quotes</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Name -&gt; SDoc
forall a. Outputable a =&gt; a -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621683036216"><span class="hs-identifier hs-var">cls</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-2183"></span><span>
</span><span id="line-2184"></span><span>    </span><span id="local-6989586621683036192"><span class="annot"><span class="annottext">lookup_top :: (Name -&gt; Bool) -&gt; RnM (NonEmpty (Either NotInScopeError Name))
</span><a href="#local-6989586621683036192"><span class="hs-identifier hs-var hs-var">lookup_top</span></a></span></span><span> </span><span id="local-6989586621683036218"><span class="annot"><span class="annottext">Name -&gt; Bool
</span><a href="#local-6989586621683036218"><span class="hs-identifier hs-var">keep_me</span></a></span></span><span>
</span><span id="line-2185"></span><span>      </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span id="local-6989586621683036219"><span class="annot"><a href="#local-6989586621683036219"><span class="hs-identifier hs-var">env</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">TcRn GlobalRdrEnv
</span><a href="GHC.Tc.Utils.Monad.html#getGlobalRdrEnv"><span class="hs-identifier hs-var">getGlobalRdrEnv</span></a></span><span>
</span><span id="line-2186"></span><span>           </span><span class="hs-special">;</span><span> </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621683036220"><span class="annot"><a href="#local-6989586621683036220"><span class="hs-identifier hs-var hs-var">occ</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">RdrName -&gt; OccName
</span><a href="GHC.Types.Name.Reader.html#rdrNameOcc"><span class="hs-identifier hs-var">rdrNameOcc</span></a></span><span> </span><span class="annot"><span class="annottext">RdrName
</span><a href="#local-6989586621683036180"><span class="hs-identifier hs-var">rdr_name</span></a></span><span>
</span><span id="line-2187"></span><span>                 </span><span id="local-6989586621683036221"><span class="annot"><a href="#local-6989586621683036221"><span class="hs-identifier hs-var hs-var">all_gres</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">GlobalRdrEnv -&gt; LookupGRE GREInfo -&gt; [GlobalRdrElt]
forall info.
GlobalRdrEnvX info -&gt; LookupGRE info -&gt; [GlobalRdrEltX info]
</span><a href="GHC.Types.Name.Reader.html#lookupGRE"><span class="hs-identifier hs-var">lookupGRE</span></a></span><span> </span><span class="annot"><span class="annottext">GlobalRdrEnv
</span><a href="#local-6989586621683036219"><span class="hs-identifier hs-var">env</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">OccName -&gt; WhichGREs GREInfo -&gt; LookupGRE GREInfo
forall info. OccName -&gt; WhichGREs info -&gt; LookupGRE info
</span><a href="GHC.Types.Name.Reader.html#LookupOccName"><span class="hs-identifier hs-var">LookupOccName</span></a></span><span> </span><span class="annot"><span class="annottext">OccName
</span><a href="#local-6989586621683036220"><span class="hs-identifier hs-var">occ</span></a></span><span> </span><span class="annot"><span class="annottext">WhichGREs GREInfo
</span><a href="#local-6989586621683036209"><span class="hs-identifier hs-var">relevant_gres</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-2188"></span><span>                 </span><span id="local-6989586621683036223"><span class="annot"><a href="#local-6989586621683036223"><span class="hs-identifier hs-var hs-var">names_in_scope</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-comment">-- If rdr_name lacks a binding, only</span><span>
</span><span id="line-2189"></span><span>                                  </span><span class="hs-comment">-- recommend alternatives from relevant</span><span>
</span><span id="line-2190"></span><span>                                  </span><span class="hs-comment">-- namespaces. See #17593.</span><span>
</span><span id="line-2191"></span><span>                                  </span><span class="annot"><span class="annottext">(GlobalRdrElt -&gt; Name) -&gt; [GlobalRdrElt] -&gt; [Name]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><span class="hs-identifier hs-var">map</span></span><span> </span><span class="annot"><span class="annottext">GlobalRdrElt -&gt; Name
forall info. GlobalRdrEltX info -&gt; Name
</span><a href="GHC.Types.Name.Reader.html#greName"><span class="hs-identifier hs-var">greName</span></a></span><span>
</span><span id="line-2192"></span><span>                                </span><span class="annot"><span class="annottext">([GlobalRdrElt] -&gt; [Name]) -&gt; [GlobalRdrElt] -&gt; [Name]
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">(GlobalRdrElt -&gt; Bool) -&gt; [GlobalRdrElt] -&gt; [GlobalRdrElt]
forall a. (a -&gt; Bool) -&gt; [a] -&gt; [a]
</span><span class="hs-identifier hs-var">filter</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">GlobalRdrElt -&gt; Bool
</span><a href="#local-6989586621683036212"><span class="hs-identifier hs-var">ok_gre</span></a></span><span> </span><span class="annot"><span class="annottext">(GlobalRdrElt -&gt; Bool)
-&gt; (GlobalRdrElt -&gt; Bool) -&gt; GlobalRdrElt -&gt; Bool
forall (f :: * -&gt; *). Applicative f =&gt; f Bool -&gt; f Bool -&gt; f Bool
</span><a href="GHC.Utils.Misc.html#%3C%26%26%3E"><span class="hs-operator hs-var">&lt;&amp;&amp;&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">GlobalRdrElt -&gt; Bool
forall info. GlobalRdrEltX info -&gt; Bool
</span><a href="GHC.Types.Name.Reader.html#isLocalGRE"><span class="hs-identifier hs-var">isLocalGRE</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-2193"></span><span>                                </span><span class="annot"><span class="annottext">([GlobalRdrElt] -&gt; [GlobalRdrElt])
-&gt; [GlobalRdrElt] -&gt; [GlobalRdrElt]
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">GlobalRdrEnv -&gt; [GlobalRdrElt]
forall info. GlobalRdrEnvX info -&gt; [GlobalRdrEltX info]
</span><a href="GHC.Types.Name.Reader.html#globalRdrEnvElts"><span class="hs-identifier hs-var">globalRdrEnvElts</span></a></span><span> </span><span class="annot"><span class="annottext">GlobalRdrEnv
</span><a href="#local-6989586621683036219"><span class="hs-identifier hs-var">env</span></a></span><span>
</span><span id="line-2194"></span><span>                 </span><span id="local-6989586621683036226"><span class="annot"><a href="#local-6989586621683036226"><span class="hs-identifier hs-var hs-var">candidates_msg</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[Name] -&gt; [GhcHint]
</span><a href="#local-6989586621683036227"><span class="hs-identifier hs-var">candidates</span></a></span><span> </span><span class="annot"><span class="annottext">[Name]
</span><a href="#local-6989586621683036223"><span class="hs-identifier hs-var">names_in_scope</span></a></span><span>
</span><span id="line-2195"></span><span>           </span><span class="hs-special">;</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="hs-identifier hs-type">filter</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621683036218"><span class="hs-identifier hs-type">keep_me</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">.</span></span><span> </span><span class="annot"><a href="GHC.Types.Name.Reader.html#greName"><span class="hs-identifier hs-type">greName</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><a href="#local-6989586621683036221"><span class="hs-identifier hs-type">all_gres</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-2196"></span><span>               </span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">[GlobalRdrElt] -&gt; Bool
forall a. [a] -&gt; Bool
forall (t :: * -&gt; *) a. Foldable t =&gt; t a -&gt; Bool
</span><span class="hs-identifier hs-var">null</span></span><span> </span><span class="annot"><span class="annottext">[GlobalRdrElt]
</span><a href="#local-6989586621683036221"><span class="hs-identifier hs-var">all_gres</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">[GhcHint] -&gt; RnM (NonEmpty (Either NotInScopeError Name))
</span><a href="#local-6989586621683036228"><span class="hs-identifier hs-var">bale_out_with</span></a></span><span> </span><span class="annot"><span class="annottext">[GhcHint]
</span><a href="#local-6989586621683036226"><span class="hs-identifier hs-var">candidates_msg</span></a></span><span>
</span><span id="line-2197"></span><span>                  </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">otherwise</span></span><span>     </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">[GhcHint] -&gt; RnM (NonEmpty (Either NotInScopeError Name))
</span><a href="#local-6989586621683036228"><span class="hs-identifier hs-var">bale_out_with</span></a></span><span> </span><span class="annot"><span class="annottext">[GhcHint]
</span><a href="#local-6989586621683036229"><span class="hs-identifier hs-var">local_msg</span></a></span><span>
</span><span id="line-2198"></span><span>               </span><span class="hs-special">(</span><span id="local-6989586621683036230"><span class="annot"><span class="annottext">GlobalRdrElt
</span><a href="#local-6989586621683036230"><span class="hs-identifier hs-var">gre1</span></a></span></span><span class="annot"><span class="hs-glyph hs-type">:</span></span><span id="local-6989586621683036231"><span class="annot"><span class="annottext">[GlobalRdrElt]
</span><a href="#local-6989586621683036231"><span class="hs-identifier hs-var">gres</span></a></span></span><span class="hs-special">)</span><span>        </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">NonEmpty (Either NotInScopeError Name)
-&gt; RnM (NonEmpty (Either NotInScopeError Name))
forall a. a -&gt; IOEnv (Env TcGblEnv TcLclEnv) a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(GlobalRdrElt -&gt; Either NotInScopeError Name)
-&gt; NonEmpty GlobalRdrElt -&gt; NonEmpty (Either NotInScopeError Name)
forall a b. (a -&gt; b) -&gt; NonEmpty a -&gt; NonEmpty b
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-identifier hs-var">fmap</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Name -&gt; Either NotInScopeError Name
forall a b. b -&gt; Either a b
</span><span class="hs-identifier hs-var">Right</span></span><span> </span><span class="annot"><span class="annottext">(Name -&gt; Either NotInScopeError Name)
-&gt; (GlobalRdrElt -&gt; Name)
-&gt; GlobalRdrElt
-&gt; Either NotInScopeError Name
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">GlobalRdrElt -&gt; Name
forall info. GlobalRdrEltX info -&gt; Name
</span><a href="GHC.Types.Name.Reader.html#greName"><span class="hs-identifier hs-var">greName</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">GlobalRdrElt
</span><a href="#local-6989586621683036230"><span class="hs-identifier hs-var">gre1</span></a></span><span> </span><span class="annot"><span class="annottext">GlobalRdrElt -&gt; [GlobalRdrElt] -&gt; NonEmpty GlobalRdrElt
forall a. a -&gt; [a] -&gt; NonEmpty a
</span><span class="hs-operator hs-var">NE.:|</span></span><span> </span><span class="annot"><span class="annottext">[GlobalRdrElt]
</span><a href="#local-6989586621683036231"><span class="hs-identifier hs-var">gres</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-2199"></span><span>
</span><span id="line-2200"></span><span>    </span><span id="local-6989586621683036197"><span class="annot"><span class="annottext">lookup_group :: NameSet -&gt; RnM (NonEmpty (Either NotInScopeError Name))
</span><a href="#local-6989586621683036197"><span class="hs-identifier hs-var hs-var">lookup_group</span></a></span></span><span> </span><span id="local-6989586621683036232"><span class="annot"><span class="annottext">NameSet
</span><a href="#local-6989586621683036232"><span class="hs-identifier hs-var">bound_names</span></a></span></span><span>  </span><span class="hs-comment">-- Look in the local envt (not top level)</span><span>
</span><span id="line-2201"></span><span>      </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span id="local-6989586621683036233"><span class="annot"><a href="#local-6989586621683036233"><span class="hs-identifier hs-var">mname</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">RdrName -&gt; RnM (Maybe Name)
</span><a href="GHC.Rename.Env.html#lookupLocalOccRn_maybe"><span class="hs-identifier hs-var">lookupLocalOccRn_maybe</span></a></span><span> </span><span class="annot"><span class="annottext">RdrName
</span><a href="#local-6989586621683036180"><span class="hs-identifier hs-var">rdr_name</span></a></span><span>
</span><span id="line-2202"></span><span>           </span><span class="hs-special">;</span><span> </span><span id="local-6989586621683036234"><span class="annot"><a href="#local-6989586621683036234"><span class="hs-identifier hs-var">env</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.Monad.html#getLocalRdrEnv"><span class="hs-identifier hs-type">getLocalRdrEnv</span></a></span><span>
</span><span id="line-2203"></span><span>           </span><span class="hs-special">;</span><span> </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621683036235"><span class="annot"><a href="#local-6989586621683036235"><span class="hs-identifier hs-var hs-var">candidates_msg</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[Name] -&gt; [GhcHint]
</span><a href="#local-6989586621683036227"><span class="hs-identifier hs-var">candidates</span></a></span><span> </span><span class="annot"><span class="annottext">([Name] -&gt; [GhcHint]) -&gt; [Name] -&gt; [GhcHint]
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">LocalRdrEnv -&gt; [Name]
</span><a href="GHC.Types.Name.Reader.html#localRdrEnvElts"><span class="hs-identifier hs-var">localRdrEnvElts</span></a></span><span> </span><span class="annot"><span class="annottext">LocalRdrEnv
</span><a href="#local-6989586621683036234"><span class="hs-identifier hs-var">env</span></a></span><span>
</span><span id="line-2204"></span><span>           </span><span class="hs-special">;</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><a href="#local-6989586621683036233"><span class="hs-identifier hs-type">mname</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-2205"></span><span>               </span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span id="local-6989586621683036237"><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621683036237"><span class="hs-identifier hs-var">n</span></a></span></span><span>
</span><span id="line-2206"></span><span>                 </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621683036237"><span class="hs-identifier hs-var">n</span></a></span><span> </span><span class="annot"><span class="annottext">Name -&gt; NameSet -&gt; Bool
</span><a href="GHC.Types.Name.Set.html#elemNameSet"><span class="hs-operator hs-var">`elemNameSet`</span></a></span><span> </span><span class="annot"><span class="annottext">NameSet
</span><a href="#local-6989586621683036232"><span class="hs-identifier hs-var">bound_names</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">NonEmpty (Either NotInScopeError Name)
-&gt; RnM (NonEmpty (Either NotInScopeError Name))
forall a. a -&gt; IOEnv (Env TcGblEnv TcLclEnv) a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="annot"><span class="annottext">(NonEmpty (Either NotInScopeError Name)
 -&gt; RnM (NonEmpty (Either NotInScopeError Name)))
-&gt; NonEmpty (Either NotInScopeError Name)
-&gt; RnM (NonEmpty (Either NotInScopeError Name))
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Either NotInScopeError Name
-&gt; NonEmpty (Either NotInScopeError Name)
forall a. a -&gt; NonEmpty a
</span><a href="../../base-4.21.0.0-ae91/src/Data.List.NonEmpty.html#singleton"><span class="hs-identifier hs-var">NE.singleton</span></a></span><span> </span><span class="annot"><span class="annottext">(Either NotInScopeError Name
 -&gt; NonEmpty (Either NotInScopeError Name))
-&gt; Either NotInScopeError Name
-&gt; NonEmpty (Either NotInScopeError Name)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Name -&gt; Either NotInScopeError Name
forall a b. b -&gt; Either a b
</span><span class="hs-identifier hs-var">Right</span></span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621683036237"><span class="hs-identifier hs-var">n</span></a></span><span>
</span><span id="line-2207"></span><span>                 </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">otherwise</span></span><span>                   </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">[GhcHint] -&gt; RnM (NonEmpty (Either NotInScopeError Name))
</span><a href="#local-6989586621683036228"><span class="hs-identifier hs-var">bale_out_with</span></a></span><span> </span><span class="annot"><span class="annottext">[GhcHint]
</span><a href="#local-6989586621683036229"><span class="hs-identifier hs-var">local_msg</span></a></span><span>
</span><span id="line-2208"></span><span>               </span><span class="annot"><span class="annottext">Maybe Name
</span><span class="hs-identifier hs-var">Nothing</span></span><span>                         </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">[GhcHint] -&gt; RnM (NonEmpty (Either NotInScopeError Name))
</span><a href="#local-6989586621683036228"><span class="hs-identifier hs-var">bale_out_with</span></a></span><span> </span><span class="annot"><span class="annottext">[GhcHint]
</span><a href="#local-6989586621683036235"><span class="hs-identifier hs-var">candidates_msg</span></a></span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-2209"></span><span>
</span><span id="line-2210"></span><span>    </span><span id="local-6989586621683036228"><span class="annot"><span class="annottext">bale_out_with :: [GhcHint] -&gt; RnM (NonEmpty (Either NotInScopeError Name))
</span><a href="#local-6989586621683036228"><span class="hs-identifier hs-var hs-var">bale_out_with</span></a></span></span><span> </span><span id="local-6989586621683036238"><span class="annot"><span class="annottext">[GhcHint]
</span><a href="#local-6989586621683036238"><span class="hs-identifier hs-var">hints</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">NonEmpty (Either NotInScopeError Name)
-&gt; RnM (NonEmpty (Either NotInScopeError Name))
forall a. a -&gt; IOEnv (Env TcGblEnv TcLclEnv) a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="annot"><span class="annottext">(NonEmpty (Either NotInScopeError Name)
 -&gt; RnM (NonEmpty (Either NotInScopeError Name)))
-&gt; NonEmpty (Either NotInScopeError Name)
-&gt; RnM (NonEmpty (Either NotInScopeError Name))
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Either NotInScopeError Name
-&gt; NonEmpty (Either NotInScopeError Name)
forall a. a -&gt; NonEmpty a
</span><a href="../../base-4.21.0.0-ae91/src/Data.List.NonEmpty.html#singleton"><span class="hs-identifier hs-var">NE.singleton</span></a></span><span> </span><span class="annot"><span class="annottext">(Either NotInScopeError Name
 -&gt; NonEmpty (Either NotInScopeError Name))
-&gt; Either NotInScopeError Name
-&gt; NonEmpty (Either NotInScopeError Name)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">NotInScopeError -&gt; Either NotInScopeError Name
forall a b. a -&gt; Either a b
</span><span class="hs-identifier hs-var">Left</span></span><span> </span><span class="annot"><span class="annottext">(NotInScopeError -&gt; Either NotInScopeError Name)
-&gt; NotInScopeError -&gt; Either NotInScopeError Name
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">SDoc -&gt; [GhcHint] -&gt; NotInScopeError
</span><a href="GHC.Tc.Errors.Types.html#MissingBinding"><span class="hs-identifier hs-var">MissingBinding</span></a></span><span> </span><span class="annot"><span class="annottext">SDoc
</span><a href="#local-6989586621683036179"><span class="hs-identifier hs-var">what</span></a></span><span> </span><span class="annot"><span class="annottext">[GhcHint]
</span><a href="#local-6989586621683036238"><span class="hs-identifier hs-var">hints</span></a></span><span>
</span><span id="line-2211"></span><span>
</span><span id="line-2212"></span><span>    </span><span id="local-6989586621683036229"><span class="annot"><span class="annottext">local_msg :: [GhcHint]
</span><a href="#local-6989586621683036229"><span class="hs-identifier hs-var hs-var">local_msg</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">SDoc -&gt; RdrName -&gt; GhcHint
</span><a href="GHC.Types.Hint.html#SuggestMoveToDeclarationSite"><span class="hs-identifier hs-var">SuggestMoveToDeclarationSite</span></a></span><span> </span><span class="annot"><span class="annottext">SDoc
</span><a href="#local-6989586621683036179"><span class="hs-identifier hs-var">what</span></a></span><span> </span><span class="annot"><span class="annottext">RdrName
</span><a href="#local-6989586621683036180"><span class="hs-identifier hs-var">rdr_name</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-2213"></span><span>
</span><span id="line-2214"></span><span>    </span><span class="hs-comment">-- Identify all similar names and produce a message listing them</span><span>
</span><span id="line-2215"></span><span>    </span><span class="annot"><a href="#local-6989586621683036227"><span class="hs-identifier hs-type">candidates</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="GHC.Types.Name.html#Name"><span class="hs-identifier hs-type">Name</span></a></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="GHC.Types.Hint.html#GhcHint"><span class="hs-identifier hs-type">GhcHint</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-2216"></span><span>    </span><span id="local-6989586621683036227"><span class="annot"><span class="annottext">candidates :: [Name] -&gt; [GhcHint]
</span><a href="#local-6989586621683036227"><span class="hs-identifier hs-var hs-var">candidates</span></a></span></span><span> </span><span id="local-6989586621683036241"><span class="annot"><span class="annottext">[Name]
</span><a href="#local-6989586621683036241"><span class="hs-identifier hs-var">names_in_scope</span></a></span></span><span>
</span><span id="line-2217"></span><span>      </span><span class="hs-glyph">|</span><span> </span><span class="hs-special">(</span><span id="local-6989586621683036242"><span class="annot"><span class="annottext">SimilarName
</span><a href="#local-6989586621683036242"><span class="hs-identifier hs-var">nm</span></a></span></span><span> </span><span class="annot"><span class="hs-glyph hs-type">:</span></span><span> </span><span id="local-6989586621683036243"><span class="annot"><span class="annottext">[SimilarName]
</span><a href="#local-6989586621683036243"><span class="hs-identifier hs-var">nms</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">(Name -&gt; SimilarName) -&gt; [Name] -&gt; [SimilarName]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><span class="hs-identifier hs-var">map</span></span><span> </span><span class="annot"><span class="annottext">Name -&gt; SimilarName
</span><a href="GHC.Types.Hint.html#SimilarName"><span class="hs-identifier hs-var">SimilarName</span></a></span><span> </span><span class="annot"><span class="annottext">[Name]
</span><a href="#local-6989586621683036245"><span class="hs-identifier hs-var">similar_names</span></a></span><span>
</span><span id="line-2218"></span><span>      </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">RdrName -&gt; NonEmpty SimilarName -&gt; GhcHint
</span><a href="GHC.Types.Hint.html#SuggestSimilarNames"><span class="hs-identifier hs-var">SuggestSimilarNames</span></a></span><span> </span><span class="annot"><span class="annottext">RdrName
</span><a href="#local-6989586621683036180"><span class="hs-identifier hs-var">rdr_name</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">SimilarName
</span><a href="#local-6989586621683036242"><span class="hs-identifier hs-var">nm</span></a></span><span> </span><span class="annot"><span class="annottext">SimilarName -&gt; [SimilarName] -&gt; NonEmpty SimilarName
forall a. a -&gt; [a] -&gt; NonEmpty a
</span><span class="hs-operator hs-var">NE.:|</span></span><span> </span><span class="annot"><span class="annottext">[SimilarName]
</span><a href="#local-6989586621683036243"><span class="hs-identifier hs-var">nms</span></a></span><span class="hs-special">)</span><span class="hs-special">]</span><span>
</span><span id="line-2219"></span><span>      </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">otherwise</span></span><span>
</span><span id="line-2220"></span><span>      </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span>
</span><span id="line-2221"></span><span>      </span><span class="hs-keyword">where</span><span>
</span><span id="line-2222"></span><span>        </span><span id="local-6989586621683036245"><span class="annot"><span class="annottext">similar_names :: [Name]
</span><a href="#local-6989586621683036245"><span class="hs-identifier hs-var hs-var">similar_names</span></a></span></span><span>
</span><span id="line-2223"></span><span>          </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">String -&gt; [(String, Name)] -&gt; [Name]
forall a. String -&gt; [(String, a)] -&gt; [a]
</span><a href="GHC.Utils.Misc.html#fuzzyLookup"><span class="hs-identifier hs-var">fuzzyLookup</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">FastString -&gt; String
</span><a href="GHC.Data.FastString.html#unpackFS"><span class="hs-identifier hs-var">unpackFS</span></a></span><span> </span><span class="annot"><span class="annottext">(FastString -&gt; String) -&gt; FastString -&gt; String
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">OccName -&gt; FastString
</span><a href="GHC.Types.Name.Occurrence.html#occNameFS"><span class="hs-identifier hs-var">occNameFS</span></a></span><span> </span><span class="annot"><span class="annottext">(OccName -&gt; FastString) -&gt; OccName -&gt; FastString
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">RdrName -&gt; OccName
</span><a href="GHC.Types.Name.Reader.html#rdrNameOcc"><span class="hs-identifier hs-var">rdrNameOcc</span></a></span><span> </span><span class="annot"><span class="annottext">RdrName
</span><a href="#local-6989586621683036180"><span class="hs-identifier hs-var">rdr_name</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-2224"></span><span>          </span><span class="annot"><span class="annottext">([(String, Name)] -&gt; [Name]) -&gt; [(String, Name)] -&gt; [Name]
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">(Name -&gt; (String, Name)) -&gt; [Name] -&gt; [(String, Name)]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><span class="hs-identifier hs-var">map</span></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span id="local-6989586621683036249"><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621683036249"><span class="hs-identifier hs-var">x</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="hs-special">(</span><span class="annot"><span class="annottext">FastString -&gt; String
</span><a href="GHC.Data.FastString.html#unpackFS"><span class="hs-identifier hs-var">unpackFS</span></a></span><span> </span><span class="annot"><span class="annottext">(FastString -&gt; String) -&gt; FastString -&gt; String
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">OccName -&gt; FastString
</span><a href="GHC.Types.Name.Occurrence.html#occNameFS"><span class="hs-identifier hs-var">occNameFS</span></a></span><span> </span><span class="annot"><span class="annottext">(OccName -&gt; FastString) -&gt; OccName -&gt; FastString
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Name -&gt; OccName
</span><a href="GHC.Types.Name.html#nameOccName"><span class="hs-identifier hs-var">nameOccName</span></a></span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621683036249"><span class="hs-identifier hs-var">x</span></a></span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621683036249"><span class="hs-identifier hs-var">x</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-2225"></span><span>                </span><span class="annot"><span class="annottext">[Name]
</span><a href="#local-6989586621683036241"><span class="hs-identifier hs-var">names_in_scope</span></a></span><span>
</span><span id="line-2226"></span><span>
</span><span id="line-2227"></span><span>
</span><span id="line-2228"></span><span class="hs-comment">---------------</span><span>
</span><span id="line-2229"></span><span class="annot"><a href="GHC.Rename.Env.html#lookupLocalTcNames"><span class="hs-identifier hs-type">lookupLocalTcNames</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Rename.Env.html#HsSigCtxt"><span class="hs-identifier hs-type">HsSigCtxt</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Utils.Outputable.html#SDoc"><span class="hs-identifier hs-type">SDoc</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Hs.Binds.html#NamespaceSpecifier"><span class="hs-identifier hs-type">NamespaceSpecifier</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Types.Name.Reader.html#RdrName"><span class="hs-identifier hs-type">RdrName</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#RnM"><span class="hs-identifier hs-type">RnM</span></a></span><span> </span><span class="hs-special">[</span><span class="hs-special">(</span><span class="annot"><a href="GHC.Types.Name.Reader.html#RdrName"><span class="hs-identifier hs-type">RdrName</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Types.Name.html#Name"><span class="hs-identifier hs-type">Name</span></a></span><span class="hs-special">)</span><span class="hs-special">]</span><span>
</span><span id="line-2230"></span><span class="hs-comment">-- GHC extension: look up both the tycon and data con or variable.</span><span>
</span><span id="line-2231"></span><span class="hs-comment">-- Used for top-level fixity signatures and deprecations.</span><span>
</span><span id="line-2232"></span><span class="hs-comment">-- Complain if neither is in scope.</span><span>
</span><span id="line-2233"></span><span class="hs-comment">-- See Note [Fixity signature lookup]</span><span>
</span><span id="line-2234"></span><span id="lookupLocalTcNames"><span class="annot"><span class="annottext">lookupLocalTcNames :: HsSigCtxt
-&gt; SDoc -&gt; NamespaceSpecifier -&gt; RdrName -&gt; RnM [(RdrName, Name)]
</span><a href="GHC.Rename.Env.html#lookupLocalTcNames"><span class="hs-identifier hs-var hs-var">lookupLocalTcNames</span></a></span></span><span> </span><span id="local-6989586621683036251"><span class="annot"><span class="annottext">HsSigCtxt
</span><a href="#local-6989586621683036251"><span class="hs-identifier hs-var">ctxt</span></a></span></span><span> </span><span id="local-6989586621683036252"><span class="annot"><span class="annottext">SDoc
</span><a href="#local-6989586621683036252"><span class="hs-identifier hs-var">what</span></a></span></span><span> </span><span id="local-6989586621683036253"><span class="annot"><span class="annottext">NamespaceSpecifier
</span><a href="#local-6989586621683036253"><span class="hs-identifier hs-var">ns_spec</span></a></span></span><span> </span><span id="local-6989586621683036254"><span class="annot"><span class="annottext">RdrName
</span><a href="#local-6989586621683036254"><span class="hs-identifier hs-var">rdr</span></a></span></span><span>
</span><span id="line-2235"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span id="local-6989586621683036255"><span class="annot"><a href="#local-6989586621683036255"><span class="hs-identifier hs-var">this_mod</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">IOEnv (Env TcGblEnv TcLclEnv) Module
forall (m :: * -&gt; *). HasModule m =&gt; m Module
</span><a href="GHC.Unit.Module.html#getModule"><span class="hs-identifier hs-var">getModule</span></a></span><span>
</span><span id="line-2236"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621683036256"><span class="annot"><a href="#local-6989586621683036256"><span class="hs-identifier hs-var hs-var">also_try_tycon_ns</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">True</span></span><span>
</span><span id="line-2237"></span><span>       </span><span class="hs-special">;</span><span> </span><span id="local-6989586621683036257"><span class="annot"><a href="#local-6989586621683036257"><span class="hs-identifier hs-var">nms_eithers</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="hs-identifier hs-type">fmap</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621683036258"><span class="hs-identifier hs-type">guard_builtin_syntax</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683036255"><span class="hs-identifier hs-type">this_mod</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683036254"><span class="hs-identifier hs-type">rdr</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="hs-operator hs-type">&lt;$&gt;</span></span><span>
</span><span id="line-2238"></span><span>                        </span><span class="annot"><a href="GHC.Rename.Env.html#lookupBindGroupOcc"><span class="hs-identifier hs-type">lookupBindGroupOcc</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683036251"><span class="hs-identifier hs-type">ctxt</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683036252"><span class="hs-identifier hs-type">what</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683036254"><span class="hs-identifier hs-type">rdr</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683036256"><span class="hs-identifier hs-type">also_try_tycon_ns</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683036253"><span class="hs-identifier hs-type">ns_spec</span></a></span><span>
</span><span id="line-2239"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="hs-keyword">let</span><span> </span><span class="hs-special">(</span><span id="local-6989586621683036259"><span class="annot"><a href="#local-6989586621683036259"><span class="hs-identifier hs-var">errs</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621683036260"><span class="annot"><a href="#local-6989586621683036260"><span class="hs-identifier hs-var">names</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="hs-identifier hs-type">partitionEithers</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../../base-4.21.0.0-ae91/src/Data.List.NonEmpty.html#toList"><span class="hs-identifier hs-type">NE.toList</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683036257"><span class="hs-identifier hs-type">nms_eithers</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-2240"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">when</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">null</span></span><span> </span><span class="annot"><a href="#local-6989586621683036260"><span class="hs-identifier hs-type">names</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span>
</span><span id="line-2241"></span><span>          </span><span class="annot"><a href="GHC.Tc.Utils.Monad.html#addErr"><span class="hs-identifier hs-type">addErr</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Prelude.Basic.html#head"><span class="hs-identifier hs-type">head</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683036259"><span class="hs-identifier hs-type">errs</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-comment">-- Bleat about one only</span><span>
</span><span id="line-2242"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">return</span></span><span> </span><span class="annot"><a href="#local-6989586621683036260"><span class="hs-identifier hs-type">names</span></a></span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-2243"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-2244"></span><span>    </span><span class="hs-comment">-- Guard against the built-in syntax (ex: `infixl 6 :`), see #15233</span><span>
</span><span id="line-2245"></span><span>    </span><span id="local-6989586621683036258"><span class="annot"><span class="annottext">guard_builtin_syntax :: Module
-&gt; RdrName
-&gt; Either NotInScopeError Name
-&gt; Either TcRnMessage (RdrName, Name)
</span><a href="#local-6989586621683036258"><span class="hs-identifier hs-var hs-var">guard_builtin_syntax</span></a></span></span><span> </span><span id="local-6989586621683036261"><span class="annot"><span class="annottext">Module
</span><a href="#local-6989586621683036261"><span class="hs-identifier hs-var">this_mod</span></a></span></span><span> </span><span id="local-6989586621683036262"><span class="annot"><span class="annottext">RdrName
</span><a href="#local-6989586621683036262"><span class="hs-identifier hs-var">rdr</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Right</span></span><span> </span><span id="local-6989586621683036263"><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621683036263"><span class="hs-identifier hs-var">name</span></a></span></span><span class="hs-special">)</span><span>
</span><span id="line-2246"></span><span>      </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span class="annot"><span class="annottext">Name
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">OccName -&gt; Maybe Name
</span><a href="GHC.Builtin.Types.html#isBuiltInOcc_maybe"><span class="hs-identifier hs-var">isBuiltInOcc_maybe</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">RdrName -&gt; OccName
forall name. HasOccName name =&gt; name -&gt; OccName
</span><a href="GHC.Types.Name.Occurrence.html#occName"><span class="hs-identifier hs-var">occName</span></a></span><span> </span><span class="annot"><span class="annottext">RdrName
</span><a href="#local-6989586621683036262"><span class="hs-identifier hs-var">rdr</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-2247"></span><span>      </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Module
</span><a href="#local-6989586621683036261"><span class="hs-identifier hs-var">this_mod</span></a></span><span> </span><span class="annot"><span class="annottext">Module -&gt; Module -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">/=</span></span><span> </span><span class="annot"><span class="annottext">HasDebugCallStack =&gt; Name -&gt; Module
Name -&gt; Module
</span><a href="GHC.Types.Name.html#nameModule"><span class="hs-identifier hs-var">nameModule</span></a></span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621683036263"><span class="hs-identifier hs-var">name</span></a></span><span>
</span><span id="line-2248"></span><span>      </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">TcRnMessage -&gt; Either TcRnMessage (RdrName, Name)
forall a b. a -&gt; Either a b
</span><span class="hs-identifier hs-var">Left</span></span><span> </span><span class="annot"><span class="annottext">(TcRnMessage -&gt; Either TcRnMessage (RdrName, Name))
-&gt; TcRnMessage -&gt; Either TcRnMessage (RdrName, Name)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">SDoc -&gt; RdrName -&gt; TcRnMessage
</span><a href="GHC.Tc.Errors.Types.html#TcRnIllegalBuiltinSyntax"><span class="hs-identifier hs-var">TcRnIllegalBuiltinSyntax</span></a></span><span> </span><span class="annot"><span class="annottext">SDoc
</span><a href="#local-6989586621683036252"><span class="hs-identifier hs-var">what</span></a></span><span> </span><span class="annot"><span class="annottext">RdrName
</span><a href="#local-6989586621683036262"><span class="hs-identifier hs-var">rdr</span></a></span><span>
</span><span id="line-2249"></span><span>      </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">otherwise</span></span><span>
</span><span id="line-2250"></span><span>      </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(RdrName, Name) -&gt; Either TcRnMessage (RdrName, Name)
forall a b. b -&gt; Either a b
</span><span class="hs-identifier hs-var">Right</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">RdrName
</span><a href="#local-6989586621683036262"><span class="hs-identifier hs-var">rdr</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621683036263"><span class="hs-identifier hs-var">name</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-2251"></span><span>    </span><span class="annot"><a href="#local-6989586621683036258"><span class="hs-identifier hs-var">guard_builtin_syntax</span></a></span><span> </span><span class="annot"><span class="annottext">Module
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">RdrName
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Left</span></span><span> </span><span id="local-6989586621683036267"><span class="annot"><span class="annottext">NotInScopeError
</span><a href="#local-6989586621683036267"><span class="hs-identifier hs-var">err</span></a></span></span><span class="hs-special">)</span><span>
</span><span id="line-2252"></span><span>      </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">TcRnMessage -&gt; Either TcRnMessage (RdrName, Name)
forall a b. a -&gt; Either a b
</span><span class="hs-identifier hs-var">Left</span></span><span> </span><span class="annot"><span class="annottext">(TcRnMessage -&gt; Either TcRnMessage (RdrName, Name))
-&gt; TcRnMessage -&gt; Either TcRnMessage (RdrName, Name)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">RdrName -&gt; NotInScopeError -&gt; TcRnMessage
</span><a href="GHC.Tc.Errors.Types.html#mkTcRnNotInScope"><span class="hs-identifier hs-var">mkTcRnNotInScope</span></a></span><span> </span><span class="annot"><span class="annottext">RdrName
</span><a href="#local-6989586621683036254"><span class="hs-identifier hs-var">rdr</span></a></span><span> </span><span class="annot"><span class="annottext">NotInScopeError
</span><a href="#local-6989586621683036267"><span class="hs-identifier hs-var">err</span></a></span><span>
</span><span id="line-2253"></span><span>
</span><span id="line-2254"></span><span class="annot"><a href="GHC.Rename.Env.html#dataTcOccs"><span class="hs-identifier hs-type">dataTcOccs</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Types.Name.Reader.html#RdrName"><span class="hs-identifier hs-type">RdrName</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="GHC.Types.Name.Reader.html#RdrName"><span class="hs-identifier hs-type">RdrName</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-2255"></span><span class="hs-comment">-- Return both the given name and the same name promoted to the TcClsName</span><span>
</span><span id="line-2256"></span><span class="hs-comment">-- namespace.  This is useful when we aren't sure which we are looking at.</span><span>
</span><span id="line-2257"></span><span class="hs-comment">-- See also Note [dataTcOccs and Exact Names]</span><span>
</span><span id="line-2258"></span><span id="dataTcOccs"><span class="annot"><span class="annottext">dataTcOccs :: RdrName -&gt; [RdrName]
</span><a href="GHC.Rename.Env.html#dataTcOccs"><span class="hs-identifier hs-var hs-var">dataTcOccs</span></a></span></span><span> </span><span id="local-6989586621683036268"><span class="annot"><span class="annottext">RdrName
</span><a href="#local-6989586621683036268"><span class="hs-identifier hs-var">rdr_name</span></a></span></span><span>
</span><span id="line-2259"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">OccName -&gt; Bool
</span><a href="GHC.Types.Name.Occurrence.html#isDataOcc"><span class="hs-identifier hs-var">isDataOcc</span></a></span><span> </span><span class="annot"><span class="annottext">OccName
</span><a href="#local-6989586621683036270"><span class="hs-identifier hs-var">occ</span></a></span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Bool -&gt; Bool
</span><span class="hs-operator hs-var">||</span></span><span> </span><span class="annot"><span class="annottext">OccName -&gt; Bool
</span><a href="GHC.Types.Name.Occurrence.html#isVarOcc"><span class="hs-identifier hs-var">isVarOcc</span></a></span><span> </span><span class="annot"><span class="annottext">OccName
</span><a href="#local-6989586621683036270"><span class="hs-identifier hs-var">occ</span></a></span><span>
</span><span id="line-2260"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">RdrName
</span><a href="#local-6989586621683036268"><span class="hs-identifier hs-var">rdr_name</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">RdrName
</span><a href="#local-6989586621683036272"><span class="hs-identifier hs-var">rdr_name_tc</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-2261"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">otherwise</span></span><span>
</span><span id="line-2262"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">RdrName
</span><a href="#local-6989586621683036268"><span class="hs-identifier hs-var">rdr_name</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-2263"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-2264"></span><span>    </span><span id="local-6989586621683036270"><span class="annot"><span class="annottext">occ :: OccName
</span><a href="#local-6989586621683036270"><span class="hs-identifier hs-var hs-var">occ</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">RdrName -&gt; OccName
</span><a href="GHC.Types.Name.Reader.html#rdrNameOcc"><span class="hs-identifier hs-var">rdrNameOcc</span></a></span><span> </span><span class="annot"><span class="annottext">RdrName
</span><a href="#local-6989586621683036268"><span class="hs-identifier hs-var">rdr_name</span></a></span><span>
</span><span id="line-2265"></span><span>    </span><span id="local-6989586621683036272"><span class="annot"><span class="annottext">rdr_name_tc :: RdrName
</span><a href="#local-6989586621683036272"><span class="hs-identifier hs-var hs-var">rdr_name_tc</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">RdrName -&gt; NameSpace -&gt; RdrName
</span><a href="GHC.Parser.PostProcess.html#setRdrNameSpace"><span class="hs-identifier hs-var">setRdrNameSpace</span></a></span><span> </span><span class="annot"><span class="annottext">RdrName
</span><a href="#local-6989586621683036268"><span class="hs-identifier hs-var">rdr_name</span></a></span><span> </span><span class="annot"><span class="annottext">NameSpace
</span><a href="GHC.Types.Name.Occurrence.html#tcName"><span class="hs-identifier hs-var">tcName</span></a></span><span>
</span><span id="line-2266"></span><span>
</span><span id="line-2267"></span><span class="hs-comment">{- Note [dataTcOccs and Exact Names]
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
Exact RdrNames can occur in code generated by Template Haskell, and generally
those references are, well, exact. However, the TH `Name` type isn't expressive
enough to always track the correct namespace information, so we sometimes get
the right Unique but wrong namespace. Thus, we still have to do the double-lookup
for Exact RdrNames.

There is also an awkward situation for built-in syntax. Example in GHCi
   :info []
This parses as the Exact RdrName for nilDataCon, but we also want
the list type constructor.

Note that setRdrNameSpace on an Exact name requires the Name to be External,
which it always is for built in syntax.
-}</span><span>
</span><span id="line-2283"></span><span>
</span><span id="line-2284"></span><span class="hs-comment">{-
************************************************************************
*                                                                      *
                        Rebindable names
        Dealing with rebindable syntax is driven by the
        Opt_RebindableSyntax dynamic flag.

        In &quot;deriving&quot; code we don't want to use rebindable syntax
        so we switch off the flag locally

*                                                                      *
************************************************************************

Haskell 98 says that when you say &quot;3&quot; you get the &quot;fromInteger&quot; from the
Standard Prelude, regardless of what is in scope.   However, to experiment
with having a language that is less coupled to the standard prelude, we're
trying a non-standard extension that instead gives you whatever &quot;Prelude.fromInteger&quot;
happens to be in scope.  Then you can
        import Prelude ()
        import MyPrelude as Prelude
to get the desired effect.

At the moment this just happens for
  * fromInteger, fromRational on literals (in expressions and patterns)
  * negate (in expressions)
  * minus  (arising from n+k patterns)
  * &quot;do&quot; notation

We store the relevant Name in the HsSyn tree, in
  * HsIntegral/HsFractional/HsIsString
  * NegApp
  * NPlusKPat
  * HsDo
respectively.  Initially, we just store the &quot;standard&quot; name (GHC.Builtin.Names.fromIntegralName,
fromRationalName etc), but the renamer changes this to the appropriate user
name if Opt_NoImplicitPrelude is on.  That is what lookupSyntax does.

We treat the original (standard) names as free-vars too, because the type checker
checks the type of the user thing against the type of the standard thing.
-}</span><span>
</span><span id="line-2324"></span><span>
</span><span id="line-2325"></span><span class="annot"><a href="GHC.Rename.Env.html#lookupIfThenElse"><span class="hs-identifier hs-type">lookupIfThenElse</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#RnM"><span class="hs-identifier hs-type">RnM</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Maybe</span></span><span> </span><span class="annot"><a href="GHC.Types.Name.html#Name"><span class="hs-identifier hs-type">Name</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-2326"></span><span class="hs-comment">-- Looks up &quot;ifThenElse&quot; if rebindable syntax is on</span><span>
</span><span id="line-2327"></span><span id="lookupIfThenElse"><span class="annot"><span class="annottext">lookupIfThenElse :: RnM (Maybe Name)
</span><a href="GHC.Rename.Env.html#lookupIfThenElse"><span class="hs-identifier hs-var hs-var">lookupIfThenElse</span></a></span></span><span>
</span><span id="line-2328"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span id="local-6989586621683036274"><span class="annot"><a href="#local-6989586621683036274"><span class="hs-identifier hs-var">rebindable_on</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Extension -&gt; TcRnIf TcGblEnv TcLclEnv Bool
forall gbl lcl. Extension -&gt; TcRnIf gbl lcl Bool
</span><a href="GHC.Tc.Utils.Monad.html#xoptM"><span class="hs-identifier hs-var">xoptM</span></a></span><span> </span><span class="annot"><span class="annottext">Extension
</span><span class="hs-identifier hs-var">LangExt.RebindableSyntax</span></span><span>
</span><span id="line-2329"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="hs-keyword">if</span><span> </span><span class="annot"><span class="hs-identifier hs-type">not</span></span><span> </span><span class="annot"><a href="#local-6989586621683036274"><span class="hs-identifier hs-type">rebindable_on</span></a></span><span>
</span><span id="line-2330"></span><span>         </span><span class="hs-keyword">then</span><span> </span><span class="annot"><span class="hs-identifier hs-type">return</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Nothing</span></span><span>
</span><span id="line-2331"></span><span>         </span><span class="hs-keyword">else</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span id="local-6989586621683036276"><span class="annot"><a href="#local-6989586621683036276"><span class="hs-identifier hs-var">ite</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><a href="GHC.Rename.Env.html#lookupOccRnNone"><span class="hs-identifier hs-type">lookupOccRnNone</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Types.Name.Reader.html#mkVarUnqual"><span class="hs-identifier hs-type">mkVarUnqual</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Data.FastString.html#fsLit"><span class="hs-identifier hs-type">fsLit</span></a></span><span> </span><span class="annot"><span class="hs-string">&quot;ifThenElse&quot;</span></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-2332"></span><span>                 </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">return</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span class="annot"><a href="#local-6989586621683036276"><span class="hs-identifier hs-type">ite</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-2333"></span><span>
</span><span id="line-2334"></span><span class="annot"><a href="GHC.Rename.Env.html#lookupSyntaxName"><span class="hs-identifier hs-type">lookupSyntaxName</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Types.Name.html#Name"><span class="hs-identifier hs-type">Name</span></a></span><span>                 </span><span class="annot"><span class="hs-comment">-- ^ The standard name</span></span><span>
</span><span id="line-2335"></span><span>                 </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#RnM"><span class="hs-identifier hs-type">RnM</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Types.Name.html#Name"><span class="hs-identifier hs-type">Name</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Types.Name.Set.html#FreeVars"><span class="hs-identifier hs-type">FreeVars</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-comment">-- ^ Possibly a non-standard name</span><span>
</span><span id="line-2336"></span><span class="hs-comment">-- Lookup a Name that may be subject to Rebindable Syntax (RS).</span><span>
</span><span id="line-2337"></span><span class="hs-comment">--</span><span>
</span><span id="line-2338"></span><span class="hs-comment">-- - When RS is off, just return the supplied (standard) Name</span><span>
</span><span id="line-2339"></span><span class="hs-comment">--</span><span>
</span><span id="line-2340"></span><span class="hs-comment">-- - When RS is on, look up the OccName of the supplied Name; return</span><span>
</span><span id="line-2341"></span><span class="hs-comment">--   what we find, or the supplied Name if there is nothing in scope</span><span>
</span><span id="line-2342"></span><span id="lookupSyntaxName"><span class="annot"><span class="annottext">lookupSyntaxName :: Name -&gt; RnM (Name, NameSet)
</span><a href="GHC.Rename.Env.html#lookupSyntaxName"><span class="hs-identifier hs-var hs-var">lookupSyntaxName</span></a></span></span><span> </span><span id="local-6989586621683036280"><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621683036280"><span class="hs-identifier hs-var">std_name</span></a></span></span><span>
</span><span id="line-2343"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span id="local-6989586621683036281"><span class="annot"><a href="#local-6989586621683036281"><span class="hs-identifier hs-var">rebind</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Extension -&gt; TcRnIf TcGblEnv TcLclEnv Bool
forall gbl lcl. Extension -&gt; TcRnIf gbl lcl Bool
</span><a href="GHC.Tc.Utils.Monad.html#xoptM"><span class="hs-identifier hs-var">xoptM</span></a></span><span> </span><span class="annot"><span class="annottext">Extension
</span><span class="hs-identifier hs-var">LangExt.RebindableSyntax</span></span><span>
</span><span id="line-2344"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="hs-keyword">if</span><span> </span><span class="annot"><span class="hs-identifier hs-type">not</span></span><span> </span><span class="annot"><a href="#local-6989586621683036281"><span class="hs-identifier hs-type">rebind</span></a></span><span>
</span><span id="line-2345"></span><span>         </span><span class="hs-keyword">then</span><span> </span><span class="annot"><span class="hs-identifier hs-type">return</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621683036280"><span class="hs-identifier hs-type">std_name</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Types.Name.Set.html#emptyFVs"><span class="hs-identifier hs-type">emptyFVs</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-2346"></span><span>         </span><span class="hs-keyword">else</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span id="local-6989586621683036283"><span class="annot"><a href="#local-6989586621683036283"><span class="hs-identifier hs-var">nm</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><a href="GHC.Rename.Env.html#lookupOccRnNone"><span class="hs-identifier hs-type">lookupOccRnNone</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Types.Name.Reader.html#mkRdrUnqual"><span class="hs-identifier hs-type">mkRdrUnqual</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Types.Name.html#nameOccName"><span class="hs-identifier hs-type">nameOccName</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683036280"><span class="hs-identifier hs-type">std_name</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-2347"></span><span>                 </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">return</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621683036283"><span class="hs-identifier hs-type">nm</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Types.Name.Set.html#unitFV"><span class="hs-identifier hs-type">unitFV</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683036283"><span class="hs-identifier hs-type">nm</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-2348"></span><span>
</span><span id="line-2349"></span><span class="annot"><a href="GHC.Rename.Env.html#lookupSyntaxExpr"><span class="hs-identifier hs-type">lookupSyntaxExpr</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Types.Name.html#Name"><span class="hs-identifier hs-type">Name</span></a></span><span>                          </span><span class="annot"><span class="hs-comment">-- ^ The standard name</span></span><span>
</span><span id="line-2350"></span><span>                 </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#RnM"><span class="hs-identifier hs-type">RnM</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Language.Haskell.Syntax.Expr.html#HsExpr"><span class="hs-identifier hs-type">HsExpr</span></a></span><span> </span><span class="annot"><a href="GHC.Hs.Extension.html#GhcRn"><span class="hs-identifier hs-type">GhcRn</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Types.Name.Set.html#FreeVars"><span class="hs-identifier hs-type">FreeVars</span></a></span><span class="hs-special">)</span><span>  </span><span class="annot"><span class="hs-comment">-- ^ Possibly a non-standard name</span></span><span>
</span><span id="line-2351"></span><span id="lookupSyntaxExpr"><span class="annot"><span class="annottext">lookupSyntaxExpr :: Name -&gt; RnM (HsExpr GhcRn, NameSet)
</span><a href="GHC.Rename.Env.html#lookupSyntaxExpr"><span class="hs-identifier hs-var hs-var">lookupSyntaxExpr</span></a></span></span><span> </span><span id="local-6989586621683036286"><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621683036286"><span class="hs-identifier hs-var">std_name</span></a></span></span><span>
</span><span id="line-2352"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span class="hs-special">(</span><span id="local-6989586621683036287"><span class="annot"><a href="#local-6989586621683036287"><span class="hs-identifier hs-var">name</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621683036288"><span class="annot"><a href="#local-6989586621683036288"><span class="hs-identifier hs-var">fvs</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Name -&gt; RnM (Name, NameSet)
</span><a href="GHC.Rename.Env.html#lookupSyntaxName"><span class="hs-identifier hs-var">lookupSyntaxName</span></a></span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621683036286"><span class="hs-identifier hs-var">std_name</span></a></span><span>
</span><span id="line-2353"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">return</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Hs.Utils.html#nl_HsVar"><span class="hs-identifier hs-type">nl_HsVar</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683036287"><span class="hs-identifier hs-type">name</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="#local-6989586621683036288"><span class="hs-identifier hs-type">fvs</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-2354"></span><span>
</span><span id="line-2355"></span><span class="annot"><a href="GHC.Rename.Env.html#lookupSyntax"><span class="hs-identifier hs-type">lookupSyntax</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Types.Name.html#Name"><span class="hs-identifier hs-type">Name</span></a></span><span>                             </span><span class="hs-comment">-- The standard name</span><span>
</span><span id="line-2356"></span><span>             </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#RnM"><span class="hs-identifier hs-type">RnM</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Language.Haskell.Syntax.Expr.html#SyntaxExpr"><span class="hs-identifier hs-type">SyntaxExpr</span></a></span><span> </span><span class="annot"><a href="GHC.Hs.Extension.html#GhcRn"><span class="hs-identifier hs-type">GhcRn</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Types.Name.Set.html#FreeVars"><span class="hs-identifier hs-type">FreeVars</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-comment">-- Possibly a non-standard</span><span>
</span><span id="line-2357"></span><span>                                                 </span><span class="hs-comment">-- name</span><span>
</span><span id="line-2358"></span><span id="lookupSyntax"><span class="annot"><span class="annottext">lookupSyntax :: Name -&gt; RnM (SyntaxExpr GhcRn, NameSet)
</span><a href="GHC.Rename.Env.html#lookupSyntax"><span class="hs-identifier hs-var hs-var">lookupSyntax</span></a></span></span><span> </span><span id="local-6989586621683036290"><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621683036290"><span class="hs-identifier hs-var">std_name</span></a></span></span><span>
</span><span id="line-2359"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span class="hs-special">(</span><span id="local-6989586621683036291"><span class="annot"><a href="#local-6989586621683036291"><span class="hs-identifier hs-var">expr</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621683036292"><span class="annot"><a href="#local-6989586621683036292"><span class="hs-identifier hs-var">fvs</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Name -&gt; RnM (HsExpr GhcRn, NameSet)
</span><a href="GHC.Rename.Env.html#lookupSyntaxExpr"><span class="hs-identifier hs-var">lookupSyntaxExpr</span></a></span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621683036290"><span class="hs-identifier hs-var">std_name</span></a></span><span>
</span><span id="line-2360"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">return</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Hs.Expr.html#mkSyntaxExpr"><span class="hs-identifier hs-type">mkSyntaxExpr</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683036291"><span class="hs-identifier hs-type">expr</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="#local-6989586621683036292"><span class="hs-identifier hs-type">fvs</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-2361"></span><span>
</span><span id="line-2362"></span><span class="annot"><a href="GHC.Rename.Env.html#lookupSyntaxNames"><span class="hs-identifier hs-type">lookupSyntaxNames</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="GHC.Types.Name.html#Name"><span class="hs-identifier hs-type">Name</span></a></span><span class="hs-special">]</span><span>                         </span><span class="hs-comment">-- Standard names</span><span>
</span><span id="line-2363"></span><span>     </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#RnM"><span class="hs-identifier hs-type">RnM</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">[</span><span class="annot"><a href="Language.Haskell.Syntax.Expr.html#HsExpr"><span class="hs-identifier hs-type">HsExpr</span></a></span><span> </span><span class="annot"><a href="GHC.Hs.Extension.html#GhcRn"><span class="hs-identifier hs-type">GhcRn</span></a></span><span class="hs-special">]</span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Types.Name.Set.html#FreeVars"><span class="hs-identifier hs-type">FreeVars</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-comment">-- See comments with HsExpr.ReboundNames</span><span>
</span><span id="line-2364"></span><span>   </span><span class="hs-comment">-- this works with CmdTop, which wants HsExprs, not SyntaxExprs</span><span>
</span><span id="line-2365"></span><span id="lookupSyntaxNames"><span class="annot"><span class="annottext">lookupSyntaxNames :: [Name] -&gt; RnM ([HsExpr GhcRn], NameSet)
</span><a href="GHC.Rename.Env.html#lookupSyntaxNames"><span class="hs-identifier hs-var hs-var">lookupSyntaxNames</span></a></span></span><span> </span><span id="local-6989586621683036294"><span class="annot"><span class="annottext">[Name]
</span><a href="#local-6989586621683036294"><span class="hs-identifier hs-var">std_names</span></a></span></span><span>
</span><span id="line-2366"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span id="local-6989586621683036295"><span class="annot"><a href="#local-6989586621683036295"><span class="hs-identifier hs-var">rebindable_on</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Extension -&gt; TcRnIf TcGblEnv TcLclEnv Bool
forall gbl lcl. Extension -&gt; TcRnIf gbl lcl Bool
</span><a href="GHC.Tc.Utils.Monad.html#xoptM"><span class="hs-identifier hs-var">xoptM</span></a></span><span> </span><span class="annot"><span class="annottext">Extension
</span><span class="hs-identifier hs-var">LangExt.RebindableSyntax</span></span><span>
</span><span id="line-2367"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="hs-keyword">if</span><span> </span><span class="annot"><span class="hs-identifier hs-type">not</span></span><span> </span><span class="annot"><a href="#local-6989586621683036295"><span class="hs-identifier hs-type">rebindable_on</span></a></span><span> </span><span class="hs-keyword">then</span><span>
</span><span id="line-2368"></span><span>             </span><span class="annot"><span class="hs-identifier hs-type">return</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">map</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Language.Haskell.Syntax.Expr.html#HsVar"><span class="hs-identifier hs-type">HsVar</span></a></span><span> </span><span class="annot"><a href="Language.Haskell.Syntax.Extension.html#noExtField"><span class="hs-identifier hs-type">noExtField</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">.</span></span><span> </span><span class="annot"><a href="GHC.Parser.Annotation.html#noLocA"><span class="hs-identifier hs-type">noLocA</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><a href="#local-6989586621683036294"><span class="hs-identifier hs-type">std_names</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Types.Name.Set.html#emptyFVs"><span class="hs-identifier hs-type">emptyFVs</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-2369"></span><span>        </span><span class="hs-keyword">else</span><span>
</span><span id="line-2370"></span><span>          </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span id="local-6989586621683036299"><span class="annot"><a href="#local-6989586621683036299"><span class="hs-identifier hs-var">usr_names</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span>
</span><span id="line-2371"></span><span>                 </span><span class="annot"><span class="hs-identifier hs-type">mapM</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Rename.Env.html#lookupOccRnNone"><span class="hs-identifier hs-type">lookupOccRnNone</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">.</span></span><span> </span><span class="annot"><a href="GHC.Types.Name.Reader.html#mkRdrUnqual"><span class="hs-identifier hs-type">mkRdrUnqual</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">.</span></span><span> </span><span class="annot"><a href="GHC.Types.Name.html#nameOccName"><span class="hs-identifier hs-type">nameOccName</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><a href="#local-6989586621683036294"><span class="hs-identifier hs-type">std_names</span></a></span><span>
</span><span id="line-2372"></span><span>             </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">return</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">map</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Language.Haskell.Syntax.Expr.html#HsVar"><span class="hs-identifier hs-type">HsVar</span></a></span><span> </span><span class="annot"><a href="Language.Haskell.Syntax.Extension.html#noExtField"><span class="hs-identifier hs-type">noExtField</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">.</span></span><span> </span><span class="annot"><a href="GHC.Parser.Annotation.html#noLocA"><span class="hs-identifier hs-type">noLocA</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><a href="#local-6989586621683036299"><span class="hs-identifier hs-type">usr_names</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Types.Name.Set.html#mkFVs"><span class="hs-identifier hs-type">mkFVs</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683036299"><span class="hs-identifier hs-type">usr_names</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-2373"></span><span>
</span><span id="line-2374"></span><span>
</span><span id="line-2375"></span><span class="hs-comment">{-
Note [QualifiedDo]
~~~~~~~~~~~~~~~~~~
QualifiedDo is implemented using the same placeholders for operation names in
the AST that were devised for RebindableSyntax. Whenever the renamer checks
which names to use for do syntax, it first checks if the do block is qualified
(e.g. M.do { stmts }), in which case it searches for qualified names. If the
qualified names are not in scope, an error is produced. If the do block is not
qualified, the renamer does the usual search of the names which considers
whether RebindableSyntax is enabled or not. Dealing with QualifiedDo is driven
by the Opt_QualifiedDo dynamic flag.
-}</span><span>
</span><span id="line-2387"></span><span>
</span><span id="line-2388"></span><span class="hs-comment">-- Lookup operations for a qualified do. If the context is not a qualified</span><span>
</span><span id="line-2389"></span><span class="hs-comment">-- do, then use lookupSyntaxExpr. See Note [QualifiedDo].</span><span>
</span><span id="line-2390"></span><span id="local-6989586621683034789"><span class="annot"><a href="GHC.Rename.Env.html#lookupQualifiedDoExpr"><span class="hs-identifier hs-type">lookupQualifiedDoExpr</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Language.Haskell.Syntax.Expr.html#HsStmtContext"><span class="hs-identifier hs-type">HsStmtContext</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683034789"><span class="hs-identifier hs-type">fn</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Types.Name.html#Name"><span class="hs-identifier hs-type">Name</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#RnM"><span class="hs-identifier hs-type">RnM</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Language.Haskell.Syntax.Expr.html#HsExpr"><span class="hs-identifier hs-type">HsExpr</span></a></span><span> </span><span class="annot"><a href="GHC.Hs.Extension.html#GhcRn"><span class="hs-identifier hs-type">GhcRn</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Types.Name.Set.html#FreeVars"><span class="hs-identifier hs-type">FreeVars</span></a></span><span class="hs-special">)</span></span><span>
</span><span id="line-2391"></span><span id="lookupQualifiedDoExpr"><span class="annot"><span class="annottext">lookupQualifiedDoExpr :: forall fn. HsStmtContext fn -&gt; Name -&gt; RnM (HsExpr GhcRn, NameSet)
</span><a href="GHC.Rename.Env.html#lookupQualifiedDoExpr"><span class="hs-identifier hs-var hs-var">lookupQualifiedDoExpr</span></a></span></span><span> </span><span id="local-6989586621683036308"><span class="annot"><span class="annottext">HsStmtContext fn
</span><a href="#local-6989586621683036308"><span class="hs-identifier hs-var">ctxt</span></a></span></span><span> </span><span id="local-6989586621683036309"><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621683036309"><span class="hs-identifier hs-var">std_name</span></a></span></span><span>
</span><span id="line-2392"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(Name -&gt; HsExpr GhcRn)
-&gt; (Name, NameSet) -&gt; (HsExpr GhcRn, NameSet)
forall b c d. (b -&gt; c) -&gt; (b, d) -&gt; (c, d)
forall (a :: * -&gt; * -&gt; *) b c d.
Arrow a =&gt;
a b c -&gt; a (b, d) (c, d)
</span><span class="hs-identifier hs-var">first</span></span><span> </span><span class="annot"><span class="annottext">IdP GhcRn -&gt; HsExpr GhcRn
Name -&gt; HsExpr GhcRn
forall (p :: Pass) a.
IsSrcSpanAnn p a =&gt;
IdP (GhcPass p) -&gt; HsExpr (GhcPass p)
</span><a href="GHC.Hs.Utils.html#nl_HsVar"><span class="hs-identifier hs-var">nl_HsVar</span></a></span><span> </span><span class="annot"><span class="annottext">((Name, NameSet) -&gt; (HsExpr GhcRn, NameSet))
-&gt; RnM (Name, NameSet) -&gt; RnM (HsExpr GhcRn, NameSet)
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="annot"><span class="annottext">HsStmtContext fn -&gt; Name -&gt; RnM (Name, NameSet)
forall fn. HsStmtContext fn -&gt; Name -&gt; RnM (Name, NameSet)
</span><a href="GHC.Rename.Env.html#lookupQualifiedDoName"><span class="hs-identifier hs-var">lookupQualifiedDoName</span></a></span><span> </span><span class="annot"><span class="annottext">HsStmtContext fn
</span><a href="#local-6989586621683036308"><span class="hs-identifier hs-var">ctxt</span></a></span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621683036309"><span class="hs-identifier hs-var">std_name</span></a></span><span>
</span><span id="line-2393"></span><span>
</span><span id="line-2394"></span><span class="hs-comment">-- Like lookupQualifiedDoExpr but for producing SyntaxExpr.</span><span>
</span><span id="line-2395"></span><span class="hs-comment">-- See Note [QualifiedDo].</span><span>
</span><span id="line-2396"></span><span id="local-6989586621683034798"><span class="annot"><a href="GHC.Rename.Env.html#lookupQualifiedDo"><span class="hs-identifier hs-type">lookupQualifiedDo</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Language.Haskell.Syntax.Expr.html#HsStmtContext"><span class="hs-identifier hs-type">HsStmtContext</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683034798"><span class="hs-identifier hs-type">fn</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Types.Name.html#Name"><span class="hs-identifier hs-type">Name</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#RnM"><span class="hs-identifier hs-type">RnM</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Language.Haskell.Syntax.Expr.html#SyntaxExpr"><span class="hs-identifier hs-type">SyntaxExpr</span></a></span><span> </span><span class="annot"><a href="GHC.Hs.Extension.html#GhcRn"><span class="hs-identifier hs-type">GhcRn</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Types.Name.Set.html#FreeVars"><span class="hs-identifier hs-type">FreeVars</span></a></span><span class="hs-special">)</span></span><span>
</span><span id="line-2397"></span><span id="lookupQualifiedDo"><span class="annot"><span class="annottext">lookupQualifiedDo :: forall fn.
HsStmtContext fn -&gt; Name -&gt; RnM (SyntaxExpr GhcRn, NameSet)
</span><a href="GHC.Rename.Env.html#lookupQualifiedDo"><span class="hs-identifier hs-var hs-var">lookupQualifiedDo</span></a></span></span><span> </span><span id="local-6989586621683036312"><span class="annot"><span class="annottext">HsStmtContext fn
</span><a href="#local-6989586621683036312"><span class="hs-identifier hs-var">ctxt</span></a></span></span><span> </span><span id="local-6989586621683036313"><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621683036313"><span class="hs-identifier hs-var">std_name</span></a></span></span><span>
</span><span id="line-2398"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(HsExpr GhcRn -&gt; SyntaxExprRn)
-&gt; (HsExpr GhcRn, NameSet) -&gt; (SyntaxExprRn, NameSet)
forall b c d. (b -&gt; c) -&gt; (b, d) -&gt; (c, d)
forall (a :: * -&gt; * -&gt; *) b c d.
Arrow a =&gt;
a b c -&gt; a (b, d) (c, d)
</span><span class="hs-identifier hs-var">first</span></span><span> </span><span class="annot"><span class="annottext">HsExpr GhcRn -&gt; SyntaxExprRn
</span><a href="GHC.Hs.Expr.html#mkSyntaxExpr"><span class="hs-identifier hs-var">mkSyntaxExpr</span></a></span><span> </span><span class="annot"><span class="annottext">((HsExpr GhcRn, NameSet) -&gt; (SyntaxExprRn, NameSet))
-&gt; RnM (HsExpr GhcRn, NameSet)
-&gt; IOEnv (Env TcGblEnv TcLclEnv) (SyntaxExprRn, NameSet)
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="annot"><span class="annottext">HsStmtContext fn -&gt; Name -&gt; RnM (HsExpr GhcRn, NameSet)
forall fn. HsStmtContext fn -&gt; Name -&gt; RnM (HsExpr GhcRn, NameSet)
</span><a href="GHC.Rename.Env.html#lookupQualifiedDoExpr"><span class="hs-identifier hs-var">lookupQualifiedDoExpr</span></a></span><span> </span><span class="annot"><span class="annottext">HsStmtContext fn
</span><a href="#local-6989586621683036312"><span class="hs-identifier hs-var">ctxt</span></a></span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621683036313"><span class="hs-identifier hs-var">std_name</span></a></span><span>
</span><span id="line-2399"></span><span>
</span><span id="line-2400"></span><span class="annot"><a href="GHC.Rename.Env.html#lookupNameWithQualifier"><span class="hs-identifier hs-type">lookupNameWithQualifier</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Types.Name.html#Name"><span class="hs-identifier hs-type">Name</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Language.Haskell.Syntax.Module.Name.html#ModuleName"><span class="hs-identifier hs-type">ModuleName</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#RnM"><span class="hs-identifier hs-type">RnM</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Types.Name.html#Name"><span class="hs-identifier hs-type">Name</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Types.Name.Set.html#FreeVars"><span class="hs-identifier hs-type">FreeVars</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-2401"></span><span id="lookupNameWithQualifier"><span class="annot"><span class="annottext">lookupNameWithQualifier :: Name -&gt; ModuleName -&gt; RnM (Name, NameSet)
</span><a href="GHC.Rename.Env.html#lookupNameWithQualifier"><span class="hs-identifier hs-var hs-var">lookupNameWithQualifier</span></a></span></span><span> </span><span id="local-6989586621683036314"><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621683036314"><span class="hs-identifier hs-var">std_name</span></a></span></span><span> </span><span id="local-6989586621683036315"><span class="annot"><span class="annottext">ModuleName
</span><a href="#local-6989586621683036315"><span class="hs-identifier hs-var">modName</span></a></span></span><span>
</span><span id="line-2402"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span id="local-6989586621683036316"><span class="annot"><a href="#local-6989586621683036316"><span class="hs-identifier hs-var">qname</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">RdrName -&gt; RnM Name
</span><a href="GHC.Rename.Env.html#lookupOccRnNone"><span class="hs-identifier hs-var">lookupOccRnNone</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ModuleName -&gt; OccName -&gt; RdrName
</span><a href="GHC.Types.Name.Reader.html#mkRdrQual"><span class="hs-identifier hs-var">mkRdrQual</span></a></span><span> </span><span class="annot"><span class="annottext">ModuleName
</span><a href="#local-6989586621683036315"><span class="hs-identifier hs-var">modName</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Name -&gt; OccName
</span><a href="GHC.Types.Name.html#nameOccName"><span class="hs-identifier hs-var">nameOccName</span></a></span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621683036314"><span class="hs-identifier hs-var">std_name</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-2403"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">return</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621683036316"><span class="hs-identifier hs-type">qname</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Types.Name.Set.html#unitFV"><span class="hs-identifier hs-type">unitFV</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683036316"><span class="hs-identifier hs-type">qname</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-2404"></span><span>
</span><span id="line-2405"></span><span class="hs-comment">-- See Note [QualifiedDo].</span><span>
</span><span id="line-2406"></span><span id="local-6989586621683034797"><span class="annot"><a href="GHC.Rename.Env.html#lookupQualifiedDoName"><span class="hs-identifier hs-type">lookupQualifiedDoName</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Language.Haskell.Syntax.Expr.html#HsStmtContext"><span class="hs-identifier hs-type">HsStmtContext</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683034797"><span class="hs-identifier hs-type">fn</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Types.Name.html#Name"><span class="hs-identifier hs-type">Name</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#RnM"><span class="hs-identifier hs-type">RnM</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Types.Name.html#Name"><span class="hs-identifier hs-type">Name</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Types.Name.Set.html#FreeVars"><span class="hs-identifier hs-type">FreeVars</span></a></span><span class="hs-special">)</span></span><span>
</span><span id="line-2407"></span><span id="lookupQualifiedDoName"><span class="annot"><span class="annottext">lookupQualifiedDoName :: forall fn. HsStmtContext fn -&gt; Name -&gt; RnM (Name, NameSet)
</span><a href="GHC.Rename.Env.html#lookupQualifiedDoName"><span class="hs-identifier hs-var hs-var">lookupQualifiedDoName</span></a></span></span><span> </span><span id="local-6989586621683036318"><span class="annot"><span class="annottext">HsStmtContext fn
</span><a href="#local-6989586621683036318"><span class="hs-identifier hs-var">ctxt</span></a></span></span><span> </span><span id="local-6989586621683036319"><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621683036319"><span class="hs-identifier hs-var">std_name</span></a></span></span><span>
</span><span id="line-2408"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">HsStmtContext fn -&gt; Maybe ModuleName
forall fn. HsStmtContext fn -&gt; Maybe ModuleName
</span><a href="Language.Haskell.Syntax.Expr.html#qualifiedDoModuleName_maybe"><span class="hs-identifier hs-var">qualifiedDoModuleName_maybe</span></a></span><span> </span><span class="annot"><span class="annottext">HsStmtContext fn
</span><a href="#local-6989586621683036318"><span class="hs-identifier hs-var">ctxt</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-2409"></span><span>      </span><span class="annot"><span class="annottext">Maybe ModuleName
</span><span class="hs-identifier hs-var">Nothing</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Name -&gt; RnM (Name, NameSet)
</span><a href="GHC.Rename.Env.html#lookupSyntaxName"><span class="hs-identifier hs-var">lookupSyntaxName</span></a></span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621683036319"><span class="hs-identifier hs-var">std_name</span></a></span><span>
</span><span id="line-2410"></span><span>      </span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span id="local-6989586621683036321"><span class="annot"><span class="annottext">ModuleName
</span><a href="#local-6989586621683036321"><span class="hs-identifier hs-var">modName</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Name -&gt; ModuleName -&gt; RnM (Name, NameSet)
</span><a href="GHC.Rename.Env.html#lookupNameWithQualifier"><span class="hs-identifier hs-var">lookupNameWithQualifier</span></a></span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621683036319"><span class="hs-identifier hs-var">std_name</span></a></span><span> </span><span class="annot"><span class="annottext">ModuleName
</span><a href="#local-6989586621683036321"><span class="hs-identifier hs-var">modName</span></a></span><span>
</span><span id="line-2411"></span><span>
</span><span id="line-2412"></span><span class="hs-comment">--------------------------------------------------------------------------------</span><span>
</span><span id="line-2413"></span><span class="hs-comment">-- Helper functions for 'isIrrefutableHsPat'.</span><span>
</span><span id="line-2414"></span><span class="hs-comment">--</span><span>
</span><span id="line-2415"></span><span class="hs-comment">-- (Defined here to avoid import cycles.)</span><span>
</span><span id="line-2416"></span><span>
</span><span id="line-2417"></span><span class="hs-comment">-- | Check irrefutability of a 'ConLike' in a 'ConPat GhcRn'</span><span>
</span><span id="line-2418"></span><span class="hs-comment">-- (the 'Irref-ConLike' condition of Note [Irrefutability of ConPat]).</span><span>
</span><span id="line-2419"></span><span class="annot"><a href="GHC.Rename.Env.html#irrefutableConLikeRn"><span class="hs-identifier hs-type">irrefutableConLikeRn</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Utils.Misc.html#HasDebugCallStack"><span class="hs-identifier hs-type">HasDebugCallStack</span></a></span><span>
</span><span id="line-2420"></span><span>                     </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="GHC.Driver.Env.Types.html#HscEnv"><span class="hs-identifier hs-type">HscEnv</span></a></span><span>
</span><span id="line-2421"></span><span>                     </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Types.Name.Reader.html#GlobalRdrEnv"><span class="hs-identifier hs-type">GlobalRdrEnv</span></a></span><span>
</span><span id="line-2422"></span><span>                     </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Types.CompleteMatch.html#CompleteMatches"><span class="hs-identifier hs-type">CompleteMatches</span></a></span><span> </span><span class="annot"><span class="hs-comment">-- ^ in-scope COMPLETE pragmas</span></span><span>
</span><span id="line-2423"></span><span>                     </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Types.Name.html#Name"><span class="hs-identifier hs-type">Name</span></a></span><span> </span><span class="annot"><span class="hs-comment">-- ^ the 'Name' of the 'ConLike'</span></span><span>
</span><span id="line-2424"></span><span>                     </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Bool</span></span><span>
</span><span id="line-2425"></span><span id="irrefutableConLikeRn"><span class="annot"><span class="annottext">irrefutableConLikeRn :: HasDebugCallStack =&gt;
HscEnv -&gt; GlobalRdrEnv -&gt; CompleteMatches -&gt; Name -&gt; Bool
</span><a href="GHC.Rename.Env.html#irrefutableConLikeRn"><span class="hs-identifier hs-var hs-var">irrefutableConLikeRn</span></a></span></span><span> </span><span id="local-6989586621683036330"><span class="annot"><span class="annottext">HscEnv
</span><a href="#local-6989586621683036330"><span class="hs-identifier hs-var">hsc_env</span></a></span></span><span> </span><span id="local-6989586621683036331"><span class="annot"><span class="annottext">GlobalRdrEnv
</span><a href="#local-6989586621683036331"><span class="hs-identifier hs-var">rdr_env</span></a></span></span><span> </span><span id="local-6989586621683036332"><span class="annot"><span class="annottext">CompleteMatches
</span><a href="#local-6989586621683036332"><span class="hs-identifier hs-var">comps</span></a></span></span><span> </span><span id="local-6989586621683036333"><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621683036333"><span class="hs-identifier hs-var">con_nm</span></a></span></span><span>
</span><span id="line-2426"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span id="local-6989586621683036334"><span class="annot"><span class="annottext">GlobalRdrElt
</span><a href="#local-6989586621683036334"><span class="hs-identifier hs-var">gre</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">GlobalRdrEnv -&gt; Name -&gt; Maybe GlobalRdrElt
forall info.
Outputable info =&gt;
GlobalRdrEnvX info -&gt; Name -&gt; Maybe (GlobalRdrEltX info)
</span><a href="GHC.Types.Name.Reader.html#lookupGRE_Name"><span class="hs-identifier hs-var">lookupGRE_Name</span></a></span><span> </span><span class="annot"><span class="annottext">GlobalRdrEnv
</span><a href="#local-6989586621683036331"><span class="hs-identifier hs-var">rdr_env</span></a></span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621683036333"><span class="hs-identifier hs-var">con_nm</span></a></span><span>
</span><span id="line-2427"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">GREInfo -&gt; Bool
</span><a href="#local-6989586621683036335"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="annot"><span class="annottext">(GREInfo -&gt; Bool) -&gt; GREInfo -&gt; Bool
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">GlobalRdrElt -&gt; GREInfo
</span><a href="GHC.Types.Name.Reader.html#greInfo"><span class="hs-identifier hs-var">greInfo</span></a></span><span> </span><span class="annot"><span class="annottext">GlobalRdrElt
</span><a href="#local-6989586621683036334"><span class="hs-identifier hs-var">gre</span></a></span><span>
</span><span id="line-2428"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">otherwise</span></span><span>
</span><span id="line-2429"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">GREInfo -&gt; Bool
</span><a href="#local-6989586621683036335"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="annot"><span class="annottext">(GREInfo -&gt; Bool) -&gt; GREInfo -&gt; Bool
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">HasDebugCallStack =&gt; HscEnv -&gt; Name -&gt; GREInfo
HscEnv -&gt; Name -&gt; GREInfo
</span><a href="GHC.Rename.Env.html#lookupGREInfo"><span class="hs-identifier hs-var">lookupGREInfo</span></a></span><span> </span><span class="annot"><span class="annottext">HscEnv
</span><a href="#local-6989586621683036330"><span class="hs-identifier hs-var">hsc_env</span></a></span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621683036333"><span class="hs-identifier hs-var">con_nm</span></a></span><span>
</span><span id="line-2430"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-2431"></span><span>    </span><span id="local-6989586621683036335"><span class="annot"><span class="annottext">go :: GREInfo -&gt; Bool
</span><a href="#local-6989586621683036335"><span class="hs-identifier hs-var hs-var">go</span></a></span></span><span> </span><span class="hs-special">(</span><span> </span><span class="annot"><a href="GHC.Types.GREInfo.html#IAmConLike"><span class="hs-identifier hs-type">IAmConLike</span></a></span><span> </span><span id="local-6989586621683036337"><span class="annot"><span class="annottext">ConInfo
</span><a href="#local-6989586621683036337"><span class="hs-identifier hs-var">conInfo</span></a></span></span><span> </span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-2432"></span><span>      </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">ConInfo -&gt; ConLikeInfo
</span><a href="GHC.Types.GREInfo.html#conLikeInfo"><span class="hs-identifier hs-var">conLikeInfo</span></a></span><span> </span><span class="annot"><span class="annottext">ConInfo
</span><a href="#local-6989586621683036337"><span class="hs-identifier hs-var">conInfo</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-2433"></span><span>        </span><span class="annot"><a href="GHC.Types.GREInfo.html#ConIsData"><span class="hs-identifier hs-type">ConIsData</span></a></span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">conLikeDataCons :: ConLikeInfo -&gt; [Name]
</span><a href="GHC.Types.GREInfo.html#conLikeDataCons"><span class="hs-identifier hs-var">conLikeDataCons</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="local-6989586621683036340"><span class="annot"><span class="annottext">[Name]
</span><a href="#local-6989586621683036340"><span class="hs-identifier hs-var">tc_cons</span></a></span></span><span> </span><span class="hs-special">}</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-2434"></span><span>          </span><span class="annot"><span class="annottext">[Name] -&gt; Arity
forall a. [a] -&gt; Arity
forall (t :: * -&gt; *) a. Foldable t =&gt; t a -&gt; Arity
</span><span class="hs-identifier hs-var">length</span></span><span> </span><span class="annot"><span class="annottext">[Name]
</span><a href="#local-6989586621683036340"><span class="hs-identifier hs-var">tc_cons</span></a></span><span> </span><span class="annot"><span class="annottext">Arity -&gt; Arity -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">==</span></span><span> </span><span class="annot"><span class="annottext">Arity
</span><span class="hs-number">1</span></span><span>
</span><span id="line-2435"></span><span>        </span><span class="annot"><span class="annottext">ConLikeInfo
</span><a href="GHC.Types.GREInfo.html#ConIsPatSyn"><span class="hs-identifier hs-var">ConIsPatSyn</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-2436"></span><span>          </span><span class="annot"><span class="annottext">Name -&gt; CompleteMatches -&gt; Bool
forall con. NamedThing con =&gt; Name -&gt; [CompleteMatchX con] -&gt; Bool
</span><a href="GHC.Rename.Env.html#in_single_complete_match"><span class="hs-identifier hs-var">in_single_complete_match</span></a></span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621683036333"><span class="hs-identifier hs-var">con_nm</span></a></span><span> </span><span class="annot"><span class="annottext">CompleteMatches
</span><a href="#local-6989586621683036332"><span class="hs-identifier hs-var">comps</span></a></span><span>
</span><span id="line-2437"></span><span>    </span><span class="annot"><a href="#local-6989586621683036335"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="annot"><span class="annottext">GREInfo
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">False</span></span><span>
</span><span id="line-2438"></span><span>
</span><span id="line-2439"></span><span class="hs-comment">-- | Check irrefutability of the 'ConLike' in a 'ConPat GhcTc'</span><span>
</span><span id="line-2440"></span><span class="hs-comment">-- (the 'Irref-ConLike' condition of Note [Irrefutability of ConPat]),</span><span>
</span><span id="line-2441"></span><span class="hs-comment">-- given all in-scope COMPLETE pragmas ('CompleteMatches' in the typechecker,</span><span>
</span><span id="line-2442"></span><span class="hs-comment">-- 'DsCompleteMatches' in the desugarer).</span><span>
</span><span id="line-2443"></span><span id="local-6989586621683034806"><span class="annot"><a href="GHC.Rename.Env.html#irrefutableConLikeTc"><span class="hs-identifier hs-type">irrefutableConLikeTc</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Types.Name.html#NamedThing"><span class="hs-identifier hs-type">NamedThing</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683034806"><span class="hs-identifier hs-type">con</span></a></span><span>
</span><span id="line-2444"></span><span>                     </span><span class="hs-glyph">=&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="GHC.Types.CompleteMatch.html#CompleteMatchX"><span class="hs-identifier hs-type">CompleteMatchX</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683034806"><span class="hs-identifier hs-type">con</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-2445"></span><span>                         </span><span class="annot"><span class="hs-comment">-- ^ in-scope COMPLETE pragmas</span></span><span>
</span><span id="line-2446"></span><span>                     </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Core.ConLike.html#ConLike"><span class="hs-identifier hs-type">ConLike</span></a></span><span>
</span><span id="line-2447"></span><span>                     </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Bool</span></span></span><span>
</span><span id="line-2448"></span><span id="irrefutableConLikeTc"><span class="annot"><span class="annottext">irrefutableConLikeTc :: forall con.
NamedThing con =&gt;
[CompleteMatchX con] -&gt; ConLike -&gt; Bool
</span><a href="GHC.Rename.Env.html#irrefutableConLikeTc"><span class="hs-identifier hs-var hs-var">irrefutableConLikeTc</span></a></span></span><span> </span><span id="local-6989586621683036350"><span class="annot"><span class="annottext">[CompleteMatchX con]
</span><a href="#local-6989586621683036350"><span class="hs-identifier hs-var">comps</span></a></span></span><span> </span><span id="local-6989586621683036351"><span class="annot"><span class="annottext">ConLike
</span><a href="#local-6989586621683036351"><span class="hs-identifier hs-var">con</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-2449"></span><span>  </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">ConLike
</span><a href="#local-6989586621683036351"><span class="hs-identifier hs-var">con</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-2450"></span><span>    </span><span class="annot"><a href="GHC.Core.ConLike.html#RealDataCon"><span class="hs-identifier hs-type">RealDataCon</span></a></span><span> </span><span id="local-6989586621683036352"><span class="annot"><span class="annottext">DataCon
</span><a href="#local-6989586621683036352"><span class="hs-identifier hs-var">dc</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">[DataCon] -&gt; Arity
forall a. [a] -&gt; Arity
forall (t :: * -&gt; *) a. Foldable t =&gt; t a -&gt; Arity
</span><span class="hs-identifier hs-var">length</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TyCon -&gt; [DataCon]
</span><a href="GHC.Core.TyCon.html#tyConDataCons"><span class="hs-identifier hs-var">tyConDataCons</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">DataCon -&gt; TyCon
</span><a href="GHC.Core.DataCon.html#dataConTyCon"><span class="hs-identifier hs-var">dataConTyCon</span></a></span><span> </span><span class="annot"><span class="annottext">DataCon
</span><a href="#local-6989586621683036352"><span class="hs-identifier hs-var">dc</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Arity -&gt; Arity -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">==</span></span><span> </span><span class="annot"><span class="annottext">Arity
</span><span class="hs-number">1</span></span><span>
</span><span id="line-2451"></span><span>    </span><span class="annot"><a href="GHC.Core.ConLike.html#PatSynCon"><span class="hs-identifier hs-type">PatSynCon</span></a></span><span> </span><span class="hs-special">{</span><span class="hs-special">}</span><span>   </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Name -&gt; [CompleteMatchX con] -&gt; Bool
forall con. NamedThing con =&gt; Name -&gt; [CompleteMatchX con] -&gt; Bool
</span><a href="GHC.Rename.Env.html#in_single_complete_match"><span class="hs-identifier hs-var">in_single_complete_match</span></a></span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621683036354"><span class="hs-identifier hs-var">con_nm</span></a></span><span> </span><span class="annot"><span class="annottext">[CompleteMatchX con]
</span><a href="#local-6989586621683036350"><span class="hs-identifier hs-var">comps</span></a></span><span>
</span><span id="line-2452"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-2453"></span><span>    </span><span id="local-6989586621683036354"><span class="annot"><span class="annottext">con_nm :: Name
</span><a href="#local-6989586621683036354"><span class="hs-identifier hs-var hs-var">con_nm</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ConLike -&gt; Name
</span><a href="GHC.Core.ConLike.html#conLikeName"><span class="hs-identifier hs-var">conLikeName</span></a></span><span> </span><span class="annot"><span class="annottext">ConLike
</span><a href="#local-6989586621683036351"><span class="hs-identifier hs-var">con</span></a></span><span>
</span><span id="line-2454"></span><span>
</span><span id="line-2455"></span><span class="hs-comment">-- | Internal helper function: check whether a 'ConLike' is the single member</span><span>
</span><span id="line-2456"></span><span class="hs-comment">-- of a COMPLETE set without a result 'TyCon'.</span><span>
</span><span id="line-2457"></span><span class="hs-comment">--</span><span>
</span><span id="line-2458"></span><span class="hs-comment">-- Why 'without a result TyCon'? See Wrinkle [Irrefutability and COMPLETE pragma result TyCons]</span><span>
</span><span id="line-2459"></span><span class="hs-comment">-- in Note [Irrefutability of ConPat].</span><span>
</span><span id="line-2460"></span><span id="local-6989586621683034804"><span class="annot"><a href="GHC.Rename.Env.html#in_single_complete_match"><span class="hs-identifier hs-type">in_single_complete_match</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Types.Name.html#NamedThing"><span class="hs-identifier hs-type">NamedThing</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683034804"><span class="hs-identifier hs-type">con</span></a></span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="GHC.Types.Name.html#Name"><span class="hs-identifier hs-type">Name</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="GHC.Types.CompleteMatch.html#CompleteMatchX"><span class="hs-identifier hs-type">CompleteMatchX</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683034804"><span class="hs-identifier hs-type">con</span></a></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Bool</span></span></span><span>
</span><span id="line-2461"></span><span id="in_single_complete_match"><span class="annot"><span class="annottext">in_single_complete_match :: forall con. NamedThing con =&gt; Name -&gt; [CompleteMatchX con] -&gt; Bool
</span><a href="GHC.Rename.Env.html#in_single_complete_match"><span class="hs-identifier hs-var hs-var">in_single_complete_match</span></a></span></span><span> </span><span id="local-6989586621683036363"><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621683036363"><span class="hs-identifier hs-var">con_nm</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[CompleteMatchX con] -&gt; Bool
</span><a href="#local-6989586621683036364"><span class="hs-identifier hs-var">go</span></a></span><span>
</span><span id="line-2462"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-2463"></span><span>    </span><span id="local-6989586621683036364"><span class="annot"><span class="annottext">go :: [CompleteMatchX con] -&gt; Bool
</span><a href="#local-6989586621683036364"><span class="hs-identifier hs-var hs-var">go</span></a></span></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">False</span></span><span>
</span><span id="line-2464"></span><span>    </span><span class="annot"><a href="#local-6989586621683036364"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="hs-special">(</span><span id="local-6989586621683036365"><span class="annot"><span class="annottext">CompleteMatchX con
</span><a href="#local-6989586621683036365"><span class="hs-identifier hs-var">comp</span></a></span></span><span class="annot"><span class="hs-glyph hs-type">:</span></span><span id="local-6989586621683036366"><span class="annot"><span class="annottext">[CompleteMatchX con]
</span><a href="#local-6989586621683036366"><span class="hs-identifier hs-var">comps</span></a></span></span><span class="hs-special">)</span><span>
</span><span id="line-2465"></span><span>      </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Maybe Name
</span><span class="hs-identifier hs-var">Nothing</span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">CompleteMatchX con -&gt; Maybe Name
forall con. CompleteMatchX con -&gt; Maybe Name
</span><a href="GHC.Types.CompleteMatch.html#cmResultTyCon"><span class="hs-identifier hs-var">cmResultTyCon</span></a></span><span> </span><span class="annot"><span class="annottext">CompleteMatchX con
</span><a href="#local-6989586621683036365"><span class="hs-identifier hs-var">comp</span></a></span><span>
</span><span id="line-2466"></span><span>        </span><span class="hs-comment">-- conservative, as we don't have enough info to compute</span><span>
</span><span id="line-2467"></span><span>        </span><span class="hs-comment">-- 'completeMatchAppliesAtType'</span><span>
</span><span id="line-2468"></span><span>      </span><span class="hs-special">,</span><span> </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621683036368"><span class="annot"><span class="annottext">comp_nms :: UniqDSet Name
</span><a href="#local-6989586621683036368"><span class="hs-identifier hs-var hs-var">comp_nms</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(con -&gt; Name) -&gt; UniqDSet con -&gt; UniqDSet Name
forall b a. Uniquable b =&gt; (a -&gt; b) -&gt; UniqDSet a -&gt; UniqDSet b
</span><a href="GHC.Types.Unique.DSet.html#mapUniqDSet"><span class="hs-identifier hs-var">mapUniqDSet</span></a></span><span> </span><span class="annot"><span class="annottext">con -&gt; Name
forall a. NamedThing a =&gt; a -&gt; Name
</span><a href="GHC.Types.Name.html#getName"><span class="hs-identifier hs-var">getName</span></a></span><span> </span><span class="annot"><span class="annottext">(UniqDSet con -&gt; UniqDSet Name) -&gt; UniqDSet con -&gt; UniqDSet Name
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">CompleteMatchX con -&gt; UniqDSet con
forall con. CompleteMatchX con -&gt; UniqDSet con
</span><a href="GHC.Types.CompleteMatch.html#cmConLikes"><span class="hs-identifier hs-var">cmConLikes</span></a></span><span> </span><span class="annot"><span class="annottext">CompleteMatchX con
</span><a href="#local-6989586621683036365"><span class="hs-identifier hs-var">comp</span></a></span><span>
</span><span id="line-2469"></span><span>      </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">UniqDSet Name
</span><a href="#local-6989586621683036368"><span class="hs-identifier hs-var">comp_nms</span></a></span><span> </span><span class="annot"><span class="annottext">UniqDSet Name -&gt; UniqDSet Name -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">==</span></span><span> </span><span class="annot"><span class="annottext">[Name] -&gt; UniqDSet Name
forall a. Uniquable a =&gt; [a] -&gt; UniqDSet a
</span><a href="GHC.Types.Unique.DSet.html#mkUniqDSet"><span class="hs-identifier hs-var">mkUniqDSet</span></a></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621683036363"><span class="hs-identifier hs-var">con_nm</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-2470"></span><span>      </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">True</span></span><span>
</span><span id="line-2471"></span><span>      </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">otherwise</span></span><span>
</span><span id="line-2472"></span><span>      </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[CompleteMatchX con] -&gt; Bool
</span><a href="#local-6989586621683036364"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="annot"><span class="annottext">[CompleteMatchX con]
</span><a href="#local-6989586621683036366"><span class="hs-identifier hs-var">comps</span></a></span><span>
</span><span id="line-2473"></span><span>
</span><span id="line-2474"></span><span class="hs-comment">--------------------------------------------------------------------------------</span><span>
</span><span id="line-2475"></span></pre></body></html>