<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><link rel="stylesheet" type="text/css" href="style.css" /><script type="text/javascript" src="highlight.js"></script></head><body><pre><span class="hs-pragma">{-# LANGUAGE DeriveFunctor       #-}</span><span>
</span><span id="line-2"></span><span class="hs-pragma">{-# LANGUAGE FlexibleContexts    #-}</span><span>
</span><span id="line-3"></span><span class="hs-pragma">{-# LANGUAGE RankNTypes          #-}</span><span>
</span><span id="line-4"></span><span class="hs-pragma">{-# LANGUAGE ScopedTypeVariables #-}</span><span>
</span><span id="line-5"></span><span>
</span><span id="line-6"></span><span class="hs-comment">{-
(c) The University of Glasgow 2006
-}</span><span>
</span><span id="line-9"></span><span>
</span><span id="line-10"></span><span class="hs-comment">-- | Module for (a) type kinds and (b) type coercions,</span><span>
</span><span id="line-11"></span><span class="hs-comment">-- as used in System FC. See 'GHC.Core.Expr' for</span><span>
</span><span id="line-12"></span><span class="hs-comment">-- more on System FC and how coercions fit into it.</span><span>
</span><span id="line-13"></span><span class="hs-comment">--</span><span>
</span><span id="line-14"></span><span class="hs-keyword">module</span><span> </span><span class="annot"><a href="GHC.Core.Coercion.html"><span class="hs-identifier">GHC.Core.Coercion</span></a></span><span> </span><span class="hs-special">(</span><span>
</span><span id="line-15"></span><span>        </span><span class="annot"><span class="hs-comment">-- * Main data type</span></span><span>
</span><span id="line-16"></span><span>        </span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#Coercion"><span class="hs-identifier">Coercion</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#CoercionN"><span class="hs-identifier">CoercionN</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#CoercionR"><span class="hs-identifier">CoercionR</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#CoercionP"><span class="hs-identifier">CoercionP</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-17"></span><span>        </span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#MCoercion"><span class="hs-identifier">MCoercion</span></a></span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#MCoercionN"><span class="hs-identifier">MCoercionN</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#MCoercionR"><span class="hs-identifier">MCoercionR</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-18"></span><span>        </span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#CoSel"><span class="hs-identifier">CoSel</span></a></span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#FunSel"><span class="hs-identifier">FunSel</span></a></span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span>
</span><span id="line-19"></span><span>        </span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#UnivCoProvenance"><span class="hs-identifier">UnivCoProvenance</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#CoercionHole"><span class="hs-identifier">CoercionHole</span></a></span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span>
</span><span id="line-20"></span><span>        </span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#coHoleCoVar"><span class="hs-identifier">coHoleCoVar</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#setCoHoleCoVar"><span class="hs-identifier">setCoHoleCoVar</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-21"></span><span>        </span><span class="annot"><a href="GHC.Types.Basic.html#LeftOrRight"><span class="hs-identifier">LeftOrRight</span></a></span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span>
</span><span id="line-22"></span><span>        </span><span class="annot"><a href="GHC.Types.Var.html#Var"><span class="hs-identifier">Var</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Types.Var.html#CoVar"><span class="hs-identifier">CoVar</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Types.Var.html#TyCoVar"><span class="hs-identifier">TyCoVar</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-23"></span><span>        </span><span class="annot"><a href="Language.Haskell.Syntax.Basic.html#Role"><span class="hs-identifier">Role</span></a></span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Core.Coercion.html#ltRole"><span class="hs-identifier">ltRole</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-24"></span><span>
</span><span id="line-25"></span><span>        </span><span class="annot"><span class="hs-comment">-- ** Functions over coercions</span></span><span>
</span><span id="line-26"></span><span>        </span><span class="annot"><a href="GHC.Core.Coercion.html#coVarRType"><span class="hs-identifier">coVarRType</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Core.Coercion.html#coVarLType"><span class="hs-identifier">coVarLType</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Core.Coercion.html#coVarTypes"><span class="hs-identifier">coVarTypes</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-27"></span><span>        </span><span class="annot"><a href="GHC.Core.Coercion.html#coVarKind"><span class="hs-identifier">coVarKind</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Core.Coercion.html#coVarTypesRole"><span class="hs-identifier">coVarTypesRole</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Core.Coercion.html#coVarRole"><span class="hs-identifier">coVarRole</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-28"></span><span>        </span><span class="annot"><a href="GHC.Core.Coercion.html#coercionType"><span class="hs-identifier">coercionType</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Core.Coercion.html#mkCoercionType"><span class="hs-identifier">mkCoercionType</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-29"></span><span>        </span><span class="annot"><a href="GHC.Core.Coercion.html#coercionKind"><span class="hs-identifier">coercionKind</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Core.Coercion.html#coercionLKind"><span class="hs-identifier">coercionLKind</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Core.Coercion.html#coercionRKind"><span class="hs-identifier">coercionRKind</span></a></span><span class="hs-special">,</span><span class="annot"><a href="GHC.Core.Coercion.html#coercionKinds"><span class="hs-identifier">coercionKinds</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-30"></span><span>        </span><span class="annot"><a href="GHC.Core.Coercion.html#coercionRole"><span class="hs-identifier">coercionRole</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Core.Coercion.html#coercionKindRole"><span class="hs-identifier">coercionKindRole</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-31"></span><span>
</span><span id="line-32"></span><span>        </span><span class="annot"><span class="hs-comment">-- ** Constructing coercions</span></span><span>
</span><span id="line-33"></span><span>        </span><span class="annot"><a href="GHC.Core.Coercion.html#mkGReflCo"><span class="hs-identifier">mkGReflCo</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Core.Coercion.html#mkGReflMCo"><span class="hs-identifier">mkGReflMCo</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Core.Coercion.html#mkReflCo"><span class="hs-identifier">mkReflCo</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Core.Coercion.html#mkRepReflCo"><span class="hs-identifier">mkRepReflCo</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Core.Coercion.html#mkNomReflCo"><span class="hs-identifier">mkNomReflCo</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-34"></span><span>        </span><span class="annot"><a href="GHC.Core.Coercion.html#mkCoVarCo"><span class="hs-identifier">mkCoVarCo</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Core.Coercion.html#mkCoVarCos"><span class="hs-identifier">mkCoVarCos</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-35"></span><span>        </span><span class="annot"><a href="GHC.Core.Coercion.html#mkAxInstCo"><span class="hs-identifier">mkAxInstCo</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Core.Coercion.html#mkUnbranchedAxInstCo"><span class="hs-identifier">mkUnbranchedAxInstCo</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-36"></span><span>        </span><span class="annot"><a href="GHC.Core.Coercion.html#mkAxInstRHS"><span class="hs-identifier">mkAxInstRHS</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Core.Coercion.html#mkUnbranchedAxInstRHS"><span class="hs-identifier">mkUnbranchedAxInstRHS</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-37"></span><span>        </span><span class="annot"><a href="GHC.Core.Coercion.html#mkAxInstLHS"><span class="hs-identifier">mkAxInstLHS</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Core.Coercion.html#mkUnbranchedAxInstLHS"><span class="hs-identifier">mkUnbranchedAxInstLHS</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-38"></span><span>        </span><span class="annot"><a href="GHC.Core.Coercion.html#mkPiCo"><span class="hs-identifier">mkPiCo</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Core.Coercion.html#mkPiCos"><span class="hs-identifier">mkPiCos</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Core.Coercion.html#mkCoCast"><span class="hs-identifier">mkCoCast</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-39"></span><span>        </span><span class="annot"><a href="GHC.Core.Coercion.html#mkSymCo"><span class="hs-identifier">mkSymCo</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Core.Coercion.html#mkTransCo"><span class="hs-identifier">mkTransCo</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-40"></span><span>        </span><span class="annot"><a href="GHC.Core.Coercion.html#mkSelCo"><span class="hs-identifier">mkSelCo</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Core.Coercion.html#mkSelCoResRole"><span class="hs-identifier">mkSelCoResRole</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Core.Coercion.html#getNthFun"><span class="hs-identifier">getNthFun</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Core.Coercion.html#selectFromType"><span class="hs-identifier">selectFromType</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Core.Coercion.html#mkLRCo"><span class="hs-identifier">mkLRCo</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-41"></span><span>        </span><span class="annot"><a href="GHC.Core.Coercion.html#mkInstCo"><span class="hs-identifier">mkInstCo</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Core.Coercion.html#mkAppCo"><span class="hs-identifier">mkAppCo</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Core.Coercion.html#mkAppCos"><span class="hs-identifier">mkAppCos</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Core.Coercion.html#mkTyConAppCo"><span class="hs-identifier">mkTyConAppCo</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-42"></span><span>        </span><span class="annot"><a href="GHC.Core.Coercion.html#mkFunCo"><span class="hs-identifier">mkFunCo</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Core.Coercion.html#mkFunCo2"><span class="hs-identifier">mkFunCo2</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Core.Coercion.html#mkFunCoNoFTF"><span class="hs-identifier">mkFunCoNoFTF</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Core.Coercion.html#mkFunResCo"><span class="hs-identifier">mkFunResCo</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-43"></span><span>        </span><span class="annot"><a href="GHC.Core.Coercion.html#mkNakedFunCo"><span class="hs-identifier">mkNakedFunCo</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-44"></span><span>        </span><span class="annot"><a href="GHC.Core.Coercion.html#mkNakedForAllCo"><span class="hs-identifier">mkNakedForAllCo</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Core.Coercion.html#mkForAllCo"><span class="hs-identifier">mkForAllCo</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Core.Coercion.html#mkHomoForAllCos"><span class="hs-identifier">mkHomoForAllCos</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-45"></span><span>        </span><span class="annot"><a href="GHC.Core.Coercion.html#mkPhantomCo"><span class="hs-identifier">mkPhantomCo</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-46"></span><span>        </span><span class="annot"><a href="GHC.Core.Coercion.html#mkHoleCo"><span class="hs-identifier">mkHoleCo</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Core.Coercion.html#mkUnivCo"><span class="hs-identifier">mkUnivCo</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Core.Coercion.html#mkSubCo"><span class="hs-identifier">mkSubCo</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-47"></span><span>        </span><span class="annot"><a href="GHC.Core.Coercion.html#mkProofIrrelCo"><span class="hs-identifier">mkProofIrrelCo</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-48"></span><span>        </span><span class="annot"><a href="GHC.Core.Coercion.html#downgradeRole"><span class="hs-identifier">downgradeRole</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Core.Coercion.html#mkAxiomCo"><span class="hs-identifier">mkAxiomCo</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-49"></span><span>        </span><span class="annot"><a href="GHC.Core.Coercion.html#mkGReflRightCo"><span class="hs-identifier">mkGReflRightCo</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Core.Coercion.html#mkGReflLeftCo"><span class="hs-identifier">mkGReflLeftCo</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Core.Coercion.html#mkCoherenceLeftCo"><span class="hs-identifier">mkCoherenceLeftCo</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Core.Coercion.html#mkCoherenceRightCo"><span class="hs-identifier">mkCoherenceRightCo</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-50"></span><span>        </span><span class="annot"><a href="GHC.Core.Coercion.html#mkKindCo"><span class="hs-identifier">mkKindCo</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-51"></span><span>        </span><span class="annot"><a href="GHC.Core.Coercion.html#castCoercionKind"><span class="hs-identifier">castCoercionKind</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Core.Coercion.html#castCoercionKind1"><span class="hs-identifier">castCoercionKind1</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Core.Coercion.html#castCoercionKind2"><span class="hs-identifier">castCoercionKind2</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-52"></span><span>
</span><span id="line-53"></span><span>        </span><span class="annot"><a href="GHC.Core.Coercion.html#mkPrimEqPred"><span class="hs-identifier">mkPrimEqPred</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Core.Coercion.html#mkReprPrimEqPred"><span class="hs-identifier">mkReprPrimEqPred</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Core.Coercion.html#mkPrimEqPredRole"><span class="hs-identifier">mkPrimEqPredRole</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-54"></span><span>        </span><span class="annot"><a href="GHC.Core.Coercion.html#mkNomPrimEqPred"><span class="hs-identifier">mkNomPrimEqPred</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-55"></span><span>
</span><span id="line-56"></span><span>        </span><span class="annot"><span class="hs-comment">-- ** Decomposition</span></span><span>
</span><span id="line-57"></span><span>        </span><span class="annot"><a href="GHC.Core.Coercion.html#instNewTyCon_maybe"><span class="hs-identifier">instNewTyCon_maybe</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-58"></span><span>
</span><span id="line-59"></span><span>        </span><span class="annot"><a href="GHC.Core.Coercion.html#NormaliseStepper"><span class="hs-identifier">NormaliseStepper</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Core.Coercion.html#NormaliseStepResult"><span class="hs-identifier">NormaliseStepResult</span></a></span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Core.Coercion.html#composeSteppers"><span class="hs-identifier">composeSteppers</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Core.Coercion.html#unwrapNewTypeStepper"><span class="hs-identifier">unwrapNewTypeStepper</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-60"></span><span>        </span><span class="annot"><a href="GHC.Core.Coercion.html#topNormaliseNewType_maybe"><span class="hs-identifier">topNormaliseNewType_maybe</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Core.Coercion.html#topNormaliseTypeX"><span class="hs-identifier">topNormaliseTypeX</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-61"></span><span>
</span><span id="line-62"></span><span>        </span><span class="annot"><a href="GHC.Core.Coercion.html#decomposeCo"><span class="hs-identifier">decomposeCo</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Core.Coercion.html#decomposeFunCo"><span class="hs-identifier">decomposeFunCo</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Core.Coercion.html#decomposePiCos"><span class="hs-identifier">decomposePiCos</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Core.Coercion.html#getCoVar_maybe"><span class="hs-identifier">getCoVar_maybe</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-63"></span><span>        </span><span class="annot"><a href="GHC.Core.Coercion.html#splitAppCo_maybe"><span class="hs-identifier">splitAppCo_maybe</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-64"></span><span>        </span><span class="annot"><a href="GHC.Core.Coercion.html#splitFunCo_maybe"><span class="hs-identifier">splitFunCo_maybe</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-65"></span><span>        </span><span class="annot"><a href="GHC.Core.Coercion.html#splitForAllCo_maybe"><span class="hs-identifier">splitForAllCo_maybe</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-66"></span><span>        </span><span class="annot"><a href="GHC.Core.Coercion.html#splitForAllCo_ty_maybe"><span class="hs-identifier">splitForAllCo_ty_maybe</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Core.Coercion.html#splitForAllCo_co_maybe"><span class="hs-identifier">splitForAllCo_co_maybe</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-67"></span><span>
</span><span id="line-68"></span><span>        </span><span class="annot"><a href="GHC.Core.Coercion.html#tyConRole"><span class="hs-identifier">tyConRole</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Core.Coercion.html#tyConRolesX"><span class="hs-identifier">tyConRolesX</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Core.Coercion.html#tyConRolesRepresentational"><span class="hs-identifier">tyConRolesRepresentational</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Core.Coercion.html#setNominalRole_maybe"><span class="hs-identifier">setNominalRole_maybe</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-69"></span><span>        </span><span class="annot"><a href="GHC.Core.Coercion.html#tyConRoleListX"><span class="hs-identifier">tyConRoleListX</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Core.Coercion.html#tyConRoleListRepresentational"><span class="hs-identifier">tyConRoleListRepresentational</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Core.Coercion.html#funRole"><span class="hs-identifier">funRole</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-70"></span><span>        </span><span class="annot"><a href="GHC.Types.Basic.html#pickLR"><span class="hs-identifier">pickLR</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-71"></span><span>
</span><span id="line-72"></span><span>        </span><span class="annot"><a href="GHC.Core.Coercion.html#isGReflCo"><span class="hs-identifier">isGReflCo</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Core.Coercion.html#isReflCo"><span class="hs-identifier">isReflCo</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Core.Coercion.html#isReflCo_maybe"><span class="hs-identifier">isReflCo_maybe</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Core.Coercion.html#isGReflCo_maybe"><span class="hs-identifier">isGReflCo_maybe</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Core.Coercion.html#isReflexiveCo"><span class="hs-identifier">isReflexiveCo</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Core.Coercion.html#isReflexiveCo_maybe"><span class="hs-identifier">isReflexiveCo_maybe</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-73"></span><span>        </span><span class="annot"><a href="GHC.Core.Coercion.html#isReflCoVar_maybe"><span class="hs-identifier">isReflCoVar_maybe</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Core.Coercion.html#isGReflMCo"><span class="hs-identifier">isGReflMCo</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Core.Coercion.html#mkGReflLeftMCo"><span class="hs-identifier">mkGReflLeftMCo</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Core.Coercion.html#mkGReflRightMCo"><span class="hs-identifier">mkGReflRightMCo</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-74"></span><span>        </span><span class="annot"><a href="GHC.Core.Coercion.html#mkCoherenceRightMCo"><span class="hs-identifier">mkCoherenceRightMCo</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-75"></span><span>
</span><span id="line-76"></span><span>        </span><span class="annot"><a href="GHC.Core.Coercion.html#coToMCo"><span class="hs-identifier">coToMCo</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Core.Coercion.html#mkTransMCo"><span class="hs-identifier">mkTransMCo</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Core.Coercion.html#mkTransMCoL"><span class="hs-identifier">mkTransMCoL</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Core.Coercion.html#mkTransMCoR"><span class="hs-identifier">mkTransMCoR</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Core.Coercion.html#mkCastTyMCo"><span class="hs-identifier">mkCastTyMCo</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Core.Coercion.html#mkSymMCo"><span class="hs-identifier">mkSymMCo</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-77"></span><span>        </span><span class="annot"><a href="GHC.Core.Coercion.html#mkFunResMCo"><span class="hs-identifier">mkFunResMCo</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Core.Coercion.html#mkPiMCos"><span class="hs-identifier">mkPiMCos</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-78"></span><span>        </span><span class="annot"><a href="GHC.Core.Coercion.html#isReflMCo"><span class="hs-identifier">isReflMCo</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Core.Coercion.html#checkReflexiveMCo"><span class="hs-identifier">checkReflexiveMCo</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-79"></span><span>
</span><span id="line-80"></span><span>        </span><span class="annot"><span class="hs-comment">-- ** Coercion variables</span></span><span>
</span><span id="line-81"></span><span>        </span><span class="annot"><a href="GHC.Types.Var.html#mkCoVar"><span class="hs-identifier">mkCoVar</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Types.Var.html#isCoVar"><span class="hs-identifier">isCoVar</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Core.Coercion.html#coVarName"><span class="hs-identifier">coVarName</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Core.Coercion.html#setCoVarName"><span class="hs-identifier">setCoVarName</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Core.Coercion.html#setCoVarUnique"><span class="hs-identifier">setCoVarUnique</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-82"></span><span>
</span><span id="line-83"></span><span>        </span><span class="annot"><span class="hs-comment">-- ** Free variables</span></span><span>
</span><span id="line-84"></span><span>        </span><span class="annot"><a href="GHC.Core.TyCo.FVs.html#tyCoVarsOfCo"><span class="hs-identifier">tyCoVarsOfCo</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Core.TyCo.FVs.html#tyCoVarsOfCos"><span class="hs-identifier">tyCoVarsOfCos</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Core.TyCo.FVs.html#coVarsOfCo"><span class="hs-identifier">coVarsOfCo</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-85"></span><span>        </span><span class="annot"><a href="GHC.Core.TyCo.FVs.html#tyCoFVsOfCo"><span class="hs-identifier">tyCoFVsOfCo</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Core.TyCo.FVs.html#tyCoFVsOfCos"><span class="hs-identifier">tyCoFVsOfCos</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Core.TyCo.FVs.html#tyCoVarsOfCoDSet"><span class="hs-identifier">tyCoVarsOfCoDSet</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-86"></span><span>        </span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#coercionSize"><span class="hs-identifier">coercionSize</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Core.TyCo.FVs.html#anyFreeVarsOfCo"><span class="hs-identifier">anyFreeVarsOfCo</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-87"></span><span>
</span><span id="line-88"></span><span>        </span><span class="annot"><span class="hs-comment">-- ** Substitution</span></span><span>
</span><span id="line-89"></span><span>        </span><span class="annot"><a href="GHC.Core.TyCo.Subst.html#CvSubstEnv"><span class="hs-identifier">CvSubstEnv</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Core.TyCo.Subst.html#emptyCvSubstEnv"><span class="hs-identifier">emptyCvSubstEnv</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-90"></span><span>        </span><span class="annot"><a href="GHC.Core.TyCo.Subst.html#lookupCoVar"><span class="hs-identifier">lookupCoVar</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-91"></span><span>        </span><span class="annot"><a href="GHC.Core.TyCo.Subst.html#substCo"><span class="hs-identifier">substCo</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Core.TyCo.Subst.html#substCos"><span class="hs-identifier">substCos</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Core.TyCo.Subst.html#substCoVar"><span class="hs-identifier">substCoVar</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Core.TyCo.Subst.html#substCoVars"><span class="hs-identifier">substCoVars</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Core.TyCo.Subst.html#substCoWith"><span class="hs-identifier">substCoWith</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-92"></span><span>        </span><span class="annot"><a href="GHC.Core.TyCo.Subst.html#substCoVarBndr"><span class="hs-identifier">substCoVarBndr</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-93"></span><span>        </span><span class="annot"><a href="GHC.Core.TyCo.Subst.html#extendTvSubstAndInScope"><span class="hs-identifier">extendTvSubstAndInScope</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Core.TyCo.Subst.html#getCvSubstEnv"><span class="hs-identifier">getCvSubstEnv</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-94"></span><span>
</span><span id="line-95"></span><span>        </span><span class="annot"><span class="hs-comment">-- ** Lifting</span></span><span>
</span><span id="line-96"></span><span>        </span><span class="annot"><a href="GHC.Core.Coercion.html#liftCoSubst"><span class="hs-identifier">liftCoSubst</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Core.Coercion.html#liftCoSubstTyVar"><span class="hs-identifier">liftCoSubstTyVar</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Core.Coercion.html#liftCoSubstWith"><span class="hs-identifier">liftCoSubstWith</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Core.Coercion.html#liftCoSubstWithEx"><span class="hs-identifier">liftCoSubstWithEx</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-97"></span><span>        </span><span class="annot"><a href="GHC.Core.Coercion.html#emptyLiftingContext"><span class="hs-identifier">emptyLiftingContext</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Core.Coercion.html#extendLiftingContext"><span class="hs-identifier">extendLiftingContext</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Core.Coercion.html#extendLiftingContextAndInScope"><span class="hs-identifier">extendLiftingContextAndInScope</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-98"></span><span>        </span><span class="annot"><a href="GHC.Core.Coercion.html#liftCoSubstVarBndrUsing"><span class="hs-identifier">liftCoSubstVarBndrUsing</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Core.Coercion.html#isMappedByLC"><span class="hs-identifier">isMappedByLC</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Core.Coercion.html#extendLiftingContextCvSubst"><span class="hs-identifier">extendLiftingContextCvSubst</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-99"></span><span>
</span><span id="line-100"></span><span>        </span><span class="annot"><a href="GHC.Core.Coercion.html#mkSubstLiftingContext"><span class="hs-identifier">mkSubstLiftingContext</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Core.Coercion.html#liftingContextSubst"><span class="hs-identifier">liftingContextSubst</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Core.Coercion.html#zapLiftingContext"><span class="hs-identifier">zapLiftingContext</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-101"></span><span>        </span><span class="annot"><a href="GHC.Core.Coercion.html#substForAllCoBndrUsingLC"><span class="hs-identifier">substForAllCoBndrUsingLC</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Core.Coercion.html#lcLookupCoVar"><span class="hs-identifier">lcLookupCoVar</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Core.Coercion.html#lcInScopeSet"><span class="hs-identifier">lcInScopeSet</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-102"></span><span>
</span><span id="line-103"></span><span>        </span><span class="annot"><a href="GHC.Core.Coercion.html#LiftCoEnv"><span class="hs-identifier">LiftCoEnv</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Core.Coercion.html#LiftingContext"><span class="hs-identifier">LiftingContext</span></a></span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Core.Coercion.html#liftEnvSubstLeft"><span class="hs-identifier">liftEnvSubstLeft</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Core.Coercion.html#liftEnvSubstRight"><span class="hs-identifier">liftEnvSubstRight</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-104"></span><span>        </span><span class="annot"><a href="GHC.Core.Coercion.html#substRightCo"><span class="hs-identifier">substRightCo</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Core.Coercion.html#substLeftCo"><span class="hs-identifier">substLeftCo</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Core.Coercion.html#swapLiftCoEnv"><span class="hs-identifier">swapLiftCoEnv</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Core.Coercion.html#lcSubstLeft"><span class="hs-identifier">lcSubstLeft</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Core.Coercion.html#lcSubstRight"><span class="hs-identifier">lcSubstRight</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-105"></span><span>
</span><span id="line-106"></span><span>        </span><span class="annot"><span class="hs-comment">-- ** Comparison</span></span><span>
</span><span id="line-107"></span><span>        </span><span class="annot"><a href="GHC.Core.Coercion.html#eqCoercion"><span class="hs-identifier">eqCoercion</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Core.Coercion.html#eqCoercionX"><span class="hs-identifier">eqCoercionX</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-108"></span><span>
</span><span id="line-109"></span><span>        </span><span class="annot"><span class="hs-comment">-- ** Forcing evaluation of coercions</span></span><span>
</span><span id="line-110"></span><span>        </span><span class="annot"><a href="GHC.Core.Coercion.html#seqCo"><span class="hs-identifier">seqCo</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-111"></span><span>
</span><span id="line-112"></span><span>        </span><span class="annot"><span class="hs-comment">-- * Pretty-printing</span></span><span>
</span><span id="line-113"></span><span>        </span><span class="annot"><a href="GHC.Core.TyCo.Ppr.html#pprCo"><span class="hs-identifier">pprCo</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Core.TyCo.Ppr.html#pprParendCo"><span class="hs-identifier">pprParendCo</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-114"></span><span>        </span><span class="annot"><a href="GHC.Core.Coercion.html#pprCoAxiom"><span class="hs-identifier">pprCoAxiom</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Core.Coercion.html#pprCoAxBranch"><span class="hs-identifier">pprCoAxBranch</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Core.Coercion.html#pprCoAxBranchLHS"><span class="hs-identifier">pprCoAxBranchLHS</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-115"></span><span>        </span><span class="annot"><a href="GHC.Core.Coercion.html#pprCoAxBranchUser"><span class="hs-identifier">pprCoAxBranchUser</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Core.Coercion.html#tidyCoAxBndrsForUser"><span class="hs-identifier">tidyCoAxBndrsForUser</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-116"></span><span>        </span><span class="annot"><a href="GHC.Core.Coercion.html#etaExpandCoAxBranch"><span class="hs-identifier">etaExpandCoAxBranch</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-117"></span><span>
</span><span id="line-118"></span><span>        </span><span class="annot"><span class="hs-comment">-- * Tidying</span></span><span>
</span><span id="line-119"></span><span>        </span><span class="annot"><a href="GHC.Core.TyCo.Tidy.html#tidyCo"><span class="hs-identifier">tidyCo</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Core.TyCo.Tidy.html#tidyCos"><span class="hs-identifier">tidyCos</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-120"></span><span>
</span><span id="line-121"></span><span>        </span><span class="annot"><span class="hs-comment">-- * Other</span></span><span>
</span><span id="line-122"></span><span>        </span><span class="annot"><a href="GHC.Core.Coercion.html#promoteCoercion"><span class="hs-identifier">promoteCoercion</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Core.Coercion.html#buildCoercion"><span class="hs-identifier">buildCoercion</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-123"></span><span>
</span><span id="line-124"></span><span>        </span><span class="annot"><a href="GHC.Core.Coercion.html#multToCo"><span class="hs-identifier">multToCo</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Core.Coercion.html#mkRuntimeRepCo"><span class="hs-identifier">mkRuntimeRepCo</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-125"></span><span>
</span><span id="line-126"></span><span>        </span><span class="annot"><a href="GHC.Core.Coercion.html#hasCoercionHoleTy"><span class="hs-identifier">hasCoercionHoleTy</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Core.Coercion.html#hasCoercionHoleCo"><span class="hs-identifier">hasCoercionHoleCo</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Core.Coercion.html#hasThisCoercionHoleTy"><span class="hs-identifier">hasThisCoercionHoleTy</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-127"></span><span>
</span><span id="line-128"></span><span>        </span><span class="annot"><a href="GHC.Core.Coercion.html#setCoHoleType"><span class="hs-identifier">setCoHoleType</span></a></span><span>
</span><span id="line-129"></span><span>       </span><span class="hs-special">)</span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-130"></span><span>
</span><span id="line-131"></span><span class="hs-keyword">import</span><span> </span><span class="hs-pragma">{-# SOURCE</span><span> </span><span class="hs-pragma">#-}</span><span> </span><span class="annot"><a href="GHC.CoreToIface.html"><span class="hs-identifier">GHC.CoreToIface</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.CoreToIface.html#toIfaceTyCon"><span class="hs-identifier">toIfaceTyCon</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.CoreToIface.html#tidyToIfaceTcArgs"><span class="hs-identifier">tidyToIfaceTcArgs</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-132"></span><span>
</span><span id="line-133"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Prelude.html"><span class="hs-identifier">GHC.Prelude</span></a></span><span>
</span><span id="line-134"></span><span>
</span><span id="line-135"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Iface.Type.html"><span class="hs-identifier">GHC.Iface.Type</span></a></span><span>
</span><span id="line-136"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Core.TyCo.Rep.html"><span class="hs-identifier">GHC.Core.TyCo.Rep</span></a></span><span>
</span><span id="line-137"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Core.TyCo.FVs.html"><span class="hs-identifier">GHC.Core.TyCo.FVs</span></a></span><span>
</span><span id="line-138"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Core.TyCo.Ppr.html"><span class="hs-identifier">GHC.Core.TyCo.Ppr</span></a></span><span>
</span><span id="line-139"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Core.TyCo.Subst.html"><span class="hs-identifier">GHC.Core.TyCo.Subst</span></a></span><span>
</span><span id="line-140"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Core.TyCo.Tidy.html"><span class="hs-identifier">GHC.Core.TyCo.Tidy</span></a></span><span>
</span><span id="line-141"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Core.TyCo.Compare.html"><span class="hs-identifier">GHC.Core.TyCo.Compare</span></a></span><span>
</span><span id="line-142"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Core.Type.html"><span class="hs-identifier">GHC.Core.Type</span></a></span><span>
</span><span id="line-143"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Core.TyCon.html"><span class="hs-identifier">GHC.Core.TyCon</span></a></span><span>
</span><span id="line-144"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Core.TyCon.RecWalk.html"><span class="hs-identifier">GHC.Core.TyCon.RecWalk</span></a></span><span>
</span><span id="line-145"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Core.Coercion.Axiom.html"><span class="hs-identifier">GHC.Core.Coercion.Axiom</span></a></span><span>
</span><span id="line-146"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Types.Var.html"><span class="hs-identifier">GHC.Types.Var</span></a></span><span>
</span><span id="line-147"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Types.Var.Env.html"><span class="hs-identifier">GHC.Types.Var.Env</span></a></span><span>
</span><span id="line-148"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Types.Var.Set.html"><span class="hs-identifier">GHC.Types.Var.Set</span></a></span><span>
</span><span id="line-149"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Types.Name.html"><span class="hs-identifier">GHC.Types.Name</span></a></span><span> </span><span class="hs-keyword">hiding</span><span> </span><span class="hs-special">(</span><span> </span><span class="annot"><a href="GHC.Types.Name.Occurrence.html#varName"><span class="hs-identifier">varName</span></a></span><span> </span><span class="hs-special">)</span><span>
</span><span id="line-150"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Types.Basic.html"><span class="hs-identifier">GHC.Types.Basic</span></a></span><span>
</span><span id="line-151"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Types.Unique.html"><span class="hs-identifier">GHC.Types.Unique</span></a></span><span>
</span><span id="line-152"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Data.FastString.html"><span class="hs-identifier">GHC.Data.FastString</span></a></span><span>
</span><span id="line-153"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Data.Pair.html"><span class="hs-identifier">GHC.Data.Pair</span></a></span><span>
</span><span id="line-154"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Types.SrcLoc.html"><span class="hs-identifier">GHC.Types.SrcLoc</span></a></span><span>
</span><span id="line-155"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Builtin.Names.html"><span class="hs-identifier">GHC.Builtin.Names</span></a></span><span>
</span><span id="line-156"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Builtin.Types.Prim.html"><span class="hs-identifier">GHC.Builtin.Types.Prim</span></a></span><span>
</span><span id="line-157"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Data.List.SetOps.html"><span class="hs-identifier">GHC.Data.List.SetOps</span></a></span><span>
</span><span id="line-158"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Data.Maybe.html"><span class="hs-identifier">GHC.Data.Maybe</span></a></span><span>
</span><span id="line-159"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Types.Unique.FM.html"><span class="hs-identifier">GHC.Types.Unique.FM</span></a></span><span>
</span><span id="line-160"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Data.List.Infinite.html"><span class="hs-identifier">GHC.Data.List.Infinite</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Data.List.Infinite.html#Infinite"><span class="hs-identifier">Infinite</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-161"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><a href="GHC.Data.List.Infinite.html"><span class="hs-identifier">GHC.Data.List.Infinite</span></a></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">Inf</span></span><span>
</span><span id="line-162"></span><span>
</span><span id="line-163"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Utils.Misc.html"><span class="hs-identifier">GHC.Utils.Misc</span></a></span><span>
</span><span id="line-164"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Utils.Outputable.html"><span class="hs-identifier">GHC.Utils.Outputable</span></a></span><span>
</span><span id="line-165"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Utils.Panic.html"><span class="hs-identifier">GHC.Utils.Panic</span></a></span><span>
</span><span id="line-166"></span><span>
</span><span id="line-167"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="../../base-4.21.0.0-ae91/src/Control.Monad.html"><span class="hs-identifier">Control.Monad</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">foldM</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">zipWithM</span></span><span class="hs-special">)</span><span>
</span><span id="line-168"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="../../base-4.21.0.0-ae91/src/Data.Function.html"><span class="hs-identifier">Data.Function</span></a></span><span> </span><span class="hs-special">(</span><span> </span><span class="annot"><span class="hs-identifier">on</span></span><span> </span><span class="hs-special">)</span><span>
</span><span id="line-169"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="../../base-4.21.0.0-ae91/src/Data.Char.html"><span class="hs-identifier">Data.Char</span></a></span><span class="hs-special">(</span><span> </span><span class="annot"><span class="hs-identifier">isDigit</span></span><span> </span><span class="hs-special">)</span><span>
</span><span id="line-170"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><a href="../../base-4.21.0.0-ae91/src/Data.Monoid.html"><span class="hs-identifier">Data.Monoid</span></a></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">Monoid</span></span><span>
</span><span id="line-171"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="../../deepseq-1.5.1.0-6837/src/Control.DeepSeq.html"><span class="hs-identifier">Control.DeepSeq</span></a></span><span>
</span><span id="line-172"></span><span>
</span><span id="line-173"></span><span class="hs-comment">{-
%************************************************************************
%*                                                                      *
     -- The coercion arguments always *precisely* saturate
     -- arity of (that branch of) the CoAxiom.  If there are
     -- any left over, we use AppCo.  See
     -- See [Coercion axioms applied to coercions] in GHC.Core.TyCo.Rep

\subsection{Coercion variables}
%*                                                                      *
%************************************************************************
-}</span><span>
</span><span id="line-185"></span><span>
</span><span id="line-186"></span><span class="annot"><a href="GHC.Core.Coercion.html#coVarName"><span class="hs-identifier hs-type">coVarName</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Types.Var.html#CoVar"><span class="hs-identifier hs-type">CoVar</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Types.Name.html#Name"><span class="hs-identifier hs-type">Name</span></a></span><span>
</span><span id="line-187"></span><span id="coVarName"><span class="annot"><span class="annottext">coVarName :: CoVar -&gt; Name
</span><a href="GHC.Core.Coercion.html#coVarName"><span class="hs-identifier hs-var hs-var">coVarName</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">CoVar -&gt; Name
</span><a href="GHC.Types.Var.html#varName"><span class="hs-identifier hs-var">varName</span></a></span><span>
</span><span id="line-188"></span><span>
</span><span id="line-189"></span><span class="annot"><a href="GHC.Core.Coercion.html#setCoVarUnique"><span class="hs-identifier hs-type">setCoVarUnique</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Types.Var.html#CoVar"><span class="hs-identifier hs-type">CoVar</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Types.Unique.html#Unique"><span class="hs-identifier hs-type">Unique</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Types.Var.html#CoVar"><span class="hs-identifier hs-type">CoVar</span></a></span><span>
</span><span id="line-190"></span><span id="setCoVarUnique"><span class="annot"><span class="annottext">setCoVarUnique :: CoVar -&gt; Unique -&gt; CoVar
</span><a href="GHC.Core.Coercion.html#setCoVarUnique"><span class="hs-identifier hs-var hs-var">setCoVarUnique</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">CoVar -&gt; Unique -&gt; CoVar
</span><a href="GHC.Types.Var.html#setVarUnique"><span class="hs-identifier hs-var">setVarUnique</span></a></span><span>
</span><span id="line-191"></span><span>
</span><span id="line-192"></span><span class="annot"><a href="GHC.Core.Coercion.html#setCoVarName"><span class="hs-identifier hs-type">setCoVarName</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Types.Var.html#CoVar"><span class="hs-identifier hs-type">CoVar</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Types.Name.html#Name"><span class="hs-identifier hs-type">Name</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Types.Var.html#CoVar"><span class="hs-identifier hs-type">CoVar</span></a></span><span>
</span><span id="line-193"></span><span id="setCoVarName"><span class="annot"><span class="annottext">setCoVarName :: CoVar -&gt; Name -&gt; CoVar
</span><a href="GHC.Core.Coercion.html#setCoVarName"><span class="hs-identifier hs-var hs-var">setCoVarName</span></a></span></span><span>   </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">CoVar -&gt; Name -&gt; CoVar
</span><a href="GHC.Types.Var.html#setVarName"><span class="hs-identifier hs-var">setVarName</span></a></span><span>
</span><span id="line-194"></span><span>
</span><span id="line-195"></span><span class="hs-comment">{-
%************************************************************************
%*                                                                      *
                   Pretty-printing CoAxioms
%*                                                                      *
%************************************************************************

Defined here to avoid module loops. CoAxiom is loaded very early on.

-}</span><span>
</span><span id="line-205"></span><span>
</span><span id="line-206"></span><span class="annot"><a href="GHC.Core.Coercion.html#etaExpandCoAxBranch"><span class="hs-identifier hs-type">etaExpandCoAxBranch</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Core.Coercion.Axiom.html#CoAxBranch"><span class="hs-identifier hs-type">CoAxBranch</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="hs-special">[</span><span class="annot"><a href="GHC.Types.Var.html#TyVar"><span class="hs-identifier hs-type">TyVar</span></a></span><span class="hs-special">]</span><span class="hs-special">,</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#Type"><span class="hs-identifier hs-type">Type</span></a></span><span class="hs-special">]</span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#Type"><span class="hs-identifier hs-type">Type</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-207"></span><span class="hs-comment">-- Return the (tvs,lhs,rhs) after eta-expanding,</span><span>
</span><span id="line-208"></span><span class="hs-comment">-- to the way in which the axiom was originally written</span><span>
</span><span id="line-209"></span><span class="hs-comment">-- See Note [Eta reduction for data families] in GHC.Core.Coercion.Axiom</span><span>
</span><span id="line-210"></span><span id="etaExpandCoAxBranch"><span class="annot"><span class="annottext">etaExpandCoAxBranch :: CoAxBranch -&gt; ([CoVar], [Type], Type)
</span><a href="GHC.Core.Coercion.html#etaExpandCoAxBranch"><span class="hs-identifier hs-var hs-var">etaExpandCoAxBranch</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Core.Coercion.Axiom.html#CoAxBranch"><span class="hs-identifier hs-type">CoAxBranch</span></a></span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">cab_tvs :: CoAxBranch -&gt; [CoVar]
</span><a href="GHC.Core.Coercion.Axiom.html#cab_tvs"><span class="hs-identifier hs-var">cab_tvs</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="local-6989586621682577836"><span class="annot"><span class="annottext">[CoVar]
</span><a href="#local-6989586621682577836"><span class="hs-identifier hs-var">tvs</span></a></span></span><span>
</span><span id="line-211"></span><span>                                </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">cab_eta_tvs :: CoAxBranch -&gt; [CoVar]
</span><a href="GHC.Core.Coercion.Axiom.html#cab_eta_tvs"><span class="hs-identifier hs-var">cab_eta_tvs</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="local-6989586621682577838"><span class="annot"><span class="annottext">[CoVar]
</span><a href="#local-6989586621682577838"><span class="hs-identifier hs-var">eta_tvs</span></a></span></span><span>
</span><span id="line-212"></span><span>                                </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">cab_lhs :: CoAxBranch -&gt; [Type]
</span><a href="GHC.Core.Coercion.Axiom.html#cab_lhs"><span class="hs-identifier hs-var">cab_lhs</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="local-6989586621682577840"><span class="annot"><span class="annottext">[Type]
</span><a href="#local-6989586621682577840"><span class="hs-identifier hs-var">lhs</span></a></span></span><span>
</span><span id="line-213"></span><span>                                </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">cab_rhs :: CoAxBranch -&gt; Type
</span><a href="GHC.Core.Coercion.Axiom.html#cab_rhs"><span class="hs-identifier hs-var">cab_rhs</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="local-6989586621682577842"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682577842"><span class="hs-identifier hs-var">rhs</span></a></span></span><span> </span><span class="hs-special">}</span><span class="hs-special">)</span><span>
</span><span id="line-214"></span><span>  </span><span class="hs-comment">-- ToDo: what about eta_cvs?</span><span>
</span><span id="line-215"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[CoVar]
</span><a href="#local-6989586621682577836"><span class="hs-identifier hs-var">tvs</span></a></span><span> </span><span class="annot"><span class="annottext">[CoVar] -&gt; [CoVar] -&gt; [CoVar]
forall a. [a] -&gt; [a] -&gt; [a]
</span><span class="hs-operator hs-var">++</span></span><span> </span><span class="annot"><span class="annottext">[CoVar]
</span><a href="#local-6989586621682577838"><span class="hs-identifier hs-var">eta_tvs</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">[Type]
</span><a href="#local-6989586621682577840"><span class="hs-identifier hs-var">lhs</span></a></span><span> </span><span class="annot"><span class="annottext">[Type] -&gt; [Type] -&gt; [Type]
forall a. [a] -&gt; [a] -&gt; [a]
</span><span class="hs-operator hs-var">++</span></span><span> </span><span class="annot"><span class="annottext">[Type]
</span><a href="#local-6989586621682577843"><span class="hs-identifier hs-var">eta_tys</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Type -&gt; [Type] -&gt; Type
</span><a href="GHC.Core.Type.html#mkAppTys"><span class="hs-identifier hs-var">mkAppTys</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682577842"><span class="hs-identifier hs-var">rhs</span></a></span><span> </span><span class="annot"><span class="annottext">[Type]
</span><a href="#local-6989586621682577843"><span class="hs-identifier hs-var">eta_tys</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-216"></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-217"></span><span>    </span><span id="local-6989586621682577843"><span class="annot"><span class="annottext">eta_tys :: [Type]
</span><a href="#local-6989586621682577843"><span class="hs-identifier hs-var hs-var">eta_tys</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[CoVar] -&gt; [Type]
</span><a href="GHC.Core.TyCo.Rep.html#mkTyVarTys"><span class="hs-identifier hs-var">mkTyVarTys</span></a></span><span> </span><span class="annot"><span class="annottext">[CoVar]
</span><a href="#local-6989586621682577838"><span class="hs-identifier hs-var">eta_tvs</span></a></span><span>
</span><span id="line-218"></span><span>
</span><span id="line-219"></span><span id="local-6989586621682577203"><span class="annot"><a href="GHC.Core.Coercion.html#pprCoAxiom"><span class="hs-identifier hs-type">pprCoAxiom</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Core.Coercion.Axiom.html#CoAxiom"><span class="hs-identifier hs-type">CoAxiom</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682577203"><span class="hs-identifier hs-type">br</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Utils.Outputable.html#SDoc"><span class="hs-identifier hs-type">SDoc</span></a></span></span><span>
</span><span id="line-220"></span><span class="hs-comment">-- Used in debug-printing only</span><span>
</span><span id="line-221"></span><span id="pprCoAxiom"><span class="annot"><span class="annottext">pprCoAxiom :: forall (br :: BranchFlag). CoAxiom br -&gt; SDoc
</span><a href="GHC.Core.Coercion.html#pprCoAxiom"><span class="hs-identifier hs-var hs-var">pprCoAxiom</span></a></span></span><span> </span><span id="local-6989586621682577852"><span class="annot"><span class="annottext">ax :: CoAxiom br
</span><a href="#local-6989586621682577852"><span class="hs-identifier hs-var">ax</span></a></span></span><span class="hs-glyph">@</span><span class="hs-special">(</span><span class="annot"><a href="GHC.Core.Coercion.Axiom.html#CoAxiom"><span class="hs-identifier hs-type">CoAxiom</span></a></span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">co_ax_tc :: forall (br :: BranchFlag). CoAxiom br -&gt; TyCon
</span><a href="GHC.Core.Coercion.Axiom.html#co_ax_tc"><span class="hs-identifier hs-var">co_ax_tc</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="local-6989586621682577855"><span class="annot"><span class="annottext">TyCon
</span><a href="#local-6989586621682577855"><span class="hs-identifier hs-var">tc</span></a></span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">co_ax_branches :: forall (br :: BranchFlag). CoAxiom br -&gt; Branches br
</span><a href="GHC.Core.Coercion.Axiom.html#co_ax_branches"><span class="hs-identifier hs-var">co_ax_branches</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="local-6989586621682577857"><span class="annot"><span class="annottext">Branches br
</span><a href="#local-6989586621682577857"><span class="hs-identifier hs-var">branches</span></a></span></span><span> </span><span class="hs-special">}</span><span class="hs-special">)</span><span>
</span><span id="line-222"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">SDoc -&gt; Arity -&gt; SDoc -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#hang"><span class="hs-identifier hs-var">hang</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">String -&gt; SDoc
forall doc. IsLine doc =&gt; String -&gt; doc
</span><a href="GHC.Utils.Outputable.html#text"><span class="hs-identifier hs-var">text</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;axiom&quot;</span></span><span> </span><span class="annot"><span class="annottext">SDoc -&gt; SDoc -&gt; SDoc
forall doc. IsLine doc =&gt; doc -&gt; doc -&gt; doc
</span><a href="GHC.Utils.Outputable.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">CoAxiom br -&gt; SDoc
forall a. Outputable a =&gt; a -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="annot"><span class="annottext">CoAxiom br
</span><a href="#local-6989586621682577852"><span class="hs-identifier hs-var">ax</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-223"></span><span>       </span><span class="annot"><span class="annottext">Arity
</span><span class="hs-number">2</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">SDoc -&gt; SDoc
forall doc. IsLine doc =&gt; doc -&gt; doc
</span><a href="GHC.Utils.Outputable.html#braces"><span class="hs-identifier hs-var">braces</span></a></span><span> </span><span class="annot"><span class="annottext">(SDoc -&gt; SDoc) -&gt; SDoc -&gt; SDoc
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">[SDoc] -&gt; SDoc
forall doc. IsDoc doc =&gt; [doc] -&gt; doc
</span><a href="GHC.Utils.Outputable.html#vcat"><span class="hs-identifier hs-var">vcat</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(CoAxBranch -&gt; SDoc) -&gt; [CoAxBranch] -&gt; [SDoc]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><span class="hs-identifier hs-var">map</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TyCon -&gt; CoAxBranch -&gt; SDoc
</span><a href="GHC.Core.Coercion.html#pprCoAxBranchUser"><span class="hs-identifier hs-var">pprCoAxBranchUser</span></a></span><span> </span><span class="annot"><span class="annottext">TyCon
</span><a href="#local-6989586621682577855"><span class="hs-identifier hs-var">tc</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Branches br -&gt; [CoAxBranch]
forall (br :: BranchFlag). Branches br -&gt; [CoAxBranch]
</span><a href="GHC.Core.Coercion.Axiom.html#fromBranches"><span class="hs-identifier hs-var">fromBranches</span></a></span><span> </span><span class="annot"><span class="annottext">Branches br
</span><a href="#local-6989586621682577857"><span class="hs-identifier hs-var">branches</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-224"></span><span>
</span><span id="line-225"></span><span class="annot"><a href="GHC.Core.Coercion.html#pprCoAxBranchUser"><span class="hs-identifier hs-type">pprCoAxBranchUser</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Core.TyCon.html#TyCon"><span class="hs-identifier hs-type">TyCon</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Core.Coercion.Axiom.html#CoAxBranch"><span class="hs-identifier hs-type">CoAxBranch</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Utils.Outputable.html#SDoc"><span class="hs-identifier hs-type">SDoc</span></a></span><span>
</span><span id="line-226"></span><span class="hs-comment">-- Used when printing injectivity errors (FamInst.reportInjectivityErrors)</span><span>
</span><span id="line-227"></span><span class="hs-comment">-- and inaccessible branches (GHC.Tc.Validity.inaccessibleCoAxBranch)</span><span>
</span><span id="line-228"></span><span class="hs-comment">-- This happens in error messages: don't print the RHS of a data</span><span>
</span><span id="line-229"></span><span class="hs-comment">--   family axiom, which is meaningless to a user</span><span>
</span><span id="line-230"></span><span id="pprCoAxBranchUser"><span class="annot"><span class="annottext">pprCoAxBranchUser :: TyCon -&gt; CoAxBranch -&gt; SDoc
</span><a href="GHC.Core.Coercion.html#pprCoAxBranchUser"><span class="hs-identifier hs-var hs-var">pprCoAxBranchUser</span></a></span></span><span> </span><span id="local-6989586621682577865"><span class="annot"><span class="annottext">TyCon
</span><a href="#local-6989586621682577865"><span class="hs-identifier hs-var">tc</span></a></span></span><span> </span><span id="local-6989586621682577866"><span class="annot"><span class="annottext">CoAxBranch
</span><a href="#local-6989586621682577866"><span class="hs-identifier hs-var">br</span></a></span></span><span>
</span><span id="line-231"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">TyCon -&gt; Bool
</span><a href="GHC.Core.TyCon.html#isDataFamilyTyCon"><span class="hs-identifier hs-var">isDataFamilyTyCon</span></a></span><span> </span><span class="annot"><span class="annottext">TyCon
</span><a href="#local-6989586621682577865"><span class="hs-identifier hs-var">tc</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">TyCon -&gt; CoAxBranch -&gt; SDoc
</span><a href="GHC.Core.Coercion.html#pprCoAxBranchLHS"><span class="hs-identifier hs-var">pprCoAxBranchLHS</span></a></span><span> </span><span class="annot"><span class="annottext">TyCon
</span><a href="#local-6989586621682577865"><span class="hs-identifier hs-var">tc</span></a></span><span> </span><span class="annot"><span class="annottext">CoAxBranch
</span><a href="#local-6989586621682577866"><span class="hs-identifier hs-var">br</span></a></span><span>
</span><span id="line-232"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">otherwise</span></span><span>            </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">TyCon -&gt; CoAxBranch -&gt; SDoc
</span><a href="GHC.Core.Coercion.html#pprCoAxBranch"><span class="hs-identifier hs-var">pprCoAxBranch</span></a></span><span>    </span><span class="annot"><span class="annottext">TyCon
</span><a href="#local-6989586621682577865"><span class="hs-identifier hs-var">tc</span></a></span><span> </span><span class="annot"><span class="annottext">CoAxBranch
</span><a href="#local-6989586621682577866"><span class="hs-identifier hs-var">br</span></a></span><span>
</span><span id="line-233"></span><span>
</span><span id="line-234"></span><span class="annot"><a href="GHC.Core.Coercion.html#pprCoAxBranchLHS"><span class="hs-identifier hs-type">pprCoAxBranchLHS</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Core.TyCon.html#TyCon"><span class="hs-identifier hs-type">TyCon</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Core.Coercion.Axiom.html#CoAxBranch"><span class="hs-identifier hs-type">CoAxBranch</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Utils.Outputable.html#SDoc"><span class="hs-identifier hs-type">SDoc</span></a></span><span>
</span><span id="line-235"></span><span class="hs-comment">-- Print the family-instance equation when reporting</span><span>
</span><span id="line-236"></span><span class="hs-comment">--   a conflict between equations (FamInst.conflictInstErr)</span><span>
</span><span id="line-237"></span><span class="hs-comment">-- For type families the RHS is important; for data families not so.</span><span>
</span><span id="line-238"></span><span class="hs-comment">--   Indeed for data families the RHS is a mysterious internal</span><span>
</span><span id="line-239"></span><span class="hs-comment">--   type constructor, so we suppress it (#14179)</span><span>
</span><span id="line-240"></span><span class="hs-comment">-- See FamInstEnv Note [Family instance overlap conflicts]</span><span>
</span><span id="line-241"></span><span id="pprCoAxBranchLHS"><span class="annot"><span class="annottext">pprCoAxBranchLHS :: TyCon -&gt; CoAxBranch -&gt; SDoc
</span><a href="GHC.Core.Coercion.html#pprCoAxBranchLHS"><span class="hs-identifier hs-var hs-var">pprCoAxBranchLHS</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(TidyEnv -&gt; Type -&gt; SDoc) -&gt; TyCon -&gt; CoAxBranch -&gt; SDoc
</span><a href="GHC.Core.Coercion.html#ppr_co_ax_branch"><span class="hs-identifier hs-var">ppr_co_ax_branch</span></a></span><span> </span><span class="annot"><span class="annottext">TidyEnv -&gt; Type -&gt; SDoc
forall {doc} {p} {p}. IsOutput doc =&gt; p -&gt; p -&gt; doc
</span><a href="#local-6989586621682577869"><span class="hs-identifier hs-var">pp_rhs</span></a></span><span>
</span><span id="line-242"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-243"></span><span>    </span><span id="local-6989586621682577869"><span class="annot"><span class="annottext">pp_rhs :: p -&gt; p -&gt; doc
</span><a href="#local-6989586621682577869"><span class="hs-identifier hs-var hs-var">pp_rhs</span></a></span></span><span> </span><span class="annot"><span class="annottext">p
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">p
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">doc
forall doc. IsOutput doc =&gt; doc
</span><a href="GHC.Utils.Outputable.html#empty"><span class="hs-identifier hs-var">empty</span></a></span><span>
</span><span id="line-244"></span><span>
</span><span id="line-245"></span><span class="annot"><a href="GHC.Core.Coercion.html#pprCoAxBranch"><span class="hs-identifier hs-type">pprCoAxBranch</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Core.TyCon.html#TyCon"><span class="hs-identifier hs-type">TyCon</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Core.Coercion.Axiom.html#CoAxBranch"><span class="hs-identifier hs-type">CoAxBranch</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Utils.Outputable.html#SDoc"><span class="hs-identifier hs-type">SDoc</span></a></span><span>
</span><span id="line-246"></span><span id="pprCoAxBranch"><span class="annot"><span class="annottext">pprCoAxBranch :: TyCon -&gt; CoAxBranch -&gt; SDoc
</span><a href="GHC.Core.Coercion.html#pprCoAxBranch"><span class="hs-identifier hs-var hs-var">pprCoAxBranch</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(TidyEnv -&gt; Type -&gt; SDoc) -&gt; TyCon -&gt; CoAxBranch -&gt; SDoc
</span><a href="GHC.Core.Coercion.html#ppr_co_ax_branch"><span class="hs-identifier hs-var">ppr_co_ax_branch</span></a></span><span> </span><span class="annot"><span class="annottext">TidyEnv -&gt; Type -&gt; SDoc
</span><a href="#local-6989586621682577873"><span class="hs-identifier hs-var">ppr_rhs</span></a></span><span>
</span><span id="line-247"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-248"></span><span>    </span><span id="local-6989586621682577873"><span class="annot"><span class="annottext">ppr_rhs :: TidyEnv -&gt; Type -&gt; SDoc
</span><a href="#local-6989586621682577873"><span class="hs-identifier hs-var hs-var">ppr_rhs</span></a></span></span><span> </span><span id="local-6989586621682577876"><span class="annot"><span class="annottext">TidyEnv
</span><a href="#local-6989586621682577876"><span class="hs-identifier hs-var">env</span></a></span></span><span> </span><span id="local-6989586621682577877"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682577877"><span class="hs-identifier hs-var">rhs</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">SDoc
forall doc. IsLine doc =&gt; doc
</span><a href="GHC.Utils.Outputable.html#equals"><span class="hs-identifier hs-var">equals</span></a></span><span> </span><span class="annot"><span class="annottext">SDoc -&gt; SDoc -&gt; SDoc
forall doc. IsLine doc =&gt; doc -&gt; doc -&gt; doc
</span><a href="GHC.Utils.Outputable.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">TidyEnv -&gt; PprPrec -&gt; Type -&gt; SDoc
</span><a href="GHC.Core.TyCo.Ppr.html#pprPrecTypeX"><span class="hs-identifier hs-var">pprPrecTypeX</span></a></span><span> </span><span class="annot"><span class="annottext">TidyEnv
</span><a href="#local-6989586621682577876"><span class="hs-identifier hs-var">env</span></a></span><span> </span><span class="annot"><span class="annottext">PprPrec
</span><a href="GHC.Types.Basic.html#topPrec"><span class="hs-identifier hs-var">topPrec</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682577877"><span class="hs-identifier hs-var">rhs</span></a></span><span>
</span><span id="line-249"></span><span>
</span><span id="line-250"></span><span class="annot"><a href="GHC.Core.Coercion.html#ppr_co_ax_branch"><span class="hs-identifier hs-type">ppr_co_ax_branch</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Types.Var.Env.html#TidyEnv"><span class="hs-identifier hs-type">TidyEnv</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#Type"><span class="hs-identifier hs-type">Type</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Utils.Outputable.html#SDoc"><span class="hs-identifier hs-type">SDoc</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-251"></span><span>                 </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Core.TyCon.html#TyCon"><span class="hs-identifier hs-type">TyCon</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Core.Coercion.Axiom.html#CoAxBranch"><span class="hs-identifier hs-type">CoAxBranch</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Utils.Outputable.html#SDoc"><span class="hs-identifier hs-type">SDoc</span></a></span><span>
</span><span id="line-252"></span><span id="ppr_co_ax_branch"><span class="annot"><span class="annottext">ppr_co_ax_branch :: (TidyEnv -&gt; Type -&gt; SDoc) -&gt; TyCon -&gt; CoAxBranch -&gt; SDoc
</span><a href="GHC.Core.Coercion.html#ppr_co_ax_branch"><span class="hs-identifier hs-var hs-var">ppr_co_ax_branch</span></a></span></span><span> </span><span id="local-6989586621682577881"><span class="annot"><span class="annottext">TidyEnv -&gt; Type -&gt; SDoc
</span><a href="#local-6989586621682577881"><span class="hs-identifier hs-var">ppr_rhs</span></a></span></span><span> </span><span id="local-6989586621682577882"><span class="annot"><span class="annottext">TyCon
</span><a href="#local-6989586621682577882"><span class="hs-identifier hs-var">fam_tc</span></a></span></span><span> </span><span id="local-6989586621682577883"><span class="annot"><span class="annottext">CoAxBranch
</span><a href="#local-6989586621682577883"><span class="hs-identifier hs-var">branch</span></a></span></span><span>
</span><span id="line-253"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(SDoc -&gt; SDoc -&gt; SDoc) -&gt; [SDoc] -&gt; SDoc
forall a. (a -&gt; a -&gt; a) -&gt; [a] -&gt; a
forall (t :: * -&gt; *) a. Foldable t =&gt; (a -&gt; a -&gt; a) -&gt; t a -&gt; a
</span><span class="hs-identifier hs-var">foldr1</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(SDoc -&gt; Arity -&gt; SDoc -&gt; SDoc) -&gt; Arity -&gt; SDoc -&gt; SDoc -&gt; SDoc
forall a b c. (a -&gt; b -&gt; c) -&gt; b -&gt; a -&gt; c
</span><span class="hs-identifier hs-var">flip</span></span><span> </span><span class="annot"><span class="annottext">SDoc -&gt; Arity -&gt; SDoc -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#hangNotEmpty"><span class="hs-identifier hs-var">hangNotEmpty</span></a></span><span> </span><span class="annot"><span class="annottext">Arity
</span><span class="hs-number">2</span></span><span class="hs-special">)</span><span>
</span><span id="line-254"></span><span>    </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">[ForAllTyBinder] -&gt; SDoc
</span><a href="GHC.Core.TyCo.Ppr.html#pprUserForAll"><span class="hs-identifier hs-var">pprUserForAll</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ForAllTyFlag -&gt; [CoVar] -&gt; [ForAllTyBinder]
forall vis. vis -&gt; [CoVar] -&gt; [VarBndr CoVar vis]
</span><a href="GHC.Types.Var.html#mkForAllTyBinders"><span class="hs-identifier hs-var">mkForAllTyBinders</span></a></span><span> </span><span class="annot"><span class="annottext">ForAllTyFlag
</span><a href="Language.Haskell.Syntax.Specificity.html#Inferred"><span class="hs-identifier hs-var">Inferred</span></a></span><span> </span><span class="annot"><span class="annottext">[CoVar]
</span><a href="#local-6989586621682577890"><span class="hs-identifier hs-var">bndrs'</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-255"></span><span>         </span><span class="hs-comment">-- See Note [Printing foralls in type family instances] in GHC.Iface.Type</span><span>
</span><span id="line-256"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">SDoc
</span><a href="#local-6989586621682577891"><span class="hs-identifier hs-var">pp_lhs</span></a></span><span> </span><span class="annot"><span class="annottext">SDoc -&gt; SDoc -&gt; SDoc
forall doc. IsLine doc =&gt; doc -&gt; doc -&gt; doc
</span><a href="GHC.Utils.Outputable.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">TidyEnv -&gt; Type -&gt; SDoc
</span><a href="#local-6989586621682577881"><span class="hs-identifier hs-var">ppr_rhs</span></a></span><span> </span><span class="annot"><span class="annottext">TidyEnv
</span><a href="#local-6989586621682577892"><span class="hs-identifier hs-var">tidy_env</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682577893"><span class="hs-identifier hs-var">ee_rhs</span></a></span><span>
</span><span id="line-257"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">[SDoc] -&gt; SDoc
forall doc. IsDoc doc =&gt; [doc] -&gt; doc
</span><a href="GHC.Utils.Outputable.html#vcat"><span class="hs-identifier hs-var">vcat</span></a></span><span> </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">String -&gt; SDoc
forall doc. IsLine doc =&gt; String -&gt; doc
</span><a href="GHC.Utils.Outputable.html#text"><span class="hs-identifier hs-var">text</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;-- Defined&quot;</span></span><span> </span><span class="annot"><span class="annottext">SDoc -&gt; SDoc -&gt; SDoc
forall doc. IsLine doc =&gt; doc -&gt; doc -&gt; doc
</span><a href="GHC.Utils.Outputable.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">SDoc
</span><a href="#local-6989586621682577894"><span class="hs-identifier hs-var">pp_loc</span></a></span><span>
</span><span id="line-258"></span><span>           </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Bool -&gt; SDoc -&gt; SDoc
forall doc. IsOutput doc =&gt; Bool -&gt; doc -&gt; doc
</span><a href="GHC.Utils.Outputable.html#ppUnless"><span class="hs-identifier hs-var">ppUnless</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[CoAxBranch] -&gt; Bool
forall a. [a] -&gt; Bool
forall (t :: * -&gt; *) a. Foldable t =&gt; t a -&gt; Bool
</span><span class="hs-identifier hs-var">null</span></span><span> </span><span class="annot"><span class="annottext">[CoAxBranch]
</span><a href="#local-6989586621682577897"><span class="hs-identifier hs-var">incomps</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(SDoc -&gt; SDoc) -&gt; SDoc -&gt; SDoc
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">SDoc -&gt; SDoc
forall doc. IsOutput doc =&gt; doc -&gt; doc
</span><a href="GHC.Utils.Outputable.html#whenPprDebug"><span class="hs-identifier hs-var">whenPprDebug</span></a></span><span> </span><span class="annot"><span class="annottext">(SDoc -&gt; SDoc) -&gt; SDoc -&gt; SDoc
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-259"></span><span>             </span><span class="annot"><span class="annottext">String -&gt; SDoc
forall doc. IsLine doc =&gt; String -&gt; doc
</span><a href="GHC.Utils.Outputable.html#text"><span class="hs-identifier hs-var">text</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;-- Incomps:&quot;</span></span><span> </span><span class="annot"><span class="annottext">SDoc -&gt; SDoc -&gt; SDoc
forall doc. IsLine doc =&gt; doc -&gt; doc -&gt; doc
</span><a href="GHC.Utils.Outputable.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">[SDoc] -&gt; SDoc
forall doc. IsDoc doc =&gt; [doc] -&gt; doc
</span><a href="GHC.Utils.Outputable.html#vcat"><span class="hs-identifier hs-var">vcat</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(CoAxBranch -&gt; SDoc) -&gt; [CoAxBranch] -&gt; [SDoc]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><span class="hs-identifier hs-var">map</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TyCon -&gt; CoAxBranch -&gt; SDoc
</span><a href="GHC.Core.Coercion.html#pprCoAxBranch"><span class="hs-identifier hs-var">pprCoAxBranch</span></a></span><span> </span><span class="annot"><span class="annottext">TyCon
</span><a href="#local-6989586621682577882"><span class="hs-identifier hs-var">fam_tc</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[CoAxBranch]
</span><a href="#local-6989586621682577897"><span class="hs-identifier hs-var">incomps</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">]</span><span>
</span><span id="line-260"></span><span>    </span><span class="hs-special">]</span><span>
</span><span id="line-261"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-262"></span><span>    </span><span id="local-6989586621682577897"><span class="annot"><span class="annottext">incomps :: [CoAxBranch]
</span><a href="#local-6989586621682577897"><span class="hs-identifier hs-var hs-var">incomps</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">CoAxBranch -&gt; [CoAxBranch]
</span><a href="GHC.Core.Coercion.Axiom.html#coAxBranchIncomps"><span class="hs-identifier hs-var">coAxBranchIncomps</span></a></span><span> </span><span class="annot"><span class="annottext">CoAxBranch
</span><a href="#local-6989586621682577883"><span class="hs-identifier hs-var">branch</span></a></span><span>
</span><span id="line-263"></span><span>    </span><span id="local-6989586621682577900"><span class="annot"><span class="annottext">loc :: SrcSpan
</span><a href="#local-6989586621682577900"><span class="hs-identifier hs-var hs-var">loc</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">CoAxBranch -&gt; SrcSpan
</span><a href="GHC.Core.Coercion.Axiom.html#coAxBranchSpan"><span class="hs-identifier hs-var">coAxBranchSpan</span></a></span><span> </span><span class="annot"><span class="annottext">CoAxBranch
</span><a href="#local-6989586621682577883"><span class="hs-identifier hs-var">branch</span></a></span><span>
</span><span id="line-264"></span><span>    </span><span id="local-6989586621682577894"><span class="annot"><span class="annottext">pp_loc :: SDoc
</span><a href="#local-6989586621682577894"><span class="hs-identifier hs-var hs-var">pp_loc</span></a></span></span><span> </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">SrcSpan -&gt; Bool
</span><a href="GHC.Types.SrcLoc.html#isGoodSrcSpan"><span class="hs-identifier hs-var">isGoodSrcSpan</span></a></span><span> </span><span class="annot"><span class="annottext">SrcSpan
</span><a href="#local-6989586621682577900"><span class="hs-identifier hs-var">loc</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">String -&gt; SDoc
forall doc. IsLine doc =&gt; String -&gt; doc
</span><a href="GHC.Utils.Outputable.html#text"><span class="hs-identifier hs-var">text</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;at&quot;</span></span><span> </span><span class="annot"><span class="annottext">SDoc -&gt; SDoc -&gt; SDoc
forall doc. IsLine doc =&gt; doc -&gt; doc -&gt; doc
</span><a href="GHC.Utils.Outputable.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">SrcLoc -&gt; SDoc
forall a. Outputable a =&gt; a -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">SrcSpan -&gt; SrcLoc
</span><a href="GHC.Types.SrcLoc.html#srcSpanStart"><span class="hs-identifier hs-var">srcSpanStart</span></a></span><span> </span><span class="annot"><span class="annottext">SrcSpan
</span><a href="#local-6989586621682577900"><span class="hs-identifier hs-var">loc</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-265"></span><span>           </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">otherwise</span></span><span>         </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">String -&gt; SDoc
forall doc. IsLine doc =&gt; String -&gt; doc
</span><a href="GHC.Utils.Outputable.html#text"><span class="hs-identifier hs-var">text</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;in&quot;</span></span><span> </span><span class="annot"><span class="annottext">SDoc -&gt; SDoc -&gt; SDoc
forall doc. IsLine doc =&gt; doc -&gt; doc -&gt; doc
</span><a href="GHC.Utils.Outputable.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">SrcSpan -&gt; SDoc
forall a. Outputable a =&gt; a -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="annot"><span class="annottext">SrcSpan
</span><a href="#local-6989586621682577900"><span class="hs-identifier hs-var">loc</span></a></span><span>
</span><span id="line-266"></span><span>
</span><span id="line-267"></span><span>    </span><span class="hs-comment">-- Eta-expand LHS and RHS types, because sometimes data family</span><span>
</span><span id="line-268"></span><span>    </span><span class="hs-comment">-- instances are eta-reduced.</span><span>
</span><span id="line-269"></span><span>    </span><span class="hs-comment">-- See Note [Eta reduction for data families] in GHC.Core.Coercion.Axiom.</span><span>
</span><span id="line-270"></span><span>    </span><span class="hs-special">(</span><span id="local-6989586621682577904"><span class="annot"><span class="annottext">[CoVar]
</span><a href="#local-6989586621682577904"><span class="hs-identifier hs-var">ee_tvs</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682577905"><span class="annot"><span class="annottext">[Type]
</span><a href="#local-6989586621682577905"><span class="hs-identifier hs-var">ee_lhs</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682577893"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682577893"><span class="hs-identifier hs-var">ee_rhs</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">CoAxBranch -&gt; ([CoVar], [Type], Type)
</span><a href="GHC.Core.Coercion.html#etaExpandCoAxBranch"><span class="hs-identifier hs-var">etaExpandCoAxBranch</span></a></span><span> </span><span class="annot"><span class="annottext">CoAxBranch
</span><a href="#local-6989586621682577883"><span class="hs-identifier hs-var">branch</span></a></span><span>
</span><span id="line-271"></span><span>
</span><span id="line-272"></span><span>    </span><span id="local-6989586621682577891"><span class="annot"><span class="annottext">pp_lhs :: SDoc
</span><a href="#local-6989586621682577891"><span class="hs-identifier hs-var hs-var">pp_lhs</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">PprPrec -&gt; IfaceTyCon -&gt; IfaceAppArgs -&gt; SDoc
</span><a href="GHC.Iface.Type.html#pprIfaceTypeApp"><span class="hs-identifier hs-var">pprIfaceTypeApp</span></a></span><span> </span><span class="annot"><span class="annottext">PprPrec
</span><a href="GHC.Types.Basic.html#topPrec"><span class="hs-identifier hs-var">topPrec</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TyCon -&gt; IfaceTyCon
</span><a href="GHC.CoreToIface.html#toIfaceTyCon"><span class="hs-identifier hs-var">toIfaceTyCon</span></a></span><span> </span><span class="annot"><span class="annottext">TyCon
</span><a href="#local-6989586621682577882"><span class="hs-identifier hs-var">fam_tc</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-273"></span><span>                             </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TidyEnv -&gt; TyCon -&gt; [Type] -&gt; IfaceAppArgs
</span><a href="GHC.CoreToIface.html#tidyToIfaceTcArgs"><span class="hs-identifier hs-var">tidyToIfaceTcArgs</span></a></span><span> </span><span class="annot"><span class="annottext">TidyEnv
</span><a href="#local-6989586621682577892"><span class="hs-identifier hs-var">tidy_env</span></a></span><span> </span><span class="annot"><span class="annottext">TyCon
</span><a href="#local-6989586621682577882"><span class="hs-identifier hs-var">fam_tc</span></a></span><span> </span><span class="annot"><span class="annottext">[Type]
</span><a href="#local-6989586621682577905"><span class="hs-identifier hs-var">ee_lhs</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-274"></span><span>
</span><span id="line-275"></span><span>    </span><span class="hs-special">(</span><span id="local-6989586621682577892"><span class="annot"><span class="annottext">TidyEnv
</span><a href="#local-6989586621682577892"><span class="hs-identifier hs-var">tidy_env</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682577890"><span class="annot"><span class="annottext">[CoVar]
</span><a href="#local-6989586621682577890"><span class="hs-identifier hs-var">bndrs'</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">TidyEnv -&gt; [CoVar] -&gt; (TidyEnv, [CoVar])
</span><a href="GHC.Core.Coercion.html#tidyCoAxBndrsForUser"><span class="hs-identifier hs-var">tidyCoAxBndrsForUser</span></a></span><span> </span><span class="annot"><span class="annottext">TidyEnv
</span><a href="GHC.Types.Var.Env.html#emptyTidyEnv"><span class="hs-identifier hs-var">emptyTidyEnv</span></a></span><span> </span><span class="annot"><span class="annottext">[CoVar]
</span><a href="#local-6989586621682577904"><span class="hs-identifier hs-var">ee_tvs</span></a></span><span>
</span><span id="line-276"></span><span>
</span><span id="line-277"></span><span class="annot"><a href="GHC.Core.Coercion.html#tidyCoAxBndrsForUser"><span class="hs-identifier hs-type">tidyCoAxBndrsForUser</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Types.Var.Env.html#TidyEnv"><span class="hs-identifier hs-type">TidyEnv</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="GHC.Types.Var.html#Var"><span class="hs-identifier hs-type">Var</span></a></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Types.Var.Env.html#TidyEnv"><span class="hs-identifier hs-type">TidyEnv</span></a></span><span class="hs-special">,</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="GHC.Types.Var.html#Var"><span class="hs-identifier hs-type">Var</span></a></span><span class="hs-special">]</span><span class="hs-special">)</span><span>
</span><span id="line-278"></span><span class="hs-comment">-- Tidy wildcards &quot;_1&quot;, &quot;_2&quot; to &quot;_&quot;, and do not return them</span><span>
</span><span id="line-279"></span><span class="hs-comment">-- in the list of binders to be printed</span><span>
</span><span id="line-280"></span><span class="hs-comment">-- This is so that in error messages we see</span><span>
</span><span id="line-281"></span><span class="hs-comment">--     forall a. F _ [a] _ = ...</span><span>
</span><span id="line-282"></span><span class="hs-comment">-- rather than</span><span>
</span><span id="line-283"></span><span class="hs-comment">--     forall a _1 _2. F _1 [a] _2 = ...</span><span>
</span><span id="line-284"></span><span class="hs-comment">--</span><span>
</span><span id="line-285"></span><span class="hs-comment">-- This is a rather disgusting function</span><span>
</span><span id="line-286"></span><span class="hs-comment">-- See Note [Wildcard names] in GHC.Tc.Gen.HsType</span><span>
</span><span id="line-287"></span><span id="tidyCoAxBndrsForUser"><span class="annot"><span class="annottext">tidyCoAxBndrsForUser :: TidyEnv -&gt; [CoVar] -&gt; (TidyEnv, [CoVar])
</span><a href="GHC.Core.Coercion.html#tidyCoAxBndrsForUser"><span class="hs-identifier hs-var hs-var">tidyCoAxBndrsForUser</span></a></span></span><span> </span><span id="local-6989586621682577908"><span class="annot"><span class="annottext">TidyEnv
</span><a href="#local-6989586621682577908"><span class="hs-identifier hs-var">init_env</span></a></span></span><span> </span><span id="local-6989586621682577909"><span class="annot"><span class="annottext">[CoVar]
</span><a href="#local-6989586621682577909"><span class="hs-identifier hs-var">tcvs</span></a></span></span><span>
</span><span id="line-288"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TidyEnv
</span><a href="#local-6989586621682577910"><span class="hs-identifier hs-var">tidy_env</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">[CoVar] -&gt; [CoVar]
forall a. [a] -&gt; [a]
</span><span class="hs-identifier hs-var">reverse</span></span><span> </span><span class="annot"><span class="annottext">[CoVar]
</span><a href="#local-6989586621682577912"><span class="hs-identifier hs-var">tidy_bndrs</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-289"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-290"></span><span>    </span><span class="hs-special">(</span><span id="local-6989586621682577910"><span class="annot"><span class="annottext">TidyEnv
</span><a href="#local-6989586621682577910"><span class="hs-identifier hs-var">tidy_env</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682577912"><span class="annot"><span class="annottext">[CoVar]
</span><a href="#local-6989586621682577912"><span class="hs-identifier hs-var">tidy_bndrs</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">((TidyEnv, [CoVar]) -&gt; CoVar -&gt; (TidyEnv, [CoVar]))
-&gt; (TidyEnv, [CoVar]) -&gt; [CoVar] -&gt; (TidyEnv, [CoVar])
forall b a. (b -&gt; a -&gt; b) -&gt; b -&gt; [a] -&gt; b
forall (t :: * -&gt; *) b a.
Foldable t =&gt;
(b -&gt; a -&gt; b) -&gt; b -&gt; t a -&gt; b
</span><span class="hs-identifier hs-var">foldl</span></span><span> </span><span class="annot"><span class="annottext">(TidyEnv, [CoVar]) -&gt; CoVar -&gt; (TidyEnv, [CoVar])
</span><a href="#local-6989586621682577914"><span class="hs-identifier hs-var">tidy_one</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TidyEnv
</span><a href="#local-6989586621682577908"><span class="hs-identifier hs-var">init_env</span></a></span><span class="hs-special">,</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[CoVar]
</span><a href="#local-6989586621682577909"><span class="hs-identifier hs-var">tcvs</span></a></span><span>
</span><span id="line-291"></span><span>
</span><span id="line-292"></span><span>    </span><span id="local-6989586621682577914"><span class="annot"><span class="annottext">tidy_one :: (TidyEnv, [CoVar]) -&gt; CoVar -&gt; (TidyEnv, [CoVar])
</span><a href="#local-6989586621682577914"><span class="hs-identifier hs-var hs-var">tidy_one</span></a></span></span><span> </span><span class="hs-special">(</span><span id="local-6989586621682577915"><span class="annot"><span class="annottext">env :: TidyEnv
</span><a href="#local-6989586621682577915"><span class="hs-identifier hs-var">env</span></a></span></span><span class="hs-glyph">@</span><span class="hs-special">(</span><span id="local-6989586621682577916"><span class="annot"><span class="annottext">TidyOccEnv
</span><a href="#local-6989586621682577916"><span class="hs-identifier hs-var">occ_env</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682577917"><span class="annot"><span class="annottext">VarEnv CoVar
</span><a href="#local-6989586621682577917"><span class="hs-identifier hs-var">subst</span></a></span></span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span id="local-6989586621682577918"><span class="annot"><span class="annottext">[CoVar]
</span><a href="#local-6989586621682577918"><span class="hs-identifier hs-var">rev_bndrs'</span></a></span></span><span class="hs-special">)</span><span> </span><span id="local-6989586621682577919"><span class="annot"><span class="annottext">CoVar
</span><a href="#local-6989586621682577919"><span class="hs-identifier hs-var">bndr</span></a></span></span><span>
</span><span id="line-293"></span><span>      </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">CoVar -&gt; Bool
</span><a href="#local-6989586621682577920"><span class="hs-identifier hs-var">is_wildcard</span></a></span><span> </span><span class="annot"><span class="annottext">CoVar
</span><a href="#local-6989586621682577919"><span class="hs-identifier hs-var">bndr</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TidyEnv
</span><a href="#local-6989586621682577921"><span class="hs-identifier hs-var">env_wild</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">[CoVar]
</span><a href="#local-6989586621682577918"><span class="hs-identifier hs-var">rev_bndrs'</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-294"></span><span>      </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">otherwise</span></span><span>        </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TidyEnv
</span><a href="#local-6989586621682577922"><span class="hs-identifier hs-var">env'</span></a></span><span class="hs-special">,</span><span>     </span><span class="annot"><span class="annottext">CoVar
</span><a href="#local-6989586621682577923"><span class="hs-identifier hs-var">bndr'</span></a></span><span> </span><span class="annot"><span class="annottext">CoVar -&gt; [CoVar] -&gt; [CoVar]
forall a. a -&gt; [a] -&gt; [a]
</span><span class="hs-glyph hs-var">:</span></span><span> </span><span class="annot"><span class="annottext">[CoVar]
</span><a href="#local-6989586621682577918"><span class="hs-identifier hs-var">rev_bndrs'</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-295"></span><span>      </span><span class="hs-keyword">where</span><span>
</span><span id="line-296"></span><span>        </span><span class="hs-special">(</span><span id="local-6989586621682577922"><span class="annot"><span class="annottext">TidyEnv
</span><a href="#local-6989586621682577922"><span class="hs-identifier hs-var">env'</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682577923"><span class="annot"><span class="annottext">CoVar
</span><a href="#local-6989586621682577923"><span class="hs-identifier hs-var">bndr'</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">TidyEnv -&gt; CoVar -&gt; (TidyEnv, CoVar)
</span><a href="GHC.Core.TyCo.Tidy.html#tidyVarBndr"><span class="hs-identifier hs-var">tidyVarBndr</span></a></span><span> </span><span class="annot"><span class="annottext">TidyEnv
</span><a href="#local-6989586621682577915"><span class="hs-identifier hs-var">env</span></a></span><span> </span><span class="annot"><span class="annottext">CoVar
</span><a href="#local-6989586621682577919"><span class="hs-identifier hs-var">bndr</span></a></span><span>
</span><span id="line-297"></span><span>        </span><span id="local-6989586621682577921"><span class="annot"><span class="annottext">env_wild :: TidyEnv
</span><a href="#local-6989586621682577921"><span class="hs-identifier hs-var hs-var">env_wild</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TidyOccEnv
</span><a href="#local-6989586621682577916"><span class="hs-identifier hs-var">occ_env</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">VarEnv CoVar -&gt; CoVar -&gt; CoVar -&gt; VarEnv CoVar
forall a. VarEnv a -&gt; CoVar -&gt; a -&gt; VarEnv a
</span><a href="GHC.Types.Var.Env.html#extendVarEnv"><span class="hs-identifier hs-var">extendVarEnv</span></a></span><span> </span><span class="annot"><span class="annottext">VarEnv CoVar
</span><a href="#local-6989586621682577917"><span class="hs-identifier hs-var">subst</span></a></span><span> </span><span class="annot"><span class="annottext">CoVar
</span><a href="#local-6989586621682577919"><span class="hs-identifier hs-var">bndr</span></a></span><span> </span><span class="annot"><span class="annottext">CoVar
</span><a href="#local-6989586621682577926"><span class="hs-identifier hs-var">wild_bndr</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-298"></span><span>        </span><span id="local-6989586621682577926"><span class="annot"><span class="annottext">wild_bndr :: CoVar
</span><a href="#local-6989586621682577926"><span class="hs-identifier hs-var hs-var">wild_bndr</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">CoVar -&gt; Name -&gt; CoVar
</span><a href="GHC.Types.Var.html#setVarName"><span class="hs-identifier hs-var">setVarName</span></a></span><span> </span><span class="annot"><span class="annottext">CoVar
</span><a href="#local-6989586621682577919"><span class="hs-identifier hs-var">bndr</span></a></span><span> </span><span class="annot"><span class="annottext">(Name -&gt; CoVar) -&gt; Name -&gt; CoVar
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-299"></span><span>                    </span><span class="annot"><span class="annottext">Name -&gt; OccName -&gt; Name
</span><a href="GHC.Types.Name.html#tidyNameOcc"><span class="hs-identifier hs-var">tidyNameOcc</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">CoVar -&gt; Name
</span><a href="GHC.Types.Var.html#varName"><span class="hs-identifier hs-var">varName</span></a></span><span> </span><span class="annot"><span class="annottext">CoVar
</span><a href="#local-6989586621682577919"><span class="hs-identifier hs-var">bndr</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">FastString -&gt; OccName
</span><a href="GHC.Types.Name.Occurrence.html#mkTyVarOccFS"><span class="hs-identifier hs-var">mkTyVarOccFS</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">String -&gt; FastString
</span><a href="GHC.Data.FastString.html#fsLit"><span class="hs-identifier hs-var">fsLit</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;_&quot;</span></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-300"></span><span>                    </span><span class="hs-comment">-- Tidy the binder to &quot;_&quot;</span><span>
</span><span id="line-301"></span><span>
</span><span id="line-302"></span><span>    </span><span class="annot"><a href="#local-6989586621682577920"><span class="hs-identifier hs-type">is_wildcard</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Types.Var.html#Var"><span class="hs-identifier hs-type">Var</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Bool</span></span><span>
</span><span id="line-303"></span><span>    </span><span id="local-6989586621682577920"><span class="annot"><span class="annottext">is_wildcard :: CoVar -&gt; Bool
</span><a href="#local-6989586621682577920"><span class="hs-identifier hs-var hs-var">is_wildcard</span></a></span></span><span> </span><span id="local-6989586621682577930"><span class="annot"><span class="annottext">CoVar
</span><a href="#local-6989586621682577930"><span class="hs-identifier hs-var">tv</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">OccName -&gt; String
</span><a href="GHC.Types.Name.Occurrence.html#occNameString"><span class="hs-identifier hs-var">occNameString</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">CoVar -&gt; OccName
forall a. NamedThing a =&gt; a -&gt; OccName
</span><a href="GHC.Types.Name.html#getOccName"><span class="hs-identifier hs-var">getOccName</span></a></span><span> </span><span class="annot"><span class="annottext">CoVar
</span><a href="#local-6989586621682577930"><span class="hs-identifier hs-var">tv</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-304"></span><span>                       </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Char
</span><span class="hs-char">'_'</span></span><span> </span><span class="annot"><span class="hs-glyph hs-type">:</span></span><span> </span><span id="local-6989586621682577933"><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621682577933"><span class="hs-identifier hs-var">rest</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">(Char -&gt; Bool) -&gt; String -&gt; Bool
forall (t :: * -&gt; *) a. Foldable t =&gt; (a -&gt; Bool) -&gt; t a -&gt; Bool
</span><span class="hs-identifier hs-var">all</span></span><span> </span><span class="annot"><span class="annottext">Char -&gt; Bool
</span><span class="hs-identifier hs-var">isDigit</span></span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621682577933"><span class="hs-identifier hs-var">rest</span></a></span><span>
</span><span id="line-305"></span><span>                       </span><span class="annot"><span class="annottext">String
</span><span class="hs-identifier">_</span></span><span>            </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">False</span></span><span>
</span><span id="line-306"></span><span>
</span><span id="line-307"></span><span>
</span><span id="line-308"></span><span class="annot"><span class="hs-comment">{- *********************************************************************
*                                                                      *
              MCoercion
*                                                                      *
********************************************************************* -}</span></span><span>
</span><span id="line-313"></span><span>
</span><span id="line-314"></span><span class="annot"><a href="GHC.Core.Coercion.html#coToMCo"><span class="hs-identifier hs-type">coToMCo</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#Coercion"><span class="hs-identifier hs-type">Coercion</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#MCoercion"><span class="hs-identifier hs-type">MCoercion</span></a></span><span>
</span><span id="line-315"></span><span class="hs-comment">-- Convert a coercion to a MCoercion,</span><span>
</span><span id="line-316"></span><span class="hs-comment">-- It's not clear whether or not isReflexiveCo would be better here</span><span>
</span><span id="line-317"></span><span class="hs-comment">--    See #19815 for a bit of data and discussion on this point</span><span>
</span><span id="line-318"></span><span id="coToMCo"><span class="annot"><span class="annottext">coToMCo :: Coercion -&gt; MCoercion
</span><a href="GHC.Core.Coercion.html#coToMCo"><span class="hs-identifier hs-var hs-var">coToMCo</span></a></span></span><span> </span><span id="local-6989586621682577935"><span class="annot"><span class="annottext">Coercion
</span><a href="#local-6989586621682577935"><span class="hs-identifier hs-var">co</span></a></span></span><span> </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Coercion -&gt; Bool
</span><a href="GHC.Core.Coercion.html#isReflCo"><span class="hs-identifier hs-var">isReflCo</span></a></span><span> </span><span class="annot"><span class="annottext">Coercion
</span><a href="#local-6989586621682577935"><span class="hs-identifier hs-var">co</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">MCoercion
</span><a href="GHC.Core.TyCo.Rep.html#MRefl"><span class="hs-identifier hs-var">MRefl</span></a></span><span>
</span><span id="line-319"></span><span>           </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">otherwise</span></span><span>   </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Coercion -&gt; MCoercion
</span><a href="GHC.Core.TyCo.Rep.html#MCo"><span class="hs-identifier hs-var">MCo</span></a></span><span> </span><span class="annot"><span class="annottext">Coercion
</span><a href="#local-6989586621682577935"><span class="hs-identifier hs-var">co</span></a></span><span>
</span><span id="line-320"></span><span>
</span><span id="line-321"></span><span class="annot"><a href="GHC.Core.Coercion.html#checkReflexiveMCo"><span class="hs-identifier hs-type">checkReflexiveMCo</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#MCoercion"><span class="hs-identifier hs-type">MCoercion</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#MCoercion"><span class="hs-identifier hs-type">MCoercion</span></a></span><span>
</span><span id="line-322"></span><span id="checkReflexiveMCo"><span class="annot"><span class="annottext">checkReflexiveMCo :: MCoercion -&gt; MCoercion
</span><a href="GHC.Core.Coercion.html#checkReflexiveMCo"><span class="hs-identifier hs-var hs-var">checkReflexiveMCo</span></a></span></span><span> </span><span class="annot"><span class="annottext">MCoercion
</span><a href="GHC.Core.TyCo.Rep.html#MRefl"><span class="hs-identifier hs-var">MRefl</span></a></span><span>                       </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">MCoercion
</span><a href="GHC.Core.TyCo.Rep.html#MRefl"><span class="hs-identifier hs-var">MRefl</span></a></span><span>
</span><span id="line-323"></span><span class="annot"><a href="GHC.Core.Coercion.html#checkReflexiveMCo"><span class="hs-identifier hs-var">checkReflexiveMCo</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#MCo"><span class="hs-identifier hs-type">MCo</span></a></span><span> </span><span id="local-6989586621682577938"><span class="annot"><span class="annottext">Coercion
</span><a href="#local-6989586621682577938"><span class="hs-identifier hs-var">co</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Coercion -&gt; Bool
</span><a href="GHC.Core.Coercion.html#isReflexiveCo"><span class="hs-identifier hs-var">isReflexiveCo</span></a></span><span> </span><span class="annot"><span class="annottext">Coercion
</span><a href="#local-6989586621682577938"><span class="hs-identifier hs-var">co</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">MCoercion
</span><a href="GHC.Core.TyCo.Rep.html#MRefl"><span class="hs-identifier hs-var">MRefl</span></a></span><span>
</span><span id="line-324"></span><span>                           </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">otherwise</span></span><span>        </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Coercion -&gt; MCoercion
</span><a href="GHC.Core.TyCo.Rep.html#MCo"><span class="hs-identifier hs-var">MCo</span></a></span><span> </span><span class="annot"><span class="annottext">Coercion
</span><a href="#local-6989586621682577938"><span class="hs-identifier hs-var">co</span></a></span><span>
</span><span id="line-325"></span><span>
</span><span id="line-326"></span><span class="hs-comment">-- | Tests if this MCoercion is obviously generalized reflexive</span><span>
</span><span id="line-327"></span><span class="hs-comment">-- Guaranteed to work very quickly.</span><span>
</span><span id="line-328"></span><span class="annot"><a href="GHC.Core.Coercion.html#isGReflMCo"><span class="hs-identifier hs-type">isGReflMCo</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#MCoercion"><span class="hs-identifier hs-type">MCoercion</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Bool</span></span><span>
</span><span id="line-329"></span><span id="isGReflMCo"><span class="annot"><span class="annottext">isGReflMCo :: MCoercion -&gt; Bool
</span><a href="GHC.Core.Coercion.html#isGReflMCo"><span class="hs-identifier hs-var hs-var">isGReflMCo</span></a></span></span><span> </span><span class="annot"><span class="annottext">MCoercion
</span><a href="GHC.Core.TyCo.Rep.html#MRefl"><span class="hs-identifier hs-var">MRefl</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">True</span></span><span>
</span><span id="line-330"></span><span class="annot"><a href="GHC.Core.Coercion.html#isGReflMCo"><span class="hs-identifier hs-var">isGReflMCo</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#MCo"><span class="hs-identifier hs-type">MCo</span></a></span><span> </span><span id="local-6989586621682577939"><span class="annot"><span class="annottext">Coercion
</span><a href="#local-6989586621682577939"><span class="hs-identifier hs-var">co</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Coercion -&gt; Bool
</span><a href="GHC.Core.Coercion.html#isGReflCo"><span class="hs-identifier hs-var">isGReflCo</span></a></span><span> </span><span class="annot"><span class="annottext">Coercion
</span><a href="#local-6989586621682577939"><span class="hs-identifier hs-var">co</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">True</span></span><span>
</span><span id="line-331"></span><span class="annot"><a href="GHC.Core.Coercion.html#isGReflMCo"><span class="hs-identifier hs-var">isGReflMCo</span></a></span><span> </span><span class="annot"><span class="annottext">MCoercion
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">False</span></span><span>
</span><span id="line-332"></span><span>
</span><span id="line-333"></span><span class="annot"><span class="hs-comment">-- | Make a generalized reflexive coercion</span></span><span>
</span><span id="line-334"></span><span class="annot"><a href="GHC.Core.Coercion.html#mkGReflCo"><span class="hs-identifier hs-type">mkGReflCo</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Language.Haskell.Syntax.Basic.html#Role"><span class="hs-identifier hs-type">Role</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#Type"><span class="hs-identifier hs-type">Type</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#MCoercionN"><span class="hs-identifier hs-type">MCoercionN</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#Coercion"><span class="hs-identifier hs-type">Coercion</span></a></span><span>
</span><span id="line-335"></span><span id="mkGReflCo"><span class="annot"><span class="annottext">mkGReflCo :: Role -&gt; Type -&gt; MCoercion -&gt; Coercion
</span><a href="GHC.Core.Coercion.html#mkGReflCo"><span class="hs-identifier hs-var hs-var">mkGReflCo</span></a></span></span><span> </span><span id="local-6989586621682577940"><span class="annot"><span class="annottext">Role
</span><a href="#local-6989586621682577940"><span class="hs-identifier hs-var">r</span></a></span></span><span> </span><span id="local-6989586621682577941"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682577941"><span class="hs-identifier hs-var">ty</span></a></span></span><span> </span><span id="local-6989586621682577942"><span class="annot"><span class="annottext">MCoercion
</span><a href="#local-6989586621682577942"><span class="hs-identifier hs-var">mco</span></a></span></span><span>
</span><span id="line-336"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">MCoercion -&gt; Bool
</span><a href="GHC.Core.Coercion.html#isGReflMCo"><span class="hs-identifier hs-var">isGReflMCo</span></a></span><span> </span><span class="annot"><span class="annottext">MCoercion
</span><a href="#local-6989586621682577942"><span class="hs-identifier hs-var">mco</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">if</span><span> </span><span class="annot"><span class="annottext">Role
</span><a href="#local-6989586621682577940"><span class="hs-identifier hs-var">r</span></a></span><span> </span><span class="annot"><span class="annottext">Role -&gt; Role -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">==</span></span><span> </span><span class="annot"><span class="annottext">Role
</span><a href="Language.Haskell.Syntax.Basic.html#Nominal"><span class="hs-identifier hs-var">Nominal</span></a></span><span> </span><span class="hs-keyword">then</span><span> </span><span class="annot"><span class="annottext">Type -&gt; Coercion
</span><a href="GHC.Core.TyCo.Rep.html#Refl"><span class="hs-identifier hs-var">Refl</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682577941"><span class="hs-identifier hs-var">ty</span></a></span><span>
</span><span id="line-337"></span><span>                                     </span><span class="hs-keyword">else</span><span> </span><span class="annot"><span class="annottext">Role -&gt; Type -&gt; MCoercion -&gt; Coercion
</span><a href="GHC.Core.TyCo.Rep.html#GRefl"><span class="hs-identifier hs-var">GRefl</span></a></span><span> </span><span class="annot"><span class="annottext">Role
</span><a href="#local-6989586621682577940"><span class="hs-identifier hs-var">r</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682577941"><span class="hs-identifier hs-var">ty</span></a></span><span> </span><span class="annot"><span class="annottext">MCoercion
</span><a href="GHC.Core.TyCo.Rep.html#MRefl"><span class="hs-identifier hs-var">MRefl</span></a></span><span>
</span><span id="line-338"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">otherwise</span></span><span>
</span><span id="line-339"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-comment">-- I'd like to have this assert, but sadly it's not true during type</span><span>
</span><span id="line-340"></span><span>    </span><span class="hs-comment">-- inference because the types are not fully zonked</span><span>
</span><span id="line-341"></span><span>    </span><span class="hs-comment">-- assertPpr (case mco of</span><span>
</span><span id="line-342"></span><span>    </span><span class="hs-comment">--              MCo co -&gt; typeKind ty `eqType` coercionLKind co</span><span>
</span><span id="line-343"></span><span>    </span><span class="hs-comment">--              MRefl  -&gt; True)</span><span>
</span><span id="line-344"></span><span>    </span><span class="hs-comment">--          (vcat [ text &quot;ty&quot; &lt;+&gt; ppr ty &lt;+&gt; dcolon &lt;+&gt; ppr (typeKind ty)</span><span>
</span><span id="line-345"></span><span>    </span><span class="hs-comment">--                , case mco of</span><span>
</span><span id="line-346"></span><span>    </span><span class="hs-comment">--                     MCo co -&gt; text &quot;co&quot; &lt;+&gt; ppr co</span><span>
</span><span id="line-347"></span><span>    </span><span class="hs-comment">--                                  &lt;+&gt; dcolon &lt;+&gt; ppr (coercionKind co)</span><span>
</span><span id="line-348"></span><span>    </span><span class="hs-comment">--                     MRefl  -&gt; text &quot;MRefl&quot;</span><span>
</span><span id="line-349"></span><span>    </span><span class="hs-comment">--                , callStackDoc ]) $</span><span>
</span><span id="line-350"></span><span>    </span><span class="annot"><span class="annottext">Role -&gt; Type -&gt; MCoercion -&gt; Coercion
</span><a href="GHC.Core.TyCo.Rep.html#GRefl"><span class="hs-identifier hs-var">GRefl</span></a></span><span> </span><span class="annot"><span class="annottext">Role
</span><a href="#local-6989586621682577940"><span class="hs-identifier hs-var">r</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682577941"><span class="hs-identifier hs-var">ty</span></a></span><span> </span><span class="annot"><span class="annottext">MCoercion
</span><a href="#local-6989586621682577942"><span class="hs-identifier hs-var">mco</span></a></span><span>
</span><span id="line-351"></span><span>
</span><span id="line-352"></span><span class="annot"><a href="GHC.Core.Coercion.html#mkGReflMCo"><span class="hs-identifier hs-type">mkGReflMCo</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Utils.Misc.html#HasDebugCallStack"><span class="hs-identifier hs-type">HasDebugCallStack</span></a></span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="Language.Haskell.Syntax.Basic.html#Role"><span class="hs-identifier hs-type">Role</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#Type"><span class="hs-identifier hs-type">Type</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#CoercionN"><span class="hs-identifier hs-type">CoercionN</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#Coercion"><span class="hs-identifier hs-type">Coercion</span></a></span><span>
</span><span id="line-353"></span><span id="mkGReflMCo"><span class="annot"><span class="annottext">mkGReflMCo :: HasDebugCallStack =&gt; Role -&gt; Type -&gt; Coercion -&gt; Coercion
</span><a href="GHC.Core.Coercion.html#mkGReflMCo"><span class="hs-identifier hs-var hs-var">mkGReflMCo</span></a></span></span><span> </span><span id="local-6989586621682577947"><span class="annot"><span class="annottext">Role
</span><a href="#local-6989586621682577947"><span class="hs-identifier hs-var">r</span></a></span></span><span> </span><span id="local-6989586621682577948"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682577948"><span class="hs-identifier hs-var">ty</span></a></span></span><span> </span><span id="local-6989586621682577949"><span class="annot"><span class="annottext">Coercion
</span><a href="#local-6989586621682577949"><span class="hs-identifier hs-var">co</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Role -&gt; Type -&gt; MCoercion -&gt; Coercion
</span><a href="GHC.Core.Coercion.html#mkGReflCo"><span class="hs-identifier hs-var">mkGReflCo</span></a></span><span> </span><span class="annot"><span class="annottext">Role
</span><a href="#local-6989586621682577947"><span class="hs-identifier hs-var">r</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682577948"><span class="hs-identifier hs-var">ty</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Coercion -&gt; MCoercion
</span><a href="GHC.Core.TyCo.Rep.html#MCo"><span class="hs-identifier hs-var">MCo</span></a></span><span> </span><span class="annot"><span class="annottext">Coercion
</span><a href="#local-6989586621682577949"><span class="hs-identifier hs-var">co</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-354"></span><span>
</span><span id="line-355"></span><span class="annot"><span class="hs-comment">-- | Compose two MCoercions via transitivity</span></span><span>
</span><span id="line-356"></span><span class="annot"><a href="GHC.Core.Coercion.html#mkTransMCo"><span class="hs-identifier hs-type">mkTransMCo</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#MCoercion"><span class="hs-identifier hs-type">MCoercion</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#MCoercion"><span class="hs-identifier hs-type">MCoercion</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#MCoercion"><span class="hs-identifier hs-type">MCoercion</span></a></span><span>
</span><span id="line-357"></span><span id="mkTransMCo"><span class="annot"><span class="annottext">mkTransMCo :: MCoercion -&gt; MCoercion -&gt; MCoercion
</span><a href="GHC.Core.Coercion.html#mkTransMCo"><span class="hs-identifier hs-var hs-var">mkTransMCo</span></a></span></span><span> </span><span class="annot"><span class="annottext">MCoercion
</span><a href="GHC.Core.TyCo.Rep.html#MRefl"><span class="hs-identifier hs-var">MRefl</span></a></span><span>     </span><span id="local-6989586621682577950"><span class="annot"><span class="annottext">MCoercion
</span><a href="#local-6989586621682577950"><span class="hs-identifier hs-var">co2</span></a></span></span><span>       </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">MCoercion
</span><a href="#local-6989586621682577950"><span class="hs-identifier hs-var">co2</span></a></span><span>
</span><span id="line-358"></span><span class="annot"><a href="GHC.Core.Coercion.html#mkTransMCo"><span class="hs-identifier hs-var">mkTransMCo</span></a></span><span> </span><span id="local-6989586621682577951"><span class="annot"><span class="annottext">MCoercion
</span><a href="#local-6989586621682577951"><span class="hs-identifier hs-var">co1</span></a></span></span><span>       </span><span class="annot"><span class="annottext">MCoercion
</span><a href="GHC.Core.TyCo.Rep.html#MRefl"><span class="hs-identifier hs-var">MRefl</span></a></span><span>     </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">MCoercion
</span><a href="#local-6989586621682577951"><span class="hs-identifier hs-var">co1</span></a></span><span>
</span><span id="line-359"></span><span class="annot"><a href="GHC.Core.Coercion.html#mkTransMCo"><span class="hs-identifier hs-var">mkTransMCo</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#MCo"><span class="hs-identifier hs-type">MCo</span></a></span><span> </span><span id="local-6989586621682577952"><span class="annot"><span class="annottext">Coercion
</span><a href="#local-6989586621682577952"><span class="hs-identifier hs-var">co1</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#MCo"><span class="hs-identifier hs-type">MCo</span></a></span><span> </span><span id="local-6989586621682577953"><span class="annot"><span class="annottext">Coercion
</span><a href="#local-6989586621682577953"><span class="hs-identifier hs-var">co2</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Coercion -&gt; MCoercion
</span><a href="GHC.Core.TyCo.Rep.html#MCo"><span class="hs-identifier hs-var">MCo</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">HasDebugCallStack =&gt; Coercion -&gt; Coercion -&gt; Coercion
Coercion -&gt; Coercion -&gt; Coercion
</span><a href="GHC.Core.Coercion.html#mkTransCo"><span class="hs-identifier hs-var">mkTransCo</span></a></span><span> </span><span class="annot"><span class="annottext">Coercion
</span><a href="#local-6989586621682577952"><span class="hs-identifier hs-var">co1</span></a></span><span> </span><span class="annot"><span class="annottext">Coercion
</span><a href="#local-6989586621682577953"><span class="hs-identifier hs-var">co2</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-360"></span><span>
</span><span id="line-361"></span><span class="annot"><a href="GHC.Core.Coercion.html#mkTransMCoL"><span class="hs-identifier hs-type">mkTransMCoL</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#MCoercion"><span class="hs-identifier hs-type">MCoercion</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#Coercion"><span class="hs-identifier hs-type">Coercion</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#MCoercion"><span class="hs-identifier hs-type">MCoercion</span></a></span><span>
</span><span id="line-362"></span><span id="mkTransMCoL"><span class="annot"><span class="annottext">mkTransMCoL :: MCoercion -&gt; Coercion -&gt; MCoercion
</span><a href="GHC.Core.Coercion.html#mkTransMCoL"><span class="hs-identifier hs-var hs-var">mkTransMCoL</span></a></span></span><span> </span><span class="annot"><span class="annottext">MCoercion
</span><a href="GHC.Core.TyCo.Rep.html#MRefl"><span class="hs-identifier hs-var">MRefl</span></a></span><span>     </span><span id="local-6989586621682577954"><span class="annot"><span class="annottext">Coercion
</span><a href="#local-6989586621682577954"><span class="hs-identifier hs-var">co2</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Coercion -&gt; MCoercion
</span><a href="GHC.Core.Coercion.html#coToMCo"><span class="hs-identifier hs-var">coToMCo</span></a></span><span> </span><span class="annot"><span class="annottext">Coercion
</span><a href="#local-6989586621682577954"><span class="hs-identifier hs-var">co2</span></a></span><span>
</span><span id="line-363"></span><span class="annot"><a href="GHC.Core.Coercion.html#mkTransMCoL"><span class="hs-identifier hs-var">mkTransMCoL</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#MCo"><span class="hs-identifier hs-type">MCo</span></a></span><span> </span><span id="local-6989586621682577955"><span class="annot"><span class="annottext">Coercion
</span><a href="#local-6989586621682577955"><span class="hs-identifier hs-var">co1</span></a></span></span><span class="hs-special">)</span><span> </span><span id="local-6989586621682577956"><span class="annot"><span class="annottext">Coercion
</span><a href="#local-6989586621682577956"><span class="hs-identifier hs-var">co2</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Coercion -&gt; MCoercion
</span><a href="GHC.Core.TyCo.Rep.html#MCo"><span class="hs-identifier hs-var">MCo</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">HasDebugCallStack =&gt; Coercion -&gt; Coercion -&gt; Coercion
Coercion -&gt; Coercion -&gt; Coercion
</span><a href="GHC.Core.Coercion.html#mkTransCo"><span class="hs-identifier hs-var">mkTransCo</span></a></span><span> </span><span class="annot"><span class="annottext">Coercion
</span><a href="#local-6989586621682577955"><span class="hs-identifier hs-var">co1</span></a></span><span> </span><span class="annot"><span class="annottext">Coercion
</span><a href="#local-6989586621682577956"><span class="hs-identifier hs-var">co2</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-364"></span><span>
</span><span id="line-365"></span><span class="annot"><a href="GHC.Core.Coercion.html#mkTransMCoR"><span class="hs-identifier hs-type">mkTransMCoR</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#Coercion"><span class="hs-identifier hs-type">Coercion</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#MCoercion"><span class="hs-identifier hs-type">MCoercion</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#MCoercion"><span class="hs-identifier hs-type">MCoercion</span></a></span><span>
</span><span id="line-366"></span><span id="mkTransMCoR"><span class="annot"><span class="annottext">mkTransMCoR :: Coercion -&gt; MCoercion -&gt; MCoercion
</span><a href="GHC.Core.Coercion.html#mkTransMCoR"><span class="hs-identifier hs-var hs-var">mkTransMCoR</span></a></span></span><span> </span><span id="local-6989586621682577957"><span class="annot"><span class="annottext">Coercion
</span><a href="#local-6989586621682577957"><span class="hs-identifier hs-var">co1</span></a></span></span><span> </span><span class="annot"><span class="annottext">MCoercion
</span><a href="GHC.Core.TyCo.Rep.html#MRefl"><span class="hs-identifier hs-var">MRefl</span></a></span><span>     </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Coercion -&gt; MCoercion
</span><a href="GHC.Core.Coercion.html#coToMCo"><span class="hs-identifier hs-var">coToMCo</span></a></span><span> </span><span class="annot"><span class="annottext">Coercion
</span><a href="#local-6989586621682577957"><span class="hs-identifier hs-var">co1</span></a></span><span>
</span><span id="line-367"></span><span class="annot"><a href="GHC.Core.Coercion.html#mkTransMCoR"><span class="hs-identifier hs-var">mkTransMCoR</span></a></span><span> </span><span id="local-6989586621682577958"><span class="annot"><span class="annottext">Coercion
</span><a href="#local-6989586621682577958"><span class="hs-identifier hs-var">co1</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#MCo"><span class="hs-identifier hs-type">MCo</span></a></span><span> </span><span id="local-6989586621682577959"><span class="annot"><span class="annottext">Coercion
</span><a href="#local-6989586621682577959"><span class="hs-identifier hs-var">co2</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Coercion -&gt; MCoercion
</span><a href="GHC.Core.TyCo.Rep.html#MCo"><span class="hs-identifier hs-var">MCo</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">HasDebugCallStack =&gt; Coercion -&gt; Coercion -&gt; Coercion
Coercion -&gt; Coercion -&gt; Coercion
</span><a href="GHC.Core.Coercion.html#mkTransCo"><span class="hs-identifier hs-var">mkTransCo</span></a></span><span> </span><span class="annot"><span class="annottext">Coercion
</span><a href="#local-6989586621682577958"><span class="hs-identifier hs-var">co1</span></a></span><span> </span><span class="annot"><span class="annottext">Coercion
</span><a href="#local-6989586621682577959"><span class="hs-identifier hs-var">co2</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-368"></span><span>
</span><span id="line-369"></span><span class="annot"><span class="hs-comment">-- | Get the reverse of an 'MCoercion'</span></span><span>
</span><span id="line-370"></span><span class="annot"><a href="GHC.Core.Coercion.html#mkSymMCo"><span class="hs-identifier hs-type">mkSymMCo</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#MCoercion"><span class="hs-identifier hs-type">MCoercion</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#MCoercion"><span class="hs-identifier hs-type">MCoercion</span></a></span><span>
</span><span id="line-371"></span><span id="mkSymMCo"><span class="annot"><span class="annottext">mkSymMCo :: MCoercion -&gt; MCoercion
</span><a href="GHC.Core.Coercion.html#mkSymMCo"><span class="hs-identifier hs-var hs-var">mkSymMCo</span></a></span></span><span> </span><span class="annot"><span class="annottext">MCoercion
</span><a href="GHC.Core.TyCo.Rep.html#MRefl"><span class="hs-identifier hs-var">MRefl</span></a></span><span>    </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">MCoercion
</span><a href="GHC.Core.TyCo.Rep.html#MRefl"><span class="hs-identifier hs-var">MRefl</span></a></span><span>
</span><span id="line-372"></span><span class="annot"><a href="GHC.Core.Coercion.html#mkSymMCo"><span class="hs-identifier hs-var">mkSymMCo</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#MCo"><span class="hs-identifier hs-type">MCo</span></a></span><span> </span><span id="local-6989586621682577960"><span class="annot"><span class="annottext">Coercion
</span><a href="#local-6989586621682577960"><span class="hs-identifier hs-var">co</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Coercion -&gt; MCoercion
</span><a href="GHC.Core.TyCo.Rep.html#MCo"><span class="hs-identifier hs-var">MCo</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Coercion -&gt; Coercion
</span><a href="GHC.Core.Coercion.html#mkSymCo"><span class="hs-identifier hs-var">mkSymCo</span></a></span><span> </span><span class="annot"><span class="annottext">Coercion
</span><a href="#local-6989586621682577960"><span class="hs-identifier hs-var">co</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-373"></span><span>
</span><span id="line-374"></span><span class="annot"><span class="hs-comment">-- | Cast a type by an 'MCoercion'</span></span><span>
</span><span id="line-375"></span><span class="annot"><a href="GHC.Core.Coercion.html#mkCastTyMCo"><span class="hs-identifier hs-type">mkCastTyMCo</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#Type"><span class="hs-identifier hs-type">Type</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#MCoercion"><span class="hs-identifier hs-type">MCoercion</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#Type"><span class="hs-identifier hs-type">Type</span></a></span><span>
</span><span id="line-376"></span><span id="mkCastTyMCo"><span class="annot"><span class="annottext">mkCastTyMCo :: Type -&gt; MCoercion -&gt; Type
</span><a href="GHC.Core.Coercion.html#mkCastTyMCo"><span class="hs-identifier hs-var hs-var">mkCastTyMCo</span></a></span></span><span> </span><span id="local-6989586621682577961"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682577961"><span class="hs-identifier hs-var">ty</span></a></span></span><span> </span><span class="annot"><span class="annottext">MCoercion
</span><a href="GHC.Core.TyCo.Rep.html#MRefl"><span class="hs-identifier hs-var">MRefl</span></a></span><span>    </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682577961"><span class="hs-identifier hs-var">ty</span></a></span><span>
</span><span id="line-377"></span><span class="annot"><a href="GHC.Core.Coercion.html#mkCastTyMCo"><span class="hs-identifier hs-var">mkCastTyMCo</span></a></span><span> </span><span id="local-6989586621682577962"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682577962"><span class="hs-identifier hs-var">ty</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#MCo"><span class="hs-identifier hs-type">MCo</span></a></span><span> </span><span id="local-6989586621682577963"><span class="annot"><span class="annottext">Coercion
</span><a href="#local-6989586621682577963"><span class="hs-identifier hs-var">co</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682577962"><span class="hs-identifier hs-var">ty</span></a></span><span> </span><span class="annot"><span class="annottext">Type -&gt; Coercion -&gt; Type
</span><a href="GHC.Core.Type.html#mkCastTy"><span class="hs-operator hs-var">`mkCastTy`</span></a></span><span> </span><span class="annot"><span class="annottext">Coercion
</span><a href="#local-6989586621682577963"><span class="hs-identifier hs-var">co</span></a></span><span>
</span><span id="line-378"></span><span>
</span><span id="line-379"></span><span class="annot"><a href="GHC.Core.Coercion.html#mkPiMCos"><span class="hs-identifier hs-type">mkPiMCos</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="GHC.Types.Var.html#Var"><span class="hs-identifier hs-type">Var</span></a></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#MCoercion"><span class="hs-identifier hs-type">MCoercion</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#MCoercion"><span class="hs-identifier hs-type">MCoercion</span></a></span><span>
</span><span id="line-380"></span><span id="mkPiMCos"><span class="annot"><span class="annottext">mkPiMCos :: [CoVar] -&gt; MCoercion -&gt; MCoercion
</span><a href="GHC.Core.Coercion.html#mkPiMCos"><span class="hs-identifier hs-var hs-var">mkPiMCos</span></a></span></span><span> </span><span class="annot"><span class="annottext">[CoVar]
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">MCoercion
</span><a href="GHC.Core.TyCo.Rep.html#MRefl"><span class="hs-identifier hs-var">MRefl</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">MCoercion
</span><a href="GHC.Core.TyCo.Rep.html#MRefl"><span class="hs-identifier hs-var">MRefl</span></a></span><span>
</span><span id="line-381"></span><span class="annot"><a href="GHC.Core.Coercion.html#mkPiMCos"><span class="hs-identifier hs-var">mkPiMCos</span></a></span><span> </span><span id="local-6989586621682577965"><span class="annot"><span class="annottext">[CoVar]
</span><a href="#local-6989586621682577965"><span class="hs-identifier hs-var">vs</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#MCo"><span class="hs-identifier hs-type">MCo</span></a></span><span> </span><span id="local-6989586621682577966"><span class="annot"><span class="annottext">Coercion
</span><a href="#local-6989586621682577966"><span class="hs-identifier hs-var">co</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Coercion -&gt; MCoercion
</span><a href="GHC.Core.TyCo.Rep.html#MCo"><span class="hs-identifier hs-var">MCo</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Role -&gt; [CoVar] -&gt; Coercion -&gt; Coercion
</span><a href="GHC.Core.Coercion.html#mkPiCos"><span class="hs-identifier hs-var">mkPiCos</span></a></span><span> </span><span class="annot"><span class="annottext">Role
</span><a href="Language.Haskell.Syntax.Basic.html#Representational"><span class="hs-identifier hs-var">Representational</span></a></span><span> </span><span class="annot"><span class="annottext">[CoVar]
</span><a href="#local-6989586621682577965"><span class="hs-identifier hs-var">vs</span></a></span><span> </span><span class="annot"><span class="annottext">Coercion
</span><a href="#local-6989586621682577966"><span class="hs-identifier hs-var">co</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-382"></span><span>
</span><span id="line-383"></span><span class="annot"><a href="GHC.Core.Coercion.html#mkFunResMCo"><span class="hs-identifier hs-type">mkFunResMCo</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Types.Var.html#Id"><span class="hs-identifier hs-type">Id</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#MCoercionR"><span class="hs-identifier hs-type">MCoercionR</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#MCoercionR"><span class="hs-identifier hs-type">MCoercionR</span></a></span><span>
</span><span id="line-384"></span><span id="mkFunResMCo"><span class="annot"><span class="annottext">mkFunResMCo :: CoVar -&gt; MCoercion -&gt; MCoercion
</span><a href="GHC.Core.Coercion.html#mkFunResMCo"><span class="hs-identifier hs-var hs-var">mkFunResMCo</span></a></span></span><span> </span><span class="annot"><span class="annottext">CoVar
</span><span class="hs-identifier">_</span></span><span>      </span><span class="annot"><span class="annottext">MCoercion
</span><a href="GHC.Core.TyCo.Rep.html#MRefl"><span class="hs-identifier hs-var">MRefl</span></a></span><span>    </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">MCoercion
</span><a href="GHC.Core.TyCo.Rep.html#MRefl"><span class="hs-identifier hs-var">MRefl</span></a></span><span>
</span><span id="line-385"></span><span class="annot"><a href="GHC.Core.Coercion.html#mkFunResMCo"><span class="hs-identifier hs-var">mkFunResMCo</span></a></span><span> </span><span id="local-6989586621682577969"><span class="annot"><span class="annottext">CoVar
</span><a href="#local-6989586621682577969"><span class="hs-identifier hs-var">arg_id</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#MCo"><span class="hs-identifier hs-type">MCo</span></a></span><span> </span><span id="local-6989586621682577970"><span class="annot"><span class="annottext">Coercion
</span><a href="#local-6989586621682577970"><span class="hs-identifier hs-var">co</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Coercion -&gt; MCoercion
</span><a href="GHC.Core.TyCo.Rep.html#MCo"><span class="hs-identifier hs-var">MCo</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Role -&gt; CoVar -&gt; Coercion -&gt; Coercion
</span><a href="GHC.Core.Coercion.html#mkFunResCo"><span class="hs-identifier hs-var">mkFunResCo</span></a></span><span> </span><span class="annot"><span class="annottext">Role
</span><a href="Language.Haskell.Syntax.Basic.html#Representational"><span class="hs-identifier hs-var">Representational</span></a></span><span> </span><span class="annot"><span class="annottext">CoVar
</span><a href="#local-6989586621682577969"><span class="hs-identifier hs-var">arg_id</span></a></span><span> </span><span class="annot"><span class="annottext">Coercion
</span><a href="#local-6989586621682577970"><span class="hs-identifier hs-var">co</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-386"></span><span>
</span><span id="line-387"></span><span class="annot"><a href="GHC.Core.Coercion.html#mkGReflLeftMCo"><span class="hs-identifier hs-type">mkGReflLeftMCo</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Language.Haskell.Syntax.Basic.html#Role"><span class="hs-identifier hs-type">Role</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#Type"><span class="hs-identifier hs-type">Type</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#MCoercionN"><span class="hs-identifier hs-type">MCoercionN</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#Coercion"><span class="hs-identifier hs-type">Coercion</span></a></span><span>
</span><span id="line-388"></span><span id="mkGReflLeftMCo"><span class="annot"><span class="annottext">mkGReflLeftMCo :: Role -&gt; Type -&gt; MCoercion -&gt; Coercion
</span><a href="GHC.Core.Coercion.html#mkGReflLeftMCo"><span class="hs-identifier hs-var hs-var">mkGReflLeftMCo</span></a></span></span><span> </span><span id="local-6989586621682577971"><span class="annot"><span class="annottext">Role
</span><a href="#local-6989586621682577971"><span class="hs-identifier hs-var">r</span></a></span></span><span> </span><span id="local-6989586621682577972"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682577972"><span class="hs-identifier hs-var">ty</span></a></span></span><span> </span><span class="annot"><span class="annottext">MCoercion
</span><a href="GHC.Core.TyCo.Rep.html#MRefl"><span class="hs-identifier hs-var">MRefl</span></a></span><span>    </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Role -&gt; Type -&gt; Coercion
</span><a href="GHC.Core.Coercion.html#mkReflCo"><span class="hs-identifier hs-var">mkReflCo</span></a></span><span> </span><span class="annot"><span class="annottext">Role
</span><a href="#local-6989586621682577971"><span class="hs-identifier hs-var">r</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682577972"><span class="hs-identifier hs-var">ty</span></a></span><span>
</span><span id="line-389"></span><span class="annot"><a href="GHC.Core.Coercion.html#mkGReflLeftMCo"><span class="hs-identifier hs-var">mkGReflLeftMCo</span></a></span><span> </span><span id="local-6989586621682577973"><span class="annot"><span class="annottext">Role
</span><a href="#local-6989586621682577973"><span class="hs-identifier hs-var">r</span></a></span></span><span> </span><span id="local-6989586621682577974"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682577974"><span class="hs-identifier hs-var">ty</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#MCo"><span class="hs-identifier hs-type">MCo</span></a></span><span> </span><span id="local-6989586621682577975"><span class="annot"><span class="annottext">Coercion
</span><a href="#local-6989586621682577975"><span class="hs-identifier hs-var">co</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Role -&gt; Type -&gt; Coercion -&gt; Coercion
</span><a href="GHC.Core.Coercion.html#mkGReflLeftCo"><span class="hs-identifier hs-var">mkGReflLeftCo</span></a></span><span> </span><span class="annot"><span class="annottext">Role
</span><a href="#local-6989586621682577973"><span class="hs-identifier hs-var">r</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682577974"><span class="hs-identifier hs-var">ty</span></a></span><span> </span><span class="annot"><span class="annottext">Coercion
</span><a href="#local-6989586621682577975"><span class="hs-identifier hs-var">co</span></a></span><span>
</span><span id="line-390"></span><span>
</span><span id="line-391"></span><span class="annot"><a href="GHC.Core.Coercion.html#mkGReflRightMCo"><span class="hs-identifier hs-type">mkGReflRightMCo</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Language.Haskell.Syntax.Basic.html#Role"><span class="hs-identifier hs-type">Role</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#Type"><span class="hs-identifier hs-type">Type</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#MCoercionN"><span class="hs-identifier hs-type">MCoercionN</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#Coercion"><span class="hs-identifier hs-type">Coercion</span></a></span><span>
</span><span id="line-392"></span><span id="mkGReflRightMCo"><span class="annot"><span class="annottext">mkGReflRightMCo :: Role -&gt; Type -&gt; MCoercion -&gt; Coercion
</span><a href="GHC.Core.Coercion.html#mkGReflRightMCo"><span class="hs-identifier hs-var hs-var">mkGReflRightMCo</span></a></span></span><span> </span><span id="local-6989586621682577976"><span class="annot"><span class="annottext">Role
</span><a href="#local-6989586621682577976"><span class="hs-identifier hs-var">r</span></a></span></span><span> </span><span id="local-6989586621682577977"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682577977"><span class="hs-identifier hs-var">ty</span></a></span></span><span> </span><span class="annot"><span class="annottext">MCoercion
</span><a href="GHC.Core.TyCo.Rep.html#MRefl"><span class="hs-identifier hs-var">MRefl</span></a></span><span>    </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Role -&gt; Type -&gt; Coercion
</span><a href="GHC.Core.Coercion.html#mkReflCo"><span class="hs-identifier hs-var">mkReflCo</span></a></span><span> </span><span class="annot"><span class="annottext">Role
</span><a href="#local-6989586621682577976"><span class="hs-identifier hs-var">r</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682577977"><span class="hs-identifier hs-var">ty</span></a></span><span>
</span><span id="line-393"></span><span class="annot"><a href="GHC.Core.Coercion.html#mkGReflRightMCo"><span class="hs-identifier hs-var">mkGReflRightMCo</span></a></span><span> </span><span id="local-6989586621682577978"><span class="annot"><span class="annottext">Role
</span><a href="#local-6989586621682577978"><span class="hs-identifier hs-var">r</span></a></span></span><span> </span><span id="local-6989586621682577979"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682577979"><span class="hs-identifier hs-var">ty</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#MCo"><span class="hs-identifier hs-type">MCo</span></a></span><span> </span><span id="local-6989586621682577980"><span class="annot"><span class="annottext">Coercion
</span><a href="#local-6989586621682577980"><span class="hs-identifier hs-var">co</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Role -&gt; Type -&gt; Coercion -&gt; Coercion
</span><a href="GHC.Core.Coercion.html#mkGReflRightCo"><span class="hs-identifier hs-var">mkGReflRightCo</span></a></span><span> </span><span class="annot"><span class="annottext">Role
</span><a href="#local-6989586621682577978"><span class="hs-identifier hs-var">r</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682577979"><span class="hs-identifier hs-var">ty</span></a></span><span> </span><span class="annot"><span class="annottext">Coercion
</span><a href="#local-6989586621682577980"><span class="hs-identifier hs-var">co</span></a></span><span>
</span><span id="line-394"></span><span>
</span><span id="line-395"></span><span class="annot"><span class="hs-comment">-- | Like 'mkCoherenceRightCo', but with an 'MCoercion'</span></span><span>
</span><span id="line-396"></span><span class="annot"><a href="GHC.Core.Coercion.html#mkCoherenceRightMCo"><span class="hs-identifier hs-type">mkCoherenceRightMCo</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Language.Haskell.Syntax.Basic.html#Role"><span class="hs-identifier hs-type">Role</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#Type"><span class="hs-identifier hs-type">Type</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#MCoercionN"><span class="hs-identifier hs-type">MCoercionN</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#Coercion"><span class="hs-identifier hs-type">Coercion</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#Coercion"><span class="hs-identifier hs-type">Coercion</span></a></span><span>
</span><span id="line-397"></span><span id="mkCoherenceRightMCo"><span class="annot"><span class="annottext">mkCoherenceRightMCo :: Role -&gt; Type -&gt; MCoercion -&gt; Coercion -&gt; Coercion
</span><a href="GHC.Core.Coercion.html#mkCoherenceRightMCo"><span class="hs-identifier hs-var hs-var">mkCoherenceRightMCo</span></a></span></span><span> </span><span class="annot"><span class="annottext">Role
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">Type
</span><span class="hs-identifier">_</span></span><span>  </span><span class="annot"><span class="annottext">MCoercion
</span><a href="GHC.Core.TyCo.Rep.html#MRefl"><span class="hs-identifier hs-var">MRefl</span></a></span><span>    </span><span id="local-6989586621682577981"><span class="annot"><span class="annottext">Coercion
</span><a href="#local-6989586621682577981"><span class="hs-identifier hs-var">co2</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Coercion
</span><a href="#local-6989586621682577981"><span class="hs-identifier hs-var">co2</span></a></span><span>
</span><span id="line-398"></span><span class="annot"><a href="GHC.Core.Coercion.html#mkCoherenceRightMCo"><span class="hs-identifier hs-var">mkCoherenceRightMCo</span></a></span><span> </span><span id="local-6989586621682577982"><span class="annot"><span class="annottext">Role
</span><a href="#local-6989586621682577982"><span class="hs-identifier hs-var">r</span></a></span></span><span> </span><span id="local-6989586621682577983"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682577983"><span class="hs-identifier hs-var">ty</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#MCo"><span class="hs-identifier hs-type">MCo</span></a></span><span> </span><span id="local-6989586621682577984"><span class="annot"><span class="annottext">Coercion
</span><a href="#local-6989586621682577984"><span class="hs-identifier hs-var">co</span></a></span></span><span class="hs-special">)</span><span> </span><span id="local-6989586621682577985"><span class="annot"><span class="annottext">Coercion
</span><a href="#local-6989586621682577985"><span class="hs-identifier hs-var">co2</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">HasDebugCallStack =&gt;
Role -&gt; Type -&gt; Coercion -&gt; Coercion -&gt; Coercion
Role -&gt; Type -&gt; Coercion -&gt; Coercion -&gt; Coercion
</span><a href="GHC.Core.Coercion.html#mkCoherenceRightCo"><span class="hs-identifier hs-var">mkCoherenceRightCo</span></a></span><span> </span><span class="annot"><span class="annottext">Role
</span><a href="#local-6989586621682577982"><span class="hs-identifier hs-var">r</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682577983"><span class="hs-identifier hs-var">ty</span></a></span><span> </span><span class="annot"><span class="annottext">Coercion
</span><a href="#local-6989586621682577984"><span class="hs-identifier hs-var">co</span></a></span><span> </span><span class="annot"><span class="annottext">Coercion
</span><a href="#local-6989586621682577985"><span class="hs-identifier hs-var">co2</span></a></span><span>
</span><span id="line-399"></span><span>
</span><span id="line-400"></span><span class="annot"><a href="GHC.Core.Coercion.html#isReflMCo"><span class="hs-identifier hs-type">isReflMCo</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#MCoercion"><span class="hs-identifier hs-type">MCoercion</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Bool</span></span><span>
</span><span id="line-401"></span><span id="isReflMCo"><span class="annot"><span class="annottext">isReflMCo :: MCoercion -&gt; Bool
</span><a href="GHC.Core.Coercion.html#isReflMCo"><span class="hs-identifier hs-var hs-var">isReflMCo</span></a></span></span><span> </span><span class="annot"><span class="annottext">MCoercion
</span><a href="GHC.Core.TyCo.Rep.html#MRefl"><span class="hs-identifier hs-var">MRefl</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">True</span></span><span>
</span><span id="line-402"></span><span class="annot"><a href="GHC.Core.Coercion.html#isReflMCo"><span class="hs-identifier hs-var">isReflMCo</span></a></span><span> </span><span class="annot"><span class="annottext">MCoercion
</span><span class="hs-identifier">_</span></span><span>     </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">False</span></span><span>
</span><span id="line-403"></span><span>
</span><span id="line-404"></span><span class="hs-comment">{-
%************************************************************************
%*                                                                      *
        Destructing coercions
%*                                                                      *
%************************************************************************
-}</span><span>
</span><span id="line-411"></span><span>
</span><span id="line-412"></span><span class="hs-comment">-- | This breaks a 'Coercion' with type @T A B C ~ T D E F@ into</span><span>
</span><span id="line-413"></span><span class="hs-comment">-- a list of 'Coercion's of kinds @A ~ D@, @B ~ E@ and @E ~ F@. Hence:</span><span>
</span><span id="line-414"></span><span class="hs-comment">--</span><span>
</span><span id="line-415"></span><span class="hs-comment">-- &gt; decomposeCo 3 c [r1, r2, r3] = [nth r1 0 c, nth r2 1 c, nth r3 2 c]</span><span>
</span><span id="line-416"></span><span class="annot"><a href="GHC.Core.Coercion.html#decomposeCo"><span class="hs-identifier hs-type">decomposeCo</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Types.Basic.html#Arity"><span class="hs-identifier hs-type">Arity</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#Coercion"><span class="hs-identifier hs-type">Coercion</span></a></span><span>
</span><span id="line-417"></span><span>            </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Data.List.Infinite.html#Infinite"><span class="hs-identifier hs-type">Infinite</span></a></span><span> </span><span class="annot"><a href="Language.Haskell.Syntax.Basic.html#Role"><span class="hs-identifier hs-type">Role</span></a></span><span>  </span><span class="hs-comment">-- the roles of the output coercions</span><span>
</span><span id="line-418"></span><span>            </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#Coercion"><span class="hs-identifier hs-type">Coercion</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-419"></span><span id="decomposeCo"><span class="annot"><span class="annottext">decomposeCo :: Arity -&gt; Coercion -&gt; Infinite Role -&gt; [Coercion]
</span><a href="GHC.Core.Coercion.html#decomposeCo"><span class="hs-identifier hs-var hs-var">decomposeCo</span></a></span></span><span> </span><span id="local-6989586621682577986"><span class="annot"><span class="annottext">Arity
</span><a href="#local-6989586621682577986"><span class="hs-identifier hs-var">arity</span></a></span></span><span> </span><span id="local-6989586621682577987"><span class="annot"><span class="annottext">Coercion
</span><a href="#local-6989586621682577987"><span class="hs-identifier hs-var">co</span></a></span></span><span> </span><span id="local-6989586621682577988"><span class="annot"><span class="annottext">Infinite Role
</span><a href="#local-6989586621682577988"><span class="hs-identifier hs-var">rs</span></a></span></span><span>
</span><span id="line-420"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">HasDebugCallStack =&gt; CoSel -&gt; Coercion -&gt; Coercion
CoSel -&gt; Coercion -&gt; Coercion
</span><a href="GHC.Core.Coercion.html#mkSelCo"><span class="hs-identifier hs-var">mkSelCo</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Arity -&gt; Role -&gt; CoSel
</span><a href="GHC.Core.TyCo.Rep.html#SelTyCon"><span class="hs-identifier hs-var">SelTyCon</span></a></span><span> </span><span class="annot"><span class="annottext">Arity
</span><a href="#local-6989586621682577990"><span class="hs-identifier hs-var">n</span></a></span><span> </span><span class="annot"><span class="annottext">Role
</span><a href="#local-6989586621682577991"><span class="hs-identifier hs-var">r</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Coercion
</span><a href="#local-6989586621682577987"><span class="hs-identifier hs-var">co</span></a></span><span> </span><span class="hs-glyph">|</span><span> </span><span class="hs-special">(</span><span id="local-6989586621682577990"><span class="annot"><span class="annottext">Arity
</span><a href="#local-6989586621682577990"><span class="hs-identifier hs-var">n</span></a></span></span><span class="hs-special">,</span><span id="local-6989586621682577991"><span class="annot"><span class="annottext">Role
</span><a href="#local-6989586621682577991"><span class="hs-identifier hs-var">r</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">Arity
</span><span class="hs-number">0</span></span><span class="hs-glyph">..</span><span class="hs-special">(</span><span class="annot"><span class="annottext">Arity
</span><a href="#local-6989586621682577986"><span class="hs-identifier hs-var">arity</span></a></span><span class="annot"><span class="annottext">Arity -&gt; Arity -&gt; Arity
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-glyph hs-var">-</span></span><span class="annot"><span class="annottext">Arity
</span><span class="hs-number">1</span></span><span class="hs-special">)</span><span class="hs-special">]</span><span> </span><span class="annot"><span class="annottext">[Arity] -&gt; [Role] -&gt; [(Arity, Role)]
forall a b. [a] -&gt; [b] -&gt; [(a, b)]
</span><span class="hs-operator hs-var">`zip`</span></span><span> </span><span class="annot"><span class="annottext">Infinite Role -&gt; [Role]
forall a. Infinite a -&gt; [a]
</span><a href="GHC.Data.List.Infinite.html#toList"><span class="hs-identifier hs-var">Inf.toList</span></a></span><span> </span><span class="annot"><span class="annottext">Infinite Role
</span><a href="#local-6989586621682577988"><span class="hs-identifier hs-var">rs</span></a></span><span> </span><span class="hs-special">]</span><span>
</span><span id="line-421"></span><span>     </span><span class="hs-comment">-- Remember, SelTyCon is zero-indexed</span><span>
</span><span id="line-422"></span><span>
</span><span id="line-423"></span><span class="annot"><a href="GHC.Core.Coercion.html#decomposeFunCo"><span class="hs-identifier hs-type">decomposeFunCo</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Utils.Misc.html#HasDebugCallStack"><span class="hs-identifier hs-type">HasDebugCallStack</span></a></span><span>
</span><span id="line-424"></span><span>               </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#Coercion"><span class="hs-identifier hs-type">Coercion</span></a></span><span>  </span><span class="hs-comment">-- Input coercion</span><span>
</span><span id="line-425"></span><span>               </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#CoercionN"><span class="hs-identifier hs-type">CoercionN</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#Coercion"><span class="hs-identifier hs-type">Coercion</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#Coercion"><span class="hs-identifier hs-type">Coercion</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-426"></span><span class="hs-comment">-- Expects co :: (s1 %m1-&gt; t1) ~ (s2 %m2-&gt; t2)</span><span>
</span><span id="line-427"></span><span class="hs-comment">-- Returns (cow :: m1 ~N m2, co1 :: s1~s2, co2 :: t1~t2)</span><span>
</span><span id="line-428"></span><span class="hs-comment">-- actually cow will be a Phantom coercion if the input is a Phantom coercion</span><span>
</span><span id="line-429"></span><span>
</span><span id="line-430"></span><span id="decomposeFunCo"><span class="annot"><span class="annottext">decomposeFunCo :: HasDebugCallStack =&gt; Coercion -&gt; (Coercion, Coercion, Coercion)
</span><a href="GHC.Core.Coercion.html#decomposeFunCo"><span class="hs-identifier hs-var hs-var">decomposeFunCo</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#FunCo"><span class="hs-identifier hs-type">FunCo</span></a></span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">fco_mult :: Coercion -&gt; Coercion
</span><a href="GHC.Core.TyCo.Rep.html#fco_mult"><span class="hs-identifier hs-var">fco_mult</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="local-6989586621682578003"><span class="annot"><span class="annottext">Coercion
</span><a href="#local-6989586621682578003"><span class="hs-identifier hs-var">w</span></a></span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">fco_arg :: Coercion -&gt; Coercion
</span><a href="GHC.Core.TyCo.Rep.html#fco_arg"><span class="hs-identifier hs-var">fco_arg</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="local-6989586621682578005"><span class="annot"><span class="annottext">Coercion
</span><a href="#local-6989586621682578005"><span class="hs-identifier hs-var">co1</span></a></span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">fco_res :: Coercion -&gt; Coercion
</span><a href="GHC.Core.TyCo.Rep.html#fco_res"><span class="hs-identifier hs-var">fco_res</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="local-6989586621682578007"><span class="annot"><span class="annottext">Coercion
</span><a href="#local-6989586621682578007"><span class="hs-identifier hs-var">co2</span></a></span></span><span> </span><span class="hs-special">}</span><span class="hs-special">)</span><span>
</span><span id="line-431"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Coercion
</span><a href="#local-6989586621682578003"><span class="hs-identifier hs-var">w</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Coercion
</span><a href="#local-6989586621682578005"><span class="hs-identifier hs-var">co1</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Coercion
</span><a href="#local-6989586621682578007"><span class="hs-identifier hs-var">co2</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-432"></span><span>   </span><span class="hs-comment">-- Short-circuits the calls to mkSelCo</span><span>
</span><span id="line-433"></span><span>
</span><span id="line-434"></span><span class="annot"><a href="GHC.Core.Coercion.html#decomposeFunCo"><span class="hs-identifier hs-var">decomposeFunCo</span></a></span><span> </span><span id="local-6989586621682578008"><span class="annot"><span class="annottext">Coercion
</span><a href="#local-6989586621682578008"><span class="hs-identifier hs-var">co</span></a></span></span><span>
</span><span id="line-435"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Bool
-&gt; SDoc
-&gt; (Coercion, Coercion, Coercion)
-&gt; (Coercion, Coercion, Coercion)
forall a. HasCallStack =&gt; Bool -&gt; SDoc -&gt; a -&gt; a
</span><a href="GHC.Utils.Panic.html#assertPpr"><span class="hs-identifier hs-var">assertPpr</span></a></span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621682578010"><span class="hs-identifier hs-var">all_ok</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Coercion -&gt; SDoc
forall a. Outputable a =&gt; a -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="annot"><span class="annottext">Coercion
</span><a href="#local-6989586621682578008"><span class="hs-identifier hs-var">co</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">((Coercion, Coercion, Coercion) -&gt; (Coercion, Coercion, Coercion))
-&gt; (Coercion, Coercion, Coercion) -&gt; (Coercion, Coercion, Coercion)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-436"></span><span>    </span><span class="hs-special">(</span><span> </span><span class="annot"><span class="annottext">HasDebugCallStack =&gt; CoSel -&gt; Coercion -&gt; Coercion
CoSel -&gt; Coercion -&gt; Coercion
</span><a href="GHC.Core.Coercion.html#mkSelCo"><span class="hs-identifier hs-var">mkSelCo</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">FunSel -&gt; CoSel
</span><a href="GHC.Core.TyCo.Rep.html#SelFun"><span class="hs-identifier hs-var">SelFun</span></a></span><span> </span><span class="annot"><span class="annottext">FunSel
</span><a href="GHC.Core.TyCo.Rep.html#SelMult"><span class="hs-identifier hs-var">SelMult</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Coercion
</span><a href="#local-6989586621682578008"><span class="hs-identifier hs-var">co</span></a></span><span>
</span><span id="line-437"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">HasDebugCallStack =&gt; CoSel -&gt; Coercion -&gt; Coercion
CoSel -&gt; Coercion -&gt; Coercion
</span><a href="GHC.Core.Coercion.html#mkSelCo"><span class="hs-identifier hs-var">mkSelCo</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">FunSel -&gt; CoSel
</span><a href="GHC.Core.TyCo.Rep.html#SelFun"><span class="hs-identifier hs-var">SelFun</span></a></span><span> </span><span class="annot"><span class="annottext">FunSel
</span><a href="GHC.Core.TyCo.Rep.html#SelArg"><span class="hs-identifier hs-var">SelArg</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Coercion
</span><a href="#local-6989586621682578008"><span class="hs-identifier hs-var">co</span></a></span><span>
</span><span id="line-438"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">HasDebugCallStack =&gt; CoSel -&gt; Coercion -&gt; Coercion
CoSel -&gt; Coercion -&gt; Coercion
</span><a href="GHC.Core.Coercion.html#mkSelCo"><span class="hs-identifier hs-var">mkSelCo</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">FunSel -&gt; CoSel
</span><a href="GHC.Core.TyCo.Rep.html#SelFun"><span class="hs-identifier hs-var">SelFun</span></a></span><span> </span><span class="annot"><span class="annottext">FunSel
</span><a href="GHC.Core.TyCo.Rep.html#SelRes"><span class="hs-identifier hs-var">SelRes</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Coercion
</span><a href="#local-6989586621682578008"><span class="hs-identifier hs-var">co</span></a></span><span> </span><span class="hs-special">)</span><span>
</span><span id="line-439"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-440"></span><span>    </span><span class="annot"><a href="GHC.Data.Pair.html#Pair"><span class="hs-identifier hs-type">Pair</span></a></span><span> </span><span id="local-6989586621682578016"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682578016"><span class="hs-identifier hs-var">s1t1</span></a></span></span><span> </span><span id="local-6989586621682578017"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682578017"><span class="hs-identifier hs-var">s2t2</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">HasDebugCallStack =&gt; Coercion -&gt; Pair Type
Coercion -&gt; Pair Type
</span><a href="GHC.Core.Coercion.html#coercionKind"><span class="hs-identifier hs-var">coercionKind</span></a></span><span> </span><span class="annot"><span class="annottext">Coercion
</span><a href="#local-6989586621682578008"><span class="hs-identifier hs-var">co</span></a></span><span>
</span><span id="line-441"></span><span>    </span><span id="local-6989586621682578010"><span class="annot"><span class="annottext">all_ok :: Bool
</span><a href="#local-6989586621682578010"><span class="hs-identifier hs-var hs-var">all_ok</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Type -&gt; Bool
</span><a href="GHC.Core.Type.html#isFunTy"><span class="hs-identifier hs-var">isFunTy</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682578016"><span class="hs-identifier hs-var">s1t1</span></a></span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Bool -&gt; Bool
</span><span class="hs-operator hs-var">&amp;&amp;</span></span><span> </span><span class="annot"><span class="annottext">Type -&gt; Bool
</span><a href="GHC.Core.Type.html#isFunTy"><span class="hs-identifier hs-var">isFunTy</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682578017"><span class="hs-identifier hs-var">s2t2</span></a></span><span>
</span><span id="line-442"></span><span>
</span><span id="line-443"></span><span class="hs-comment">{- Note [Pushing a coercion into a pi-type]
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
Suppose we have this:
    (f |&gt; co) t1 .. tn
Then we want to push the coercion into the arguments, so as to make
progress. For example of why you might want to do so, see Note
[Respecting definitional equality] in GHC.Core.TyCo.Rep.

This is done by decomposePiCos.  Specifically, if
    decomposePiCos co [t1,..,tn] = ([co1,...,cok], cor)
then
    (f |&gt; co) t1 .. tn   =   (f (t1 |&gt; co1) ... (tk |&gt; cok)) |&gt; cor) t(k+1) ... tn

Notes:

* k can be smaller than n! That is decomposePiCos can return *fewer*
  coercions than there are arguments (ie k &lt; n), if the kind provided
  doesn't have enough binders.

* If there is a type error, we might see
       (f |&gt; co) t1
  where co :: (forall a. ty) ~ (ty1 -&gt; ty2)
  Here 'co' is insoluble, but we don't want to crash in decoposePiCos.
  So decomposePiCos carefully tests both sides of the coercion to check
  they are both foralls or both arrows.  Not doing this caused #15343.
-}</span><span>
</span><span id="line-469"></span><span>
</span><span id="line-470"></span><span class="annot"><a href="GHC.Core.Coercion.html#decomposePiCos"><span class="hs-identifier hs-type">decomposePiCos</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Utils.Misc.html#HasDebugCallStack"><span class="hs-identifier hs-type">HasDebugCallStack</span></a></span><span>
</span><span id="line-471"></span><span>               </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#CoercionN"><span class="hs-identifier hs-type">CoercionN</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Data.Pair.html#Pair"><span class="hs-identifier hs-type">Pair</span></a></span><span> </span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#Type"><span class="hs-identifier hs-type">Type</span></a></span><span>  </span><span class="hs-comment">-- Coercion and its kind</span><span>
</span><span id="line-472"></span><span>               </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#Type"><span class="hs-identifier hs-type">Type</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-473"></span><span>               </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="hs-special">[</span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#CoercionN"><span class="hs-identifier hs-type">CoercionN</span></a></span><span class="hs-special">]</span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#CoercionN"><span class="hs-identifier hs-type">CoercionN</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-474"></span><span class="hs-comment">-- See Note [Pushing a coercion into a pi-type]</span><span>
</span><span id="line-475"></span><span id="decomposePiCos"><span class="annot"><span class="annottext">decomposePiCos :: HasDebugCallStack =&gt;
Coercion -&gt; Pair Type -&gt; [Type] -&gt; ([Coercion], Coercion)
</span><a href="GHC.Core.Coercion.html#decomposePiCos"><span class="hs-identifier hs-var hs-var">decomposePiCos</span></a></span></span><span> </span><span id="local-6989586621682578027"><span class="annot"><span class="annottext">Coercion
</span><a href="#local-6989586621682578027"><span class="hs-identifier hs-var">orig_co</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Data.Pair.html#Pair"><span class="hs-identifier hs-type">Pair</span></a></span><span> </span><span id="local-6989586621682578028"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682578028"><span class="hs-identifier hs-var">orig_k1</span></a></span></span><span> </span><span id="local-6989586621682578029"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682578029"><span class="hs-identifier hs-var">orig_k2</span></a></span></span><span class="hs-special">)</span><span> </span><span id="local-6989586621682578030"><span class="annot"><span class="annottext">[Type]
</span><a href="#local-6989586621682578030"><span class="hs-identifier hs-var">orig_args</span></a></span></span><span>
</span><span id="line-476"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[Coercion]
-&gt; (Subst, Type)
-&gt; Coercion
-&gt; (Subst, Type)
-&gt; [Type]
-&gt; ([Coercion], Coercion)
</span><a href="#local-6989586621682578031"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Subst
</span><a href="#local-6989586621682578032"><span class="hs-identifier hs-var">orig_subst</span></a></span><span class="hs-special">,</span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682578028"><span class="hs-identifier hs-var">orig_k1</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Coercion
</span><a href="#local-6989586621682578027"><span class="hs-identifier hs-var">orig_co</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Subst
</span><a href="#local-6989586621682578032"><span class="hs-identifier hs-var">orig_subst</span></a></span><span class="hs-special">,</span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682578029"><span class="hs-identifier hs-var">orig_k2</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[Type]
</span><a href="#local-6989586621682578030"><span class="hs-identifier hs-var">orig_args</span></a></span><span>
</span><span id="line-477"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-478"></span><span>    </span><span id="local-6989586621682578032"><span class="annot"><span class="annottext">orig_subst :: Subst
</span><a href="#local-6989586621682578032"><span class="hs-identifier hs-var hs-var">orig_subst</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">InScopeSet -&gt; Subst
</span><a href="GHC.Core.TyCo.Subst.html#mkEmptySubst"><span class="hs-identifier hs-var">mkEmptySubst</span></a></span><span> </span><span class="annot"><span class="annottext">(InScopeSet -&gt; Subst) -&gt; InScopeSet -&gt; Subst
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">VarSet -&gt; InScopeSet
</span><a href="GHC.Types.Var.Env.html#mkInScopeSet"><span class="hs-identifier hs-var">mkInScopeSet</span></a></span><span> </span><span class="annot"><span class="annottext">(VarSet -&gt; InScopeSet) -&gt; VarSet -&gt; InScopeSet
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-479"></span><span>                 </span><span class="annot"><span class="annottext">[Type] -&gt; VarSet
</span><a href="GHC.Core.TyCo.FVs.html#tyCoVarsOfTypes"><span class="hs-identifier hs-var">tyCoVarsOfTypes</span></a></span><span> </span><span class="annot"><span class="annottext">[Type]
</span><a href="#local-6989586621682578030"><span class="hs-identifier hs-var">orig_args</span></a></span><span> </span><span class="annot"><span class="annottext">VarSet -&gt; VarSet -&gt; VarSet
</span><a href="GHC.Types.Var.Set.html#unionVarSet"><span class="hs-operator hs-var">`unionVarSet`</span></a></span><span> </span><span class="annot"><span class="annottext">Coercion -&gt; VarSet
</span><a href="GHC.Core.TyCo.FVs.html#tyCoVarsOfCo"><span class="hs-identifier hs-var">tyCoVarsOfCo</span></a></span><span> </span><span class="annot"><span class="annottext">Coercion
</span><a href="#local-6989586621682578027"><span class="hs-identifier hs-var">orig_co</span></a></span><span>
</span><span id="line-480"></span><span>
</span><span id="line-481"></span><span>    </span><span class="annot"><a href="#local-6989586621682578031"><span class="hs-identifier hs-type">go</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#CoercionN"><span class="hs-identifier hs-type">CoercionN</span></a></span><span class="hs-special">]</span><span>      </span><span class="hs-comment">-- accumulator for argument coercions, reversed</span><span>
</span><span id="line-482"></span><span>       </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Core.TyCo.Subst.html#Subst"><span class="hs-identifier hs-type">Subst</span></a></span><span class="hs-special">,</span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#Kind"><span class="hs-identifier hs-type">Kind</span></a></span><span class="hs-special">)</span><span>  </span><span class="hs-comment">-- Lhs kind of coercion</span><span>
</span><span id="line-483"></span><span>       </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#CoercionN"><span class="hs-identifier hs-type">CoercionN</span></a></span><span>        </span><span class="hs-comment">-- coercion originally applied to the function</span><span>
</span><span id="line-484"></span><span>       </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Core.TyCo.Subst.html#Subst"><span class="hs-identifier hs-type">Subst</span></a></span><span class="hs-special">,</span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#Kind"><span class="hs-identifier hs-type">Kind</span></a></span><span class="hs-special">)</span><span>  </span><span class="hs-comment">-- Rhs kind of coercion</span><span>
</span><span id="line-485"></span><span>       </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#Type"><span class="hs-identifier hs-type">Type</span></a></span><span class="hs-special">]</span><span>           </span><span class="hs-comment">-- Arguments to that function</span><span>
</span><span id="line-486"></span><span>       </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="hs-special">[</span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#CoercionN"><span class="hs-identifier hs-type">CoercionN</span></a></span><span class="hs-special">]</span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#Coercion"><span class="hs-identifier hs-type">Coercion</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-487"></span><span>    </span><span class="hs-comment">-- Invariant:  co :: subst1(k1) ~ subst2(k2)</span><span>
</span><span id="line-488"></span><span>
</span><span id="line-489"></span><span>    </span><span id="local-6989586621682578031"><span class="annot"><span class="annottext">go :: [Coercion]
-&gt; (Subst, Type)
-&gt; Coercion
-&gt; (Subst, Type)
-&gt; [Type]
-&gt; ([Coercion], Coercion)
</span><a href="#local-6989586621682578031"><span class="hs-identifier hs-var hs-var">go</span></a></span></span><span> </span><span id="local-6989586621682578038"><span class="annot"><span class="annottext">[Coercion]
</span><a href="#local-6989586621682578038"><span class="hs-identifier hs-var">acc_arg_cos</span></a></span></span><span> </span><span class="hs-special">(</span><span id="local-6989586621682578039"><span class="annot"><span class="annottext">Subst
</span><a href="#local-6989586621682578039"><span class="hs-identifier hs-var">subst1</span></a></span></span><span class="hs-special">,</span><span id="local-6989586621682578040"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682578040"><span class="hs-identifier hs-var">k1</span></a></span></span><span class="hs-special">)</span><span> </span><span id="local-6989586621682578041"><span class="annot"><span class="annottext">Coercion
</span><a href="#local-6989586621682578041"><span class="hs-identifier hs-var">co</span></a></span></span><span> </span><span class="hs-special">(</span><span id="local-6989586621682578042"><span class="annot"><span class="annottext">Subst
</span><a href="#local-6989586621682578042"><span class="hs-identifier hs-var">subst2</span></a></span></span><span class="hs-special">,</span><span id="local-6989586621682578043"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682578043"><span class="hs-identifier hs-var">k2</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span id="local-6989586621682578044"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682578044"><span class="hs-identifier hs-var">ty</span></a></span></span><span class="annot"><span class="hs-glyph hs-type">:</span></span><span id="local-6989586621682578045"><span class="annot"><span class="annottext">[Type]
</span><a href="#local-6989586621682578045"><span class="hs-identifier hs-var">tys</span></a></span></span><span class="hs-special">)</span><span>
</span><span id="line-490"></span><span>      </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span class="hs-special">(</span><span id="local-6989586621682578046"><span class="annot"><span class="annottext">CoVar
</span><a href="#local-6989586621682578046"><span class="hs-identifier hs-var">a</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682578047"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682578047"><span class="hs-identifier hs-var">t1</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Type -&gt; Maybe (CoVar, Type)
</span><a href="GHC.Core.Type.html#splitForAllTyCoVar_maybe"><span class="hs-identifier hs-var">splitForAllTyCoVar_maybe</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682578040"><span class="hs-identifier hs-var">k1</span></a></span><span>
</span><span id="line-491"></span><span>      </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span class="hs-special">(</span><span id="local-6989586621682578049"><span class="annot"><span class="annottext">CoVar
</span><a href="#local-6989586621682578049"><span class="hs-identifier hs-var">b</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682578050"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682578050"><span class="hs-identifier hs-var">t2</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Type -&gt; Maybe (CoVar, Type)
</span><a href="GHC.Core.Type.html#splitForAllTyCoVar_maybe"><span class="hs-identifier hs-var">splitForAllTyCoVar_maybe</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682578043"><span class="hs-identifier hs-var">k2</span></a></span><span>
</span><span id="line-492"></span><span>        </span><span class="hs-comment">-- know     co :: (forall a:s1.t1) ~ (forall b:s2.t2)</span><span>
</span><span id="line-493"></span><span>        </span><span class="hs-comment">--    function :: forall a:s1.t1   (the function is not passed to decomposePiCos)</span><span>
</span><span id="line-494"></span><span>        </span><span class="hs-comment">--           a :: s1</span><span>
</span><span id="line-495"></span><span>        </span><span class="hs-comment">--           b :: s2</span><span>
</span><span id="line-496"></span><span>        </span><span class="hs-comment">--          ty :: s2</span><span>
</span><span id="line-497"></span><span>        </span><span class="hs-comment">-- need arg_co :: s2 ~ s1</span><span>
</span><span id="line-498"></span><span>        </span><span class="hs-comment">--      res_co :: t1[ty |&gt; arg_co / a] ~ t2[ty / b]</span><span>
</span><span id="line-499"></span><span>      </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621682578051"><span class="annot"><span class="annottext">arg_co :: Coercion
</span><a href="#local-6989586621682578051"><span class="hs-identifier hs-var hs-var">arg_co</span></a></span></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">HasDebugCallStack =&gt; CoSel -&gt; Coercion -&gt; Coercion
CoSel -&gt; Coercion -&gt; Coercion
</span><a href="GHC.Core.Coercion.html#mkSelCo"><span class="hs-identifier hs-var">mkSelCo</span></a></span><span> </span><span class="annot"><span class="annottext">CoSel
</span><a href="GHC.Core.TyCo.Rep.html#SelForAll"><span class="hs-identifier hs-var">SelForAll</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Coercion -&gt; Coercion
</span><a href="GHC.Core.Coercion.html#mkSymCo"><span class="hs-identifier hs-var">mkSymCo</span></a></span><span> </span><span class="annot"><span class="annottext">Coercion
</span><a href="#local-6989586621682578041"><span class="hs-identifier hs-var">co</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-500"></span><span>            </span><span id="local-6989586621682578053"><span class="annot"><span class="annottext">res_co :: Coercion
</span><a href="#local-6989586621682578053"><span class="hs-identifier hs-var hs-var">res_co</span></a></span></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Coercion -&gt; Coercion -&gt; Coercion
</span><a href="GHC.Core.Coercion.html#mkInstCo"><span class="hs-identifier hs-var">mkInstCo</span></a></span><span> </span><span class="annot"><span class="annottext">Coercion
</span><a href="#local-6989586621682578041"><span class="hs-identifier hs-var">co</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Role -&gt; Type -&gt; Coercion -&gt; Coercion
</span><a href="GHC.Core.Coercion.html#mkGReflLeftCo"><span class="hs-identifier hs-var">mkGReflLeftCo</span></a></span><span> </span><span class="annot"><span class="annottext">Role
</span><a href="Language.Haskell.Syntax.Basic.html#Nominal"><span class="hs-identifier hs-var">Nominal</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682578044"><span class="hs-identifier hs-var">ty</span></a></span><span> </span><span class="annot"><span class="annottext">Coercion
</span><a href="#local-6989586621682578051"><span class="hs-identifier hs-var">arg_co</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-501"></span><span>            </span><span id="local-6989586621682578054"><span class="annot"><span class="annottext">subst1' :: Subst
</span><a href="#local-6989586621682578054"><span class="hs-identifier hs-var hs-var">subst1'</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Subst -&gt; CoVar -&gt; Type -&gt; Subst
</span><a href="GHC.Core.TyCo.Subst.html#extendTCvSubst"><span class="hs-identifier hs-var">extendTCvSubst</span></a></span><span> </span><span class="annot"><span class="annottext">Subst
</span><a href="#local-6989586621682578039"><span class="hs-identifier hs-var">subst1</span></a></span><span> </span><span class="annot"><span class="annottext">CoVar
</span><a href="#local-6989586621682578046"><span class="hs-identifier hs-var">a</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682578044"><span class="hs-identifier hs-var">ty</span></a></span><span> </span><span class="annot"><span class="annottext">Type -&gt; Coercion -&gt; Type
</span><a href="GHC.Core.TyCo.Rep.html#CastTy"><span class="hs-operator hs-var">`CastTy`</span></a></span><span> </span><span class="annot"><span class="annottext">Coercion
</span><a href="#local-6989586621682578051"><span class="hs-identifier hs-var">arg_co</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-502"></span><span>            </span><span id="local-6989586621682578057"><span class="annot"><span class="annottext">subst2' :: Subst
</span><a href="#local-6989586621682578057"><span class="hs-identifier hs-var hs-var">subst2'</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Subst -&gt; CoVar -&gt; Type -&gt; Subst
</span><a href="GHC.Core.TyCo.Subst.html#extendTCvSubst"><span class="hs-identifier hs-var">extendTCvSubst</span></a></span><span> </span><span class="annot"><span class="annottext">Subst
</span><a href="#local-6989586621682578042"><span class="hs-identifier hs-var">subst2</span></a></span><span> </span><span class="annot"><span class="annottext">CoVar
</span><a href="#local-6989586621682578049"><span class="hs-identifier hs-var">b</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682578044"><span class="hs-identifier hs-var">ty</span></a></span><span>
</span><span id="line-503"></span><span>        </span><span class="hs-keyword">in</span><span>
</span><span id="line-504"></span><span>        </span><span class="annot"><span class="annottext">[Coercion]
-&gt; (Subst, Type)
-&gt; Coercion
-&gt; (Subst, Type)
-&gt; [Type]
-&gt; ([Coercion], Coercion)
</span><a href="#local-6989586621682578031"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Coercion
</span><a href="#local-6989586621682578051"><span class="hs-identifier hs-var">arg_co</span></a></span><span> </span><span class="annot"><span class="annottext">Coercion -&gt; [Coercion] -&gt; [Coercion]
forall a. a -&gt; [a] -&gt; [a]
</span><span class="hs-glyph hs-var">:</span></span><span> </span><span class="annot"><span class="annottext">[Coercion]
</span><a href="#local-6989586621682578038"><span class="hs-identifier hs-var">acc_arg_cos</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Subst
</span><a href="#local-6989586621682578054"><span class="hs-identifier hs-var">subst1'</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682578047"><span class="hs-identifier hs-var">t1</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Coercion
</span><a href="#local-6989586621682578053"><span class="hs-identifier hs-var">res_co</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Subst
</span><a href="#local-6989586621682578057"><span class="hs-identifier hs-var">subst2'</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682578050"><span class="hs-identifier hs-var">t2</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[Type]
</span><a href="#local-6989586621682578045"><span class="hs-identifier hs-var">tys</span></a></span><span>
</span><span id="line-505"></span><span>
</span><span id="line-506"></span><span>      </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span class="hs-special">(</span><span id="local-6989586621682578058"><span class="annot"><span class="annottext">FunTyFlag
</span><a href="#local-6989586621682578058"><span class="hs-identifier hs-var">af1</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682578059"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682578059"><span class="hs-identifier hs-var">_w1</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682578060"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682578060"><span class="hs-identifier hs-var">_s1</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682578061"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682578061"><span class="hs-identifier hs-var">t1</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Type -&gt; Maybe (FunTyFlag, Type, Type, Type)
</span><a href="GHC.Core.Type.html#splitFunTy_maybe"><span class="hs-identifier hs-var">splitFunTy_maybe</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682578040"><span class="hs-identifier hs-var">k1</span></a></span><span>
</span><span id="line-507"></span><span>      </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span class="hs-special">(</span><span id="local-6989586621682578063"><span class="annot"><span class="annottext">FunTyFlag
</span><a href="#local-6989586621682578063"><span class="hs-identifier hs-var">af2</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682578064"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682578064"><span class="hs-identifier hs-var">_w1</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682578065"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682578065"><span class="hs-identifier hs-var">_s2</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682578066"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682578066"><span class="hs-identifier hs-var">t2</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Type -&gt; Maybe (FunTyFlag, Type, Type, Type)
</span><a href="GHC.Core.Type.html#splitFunTy_maybe"><span class="hs-identifier hs-var">splitFunTy_maybe</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682578043"><span class="hs-identifier hs-var">k2</span></a></span><span>
</span><span id="line-508"></span><span>      </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">FunTyFlag
</span><a href="#local-6989586621682578058"><span class="hs-identifier hs-var">af1</span></a></span><span> </span><span class="annot"><span class="annottext">FunTyFlag -&gt; FunTyFlag -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">==</span></span><span> </span><span class="annot"><span class="annottext">FunTyFlag
</span><a href="#local-6989586621682578063"><span class="hs-identifier hs-var">af2</span></a></span><span>  </span><span class="hs-comment">-- Same sort of arrow</span><span>
</span><span id="line-509"></span><span>        </span><span class="hs-comment">-- know     co :: (s1 -&gt; t1) ~ (s2 -&gt; t2)</span><span>
</span><span id="line-510"></span><span>        </span><span class="hs-comment">--    function :: s1 -&gt; t1</span><span>
</span><span id="line-511"></span><span>        </span><span class="hs-comment">--          ty :: s2</span><span>
</span><span id="line-512"></span><span>        </span><span class="hs-comment">-- need arg_co :: s2 ~ s1</span><span>
</span><span id="line-513"></span><span>        </span><span class="hs-comment">--      res_co :: t1 ~ t2</span><span>
</span><span id="line-514"></span><span>      </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">let</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Coercion
</span><span class="hs-identifier">_</span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682578067"><span class="annot"><span class="annottext">Coercion
</span><a href="#local-6989586621682578067"><span class="hs-identifier hs-var">sym_arg_co</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682578068"><span class="annot"><span class="annottext">Coercion
</span><a href="#local-6989586621682578068"><span class="hs-identifier hs-var">res_co</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">HasDebugCallStack =&gt; Coercion -&gt; (Coercion, Coercion, Coercion)
Coercion -&gt; (Coercion, Coercion, Coercion)
</span><a href="GHC.Core.Coercion.html#decomposeFunCo"><span class="hs-identifier hs-var">decomposeFunCo</span></a></span><span> </span><span class="annot"><span class="annottext">Coercion
</span><a href="#local-6989586621682578041"><span class="hs-identifier hs-var">co</span></a></span><span>
</span><span id="line-515"></span><span>            </span><span class="hs-comment">-- It should be fine to ignore the multiplicity bit</span><span>
</span><span id="line-516"></span><span>            </span><span class="hs-comment">-- of the coercion for a Nominal coercion.</span><span>
</span><span id="line-517"></span><span>            </span><span id="local-6989586621682578069"><span class="annot"><span class="annottext">arg_co :: Coercion
</span><a href="#local-6989586621682578069"><span class="hs-identifier hs-var hs-var">arg_co</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Coercion -&gt; Coercion
</span><a href="GHC.Core.Coercion.html#mkSymCo"><span class="hs-identifier hs-var">mkSymCo</span></a></span><span> </span><span class="annot"><span class="annottext">Coercion
</span><a href="#local-6989586621682578067"><span class="hs-identifier hs-var">sym_arg_co</span></a></span><span>
</span><span id="line-518"></span><span>        </span><span class="hs-keyword">in</span><span>
</span><span id="line-519"></span><span>        </span><span class="annot"><span class="annottext">[Coercion]
-&gt; (Subst, Type)
-&gt; Coercion
-&gt; (Subst, Type)
-&gt; [Type]
-&gt; ([Coercion], Coercion)
</span><a href="#local-6989586621682578031"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Coercion
</span><a href="#local-6989586621682578069"><span class="hs-identifier hs-var">arg_co</span></a></span><span> </span><span class="annot"><span class="annottext">Coercion -&gt; [Coercion] -&gt; [Coercion]
forall a. a -&gt; [a] -&gt; [a]
</span><span class="hs-glyph hs-var">:</span></span><span> </span><span class="annot"><span class="annottext">[Coercion]
</span><a href="#local-6989586621682578038"><span class="hs-identifier hs-var">acc_arg_cos</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Subst
</span><a href="#local-6989586621682578039"><span class="hs-identifier hs-var">subst1</span></a></span><span class="hs-special">,</span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682578061"><span class="hs-identifier hs-var">t1</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Coercion
</span><a href="#local-6989586621682578068"><span class="hs-identifier hs-var">res_co</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Subst
</span><a href="#local-6989586621682578042"><span class="hs-identifier hs-var">subst2</span></a></span><span class="hs-special">,</span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682578066"><span class="hs-identifier hs-var">t2</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[Type]
</span><a href="#local-6989586621682578045"><span class="hs-identifier hs-var">tys</span></a></span><span>
</span><span id="line-520"></span><span>
</span><span id="line-521"></span><span>      </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Bool
</span><span class="hs-identifier hs-var">not</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Subst -&gt; Bool
</span><a href="GHC.Core.TyCo.Subst.html#isEmptyTCvSubst"><span class="hs-identifier hs-var">isEmptyTCvSubst</span></a></span><span> </span><span class="annot"><span class="annottext">Subst
</span><a href="#local-6989586621682578039"><span class="hs-identifier hs-var">subst1</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Bool -&gt; Bool
</span><span class="hs-operator hs-var">||</span></span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Bool
</span><span class="hs-identifier hs-var">not</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Subst -&gt; Bool
</span><a href="GHC.Core.TyCo.Subst.html#isEmptyTCvSubst"><span class="hs-identifier hs-var">isEmptyTCvSubst</span></a></span><span> </span><span class="annot"><span class="annottext">Subst
</span><a href="#local-6989586621682578042"><span class="hs-identifier hs-var">subst2</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-522"></span><span>      </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[Coercion]
-&gt; (Subst, Type)
-&gt; Coercion
-&gt; (Subst, Type)
-&gt; [Type]
-&gt; ([Coercion], Coercion)
</span><a href="#local-6989586621682578031"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="annot"><span class="annottext">[Coercion]
</span><a href="#local-6989586621682578038"><span class="hs-identifier hs-var">acc_arg_cos</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Subst -&gt; Subst
</span><a href="GHC.Core.TyCo.Subst.html#zapSubst"><span class="hs-identifier hs-var">zapSubst</span></a></span><span> </span><span class="annot"><span class="annottext">Subst
</span><a href="#local-6989586621682578039"><span class="hs-identifier hs-var">subst1</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">HasDebugCallStack =&gt; Subst -&gt; Type -&gt; Type
Subst -&gt; Type -&gt; Type
</span><a href="GHC.Core.TyCo.Subst.html#substTy"><span class="hs-identifier hs-var">substTy</span></a></span><span> </span><span class="annot"><span class="annottext">Subst
</span><a href="#local-6989586621682578039"><span class="hs-identifier hs-var">subst1</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682578040"><span class="hs-identifier hs-var">k1</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-523"></span><span>                       </span><span class="annot"><span class="annottext">Coercion
</span><a href="#local-6989586621682578041"><span class="hs-identifier hs-var">co</span></a></span><span>
</span><span id="line-524"></span><span>                       </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Subst -&gt; Subst
</span><a href="GHC.Core.TyCo.Subst.html#zapSubst"><span class="hs-identifier hs-var">zapSubst</span></a></span><span> </span><span class="annot"><span class="annottext">Subst
</span><a href="#local-6989586621682578042"><span class="hs-identifier hs-var">subst2</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">HasDebugCallStack =&gt; Subst -&gt; Type -&gt; Type
Subst -&gt; Type -&gt; Type
</span><a href="GHC.Core.TyCo.Subst.html#substTy"><span class="hs-identifier hs-var">substTy</span></a></span><span> </span><span class="annot"><span class="annottext">Subst
</span><a href="#local-6989586621682578039"><span class="hs-identifier hs-var">subst1</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682578043"><span class="hs-identifier hs-var">k2</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-525"></span><span>                       </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682578044"><span class="hs-identifier hs-var">ty</span></a></span><span class="annot"><span class="annottext">Type -&gt; [Type] -&gt; [Type]
forall a. a -&gt; [a] -&gt; [a]
</span><span class="hs-glyph hs-var">:</span></span><span class="annot"><span class="annottext">[Type]
</span><a href="#local-6989586621682578045"><span class="hs-identifier hs-var">tys</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-526"></span><span>
</span><span id="line-527"></span><span>      </span><span class="hs-comment">-- tys might not be empty, if the left-hand type of the original coercion</span><span>
</span><span id="line-528"></span><span>      </span><span class="hs-comment">-- didn't have enough binders</span><span>
</span><span id="line-529"></span><span>    </span><span class="annot"><a href="#local-6989586621682578031"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span id="local-6989586621682578075"><span class="annot"><span class="annottext">[Coercion]
</span><a href="#local-6989586621682578075"><span class="hs-identifier hs-var">acc_arg_cos</span></a></span></span><span> </span><span id="local-6989586621682578076"><span class="annot"><span class="annottext">(Subst, Type)
</span><a href="#local-6989586621682578076"><span class="hs-identifier hs-var">_ki1</span></a></span></span><span> </span><span id="local-6989586621682578077"><span class="annot"><span class="annottext">Coercion
</span><a href="#local-6989586621682578077"><span class="hs-identifier hs-var">co</span></a></span></span><span> </span><span id="local-6989586621682578078"><span class="annot"><span class="annottext">(Subst, Type)
</span><a href="#local-6989586621682578078"><span class="hs-identifier hs-var">_ki2</span></a></span></span><span> </span><span id="local-6989586621682578079"><span class="annot"><span class="annottext">[Type]
</span><a href="#local-6989586621682578079"><span class="hs-identifier hs-var">_tys</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[Coercion] -&gt; [Coercion]
forall a. [a] -&gt; [a]
</span><span class="hs-identifier hs-var">reverse</span></span><span> </span><span class="annot"><span class="annottext">[Coercion]
</span><a href="#local-6989586621682578075"><span class="hs-identifier hs-var">acc_arg_cos</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Coercion
</span><a href="#local-6989586621682578077"><span class="hs-identifier hs-var">co</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-530"></span><span>
</span><span id="line-531"></span><span class="hs-comment">-- | Extract a covar, if possible. This check is dirty. Be ashamed</span><span>
</span><span id="line-532"></span><span class="hs-comment">-- of yourself. (It's dirty because it cares about the structure of</span><span>
</span><span id="line-533"></span><span class="hs-comment">-- a coercion, which is morally reprehensible.)</span><span>
</span><span id="line-534"></span><span class="annot"><a href="GHC.Core.Coercion.html#getCoVar_maybe"><span class="hs-identifier hs-type">getCoVar_maybe</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#Coercion"><span class="hs-identifier hs-type">Coercion</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Maybe</span></span><span> </span><span class="annot"><a href="GHC.Types.Var.html#CoVar"><span class="hs-identifier hs-type">CoVar</span></a></span><span>
</span><span id="line-535"></span><span id="getCoVar_maybe"><span class="annot"><span class="annottext">getCoVar_maybe :: Coercion -&gt; Maybe CoVar
</span><a href="GHC.Core.Coercion.html#getCoVar_maybe"><span class="hs-identifier hs-var hs-var">getCoVar_maybe</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#CoVarCo"><span class="hs-identifier hs-type">CoVarCo</span></a></span><span> </span><span id="local-6989586621682578081"><span class="annot"><span class="annottext">CoVar
</span><a href="#local-6989586621682578081"><span class="hs-identifier hs-var">cv</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">CoVar -&gt; Maybe CoVar
forall a. a -&gt; Maybe a
</span><span class="hs-identifier hs-var">Just</span></span><span> </span><span class="annot"><span class="annottext">CoVar
</span><a href="#local-6989586621682578081"><span class="hs-identifier hs-var">cv</span></a></span><span>
</span><span id="line-536"></span><span class="annot"><a href="GHC.Core.Coercion.html#getCoVar_maybe"><span class="hs-identifier hs-var">getCoVar_maybe</span></a></span><span> </span><span class="annot"><span class="annottext">Coercion
</span><span class="hs-identifier">_</span></span><span>            </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Maybe CoVar
forall a. Maybe a
</span><span class="hs-identifier hs-var">Nothing</span></span><span>
</span><span id="line-537"></span><span>
</span><span id="line-538"></span><span class="annot"><a href="GHC.Core.Coercion.html#multToCo"><span class="hs-identifier hs-type">multToCo</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#Mult"><span class="hs-identifier hs-type">Mult</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#Coercion"><span class="hs-identifier hs-type">Coercion</span></a></span><span>
</span><span id="line-539"></span><span id="multToCo"><span class="annot"><span class="annottext">multToCo :: Type -&gt; Coercion
</span><a href="GHC.Core.Coercion.html#multToCo"><span class="hs-identifier hs-var hs-var">multToCo</span></a></span></span><span> </span><span id="local-6989586621682578083"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682578083"><span class="hs-identifier hs-var">r</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Type -&gt; Coercion
</span><a href="GHC.Core.Coercion.html#mkNomReflCo"><span class="hs-identifier hs-var">mkNomReflCo</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682578083"><span class="hs-identifier hs-var">r</span></a></span><span>
</span><span id="line-540"></span><span>
</span><span id="line-541"></span><span class="hs-comment">-- first result has role equal to input; third result is Nominal</span><span>
</span><span id="line-542"></span><span class="annot"><a href="GHC.Core.Coercion.html#splitAppCo_maybe"><span class="hs-identifier hs-type">splitAppCo_maybe</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#Coercion"><span class="hs-identifier hs-type">Coercion</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Maybe</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#Coercion"><span class="hs-identifier hs-type">Coercion</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#Coercion"><span class="hs-identifier hs-type">Coercion</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-543"></span><span class="annot"><span class="hs-comment">-- ^ Attempt to take a coercion application apart.</span></span><span>
</span><span id="line-544"></span><span id="splitAppCo_maybe"><span class="annot"><span class="annottext">splitAppCo_maybe :: Coercion -&gt; Maybe (Coercion, Coercion)
</span><a href="GHC.Core.Coercion.html#splitAppCo_maybe"><span class="hs-identifier hs-var hs-var">splitAppCo_maybe</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#AppCo"><span class="hs-identifier hs-type">AppCo</span></a></span><span> </span><span id="local-6989586621682578085"><span class="annot"><span class="annottext">Coercion
</span><a href="#local-6989586621682578085"><span class="hs-identifier hs-var">co</span></a></span></span><span> </span><span id="local-6989586621682578086"><span class="annot"><span class="annottext">Coercion
</span><a href="#local-6989586621682578086"><span class="hs-identifier hs-var">arg</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(Coercion, Coercion) -&gt; Maybe (Coercion, Coercion)
forall a. a -&gt; Maybe a
</span><span class="hs-identifier hs-var">Just</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Coercion
</span><a href="#local-6989586621682578085"><span class="hs-identifier hs-var">co</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Coercion
</span><a href="#local-6989586621682578086"><span class="hs-identifier hs-var">arg</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-545"></span><span class="annot"><a href="GHC.Core.Coercion.html#splitAppCo_maybe"><span class="hs-identifier hs-var">splitAppCo_maybe</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#TyConAppCo"><span class="hs-identifier hs-type">TyConAppCo</span></a></span><span> </span><span id="local-6989586621682578088"><span class="annot"><span class="annottext">Role
</span><a href="#local-6989586621682578088"><span class="hs-identifier hs-var">r</span></a></span></span><span> </span><span id="local-6989586621682578089"><span class="annot"><span class="annottext">TyCon
</span><a href="#local-6989586621682578089"><span class="hs-identifier hs-var">tc</span></a></span></span><span> </span><span id="local-6989586621682578090"><span class="annot"><span class="annottext">[Coercion]
</span><a href="#local-6989586621682578090"><span class="hs-identifier hs-var">args</span></a></span></span><span class="hs-special">)</span><span>
</span><span id="line-546"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">[Coercion]
</span><a href="#local-6989586621682578090"><span class="hs-identifier hs-var">args</span></a></span><span> </span><span class="annot"><span class="annottext">[Coercion] -&gt; Arity -&gt; Bool
forall a. [a] -&gt; Arity -&gt; Bool
</span><a href="GHC.Utils.Misc.html#lengthExceeds"><span class="hs-operator hs-var">`lengthExceeds`</span></a></span><span> </span><span class="annot"><span class="annottext">TyCon -&gt; Arity
</span><a href="GHC.Core.TyCon.html#tyConArity"><span class="hs-identifier hs-var">tyConArity</span></a></span><span> </span><span class="annot"><span class="annottext">TyCon
</span><a href="#local-6989586621682578089"><span class="hs-identifier hs-var">tc</span></a></span><span>
</span><span id="line-547"></span><span>  </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span class="hs-special">(</span><span id="local-6989586621682578093"><span class="annot"><span class="annottext">[Coercion]
</span><a href="#local-6989586621682578093"><span class="hs-identifier hs-var">args'</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682578094"><span class="annot"><span class="annottext">Coercion
</span><a href="#local-6989586621682578094"><span class="hs-identifier hs-var">arg'</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">[Coercion] -&gt; Maybe ([Coercion], Coercion)
forall a. [a] -&gt; Maybe ([a], a)
</span><a href="GHC.Utils.Misc.html#snocView"><span class="hs-identifier hs-var">snocView</span></a></span><span> </span><span class="annot"><span class="annottext">[Coercion]
</span><a href="#local-6989586621682578090"><span class="hs-identifier hs-var">args</span></a></span><span>
</span><span id="line-548"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(Coercion, Coercion) -&gt; Maybe (Coercion, Coercion)
forall a. a -&gt; Maybe a
</span><span class="hs-identifier hs-var">Just</span></span><span> </span><span class="hs-special">(</span><span> </span><span class="annot"><span class="annottext">HasDebugCallStack =&gt; Role -&gt; TyCon -&gt; [Coercion] -&gt; Coercion
Role -&gt; TyCon -&gt; [Coercion] -&gt; Coercion
</span><a href="GHC.Core.Coercion.html#mkTyConAppCo"><span class="hs-identifier hs-var">mkTyConAppCo</span></a></span><span> </span><span class="annot"><span class="annottext">Role
</span><a href="#local-6989586621682578088"><span class="hs-identifier hs-var">r</span></a></span><span> </span><span class="annot"><span class="annottext">TyCon
</span><a href="#local-6989586621682578089"><span class="hs-identifier hs-var">tc</span></a></span><span> </span><span class="annot"><span class="annottext">[Coercion]
</span><a href="#local-6989586621682578093"><span class="hs-identifier hs-var">args'</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Coercion
</span><a href="#local-6989586621682578094"><span class="hs-identifier hs-var">arg'</span></a></span><span> </span><span class="hs-special">)</span><span>
</span><span id="line-549"></span><span>
</span><span id="line-550"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Bool
</span><span class="hs-identifier hs-var">not</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TyCon -&gt; Bool
</span><a href="GHC.Core.TyCon.html#tyConMustBeSaturated"><span class="hs-identifier hs-var">tyConMustBeSaturated</span></a></span><span> </span><span class="annot"><span class="annottext">TyCon
</span><a href="#local-6989586621682578089"><span class="hs-identifier hs-var">tc</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-551"></span><span>    </span><span class="hs-comment">-- Never create unsaturated type family apps!</span><span>
</span><span id="line-552"></span><span>  </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span class="hs-special">(</span><span id="local-6989586621682578097"><span class="annot"><span class="annottext">[Coercion]
</span><a href="#local-6989586621682578097"><span class="hs-identifier hs-var">args'</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682578098"><span class="annot"><span class="annottext">Coercion
</span><a href="#local-6989586621682578098"><span class="hs-identifier hs-var">arg'</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">[Coercion] -&gt; Maybe ([Coercion], Coercion)
forall a. [a] -&gt; Maybe ([a], a)
</span><a href="GHC.Utils.Misc.html#snocView"><span class="hs-identifier hs-var">snocView</span></a></span><span> </span><span class="annot"><span class="annottext">[Coercion]
</span><a href="#local-6989586621682578090"><span class="hs-identifier hs-var">args</span></a></span><span>
</span><span id="line-553"></span><span>  </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span id="local-6989586621682578099"><span class="annot"><span class="annottext">Coercion
</span><a href="#local-6989586621682578099"><span class="hs-identifier hs-var">arg''</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Role -&gt; Coercion -&gt; Maybe Coercion
</span><a href="GHC.Core.Coercion.html#setNominalRole_maybe"><span class="hs-identifier hs-var">setNominalRole_maybe</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Role -&gt; TyCon -&gt; Arity -&gt; Role
</span><a href="GHC.Core.Coercion.html#tyConRole"><span class="hs-identifier hs-var">tyConRole</span></a></span><span> </span><span class="annot"><span class="annottext">Role
</span><a href="#local-6989586621682578088"><span class="hs-identifier hs-var">r</span></a></span><span> </span><span class="annot"><span class="annottext">TyCon
</span><a href="#local-6989586621682578089"><span class="hs-identifier hs-var">tc</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[Coercion] -&gt; Arity
forall a. [a] -&gt; Arity
forall (t :: * -&gt; *) a. Foldable t =&gt; t a -&gt; Arity
</span><span class="hs-identifier hs-var">length</span></span><span> </span><span class="annot"><span class="annottext">[Coercion]
</span><a href="#local-6989586621682578097"><span class="hs-identifier hs-var">args'</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Coercion
</span><a href="#local-6989586621682578098"><span class="hs-identifier hs-var">arg'</span></a></span><span>
</span><span id="line-554"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(Coercion, Coercion) -&gt; Maybe (Coercion, Coercion)
forall a. a -&gt; Maybe a
</span><span class="hs-identifier hs-var">Just</span></span><span> </span><span class="hs-special">(</span><span> </span><span class="annot"><span class="annottext">HasDebugCallStack =&gt; Role -&gt; TyCon -&gt; [Coercion] -&gt; Coercion
Role -&gt; TyCon -&gt; [Coercion] -&gt; Coercion
</span><a href="GHC.Core.Coercion.html#mkTyConAppCo"><span class="hs-identifier hs-var">mkTyConAppCo</span></a></span><span> </span><span class="annot"><span class="annottext">Role
</span><a href="#local-6989586621682578088"><span class="hs-identifier hs-var">r</span></a></span><span> </span><span class="annot"><span class="annottext">TyCon
</span><a href="#local-6989586621682578089"><span class="hs-identifier hs-var">tc</span></a></span><span> </span><span class="annot"><span class="annottext">[Coercion]
</span><a href="#local-6989586621682578097"><span class="hs-identifier hs-var">args'</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Coercion
</span><a href="#local-6989586621682578099"><span class="hs-identifier hs-var">arg''</span></a></span><span> </span><span class="hs-special">)</span><span>
</span><span id="line-555"></span><span>       </span><span class="hs-comment">-- Use mkTyConAppCo to preserve the invariant</span><span>
</span><span id="line-556"></span><span>       </span><span class="hs-comment">--  that identity coercions are always represented by Refl</span><span>
</span><span id="line-557"></span><span>
</span><span id="line-558"></span><span class="annot"><a href="GHC.Core.Coercion.html#splitAppCo_maybe"><span class="hs-identifier hs-var">splitAppCo_maybe</span></a></span><span> </span><span id="local-6989586621682578101"><span class="annot"><span class="annottext">Coercion
</span><a href="#local-6989586621682578101"><span class="hs-identifier hs-var">co</span></a></span></span><span>
</span><span id="line-559"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span class="hs-special">(</span><span id="local-6989586621682578102"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682578102"><span class="hs-identifier hs-var">ty</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682578103"><span class="annot"><span class="annottext">Role
</span><a href="#local-6989586621682578103"><span class="hs-identifier hs-var">r</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Coercion -&gt; Maybe (Type, Role)
</span><a href="GHC.Core.Coercion.html#isReflCo_maybe"><span class="hs-identifier hs-var">isReflCo_maybe</span></a></span><span> </span><span class="annot"><span class="annottext">Coercion
</span><a href="#local-6989586621682578101"><span class="hs-identifier hs-var">co</span></a></span><span>
</span><span id="line-560"></span><span>  </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span class="hs-special">(</span><span id="local-6989586621682578104"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682578104"><span class="hs-identifier hs-var">ty1</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682578105"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682578105"><span class="hs-identifier hs-var">ty2</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Type -&gt; Maybe (Type, Type)
</span><a href="GHC.Core.Type.html#splitAppTy_maybe"><span class="hs-identifier hs-var">splitAppTy_maybe</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682578102"><span class="hs-identifier hs-var">ty</span></a></span><span>
</span><span id="line-561"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(Coercion, Coercion) -&gt; Maybe (Coercion, Coercion)
forall a. a -&gt; Maybe a
</span><span class="hs-identifier hs-var">Just</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Role -&gt; Type -&gt; Coercion
</span><a href="GHC.Core.Coercion.html#mkReflCo"><span class="hs-identifier hs-var">mkReflCo</span></a></span><span> </span><span class="annot"><span class="annottext">Role
</span><a href="#local-6989586621682578103"><span class="hs-identifier hs-var">r</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682578104"><span class="hs-identifier hs-var">ty1</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Type -&gt; Coercion
</span><a href="GHC.Core.Coercion.html#mkNomReflCo"><span class="hs-identifier hs-var">mkNomReflCo</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682578105"><span class="hs-identifier hs-var">ty2</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-562"></span><span class="annot"><a href="GHC.Core.Coercion.html#splitAppCo_maybe"><span class="hs-identifier hs-var">splitAppCo_maybe</span></a></span><span> </span><span class="annot"><span class="annottext">Coercion
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Maybe (Coercion, Coercion)
forall a. Maybe a
</span><span class="hs-identifier hs-var">Nothing</span></span><span>
</span><span id="line-563"></span><span>
</span><span id="line-564"></span><span class="hs-comment">-- Only used in specialise/Rules</span><span>
</span><span id="line-565"></span><span class="annot"><a href="GHC.Core.Coercion.html#splitFunCo_maybe"><span class="hs-identifier hs-type">splitFunCo_maybe</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#Coercion"><span class="hs-identifier hs-type">Coercion</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Maybe</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#Coercion"><span class="hs-identifier hs-type">Coercion</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#Coercion"><span class="hs-identifier hs-type">Coercion</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-566"></span><span id="splitFunCo_maybe"><span class="annot"><span class="annottext">splitFunCo_maybe :: Coercion -&gt; Maybe (Coercion, Coercion)
</span><a href="GHC.Core.Coercion.html#splitFunCo_maybe"><span class="hs-identifier hs-var hs-var">splitFunCo_maybe</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#FunCo"><span class="hs-identifier hs-type">FunCo</span></a></span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">fco_arg :: Coercion -&gt; Coercion
</span><a href="GHC.Core.TyCo.Rep.html#fco_arg"><span class="hs-identifier hs-var">fco_arg</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="local-6989586621682578107"><span class="annot"><span class="annottext">Coercion
</span><a href="#local-6989586621682578107"><span class="hs-identifier hs-var">arg</span></a></span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">fco_res :: Coercion -&gt; Coercion
</span><a href="GHC.Core.TyCo.Rep.html#fco_res"><span class="hs-identifier hs-var">fco_res</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="local-6989586621682578108"><span class="annot"><span class="annottext">Coercion
</span><a href="#local-6989586621682578108"><span class="hs-identifier hs-var">res</span></a></span></span><span> </span><span class="hs-special">}</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(Coercion, Coercion) -&gt; Maybe (Coercion, Coercion)
forall a. a -&gt; Maybe a
</span><span class="hs-identifier hs-var">Just</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Coercion
</span><a href="#local-6989586621682578107"><span class="hs-identifier hs-var">arg</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Coercion
</span><a href="#local-6989586621682578108"><span class="hs-identifier hs-var">res</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-567"></span><span class="annot"><a href="GHC.Core.Coercion.html#splitFunCo_maybe"><span class="hs-identifier hs-var">splitFunCo_maybe</span></a></span><span> </span><span class="annot"><span class="annottext">Coercion
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Maybe (Coercion, Coercion)
forall a. Maybe a
</span><span class="hs-identifier hs-var">Nothing</span></span><span>
</span><span id="line-568"></span><span>
</span><span id="line-569"></span><span class="annot"><a href="GHC.Core.Coercion.html#splitForAllCo_maybe"><span class="hs-identifier hs-type">splitForAllCo_maybe</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#Coercion"><span class="hs-identifier hs-type">Coercion</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Maybe</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Types.Var.html#TyCoVar"><span class="hs-identifier hs-type">TyCoVar</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Language.Haskell.Syntax.Specificity.html#ForAllTyFlag"><span class="hs-identifier hs-type">ForAllTyFlag</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Language.Haskell.Syntax.Specificity.html#ForAllTyFlag"><span class="hs-identifier hs-type">ForAllTyFlag</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#Coercion"><span class="hs-identifier hs-type">Coercion</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#Coercion"><span class="hs-identifier hs-type">Coercion</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-570"></span><span id="splitForAllCo_maybe"><span class="annot"><span class="annottext">splitForAllCo_maybe :: Coercion
-&gt; Maybe (CoVar, ForAllTyFlag, ForAllTyFlag, Coercion, Coercion)
</span><a href="GHC.Core.Coercion.html#splitForAllCo_maybe"><span class="hs-identifier hs-var hs-var">splitForAllCo_maybe</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#ForAllCo"><span class="hs-identifier hs-type">ForAllCo</span></a></span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">fco_tcv :: Coercion -&gt; CoVar
</span><a href="GHC.Core.TyCo.Rep.html#fco_tcv"><span class="hs-identifier hs-var">fco_tcv</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="local-6989586621682578111"><span class="annot"><span class="annottext">CoVar
</span><a href="#local-6989586621682578111"><span class="hs-identifier hs-var">tv</span></a></span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">fco_visL :: Coercion -&gt; ForAllTyFlag
</span><a href="GHC.Core.TyCo.Rep.html#fco_visL"><span class="hs-identifier hs-var">fco_visL</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="local-6989586621682578113"><span class="annot"><span class="annottext">ForAllTyFlag
</span><a href="#local-6989586621682578113"><span class="hs-identifier hs-var">vL</span></a></span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">fco_visR :: Coercion -&gt; ForAllTyFlag
</span><a href="GHC.Core.TyCo.Rep.html#fco_visR"><span class="hs-identifier hs-var">fco_visR</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="local-6989586621682578115"><span class="annot"><span class="annottext">ForAllTyFlag
</span><a href="#local-6989586621682578115"><span class="hs-identifier hs-var">vR</span></a></span></span><span>
</span><span id="line-571"></span><span>                              </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">fco_kind :: Coercion -&gt; Coercion
</span><a href="GHC.Core.TyCo.Rep.html#fco_kind"><span class="hs-identifier hs-var">fco_kind</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="local-6989586621682578117"><span class="annot"><span class="annottext">Coercion
</span><a href="#local-6989586621682578117"><span class="hs-identifier hs-var">k_co</span></a></span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">fco_body :: Coercion -&gt; Coercion
</span><a href="GHC.Core.TyCo.Rep.html#fco_body"><span class="hs-identifier hs-var">fco_body</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="local-6989586621682578119"><span class="annot"><span class="annottext">Coercion
</span><a href="#local-6989586621682578119"><span class="hs-identifier hs-var">co</span></a></span></span><span> </span><span class="hs-special">}</span><span class="hs-special">)</span><span>
</span><span id="line-572"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(CoVar, ForAllTyFlag, ForAllTyFlag, Coercion, Coercion)
-&gt; Maybe (CoVar, ForAllTyFlag, ForAllTyFlag, Coercion, Coercion)
forall a. a -&gt; Maybe a
</span><span class="hs-identifier hs-var">Just</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">CoVar
</span><a href="#local-6989586621682578111"><span class="hs-identifier hs-var">tv</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">ForAllTyFlag
</span><a href="#local-6989586621682578113"><span class="hs-identifier hs-var">vL</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">ForAllTyFlag
</span><a href="#local-6989586621682578115"><span class="hs-identifier hs-var">vR</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Coercion
</span><a href="#local-6989586621682578117"><span class="hs-identifier hs-var">k_co</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Coercion
</span><a href="#local-6989586621682578119"><span class="hs-identifier hs-var">co</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-573"></span><span class="annot"><a href="GHC.Core.Coercion.html#splitForAllCo_maybe"><span class="hs-identifier hs-var">splitForAllCo_maybe</span></a></span><span> </span><span id="local-6989586621682578120"><span class="annot"><span class="annottext">Coercion
</span><a href="#local-6989586621682578120"><span class="hs-identifier hs-var">co</span></a></span></span><span>
</span><span id="line-574"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span class="hs-special">(</span><span id="local-6989586621682578121"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682578121"><span class="hs-identifier hs-var">ty</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682578122"><span class="annot"><span class="annottext">Role
</span><a href="#local-6989586621682578122"><span class="hs-identifier hs-var">r</span></a></span></span><span class="hs-special">)</span><span>        </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Coercion -&gt; Maybe (Type, Role)
</span><a href="GHC.Core.Coercion.html#isReflCo_maybe"><span class="hs-identifier hs-var">isReflCo_maybe</span></a></span><span> </span><span class="annot"><span class="annottext">Coercion
</span><a href="#local-6989586621682578120"><span class="hs-identifier hs-var">co</span></a></span><span>
</span><span id="line-575"></span><span>  </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Types.Var.html#Bndr"><span class="hs-identifier hs-type">Bndr</span></a></span><span> </span><span id="local-6989586621682578124"><span class="annot"><span class="annottext">CoVar
</span><a href="#local-6989586621682578124"><span class="hs-identifier hs-var">tcv</span></a></span></span><span> </span><span id="local-6989586621682578125"><span class="annot"><span class="annottext">ForAllTyFlag
</span><a href="#local-6989586621682578125"><span class="hs-identifier hs-var">vis</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682578126"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682578126"><span class="hs-identifier hs-var">body_ty</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Type -&gt; Maybe (ForAllTyBinder, Type)
</span><a href="GHC.Core.Type.html#splitForAllForAllTyBinder_maybe"><span class="hs-identifier hs-var">splitForAllForAllTyBinder_maybe</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682578121"><span class="hs-identifier hs-var">ty</span></a></span><span>
</span><span id="line-576"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(CoVar, ForAllTyFlag, ForAllTyFlag, Coercion, Coercion)
-&gt; Maybe (CoVar, ForAllTyFlag, ForAllTyFlag, Coercion, Coercion)
forall a. a -&gt; Maybe a
</span><span class="hs-identifier hs-var">Just</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">CoVar
</span><a href="#local-6989586621682578124"><span class="hs-identifier hs-var">tcv</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">ForAllTyFlag
</span><a href="#local-6989586621682578125"><span class="hs-identifier hs-var">vis</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">ForAllTyFlag
</span><a href="#local-6989586621682578125"><span class="hs-identifier hs-var">vis</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Type -&gt; Coercion
</span><a href="GHC.Core.Coercion.html#mkNomReflCo"><span class="hs-identifier hs-var">mkNomReflCo</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">CoVar -&gt; Type
</span><a href="GHC.Types.Var.html#varType"><span class="hs-identifier hs-var">varType</span></a></span><span> </span><span class="annot"><span class="annottext">CoVar
</span><a href="#local-6989586621682578124"><span class="hs-identifier hs-var">tcv</span></a></span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Role -&gt; Type -&gt; Coercion
</span><a href="GHC.Core.Coercion.html#mkReflCo"><span class="hs-identifier hs-var">mkReflCo</span></a></span><span> </span><span class="annot"><span class="annottext">Role
</span><a href="#local-6989586621682578122"><span class="hs-identifier hs-var">r</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682578126"><span class="hs-identifier hs-var">body_ty</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-577"></span><span class="annot"><a href="GHC.Core.Coercion.html#splitForAllCo_maybe"><span class="hs-identifier hs-var">splitForAllCo_maybe</span></a></span><span> </span><span class="annot"><span class="annottext">Coercion
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Maybe (CoVar, ForAllTyFlag, ForAllTyFlag, Coercion, Coercion)
forall a. Maybe a
</span><span class="hs-identifier hs-var">Nothing</span></span><span>
</span><span id="line-578"></span><span>
</span><span id="line-579"></span><span class="annot"><span class="hs-comment">-- | Like 'splitForAllCo_maybe', but only returns Just for tyvar binder</span></span><span>
</span><span id="line-580"></span><span class="annot"><a href="GHC.Core.Coercion.html#splitForAllCo_ty_maybe"><span class="hs-identifier hs-type">splitForAllCo_ty_maybe</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#Coercion"><span class="hs-identifier hs-type">Coercion</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Maybe</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Types.Var.html#TyVar"><span class="hs-identifier hs-type">TyVar</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Language.Haskell.Syntax.Specificity.html#ForAllTyFlag"><span class="hs-identifier hs-type">ForAllTyFlag</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Language.Haskell.Syntax.Specificity.html#ForAllTyFlag"><span class="hs-identifier hs-type">ForAllTyFlag</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#Coercion"><span class="hs-identifier hs-type">Coercion</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#Coercion"><span class="hs-identifier hs-type">Coercion</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-581"></span><span id="splitForAllCo_ty_maybe"><span class="annot"><span class="annottext">splitForAllCo_ty_maybe :: Coercion
-&gt; Maybe (CoVar, ForAllTyFlag, ForAllTyFlag, Coercion, Coercion)
</span><a href="GHC.Core.Coercion.html#splitForAllCo_ty_maybe"><span class="hs-identifier hs-var hs-var">splitForAllCo_ty_maybe</span></a></span></span><span> </span><span id="local-6989586621682578129"><span class="annot"><span class="annottext">Coercion
</span><a href="#local-6989586621682578129"><span class="hs-identifier hs-var">co</span></a></span></span><span>
</span><span id="line-582"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span id="local-6989586621682578130"><span class="annot"><span class="annottext">stuff :: (CoVar, ForAllTyFlag, ForAllTyFlag, Coercion, Coercion)
</span><a href="#local-6989586621682578130"><span class="hs-identifier hs-var">stuff</span></a></span></span><span class="hs-glyph">@</span><span class="hs-special">(</span><span id="local-6989586621682578131"><span class="annot"><span class="annottext">CoVar
</span><a href="#local-6989586621682578131"><span class="hs-identifier hs-var">tv</span></a></span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">ForAllTyFlag
</span><span class="hs-identifier">_</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">ForAllTyFlag
</span><span class="hs-identifier">_</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Coercion
</span><span class="hs-identifier">_</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Coercion
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Coercion
-&gt; Maybe (CoVar, ForAllTyFlag, ForAllTyFlag, Coercion, Coercion)
</span><a href="GHC.Core.Coercion.html#splitForAllCo_maybe"><span class="hs-identifier hs-var">splitForAllCo_maybe</span></a></span><span> </span><span class="annot"><span class="annottext">Coercion
</span><a href="#local-6989586621682578129"><span class="hs-identifier hs-var">co</span></a></span><span>
</span><span id="line-583"></span><span>  </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">CoVar -&gt; Bool
</span><a href="GHC.Types.Var.html#isTyVar"><span class="hs-identifier hs-var">isTyVar</span></a></span><span> </span><span class="annot"><span class="annottext">CoVar
</span><a href="#local-6989586621682578131"><span class="hs-identifier hs-var">tv</span></a></span><span>
</span><span id="line-584"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(CoVar, ForAllTyFlag, ForAllTyFlag, Coercion, Coercion)
-&gt; Maybe (CoVar, ForAllTyFlag, ForAllTyFlag, Coercion, Coercion)
forall a. a -&gt; Maybe a
</span><span class="hs-identifier hs-var">Just</span></span><span> </span><span class="annot"><span class="annottext">(CoVar, ForAllTyFlag, ForAllTyFlag, Coercion, Coercion)
</span><a href="#local-6989586621682578130"><span class="hs-identifier hs-var">stuff</span></a></span><span>
</span><span id="line-585"></span><span class="annot"><a href="GHC.Core.Coercion.html#splitForAllCo_ty_maybe"><span class="hs-identifier hs-var">splitForAllCo_ty_maybe</span></a></span><span> </span><span class="annot"><span class="annottext">Coercion
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Maybe (CoVar, ForAllTyFlag, ForAllTyFlag, Coercion, Coercion)
forall a. Maybe a
</span><span class="hs-identifier hs-var">Nothing</span></span><span>
</span><span id="line-586"></span><span>
</span><span id="line-587"></span><span class="annot"><span class="hs-comment">-- | Like 'splitForAllCo_maybe', but only returns Just for covar binder</span></span><span>
</span><span id="line-588"></span><span class="annot"><a href="GHC.Core.Coercion.html#splitForAllCo_co_maybe"><span class="hs-identifier hs-type">splitForAllCo_co_maybe</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#Coercion"><span class="hs-identifier hs-type">Coercion</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Maybe</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Types.Var.html#CoVar"><span class="hs-identifier hs-type">CoVar</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Language.Haskell.Syntax.Specificity.html#ForAllTyFlag"><span class="hs-identifier hs-type">ForAllTyFlag</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Language.Haskell.Syntax.Specificity.html#ForAllTyFlag"><span class="hs-identifier hs-type">ForAllTyFlag</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#Coercion"><span class="hs-identifier hs-type">Coercion</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#Coercion"><span class="hs-identifier hs-type">Coercion</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-589"></span><span id="splitForAllCo_co_maybe"><span class="annot"><span class="annottext">splitForAllCo_co_maybe :: Coercion
-&gt; Maybe (CoVar, ForAllTyFlag, ForAllTyFlag, Coercion, Coercion)
</span><a href="GHC.Core.Coercion.html#splitForAllCo_co_maybe"><span class="hs-identifier hs-var hs-var">splitForAllCo_co_maybe</span></a></span></span><span> </span><span id="local-6989586621682578133"><span class="annot"><span class="annottext">Coercion
</span><a href="#local-6989586621682578133"><span class="hs-identifier hs-var">co</span></a></span></span><span>
</span><span id="line-590"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span id="local-6989586621682578134"><span class="annot"><span class="annottext">stuff :: (CoVar, ForAllTyFlag, ForAllTyFlag, Coercion, Coercion)
</span><a href="#local-6989586621682578134"><span class="hs-identifier hs-var">stuff</span></a></span></span><span class="hs-glyph">@</span><span class="hs-special">(</span><span id="local-6989586621682578135"><span class="annot"><span class="annottext">CoVar
</span><a href="#local-6989586621682578135"><span class="hs-identifier hs-var">cv</span></a></span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">ForAllTyFlag
</span><span class="hs-identifier">_</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">ForAllTyFlag
</span><span class="hs-identifier">_</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Coercion
</span><span class="hs-identifier">_</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Coercion
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Coercion
-&gt; Maybe (CoVar, ForAllTyFlag, ForAllTyFlag, Coercion, Coercion)
</span><a href="GHC.Core.Coercion.html#splitForAllCo_maybe"><span class="hs-identifier hs-var">splitForAllCo_maybe</span></a></span><span> </span><span class="annot"><span class="annottext">Coercion
</span><a href="#local-6989586621682578133"><span class="hs-identifier hs-var">co</span></a></span><span>
</span><span id="line-591"></span><span>  </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">CoVar -&gt; Bool
</span><a href="GHC.Types.Var.html#isCoVar"><span class="hs-identifier hs-var">isCoVar</span></a></span><span> </span><span class="annot"><span class="annottext">CoVar
</span><a href="#local-6989586621682578135"><span class="hs-identifier hs-var">cv</span></a></span><span>
</span><span id="line-592"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(CoVar, ForAllTyFlag, ForAllTyFlag, Coercion, Coercion)
-&gt; Maybe (CoVar, ForAllTyFlag, ForAllTyFlag, Coercion, Coercion)
forall a. a -&gt; Maybe a
</span><span class="hs-identifier hs-var">Just</span></span><span> </span><span class="annot"><span class="annottext">(CoVar, ForAllTyFlag, ForAllTyFlag, Coercion, Coercion)
</span><a href="#local-6989586621682578134"><span class="hs-identifier hs-var">stuff</span></a></span><span>
</span><span id="line-593"></span><span class="annot"><a href="GHC.Core.Coercion.html#splitForAllCo_co_maybe"><span class="hs-identifier hs-var">splitForAllCo_co_maybe</span></a></span><span> </span><span class="annot"><span class="annottext">Coercion
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Maybe (CoVar, ForAllTyFlag, ForAllTyFlag, Coercion, Coercion)
forall a. Maybe a
</span><span class="hs-identifier hs-var">Nothing</span></span><span>
</span><span id="line-594"></span><span>
</span><span id="line-595"></span><span class="hs-comment">-------------------------------------------------------</span><span>
</span><span id="line-596"></span><span class="hs-comment">-- and some coercion kind stuff</span><span>
</span><span id="line-597"></span><span>
</span><span id="line-598"></span><span class="annot"><a href="GHC.Core.Coercion.html#coVarLType"><span class="hs-identifier hs-type">coVarLType</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Core.Coercion.html#coVarRType"><span class="hs-identifier hs-type">coVarRType</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Utils.Misc.html#HasDebugCallStack"><span class="hs-identifier hs-type">HasDebugCallStack</span></a></span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="GHC.Types.Var.html#CoVar"><span class="hs-identifier hs-type">CoVar</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#Type"><span class="hs-identifier hs-type">Type</span></a></span><span>
</span><span id="line-599"></span><span id="coVarLType"><span class="annot"><span class="annottext">coVarLType :: HasDebugCallStack =&gt; CoVar -&gt; Type
</span><a href="GHC.Core.Coercion.html#coVarLType"><span class="hs-identifier hs-var hs-var">coVarLType</span></a></span></span><span> </span><span id="local-6989586621682578138"><span class="annot"><span class="annottext">CoVar
</span><a href="#local-6989586621682578138"><span class="hs-identifier hs-var">cv</span></a></span></span><span> </span><span class="hs-glyph">|</span><span> </span><span class="hs-special">(</span><span id="local-6989586621682578139"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682578139"><span class="hs-identifier hs-var">ty1</span></a></span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Type
</span><span class="hs-identifier">_</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Role
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">HasDebugCallStack =&gt; CoVar -&gt; (Type, Type, Role)
CoVar -&gt; (Type, Type, Role)
</span><a href="GHC.Core.Coercion.html#coVarTypesRole"><span class="hs-identifier hs-var">coVarTypesRole</span></a></span><span> </span><span class="annot"><span class="annottext">CoVar
</span><a href="#local-6989586621682578138"><span class="hs-identifier hs-var">cv</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682578139"><span class="hs-identifier hs-var">ty1</span></a></span><span>
</span><span id="line-600"></span><span id="coVarRType"><span class="annot"><span class="annottext">coVarRType :: HasDebugCallStack =&gt; CoVar -&gt; Type
</span><a href="GHC.Core.Coercion.html#coVarRType"><span class="hs-identifier hs-var hs-var">coVarRType</span></a></span></span><span> </span><span id="local-6989586621682578142"><span class="annot"><span class="annottext">CoVar
</span><a href="#local-6989586621682578142"><span class="hs-identifier hs-var">cv</span></a></span></span><span> </span><span class="hs-glyph">|</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Type
</span><span class="hs-identifier">_</span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682578143"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682578143"><span class="hs-identifier hs-var">ty2</span></a></span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Role
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">HasDebugCallStack =&gt; CoVar -&gt; (Type, Type, Role)
CoVar -&gt; (Type, Type, Role)
</span><a href="GHC.Core.Coercion.html#coVarTypesRole"><span class="hs-identifier hs-var">coVarTypesRole</span></a></span><span> </span><span class="annot"><span class="annottext">CoVar
</span><a href="#local-6989586621682578142"><span class="hs-identifier hs-var">cv</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682578143"><span class="hs-identifier hs-var">ty2</span></a></span><span>
</span><span id="line-601"></span><span>
</span><span id="line-602"></span><span class="annot"><a href="GHC.Core.Coercion.html#coVarTypes"><span class="hs-identifier hs-type">coVarTypes</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Utils.Misc.html#HasDebugCallStack"><span class="hs-identifier hs-type">HasDebugCallStack</span></a></span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="GHC.Types.Var.html#CoVar"><span class="hs-identifier hs-type">CoVar</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Data.Pair.html#Pair"><span class="hs-identifier hs-type">Pair</span></a></span><span> </span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#Type"><span class="hs-identifier hs-type">Type</span></a></span><span>
</span><span id="line-603"></span><span id="coVarTypes"><span class="annot"><span class="annottext">coVarTypes :: HasDebugCallStack =&gt; CoVar -&gt; Pair Type
</span><a href="GHC.Core.Coercion.html#coVarTypes"><span class="hs-identifier hs-var hs-var">coVarTypes</span></a></span></span><span> </span><span id="local-6989586621682578146"><span class="annot"><span class="annottext">CoVar
</span><a href="#local-6989586621682578146"><span class="hs-identifier hs-var">cv</span></a></span></span><span> </span><span class="hs-glyph">|</span><span> </span><span class="hs-special">(</span><span id="local-6989586621682578147"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682578147"><span class="hs-identifier hs-var">ty1</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682578148"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682578148"><span class="hs-identifier hs-var">ty2</span></a></span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Role
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">HasDebugCallStack =&gt; CoVar -&gt; (Type, Type, Role)
CoVar -&gt; (Type, Type, Role)
</span><a href="GHC.Core.Coercion.html#coVarTypesRole"><span class="hs-identifier hs-var">coVarTypesRole</span></a></span><span> </span><span class="annot"><span class="annottext">CoVar
</span><a href="#local-6989586621682578146"><span class="hs-identifier hs-var">cv</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Type -&gt; Type -&gt; Pair Type
forall a. a -&gt; a -&gt; Pair a
</span><a href="GHC.Data.Pair.html#Pair"><span class="hs-identifier hs-var">Pair</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682578147"><span class="hs-identifier hs-var">ty1</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682578148"><span class="hs-identifier hs-var">ty2</span></a></span><span>
</span><span id="line-604"></span><span>
</span><span id="line-605"></span><span class="annot"><a href="GHC.Core.Coercion.html#coVarTypesRole"><span class="hs-identifier hs-type">coVarTypesRole</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Utils.Misc.html#HasDebugCallStack"><span class="hs-identifier hs-type">HasDebugCallStack</span></a></span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="GHC.Types.Var.html#CoVar"><span class="hs-identifier hs-type">CoVar</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#Type"><span class="hs-identifier hs-type">Type</span></a></span><span class="hs-special">,</span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#Type"><span class="hs-identifier hs-type">Type</span></a></span><span class="hs-special">,</span><span class="annot"><a href="Language.Haskell.Syntax.Basic.html#Role"><span class="hs-identifier hs-type">Role</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-606"></span><span id="coVarTypesRole"><span class="annot"><span class="annottext">coVarTypesRole :: HasDebugCallStack =&gt; CoVar -&gt; (Type, Type, Role)
</span><a href="GHC.Core.Coercion.html#coVarTypesRole"><span class="hs-identifier hs-var hs-var">coVarTypesRole</span></a></span></span><span> </span><span id="local-6989586621682578156"><span class="annot"><span class="annottext">CoVar
</span><a href="#local-6989586621682578156"><span class="hs-identifier hs-var">cv</span></a></span></span><span>
</span><span id="line-607"></span><span> </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span class="hs-special">(</span><span id="local-6989586621682578157"><span class="annot"><span class="annottext">TyCon
</span><a href="#local-6989586621682578157"><span class="hs-identifier hs-var">tc</span></a></span></span><span class="hs-special">,</span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">Type
</span><span class="hs-identifier">_</span></span><span class="hs-special">,</span><span class="annot"><span class="annottext">Type
</span><span class="hs-identifier">_</span></span><span class="hs-special">,</span><span id="local-6989586621682578158"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682578158"><span class="hs-identifier hs-var">ty1</span></a></span></span><span class="hs-special">,</span><span id="local-6989586621682578159"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682578159"><span class="hs-identifier hs-var">ty2</span></a></span></span><span class="hs-special">]</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">HasDebugCallStack =&gt; Type -&gt; Maybe (TyCon, [Type])
Type -&gt; Maybe (TyCon, [Type])
</span><a href="GHC.Core.Type.html#splitTyConApp_maybe"><span class="hs-identifier hs-var">splitTyConApp_maybe</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">CoVar -&gt; Type
</span><a href="GHC.Types.Var.html#varType"><span class="hs-identifier hs-var">varType</span></a></span><span> </span><span class="annot"><span class="annottext">CoVar
</span><a href="#local-6989586621682578156"><span class="hs-identifier hs-var">cv</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-608"></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682578158"><span class="hs-identifier hs-var">ty1</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682578159"><span class="hs-identifier hs-var">ty2</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">TyCon -&gt; Role
</span><a href="GHC.Core.Coercion.html#eqTyConRole"><span class="hs-identifier hs-var">eqTyConRole</span></a></span><span> </span><span class="annot"><span class="annottext">TyCon
</span><a href="#local-6989586621682578157"><span class="hs-identifier hs-var">tc</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-609"></span><span> </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">otherwise</span></span><span>
</span><span id="line-610"></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">String -&gt; SDoc -&gt; (Type, Type, Role)
forall a. HasCallStack =&gt; String -&gt; SDoc -&gt; a
</span><a href="GHC.Utils.Panic.html#pprPanic"><span class="hs-identifier hs-var">pprPanic</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;coVarTypesRole, non coercion variable&quot;</span></span><span>
</span><span id="line-611"></span><span>            </span><span class="hs-special">(</span><span class="annot"><span class="annottext">CoVar -&gt; SDoc
forall a. Outputable a =&gt; a -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="annot"><span class="annottext">CoVar
</span><a href="#local-6989586621682578156"><span class="hs-identifier hs-var">cv</span></a></span><span> </span><span class="annot"><span class="annottext">SDoc -&gt; SDoc -&gt; SDoc
forall doc. IsDoc doc =&gt; doc -&gt; doc -&gt; doc
</span><a href="GHC.Utils.Outputable.html#%24%24"><span class="hs-operator hs-var">$$</span></a></span><span> </span><span class="annot"><span class="annottext">Type -&gt; SDoc
forall a. Outputable a =&gt; a -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">CoVar -&gt; Type
</span><a href="GHC.Types.Var.html#varType"><span class="hs-identifier hs-var">varType</span></a></span><span> </span><span class="annot"><span class="annottext">CoVar
</span><a href="#local-6989586621682578156"><span class="hs-identifier hs-var">cv</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-612"></span><span>
</span><span id="line-613"></span><span class="annot"><a href="GHC.Core.Coercion.html#coVarKind"><span class="hs-identifier hs-type">coVarKind</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Types.Var.html#CoVar"><span class="hs-identifier hs-type">CoVar</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#Type"><span class="hs-identifier hs-type">Type</span></a></span><span>
</span><span id="line-614"></span><span id="coVarKind"><span class="annot"><span class="annottext">coVarKind :: CoVar -&gt; Type
</span><a href="GHC.Core.Coercion.html#coVarKind"><span class="hs-identifier hs-var hs-var">coVarKind</span></a></span></span><span> </span><span id="local-6989586621682578164"><span class="annot"><span class="annottext">CoVar
</span><a href="#local-6989586621682578164"><span class="hs-identifier hs-var">cv</span></a></span></span><span>
</span><span id="line-615"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Bool -&gt; (CoVar -&gt; Type) -&gt; CoVar -&gt; Type
forall a. HasCallStack =&gt; Bool -&gt; a -&gt; a
</span><a href="GHC.Utils.Panic.Plain.html#assert"><span class="hs-identifier hs-var">assert</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">CoVar -&gt; Bool
</span><a href="GHC.Types.Var.html#isCoVar"><span class="hs-identifier hs-var">isCoVar</span></a></span><span> </span><span class="annot"><span class="annottext">CoVar
</span><a href="#local-6989586621682578164"><span class="hs-identifier hs-var">cv</span></a></span><span> </span><span class="hs-special">)</span><span>
</span><span id="line-616"></span><span>    </span><span class="annot"><span class="annottext">CoVar -&gt; Type
</span><a href="GHC.Types.Var.html#varType"><span class="hs-identifier hs-var">varType</span></a></span><span> </span><span class="annot"><span class="annottext">CoVar
</span><a href="#local-6989586621682578164"><span class="hs-identifier hs-var">cv</span></a></span><span>
</span><span id="line-617"></span><span>
</span><span id="line-618"></span><span class="annot"><a href="GHC.Core.Coercion.html#coVarRole"><span class="hs-identifier hs-type">coVarRole</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Types.Var.html#CoVar"><span class="hs-identifier hs-type">CoVar</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Language.Haskell.Syntax.Basic.html#Role"><span class="hs-identifier hs-type">Role</span></a></span><span>
</span><span id="line-619"></span><span id="coVarRole"><span class="annot"><span class="annottext">coVarRole :: CoVar -&gt; Role
</span><a href="GHC.Core.Coercion.html#coVarRole"><span class="hs-identifier hs-var hs-var">coVarRole</span></a></span></span><span> </span><span id="local-6989586621682578166"><span class="annot"><span class="annottext">CoVar
</span><a href="#local-6989586621682578166"><span class="hs-identifier hs-var">cv</span></a></span></span><span>
</span><span id="line-620"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">TyCon -&gt; Role
</span><a href="GHC.Core.Coercion.html#eqTyConRole"><span class="hs-identifier hs-var">eqTyConRole</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">Type -&gt; Maybe TyCon
</span><a href="GHC.Core.Type.html#tyConAppTyCon_maybe"><span class="hs-identifier hs-var">tyConAppTyCon_maybe</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">CoVar -&gt; Type
</span><a href="GHC.Types.Var.html#varType"><span class="hs-identifier hs-var">varType</span></a></span><span> </span><span class="annot"><span class="annottext">CoVar
</span><a href="#local-6989586621682578166"><span class="hs-identifier hs-var">cv</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-621"></span><span>                   </span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span id="local-6989586621682578168"><span class="annot"><span class="annottext">TyCon
</span><a href="#local-6989586621682578168"><span class="hs-identifier hs-var">tc0</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">TyCon
</span><a href="#local-6989586621682578168"><span class="hs-identifier hs-var">tc0</span></a></span><span>
</span><span id="line-622"></span><span>                   </span><span class="annot"><span class="annottext">Maybe TyCon
</span><span class="hs-identifier hs-var">Nothing</span></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">String -&gt; SDoc -&gt; TyCon
forall a. HasCallStack =&gt; String -&gt; SDoc -&gt; a
</span><a href="GHC.Utils.Panic.html#pprPanic"><span class="hs-identifier hs-var">pprPanic</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;coVarRole: not tyconapp&quot;</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">CoVar -&gt; SDoc
forall a. Outputable a =&gt; a -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="annot"><span class="annottext">CoVar
</span><a href="#local-6989586621682578166"><span class="hs-identifier hs-var">cv</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-623"></span><span>
</span><span id="line-624"></span><span class="annot"><a href="GHC.Core.Coercion.html#eqTyConRole"><span class="hs-identifier hs-type">eqTyConRole</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Core.TyCon.html#TyCon"><span class="hs-identifier hs-type">TyCon</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Language.Haskell.Syntax.Basic.html#Role"><span class="hs-identifier hs-type">Role</span></a></span><span>
</span><span id="line-625"></span><span class="hs-comment">-- Given (~#) or (~R#) return the Nominal or Representational respectively</span><span>
</span><span id="line-626"></span><span id="eqTyConRole"><span class="annot"><span class="annottext">eqTyConRole :: TyCon -&gt; Role
</span><a href="GHC.Core.Coercion.html#eqTyConRole"><span class="hs-identifier hs-var hs-var">eqTyConRole</span></a></span></span><span> </span><span id="local-6989586621682578169"><span class="annot"><span class="annottext">TyCon
</span><a href="#local-6989586621682578169"><span class="hs-identifier hs-var">tc</span></a></span></span><span>
</span><span id="line-627"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">TyCon
</span><a href="#local-6989586621682578169"><span class="hs-identifier hs-var">tc</span></a></span><span> </span><span class="annot"><span class="annottext">TyCon -&gt; Unique -&gt; Bool
forall a. Uniquable a =&gt; a -&gt; Unique -&gt; Bool
</span><a href="GHC.Types.Unique.html#hasKey"><span class="hs-operator hs-var">`hasKey`</span></a></span><span> </span><span class="annot"><span class="annottext">Unique
</span><a href="GHC.Builtin.Names.html#eqPrimTyConKey"><span class="hs-identifier hs-var">eqPrimTyConKey</span></a></span><span>
</span><span id="line-628"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Role
</span><a href="Language.Haskell.Syntax.Basic.html#Nominal"><span class="hs-identifier hs-var">Nominal</span></a></span><span>
</span><span id="line-629"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">TyCon
</span><a href="#local-6989586621682578169"><span class="hs-identifier hs-var">tc</span></a></span><span> </span><span class="annot"><span class="annottext">TyCon -&gt; Unique -&gt; Bool
forall a. Uniquable a =&gt; a -&gt; Unique -&gt; Bool
</span><a href="GHC.Types.Unique.html#hasKey"><span class="hs-operator hs-var">`hasKey`</span></a></span><span> </span><span class="annot"><span class="annottext">Unique
</span><a href="GHC.Builtin.Names.html#eqReprPrimTyConKey"><span class="hs-identifier hs-var">eqReprPrimTyConKey</span></a></span><span>
</span><span id="line-630"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Role
</span><a href="Language.Haskell.Syntax.Basic.html#Representational"><span class="hs-identifier hs-var">Representational</span></a></span><span>
</span><span id="line-631"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">otherwise</span></span><span>
</span><span id="line-632"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">String -&gt; SDoc -&gt; Role
forall a. HasCallStack =&gt; String -&gt; SDoc -&gt; a
</span><a href="GHC.Utils.Panic.html#pprPanic"><span class="hs-identifier hs-var">pprPanic</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;eqTyConRole: unknown tycon&quot;</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TyCon -&gt; SDoc
forall a. Outputable a =&gt; a -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="annot"><span class="annottext">TyCon
</span><a href="#local-6989586621682578169"><span class="hs-identifier hs-var">tc</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-633"></span><span>
</span><span id="line-634"></span><span class="hs-comment">-- | Given a coercion `co :: (t1 :: TYPE r1) ~ (t2 :: TYPE r2)`</span><span>
</span><span id="line-635"></span><span class="hs-comment">-- produce a coercion `rep_co :: r1 ~ r2`</span><span>
</span><span id="line-636"></span><span class="hs-comment">-- But actually it is possible that</span><span>
</span><span id="line-637"></span><span class="hs-comment">--     co :: (t1 :: CONSTRAINT r1) ~ (t2 :: CONSTRAINT r2)</span><span>
</span><span id="line-638"></span><span class="hs-comment">-- or  co :: (t1 :: TYPE r1)       ~ (t2 :: CONSTRAINT r2)</span><span>
</span><span id="line-639"></span><span class="hs-comment">-- or  co :: (t1 :: CONSTRAINT r1) ~ (t2 :: TYPE r2)</span><span>
</span><span id="line-640"></span><span class="hs-comment">-- See Note [mkRuntimeRepCo]</span><span>
</span><span id="line-641"></span><span class="annot"><a href="GHC.Core.Coercion.html#mkRuntimeRepCo"><span class="hs-identifier hs-type">mkRuntimeRepCo</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Utils.Misc.html#HasDebugCallStack"><span class="hs-identifier hs-type">HasDebugCallStack</span></a></span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#Coercion"><span class="hs-identifier hs-type">Coercion</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#Coercion"><span class="hs-identifier hs-type">Coercion</span></a></span><span>
</span><span id="line-642"></span><span id="mkRuntimeRepCo"><span class="annot"><span class="annottext">mkRuntimeRepCo :: HasDebugCallStack =&gt; Coercion -&gt; Coercion
</span><a href="GHC.Core.Coercion.html#mkRuntimeRepCo"><span class="hs-identifier hs-var hs-var">mkRuntimeRepCo</span></a></span></span><span> </span><span id="local-6989586621682578178"><span class="annot"><span class="annottext">Coercion
</span><a href="#local-6989586621682578178"><span class="hs-identifier hs-var">co</span></a></span></span><span>
</span><span id="line-643"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Coercion -&gt; Coercion
forall a. HasCallStack =&gt; Bool -&gt; a -&gt; a
</span><a href="GHC.Utils.Panic.Plain.html#assert"><span class="hs-identifier hs-var">assert</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Type -&gt; Bool
</span><a href="GHC.Core.Type.html#isTYPEorCONSTRAINT"><span class="hs-identifier hs-var">isTYPEorCONSTRAINT</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682578180"><span class="hs-identifier hs-var">k1</span></a></span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Bool -&gt; Bool
</span><span class="hs-operator hs-var">&amp;&amp;</span></span><span> </span><span class="annot"><span class="annottext">Type -&gt; Bool
</span><a href="GHC.Core.Type.html#isTYPEorCONSTRAINT"><span class="hs-identifier hs-var">isTYPEorCONSTRAINT</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682578181"><span class="hs-identifier hs-var">k2</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(Coercion -&gt; Coercion) -&gt; Coercion -&gt; Coercion
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-644"></span><span>    </span><span class="annot"><span class="annottext">HasDebugCallStack =&gt; CoSel -&gt; Coercion -&gt; Coercion
CoSel -&gt; Coercion -&gt; Coercion
</span><a href="GHC.Core.Coercion.html#mkSelCo"><span class="hs-identifier hs-var">mkSelCo</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Arity -&gt; Role -&gt; CoSel
</span><a href="GHC.Core.TyCo.Rep.html#SelTyCon"><span class="hs-identifier hs-var">SelTyCon</span></a></span><span> </span><span class="annot"><span class="annottext">Arity
</span><span class="hs-number">0</span></span><span> </span><span class="annot"><span class="annottext">Role
</span><a href="Language.Haskell.Syntax.Basic.html#Nominal"><span class="hs-identifier hs-var">Nominal</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Coercion
</span><a href="#local-6989586621682578182"><span class="hs-identifier hs-var">kind_co</span></a></span><span>
</span><span id="line-645"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-646"></span><span>    </span><span id="local-6989586621682578182"><span class="annot"><span class="annottext">kind_co :: Coercion
</span><a href="#local-6989586621682578182"><span class="hs-identifier hs-var hs-var">kind_co</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Coercion -&gt; Coercion
</span><a href="GHC.Core.Coercion.html#mkKindCo"><span class="hs-identifier hs-var">mkKindCo</span></a></span><span> </span><span class="annot"><span class="annottext">Coercion
</span><a href="#local-6989586621682578178"><span class="hs-identifier hs-var">co</span></a></span><span>  </span><span class="hs-comment">-- kind_co :: TYPE r1 ~ TYPE r2</span><span>
</span><span id="line-647"></span><span>    </span><span class="annot"><a href="GHC.Data.Pair.html#Pair"><span class="hs-identifier hs-type">Pair</span></a></span><span> </span><span id="local-6989586621682578180"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682578180"><span class="hs-identifier hs-var">k1</span></a></span></span><span> </span><span id="local-6989586621682578181"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682578181"><span class="hs-identifier hs-var">k2</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">HasDebugCallStack =&gt; Coercion -&gt; Pair Type
Coercion -&gt; Pair Type
</span><a href="GHC.Core.Coercion.html#coercionKind"><span class="hs-identifier hs-var">coercionKind</span></a></span><span> </span><span class="annot"><span class="annottext">Coercion
</span><a href="#local-6989586621682578182"><span class="hs-identifier hs-var">kind_co</span></a></span><span>
</span><span id="line-648"></span><span>
</span><span id="line-649"></span><span class="hs-comment">{- Note [mkRuntimeRepCo]
~~~~~~~~~~~~~~~~~~~~~~~~
Given
   class C a where { op :: Maybe a }
we will get an axiom
   axC a :: (C a :: CONSTRAINT r1) ~ (Maybe a :: TYPE r2)
(See Note [Type and Constraint are not apart] in GHC.Builtin.Types.Prim.)

Then we may call mkRuntimeRepCo on (axC ty), and that will return
   mkSelCo (SelTyCon 0 Nominal) (Kind (axC ty)) :: r1 ~ r2

So mkSelCo needs to be happy with decomposing a coercion of kind
   CONSTRAINT r1 ~ TYPE r2

Hence the use of `tyConIsTYPEorCONSTRAINT` in the assertion `good_call`
in `mkSelCo`. See #23018 for a concrete example.  (In this context it's
important that TYPE and CONSTRAINT have the same arity and kind, not
merely that they are not-apart; otherwise SelCo would not make sense.)
-}</span><span>
</span><span id="line-668"></span><span>
</span><span id="line-669"></span><span class="annot"><a href="GHC.Core.Coercion.html#isReflCoVar_maybe"><span class="hs-identifier hs-type">isReflCoVar_maybe</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Types.Var.html#Var"><span class="hs-identifier hs-type">Var</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Maybe</span></span><span> </span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#Coercion"><span class="hs-identifier hs-type">Coercion</span></a></span><span>
</span><span id="line-670"></span><span class="hs-comment">-- If cv :: t~t then isReflCoVar_maybe cv = Just (Refl t)</span><span>
</span><span id="line-671"></span><span class="hs-comment">-- Works on all kinds of Vars, not just CoVars</span><span>
</span><span id="line-672"></span><span id="isReflCoVar_maybe"><span class="annot"><span class="annottext">isReflCoVar_maybe :: CoVar -&gt; Maybe Coercion
</span><a href="GHC.Core.Coercion.html#isReflCoVar_maybe"><span class="hs-identifier hs-var hs-var">isReflCoVar_maybe</span></a></span></span><span> </span><span id="local-6989586621682578183"><span class="annot"><span class="annottext">CoVar
</span><a href="#local-6989586621682578183"><span class="hs-identifier hs-var">cv</span></a></span></span><span>
</span><span id="line-673"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">CoVar -&gt; Bool
</span><a href="GHC.Types.Var.html#isCoVar"><span class="hs-identifier hs-var">isCoVar</span></a></span><span> </span><span class="annot"><span class="annottext">CoVar
</span><a href="#local-6989586621682578183"><span class="hs-identifier hs-var">cv</span></a></span><span>
</span><span id="line-674"></span><span>  </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Data.Pair.html#Pair"><span class="hs-identifier hs-type">Pair</span></a></span><span> </span><span id="local-6989586621682578184"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682578184"><span class="hs-identifier hs-var">ty1</span></a></span></span><span> </span><span id="local-6989586621682578185"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682578185"><span class="hs-identifier hs-var">ty2</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">HasDebugCallStack =&gt; CoVar -&gt; Pair Type
CoVar -&gt; Pair Type
</span><a href="GHC.Core.Coercion.html#coVarTypes"><span class="hs-identifier hs-var">coVarTypes</span></a></span><span> </span><span class="annot"><span class="annottext">CoVar
</span><a href="#local-6989586621682578183"><span class="hs-identifier hs-var">cv</span></a></span><span>
</span><span id="line-675"></span><span>  </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682578184"><span class="hs-identifier hs-var">ty1</span></a></span><span> </span><span class="annot"><span class="annottext">HasCallStack =&gt; Type -&gt; Type -&gt; Bool
Type -&gt; Type -&gt; Bool
</span><a href="GHC.Core.TyCo.Compare.html#eqType"><span class="hs-operator hs-var">`eqType`</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682578185"><span class="hs-identifier hs-var">ty2</span></a></span><span>
</span><span id="line-676"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Coercion -&gt; Maybe Coercion
forall a. a -&gt; Maybe a
</span><span class="hs-identifier hs-var">Just</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Role -&gt; Type -&gt; Coercion
</span><a href="GHC.Core.Coercion.html#mkReflCo"><span class="hs-identifier hs-var">mkReflCo</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">CoVar -&gt; Role
</span><a href="GHC.Core.Coercion.html#coVarRole"><span class="hs-identifier hs-var">coVarRole</span></a></span><span> </span><span class="annot"><span class="annottext">CoVar
</span><a href="#local-6989586621682578183"><span class="hs-identifier hs-var">cv</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682578184"><span class="hs-identifier hs-var">ty1</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-677"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">otherwise</span></span><span>
</span><span id="line-678"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Maybe Coercion
forall a. Maybe a
</span><span class="hs-identifier hs-var">Nothing</span></span><span>
</span><span id="line-679"></span><span>
</span><span id="line-680"></span><span class="hs-comment">-- | Tests if this coercion is obviously a generalized reflexive coercion.</span><span>
</span><span id="line-681"></span><span class="hs-comment">-- Guaranteed to work very quickly.</span><span>
</span><span id="line-682"></span><span class="annot"><a href="GHC.Core.Coercion.html#isGReflCo"><span class="hs-identifier hs-type">isGReflCo</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#Coercion"><span class="hs-identifier hs-type">Coercion</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Bool</span></span><span>
</span><span id="line-683"></span><span id="isGReflCo"><span class="annot"><span class="annottext">isGReflCo :: Coercion -&gt; Bool
</span><a href="GHC.Core.Coercion.html#isGReflCo"><span class="hs-identifier hs-var hs-var">isGReflCo</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#GRefl"><span class="hs-identifier hs-type">GRefl</span></a></span><span class="hs-special">{</span><span class="hs-special">}</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">True</span></span><span>
</span><span id="line-684"></span><span class="annot"><a href="GHC.Core.Coercion.html#isGReflCo"><span class="hs-identifier hs-var">isGReflCo</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#Refl"><span class="hs-identifier hs-type">Refl</span></a></span><span class="hs-special">{</span><span class="hs-special">}</span><span class="hs-special">)</span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">True</span></span><span> </span><span class="hs-comment">-- Refl ty == GRefl N ty MRefl</span><span>
</span><span id="line-685"></span><span class="annot"><a href="GHC.Core.Coercion.html#isGReflCo"><span class="hs-identifier hs-var">isGReflCo</span></a></span><span> </span><span class="annot"><span class="annottext">Coercion
</span><span class="hs-identifier">_</span></span><span>         </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">False</span></span><span>
</span><span id="line-686"></span><span>
</span><span id="line-687"></span><span class="hs-comment">-- | Tests if this coercion is obviously reflexive. Guaranteed to work</span><span>
</span><span id="line-688"></span><span class="hs-comment">-- very quickly. Sometimes a coercion can be reflexive, but not obviously</span><span>
</span><span id="line-689"></span><span class="hs-comment">-- so. c.f. 'isReflexiveCo'</span><span>
</span><span id="line-690"></span><span class="annot"><a href="GHC.Core.Coercion.html#isReflCo"><span class="hs-identifier hs-type">isReflCo</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#Coercion"><span class="hs-identifier hs-type">Coercion</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Bool</span></span><span>
</span><span id="line-691"></span><span id="isReflCo"><span class="annot"><span class="annottext">isReflCo :: Coercion -&gt; Bool
</span><a href="GHC.Core.Coercion.html#isReflCo"><span class="hs-identifier hs-var hs-var">isReflCo</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#Refl"><span class="hs-identifier hs-type">Refl</span></a></span><span class="hs-special">{</span><span class="hs-special">}</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">True</span></span><span>
</span><span id="line-692"></span><span class="annot"><a href="GHC.Core.Coercion.html#isReflCo"><span class="hs-identifier hs-var">isReflCo</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#GRefl"><span class="hs-identifier hs-type">GRefl</span></a></span><span> </span><span class="annot"><span class="annottext">Role
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">Type
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621682578187"><span class="annot"><span class="annottext">MCoercion
</span><a href="#local-6989586621682578187"><span class="hs-identifier hs-var">mco</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">MCoercion -&gt; Bool
</span><a href="GHC.Core.Coercion.html#isGReflMCo"><span class="hs-identifier hs-var">isGReflMCo</span></a></span><span> </span><span class="annot"><span class="annottext">MCoercion
</span><a href="#local-6989586621682578187"><span class="hs-identifier hs-var">mco</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">True</span></span><span>
</span><span id="line-693"></span><span class="annot"><a href="GHC.Core.Coercion.html#isReflCo"><span class="hs-identifier hs-var">isReflCo</span></a></span><span> </span><span class="annot"><span class="annottext">Coercion
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">False</span></span><span>
</span><span id="line-694"></span><span>
</span><span id="line-695"></span><span class="hs-comment">-- | Returns the type coerced if this coercion is a generalized reflexive</span><span>
</span><span id="line-696"></span><span class="hs-comment">-- coercion. Guaranteed to work very quickly.</span><span>
</span><span id="line-697"></span><span class="annot"><a href="GHC.Core.Coercion.html#isGReflCo_maybe"><span class="hs-identifier hs-type">isGReflCo_maybe</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#Coercion"><span class="hs-identifier hs-type">Coercion</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Maybe</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#Type"><span class="hs-identifier hs-type">Type</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Language.Haskell.Syntax.Basic.html#Role"><span class="hs-identifier hs-type">Role</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-698"></span><span id="isGReflCo_maybe"><span class="annot"><span class="annottext">isGReflCo_maybe :: Coercion -&gt; Maybe (Type, Role)
</span><a href="GHC.Core.Coercion.html#isGReflCo_maybe"><span class="hs-identifier hs-var hs-var">isGReflCo_maybe</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#GRefl"><span class="hs-identifier hs-type">GRefl</span></a></span><span> </span><span id="local-6989586621682578188"><span class="annot"><span class="annottext">Role
</span><a href="#local-6989586621682578188"><span class="hs-identifier hs-var">r</span></a></span></span><span> </span><span id="local-6989586621682578189"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682578189"><span class="hs-identifier hs-var">ty</span></a></span></span><span> </span><span class="annot"><span class="annottext">MCoercion
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(Type, Role) -&gt; Maybe (Type, Role)
forall a. a -&gt; Maybe a
</span><span class="hs-identifier hs-var">Just</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682578189"><span class="hs-identifier hs-var">ty</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Role
</span><a href="#local-6989586621682578188"><span class="hs-identifier hs-var">r</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-699"></span><span class="annot"><a href="GHC.Core.Coercion.html#isGReflCo_maybe"><span class="hs-identifier hs-var">isGReflCo_maybe</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#Refl"><span class="hs-identifier hs-type">Refl</span></a></span><span> </span><span id="local-6989586621682578190"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682578190"><span class="hs-identifier hs-var">ty</span></a></span></span><span class="hs-special">)</span><span>      </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(Type, Role) -&gt; Maybe (Type, Role)
forall a. a -&gt; Maybe a
</span><span class="hs-identifier hs-var">Just</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682578190"><span class="hs-identifier hs-var">ty</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Role
</span><a href="Language.Haskell.Syntax.Basic.html#Nominal"><span class="hs-identifier hs-var">Nominal</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-700"></span><span class="annot"><a href="GHC.Core.Coercion.html#isGReflCo_maybe"><span class="hs-identifier hs-var">isGReflCo_maybe</span></a></span><span> </span><span class="annot"><span class="annottext">Coercion
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Maybe (Type, Role)
forall a. Maybe a
</span><span class="hs-identifier hs-var">Nothing</span></span><span>
</span><span id="line-701"></span><span>
</span><span id="line-702"></span><span class="hs-comment">-- | Returns the type coerced if this coercion is reflexive. Guaranteed</span><span>
</span><span id="line-703"></span><span class="hs-comment">-- to work very quickly. Sometimes a coercion can be reflexive, but not</span><span>
</span><span id="line-704"></span><span class="hs-comment">-- obviously so. c.f. 'isReflexiveCo_maybe'</span><span>
</span><span id="line-705"></span><span class="annot"><a href="GHC.Core.Coercion.html#isReflCo_maybe"><span class="hs-identifier hs-type">isReflCo_maybe</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#Coercion"><span class="hs-identifier hs-type">Coercion</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Maybe</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#Type"><span class="hs-identifier hs-type">Type</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Language.Haskell.Syntax.Basic.html#Role"><span class="hs-identifier hs-type">Role</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-706"></span><span id="isReflCo_maybe"><span class="annot"><span class="annottext">isReflCo_maybe :: Coercion -&gt; Maybe (Type, Role)
</span><a href="GHC.Core.Coercion.html#isReflCo_maybe"><span class="hs-identifier hs-var hs-var">isReflCo_maybe</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#Refl"><span class="hs-identifier hs-type">Refl</span></a></span><span> </span><span id="local-6989586621682578191"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682578191"><span class="hs-identifier hs-var">ty</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(Type, Role) -&gt; Maybe (Type, Role)
forall a. a -&gt; Maybe a
</span><span class="hs-identifier hs-var">Just</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682578191"><span class="hs-identifier hs-var">ty</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Role
</span><a href="Language.Haskell.Syntax.Basic.html#Nominal"><span class="hs-identifier hs-var">Nominal</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-707"></span><span class="annot"><a href="GHC.Core.Coercion.html#isReflCo_maybe"><span class="hs-identifier hs-var">isReflCo_maybe</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#GRefl"><span class="hs-identifier hs-type">GRefl</span></a></span><span> </span><span id="local-6989586621682578192"><span class="annot"><span class="annottext">Role
</span><a href="#local-6989586621682578192"><span class="hs-identifier hs-var">r</span></a></span></span><span> </span><span id="local-6989586621682578193"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682578193"><span class="hs-identifier hs-var">ty</span></a></span></span><span> </span><span id="local-6989586621682578194"><span class="annot"><span class="annottext">MCoercion
</span><a href="#local-6989586621682578194"><span class="hs-identifier hs-var">mco</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">MCoercion -&gt; Bool
</span><a href="GHC.Core.Coercion.html#isGReflMCo"><span class="hs-identifier hs-var">isGReflMCo</span></a></span><span> </span><span class="annot"><span class="annottext">MCoercion
</span><a href="#local-6989586621682578194"><span class="hs-identifier hs-var">mco</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(Type, Role) -&gt; Maybe (Type, Role)
forall a. a -&gt; Maybe a
</span><span class="hs-identifier hs-var">Just</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682578193"><span class="hs-identifier hs-var">ty</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Role
</span><a href="#local-6989586621682578192"><span class="hs-identifier hs-var">r</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-708"></span><span class="annot"><a href="GHC.Core.Coercion.html#isReflCo_maybe"><span class="hs-identifier hs-var">isReflCo_maybe</span></a></span><span> </span><span class="annot"><span class="annottext">Coercion
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Maybe (Type, Role)
forall a. Maybe a
</span><span class="hs-identifier hs-var">Nothing</span></span><span>
</span><span id="line-709"></span><span>
</span><span id="line-710"></span><span class="hs-comment">-- | Slowly checks if the coercion is reflexive. Don't call this in a loop,</span><span>
</span><span id="line-711"></span><span class="hs-comment">-- as it walks over the entire coercion.</span><span>
</span><span id="line-712"></span><span class="annot"><a href="GHC.Core.Coercion.html#isReflexiveCo"><span class="hs-identifier hs-type">isReflexiveCo</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#Coercion"><span class="hs-identifier hs-type">Coercion</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Bool</span></span><span>
</span><span id="line-713"></span><span id="isReflexiveCo"><span class="annot"><span class="annottext">isReflexiveCo :: Coercion -&gt; Bool
</span><a href="GHC.Core.Coercion.html#isReflexiveCo"><span class="hs-identifier hs-var hs-var">isReflexiveCo</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Maybe (Type, Role) -&gt; Bool
forall a. Maybe a -&gt; Bool
</span><span class="hs-identifier hs-var">isJust</span></span><span> </span><span class="annot"><span class="annottext">(Maybe (Type, Role) -&gt; Bool)
-&gt; (Coercion -&gt; Maybe (Type, Role)) -&gt; Coercion -&gt; Bool
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">Coercion -&gt; Maybe (Type, Role)
</span><a href="GHC.Core.Coercion.html#isReflexiveCo_maybe"><span class="hs-identifier hs-var">isReflexiveCo_maybe</span></a></span><span>
</span><span id="line-714"></span><span>
</span><span id="line-715"></span><span class="hs-comment">-- | Extracts the coerced type from a reflexive coercion. This potentially</span><span>
</span><span id="line-716"></span><span class="hs-comment">-- walks over the entire coercion, so avoid doing this in a loop.</span><span>
</span><span id="line-717"></span><span class="annot"><a href="GHC.Core.Coercion.html#isReflexiveCo_maybe"><span class="hs-identifier hs-type">isReflexiveCo_maybe</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#Coercion"><span class="hs-identifier hs-type">Coercion</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Maybe</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#Type"><span class="hs-identifier hs-type">Type</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Language.Haskell.Syntax.Basic.html#Role"><span class="hs-identifier hs-type">Role</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-718"></span><span id="isReflexiveCo_maybe"><span class="annot"><span class="annottext">isReflexiveCo_maybe :: Coercion -&gt; Maybe (Type, Role)
</span><a href="GHC.Core.Coercion.html#isReflexiveCo_maybe"><span class="hs-identifier hs-var hs-var">isReflexiveCo_maybe</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#Refl"><span class="hs-identifier hs-type">Refl</span></a></span><span> </span><span id="local-6989586621682578197"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682578197"><span class="hs-identifier hs-var">ty</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(Type, Role) -&gt; Maybe (Type, Role)
forall a. a -&gt; Maybe a
</span><span class="hs-identifier hs-var">Just</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682578197"><span class="hs-identifier hs-var">ty</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Role
</span><a href="Language.Haskell.Syntax.Basic.html#Nominal"><span class="hs-identifier hs-var">Nominal</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-719"></span><span class="annot"><a href="GHC.Core.Coercion.html#isReflexiveCo_maybe"><span class="hs-identifier hs-var">isReflexiveCo_maybe</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#GRefl"><span class="hs-identifier hs-type">GRefl</span></a></span><span> </span><span id="local-6989586621682578198"><span class="annot"><span class="annottext">Role
</span><a href="#local-6989586621682578198"><span class="hs-identifier hs-var">r</span></a></span></span><span> </span><span id="local-6989586621682578199"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682578199"><span class="hs-identifier hs-var">ty</span></a></span></span><span> </span><span id="local-6989586621682578200"><span class="annot"><span class="annottext">MCoercion
</span><a href="#local-6989586621682578200"><span class="hs-identifier hs-var">mco</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">MCoercion -&gt; Bool
</span><a href="GHC.Core.Coercion.html#isGReflMCo"><span class="hs-identifier hs-var">isGReflMCo</span></a></span><span> </span><span class="annot"><span class="annottext">MCoercion
</span><a href="#local-6989586621682578200"><span class="hs-identifier hs-var">mco</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(Type, Role) -&gt; Maybe (Type, Role)
forall a. a -&gt; Maybe a
</span><span class="hs-identifier hs-var">Just</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682578199"><span class="hs-identifier hs-var">ty</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Role
</span><a href="#local-6989586621682578198"><span class="hs-identifier hs-var">r</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-720"></span><span class="annot"><a href="GHC.Core.Coercion.html#isReflexiveCo_maybe"><span class="hs-identifier hs-var">isReflexiveCo_maybe</span></a></span><span> </span><span id="local-6989586621682578201"><span class="annot"><span class="annottext">Coercion
</span><a href="#local-6989586621682578201"><span class="hs-identifier hs-var">co</span></a></span></span><span>
</span><span id="line-721"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682578202"><span class="hs-identifier hs-var">ty1</span></a></span><span> </span><span class="annot"><span class="annottext">HasCallStack =&gt; Type -&gt; Type -&gt; Bool
Type -&gt; Type -&gt; Bool
</span><a href="GHC.Core.TyCo.Compare.html#eqType"><span class="hs-operator hs-var">`eqType`</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682578203"><span class="hs-identifier hs-var">ty2</span></a></span><span>
</span><span id="line-722"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(Type, Role) -&gt; Maybe (Type, Role)
forall a. a -&gt; Maybe a
</span><span class="hs-identifier hs-var">Just</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682578202"><span class="hs-identifier hs-var">ty1</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Role
</span><a href="#local-6989586621682578204"><span class="hs-identifier hs-var">r</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-723"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">otherwise</span></span><span>
</span><span id="line-724"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Maybe (Type, Role)
forall a. Maybe a
</span><span class="hs-identifier hs-var">Nothing</span></span><span>
</span><span id="line-725"></span><span>  </span><span class="hs-keyword">where</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Data.Pair.html#Pair"><span class="hs-identifier hs-type">Pair</span></a></span><span> </span><span id="local-6989586621682578202"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682578202"><span class="hs-identifier hs-var">ty1</span></a></span></span><span> </span><span id="local-6989586621682578203"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682578203"><span class="hs-identifier hs-var">ty2</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682578204"><span class="annot"><span class="annottext">Role
</span><a href="#local-6989586621682578204"><span class="hs-identifier hs-var">r</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Coercion -&gt; (Pair Type, Role)
</span><a href="GHC.Core.Coercion.html#coercionKindRole"><span class="hs-identifier hs-var">coercionKindRole</span></a></span><span> </span><span class="annot"><span class="annottext">Coercion
</span><a href="#local-6989586621682578201"><span class="hs-identifier hs-var">co</span></a></span><span>
</span><span id="line-726"></span><span>
</span><span id="line-727"></span><span>
</span><span id="line-728"></span><span class="hs-comment">{-
%************************************************************************
%*                                                                      *
            Building coercions
%*                                                                      *
%************************************************************************

These &quot;smart constructors&quot; maintain the invariants listed in the definition
of Coercion, and they perform very basic optimizations.

Note [Role twiddling functions]
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
There are a plethora of functions for twiddling roles:

mkSubCo: Requires a nominal input coercion and always produces a
representational output. This is used when you (the programmer) are sure you
know exactly that role you have and what you want.

downgradeRole_maybe: This function takes both the input role and the output role
as parameters. (The *output* role comes first!) It can only *downgrade* a
role -- that is, change it from N to R or P, or from R to P. This one-way
behavior is why there is the &quot;_maybe&quot;. If an upgrade is requested, this
function produces Nothing. This is used when you need to change the role of a
coercion, but you're not sure (as you're writing the code) of which roles are
involved.

This function could have been written using coercionRole to ascertain the role
of the input. But, that function is recursive, and the caller of downgradeRole_maybe
often knows the input role. So, this is more efficient.

downgradeRole: This is just like downgradeRole_maybe, but it panics if the
conversion isn't a downgrade.

setNominalRole_maybe: This is the only function that can *upgrade* a coercion.
The result (if it exists) is always Nominal. The input can be at any role. It
works on a &quot;best effort&quot; basis, as it should never be strictly necessary to
upgrade a coercion during compilation. It is currently only used within GHC in
splitAppCo_maybe. In order to be a proper inverse of mkAppCo, the second
coercion that splitAppCo_maybe returns must be nominal. But, it's conceivable
that splitAppCo_maybe is operating over a TyConAppCo that uses a
representational coercion. Hence the need for setNominalRole_maybe.
splitAppCo_maybe, in turn, is used only within coercion optimization -- thus,
it is not absolutely critical that setNominalRole_maybe be complete.

Note that setNominalRole_maybe will never upgrade a phantom UnivCo. Phantom
UnivCos are perfectly type-safe, whereas representational and nominal ones are
not. (Nominal ones are no worse than representational ones, so this function *will*
change a UnivCo Representational to a UnivCo Nominal.)

Conal Elliott also came across a need for this function while working with the
GHC API, as he was decomposing Core casts. The Core casts use representational
coercions, as they must, but his use case required nominal coercions (he was
building a GADT). So, that's why this function is exported from this module.

One might ask: shouldn't downgradeRole_maybe just use setNominalRole_maybe as
appropriate? I (Richard E.) have decided not to do this, because upgrading a
role is bizarre and a caller should have to ask for this behavior explicitly.

-}</span><span>
</span><span id="line-787"></span><span>
</span><span id="line-788"></span><span class="annot"><span class="hs-comment">-- | Make a reflexive coercion</span></span><span>
</span><span id="line-789"></span><span class="annot"><a href="GHC.Core.Coercion.html#mkReflCo"><span class="hs-identifier hs-type">mkReflCo</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Language.Haskell.Syntax.Basic.html#Role"><span class="hs-identifier hs-type">Role</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#Type"><span class="hs-identifier hs-type">Type</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#Coercion"><span class="hs-identifier hs-type">Coercion</span></a></span><span>
</span><span id="line-790"></span><span id="mkReflCo"><span class="annot"><span class="annottext">mkReflCo :: Role -&gt; Type -&gt; Coercion
</span><a href="GHC.Core.Coercion.html#mkReflCo"><span class="hs-identifier hs-var hs-var">mkReflCo</span></a></span></span><span> </span><span class="annot"><span class="annottext">Role
</span><a href="Language.Haskell.Syntax.Basic.html#Nominal"><span class="hs-identifier hs-var">Nominal</span></a></span><span> </span><span id="local-6989586621682578205"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682578205"><span class="hs-identifier hs-var">ty</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Type -&gt; Coercion
</span><a href="GHC.Core.TyCo.Rep.html#Refl"><span class="hs-identifier hs-var">Refl</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682578205"><span class="hs-identifier hs-var">ty</span></a></span><span>
</span><span id="line-791"></span><span class="annot"><a href="GHC.Core.Coercion.html#mkReflCo"><span class="hs-identifier hs-var">mkReflCo</span></a></span><span> </span><span id="local-6989586621682578206"><span class="annot"><span class="annottext">Role
</span><a href="#local-6989586621682578206"><span class="hs-identifier hs-var">r</span></a></span></span><span>       </span><span id="local-6989586621682578207"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682578207"><span class="hs-identifier hs-var">ty</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Role -&gt; Type -&gt; MCoercion -&gt; Coercion
</span><a href="GHC.Core.TyCo.Rep.html#GRefl"><span class="hs-identifier hs-var">GRefl</span></a></span><span> </span><span class="annot"><span class="annottext">Role
</span><a href="#local-6989586621682578206"><span class="hs-identifier hs-var">r</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682578207"><span class="hs-identifier hs-var">ty</span></a></span><span> </span><span class="annot"><span class="annottext">MCoercion
</span><a href="GHC.Core.TyCo.Rep.html#MRefl"><span class="hs-identifier hs-var">MRefl</span></a></span><span>
</span><span id="line-792"></span><span>
</span><span id="line-793"></span><span class="annot"><span class="hs-comment">-- | Make a representational reflexive coercion</span></span><span>
</span><span id="line-794"></span><span class="annot"><a href="GHC.Core.Coercion.html#mkRepReflCo"><span class="hs-identifier hs-type">mkRepReflCo</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#Type"><span class="hs-identifier hs-type">Type</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#Coercion"><span class="hs-identifier hs-type">Coercion</span></a></span><span>
</span><span id="line-795"></span><span id="mkRepReflCo"><span class="annot"><span class="annottext">mkRepReflCo :: Type -&gt; Coercion
</span><a href="GHC.Core.Coercion.html#mkRepReflCo"><span class="hs-identifier hs-var hs-var">mkRepReflCo</span></a></span></span><span> </span><span id="local-6989586621682578208"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682578208"><span class="hs-identifier hs-var">ty</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Role -&gt; Type -&gt; MCoercion -&gt; Coercion
</span><a href="GHC.Core.TyCo.Rep.html#GRefl"><span class="hs-identifier hs-var">GRefl</span></a></span><span> </span><span class="annot"><span class="annottext">Role
</span><a href="Language.Haskell.Syntax.Basic.html#Representational"><span class="hs-identifier hs-var">Representational</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682578208"><span class="hs-identifier hs-var">ty</span></a></span><span> </span><span class="annot"><span class="annottext">MCoercion
</span><a href="GHC.Core.TyCo.Rep.html#MRefl"><span class="hs-identifier hs-var">MRefl</span></a></span><span>
</span><span id="line-796"></span><span>
</span><span id="line-797"></span><span class="annot"><span class="hs-comment">-- | Make a nominal reflexive coercion</span></span><span>
</span><span id="line-798"></span><span class="annot"><a href="GHC.Core.Coercion.html#mkNomReflCo"><span class="hs-identifier hs-type">mkNomReflCo</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#Type"><span class="hs-identifier hs-type">Type</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#Coercion"><span class="hs-identifier hs-type">Coercion</span></a></span><span>
</span><span id="line-799"></span><span id="mkNomReflCo"><span class="annot"><span class="annottext">mkNomReflCo :: Type -&gt; Coercion
</span><a href="GHC.Core.Coercion.html#mkNomReflCo"><span class="hs-identifier hs-var hs-var">mkNomReflCo</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Type -&gt; Coercion
</span><a href="GHC.Core.TyCo.Rep.html#Refl"><span class="hs-identifier hs-var">Refl</span></a></span><span>
</span><span id="line-800"></span><span>
</span><span id="line-801"></span><span class="hs-comment">-- | Apply a type constructor to a list of coercions. It is the</span><span>
</span><span id="line-802"></span><span class="hs-comment">-- caller's responsibility to get the roles correct on argument coercions.</span><span>
</span><span id="line-803"></span><span class="annot"><a href="GHC.Core.Coercion.html#mkTyConAppCo"><span class="hs-identifier hs-type">mkTyConAppCo</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Utils.Misc.html#HasDebugCallStack"><span class="hs-identifier hs-type">HasDebugCallStack</span></a></span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="Language.Haskell.Syntax.Basic.html#Role"><span class="hs-identifier hs-type">Role</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Core.TyCon.html#TyCon"><span class="hs-identifier hs-type">TyCon</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#Coercion"><span class="hs-identifier hs-type">Coercion</span></a></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#Coercion"><span class="hs-identifier hs-type">Coercion</span></a></span><span>
</span><span id="line-804"></span><span id="mkTyConAppCo"><span class="annot"><span class="annottext">mkTyConAppCo :: HasDebugCallStack =&gt; Role -&gt; TyCon -&gt; [Coercion] -&gt; Coercion
</span><a href="GHC.Core.Coercion.html#mkTyConAppCo"><span class="hs-identifier hs-var hs-var">mkTyConAppCo</span></a></span></span><span> </span><span id="local-6989586621682578215"><span class="annot"><span class="annottext">Role
</span><a href="#local-6989586621682578215"><span class="hs-identifier hs-var">r</span></a></span></span><span> </span><span id="local-6989586621682578216"><span class="annot"><span class="annottext">TyCon
</span><a href="#local-6989586621682578216"><span class="hs-identifier hs-var">tc</span></a></span></span><span> </span><span id="local-6989586621682578217"><span class="annot"><span class="annottext">[Coercion]
</span><a href="#local-6989586621682578217"><span class="hs-identifier hs-var">cos</span></a></span></span><span>
</span><span id="line-805"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span id="local-6989586621682578218"><span class="annot"><span class="annottext">Coercion
</span><a href="#local-6989586621682578218"><span class="hs-identifier hs-var">co</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">HasDebugCallStack =&gt; Role -&gt; TyCon -&gt; [Coercion] -&gt; Maybe Coercion
Role -&gt; TyCon -&gt; [Coercion] -&gt; Maybe Coercion
</span><a href="GHC.Core.Type.html#tyConAppFunCo_maybe"><span class="hs-identifier hs-var">tyConAppFunCo_maybe</span></a></span><span> </span><span class="annot"><span class="annottext">Role
</span><a href="#local-6989586621682578215"><span class="hs-identifier hs-var">r</span></a></span><span> </span><span class="annot"><span class="annottext">TyCon
</span><a href="#local-6989586621682578216"><span class="hs-identifier hs-var">tc</span></a></span><span> </span><span class="annot"><span class="annottext">[Coercion]
</span><a href="#local-6989586621682578217"><span class="hs-identifier hs-var">cos</span></a></span><span>
</span><span id="line-806"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Coercion
</span><a href="#local-6989586621682578218"><span class="hs-identifier hs-var">co</span></a></span><span>
</span><span id="line-807"></span><span>
</span><span id="line-808"></span><span>  </span><span class="hs-comment">-- Expand type synonyms</span><span>
</span><span id="line-809"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span class="annot"><a href="GHC.Core.TyCon.html#ExpandsSyn"><span class="hs-identifier hs-type">ExpandsSyn</span></a></span><span> </span><span id="local-6989586621682578221"><span class="annot"><span class="annottext">[(CoVar, Coercion)]
</span><a href="#local-6989586621682578221"><span class="hs-identifier hs-var">tv_co_prs</span></a></span></span><span> </span><span id="local-6989586621682578222"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682578222"><span class="hs-identifier hs-var">rhs_ty</span></a></span></span><span> </span><span id="local-6989586621682578223"><span class="annot"><span class="annottext">[Coercion]
</span><a href="#local-6989586621682578223"><span class="hs-identifier hs-var">leftover_cos</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">TyCon -&gt; [Coercion] -&gt; ExpandSynResult Coercion
forall tyco. TyCon -&gt; [tyco] -&gt; ExpandSynResult tyco
</span><a href="GHC.Core.TyCon.html#expandSynTyCon_maybe"><span class="hs-identifier hs-var">expandSynTyCon_maybe</span></a></span><span> </span><span class="annot"><span class="annottext">TyCon
</span><a href="#local-6989586621682578216"><span class="hs-identifier hs-var">tc</span></a></span><span> </span><span class="annot"><span class="annottext">[Coercion]
</span><a href="#local-6989586621682578217"><span class="hs-identifier hs-var">cos</span></a></span><span>
</span><span id="line-810"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Coercion -&gt; [Coercion] -&gt; Coercion
</span><a href="GHC.Core.Coercion.html#mkAppCos"><span class="hs-identifier hs-var">mkAppCos</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">HasDebugCallStack =&gt; Role -&gt; LiftingContext -&gt; Type -&gt; Coercion
Role -&gt; LiftingContext -&gt; Type -&gt; Coercion
</span><a href="GHC.Core.Coercion.html#liftCoSubst"><span class="hs-identifier hs-var">liftCoSubst</span></a></span><span> </span><span class="annot"><span class="annottext">Role
</span><a href="#local-6989586621682578215"><span class="hs-identifier hs-var">r</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[(CoVar, Coercion)] -&gt; LiftingContext
</span><a href="GHC.Core.Coercion.html#mkLiftingContext"><span class="hs-identifier hs-var">mkLiftingContext</span></a></span><span> </span><span class="annot"><span class="annottext">[(CoVar, Coercion)]
</span><a href="#local-6989586621682578221"><span class="hs-identifier hs-var">tv_co_prs</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682578222"><span class="hs-identifier hs-var">rhs_ty</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[Coercion]
</span><a href="#local-6989586621682578223"><span class="hs-identifier hs-var">leftover_cos</span></a></span><span>
</span><span id="line-811"></span><span>
</span><span id="line-812"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span id="local-6989586621682578226"><span class="annot"><span class="annottext">[(Type, Role)]
</span><a href="#local-6989586621682578226"><span class="hs-identifier hs-var">tys_roles</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">(Coercion -&gt; Maybe (Type, Role))
-&gt; [Coercion] -&gt; Maybe [(Type, Role)]
forall (t :: * -&gt; *) (f :: * -&gt; *) a b.
(Traversable t, Applicative f) =&gt;
(a -&gt; f b) -&gt; t a -&gt; f (t b)
forall (f :: * -&gt; *) a b.
Applicative f =&gt;
(a -&gt; f b) -&gt; [a] -&gt; f [b]
</span><span class="hs-identifier hs-var">traverse</span></span><span> </span><span class="annot"><span class="annottext">Coercion -&gt; Maybe (Type, Role)
</span><a href="GHC.Core.Coercion.html#isReflCo_maybe"><span class="hs-identifier hs-var">isReflCo_maybe</span></a></span><span> </span><span class="annot"><span class="annottext">[Coercion]
</span><a href="#local-6989586621682578217"><span class="hs-identifier hs-var">cos</span></a></span><span>
</span><span id="line-813"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Role -&gt; Type -&gt; Coercion
</span><a href="GHC.Core.Coercion.html#mkReflCo"><span class="hs-identifier hs-var">mkReflCo</span></a></span><span> </span><span class="annot"><span class="annottext">Role
</span><a href="#local-6989586621682578215"><span class="hs-identifier hs-var">r</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TyCon -&gt; [Type] -&gt; Type
</span><a href="GHC.Core.Type.html#mkTyConApp"><span class="hs-identifier hs-var">mkTyConApp</span></a></span><span> </span><span class="annot"><span class="annottext">TyCon
</span><a href="#local-6989586621682578216"><span class="hs-identifier hs-var">tc</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">((Type, Role) -&gt; Type) -&gt; [(Type, Role)] -&gt; [Type]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><span class="hs-identifier hs-var">map</span></span><span> </span><span class="annot"><span class="annottext">(Type, Role) -&gt; Type
forall a b. (a, b) -&gt; a
</span><span class="hs-identifier hs-var">fst</span></span><span> </span><span class="annot"><span class="annottext">[(Type, Role)]
</span><a href="#local-6989586621682578226"><span class="hs-identifier hs-var">tys_roles</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-814"></span><span>  </span><span class="hs-comment">-- See Note [Refl invariant]</span><span>
</span><span id="line-815"></span><span>
</span><span id="line-816"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">otherwise</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Role -&gt; TyCon -&gt; [Coercion] -&gt; Coercion
</span><a href="GHC.Core.TyCo.Rep.html#TyConAppCo"><span class="hs-identifier hs-var">TyConAppCo</span></a></span><span> </span><span class="annot"><span class="annottext">Role
</span><a href="#local-6989586621682578215"><span class="hs-identifier hs-var">r</span></a></span><span> </span><span class="annot"><span class="annottext">TyCon
</span><a href="#local-6989586621682578216"><span class="hs-identifier hs-var">tc</span></a></span><span> </span><span class="annot"><span class="annottext">[Coercion]
</span><a href="#local-6989586621682578217"><span class="hs-identifier hs-var">cos</span></a></span><span>
</span><span id="line-817"></span><span>
</span><span id="line-818"></span><span class="annot"><a href="GHC.Core.Coercion.html#mkFunCoNoFTF"><span class="hs-identifier hs-type">mkFunCoNoFTF</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Utils.Misc.html#HasDebugCallStack"><span class="hs-identifier hs-type">HasDebugCallStack</span></a></span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="Language.Haskell.Syntax.Basic.html#Role"><span class="hs-identifier hs-type">Role</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#CoercionN"><span class="hs-identifier hs-type">CoercionN</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#Coercion"><span class="hs-identifier hs-type">Coercion</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#Coercion"><span class="hs-identifier hs-type">Coercion</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#Coercion"><span class="hs-identifier hs-type">Coercion</span></a></span><span>
</span><span id="line-819"></span><span class="hs-comment">-- This version of mkFunCo takes no FunTyFlags; it works them out</span><span>
</span><span id="line-820"></span><span id="mkFunCoNoFTF"><span class="annot"><span class="annottext">mkFunCoNoFTF :: HasDebugCallStack =&gt;
Role -&gt; Coercion -&gt; Coercion -&gt; Coercion -&gt; Coercion
</span><a href="GHC.Core.Coercion.html#mkFunCoNoFTF"><span class="hs-identifier hs-var hs-var">mkFunCoNoFTF</span></a></span></span><span> </span><span id="local-6989586621682578235"><span class="annot"><span class="annottext">Role
</span><a href="#local-6989586621682578235"><span class="hs-identifier hs-var">r</span></a></span></span><span> </span><span id="local-6989586621682578236"><span class="annot"><span class="annottext">Coercion
</span><a href="#local-6989586621682578236"><span class="hs-identifier hs-var">w</span></a></span></span><span> </span><span id="local-6989586621682578237"><span class="annot"><span class="annottext">Coercion
</span><a href="#local-6989586621682578237"><span class="hs-identifier hs-var">arg_co</span></a></span></span><span> </span><span id="local-6989586621682578238"><span class="annot"><span class="annottext">Coercion
</span><a href="#local-6989586621682578238"><span class="hs-identifier hs-var">res_co</span></a></span></span><span>
</span><span id="line-821"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Role
-&gt; FunTyFlag
-&gt; FunTyFlag
-&gt; Coercion
-&gt; Coercion
-&gt; Coercion
-&gt; Coercion
</span><a href="GHC.Core.Coercion.html#mkFunCo2"><span class="hs-identifier hs-var">mkFunCo2</span></a></span><span> </span><span class="annot"><span class="annottext">Role
</span><a href="#local-6989586621682578235"><span class="hs-identifier hs-var">r</span></a></span><span> </span><span class="annot"><span class="annottext">FunTyFlag
</span><a href="#local-6989586621682578239"><span class="hs-identifier hs-var">afl</span></a></span><span> </span><span class="annot"><span class="annottext">FunTyFlag
</span><a href="#local-6989586621682578240"><span class="hs-identifier hs-var">afr</span></a></span><span> </span><span class="annot"><span class="annottext">Coercion
</span><a href="#local-6989586621682578236"><span class="hs-identifier hs-var">w</span></a></span><span> </span><span class="annot"><span class="annottext">Coercion
</span><a href="#local-6989586621682578237"><span class="hs-identifier hs-var">arg_co</span></a></span><span> </span><span class="annot"><span class="annottext">Coercion
</span><a href="#local-6989586621682578238"><span class="hs-identifier hs-var">res_co</span></a></span><span>
</span><span id="line-822"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-823"></span><span>    </span><span id="local-6989586621682578239"><span class="annot"><span class="annottext">afl :: FunTyFlag
</span><a href="#local-6989586621682578239"><span class="hs-identifier hs-var hs-var">afl</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">HasDebugCallStack =&gt; Type -&gt; Type -&gt; FunTyFlag
Type -&gt; Type -&gt; FunTyFlag
</span><a href="GHC.Core.Type.html#chooseFunTyFlag"><span class="hs-identifier hs-var">chooseFunTyFlag</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682578242"><span class="hs-identifier hs-var">argl_ty</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682578243"><span class="hs-identifier hs-var">resl_ty</span></a></span><span>
</span><span id="line-824"></span><span>    </span><span id="local-6989586621682578240"><span class="annot"><span class="annottext">afr :: FunTyFlag
</span><a href="#local-6989586621682578240"><span class="hs-identifier hs-var hs-var">afr</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">HasDebugCallStack =&gt; Type -&gt; Type -&gt; FunTyFlag
Type -&gt; Type -&gt; FunTyFlag
</span><a href="GHC.Core.Type.html#chooseFunTyFlag"><span class="hs-identifier hs-var">chooseFunTyFlag</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682578244"><span class="hs-identifier hs-var">argr_ty</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682578245"><span class="hs-identifier hs-var">resr_ty</span></a></span><span>
</span><span id="line-825"></span><span>    </span><span class="annot"><a href="GHC.Data.Pair.html#Pair"><span class="hs-identifier hs-type">Pair</span></a></span><span> </span><span id="local-6989586621682578242"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682578242"><span class="hs-identifier hs-var">argl_ty</span></a></span></span><span> </span><span id="local-6989586621682578244"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682578244"><span class="hs-identifier hs-var">argr_ty</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">HasDebugCallStack =&gt; Coercion -&gt; Pair Type
Coercion -&gt; Pair Type
</span><a href="GHC.Core.Coercion.html#coercionKind"><span class="hs-identifier hs-var">coercionKind</span></a></span><span> </span><span class="annot"><span class="annottext">Coercion
</span><a href="#local-6989586621682578237"><span class="hs-identifier hs-var">arg_co</span></a></span><span>
</span><span id="line-826"></span><span>    </span><span class="annot"><a href="GHC.Data.Pair.html#Pair"><span class="hs-identifier hs-type">Pair</span></a></span><span> </span><span id="local-6989586621682578243"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682578243"><span class="hs-identifier hs-var">resl_ty</span></a></span></span><span> </span><span id="local-6989586621682578245"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682578245"><span class="hs-identifier hs-var">resr_ty</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">HasDebugCallStack =&gt; Coercion -&gt; Pair Type
Coercion -&gt; Pair Type
</span><a href="GHC.Core.Coercion.html#coercionKind"><span class="hs-identifier hs-var">coercionKind</span></a></span><span> </span><span class="annot"><span class="annottext">Coercion
</span><a href="#local-6989586621682578238"><span class="hs-identifier hs-var">res_co</span></a></span><span>
</span><span id="line-827"></span><span>
</span><span id="line-828"></span><span class="hs-comment">-- | Build a function 'Coercion' from two other 'Coercion's. That is,</span><span>
</span><span id="line-829"></span><span class="hs-comment">-- given @co1 :: a ~ b@ and @co2 :: x ~ y@ produce @co :: (a -&gt; x) ~ (b -&gt; y)@</span><span>
</span><span id="line-830"></span><span class="hs-comment">-- or @(a =&gt; x) ~ (b =&gt; y)@, depending on the kind of @a@/@b@.</span><span>
</span><span id="line-831"></span><span class="hs-comment">-- This (most common) version takes a single FunTyFlag, which is used</span><span>
</span><span id="line-832"></span><span class="hs-comment">--   for both fco_afl and ftf_afr of the FunCo</span><span>
</span><span id="line-833"></span><span class="annot"><a href="GHC.Core.Coercion.html#mkFunCo"><span class="hs-identifier hs-type">mkFunCo</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Language.Haskell.Syntax.Basic.html#Role"><span class="hs-identifier hs-type">Role</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Types.Var.html#FunTyFlag"><span class="hs-identifier hs-type">FunTyFlag</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#CoercionN"><span class="hs-identifier hs-type">CoercionN</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#Coercion"><span class="hs-identifier hs-type">Coercion</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#Coercion"><span class="hs-identifier hs-type">Coercion</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#Coercion"><span class="hs-identifier hs-type">Coercion</span></a></span><span>
</span><span id="line-834"></span><span id="mkFunCo"><span class="annot"><span class="annottext">mkFunCo :: Role -&gt; FunTyFlag -&gt; Coercion -&gt; Coercion -&gt; Coercion -&gt; Coercion
</span><a href="GHC.Core.Coercion.html#mkFunCo"><span class="hs-identifier hs-var hs-var">mkFunCo</span></a></span></span><span> </span><span id="local-6989586621682578246"><span class="annot"><span class="annottext">Role
</span><a href="#local-6989586621682578246"><span class="hs-identifier hs-var">r</span></a></span></span><span> </span><span id="local-6989586621682578247"><span class="annot"><span class="annottext">FunTyFlag
</span><a href="#local-6989586621682578247"><span class="hs-identifier hs-var">af</span></a></span></span><span> </span><span id="local-6989586621682578248"><span class="annot"><span class="annottext">Coercion
</span><a href="#local-6989586621682578248"><span class="hs-identifier hs-var">w</span></a></span></span><span> </span><span id="local-6989586621682578249"><span class="annot"><span class="annottext">Coercion
</span><a href="#local-6989586621682578249"><span class="hs-identifier hs-var">arg_co</span></a></span></span><span> </span><span id="local-6989586621682578250"><span class="annot"><span class="annottext">Coercion
</span><a href="#local-6989586621682578250"><span class="hs-identifier hs-var">res_co</span></a></span></span><span>
</span><span id="line-835"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Role
-&gt; FunTyFlag
-&gt; FunTyFlag
-&gt; Coercion
-&gt; Coercion
-&gt; Coercion
-&gt; Coercion
</span><a href="GHC.Core.Coercion.html#mkFunCo2"><span class="hs-identifier hs-var">mkFunCo2</span></a></span><span> </span><span class="annot"><span class="annottext">Role
</span><a href="#local-6989586621682578246"><span class="hs-identifier hs-var">r</span></a></span><span> </span><span class="annot"><span class="annottext">FunTyFlag
</span><a href="#local-6989586621682578247"><span class="hs-identifier hs-var">af</span></a></span><span> </span><span class="annot"><span class="annottext">FunTyFlag
</span><a href="#local-6989586621682578247"><span class="hs-identifier hs-var">af</span></a></span><span> </span><span class="annot"><span class="annottext">Coercion
</span><a href="#local-6989586621682578248"><span class="hs-identifier hs-var">w</span></a></span><span> </span><span class="annot"><span class="annottext">Coercion
</span><a href="#local-6989586621682578249"><span class="hs-identifier hs-var">arg_co</span></a></span><span> </span><span class="annot"><span class="annottext">Coercion
</span><a href="#local-6989586621682578250"><span class="hs-identifier hs-var">res_co</span></a></span><span>
</span><span id="line-836"></span><span>
</span><span id="line-837"></span><span class="annot"><a href="GHC.Core.Coercion.html#mkNakedFunCo"><span class="hs-identifier hs-type">mkNakedFunCo</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Language.Haskell.Syntax.Basic.html#Role"><span class="hs-identifier hs-type">Role</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Types.Var.html#FunTyFlag"><span class="hs-identifier hs-type">FunTyFlag</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#CoercionN"><span class="hs-identifier hs-type">CoercionN</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#Coercion"><span class="hs-identifier hs-type">Coercion</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#Coercion"><span class="hs-identifier hs-type">Coercion</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#Coercion"><span class="hs-identifier hs-type">Coercion</span></a></span><span>
</span><span id="line-838"></span><span class="hs-comment">-- This version of mkFunCo does not check FunCo invariants (checkFunCo)</span><span>
</span><span id="line-839"></span><span class="hs-comment">-- It's a historical vestige; See Note [No assertion check on mkFunCo]</span><span>
</span><span id="line-840"></span><span id="mkNakedFunCo"><span class="annot"><span class="annottext">mkNakedFunCo :: Role -&gt; FunTyFlag -&gt; Coercion -&gt; Coercion -&gt; Coercion -&gt; Coercion
</span><a href="GHC.Core.Coercion.html#mkNakedFunCo"><span class="hs-identifier hs-var hs-var">mkNakedFunCo</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Role -&gt; FunTyFlag -&gt; Coercion -&gt; Coercion -&gt; Coercion -&gt; Coercion
</span><a href="GHC.Core.Coercion.html#mkFunCo"><span class="hs-identifier hs-var">mkFunCo</span></a></span><span>
</span><span id="line-841"></span><span>
</span><span id="line-842"></span><span class="annot"><a href="GHC.Core.Coercion.html#mkFunCo2"><span class="hs-identifier hs-type">mkFunCo2</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Language.Haskell.Syntax.Basic.html#Role"><span class="hs-identifier hs-type">Role</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Types.Var.html#FunTyFlag"><span class="hs-identifier hs-type">FunTyFlag</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Types.Var.html#FunTyFlag"><span class="hs-identifier hs-type">FunTyFlag</span></a></span><span>
</span><span id="line-843"></span><span>         </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#CoercionN"><span class="hs-identifier hs-type">CoercionN</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#Coercion"><span class="hs-identifier hs-type">Coercion</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#Coercion"><span class="hs-identifier hs-type">Coercion</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#Coercion"><span class="hs-identifier hs-type">Coercion</span></a></span><span>
</span><span id="line-844"></span><span class="hs-comment">-- This is the smart constructor for FunCo; it checks invariants</span><span>
</span><span id="line-845"></span><span id="mkFunCo2"><span class="annot"><span class="annottext">mkFunCo2 :: Role
-&gt; FunTyFlag
-&gt; FunTyFlag
-&gt; Coercion
-&gt; Coercion
-&gt; Coercion
-&gt; Coercion
</span><a href="GHC.Core.Coercion.html#mkFunCo2"><span class="hs-identifier hs-var hs-var">mkFunCo2</span></a></span></span><span> </span><span id="local-6989586621682578251"><span class="annot"><span class="annottext">Role
</span><a href="#local-6989586621682578251"><span class="hs-identifier hs-var">r</span></a></span></span><span> </span><span id="local-6989586621682578252"><span class="annot"><span class="annottext">FunTyFlag
</span><a href="#local-6989586621682578252"><span class="hs-identifier hs-var">afl</span></a></span></span><span> </span><span id="local-6989586621682578253"><span class="annot"><span class="annottext">FunTyFlag
</span><a href="#local-6989586621682578253"><span class="hs-identifier hs-var">afr</span></a></span></span><span> </span><span id="local-6989586621682578254"><span class="annot"><span class="annottext">Coercion
</span><a href="#local-6989586621682578254"><span class="hs-identifier hs-var">w</span></a></span></span><span> </span><span id="local-6989586621682578255"><span class="annot"><span class="annottext">Coercion
</span><a href="#local-6989586621682578255"><span class="hs-identifier hs-var">arg_co</span></a></span></span><span> </span><span id="local-6989586621682578256"><span class="annot"><span class="annottext">Coercion
</span><a href="#local-6989586621682578256"><span class="hs-identifier hs-var">res_co</span></a></span></span><span>
</span><span id="line-846"></span><span>  </span><span class="hs-comment">-- See Note [No assertion check on mkFunCo]</span><span>
</span><span id="line-847"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span class="hs-special">(</span><span id="local-6989586621682578257"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682578257"><span class="hs-identifier hs-var">ty1</span></a></span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Role
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Coercion -&gt; Maybe (Type, Role)
</span><a href="GHC.Core.Coercion.html#isReflCo_maybe"><span class="hs-identifier hs-var">isReflCo_maybe</span></a></span><span> </span><span class="annot"><span class="annottext">Coercion
</span><a href="#local-6989586621682578255"><span class="hs-identifier hs-var">arg_co</span></a></span><span>
</span><span id="line-848"></span><span>  </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span class="hs-special">(</span><span id="local-6989586621682578258"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682578258"><span class="hs-identifier hs-var">ty2</span></a></span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Role
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Coercion -&gt; Maybe (Type, Role)
</span><a href="GHC.Core.Coercion.html#isReflCo_maybe"><span class="hs-identifier hs-var">isReflCo_maybe</span></a></span><span> </span><span class="annot"><span class="annottext">Coercion
</span><a href="#local-6989586621682578256"><span class="hs-identifier hs-var">res_co</span></a></span><span>
</span><span id="line-849"></span><span>  </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span class="hs-special">(</span><span id="local-6989586621682578259"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682578259"><span class="hs-identifier hs-var">w</span></a></span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Role
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span>   </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Coercion -&gt; Maybe (Type, Role)
</span><a href="GHC.Core.Coercion.html#isReflCo_maybe"><span class="hs-identifier hs-var">isReflCo_maybe</span></a></span><span> </span><span class="annot"><span class="annottext">Coercion
</span><a href="#local-6989586621682578254"><span class="hs-identifier hs-var">w</span></a></span><span>
</span><span id="line-850"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Role -&gt; Type -&gt; Coercion
</span><a href="GHC.Core.Coercion.html#mkReflCo"><span class="hs-identifier hs-var">mkReflCo</span></a></span><span> </span><span class="annot"><span class="annottext">Role
</span><a href="#local-6989586621682578251"><span class="hs-identifier hs-var">r</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">HasDebugCallStack =&gt; FunTyFlag -&gt; Type -&gt; Type -&gt; Type -&gt; Type
FunTyFlag -&gt; Type -&gt; Type -&gt; Type -&gt; Type
</span><a href="GHC.Core.TyCo.Rep.html#mkFunTy"><span class="hs-identifier hs-var">mkFunTy</span></a></span><span> </span><span class="annot"><span class="annottext">FunTyFlag
</span><a href="#local-6989586621682578252"><span class="hs-identifier hs-var">afl</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682578259"><span class="hs-identifier hs-var">w</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682578257"><span class="hs-identifier hs-var">ty1</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682578258"><span class="hs-identifier hs-var">ty2</span></a></span><span class="hs-special">)</span><span>  </span><span class="hs-comment">-- See Note [Refl invariant]</span><span>
</span><span id="line-851"></span><span>
</span><span id="line-852"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">otherwise</span></span><span>
</span><span id="line-853"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#FunCo"><span class="hs-identifier hs-type">FunCo</span></a></span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">fco_role :: Role
</span><a href="GHC.Core.TyCo.Rep.html#fco_role"><span class="hs-identifier hs-var">fco_role</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Role
</span><a href="#local-6989586621682578251"><span class="hs-identifier hs-var">r</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">fco_afl :: FunTyFlag
</span><a href="GHC.Core.TyCo.Rep.html#fco_afl"><span class="hs-identifier hs-var">fco_afl</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">FunTyFlag
</span><a href="#local-6989586621682578252"><span class="hs-identifier hs-var">afl</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">fco_afr :: FunTyFlag
</span><a href="GHC.Core.TyCo.Rep.html#fco_afr"><span class="hs-identifier hs-var">fco_afr</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">FunTyFlag
</span><a href="#local-6989586621682578253"><span class="hs-identifier hs-var">afr</span></a></span><span>
</span><span id="line-854"></span><span>          </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">fco_mult :: Coercion
</span><a href="GHC.Core.TyCo.Rep.html#fco_mult"><span class="hs-identifier hs-var">fco_mult</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Coercion
</span><a href="#local-6989586621682578254"><span class="hs-identifier hs-var">w</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">fco_arg :: Coercion
</span><a href="GHC.Core.TyCo.Rep.html#fco_arg"><span class="hs-identifier hs-var">fco_arg</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Coercion
</span><a href="#local-6989586621682578255"><span class="hs-identifier hs-var">arg_co</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">fco_res :: Coercion
</span><a href="GHC.Core.TyCo.Rep.html#fco_res"><span class="hs-identifier hs-var">fco_res</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Coercion
</span><a href="#local-6989586621682578256"><span class="hs-identifier hs-var">res_co</span></a></span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-855"></span><span>
</span><span id="line-856"></span><span>
</span><span id="line-857"></span><span class="hs-comment">{- Note [No assertion check on mkFunCo]
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
We used to have a checkFunCo assertion on mkFunCo, but during typechecking
we can (legitimately) have not-full-zonked types or coercion variables, so
the assertion spuriously fails (test T11480b is a case in point).  Lint
checks all these things anyway.

We used to get around the problem by calling mkNakedFunCo from within the
typechecker, which dodged the assertion check.  But then mkAppCo calls
mkTyConAppCo, which calls tyConAppFunCo_maybe, which calls mkFunCo.
Duplicating this stack of calls with &quot;naked&quot; versions of each seems too much.

-- Commented out: see Note [No assertion check on mkFunCo]
checkFunCo :: Role -&gt; FunTyFlag -&gt; FunTyFlag
           -&gt; CoercionN -&gt; Coercion -&gt; Coercion
           -&gt; Maybe SDoc
-- Checks well-formed-ness for FunCo
-- Used only in assertions and Lint
{-# NOINLINE checkFunCo #-}
checkFunCo _r afl afr _w arg_co res_co
  | not (ok argl_ty &amp;&amp; ok argr_ty &amp;&amp; ok resl_ty &amp;&amp; ok resr_ty)
  = Just (hang (text &quot;Bad arg or res types&quot;) 2 pp_inputs)

  | afl == computed_afl
  , afr == computed_afr
  = Nothing
  | otherwise
  = Just (vcat [ text &quot;afl (provided,computed):&quot; &lt;+&gt; ppr afl &lt;+&gt; ppr computed_afl
               , text &quot;afr (provided,computed):&quot; &lt;+&gt; ppr afr &lt;+&gt; ppr computed_afr
               , pp_inputs ])
  where
    computed_afl = chooseFunTyFlag argl_ty resl_ty
    computed_afr = chooseFunTyFlag argr_ty resr_ty
    Pair argl_ty argr_ty = coercionKind arg_co
    Pair resl_ty resr_ty = coercionKind res_co

    pp_inputs = vcat [ pp_ty &quot;argl&quot; argl_ty, pp_ty &quot;argr&quot; argr_ty
                     , pp_ty &quot;resl&quot; resl_ty, pp_ty &quot;resr&quot; resr_ty
                     , text &quot;arg_co:&quot; &lt;+&gt; ppr arg_co
                     , text &quot;res_co:&quot; &lt;+&gt; ppr res_co ]

    ok ty = isTYPEorCONSTRAINT (typeKind ty)
    pp_ty str ty = text str &lt;&gt; colon &lt;+&gt; hang (ppr ty)
                                            2 (dcolon &lt;+&gt; ppr (typeKind ty))
-}</span><span>
</span><span id="line-902"></span><span>
</span><span id="line-903"></span><span class="hs-comment">-- | Apply a 'Coercion' to another 'Coercion'.</span><span>
</span><span id="line-904"></span><span class="hs-comment">-- The second coercion must be Nominal, unless the first is Phantom.</span><span>
</span><span id="line-905"></span><span class="hs-comment">-- If the first is Phantom, then the second can be either Phantom or Nominal.</span><span>
</span><span id="line-906"></span><span class="annot"><a href="GHC.Core.Coercion.html#mkAppCo"><span class="hs-identifier hs-type">mkAppCo</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#Coercion"><span class="hs-identifier hs-type">Coercion</span></a></span><span>     </span><span class="annot"><span class="hs-comment">-- ^ :: t1 ~r t2</span></span><span>
</span><span id="line-907"></span><span>        </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#Coercion"><span class="hs-identifier hs-type">Coercion</span></a></span><span>     </span><span class="annot"><span class="hs-comment">-- ^ :: s1 ~N s2, where s1 :: k1, s2 :: k2</span></span><span>
</span><span id="line-908"></span><span>        </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#Coercion"><span class="hs-identifier hs-type">Coercion</span></a></span><span>     </span><span class="annot"><span class="hs-comment">-- ^ :: t1 s1 ~r t2 s2</span></span><span>
</span><span id="line-909"></span><span id="mkAppCo"><span class="annot"><span class="annottext">mkAppCo :: Coercion -&gt; Coercion -&gt; Coercion
</span><a href="GHC.Core.Coercion.html#mkAppCo"><span class="hs-identifier hs-var hs-var">mkAppCo</span></a></span></span><span> </span><span id="local-6989586621682578264"><span class="annot"><span class="annottext">Coercion
</span><a href="#local-6989586621682578264"><span class="hs-identifier hs-var">co</span></a></span></span><span> </span><span id="local-6989586621682578265"><span class="annot"><span class="annottext">Coercion
</span><a href="#local-6989586621682578265"><span class="hs-identifier hs-var">arg</span></a></span></span><span>
</span><span id="line-910"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span class="hs-special">(</span><span id="local-6989586621682578266"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682578266"><span class="hs-identifier hs-var">ty1</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682578267"><span class="annot"><span class="annottext">Role
</span><a href="#local-6989586621682578267"><span class="hs-identifier hs-var">r</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Coercion -&gt; Maybe (Type, Role)
</span><a href="GHC.Core.Coercion.html#isReflCo_maybe"><span class="hs-identifier hs-var">isReflCo_maybe</span></a></span><span> </span><span class="annot"><span class="annottext">Coercion
</span><a href="#local-6989586621682578264"><span class="hs-identifier hs-var">co</span></a></span><span>
</span><span id="line-911"></span><span>  </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span class="hs-special">(</span><span id="local-6989586621682578268"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682578268"><span class="hs-identifier hs-var">ty2</span></a></span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Role
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Coercion -&gt; Maybe (Type, Role)
</span><a href="GHC.Core.Coercion.html#isReflCo_maybe"><span class="hs-identifier hs-var">isReflCo_maybe</span></a></span><span> </span><span class="annot"><span class="annottext">Coercion
</span><a href="#local-6989586621682578265"><span class="hs-identifier hs-var">arg</span></a></span><span>
</span><span id="line-912"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Role -&gt; Type -&gt; Coercion
</span><a href="GHC.Core.Coercion.html#mkReflCo"><span class="hs-identifier hs-var">mkReflCo</span></a></span><span> </span><span class="annot"><span class="annottext">Role
</span><a href="#local-6989586621682578267"><span class="hs-identifier hs-var">r</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Type -&gt; Type -&gt; Type
</span><a href="GHC.Core.Type.html#mkAppTy"><span class="hs-identifier hs-var">mkAppTy</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682578266"><span class="hs-identifier hs-var">ty1</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682578268"><span class="hs-identifier hs-var">ty2</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-913"></span><span>
</span><span id="line-914"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span class="hs-special">(</span><span id="local-6989586621682578270"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682578270"><span class="hs-identifier hs-var">ty1</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682578271"><span class="annot"><span class="annottext">Role
</span><a href="#local-6989586621682578271"><span class="hs-identifier hs-var">r</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Coercion -&gt; Maybe (Type, Role)
</span><a href="GHC.Core.Coercion.html#isReflCo_maybe"><span class="hs-identifier hs-var">isReflCo_maybe</span></a></span><span> </span><span class="annot"><span class="annottext">Coercion
</span><a href="#local-6989586621682578264"><span class="hs-identifier hs-var">co</span></a></span><span>
</span><span id="line-915"></span><span>  </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span class="hs-special">(</span><span id="local-6989586621682578272"><span class="annot"><span class="annottext">TyCon
</span><a href="#local-6989586621682578272"><span class="hs-identifier hs-var">tc</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682578273"><span class="annot"><span class="annottext">[Type]
</span><a href="#local-6989586621682578273"><span class="hs-identifier hs-var">tys</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">HasDebugCallStack =&gt; Type -&gt; Maybe (TyCon, [Type])
Type -&gt; Maybe (TyCon, [Type])
</span><a href="GHC.Core.Type.html#splitTyConApp_maybe"><span class="hs-identifier hs-var">splitTyConApp_maybe</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682578270"><span class="hs-identifier hs-var">ty1</span></a></span><span>
</span><span id="line-916"></span><span>    </span><span class="hs-comment">-- Expand type synonyms; a TyConAppCo can't have a type synonym (#9102)</span><span>
</span><span id="line-917"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">HasDebugCallStack =&gt; Role -&gt; TyCon -&gt; [Coercion] -&gt; Coercion
Role -&gt; TyCon -&gt; [Coercion] -&gt; Coercion
</span><a href="GHC.Core.Coercion.html#mkTyConAppCo"><span class="hs-identifier hs-var">mkTyConAppCo</span></a></span><span> </span><span class="annot"><span class="annottext">Role
</span><a href="#local-6989586621682578271"><span class="hs-identifier hs-var">r</span></a></span><span> </span><span class="annot"><span class="annottext">TyCon
</span><a href="#local-6989586621682578272"><span class="hs-identifier hs-var">tc</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Infinite Role -&gt; [Type] -&gt; [Coercion]
</span><a href="#local-6989586621682578274"><span class="hs-identifier hs-var">zip_roles</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Role -&gt; TyCon -&gt; Infinite Role
</span><a href="GHC.Core.Coercion.html#tyConRolesX"><span class="hs-identifier hs-var">tyConRolesX</span></a></span><span> </span><span class="annot"><span class="annottext">Role
</span><a href="#local-6989586621682578271"><span class="hs-identifier hs-var">r</span></a></span><span> </span><span class="annot"><span class="annottext">TyCon
</span><a href="#local-6989586621682578272"><span class="hs-identifier hs-var">tc</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[Type]
</span><a href="#local-6989586621682578273"><span class="hs-identifier hs-var">tys</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-918"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-919"></span><span>    </span><span id="local-6989586621682578274"><span class="annot"><span class="annottext">zip_roles :: Infinite Role -&gt; [Type] -&gt; [Coercion]
</span><a href="#local-6989586621682578274"><span class="hs-identifier hs-var hs-var">zip_roles</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Data.List.Infinite.html#Inf"><span class="hs-identifier hs-type">Inf</span></a></span><span> </span><span id="local-6989586621682578276"><span class="annot"><span class="annottext">Role
</span><a href="#local-6989586621682578276"><span class="hs-identifier hs-var">r1</span></a></span></span><span> </span><span class="annot"><span class="annottext">Infinite Role
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span>  </span><span class="hs-special">[</span><span class="hs-special">]</span><span>            </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">Role -&gt; Role -&gt; Coercion -&gt; Coercion
</span><a href="GHC.Core.Coercion.html#downgradeRole"><span class="hs-identifier hs-var">downgradeRole</span></a></span><span> </span><span class="annot"><span class="annottext">Role
</span><a href="#local-6989586621682578276"><span class="hs-identifier hs-var">r1</span></a></span><span> </span><span class="annot"><span class="annottext">Role
</span><a href="Language.Haskell.Syntax.Basic.html#Nominal"><span class="hs-identifier hs-var">Nominal</span></a></span><span> </span><span class="annot"><span class="annottext">Coercion
</span><a href="#local-6989586621682578265"><span class="hs-identifier hs-var">arg</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-920"></span><span>    </span><span class="annot"><a href="#local-6989586621682578274"><span class="hs-identifier hs-var">zip_roles</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Data.List.Infinite.html#Inf"><span class="hs-identifier hs-type">Inf</span></a></span><span> </span><span id="local-6989586621682578277"><span class="annot"><span class="annottext">Role
</span><a href="#local-6989586621682578277"><span class="hs-identifier hs-var">r1</span></a></span></span><span> </span><span id="local-6989586621682578278"><span class="annot"><span class="annottext">Infinite Role
</span><a href="#local-6989586621682578278"><span class="hs-identifier hs-var">rs</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span id="local-6989586621682578279"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682578279"><span class="hs-identifier hs-var">ty1</span></a></span></span><span class="annot"><span class="hs-glyph hs-type">:</span></span><span id="local-6989586621682578280"><span class="annot"><span class="annottext">[Type]
</span><a href="#local-6989586621682578280"><span class="hs-identifier hs-var">tys</span></a></span></span><span class="hs-special">)</span><span>     </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Role -&gt; Type -&gt; Coercion
</span><a href="GHC.Core.Coercion.html#mkReflCo"><span class="hs-identifier hs-var">mkReflCo</span></a></span><span> </span><span class="annot"><span class="annottext">Role
</span><a href="#local-6989586621682578277"><span class="hs-identifier hs-var">r1</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682578279"><span class="hs-identifier hs-var">ty1</span></a></span><span> </span><span class="annot"><span class="annottext">Coercion -&gt; [Coercion] -&gt; [Coercion]
forall a. a -&gt; [a] -&gt; [a]
</span><span class="hs-glyph hs-var">:</span></span><span> </span><span class="annot"><span class="annottext">Infinite Role -&gt; [Type] -&gt; [Coercion]
</span><a href="#local-6989586621682578274"><span class="hs-identifier hs-var">zip_roles</span></a></span><span> </span><span class="annot"><span class="annottext">Infinite Role
</span><a href="#local-6989586621682578278"><span class="hs-identifier hs-var">rs</span></a></span><span> </span><span class="annot"><span class="annottext">[Type]
</span><a href="#local-6989586621682578280"><span class="hs-identifier hs-var">tys</span></a></span><span>
</span><span id="line-921"></span><span>
</span><span id="line-922"></span><span class="annot"><a href="GHC.Core.Coercion.html#mkAppCo"><span class="hs-identifier hs-var">mkAppCo</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#TyConAppCo"><span class="hs-identifier hs-type">TyConAppCo</span></a></span><span> </span><span id="local-6989586621682578281"><span class="annot"><span class="annottext">Role
</span><a href="#local-6989586621682578281"><span class="hs-identifier hs-var">r</span></a></span></span><span> </span><span id="local-6989586621682578282"><span class="annot"><span class="annottext">TyCon
</span><a href="#local-6989586621682578282"><span class="hs-identifier hs-var">tc</span></a></span></span><span> </span><span id="local-6989586621682578283"><span class="annot"><span class="annottext">[Coercion]
</span><a href="#local-6989586621682578283"><span class="hs-identifier hs-var">args</span></a></span></span><span class="hs-special">)</span><span> </span><span id="local-6989586621682578284"><span class="annot"><span class="annottext">Coercion
</span><a href="#local-6989586621682578284"><span class="hs-identifier hs-var">arg</span></a></span></span><span>
</span><span id="line-923"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">Role
</span><a href="#local-6989586621682578281"><span class="hs-identifier hs-var">r</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-924"></span><span>      </span><span class="annot"><span class="annottext">Role
</span><a href="Language.Haskell.Syntax.Basic.html#Nominal"><span class="hs-identifier hs-var">Nominal</span></a></span><span>          </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">HasDebugCallStack =&gt; Role -&gt; TyCon -&gt; [Coercion] -&gt; Coercion
Role -&gt; TyCon -&gt; [Coercion] -&gt; Coercion
</span><a href="GHC.Core.Coercion.html#mkTyConAppCo"><span class="hs-identifier hs-var">mkTyConAppCo</span></a></span><span> </span><span class="annot"><span class="annottext">Role
</span><a href="Language.Haskell.Syntax.Basic.html#Nominal"><span class="hs-identifier hs-var">Nominal</span></a></span><span> </span><span class="annot"><span class="annottext">TyCon
</span><a href="#local-6989586621682578282"><span class="hs-identifier hs-var">tc</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[Coercion]
</span><a href="#local-6989586621682578283"><span class="hs-identifier hs-var">args</span></a></span><span> </span><span class="annot"><span class="annottext">[Coercion] -&gt; [Coercion] -&gt; [Coercion]
forall a. [a] -&gt; [a] -&gt; [a]
</span><span class="hs-operator hs-var">++</span></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">Coercion
</span><a href="#local-6989586621682578284"><span class="hs-identifier hs-var">arg</span></a></span><span class="hs-special">]</span><span class="hs-special">)</span><span>
</span><span id="line-925"></span><span>      </span><span class="annot"><span class="annottext">Role
</span><a href="Language.Haskell.Syntax.Basic.html#Representational"><span class="hs-identifier hs-var">Representational</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">HasDebugCallStack =&gt; Role -&gt; TyCon -&gt; [Coercion] -&gt; Coercion
Role -&gt; TyCon -&gt; [Coercion] -&gt; Coercion
</span><a href="GHC.Core.Coercion.html#mkTyConAppCo"><span class="hs-identifier hs-var">mkTyConAppCo</span></a></span><span> </span><span class="annot"><span class="annottext">Role
</span><a href="Language.Haskell.Syntax.Basic.html#Representational"><span class="hs-identifier hs-var">Representational</span></a></span><span> </span><span class="annot"><span class="annottext">TyCon
</span><a href="#local-6989586621682578282"><span class="hs-identifier hs-var">tc</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[Coercion]
</span><a href="#local-6989586621682578283"><span class="hs-identifier hs-var">args</span></a></span><span> </span><span class="annot"><span class="annottext">[Coercion] -&gt; [Coercion] -&gt; [Coercion]
forall a. [a] -&gt; [a] -&gt; [a]
</span><span class="hs-operator hs-var">++</span></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">Coercion
</span><a href="#local-6989586621682578285"><span class="hs-identifier hs-var">arg'</span></a></span><span class="hs-special">]</span><span class="hs-special">)</span><span>
</span><span id="line-926"></span><span>        </span><span class="hs-keyword">where</span><span> </span><span id="local-6989586621682578286"><span class="annot"><span class="annottext">new_role :: Role
</span><a href="#local-6989586621682578286"><span class="hs-identifier hs-var hs-var">new_role</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">TyCon -&gt; Infinite Role
</span><a href="GHC.Core.Coercion.html#tyConRolesRepresentational"><span class="hs-identifier hs-var">tyConRolesRepresentational</span></a></span><span> </span><span class="annot"><span class="annottext">TyCon
</span><a href="#local-6989586621682578282"><span class="hs-identifier hs-var">tc</span></a></span><span> </span><span class="annot"><span class="annottext">Infinite Role -&gt; Arity -&gt; Role
forall a. Infinite a -&gt; Arity -&gt; a
</span><a href="GHC.Data.List.Infinite.html#%21%21"><span class="hs-operator hs-var">Inf.!!</span></a></span><span> </span><span class="annot"><span class="annottext">[Coercion] -&gt; Arity
forall a. [a] -&gt; Arity
forall (t :: * -&gt; *) a. Foldable t =&gt; t a -&gt; Arity
</span><span class="hs-identifier hs-var">length</span></span><span> </span><span class="annot"><span class="annottext">[Coercion]
</span><a href="#local-6989586621682578283"><span class="hs-identifier hs-var">args</span></a></span><span>
</span><span id="line-927"></span><span>              </span><span id="local-6989586621682578285"><span class="annot"><span class="annottext">arg' :: Coercion
</span><a href="#local-6989586621682578285"><span class="hs-identifier hs-var hs-var">arg'</span></a></span></span><span>     </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Role -&gt; Role -&gt; Coercion -&gt; Coercion
</span><a href="GHC.Core.Coercion.html#downgradeRole"><span class="hs-identifier hs-var">downgradeRole</span></a></span><span> </span><span class="annot"><span class="annottext">Role
</span><a href="#local-6989586621682578286"><span class="hs-identifier hs-var">new_role</span></a></span><span> </span><span class="annot"><span class="annottext">Role
</span><a href="Language.Haskell.Syntax.Basic.html#Nominal"><span class="hs-identifier hs-var">Nominal</span></a></span><span> </span><span class="annot"><span class="annottext">Coercion
</span><a href="#local-6989586621682578284"><span class="hs-identifier hs-var">arg</span></a></span><span>
</span><span id="line-928"></span><span>      </span><span class="annot"><span class="annottext">Role
</span><a href="Language.Haskell.Syntax.Basic.html#Phantom"><span class="hs-identifier hs-var">Phantom</span></a></span><span>          </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">HasDebugCallStack =&gt; Role -&gt; TyCon -&gt; [Coercion] -&gt; Coercion
Role -&gt; TyCon -&gt; [Coercion] -&gt; Coercion
</span><a href="GHC.Core.Coercion.html#mkTyConAppCo"><span class="hs-identifier hs-var">mkTyConAppCo</span></a></span><span> </span><span class="annot"><span class="annottext">Role
</span><a href="Language.Haskell.Syntax.Basic.html#Phantom"><span class="hs-identifier hs-var">Phantom</span></a></span><span> </span><span class="annot"><span class="annottext">TyCon
</span><a href="#local-6989586621682578282"><span class="hs-identifier hs-var">tc</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[Coercion]
</span><a href="#local-6989586621682578283"><span class="hs-identifier hs-var">args</span></a></span><span> </span><span class="annot"><span class="annottext">[Coercion] -&gt; [Coercion] -&gt; [Coercion]
forall a. [a] -&gt; [a] -&gt; [a]
</span><span class="hs-operator hs-var">++</span></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">Coercion -&gt; Coercion
</span><a href="GHC.Core.Coercion.html#toPhantomCo"><span class="hs-identifier hs-var">toPhantomCo</span></a></span><span> </span><span class="annot"><span class="annottext">Coercion
</span><a href="#local-6989586621682578284"><span class="hs-identifier hs-var">arg</span></a></span><span class="hs-special">]</span><span class="hs-special">)</span><span>
</span><span id="line-929"></span><span class="annot"><a href="GHC.Core.Coercion.html#mkAppCo"><span class="hs-identifier hs-var">mkAppCo</span></a></span><span> </span><span id="local-6989586621682578290"><span class="annot"><span class="annottext">Coercion
</span><a href="#local-6989586621682578290"><span class="hs-identifier hs-var">co</span></a></span></span><span> </span><span id="local-6989586621682578291"><span class="annot"><span class="annottext">Coercion
</span><a href="#local-6989586621682578291"><span class="hs-identifier hs-var">arg</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Coercion -&gt; Coercion -&gt; Coercion
</span><a href="GHC.Core.TyCo.Rep.html#AppCo"><span class="hs-identifier hs-var">AppCo</span></a></span><span> </span><span class="annot"><span class="annottext">Coercion
</span><a href="#local-6989586621682578290"><span class="hs-identifier hs-var">co</span></a></span><span>  </span><span class="annot"><span class="annottext">Coercion
</span><a href="#local-6989586621682578291"><span class="hs-identifier hs-var">arg</span></a></span><span>
</span><span id="line-930"></span><span class="hs-comment">-- Note, mkAppCo is careful to maintain invariants regarding</span><span>
</span><span id="line-931"></span><span class="hs-comment">-- where Refl constructors appear; see the comments in the definition</span><span>
</span><span id="line-932"></span><span class="hs-comment">-- of Coercion and the Note [Refl invariant] in GHC.Core.TyCo.Rep.</span><span>
</span><span id="line-933"></span><span>
</span><span id="line-934"></span><span class="hs-comment">-- | Applies multiple 'Coercion's to another 'Coercion', from left to right.</span><span>
</span><span id="line-935"></span><span class="hs-comment">-- See also 'mkAppCo'.</span><span>
</span><span id="line-936"></span><span class="annot"><a href="GHC.Core.Coercion.html#mkAppCos"><span class="hs-identifier hs-type">mkAppCos</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#Coercion"><span class="hs-identifier hs-type">Coercion</span></a></span><span>
</span><span id="line-937"></span><span>         </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#Coercion"><span class="hs-identifier hs-type">Coercion</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-938"></span><span>         </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#Coercion"><span class="hs-identifier hs-type">Coercion</span></a></span><span>
</span><span id="line-939"></span><span id="mkAppCos"><span class="annot"><span class="annottext">mkAppCos :: Coercion -&gt; [Coercion] -&gt; Coercion
</span><a href="GHC.Core.Coercion.html#mkAppCos"><span class="hs-identifier hs-var hs-var">mkAppCos</span></a></span></span><span> </span><span id="local-6989586621682578292"><span class="annot"><span class="annottext">Coercion
</span><a href="#local-6989586621682578292"><span class="hs-identifier hs-var">co1</span></a></span></span><span> </span><span id="local-6989586621682578293"><span class="annot"><span class="annottext">[Coercion]
</span><a href="#local-6989586621682578293"><span class="hs-identifier hs-var">cos</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(Coercion -&gt; Coercion -&gt; Coercion)
-&gt; Coercion -&gt; [Coercion] -&gt; Coercion
forall b a. (b -&gt; a -&gt; b) -&gt; b -&gt; [a] -&gt; b
forall (t :: * -&gt; *) b a.
Foldable t =&gt;
(b -&gt; a -&gt; b) -&gt; b -&gt; t a -&gt; b
</span><span class="hs-identifier hs-var">foldl'</span></span><span> </span><span class="annot"><span class="annottext">Coercion -&gt; Coercion -&gt; Coercion
</span><a href="GHC.Core.Coercion.html#mkAppCo"><span class="hs-identifier hs-var">mkAppCo</span></a></span><span> </span><span class="annot"><span class="annottext">Coercion
</span><a href="#local-6989586621682578292"><span class="hs-identifier hs-var">co1</span></a></span><span> </span><span class="annot"><span class="annottext">[Coercion]
</span><a href="#local-6989586621682578293"><span class="hs-identifier hs-var">cos</span></a></span><span>
</span><span id="line-940"></span><span>
</span><span id="line-941"></span><span>
</span><span id="line-942"></span><span class="annot"><span class="hs-comment">-- | Make a Coercion from a tycovar, a kind coercion, and a body coercion.</span></span><span>
</span><span id="line-943"></span><span class="annot"><a href="GHC.Core.Coercion.html#mkForAllCo"><span class="hs-identifier hs-type">mkForAllCo</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Utils.Misc.html#HasDebugCallStack"><span class="hs-identifier hs-type">HasDebugCallStack</span></a></span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="GHC.Types.Var.html#TyCoVar"><span class="hs-identifier hs-type">TyCoVar</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Language.Haskell.Syntax.Specificity.html#ForAllTyFlag"><span class="hs-identifier hs-type">ForAllTyFlag</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Language.Haskell.Syntax.Specificity.html#ForAllTyFlag"><span class="hs-identifier hs-type">ForAllTyFlag</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#CoercionN"><span class="hs-identifier hs-type">CoercionN</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#Coercion"><span class="hs-identifier hs-type">Coercion</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#Coercion"><span class="hs-identifier hs-type">Coercion</span></a></span><span>
</span><span id="line-944"></span><span id="mkForAllCo"><span class="annot"><span class="annottext">mkForAllCo :: HasDebugCallStack =&gt;
CoVar
-&gt; ForAllTyFlag -&gt; ForAllTyFlag -&gt; Coercion -&gt; Coercion -&gt; Coercion
</span><a href="GHC.Core.Coercion.html#mkForAllCo"><span class="hs-identifier hs-var hs-var">mkForAllCo</span></a></span></span><span> </span><span id="local-6989586621682578296"><span class="annot"><span class="annottext">CoVar
</span><a href="#local-6989586621682578296"><span class="hs-identifier hs-var">v</span></a></span></span><span> </span><span id="local-6989586621682578297"><span class="annot"><span class="annottext">ForAllTyFlag
</span><a href="#local-6989586621682578297"><span class="hs-identifier hs-var">visL</span></a></span></span><span> </span><span id="local-6989586621682578298"><span class="annot"><span class="annottext">ForAllTyFlag
</span><a href="#local-6989586621682578298"><span class="hs-identifier hs-var">visR</span></a></span></span><span> </span><span id="local-6989586621682578299"><span class="annot"><span class="annottext">Coercion
</span><a href="#local-6989586621682578299"><span class="hs-identifier hs-var">kind_co</span></a></span></span><span> </span><span id="local-6989586621682578300"><span class="annot"><span class="annottext">Coercion
</span><a href="#local-6989586621682578300"><span class="hs-identifier hs-var">co</span></a></span></span><span>
</span><span id="line-945"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span class="hs-special">(</span><span id="local-6989586621682578301"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682578301"><span class="hs-identifier hs-var">ty</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682578302"><span class="annot"><span class="annottext">Role
</span><a href="#local-6989586621682578302"><span class="hs-identifier hs-var">r</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Coercion -&gt; Maybe (Type, Role)
</span><a href="GHC.Core.Coercion.html#isReflCo_maybe"><span class="hs-identifier hs-var">isReflCo_maybe</span></a></span><span> </span><span class="annot"><span class="annottext">Coercion
</span><a href="#local-6989586621682578300"><span class="hs-identifier hs-var">co</span></a></span><span>
</span><span id="line-946"></span><span>  </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Coercion -&gt; Bool
</span><a href="GHC.Core.Coercion.html#isReflCo"><span class="hs-identifier hs-var">isReflCo</span></a></span><span> </span><span class="annot"><span class="annottext">Coercion
</span><a href="#local-6989586621682578299"><span class="hs-identifier hs-var">kind_co</span></a></span><span>
</span><span id="line-947"></span><span>  </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">ForAllTyFlag
</span><a href="#local-6989586621682578297"><span class="hs-identifier hs-var">visL</span></a></span><span> </span><span class="annot"><span class="annottext">ForAllTyFlag -&gt; ForAllTyFlag -&gt; Bool
</span><a href="GHC.Core.TyCo.Compare.html#eqForAllVis"><span class="hs-operator hs-var">`eqForAllVis`</span></a></span><span> </span><span class="annot"><span class="annottext">ForAllTyFlag
</span><a href="#local-6989586621682578298"><span class="hs-identifier hs-var">visR</span></a></span><span>
</span><span id="line-948"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Role -&gt; Type -&gt; Coercion
</span><a href="GHC.Core.Coercion.html#mkReflCo"><span class="hs-identifier hs-var">mkReflCo</span></a></span><span> </span><span class="annot"><span class="annottext">Role
</span><a href="#local-6989586621682578302"><span class="hs-identifier hs-var">r</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">CoVar -&gt; ForAllTyFlag -&gt; Type -&gt; Type
</span><a href="GHC.Core.Type.html#mkTyCoForAllTy"><span class="hs-identifier hs-var">mkTyCoForAllTy</span></a></span><span> </span><span class="annot"><span class="annottext">CoVar
</span><a href="#local-6989586621682578296"><span class="hs-identifier hs-var">v</span></a></span><span> </span><span class="annot"><span class="annottext">ForAllTyFlag
</span><a href="#local-6989586621682578297"><span class="hs-identifier hs-var">visL</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682578301"><span class="hs-identifier hs-var">ty</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-949"></span><span>
</span><span id="line-950"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">otherwise</span></span><span>
</span><span id="line-951"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">CoVar
-&gt; ForAllTyFlag -&gt; ForAllTyFlag -&gt; Coercion -&gt; Coercion -&gt; Coercion
</span><a href="GHC.Core.Coercion.html#mkForAllCo_NoRefl"><span class="hs-identifier hs-var">mkForAllCo_NoRefl</span></a></span><span> </span><span class="annot"><span class="annottext">CoVar
</span><a href="#local-6989586621682578296"><span class="hs-identifier hs-var">v</span></a></span><span> </span><span class="annot"><span class="annottext">ForAllTyFlag
</span><a href="#local-6989586621682578297"><span class="hs-identifier hs-var">visL</span></a></span><span> </span><span class="annot"><span class="annottext">ForAllTyFlag
</span><a href="#local-6989586621682578298"><span class="hs-identifier hs-var">visR</span></a></span><span> </span><span class="annot"><span class="annottext">Coercion
</span><a href="#local-6989586621682578299"><span class="hs-identifier hs-var">kind_co</span></a></span><span> </span><span class="annot"><span class="annottext">Coercion
</span><a href="#local-6989586621682578300"><span class="hs-identifier hs-var">co</span></a></span><span>
</span><span id="line-952"></span><span>
</span><span id="line-953"></span><span class="hs-comment">-- | Make a Coercion quantified over a type/coercion variable;</span><span>
</span><span id="line-954"></span><span class="hs-comment">-- the variable has the same kind and visibility in both sides of the coercion</span><span>
</span><span id="line-955"></span><span class="annot"><a href="GHC.Core.Coercion.html#mkHomoForAllCos"><span class="hs-identifier hs-type">mkHomoForAllCos</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="GHC.Types.Var.html#ForAllTyBinder"><span class="hs-identifier hs-type">ForAllTyBinder</span></a></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#Coercion"><span class="hs-identifier hs-type">Coercion</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#Coercion"><span class="hs-identifier hs-type">Coercion</span></a></span><span>
</span><span id="line-956"></span><span id="mkHomoForAllCos"><span class="annot"><span class="annottext">mkHomoForAllCos :: [ForAllTyBinder] -&gt; Coercion -&gt; Coercion
</span><a href="GHC.Core.Coercion.html#mkHomoForAllCos"><span class="hs-identifier hs-var hs-var">mkHomoForAllCos</span></a></span></span><span> </span><span id="local-6989586621682578306"><span class="annot"><span class="annottext">[ForAllTyBinder]
</span><a href="#local-6989586621682578306"><span class="hs-identifier hs-var">vs</span></a></span></span><span> </span><span id="local-6989586621682578307"><span class="annot"><span class="annottext">Coercion
</span><a href="#local-6989586621682578307"><span class="hs-identifier hs-var">orig_co</span></a></span></span><span>
</span><span id="line-957"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span class="hs-special">(</span><span id="local-6989586621682578308"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682578308"><span class="hs-identifier hs-var">ty</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682578309"><span class="annot"><span class="annottext">Role
</span><a href="#local-6989586621682578309"><span class="hs-identifier hs-var">r</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Coercion -&gt; Maybe (Type, Role)
</span><a href="GHC.Core.Coercion.html#isReflCo_maybe"><span class="hs-identifier hs-var">isReflCo_maybe</span></a></span><span> </span><span class="annot"><span class="annottext">Coercion
</span><a href="#local-6989586621682578307"><span class="hs-identifier hs-var">orig_co</span></a></span><span>
</span><span id="line-958"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Role -&gt; Type -&gt; Coercion
</span><a href="GHC.Core.Coercion.html#mkReflCo"><span class="hs-identifier hs-var">mkReflCo</span></a></span><span> </span><span class="annot"><span class="annottext">Role
</span><a href="#local-6989586621682578309"><span class="hs-identifier hs-var">r</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[ForAllTyBinder] -&gt; Type -&gt; Type
</span><a href="GHC.Core.Type.html#mkTyCoForAllTys"><span class="hs-identifier hs-var">mkTyCoForAllTys</span></a></span><span> </span><span class="annot"><span class="annottext">[ForAllTyBinder]
</span><a href="#local-6989586621682578306"><span class="hs-identifier hs-var">vs</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682578308"><span class="hs-identifier hs-var">ty</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-959"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">otherwise</span></span><span>
</span><span id="line-960"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(ForAllTyBinder -&gt; Coercion -&gt; Coercion)
-&gt; Coercion -&gt; [ForAllTyBinder] -&gt; Coercion
forall a b. (a -&gt; b -&gt; b) -&gt; b -&gt; [a] -&gt; b
forall (t :: * -&gt; *) a b.
Foldable t =&gt;
(a -&gt; b -&gt; b) -&gt; b -&gt; t a -&gt; b
</span><span class="hs-identifier hs-var">foldr</span></span><span> </span><span class="annot"><span class="annottext">ForAllTyBinder -&gt; Coercion -&gt; Coercion
</span><a href="#local-6989586621682578312"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="annot"><span class="annottext">Coercion
</span><a href="#local-6989586621682578307"><span class="hs-identifier hs-var">orig_co</span></a></span><span> </span><span class="annot"><span class="annottext">[ForAllTyBinder]
</span><a href="#local-6989586621682578306"><span class="hs-identifier hs-var">vs</span></a></span><span>
</span><span id="line-961"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-962"></span><span>    </span><span id="local-6989586621682578312"><span class="annot"><span class="annottext">go :: ForAllTyBinder -&gt; Coercion -&gt; Coercion
</span><a href="#local-6989586621682578312"><span class="hs-identifier hs-var hs-var">go</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Types.Var.html#Bndr"><span class="hs-identifier hs-type">Bndr</span></a></span><span> </span><span id="local-6989586621682578313"><span class="annot"><span class="annottext">CoVar
</span><a href="#local-6989586621682578313"><span class="hs-identifier hs-var">var</span></a></span></span><span> </span><span id="local-6989586621682578314"><span class="annot"><span class="annottext">ForAllTyFlag
</span><a href="#local-6989586621682578314"><span class="hs-identifier hs-var">vis</span></a></span></span><span class="hs-special">)</span><span> </span><span id="local-6989586621682578315"><span class="annot"><span class="annottext">Coercion
</span><a href="#local-6989586621682578315"><span class="hs-identifier hs-var">co</span></a></span></span><span>
</span><span id="line-963"></span><span>      </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">CoVar
-&gt; ForAllTyFlag -&gt; ForAllTyFlag -&gt; Coercion -&gt; Coercion -&gt; Coercion
</span><a href="GHC.Core.Coercion.html#mkForAllCo_NoRefl"><span class="hs-identifier hs-var">mkForAllCo_NoRefl</span></a></span><span> </span><span class="annot"><span class="annottext">CoVar
</span><a href="#local-6989586621682578313"><span class="hs-identifier hs-var">var</span></a></span><span> </span><span class="annot"><span class="annottext">ForAllTyFlag
</span><a href="#local-6989586621682578314"><span class="hs-identifier hs-var">vis</span></a></span><span> </span><span class="annot"><span class="annottext">ForAllTyFlag
</span><a href="#local-6989586621682578314"><span class="hs-identifier hs-var">vis</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Type -&gt; Coercion
</span><a href="GHC.Core.Coercion.html#mkNomReflCo"><span class="hs-identifier hs-var">mkNomReflCo</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">CoVar -&gt; Type
</span><a href="GHC.Types.Var.html#varType"><span class="hs-identifier hs-var">varType</span></a></span><span> </span><span class="annot"><span class="annottext">CoVar
</span><a href="#local-6989586621682578313"><span class="hs-identifier hs-var">var</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Coercion
</span><a href="#local-6989586621682578315"><span class="hs-identifier hs-var">co</span></a></span><span>
</span><span id="line-964"></span><span>
</span><span id="line-965"></span><span class="hs-comment">-- | Like 'mkForAllCo', but there is no need to check that the inner coercion isn't Refl;</span><span>
</span><span id="line-966"></span><span class="hs-comment">--   the caller has done that. (For example, it is guaranteed in 'mkHomoForAllCos'.)</span><span>
</span><span id="line-967"></span><span class="hs-comment">-- The kind of the tycovar should be the left-hand kind of the kind coercion.</span><span>
</span><span id="line-968"></span><span class="annot"><a href="GHC.Core.Coercion.html#mkForAllCo_NoRefl"><span class="hs-identifier hs-type">mkForAllCo_NoRefl</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Types.Var.html#TyCoVar"><span class="hs-identifier hs-type">TyCoVar</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Language.Haskell.Syntax.Specificity.html#ForAllTyFlag"><span class="hs-identifier hs-type">ForAllTyFlag</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Language.Haskell.Syntax.Specificity.html#ForAllTyFlag"><span class="hs-identifier hs-type">ForAllTyFlag</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#CoercionN"><span class="hs-identifier hs-type">CoercionN</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#Coercion"><span class="hs-identifier hs-type">Coercion</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#Coercion"><span class="hs-identifier hs-type">Coercion</span></a></span><span>
</span><span id="line-969"></span><span id="mkForAllCo_NoRefl"><span class="annot"><span class="annottext">mkForAllCo_NoRefl :: CoVar
-&gt; ForAllTyFlag -&gt; ForAllTyFlag -&gt; Coercion -&gt; Coercion -&gt; Coercion
</span><a href="GHC.Core.Coercion.html#mkForAllCo_NoRefl"><span class="hs-identifier hs-var hs-var">mkForAllCo_NoRefl</span></a></span></span><span> </span><span id="local-6989586621682578316"><span class="annot"><span class="annottext">CoVar
</span><a href="#local-6989586621682578316"><span class="hs-identifier hs-var">tcv</span></a></span></span><span> </span><span id="local-6989586621682578317"><span class="annot"><span class="annottext">ForAllTyFlag
</span><a href="#local-6989586621682578317"><span class="hs-identifier hs-var">visL</span></a></span></span><span> </span><span id="local-6989586621682578318"><span class="annot"><span class="annottext">ForAllTyFlag
</span><a href="#local-6989586621682578318"><span class="hs-identifier hs-var">visR</span></a></span></span><span> </span><span id="local-6989586621682578319"><span class="annot"><span class="annottext">Coercion
</span><a href="#local-6989586621682578319"><span class="hs-identifier hs-var">kind_co</span></a></span></span><span> </span><span id="local-6989586621682578320"><span class="annot"><span class="annottext">Coercion
</span><a href="#local-6989586621682578320"><span class="hs-identifier hs-var">co</span></a></span></span><span>
</span><span id="line-970"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">CoVar
-&gt; ForAllTyFlag
-&gt; ForAllTyFlag
-&gt; Coercion
-&gt; Coercion
-&gt; Coercion
-&gt; Coercion
forall a.
HasDebugCallStack =&gt;
CoVar
-&gt; ForAllTyFlag -&gt; ForAllTyFlag -&gt; Coercion -&gt; Coercion -&gt; a -&gt; a
</span><a href="GHC.Core.Coercion.html#assertGoodForAllCo"><span class="hs-identifier hs-var">assertGoodForAllCo</span></a></span><span> </span><span class="annot"><span class="annottext">CoVar
</span><a href="#local-6989586621682578316"><span class="hs-identifier hs-var">tcv</span></a></span><span> </span><span class="annot"><span class="annottext">ForAllTyFlag
</span><a href="#local-6989586621682578317"><span class="hs-identifier hs-var">visL</span></a></span><span> </span><span class="annot"><span class="annottext">ForAllTyFlag
</span><a href="#local-6989586621682578318"><span class="hs-identifier hs-var">visR</span></a></span><span> </span><span class="annot"><span class="annottext">Coercion
</span><a href="#local-6989586621682578319"><span class="hs-identifier hs-var">kind_co</span></a></span><span> </span><span class="annot"><span class="annottext">Coercion
</span><a href="#local-6989586621682578320"><span class="hs-identifier hs-var">co</span></a></span><span> </span><span class="annot"><span class="annottext">(Coercion -&gt; Coercion) -&gt; Coercion -&gt; Coercion
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-971"></span><span>    </span><span class="annot"><span class="annottext">Bool -&gt; SDoc -&gt; Coercion -&gt; Coercion
forall a. HasCallStack =&gt; Bool -&gt; SDoc -&gt; a -&gt; a
</span><a href="GHC.Utils.Panic.html#assertPpr"><span class="hs-identifier hs-var">assertPpr</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Bool -&gt; Bool
</span><span class="hs-identifier hs-var">not</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Coercion -&gt; Bool
</span><a href="GHC.Core.Coercion.html#isReflCo"><span class="hs-identifier hs-var">isReflCo</span></a></span><span> </span><span class="annot"><span class="annottext">Coercion
</span><a href="#local-6989586621682578320"><span class="hs-identifier hs-var">co</span></a></span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Bool -&gt; Bool
</span><span class="hs-operator hs-var">&amp;&amp;</span></span><span> </span><span class="annot"><span class="annottext">Coercion -&gt; Bool
</span><a href="GHC.Core.Coercion.html#isReflCo"><span class="hs-identifier hs-var">isReflCo</span></a></span><span> </span><span class="annot"><span class="annottext">Coercion
</span><a href="#local-6989586621682578319"><span class="hs-identifier hs-var">kind_co</span></a></span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Bool -&gt; Bool
</span><span class="hs-operator hs-var">&amp;&amp;</span></span><span> </span><span class="annot"><span class="annottext">ForAllTyFlag
</span><a href="#local-6989586621682578317"><span class="hs-identifier hs-var">visL</span></a></span><span> </span><span class="annot"><span class="annottext">ForAllTyFlag -&gt; ForAllTyFlag -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">==</span></span><span> </span><span class="annot"><span class="annottext">ForAllTyFlag
</span><a href="#local-6989586621682578318"><span class="hs-identifier hs-var">visR</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Coercion -&gt; SDoc
forall a. Outputable a =&gt; a -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="annot"><span class="annottext">Coercion
</span><a href="#local-6989586621682578320"><span class="hs-identifier hs-var">co</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(Coercion -&gt; Coercion) -&gt; Coercion -&gt; Coercion
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-972"></span><span>    </span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#ForAllCo"><span class="hs-identifier hs-type">ForAllCo</span></a></span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">fco_tcv :: CoVar
</span><a href="GHC.Core.TyCo.Rep.html#fco_tcv"><span class="hs-identifier hs-var">fco_tcv</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">CoVar
</span><a href="#local-6989586621682578316"><span class="hs-identifier hs-var">tcv</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">fco_visL :: ForAllTyFlag
</span><a href="GHC.Core.TyCo.Rep.html#fco_visL"><span class="hs-identifier hs-var">fco_visL</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ForAllTyFlag
</span><a href="#local-6989586621682578317"><span class="hs-identifier hs-var">visL</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">fco_visR :: ForAllTyFlag
</span><a href="GHC.Core.TyCo.Rep.html#fco_visR"><span class="hs-identifier hs-var">fco_visR</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ForAllTyFlag
</span><a href="#local-6989586621682578318"><span class="hs-identifier hs-var">visR</span></a></span><span>
</span><span id="line-973"></span><span>             </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">fco_kind :: Coercion
</span><a href="GHC.Core.TyCo.Rep.html#fco_kind"><span class="hs-identifier hs-var">fco_kind</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Coercion
</span><a href="#local-6989586621682578319"><span class="hs-identifier hs-var">kind_co</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">fco_body :: Coercion
</span><a href="GHC.Core.TyCo.Rep.html#fco_body"><span class="hs-identifier hs-var">fco_body</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Coercion
</span><a href="#local-6989586621682578320"><span class="hs-identifier hs-var">co</span></a></span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-974"></span><span>
</span><span id="line-975"></span><span id="local-6989586621682577292"><span class="annot"><a href="GHC.Core.Coercion.html#assertGoodForAllCo"><span class="hs-identifier hs-type">assertGoodForAllCo</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Utils.Misc.html#HasDebugCallStack"><span class="hs-identifier hs-type">HasDebugCallStack</span></a></span><span>
</span><span id="line-976"></span><span>                   </span><span class="hs-glyph">=&gt;</span><span>  </span><span class="annot"><a href="GHC.Types.Var.html#TyCoVar"><span class="hs-identifier hs-type">TyCoVar</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Language.Haskell.Syntax.Specificity.html#ForAllTyFlag"><span class="hs-identifier hs-type">ForAllTyFlag</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Language.Haskell.Syntax.Specificity.html#ForAllTyFlag"><span class="hs-identifier hs-type">ForAllTyFlag</span></a></span><span>
</span><span id="line-977"></span><span>                   </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#CoercionN"><span class="hs-identifier hs-type">CoercionN</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#Coercion"><span class="hs-identifier hs-type">Coercion</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621682577292"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621682577292"><span class="hs-identifier hs-type">a</span></a></span></span><span>
</span><span id="line-978"></span><span class="hs-comment">-- Check ForAllCo invariants; see Note [ForAllCo] in GHC.Core.TyCo.Rep</span><span>
</span><span id="line-979"></span><span id="assertGoodForAllCo"><span class="annot"><span class="annottext">assertGoodForAllCo :: forall a.
HasDebugCallStack =&gt;
CoVar
-&gt; ForAllTyFlag -&gt; ForAllTyFlag -&gt; Coercion -&gt; Coercion -&gt; a -&gt; a
</span><a href="GHC.Core.Coercion.html#assertGoodForAllCo"><span class="hs-identifier hs-var hs-var">assertGoodForAllCo</span></a></span></span><span> </span><span id="local-6989586621682578360"><span class="annot"><span class="annottext">CoVar
</span><a href="#local-6989586621682578360"><span class="hs-identifier hs-var">tcv</span></a></span></span><span> </span><span id="local-6989586621682578361"><span class="annot"><span class="annottext">ForAllTyFlag
</span><a href="#local-6989586621682578361"><span class="hs-identifier hs-var">visL</span></a></span></span><span> </span><span id="local-6989586621682578362"><span class="annot"><span class="annottext">ForAllTyFlag
</span><a href="#local-6989586621682578362"><span class="hs-identifier hs-var">visR</span></a></span></span><span> </span><span id="local-6989586621682578363"><span class="annot"><span class="annottext">Coercion
</span><a href="#local-6989586621682578363"><span class="hs-identifier hs-var">kind_co</span></a></span></span><span> </span><span id="local-6989586621682578364"><span class="annot"><span class="annottext">Coercion
</span><a href="#local-6989586621682578364"><span class="hs-identifier hs-var">co</span></a></span></span><span>
</span><span id="line-980"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">CoVar -&gt; Bool
</span><a href="GHC.Types.Var.html#isTyVar"><span class="hs-identifier hs-var">isTyVar</span></a></span><span> </span><span class="annot"><span class="annottext">CoVar
</span><a href="#local-6989586621682578360"><span class="hs-identifier hs-var">tcv</span></a></span><span>
</span><span id="line-981"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Bool -&gt; SDoc -&gt; a -&gt; a
forall a. HasCallStack =&gt; Bool -&gt; SDoc -&gt; a -&gt; a
</span><a href="GHC.Utils.Panic.html#assertPpr"><span class="hs-identifier hs-var">assertPpr</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682578365"><span class="hs-identifier hs-var">tcv_type</span></a></span><span> </span><span class="annot"><span class="annottext">HasCallStack =&gt; Type -&gt; Type -&gt; Bool
Type -&gt; Type -&gt; Bool
</span><a href="GHC.Core.TyCo.Compare.html#eqType"><span class="hs-operator hs-var">`eqType`</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682578366"><span class="hs-identifier hs-var">kind_co_lkind</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">SDoc
</span><a href="#local-6989586621682578367"><span class="hs-identifier hs-var">doc</span></a></span><span>
</span><span id="line-982"></span><span>
</span><span id="line-983"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">otherwise</span></span><span>
</span><span id="line-984"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Bool -&gt; SDoc -&gt; a -&gt; a
forall a. HasCallStack =&gt; Bool -&gt; SDoc -&gt; a -&gt; a
</span><a href="GHC.Utils.Panic.html#assertPpr"><span class="hs-identifier hs-var">assertPpr</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682578365"><span class="hs-identifier hs-var">tcv_type</span></a></span><span> </span><span class="annot"><span class="annottext">HasCallStack =&gt; Type -&gt; Type -&gt; Bool
Type -&gt; Type -&gt; Bool
</span><a href="GHC.Core.TyCo.Compare.html#eqType"><span class="hs-operator hs-var">`eqType`</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682578366"><span class="hs-identifier hs-var">kind_co_lkind</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">SDoc
</span><a href="#local-6989586621682578367"><span class="hs-identifier hs-var">doc</span></a></span><span>
</span><span id="line-985"></span><span>        </span><span class="hs-comment">-- The kind of the tycovar should be the left-hand kind of the kind coercion.</span><span>
</span><span id="line-986"></span><span>  </span><span class="annot"><span class="annottext">(a -&gt; a) -&gt; (a -&gt; a) -&gt; a -&gt; a
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">Bool -&gt; SDoc -&gt; a -&gt; a
forall a. HasCallStack =&gt; Bool -&gt; SDoc -&gt; a -&gt; a
</span><a href="GHC.Utils.Panic.html#assertPpr"><span class="hs-identifier hs-var">assertPpr</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">CoVar -&gt; Coercion -&gt; Bool
</span><a href="GHC.Core.TyCo.FVs.html#almostDevoidCoVarOfCo"><span class="hs-identifier hs-var">almostDevoidCoVarOfCo</span></a></span><span> </span><span class="annot"><span class="annottext">CoVar
</span><a href="#local-6989586621682578360"><span class="hs-identifier hs-var">tcv</span></a></span><span> </span><span class="annot"><span class="annottext">Coercion
</span><a href="#local-6989586621682578364"><span class="hs-identifier hs-var">co</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">SDoc
</span><a href="#local-6989586621682578367"><span class="hs-identifier hs-var">doc</span></a></span><span>
</span><span id="line-987"></span><span>        </span><span class="hs-comment">-- See (FC6) in Note [ForAllCo] in GHC.Core.TyCo.Rep</span><span>
</span><span id="line-988"></span><span>  </span><span class="annot"><span class="annottext">(a -&gt; a) -&gt; (a -&gt; a) -&gt; a -&gt; a
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">Bool -&gt; SDoc -&gt; a -&gt; a
forall a. HasCallStack =&gt; Bool -&gt; SDoc -&gt; a -&gt; a
</span><a href="GHC.Utils.Panic.html#assertPpr"><span class="hs-identifier hs-var">assertPpr</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ForAllTyFlag
</span><a href="#local-6989586621682578361"><span class="hs-identifier hs-var">visL</span></a></span><span> </span><span class="annot"><span class="annottext">ForAllTyFlag -&gt; ForAllTyFlag -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">==</span></span><span> </span><span class="annot"><span class="annottext">ForAllTyFlag
</span><a href="Language.Haskell.Syntax.Specificity.html#coreTyLamForAllTyFlag"><span class="hs-identifier hs-var">coreTyLamForAllTyFlag</span></a></span><span>
</span><span id="line-989"></span><span>            </span><span class="annot"><span class="annottext">Bool -&gt; Bool -&gt; Bool
</span><span class="hs-operator hs-var">&amp;&amp;</span></span><span> </span><span class="annot"><span class="annottext">ForAllTyFlag
</span><a href="#local-6989586621682578362"><span class="hs-identifier hs-var">visR</span></a></span><span> </span><span class="annot"><span class="annottext">ForAllTyFlag -&gt; ForAllTyFlag -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">==</span></span><span> </span><span class="annot"><span class="annottext">ForAllTyFlag
</span><a href="Language.Haskell.Syntax.Specificity.html#coreTyLamForAllTyFlag"><span class="hs-identifier hs-var">coreTyLamForAllTyFlag</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">SDoc
</span><a href="#local-6989586621682578367"><span class="hs-identifier hs-var">doc</span></a></span><span>
</span><span id="line-990"></span><span>        </span><span class="hs-comment">-- See (FC7) in Note [ForAllCo] in GHC.Core.TyCo.Rep</span><span>
</span><span id="line-991"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-992"></span><span>    </span><span id="local-6989586621682578365"><span class="annot"><span class="annottext">tcv_type :: Type
</span><a href="#local-6989586621682578365"><span class="hs-identifier hs-var hs-var">tcv_type</span></a></span></span><span>      </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">CoVar -&gt; Type
</span><a href="GHC.Types.Var.html#varType"><span class="hs-identifier hs-var">varType</span></a></span><span> </span><span class="annot"><span class="annottext">CoVar
</span><a href="#local-6989586621682578360"><span class="hs-identifier hs-var">tcv</span></a></span><span>
</span><span id="line-993"></span><span>    </span><span id="local-6989586621682578366"><span class="annot"><span class="annottext">kind_co_lkind :: Type
</span><a href="#local-6989586621682578366"><span class="hs-identifier hs-var hs-var">kind_co_lkind</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">HasDebugCallStack =&gt; Coercion -&gt; Type
Coercion -&gt; Type
</span><a href="GHC.Core.Coercion.html#coercionLKind"><span class="hs-identifier hs-var">coercionLKind</span></a></span><span> </span><span class="annot"><span class="annottext">Coercion
</span><a href="#local-6989586621682578363"><span class="hs-identifier hs-var">kind_co</span></a></span><span>
</span><span id="line-994"></span><span>
</span><span id="line-995"></span><span>    </span><span id="local-6989586621682578367"><span class="annot"><span class="annottext">doc :: SDoc
</span><a href="#local-6989586621682578367"><span class="hs-identifier hs-var hs-var">doc</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[SDoc] -&gt; SDoc
forall doc. IsDoc doc =&gt; [doc] -&gt; doc
</span><a href="GHC.Utils.Outputable.html#vcat"><span class="hs-identifier hs-var">vcat</span></a></span><span> </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">String -&gt; SDoc
forall doc. IsLine doc =&gt; String -&gt; doc
</span><a href="GHC.Utils.Outputable.html#text"><span class="hs-identifier hs-var">text</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;Var:&quot;</span></span><span> </span><span class="annot"><span class="annottext">SDoc -&gt; SDoc -&gt; SDoc
forall doc. IsLine doc =&gt; doc -&gt; doc -&gt; doc
</span><a href="GHC.Utils.Outputable.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">CoVar -&gt; SDoc
forall a. Outputable a =&gt; a -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="annot"><span class="annottext">CoVar
</span><a href="#local-6989586621682578360"><span class="hs-identifier hs-var">tcv</span></a></span><span> </span><span class="annot"><span class="annottext">SDoc -&gt; SDoc -&gt; SDoc
forall doc. IsLine doc =&gt; doc -&gt; doc -&gt; doc
</span><a href="GHC.Utils.Outputable.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">SDoc
</span><a href="GHC.Utils.Outputable.html#dcolon"><span class="hs-identifier hs-var">dcolon</span></a></span><span> </span><span class="annot"><span class="annottext">SDoc -&gt; SDoc -&gt; SDoc
forall doc. IsLine doc =&gt; doc -&gt; doc -&gt; doc
</span><a href="GHC.Utils.Outputable.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">Type -&gt; SDoc
forall a. Outputable a =&gt; a -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682578365"><span class="hs-identifier hs-var">tcv_type</span></a></span><span>
</span><span id="line-996"></span><span>               </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">String -&gt; SDoc
forall doc. IsLine doc =&gt; String -&gt; doc
</span><a href="GHC.Utils.Outputable.html#text"><span class="hs-identifier hs-var">text</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;Vis:&quot;</span></span><span> </span><span class="annot"><span class="annottext">SDoc -&gt; SDoc -&gt; SDoc
forall doc. IsLine doc =&gt; doc -&gt; doc -&gt; doc
</span><a href="GHC.Utils.Outputable.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">ForAllTyFlag -&gt; SDoc
forall a. Outputable a =&gt; a -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="annot"><span class="annottext">ForAllTyFlag
</span><a href="#local-6989586621682578361"><span class="hs-identifier hs-var">visL</span></a></span><span> </span><span class="annot"><span class="annottext">SDoc -&gt; SDoc -&gt; SDoc
forall doc. IsLine doc =&gt; doc -&gt; doc -&gt; doc
</span><a href="GHC.Utils.Outputable.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">ForAllTyFlag -&gt; SDoc
forall a. Outputable a =&gt; a -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="annot"><span class="annottext">ForAllTyFlag
</span><a href="#local-6989586621682578362"><span class="hs-identifier hs-var">visR</span></a></span><span>
</span><span id="line-997"></span><span>               </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">String -&gt; SDoc
forall doc. IsLine doc =&gt; String -&gt; doc
</span><a href="GHC.Utils.Outputable.html#text"><span class="hs-identifier hs-var">text</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;kind_co:&quot;</span></span><span> </span><span class="annot"><span class="annottext">SDoc -&gt; SDoc -&gt; SDoc
forall doc. IsLine doc =&gt; doc -&gt; doc -&gt; doc
</span><a href="GHC.Utils.Outputable.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">Coercion -&gt; SDoc
forall a. Outputable a =&gt; a -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="annot"><span class="annottext">Coercion
</span><a href="#local-6989586621682578363"><span class="hs-identifier hs-var">kind_co</span></a></span><span>
</span><span id="line-998"></span><span>               </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">String -&gt; SDoc
forall doc. IsLine doc =&gt; String -&gt; doc
</span><a href="GHC.Utils.Outputable.html#text"><span class="hs-identifier hs-var">text</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;kind_co_lkind&quot;</span></span><span> </span><span class="annot"><span class="annottext">SDoc -&gt; SDoc -&gt; SDoc
forall doc. IsLine doc =&gt; doc -&gt; doc -&gt; doc
</span><a href="GHC.Utils.Outputable.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">Type -&gt; SDoc
forall a. Outputable a =&gt; a -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682578366"><span class="hs-identifier hs-var">kind_co_lkind</span></a></span><span>
</span><span id="line-999"></span><span>               </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">String -&gt; SDoc
forall doc. IsLine doc =&gt; String -&gt; doc
</span><a href="GHC.Utils.Outputable.html#text"><span class="hs-identifier hs-var">text</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;body_co&quot;</span></span><span> </span><span class="annot"><span class="annottext">SDoc -&gt; SDoc -&gt; SDoc
forall doc. IsLine doc =&gt; doc -&gt; doc -&gt; doc
</span><a href="GHC.Utils.Outputable.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">Coercion -&gt; SDoc
forall a. Outputable a =&gt; a -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="annot"><span class="annottext">Coercion
</span><a href="#local-6989586621682578364"><span class="hs-identifier hs-var">co</span></a></span><span> </span><span class="hs-special">]</span><span>
</span><span id="line-1000"></span><span>
</span><span id="line-1001"></span><span>
</span><span id="line-1002"></span><span class="annot"><a href="GHC.Core.Coercion.html#mkNakedForAllCo"><span class="hs-identifier hs-type">mkNakedForAllCo</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Types.Var.html#TyVar"><span class="hs-identifier hs-type">TyVar</span></a></span><span>    </span><span class="hs-comment">-- Never a CoVar</span><span>
</span><span id="line-1003"></span><span>                </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Language.Haskell.Syntax.Specificity.html#ForAllTyFlag"><span class="hs-identifier hs-type">ForAllTyFlag</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Language.Haskell.Syntax.Specificity.html#ForAllTyFlag"><span class="hs-identifier hs-type">ForAllTyFlag</span></a></span><span>
</span><span id="line-1004"></span><span>                </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#CoercionN"><span class="hs-identifier hs-type">CoercionN</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#Coercion"><span class="hs-identifier hs-type">Coercion</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#Coercion"><span class="hs-identifier hs-type">Coercion</span></a></span><span>
</span><span id="line-1005"></span><span class="hs-comment">-- This version lacks the assertion checks.</span><span>
</span><span id="line-1006"></span><span class="hs-comment">-- Used during type checking when the arguments may (legitimately) not be zonked</span><span>
</span><span id="line-1007"></span><span class="hs-comment">-- and so the assertions might (bogusly) fail</span><span>
</span><span id="line-1008"></span><span class="hs-comment">-- NB: since the coercions are un-zonked, we can't really deal with</span><span>
</span><span id="line-1009"></span><span class="hs-comment">--     (FC6) and (FC7) in Note [ForAllCo] in GHC.Core.TyCo.Rep.</span><span>
</span><span id="line-1010"></span><span class="hs-comment">--     Fortunately we don't have to: this function is needed only for /type/ variables.</span><span>
</span><span id="line-1011"></span><span id="mkNakedForAllCo"><span class="annot"><span class="annottext">mkNakedForAllCo :: CoVar
-&gt; ForAllTyFlag -&gt; ForAllTyFlag -&gt; Coercion -&gt; Coercion -&gt; Coercion
</span><a href="GHC.Core.Coercion.html#mkNakedForAllCo"><span class="hs-identifier hs-var hs-var">mkNakedForAllCo</span></a></span></span><span> </span><span id="local-6989586621682578371"><span class="annot"><span class="annottext">CoVar
</span><a href="#local-6989586621682578371"><span class="hs-identifier hs-var">tv</span></a></span></span><span> </span><span id="local-6989586621682578372"><span class="annot"><span class="annottext">ForAllTyFlag
</span><a href="#local-6989586621682578372"><span class="hs-identifier hs-var">visL</span></a></span></span><span> </span><span id="local-6989586621682578373"><span class="annot"><span class="annottext">ForAllTyFlag
</span><a href="#local-6989586621682578373"><span class="hs-identifier hs-var">visR</span></a></span></span><span> </span><span id="local-6989586621682578374"><span class="annot"><span class="annottext">Coercion
</span><a href="#local-6989586621682578374"><span class="hs-identifier hs-var">kind_co</span></a></span></span><span> </span><span id="local-6989586621682578375"><span class="annot"><span class="annottext">Coercion
</span><a href="#local-6989586621682578375"><span class="hs-identifier hs-var">co</span></a></span></span><span>
</span><span id="line-1012"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool -&gt; SDoc -&gt; Bool -&gt; Bool
forall a. HasCallStack =&gt; Bool -&gt; SDoc -&gt; a -&gt; a
</span><a href="GHC.Utils.Panic.html#assertPpr"><span class="hs-identifier hs-var">assertPpr</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">CoVar -&gt; Bool
</span><a href="GHC.Types.Var.html#isTyVar"><span class="hs-identifier hs-var">isTyVar</span></a></span><span> </span><span class="annot"><span class="annottext">CoVar
</span><a href="#local-6989586621682578371"><span class="hs-identifier hs-var">tv</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">CoVar -&gt; SDoc
forall a. Outputable a =&gt; a -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="annot"><span class="annottext">CoVar
</span><a href="#local-6989586621682578371"><span class="hs-identifier hs-var">tv</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">True</span></span><span>
</span><span id="line-1013"></span><span>  </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span class="hs-special">(</span><span id="local-6989586621682578376"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682578376"><span class="hs-identifier hs-var">ty</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682578377"><span class="annot"><span class="annottext">Role
</span><a href="#local-6989586621682578377"><span class="hs-identifier hs-var">r</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Coercion -&gt; Maybe (Type, Role)
</span><a href="GHC.Core.Coercion.html#isReflCo_maybe"><span class="hs-identifier hs-var">isReflCo_maybe</span></a></span><span> </span><span class="annot"><span class="annottext">Coercion
</span><a href="#local-6989586621682578375"><span class="hs-identifier hs-var">co</span></a></span><span>
</span><span id="line-1014"></span><span>  </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Coercion -&gt; Bool
</span><a href="GHC.Core.Coercion.html#isReflCo"><span class="hs-identifier hs-var">isReflCo</span></a></span><span> </span><span class="annot"><span class="annottext">Coercion
</span><a href="#local-6989586621682578374"><span class="hs-identifier hs-var">kind_co</span></a></span><span>
</span><span id="line-1015"></span><span>  </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">ForAllTyFlag
</span><a href="#local-6989586621682578372"><span class="hs-identifier hs-var">visL</span></a></span><span> </span><span class="annot"><span class="annottext">ForAllTyFlag -&gt; ForAllTyFlag -&gt; Bool
</span><a href="GHC.Core.TyCo.Compare.html#eqForAllVis"><span class="hs-operator hs-var">`eqForAllVis`</span></a></span><span> </span><span class="annot"><span class="annottext">ForAllTyFlag
</span><a href="#local-6989586621682578373"><span class="hs-identifier hs-var">visR</span></a></span><span>
</span><span id="line-1016"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Role -&gt; Type -&gt; Coercion
</span><a href="GHC.Core.Coercion.html#mkReflCo"><span class="hs-identifier hs-var">mkReflCo</span></a></span><span> </span><span class="annot"><span class="annottext">Role
</span><a href="#local-6989586621682578377"><span class="hs-identifier hs-var">r</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ForAllTyBinder -&gt; Type -&gt; Type
</span><a href="GHC.Core.TyCo.Rep.html#mkForAllTy"><span class="hs-identifier hs-var">mkForAllTy</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">CoVar -&gt; ForAllTyFlag -&gt; ForAllTyBinder
forall var argf. var -&gt; argf -&gt; VarBndr var argf
</span><a href="GHC.Types.Var.html#Bndr"><span class="hs-identifier hs-var">Bndr</span></a></span><span> </span><span class="annot"><span class="annottext">CoVar
</span><a href="#local-6989586621682578371"><span class="hs-identifier hs-var">tv</span></a></span><span> </span><span class="annot"><span class="annottext">ForAllTyFlag
</span><a href="#local-6989586621682578372"><span class="hs-identifier hs-var">visL</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682578376"><span class="hs-identifier hs-var">ty</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1017"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">otherwise</span></span><span>
</span><span id="line-1018"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#ForAllCo"><span class="hs-identifier hs-type">ForAllCo</span></a></span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">fco_tcv :: CoVar
</span><a href="GHC.Core.TyCo.Rep.html#fco_tcv"><span class="hs-identifier hs-var">fco_tcv</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">CoVar
</span><a href="#local-6989586621682578371"><span class="hs-identifier hs-var">tv</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">fco_visL :: ForAllTyFlag
</span><a href="GHC.Core.TyCo.Rep.html#fco_visL"><span class="hs-identifier hs-var">fco_visL</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ForAllTyFlag
</span><a href="#local-6989586621682578372"><span class="hs-identifier hs-var">visL</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">fco_visR :: ForAllTyFlag
</span><a href="GHC.Core.TyCo.Rep.html#fco_visR"><span class="hs-identifier hs-var">fco_visR</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ForAllTyFlag
</span><a href="#local-6989586621682578373"><span class="hs-identifier hs-var">visR</span></a></span><span>
</span><span id="line-1019"></span><span>             </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">fco_kind :: Coercion
</span><a href="GHC.Core.TyCo.Rep.html#fco_kind"><span class="hs-identifier hs-var">fco_kind</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Coercion
</span><a href="#local-6989586621682578374"><span class="hs-identifier hs-var">kind_co</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">fco_body :: Coercion
</span><a href="GHC.Core.TyCo.Rep.html#fco_body"><span class="hs-identifier hs-var">fco_body</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Coercion
</span><a href="#local-6989586621682578375"><span class="hs-identifier hs-var">co</span></a></span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-1020"></span><span>
</span><span id="line-1021"></span><span>
</span><span id="line-1022"></span><span class="annot"><a href="GHC.Core.Coercion.html#mkCoVarCo"><span class="hs-identifier hs-type">mkCoVarCo</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Types.Var.html#CoVar"><span class="hs-identifier hs-type">CoVar</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#Coercion"><span class="hs-identifier hs-type">Coercion</span></a></span><span>
</span><span id="line-1023"></span><span class="hs-comment">-- cv :: s ~# t</span><span>
</span><span id="line-1024"></span><span class="hs-comment">-- See Note [mkCoVarCo]</span><span>
</span><span id="line-1025"></span><span id="mkCoVarCo"><span class="annot"><span class="annottext">mkCoVarCo :: CoVar -&gt; Coercion
</span><a href="GHC.Core.Coercion.html#mkCoVarCo"><span class="hs-identifier hs-var hs-var">mkCoVarCo</span></a></span></span><span> </span><span id="local-6989586621682578379"><span class="annot"><span class="annottext">CoVar
</span><a href="#local-6989586621682578379"><span class="hs-identifier hs-var">cv</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">CoVar -&gt; Coercion
</span><a href="GHC.Core.TyCo.Rep.html#CoVarCo"><span class="hs-identifier hs-var">CoVarCo</span></a></span><span> </span><span class="annot"><span class="annottext">CoVar
</span><a href="#local-6989586621682578379"><span class="hs-identifier hs-var">cv</span></a></span><span>
</span><span id="line-1026"></span><span>
</span><span id="line-1027"></span><span class="annot"><a href="GHC.Core.Coercion.html#mkCoVarCos"><span class="hs-identifier hs-type">mkCoVarCos</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="GHC.Types.Var.html#CoVar"><span class="hs-identifier hs-type">CoVar</span></a></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#Coercion"><span class="hs-identifier hs-type">Coercion</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-1028"></span><span id="mkCoVarCos"><span class="annot"><span class="annottext">mkCoVarCos :: [CoVar] -&gt; [Coercion]
</span><a href="GHC.Core.Coercion.html#mkCoVarCos"><span class="hs-identifier hs-var hs-var">mkCoVarCos</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(CoVar -&gt; Coercion) -&gt; [CoVar] -&gt; [Coercion]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><span class="hs-identifier hs-var">map</span></span><span> </span><span class="annot"><span class="annottext">CoVar -&gt; Coercion
</span><a href="GHC.Core.Coercion.html#mkCoVarCo"><span class="hs-identifier hs-var">mkCoVarCo</span></a></span><span>
</span><span id="line-1029"></span><span>
</span><span id="line-1030"></span><span class="hs-comment">{- Note [mkCoVarCo]
~~~~~~~~~~~~~~~~~~~
In the past, mkCoVarCo optimised (c :: t~t) to (Refl t).  That is
valid (although see Note [Unbound RULE binders] in GHC.Core.Rules), but
it's a relatively expensive test and perhaps better done in
optCoercion.  Not a big deal either way.
-}</span><span>
</span><span id="line-1037"></span><span>
</span><span id="line-1038"></span><span class="annot"><a href="GHC.Core.Coercion.html#mkAxInstCo"><span class="hs-identifier hs-type">mkAxInstCo</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Language.Haskell.Syntax.Basic.html#Role"><span class="hs-identifier hs-type">Role</span></a></span><span>
</span><span id="line-1039"></span><span>           </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Core.Coercion.Axiom.html#CoAxiomRule"><span class="hs-identifier hs-type">CoAxiomRule</span></a></span><span>   </span><span class="hs-comment">-- Always BranchedAxiom or UnbranchedAxiom</span><span>
</span><span id="line-1040"></span><span>           </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#Type"><span class="hs-identifier hs-type">Type</span></a></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#Coercion"><span class="hs-identifier hs-type">Coercion</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-1041"></span><span>           </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#Coercion"><span class="hs-identifier hs-type">Coercion</span></a></span><span>
</span><span id="line-1042"></span><span class="hs-comment">-- mkAxInstCo can legitimately be called over-saturated;</span><span>
</span><span id="line-1043"></span><span class="hs-comment">-- i.e. with more type arguments than the coercion requires</span><span>
</span><span id="line-1044"></span><span class="hs-comment">-- Only called with BranchedAxiom or UnbranchedAxiom</span><span>
</span><span id="line-1045"></span><span id="mkAxInstCo"><span class="annot"><span class="annottext">mkAxInstCo :: Role -&gt; CoAxiomRule -&gt; [Type] -&gt; [Coercion] -&gt; Coercion
</span><a href="GHC.Core.Coercion.html#mkAxInstCo"><span class="hs-identifier hs-var hs-var">mkAxInstCo</span></a></span></span><span> </span><span id="local-6989586621682578380"><span class="annot"><span class="annottext">Role
</span><a href="#local-6989586621682578380"><span class="hs-keyword hs-var">role</span></a></span></span><span> </span><span id="local-6989586621682578381"><span class="annot"><span class="annottext">CoAxiomRule
</span><a href="#local-6989586621682578381"><span class="hs-identifier hs-var">axr</span></a></span></span><span> </span><span id="local-6989586621682578382"><span class="annot"><span class="annottext">[Type]
</span><a href="#local-6989586621682578382"><span class="hs-identifier hs-var">tys</span></a></span></span><span> </span><span id="local-6989586621682578383"><span class="annot"><span class="annottext">[Coercion]
</span><a href="#local-6989586621682578383"><span class="hs-identifier hs-var">cos</span></a></span></span><span>
</span><span id="line-1046"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Arity
</span><a href="#local-6989586621682578384"><span class="hs-identifier hs-var">arity</span></a></span><span> </span><span class="annot"><span class="annottext">Arity -&gt; Arity -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">==</span></span><span> </span><span class="annot"><span class="annottext">Arity
</span><a href="#local-6989586621682578385"><span class="hs-identifier hs-var">n_tys</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Role -&gt; Role -&gt; Coercion -&gt; Coercion
</span><a href="GHC.Core.Coercion.html#downgradeRole"><span class="hs-identifier hs-var">downgradeRole</span></a></span><span> </span><span class="annot"><span class="annottext">Role
</span><a href="#local-6989586621682578380"><span class="hs-keyword hs-var">role</span></a></span><span> </span><span class="annot"><span class="annottext">Role
</span><a href="#local-6989586621682578386"><span class="hs-identifier hs-var">ax_role</span></a></span><span> </span><span class="annot"><span class="annottext">(Coercion -&gt; Coercion) -&gt; Coercion -&gt; Coercion
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-1047"></span><span>                     </span><span class="annot"><span class="annottext">CoAxiomRule -&gt; [Coercion] -&gt; Coercion
</span><a href="GHC.Core.TyCo.Rep.html#AxiomCo"><span class="hs-identifier hs-var">AxiomCo</span></a></span><span> </span><span class="annot"><span class="annottext">CoAxiomRule
</span><a href="#local-6989586621682578381"><span class="hs-identifier hs-var">axr</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[Coercion]
</span><a href="#local-6989586621682578388"><span class="hs-identifier hs-var">rtys</span></a></span><span> </span><span class="annot"><span class="annottext">[Coercion] -&gt; [Coercion] -&gt; [Coercion]
forall a. [a] -&gt; [a] -&gt; [a]
</span><a href="GHC.Utils.Misc.html#chkAppend"><span class="hs-operator hs-var">`chkAppend`</span></a></span><span> </span><span class="annot"><span class="annottext">[Coercion]
</span><a href="#local-6989586621682578383"><span class="hs-identifier hs-var">cos</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1048"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">otherwise</span></span><span>      </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Coercion -&gt; Coercion
forall a. HasCallStack =&gt; Bool -&gt; a -&gt; a
</span><a href="GHC.Utils.Panic.Plain.html#assert"><span class="hs-identifier hs-var">assert</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Arity
</span><a href="#local-6989586621682578384"><span class="hs-identifier hs-var">arity</span></a></span><span> </span><span class="annot"><span class="annottext">Arity -&gt; Arity -&gt; Bool
forall a. Ord a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">&lt;</span></span><span> </span><span class="annot"><span class="annottext">Arity
</span><a href="#local-6989586621682578385"><span class="hs-identifier hs-var">n_tys</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(Coercion -&gt; Coercion) -&gt; Coercion -&gt; Coercion
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-1049"></span><span>                     </span><span class="annot"><span class="annottext">Role -&gt; Role -&gt; Coercion -&gt; Coercion
</span><a href="GHC.Core.Coercion.html#downgradeRole"><span class="hs-identifier hs-var">downgradeRole</span></a></span><span> </span><span class="annot"><span class="annottext">Role
</span><a href="#local-6989586621682578380"><span class="hs-keyword hs-var">role</span></a></span><span> </span><span class="annot"><span class="annottext">Role
</span><a href="#local-6989586621682578386"><span class="hs-identifier hs-var">ax_role</span></a></span><span> </span><span class="annot"><span class="annottext">(Coercion -&gt; Coercion) -&gt; Coercion -&gt; Coercion
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-1050"></span><span>                     </span><span class="annot"><span class="annottext">Coercion -&gt; [Coercion] -&gt; Coercion
</span><a href="GHC.Core.Coercion.html#mkAppCos"><span class="hs-identifier hs-var">mkAppCos</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">CoAxiomRule -&gt; [Coercion] -&gt; Coercion
</span><a href="GHC.Core.TyCo.Rep.html#AxiomCo"><span class="hs-identifier hs-var">AxiomCo</span></a></span><span> </span><span class="annot"><span class="annottext">CoAxiomRule
</span><a href="#local-6989586621682578381"><span class="hs-identifier hs-var">axr</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[Coercion]
</span><a href="#local-6989586621682578391"><span class="hs-identifier hs-var">ax_args</span></a></span><span> </span><span class="annot"><span class="annottext">[Coercion] -&gt; [Coercion] -&gt; [Coercion]
forall a. [a] -&gt; [a] -&gt; [a]
</span><a href="GHC.Utils.Misc.html#chkAppend"><span class="hs-operator hs-var">`chkAppend`</span></a></span><span> </span><span class="annot"><span class="annottext">[Coercion]
</span><a href="#local-6989586621682578383"><span class="hs-identifier hs-var">cos</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-1051"></span><span>                              </span><span class="annot"><span class="annottext">[Coercion]
</span><a href="#local-6989586621682578392"><span class="hs-identifier hs-var">leftover_args</span></a></span><span>
</span><span id="line-1052"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-1053"></span><span>    </span><span class="hs-special">(</span><span id="local-6989586621682578386"><span class="annot"><span class="annottext">Role
</span><a href="#local-6989586621682578386"><span class="hs-identifier hs-var">ax_role</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682578393"><span class="annot"><span class="annottext">CoAxBranch
</span><a href="#local-6989586621682578393"><span class="hs-identifier hs-var">branch</span></a></span></span><span class="hs-special">)</span><span>        </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">CoAxiomRule -&gt; Maybe (TyCon, Role, CoAxBranch)
</span><a href="GHC.Core.Coercion.Axiom.html#coAxiomRuleBranch_maybe"><span class="hs-identifier hs-var">coAxiomRuleBranch_maybe</span></a></span><span> </span><span class="annot"><span class="annottext">CoAxiomRule
</span><a href="#local-6989586621682578381"><span class="hs-identifier hs-var">axr</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-1054"></span><span>                                  </span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span class="hs-special">(</span><span id="local-6989586621682578395"><span class="annot"><span class="annottext">TyCon
</span><a href="#local-6989586621682578395"><span class="hs-identifier hs-var">_tc</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682578396"><span class="annot"><span class="annottext">Role
</span><a href="#local-6989586621682578396"><span class="hs-identifier hs-var">ax_role</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682578397"><span class="annot"><span class="annottext">CoAxBranch
</span><a href="#local-6989586621682578397"><span class="hs-identifier hs-var">branch</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Role
</span><a href="#local-6989586621682578396"><span class="hs-identifier hs-var">ax_role</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">CoAxBranch
</span><a href="#local-6989586621682578397"><span class="hs-identifier hs-var">branch</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1055"></span><span>                                  </span><span class="annot"><span class="annottext">Maybe (TyCon, Role, CoAxBranch)
</span><span class="hs-identifier hs-var">Nothing</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">String -&gt; SDoc -&gt; (Role, CoAxBranch)
forall a. HasCallStack =&gt; String -&gt; SDoc -&gt; a
</span><a href="GHC.Utils.Panic.html#pprPanic"><span class="hs-identifier hs-var">pprPanic</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;mkAxInstCo&quot;</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">CoAxiomRule -&gt; SDoc
forall a. Outputable a =&gt; a -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="annot"><span class="annottext">CoAxiomRule
</span><a href="#local-6989586621682578381"><span class="hs-identifier hs-var">axr</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1056"></span><span>    </span><span id="local-6989586621682578385"><span class="annot"><span class="annottext">n_tys :: Arity
</span><a href="#local-6989586621682578385"><span class="hs-identifier hs-var hs-var">n_tys</span></a></span></span><span>                    </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[Type] -&gt; Arity
forall a. [a] -&gt; Arity
forall (t :: * -&gt; *) a. Foldable t =&gt; t a -&gt; Arity
</span><span class="hs-identifier hs-var">length</span></span><span> </span><span class="annot"><span class="annottext">[Type]
</span><a href="#local-6989586621682578382"><span class="hs-identifier hs-var">tys</span></a></span><span>
</span><span id="line-1057"></span><span>    </span><span id="local-6989586621682578384"><span class="annot"><span class="annottext">arity :: Arity
</span><a href="#local-6989586621682578384"><span class="hs-identifier hs-var hs-var">arity</span></a></span></span><span>                    </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[CoVar] -&gt; Arity
forall a. [a] -&gt; Arity
forall (t :: * -&gt; *) a. Foldable t =&gt; t a -&gt; Arity
</span><span class="hs-identifier hs-var">length</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">CoAxBranch -&gt; [CoVar]
</span><a href="GHC.Core.Coercion.Axiom.html#coAxBranchTyVars"><span class="hs-identifier hs-var">coAxBranchTyVars</span></a></span><span> </span><span class="annot"><span class="annottext">CoAxBranch
</span><a href="#local-6989586621682578393"><span class="hs-identifier hs-var">branch</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1058"></span><span>    </span><span id="local-6989586621682578399"><span class="annot"><span class="annottext">arg_roles :: [Role]
</span><a href="#local-6989586621682578399"><span class="hs-identifier hs-var hs-var">arg_roles</span></a></span></span><span>                </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">CoAxBranch -&gt; [Role]
</span><a href="GHC.Core.Coercion.Axiom.html#coAxBranchRoles"><span class="hs-identifier hs-var">coAxBranchRoles</span></a></span><span> </span><span class="annot"><span class="annottext">CoAxBranch
</span><a href="#local-6989586621682578393"><span class="hs-identifier hs-var">branch</span></a></span><span>
</span><span id="line-1059"></span><span>    </span><span id="local-6989586621682578388"><span class="annot"><span class="annottext">rtys :: [Coercion]
</span><a href="#local-6989586621682578388"><span class="hs-identifier hs-var hs-var">rtys</span></a></span></span><span>                     </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(Role -&gt; Type -&gt; Coercion) -&gt; [Role] -&gt; [Type] -&gt; [Coercion]
forall a b c. (a -&gt; b -&gt; c) -&gt; [a] -&gt; [b] -&gt; [c]
</span><span class="hs-identifier hs-var">zipWith</span></span><span> </span><span class="annot"><span class="annottext">Role -&gt; Type -&gt; Coercion
</span><a href="GHC.Core.Coercion.html#mkReflCo"><span class="hs-identifier hs-var">mkReflCo</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[Role]
</span><a href="#local-6989586621682578399"><span class="hs-identifier hs-var">arg_roles</span></a></span><span> </span><span class="annot"><span class="annottext">[Role] -&gt; [Role] -&gt; [Role]
forall a. [a] -&gt; [a] -&gt; [a]
</span><span class="hs-operator hs-var">++</span></span><span> </span><span class="annot"><span class="annottext">Role -&gt; [Role]
forall a. a -&gt; [a]
</span><span class="hs-identifier hs-var">repeat</span></span><span> </span><span class="annot"><span class="annottext">Role
</span><a href="Language.Haskell.Syntax.Basic.html#Nominal"><span class="hs-identifier hs-var">Nominal</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[Type]
</span><a href="#local-6989586621682578382"><span class="hs-identifier hs-var">tys</span></a></span><span>
</span><span id="line-1060"></span><span>    </span><span class="hs-special">(</span><span id="local-6989586621682578391"><span class="annot"><span class="annottext">[Coercion]
</span><a href="#local-6989586621682578391"><span class="hs-identifier hs-var">ax_args</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682578392"><span class="annot"><span class="annottext">[Coercion]
</span><a href="#local-6989586621682578392"><span class="hs-identifier hs-var">leftover_args</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Arity -&gt; [Coercion] -&gt; ([Coercion], [Coercion])
forall a. Arity -&gt; [a] -&gt; ([a], [a])
</span><span class="hs-identifier hs-var">splitAt</span></span><span> </span><span class="annot"><span class="annottext">Arity
</span><a href="#local-6989586621682578384"><span class="hs-identifier hs-var">arity</span></a></span><span> </span><span class="annot"><span class="annottext">[Coercion]
</span><a href="#local-6989586621682578388"><span class="hs-identifier hs-var">rtys</span></a></span><span>
</span><span id="line-1061"></span><span>
</span><span id="line-1062"></span><span class="hs-comment">-- worker function</span><span>
</span><span id="line-1063"></span><span class="annot"><a href="GHC.Core.Coercion.html#mkAxiomCo"><span class="hs-identifier hs-type">mkAxiomCo</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Core.Coercion.Axiom.html#CoAxiomRule"><span class="hs-identifier hs-type">CoAxiomRule</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#Coercion"><span class="hs-identifier hs-type">Coercion</span></a></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#Coercion"><span class="hs-identifier hs-type">Coercion</span></a></span><span>
</span><span id="line-1064"></span><span id="mkAxiomCo"><span class="annot"><span class="annottext">mkAxiomCo :: CoAxiomRule -&gt; [Coercion] -&gt; Coercion
</span><a href="GHC.Core.Coercion.html#mkAxiomCo"><span class="hs-identifier hs-var hs-var">mkAxiomCo</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">CoAxiomRule -&gt; [Coercion] -&gt; Coercion
</span><a href="GHC.Core.TyCo.Rep.html#AxiomCo"><span class="hs-identifier hs-var">AxiomCo</span></a></span><span>
</span><span id="line-1065"></span><span>
</span><span id="line-1066"></span><span class="hs-comment">-- to be used only with unbranched axioms</span><span>
</span><span id="line-1067"></span><span class="annot"><a href="GHC.Core.Coercion.html#mkUnbranchedAxInstCo"><span class="hs-identifier hs-type">mkUnbranchedAxInstCo</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Language.Haskell.Syntax.Basic.html#Role"><span class="hs-identifier hs-type">Role</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Core.Coercion.Axiom.html#CoAxiom"><span class="hs-identifier hs-type">CoAxiom</span></a></span><span> </span><span class="annot"><a href="GHC.Core.Coercion.Axiom.html#Unbranched"><span class="hs-identifier hs-type">Unbranched</span></a></span><span>
</span><span id="line-1068"></span><span>                     </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#Type"><span class="hs-identifier hs-type">Type</span></a></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#Coercion"><span class="hs-identifier hs-type">Coercion</span></a></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#Coercion"><span class="hs-identifier hs-type">Coercion</span></a></span><span>
</span><span id="line-1069"></span><span id="mkUnbranchedAxInstCo"><span class="annot"><span class="annottext">mkUnbranchedAxInstCo :: Role -&gt; CoAxiom Unbranched -&gt; [Type] -&gt; [Coercion] -&gt; Coercion
</span><a href="GHC.Core.Coercion.html#mkUnbranchedAxInstCo"><span class="hs-identifier hs-var hs-var">mkUnbranchedAxInstCo</span></a></span></span><span> </span><span id="local-6989586621682578404"><span class="annot"><span class="annottext">Role
</span><a href="#local-6989586621682578404"><span class="hs-keyword hs-var">role</span></a></span></span><span> </span><span id="local-6989586621682578405"><span class="annot"><span class="annottext">CoAxiom Unbranched
</span><a href="#local-6989586621682578405"><span class="hs-identifier hs-var">ax</span></a></span></span><span> </span><span id="local-6989586621682578406"><span class="annot"><span class="annottext">[Type]
</span><a href="#local-6989586621682578406"><span class="hs-identifier hs-var">tys</span></a></span></span><span> </span><span id="local-6989586621682578407"><span class="annot"><span class="annottext">[Coercion]
</span><a href="#local-6989586621682578407"><span class="hs-identifier hs-var">cos</span></a></span></span><span>
</span><span id="line-1070"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Role -&gt; CoAxiomRule -&gt; [Type] -&gt; [Coercion] -&gt; Coercion
</span><a href="GHC.Core.Coercion.html#mkAxInstCo"><span class="hs-identifier hs-var">mkAxInstCo</span></a></span><span> </span><span class="annot"><span class="annottext">Role
</span><a href="#local-6989586621682578404"><span class="hs-keyword hs-var">role</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">CoAxiom Unbranched -&gt; CoAxiomRule
</span><a href="GHC.Core.Coercion.Axiom.html#UnbranchedAxiom"><span class="hs-identifier hs-var">UnbranchedAxiom</span></a></span><span> </span><span class="annot"><span class="annottext">CoAxiom Unbranched
</span><a href="#local-6989586621682578405"><span class="hs-identifier hs-var">ax</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[Type]
</span><a href="#local-6989586621682578406"><span class="hs-identifier hs-var">tys</span></a></span><span> </span><span class="annot"><span class="annottext">[Coercion]
</span><a href="#local-6989586621682578407"><span class="hs-identifier hs-var">cos</span></a></span><span>
</span><span id="line-1071"></span><span>
</span><span id="line-1072"></span><span id="local-6989586621682577303"><span class="annot"><a href="GHC.Core.Coercion.html#mkAxInstRHS"><span class="hs-identifier hs-type">mkAxInstRHS</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Core.Coercion.Axiom.html#CoAxiom"><span class="hs-identifier hs-type">CoAxiom</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682577303"><span class="hs-identifier hs-type">br</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Core.Coercion.Axiom.html#BranchIndex"><span class="hs-identifier hs-type">BranchIndex</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#Type"><span class="hs-identifier hs-type">Type</span></a></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#Coercion"><span class="hs-identifier hs-type">Coercion</span></a></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#Type"><span class="hs-identifier hs-type">Type</span></a></span></span><span>
</span><span id="line-1073"></span><span class="hs-comment">-- Instantiate the axiom with specified types,</span><span>
</span><span id="line-1074"></span><span class="hs-comment">-- returning the instantiated RHS</span><span>
</span><span id="line-1075"></span><span class="hs-comment">-- A companion to mkAxInstCo:</span><span>
</span><span id="line-1076"></span><span class="hs-comment">--    mkAxInstRhs ax index tys = snd (coercionKind (mkAxInstCo ax index tys))</span><span>
</span><span id="line-1077"></span><span id="mkAxInstRHS"><span class="annot"><span class="annottext">mkAxInstRHS :: forall (br :: BranchFlag).
CoAxiom br -&gt; Arity -&gt; [Type] -&gt; [Coercion] -&gt; Type
</span><a href="GHC.Core.Coercion.html#mkAxInstRHS"><span class="hs-identifier hs-var hs-var">mkAxInstRHS</span></a></span></span><span> </span><span id="local-6989586621682578413"><span class="annot"><span class="annottext">CoAxiom br
</span><a href="#local-6989586621682578413"><span class="hs-identifier hs-var">ax</span></a></span></span><span> </span><span id="local-6989586621682578414"><span class="annot"><span class="annottext">Arity
</span><a href="#local-6989586621682578414"><span class="hs-identifier hs-var">index</span></a></span></span><span> </span><span id="local-6989586621682578415"><span class="annot"><span class="annottext">[Type]
</span><a href="#local-6989586621682578415"><span class="hs-identifier hs-var">tys</span></a></span></span><span> </span><span id="local-6989586621682578416"><span class="annot"><span class="annottext">[Coercion]
</span><a href="#local-6989586621682578416"><span class="hs-identifier hs-var">cos</span></a></span></span><span>
</span><span id="line-1078"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Type -&gt; Type
forall a. HasCallStack =&gt; Bool -&gt; a -&gt; a
</span><a href="GHC.Utils.Panic.Plain.html#assert"><span class="hs-identifier hs-var">assert</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[CoVar]
</span><a href="#local-6989586621682578417"><span class="hs-identifier hs-var">tvs</span></a></span><span> </span><span class="annot"><span class="annottext">[CoVar] -&gt; [Type] -&gt; Bool
forall a b. [a] -&gt; [b] -&gt; Bool
</span><a href="GHC.Utils.Misc.html#equalLength"><span class="hs-operator hs-var">`equalLength`</span></a></span><span> </span><span class="annot"><span class="annottext">[Type]
</span><a href="#local-6989586621682578419"><span class="hs-identifier hs-var">tys1</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(Type -&gt; Type) -&gt; Type -&gt; Type
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-1079"></span><span>    </span><span class="annot"><span class="annottext">Type -&gt; [Type] -&gt; Type
</span><a href="GHC.Core.Type.html#mkAppTys"><span class="hs-identifier hs-var">mkAppTys</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682578420"><span class="hs-identifier hs-var">rhs'</span></a></span><span> </span><span class="annot"><span class="annottext">[Type]
</span><a href="#local-6989586621682578421"><span class="hs-identifier hs-var">tys2</span></a></span><span>
</span><span id="line-1080"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-1081"></span><span>    </span><span id="local-6989586621682578422"><span class="annot"><span class="annottext">branch :: CoAxBranch
</span><a href="#local-6989586621682578422"><span class="hs-identifier hs-var hs-var">branch</span></a></span></span><span>       </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">CoAxiom br -&gt; Arity -&gt; CoAxBranch
forall (br :: BranchFlag). CoAxiom br -&gt; Arity -&gt; CoAxBranch
</span><a href="GHC.Core.Coercion.Axiom.html#coAxiomNthBranch"><span class="hs-identifier hs-var">coAxiomNthBranch</span></a></span><span> </span><span class="annot"><span class="annottext">CoAxiom br
</span><a href="#local-6989586621682578413"><span class="hs-identifier hs-var">ax</span></a></span><span> </span><span class="annot"><span class="annottext">Arity
</span><a href="#local-6989586621682578414"><span class="hs-identifier hs-var">index</span></a></span><span>
</span><span id="line-1082"></span><span>    </span><span id="local-6989586621682578417"><span class="annot"><span class="annottext">tvs :: [CoVar]
</span><a href="#local-6989586621682578417"><span class="hs-identifier hs-var hs-var">tvs</span></a></span></span><span>          </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">CoAxBranch -&gt; [CoVar]
</span><a href="GHC.Core.Coercion.Axiom.html#coAxBranchTyVars"><span class="hs-identifier hs-var">coAxBranchTyVars</span></a></span><span> </span><span class="annot"><span class="annottext">CoAxBranch
</span><a href="#local-6989586621682578422"><span class="hs-identifier hs-var">branch</span></a></span><span>
</span><span id="line-1083"></span><span>    </span><span id="local-6989586621682578424"><span class="annot"><span class="annottext">cvs :: [CoVar]
</span><a href="#local-6989586621682578424"><span class="hs-identifier hs-var hs-var">cvs</span></a></span></span><span>          </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">CoAxBranch -&gt; [CoVar]
</span><a href="GHC.Core.Coercion.Axiom.html#coAxBranchCoVars"><span class="hs-identifier hs-var">coAxBranchCoVars</span></a></span><span> </span><span class="annot"><span class="annottext">CoAxBranch
</span><a href="#local-6989586621682578422"><span class="hs-identifier hs-var">branch</span></a></span><span>
</span><span id="line-1084"></span><span>    </span><span class="hs-special">(</span><span id="local-6989586621682578419"><span class="annot"><span class="annottext">[Type]
</span><a href="#local-6989586621682578419"><span class="hs-identifier hs-var">tys1</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682578421"><span class="annot"><span class="annottext">[Type]
</span><a href="#local-6989586621682578421"><span class="hs-identifier hs-var">tys2</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[CoVar] -&gt; [Type] -&gt; ([Type], [Type])
forall b a. [b] -&gt; [a] -&gt; ([a], [a])
</span><a href="GHC.Utils.Misc.html#splitAtList"><span class="hs-identifier hs-var">splitAtList</span></a></span><span> </span><span class="annot"><span class="annottext">[CoVar]
</span><a href="#local-6989586621682578417"><span class="hs-identifier hs-var">tvs</span></a></span><span> </span><span class="annot"><span class="annottext">[Type]
</span><a href="#local-6989586621682578415"><span class="hs-identifier hs-var">tys</span></a></span><span>
</span><span id="line-1085"></span><span>    </span><span id="local-6989586621682578420"><span class="annot"><span class="annottext">rhs' :: Type
</span><a href="#local-6989586621682578420"><span class="hs-identifier hs-var hs-var">rhs'</span></a></span></span><span>         </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[CoVar] -&gt; [Type] -&gt; Type -&gt; Type
HasDebugCallStack =&gt; [CoVar] -&gt; [Type] -&gt; Type -&gt; Type
</span><a href="GHC.Core.TyCo.Subst.html#substTyWith"><span class="hs-identifier hs-var">substTyWith</span></a></span><span> </span><span class="annot"><span class="annottext">[CoVar]
</span><a href="#local-6989586621682578417"><span class="hs-identifier hs-var">tvs</span></a></span><span> </span><span class="annot"><span class="annottext">[Type]
</span><a href="#local-6989586621682578419"><span class="hs-identifier hs-var">tys1</span></a></span><span> </span><span class="annot"><span class="annottext">(Type -&gt; Type) -&gt; Type -&gt; Type
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-1086"></span><span>                   </span><span class="annot"><span class="annottext">[CoVar] -&gt; [Coercion] -&gt; Type -&gt; Type
</span><a href="GHC.Core.TyCo.Subst.html#substTyWithCoVars"><span class="hs-identifier hs-var">substTyWithCoVars</span></a></span><span> </span><span class="annot"><span class="annottext">[CoVar]
</span><a href="#local-6989586621682578424"><span class="hs-identifier hs-var">cvs</span></a></span><span> </span><span class="annot"><span class="annottext">[Coercion]
</span><a href="#local-6989586621682578416"><span class="hs-identifier hs-var">cos</span></a></span><span> </span><span class="annot"><span class="annottext">(Type -&gt; Type) -&gt; Type -&gt; Type
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-1087"></span><span>                   </span><span class="annot"><span class="annottext">CoAxBranch -&gt; Type
</span><a href="GHC.Core.Coercion.Axiom.html#coAxBranchRHS"><span class="hs-identifier hs-var">coAxBranchRHS</span></a></span><span> </span><span class="annot"><span class="annottext">CoAxBranch
</span><a href="#local-6989586621682578422"><span class="hs-identifier hs-var">branch</span></a></span><span>
</span><span id="line-1088"></span><span>
</span><span id="line-1089"></span><span class="annot"><a href="GHC.Core.Coercion.html#mkUnbranchedAxInstRHS"><span class="hs-identifier hs-type">mkUnbranchedAxInstRHS</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Core.Coercion.Axiom.html#CoAxiom"><span class="hs-identifier hs-type">CoAxiom</span></a></span><span> </span><span class="annot"><a href="GHC.Core.Coercion.Axiom.html#Unbranched"><span class="hs-identifier hs-type">Unbranched</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#Type"><span class="hs-identifier hs-type">Type</span></a></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#Coercion"><span class="hs-identifier hs-type">Coercion</span></a></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#Type"><span class="hs-identifier hs-type">Type</span></a></span><span>
</span><span id="line-1090"></span><span id="mkUnbranchedAxInstRHS"><span class="annot"><span class="annottext">mkUnbranchedAxInstRHS :: CoAxiom Unbranched -&gt; [Type] -&gt; [Coercion] -&gt; Type
</span><a href="GHC.Core.Coercion.html#mkUnbranchedAxInstRHS"><span class="hs-identifier hs-var hs-var">mkUnbranchedAxInstRHS</span></a></span></span><span> </span><span id="local-6989586621682578430"><span class="annot"><span class="annottext">CoAxiom Unbranched
</span><a href="#local-6989586621682578430"><span class="hs-identifier hs-var">ax</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">CoAxiom Unbranched -&gt; Arity -&gt; [Type] -&gt; [Coercion] -&gt; Type
forall (br :: BranchFlag).
CoAxiom br -&gt; Arity -&gt; [Type] -&gt; [Coercion] -&gt; Type
</span><a href="GHC.Core.Coercion.html#mkAxInstRHS"><span class="hs-identifier hs-var">mkAxInstRHS</span></a></span><span> </span><span class="annot"><span class="annottext">CoAxiom Unbranched
</span><a href="#local-6989586621682578430"><span class="hs-identifier hs-var">ax</span></a></span><span> </span><span class="annot"><span class="annottext">Arity
</span><span class="hs-number">0</span></span><span>
</span><span id="line-1091"></span><span>
</span><span id="line-1092"></span><span class="hs-comment">-- | Return the left-hand type of the axiom, when the axiom is instantiated</span><span>
</span><span id="line-1093"></span><span class="hs-comment">-- at the types given.</span><span>
</span><span id="line-1094"></span><span id="local-6989586621682578431"><span class="annot"><a href="GHC.Core.Coercion.html#mkAxInstLHS"><span class="hs-identifier hs-type">mkAxInstLHS</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Core.Coercion.Axiom.html#CoAxiom"><span class="hs-identifier hs-type">CoAxiom</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682578431"><span class="hs-identifier hs-type">br</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Core.Coercion.Axiom.html#BranchIndex"><span class="hs-identifier hs-type">BranchIndex</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#Type"><span class="hs-identifier hs-type">Type</span></a></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#Coercion"><span class="hs-identifier hs-type">Coercion</span></a></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#Type"><span class="hs-identifier hs-type">Type</span></a></span></span><span>
</span><span id="line-1095"></span><span id="mkAxInstLHS"><span class="annot"><span class="annottext">mkAxInstLHS :: forall (br :: BranchFlag).
CoAxiom br -&gt; Arity -&gt; [Type] -&gt; [Coercion] -&gt; Type
</span><a href="GHC.Core.Coercion.html#mkAxInstLHS"><span class="hs-identifier hs-var hs-var">mkAxInstLHS</span></a></span></span><span> </span><span id="local-6989586621682578436"><span class="annot"><span class="annottext">CoAxiom br
</span><a href="#local-6989586621682578436"><span class="hs-identifier hs-var">ax</span></a></span></span><span> </span><span id="local-6989586621682578437"><span class="annot"><span class="annottext">Arity
</span><a href="#local-6989586621682578437"><span class="hs-identifier hs-var">index</span></a></span></span><span> </span><span id="local-6989586621682578438"><span class="annot"><span class="annottext">[Type]
</span><a href="#local-6989586621682578438"><span class="hs-identifier hs-var">tys</span></a></span></span><span> </span><span id="local-6989586621682578439"><span class="annot"><span class="annottext">[Coercion]
</span><a href="#local-6989586621682578439"><span class="hs-identifier hs-var">cos</span></a></span></span><span>
</span><span id="line-1096"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Type -&gt; Type
forall a. HasCallStack =&gt; Bool -&gt; a -&gt; a
</span><a href="GHC.Utils.Panic.Plain.html#assert"><span class="hs-identifier hs-var">assert</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[CoVar]
</span><a href="#local-6989586621682578440"><span class="hs-identifier hs-var">tvs</span></a></span><span> </span><span class="annot"><span class="annottext">[CoVar] -&gt; [Type] -&gt; Bool
forall a b. [a] -&gt; [b] -&gt; Bool
</span><a href="GHC.Utils.Misc.html#equalLength"><span class="hs-operator hs-var">`equalLength`</span></a></span><span> </span><span class="annot"><span class="annottext">[Type]
</span><a href="#local-6989586621682578441"><span class="hs-identifier hs-var">tys1</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(Type -&gt; Type) -&gt; Type -&gt; Type
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-1097"></span><span>    </span><span class="annot"><span class="annottext">TyCon -&gt; [Type] -&gt; Type
</span><a href="GHC.Core.Type.html#mkTyConApp"><span class="hs-identifier hs-var">mkTyConApp</span></a></span><span> </span><span class="annot"><span class="annottext">TyCon
</span><a href="#local-6989586621682578442"><span class="hs-identifier hs-var">fam_tc</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[Type]
</span><a href="#local-6989586621682578443"><span class="hs-identifier hs-var">lhs_tys</span></a></span><span> </span><span class="annot"><span class="annottext">[Type] -&gt; [Type] -&gt; [Type]
forall a. [a] -&gt; [a] -&gt; [a]
</span><a href="GHC.Utils.Misc.html#chkAppend"><span class="hs-operator hs-var">`chkAppend`</span></a></span><span> </span><span class="annot"><span class="annottext">[Type]
</span><a href="#local-6989586621682578444"><span class="hs-identifier hs-var">tys2</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1098"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-1099"></span><span>    </span><span id="local-6989586621682578445"><span class="annot"><span class="annottext">branch :: CoAxBranch
</span><a href="#local-6989586621682578445"><span class="hs-identifier hs-var hs-var">branch</span></a></span></span><span>       </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">CoAxiom br -&gt; Arity -&gt; CoAxBranch
forall (br :: BranchFlag). CoAxiom br -&gt; Arity -&gt; CoAxBranch
</span><a href="GHC.Core.Coercion.Axiom.html#coAxiomNthBranch"><span class="hs-identifier hs-var">coAxiomNthBranch</span></a></span><span> </span><span class="annot"><span class="annottext">CoAxiom br
</span><a href="#local-6989586621682578436"><span class="hs-identifier hs-var">ax</span></a></span><span> </span><span class="annot"><span class="annottext">Arity
</span><a href="#local-6989586621682578437"><span class="hs-identifier hs-var">index</span></a></span><span>
</span><span id="line-1100"></span><span>    </span><span id="local-6989586621682578440"><span class="annot"><span class="annottext">tvs :: [CoVar]
</span><a href="#local-6989586621682578440"><span class="hs-identifier hs-var hs-var">tvs</span></a></span></span><span>          </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">CoAxBranch -&gt; [CoVar]
</span><a href="GHC.Core.Coercion.Axiom.html#coAxBranchTyVars"><span class="hs-identifier hs-var">coAxBranchTyVars</span></a></span><span> </span><span class="annot"><span class="annottext">CoAxBranch
</span><a href="#local-6989586621682578445"><span class="hs-identifier hs-var">branch</span></a></span><span>
</span><span id="line-1101"></span><span>    </span><span id="local-6989586621682578446"><span class="annot"><span class="annottext">cvs :: [CoVar]
</span><a href="#local-6989586621682578446"><span class="hs-identifier hs-var hs-var">cvs</span></a></span></span><span>          </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">CoAxBranch -&gt; [CoVar]
</span><a href="GHC.Core.Coercion.Axiom.html#coAxBranchCoVars"><span class="hs-identifier hs-var">coAxBranchCoVars</span></a></span><span> </span><span class="annot"><span class="annottext">CoAxBranch
</span><a href="#local-6989586621682578445"><span class="hs-identifier hs-var">branch</span></a></span><span>
</span><span id="line-1102"></span><span>    </span><span class="hs-special">(</span><span id="local-6989586621682578441"><span class="annot"><span class="annottext">[Type]
</span><a href="#local-6989586621682578441"><span class="hs-identifier hs-var">tys1</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682578444"><span class="annot"><span class="annottext">[Type]
</span><a href="#local-6989586621682578444"><span class="hs-identifier hs-var">tys2</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[CoVar] -&gt; [Type] -&gt; ([Type], [Type])
forall b a. [b] -&gt; [a] -&gt; ([a], [a])
</span><a href="GHC.Utils.Misc.html#splitAtList"><span class="hs-identifier hs-var">splitAtList</span></a></span><span> </span><span class="annot"><span class="annottext">[CoVar]
</span><a href="#local-6989586621682578440"><span class="hs-identifier hs-var">tvs</span></a></span><span> </span><span class="annot"><span class="annottext">[Type]
</span><a href="#local-6989586621682578438"><span class="hs-identifier hs-var">tys</span></a></span><span>
</span><span id="line-1103"></span><span>    </span><span id="local-6989586621682578443"><span class="annot"><span class="annottext">lhs_tys :: [Type]
</span><a href="#local-6989586621682578443"><span class="hs-identifier hs-var hs-var">lhs_tys</span></a></span></span><span>      </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[CoVar] -&gt; [Type] -&gt; [Type] -&gt; [Type]
HasDebugCallStack =&gt; [CoVar] -&gt; [Type] -&gt; [Type] -&gt; [Type]
</span><a href="GHC.Core.TyCo.Subst.html#substTysWith"><span class="hs-identifier hs-var">substTysWith</span></a></span><span> </span><span class="annot"><span class="annottext">[CoVar]
</span><a href="#local-6989586621682578440"><span class="hs-identifier hs-var">tvs</span></a></span><span> </span><span class="annot"><span class="annottext">[Type]
</span><a href="#local-6989586621682578441"><span class="hs-identifier hs-var">tys1</span></a></span><span> </span><span class="annot"><span class="annottext">([Type] -&gt; [Type]) -&gt; [Type] -&gt; [Type]
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-1104"></span><span>                   </span><span class="annot"><span class="annottext">[CoVar] -&gt; [Coercion] -&gt; [Type] -&gt; [Type]
HasDebugCallStack =&gt; [CoVar] -&gt; [Coercion] -&gt; [Type] -&gt; [Type]
</span><a href="GHC.Core.TyCo.Subst.html#substTysWithCoVars"><span class="hs-identifier hs-var">substTysWithCoVars</span></a></span><span> </span><span class="annot"><span class="annottext">[CoVar]
</span><a href="#local-6989586621682578446"><span class="hs-identifier hs-var">cvs</span></a></span><span> </span><span class="annot"><span class="annottext">[Coercion]
</span><a href="#local-6989586621682578439"><span class="hs-identifier hs-var">cos</span></a></span><span> </span><span class="annot"><span class="annottext">([Type] -&gt; [Type]) -&gt; [Type] -&gt; [Type]
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-1105"></span><span>                   </span><span class="annot"><span class="annottext">CoAxBranch -&gt; [Type]
</span><a href="GHC.Core.Coercion.Axiom.html#coAxBranchLHS"><span class="hs-identifier hs-var">coAxBranchLHS</span></a></span><span> </span><span class="annot"><span class="annottext">CoAxBranch
</span><a href="#local-6989586621682578445"><span class="hs-identifier hs-var">branch</span></a></span><span>
</span><span id="line-1106"></span><span>    </span><span id="local-6989586621682578442"><span class="annot"><span class="annottext">fam_tc :: TyCon
</span><a href="#local-6989586621682578442"><span class="hs-identifier hs-var hs-var">fam_tc</span></a></span></span><span>       </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">CoAxiom br -&gt; TyCon
forall (br :: BranchFlag). CoAxiom br -&gt; TyCon
</span><a href="GHC.Core.Coercion.Axiom.html#coAxiomTyCon"><span class="hs-identifier hs-var">coAxiomTyCon</span></a></span><span> </span><span class="annot"><span class="annottext">CoAxiom br
</span><a href="#local-6989586621682578436"><span class="hs-identifier hs-var">ax</span></a></span><span>
</span><span id="line-1107"></span><span>
</span><span id="line-1108"></span><span class="annot"><span class="hs-comment">-- | Instantiate the left-hand side of an unbranched axiom</span></span><span>
</span><span id="line-1109"></span><span class="annot"><a href="GHC.Core.Coercion.html#mkUnbranchedAxInstLHS"><span class="hs-identifier hs-type">mkUnbranchedAxInstLHS</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Core.Coercion.Axiom.html#CoAxiom"><span class="hs-identifier hs-type">CoAxiom</span></a></span><span> </span><span class="annot"><a href="GHC.Core.Coercion.Axiom.html#Unbranched"><span class="hs-identifier hs-type">Unbranched</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#Type"><span class="hs-identifier hs-type">Type</span></a></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#Coercion"><span class="hs-identifier hs-type">Coercion</span></a></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#Type"><span class="hs-identifier hs-type">Type</span></a></span><span>
</span><span id="line-1110"></span><span id="mkUnbranchedAxInstLHS"><span class="annot"><span class="annottext">mkUnbranchedAxInstLHS :: CoAxiom Unbranched -&gt; [Type] -&gt; [Coercion] -&gt; Type
</span><a href="GHC.Core.Coercion.html#mkUnbranchedAxInstLHS"><span class="hs-identifier hs-var hs-var">mkUnbranchedAxInstLHS</span></a></span></span><span> </span><span id="local-6989586621682578451"><span class="annot"><span class="annottext">CoAxiom Unbranched
</span><a href="#local-6989586621682578451"><span class="hs-identifier hs-var">ax</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">CoAxiom Unbranched -&gt; Arity -&gt; [Type] -&gt; [Coercion] -&gt; Type
forall (br :: BranchFlag).
CoAxiom br -&gt; Arity -&gt; [Type] -&gt; [Coercion] -&gt; Type
</span><a href="GHC.Core.Coercion.html#mkAxInstLHS"><span class="hs-identifier hs-var">mkAxInstLHS</span></a></span><span> </span><span class="annot"><span class="annottext">CoAxiom Unbranched
</span><a href="#local-6989586621682578451"><span class="hs-identifier hs-var">ax</span></a></span><span> </span><span class="annot"><span class="annottext">Arity
</span><span class="hs-number">0</span></span><span>
</span><span id="line-1111"></span><span>
</span><span id="line-1112"></span><span class="annot"><span class="hs-comment">-- | Make a coercion from a coercion hole</span></span><span>
</span><span id="line-1113"></span><span class="annot"><a href="GHC.Core.Coercion.html#mkHoleCo"><span class="hs-identifier hs-type">mkHoleCo</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#CoercionHole"><span class="hs-identifier hs-type">CoercionHole</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#Coercion"><span class="hs-identifier hs-type">Coercion</span></a></span><span>
</span><span id="line-1114"></span><span id="mkHoleCo"><span class="annot"><span class="annottext">mkHoleCo :: CoercionHole -&gt; Coercion
</span><a href="GHC.Core.Coercion.html#mkHoleCo"><span class="hs-identifier hs-var hs-var">mkHoleCo</span></a></span></span><span> </span><span id="local-6989586621682578452"><span class="annot"><span class="annottext">CoercionHole
</span><a href="#local-6989586621682578452"><span class="hs-identifier hs-var">h</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">CoercionHole -&gt; Coercion
</span><a href="GHC.Core.TyCo.Rep.html#HoleCo"><span class="hs-identifier hs-var">HoleCo</span></a></span><span> </span><span class="annot"><span class="annottext">CoercionHole
</span><a href="#local-6989586621682578452"><span class="hs-identifier hs-var">h</span></a></span><span>
</span><span id="line-1115"></span><span>
</span><span id="line-1116"></span><span class="annot"><span class="hs-comment">-- | Make a universal coercion between two arbitrary types.</span></span><span>
</span><span id="line-1117"></span><span class="annot"><a href="GHC.Core.Coercion.html#mkUnivCo"><span class="hs-identifier hs-type">mkUnivCo</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#UnivCoProvenance"><span class="hs-identifier hs-type">UnivCoProvenance</span></a></span><span>
</span><span id="line-1118"></span><span>         </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#Coercion"><span class="hs-identifier hs-type">Coercion</span></a></span><span class="hs-special">]</span><span> </span><span class="annot"><span class="hs-comment">-- ^ Coercions on which this depends</span></span><span>
</span><span id="line-1119"></span><span>         </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Language.Haskell.Syntax.Basic.html#Role"><span class="hs-identifier hs-type">Role</span></a></span><span>       </span><span class="annot"><span class="hs-comment">-- ^ role of the built coercion, &quot;r&quot;</span></span><span>
</span><span id="line-1120"></span><span>         </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#Type"><span class="hs-identifier hs-type">Type</span></a></span><span>       </span><span class="annot"><span class="hs-comment">-- ^ t1 :: k1</span></span><span>
</span><span id="line-1121"></span><span>         </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#Type"><span class="hs-identifier hs-type">Type</span></a></span><span>       </span><span class="annot"><span class="hs-comment">-- ^ t2 :: k2</span></span><span>
</span><span id="line-1122"></span><span>         </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#Coercion"><span class="hs-identifier hs-type">Coercion</span></a></span><span>   </span><span class="annot"><span class="hs-comment">-- ^ :: t1 ~r t2</span></span><span>
</span><span id="line-1123"></span><span id="mkUnivCo"><span class="annot"><span class="annottext">mkUnivCo :: UnivCoProvenance -&gt; [Coercion] -&gt; Role -&gt; Type -&gt; Type -&gt; Coercion
</span><a href="GHC.Core.Coercion.html#mkUnivCo"><span class="hs-identifier hs-var hs-var">mkUnivCo</span></a></span></span><span> </span><span id="local-6989586621682578454"><span class="annot"><span class="annottext">UnivCoProvenance
</span><a href="#local-6989586621682578454"><span class="hs-identifier hs-var">prov</span></a></span></span><span> </span><span id="local-6989586621682578455"><span class="annot"><span class="annottext">[Coercion]
</span><a href="#local-6989586621682578455"><span class="hs-identifier hs-var">deps</span></a></span></span><span> </span><span id="local-6989586621682578456"><span class="annot"><span class="annottext">Role
</span><a href="#local-6989586621682578456"><span class="hs-keyword hs-var">role</span></a></span></span><span> </span><span id="local-6989586621682578457"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682578457"><span class="hs-identifier hs-var">ty1</span></a></span></span><span> </span><span id="local-6989586621682578458"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682578458"><span class="hs-identifier hs-var">ty2</span></a></span></span><span>
</span><span id="line-1124"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682578457"><span class="hs-identifier hs-var">ty1</span></a></span><span> </span><span class="annot"><span class="annottext">HasCallStack =&gt; Type -&gt; Type -&gt; Bool
Type -&gt; Type -&gt; Bool
</span><a href="GHC.Core.TyCo.Compare.html#eqType"><span class="hs-operator hs-var">`eqType`</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682578458"><span class="hs-identifier hs-var">ty2</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Role -&gt; Type -&gt; Coercion
</span><a href="GHC.Core.Coercion.html#mkReflCo"><span class="hs-identifier hs-var">mkReflCo</span></a></span><span> </span><span class="annot"><span class="annottext">Role
</span><a href="#local-6989586621682578456"><span class="hs-keyword hs-var">role</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682578457"><span class="hs-identifier hs-var">ty1</span></a></span><span>
</span><span id="line-1125"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">otherwise</span></span><span>        </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#UnivCo"><span class="hs-identifier hs-type">UnivCo</span></a></span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">uco_prov :: UnivCoProvenance
</span><a href="GHC.Core.TyCo.Rep.html#uco_prov"><span class="hs-identifier hs-var">uco_prov</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">UnivCoProvenance
</span><a href="#local-6989586621682578454"><span class="hs-identifier hs-var">prov</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">uco_role :: Role
</span><a href="GHC.Core.TyCo.Rep.html#uco_role"><span class="hs-identifier hs-var">uco_role</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Role
</span><a href="#local-6989586621682578456"><span class="hs-keyword hs-var">role</span></a></span><span>
</span><span id="line-1126"></span><span>                              </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">uco_lty :: Type
</span><a href="GHC.Core.TyCo.Rep.html#uco_lty"><span class="hs-identifier hs-var">uco_lty</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682578457"><span class="hs-identifier hs-var">ty1</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">uco_rty :: Type
</span><a href="GHC.Core.TyCo.Rep.html#uco_rty"><span class="hs-identifier hs-var">uco_rty</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682578458"><span class="hs-identifier hs-var">ty2</span></a></span><span>
</span><span id="line-1127"></span><span>                              </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">uco_deps :: [Coercion]
</span><a href="GHC.Core.TyCo.Rep.html#uco_deps"><span class="hs-identifier hs-var">uco_deps</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[Coercion]
</span><a href="#local-6989586621682578455"><span class="hs-identifier hs-var">deps</span></a></span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-1128"></span><span>
</span><span id="line-1129"></span><span class="hs-comment">-- | Create a symmetric version of the given 'Coercion' that asserts</span><span>
</span><span id="line-1130"></span><span class="hs-comment">--   equality between the same types but in the other &quot;direction&quot;, so</span><span>
</span><span id="line-1131"></span><span class="hs-comment">--   a kind of @t1 ~ t2@ becomes the kind @t2 ~ t1@.</span><span>
</span><span id="line-1132"></span><span class="annot"><a href="GHC.Core.Coercion.html#mkSymCo"><span class="hs-identifier hs-type">mkSymCo</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#Coercion"><span class="hs-identifier hs-type">Coercion</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#Coercion"><span class="hs-identifier hs-type">Coercion</span></a></span><span>
</span><span id="line-1133"></span><span>
</span><span id="line-1134"></span><span class="hs-comment">-- Do a few simple optimizations, mainly to expose the underlying</span><span>
</span><span id="line-1135"></span><span class="hs-comment">-- constructors to other 'mk' functions.  E.g.</span><span>
</span><span id="line-1136"></span><span class="hs-comment">--   mkInstCo (mkSymCo (ForAllCo ...)) ty</span><span>
</span><span id="line-1137"></span><span class="hs-comment">-- We want to push the SymCo inside the ForallCo, so that we can instantiate</span><span>
</span><span id="line-1138"></span><span class="hs-comment">-- This can make a big difference.  E.g without coercion optimisation, GHC.Read</span><span>
</span><span id="line-1139"></span><span class="hs-comment">-- totally explodes; but when we push Sym inside ForAll, it's fine.</span><span>
</span><span id="line-1140"></span><span id="mkSymCo"><span class="annot"><span class="annottext">mkSymCo :: Coercion -&gt; Coercion
</span><a href="GHC.Core.Coercion.html#mkSymCo"><span class="hs-identifier hs-var hs-var">mkSymCo</span></a></span></span><span> </span><span id="local-6989586621682578465"><span class="annot"><span class="annottext">Coercion
</span><a href="#local-6989586621682578465"><span class="hs-identifier hs-var">co</span></a></span></span><span> </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Coercion -&gt; Bool
</span><a href="GHC.Core.Coercion.html#isReflCo"><span class="hs-identifier hs-var">isReflCo</span></a></span><span> </span><span class="annot"><span class="annottext">Coercion
</span><a href="#local-6989586621682578465"><span class="hs-identifier hs-var">co</span></a></span><span>   </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Coercion
</span><a href="#local-6989586621682578465"><span class="hs-identifier hs-var">co</span></a></span><span>
</span><span id="line-1141"></span><span class="annot"><a href="GHC.Core.Coercion.html#mkSymCo"><span class="hs-identifier hs-var">mkSymCo</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#SymCo"><span class="hs-identifier hs-type">SymCo</span></a></span><span> </span><span id="local-6989586621682578467"><span class="annot"><span class="annottext">Coercion
</span><a href="#local-6989586621682578467"><span class="hs-identifier hs-var">co</span></a></span></span><span class="hs-special">)</span><span>         </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Coercion
</span><a href="#local-6989586621682578467"><span class="hs-identifier hs-var">co</span></a></span><span>
</span><span id="line-1142"></span><span class="annot"><a href="GHC.Core.Coercion.html#mkSymCo"><span class="hs-identifier hs-var">mkSymCo</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#SubCo"><span class="hs-identifier hs-type">SubCo</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#SymCo"><span class="hs-identifier hs-type">SymCo</span></a></span><span> </span><span id="local-6989586621682578469"><span class="annot"><span class="annottext">Coercion
</span><a href="#local-6989586621682578469"><span class="hs-identifier hs-var">co</span></a></span></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Coercion -&gt; Coercion
</span><a href="GHC.Core.TyCo.Rep.html#SubCo"><span class="hs-identifier hs-var">SubCo</span></a></span><span> </span><span class="annot"><span class="annottext">Coercion
</span><a href="#local-6989586621682578469"><span class="hs-identifier hs-var">co</span></a></span><span>
</span><span id="line-1143"></span><span class="annot"><a href="GHC.Core.Coercion.html#mkSymCo"><span class="hs-identifier hs-var">mkSymCo</span></a></span><span> </span><span id="local-6989586621682578470"><span class="annot"><span class="annottext">co :: Coercion
</span><a href="#local-6989586621682578470"><span class="hs-identifier hs-var">co</span></a></span></span><span class="hs-glyph">@</span><span class="hs-special">(</span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#ForAllCo"><span class="hs-identifier hs-type">ForAllCo</span></a></span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">fco_kind :: Coercion -&gt; Coercion
</span><a href="GHC.Core.TyCo.Rep.html#fco_kind"><span class="hs-identifier hs-var">fco_kind</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="local-6989586621682578471"><span class="annot"><span class="annottext">Coercion
</span><a href="#local-6989586621682578471"><span class="hs-identifier hs-var">kco</span></a></span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">fco_body :: Coercion -&gt; Coercion
</span><a href="GHC.Core.TyCo.Rep.html#fco_body"><span class="hs-identifier hs-var">fco_body</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="local-6989586621682578472"><span class="annot"><span class="annottext">Coercion
</span><a href="#local-6989586621682578472"><span class="hs-identifier hs-var">body_co</span></a></span></span><span> </span><span class="hs-special">}</span><span class="hs-special">)</span><span>
</span><span id="line-1144"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Coercion -&gt; Bool
</span><a href="GHC.Core.Coercion.html#isReflCo"><span class="hs-identifier hs-var">isReflCo</span></a></span><span> </span><span class="annot"><span class="annottext">Coercion
</span><a href="#local-6989586621682578471"><span class="hs-identifier hs-var">kco</span></a></span><span>           </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Coercion
</span><a href="#local-6989586621682578470"><span class="hs-identifier hs-var">co</span></a></span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#fco_body"><span class="hs-identifier hs-var">fco_body</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="GHC.Core.Coercion.html#mkSymCo"><span class="hs-identifier hs-type">mkSymCo</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682578472"><span class="hs-identifier hs-type">body_co</span></a></span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-1145"></span><span class="annot"><a href="GHC.Core.Coercion.html#mkSymCo"><span class="hs-identifier hs-var">mkSymCo</span></a></span><span> </span><span id="local-6989586621682578473"><span class="annot"><span class="annottext">Coercion
</span><a href="#local-6989586621682578473"><span class="hs-identifier hs-var">co</span></a></span></span><span>                 </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Coercion -&gt; Coercion
</span><a href="GHC.Core.TyCo.Rep.html#SymCo"><span class="hs-identifier hs-var">SymCo</span></a></span><span> </span><span class="annot"><span class="annottext">Coercion
</span><a href="#local-6989586621682578473"><span class="hs-identifier hs-var">co</span></a></span><span>
</span><span id="line-1146"></span><span>
</span><span id="line-1147"></span><span class="hs-comment">-- | mkTransCo creates a new 'Coercion' by composing the two</span><span>
</span><span id="line-1148"></span><span class="hs-comment">--   given 'Coercion's transitively: (co1 ; co2)</span><span>
</span><span id="line-1149"></span><span class="annot"><a href="GHC.Core.Coercion.html#mkTransCo"><span class="hs-identifier hs-type">mkTransCo</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Utils.Misc.html#HasDebugCallStack"><span class="hs-identifier hs-type">HasDebugCallStack</span></a></span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#Coercion"><span class="hs-identifier hs-type">Coercion</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#Coercion"><span class="hs-identifier hs-type">Coercion</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#Coercion"><span class="hs-identifier hs-type">Coercion</span></a></span><span>
</span><span id="line-1150"></span><span id="mkTransCo"><span class="annot"><span class="annottext">mkTransCo :: HasDebugCallStack =&gt; Coercion -&gt; Coercion -&gt; Coercion
</span><a href="GHC.Core.Coercion.html#mkTransCo"><span class="hs-identifier hs-var hs-var">mkTransCo</span></a></span></span><span> </span><span id="local-6989586621682578476"><span class="annot"><span class="annottext">Coercion
</span><a href="#local-6989586621682578476"><span class="hs-identifier hs-var">co1</span></a></span></span><span> </span><span id="local-6989586621682578477"><span class="annot"><span class="annottext">Coercion
</span><a href="#local-6989586621682578477"><span class="hs-identifier hs-var">co2</span></a></span></span><span>
</span><span id="line-1151"></span><span>   </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Coercion -&gt; Bool
</span><a href="GHC.Core.Coercion.html#isReflCo"><span class="hs-identifier hs-var">isReflCo</span></a></span><span> </span><span class="annot"><span class="annottext">Coercion
</span><a href="#local-6989586621682578476"><span class="hs-identifier hs-var">co1</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Coercion
</span><a href="#local-6989586621682578477"><span class="hs-identifier hs-var">co2</span></a></span><span>
</span><span id="line-1152"></span><span>   </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Coercion -&gt; Bool
</span><a href="GHC.Core.Coercion.html#isReflCo"><span class="hs-identifier hs-var">isReflCo</span></a></span><span> </span><span class="annot"><span class="annottext">Coercion
</span><a href="#local-6989586621682578477"><span class="hs-identifier hs-var">co2</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Coercion
</span><a href="#local-6989586621682578476"><span class="hs-identifier hs-var">co1</span></a></span><span>
</span><span id="line-1153"></span><span>
</span><span id="line-1154"></span><span>   </span><span class="hs-glyph">|</span><span> </span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#GRefl"><span class="hs-identifier hs-type">GRefl</span></a></span><span> </span><span id="local-6989586621682578478"><span class="annot"><span class="annottext">Role
</span><a href="#local-6989586621682578478"><span class="hs-identifier hs-var">r</span></a></span></span><span> </span><span id="local-6989586621682578479"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682578479"><span class="hs-identifier hs-var">t1</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#MCo"><span class="hs-identifier hs-type">MCo</span></a></span><span> </span><span id="local-6989586621682578480"><span class="annot"><span class="annottext">Coercion
</span><a href="#local-6989586621682578480"><span class="hs-identifier hs-var">kco1</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Coercion
</span><a href="#local-6989586621682578476"><span class="hs-identifier hs-var">co1</span></a></span><span>
</span><span id="line-1155"></span><span>   </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#GRefl"><span class="hs-identifier hs-type">GRefl</span></a></span><span> </span><span class="annot"><span class="annottext">Role
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">Type
</span><span class="hs-identifier">_</span></span><span>  </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#MCo"><span class="hs-identifier hs-type">MCo</span></a></span><span> </span><span id="local-6989586621682578481"><span class="annot"><span class="annottext">Coercion
</span><a href="#local-6989586621682578481"><span class="hs-identifier hs-var">kco2</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Coercion
</span><a href="#local-6989586621682578477"><span class="hs-identifier hs-var">co2</span></a></span><span>
</span><span id="line-1156"></span><span>   </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Role -&gt; Type -&gt; MCoercion -&gt; Coercion
</span><a href="GHC.Core.TyCo.Rep.html#GRefl"><span class="hs-identifier hs-var">GRefl</span></a></span><span> </span><span class="annot"><span class="annottext">Role
</span><a href="#local-6989586621682578478"><span class="hs-identifier hs-var">r</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682578479"><span class="hs-identifier hs-var">t1</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Coercion -&gt; MCoercion
</span><a href="GHC.Core.TyCo.Rep.html#MCo"><span class="hs-identifier hs-var">MCo</span></a></span><span> </span><span class="annot"><span class="annottext">(Coercion -&gt; MCoercion) -&gt; Coercion -&gt; MCoercion
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">HasDebugCallStack =&gt; Coercion -&gt; Coercion -&gt; Coercion
Coercion -&gt; Coercion -&gt; Coercion
</span><a href="GHC.Core.Coercion.html#mkTransCo"><span class="hs-identifier hs-var">mkTransCo</span></a></span><span> </span><span class="annot"><span class="annottext">Coercion
</span><a href="#local-6989586621682578480"><span class="hs-identifier hs-var">kco1</span></a></span><span> </span><span class="annot"><span class="annottext">Coercion
</span><a href="#local-6989586621682578481"><span class="hs-identifier hs-var">kco2</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1157"></span><span>
</span><span id="line-1158"></span><span>   </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">otherwise</span></span><span>
</span><span id="line-1159"></span><span>   </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Coercion -&gt; Coercion -&gt; Coercion
</span><a href="GHC.Core.TyCo.Rep.html#TransCo"><span class="hs-identifier hs-var">TransCo</span></a></span><span> </span><span class="annot"><span class="annottext">Coercion
</span><a href="#local-6989586621682578476"><span class="hs-identifier hs-var">co1</span></a></span><span> </span><span class="annot"><span class="annottext">Coercion
</span><a href="#local-6989586621682578477"><span class="hs-identifier hs-var">co2</span></a></span><span>
</span><span id="line-1160"></span><span>
</span><span id="line-1161"></span><span class="hs-comment">--------------------</span><span>
</span><span id="line-1162"></span><span class="hs-comment">{- Note [mkSelCo precondition]
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
To satisfy the Purely Kinded Type Invariant (PKTI), we require that
  in any call (mkSelCo cs co)
  * selectFromType cs (coercionLKind co) works
  * selectFromType cs (coercionRKind co) works
  * and hence coercionKind (SelCo cs co) works (PKTI)
-}</span><span>
</span><span id="line-1170"></span><span>
</span><span id="line-1171"></span><span class="annot"><a href="GHC.Core.Coercion.html#mkSelCo"><span class="hs-identifier hs-type">mkSelCo</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Utils.Misc.html#HasDebugCallStack"><span class="hs-identifier hs-type">HasDebugCallStack</span></a></span><span>
</span><span id="line-1172"></span><span>        </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#CoSel"><span class="hs-identifier hs-type">CoSel</span></a></span><span>
</span><span id="line-1173"></span><span>        </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#Coercion"><span class="hs-identifier hs-type">Coercion</span></a></span><span>
</span><span id="line-1174"></span><span>        </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#Coercion"><span class="hs-identifier hs-type">Coercion</span></a></span><span>
</span><span id="line-1175"></span><span class="hs-comment">-- See Note [mkSelCo precondition]</span><span>
</span><span id="line-1176"></span><span id="mkSelCo"><span class="annot"><span class="annottext">mkSelCo :: HasDebugCallStack =&gt; CoSel -&gt; Coercion -&gt; Coercion
</span><a href="GHC.Core.Coercion.html#mkSelCo"><span class="hs-identifier hs-var hs-var">mkSelCo</span></a></span></span><span> </span><span id="local-6989586621682578485"><span class="annot"><span class="annottext">CoSel
</span><a href="#local-6989586621682578485"><span class="hs-identifier hs-var">n</span></a></span></span><span> </span><span id="local-6989586621682578486"><span class="annot"><span class="annottext">Coercion
</span><a href="#local-6989586621682578486"><span class="hs-identifier hs-var">co</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">HasDebugCallStack =&gt; CoSel -&gt; Coercion -&gt; Maybe Coercion
CoSel -&gt; Coercion -&gt; Maybe Coercion
</span><a href="GHC.Core.Coercion.html#mkSelCo_maybe"><span class="hs-identifier hs-var">mkSelCo_maybe</span></a></span><span> </span><span class="annot"><span class="annottext">CoSel
</span><a href="#local-6989586621682578485"><span class="hs-identifier hs-var">n</span></a></span><span> </span><span class="annot"><span class="annottext">Coercion
</span><a href="#local-6989586621682578486"><span class="hs-identifier hs-var">co</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe Coercion -&gt; Coercion -&gt; Coercion
forall a. Maybe a -&gt; a -&gt; a
</span><a href="GHC.Data.Maybe.html#orElse"><span class="hs-operator hs-var">`orElse`</span></a></span><span> </span><span class="annot"><span class="annottext">CoSel -&gt; Coercion -&gt; Coercion
</span><a href="GHC.Core.TyCo.Rep.html#SelCo"><span class="hs-identifier hs-var">SelCo</span></a></span><span> </span><span class="annot"><span class="annottext">CoSel
</span><a href="#local-6989586621682578485"><span class="hs-identifier hs-var">n</span></a></span><span> </span><span class="annot"><span class="annottext">Coercion
</span><a href="#local-6989586621682578486"><span class="hs-identifier hs-var">co</span></a></span><span>
</span><span id="line-1177"></span><span>
</span><span id="line-1178"></span><span class="annot"><a href="GHC.Core.Coercion.html#mkSelCo_maybe"><span class="hs-identifier hs-type">mkSelCo_maybe</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Utils.Misc.html#HasDebugCallStack"><span class="hs-identifier hs-type">HasDebugCallStack</span></a></span><span>
</span><span id="line-1179"></span><span>        </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#CoSel"><span class="hs-identifier hs-type">CoSel</span></a></span><span>
</span><span id="line-1180"></span><span>        </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#Coercion"><span class="hs-identifier hs-type">Coercion</span></a></span><span>
</span><span id="line-1181"></span><span>        </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Maybe</span></span><span> </span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#Coercion"><span class="hs-identifier hs-type">Coercion</span></a></span><span>
</span><span id="line-1182"></span><span class="hs-comment">-- Note [mkSelCo precondition]</span><span>
</span><span id="line-1183"></span><span id="mkSelCo_maybe"><span class="annot"><span class="annottext">mkSelCo_maybe :: HasDebugCallStack =&gt; CoSel -&gt; Coercion -&gt; Maybe Coercion
</span><a href="GHC.Core.Coercion.html#mkSelCo_maybe"><span class="hs-identifier hs-var hs-var">mkSelCo_maybe</span></a></span></span><span> </span><span id="local-6989586621682578521"><span class="annot"><span class="annottext">CoSel
</span><a href="#local-6989586621682578521"><span class="hs-identifier hs-var">cs</span></a></span></span><span> </span><span id="local-6989586621682578522"><span class="annot"><span class="annottext">Coercion
</span><a href="#local-6989586621682578522"><span class="hs-identifier hs-var">co</span></a></span></span><span>
</span><span id="line-1184"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Bool -&gt; SDoc -&gt; Maybe Coercion -&gt; Maybe Coercion
forall a. HasCallStack =&gt; Bool -&gt; SDoc -&gt; a -&gt; a
</span><a href="GHC.Utils.Panic.html#assertPpr"><span class="hs-identifier hs-var">assertPpr</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">CoSel -&gt; Bool
</span><a href="#local-6989586621682578523"><span class="hs-identifier hs-var">good_call</span></a></span><span> </span><span class="annot"><span class="annottext">CoSel
</span><a href="#local-6989586621682578521"><span class="hs-identifier hs-var">cs</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">SDoc
</span><a href="#local-6989586621682578524"><span class="hs-identifier hs-var">bad_call_msg</span></a></span><span> </span><span class="annot"><span class="annottext">(Maybe Coercion -&gt; Maybe Coercion)
-&gt; Maybe Coercion -&gt; Maybe Coercion
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-1185"></span><span>    </span><span class="annot"><span class="annottext">CoSel -&gt; Coercion -&gt; Maybe Coercion
</span><a href="#local-6989586621682578525"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="annot"><span class="annottext">CoSel
</span><a href="#local-6989586621682578521"><span class="hs-identifier hs-var">cs</span></a></span><span> </span><span class="annot"><span class="annottext">Coercion
</span><a href="#local-6989586621682578522"><span class="hs-identifier hs-var">co</span></a></span><span>
</span><span id="line-1186"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-1187"></span><span>
</span><span id="line-1188"></span><span>    </span><span id="local-6989586621682578525"><span class="annot"><span class="annottext">go :: CoSel -&gt; Coercion -&gt; Maybe Coercion
</span><a href="#local-6989586621682578525"><span class="hs-identifier hs-var hs-var">go</span></a></span></span><span> </span><span class="annot"><span class="annottext">CoSel
</span><a href="GHC.Core.TyCo.Rep.html#SelForAll"><span class="hs-identifier hs-var">SelForAll</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#ForAllCo"><span class="hs-identifier hs-type">ForAllCo</span></a></span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">fco_kind :: Coercion -&gt; Coercion
</span><a href="GHC.Core.TyCo.Rep.html#fco_kind"><span class="hs-identifier hs-var">fco_kind</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="local-6989586621682578547"><span class="annot"><span class="annottext">Coercion
</span><a href="#local-6989586621682578547"><span class="hs-identifier hs-var">kind_co</span></a></span></span><span> </span><span class="hs-special">}</span><span class="hs-special">)</span><span>
</span><span id="line-1189"></span><span>      </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Coercion -&gt; Maybe Coercion
forall a. a -&gt; Maybe a
</span><span class="hs-identifier hs-var">Just</span></span><span> </span><span class="annot"><span class="annottext">Coercion
</span><a href="#local-6989586621682578547"><span class="hs-identifier hs-var">kind_co</span></a></span><span>
</span><span id="line-1190"></span><span>      </span><span class="hs-comment">-- If co :: (forall a1:k1. t1) ~ (forall a2:k2. t2)</span><span>
</span><span id="line-1191"></span><span>      </span><span class="hs-comment">-- then (nth SelForAll co :: k1 ~N k2)</span><span>
</span><span id="line-1192"></span><span>      </span><span class="hs-comment">-- If co :: (forall a1:t1 ~ t2. t1) ~ (forall a2:t3 ~ t4. t2)</span><span>
</span><span id="line-1193"></span><span>      </span><span class="hs-comment">-- then (nth SelForAll co :: (t1 ~ t2) ~N (t3 ~ t4))</span><span>
</span><span id="line-1194"></span><span>
</span><span id="line-1195"></span><span>    </span><span class="annot"><a href="#local-6989586621682578525"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#SelFun"><span class="hs-identifier hs-type">SelFun</span></a></span><span> </span><span id="local-6989586621682578548"><span class="annot"><span class="annottext">FunSel
</span><a href="#local-6989586621682578548"><span class="hs-identifier hs-var">fs</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#FunCo"><span class="hs-identifier hs-type">FunCo</span></a></span><span> </span><span class="annot"><span class="annottext">Role
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">FunTyFlag
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">FunTyFlag
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621682578549"><span class="annot"><span class="annottext">Coercion
</span><a href="#local-6989586621682578549"><span class="hs-identifier hs-var">w</span></a></span></span><span> </span><span id="local-6989586621682578550"><span class="annot"><span class="annottext">Coercion
</span><a href="#local-6989586621682578550"><span class="hs-identifier hs-var">arg</span></a></span></span><span> </span><span id="local-6989586621682578551"><span class="annot"><span class="annottext">Coercion
</span><a href="#local-6989586621682578551"><span class="hs-identifier hs-var">res</span></a></span></span><span class="hs-special">)</span><span>
</span><span id="line-1196"></span><span>      </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Coercion -&gt; Maybe Coercion
forall a. a -&gt; Maybe a
</span><span class="hs-identifier hs-var">Just</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">FunSel -&gt; Coercion -&gt; Coercion -&gt; Coercion -&gt; Coercion
forall a. FunSel -&gt; a -&gt; a -&gt; a -&gt; a
</span><a href="GHC.Core.Coercion.html#getNthFun"><span class="hs-identifier hs-var">getNthFun</span></a></span><span> </span><span class="annot"><span class="annottext">FunSel
</span><a href="#local-6989586621682578548"><span class="hs-identifier hs-var">fs</span></a></span><span> </span><span class="annot"><span class="annottext">Coercion
</span><a href="#local-6989586621682578549"><span class="hs-identifier hs-var">w</span></a></span><span> </span><span class="annot"><span class="annottext">Coercion
</span><a href="#local-6989586621682578550"><span class="hs-identifier hs-var">arg</span></a></span><span> </span><span class="annot"><span class="annottext">Coercion
</span><a href="#local-6989586621682578551"><span class="hs-identifier hs-var">res</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1197"></span><span>
</span><span id="line-1198"></span><span>    </span><span class="annot"><a href="#local-6989586621682578525"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#SelTyCon"><span class="hs-identifier hs-type">SelTyCon</span></a></span><span> </span><span id="local-6989586621682578552"><span class="annot"><span class="annottext">Arity
</span><a href="#local-6989586621682578552"><span class="hs-identifier hs-var">i</span></a></span></span><span> </span><span id="local-6989586621682578553"><span class="annot"><span class="annottext">Role
</span><a href="#local-6989586621682578553"><span class="hs-identifier hs-var">r</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#TyConAppCo"><span class="hs-identifier hs-type">TyConAppCo</span></a></span><span> </span><span id="local-6989586621682578554"><span class="annot"><span class="annottext">Role
</span><a href="#local-6989586621682578554"><span class="hs-identifier hs-var">r0</span></a></span></span><span> </span><span id="local-6989586621682578555"><span class="annot"><span class="annottext">TyCon
</span><a href="#local-6989586621682578555"><span class="hs-identifier hs-var">tc</span></a></span></span><span> </span><span id="local-6989586621682578556"><span class="annot"><span class="annottext">[Coercion]
</span><a href="#local-6989586621682578556"><span class="hs-identifier hs-var">arg_cos</span></a></span></span><span class="hs-special">)</span><span>
</span><span id="line-1199"></span><span>      </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Bool -&gt; SDoc -&gt; Maybe Coercion -&gt; Maybe Coercion
forall a. HasCallStack =&gt; Bool -&gt; SDoc -&gt; a -&gt; a
</span><a href="GHC.Utils.Panic.html#assertPpr"><span class="hs-identifier hs-var">assertPpr</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Role
</span><a href="#local-6989586621682578553"><span class="hs-identifier hs-var">r</span></a></span><span> </span><span class="annot"><span class="annottext">Role -&gt; Role -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">==</span></span><span> </span><span class="annot"><span class="annottext">Role -&gt; TyCon -&gt; Arity -&gt; Role
</span><a href="GHC.Core.Coercion.html#tyConRole"><span class="hs-identifier hs-var">tyConRole</span></a></span><span> </span><span class="annot"><span class="annottext">Role
</span><a href="#local-6989586621682578554"><span class="hs-identifier hs-var">r0</span></a></span><span> </span><span class="annot"><span class="annottext">TyCon
</span><a href="#local-6989586621682578555"><span class="hs-identifier hs-var">tc</span></a></span><span> </span><span class="annot"><span class="annottext">Arity
</span><a href="#local-6989586621682578552"><span class="hs-identifier hs-var">i</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1200"></span><span>                  </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[SDoc] -&gt; SDoc
forall doc. IsDoc doc =&gt; [doc] -&gt; doc
</span><a href="GHC.Utils.Outputable.html#vcat"><span class="hs-identifier hs-var">vcat</span></a></span><span> </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">TyCon -&gt; SDoc
forall a. Outputable a =&gt; a -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="annot"><span class="annottext">TyCon
</span><a href="#local-6989586621682578555"><span class="hs-identifier hs-var">tc</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">[Coercion] -&gt; SDoc
forall a. Outputable a =&gt; a -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="annot"><span class="annottext">[Coercion]
</span><a href="#local-6989586621682578556"><span class="hs-identifier hs-var">arg_cos</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Role -&gt; SDoc
forall a. Outputable a =&gt; a -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="annot"><span class="annottext">Role
</span><a href="#local-6989586621682578554"><span class="hs-identifier hs-var">r0</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Arity -&gt; SDoc
forall a. Outputable a =&gt; a -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="annot"><span class="annottext">Arity
</span><a href="#local-6989586621682578552"><span class="hs-identifier hs-var">i</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Role -&gt; SDoc
forall a. Outputable a =&gt; a -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="annot"><span class="annottext">Role
</span><a href="#local-6989586621682578553"><span class="hs-identifier hs-var">r</span></a></span><span> </span><span class="hs-special">]</span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(Maybe Coercion -&gt; Maybe Coercion)
-&gt; Maybe Coercion -&gt; Maybe Coercion
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-1201"></span><span>        </span><span class="annot"><span class="annottext">Coercion -&gt; Maybe Coercion
forall a. a -&gt; Maybe a
</span><span class="hs-identifier hs-var">Just</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[Coercion]
</span><a href="#local-6989586621682578556"><span class="hs-identifier hs-var">arg_cos</span></a></span><span> </span><span class="annot"><span class="annottext">[Coercion] -&gt; Arity -&gt; Coercion
forall a. Outputable a =&gt; [a] -&gt; Arity -&gt; a
</span><a href="GHC.Data.List.SetOps.html#getNth"><span class="hs-operator hs-var">`getNth`</span></a></span><span> </span><span class="annot"><span class="annottext">Arity
</span><a href="#local-6989586621682578552"><span class="hs-identifier hs-var">i</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1202"></span><span>
</span><span id="line-1203"></span><span>    </span><span class="annot"><a href="#local-6989586621682578525"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span id="local-6989586621682578558"><span class="annot"><span class="annottext">CoSel
</span><a href="#local-6989586621682578558"><span class="hs-identifier hs-var">cs</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#SymCo"><span class="hs-identifier hs-type">SymCo</span></a></span><span> </span><span id="local-6989586621682578559"><span class="annot"><span class="annottext">Coercion
</span><a href="#local-6989586621682578559"><span class="hs-identifier hs-var">co</span></a></span></span><span class="hs-special">)</span><span>  </span><span class="hs-comment">-- Recurse, hoping to get to a TyConAppCo or FunCo</span><span>
</span><span id="line-1204"></span><span>      </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span id="local-6989586621682578560"><span class="annot"><a href="#local-6989586621682578560"><span class="hs-identifier hs-var">co'</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">CoSel -&gt; Coercion -&gt; Maybe Coercion
</span><a href="#local-6989586621682578525"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="annot"><span class="annottext">CoSel
</span><a href="#local-6989586621682578558"><span class="hs-identifier hs-var">cs</span></a></span><span> </span><span class="annot"><span class="annottext">Coercion
</span><a href="#local-6989586621682578559"><span class="hs-identifier hs-var">co</span></a></span><span class="hs-special">;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">return</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Core.Coercion.html#mkSymCo"><span class="hs-identifier hs-type">mkSymCo</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682578560"><span class="hs-identifier hs-type">co'</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-1205"></span><span>
</span><span id="line-1206"></span><span>    </span><span class="annot"><a href="#local-6989586621682578525"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span id="local-6989586621682578561"><span class="annot"><span class="annottext">CoSel
</span><a href="#local-6989586621682578561"><span class="hs-identifier hs-var">cs</span></a></span></span><span> </span><span id="local-6989586621682578562"><span class="annot"><span class="annottext">Coercion
</span><a href="#local-6989586621682578562"><span class="hs-identifier hs-var">co</span></a></span></span><span>
</span><span id="line-1207"></span><span>      </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span class="hs-special">(</span><span id="local-6989586621682578563"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682578563"><span class="hs-identifier hs-var">ty</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682578564"><span class="annot"><span class="annottext">Role
</span><a href="#local-6989586621682578564"><span class="hs-identifier hs-var">co_role</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Coercion -&gt; Maybe (Type, Role)
</span><a href="GHC.Core.Coercion.html#isReflCo_maybe"><span class="hs-identifier hs-var">isReflCo_maybe</span></a></span><span> </span><span class="annot"><span class="annottext">Coercion
</span><a href="#local-6989586621682578562"><span class="hs-identifier hs-var">co</span></a></span><span>
</span><span id="line-1208"></span><span>      </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Coercion -&gt; Maybe Coercion
forall a. a -&gt; Maybe a
</span><span class="hs-identifier hs-var">Just</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Role -&gt; Type -&gt; Coercion
</span><a href="GHC.Core.Coercion.html#mkReflCo"><span class="hs-identifier hs-var">mkReflCo</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">CoSel -&gt; Role -&gt; Role
</span><a href="GHC.Core.Coercion.html#mkSelCoResRole"><span class="hs-identifier hs-var">mkSelCoResRole</span></a></span><span> </span><span class="annot"><span class="annottext">CoSel
</span><a href="#local-6989586621682578561"><span class="hs-identifier hs-var">cs</span></a></span><span> </span><span class="annot"><span class="annottext">Role
</span><a href="#local-6989586621682578564"><span class="hs-identifier hs-var">co_role</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">HasDebugCallStack =&gt; CoSel -&gt; Type -&gt; Type
CoSel -&gt; Type -&gt; Type
</span><a href="GHC.Core.Coercion.html#selectFromType"><span class="hs-identifier hs-var">selectFromType</span></a></span><span> </span><span class="annot"><span class="annottext">CoSel
</span><a href="#local-6989586621682578561"><span class="hs-identifier hs-var">cs</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682578563"><span class="hs-identifier hs-var">ty</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-1209"></span><span>        </span><span class="hs-comment">-- mkSelCoreResRole: The role of the result may not be</span><span>
</span><span id="line-1210"></span><span>        </span><span class="hs-comment">-- be equal to co_role, the role of co, per Note [SelCo].</span><span>
</span><span id="line-1211"></span><span>        </span><span class="hs-comment">-- This was revealed by #23938.</span><span>
</span><span id="line-1212"></span><span>
</span><span id="line-1213"></span><span>      </span><span class="hs-glyph">|</span><span> </span><span class="annot"><a href="GHC.Data.Pair.html#Pair"><span class="hs-identifier hs-type">Pair</span></a></span><span> </span><span id="local-6989586621682578565"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682578565"><span class="hs-identifier hs-var">ty1</span></a></span></span><span> </span><span id="local-6989586621682578566"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682578566"><span class="hs-identifier hs-var">ty2</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">HasDebugCallStack =&gt; Coercion -&gt; Pair Type
Coercion -&gt; Pair Type
</span><a href="GHC.Core.Coercion.html#coercionKind"><span class="hs-identifier hs-var">coercionKind</span></a></span><span> </span><span class="annot"><span class="annottext">Coercion
</span><a href="#local-6989586621682578562"><span class="hs-identifier hs-var">co</span></a></span><span>
</span><span id="line-1214"></span><span>      </span><span class="hs-special">,</span><span> </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621682578567"><span class="annot"><span class="annottext">sty1 :: Type
</span><a href="#local-6989586621682578567"><span class="hs-identifier hs-var hs-var">sty1</span></a></span></span><span>    </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">HasDebugCallStack =&gt; CoSel -&gt; Type -&gt; Type
CoSel -&gt; Type -&gt; Type
</span><a href="GHC.Core.Coercion.html#selectFromType"><span class="hs-identifier hs-var">selectFromType</span></a></span><span> </span><span class="annot"><span class="annottext">CoSel
</span><a href="#local-6989586621682578561"><span class="hs-identifier hs-var">cs</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682578565"><span class="hs-identifier hs-var">ty1</span></a></span><span>
</span><span id="line-1215"></span><span>            </span><span id="local-6989586621682578568"><span class="annot"><span class="annottext">sty2 :: Type
</span><a href="#local-6989586621682578568"><span class="hs-identifier hs-var hs-var">sty2</span></a></span></span><span>    </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">HasDebugCallStack =&gt; CoSel -&gt; Type -&gt; Type
CoSel -&gt; Type -&gt; Type
</span><a href="GHC.Core.Coercion.html#selectFromType"><span class="hs-identifier hs-var">selectFromType</span></a></span><span> </span><span class="annot"><span class="annottext">CoSel
</span><a href="#local-6989586621682578561"><span class="hs-identifier hs-var">cs</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682578566"><span class="hs-identifier hs-var">ty2</span></a></span><span>
</span><span id="line-1216"></span><span>            </span><span id="local-6989586621682578569"><span class="annot"><span class="annottext">co_role :: Role
</span><a href="#local-6989586621682578569"><span class="hs-identifier hs-var hs-var">co_role</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Coercion -&gt; Role
</span><a href="GHC.Core.Coercion.html#coercionRole"><span class="hs-identifier hs-var">coercionRole</span></a></span><span> </span><span class="annot"><span class="annottext">Coercion
</span><a href="#local-6989586621682578562"><span class="hs-identifier hs-var">co</span></a></span><span>
</span><span id="line-1217"></span><span>      </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682578567"><span class="hs-identifier hs-var">sty1</span></a></span><span> </span><span class="annot"><span class="annottext">HasCallStack =&gt; Type -&gt; Type -&gt; Bool
Type -&gt; Type -&gt; Bool
</span><a href="GHC.Core.TyCo.Compare.html#eqType"><span class="hs-operator hs-var">`eqType`</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682578568"><span class="hs-identifier hs-var">sty2</span></a></span><span>
</span><span id="line-1218"></span><span>      </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Coercion -&gt; Maybe Coercion
forall a. a -&gt; Maybe a
</span><span class="hs-identifier hs-var">Just</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Role -&gt; Type -&gt; Coercion
</span><a href="GHC.Core.Coercion.html#mkReflCo"><span class="hs-identifier hs-var">mkReflCo</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">CoSel -&gt; Role -&gt; Role
</span><a href="GHC.Core.Coercion.html#mkSelCoResRole"><span class="hs-identifier hs-var">mkSelCoResRole</span></a></span><span> </span><span class="annot"><span class="annottext">CoSel
</span><a href="#local-6989586621682578561"><span class="hs-identifier hs-var">cs</span></a></span><span> </span><span class="annot"><span class="annottext">Role
</span><a href="#local-6989586621682578569"><span class="hs-identifier hs-var">co_role</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682578567"><span class="hs-identifier hs-var">sty1</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1219"></span><span>            </span><span class="hs-comment">-- Checking for fully reflexive-ness (by seeing if sty1=sty2)</span><span>
</span><span id="line-1220"></span><span>            </span><span class="hs-comment">-- is worthwhile, because a non-Refl coercion `co` may well have a</span><span>
</span><span id="line-1221"></span><span>            </span><span class="hs-comment">-- reflexive (SelCo cs co).</span><span>
</span><span id="line-1222"></span><span>            </span><span class="hs-comment">-- E.g. co :: Either a b ~ Either a c</span><span>
</span><span id="line-1223"></span><span>            </span><span class="hs-comment">--      Then (SubCo (SelTyCon 0) co) is reflexive</span><span>
</span><span id="line-1224"></span><span>
</span><span id="line-1225"></span><span>      </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">otherwise</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Maybe Coercion
forall a. Maybe a
</span><span class="hs-identifier hs-var">Nothing</span></span><span>
</span><span id="line-1226"></span><span>
</span><span id="line-1227"></span><span>    </span><span class="hs-comment">----------- Assertion checking --------------</span><span>
</span><span id="line-1228"></span><span>    </span><span class="hs-comment">-- NB: using coercionKind requires Note [mkSelCo precondition]</span><span>
</span><span id="line-1229"></span><span>    </span><span class="annot"><a href="GHC.Data.Pair.html#Pair"><span class="hs-identifier hs-type">Pair</span></a></span><span> </span><span id="local-6989586621682578570"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682578570"><span class="hs-identifier hs-var">ty1</span></a></span></span><span> </span><span id="local-6989586621682578571"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682578571"><span class="hs-identifier hs-var">ty2</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">HasDebugCallStack =&gt; Coercion -&gt; Pair Type
Coercion -&gt; Pair Type
</span><a href="GHC.Core.Coercion.html#coercionKind"><span class="hs-identifier hs-var">coercionKind</span></a></span><span> </span><span class="annot"><span class="annottext">Coercion
</span><a href="#local-6989586621682578522"><span class="hs-identifier hs-var">co</span></a></span><span>
</span><span id="line-1230"></span><span>    </span><span id="local-6989586621682578524"><span class="annot"><span class="annottext">bad_call_msg :: SDoc
</span><a href="#local-6989586621682578524"><span class="hs-identifier hs-var hs-var">bad_call_msg</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[SDoc] -&gt; SDoc
forall doc. IsDoc doc =&gt; [doc] -&gt; doc
</span><a href="GHC.Utils.Outputable.html#vcat"><span class="hs-identifier hs-var">vcat</span></a></span><span> </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">String -&gt; SDoc
forall doc. IsLine doc =&gt; String -&gt; doc
</span><a href="GHC.Utils.Outputable.html#text"><span class="hs-identifier hs-var">text</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;Coercion =&quot;</span></span><span> </span><span class="annot"><span class="annottext">SDoc -&gt; SDoc -&gt; SDoc
forall doc. IsLine doc =&gt; doc -&gt; doc -&gt; doc
</span><a href="GHC.Utils.Outputable.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">Coercion -&gt; SDoc
forall a. Outputable a =&gt; a -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="annot"><span class="annottext">Coercion
</span><a href="#local-6989586621682578522"><span class="hs-identifier hs-var">co</span></a></span><span>
</span><span id="line-1231"></span><span>                        </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">String -&gt; SDoc
forall doc. IsLine doc =&gt; String -&gt; doc
</span><a href="GHC.Utils.Outputable.html#text"><span class="hs-identifier hs-var">text</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;LHS ty =&quot;</span></span><span> </span><span class="annot"><span class="annottext">SDoc -&gt; SDoc -&gt; SDoc
forall doc. IsLine doc =&gt; doc -&gt; doc -&gt; doc
</span><a href="GHC.Utils.Outputable.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">Type -&gt; SDoc
forall a. Outputable a =&gt; a -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682578570"><span class="hs-identifier hs-var">ty1</span></a></span><span>
</span><span id="line-1232"></span><span>                        </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">String -&gt; SDoc
forall doc. IsLine doc =&gt; String -&gt; doc
</span><a href="GHC.Utils.Outputable.html#text"><span class="hs-identifier hs-var">text</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;RHS ty =&quot;</span></span><span> </span><span class="annot"><span class="annottext">SDoc -&gt; SDoc -&gt; SDoc
forall doc. IsLine doc =&gt; doc -&gt; doc -&gt; doc
</span><a href="GHC.Utils.Outputable.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">Type -&gt; SDoc
forall a. Outputable a =&gt; a -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682578571"><span class="hs-identifier hs-var">ty2</span></a></span><span>
</span><span id="line-1233"></span><span>                        </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">String -&gt; SDoc
forall doc. IsLine doc =&gt; String -&gt; doc
</span><a href="GHC.Utils.Outputable.html#text"><span class="hs-identifier hs-var">text</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;cs =&quot;</span></span><span> </span><span class="annot"><span class="annottext">SDoc -&gt; SDoc -&gt; SDoc
forall doc. IsLine doc =&gt; doc -&gt; doc -&gt; doc
</span><a href="GHC.Utils.Outputable.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">CoSel -&gt; SDoc
forall a. Outputable a =&gt; a -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="annot"><span class="annottext">CoSel
</span><a href="#local-6989586621682578521"><span class="hs-identifier hs-var">cs</span></a></span><span>
</span><span id="line-1234"></span><span>                        </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">String -&gt; SDoc
forall doc. IsLine doc =&gt; String -&gt; doc
</span><a href="GHC.Utils.Outputable.html#text"><span class="hs-identifier hs-var">text</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;coercion role =&quot;</span></span><span> </span><span class="annot"><span class="annottext">SDoc -&gt; SDoc -&gt; SDoc
forall doc. IsLine doc =&gt; doc -&gt; doc -&gt; doc
</span><a href="GHC.Utils.Outputable.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">Role -&gt; SDoc
forall a. Outputable a =&gt; a -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Coercion -&gt; Role
</span><a href="GHC.Core.Coercion.html#coercionRole"><span class="hs-identifier hs-var">coercionRole</span></a></span><span> </span><span class="annot"><span class="annottext">Coercion
</span><a href="#local-6989586621682578522"><span class="hs-identifier hs-var">co</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">]</span><span>
</span><span id="line-1235"></span><span>
</span><span id="line-1236"></span><span>    </span><span class="hs-comment">-- good_call checks the typing rules given in Note [SelCo]</span><span>
</span><span id="line-1237"></span><span>    </span><span id="local-6989586621682578523"><span class="annot"><span class="annottext">good_call :: CoSel -&gt; Bool
</span><a href="#local-6989586621682578523"><span class="hs-identifier hs-var hs-var">good_call</span></a></span></span><span> </span><span class="annot"><span class="annottext">CoSel
</span><a href="GHC.Core.TyCo.Rep.html#SelForAll"><span class="hs-identifier hs-var">SelForAll</span></a></span><span>
</span><span id="line-1238"></span><span>      </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span class="hs-special">(</span><span id="local-6989586621682578572"><span class="annot"><span class="annottext">CoVar
</span><a href="#local-6989586621682578572"><span class="hs-identifier hs-var">_tv1</span></a></span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Type
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Type -&gt; Maybe (CoVar, Type)
</span><a href="GHC.Core.Type.html#splitForAllTyCoVar_maybe"><span class="hs-identifier hs-var">splitForAllTyCoVar_maybe</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682578570"><span class="hs-identifier hs-var">ty1</span></a></span><span>
</span><span id="line-1239"></span><span>      </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span class="hs-special">(</span><span id="local-6989586621682578573"><span class="annot"><span class="annottext">CoVar
</span><a href="#local-6989586621682578573"><span class="hs-identifier hs-var">_tv2</span></a></span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Type
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Type -&gt; Maybe (CoVar, Type)
</span><a href="GHC.Core.Type.html#splitForAllTyCoVar_maybe"><span class="hs-identifier hs-var">splitForAllTyCoVar_maybe</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682578571"><span class="hs-identifier hs-var">ty2</span></a></span><span>
</span><span id="line-1240"></span><span>      </span><span class="hs-glyph">=</span><span>  </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">True</span></span><span>
</span><span id="line-1241"></span><span>
</span><span id="line-1242"></span><span>    </span><span class="annot"><a href="#local-6989586621682578523"><span class="hs-identifier hs-var">good_call</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#SelFun"><span class="hs-identifier hs-type">SelFun</span></a></span><span> </span><span class="hs-special">{</span><span class="hs-special">}</span><span class="hs-special">)</span><span>
</span><span id="line-1243"></span><span>       </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Type -&gt; Bool
</span><a href="GHC.Core.Type.html#isFunTy"><span class="hs-identifier hs-var">isFunTy</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682578570"><span class="hs-identifier hs-var">ty1</span></a></span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Bool -&gt; Bool
</span><span class="hs-operator hs-var">&amp;&amp;</span></span><span> </span><span class="annot"><span class="annottext">Type -&gt; Bool
</span><a href="GHC.Core.Type.html#isFunTy"><span class="hs-identifier hs-var">isFunTy</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682578571"><span class="hs-identifier hs-var">ty2</span></a></span><span>
</span><span id="line-1244"></span><span>
</span><span id="line-1245"></span><span>    </span><span class="annot"><a href="#local-6989586621682578523"><span class="hs-identifier hs-var">good_call</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#SelTyCon"><span class="hs-identifier hs-type">SelTyCon</span></a></span><span> </span><span id="local-6989586621682578574"><span class="annot"><span class="annottext">Arity
</span><a href="#local-6989586621682578574"><span class="hs-identifier hs-var">n</span></a></span></span><span> </span><span id="local-6989586621682578575"><span class="annot"><span class="annottext">Role
</span><a href="#local-6989586621682578575"><span class="hs-identifier hs-var">r</span></a></span></span><span class="hs-special">)</span><span>
</span><span id="line-1246"></span><span>       </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span class="hs-special">(</span><span id="local-6989586621682578576"><span class="annot"><span class="annottext">TyCon
</span><a href="#local-6989586621682578576"><span class="hs-identifier hs-var">tc1</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682578577"><span class="annot"><span class="annottext">[Type]
</span><a href="#local-6989586621682578577"><span class="hs-identifier hs-var">tys1</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">HasDebugCallStack =&gt; Type -&gt; Maybe (TyCon, [Type])
Type -&gt; Maybe (TyCon, [Type])
</span><a href="GHC.Core.Type.html#splitTyConApp_maybe"><span class="hs-identifier hs-var">splitTyConApp_maybe</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682578570"><span class="hs-identifier hs-var">ty1</span></a></span><span>
</span><span id="line-1247"></span><span>       </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span class="hs-special">(</span><span id="local-6989586621682578578"><span class="annot"><span class="annottext">TyCon
</span><a href="#local-6989586621682578578"><span class="hs-identifier hs-var">tc2</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682578579"><span class="annot"><span class="annottext">[Type]
</span><a href="#local-6989586621682578579"><span class="hs-identifier hs-var">tys2</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">HasDebugCallStack =&gt; Type -&gt; Maybe (TyCon, [Type])
Type -&gt; Maybe (TyCon, [Type])
</span><a href="GHC.Core.Type.html#splitTyConApp_maybe"><span class="hs-identifier hs-var">splitTyConApp_maybe</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682578571"><span class="hs-identifier hs-var">ty2</span></a></span><span>
</span><span id="line-1248"></span><span>       </span><span class="hs-special">,</span><span> </span><span class="hs-keyword">let</span><span> </span><span class="hs-special">{</span><span> </span><span id="local-6989586621682578580"><span class="annot"><span class="annottext">len1 :: Arity
</span><a href="#local-6989586621682578580"><span class="hs-identifier hs-var hs-var">len1</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[Type] -&gt; Arity
forall a. [a] -&gt; Arity
forall (t :: * -&gt; *) a. Foldable t =&gt; t a -&gt; Arity
</span><span class="hs-identifier hs-var">length</span></span><span> </span><span class="annot"><span class="annottext">[Type]
</span><a href="#local-6989586621682578577"><span class="hs-identifier hs-var">tys1</span></a></span><span>
</span><span id="line-1249"></span><span>             </span><span class="hs-special">;</span><span> </span><span id="local-6989586621682578581"><span class="annot"><span class="annottext">len2 :: Arity
</span><a href="#local-6989586621682578581"><span class="hs-identifier hs-var hs-var">len2</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[Type] -&gt; Arity
forall a. [a] -&gt; Arity
forall (t :: * -&gt; *) a. Foldable t =&gt; t a -&gt; Arity
</span><span class="hs-identifier hs-var">length</span></span><span> </span><span class="annot"><span class="annottext">[Type]
</span><a href="#local-6989586621682578579"><span class="hs-identifier hs-var">tys2</span></a></span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-1250"></span><span>       </span><span class="hs-glyph">=</span><span>  </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TyCon
</span><a href="#local-6989586621682578576"><span class="hs-identifier hs-var">tc1</span></a></span><span> </span><span class="annot"><span class="annottext">TyCon -&gt; TyCon -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">==</span></span><span> </span><span class="annot"><span class="annottext">TyCon
</span><a href="#local-6989586621682578578"><span class="hs-identifier hs-var">tc2</span></a></span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Bool -&gt; Bool
</span><span class="hs-operator hs-var">||</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TyCon -&gt; Bool
</span><a href="GHC.Core.Type.html#tyConIsTYPEorCONSTRAINT"><span class="hs-identifier hs-var">tyConIsTYPEorCONSTRAINT</span></a></span><span> </span><span class="annot"><span class="annottext">TyCon
</span><a href="#local-6989586621682578576"><span class="hs-identifier hs-var">tc1</span></a></span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Bool -&gt; Bool
</span><span class="hs-operator hs-var">&amp;&amp;</span></span><span> </span><span class="annot"><span class="annottext">TyCon -&gt; Bool
</span><a href="GHC.Core.Type.html#tyConIsTYPEorCONSTRAINT"><span class="hs-identifier hs-var">tyConIsTYPEorCONSTRAINT</span></a></span><span> </span><span class="annot"><span class="annottext">TyCon
</span><a href="#local-6989586621682578578"><span class="hs-identifier hs-var">tc2</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-1251"></span><span>                      </span><span class="hs-comment">-- tyConIsTYPEorCONSTRAINT: see Note [mkRuntimeRepCo]</span><span>
</span><span id="line-1252"></span><span>       </span><span class="annot"><span class="annottext">Bool -&gt; Bool -&gt; Bool
</span><span class="hs-operator hs-var">&amp;&amp;</span></span><span> </span><span class="annot"><span class="annottext">Arity
</span><a href="#local-6989586621682578580"><span class="hs-identifier hs-var">len1</span></a></span><span> </span><span class="annot"><span class="annottext">Arity -&gt; Arity -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">==</span></span><span> </span><span class="annot"><span class="annottext">Arity
</span><a href="#local-6989586621682578581"><span class="hs-identifier hs-var">len2</span></a></span><span>
</span><span id="line-1253"></span><span>       </span><span class="annot"><span class="annottext">Bool -&gt; Bool -&gt; Bool
</span><span class="hs-operator hs-var">&amp;&amp;</span></span><span> </span><span class="annot"><span class="annottext">Arity
</span><a href="#local-6989586621682578574"><span class="hs-identifier hs-var">n</span></a></span><span> </span><span class="annot"><span class="annottext">Arity -&gt; Arity -&gt; Bool
forall a. Ord a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">&lt;</span></span><span> </span><span class="annot"><span class="annottext">Arity
</span><a href="#local-6989586621682578580"><span class="hs-identifier hs-var">len1</span></a></span><span>
</span><span id="line-1254"></span><span>       </span><span class="annot"><span class="annottext">Bool -&gt; Bool -&gt; Bool
</span><span class="hs-operator hs-var">&amp;&amp;</span></span><span> </span><span class="annot"><span class="annottext">Role
</span><a href="#local-6989586621682578575"><span class="hs-identifier hs-var">r</span></a></span><span> </span><span class="annot"><span class="annottext">Role -&gt; Role -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">==</span></span><span> </span><span class="annot"><span class="annottext">Role -&gt; TyCon -&gt; Arity -&gt; Role
</span><a href="GHC.Core.Coercion.html#tyConRole"><span class="hs-identifier hs-var">tyConRole</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Coercion -&gt; Role
</span><a href="GHC.Core.Coercion.html#coercionRole"><span class="hs-identifier hs-var">coercionRole</span></a></span><span> </span><span class="annot"><span class="annottext">Coercion
</span><a href="#local-6989586621682578522"><span class="hs-identifier hs-var">co</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">TyCon
</span><a href="#local-6989586621682578576"><span class="hs-identifier hs-var">tc1</span></a></span><span> </span><span class="annot"><span class="annottext">Arity
</span><a href="#local-6989586621682578574"><span class="hs-identifier hs-var">n</span></a></span><span>
</span><span id="line-1255"></span><span>
</span><span id="line-1256"></span><span>    </span><span class="annot"><a href="#local-6989586621682578523"><span class="hs-identifier hs-var">good_call</span></a></span><span> </span><span class="annot"><span class="annottext">CoSel
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">False</span></span><span>
</span><span id="line-1257"></span><span>
</span><span id="line-1258"></span><span class="annot"><a href="GHC.Core.Coercion.html#mkSelCoResRole"><span class="hs-identifier hs-type">mkSelCoResRole</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#CoSel"><span class="hs-identifier hs-type">CoSel</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Language.Haskell.Syntax.Basic.html#Role"><span class="hs-identifier hs-type">Role</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Language.Haskell.Syntax.Basic.html#Role"><span class="hs-identifier hs-type">Role</span></a></span><span>
</span><span id="line-1259"></span><span class="hs-comment">-- What is the role of (SelCo cs co), if co has role 'r'?</span><span>
</span><span id="line-1260"></span><span class="hs-comment">-- It is not just 'r'!</span><span>
</span><span id="line-1261"></span><span class="hs-comment">-- c.f. the SelCo case of coercionRole</span><span>
</span><span id="line-1262"></span><span id="mkSelCoResRole"><span class="annot"><span class="annottext">mkSelCoResRole :: CoSel -&gt; Role -&gt; Role
</span><a href="GHC.Core.Coercion.html#mkSelCoResRole"><span class="hs-identifier hs-var hs-var">mkSelCoResRole</span></a></span></span><span> </span><span class="annot"><span class="annottext">CoSel
</span><a href="GHC.Core.TyCo.Rep.html#SelForAll"><span class="hs-identifier hs-var">SelForAll</span></a></span><span>       </span><span class="annot"><span class="annottext">Role
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Role
</span><a href="Language.Haskell.Syntax.Basic.html#Nominal"><span class="hs-identifier hs-var">Nominal</span></a></span><span>
</span><span id="line-1263"></span><span class="annot"><a href="GHC.Core.Coercion.html#mkSelCoResRole"><span class="hs-identifier hs-var">mkSelCoResRole</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#SelTyCon"><span class="hs-identifier hs-type">SelTyCon</span></a></span><span> </span><span class="annot"><span class="annottext">Arity
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621682578583"><span class="annot"><span class="annottext">Role
</span><a href="#local-6989586621682578583"><span class="hs-identifier hs-var">r'</span></a></span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Role
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Role
</span><a href="#local-6989586621682578583"><span class="hs-identifier hs-var">r'</span></a></span><span>
</span><span id="line-1264"></span><span class="annot"><a href="GHC.Core.Coercion.html#mkSelCoResRole"><span class="hs-identifier hs-var">mkSelCoResRole</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#SelFun"><span class="hs-identifier hs-type">SelFun</span></a></span><span> </span><span id="local-6989586621682578584"><span class="annot"><span class="annottext">FunSel
</span><a href="#local-6989586621682578584"><span class="hs-identifier hs-var">fs</span></a></span></span><span class="hs-special">)</span><span>     </span><span id="local-6989586621682578585"><span class="annot"><span class="annottext">Role
</span><a href="#local-6989586621682578585"><span class="hs-identifier hs-var">r</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Role -&gt; FunSel -&gt; Role
</span><a href="GHC.Core.Coercion.html#funRole"><span class="hs-identifier hs-var">funRole</span></a></span><span> </span><span class="annot"><span class="annottext">Role
</span><a href="#local-6989586621682578585"><span class="hs-identifier hs-var">r</span></a></span><span> </span><span class="annot"><span class="annottext">FunSel
</span><a href="#local-6989586621682578584"><span class="hs-identifier hs-var">fs</span></a></span><span>
</span><span id="line-1265"></span><span>
</span><span id="line-1266"></span><span class="annot"><span class="hs-comment">-- | Extract the nth field of a FunCo</span></span><span>
</span><span id="line-1267"></span><span id="local-6989586621682577314"><span class="annot"><a href="GHC.Core.Coercion.html#getNthFun"><span class="hs-identifier hs-type">getNthFun</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#FunSel"><span class="hs-identifier hs-type">FunSel</span></a></span><span>
</span><span id="line-1268"></span><span>          </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621682577314"><span class="hs-identifier hs-type">a</span></a></span><span>    </span><span class="annot"><span class="hs-comment">-- ^ multiplicity</span></span><span>
</span><span id="line-1269"></span><span>          </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621682577314"><span class="hs-identifier hs-type">a</span></a></span><span>    </span><span class="annot"><span class="hs-comment">-- ^ argument</span></span><span>
</span><span id="line-1270"></span><span>          </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621682577314"><span class="hs-identifier hs-type">a</span></a></span><span>    </span><span class="annot"><span class="hs-comment">-- ^ result</span></span><span>
</span><span id="line-1271"></span><span>          </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621682577314"><span class="hs-identifier hs-type">a</span></a></span></span><span>    </span><span class="annot"><span class="hs-comment">-- ^ One of the above three</span></span><span>
</span><span id="line-1272"></span><span id="getNthFun"><span class="annot"><span class="annottext">getNthFun :: forall a. FunSel -&gt; a -&gt; a -&gt; a -&gt; a
</span><a href="GHC.Core.Coercion.html#getNthFun"><span class="hs-identifier hs-var hs-var">getNthFun</span></a></span></span><span> </span><span class="annot"><span class="annottext">FunSel
</span><a href="GHC.Core.TyCo.Rep.html#SelMult"><span class="hs-identifier hs-var">SelMult</span></a></span><span> </span><span id="local-6989586621682578586"><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621682578586"><span class="hs-identifier hs-var">mult</span></a></span></span><span> </span><span class="annot"><span class="annottext">a
</span><span class="hs-identifier">_</span></span><span>   </span><span class="annot"><span class="annottext">a
</span><span class="hs-identifier">_</span></span><span>   </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621682578586"><span class="hs-identifier hs-var">mult</span></a></span><span>
</span><span id="line-1273"></span><span class="annot"><a href="GHC.Core.Coercion.html#getNthFun"><span class="hs-identifier hs-var">getNthFun</span></a></span><span> </span><span class="annot"><span class="annottext">FunSel
</span><a href="GHC.Core.TyCo.Rep.html#SelArg"><span class="hs-identifier hs-var">SelArg</span></a></span><span> </span><span class="annot"><span class="annottext">a
</span><span class="hs-identifier">_</span></span><span>     </span><span id="local-6989586621682578587"><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621682578587"><span class="hs-identifier hs-var">arg</span></a></span></span><span> </span><span class="annot"><span class="annottext">a
</span><span class="hs-identifier">_</span></span><span>   </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621682578587"><span class="hs-identifier hs-var">arg</span></a></span><span>
</span><span id="line-1274"></span><span class="annot"><a href="GHC.Core.Coercion.html#getNthFun"><span class="hs-identifier hs-var">getNthFun</span></a></span><span> </span><span class="annot"><span class="annottext">FunSel
</span><a href="GHC.Core.TyCo.Rep.html#SelRes"><span class="hs-identifier hs-var">SelRes</span></a></span><span> </span><span class="annot"><span class="annottext">a
</span><span class="hs-identifier">_</span></span><span>     </span><span class="annot"><span class="annottext">a
</span><span class="hs-identifier">_</span></span><span>   </span><span id="local-6989586621682578588"><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621682578588"><span class="hs-identifier hs-var">res</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621682578588"><span class="hs-identifier hs-var">res</span></a></span><span>
</span><span id="line-1275"></span><span>
</span><span id="line-1276"></span><span class="annot"><a href="GHC.Core.Coercion.html#selectFromType"><span class="hs-identifier hs-type">selectFromType</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Utils.Misc.html#HasDebugCallStack"><span class="hs-identifier hs-type">HasDebugCallStack</span></a></span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#CoSel"><span class="hs-identifier hs-type">CoSel</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#Type"><span class="hs-identifier hs-type">Type</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#Type"><span class="hs-identifier hs-type">Type</span></a></span><span>
</span><span id="line-1277"></span><span id="selectFromType"><span class="annot"><span class="annottext">selectFromType :: HasDebugCallStack =&gt; CoSel -&gt; Type -&gt; Type
</span><a href="GHC.Core.Coercion.html#selectFromType"><span class="hs-identifier hs-var hs-var">selectFromType</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#SelFun"><span class="hs-identifier hs-type">SelFun</span></a></span><span> </span><span id="local-6989586621682578601"><span class="annot"><span class="annottext">FunSel
</span><a href="#local-6989586621682578601"><span class="hs-identifier hs-var">fs</span></a></span></span><span class="hs-special">)</span><span> </span><span id="local-6989586621682578602"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682578602"><span class="hs-identifier hs-var">ty</span></a></span></span><span>
</span><span id="line-1278"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span class="hs-special">(</span><span id="local-6989586621682578603"><span class="annot"><span class="annottext">FunTyFlag
</span><a href="#local-6989586621682578603"><span class="hs-identifier hs-var">_af</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682578604"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682578604"><span class="hs-identifier hs-var">mult</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682578605"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682578605"><span class="hs-identifier hs-var">arg</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682578606"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682578606"><span class="hs-identifier hs-var">res</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Type -&gt; Maybe (FunTyFlag, Type, Type, Type)
</span><a href="GHC.Core.Type.html#splitFunTy_maybe"><span class="hs-identifier hs-var">splitFunTy_maybe</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682578602"><span class="hs-identifier hs-var">ty</span></a></span><span>
</span><span id="line-1279"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">FunSel -&gt; Type -&gt; Type -&gt; Type -&gt; Type
forall a. FunSel -&gt; a -&gt; a -&gt; a -&gt; a
</span><a href="GHC.Core.Coercion.html#getNthFun"><span class="hs-identifier hs-var">getNthFun</span></a></span><span> </span><span class="annot"><span class="annottext">FunSel
</span><a href="#local-6989586621682578601"><span class="hs-identifier hs-var">fs</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682578604"><span class="hs-identifier hs-var">mult</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682578605"><span class="hs-identifier hs-var">arg</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682578606"><span class="hs-identifier hs-var">res</span></a></span><span>
</span><span id="line-1280"></span><span>
</span><span id="line-1281"></span><span class="annot"><a href="GHC.Core.Coercion.html#selectFromType"><span class="hs-identifier hs-var">selectFromType</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#SelTyCon"><span class="hs-identifier hs-type">SelTyCon</span></a></span><span> </span><span id="local-6989586621682578607"><span class="annot"><span class="annottext">Arity
</span><a href="#local-6989586621682578607"><span class="hs-identifier hs-var">n</span></a></span></span><span> </span><span class="annot"><span class="annottext">Role
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span> </span><span id="local-6989586621682578608"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682578608"><span class="hs-identifier hs-var">ty</span></a></span></span><span>
</span><span id="line-1282"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span id="local-6989586621682578609"><span class="annot"><span class="annottext">[Type]
</span><a href="#local-6989586621682578609"><span class="hs-identifier hs-var">args</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Type -&gt; Maybe [Type]
</span><a href="GHC.Core.Type.html#tyConAppArgs_maybe"><span class="hs-identifier hs-var">tyConAppArgs_maybe</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682578608"><span class="hs-identifier hs-var">ty</span></a></span><span>
</span><span id="line-1283"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Bool -&gt; SDoc -&gt; Type -&gt; Type
forall a. HasCallStack =&gt; Bool -&gt; SDoc -&gt; a -&gt; a
</span><a href="GHC.Utils.Panic.html#assertPpr"><span class="hs-identifier hs-var">assertPpr</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[Type]
</span><a href="#local-6989586621682578609"><span class="hs-identifier hs-var">args</span></a></span><span> </span><span class="annot"><span class="annottext">[Type] -&gt; Arity -&gt; Bool
forall a. [a] -&gt; Arity -&gt; Bool
</span><a href="GHC.Utils.Misc.html#lengthExceeds"><span class="hs-operator hs-var">`lengthExceeds`</span></a></span><span> </span><span class="annot"><span class="annottext">Arity
</span><a href="#local-6989586621682578607"><span class="hs-identifier hs-var">n</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Arity -&gt; SDoc
forall a. Outputable a =&gt; a -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="annot"><span class="annottext">Arity
</span><a href="#local-6989586621682578607"><span class="hs-identifier hs-var">n</span></a></span><span> </span><span class="annot"><span class="annottext">SDoc -&gt; SDoc -&gt; SDoc
forall doc. IsDoc doc =&gt; doc -&gt; doc -&gt; doc
</span><a href="GHC.Utils.Outputable.html#%24%24"><span class="hs-operator hs-var">$$</span></a></span><span> </span><span class="annot"><span class="annottext">Type -&gt; SDoc
forall a. Outputable a =&gt; a -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682578608"><span class="hs-identifier hs-var">ty</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(Type -&gt; Type) -&gt; Type -&gt; Type
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-1284"></span><span>    </span><span class="annot"><span class="annottext">[Type]
</span><a href="#local-6989586621682578609"><span class="hs-identifier hs-var">args</span></a></span><span> </span><span class="annot"><span class="annottext">[Type] -&gt; Arity -&gt; Type
forall a. Outputable a =&gt; [a] -&gt; Arity -&gt; a
</span><a href="GHC.Data.List.SetOps.html#getNth"><span class="hs-operator hs-var">`getNth`</span></a></span><span> </span><span class="annot"><span class="annottext">Arity
</span><a href="#local-6989586621682578607"><span class="hs-identifier hs-var">n</span></a></span><span>
</span><span id="line-1285"></span><span>
</span><span id="line-1286"></span><span class="annot"><a href="GHC.Core.Coercion.html#selectFromType"><span class="hs-identifier hs-var">selectFromType</span></a></span><span> </span><span class="annot"><span class="annottext">CoSel
</span><a href="GHC.Core.TyCo.Rep.html#SelForAll"><span class="hs-identifier hs-var">SelForAll</span></a></span><span> </span><span id="local-6989586621682578611"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682578611"><span class="hs-identifier hs-var">ty</span></a></span></span><span>       </span><span class="hs-comment">-- Works for both tyvar and covar</span><span>
</span><span id="line-1287"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span class="hs-special">(</span><span id="local-6989586621682578612"><span class="annot"><span class="annottext">CoVar
</span><a href="#local-6989586621682578612"><span class="hs-identifier hs-var">tv</span></a></span></span><span class="hs-special">,</span><span class="annot"><span class="annottext">Type
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Type -&gt; Maybe (CoVar, Type)
</span><a href="GHC.Core.Type.html#splitForAllTyCoVar_maybe"><span class="hs-identifier hs-var">splitForAllTyCoVar_maybe</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682578611"><span class="hs-identifier hs-var">ty</span></a></span><span>
</span><span id="line-1288"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">CoVar -&gt; Type
</span><a href="GHC.Types.Var.html#tyVarKind"><span class="hs-identifier hs-var">tyVarKind</span></a></span><span> </span><span class="annot"><span class="annottext">CoVar
</span><a href="#local-6989586621682578612"><span class="hs-identifier hs-var">tv</span></a></span><span>
</span><span id="line-1289"></span><span>
</span><span id="line-1290"></span><span class="annot"><a href="GHC.Core.Coercion.html#selectFromType"><span class="hs-identifier hs-var">selectFromType</span></a></span><span> </span><span id="local-6989586621682578614"><span class="annot"><span class="annottext">CoSel
</span><a href="#local-6989586621682578614"><span class="hs-identifier hs-var">cs</span></a></span></span><span> </span><span id="local-6989586621682578615"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682578615"><span class="hs-identifier hs-var">ty</span></a></span></span><span>
</span><span id="line-1291"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">String -&gt; SDoc -&gt; Type
forall a. HasCallStack =&gt; String -&gt; SDoc -&gt; a
</span><a href="GHC.Utils.Panic.html#pprPanic"><span class="hs-identifier hs-var">pprPanic</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;selectFromType&quot;</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">CoSel -&gt; SDoc
forall a. Outputable a =&gt; a -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="annot"><span class="annottext">CoSel
</span><a href="#local-6989586621682578614"><span class="hs-identifier hs-var">cs</span></a></span><span> </span><span class="annot"><span class="annottext">SDoc -&gt; SDoc -&gt; SDoc
forall doc. IsDoc doc =&gt; doc -&gt; doc -&gt; doc
</span><a href="GHC.Utils.Outputable.html#%24%24"><span class="hs-operator hs-var">$$</span></a></span><span> </span><span class="annot"><span class="annottext">Type -&gt; SDoc
forall a. Outputable a =&gt; a -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682578615"><span class="hs-identifier hs-var">ty</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1292"></span><span>
</span><span id="line-1293"></span><span class="hs-comment">--------------------</span><span>
</span><span id="line-1294"></span><span class="annot"><a href="GHC.Core.Coercion.html#mkLRCo"><span class="hs-identifier hs-type">mkLRCo</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Types.Basic.html#LeftOrRight"><span class="hs-identifier hs-type">LeftOrRight</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#Coercion"><span class="hs-identifier hs-type">Coercion</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#Coercion"><span class="hs-identifier hs-type">Coercion</span></a></span><span>
</span><span id="line-1295"></span><span id="mkLRCo"><span class="annot"><span class="annottext">mkLRCo :: LeftOrRight -&gt; Coercion -&gt; Coercion
</span><a href="GHC.Core.Coercion.html#mkLRCo"><span class="hs-identifier hs-var hs-var">mkLRCo</span></a></span></span><span> </span><span id="local-6989586621682578616"><span class="annot"><span class="annottext">LeftOrRight
</span><a href="#local-6989586621682578616"><span class="hs-identifier hs-var">lr</span></a></span></span><span> </span><span id="local-6989586621682578617"><span class="annot"><span class="annottext">Coercion
</span><a href="#local-6989586621682578617"><span class="hs-identifier hs-var">co</span></a></span></span><span>
</span><span id="line-1296"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span class="hs-special">(</span><span id="local-6989586621682578618"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682578618"><span class="hs-identifier hs-var">ty</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682578619"><span class="annot"><span class="annottext">Role
</span><a href="#local-6989586621682578619"><span class="hs-identifier hs-var">eq</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Coercion -&gt; Maybe (Type, Role)
</span><a href="GHC.Core.Coercion.html#isReflCo_maybe"><span class="hs-identifier hs-var">isReflCo_maybe</span></a></span><span> </span><span class="annot"><span class="annottext">Coercion
</span><a href="#local-6989586621682578617"><span class="hs-identifier hs-var">co</span></a></span><span>
</span><span id="line-1297"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Role -&gt; Type -&gt; Coercion
</span><a href="GHC.Core.Coercion.html#mkReflCo"><span class="hs-identifier hs-var">mkReflCo</span></a></span><span> </span><span class="annot"><span class="annottext">Role
</span><a href="#local-6989586621682578619"><span class="hs-identifier hs-var">eq</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">LeftOrRight -&gt; (Type, Type) -&gt; Type
forall a. LeftOrRight -&gt; (a, a) -&gt; a
</span><a href="GHC.Types.Basic.html#pickLR"><span class="hs-identifier hs-var">pickLR</span></a></span><span> </span><span class="annot"><span class="annottext">LeftOrRight
</span><a href="#local-6989586621682578616"><span class="hs-identifier hs-var">lr</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Type -&gt; (Type, Type)
</span><a href="GHC.Core.Type.html#splitAppTy"><span class="hs-identifier hs-var">splitAppTy</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682578618"><span class="hs-identifier hs-var">ty</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-1298"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">otherwise</span></span><span>
</span><span id="line-1299"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">LeftOrRight -&gt; Coercion -&gt; Coercion
</span><a href="GHC.Core.TyCo.Rep.html#LRCo"><span class="hs-identifier hs-var">LRCo</span></a></span><span> </span><span class="annot"><span class="annottext">LeftOrRight
</span><a href="#local-6989586621682578616"><span class="hs-identifier hs-var">lr</span></a></span><span> </span><span class="annot"><span class="annottext">Coercion
</span><a href="#local-6989586621682578617"><span class="hs-identifier hs-var">co</span></a></span><span>
</span><span id="line-1300"></span><span>
</span><span id="line-1301"></span><span class="hs-comment">-- | Instantiates a 'Coercion'.</span><span>
</span><span id="line-1302"></span><span class="hs-comment">-- Works for both tyvar and covar</span><span>
</span><span id="line-1303"></span><span class="annot"><a href="GHC.Core.Coercion.html#mkInstCo"><span class="hs-identifier hs-type">mkInstCo</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#Coercion"><span class="hs-identifier hs-type">Coercion</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#CoercionN"><span class="hs-identifier hs-type">CoercionN</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#Coercion"><span class="hs-identifier hs-type">Coercion</span></a></span><span>
</span><span id="line-1304"></span><span id="mkInstCo"><span class="annot"><span class="annottext">mkInstCo :: Coercion -&gt; Coercion -&gt; Coercion
</span><a href="GHC.Core.Coercion.html#mkInstCo"><span class="hs-identifier hs-var hs-var">mkInstCo</span></a></span></span><span> </span><span id="local-6989586621682578622"><span class="annot"><span class="annottext">Coercion
</span><a href="#local-6989586621682578622"><span class="hs-identifier hs-var">co_fun</span></a></span></span><span> </span><span id="local-6989586621682578623"><span class="annot"><span class="annottext">Coercion
</span><a href="#local-6989586621682578623"><span class="hs-identifier hs-var">co_arg</span></a></span></span><span>
</span><span id="line-1305"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span class="hs-special">(</span><span id="local-6989586621682578624"><span class="annot"><span class="annottext">CoVar
</span><a href="#local-6989586621682578624"><span class="hs-identifier hs-var">tcv</span></a></span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">ForAllTyFlag
</span><span class="hs-identifier">_</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">ForAllTyFlag
</span><span class="hs-identifier">_</span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682578625"><span class="annot"><span class="annottext">Coercion
</span><a href="#local-6989586621682578625"><span class="hs-identifier hs-var">kind_co</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682578626"><span class="annot"><span class="annottext">Coercion
</span><a href="#local-6989586621682578626"><span class="hs-identifier hs-var">body_co</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Coercion
-&gt; Maybe (CoVar, ForAllTyFlag, ForAllTyFlag, Coercion, Coercion)
</span><a href="GHC.Core.Coercion.html#splitForAllCo_maybe"><span class="hs-identifier hs-var">splitForAllCo_maybe</span></a></span><span> </span><span class="annot"><span class="annottext">Coercion
</span><a href="#local-6989586621682578622"><span class="hs-identifier hs-var">co_fun</span></a></span><span>
</span><span id="line-1306"></span><span>  </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span class="hs-special">(</span><span id="local-6989586621682578627"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682578627"><span class="hs-identifier hs-var">arg</span></a></span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Role
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Coercion -&gt; Maybe (Type, Role)
</span><a href="GHC.Core.Coercion.html#isReflCo_maybe"><span class="hs-identifier hs-var">isReflCo_maybe</span></a></span><span> </span><span class="annot"><span class="annottext">Coercion
</span><a href="#local-6989586621682578623"><span class="hs-identifier hs-var">co_arg</span></a></span><span>
</span><span id="line-1307"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Bool -&gt; SDoc -&gt; Coercion -&gt; Coercion
forall a. HasCallStack =&gt; Bool -&gt; SDoc -&gt; a -&gt; a
</span><a href="GHC.Utils.Panic.html#assertPpr"><span class="hs-identifier hs-var">assertPpr</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Coercion -&gt; Bool
</span><a href="GHC.Core.Coercion.html#isReflexiveCo"><span class="hs-identifier hs-var">isReflexiveCo</span></a></span><span> </span><span class="annot"><span class="annottext">Coercion
</span><a href="#local-6989586621682578625"><span class="hs-identifier hs-var">kind_co</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Coercion -&gt; SDoc
forall a. Outputable a =&gt; a -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="annot"><span class="annottext">Coercion
</span><a href="#local-6989586621682578622"><span class="hs-identifier hs-var">co_fun</span></a></span><span> </span><span class="annot"><span class="annottext">SDoc -&gt; SDoc -&gt; SDoc
forall doc. IsDoc doc =&gt; doc -&gt; doc -&gt; doc
</span><a href="GHC.Utils.Outputable.html#%24%24"><span class="hs-operator hs-var">$$</span></a></span><span> </span><span class="annot"><span class="annottext">Coercion -&gt; SDoc
forall a. Outputable a =&gt; a -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="annot"><span class="annottext">Coercion
</span><a href="#local-6989586621682578623"><span class="hs-identifier hs-var">co_arg</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(Coercion -&gt; Coercion) -&gt; Coercion -&gt; Coercion
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-1308"></span><span>       </span><span class="hs-comment">-- If the arg is Refl, then kind_co must be reflexive too</span><span>
</span><span id="line-1309"></span><span>    </span><span class="annot"><span class="annottext">Subst -&gt; Coercion -&gt; Coercion
</span><a href="GHC.Core.TyCo.Subst.html#substCoUnchecked"><span class="hs-identifier hs-var">substCoUnchecked</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[CoVar] -&gt; [Type] -&gt; Subst
HasDebugCallStack =&gt; [CoVar] -&gt; [Type] -&gt; Subst
</span><a href="GHC.Core.TyCo.Subst.html#zipTCvSubst"><span class="hs-identifier hs-var">zipTCvSubst</span></a></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">CoVar
</span><a href="#local-6989586621682578624"><span class="hs-identifier hs-var">tcv</span></a></span><span class="hs-special">]</span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682578627"><span class="hs-identifier hs-var">arg</span></a></span><span class="hs-special">]</span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Coercion
</span><a href="#local-6989586621682578626"><span class="hs-identifier hs-var">body_co</span></a></span><span>
</span><span id="line-1310"></span><span class="annot"><a href="GHC.Core.Coercion.html#mkInstCo"><span class="hs-identifier hs-var">mkInstCo</span></a></span><span> </span><span id="local-6989586621682578630"><span class="annot"><span class="annottext">Coercion
</span><a href="#local-6989586621682578630"><span class="hs-identifier hs-var">co</span></a></span></span><span> </span><span id="local-6989586621682578631"><span class="annot"><span class="annottext">Coercion
</span><a href="#local-6989586621682578631"><span class="hs-identifier hs-var">arg</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Coercion -&gt; Coercion -&gt; Coercion
</span><a href="GHC.Core.TyCo.Rep.html#InstCo"><span class="hs-identifier hs-var">InstCo</span></a></span><span> </span><span class="annot"><span class="annottext">Coercion
</span><a href="#local-6989586621682578630"><span class="hs-identifier hs-var">co</span></a></span><span> </span><span class="annot"><span class="annottext">Coercion
</span><a href="#local-6989586621682578631"><span class="hs-identifier hs-var">arg</span></a></span><span>
</span><span id="line-1311"></span><span>
</span><span id="line-1312"></span><span class="hs-comment">-- | Given @ty :: k1@, @co :: k1 ~ k2@,</span><span>
</span><span id="line-1313"></span><span class="hs-comment">-- produces @co' :: ty ~r (ty |&gt; co)@</span><span>
</span><span id="line-1314"></span><span class="annot"><a href="GHC.Core.Coercion.html#mkGReflRightCo"><span class="hs-identifier hs-type">mkGReflRightCo</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Language.Haskell.Syntax.Basic.html#Role"><span class="hs-identifier hs-type">Role</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#Type"><span class="hs-identifier hs-type">Type</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#CoercionN"><span class="hs-identifier hs-type">CoercionN</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#Coercion"><span class="hs-identifier hs-type">Coercion</span></a></span><span>
</span><span id="line-1315"></span><span id="mkGReflRightCo"><span class="annot"><span class="annottext">mkGReflRightCo :: Role -&gt; Type -&gt; Coercion -&gt; Coercion
</span><a href="GHC.Core.Coercion.html#mkGReflRightCo"><span class="hs-identifier hs-var hs-var">mkGReflRightCo</span></a></span></span><span> </span><span id="local-6989586621682578633"><span class="annot"><span class="annottext">Role
</span><a href="#local-6989586621682578633"><span class="hs-identifier hs-var">r</span></a></span></span><span> </span><span id="local-6989586621682578634"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682578634"><span class="hs-identifier hs-var">ty</span></a></span></span><span> </span><span id="local-6989586621682578635"><span class="annot"><span class="annottext">Coercion
</span><a href="#local-6989586621682578635"><span class="hs-identifier hs-var">co</span></a></span></span><span>
</span><span id="line-1316"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Coercion -&gt; Bool
</span><a href="GHC.Core.Coercion.html#isGReflCo"><span class="hs-identifier hs-var">isGReflCo</span></a></span><span> </span><span class="annot"><span class="annottext">Coercion
</span><a href="#local-6989586621682578635"><span class="hs-identifier hs-var">co</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Role -&gt; Type -&gt; Coercion
</span><a href="GHC.Core.Coercion.html#mkReflCo"><span class="hs-identifier hs-var">mkReflCo</span></a></span><span> </span><span class="annot"><span class="annottext">Role
</span><a href="#local-6989586621682578633"><span class="hs-identifier hs-var">r</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682578634"><span class="hs-identifier hs-var">ty</span></a></span><span>
</span><span id="line-1317"></span><span>    </span><span class="hs-comment">-- the kinds of @k1@ and @k2@ are the same, thus @isGReflCo@</span><span>
</span><span id="line-1318"></span><span>    </span><span class="hs-comment">-- instead of @isReflCo@</span><span>
</span><span id="line-1319"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">otherwise</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">HasDebugCallStack =&gt; Role -&gt; Type -&gt; Coercion -&gt; Coercion
Role -&gt; Type -&gt; Coercion -&gt; Coercion
</span><a href="GHC.Core.Coercion.html#mkGReflMCo"><span class="hs-identifier hs-var">mkGReflMCo</span></a></span><span> </span><span class="annot"><span class="annottext">Role
</span><a href="#local-6989586621682578633"><span class="hs-identifier hs-var">r</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682578634"><span class="hs-identifier hs-var">ty</span></a></span><span> </span><span class="annot"><span class="annottext">Coercion
</span><a href="#local-6989586621682578635"><span class="hs-identifier hs-var">co</span></a></span><span>
</span><span id="line-1320"></span><span>
</span><span id="line-1321"></span><span class="hs-comment">-- | Given @r@, @ty :: k1@, and @co :: k1 ~N k2@,</span><span>
</span><span id="line-1322"></span><span class="hs-comment">-- produces @co' :: (ty |&gt; co) ~r ty@</span><span>
</span><span id="line-1323"></span><span class="annot"><a href="GHC.Core.Coercion.html#mkGReflLeftCo"><span class="hs-identifier hs-type">mkGReflLeftCo</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Language.Haskell.Syntax.Basic.html#Role"><span class="hs-identifier hs-type">Role</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#Type"><span class="hs-identifier hs-type">Type</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#CoercionN"><span class="hs-identifier hs-type">CoercionN</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#Coercion"><span class="hs-identifier hs-type">Coercion</span></a></span><span>
</span><span id="line-1324"></span><span id="mkGReflLeftCo"><span class="annot"><span class="annottext">mkGReflLeftCo :: Role -&gt; Type -&gt; Coercion -&gt; Coercion
</span><a href="GHC.Core.Coercion.html#mkGReflLeftCo"><span class="hs-identifier hs-var hs-var">mkGReflLeftCo</span></a></span></span><span> </span><span id="local-6989586621682578636"><span class="annot"><span class="annottext">Role
</span><a href="#local-6989586621682578636"><span class="hs-identifier hs-var">r</span></a></span></span><span> </span><span id="local-6989586621682578637"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682578637"><span class="hs-identifier hs-var">ty</span></a></span></span><span> </span><span id="local-6989586621682578638"><span class="annot"><span class="annottext">Coercion
</span><a href="#local-6989586621682578638"><span class="hs-identifier hs-var">co</span></a></span></span><span>
</span><span id="line-1325"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Coercion -&gt; Bool
</span><a href="GHC.Core.Coercion.html#isGReflCo"><span class="hs-identifier hs-var">isGReflCo</span></a></span><span> </span><span class="annot"><span class="annottext">Coercion
</span><a href="#local-6989586621682578638"><span class="hs-identifier hs-var">co</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Role -&gt; Type -&gt; Coercion
</span><a href="GHC.Core.Coercion.html#mkReflCo"><span class="hs-identifier hs-var">mkReflCo</span></a></span><span> </span><span class="annot"><span class="annottext">Role
</span><a href="#local-6989586621682578636"><span class="hs-identifier hs-var">r</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682578637"><span class="hs-identifier hs-var">ty</span></a></span><span>
</span><span id="line-1326"></span><span>    </span><span class="hs-comment">-- the kinds of @k1@ and @k2@ are the same, thus @isGReflCo@</span><span>
</span><span id="line-1327"></span><span>    </span><span class="hs-comment">-- instead of @isReflCo@</span><span>
</span><span id="line-1328"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">otherwise</span></span><span>    </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Coercion -&gt; Coercion
</span><a href="GHC.Core.Coercion.html#mkSymCo"><span class="hs-identifier hs-var">mkSymCo</span></a></span><span> </span><span class="annot"><span class="annottext">(Coercion -&gt; Coercion) -&gt; Coercion -&gt; Coercion
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">HasDebugCallStack =&gt; Role -&gt; Type -&gt; Coercion -&gt; Coercion
Role -&gt; Type -&gt; Coercion -&gt; Coercion
</span><a href="GHC.Core.Coercion.html#mkGReflMCo"><span class="hs-identifier hs-var">mkGReflMCo</span></a></span><span> </span><span class="annot"><span class="annottext">Role
</span><a href="#local-6989586621682578636"><span class="hs-identifier hs-var">r</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682578637"><span class="hs-identifier hs-var">ty</span></a></span><span> </span><span class="annot"><span class="annottext">Coercion
</span><a href="#local-6989586621682578638"><span class="hs-identifier hs-var">co</span></a></span><span>
</span><span id="line-1329"></span><span>
</span><span id="line-1330"></span><span class="hs-comment">-- | Given @ty :: k1@, @co :: k1 ~ k2@, @co2:: ty ~r ty'@,</span><span>
</span><span id="line-1331"></span><span class="hs-comment">-- produces @co' :: (ty |&gt; co) ~r ty'</span><span>
</span><span id="line-1332"></span><span class="hs-comment">-- It is not only a utility function, but it saves allocation when co</span><span>
</span><span id="line-1333"></span><span class="hs-comment">-- is a GRefl coercion.</span><span>
</span><span id="line-1334"></span><span class="annot"><a href="GHC.Core.Coercion.html#mkCoherenceLeftCo"><span class="hs-identifier hs-type">mkCoherenceLeftCo</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Language.Haskell.Syntax.Basic.html#Role"><span class="hs-identifier hs-type">Role</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#Type"><span class="hs-identifier hs-type">Type</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#CoercionN"><span class="hs-identifier hs-type">CoercionN</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#Coercion"><span class="hs-identifier hs-type">Coercion</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#Coercion"><span class="hs-identifier hs-type">Coercion</span></a></span><span>
</span><span id="line-1335"></span><span id="mkCoherenceLeftCo"><span class="annot"><span class="annottext">mkCoherenceLeftCo :: Role -&gt; Type -&gt; Coercion -&gt; Coercion -&gt; Coercion
</span><a href="GHC.Core.Coercion.html#mkCoherenceLeftCo"><span class="hs-identifier hs-var hs-var">mkCoherenceLeftCo</span></a></span></span><span> </span><span id="local-6989586621682578639"><span class="annot"><span class="annottext">Role
</span><a href="#local-6989586621682578639"><span class="hs-identifier hs-var">r</span></a></span></span><span> </span><span id="local-6989586621682578640"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682578640"><span class="hs-identifier hs-var">ty</span></a></span></span><span> </span><span id="local-6989586621682578641"><span class="annot"><span class="annottext">Coercion
</span><a href="#local-6989586621682578641"><span class="hs-identifier hs-var">co</span></a></span></span><span> </span><span id="local-6989586621682578642"><span class="annot"><span class="annottext">Coercion
</span><a href="#local-6989586621682578642"><span class="hs-identifier hs-var">co2</span></a></span></span><span>
</span><span id="line-1336"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Coercion -&gt; Bool
</span><a href="GHC.Core.Coercion.html#isGReflCo"><span class="hs-identifier hs-var">isGReflCo</span></a></span><span> </span><span class="annot"><span class="annottext">Coercion
</span><a href="#local-6989586621682578641"><span class="hs-identifier hs-var">co</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Coercion
</span><a href="#local-6989586621682578642"><span class="hs-identifier hs-var">co2</span></a></span><span>
</span><span id="line-1337"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">otherwise</span></span><span>    </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Coercion -&gt; Coercion
</span><a href="GHC.Core.Coercion.html#mkSymCo"><span class="hs-identifier hs-var">mkSymCo</span></a></span><span> </span><span class="annot"><span class="annottext">(Coercion -&gt; Coercion) -&gt; Coercion -&gt; Coercion
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">HasDebugCallStack =&gt; Role -&gt; Type -&gt; Coercion -&gt; Coercion
Role -&gt; Type -&gt; Coercion -&gt; Coercion
</span><a href="GHC.Core.Coercion.html#mkGReflMCo"><span class="hs-identifier hs-var">mkGReflMCo</span></a></span><span> </span><span class="annot"><span class="annottext">Role
</span><a href="#local-6989586621682578639"><span class="hs-identifier hs-var">r</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682578640"><span class="hs-identifier hs-var">ty</span></a></span><span> </span><span class="annot"><span class="annottext">Coercion
</span><a href="#local-6989586621682578641"><span class="hs-identifier hs-var">co</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">HasDebugCallStack =&gt; Coercion -&gt; Coercion -&gt; Coercion
Coercion -&gt; Coercion -&gt; Coercion
</span><a href="GHC.Core.Coercion.html#mkTransCo"><span class="hs-operator hs-var">`mkTransCo`</span></a></span><span> </span><span class="annot"><span class="annottext">Coercion
</span><a href="#local-6989586621682578642"><span class="hs-identifier hs-var">co2</span></a></span><span>
</span><span id="line-1338"></span><span>
</span><span id="line-1339"></span><span class="hs-comment">-- | Given @ty :: k1@, @co :: k1 ~ k2@, @co2:: ty' ~r ty@,</span><span>
</span><span id="line-1340"></span><span class="hs-comment">-- produces @co' :: ty' ~r (ty |&gt; co)</span><span>
</span><span id="line-1341"></span><span class="hs-comment">-- It is not only a utility function, but it saves allocation when co</span><span>
</span><span id="line-1342"></span><span class="hs-comment">-- is a GRefl coercion.</span><span>
</span><span id="line-1343"></span><span class="annot"><a href="GHC.Core.Coercion.html#mkCoherenceRightCo"><span class="hs-identifier hs-type">mkCoherenceRightCo</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Utils.Misc.html#HasDebugCallStack"><span class="hs-identifier hs-type">HasDebugCallStack</span></a></span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="Language.Haskell.Syntax.Basic.html#Role"><span class="hs-identifier hs-type">Role</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#Type"><span class="hs-identifier hs-type">Type</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#CoercionN"><span class="hs-identifier hs-type">CoercionN</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#Coercion"><span class="hs-identifier hs-type">Coercion</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#Coercion"><span class="hs-identifier hs-type">Coercion</span></a></span><span>
</span><span id="line-1344"></span><span id="mkCoherenceRightCo"><span class="annot"><span class="annottext">mkCoherenceRightCo :: HasDebugCallStack =&gt;
Role -&gt; Type -&gt; Coercion -&gt; Coercion -&gt; Coercion
</span><a href="GHC.Core.Coercion.html#mkCoherenceRightCo"><span class="hs-identifier hs-var hs-var">mkCoherenceRightCo</span></a></span></span><span> </span><span id="local-6989586621682578646"><span class="annot"><span class="annottext">Role
</span><a href="#local-6989586621682578646"><span class="hs-identifier hs-var">r</span></a></span></span><span> </span><span id="local-6989586621682578647"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682578647"><span class="hs-identifier hs-var">ty</span></a></span></span><span> </span><span id="local-6989586621682578648"><span class="annot"><span class="annottext">Coercion
</span><a href="#local-6989586621682578648"><span class="hs-identifier hs-var">co</span></a></span></span><span> </span><span id="local-6989586621682578649"><span class="annot"><span class="annottext">Coercion
</span><a href="#local-6989586621682578649"><span class="hs-identifier hs-var">co2</span></a></span></span><span>
</span><span id="line-1345"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Coercion -&gt; Bool
</span><a href="GHC.Core.Coercion.html#isGReflCo"><span class="hs-identifier hs-var">isGReflCo</span></a></span><span> </span><span class="annot"><span class="annottext">Coercion
</span><a href="#local-6989586621682578648"><span class="hs-identifier hs-var">co</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Coercion
</span><a href="#local-6989586621682578649"><span class="hs-identifier hs-var">co2</span></a></span><span>
</span><span id="line-1346"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">otherwise</span></span><span>    </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Coercion
</span><a href="#local-6989586621682578649"><span class="hs-identifier hs-var">co2</span></a></span><span> </span><span class="annot"><span class="annottext">HasDebugCallStack =&gt; Coercion -&gt; Coercion -&gt; Coercion
Coercion -&gt; Coercion -&gt; Coercion
</span><a href="GHC.Core.Coercion.html#mkTransCo"><span class="hs-operator hs-var">`mkTransCo`</span></a></span><span> </span><span class="annot"><span class="annottext">HasDebugCallStack =&gt; Role -&gt; Type -&gt; Coercion -&gt; Coercion
Role -&gt; Type -&gt; Coercion -&gt; Coercion
</span><a href="GHC.Core.Coercion.html#mkGReflMCo"><span class="hs-identifier hs-var">mkGReflMCo</span></a></span><span> </span><span class="annot"><span class="annottext">Role
</span><a href="#local-6989586621682578646"><span class="hs-identifier hs-var">r</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682578647"><span class="hs-identifier hs-var">ty</span></a></span><span> </span><span class="annot"><span class="annottext">Coercion
</span><a href="#local-6989586621682578648"><span class="hs-identifier hs-var">co</span></a></span><span>
</span><span id="line-1347"></span><span>
</span><span id="line-1348"></span><span class="annot"><span class="hs-comment">-- | Given @co :: (a :: k) ~ (b :: k')@ produce @co' :: k ~ k'@.</span></span><span>
</span><span id="line-1349"></span><span class="annot"><a href="GHC.Core.Coercion.html#mkKindCo"><span class="hs-identifier hs-type">mkKindCo</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#Coercion"><span class="hs-identifier hs-type">Coercion</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#Coercion"><span class="hs-identifier hs-type">Coercion</span></a></span><span>
</span><span id="line-1350"></span><span id="mkKindCo"><span class="annot"><span class="annottext">mkKindCo :: Coercion -&gt; Coercion
</span><a href="GHC.Core.Coercion.html#mkKindCo"><span class="hs-identifier hs-var hs-var">mkKindCo</span></a></span></span><span> </span><span id="local-6989586621682578650"><span class="annot"><span class="annottext">Coercion
</span><a href="#local-6989586621682578650"><span class="hs-identifier hs-var">co</span></a></span></span><span> </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span class="hs-special">(</span><span id="local-6989586621682578651"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682578651"><span class="hs-identifier hs-var">ty</span></a></span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Role
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Coercion -&gt; Maybe (Type, Role)
</span><a href="GHC.Core.Coercion.html#isReflCo_maybe"><span class="hs-identifier hs-var">isReflCo_maybe</span></a></span><span> </span><span class="annot"><span class="annottext">Coercion
</span><a href="#local-6989586621682578650"><span class="hs-identifier hs-var">co</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Type -&gt; Coercion
</span><a href="GHC.Core.TyCo.Rep.html#Refl"><span class="hs-identifier hs-var">Refl</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">HasDebugCallStack =&gt; Type -&gt; Type
Type -&gt; Type
</span><a href="GHC.Core.Type.html#typeKind"><span class="hs-identifier hs-var">typeKind</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682578651"><span class="hs-identifier hs-var">ty</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1351"></span><span class="annot"><a href="GHC.Core.Coercion.html#mkKindCo"><span class="hs-identifier hs-var">mkKindCo</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#GRefl"><span class="hs-identifier hs-type">GRefl</span></a></span><span> </span><span class="annot"><span class="annottext">Role
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">Type
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#MCo"><span class="hs-identifier hs-type">MCo</span></a></span><span> </span><span id="local-6989586621682578653"><span class="annot"><span class="annottext">Coercion
</span><a href="#local-6989586621682578653"><span class="hs-identifier hs-var">co</span></a></span></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Coercion
</span><a href="#local-6989586621682578653"><span class="hs-identifier hs-var">co</span></a></span><span>
</span><span id="line-1352"></span><span class="annot"><a href="GHC.Core.Coercion.html#mkKindCo"><span class="hs-identifier hs-var">mkKindCo</span></a></span><span> </span><span id="local-6989586621682578654"><span class="annot"><span class="annottext">Coercion
</span><a href="#local-6989586621682578654"><span class="hs-identifier hs-var">co</span></a></span></span><span>
</span><span id="line-1353"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span class="annot"><a href="GHC.Data.Pair.html#Pair"><span class="hs-identifier hs-type">Pair</span></a></span><span> </span><span id="local-6989586621682578655"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682578655"><span class="hs-identifier hs-var">ty1</span></a></span></span><span> </span><span id="local-6989586621682578656"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682578656"><span class="hs-identifier hs-var">ty2</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">HasDebugCallStack =&gt; Coercion -&gt; Pair Type
Coercion -&gt; Pair Type
</span><a href="GHC.Core.Coercion.html#coercionKind"><span class="hs-identifier hs-var">coercionKind</span></a></span><span> </span><span class="annot"><span class="annottext">Coercion
</span><a href="#local-6989586621682578654"><span class="hs-identifier hs-var">co</span></a></span><span>
</span><span id="line-1354"></span><span>       </span><span class="hs-comment">-- Generally, calling coercionKind during coercion creation is a bad idea,</span><span>
</span><span id="line-1355"></span><span>       </span><span class="hs-comment">-- as it can lead to exponential behavior. But, we don't have nested mkKindCos,</span><span>
</span><span id="line-1356"></span><span>       </span><span class="hs-comment">-- so it's OK here.</span><span>
</span><span id="line-1357"></span><span>  </span><span class="hs-special">,</span><span> </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621682578657"><span class="annot"><span class="annottext">tk1 :: Type
</span><a href="#local-6989586621682578657"><span class="hs-identifier hs-var hs-var">tk1</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">HasDebugCallStack =&gt; Type -&gt; Type
Type -&gt; Type
</span><a href="GHC.Core.Type.html#typeKind"><span class="hs-identifier hs-var">typeKind</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682578655"><span class="hs-identifier hs-var">ty1</span></a></span><span>
</span><span id="line-1358"></span><span>        </span><span id="local-6989586621682578658"><span class="annot"><span class="annottext">tk2 :: Type
</span><a href="#local-6989586621682578658"><span class="hs-identifier hs-var hs-var">tk2</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">HasDebugCallStack =&gt; Type -&gt; Type
Type -&gt; Type
</span><a href="GHC.Core.Type.html#typeKind"><span class="hs-identifier hs-var">typeKind</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682578656"><span class="hs-identifier hs-var">ty2</span></a></span><span>
</span><span id="line-1359"></span><span>  </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682578657"><span class="hs-identifier hs-var">tk1</span></a></span><span> </span><span class="annot"><span class="annottext">HasCallStack =&gt; Type -&gt; Type -&gt; Bool
Type -&gt; Type -&gt; Bool
</span><a href="GHC.Core.TyCo.Compare.html#eqType"><span class="hs-operator hs-var">`eqType`</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682578658"><span class="hs-identifier hs-var">tk2</span></a></span><span>
</span><span id="line-1360"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Type -&gt; Coercion
</span><a href="GHC.Core.TyCo.Rep.html#Refl"><span class="hs-identifier hs-var">Refl</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682578657"><span class="hs-identifier hs-var">tk1</span></a></span><span>
</span><span id="line-1361"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">otherwise</span></span><span>
</span><span id="line-1362"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Coercion -&gt; Coercion
</span><a href="GHC.Core.TyCo.Rep.html#KindCo"><span class="hs-identifier hs-var">KindCo</span></a></span><span> </span><span class="annot"><span class="annottext">Coercion
</span><a href="#local-6989586621682578654"><span class="hs-identifier hs-var">co</span></a></span><span>
</span><span id="line-1363"></span><span>
</span><span id="line-1364"></span><span class="annot"><a href="GHC.Core.Coercion.html#mkSubCo"><span class="hs-identifier hs-type">mkSubCo</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Utils.Misc.html#HasDebugCallStack"><span class="hs-identifier hs-type">HasDebugCallStack</span></a></span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#Coercion"><span class="hs-identifier hs-type">Coercion</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#Coercion"><span class="hs-identifier hs-type">Coercion</span></a></span><span>
</span><span id="line-1365"></span><span class="hs-comment">-- Input coercion is Nominal, result is Representational</span><span>
</span><span id="line-1366"></span><span class="hs-comment">-- see also Note [Role twiddling functions]</span><span>
</span><span id="line-1367"></span><span id="mkSubCo"><span class="annot"><span class="annottext">mkSubCo :: HasDebugCallStack =&gt; Coercion -&gt; Coercion
</span><a href="GHC.Core.Coercion.html#mkSubCo"><span class="hs-identifier hs-var hs-var">mkSubCo</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#Refl"><span class="hs-identifier hs-type">Refl</span></a></span><span> </span><span id="local-6989586621682578667"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682578667"><span class="hs-identifier hs-var">ty</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Role -&gt; Type -&gt; MCoercion -&gt; Coercion
</span><a href="GHC.Core.TyCo.Rep.html#GRefl"><span class="hs-identifier hs-var">GRefl</span></a></span><span> </span><span class="annot"><span class="annottext">Role
</span><a href="Language.Haskell.Syntax.Basic.html#Representational"><span class="hs-identifier hs-var">Representational</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682578667"><span class="hs-identifier hs-var">ty</span></a></span><span> </span><span class="annot"><span class="annottext">MCoercion
</span><a href="GHC.Core.TyCo.Rep.html#MRefl"><span class="hs-identifier hs-var">MRefl</span></a></span><span>
</span><span id="line-1368"></span><span class="annot"><a href="GHC.Core.Coercion.html#mkSubCo"><span class="hs-identifier hs-var">mkSubCo</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#GRefl"><span class="hs-identifier hs-type">GRefl</span></a></span><span> </span><span class="annot"><span class="annottext">Role
</span><a href="Language.Haskell.Syntax.Basic.html#Nominal"><span class="hs-identifier hs-var">Nominal</span></a></span><span> </span><span id="local-6989586621682578668"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682578668"><span class="hs-identifier hs-var">ty</span></a></span></span><span> </span><span id="local-6989586621682578669"><span class="annot"><span class="annottext">MCoercion
</span><a href="#local-6989586621682578669"><span class="hs-identifier hs-var">co</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Role -&gt; Type -&gt; MCoercion -&gt; Coercion
</span><a href="GHC.Core.TyCo.Rep.html#GRefl"><span class="hs-identifier hs-var">GRefl</span></a></span><span> </span><span class="annot"><span class="annottext">Role
</span><a href="Language.Haskell.Syntax.Basic.html#Representational"><span class="hs-identifier hs-var">Representational</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682578668"><span class="hs-identifier hs-var">ty</span></a></span><span> </span><span class="annot"><span class="annottext">MCoercion
</span><a href="#local-6989586621682578669"><span class="hs-identifier hs-var">co</span></a></span><span>
</span><span id="line-1369"></span><span class="annot"><a href="GHC.Core.Coercion.html#mkSubCo"><span class="hs-identifier hs-var">mkSubCo</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#TyConAppCo"><span class="hs-identifier hs-type">TyConAppCo</span></a></span><span> </span><span class="annot"><span class="annottext">Role
</span><a href="Language.Haskell.Syntax.Basic.html#Nominal"><span class="hs-identifier hs-var">Nominal</span></a></span><span> </span><span id="local-6989586621682578670"><span class="annot"><span class="annottext">TyCon
</span><a href="#local-6989586621682578670"><span class="hs-identifier hs-var">tc</span></a></span></span><span> </span><span id="local-6989586621682578671"><span class="annot"><span class="annottext">[Coercion]
</span><a href="#local-6989586621682578671"><span class="hs-identifier hs-var">cos</span></a></span></span><span class="hs-special">)</span><span>
</span><span id="line-1370"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Role -&gt; TyCon -&gt; [Coercion] -&gt; Coercion
</span><a href="GHC.Core.TyCo.Rep.html#TyConAppCo"><span class="hs-identifier hs-var">TyConAppCo</span></a></span><span> </span><span class="annot"><span class="annottext">Role
</span><a href="Language.Haskell.Syntax.Basic.html#Representational"><span class="hs-identifier hs-var">Representational</span></a></span><span> </span><span class="annot"><span class="annottext">TyCon
</span><a href="#local-6989586621682578670"><span class="hs-identifier hs-var">tc</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TyCon -&gt; [Coercion] -&gt; [Coercion]
</span><a href="GHC.Core.Coercion.html#applyRoles"><span class="hs-identifier hs-var">applyRoles</span></a></span><span> </span><span class="annot"><span class="annottext">TyCon
</span><a href="#local-6989586621682578670"><span class="hs-identifier hs-var">tc</span></a></span><span> </span><span class="annot"><span class="annottext">[Coercion]
</span><a href="#local-6989586621682578671"><span class="hs-identifier hs-var">cos</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1371"></span><span class="annot"><a href="GHC.Core.Coercion.html#mkSubCo"><span class="hs-identifier hs-var">mkSubCo</span></a></span><span> </span><span id="local-6989586621682578673"><span class="annot"><span class="annottext">co :: Coercion
</span><a href="#local-6989586621682578673"><span class="hs-identifier hs-var">co</span></a></span></span><span class="hs-glyph">@</span><span class="hs-special">(</span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#FunCo"><span class="hs-identifier hs-type">FunCo</span></a></span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">fco_role :: Coercion -&gt; Role
</span><a href="GHC.Core.TyCo.Rep.html#fco_role"><span class="hs-identifier hs-var">fco_role</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Role
</span><a href="Language.Haskell.Syntax.Basic.html#Nominal"><span class="hs-identifier hs-var">Nominal</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">fco_arg :: Coercion -&gt; Coercion
</span><a href="GHC.Core.TyCo.Rep.html#fco_arg"><span class="hs-identifier hs-var">fco_arg</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="local-6989586621682578674"><span class="annot"><span class="annottext">Coercion
</span><a href="#local-6989586621682578674"><span class="hs-identifier hs-var">arg</span></a></span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">fco_res :: Coercion -&gt; Coercion
</span><a href="GHC.Core.TyCo.Rep.html#fco_res"><span class="hs-identifier hs-var">fco_res</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="local-6989586621682578675"><span class="annot"><span class="annottext">Coercion
</span><a href="#local-6989586621682578675"><span class="hs-identifier hs-var">res</span></a></span></span><span> </span><span class="hs-special">}</span><span class="hs-special">)</span><span>
</span><span id="line-1372"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Coercion
</span><a href="#local-6989586621682578673"><span class="hs-identifier hs-var">co</span></a></span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#fco_role"><span class="hs-identifier hs-var">fco_role</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="Language.Haskell.Syntax.Basic.html#Representational"><span class="hs-identifier hs-type">Representational</span></a></span><span>
</span><span id="line-1373"></span><span>       </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#fco_arg"><span class="hs-identifier hs-var">fco_arg</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="GHC.Core.Coercion.html#downgradeRole"><span class="hs-identifier hs-type">downgradeRole</span></a></span><span> </span><span class="annot"><a href="Language.Haskell.Syntax.Basic.html#Representational"><span class="hs-identifier hs-type">Representational</span></a></span><span> </span><span class="annot"><a href="Language.Haskell.Syntax.Basic.html#Nominal"><span class="hs-identifier hs-type">Nominal</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682578674"><span class="hs-identifier hs-type">arg</span></a></span><span>
</span><span id="line-1374"></span><span>       </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#fco_res"><span class="hs-identifier hs-var">fco_res</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="GHC.Core.Coercion.html#downgradeRole"><span class="hs-identifier hs-type">downgradeRole</span></a></span><span> </span><span class="annot"><a href="Language.Haskell.Syntax.Basic.html#Representational"><span class="hs-identifier hs-type">Representational</span></a></span><span> </span><span class="annot"><a href="Language.Haskell.Syntax.Basic.html#Nominal"><span class="hs-identifier hs-type">Nominal</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682578675"><span class="hs-identifier hs-type">res</span></a></span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-1375"></span><span class="annot"><a href="GHC.Core.Coercion.html#mkSubCo"><span class="hs-identifier hs-var">mkSubCo</span></a></span><span> </span><span id="local-6989586621682578676"><span class="annot"><span class="annottext">Coercion
</span><a href="#local-6989586621682578676"><span class="hs-identifier hs-var">co</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Bool -&gt; SDoc -&gt; Coercion -&gt; Coercion
forall a. HasCallStack =&gt; Bool -&gt; SDoc -&gt; a -&gt; a
</span><a href="GHC.Utils.Panic.html#assertPpr"><span class="hs-identifier hs-var">assertPpr</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Coercion -&gt; Role
</span><a href="GHC.Core.Coercion.html#coercionRole"><span class="hs-identifier hs-var">coercionRole</span></a></span><span> </span><span class="annot"><span class="annottext">Coercion
</span><a href="#local-6989586621682578676"><span class="hs-identifier hs-var">co</span></a></span><span> </span><span class="annot"><span class="annottext">Role -&gt; Role -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">==</span></span><span> </span><span class="annot"><span class="annottext">Role
</span><a href="Language.Haskell.Syntax.Basic.html#Nominal"><span class="hs-identifier hs-var">Nominal</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Coercion -&gt; SDoc
forall a. Outputable a =&gt; a -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="annot"><span class="annottext">Coercion
</span><a href="#local-6989586621682578676"><span class="hs-identifier hs-var">co</span></a></span><span> </span><span class="annot"><span class="annottext">SDoc -&gt; SDoc -&gt; SDoc
forall doc. IsLine doc =&gt; doc -&gt; doc -&gt; doc
</span><a href="GHC.Utils.Outputable.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">Role -&gt; SDoc
forall a. Outputable a =&gt; a -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Coercion -&gt; Role
</span><a href="GHC.Core.Coercion.html#coercionRole"><span class="hs-identifier hs-var">coercionRole</span></a></span><span> </span><span class="annot"><span class="annottext">Coercion
</span><a href="#local-6989586621682578676"><span class="hs-identifier hs-var">co</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(Coercion -&gt; Coercion) -&gt; Coercion -&gt; Coercion
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-1376"></span><span>             </span><span class="annot"><span class="annottext">Coercion -&gt; Coercion
</span><a href="GHC.Core.TyCo.Rep.html#SubCo"><span class="hs-identifier hs-var">SubCo</span></a></span><span> </span><span class="annot"><span class="annottext">Coercion
</span><a href="#local-6989586621682578676"><span class="hs-identifier hs-var">co</span></a></span><span>
</span><span id="line-1377"></span><span>
</span><span id="line-1378"></span><span class="annot"><span class="hs-comment">-- | Changes a role, but only a downgrade. See Note [Role twiddling functions]</span></span><span>
</span><span id="line-1379"></span><span class="annot"><a href="GHC.Core.Coercion.html#downgradeRole_maybe"><span class="hs-identifier hs-type">downgradeRole_maybe</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Language.Haskell.Syntax.Basic.html#Role"><span class="hs-identifier hs-type">Role</span></a></span><span>   </span><span class="annot"><span class="hs-comment">-- ^ desired role</span></span><span>
</span><span id="line-1380"></span><span>                    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Language.Haskell.Syntax.Basic.html#Role"><span class="hs-identifier hs-type">Role</span></a></span><span>   </span><span class="annot"><span class="hs-comment">-- ^ current role</span></span><span>
</span><span id="line-1381"></span><span>                    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#Coercion"><span class="hs-identifier hs-type">Coercion</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Maybe</span></span><span> </span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#Coercion"><span class="hs-identifier hs-type">Coercion</span></a></span><span>
</span><span id="line-1382"></span><span class="hs-comment">-- In (downgradeRole_maybe dr cr co) it's a precondition that</span><span>
</span><span id="line-1383"></span><span class="hs-comment">--                                   cr = coercionRole co</span><span>
</span><span id="line-1384"></span><span>
</span><span id="line-1385"></span><span id="downgradeRole_maybe"><span class="annot"><span class="annottext">downgradeRole_maybe :: Role -&gt; Role -&gt; Coercion -&gt; Maybe Coercion
</span><a href="GHC.Core.Coercion.html#downgradeRole_maybe"><span class="hs-identifier hs-var hs-var">downgradeRole_maybe</span></a></span></span><span> </span><span class="annot"><span class="annottext">Role
</span><a href="Language.Haskell.Syntax.Basic.html#Nominal"><span class="hs-identifier hs-var">Nominal</span></a></span><span>          </span><span class="annot"><span class="annottext">Role
</span><a href="Language.Haskell.Syntax.Basic.html#Nominal"><span class="hs-identifier hs-var">Nominal</span></a></span><span>          </span><span id="local-6989586621682578678"><span class="annot"><span class="annottext">Coercion
</span><a href="#local-6989586621682578678"><span class="hs-identifier hs-var">co</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Coercion -&gt; Maybe Coercion
forall a. a -&gt; Maybe a
</span><span class="hs-identifier hs-var">Just</span></span><span> </span><span class="annot"><span class="annottext">Coercion
</span><a href="#local-6989586621682578678"><span class="hs-identifier hs-var">co</span></a></span><span>
</span><span id="line-1386"></span><span class="annot"><a href="GHC.Core.Coercion.html#downgradeRole_maybe"><span class="hs-identifier hs-var">downgradeRole_maybe</span></a></span><span> </span><span class="annot"><span class="annottext">Role
</span><a href="Language.Haskell.Syntax.Basic.html#Nominal"><span class="hs-identifier hs-var">Nominal</span></a></span><span>          </span><span class="annot"><span class="annottext">Role
</span><span class="hs-identifier">_</span></span><span>                </span><span class="annot"><span class="annottext">Coercion
</span><span class="hs-identifier">_</span></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Maybe Coercion
forall a. Maybe a
</span><span class="hs-identifier hs-var">Nothing</span></span><span>
</span><span id="line-1387"></span><span>
</span><span id="line-1388"></span><span class="annot"><a href="GHC.Core.Coercion.html#downgradeRole_maybe"><span class="hs-identifier hs-var">downgradeRole_maybe</span></a></span><span> </span><span class="annot"><span class="annottext">Role
</span><a href="Language.Haskell.Syntax.Basic.html#Representational"><span class="hs-identifier hs-var">Representational</span></a></span><span> </span><span class="annot"><span class="annottext">Role
</span><a href="Language.Haskell.Syntax.Basic.html#Nominal"><span class="hs-identifier hs-var">Nominal</span></a></span><span>          </span><span id="local-6989586621682578679"><span class="annot"><span class="annottext">Coercion
</span><a href="#local-6989586621682578679"><span class="hs-identifier hs-var">co</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Coercion -&gt; Maybe Coercion
forall a. a -&gt; Maybe a
</span><span class="hs-identifier hs-var">Just</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">HasDebugCallStack =&gt; Coercion -&gt; Coercion
Coercion -&gt; Coercion
</span><a href="GHC.Core.Coercion.html#mkSubCo"><span class="hs-identifier hs-var">mkSubCo</span></a></span><span> </span><span class="annot"><span class="annottext">Coercion
</span><a href="#local-6989586621682578679"><span class="hs-identifier hs-var">co</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1389"></span><span class="annot"><a href="GHC.Core.Coercion.html#downgradeRole_maybe"><span class="hs-identifier hs-var">downgradeRole_maybe</span></a></span><span> </span><span class="annot"><span class="annottext">Role
</span><a href="Language.Haskell.Syntax.Basic.html#Representational"><span class="hs-identifier hs-var">Representational</span></a></span><span> </span><span class="annot"><span class="annottext">Role
</span><a href="Language.Haskell.Syntax.Basic.html#Representational"><span class="hs-identifier hs-var">Representational</span></a></span><span> </span><span id="local-6989586621682578680"><span class="annot"><span class="annottext">Coercion
</span><a href="#local-6989586621682578680"><span class="hs-identifier hs-var">co</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Coercion -&gt; Maybe Coercion
forall a. a -&gt; Maybe a
</span><span class="hs-identifier hs-var">Just</span></span><span> </span><span class="annot"><span class="annottext">Coercion
</span><a href="#local-6989586621682578680"><span class="hs-identifier hs-var">co</span></a></span><span>
</span><span id="line-1390"></span><span class="annot"><a href="GHC.Core.Coercion.html#downgradeRole_maybe"><span class="hs-identifier hs-var">downgradeRole_maybe</span></a></span><span> </span><span class="annot"><span class="annottext">Role
</span><a href="Language.Haskell.Syntax.Basic.html#Representational"><span class="hs-identifier hs-var">Representational</span></a></span><span> </span><span class="annot"><span class="annottext">Role
</span><a href="Language.Haskell.Syntax.Basic.html#Phantom"><span class="hs-identifier hs-var">Phantom</span></a></span><span>          </span><span class="annot"><span class="annottext">Coercion
</span><span class="hs-identifier">_</span></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Maybe Coercion
forall a. Maybe a
</span><span class="hs-identifier hs-var">Nothing</span></span><span>
</span><span id="line-1391"></span><span>
</span><span id="line-1392"></span><span class="annot"><a href="GHC.Core.Coercion.html#downgradeRole_maybe"><span class="hs-identifier hs-var">downgradeRole_maybe</span></a></span><span> </span><span class="annot"><span class="annottext">Role
</span><a href="Language.Haskell.Syntax.Basic.html#Phantom"><span class="hs-identifier hs-var">Phantom</span></a></span><span>          </span><span class="annot"><span class="annottext">Role
</span><a href="Language.Haskell.Syntax.Basic.html#Phantom"><span class="hs-identifier hs-var">Phantom</span></a></span><span>          </span><span id="local-6989586621682578681"><span class="annot"><span class="annottext">Coercion
</span><a href="#local-6989586621682578681"><span class="hs-identifier hs-var">co</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Coercion -&gt; Maybe Coercion
forall a. a -&gt; Maybe a
</span><span class="hs-identifier hs-var">Just</span></span><span> </span><span class="annot"><span class="annottext">Coercion
</span><a href="#local-6989586621682578681"><span class="hs-identifier hs-var">co</span></a></span><span>
</span><span id="line-1393"></span><span class="annot"><a href="GHC.Core.Coercion.html#downgradeRole_maybe"><span class="hs-identifier hs-var">downgradeRole_maybe</span></a></span><span> </span><span class="annot"><span class="annottext">Role
</span><a href="Language.Haskell.Syntax.Basic.html#Phantom"><span class="hs-identifier hs-var">Phantom</span></a></span><span>          </span><span class="annot"><span class="annottext">Role
</span><span class="hs-identifier">_</span></span><span>                </span><span id="local-6989586621682578682"><span class="annot"><span class="annottext">Coercion
</span><a href="#local-6989586621682578682"><span class="hs-identifier hs-var">co</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Coercion -&gt; Maybe Coercion
forall a. a -&gt; Maybe a
</span><span class="hs-identifier hs-var">Just</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Coercion -&gt; Coercion
</span><a href="GHC.Core.Coercion.html#toPhantomCo"><span class="hs-identifier hs-var">toPhantomCo</span></a></span><span> </span><span class="annot"><span class="annottext">Coercion
</span><a href="#local-6989586621682578682"><span class="hs-identifier hs-var">co</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1394"></span><span>
</span><span id="line-1395"></span><span class="hs-comment">-- | Like 'downgradeRole_maybe', but panics if the change isn't a downgrade.</span><span>
</span><span id="line-1396"></span><span class="hs-comment">-- See Note [Role twiddling functions]</span><span>
</span><span id="line-1397"></span><span class="annot"><a href="GHC.Core.Coercion.html#downgradeRole"><span class="hs-identifier hs-type">downgradeRole</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Language.Haskell.Syntax.Basic.html#Role"><span class="hs-identifier hs-type">Role</span></a></span><span>  </span><span class="hs-comment">-- desired role</span><span>
</span><span id="line-1398"></span><span>              </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Language.Haskell.Syntax.Basic.html#Role"><span class="hs-identifier hs-type">Role</span></a></span><span>  </span><span class="hs-comment">-- current role</span><span>
</span><span id="line-1399"></span><span>              </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#Coercion"><span class="hs-identifier hs-type">Coercion</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#Coercion"><span class="hs-identifier hs-type">Coercion</span></a></span><span>
</span><span id="line-1400"></span><span id="downgradeRole"><span class="annot"><span class="annottext">downgradeRole :: Role -&gt; Role -&gt; Coercion -&gt; Coercion
</span><a href="GHC.Core.Coercion.html#downgradeRole"><span class="hs-identifier hs-var hs-var">downgradeRole</span></a></span></span><span> </span><span id="local-6989586621682578683"><span class="annot"><span class="annottext">Role
</span><a href="#local-6989586621682578683"><span class="hs-identifier hs-var">r1</span></a></span></span><span> </span><span id="local-6989586621682578684"><span class="annot"><span class="annottext">Role
</span><a href="#local-6989586621682578684"><span class="hs-identifier hs-var">r2</span></a></span></span><span> </span><span id="local-6989586621682578685"><span class="annot"><span class="annottext">Coercion
</span><a href="#local-6989586621682578685"><span class="hs-identifier hs-var">co</span></a></span></span><span>
</span><span id="line-1401"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">Role -&gt; Role -&gt; Coercion -&gt; Maybe Coercion
</span><a href="GHC.Core.Coercion.html#downgradeRole_maybe"><span class="hs-identifier hs-var">downgradeRole_maybe</span></a></span><span> </span><span class="annot"><span class="annottext">Role
</span><a href="#local-6989586621682578683"><span class="hs-identifier hs-var">r1</span></a></span><span> </span><span class="annot"><span class="annottext">Role
</span><a href="#local-6989586621682578684"><span class="hs-identifier hs-var">r2</span></a></span><span> </span><span class="annot"><span class="annottext">Coercion
</span><a href="#local-6989586621682578685"><span class="hs-identifier hs-var">co</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-1402"></span><span>      </span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span id="local-6989586621682578686"><span class="annot"><span class="annottext">Coercion
</span><a href="#local-6989586621682578686"><span class="hs-identifier hs-var">co'</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Coercion
</span><a href="#local-6989586621682578686"><span class="hs-identifier hs-var">co'</span></a></span><span>
</span><span id="line-1403"></span><span>      </span><span class="annot"><span class="annottext">Maybe Coercion
</span><span class="hs-identifier hs-var">Nothing</span></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">String -&gt; SDoc -&gt; Coercion
forall a. HasCallStack =&gt; String -&gt; SDoc -&gt; a
</span><a href="GHC.Utils.Panic.html#pprPanic"><span class="hs-identifier hs-var">pprPanic</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;downgradeRole&quot;</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Coercion -&gt; SDoc
forall a. Outputable a =&gt; a -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="annot"><span class="annottext">Coercion
</span><a href="#local-6989586621682578685"><span class="hs-identifier hs-var">co</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1404"></span><span>
</span><span id="line-1405"></span><span class="annot"><span class="hs-comment">-- | Make a &quot;coercion between coercions&quot;.</span></span><span>
</span><span id="line-1406"></span><span class="annot"><a href="GHC.Core.Coercion.html#mkProofIrrelCo"><span class="hs-identifier hs-type">mkProofIrrelCo</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Language.Haskell.Syntax.Basic.html#Role"><span class="hs-identifier hs-type">Role</span></a></span><span>       </span><span class="annot"><span class="hs-comment">-- ^ role of the created coercion, &quot;r&quot;</span></span><span>
</span><span id="line-1407"></span><span>               </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#CoercionN"><span class="hs-identifier hs-type">CoercionN</span></a></span><span>  </span><span class="annot"><span class="hs-comment">-- ^ :: phi1 ~N phi2</span></span><span>
</span><span id="line-1408"></span><span>               </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#Coercion"><span class="hs-identifier hs-type">Coercion</span></a></span><span>   </span><span class="annot"><span class="hs-comment">-- ^ g1 :: phi1</span></span><span>
</span><span id="line-1409"></span><span>               </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#Coercion"><span class="hs-identifier hs-type">Coercion</span></a></span><span>   </span><span class="annot"><span class="hs-comment">-- ^ g2 :: phi2</span></span><span>
</span><span id="line-1410"></span><span>               </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#Coercion"><span class="hs-identifier hs-type">Coercion</span></a></span><span>   </span><span class="annot"><span class="hs-comment">-- ^ :: g1 ~r g2</span></span><span>
</span><span id="line-1411"></span><span>
</span><span id="line-1412"></span><span class="hs-comment">-- if the two coercion prove the same fact, I just don't care what</span><span>
</span><span id="line-1413"></span><span class="hs-comment">-- the individual coercions are.</span><span>
</span><span id="line-1414"></span><span id="mkProofIrrelCo"><span class="annot"><span class="annottext">mkProofIrrelCo :: Role -&gt; Coercion -&gt; Coercion -&gt; Coercion -&gt; Coercion
</span><a href="GHC.Core.Coercion.html#mkProofIrrelCo"><span class="hs-identifier hs-var hs-var">mkProofIrrelCo</span></a></span></span><span> </span><span id="local-6989586621682578687"><span class="annot"><span class="annottext">Role
</span><a href="#local-6989586621682578687"><span class="hs-identifier hs-var">r</span></a></span></span><span> </span><span id="local-6989586621682578688"><span class="annot"><span class="annottext">Coercion
</span><a href="#local-6989586621682578688"><span class="hs-identifier hs-var">co</span></a></span></span><span> </span><span id="local-6989586621682578689"><span class="annot"><span class="annottext">Coercion
</span><a href="#local-6989586621682578689"><span class="hs-identifier hs-var">g</span></a></span></span><span>  </span><span class="annot"><span class="annottext">Coercion
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Coercion -&gt; Bool
</span><a href="GHC.Core.Coercion.html#isGReflCo"><span class="hs-identifier hs-var">isGReflCo</span></a></span><span> </span><span class="annot"><span class="annottext">Coercion
</span><a href="#local-6989586621682578688"><span class="hs-identifier hs-var">co</span></a></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Role -&gt; Type -&gt; Coercion
</span><a href="GHC.Core.Coercion.html#mkReflCo"><span class="hs-identifier hs-var">mkReflCo</span></a></span><span> </span><span class="annot"><span class="annottext">Role
</span><a href="#local-6989586621682578687"><span class="hs-identifier hs-var">r</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Coercion -&gt; Type
</span><a href="GHC.Core.Type.html#mkCoercionTy"><span class="hs-identifier hs-var">mkCoercionTy</span></a></span><span> </span><span class="annot"><span class="annottext">Coercion
</span><a href="#local-6989586621682578689"><span class="hs-identifier hs-var">g</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1415"></span><span>  </span><span class="hs-comment">-- kco is a kind coercion, thus @isGReflCo@ rather than @isReflCo@</span><span>
</span><span id="line-1416"></span><span class="annot"><a href="GHC.Core.Coercion.html#mkProofIrrelCo"><span class="hs-identifier hs-var">mkProofIrrelCo</span></a></span><span> </span><span id="local-6989586621682578691"><span class="annot"><span class="annottext">Role
</span><a href="#local-6989586621682578691"><span class="hs-identifier hs-var">r</span></a></span></span><span> </span><span id="local-6989586621682578692"><span class="annot"><span class="annottext">Coercion
</span><a href="#local-6989586621682578692"><span class="hs-identifier hs-var">kco</span></a></span></span><span> </span><span id="local-6989586621682578693"><span class="annot"><span class="annottext">Coercion
</span><a href="#local-6989586621682578693"><span class="hs-identifier hs-var">g1</span></a></span></span><span> </span><span id="local-6989586621682578694"><span class="annot"><span class="annottext">Coercion
</span><a href="#local-6989586621682578694"><span class="hs-identifier hs-var">g2</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">UnivCoProvenance -&gt; [Coercion] -&gt; Role -&gt; Type -&gt; Type -&gt; Coercion
</span><a href="GHC.Core.Coercion.html#mkUnivCo"><span class="hs-identifier hs-var">mkUnivCo</span></a></span><span> </span><span class="annot"><span class="annottext">UnivCoProvenance
</span><a href="GHC.Core.TyCo.Rep.html#ProofIrrelProv"><span class="hs-identifier hs-var">ProofIrrelProv</span></a></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">Coercion
</span><a href="#local-6989586621682578692"><span class="hs-identifier hs-var">kco</span></a></span><span class="hs-special">]</span><span> </span><span class="annot"><span class="annottext">Role
</span><a href="#local-6989586621682578691"><span class="hs-identifier hs-var">r</span></a></span><span>
</span><span id="line-1417"></span><span>                                      </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Coercion -&gt; Type
</span><a href="GHC.Core.Type.html#mkCoercionTy"><span class="hs-identifier hs-var">mkCoercionTy</span></a></span><span> </span><span class="annot"><span class="annottext">Coercion
</span><a href="#local-6989586621682578693"><span class="hs-identifier hs-var">g1</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Coercion -&gt; Type
</span><a href="GHC.Core.Type.html#mkCoercionTy"><span class="hs-identifier hs-var">mkCoercionTy</span></a></span><span> </span><span class="annot"><span class="annottext">Coercion
</span><a href="#local-6989586621682578694"><span class="hs-identifier hs-var">g2</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1418"></span><span>
</span><span id="line-1419"></span><span class="hs-comment">{-
%************************************************************************
%*                                                                      *
   Roles
%*                                                                      *
%************************************************************************
-}</span><span>
</span><span id="line-1426"></span><span>
</span><span id="line-1427"></span><span class="hs-comment">-- | Converts a coercion to be nominal, if possible.</span><span>
</span><span id="line-1428"></span><span class="hs-comment">-- See Note [Role twiddling functions]</span><span>
</span><span id="line-1429"></span><span class="annot"><a href="GHC.Core.Coercion.html#setNominalRole_maybe"><span class="hs-identifier hs-type">setNominalRole_maybe</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Language.Haskell.Syntax.Basic.html#Role"><span class="hs-identifier hs-type">Role</span></a></span><span> </span><span class="hs-comment">-- of input coercion</span><span>
</span><span id="line-1430"></span><span>                     </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#Coercion"><span class="hs-identifier hs-type">Coercion</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Maybe</span></span><span> </span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#CoercionN"><span class="hs-identifier hs-type">CoercionN</span></a></span><span>
</span><span id="line-1431"></span><span id="setNominalRole_maybe"><span class="annot"><span class="annottext">setNominalRole_maybe :: Role -&gt; Coercion -&gt; Maybe Coercion
</span><a href="GHC.Core.Coercion.html#setNominalRole_maybe"><span class="hs-identifier hs-var hs-var">setNominalRole_maybe</span></a></span></span><span> </span><span id="local-6989586621682578696"><span class="annot"><span class="annottext">Role
</span><a href="#local-6989586621682578696"><span class="hs-identifier hs-var">r</span></a></span></span><span> </span><span id="local-6989586621682578697"><span class="annot"><span class="annottext">Coercion
</span><a href="#local-6989586621682578697"><span class="hs-identifier hs-var">co</span></a></span></span><span>
</span><span id="line-1432"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Role
</span><a href="#local-6989586621682578696"><span class="hs-identifier hs-var">r</span></a></span><span> </span><span class="annot"><span class="annottext">Role -&gt; Role -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">==</span></span><span> </span><span class="annot"><span class="annottext">Role
</span><a href="Language.Haskell.Syntax.Basic.html#Nominal"><span class="hs-identifier hs-var">Nominal</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Coercion -&gt; Maybe Coercion
forall a. a -&gt; Maybe a
</span><span class="hs-identifier hs-var">Just</span></span><span> </span><span class="annot"><span class="annottext">Coercion
</span><a href="#local-6989586621682578697"><span class="hs-identifier hs-var">co</span></a></span><span>
</span><span id="line-1433"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">otherwise</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Coercion -&gt; Maybe Coercion
</span><a href="#local-6989586621682578698"><span class="hs-identifier hs-var">setNominalRole_maybe_helper</span></a></span><span> </span><span class="annot"><span class="annottext">Coercion
</span><a href="#local-6989586621682578697"><span class="hs-identifier hs-var">co</span></a></span><span>
</span><span id="line-1434"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-1435"></span><span>    </span><span id="local-6989586621682578698"><span class="annot"><span class="annottext">setNominalRole_maybe_helper :: Coercion -&gt; Maybe Coercion
</span><a href="#local-6989586621682578698"><span class="hs-identifier hs-var hs-var">setNominalRole_maybe_helper</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#SubCo"><span class="hs-identifier hs-type">SubCo</span></a></span><span> </span><span id="local-6989586621682578721"><span class="annot"><span class="annottext">Coercion
</span><a href="#local-6989586621682578721"><span class="hs-identifier hs-var">co</span></a></span></span><span class="hs-special">)</span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Coercion -&gt; Maybe Coercion
forall a. a -&gt; Maybe a
</span><span class="hs-identifier hs-var">Just</span></span><span> </span><span class="annot"><span class="annottext">Coercion
</span><a href="#local-6989586621682578721"><span class="hs-identifier hs-var">co</span></a></span><span>
</span><span id="line-1436"></span><span>    </span><span class="annot"><a href="#local-6989586621682578698"><span class="hs-identifier hs-var">setNominalRole_maybe_helper</span></a></span><span> </span><span id="local-6989586621682578722"><span class="annot"><span class="annottext">co :: Coercion
</span><a href="#local-6989586621682578722"><span class="hs-identifier hs-var">co</span></a></span></span><span class="hs-glyph">@</span><span class="hs-special">(</span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#Refl"><span class="hs-identifier hs-type">Refl</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Coercion -&gt; Maybe Coercion
forall a. a -&gt; Maybe a
</span><span class="hs-identifier hs-var">Just</span></span><span> </span><span class="annot"><span class="annottext">Coercion
</span><a href="#local-6989586621682578722"><span class="hs-identifier hs-var">co</span></a></span><span>
</span><span id="line-1437"></span><span>    </span><span class="annot"><a href="#local-6989586621682578698"><span class="hs-identifier hs-var">setNominalRole_maybe_helper</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#GRefl"><span class="hs-identifier hs-type">GRefl</span></a></span><span> </span><span class="annot"><span class="annottext">Role
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621682578723"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682578723"><span class="hs-identifier hs-var">ty</span></a></span></span><span> </span><span id="local-6989586621682578724"><span class="annot"><span class="annottext">MCoercion
</span><a href="#local-6989586621682578724"><span class="hs-identifier hs-var">co</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Coercion -&gt; Maybe Coercion
forall a. a -&gt; Maybe a
</span><span class="hs-identifier hs-var">Just</span></span><span> </span><span class="annot"><span class="annottext">(Coercion -&gt; Maybe Coercion) -&gt; Coercion -&gt; Maybe Coercion
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Role -&gt; Type -&gt; MCoercion -&gt; Coercion
</span><a href="GHC.Core.TyCo.Rep.html#GRefl"><span class="hs-identifier hs-var">GRefl</span></a></span><span> </span><span class="annot"><span class="annottext">Role
</span><a href="Language.Haskell.Syntax.Basic.html#Nominal"><span class="hs-identifier hs-var">Nominal</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682578723"><span class="hs-identifier hs-var">ty</span></a></span><span> </span><span class="annot"><span class="annottext">MCoercion
</span><a href="#local-6989586621682578724"><span class="hs-identifier hs-var">co</span></a></span><span>
</span><span id="line-1438"></span><span>    </span><span class="annot"><a href="#local-6989586621682578698"><span class="hs-identifier hs-var">setNominalRole_maybe_helper</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#TyConAppCo"><span class="hs-identifier hs-type">TyConAppCo</span></a></span><span> </span><span class="annot"><span class="annottext">Role
</span><a href="Language.Haskell.Syntax.Basic.html#Representational"><span class="hs-identifier hs-var">Representational</span></a></span><span> </span><span id="local-6989586621682578725"><span class="annot"><span class="annottext">TyCon
</span><a href="#local-6989586621682578725"><span class="hs-identifier hs-var">tc</span></a></span></span><span> </span><span id="local-6989586621682578726"><span class="annot"><span class="annottext">[Coercion]
</span><a href="#local-6989586621682578726"><span class="hs-identifier hs-var">cos</span></a></span></span><span class="hs-special">)</span><span>
</span><span id="line-1439"></span><span>      </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span id="local-6989586621682578727"><span class="annot"><a href="#local-6989586621682578727"><span class="hs-identifier hs-var">cos'</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">(Role -&gt; Coercion -&gt; Maybe Coercion)
-&gt; [Role] -&gt; [Coercion] -&gt; Maybe [Coercion]
forall (m :: * -&gt; *) a b c.
Applicative m =&gt;
(a -&gt; b -&gt; m c) -&gt; [a] -&gt; [b] -&gt; m [c]
</span><span class="hs-identifier hs-var">zipWithM</span></span><span> </span><span class="annot"><span class="annottext">Role -&gt; Coercion -&gt; Maybe Coercion
</span><a href="GHC.Core.Coercion.html#setNominalRole_maybe"><span class="hs-identifier hs-var">setNominalRole_maybe</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Role -&gt; TyCon -&gt; [Role]
</span><a href="GHC.Core.Coercion.html#tyConRoleListX"><span class="hs-identifier hs-var">tyConRoleListX</span></a></span><span> </span><span class="annot"><span class="annottext">Role
</span><a href="Language.Haskell.Syntax.Basic.html#Representational"><span class="hs-identifier hs-var">Representational</span></a></span><span> </span><span class="annot"><span class="annottext">TyCon
</span><a href="#local-6989586621682578725"><span class="hs-identifier hs-var">tc</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[Coercion]
</span><a href="#local-6989586621682578726"><span class="hs-identifier hs-var">cos</span></a></span><span>
</span><span id="line-1440"></span><span>           </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">return</span></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#TyConAppCo"><span class="hs-identifier hs-type">TyConAppCo</span></a></span><span> </span><span class="annot"><a href="Language.Haskell.Syntax.Basic.html#Nominal"><span class="hs-identifier hs-type">Nominal</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682578725"><span class="hs-identifier hs-type">tc</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682578727"><span class="hs-identifier hs-type">cos'</span></a></span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-1441"></span><span>    </span><span class="annot"><a href="#local-6989586621682578698"><span class="hs-identifier hs-var">setNominalRole_maybe_helper</span></a></span><span> </span><span id="local-6989586621682578728"><span class="annot"><span class="annottext">co :: Coercion
</span><a href="#local-6989586621682578728"><span class="hs-identifier hs-var">co</span></a></span></span><span class="hs-glyph">@</span><span class="hs-special">(</span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#FunCo"><span class="hs-identifier hs-type">FunCo</span></a></span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">fco_role :: Coercion -&gt; Role
</span><a href="GHC.Core.TyCo.Rep.html#fco_role"><span class="hs-identifier hs-var">fco_role</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Role
</span><a href="Language.Haskell.Syntax.Basic.html#Representational"><span class="hs-identifier hs-var">Representational</span></a></span><span>
</span><span id="line-1442"></span><span>                                          </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">fco_arg :: Coercion -&gt; Coercion
</span><a href="GHC.Core.TyCo.Rep.html#fco_arg"><span class="hs-identifier hs-var">fco_arg</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="local-6989586621682578729"><span class="annot"><span class="annottext">Coercion
</span><a href="#local-6989586621682578729"><span class="hs-identifier hs-var">co1</span></a></span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">fco_res :: Coercion -&gt; Coercion
</span><a href="GHC.Core.TyCo.Rep.html#fco_res"><span class="hs-identifier hs-var">fco_res</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="local-6989586621682578730"><span class="annot"><span class="annottext">Coercion
</span><a href="#local-6989586621682578730"><span class="hs-identifier hs-var">co2</span></a></span></span><span> </span><span class="hs-special">}</span><span class="hs-special">)</span><span>
</span><span id="line-1443"></span><span>      </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span id="local-6989586621682578731"><span class="annot"><a href="#local-6989586621682578731"><span class="hs-identifier hs-var">co1'</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Role -&gt; Coercion -&gt; Maybe Coercion
</span><a href="GHC.Core.Coercion.html#setNominalRole_maybe"><span class="hs-identifier hs-var">setNominalRole_maybe</span></a></span><span> </span><span class="annot"><span class="annottext">Role
</span><a href="Language.Haskell.Syntax.Basic.html#Representational"><span class="hs-identifier hs-var">Representational</span></a></span><span> </span><span class="annot"><span class="annottext">Coercion
</span><a href="#local-6989586621682578729"><span class="hs-identifier hs-var">co1</span></a></span><span>
</span><span id="line-1444"></span><span>           </span><span class="hs-special">;</span><span> </span><span id="local-6989586621682578732"><span class="annot"><a href="#local-6989586621682578732"><span class="hs-identifier hs-var">co2'</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><a href="GHC.Core.Coercion.html#setNominalRole_maybe"><span class="hs-identifier hs-type">setNominalRole_maybe</span></a></span><span> </span><span class="annot"><a href="Language.Haskell.Syntax.Basic.html#Representational"><span class="hs-identifier hs-type">Representational</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682578730"><span class="hs-identifier hs-type">co2</span></a></span><span>
</span><span id="line-1445"></span><span>           </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">return</span></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="annot"><a href="#local-6989586621682578728"><span class="hs-identifier hs-type">co</span></a></span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#fco_role"><span class="hs-identifier hs-var">fco_role</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="Language.Haskell.Syntax.Basic.html#Nominal"><span class="hs-identifier hs-type">Nominal</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#fco_arg"><span class="hs-identifier hs-var">fco_arg</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="#local-6989586621682578731"><span class="hs-identifier hs-type">co1'</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#fco_res"><span class="hs-identifier hs-var">fco_res</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="#local-6989586621682578732"><span class="hs-identifier hs-type">co2'</span></a></span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-1446"></span><span>           </span><span class="hs-special">}</span><span>
</span><span id="line-1447"></span><span>    </span><span class="annot"><a href="#local-6989586621682578698"><span class="hs-identifier hs-var">setNominalRole_maybe_helper</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#SymCo"><span class="hs-identifier hs-type">SymCo</span></a></span><span> </span><span id="local-6989586621682578733"><span class="annot"><span class="annottext">Coercion
</span><a href="#local-6989586621682578733"><span class="hs-identifier hs-var">co</span></a></span></span><span class="hs-special">)</span><span>
</span><span id="line-1448"></span><span>      </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Coercion -&gt; Coercion
</span><a href="GHC.Core.TyCo.Rep.html#SymCo"><span class="hs-identifier hs-var">SymCo</span></a></span><span> </span><span class="annot"><span class="annottext">(Coercion -&gt; Coercion) -&gt; Maybe Coercion -&gt; Maybe Coercion
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="annot"><span class="annottext">Coercion -&gt; Maybe Coercion
</span><a href="#local-6989586621682578698"><span class="hs-identifier hs-var">setNominalRole_maybe_helper</span></a></span><span> </span><span class="annot"><span class="annottext">Coercion
</span><a href="#local-6989586621682578733"><span class="hs-identifier hs-var">co</span></a></span><span>
</span><span id="line-1449"></span><span>    </span><span class="annot"><a href="#local-6989586621682578698"><span class="hs-identifier hs-var">setNominalRole_maybe_helper</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#TransCo"><span class="hs-identifier hs-type">TransCo</span></a></span><span> </span><span id="local-6989586621682578735"><span class="annot"><span class="annottext">Coercion
</span><a href="#local-6989586621682578735"><span class="hs-identifier hs-var">co1</span></a></span></span><span> </span><span id="local-6989586621682578736"><span class="annot"><span class="annottext">Coercion
</span><a href="#local-6989586621682578736"><span class="hs-identifier hs-var">co2</span></a></span></span><span class="hs-special">)</span><span>
</span><span id="line-1450"></span><span>      </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Coercion -&gt; Coercion -&gt; Coercion
</span><a href="GHC.Core.TyCo.Rep.html#TransCo"><span class="hs-identifier hs-var">TransCo</span></a></span><span> </span><span class="annot"><span class="annottext">(Coercion -&gt; Coercion -&gt; Coercion)
-&gt; Maybe Coercion -&gt; Maybe (Coercion -&gt; Coercion)
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="annot"><span class="annottext">Coercion -&gt; Maybe Coercion
</span><a href="#local-6989586621682578698"><span class="hs-identifier hs-var">setNominalRole_maybe_helper</span></a></span><span> </span><span class="annot"><span class="annottext">Coercion
</span><a href="#local-6989586621682578735"><span class="hs-identifier hs-var">co1</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe (Coercion -&gt; Coercion) -&gt; Maybe Coercion -&gt; Maybe Coercion
forall a b. Maybe (a -&gt; b) -&gt; Maybe a -&gt; Maybe b
forall (f :: * -&gt; *) a b. Applicative f =&gt; f (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;*&gt;</span></span><span> </span><span class="annot"><span class="annottext">Coercion -&gt; Maybe Coercion
</span><a href="#local-6989586621682578698"><span class="hs-identifier hs-var">setNominalRole_maybe_helper</span></a></span><span> </span><span class="annot"><span class="annottext">Coercion
</span><a href="#local-6989586621682578736"><span class="hs-identifier hs-var">co2</span></a></span><span>
</span><span id="line-1451"></span><span>    </span><span class="annot"><a href="#local-6989586621682578698"><span class="hs-identifier hs-var">setNominalRole_maybe_helper</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#AppCo"><span class="hs-identifier hs-type">AppCo</span></a></span><span> </span><span id="local-6989586621682578737"><span class="annot"><span class="annottext">Coercion
</span><a href="#local-6989586621682578737"><span class="hs-identifier hs-var">co1</span></a></span></span><span> </span><span id="local-6989586621682578738"><span class="annot"><span class="annottext">Coercion
</span><a href="#local-6989586621682578738"><span class="hs-identifier hs-var">co2</span></a></span></span><span class="hs-special">)</span><span>
</span><span id="line-1452"></span><span>      </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Coercion -&gt; Coercion -&gt; Coercion
</span><a href="GHC.Core.TyCo.Rep.html#AppCo"><span class="hs-identifier hs-var">AppCo</span></a></span><span> </span><span class="annot"><span class="annottext">(Coercion -&gt; Coercion -&gt; Coercion)
-&gt; Maybe Coercion -&gt; Maybe (Coercion -&gt; Coercion)
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="annot"><span class="annottext">Coercion -&gt; Maybe Coercion
</span><a href="#local-6989586621682578698"><span class="hs-identifier hs-var">setNominalRole_maybe_helper</span></a></span><span> </span><span class="annot"><span class="annottext">Coercion
</span><a href="#local-6989586621682578737"><span class="hs-identifier hs-var">co1</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe (Coercion -&gt; Coercion) -&gt; Maybe Coercion -&gt; Maybe Coercion
forall a b. Maybe (a -&gt; b) -&gt; Maybe a -&gt; Maybe b
forall (f :: * -&gt; *) a b. Applicative f =&gt; f (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;*&gt;</span></span><span> </span><span class="annot"><span class="annottext">Coercion -&gt; Maybe Coercion
forall a. a -&gt; Maybe a
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">pure</span></span><span> </span><span class="annot"><span class="annottext">Coercion
</span><a href="#local-6989586621682578738"><span class="hs-identifier hs-var">co2</span></a></span><span>
</span><span id="line-1453"></span><span>    </span><span class="annot"><a href="#local-6989586621682578698"><span class="hs-identifier hs-var">setNominalRole_maybe_helper</span></a></span><span> </span><span id="local-6989586621682578739"><span class="annot"><span class="annottext">co :: Coercion
</span><a href="#local-6989586621682578739"><span class="hs-identifier hs-var">co</span></a></span></span><span class="hs-glyph">@</span><span class="hs-special">(</span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#ForAllCo"><span class="hs-identifier hs-type">ForAllCo</span></a></span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">fco_visL :: Coercion -&gt; ForAllTyFlag
</span><a href="GHC.Core.TyCo.Rep.html#fco_visL"><span class="hs-identifier hs-var">fco_visL</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="local-6989586621682578740"><span class="annot"><span class="annottext">ForAllTyFlag
</span><a href="#local-6989586621682578740"><span class="hs-identifier hs-var">visL</span></a></span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">fco_visR :: Coercion -&gt; ForAllTyFlag
</span><a href="GHC.Core.TyCo.Rep.html#fco_visR"><span class="hs-identifier hs-var">fco_visR</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="local-6989586621682578741"><span class="annot"><span class="annottext">ForAllTyFlag
</span><a href="#local-6989586621682578741"><span class="hs-identifier hs-var">visR</span></a></span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">fco_body :: Coercion -&gt; Coercion
</span><a href="GHC.Core.TyCo.Rep.html#fco_body"><span class="hs-identifier hs-var">fco_body</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="local-6989586621682578742"><span class="annot"><span class="annottext">Coercion
</span><a href="#local-6989586621682578742"><span class="hs-identifier hs-var">body_co</span></a></span></span><span> </span><span class="hs-special">}</span><span class="hs-special">)</span><span>
</span><span id="line-1454"></span><span>      </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">ForAllTyFlag
</span><a href="#local-6989586621682578740"><span class="hs-identifier hs-var">visL</span></a></span><span> </span><span class="annot"><span class="annottext">ForAllTyFlag -&gt; ForAllTyFlag -&gt; Bool
</span><a href="GHC.Core.TyCo.Compare.html#eqForAllVis"><span class="hs-operator hs-var">`eqForAllVis`</span></a></span><span> </span><span class="annot"><span class="annottext">ForAllTyFlag
</span><a href="#local-6989586621682578741"><span class="hs-identifier hs-var">visR</span></a></span><span> </span><span class="hs-comment">-- See (FC3) in Note [ForAllCo] in GHC.Core.TyCo.Rep</span><span>
</span><span id="line-1455"></span><span>      </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span id="local-6989586621682578743"><span class="annot"><a href="#local-6989586621682578743"><span class="hs-identifier hs-var">body_co'</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Coercion -&gt; Maybe Coercion
</span><a href="#local-6989586621682578698"><span class="hs-identifier hs-var">setNominalRole_maybe_helper</span></a></span><span> </span><span class="annot"><span class="annottext">Coercion
</span><a href="#local-6989586621682578742"><span class="hs-identifier hs-var">body_co</span></a></span><span>
</span><span id="line-1456"></span><span>           </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">return</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621682578739"><span class="hs-identifier hs-type">co</span></a></span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#fco_body"><span class="hs-identifier hs-var">fco_body</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="#local-6989586621682578743"><span class="hs-identifier hs-type">body_co'</span></a></span><span> </span><span class="hs-special">}</span><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-1457"></span><span>    </span><span class="annot"><a href="#local-6989586621682578698"><span class="hs-identifier hs-var">setNominalRole_maybe_helper</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#SelCo"><span class="hs-identifier hs-type">SelCo</span></a></span><span> </span><span id="local-6989586621682578744"><span class="annot"><span class="annottext">CoSel
</span><a href="#local-6989586621682578744"><span class="hs-identifier hs-var">cs</span></a></span></span><span> </span><span id="local-6989586621682578745"><span class="annot"><span class="annottext">Coercion
</span><a href="#local-6989586621682578745"><span class="hs-identifier hs-var">co</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-1458"></span><span>      </span><span class="hs-comment">-- NB, this case recurses via setNominalRole_maybe, not</span><span>
</span><span id="line-1459"></span><span>      </span><span class="hs-comment">-- setNominalRole_maybe_helper!</span><span>
</span><span id="line-1460"></span><span>      </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">CoSel
</span><a href="#local-6989586621682578744"><span class="hs-identifier hs-var">cs</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-1461"></span><span>        </span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#SelTyCon"><span class="hs-identifier hs-type">SelTyCon</span></a></span><span> </span><span id="local-6989586621682578746"><span class="annot"><span class="annottext">Arity
</span><a href="#local-6989586621682578746"><span class="hs-identifier hs-var">n</span></a></span></span><span> </span><span id="local-6989586621682578747"><span class="annot"><span class="annottext">Role
</span><a href="#local-6989586621682578747"><span class="hs-identifier hs-var">_r</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-1462"></span><span>          </span><span class="hs-comment">-- Remember to update the role in SelTyCon to nominal;</span><span>
</span><span id="line-1463"></span><span>          </span><span class="hs-comment">-- not doing this caused #23362.</span><span>
</span><span id="line-1464"></span><span>          </span><span class="hs-comment">-- See the typing rule in Note [SelCo] in GHC.Core.TyCo.Rep.</span><span>
</span><span id="line-1465"></span><span>          </span><span class="annot"><span class="annottext">CoSel -&gt; Coercion -&gt; Coercion
</span><a href="GHC.Core.TyCo.Rep.html#SelCo"><span class="hs-identifier hs-var">SelCo</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Arity -&gt; Role -&gt; CoSel
</span><a href="GHC.Core.TyCo.Rep.html#SelTyCon"><span class="hs-identifier hs-var">SelTyCon</span></a></span><span> </span><span class="annot"><span class="annottext">Arity
</span><a href="#local-6989586621682578746"><span class="hs-identifier hs-var">n</span></a></span><span> </span><span class="annot"><span class="annottext">Role
</span><a href="Language.Haskell.Syntax.Basic.html#Nominal"><span class="hs-identifier hs-var">Nominal</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(Coercion -&gt; Coercion) -&gt; Maybe Coercion -&gt; Maybe Coercion
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="annot"><span class="annottext">Role -&gt; Coercion -&gt; Maybe Coercion
</span><a href="GHC.Core.Coercion.html#setNominalRole_maybe"><span class="hs-identifier hs-var">setNominalRole_maybe</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Coercion -&gt; Role
</span><a href="GHC.Core.Coercion.html#coercionRole"><span class="hs-identifier hs-var">coercionRole</span></a></span><span> </span><span class="annot"><span class="annottext">Coercion
</span><a href="#local-6989586621682578745"><span class="hs-identifier hs-var">co</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Coercion
</span><a href="#local-6989586621682578745"><span class="hs-identifier hs-var">co</span></a></span><span>
</span><span id="line-1466"></span><span>        </span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#SelFun"><span class="hs-identifier hs-type">SelFun</span></a></span><span> </span><span id="local-6989586621682578748"><span class="annot"><span class="annottext">FunSel
</span><a href="#local-6989586621682578748"><span class="hs-identifier hs-var">fs</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-1467"></span><span>          </span><span class="annot"><span class="annottext">CoSel -&gt; Coercion -&gt; Coercion
</span><a href="GHC.Core.TyCo.Rep.html#SelCo"><span class="hs-identifier hs-var">SelCo</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">FunSel -&gt; CoSel
</span><a href="GHC.Core.TyCo.Rep.html#SelFun"><span class="hs-identifier hs-var">SelFun</span></a></span><span> </span><span class="annot"><span class="annottext">FunSel
</span><a href="#local-6989586621682578748"><span class="hs-identifier hs-var">fs</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(Coercion -&gt; Coercion) -&gt; Maybe Coercion -&gt; Maybe Coercion
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="annot"><span class="annottext">Role -&gt; Coercion -&gt; Maybe Coercion
</span><a href="GHC.Core.Coercion.html#setNominalRole_maybe"><span class="hs-identifier hs-var">setNominalRole_maybe</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Coercion -&gt; Role
</span><a href="GHC.Core.Coercion.html#coercionRole"><span class="hs-identifier hs-var">coercionRole</span></a></span><span> </span><span class="annot"><span class="annottext">Coercion
</span><a href="#local-6989586621682578745"><span class="hs-identifier hs-var">co</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Coercion
</span><a href="#local-6989586621682578745"><span class="hs-identifier hs-var">co</span></a></span><span>
</span><span id="line-1468"></span><span>        </span><span class="annot"><span class="annottext">CoSel
</span><a href="GHC.Core.TyCo.Rep.html#SelForAll"><span class="hs-identifier hs-var">SelForAll</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-1469"></span><span>          </span><span class="annot"><span class="annottext">String -&gt; SDoc -&gt; Maybe Coercion
forall a. HasCallStack =&gt; String -&gt; SDoc -&gt; a
</span><a href="GHC.Utils.Panic.html#pprPanic"><span class="hs-identifier hs-var">pprPanic</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;setNominalRole_maybe: the coercion should already be nominal&quot;</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Coercion -&gt; SDoc
forall a. Outputable a =&gt; a -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="annot"><span class="annottext">Coercion
</span><a href="#local-6989586621682578745"><span class="hs-identifier hs-var">co</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1470"></span><span>    </span><span class="annot"><a href="#local-6989586621682578698"><span class="hs-identifier hs-var">setNominalRole_maybe_helper</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#InstCo"><span class="hs-identifier hs-type">InstCo</span></a></span><span> </span><span id="local-6989586621682578749"><span class="annot"><span class="annottext">Coercion
</span><a href="#local-6989586621682578749"><span class="hs-identifier hs-var">co</span></a></span></span><span> </span><span id="local-6989586621682578750"><span class="annot"><span class="annottext">Coercion
</span><a href="#local-6989586621682578750"><span class="hs-identifier hs-var">arg</span></a></span></span><span class="hs-special">)</span><span>
</span><span id="line-1471"></span><span>      </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Coercion -&gt; Coercion -&gt; Coercion
</span><a href="GHC.Core.TyCo.Rep.html#InstCo"><span class="hs-identifier hs-var">InstCo</span></a></span><span> </span><span class="annot"><span class="annottext">(Coercion -&gt; Coercion -&gt; Coercion)
-&gt; Maybe Coercion -&gt; Maybe (Coercion -&gt; Coercion)
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="annot"><span class="annottext">Coercion -&gt; Maybe Coercion
</span><a href="#local-6989586621682578698"><span class="hs-identifier hs-var">setNominalRole_maybe_helper</span></a></span><span> </span><span class="annot"><span class="annottext">Coercion
</span><a href="#local-6989586621682578749"><span class="hs-identifier hs-var">co</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe (Coercion -&gt; Coercion) -&gt; Maybe Coercion -&gt; Maybe Coercion
forall a b. Maybe (a -&gt; b) -&gt; Maybe a -&gt; Maybe b
forall (f :: * -&gt; *) a b. Applicative f =&gt; f (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;*&gt;</span></span><span> </span><span class="annot"><span class="annottext">Coercion -&gt; Maybe Coercion
forall a. a -&gt; Maybe a
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">pure</span></span><span> </span><span class="annot"><span class="annottext">Coercion
</span><a href="#local-6989586621682578750"><span class="hs-identifier hs-var">arg</span></a></span><span>
</span><span id="line-1472"></span><span>    </span><span class="annot"><a href="#local-6989586621682578698"><span class="hs-identifier hs-var">setNominalRole_maybe_helper</span></a></span><span> </span><span id="local-6989586621682578751"><span class="annot"><span class="annottext">co :: Coercion
</span><a href="#local-6989586621682578751"><span class="hs-identifier hs-var">co</span></a></span></span><span class="hs-glyph">@</span><span class="hs-special">(</span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#UnivCo"><span class="hs-identifier hs-type">UnivCo</span></a></span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">uco_prov :: Coercion -&gt; UnivCoProvenance
</span><a href="GHC.Core.TyCo.Rep.html#uco_prov"><span class="hs-identifier hs-var">uco_prov</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="local-6989586621682578752"><span class="annot"><span class="annottext">UnivCoProvenance
</span><a href="#local-6989586621682578752"><span class="hs-identifier hs-var">prov</span></a></span></span><span> </span><span class="hs-special">}</span><span class="hs-special">)</span><span>
</span><span id="line-1473"></span><span>      </span><span class="hs-glyph">|</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">UnivCoProvenance
</span><a href="#local-6989586621682578752"><span class="hs-identifier hs-var">prov</span></a></span><span> </span><span class="hs-keyword">of</span><span> </span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#PhantomProv"><span class="hs-identifier hs-type">PhantomProv</span></a></span><span> </span><span class="hs-special">{</span><span class="hs-special">}</span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">False</span></span><span>  </span><span class="hs-comment">-- should always be phantom</span><span>
</span><span id="line-1474"></span><span>                     </span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#ProofIrrelProv"><span class="hs-identifier hs-type">ProofIrrelProv</span></a></span><span> </span><span class="hs-special">{</span><span class="hs-special">}</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">True</span></span><span>   </span><span class="hs-comment">-- it's always safe</span><span>
</span><span id="line-1475"></span><span>                     </span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#PluginProv"><span class="hs-identifier hs-type">PluginProv</span></a></span><span> </span><span class="hs-special">{</span><span class="hs-special">}</span><span>     </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">False</span></span><span>  </span><span class="hs-comment">-- who knows? This choice is conservative.</span><span>
</span><span id="line-1476"></span><span>      </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Coercion -&gt; Maybe Coercion
forall a. a -&gt; Maybe a
</span><span class="hs-identifier hs-var">Just</span></span><span> </span><span class="annot"><span class="annottext">(Coercion -&gt; Maybe Coercion) -&gt; Coercion -&gt; Maybe Coercion
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Coercion
</span><a href="#local-6989586621682578751"><span class="hs-identifier hs-var">co</span></a></span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#uco_role"><span class="hs-identifier hs-var">uco_role</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="Language.Haskell.Syntax.Basic.html#Nominal"><span class="hs-identifier hs-type">Nominal</span></a></span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-1477"></span><span>    </span><span class="annot"><a href="#local-6989586621682578698"><span class="hs-identifier hs-var">setNominalRole_maybe_helper</span></a></span><span> </span><span class="annot"><span class="annottext">Coercion
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Maybe Coercion
forall a. Maybe a
</span><span class="hs-identifier hs-var">Nothing</span></span><span>
</span><span id="line-1478"></span><span>
</span><span id="line-1479"></span><span class="hs-comment">-- | Make a phantom coercion between two types. The coercion passed</span><span>
</span><span id="line-1480"></span><span class="hs-comment">-- in must be a nominal coercion between the kinds of the</span><span>
</span><span id="line-1481"></span><span class="hs-comment">-- types.</span><span>
</span><span id="line-1482"></span><span class="annot"><a href="GHC.Core.Coercion.html#mkPhantomCo"><span class="hs-identifier hs-type">mkPhantomCo</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#Coercion"><span class="hs-identifier hs-type">Coercion</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#Type"><span class="hs-identifier hs-type">Type</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#Type"><span class="hs-identifier hs-type">Type</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#Coercion"><span class="hs-identifier hs-type">Coercion</span></a></span><span>
</span><span id="line-1483"></span><span id="mkPhantomCo"><span class="annot"><span class="annottext">mkPhantomCo :: Coercion -&gt; Type -&gt; Type -&gt; Coercion
</span><a href="GHC.Core.Coercion.html#mkPhantomCo"><span class="hs-identifier hs-var hs-var">mkPhantomCo</span></a></span></span><span> </span><span id="local-6989586621682578755"><span class="annot"><span class="annottext">Coercion
</span><a href="#local-6989586621682578755"><span class="hs-identifier hs-var">h</span></a></span></span><span> </span><span id="local-6989586621682578756"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682578756"><span class="hs-identifier hs-var">t1</span></a></span></span><span> </span><span id="local-6989586621682578757"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682578757"><span class="hs-identifier hs-var">t2</span></a></span></span><span>
</span><span id="line-1484"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">UnivCoProvenance -&gt; [Coercion] -&gt; Role -&gt; Type -&gt; Type -&gt; Coercion
</span><a href="GHC.Core.Coercion.html#mkUnivCo"><span class="hs-identifier hs-var">mkUnivCo</span></a></span><span> </span><span class="annot"><span class="annottext">UnivCoProvenance
</span><a href="GHC.Core.TyCo.Rep.html#PhantomProv"><span class="hs-identifier hs-var">PhantomProv</span></a></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">Coercion
</span><a href="#local-6989586621682578755"><span class="hs-identifier hs-var">h</span></a></span><span class="hs-special">]</span><span> </span><span class="annot"><span class="annottext">Role
</span><a href="Language.Haskell.Syntax.Basic.html#Phantom"><span class="hs-identifier hs-var">Phantom</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682578756"><span class="hs-identifier hs-var">t1</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682578757"><span class="hs-identifier hs-var">t2</span></a></span><span>
</span><span id="line-1485"></span><span>
</span><span id="line-1486"></span><span class="hs-comment">-- takes any coercion and turns it into a Phantom coercion</span><span>
</span><span id="line-1487"></span><span class="annot"><a href="GHC.Core.Coercion.html#toPhantomCo"><span class="hs-identifier hs-type">toPhantomCo</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#Coercion"><span class="hs-identifier hs-type">Coercion</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#Coercion"><span class="hs-identifier hs-type">Coercion</span></a></span><span>
</span><span id="line-1488"></span><span id="toPhantomCo"><span class="annot"><span class="annottext">toPhantomCo :: Coercion -&gt; Coercion
</span><a href="GHC.Core.Coercion.html#toPhantomCo"><span class="hs-identifier hs-var hs-var">toPhantomCo</span></a></span></span><span> </span><span id="local-6989586621682578758"><span class="annot"><span class="annottext">Coercion
</span><a href="#local-6989586621682578758"><span class="hs-identifier hs-var">co</span></a></span></span><span>
</span><span id="line-1489"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Coercion -&gt; Type -&gt; Type -&gt; Coercion
</span><a href="GHC.Core.Coercion.html#mkPhantomCo"><span class="hs-identifier hs-var">mkPhantomCo</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Coercion -&gt; Coercion
</span><a href="GHC.Core.Coercion.html#mkKindCo"><span class="hs-identifier hs-var">mkKindCo</span></a></span><span> </span><span class="annot"><span class="annottext">Coercion
</span><a href="#local-6989586621682578758"><span class="hs-identifier hs-var">co</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682578759"><span class="hs-identifier hs-var">ty1</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682578760"><span class="hs-identifier hs-var">ty2</span></a></span><span>
</span><span id="line-1490"></span><span>  </span><span class="hs-keyword">where</span><span> </span><span class="annot"><a href="GHC.Data.Pair.html#Pair"><span class="hs-identifier hs-type">Pair</span></a></span><span> </span><span id="local-6989586621682578759"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682578759"><span class="hs-identifier hs-var">ty1</span></a></span></span><span> </span><span id="local-6989586621682578760"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682578760"><span class="hs-identifier hs-var">ty2</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">HasDebugCallStack =&gt; Coercion -&gt; Pair Type
Coercion -&gt; Pair Type
</span><a href="GHC.Core.Coercion.html#coercionKind"><span class="hs-identifier hs-var">coercionKind</span></a></span><span> </span><span class="annot"><span class="annottext">Coercion
</span><a href="#local-6989586621682578758"><span class="hs-identifier hs-var">co</span></a></span><span>
</span><span id="line-1491"></span><span>
</span><span id="line-1492"></span><span class="hs-comment">-- Convert args to a TyConAppCo Nominal to the same TyConAppCo Representational</span><span>
</span><span id="line-1493"></span><span class="annot"><a href="GHC.Core.Coercion.html#applyRoles"><span class="hs-identifier hs-type">applyRoles</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Core.TyCon.html#TyCon"><span class="hs-identifier hs-type">TyCon</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#Coercion"><span class="hs-identifier hs-type">Coercion</span></a></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#Coercion"><span class="hs-identifier hs-type">Coercion</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-1494"></span><span id="applyRoles"><span class="annot"><span class="annottext">applyRoles :: TyCon -&gt; [Coercion] -&gt; [Coercion]
</span><a href="GHC.Core.Coercion.html#applyRoles"><span class="hs-identifier hs-var hs-var">applyRoles</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(Role -&gt; Coercion -&gt; Coercion)
-&gt; [Role] -&gt; [Coercion] -&gt; [Coercion]
forall a b c. (a -&gt; b -&gt; c) -&gt; [a] -&gt; [b] -&gt; [c]
</span><span class="hs-identifier hs-var">zipWith</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Role -&gt; Role -&gt; Coercion -&gt; Coercion
</span><a href="GHC.Core.Coercion.html#downgradeRole"><span class="hs-operator hs-var">`downgradeRole`</span></a></span><span> </span><span class="annot"><span class="annottext">Role
</span><a href="Language.Haskell.Syntax.Basic.html#Nominal"><span class="hs-identifier hs-var">Nominal</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">([Role] -&gt; [Coercion] -&gt; [Coercion])
-&gt; (TyCon -&gt; [Role]) -&gt; TyCon -&gt; [Coercion] -&gt; [Coercion]
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">TyCon -&gt; [Role]
</span><a href="GHC.Core.Coercion.html#tyConRoleListRepresentational"><span class="hs-identifier hs-var">tyConRoleListRepresentational</span></a></span><span>
</span><span id="line-1495"></span><span>
</span><span id="line-1496"></span><span class="hs-comment">-- The Role parameter is the Role of the TyConAppCo</span><span>
</span><span id="line-1497"></span><span class="hs-comment">-- defined here because this is intimately concerned with the implementation</span><span>
</span><span id="line-1498"></span><span class="hs-comment">-- of TyConAppCo</span><span>
</span><span id="line-1499"></span><span class="hs-comment">-- Always returns an infinite list (with a infinite tail of Nominal)</span><span>
</span><span id="line-1500"></span><span class="annot"><a href="GHC.Core.Coercion.html#tyConRolesX"><span class="hs-identifier hs-type">tyConRolesX</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Language.Haskell.Syntax.Basic.html#Role"><span class="hs-identifier hs-type">Role</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Core.TyCon.html#TyCon"><span class="hs-identifier hs-type">TyCon</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Data.List.Infinite.html#Infinite"><span class="hs-identifier hs-type">Infinite</span></a></span><span> </span><span class="annot"><a href="Language.Haskell.Syntax.Basic.html#Role"><span class="hs-identifier hs-type">Role</span></a></span><span>
</span><span id="line-1501"></span><span id="tyConRolesX"><span class="annot"><span class="annottext">tyConRolesX :: Role -&gt; TyCon -&gt; Infinite Role
</span><a href="GHC.Core.Coercion.html#tyConRolesX"><span class="hs-identifier hs-var hs-var">tyConRolesX</span></a></span></span><span> </span><span class="annot"><span class="annottext">Role
</span><a href="Language.Haskell.Syntax.Basic.html#Representational"><span class="hs-identifier hs-var">Representational</span></a></span><span> </span><span id="local-6989586621682578761"><span class="annot"><span class="annottext">TyCon
</span><a href="#local-6989586621682578761"><span class="hs-identifier hs-var">tc</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">TyCon -&gt; Infinite Role
</span><a href="GHC.Core.Coercion.html#tyConRolesRepresentational"><span class="hs-identifier hs-var">tyConRolesRepresentational</span></a></span><span> </span><span class="annot"><span class="annottext">TyCon
</span><a href="#local-6989586621682578761"><span class="hs-identifier hs-var">tc</span></a></span><span>
</span><span id="line-1502"></span><span class="annot"><a href="GHC.Core.Coercion.html#tyConRolesX"><span class="hs-identifier hs-var">tyConRolesX</span></a></span><span> </span><span id="local-6989586621682578762"><span class="annot"><span class="annottext">Role
</span><a href="#local-6989586621682578762"><span class="hs-keyword hs-var">role</span></a></span></span><span>             </span><span class="annot"><span class="annottext">TyCon
</span><span class="hs-identifier">_</span></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Role -&gt; Infinite Role
forall a. a -&gt; Infinite a
</span><a href="GHC.Data.List.Infinite.html#repeat"><span class="hs-identifier hs-var">Inf.repeat</span></a></span><span> </span><span class="annot"><span class="annottext">Role
</span><a href="#local-6989586621682578762"><span class="hs-keyword hs-var">role</span></a></span><span>
</span><span id="line-1503"></span><span>
</span><span id="line-1504"></span><span class="annot"><a href="GHC.Core.Coercion.html#tyConRoleListX"><span class="hs-identifier hs-type">tyConRoleListX</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Language.Haskell.Syntax.Basic.html#Role"><span class="hs-identifier hs-type">Role</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Core.TyCon.html#TyCon"><span class="hs-identifier hs-type">TyCon</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="Language.Haskell.Syntax.Basic.html#Role"><span class="hs-identifier hs-type">Role</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-1505"></span><span id="tyConRoleListX"><span class="annot"><span class="annottext">tyConRoleListX :: Role -&gt; TyCon -&gt; [Role]
</span><a href="GHC.Core.Coercion.html#tyConRoleListX"><span class="hs-identifier hs-var hs-var">tyConRoleListX</span></a></span></span><span> </span><span id="local-6989586621682578764"><span class="annot"><span class="annottext">Role
</span><a href="#local-6989586621682578764"><span class="hs-keyword hs-var">role</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Infinite Role -&gt; [Role]
forall a. Infinite a -&gt; [a]
</span><a href="GHC.Data.List.Infinite.html#toList"><span class="hs-identifier hs-var">Inf.toList</span></a></span><span> </span><span class="annot"><span class="annottext">(Infinite Role -&gt; [Role])
-&gt; (TyCon -&gt; Infinite Role) -&gt; TyCon -&gt; [Role]
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">Role -&gt; TyCon -&gt; Infinite Role
</span><a href="GHC.Core.Coercion.html#tyConRolesX"><span class="hs-identifier hs-var">tyConRolesX</span></a></span><span> </span><span class="annot"><span class="annottext">Role
</span><a href="#local-6989586621682578764"><span class="hs-keyword hs-var">role</span></a></span><span>
</span><span id="line-1506"></span><span>
</span><span id="line-1507"></span><span class="hs-comment">-- Returns the roles of the parameters of a tycon, with an infinite tail</span><span>
</span><span id="line-1508"></span><span class="hs-comment">-- of Nominal</span><span>
</span><span id="line-1509"></span><span class="annot"><a href="GHC.Core.Coercion.html#tyConRolesRepresentational"><span class="hs-identifier hs-type">tyConRolesRepresentational</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Core.TyCon.html#TyCon"><span class="hs-identifier hs-type">TyCon</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Data.List.Infinite.html#Infinite"><span class="hs-identifier hs-type">Infinite</span></a></span><span> </span><span class="annot"><a href="Language.Haskell.Syntax.Basic.html#Role"><span class="hs-identifier hs-type">Role</span></a></span><span>
</span><span id="line-1510"></span><span id="tyConRolesRepresentational"><span class="annot"><span class="annottext">tyConRolesRepresentational :: TyCon -&gt; Infinite Role
</span><a href="GHC.Core.Coercion.html#tyConRolesRepresentational"><span class="hs-identifier hs-var hs-var">tyConRolesRepresentational</span></a></span></span><span> </span><span id="local-6989586621682578765"><span class="annot"><span class="annottext">TyCon
</span><a href="#local-6989586621682578765"><span class="hs-identifier hs-var">tc</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">TyCon -&gt; [Role]
</span><a href="GHC.Core.TyCon.html#tyConRoles"><span class="hs-identifier hs-var">tyConRoles</span></a></span><span> </span><span class="annot"><span class="annottext">TyCon
</span><a href="#local-6989586621682578765"><span class="hs-identifier hs-var">tc</span></a></span><span> </span><span class="annot"><span class="annottext">[Role] -&gt; Infinite Role -&gt; Infinite Role
forall (f :: * -&gt; *) a.
Foldable f =&gt;
f a -&gt; Infinite a -&gt; Infinite a
</span><a href="GHC.Data.List.Infinite.html#%2B%2B"><span class="hs-operator hs-var">Inf.++</span></a></span><span> </span><span class="annot"><span class="annottext">Role -&gt; Infinite Role
forall a. a -&gt; Infinite a
</span><a href="GHC.Data.List.Infinite.html#repeat"><span class="hs-identifier hs-var">Inf.repeat</span></a></span><span> </span><span class="annot"><span class="annottext">Role
</span><a href="Language.Haskell.Syntax.Basic.html#Nominal"><span class="hs-identifier hs-var">Nominal</span></a></span><span>
</span><span id="line-1511"></span><span>
</span><span id="line-1512"></span><span class="hs-comment">-- Returns the roles of the parameters of a tycon, with an infinite tail</span><span>
</span><span id="line-1513"></span><span class="hs-comment">-- of Nominal</span><span>
</span><span id="line-1514"></span><span class="annot"><a href="GHC.Core.Coercion.html#tyConRoleListRepresentational"><span class="hs-identifier hs-type">tyConRoleListRepresentational</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Core.TyCon.html#TyCon"><span class="hs-identifier hs-type">TyCon</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="Language.Haskell.Syntax.Basic.html#Role"><span class="hs-identifier hs-type">Role</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-1515"></span><span id="tyConRoleListRepresentational"><span class="annot"><span class="annottext">tyConRoleListRepresentational :: TyCon -&gt; [Role]
</span><a href="GHC.Core.Coercion.html#tyConRoleListRepresentational"><span class="hs-identifier hs-var hs-var">tyConRoleListRepresentational</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Infinite Role -&gt; [Role]
forall a. Infinite a -&gt; [a]
</span><a href="GHC.Data.List.Infinite.html#toList"><span class="hs-identifier hs-var">Inf.toList</span></a></span><span> </span><span class="annot"><span class="annottext">(Infinite Role -&gt; [Role])
-&gt; (TyCon -&gt; Infinite Role) -&gt; TyCon -&gt; [Role]
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">TyCon -&gt; Infinite Role
</span><a href="GHC.Core.Coercion.html#tyConRolesRepresentational"><span class="hs-identifier hs-var">tyConRolesRepresentational</span></a></span><span>
</span><span id="line-1516"></span><span>
</span><span id="line-1517"></span><span class="annot"><a href="GHC.Core.Coercion.html#tyConRole"><span class="hs-identifier hs-type">tyConRole</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Language.Haskell.Syntax.Basic.html#Role"><span class="hs-identifier hs-type">Role</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Core.TyCon.html#TyCon"><span class="hs-identifier hs-type">TyCon</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Int</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Language.Haskell.Syntax.Basic.html#Role"><span class="hs-identifier hs-type">Role</span></a></span><span>
</span><span id="line-1518"></span><span id="tyConRole"><span class="annot"><span class="annottext">tyConRole :: Role -&gt; TyCon -&gt; Arity -&gt; Role
</span><a href="GHC.Core.Coercion.html#tyConRole"><span class="hs-identifier hs-var hs-var">tyConRole</span></a></span></span><span> </span><span class="annot"><span class="annottext">Role
</span><a href="Language.Haskell.Syntax.Basic.html#Nominal"><span class="hs-identifier hs-var">Nominal</span></a></span><span>          </span><span class="annot"><span class="annottext">TyCon
</span><span class="hs-identifier">_</span></span><span>  </span><span class="annot"><span class="annottext">Arity
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Role
</span><a href="Language.Haskell.Syntax.Basic.html#Nominal"><span class="hs-identifier hs-var">Nominal</span></a></span><span>
</span><span id="line-1519"></span><span class="annot"><a href="GHC.Core.Coercion.html#tyConRole"><span class="hs-identifier hs-var">tyConRole</span></a></span><span> </span><span class="annot"><span class="annottext">Role
</span><a href="Language.Haskell.Syntax.Basic.html#Phantom"><span class="hs-identifier hs-var">Phantom</span></a></span><span>          </span><span class="annot"><span class="annottext">TyCon
</span><span class="hs-identifier">_</span></span><span>  </span><span class="annot"><span class="annottext">Arity
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Role
</span><a href="Language.Haskell.Syntax.Basic.html#Phantom"><span class="hs-identifier hs-var">Phantom</span></a></span><span>
</span><span id="line-1520"></span><span class="annot"><a href="GHC.Core.Coercion.html#tyConRole"><span class="hs-identifier hs-var">tyConRole</span></a></span><span> </span><span class="annot"><span class="annottext">Role
</span><a href="Language.Haskell.Syntax.Basic.html#Representational"><span class="hs-identifier hs-var">Representational</span></a></span><span> </span><span id="local-6989586621682578768"><span class="annot"><span class="annottext">TyCon
</span><a href="#local-6989586621682578768"><span class="hs-identifier hs-var">tc</span></a></span></span><span> </span><span id="local-6989586621682578769"><span class="annot"><span class="annottext">Arity
</span><a href="#local-6989586621682578769"><span class="hs-identifier hs-var">n</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">TyCon -&gt; Infinite Role
</span><a href="GHC.Core.Coercion.html#tyConRolesRepresentational"><span class="hs-identifier hs-var">tyConRolesRepresentational</span></a></span><span> </span><span class="annot"><span class="annottext">TyCon
</span><a href="#local-6989586621682578768"><span class="hs-identifier hs-var">tc</span></a></span><span> </span><span class="annot"><span class="annottext">Infinite Role -&gt; Arity -&gt; Role
forall a. Infinite a -&gt; Arity -&gt; a
</span><a href="GHC.Data.List.Infinite.html#%21%21"><span class="hs-operator hs-var">Inf.!!</span></a></span><span> </span><span class="annot"><span class="annottext">Arity
</span><a href="#local-6989586621682578769"><span class="hs-identifier hs-var">n</span></a></span><span>
</span><span id="line-1521"></span><span>
</span><span id="line-1522"></span><span class="annot"><a href="GHC.Core.Coercion.html#funRole"><span class="hs-identifier hs-type">funRole</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Language.Haskell.Syntax.Basic.html#Role"><span class="hs-identifier hs-type">Role</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#FunSel"><span class="hs-identifier hs-type">FunSel</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Language.Haskell.Syntax.Basic.html#Role"><span class="hs-identifier hs-type">Role</span></a></span><span>
</span><span id="line-1523"></span><span id="funRole"><span class="annot"><span class="annottext">funRole :: Role -&gt; FunSel -&gt; Role
</span><a href="GHC.Core.Coercion.html#funRole"><span class="hs-identifier hs-var hs-var">funRole</span></a></span></span><span> </span><span class="annot"><span class="annottext">Role
</span><a href="Language.Haskell.Syntax.Basic.html#Nominal"><span class="hs-identifier hs-var">Nominal</span></a></span><span>          </span><span class="annot"><span class="annottext">FunSel
</span><span class="hs-identifier">_</span></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Role
</span><a href="Language.Haskell.Syntax.Basic.html#Nominal"><span class="hs-identifier hs-var">Nominal</span></a></span><span>
</span><span id="line-1524"></span><span class="annot"><a href="GHC.Core.Coercion.html#funRole"><span class="hs-identifier hs-var">funRole</span></a></span><span> </span><span class="annot"><span class="annottext">Role
</span><a href="Language.Haskell.Syntax.Basic.html#Phantom"><span class="hs-identifier hs-var">Phantom</span></a></span><span>          </span><span class="annot"><span class="annottext">FunSel
</span><span class="hs-identifier">_</span></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Role
</span><a href="Language.Haskell.Syntax.Basic.html#Phantom"><span class="hs-identifier hs-var">Phantom</span></a></span><span>
</span><span id="line-1525"></span><span class="annot"><a href="GHC.Core.Coercion.html#funRole"><span class="hs-identifier hs-var">funRole</span></a></span><span> </span><span class="annot"><span class="annottext">Role
</span><a href="Language.Haskell.Syntax.Basic.html#Representational"><span class="hs-identifier hs-var">Representational</span></a></span><span> </span><span id="local-6989586621682578770"><span class="annot"><span class="annottext">FunSel
</span><a href="#local-6989586621682578770"><span class="hs-identifier hs-var">fs</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">FunSel -&gt; Role
</span><a href="GHC.Core.Coercion.html#funRoleRepresentational"><span class="hs-identifier hs-var">funRoleRepresentational</span></a></span><span> </span><span class="annot"><span class="annottext">FunSel
</span><a href="#local-6989586621682578770"><span class="hs-identifier hs-var">fs</span></a></span><span>
</span><span id="line-1526"></span><span>
</span><span id="line-1527"></span><span class="annot"><a href="GHC.Core.Coercion.html#funRoleRepresentational"><span class="hs-identifier hs-type">funRoleRepresentational</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#FunSel"><span class="hs-identifier hs-type">FunSel</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Language.Haskell.Syntax.Basic.html#Role"><span class="hs-identifier hs-type">Role</span></a></span><span>
</span><span id="line-1528"></span><span id="funRoleRepresentational"><span class="annot"><span class="annottext">funRoleRepresentational :: FunSel -&gt; Role
</span><a href="GHC.Core.Coercion.html#funRoleRepresentational"><span class="hs-identifier hs-var hs-var">funRoleRepresentational</span></a></span></span><span> </span><span class="annot"><span class="annottext">FunSel
</span><a href="GHC.Core.TyCo.Rep.html#SelMult"><span class="hs-identifier hs-var">SelMult</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Role
</span><a href="Language.Haskell.Syntax.Basic.html#Nominal"><span class="hs-identifier hs-var">Nominal</span></a></span><span>
</span><span id="line-1529"></span><span class="annot"><a href="GHC.Core.Coercion.html#funRoleRepresentational"><span class="hs-identifier hs-var">funRoleRepresentational</span></a></span><span> </span><span class="annot"><span class="annottext">FunSel
</span><a href="GHC.Core.TyCo.Rep.html#SelArg"><span class="hs-identifier hs-var">SelArg</span></a></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Role
</span><a href="Language.Haskell.Syntax.Basic.html#Representational"><span class="hs-identifier hs-var">Representational</span></a></span><span>
</span><span id="line-1530"></span><span class="annot"><a href="GHC.Core.Coercion.html#funRoleRepresentational"><span class="hs-identifier hs-var">funRoleRepresentational</span></a></span><span> </span><span class="annot"><span class="annottext">FunSel
</span><a href="GHC.Core.TyCo.Rep.html#SelRes"><span class="hs-identifier hs-var">SelRes</span></a></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Role
</span><a href="Language.Haskell.Syntax.Basic.html#Representational"><span class="hs-identifier hs-var">Representational</span></a></span><span>
</span><span id="line-1531"></span><span>
</span><span id="line-1532"></span><span class="annot"><a href="GHC.Core.Coercion.html#ltRole"><span class="hs-identifier hs-type">ltRole</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Language.Haskell.Syntax.Basic.html#Role"><span class="hs-identifier hs-type">Role</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Language.Haskell.Syntax.Basic.html#Role"><span class="hs-identifier hs-type">Role</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Bool</span></span><span>
</span><span id="line-1533"></span><span class="hs-comment">-- Is one role &quot;less&quot; than another?</span><span>
</span><span id="line-1534"></span><span class="hs-comment">--     Nominal &lt; Representational &lt; Phantom</span><span>
</span><span id="line-1535"></span><span id="ltRole"><span class="annot"><span class="annottext">ltRole :: Role -&gt; Role -&gt; Bool
</span><a href="GHC.Core.Coercion.html#ltRole"><span class="hs-identifier hs-var hs-var">ltRole</span></a></span></span><span> </span><span class="annot"><span class="annottext">Role
</span><a href="Language.Haskell.Syntax.Basic.html#Phantom"><span class="hs-identifier hs-var">Phantom</span></a></span><span>          </span><span class="annot"><span class="annottext">Role
</span><span class="hs-identifier">_</span></span><span>       </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">False</span></span><span>
</span><span id="line-1536"></span><span class="annot"><a href="GHC.Core.Coercion.html#ltRole"><span class="hs-identifier hs-var">ltRole</span></a></span><span> </span><span class="annot"><span class="annottext">Role
</span><a href="Language.Haskell.Syntax.Basic.html#Representational"><span class="hs-identifier hs-var">Representational</span></a></span><span> </span><span class="annot"><span class="annottext">Role
</span><a href="Language.Haskell.Syntax.Basic.html#Phantom"><span class="hs-identifier hs-var">Phantom</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">True</span></span><span>
</span><span id="line-1537"></span><span class="annot"><a href="GHC.Core.Coercion.html#ltRole"><span class="hs-identifier hs-var">ltRole</span></a></span><span> </span><span class="annot"><span class="annottext">Role
</span><a href="Language.Haskell.Syntax.Basic.html#Representational"><span class="hs-identifier hs-var">Representational</span></a></span><span> </span><span class="annot"><span class="annottext">Role
</span><span class="hs-identifier">_</span></span><span>       </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">False</span></span><span>
</span><span id="line-1538"></span><span class="annot"><a href="GHC.Core.Coercion.html#ltRole"><span class="hs-identifier hs-var">ltRole</span></a></span><span> </span><span class="annot"><span class="annottext">Role
</span><a href="Language.Haskell.Syntax.Basic.html#Nominal"><span class="hs-identifier hs-var">Nominal</span></a></span><span>          </span><span class="annot"><span class="annottext">Role
</span><a href="Language.Haskell.Syntax.Basic.html#Nominal"><span class="hs-identifier hs-var">Nominal</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">False</span></span><span>
</span><span id="line-1539"></span><span class="annot"><a href="GHC.Core.Coercion.html#ltRole"><span class="hs-identifier hs-var">ltRole</span></a></span><span> </span><span class="annot"><span class="annottext">Role
</span><a href="Language.Haskell.Syntax.Basic.html#Nominal"><span class="hs-identifier hs-var">Nominal</span></a></span><span>          </span><span class="annot"><span class="annottext">Role
</span><span class="hs-identifier">_</span></span><span>       </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">True</span></span><span>
</span><span id="line-1540"></span><span>
</span><span id="line-1541"></span><span class="hs-comment">-------------------------------</span><span>
</span><span id="line-1542"></span><span>
</span><span id="line-1543"></span><span class="hs-comment">-- | like mkKindCo, but aggressively &amp; recursively optimizes to avoid using</span><span>
</span><span id="line-1544"></span><span class="hs-comment">-- a KindCo constructor. The output role is nominal.</span><span>
</span><span id="line-1545"></span><span class="annot"><a href="GHC.Core.Coercion.html#promoteCoercion"><span class="hs-identifier hs-type">promoteCoercion</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Utils.Misc.html#HasDebugCallStack"><span class="hs-identifier hs-type">HasDebugCallStack</span></a></span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#Coercion"><span class="hs-identifier hs-type">Coercion</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#CoercionN"><span class="hs-identifier hs-type">CoercionN</span></a></span><span>
</span><span id="line-1546"></span><span>
</span><span id="line-1547"></span><span class="hs-comment">-- First cases handles anything that should yield refl.</span><span>
</span><span id="line-1548"></span><span id="promoteCoercion"><span class="annot"><span class="annottext">promoteCoercion :: HasDebugCallStack =&gt; Coercion -&gt; Coercion
</span><a href="GHC.Core.Coercion.html#promoteCoercion"><span class="hs-identifier hs-var hs-var">promoteCoercion</span></a></span></span><span> </span><span id="local-6989586621682578800"><span class="annot"><span class="annottext">Coercion
</span><a href="#local-6989586621682578800"><span class="hs-identifier hs-var">co</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">Coercion
</span><a href="#local-6989586621682578800"><span class="hs-identifier hs-var">co</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-1549"></span><span>
</span><span id="line-1550"></span><span>    </span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#Refl"><span class="hs-identifier hs-type">Refl</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Type -&gt; Coercion
</span><a href="GHC.Core.Coercion.html#mkNomReflCo"><span class="hs-identifier hs-var">mkNomReflCo</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682578801"><span class="hs-identifier hs-var">ki1</span></a></span><span>
</span><span id="line-1551"></span><span>
</span><span id="line-1552"></span><span>    </span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#GRefl"><span class="hs-identifier hs-type">GRefl</span></a></span><span> </span><span class="annot"><span class="annottext">Role
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">Type
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">MCoercion
</span><a href="GHC.Core.TyCo.Rep.html#MRefl"><span class="hs-identifier hs-var">MRefl</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Type -&gt; Coercion
</span><a href="GHC.Core.Coercion.html#mkNomReflCo"><span class="hs-identifier hs-var">mkNomReflCo</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682578801"><span class="hs-identifier hs-var">ki1</span></a></span><span>
</span><span id="line-1553"></span><span>
</span><span id="line-1554"></span><span>    </span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#GRefl"><span class="hs-identifier hs-type">GRefl</span></a></span><span> </span><span class="annot"><span class="annottext">Role
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">Type
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#MCo"><span class="hs-identifier hs-type">MCo</span></a></span><span> </span><span id="local-6989586621682578802"><span class="annot"><span class="annottext">Coercion
</span><a href="#local-6989586621682578802"><span class="hs-identifier hs-var">co</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Coercion
</span><a href="#local-6989586621682578802"><span class="hs-identifier hs-var">co</span></a></span><span>
</span><span id="line-1555"></span><span>
</span><span id="line-1556"></span><span>    </span><span class="annot"><span class="annottext">Coercion
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682578801"><span class="hs-identifier hs-var">ki1</span></a></span><span> </span><span class="annot"><span class="annottext">HasCallStack =&gt; Type -&gt; Type -&gt; Bool
Type -&gt; Type -&gt; Bool
</span><a href="GHC.Core.TyCo.Compare.html#eqType"><span class="hs-operator hs-var">`eqType`</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682578803"><span class="hs-identifier hs-var">ki2</span></a></span><span>
</span><span id="line-1557"></span><span>      </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Type -&gt; Coercion
</span><a href="GHC.Core.Coercion.html#mkNomReflCo"><span class="hs-identifier hs-var">mkNomReflCo</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">HasDebugCallStack =&gt; Type -&gt; Type
Type -&gt; Type
</span><a href="GHC.Core.Type.html#typeKind"><span class="hs-identifier hs-var">typeKind</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682578804"><span class="hs-identifier hs-var">ty1</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1558"></span><span>     </span><span class="hs-comment">-- No later branch should return refl</span><span>
</span><span id="line-1559"></span><span>     </span><span class="hs-comment">-- The assert (False )s throughout</span><span>
</span><span id="line-1560"></span><span>     </span><span class="hs-comment">-- are these cases explicitly, but they should never fire.</span><span>
</span><span id="line-1561"></span><span>
</span><span id="line-1562"></span><span>    </span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#TyConAppCo"><span class="hs-identifier hs-type">TyConAppCo</span></a></span><span> </span><span class="annot"><span class="annottext">Role
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621682578805"><span class="annot"><span class="annottext">TyCon
</span><a href="#local-6989586621682578805"><span class="hs-identifier hs-var">tc</span></a></span></span><span> </span><span id="local-6989586621682578806"><span class="annot"><span class="annottext">[Coercion]
</span><a href="#local-6989586621682578806"><span class="hs-identifier hs-var">args</span></a></span></span><span>
</span><span id="line-1563"></span><span>      </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span id="local-6989586621682578807"><span class="annot"><span class="annottext">Coercion
</span><a href="#local-6989586621682578807"><span class="hs-identifier hs-var">co'</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Coercion -&gt; [Coercion] -&gt; Maybe Coercion
</span><a href="GHC.Core.Coercion.html#instCoercions"><span class="hs-identifier hs-var">instCoercions</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Type -&gt; Coercion
</span><a href="GHC.Core.Coercion.html#mkNomReflCo"><span class="hs-identifier hs-var">mkNomReflCo</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TyCon -&gt; Type
</span><a href="GHC.Core.TyCon.html#tyConKind"><span class="hs-identifier hs-var">tyConKind</span></a></span><span> </span><span class="annot"><span class="annottext">TyCon
</span><a href="#local-6989586621682578805"><span class="hs-identifier hs-var">tc</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[Coercion]
</span><a href="#local-6989586621682578806"><span class="hs-identifier hs-var">args</span></a></span><span>
</span><span id="line-1564"></span><span>      </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Coercion
</span><a href="#local-6989586621682578807"><span class="hs-identifier hs-var">co'</span></a></span><span>
</span><span id="line-1565"></span><span>      </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">otherwise</span></span><span>
</span><span id="line-1566"></span><span>      </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Coercion -&gt; Coercion
</span><a href="GHC.Core.Coercion.html#mkKindCo"><span class="hs-identifier hs-var">mkKindCo</span></a></span><span> </span><span class="annot"><span class="annottext">Coercion
</span><a href="#local-6989586621682578800"><span class="hs-identifier hs-var">co</span></a></span><span>
</span><span id="line-1567"></span><span>
</span><span id="line-1568"></span><span>    </span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#AppCo"><span class="hs-identifier hs-type">AppCo</span></a></span><span> </span><span id="local-6989586621682578810"><span class="annot"><span class="annottext">Coercion
</span><a href="#local-6989586621682578810"><span class="hs-identifier hs-var">co1</span></a></span></span><span> </span><span id="local-6989586621682578811"><span class="annot"><span class="annottext">Coercion
</span><a href="#local-6989586621682578811"><span class="hs-identifier hs-var">arg</span></a></span></span><span>
</span><span id="line-1569"></span><span>      </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span id="local-6989586621682578812"><span class="annot"><span class="annottext">Coercion
</span><a href="#local-6989586621682578812"><span class="hs-identifier hs-var">co'</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Pair Type -&gt; Coercion -&gt; Coercion -&gt; Maybe Coercion
</span><a href="GHC.Core.Coercion.html#instCoercion"><span class="hs-identifier hs-var">instCoercion</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">HasDebugCallStack =&gt; Coercion -&gt; Pair Type
Coercion -&gt; Pair Type
</span><a href="GHC.Core.Coercion.html#coercionKind"><span class="hs-identifier hs-var">coercionKind</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Coercion -&gt; Coercion
</span><a href="GHC.Core.Coercion.html#mkKindCo"><span class="hs-identifier hs-var">mkKindCo</span></a></span><span> </span><span class="annot"><span class="annottext">Coercion
</span><a href="#local-6989586621682578810"><span class="hs-identifier hs-var">co1</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-1570"></span><span>                                 </span><span class="hs-special">(</span><span class="annot"><span class="annottext">HasDebugCallStack =&gt; Coercion -&gt; Coercion
Coercion -&gt; Coercion
</span><a href="GHC.Core.Coercion.html#promoteCoercion"><span class="hs-identifier hs-var">promoteCoercion</span></a></span><span> </span><span class="annot"><span class="annottext">Coercion
</span><a href="#local-6989586621682578810"><span class="hs-identifier hs-var">co1</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Coercion
</span><a href="#local-6989586621682578811"><span class="hs-identifier hs-var">arg</span></a></span><span>
</span><span id="line-1571"></span><span>      </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Coercion
</span><a href="#local-6989586621682578812"><span class="hs-identifier hs-var">co'</span></a></span><span>
</span><span id="line-1572"></span><span>      </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">otherwise</span></span><span>
</span><span id="line-1573"></span><span>      </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Coercion -&gt; Coercion
</span><a href="GHC.Core.Coercion.html#mkKindCo"><span class="hs-identifier hs-var">mkKindCo</span></a></span><span> </span><span class="annot"><span class="annottext">Coercion
</span><a href="#local-6989586621682578800"><span class="hs-identifier hs-var">co</span></a></span><span>
</span><span id="line-1574"></span><span>
</span><span id="line-1575"></span><span>    </span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#ForAllCo"><span class="hs-identifier hs-type">ForAllCo</span></a></span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">fco_tcv :: Coercion -&gt; CoVar
</span><a href="GHC.Core.TyCo.Rep.html#fco_tcv"><span class="hs-identifier hs-var">fco_tcv</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="local-6989586621682578814"><span class="annot"><span class="annottext">CoVar
</span><a href="#local-6989586621682578814"><span class="hs-identifier hs-var">tv</span></a></span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">fco_body :: Coercion -&gt; Coercion
</span><a href="GHC.Core.TyCo.Rep.html#fco_body"><span class="hs-identifier hs-var">fco_body</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="local-6989586621682578815"><span class="annot"><span class="annottext">Coercion
</span><a href="#local-6989586621682578815"><span class="hs-identifier hs-var">g</span></a></span></span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-1576"></span><span>      </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">CoVar -&gt; Bool
</span><a href="GHC.Types.Var.html#isTyVar"><span class="hs-identifier hs-var">isTyVar</span></a></span><span> </span><span class="annot"><span class="annottext">CoVar
</span><a href="#local-6989586621682578814"><span class="hs-identifier hs-var">tv</span></a></span><span>
</span><span id="line-1577"></span><span>      </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">HasDebugCallStack =&gt; Coercion -&gt; Coercion
Coercion -&gt; Coercion
</span><a href="GHC.Core.Coercion.html#promoteCoercion"><span class="hs-identifier hs-var">promoteCoercion</span></a></span><span> </span><span class="annot"><span class="annottext">Coercion
</span><a href="#local-6989586621682578815"><span class="hs-identifier hs-var">g</span></a></span><span>
</span><span id="line-1578"></span><span>
</span><span id="line-1579"></span><span>    </span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#ForAllCo"><span class="hs-identifier hs-type">ForAllCo</span></a></span><span> </span><span class="hs-special">{</span><span class="hs-special">}</span><span>
</span><span id="line-1580"></span><span>      </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Coercion -&gt; Coercion
forall a. HasCallStack =&gt; Bool -&gt; a -&gt; a
</span><a href="GHC.Utils.Panic.Plain.html#assert"><span class="hs-identifier hs-var">assert</span></a></span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">False</span></span><span> </span><span class="annot"><span class="annottext">(Coercion -&gt; Coercion) -&gt; Coercion -&gt; Coercion
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-1581"></span><span>            </span><span class="hs-comment">-- (ForAllCo {} :: (forall cv.t1) ~ (forall cv.t2)</span><span>
</span><span id="line-1582"></span><span>            </span><span class="hs-comment">-- The tyvar case is handled above, so the bound var is a</span><span>
</span><span id="line-1583"></span><span>            </span><span class="hs-comment">-- a coercion variable. So both sides have kind Type</span><span>
</span><span id="line-1584"></span><span>            </span><span class="hs-comment">-- (Note [Weird typing rule for ForAllTy] in GHC.Core.TyCo.Rep).</span><span>
</span><span id="line-1585"></span><span>            </span><span class="hs-comment">-- So the result is Refl, and that should have been caught by</span><span>
</span><span id="line-1586"></span><span>            </span><span class="hs-comment">-- the first equation above.  Hence `assert False`</span><span>
</span><span id="line-1587"></span><span>         </span><span class="annot"><span class="annottext">Type -&gt; Coercion
</span><a href="GHC.Core.Coercion.html#mkNomReflCo"><span class="hs-identifier hs-var">mkNomReflCo</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="GHC.Builtin.Types.html#liftedTypeKind"><span class="hs-identifier hs-var">liftedTypeKind</span></a></span><span>
</span><span id="line-1588"></span><span>
</span><span id="line-1589"></span><span>    </span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#FunCo"><span class="hs-identifier hs-type">FunCo</span></a></span><span> </span><span class="hs-special">{</span><span class="hs-special">}</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Coercion -&gt; Coercion
</span><a href="GHC.Core.Coercion.html#mkKindCo"><span class="hs-identifier hs-var">mkKindCo</span></a></span><span> </span><span class="annot"><span class="annottext">Coercion
</span><a href="#local-6989586621682578800"><span class="hs-identifier hs-var">co</span></a></span><span>
</span><span id="line-1590"></span><span>       </span><span class="hs-comment">-- We can get Type~Constraint or Constraint~Type</span><span>
</span><span id="line-1591"></span><span>       </span><span class="hs-comment">-- from FunCo {} :: (a -&gt; (b::Type)) ~ (a -=&gt; (b'::Constraint))</span><span>
</span><span id="line-1592"></span><span>
</span><span id="line-1593"></span><span>    </span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#CoVarCo"><span class="hs-identifier hs-type">CoVarCo</span></a></span><span> </span><span class="hs-special">{</span><span class="hs-special">}</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Coercion -&gt; Coercion
</span><a href="GHC.Core.Coercion.html#mkKindCo"><span class="hs-identifier hs-var">mkKindCo</span></a></span><span> </span><span class="annot"><span class="annottext">Coercion
</span><a href="#local-6989586621682578800"><span class="hs-identifier hs-var">co</span></a></span><span>
</span><span id="line-1594"></span><span>    </span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#HoleCo"><span class="hs-identifier hs-type">HoleCo</span></a></span><span> </span><span class="hs-special">{</span><span class="hs-special">}</span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Coercion -&gt; Coercion
</span><a href="GHC.Core.Coercion.html#mkKindCo"><span class="hs-identifier hs-var">mkKindCo</span></a></span><span> </span><span class="annot"><span class="annottext">Coercion
</span><a href="#local-6989586621682578800"><span class="hs-identifier hs-var">co</span></a></span><span>
</span><span id="line-1595"></span><span>    </span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#AxiomCo"><span class="hs-identifier hs-type">AxiomCo</span></a></span><span> </span><span class="hs-special">{</span><span class="hs-special">}</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Coercion -&gt; Coercion
</span><a href="GHC.Core.Coercion.html#mkKindCo"><span class="hs-identifier hs-var">mkKindCo</span></a></span><span> </span><span class="annot"><span class="annottext">Coercion
</span><a href="#local-6989586621682578800"><span class="hs-identifier hs-var">co</span></a></span><span>
</span><span id="line-1596"></span><span>    </span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#UnivCo"><span class="hs-identifier hs-type">UnivCo</span></a></span><span> </span><span class="hs-special">{</span><span class="hs-special">}</span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Coercion -&gt; Coercion
</span><a href="GHC.Core.Coercion.html#mkKindCo"><span class="hs-identifier hs-var">mkKindCo</span></a></span><span> </span><span class="annot"><span class="annottext">Coercion
</span><a href="#local-6989586621682578800"><span class="hs-identifier hs-var">co</span></a></span><span>  </span><span class="hs-comment">-- We could instead return the (single) `uco_deps` coercion in</span><span>
</span><span id="line-1597"></span><span>                               </span><span class="hs-comment">-- the `ProofIrrelProv` and `PhantomProv` cases, but it doesn't</span><span>
</span><span id="line-1598"></span><span>                               </span><span class="hs-comment">-- quite seem worth doing.</span><span>
</span><span id="line-1599"></span><span>
</span><span id="line-1600"></span><span>    </span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#SymCo"><span class="hs-identifier hs-type">SymCo</span></a></span><span> </span><span id="local-6989586621682578817"><span class="annot"><span class="annottext">Coercion
</span><a href="#local-6989586621682578817"><span class="hs-identifier hs-var">g</span></a></span></span><span>
</span><span id="line-1601"></span><span>      </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Coercion -&gt; Coercion
</span><a href="GHC.Core.Coercion.html#mkSymCo"><span class="hs-identifier hs-var">mkSymCo</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">HasDebugCallStack =&gt; Coercion -&gt; Coercion
Coercion -&gt; Coercion
</span><a href="GHC.Core.Coercion.html#promoteCoercion"><span class="hs-identifier hs-var">promoteCoercion</span></a></span><span> </span><span class="annot"><span class="annottext">Coercion
</span><a href="#local-6989586621682578817"><span class="hs-identifier hs-var">g</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1602"></span><span>
</span><span id="line-1603"></span><span>    </span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#TransCo"><span class="hs-identifier hs-type">TransCo</span></a></span><span> </span><span id="local-6989586621682578818"><span class="annot"><span class="annottext">Coercion
</span><a href="#local-6989586621682578818"><span class="hs-identifier hs-var">co1</span></a></span></span><span> </span><span id="local-6989586621682578819"><span class="annot"><span class="annottext">Coercion
</span><a href="#local-6989586621682578819"><span class="hs-identifier hs-var">co2</span></a></span></span><span>
</span><span id="line-1604"></span><span>      </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">HasDebugCallStack =&gt; Coercion -&gt; Coercion -&gt; Coercion
Coercion -&gt; Coercion -&gt; Coercion
</span><a href="GHC.Core.Coercion.html#mkTransCo"><span class="hs-identifier hs-var">mkTransCo</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">HasDebugCallStack =&gt; Coercion -&gt; Coercion
Coercion -&gt; Coercion
</span><a href="GHC.Core.Coercion.html#promoteCoercion"><span class="hs-identifier hs-var">promoteCoercion</span></a></span><span> </span><span class="annot"><span class="annottext">Coercion
</span><a href="#local-6989586621682578818"><span class="hs-identifier hs-var">co1</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">HasDebugCallStack =&gt; Coercion -&gt; Coercion
Coercion -&gt; Coercion
</span><a href="GHC.Core.Coercion.html#promoteCoercion"><span class="hs-identifier hs-var">promoteCoercion</span></a></span><span> </span><span class="annot"><span class="annottext">Coercion
</span><a href="#local-6989586621682578819"><span class="hs-identifier hs-var">co2</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1605"></span><span>
</span><span id="line-1606"></span><span>    </span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#SelCo"><span class="hs-identifier hs-type">SelCo</span></a></span><span> </span><span id="local-6989586621682578820"><span class="annot"><span class="annottext">CoSel
</span><a href="#local-6989586621682578820"><span class="hs-identifier hs-var">n</span></a></span></span><span> </span><span id="local-6989586621682578821"><span class="annot"><span class="annottext">Coercion
</span><a href="#local-6989586621682578821"><span class="hs-identifier hs-var">co1</span></a></span></span><span>
</span><span id="line-1607"></span><span>      </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span id="local-6989586621682578822"><span class="annot"><span class="annottext">Coercion
</span><a href="#local-6989586621682578822"><span class="hs-identifier hs-var">co'</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">HasDebugCallStack =&gt; CoSel -&gt; Coercion -&gt; Maybe Coercion
CoSel -&gt; Coercion -&gt; Maybe Coercion
</span><a href="GHC.Core.Coercion.html#mkSelCo_maybe"><span class="hs-identifier hs-var">mkSelCo_maybe</span></a></span><span> </span><span class="annot"><span class="annottext">CoSel
</span><a href="#local-6989586621682578820"><span class="hs-identifier hs-var">n</span></a></span><span> </span><span class="annot"><span class="annottext">Coercion
</span><a href="#local-6989586621682578821"><span class="hs-identifier hs-var">co1</span></a></span><span>
</span><span id="line-1608"></span><span>      </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">HasDebugCallStack =&gt; Coercion -&gt; Coercion
Coercion -&gt; Coercion
</span><a href="GHC.Core.Coercion.html#promoteCoercion"><span class="hs-identifier hs-var">promoteCoercion</span></a></span><span> </span><span class="annot"><span class="annottext">Coercion
</span><a href="#local-6989586621682578822"><span class="hs-identifier hs-var">co'</span></a></span><span>
</span><span id="line-1609"></span><span>
</span><span id="line-1610"></span><span>      </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">otherwise</span></span><span>
</span><span id="line-1611"></span><span>      </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Coercion -&gt; Coercion
</span><a href="GHC.Core.Coercion.html#mkKindCo"><span class="hs-identifier hs-var">mkKindCo</span></a></span><span> </span><span class="annot"><span class="annottext">Coercion
</span><a href="#local-6989586621682578800"><span class="hs-identifier hs-var">co</span></a></span><span>
</span><span id="line-1612"></span><span>
</span><span id="line-1613"></span><span>    </span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#LRCo"><span class="hs-identifier hs-type">LRCo</span></a></span><span> </span><span id="local-6989586621682578823"><span class="annot"><span class="annottext">LeftOrRight
</span><a href="#local-6989586621682578823"><span class="hs-identifier hs-var">lr</span></a></span></span><span> </span><span id="local-6989586621682578824"><span class="annot"><span class="annottext">Coercion
</span><a href="#local-6989586621682578824"><span class="hs-identifier hs-var">co1</span></a></span></span><span>
</span><span id="line-1614"></span><span>      </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span class="hs-special">(</span><span id="local-6989586621682578825"><span class="annot"><span class="annottext">Coercion
</span><a href="#local-6989586621682578825"><span class="hs-identifier hs-var">lco</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682578826"><span class="annot"><span class="annottext">Coercion
</span><a href="#local-6989586621682578826"><span class="hs-identifier hs-var">rco</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Coercion -&gt; Maybe (Coercion, Coercion)
</span><a href="GHC.Core.Coercion.html#splitAppCo_maybe"><span class="hs-identifier hs-var">splitAppCo_maybe</span></a></span><span> </span><span class="annot"><span class="annottext">Coercion
</span><a href="#local-6989586621682578824"><span class="hs-identifier hs-var">co1</span></a></span><span>
</span><span id="line-1615"></span><span>      </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">LeftOrRight
</span><a href="#local-6989586621682578823"><span class="hs-identifier hs-var">lr</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-1616"></span><span>           </span><span class="annot"><span class="annottext">LeftOrRight
</span><a href="GHC.Types.Basic.html#CLeft"><span class="hs-identifier hs-var">CLeft</span></a></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">HasDebugCallStack =&gt; Coercion -&gt; Coercion
Coercion -&gt; Coercion
</span><a href="GHC.Core.Coercion.html#promoteCoercion"><span class="hs-identifier hs-var">promoteCoercion</span></a></span><span> </span><span class="annot"><span class="annottext">Coercion
</span><a href="#local-6989586621682578825"><span class="hs-identifier hs-var">lco</span></a></span><span>
</span><span id="line-1617"></span><span>           </span><span class="annot"><span class="annottext">LeftOrRight
</span><a href="GHC.Types.Basic.html#CRight"><span class="hs-identifier hs-var">CRight</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">HasDebugCallStack =&gt; Coercion -&gt; Coercion
Coercion -&gt; Coercion
</span><a href="GHC.Core.Coercion.html#promoteCoercion"><span class="hs-identifier hs-var">promoteCoercion</span></a></span><span> </span><span class="annot"><span class="annottext">Coercion
</span><a href="#local-6989586621682578826"><span class="hs-identifier hs-var">rco</span></a></span><span>
</span><span id="line-1618"></span><span>
</span><span id="line-1619"></span><span>      </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">otherwise</span></span><span>
</span><span id="line-1620"></span><span>      </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Coercion -&gt; Coercion
</span><a href="GHC.Core.Coercion.html#mkKindCo"><span class="hs-identifier hs-var">mkKindCo</span></a></span><span> </span><span class="annot"><span class="annottext">Coercion
</span><a href="#local-6989586621682578800"><span class="hs-identifier hs-var">co</span></a></span><span>
</span><span id="line-1621"></span><span>
</span><span id="line-1622"></span><span>    </span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#InstCo"><span class="hs-identifier hs-type">InstCo</span></a></span><span> </span><span id="local-6989586621682578829"><span class="annot"><span class="annottext">Coercion
</span><a href="#local-6989586621682578829"><span class="hs-identifier hs-var">g</span></a></span></span><span> </span><span class="annot"><span class="annottext">Coercion
</span><span class="hs-identifier">_</span></span><span>
</span><span id="line-1623"></span><span>      </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Type -&gt; Bool
</span><a href="GHC.Core.Type.html#isForAllTy_ty"><span class="hs-identifier hs-var">isForAllTy_ty</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682578804"><span class="hs-identifier hs-var">ty1</span></a></span><span>
</span><span id="line-1624"></span><span>      </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Coercion -&gt; Coercion
forall a. HasCallStack =&gt; Bool -&gt; a -&gt; a
</span><a href="GHC.Utils.Panic.Plain.html#assert"><span class="hs-identifier hs-var">assert</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Type -&gt; Bool
</span><a href="GHC.Core.Type.html#isForAllTy_ty"><span class="hs-identifier hs-var">isForAllTy_ty</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682578831"><span class="hs-identifier hs-var">ty2</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(Coercion -&gt; Coercion) -&gt; Coercion -&gt; Coercion
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-1625"></span><span>         </span><span class="annot"><span class="annottext">HasDebugCallStack =&gt; Coercion -&gt; Coercion
Coercion -&gt; Coercion
</span><a href="GHC.Core.Coercion.html#promoteCoercion"><span class="hs-identifier hs-var">promoteCoercion</span></a></span><span> </span><span class="annot"><span class="annottext">Coercion
</span><a href="#local-6989586621682578829"><span class="hs-identifier hs-var">g</span></a></span><span>
</span><span id="line-1626"></span><span>      </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">otherwise</span></span><span>
</span><span id="line-1627"></span><span>      </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Coercion -&gt; Coercion
forall a. HasCallStack =&gt; Bool -&gt; a -&gt; a
</span><a href="GHC.Utils.Panic.Plain.html#assert"><span class="hs-identifier hs-var">assert</span></a></span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">False</span></span><span> </span><span class="annot"><span class="annottext">(Coercion -&gt; Coercion) -&gt; Coercion -&gt; Coercion
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-1628"></span><span>         </span><span class="annot"><span class="annottext">Type -&gt; Coercion
</span><a href="GHC.Core.Coercion.html#mkNomReflCo"><span class="hs-identifier hs-var">mkNomReflCo</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="GHC.Builtin.Types.html#liftedTypeKind"><span class="hs-identifier hs-var">liftedTypeKind</span></a></span><span>
</span><span id="line-1629"></span><span>           </span><span class="hs-comment">-- See Note [Weird typing rule for ForAllTy] in GHC.Core.TyCo.Rep</span><span>
</span><span id="line-1630"></span><span>
</span><span id="line-1631"></span><span>    </span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#KindCo"><span class="hs-identifier hs-type">KindCo</span></a></span><span> </span><span class="annot"><span class="annottext">Coercion
</span><span class="hs-identifier">_</span></span><span>
</span><span id="line-1632"></span><span>      </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Coercion -&gt; Coercion
forall a. HasCallStack =&gt; Bool -&gt; a -&gt; a
</span><a href="GHC.Utils.Panic.Plain.html#assert"><span class="hs-identifier hs-var">assert</span></a></span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">False</span></span><span> </span><span class="annot"><span class="annottext">(Coercion -&gt; Coercion) -&gt; Coercion -&gt; Coercion
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-comment">-- See the first equation above</span><span>
</span><span id="line-1633"></span><span>         </span><span class="annot"><span class="annottext">Type -&gt; Coercion
</span><a href="GHC.Core.Coercion.html#mkNomReflCo"><span class="hs-identifier hs-var">mkNomReflCo</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="GHC.Builtin.Types.html#liftedTypeKind"><span class="hs-identifier hs-var">liftedTypeKind</span></a></span><span>
</span><span id="line-1634"></span><span>
</span><span id="line-1635"></span><span>    </span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#SubCo"><span class="hs-identifier hs-type">SubCo</span></a></span><span> </span><span id="local-6989586621682578832"><span class="annot"><span class="annottext">Coercion
</span><a href="#local-6989586621682578832"><span class="hs-identifier hs-var">g</span></a></span></span><span>
</span><span id="line-1636"></span><span>      </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">HasDebugCallStack =&gt; Coercion -&gt; Coercion
Coercion -&gt; Coercion
</span><a href="GHC.Core.Coercion.html#promoteCoercion"><span class="hs-identifier hs-var">promoteCoercion</span></a></span><span> </span><span class="annot"><span class="annottext">Coercion
</span><a href="#local-6989586621682578832"><span class="hs-identifier hs-var">g</span></a></span><span>
</span><span id="line-1637"></span><span>
</span><span id="line-1638"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-1639"></span><span>    </span><span class="annot"><a href="GHC.Data.Pair.html#Pair"><span class="hs-identifier hs-type">Pair</span></a></span><span> </span><span id="local-6989586621682578804"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682578804"><span class="hs-identifier hs-var">ty1</span></a></span></span><span> </span><span id="local-6989586621682578831"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682578831"><span class="hs-identifier hs-var">ty2</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">HasDebugCallStack =&gt; Coercion -&gt; Pair Type
Coercion -&gt; Pair Type
</span><a href="GHC.Core.Coercion.html#coercionKind"><span class="hs-identifier hs-var">coercionKind</span></a></span><span> </span><span class="annot"><span class="annottext">Coercion
</span><a href="#local-6989586621682578800"><span class="hs-identifier hs-var">co</span></a></span><span>
</span><span id="line-1640"></span><span>    </span><span id="local-6989586621682578801"><span class="annot"><span class="annottext">ki1 :: Type
</span><a href="#local-6989586621682578801"><span class="hs-identifier hs-var hs-var">ki1</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">HasDebugCallStack =&gt; Type -&gt; Type
Type -&gt; Type
</span><a href="GHC.Core.Type.html#typeKind"><span class="hs-identifier hs-var">typeKind</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682578804"><span class="hs-identifier hs-var">ty1</span></a></span><span>
</span><span id="line-1641"></span><span>    </span><span id="local-6989586621682578803"><span class="annot"><span class="annottext">ki2 :: Type
</span><a href="#local-6989586621682578803"><span class="hs-identifier hs-var hs-var">ki2</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">HasDebugCallStack =&gt; Type -&gt; Type
Type -&gt; Type
</span><a href="GHC.Core.Type.html#typeKind"><span class="hs-identifier hs-var">typeKind</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682578831"><span class="hs-identifier hs-var">ty2</span></a></span><span>
</span><span id="line-1642"></span><span>
</span><span id="line-1643"></span><span class="hs-comment">-- | say @g = promoteCoercion h@. Then, @instCoercion g w@ yields @Just g'@,</span><span>
</span><span id="line-1644"></span><span class="hs-comment">-- where @g' = promoteCoercion (h w)@.</span><span>
</span><span id="line-1645"></span><span class="hs-comment">-- fails if this is not possible, if @g@ coerces between a forall and an -&gt;</span><span>
</span><span id="line-1646"></span><span class="hs-comment">-- or if second parameter has a representational role and can't be used</span><span>
</span><span id="line-1647"></span><span class="hs-comment">-- with an InstCo.</span><span>
</span><span id="line-1648"></span><span class="annot"><a href="GHC.Core.Coercion.html#instCoercion"><span class="hs-identifier hs-type">instCoercion</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Data.Pair.html#Pair"><span class="hs-identifier hs-type">Pair</span></a></span><span> </span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#Type"><span class="hs-identifier hs-type">Type</span></a></span><span> </span><span class="hs-comment">-- g :: lty ~ rty</span><span>
</span><span id="line-1649"></span><span>             </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#CoercionN"><span class="hs-identifier hs-type">CoercionN</span></a></span><span>  </span><span class="annot"><span class="hs-comment">-- ^  must be nominal</span></span><span>
</span><span id="line-1650"></span><span>             </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#Coercion"><span class="hs-identifier hs-type">Coercion</span></a></span><span>
</span><span id="line-1651"></span><span>             </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Maybe</span></span><span> </span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#CoercionN"><span class="hs-identifier hs-type">CoercionN</span></a></span><span>
</span><span id="line-1652"></span><span id="instCoercion"><span class="annot"><span class="annottext">instCoercion :: Pair Type -&gt; Coercion -&gt; Coercion -&gt; Maybe Coercion
</span><a href="GHC.Core.Coercion.html#instCoercion"><span class="hs-identifier hs-var hs-var">instCoercion</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Data.Pair.html#Pair"><span class="hs-identifier hs-type">Pair</span></a></span><span> </span><span id="local-6989586621682578833"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682578833"><span class="hs-identifier hs-var">lty</span></a></span></span><span> </span><span id="local-6989586621682578834"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682578834"><span class="hs-identifier hs-var">rty</span></a></span></span><span class="hs-special">)</span><span> </span><span id="local-6989586621682578835"><span class="annot"><span class="annottext">Coercion
</span><a href="#local-6989586621682578835"><span class="hs-identifier hs-var">g</span></a></span></span><span> </span><span id="local-6989586621682578836"><span class="annot"><span class="annottext">Coercion
</span><a href="#local-6989586621682578836"><span class="hs-identifier hs-var">w</span></a></span></span><span>
</span><span id="line-1653"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Type -&gt; Bool
</span><a href="GHC.Core.Type.html#isForAllTy_ty"><span class="hs-identifier hs-var">isForAllTy_ty</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682578833"><span class="hs-identifier hs-var">lty</span></a></span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Bool -&gt; Bool
</span><span class="hs-operator hs-var">&amp;&amp;</span></span><span> </span><span class="annot"><span class="annottext">Type -&gt; Bool
</span><a href="GHC.Core.Type.html#isForAllTy_ty"><span class="hs-identifier hs-var">isForAllTy_ty</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682578834"><span class="hs-identifier hs-var">rty</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1654"></span><span>  </span><span class="annot"><span class="annottext">Bool -&gt; Bool -&gt; Bool
</span><span class="hs-operator hs-var">||</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Type -&gt; Bool
</span><a href="GHC.Core.Type.html#isForAllTy_co"><span class="hs-identifier hs-var">isForAllTy_co</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682578833"><span class="hs-identifier hs-var">lty</span></a></span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Bool -&gt; Bool
</span><span class="hs-operator hs-var">&amp;&amp;</span></span><span> </span><span class="annot"><span class="annottext">Type -&gt; Bool
</span><a href="GHC.Core.Type.html#isForAllTy_co"><span class="hs-identifier hs-var">isForAllTy_co</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682578834"><span class="hs-identifier hs-var">rty</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1655"></span><span>  </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span id="local-6989586621682578838"><span class="annot"><span class="annottext">Coercion
</span><a href="#local-6989586621682578838"><span class="hs-identifier hs-var">w'</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Role -&gt; Coercion -&gt; Maybe Coercion
</span><a href="GHC.Core.Coercion.html#setNominalRole_maybe"><span class="hs-identifier hs-var">setNominalRole_maybe</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Coercion -&gt; Role
</span><a href="GHC.Core.Coercion.html#coercionRole"><span class="hs-identifier hs-var">coercionRole</span></a></span><span> </span><span class="annot"><span class="annottext">Coercion
</span><a href="#local-6989586621682578836"><span class="hs-identifier hs-var">w</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Coercion
</span><a href="#local-6989586621682578836"><span class="hs-identifier hs-var">w</span></a></span><span>
</span><span id="line-1656"></span><span>    </span><span class="hs-comment">-- g :: (forall t1. t2) ~ (forall t1. t3)</span><span>
</span><span id="line-1657"></span><span>    </span><span class="hs-comment">-- w :: s1 ~ s2</span><span>
</span><span id="line-1658"></span><span>    </span><span class="hs-comment">-- returns mkInstCo g w' :: t2 [t1 |-&gt; s1 ] ~ t3 [t1 |-&gt; s2]</span><span>
</span><span id="line-1659"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Coercion -&gt; Maybe Coercion
forall a. a -&gt; Maybe a
</span><span class="hs-identifier hs-var">Just</span></span><span> </span><span class="annot"><span class="annottext">(Coercion -&gt; Maybe Coercion) -&gt; Coercion -&gt; Maybe Coercion
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Coercion -&gt; Coercion -&gt; Coercion
</span><a href="GHC.Core.Coercion.html#mkInstCo"><span class="hs-identifier hs-var">mkInstCo</span></a></span><span> </span><span class="annot"><span class="annottext">Coercion
</span><a href="#local-6989586621682578835"><span class="hs-identifier hs-var">g</span></a></span><span> </span><span class="annot"><span class="annottext">Coercion
</span><a href="#local-6989586621682578838"><span class="hs-identifier hs-var">w'</span></a></span><span>
</span><span id="line-1660"></span><span>
</span><span id="line-1661"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Type -&gt; Bool
</span><a href="GHC.Core.Type.html#isFunTy"><span class="hs-identifier hs-var">isFunTy</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682578833"><span class="hs-identifier hs-var">lty</span></a></span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Bool -&gt; Bool
</span><span class="hs-operator hs-var">&amp;&amp;</span></span><span> </span><span class="annot"><span class="annottext">Type -&gt; Bool
</span><a href="GHC.Core.Type.html#isFunTy"><span class="hs-identifier hs-var">isFunTy</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682578834"><span class="hs-identifier hs-var">rty</span></a></span><span>
</span><span id="line-1662"></span><span>    </span><span class="hs-comment">-- g :: (t1 -&gt; t2) ~ (t3 -&gt; t4)</span><span>
</span><span id="line-1663"></span><span>    </span><span class="hs-comment">-- returns t2 ~ t4</span><span>
</span><span id="line-1664"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Coercion -&gt; Maybe Coercion
forall a. a -&gt; Maybe a
</span><span class="hs-identifier hs-var">Just</span></span><span> </span><span class="annot"><span class="annottext">(Coercion -&gt; Maybe Coercion) -&gt; Coercion -&gt; Maybe Coercion
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">HasDebugCallStack =&gt; CoSel -&gt; Coercion -&gt; Coercion
CoSel -&gt; Coercion -&gt; Coercion
</span><a href="GHC.Core.Coercion.html#mkSelCo"><span class="hs-identifier hs-var">mkSelCo</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">FunSel -&gt; CoSel
</span><a href="GHC.Core.TyCo.Rep.html#SelFun"><span class="hs-identifier hs-var">SelFun</span></a></span><span> </span><span class="annot"><span class="annottext">FunSel
</span><a href="GHC.Core.TyCo.Rep.html#SelRes"><span class="hs-identifier hs-var">SelRes</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Coercion
</span><a href="#local-6989586621682578835"><span class="hs-identifier hs-var">g</span></a></span><span> </span><span class="hs-comment">-- extract result type</span><span>
</span><span id="line-1665"></span><span>
</span><span id="line-1666"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">otherwise</span></span><span> </span><span class="hs-comment">-- one forall, one funty...</span><span>
</span><span id="line-1667"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Maybe Coercion
forall a. Maybe a
</span><span class="hs-identifier hs-var">Nothing</span></span><span>
</span><span id="line-1668"></span><span>
</span><span id="line-1669"></span><span class="annot"><span class="hs-comment">-- | Repeated use of 'instCoercion'</span></span><span>
</span><span id="line-1670"></span><span class="annot"><a href="GHC.Core.Coercion.html#instCoercions"><span class="hs-identifier hs-type">instCoercions</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#CoercionN"><span class="hs-identifier hs-type">CoercionN</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#Coercion"><span class="hs-identifier hs-type">Coercion</span></a></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Maybe</span></span><span> </span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#CoercionN"><span class="hs-identifier hs-type">CoercionN</span></a></span><span>
</span><span id="line-1671"></span><span id="instCoercions"><span class="annot"><span class="annottext">instCoercions :: Coercion -&gt; [Coercion] -&gt; Maybe Coercion
</span><a href="GHC.Core.Coercion.html#instCoercions"><span class="hs-identifier hs-var hs-var">instCoercions</span></a></span></span><span> </span><span id="local-6989586621682578839"><span class="annot"><span class="annottext">Coercion
</span><a href="#local-6989586621682578839"><span class="hs-identifier hs-var">g</span></a></span></span><span> </span><span id="local-6989586621682578840"><span class="annot"><span class="annottext">[Coercion]
</span><a href="#local-6989586621682578840"><span class="hs-identifier hs-var">ws</span></a></span></span><span>
</span><span id="line-1672"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621682578841"><span class="annot"><span class="annottext">arg_ty_pairs :: [Pair Type]
</span><a href="#local-6989586621682578841"><span class="hs-identifier hs-var hs-var">arg_ty_pairs</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(Coercion -&gt; Pair Type) -&gt; [Coercion] -&gt; [Pair Type]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><span class="hs-identifier hs-var">map</span></span><span> </span><span class="annot"><span class="annottext">HasDebugCallStack =&gt; Coercion -&gt; Pair Type
Coercion -&gt; Pair Type
</span><a href="GHC.Core.Coercion.html#coercionKind"><span class="hs-identifier hs-var">coercionKind</span></a></span><span> </span><span class="annot"><span class="annottext">[Coercion]
</span><a href="#local-6989586621682578840"><span class="hs-identifier hs-var">ws</span></a></span><span> </span><span class="hs-keyword">in</span><span>
</span><span id="line-1673"></span><span>    </span><span class="annot"><span class="annottext">(Pair Type, Coercion) -&gt; Coercion
forall a b. (a, b) -&gt; b
</span><span class="hs-identifier hs-var">snd</span></span><span> </span><span class="annot"><span class="annottext">((Pair Type, Coercion) -&gt; Coercion)
-&gt; Maybe (Pair Type, Coercion) -&gt; Maybe Coercion
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="annot"><span class="annottext">((Pair Type, Coercion)
 -&gt; (Pair Type, Coercion) -&gt; Maybe (Pair Type, Coercion))
-&gt; (Pair Type, Coercion)
-&gt; [(Pair Type, Coercion)]
-&gt; Maybe (Pair Type, Coercion)
forall (t :: * -&gt; *) (m :: * -&gt; *) b a.
(Foldable t, Monad m) =&gt;
(b -&gt; a -&gt; m b) -&gt; b -&gt; t a -&gt; m b
</span><span class="hs-identifier hs-var">foldM</span></span><span> </span><span class="annot"><span class="annottext">(Pair Type, Coercion)
-&gt; (Pair Type, Coercion) -&gt; Maybe (Pair Type, Coercion)
</span><a href="#local-6989586621682578843"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">HasDebugCallStack =&gt; Coercion -&gt; Pair Type
Coercion -&gt; Pair Type
</span><a href="GHC.Core.Coercion.html#coercionKind"><span class="hs-identifier hs-var">coercionKind</span></a></span><span> </span><span class="annot"><span class="annottext">Coercion
</span><a href="#local-6989586621682578839"><span class="hs-identifier hs-var">g</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Coercion
</span><a href="#local-6989586621682578839"><span class="hs-identifier hs-var">g</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[Pair Type] -&gt; [Coercion] -&gt; [(Pair Type, Coercion)]
forall a b. [a] -&gt; [b] -&gt; [(a, b)]
</span><span class="hs-identifier hs-var">zip</span></span><span> </span><span class="annot"><span class="annottext">[Pair Type]
</span><a href="#local-6989586621682578841"><span class="hs-identifier hs-var">arg_ty_pairs</span></a></span><span> </span><span class="annot"><span class="annottext">[Coercion]
</span><a href="#local-6989586621682578840"><span class="hs-identifier hs-var">ws</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1674"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-1675"></span><span>    </span><span class="annot"><a href="#local-6989586621682578843"><span class="hs-identifier hs-type">go</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Data.Pair.html#Pair"><span class="hs-identifier hs-type">Pair</span></a></span><span> </span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#Type"><span class="hs-identifier hs-type">Type</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#Coercion"><span class="hs-identifier hs-type">Coercion</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Data.Pair.html#Pair"><span class="hs-identifier hs-type">Pair</span></a></span><span> </span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#Type"><span class="hs-identifier hs-type">Type</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#Coercion"><span class="hs-identifier hs-type">Coercion</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1676"></span><span>       </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Maybe</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Data.Pair.html#Pair"><span class="hs-identifier hs-type">Pair</span></a></span><span> </span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#Type"><span class="hs-identifier hs-type">Type</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#Coercion"><span class="hs-identifier hs-type">Coercion</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1677"></span><span>    </span><span id="local-6989586621682578843"><span class="annot"><span class="annottext">go :: (Pair Type, Coercion)
-&gt; (Pair Type, Coercion) -&gt; Maybe (Pair Type, Coercion)
</span><a href="#local-6989586621682578843"><span class="hs-identifier hs-var hs-var">go</span></a></span></span><span> </span><span class="hs-special">(</span><span id="local-6989586621682578844"><span class="annot"><span class="annottext">Pair Type
</span><a href="#local-6989586621682578844"><span class="hs-identifier hs-var">g_tys</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682578845"><span class="annot"><span class="annottext">Coercion
</span><a href="#local-6989586621682578845"><span class="hs-identifier hs-var">g</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span id="local-6989586621682578846"><span class="annot"><span class="annottext">Pair Type
</span><a href="#local-6989586621682578846"><span class="hs-identifier hs-var">w_tys</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682578847"><span class="annot"><span class="annottext">Coercion
</span><a href="#local-6989586621682578847"><span class="hs-identifier hs-var">w</span></a></span></span><span class="hs-special">)</span><span>
</span><span id="line-1678"></span><span>      </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span id="local-6989586621682578848"><span class="annot"><a href="#local-6989586621682578848"><span class="hs-identifier hs-var">g'</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Pair Type -&gt; Coercion -&gt; Coercion -&gt; Maybe Coercion
</span><a href="GHC.Core.Coercion.html#instCoercion"><span class="hs-identifier hs-var">instCoercion</span></a></span><span> </span><span class="annot"><span class="annottext">Pair Type
</span><a href="#local-6989586621682578844"><span class="hs-identifier hs-var">g_tys</span></a></span><span> </span><span class="annot"><span class="annottext">Coercion
</span><a href="#local-6989586621682578845"><span class="hs-identifier hs-var">g</span></a></span><span> </span><span class="annot"><span class="annottext">Coercion
</span><a href="#local-6989586621682578847"><span class="hs-identifier hs-var">w</span></a></span><span>
</span><span id="line-1679"></span><span>           </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">return</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Core.Type.html#piResultTy"><span class="hs-identifier hs-type">piResultTy</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">&lt;$&gt;</span></span><span> </span><span class="annot"><a href="#local-6989586621682578844"><span class="hs-identifier hs-type">g_tys</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">&lt;*&gt;</span></span><span> </span><span class="annot"><a href="#local-6989586621682578846"><span class="hs-identifier hs-type">w_tys</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="#local-6989586621682578848"><span class="hs-identifier hs-type">g'</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-1680"></span><span>
</span><span id="line-1681"></span><span class="hs-comment">-- | Creates a new coercion with both of its types casted by different casts</span><span>
</span><span id="line-1682"></span><span class="hs-comment">-- @castCoercionKind2 g r t1 t2 h1 h2@, where @g :: t1 ~r t2@,</span><span>
</span><span id="line-1683"></span><span class="hs-comment">-- has type @(t1 |&gt; h1) ~r (t2 |&gt; h2)@.</span><span>
</span><span id="line-1684"></span><span class="hs-comment">-- @h1@ and @h2@ must be nominal.</span><span>
</span><span id="line-1685"></span><span class="annot"><a href="GHC.Core.Coercion.html#castCoercionKind2"><span class="hs-identifier hs-type">castCoercionKind2</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#Coercion"><span class="hs-identifier hs-type">Coercion</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Language.Haskell.Syntax.Basic.html#Role"><span class="hs-identifier hs-type">Role</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#Type"><span class="hs-identifier hs-type">Type</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#Type"><span class="hs-identifier hs-type">Type</span></a></span><span>
</span><span id="line-1686"></span><span>                 </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#CoercionN"><span class="hs-identifier hs-type">CoercionN</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#CoercionN"><span class="hs-identifier hs-type">CoercionN</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#Coercion"><span class="hs-identifier hs-type">Coercion</span></a></span><span>
</span><span id="line-1687"></span><span id="castCoercionKind2"><span class="annot"><span class="annottext">castCoercionKind2 :: Coercion
-&gt; Role -&gt; Type -&gt; Type -&gt; Coercion -&gt; Coercion -&gt; Coercion
</span><a href="GHC.Core.Coercion.html#castCoercionKind2"><span class="hs-identifier hs-var hs-var">castCoercionKind2</span></a></span></span><span> </span><span id="local-6989586621682578850"><span class="annot"><span class="annottext">Coercion
</span><a href="#local-6989586621682578850"><span class="hs-identifier hs-var">g</span></a></span></span><span> </span><span id="local-6989586621682578851"><span class="annot"><span class="annottext">Role
</span><a href="#local-6989586621682578851"><span class="hs-identifier hs-var">r</span></a></span></span><span> </span><span id="local-6989586621682578852"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682578852"><span class="hs-identifier hs-var">t1</span></a></span></span><span> </span><span id="local-6989586621682578853"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682578853"><span class="hs-identifier hs-var">t2</span></a></span></span><span> </span><span id="local-6989586621682578854"><span class="annot"><span class="annottext">Coercion
</span><a href="#local-6989586621682578854"><span class="hs-identifier hs-var">h1</span></a></span></span><span> </span><span id="local-6989586621682578855"><span class="annot"><span class="annottext">Coercion
</span><a href="#local-6989586621682578855"><span class="hs-identifier hs-var">h2</span></a></span></span><span>
</span><span id="line-1688"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">HasDebugCallStack =&gt;
Role -&gt; Type -&gt; Coercion -&gt; Coercion -&gt; Coercion
Role -&gt; Type -&gt; Coercion -&gt; Coercion -&gt; Coercion
</span><a href="GHC.Core.Coercion.html#mkCoherenceRightCo"><span class="hs-identifier hs-var">mkCoherenceRightCo</span></a></span><span> </span><span class="annot"><span class="annottext">Role
</span><a href="#local-6989586621682578851"><span class="hs-identifier hs-var">r</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682578853"><span class="hs-identifier hs-var">t2</span></a></span><span> </span><span class="annot"><span class="annottext">Coercion
</span><a href="#local-6989586621682578855"><span class="hs-identifier hs-var">h2</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Role -&gt; Type -&gt; Coercion -&gt; Coercion -&gt; Coercion
</span><a href="GHC.Core.Coercion.html#mkCoherenceLeftCo"><span class="hs-identifier hs-var">mkCoherenceLeftCo</span></a></span><span> </span><span class="annot"><span class="annottext">Role
</span><a href="#local-6989586621682578851"><span class="hs-identifier hs-var">r</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682578852"><span class="hs-identifier hs-var">t1</span></a></span><span> </span><span class="annot"><span class="annottext">Coercion
</span><a href="#local-6989586621682578854"><span class="hs-identifier hs-var">h1</span></a></span><span> </span><span class="annot"><span class="annottext">Coercion
</span><a href="#local-6989586621682578850"><span class="hs-identifier hs-var">g</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1689"></span><span>
</span><span id="line-1690"></span><span class="hs-comment">-- | @castCoercionKind1 g r t1 t2 h@ = @coercionKind g r t1 t2 h h@</span><span>
</span><span id="line-1691"></span><span class="hs-comment">-- That is, it's a specialised form of castCoercionKind, where the two</span><span>
</span><span id="line-1692"></span><span class="hs-comment">--          kind coercions are identical</span><span>
</span><span id="line-1693"></span><span class="hs-comment">-- @castCoercionKind1 g r t1 t2 h@, where @g :: t1 ~r t2@,</span><span>
</span><span id="line-1694"></span><span class="hs-comment">-- has type @(t1 |&gt; h) ~r (t2 |&gt; h)@.</span><span>
</span><span id="line-1695"></span><span class="hs-comment">-- @h@ must be nominal.</span><span>
</span><span id="line-1696"></span><span class="hs-comment">-- See Note [castCoercionKind1]</span><span>
</span><span id="line-1697"></span><span class="annot"><a href="GHC.Core.Coercion.html#castCoercionKind1"><span class="hs-identifier hs-type">castCoercionKind1</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#Coercion"><span class="hs-identifier hs-type">Coercion</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Language.Haskell.Syntax.Basic.html#Role"><span class="hs-identifier hs-type">Role</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#Type"><span class="hs-identifier hs-type">Type</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#Type"><span class="hs-identifier hs-type">Type</span></a></span><span>
</span><span id="line-1698"></span><span>                  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#CoercionN"><span class="hs-identifier hs-type">CoercionN</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#Coercion"><span class="hs-identifier hs-type">Coercion</span></a></span><span>
</span><span id="line-1699"></span><span id="castCoercionKind1"><span class="annot"><span class="annottext">castCoercionKind1 :: Coercion -&gt; Role -&gt; Type -&gt; Type -&gt; Coercion -&gt; Coercion
</span><a href="GHC.Core.Coercion.html#castCoercionKind1"><span class="hs-identifier hs-var hs-var">castCoercionKind1</span></a></span></span><span> </span><span id="local-6989586621682578856"><span class="annot"><span class="annottext">Coercion
</span><a href="#local-6989586621682578856"><span class="hs-identifier hs-var">g</span></a></span></span><span> </span><span id="local-6989586621682578857"><span class="annot"><span class="annottext">Role
</span><a href="#local-6989586621682578857"><span class="hs-identifier hs-var">r</span></a></span></span><span> </span><span id="local-6989586621682578858"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682578858"><span class="hs-identifier hs-var">t1</span></a></span></span><span> </span><span id="local-6989586621682578859"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682578859"><span class="hs-identifier hs-var">t2</span></a></span></span><span> </span><span id="local-6989586621682578860"><span class="annot"><span class="annottext">Coercion
</span><a href="#local-6989586621682578860"><span class="hs-identifier hs-var">h</span></a></span></span><span>
</span><span id="line-1700"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">Coercion
</span><a href="#local-6989586621682578856"><span class="hs-identifier hs-var">g</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-1701"></span><span>      </span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#Refl"><span class="hs-identifier hs-type">Refl</span></a></span><span> </span><span class="hs-special">{</span><span class="hs-special">}</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Coercion -&gt; Coercion
forall a. HasCallStack =&gt; Bool -&gt; a -&gt; a
</span><a href="GHC.Utils.Panic.Plain.html#assert"><span class="hs-identifier hs-var">assert</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Role
</span><a href="#local-6989586621682578857"><span class="hs-identifier hs-var">r</span></a></span><span> </span><span class="annot"><span class="annottext">Role -&gt; Role -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">==</span></span><span> </span><span class="annot"><span class="annottext">Role
</span><a href="Language.Haskell.Syntax.Basic.html#Nominal"><span class="hs-identifier hs-var">Nominal</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(Coercion -&gt; Coercion) -&gt; Coercion -&gt; Coercion
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-comment">-- Refl is always Nominal</span><span>
</span><span id="line-1702"></span><span>                 </span><span class="annot"><span class="annottext">Type -&gt; Coercion
</span><a href="GHC.Core.Coercion.html#mkNomReflCo"><span class="hs-identifier hs-var">mkNomReflCo</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Type -&gt; Coercion -&gt; Type
</span><a href="GHC.Core.Type.html#mkCastTy"><span class="hs-identifier hs-var">mkCastTy</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682578859"><span class="hs-identifier hs-var">t2</span></a></span><span> </span><span class="annot"><span class="annottext">Coercion
</span><a href="#local-6989586621682578860"><span class="hs-identifier hs-var">h</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1703"></span><span>      </span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#GRefl"><span class="hs-identifier hs-type">GRefl</span></a></span><span> </span><span class="annot"><span class="annottext">Role
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">Type
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621682578861"><span class="annot"><span class="annottext">MCoercion
</span><a href="#local-6989586621682578861"><span class="hs-identifier hs-var">mco</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">MCoercion
</span><a href="#local-6989586621682578861"><span class="hs-identifier hs-var">mco</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-1704"></span><span>           </span><span class="annot"><span class="annottext">MCoercion
</span><a href="GHC.Core.TyCo.Rep.html#MRefl"><span class="hs-identifier hs-var">MRefl</span></a></span><span>       </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Role -&gt; Type -&gt; Coercion
</span><a href="GHC.Core.Coercion.html#mkReflCo"><span class="hs-identifier hs-var">mkReflCo</span></a></span><span> </span><span class="annot"><span class="annottext">Role
</span><a href="#local-6989586621682578857"><span class="hs-identifier hs-var">r</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Type -&gt; Coercion -&gt; Type
</span><a href="GHC.Core.Type.html#mkCastTy"><span class="hs-identifier hs-var">mkCastTy</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682578859"><span class="hs-identifier hs-var">t2</span></a></span><span> </span><span class="annot"><span class="annottext">Coercion
</span><a href="#local-6989586621682578860"><span class="hs-identifier hs-var">h</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1705"></span><span>           </span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#MCo"><span class="hs-identifier hs-type">MCo</span></a></span><span> </span><span id="local-6989586621682578862"><span class="annot"><span class="annottext">Coercion
</span><a href="#local-6989586621682578862"><span class="hs-identifier hs-var">kind_co</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">HasDebugCallStack =&gt; Role -&gt; Type -&gt; Coercion -&gt; Coercion
Role -&gt; Type -&gt; Coercion -&gt; Coercion
</span><a href="GHC.Core.Coercion.html#mkGReflMCo"><span class="hs-identifier hs-var">mkGReflMCo</span></a></span><span> </span><span class="annot"><span class="annottext">Role
</span><a href="#local-6989586621682578857"><span class="hs-identifier hs-var">r</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Type -&gt; Coercion -&gt; Type
</span><a href="GHC.Core.Type.html#mkCastTy"><span class="hs-identifier hs-var">mkCastTy</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682578858"><span class="hs-identifier hs-var">t1</span></a></span><span> </span><span class="annot"><span class="annottext">Coercion
</span><a href="#local-6989586621682578860"><span class="hs-identifier hs-var">h</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1706"></span><span>                               </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Coercion -&gt; Coercion
</span><a href="GHC.Core.Coercion.html#mkSymCo"><span class="hs-identifier hs-var">mkSymCo</span></a></span><span> </span><span class="annot"><span class="annottext">Coercion
</span><a href="#local-6989586621682578860"><span class="hs-identifier hs-var">h</span></a></span><span> </span><span class="annot"><span class="annottext">HasDebugCallStack =&gt; Coercion -&gt; Coercion -&gt; Coercion
Coercion -&gt; Coercion -&gt; Coercion
</span><a href="GHC.Core.Coercion.html#mkTransCo"><span class="hs-operator hs-var">`mkTransCo`</span></a></span><span> </span><span class="annot"><span class="annottext">Coercion
</span><a href="#local-6989586621682578862"><span class="hs-identifier hs-var">kind_co</span></a></span><span> </span><span class="annot"><span class="annottext">HasDebugCallStack =&gt; Coercion -&gt; Coercion -&gt; Coercion
Coercion -&gt; Coercion -&gt; Coercion
</span><a href="GHC.Core.Coercion.html#mkTransCo"><span class="hs-operator hs-var">`mkTransCo`</span></a></span><span> </span><span class="annot"><span class="annottext">Coercion
</span><a href="#local-6989586621682578860"><span class="hs-identifier hs-var">h</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1707"></span><span>      </span><span class="annot"><span class="annottext">Coercion
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Coercion
-&gt; Role -&gt; Type -&gt; Type -&gt; Coercion -&gt; Coercion -&gt; Coercion
</span><a href="GHC.Core.Coercion.html#castCoercionKind2"><span class="hs-identifier hs-var">castCoercionKind2</span></a></span><span> </span><span class="annot"><span class="annottext">Coercion
</span><a href="#local-6989586621682578856"><span class="hs-identifier hs-var">g</span></a></span><span> </span><span class="annot"><span class="annottext">Role
</span><a href="#local-6989586621682578857"><span class="hs-identifier hs-var">r</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682578858"><span class="hs-identifier hs-var">t1</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682578859"><span class="hs-identifier hs-var">t2</span></a></span><span> </span><span class="annot"><span class="annottext">Coercion
</span><a href="#local-6989586621682578860"><span class="hs-identifier hs-var">h</span></a></span><span> </span><span class="annot"><span class="annottext">Coercion
</span><a href="#local-6989586621682578860"><span class="hs-identifier hs-var">h</span></a></span><span>
</span><span id="line-1708"></span><span>
</span><span id="line-1709"></span><span class="hs-comment">-- | Creates a new coercion with both of its types casted by different casts</span><span>
</span><span id="line-1710"></span><span class="hs-comment">-- @castCoercionKind g h1 h2@, where @g :: t1 ~r t2@,</span><span>
</span><span id="line-1711"></span><span class="hs-comment">-- has type @(t1 |&gt; h1) ~r (t2 |&gt; h2)@.</span><span>
</span><span id="line-1712"></span><span class="hs-comment">-- @h1@ and @h2@ must be nominal.</span><span>
</span><span id="line-1713"></span><span class="hs-comment">-- It calls @coercionKindRole@, so it's quite inefficient (which 'I' stands for)</span><span>
</span><span id="line-1714"></span><span class="hs-comment">-- Use @castCoercionKind2@ instead if @t1@, @t2@, and @r@ are known beforehand.</span><span>
</span><span id="line-1715"></span><span class="annot"><a href="GHC.Core.Coercion.html#castCoercionKind"><span class="hs-identifier hs-type">castCoercionKind</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#Coercion"><span class="hs-identifier hs-type">Coercion</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#CoercionN"><span class="hs-identifier hs-type">CoercionN</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#CoercionN"><span class="hs-identifier hs-type">CoercionN</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#Coercion"><span class="hs-identifier hs-type">Coercion</span></a></span><span>
</span><span id="line-1716"></span><span id="castCoercionKind"><span class="annot"><span class="annottext">castCoercionKind :: Coercion -&gt; Coercion -&gt; Coercion -&gt; Coercion
</span><a href="GHC.Core.Coercion.html#castCoercionKind"><span class="hs-identifier hs-var hs-var">castCoercionKind</span></a></span></span><span> </span><span id="local-6989586621682578863"><span class="annot"><span class="annottext">Coercion
</span><a href="#local-6989586621682578863"><span class="hs-identifier hs-var">g</span></a></span></span><span> </span><span id="local-6989586621682578864"><span class="annot"><span class="annottext">Coercion
</span><a href="#local-6989586621682578864"><span class="hs-identifier hs-var">h1</span></a></span></span><span> </span><span id="local-6989586621682578865"><span class="annot"><span class="annottext">Coercion
</span><a href="#local-6989586621682578865"><span class="hs-identifier hs-var">h2</span></a></span></span><span>
</span><span id="line-1717"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Coercion
-&gt; Role -&gt; Type -&gt; Type -&gt; Coercion -&gt; Coercion -&gt; Coercion
</span><a href="GHC.Core.Coercion.html#castCoercionKind2"><span class="hs-identifier hs-var">castCoercionKind2</span></a></span><span> </span><span class="annot"><span class="annottext">Coercion
</span><a href="#local-6989586621682578863"><span class="hs-identifier hs-var">g</span></a></span><span> </span><span class="annot"><span class="annottext">Role
</span><a href="#local-6989586621682578866"><span class="hs-identifier hs-var">r</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682578867"><span class="hs-identifier hs-var">t1</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682578868"><span class="hs-identifier hs-var">t2</span></a></span><span> </span><span class="annot"><span class="annottext">Coercion
</span><a href="#local-6989586621682578864"><span class="hs-identifier hs-var">h1</span></a></span><span> </span><span class="annot"><span class="annottext">Coercion
</span><a href="#local-6989586621682578865"><span class="hs-identifier hs-var">h2</span></a></span><span>
</span><span id="line-1718"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-1719"></span><span>    </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Data.Pair.html#Pair"><span class="hs-identifier hs-type">Pair</span></a></span><span> </span><span id="local-6989586621682578867"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682578867"><span class="hs-identifier hs-var">t1</span></a></span></span><span> </span><span id="local-6989586621682578868"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682578868"><span class="hs-identifier hs-var">t2</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682578866"><span class="annot"><span class="annottext">Role
</span><a href="#local-6989586621682578866"><span class="hs-identifier hs-var">r</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Coercion -&gt; (Pair Type, Role)
</span><a href="GHC.Core.Coercion.html#coercionKindRole"><span class="hs-identifier hs-var">coercionKindRole</span></a></span><span> </span><span class="annot"><span class="annottext">Coercion
</span><a href="#local-6989586621682578863"><span class="hs-identifier hs-var">g</span></a></span><span>
</span><span id="line-1720"></span><span>
</span><span id="line-1721"></span><span class="annot"><a href="GHC.Core.Coercion.html#mkPiCos"><span class="hs-identifier hs-type">mkPiCos</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Language.Haskell.Syntax.Basic.html#Role"><span class="hs-identifier hs-type">Role</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="GHC.Types.Var.html#Var"><span class="hs-identifier hs-type">Var</span></a></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#Coercion"><span class="hs-identifier hs-type">Coercion</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#Coercion"><span class="hs-identifier hs-type">Coercion</span></a></span><span>
</span><span id="line-1722"></span><span id="mkPiCos"><span class="annot"><span class="annottext">mkPiCos :: Role -&gt; [CoVar] -&gt; Coercion -&gt; Coercion
</span><a href="GHC.Core.Coercion.html#mkPiCos"><span class="hs-identifier hs-var hs-var">mkPiCos</span></a></span></span><span> </span><span id="local-6989586621682578869"><span class="annot"><span class="annottext">Role
</span><a href="#local-6989586621682578869"><span class="hs-identifier hs-var">r</span></a></span></span><span> </span><span id="local-6989586621682578870"><span class="annot"><span class="annottext">[CoVar]
</span><a href="#local-6989586621682578870"><span class="hs-identifier hs-var">vs</span></a></span></span><span> </span><span id="local-6989586621682578871"><span class="annot"><span class="annottext">Coercion
</span><a href="#local-6989586621682578871"><span class="hs-identifier hs-var">co</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(CoVar -&gt; Coercion -&gt; Coercion) -&gt; Coercion -&gt; [CoVar] -&gt; Coercion
forall a b. (a -&gt; b -&gt; b) -&gt; b -&gt; [a] -&gt; b
forall (t :: * -&gt; *) a b.
Foldable t =&gt;
(a -&gt; b -&gt; b) -&gt; b -&gt; t a -&gt; b
</span><span class="hs-identifier hs-var">foldr</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Role -&gt; CoVar -&gt; Coercion -&gt; Coercion
</span><a href="GHC.Core.Coercion.html#mkPiCo"><span class="hs-identifier hs-var">mkPiCo</span></a></span><span> </span><span class="annot"><span class="annottext">Role
</span><a href="#local-6989586621682578869"><span class="hs-identifier hs-var">r</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Coercion
</span><a href="#local-6989586621682578871"><span class="hs-identifier hs-var">co</span></a></span><span> </span><span class="annot"><span class="annottext">[CoVar]
</span><a href="#local-6989586621682578870"><span class="hs-identifier hs-var">vs</span></a></span><span>
</span><span id="line-1723"></span><span>
</span><span id="line-1724"></span><span class="hs-comment">-- | Make a forall 'Coercion', where both types related by the coercion</span><span>
</span><span id="line-1725"></span><span class="hs-comment">-- are quantified over the same variable.</span><span>
</span><span id="line-1726"></span><span class="annot"><a href="GHC.Core.Coercion.html#mkPiCo"><span class="hs-identifier hs-type">mkPiCo</span></a></span><span>  </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Language.Haskell.Syntax.Basic.html#Role"><span class="hs-identifier hs-type">Role</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Types.Var.html#Var"><span class="hs-identifier hs-type">Var</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#Coercion"><span class="hs-identifier hs-type">Coercion</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#Coercion"><span class="hs-identifier hs-type">Coercion</span></a></span><span>
</span><span id="line-1727"></span><span id="mkPiCo"><span class="annot"><span class="annottext">mkPiCo :: Role -&gt; CoVar -&gt; Coercion -&gt; Coercion
</span><a href="GHC.Core.Coercion.html#mkPiCo"><span class="hs-identifier hs-var hs-var">mkPiCo</span></a></span></span><span> </span><span id="local-6989586621682578872"><span class="annot"><span class="annottext">Role
</span><a href="#local-6989586621682578872"><span class="hs-identifier hs-var">r</span></a></span></span><span> </span><span id="local-6989586621682578873"><span class="annot"><span class="annottext">CoVar
</span><a href="#local-6989586621682578873"><span class="hs-identifier hs-var">v</span></a></span></span><span> </span><span id="local-6989586621682578874"><span class="annot"><span class="annottext">Coercion
</span><a href="#local-6989586621682578874"><span class="hs-identifier hs-var">co</span></a></span></span><span> </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">CoVar -&gt; Bool
</span><a href="GHC.Types.Var.html#isTyVar"><span class="hs-identifier hs-var">isTyVar</span></a></span><span> </span><span class="annot"><span class="annottext">CoVar
</span><a href="#local-6989586621682578873"><span class="hs-identifier hs-var">v</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[ForAllTyBinder] -&gt; Coercion -&gt; Coercion
</span><a href="GHC.Core.Coercion.html#mkHomoForAllCos"><span class="hs-identifier hs-var">mkHomoForAllCos</span></a></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">CoVar -&gt; ForAllTyFlag -&gt; ForAllTyBinder
forall var argf. var -&gt; argf -&gt; VarBndr var argf
</span><a href="GHC.Types.Var.html#Bndr"><span class="hs-identifier hs-var">Bndr</span></a></span><span> </span><span class="annot"><span class="annottext">CoVar
</span><a href="#local-6989586621682578873"><span class="hs-identifier hs-var">v</span></a></span><span> </span><span class="annot"><span class="annottext">ForAllTyFlag
</span><a href="Language.Haskell.Syntax.Specificity.html#coreTyLamForAllTyFlag"><span class="hs-identifier hs-var">coreTyLamForAllTyFlag</span></a></span><span class="hs-special">]</span><span> </span><span class="annot"><span class="annottext">Coercion
</span><a href="#local-6989586621682578874"><span class="hs-identifier hs-var">co</span></a></span><span>
</span><span id="line-1728"></span><span>              </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">CoVar -&gt; Bool
</span><a href="GHC.Types.Var.html#isCoVar"><span class="hs-identifier hs-var">isCoVar</span></a></span><span> </span><span class="annot"><span class="annottext">CoVar
</span><a href="#local-6989586621682578873"><span class="hs-identifier hs-var">v</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Coercion -&gt; Coercion
forall a. HasCallStack =&gt; Bool -&gt; a -&gt; a
</span><a href="GHC.Utils.Panic.Plain.html#assert"><span class="hs-identifier hs-var">assert</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Bool -&gt; Bool
</span><span class="hs-identifier hs-var">not</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">CoVar
</span><a href="#local-6989586621682578873"><span class="hs-identifier hs-var">v</span></a></span><span> </span><span class="annot"><span class="annottext">CoVar -&gt; VarSet -&gt; Bool
</span><a href="GHC.Types.Var.Set.html#elemVarSet"><span class="hs-operator hs-var">`elemVarSet`</span></a></span><span> </span><span class="annot"><span class="annottext">Coercion -&gt; VarSet
</span><a href="GHC.Core.TyCo.FVs.html#tyCoVarsOfCo"><span class="hs-identifier hs-var">tyCoVarsOfCo</span></a></span><span> </span><span class="annot"><span class="annottext">Coercion
</span><a href="#local-6989586621682578874"><span class="hs-identifier hs-var">co</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(Coercion -&gt; Coercion) -&gt; Coercion -&gt; Coercion
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-1729"></span><span>                  </span><span class="hs-comment">-- We didn't call mkForAllCo here because if v does not appear</span><span>
</span><span id="line-1730"></span><span>                  </span><span class="hs-comment">-- in co, the argument coercion will be nominal. But here we</span><span>
</span><span id="line-1731"></span><span>                  </span><span class="hs-comment">-- want it to be r. It is only called in 'mkPiCos', which is</span><span>
</span><span id="line-1732"></span><span>                  </span><span class="hs-comment">-- only used in GHC.Core.Opt.Simplify.Utils, where we are sure for</span><span>
</span><span id="line-1733"></span><span>                  </span><span class="hs-comment">-- now (Aug 2018) v won't occur in co.</span><span>
</span><span id="line-1734"></span><span>                            </span><span class="annot"><span class="annottext">Role -&gt; CoVar -&gt; Coercion -&gt; Coercion
</span><a href="GHC.Core.Coercion.html#mkFunResCo"><span class="hs-identifier hs-var">mkFunResCo</span></a></span><span> </span><span class="annot"><span class="annottext">Role
</span><a href="#local-6989586621682578872"><span class="hs-identifier hs-var">r</span></a></span><span> </span><span class="annot"><span class="annottext">CoVar
</span><a href="#local-6989586621682578873"><span class="hs-identifier hs-var">v</span></a></span><span> </span><span class="annot"><span class="annottext">Coercion
</span><a href="#local-6989586621682578874"><span class="hs-identifier hs-var">co</span></a></span><span>
</span><span id="line-1735"></span><span>              </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">otherwise</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Role -&gt; CoVar -&gt; Coercion -&gt; Coercion
</span><a href="GHC.Core.Coercion.html#mkFunResCo"><span class="hs-identifier hs-var">mkFunResCo</span></a></span><span> </span><span class="annot"><span class="annottext">Role
</span><a href="#local-6989586621682578872"><span class="hs-identifier hs-var">r</span></a></span><span> </span><span class="annot"><span class="annottext">CoVar
</span><a href="#local-6989586621682578873"><span class="hs-identifier hs-var">v</span></a></span><span> </span><span class="annot"><span class="annottext">Coercion
</span><a href="#local-6989586621682578874"><span class="hs-identifier hs-var">co</span></a></span><span>
</span><span id="line-1736"></span><span>
</span><span id="line-1737"></span><span class="annot"><a href="GHC.Core.Coercion.html#mkFunResCo"><span class="hs-identifier hs-type">mkFunResCo</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Language.Haskell.Syntax.Basic.html#Role"><span class="hs-identifier hs-type">Role</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Types.Var.html#Id"><span class="hs-identifier hs-type">Id</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#Coercion"><span class="hs-identifier hs-type">Coercion</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#Coercion"><span class="hs-identifier hs-type">Coercion</span></a></span><span>
</span><span id="line-1738"></span><span class="hs-comment">-- Given res_co :: res1 ~ res2,</span><span>
</span><span id="line-1739"></span><span class="hs-comment">--   mkFunResCo r m arg res_co :: (arg -&gt; res1) ~r (arg -&gt; res2)</span><span>
</span><span id="line-1740"></span><span class="hs-comment">-- Reflexive in the multiplicity argument</span><span>
</span><span id="line-1741"></span><span id="mkFunResCo"><span class="annot"><span class="annottext">mkFunResCo :: Role -&gt; CoVar -&gt; Coercion -&gt; Coercion
</span><a href="GHC.Core.Coercion.html#mkFunResCo"><span class="hs-identifier hs-var hs-var">mkFunResCo</span></a></span></span><span> </span><span id="local-6989586621682578876"><span class="annot"><span class="annottext">Role
</span><a href="#local-6989586621682578876"><span class="hs-keyword hs-var">role</span></a></span></span><span> </span><span id="local-6989586621682578877"><span class="annot"><span class="annottext">CoVar
</span><a href="#local-6989586621682578877"><span class="hs-identifier hs-var">id</span></a></span></span><span> </span><span id="local-6989586621682578878"><span class="annot"><span class="annottext">Coercion
</span><a href="#local-6989586621682578878"><span class="hs-identifier hs-var">res_co</span></a></span></span><span>
</span><span id="line-1742"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">HasDebugCallStack =&gt;
Role -&gt; Coercion -&gt; Coercion -&gt; Coercion -&gt; Coercion
Role -&gt; Coercion -&gt; Coercion -&gt; Coercion -&gt; Coercion
</span><a href="GHC.Core.Coercion.html#mkFunCoNoFTF"><span class="hs-identifier hs-var">mkFunCoNoFTF</span></a></span><span> </span><span class="annot"><span class="annottext">Role
</span><a href="#local-6989586621682578876"><span class="hs-keyword hs-var">role</span></a></span><span> </span><span class="annot"><span class="annottext">Coercion
</span><a href="#local-6989586621682578879"><span class="hs-identifier hs-var">mult</span></a></span><span> </span><span class="annot"><span class="annottext">Coercion
</span><a href="#local-6989586621682578880"><span class="hs-identifier hs-var">arg_co</span></a></span><span> </span><span class="annot"><span class="annottext">Coercion
</span><a href="#local-6989586621682578878"><span class="hs-identifier hs-var">res_co</span></a></span><span>
</span><span id="line-1743"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-1744"></span><span>    </span><span id="local-6989586621682578880"><span class="annot"><span class="annottext">arg_co :: Coercion
</span><a href="#local-6989586621682578880"><span class="hs-identifier hs-var hs-var">arg_co</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Role -&gt; Type -&gt; Coercion
</span><a href="GHC.Core.Coercion.html#mkReflCo"><span class="hs-identifier hs-var">mkReflCo</span></a></span><span> </span><span class="annot"><span class="annottext">Role
</span><a href="#local-6989586621682578876"><span class="hs-keyword hs-var">role</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">CoVar -&gt; Type
</span><a href="GHC.Types.Var.html#varType"><span class="hs-identifier hs-var">varType</span></a></span><span> </span><span class="annot"><span class="annottext">CoVar
</span><a href="#local-6989586621682578877"><span class="hs-identifier hs-var">id</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1745"></span><span>    </span><span id="local-6989586621682578879"><span class="annot"><span class="annottext">mult :: Coercion
</span><a href="#local-6989586621682578879"><span class="hs-identifier hs-var hs-var">mult</span></a></span></span><span>   </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Type -&gt; Coercion
</span><a href="GHC.Core.Coercion.html#multToCo"><span class="hs-identifier hs-var">multToCo</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">CoVar -&gt; Type
</span><a href="GHC.Types.Var.html#varMult"><span class="hs-identifier hs-var">varMult</span></a></span><span> </span><span class="annot"><span class="annottext">CoVar
</span><a href="#local-6989586621682578877"><span class="hs-identifier hs-var">id</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1746"></span><span>
</span><span id="line-1747"></span><span class="hs-comment">-- mkCoCast (c :: s1 ~?r t1) (g :: (s1 ~?r t1) ~#R (s2 ~?r t2)) :: s2 ~?r t2</span><span>
</span><span id="line-1748"></span><span class="hs-comment">-- The first coercion might be lifted or unlifted; thus the ~? above</span><span>
</span><span id="line-1749"></span><span class="hs-comment">-- Lifted and unlifted equalities take different numbers of arguments,</span><span>
</span><span id="line-1750"></span><span class="hs-comment">-- so we have to make sure to supply the right parameter to decomposeCo.</span><span>
</span><span id="line-1751"></span><span class="hs-comment">-- Also, note that the role of the first coercion is the same as the role of</span><span>
</span><span id="line-1752"></span><span class="hs-comment">-- the equalities related by the second coercion. The second coercion is</span><span>
</span><span id="line-1753"></span><span class="hs-comment">-- itself always representational.</span><span>
</span><span id="line-1754"></span><span class="annot"><a href="GHC.Core.Coercion.html#mkCoCast"><span class="hs-identifier hs-type">mkCoCast</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#Coercion"><span class="hs-identifier hs-type">Coercion</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#CoercionR"><span class="hs-identifier hs-type">CoercionR</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#Coercion"><span class="hs-identifier hs-type">Coercion</span></a></span><span>
</span><span id="line-1755"></span><span id="mkCoCast"><span class="annot"><span class="annottext">mkCoCast :: Coercion -&gt; Coercion -&gt; Coercion
</span><a href="GHC.Core.Coercion.html#mkCoCast"><span class="hs-identifier hs-var hs-var">mkCoCast</span></a></span></span><span> </span><span id="local-6989586621682578882"><span class="annot"><span class="annottext">Coercion
</span><a href="#local-6989586621682578882"><span class="hs-identifier hs-var">c</span></a></span></span><span> </span><span id="local-6989586621682578883"><span class="annot"><span class="annottext">Coercion
</span><a href="#local-6989586621682578883"><span class="hs-identifier hs-var">g</span></a></span></span><span>
</span><span id="line-1756"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span class="hs-special">(</span><span id="local-6989586621682578884"><span class="annot"><span class="annottext">Coercion
</span><a href="#local-6989586621682578884"><span class="hs-identifier hs-var">g2</span></a></span></span><span class="annot"><span class="hs-glyph hs-type">:</span></span><span id="local-6989586621682578885"><span class="annot"><span class="annottext">Coercion
</span><a href="#local-6989586621682578885"><span class="hs-identifier hs-var">g1</span></a></span></span><span class="annot"><span class="hs-glyph hs-type">:</span></span><span class="annot"><span class="annottext">[Coercion]
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">[Coercion] -&gt; [Coercion]
forall a. [a] -&gt; [a]
</span><span class="hs-identifier hs-var">reverse</span></span><span> </span><span class="annot"><span class="annottext">[Coercion]
</span><a href="#local-6989586621682578886"><span class="hs-identifier hs-var">co_list</span></a></span><span>
</span><span id="line-1757"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Coercion -&gt; Coercion
</span><a href="GHC.Core.Coercion.html#mkSymCo"><span class="hs-identifier hs-var">mkSymCo</span></a></span><span> </span><span class="annot"><span class="annottext">Coercion
</span><a href="#local-6989586621682578885"><span class="hs-identifier hs-var">g1</span></a></span><span> </span><span class="annot"><span class="annottext">HasDebugCallStack =&gt; Coercion -&gt; Coercion -&gt; Coercion
Coercion -&gt; Coercion -&gt; Coercion
</span><a href="GHC.Core.Coercion.html#mkTransCo"><span class="hs-operator hs-var">`mkTransCo`</span></a></span><span> </span><span class="annot"><span class="annottext">Coercion
</span><a href="#local-6989586621682578882"><span class="hs-identifier hs-var">c</span></a></span><span> </span><span class="annot"><span class="annottext">HasDebugCallStack =&gt; Coercion -&gt; Coercion -&gt; Coercion
Coercion -&gt; Coercion -&gt; Coercion
</span><a href="GHC.Core.Coercion.html#mkTransCo"><span class="hs-operator hs-var">`mkTransCo`</span></a></span><span> </span><span class="annot"><span class="annottext">Coercion
</span><a href="#local-6989586621682578884"><span class="hs-identifier hs-var">g2</span></a></span><span>
</span><span id="line-1758"></span><span>
</span><span id="line-1759"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">otherwise</span></span><span>
</span><span id="line-1760"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">String -&gt; SDoc -&gt; Coercion
forall a. HasCallStack =&gt; String -&gt; SDoc -&gt; a
</span><a href="GHC.Utils.Panic.html#pprPanic"><span class="hs-identifier hs-var">pprPanic</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;mkCoCast&quot;</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Coercion -&gt; SDoc
forall a. Outputable a =&gt; a -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="annot"><span class="annottext">Coercion
</span><a href="#local-6989586621682578883"><span class="hs-identifier hs-var">g</span></a></span><span> </span><span class="annot"><span class="annottext">SDoc -&gt; SDoc -&gt; SDoc
forall doc. IsDoc doc =&gt; doc -&gt; doc -&gt; doc
</span><a href="GHC.Utils.Outputable.html#%24%24"><span class="hs-operator hs-var">$$</span></a></span><span> </span><span class="annot"><span class="annottext">Pair Type -&gt; SDoc
forall a. Outputable a =&gt; a -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">HasDebugCallStack =&gt; Coercion -&gt; Pair Type
Coercion -&gt; Pair Type
</span><a href="GHC.Core.Coercion.html#coercionKind"><span class="hs-identifier hs-var">coercionKind</span></a></span><span> </span><span class="annot"><span class="annottext">Coercion
</span><a href="#local-6989586621682578883"><span class="hs-identifier hs-var">g</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-1761"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-1762"></span><span>    </span><span class="hs-comment">-- g  :: (s1 ~# t1) ~# (s2 ~# t2)</span><span>
</span><span id="line-1763"></span><span>    </span><span class="hs-comment">-- g1 :: s1 ~# s2</span><span>
</span><span id="line-1764"></span><span>    </span><span class="hs-comment">-- g2 :: t1 ~# t2</span><span>
</span><span id="line-1765"></span><span>    </span><span class="hs-special">(</span><span id="local-6989586621682578887"><span class="annot"><span class="annottext">TyCon
</span><a href="#local-6989586621682578887"><span class="hs-identifier hs-var">tc</span></a></span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">[Type]
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Type -&gt; (TyCon, [Type])
</span><a href="GHC.Core.Type.html#splitTyConApp"><span class="hs-identifier hs-var">splitTyConApp</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">HasDebugCallStack =&gt; Coercion -&gt; Type
Coercion -&gt; Type
</span><a href="GHC.Core.Coercion.html#coercionLKind"><span class="hs-identifier hs-var">coercionLKind</span></a></span><span> </span><span class="annot"><span class="annottext">Coercion
</span><a href="#local-6989586621682578883"><span class="hs-identifier hs-var">g</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1766"></span><span>    </span><span id="local-6989586621682578886"><span class="annot"><span class="annottext">co_list :: [Coercion]
</span><a href="#local-6989586621682578886"><span class="hs-identifier hs-var hs-var">co_list</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Arity -&gt; Coercion -&gt; Infinite Role -&gt; [Coercion]
</span><a href="GHC.Core.Coercion.html#decomposeCo"><span class="hs-identifier hs-var">decomposeCo</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TyCon -&gt; Arity
</span><a href="GHC.Core.TyCon.html#tyConArity"><span class="hs-identifier hs-var">tyConArity</span></a></span><span> </span><span class="annot"><span class="annottext">TyCon
</span><a href="#local-6989586621682578887"><span class="hs-identifier hs-var">tc</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Coercion
</span><a href="#local-6989586621682578883"><span class="hs-identifier hs-var">g</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TyCon -&gt; Infinite Role
</span><a href="GHC.Core.Coercion.html#tyConRolesRepresentational"><span class="hs-identifier hs-var">tyConRolesRepresentational</span></a></span><span> </span><span class="annot"><span class="annottext">TyCon
</span><a href="#local-6989586621682578887"><span class="hs-identifier hs-var">tc</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1767"></span><span>
</span><span id="line-1768"></span><span class="hs-comment">{- Note [castCoercionKind1]
~~~~~~~~~~~~~~~~~~~~~~~~~~~
castCoercionKind1 deals with the very important special case of castCoercionKind2
where the two kind coercions are identical.  In that case we can exploit the
situation where the main coercion is reflexive, via the special cases for Refl
and GRefl.

This is important when rewriting  (ty |&gt; co). We rewrite ty, yielding
   fco :: ty ~ ty'
and now we want a coercion xco between
   xco :: (ty |&gt; co) ~ (ty' |&gt; co)
That's exactly what castCoercionKind1 does.  And it's very very common for
fco to be Refl.  In that case we do NOT want to get some terrible composition
of mkLeftCoherenceCo and mkRightCoherenceCo, which is what castCoercionKind2
has to do in its full generality.  See #18413.
-}</span><span>
</span><span id="line-1784"></span><span>
</span><span id="line-1785"></span><span class="hs-comment">{-
%************************************************************************
%*                                                                      *
            Newtypes
%*                                                                      *
%************************************************************************
-}</span><span>
</span><span id="line-1792"></span><span>
</span><span id="line-1793"></span><span class="hs-comment">-- | If `instNewTyCon_maybe T ts = Just (rep_ty, co)`</span><span>
</span><span id="line-1794"></span><span class="hs-comment">--   then `co :: T ts ~R# rep_ty`</span><span>
</span><span id="line-1795"></span><span class="hs-comment">--</span><span>
</span><span id="line-1796"></span><span class="hs-comment">-- Checks for a newtype, and for being saturated</span><span>
</span><span id="line-1797"></span><span class="annot"><a href="GHC.Core.Coercion.html#instNewTyCon_maybe"><span class="hs-identifier hs-type">instNewTyCon_maybe</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Core.TyCon.html#TyCon"><span class="hs-identifier hs-type">TyCon</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#Type"><span class="hs-identifier hs-type">Type</span></a></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Maybe</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#Type"><span class="hs-identifier hs-type">Type</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#Coercion"><span class="hs-identifier hs-type">Coercion</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1798"></span><span id="instNewTyCon_maybe"><span class="annot"><span class="annottext">instNewTyCon_maybe :: TyCon -&gt; [Type] -&gt; Maybe (Type, Coercion)
</span><a href="GHC.Core.Coercion.html#instNewTyCon_maybe"><span class="hs-identifier hs-var hs-var">instNewTyCon_maybe</span></a></span></span><span> </span><span id="local-6989586621682578889"><span class="annot"><span class="annottext">TyCon
</span><a href="#local-6989586621682578889"><span class="hs-identifier hs-var">tc</span></a></span></span><span> </span><span id="local-6989586621682578890"><span class="annot"><span class="annottext">[Type]
</span><a href="#local-6989586621682578890"><span class="hs-identifier hs-var">tys</span></a></span></span><span>
</span><span id="line-1799"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span class="hs-special">(</span><span id="local-6989586621682578891"><span class="annot"><span class="annottext">[CoVar]
</span><a href="#local-6989586621682578891"><span class="hs-identifier hs-var">tvs</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682578892"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682578892"><span class="hs-identifier hs-var">ty</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682578893"><span class="annot"><span class="annottext">CoAxiom Unbranched
</span><a href="#local-6989586621682578893"><span class="hs-identifier hs-var">co_tc</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">TyCon -&gt; Maybe ([CoVar], Type, CoAxiom Unbranched)
</span><a href="GHC.Core.TyCon.html#unwrapNewTyConEtad_maybe"><span class="hs-identifier hs-var">unwrapNewTyConEtad_maybe</span></a></span><span> </span><span class="annot"><span class="annottext">TyCon
</span><a href="#local-6989586621682578889"><span class="hs-identifier hs-var">tc</span></a></span><span>  </span><span class="hs-comment">-- Check for newtype</span><span>
</span><span id="line-1800"></span><span>  </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">[CoVar]
</span><a href="#local-6989586621682578891"><span class="hs-identifier hs-var">tvs</span></a></span><span> </span><span class="annot"><span class="annottext">[CoVar] -&gt; [Type] -&gt; Bool
forall a b. [a] -&gt; [b] -&gt; Bool
</span><a href="GHC.Utils.Misc.html#leLength"><span class="hs-operator hs-var">`leLength`</span></a></span><span> </span><span class="annot"><span class="annottext">[Type]
</span><a href="#local-6989586621682578890"><span class="hs-identifier hs-var">tys</span></a></span><span>                                    </span><span class="hs-comment">-- Check saturated enough</span><span>
</span><span id="line-1801"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(Type, Coercion) -&gt; Maybe (Type, Coercion)
forall a. a -&gt; Maybe a
</span><span class="hs-identifier hs-var">Just</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[CoVar] -&gt; Type -&gt; [Type] -&gt; Type
HasDebugCallStack =&gt; [CoVar] -&gt; Type -&gt; [Type] -&gt; Type
</span><a href="GHC.Core.Type.html#applyTysX"><span class="hs-identifier hs-var">applyTysX</span></a></span><span> </span><span class="annot"><span class="annottext">[CoVar]
</span><a href="#local-6989586621682578891"><span class="hs-identifier hs-var">tvs</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682578892"><span class="hs-identifier hs-var">ty</span></a></span><span> </span><span class="annot"><span class="annottext">[Type]
</span><a href="#local-6989586621682578890"><span class="hs-identifier hs-var">tys</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Role -&gt; CoAxiom Unbranched -&gt; [Type] -&gt; [Coercion] -&gt; Coercion
</span><a href="GHC.Core.Coercion.html#mkUnbranchedAxInstCo"><span class="hs-identifier hs-var">mkUnbranchedAxInstCo</span></a></span><span> </span><span class="annot"><span class="annottext">Role
</span><a href="Language.Haskell.Syntax.Basic.html#Representational"><span class="hs-identifier hs-var">Representational</span></a></span><span> </span><span class="annot"><span class="annottext">CoAxiom Unbranched
</span><a href="#local-6989586621682578893"><span class="hs-identifier hs-var">co_tc</span></a></span><span> </span><span class="annot"><span class="annottext">[Type]
</span><a href="#local-6989586621682578890"><span class="hs-identifier hs-var">tys</span></a></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span class="hs-special">)</span><span>
</span><span id="line-1802"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">otherwise</span></span><span>
</span><span id="line-1803"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Maybe (Type, Coercion)
forall a. Maybe a
</span><span class="hs-identifier hs-var">Nothing</span></span><span>
</span><span id="line-1804"></span><span>
</span><span id="line-1805"></span><span class="hs-comment">{-
************************************************************************
*                                                                      *
         Type normalisation
*                                                                      *
************************************************************************
-}</span><span>
</span><span id="line-1812"></span><span>
</span><span id="line-1813"></span><span class="hs-comment">-- | A function to check if we can reduce a type by one step. Used</span><span>
</span><span id="line-1814"></span><span class="hs-comment">-- with 'topNormaliseTypeX'.</span><span>
</span><span id="line-1815"></span><span class="hs-keyword">type</span><span> </span><span id="NormaliseStepper"><span class="annot"><a href="GHC.Core.Coercion.html#NormaliseStepper"><span class="hs-identifier hs-var">NormaliseStepper</span></a></span></span><span> </span><span id="local-6989586621682578897"><span class="annot"><a href="#local-6989586621682578897"><span class="hs-identifier hs-type">ev</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="GHC.Core.TyCon.RecWalk.html#RecTcChecker"><span class="hs-identifier hs-type">RecTcChecker</span></a></span><span>
</span><span id="line-1816"></span><span>                         </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Core.TyCon.html#TyCon"><span class="hs-identifier hs-type">TyCon</span></a></span><span>     </span><span class="hs-comment">-- tc</span><span>
</span><span id="line-1817"></span><span>                         </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#Type"><span class="hs-identifier hs-type">Type</span></a></span><span class="hs-special">]</span><span>    </span><span class="hs-comment">-- tys</span><span>
</span><span id="line-1818"></span><span>                         </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Core.Coercion.html#NormaliseStepResult"><span class="hs-identifier hs-type">NormaliseStepResult</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682578897"><span class="hs-identifier hs-type">ev</span></a></span><span>
</span><span id="line-1819"></span><span>
</span><span id="line-1820"></span><span class="hs-comment">-- | The result of stepping in a normalisation function.</span><span>
</span><span id="line-1821"></span><span class="hs-comment">-- See 'topNormaliseTypeX'.</span><span>
</span><span id="line-1822"></span><span class="hs-keyword">data</span><span> </span><span id="NormaliseStepResult"><span class="annot"><a href="GHC.Core.Coercion.html#NormaliseStepResult"><span class="hs-identifier hs-var">NormaliseStepResult</span></a></span></span><span> </span><span id="local-6989586621682577353"><span class="annot"><a href="#local-6989586621682577353"><span class="hs-identifier hs-type">ev</span></a></span></span><span>
</span><span id="line-1823"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span id="NS_Done"><span class="annot"><a href="GHC.Core.Coercion.html#NS_Done"><span class="hs-identifier hs-var">NS_Done</span></a></span></span><span>   </span><span class="annot"><span class="hs-comment">-- ^ Nothing more to do</span></span><span>
</span><span id="line-1824"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span id="NS_Abort"><span class="annot"><a href="GHC.Core.Coercion.html#NS_Abort"><span class="hs-identifier hs-var">NS_Abort</span></a></span></span><span>  </span><span class="annot"><span class="hs-comment">-- ^ Utter failure. The outer function should fail too.</span></span><span>
</span><span id="line-1825"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span id="NS_Step"><span class="annot"><a href="GHC.Core.Coercion.html#NS_Step"><span class="hs-identifier hs-var">NS_Step</span></a></span></span><span> </span><span class="annot"><a href="GHC.Core.TyCon.RecWalk.html#RecTcChecker"><span class="hs-identifier hs-type">RecTcChecker</span></a></span><span> </span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#Type"><span class="hs-identifier hs-type">Type</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682577353"><span class="hs-identifier hs-type">ev</span></a></span><span>    </span><span class="hs-comment">-- ^ We stepped, yielding new bits;</span><span>
</span><span id="line-1826"></span><span>                                    </span><span class="hs-comment">-- ^ ev is evidence;</span><span>
</span><span id="line-1827"></span><span>                                    </span><span class="hs-comment">-- Usually a co :: old type ~ new type</span><span>
</span><span id="line-1828"></span><span>  </span><span class="hs-keyword">deriving</span><span> </span><span class="hs-special">(</span><span id="local-6989586621682578902"><span id="local-6989586621682578904"><span class="annot"><span class="annottext">(forall a b.
 (a -&gt; b) -&gt; NormaliseStepResult a -&gt; NormaliseStepResult b)
-&gt; (forall a b.
    a -&gt; NormaliseStepResult b -&gt; NormaliseStepResult a)
-&gt; Functor NormaliseStepResult
forall a b. a -&gt; NormaliseStepResult b -&gt; NormaliseStepResult a
forall a b.
(a -&gt; b) -&gt; NormaliseStepResult a -&gt; NormaliseStepResult b
forall (f :: * -&gt; *).
(forall a b. (a -&gt; b) -&gt; f a -&gt; f b)
-&gt; (forall a b. a -&gt; f b -&gt; f a) -&gt; Functor f
$cfmap :: forall a b.
(a -&gt; b) -&gt; NormaliseStepResult a -&gt; NormaliseStepResult b
fmap :: forall a b.
(a -&gt; b) -&gt; NormaliseStepResult a -&gt; NormaliseStepResult b
$c&lt;$ :: forall a b. a -&gt; NormaliseStepResult b -&gt; NormaliseStepResult a
&lt;$ :: forall a b. a -&gt; NormaliseStepResult b -&gt; NormaliseStepResult a
</span><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var hs-var">Functor</span></span></span></span><span class="hs-special">)</span><span>
</span><span id="line-1829"></span><span>
</span><span id="line-1830"></span><span class="hs-keyword">instance</span><span> </span><span id="local-6989586621682577348"><span class="annot"><a href="GHC.Utils.Outputable.html#Outputable"><span class="hs-identifier hs-type">Outputable</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682577348"><span class="hs-identifier hs-type">ev</span></a></span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="GHC.Utils.Outputable.html#Outputable"><span class="hs-identifier hs-type">Outputable</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Core.Coercion.html#NormaliseStepResult"><span class="hs-identifier hs-type">NormaliseStepResult</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682577348"><span class="hs-identifier hs-type">ev</span></a></span><span class="hs-special">)</span></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-1831"></span><span>  </span><span id="local-6989586621682578918"><span class="annot"><span class="annottext">ppr :: NormaliseStepResult ev -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var hs-var hs-var">ppr</span></a></span></span><span> </span><span class="annot"><span class="annottext">NormaliseStepResult ev
</span><a href="GHC.Core.Coercion.html#NS_Done"><span class="hs-identifier hs-var">NS_Done</span></a></span><span>           </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">String -&gt; SDoc
forall doc. IsLine doc =&gt; String -&gt; doc
</span><a href="GHC.Utils.Outputable.html#text"><span class="hs-identifier hs-var">text</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;NS_Done&quot;</span></span><span>
</span><span id="line-1832"></span><span>  </span><span class="annot"><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="annot"><span class="annottext">NormaliseStepResult ev
</span><a href="GHC.Core.Coercion.html#NS_Abort"><span class="hs-identifier hs-var">NS_Abort</span></a></span><span>          </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">String -&gt; SDoc
forall doc. IsLine doc =&gt; String -&gt; doc
</span><a href="GHC.Utils.Outputable.html#text"><span class="hs-identifier hs-var">text</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;NS_Abort&quot;</span></span><span>
</span><span id="line-1833"></span><span>  </span><span class="annot"><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Core.Coercion.html#NS_Step"><span class="hs-identifier hs-type">NS_Step</span></a></span><span> </span><span class="annot"><span class="annottext">RecTcChecker
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621682578919"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682578919"><span class="hs-identifier hs-var">ty</span></a></span></span><span> </span><span id="local-6989586621682578920"><span class="annot"><span class="annottext">ev
</span><a href="#local-6989586621682578920"><span class="hs-identifier hs-var">ev</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[SDoc] -&gt; SDoc
forall doc. IsLine doc =&gt; [doc] -&gt; doc
</span><a href="GHC.Utils.Outputable.html#sep"><span class="hs-identifier hs-var">sep</span></a></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">String -&gt; SDoc
forall doc. IsLine doc =&gt; String -&gt; doc
</span><a href="GHC.Utils.Outputable.html#text"><span class="hs-identifier hs-var">text</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;NS_Step&quot;</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Type -&gt; SDoc
forall a. Outputable a =&gt; a -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682578919"><span class="hs-identifier hs-var">ty</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">ev -&gt; SDoc
forall a. Outputable a =&gt; a -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="annot"><span class="annottext">ev
</span><a href="#local-6989586621682578920"><span class="hs-identifier hs-var">ev</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-1834"></span><span>
</span><span id="line-1835"></span><span class="hs-comment">-- | Try one stepper and then try the next, if the first doesn't make</span><span>
</span><span id="line-1836"></span><span class="hs-comment">-- progress.</span><span>
</span><span id="line-1837"></span><span class="hs-comment">-- So if it returns NS_Done, it means that both steppers are satisfied</span><span>
</span><span id="line-1838"></span><span id="local-6989586621682577350"><span class="annot"><a href="GHC.Core.Coercion.html#composeSteppers"><span class="hs-identifier hs-type">composeSteppers</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Core.Coercion.html#NormaliseStepper"><span class="hs-identifier hs-type">NormaliseStepper</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682577350"><span class="hs-identifier hs-type">ev</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Core.Coercion.html#NormaliseStepper"><span class="hs-identifier hs-type">NormaliseStepper</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682577350"><span class="hs-identifier hs-type">ev</span></a></span><span>
</span><span id="line-1839"></span><span>                </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Core.Coercion.html#NormaliseStepper"><span class="hs-identifier hs-type">NormaliseStepper</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682577350"><span class="hs-identifier hs-type">ev</span></a></span></span><span>
</span><span id="line-1840"></span><span id="composeSteppers"><span class="annot"><span class="annottext">composeSteppers :: forall ev.
NormaliseStepper ev -&gt; NormaliseStepper ev -&gt; NormaliseStepper ev
</span><a href="GHC.Core.Coercion.html#composeSteppers"><span class="hs-identifier hs-var hs-var">composeSteppers</span></a></span></span><span> </span><span id="local-6989586621682578922"><span class="annot"><span class="annottext">NormaliseStepper ev
</span><a href="#local-6989586621682578922"><span class="hs-identifier hs-var">step1</span></a></span></span><span> </span><span id="local-6989586621682578923"><span class="annot"><span class="annottext">NormaliseStepper ev
</span><a href="#local-6989586621682578923"><span class="hs-identifier hs-var">step2</span></a></span></span><span> </span><span id="local-6989586621682578924"><span class="annot"><span class="annottext">RecTcChecker
</span><a href="#local-6989586621682578924"><span class="hs-identifier hs-var">rec_nts</span></a></span></span><span> </span><span id="local-6989586621682578925"><span class="annot"><span class="annottext">TyCon
</span><a href="#local-6989586621682578925"><span class="hs-identifier hs-var">tc</span></a></span></span><span> </span><span id="local-6989586621682578926"><span class="annot"><span class="annottext">[Type]
</span><a href="#local-6989586621682578926"><span class="hs-identifier hs-var">tys</span></a></span></span><span>
</span><span id="line-1841"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">NormaliseStepper ev
</span><a href="#local-6989586621682578922"><span class="hs-identifier hs-var">step1</span></a></span><span> </span><span class="annot"><span class="annottext">RecTcChecker
</span><a href="#local-6989586621682578924"><span class="hs-identifier hs-var">rec_nts</span></a></span><span> </span><span class="annot"><span class="annottext">TyCon
</span><a href="#local-6989586621682578925"><span class="hs-identifier hs-var">tc</span></a></span><span> </span><span class="annot"><span class="annottext">[Type]
</span><a href="#local-6989586621682578926"><span class="hs-identifier hs-var">tys</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-1842"></span><span>      </span><span id="local-6989586621682578927"><span class="annot"><span class="annottext">success :: NormaliseStepResult ev
</span><a href="#local-6989586621682578927"><span class="hs-identifier hs-var">success</span></a></span></span><span class="hs-glyph">@</span><span class="hs-special">(</span><span class="annot"><a href="GHC.Core.Coercion.html#NS_Step"><span class="hs-identifier hs-type">NS_Step</span></a></span><span> </span><span class="hs-special">{</span><span class="hs-special">}</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">NormaliseStepResult ev
</span><a href="#local-6989586621682578927"><span class="hs-identifier hs-var">success</span></a></span><span>
</span><span id="line-1843"></span><span>      </span><span class="annot"><span class="annottext">NormaliseStepResult ev
</span><a href="GHC.Core.Coercion.html#NS_Done"><span class="hs-identifier hs-var">NS_Done</span></a></span><span>              </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">NormaliseStepper ev
</span><a href="#local-6989586621682578923"><span class="hs-identifier hs-var">step2</span></a></span><span> </span><span class="annot"><span class="annottext">RecTcChecker
</span><a href="#local-6989586621682578924"><span class="hs-identifier hs-var">rec_nts</span></a></span><span> </span><span class="annot"><span class="annottext">TyCon
</span><a href="#local-6989586621682578925"><span class="hs-identifier hs-var">tc</span></a></span><span> </span><span class="annot"><span class="annottext">[Type]
</span><a href="#local-6989586621682578926"><span class="hs-identifier hs-var">tys</span></a></span><span>
</span><span id="line-1844"></span><span>      </span><span class="annot"><span class="annottext">NormaliseStepResult ev
</span><a href="GHC.Core.Coercion.html#NS_Abort"><span class="hs-identifier hs-var">NS_Abort</span></a></span><span>             </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">NormaliseStepResult ev
forall ev. NormaliseStepResult ev
</span><a href="GHC.Core.Coercion.html#NS_Abort"><span class="hs-identifier hs-var">NS_Abort</span></a></span><span>
</span><span id="line-1845"></span><span>
</span><span id="line-1846"></span><span class="hs-comment">-- | A 'NormaliseStepper' that unwraps newtypes, careful not to fall into</span><span>
</span><span id="line-1847"></span><span class="hs-comment">-- a loop. If it would fall into a loop, it produces 'NS_Abort'.</span><span>
</span><span id="line-1848"></span><span class="annot"><a href="GHC.Core.Coercion.html#unwrapNewTypeStepper"><span class="hs-identifier hs-type">unwrapNewTypeStepper</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Core.Coercion.html#NormaliseStepper"><span class="hs-identifier hs-type">NormaliseStepper</span></a></span><span> </span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#Coercion"><span class="hs-identifier hs-type">Coercion</span></a></span><span>
</span><span id="line-1849"></span><span id="unwrapNewTypeStepper"><span class="annot"><span class="annottext">unwrapNewTypeStepper :: NormaliseStepper Coercion
</span><a href="GHC.Core.Coercion.html#unwrapNewTypeStepper"><span class="hs-identifier hs-var hs-var">unwrapNewTypeStepper</span></a></span></span><span> </span><span id="local-6989586621682578928"><span class="annot"><span class="annottext">RecTcChecker
</span><a href="#local-6989586621682578928"><span class="hs-identifier hs-var">rec_nts</span></a></span></span><span> </span><span id="local-6989586621682578929"><span class="annot"><span class="annottext">TyCon
</span><a href="#local-6989586621682578929"><span class="hs-identifier hs-var">tc</span></a></span></span><span> </span><span id="local-6989586621682578930"><span class="annot"><span class="annottext">[Type]
</span><a href="#local-6989586621682578930"><span class="hs-identifier hs-var">tys</span></a></span></span><span>
</span><span id="line-1850"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span class="hs-special">(</span><span id="local-6989586621682578931"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682578931"><span class="hs-identifier hs-var">ty'</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682578932"><span class="annot"><span class="annottext">Coercion
</span><a href="#local-6989586621682578932"><span class="hs-identifier hs-var">co</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">TyCon -&gt; [Type] -&gt; Maybe (Type, Coercion)
</span><a href="GHC.Core.Coercion.html#instNewTyCon_maybe"><span class="hs-identifier hs-var">instNewTyCon_maybe</span></a></span><span> </span><span class="annot"><span class="annottext">TyCon
</span><a href="#local-6989586621682578929"><span class="hs-identifier hs-var">tc</span></a></span><span> </span><span class="annot"><span class="annottext">[Type]
</span><a href="#local-6989586621682578930"><span class="hs-identifier hs-var">tys</span></a></span><span>
</span><span id="line-1851"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-comment">-- pprTrace &quot;unNS&quot; (ppr tc &lt;+&gt; ppr (getUnique tc) &lt;+&gt; ppr tys $$ ppr ty' $$ ppr rec_nts) $</span><span>
</span><span id="line-1852"></span><span>    </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">RecTcChecker -&gt; TyCon -&gt; Maybe RecTcChecker
</span><a href="GHC.Core.TyCon.RecWalk.html#checkRecTc"><span class="hs-identifier hs-var">checkRecTc</span></a></span><span> </span><span class="annot"><span class="annottext">RecTcChecker
</span><a href="#local-6989586621682578928"><span class="hs-identifier hs-var">rec_nts</span></a></span><span> </span><span class="annot"><span class="annottext">TyCon
</span><a href="#local-6989586621682578929"><span class="hs-identifier hs-var">tc</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-1853"></span><span>      </span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span id="local-6989586621682578934"><span class="annot"><span class="annottext">RecTcChecker
</span><a href="#local-6989586621682578934"><span class="hs-identifier hs-var">rec_nts'</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">RecTcChecker -&gt; Type -&gt; Coercion -&gt; NormaliseStepResult Coercion
forall ev. RecTcChecker -&gt; Type -&gt; ev -&gt; NormaliseStepResult ev
</span><a href="GHC.Core.Coercion.html#NS_Step"><span class="hs-identifier hs-var">NS_Step</span></a></span><span> </span><span class="annot"><span class="annottext">RecTcChecker
</span><a href="#local-6989586621682578934"><span class="hs-identifier hs-var">rec_nts'</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682578931"><span class="hs-identifier hs-var">ty'</span></a></span><span> </span><span class="annot"><span class="annottext">Coercion
</span><a href="#local-6989586621682578932"><span class="hs-identifier hs-var">co</span></a></span><span>
</span><span id="line-1854"></span><span>      </span><span class="annot"><span class="annottext">Maybe RecTcChecker
</span><span class="hs-identifier hs-var">Nothing</span></span><span>       </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">NormaliseStepResult Coercion
forall ev. NormaliseStepResult ev
</span><a href="GHC.Core.Coercion.html#NS_Abort"><span class="hs-identifier hs-var">NS_Abort</span></a></span><span>
</span><span id="line-1855"></span><span>
</span><span id="line-1856"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">otherwise</span></span><span>
</span><span id="line-1857"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">NormaliseStepResult Coercion
forall ev. NormaliseStepResult ev
</span><a href="GHC.Core.Coercion.html#NS_Done"><span class="hs-identifier hs-var">NS_Done</span></a></span><span>
</span><span id="line-1858"></span><span>
</span><span id="line-1859"></span><span class="hs-comment">-- | A general function for normalising the top-level of a type. It continues</span><span>
</span><span id="line-1860"></span><span class="hs-comment">-- to use the provided 'NormaliseStepper' until that function fails, and then</span><span>
</span><span id="line-1861"></span><span class="hs-comment">-- this function returns. The roles of the coercions produced by the</span><span>
</span><span id="line-1862"></span><span class="hs-comment">-- 'NormaliseStepper' must all be the same, which is the role returned from</span><span>
</span><span id="line-1863"></span><span class="hs-comment">-- the call to 'topNormaliseTypeX'.</span><span>
</span><span id="line-1864"></span><span class="hs-comment">--</span><span>
</span><span id="line-1865"></span><span class="hs-comment">-- Typically ev is Coercion.</span><span>
</span><span id="line-1866"></span><span class="hs-comment">--</span><span>
</span><span id="line-1867"></span><span class="hs-comment">-- If topNormaliseTypeX step plus ty = Just (ev, ty')</span><span>
</span><span id="line-1868"></span><span class="hs-comment">-- then ty ~ev1~ t1 ~ev2~ t2 ... ~evn~ ty'</span><span>
</span><span id="line-1869"></span><span class="hs-comment">-- and ev = ev1 `plus` ev2 `plus` ... `plus` evn</span><span>
</span><span id="line-1870"></span><span class="hs-comment">-- If it returns Nothing then no newtype unwrapping could happen</span><span>
</span><span id="line-1871"></span><span id="local-6989586621682577354"><span class="annot"><a href="GHC.Core.Coercion.html#topNormaliseTypeX"><span class="hs-identifier hs-type">topNormaliseTypeX</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Core.Coercion.html#NormaliseStepper"><span class="hs-identifier hs-type">NormaliseStepper</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682577354"><span class="hs-identifier hs-type">ev</span></a></span><span>
</span><span id="line-1872"></span><span>                  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621682577354"><span class="hs-identifier hs-type">ev</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621682577354"><span class="hs-identifier hs-type">ev</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621682577354"><span class="hs-identifier hs-type">ev</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1873"></span><span>                  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#Type"><span class="hs-identifier hs-type">Type</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Maybe</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621682577354"><span class="hs-identifier hs-type">ev</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#Type"><span class="hs-identifier hs-type">Type</span></a></span><span class="hs-special">)</span></span><span>
</span><span id="line-1874"></span><span id="topNormaliseTypeX"><span class="annot"><span class="annottext">topNormaliseTypeX :: forall ev.
NormaliseStepper ev -&gt; (ev -&gt; ev -&gt; ev) -&gt; Type -&gt; Maybe (ev, Type)
</span><a href="GHC.Core.Coercion.html#topNormaliseTypeX"><span class="hs-identifier hs-var hs-var">topNormaliseTypeX</span></a></span></span><span> </span><span id="local-6989586621682578937"><span class="annot"><span class="annottext">NormaliseStepper ev
</span><a href="#local-6989586621682578937"><span class="hs-identifier hs-var">stepper</span></a></span></span><span> </span><span id="local-6989586621682578938"><span class="annot"><span class="annottext">ev -&gt; ev -&gt; ev
</span><a href="#local-6989586621682578938"><span class="hs-identifier hs-var">plus</span></a></span></span><span> </span><span id="local-6989586621682578939"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682578939"><span class="hs-identifier hs-var">ty</span></a></span></span><span>
</span><span id="line-1875"></span><span> </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span class="hs-special">(</span><span id="local-6989586621682578940"><span class="annot"><span class="annottext">TyCon
</span><a href="#local-6989586621682578940"><span class="hs-identifier hs-var">tc</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682578941"><span class="annot"><span class="annottext">[Type]
</span><a href="#local-6989586621682578941"><span class="hs-identifier hs-var">tys</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">HasDebugCallStack =&gt; Type -&gt; Maybe (TyCon, [Type])
Type -&gt; Maybe (TyCon, [Type])
</span><a href="GHC.Core.Type.html#splitTyConApp_maybe"><span class="hs-identifier hs-var">splitTyConApp_maybe</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682578939"><span class="hs-identifier hs-var">ty</span></a></span><span>
</span><span id="line-1876"></span><span> </span><span class="hs-comment">-- SPJ: The default threshold for initRecTc is 100 which is extremely dangerous</span><span>
</span><span id="line-1877"></span><span> </span><span class="hs-comment">--      for certain type synonyms, we should think about reducing it (see #20990)</span><span>
</span><span id="line-1878"></span><span> </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Core.Coercion.html#NS_Step"><span class="hs-identifier hs-type">NS_Step</span></a></span><span> </span><span id="local-6989586621682578942"><span class="annot"><span class="annottext">RecTcChecker
</span><a href="#local-6989586621682578942"><span class="hs-identifier hs-var">rec_nts</span></a></span></span><span> </span><span id="local-6989586621682578943"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682578943"><span class="hs-identifier hs-var">ty'</span></a></span></span><span> </span><span id="local-6989586621682578944"><span class="annot"><span class="annottext">ev
</span><a href="#local-6989586621682578944"><span class="hs-identifier hs-var">ev</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">NormaliseStepper ev
</span><a href="#local-6989586621682578937"><span class="hs-identifier hs-var">stepper</span></a></span><span> </span><span class="annot"><span class="annottext">RecTcChecker
</span><a href="GHC.Core.TyCon.RecWalk.html#initRecTc"><span class="hs-identifier hs-var">initRecTc</span></a></span><span> </span><span class="annot"><span class="annottext">TyCon
</span><a href="#local-6989586621682578940"><span class="hs-identifier hs-var">tc</span></a></span><span> </span><span class="annot"><span class="annottext">[Type]
</span><a href="#local-6989586621682578941"><span class="hs-identifier hs-var">tys</span></a></span><span>
</span><span id="line-1879"></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">RecTcChecker -&gt; ev -&gt; Type -&gt; Maybe (ev, Type)
</span><a href="#local-6989586621682578946"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="annot"><span class="annottext">RecTcChecker
</span><a href="#local-6989586621682578942"><span class="hs-identifier hs-var">rec_nts</span></a></span><span> </span><span class="annot"><span class="annottext">ev
</span><a href="#local-6989586621682578944"><span class="hs-identifier hs-var">ev</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682578943"><span class="hs-identifier hs-var">ty'</span></a></span><span>
</span><span id="line-1880"></span><span> </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">otherwise</span></span><span>
</span><span id="line-1881"></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Maybe (ev, Type)
forall a. Maybe a
</span><span class="hs-identifier hs-var">Nothing</span></span><span>
</span><span id="line-1882"></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-1883"></span><span>    </span><span id="local-6989586621682578946"><span class="annot"><span class="annottext">go :: RecTcChecker -&gt; ev -&gt; Type -&gt; Maybe (ev, Type)
</span><a href="#local-6989586621682578946"><span class="hs-identifier hs-var hs-var">go</span></a></span></span><span> </span><span id="local-6989586621682578947"><span class="annot"><span class="annottext">RecTcChecker
</span><a href="#local-6989586621682578947"><span class="hs-identifier hs-var">rec_nts</span></a></span></span><span> </span><span id="local-6989586621682578948"><span class="annot"><span class="annottext">ev
</span><a href="#local-6989586621682578948"><span class="hs-identifier hs-var">ev</span></a></span></span><span> </span><span id="local-6989586621682578949"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682578949"><span class="hs-identifier hs-var">ty</span></a></span></span><span>
</span><span id="line-1884"></span><span>      </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span class="hs-special">(</span><span id="local-6989586621682578950"><span class="annot"><span class="annottext">TyCon
</span><a href="#local-6989586621682578950"><span class="hs-identifier hs-var">tc</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682578951"><span class="annot"><span class="annottext">[Type]
</span><a href="#local-6989586621682578951"><span class="hs-identifier hs-var">tys</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">HasDebugCallStack =&gt; Type -&gt; Maybe (TyCon, [Type])
Type -&gt; Maybe (TyCon, [Type])
</span><a href="GHC.Core.Type.html#splitTyConApp_maybe"><span class="hs-identifier hs-var">splitTyConApp_maybe</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682578949"><span class="hs-identifier hs-var">ty</span></a></span><span>
</span><span id="line-1885"></span><span>      </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">NormaliseStepper ev
</span><a href="#local-6989586621682578937"><span class="hs-identifier hs-var">stepper</span></a></span><span> </span><span class="annot"><span class="annottext">RecTcChecker
</span><a href="#local-6989586621682578947"><span class="hs-identifier hs-var">rec_nts</span></a></span><span> </span><span class="annot"><span class="annottext">TyCon
</span><a href="#local-6989586621682578950"><span class="hs-identifier hs-var">tc</span></a></span><span> </span><span class="annot"><span class="annottext">[Type]
</span><a href="#local-6989586621682578951"><span class="hs-identifier hs-var">tys</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-1886"></span><span>          </span><span class="annot"><a href="GHC.Core.Coercion.html#NS_Step"><span class="hs-identifier hs-type">NS_Step</span></a></span><span> </span><span id="local-6989586621682578952"><span class="annot"><span class="annottext">RecTcChecker
</span><a href="#local-6989586621682578952"><span class="hs-identifier hs-var">rec_nts'</span></a></span></span><span> </span><span id="local-6989586621682578953"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682578953"><span class="hs-identifier hs-var">ty'</span></a></span></span><span> </span><span id="local-6989586621682578954"><span class="annot"><span class="annottext">ev
</span><a href="#local-6989586621682578954"><span class="hs-identifier hs-var">ev'</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">RecTcChecker -&gt; ev -&gt; Type -&gt; Maybe (ev, Type)
</span><a href="#local-6989586621682578946"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="annot"><span class="annottext">RecTcChecker
</span><a href="#local-6989586621682578952"><span class="hs-identifier hs-var">rec_nts'</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ev
</span><a href="#local-6989586621682578948"><span class="hs-identifier hs-var">ev</span></a></span><span> </span><span class="annot"><span class="annottext">ev -&gt; ev -&gt; ev
</span><a href="#local-6989586621682578938"><span class="hs-operator hs-var">`plus`</span></a></span><span> </span><span class="annot"><span class="annottext">ev
</span><a href="#local-6989586621682578954"><span class="hs-identifier hs-var">ev'</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682578953"><span class="hs-identifier hs-var">ty'</span></a></span><span>
</span><span id="line-1887"></span><span>          </span><span class="annot"><span class="annottext">NormaliseStepResult ev
</span><a href="GHC.Core.Coercion.html#NS_Done"><span class="hs-identifier hs-var">NS_Done</span></a></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">(ev, Type) -&gt; Maybe (ev, Type)
forall a. a -&gt; Maybe a
</span><span class="hs-identifier hs-var">Just</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ev
</span><a href="#local-6989586621682578948"><span class="hs-identifier hs-var">ev</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682578949"><span class="hs-identifier hs-var">ty</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1888"></span><span>          </span><span class="annot"><span class="annottext">NormaliseStepResult ev
</span><a href="GHC.Core.Coercion.html#NS_Abort"><span class="hs-identifier hs-var">NS_Abort</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Maybe (ev, Type)
forall a. Maybe a
</span><span class="hs-identifier hs-var">Nothing</span></span><span>
</span><span id="line-1889"></span><span>
</span><span id="line-1890"></span><span>      </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">otherwise</span></span><span>
</span><span id="line-1891"></span><span>      </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(ev, Type) -&gt; Maybe (ev, Type)
forall a. a -&gt; Maybe a
</span><span class="hs-identifier hs-var">Just</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ev
</span><a href="#local-6989586621682578948"><span class="hs-identifier hs-var">ev</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682578949"><span class="hs-identifier hs-var">ty</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1892"></span><span>
</span><span id="line-1893"></span><span class="annot"><a href="GHC.Core.Coercion.html#topNormaliseNewType_maybe"><span class="hs-identifier hs-type">topNormaliseNewType_maybe</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#Type"><span class="hs-identifier hs-type">Type</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Maybe</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#Coercion"><span class="hs-identifier hs-type">Coercion</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#Type"><span class="hs-identifier hs-type">Type</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1894"></span><span class="hs-comment">-- ^ Sometimes we want to look through a @newtype@ and get its associated coercion.</span><span>
</span><span id="line-1895"></span><span class="hs-comment">-- This function strips off @newtype@ layers enough to reveal something that isn't</span><span>
</span><span id="line-1896"></span><span class="hs-comment">-- a @newtype@.  Specifically, here's the invariant:</span><span>
</span><span id="line-1897"></span><span class="hs-comment">--</span><span>
</span><span id="line-1898"></span><span class="hs-comment">-- &gt; topNormaliseNewType_maybe rec_nts ty = Just (co, ty')</span><span>
</span><span id="line-1899"></span><span class="hs-comment">--</span><span>
</span><span id="line-1900"></span><span class="hs-comment">-- then (a)  @co : ty ~R ty'@.</span><span>
</span><span id="line-1901"></span><span class="hs-comment">--      (b)  ty' is not a newtype.</span><span>
</span><span id="line-1902"></span><span class="hs-comment">--</span><span>
</span><span id="line-1903"></span><span class="hs-comment">-- The function returns @Nothing@ for non-@newtypes@,</span><span>
</span><span id="line-1904"></span><span class="hs-comment">-- or unsaturated applications</span><span>
</span><span id="line-1905"></span><span class="hs-comment">--</span><span>
</span><span id="line-1906"></span><span class="hs-comment">-- This function does *not* look through type families, because it has no access to</span><span>
</span><span id="line-1907"></span><span class="hs-comment">-- the type family environment. If you do have that at hand, consider to use</span><span>
</span><span id="line-1908"></span><span class="hs-comment">-- topNormaliseType_maybe, which should be a drop-in replacement for</span><span>
</span><span id="line-1909"></span><span class="hs-comment">-- topNormaliseNewType_maybe</span><span>
</span><span id="line-1910"></span><span class="hs-comment">-- If topNormliseNewType_maybe ty = Just (co, ty'), then co : ty ~R ty'</span><span>
</span><span id="line-1911"></span><span id="topNormaliseNewType_maybe"><span class="annot"><span class="annottext">topNormaliseNewType_maybe :: Type -&gt; Maybe (Coercion, Type)
</span><a href="GHC.Core.Coercion.html#topNormaliseNewType_maybe"><span class="hs-identifier hs-var hs-var">topNormaliseNewType_maybe</span></a></span></span><span> </span><span id="local-6989586621682578955"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682578955"><span class="hs-identifier hs-var">ty</span></a></span></span><span>
</span><span id="line-1912"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">NormaliseStepper Coercion
-&gt; (Coercion -&gt; Coercion -&gt; Coercion)
-&gt; Type
-&gt; Maybe (Coercion, Type)
forall ev.
NormaliseStepper ev -&gt; (ev -&gt; ev -&gt; ev) -&gt; Type -&gt; Maybe (ev, Type)
</span><a href="GHC.Core.Coercion.html#topNormaliseTypeX"><span class="hs-identifier hs-var">topNormaliseTypeX</span></a></span><span> </span><span class="annot"><span class="annottext">NormaliseStepper Coercion
</span><a href="GHC.Core.Coercion.html#unwrapNewTypeStepper"><span class="hs-identifier hs-var">unwrapNewTypeStepper</span></a></span><span> </span><span class="annot"><span class="annottext">HasDebugCallStack =&gt; Coercion -&gt; Coercion -&gt; Coercion
Coercion -&gt; Coercion -&gt; Coercion
</span><a href="GHC.Core.Coercion.html#mkTransCo"><span class="hs-identifier hs-var">mkTransCo</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682578955"><span class="hs-identifier hs-var">ty</span></a></span><span>
</span><span id="line-1913"></span><span>
</span><span id="line-1914"></span><span class="hs-comment">{-
%************************************************************************
%*                                                                      *
                   Comparison of coercions
%*                                                                      *
%************************************************************************
-}</span><span>
</span><span id="line-1921"></span><span>
</span><span id="line-1922"></span><span class="annot"><span class="hs-comment">-- | Syntactic equality of coercions</span></span><span>
</span><span id="line-1923"></span><span class="annot"><a href="GHC.Core.Coercion.html#eqCoercion"><span class="hs-identifier hs-type">eqCoercion</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#Coercion"><span class="hs-identifier hs-type">Coercion</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#Coercion"><span class="hs-identifier hs-type">Coercion</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Bool</span></span><span>
</span><span id="line-1924"></span><span id="eqCoercion"><span class="annot"><span class="annottext">eqCoercion :: Coercion -&gt; Coercion -&gt; Bool
</span><a href="GHC.Core.Coercion.html#eqCoercion"><span class="hs-identifier hs-var hs-var">eqCoercion</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">HasCallStack =&gt; Type -&gt; Type -&gt; Bool
Type -&gt; Type -&gt; Bool
</span><a href="GHC.Core.TyCo.Compare.html#eqType"><span class="hs-identifier hs-var">eqType</span></a></span><span> </span><span class="annot"><span class="annottext">(Type -&gt; Type -&gt; Bool)
-&gt; (Coercion -&gt; Type) -&gt; Coercion -&gt; Coercion -&gt; Bool
forall b c a. (b -&gt; b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; a -&gt; c
</span><span class="hs-operator hs-var">`on`</span></span><span> </span><span class="annot"><span class="annottext">Coercion -&gt; Type
</span><a href="GHC.Core.Coercion.html#coercionType"><span class="hs-identifier hs-var">coercionType</span></a></span><span>
</span><span id="line-1925"></span><span>
</span><span id="line-1926"></span><span class="annot"><span class="hs-comment">-- | Compare two 'Coercion's, with respect to an RnEnv2</span></span><span>
</span><span id="line-1927"></span><span class="annot"><a href="GHC.Core.Coercion.html#eqCoercionX"><span class="hs-identifier hs-type">eqCoercionX</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Types.Var.Env.html#RnEnv2"><span class="hs-identifier hs-type">RnEnv2</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#Coercion"><span class="hs-identifier hs-type">Coercion</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#Coercion"><span class="hs-identifier hs-type">Coercion</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Bool</span></span><span>
</span><span id="line-1928"></span><span id="eqCoercionX"><span class="annot"><span class="annottext">eqCoercionX :: RnEnv2 -&gt; Coercion -&gt; Coercion -&gt; Bool
</span><a href="GHC.Core.Coercion.html#eqCoercionX"><span class="hs-identifier hs-var hs-var">eqCoercionX</span></a></span></span><span> </span><span id="local-6989586621682578956"><span class="annot"><span class="annottext">RnEnv2
</span><a href="#local-6989586621682578956"><span class="hs-identifier hs-var">env</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">HasCallStack =&gt; RnEnv2 -&gt; Type -&gt; Type -&gt; Bool
RnEnv2 -&gt; Type -&gt; Type -&gt; Bool
</span><a href="GHC.Core.TyCo.Compare.html#eqTypeX"><span class="hs-identifier hs-var">eqTypeX</span></a></span><span> </span><span class="annot"><span class="annottext">RnEnv2
</span><a href="#local-6989586621682578956"><span class="hs-identifier hs-var">env</span></a></span><span> </span><span class="annot"><span class="annottext">(Type -&gt; Type -&gt; Bool)
-&gt; (Coercion -&gt; Type) -&gt; Coercion -&gt; Coercion -&gt; Bool
forall b c a. (b -&gt; b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; a -&gt; c
</span><span class="hs-operator hs-var">`on`</span></span><span> </span><span class="annot"><span class="annottext">Coercion -&gt; Type
</span><a href="GHC.Core.Coercion.html#coercionType"><span class="hs-identifier hs-var">coercionType</span></a></span><span>
</span><span id="line-1929"></span><span>
</span><span id="line-1930"></span><span class="hs-comment">{-
%************************************************************************
%*                                                                      *
                   &quot;Lifting&quot; substitution
           [(TyCoVar,Coercion)] -&gt; Type -&gt; Coercion
%*                                                                      *
%************************************************************************

Note [Lifting coercions over types: liftCoSubst]
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
The KPUSH rule deals with this situation
   data T a = K (a -&gt; Maybe a)
   g :: T t1 ~ T t2
   x :: t1 -&gt; Maybe t1

   case (K @t1 x) |&gt; g of
     K (y:t2 -&gt; Maybe t2) -&gt; rhs

We want to push the coercion inside the constructor application.
So we do this

   g' :: t1~t2  =  SelCo (SelTyCon 0) g

   case K @t2 (x |&gt; g' -&gt; Maybe g') of
     K (y:t2 -&gt; Maybe t2) -&gt; rhs

The crucial operation is that we
  * take the type of K's argument: a -&gt; Maybe a
  * and substitute g' for a
thus giving *coercion*.  This is what liftCoSubst does.

In the presence of kind coercions, this is a bit
of a hairy operation. So, we refer you to the paper introducing kind coercions,
available at www.cis.upenn.edu/~sweirich/papers/fckinds-extended.pdf

Note [extendLiftingContextEx]
~~~~~~~~~~~~~~~~~~~~~~~~~~~
Consider we have datatype
  K :: /\k. /\a::k. P -&gt; T k  -- P be some type
  g :: T k1 ~ T k2

  case (K @k1 @t1 x) |&gt; g of
    K y -&gt; rhs

We want to push the coercion inside the constructor application.
We first get the coercion mapped by the universal type variable k:
   lc = k |-&gt; SelCo (SelTyCon 0) g :: k1~k2

Here, the important point is that the kind of a is coerced, and P might be
dependent on the existential type variable a.
Thus we first get the coercion of a's kind
   g2 = liftCoSubst lc k :: k1 ~ k2

Then we store a new mapping into the lifting context
   lc2 = a |-&gt; (t1 ~ t1 |&gt; g2), lc

So later when we can correctly deal with the argument type P
   liftCoSubst lc2 P :: P [k|-&gt;k1][a|-&gt;t1] ~ P[k|-&gt;k2][a |-&gt; (t1|&gt;g2)]

This is exactly what extendLiftingContextEx does.
* For each (tyvar:k, ty) pair, we product the mapping
    tyvar |-&gt; (ty ~ ty |&gt; (liftCoSubst lc k))
* For each (covar:s1~s2, ty) pair, we produce the mapping
    covar |-&gt; (co ~ co')
    co' = Sym (liftCoSubst lc s1) ;; covar ;; liftCoSubst lc s2 :: s1'~s2'

This follows the lifting context extension definition in the
&quot;FC with Explicit Kind Equality&quot; paper.
-}</span><span>
</span><span id="line-1999"></span><span>
</span><span id="line-2000"></span><span class="hs-comment">-- ----------------------------------------------------</span><span>
</span><span id="line-2001"></span><span class="hs-comment">-- See Note [Lifting coercions over types: liftCoSubst]</span><span>
</span><span id="line-2002"></span><span class="hs-comment">-- ----------------------------------------------------</span><span>
</span><span id="line-2003"></span><span>
</span><span id="line-2004"></span><span class="hs-keyword">data</span><span> </span><span id="LiftingContext"><span class="annot"><a href="GHC.Core.Coercion.html#LiftingContext"><span class="hs-identifier hs-var">LiftingContext</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="LC"><span class="annot"><a href="GHC.Core.Coercion.html#LC"><span class="hs-identifier hs-var">LC</span></a></span></span><span> </span><span class="annot"><a href="GHC.Core.TyCo.Subst.html#Subst"><span class="hs-identifier hs-type">Subst</span></a></span><span> </span><span class="annot"><a href="GHC.Core.Coercion.html#LiftCoEnv"><span class="hs-identifier hs-type">LiftCoEnv</span></a></span><span>
</span><span id="line-2005"></span><span>  </span><span class="hs-comment">-- in optCoercion, we need to lift when optimizing InstCo.</span><span>
</span><span id="line-2006"></span><span>  </span><span class="hs-comment">-- See Note [Optimising InstCo] in GHC.Core.Coercion.Opt</span><span>
</span><span id="line-2007"></span><span>  </span><span class="hs-comment">-- We thus propagate the substitution from GHC.Core.Coercion.Opt here.</span><span>
</span><span id="line-2008"></span><span>
</span><span id="line-2009"></span><span class="hs-keyword">instance</span><span> </span><span class="annot"><a href="GHC.Utils.Outputable.html#Outputable"><span class="hs-identifier hs-type">Outputable</span></a></span><span> </span><span class="annot"><a href="GHC.Core.Coercion.html#LiftingContext"><span class="hs-identifier hs-type">LiftingContext</span></a></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-2010"></span><span>  </span><span id="local-6989586621682578964"><span class="annot"><span class="annottext">ppr :: LiftingContext -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var hs-var hs-var">ppr</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Core.Coercion.html#LC"><span class="hs-identifier hs-type">LC</span></a></span><span> </span><span class="annot"><span class="annottext">Subst
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621682578965"><span class="annot"><span class="annottext">LiftCoEnv
</span><a href="#local-6989586621682578965"><span class="hs-identifier hs-var">env</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">SDoc -&gt; Arity -&gt; SDoc -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#hang"><span class="hs-identifier hs-var">hang</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">String -&gt; SDoc
forall doc. IsLine doc =&gt; String -&gt; doc
</span><a href="GHC.Utils.Outputable.html#text"><span class="hs-identifier hs-var">text</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;LiftingContext:&quot;</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Arity
</span><span class="hs-number">2</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">LiftCoEnv -&gt; SDoc
forall a. Outputable a =&gt; a -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="annot"><span class="annottext">LiftCoEnv
</span><a href="#local-6989586621682578965"><span class="hs-identifier hs-var">env</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-2011"></span><span>
</span><span id="line-2012"></span><span class="hs-keyword">type</span><span> </span><span id="LiftCoEnv"><span class="annot"><a href="GHC.Core.Coercion.html#LiftCoEnv"><span class="hs-identifier hs-var">LiftCoEnv</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="GHC.Types.Var.Env.html#VarEnv"><span class="hs-identifier hs-type">VarEnv</span></a></span><span> </span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#Coercion"><span class="hs-identifier hs-type">Coercion</span></a></span><span>
</span><span id="line-2013"></span><span>     </span><span class="hs-comment">-- Maps *type variables* to *coercions*.</span><span>
</span><span id="line-2014"></span><span>     </span><span class="hs-comment">-- That's the whole point of this function!</span><span>
</span><span id="line-2015"></span><span>     </span><span class="hs-comment">-- Also maps coercion variables to ProofIrrelCos.</span><span>
</span><span id="line-2016"></span><span>
</span><span id="line-2017"></span><span class="hs-comment">-- like liftCoSubstWith, but allows for existentially-bound types as well</span><span>
</span><span id="line-2018"></span><span class="annot"><a href="GHC.Core.Coercion.html#liftCoSubstWithEx"><span class="hs-identifier hs-type">liftCoSubstWithEx</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Language.Haskell.Syntax.Basic.html#Role"><span class="hs-identifier hs-type">Role</span></a></span><span>          </span><span class="hs-comment">-- desired role for output coercion</span><span>
</span><span id="line-2019"></span><span>                  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="GHC.Types.Var.html#TyVar"><span class="hs-identifier hs-type">TyVar</span></a></span><span class="hs-special">]</span><span>       </span><span class="hs-comment">-- universally quantified tyvars</span><span>
</span><span id="line-2020"></span><span>                  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#Coercion"><span class="hs-identifier hs-type">Coercion</span></a></span><span class="hs-special">]</span><span>    </span><span class="hs-comment">-- coercions to substitute for those</span><span>
</span><span id="line-2021"></span><span>                  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="GHC.Types.Var.html#TyCoVar"><span class="hs-identifier hs-type">TyCoVar</span></a></span><span class="hs-special">]</span><span>     </span><span class="hs-comment">-- existentially quantified tycovars</span><span>
</span><span id="line-2022"></span><span>                  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#Type"><span class="hs-identifier hs-type">Type</span></a></span><span class="hs-special">]</span><span>        </span><span class="hs-comment">-- types and coercions to be bound to ex vars</span><span>
</span><span id="line-2023"></span><span>                  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#Type"><span class="hs-identifier hs-type">Type</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#Coercion"><span class="hs-identifier hs-type">Coercion</span></a></span><span class="hs-special">,</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#Type"><span class="hs-identifier hs-type">Type</span></a></span><span class="hs-special">]</span><span class="hs-special">)</span><span> </span><span class="hs-comment">-- (lifting function, converted ex args)</span><span>
</span><span id="line-2024"></span><span id="liftCoSubstWithEx"><span class="annot"><span class="annottext">liftCoSubstWithEx :: Role
-&gt; [CoVar]
-&gt; [Coercion]
-&gt; [CoVar]
-&gt; [Type]
-&gt; (Type -&gt; Coercion, [Type])
</span><a href="GHC.Core.Coercion.html#liftCoSubstWithEx"><span class="hs-identifier hs-var hs-var">liftCoSubstWithEx</span></a></span></span><span> </span><span id="local-6989586621682578966"><span class="annot"><span class="annottext">Role
</span><a href="#local-6989586621682578966"><span class="hs-keyword hs-var">role</span></a></span></span><span> </span><span id="local-6989586621682578967"><span class="annot"><span class="annottext">[CoVar]
</span><a href="#local-6989586621682578967"><span class="hs-identifier hs-var">univs</span></a></span></span><span> </span><span id="local-6989586621682578968"><span class="annot"><span class="annottext">[Coercion]
</span><a href="#local-6989586621682578968"><span class="hs-identifier hs-var">omegas</span></a></span></span><span> </span><span id="local-6989586621682578969"><span class="annot"><span class="annottext">[CoVar]
</span><a href="#local-6989586621682578969"><span class="hs-identifier hs-var">exs</span></a></span></span><span> </span><span id="local-6989586621682578970"><span class="annot"><span class="annottext">[Type]
</span><a href="#local-6989586621682578970"><span class="hs-identifier hs-var">rhos</span></a></span></span><span>
</span><span id="line-2025"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621682578971"><span class="annot"><span class="annottext">theta :: LiftingContext
</span><a href="#local-6989586621682578971"><span class="hs-identifier hs-var hs-var">theta</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[(CoVar, Coercion)] -&gt; LiftingContext
</span><a href="GHC.Core.Coercion.html#mkLiftingContext"><span class="hs-identifier hs-var">mkLiftingContext</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">String -&gt; [CoVar] -&gt; [Coercion] -&gt; [(CoVar, Coercion)]
forall a b. HasDebugCallStack =&gt; String -&gt; [a] -&gt; [b] -&gt; [(a, b)]
</span><a href="GHC.Utils.Misc.html#zipEqual"><span class="hs-identifier hs-var">zipEqual</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;liftCoSubstWithExU&quot;</span></span><span> </span><span class="annot"><span class="annottext">[CoVar]
</span><a href="#local-6989586621682578967"><span class="hs-identifier hs-var">univs</span></a></span><span> </span><span class="annot"><span class="annottext">[Coercion]
</span><a href="#local-6989586621682578968"><span class="hs-identifier hs-var">omegas</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-2026"></span><span>        </span><span id="local-6989586621682578973"><span class="annot"><span class="annottext">psi :: LiftingContext
</span><a href="#local-6989586621682578973"><span class="hs-identifier hs-var hs-var">psi</span></a></span></span><span>   </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">LiftingContext -&gt; [(CoVar, Type)] -&gt; LiftingContext
</span><a href="GHC.Core.Coercion.html#extendLiftingContextEx"><span class="hs-identifier hs-var">extendLiftingContextEx</span></a></span><span> </span><span class="annot"><span class="annottext">LiftingContext
</span><a href="#local-6989586621682578971"><span class="hs-identifier hs-var">theta</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">String -&gt; [CoVar] -&gt; [Type] -&gt; [(CoVar, Type)]
forall a b. HasDebugCallStack =&gt; String -&gt; [a] -&gt; [b] -&gt; [(a, b)]
</span><a href="GHC.Utils.Misc.html#zipEqual"><span class="hs-identifier hs-var">zipEqual</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;liftCoSubstWithExX&quot;</span></span><span> </span><span class="annot"><span class="annottext">[CoVar]
</span><a href="#local-6989586621682578969"><span class="hs-identifier hs-var">exs</span></a></span><span> </span><span class="annot"><span class="annottext">[Type]
</span><a href="#local-6989586621682578970"><span class="hs-identifier hs-var">rhos</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-2027"></span><span>    </span><span class="hs-keyword">in</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">LiftingContext -&gt; Role -&gt; Type -&gt; Coercion
</span><a href="GHC.Core.Coercion.html#ty_co_subst"><span class="hs-identifier hs-var">ty_co_subst</span></a></span><span> </span><span class="annot"><span class="annottext">LiftingContext
</span><a href="#local-6989586621682578973"><span class="hs-identifier hs-var">psi</span></a></span><span> </span><span class="annot"><span class="annottext">Role
</span><a href="#local-6989586621682578966"><span class="hs-keyword hs-var">role</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">HasDebugCallStack =&gt; Subst -&gt; [Type] -&gt; [Type]
Subst -&gt; [Type] -&gt; [Type]
</span><a href="GHC.Core.TyCo.Subst.html#substTys"><span class="hs-identifier hs-var">substTys</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">LiftingContext -&gt; Subst
</span><a href="GHC.Core.Coercion.html#lcSubstRight"><span class="hs-identifier hs-var">lcSubstRight</span></a></span><span> </span><span class="annot"><span class="annottext">LiftingContext
</span><a href="#local-6989586621682578973"><span class="hs-identifier hs-var">psi</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[CoVar] -&gt; [Type]
</span><a href="GHC.Core.TyCo.Rep.html#mkTyCoVarTys"><span class="hs-identifier hs-var">mkTyCoVarTys</span></a></span><span> </span><span class="annot"><span class="annottext">[CoVar]
</span><a href="#local-6989586621682578969"><span class="hs-identifier hs-var">exs</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-2028"></span><span>
</span><span id="line-2029"></span><span class="annot"><a href="GHC.Core.Coercion.html#liftCoSubstWith"><span class="hs-identifier hs-type">liftCoSubstWith</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Language.Haskell.Syntax.Basic.html#Role"><span class="hs-identifier hs-type">Role</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="GHC.Types.Var.html#TyCoVar"><span class="hs-identifier hs-type">TyCoVar</span></a></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#Coercion"><span class="hs-identifier hs-type">Coercion</span></a></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#Type"><span class="hs-identifier hs-type">Type</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#Coercion"><span class="hs-identifier hs-type">Coercion</span></a></span><span>
</span><span id="line-2030"></span><span id="liftCoSubstWith"><span class="annot"><span class="annottext">liftCoSubstWith :: Role -&gt; [CoVar] -&gt; [Coercion] -&gt; Type -&gt; Coercion
</span><a href="GHC.Core.Coercion.html#liftCoSubstWith"><span class="hs-identifier hs-var hs-var">liftCoSubstWith</span></a></span></span><span> </span><span id="local-6989586621682578978"><span class="annot"><span class="annottext">Role
</span><a href="#local-6989586621682578978"><span class="hs-identifier hs-var">r</span></a></span></span><span> </span><span id="local-6989586621682578979"><span class="annot"><span class="annottext">[CoVar]
</span><a href="#local-6989586621682578979"><span class="hs-identifier hs-var">tvs</span></a></span></span><span> </span><span id="local-6989586621682578980"><span class="annot"><span class="annottext">[Coercion]
</span><a href="#local-6989586621682578980"><span class="hs-identifier hs-var">cos</span></a></span></span><span> </span><span id="local-6989586621682578981"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682578981"><span class="hs-identifier hs-var">ty</span></a></span></span><span>
</span><span id="line-2031"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">HasDebugCallStack =&gt; Role -&gt; LiftingContext -&gt; Type -&gt; Coercion
Role -&gt; LiftingContext -&gt; Type -&gt; Coercion
</span><a href="GHC.Core.Coercion.html#liftCoSubst"><span class="hs-identifier hs-var">liftCoSubst</span></a></span><span> </span><span class="annot"><span class="annottext">Role
</span><a href="#local-6989586621682578978"><span class="hs-identifier hs-var">r</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[(CoVar, Coercion)] -&gt; LiftingContext
</span><a href="GHC.Core.Coercion.html#mkLiftingContext"><span class="hs-identifier hs-var">mkLiftingContext</span></a></span><span> </span><span class="annot"><span class="annottext">([(CoVar, Coercion)] -&gt; LiftingContext)
-&gt; [(CoVar, Coercion)] -&gt; LiftingContext
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">String -&gt; [CoVar] -&gt; [Coercion] -&gt; [(CoVar, Coercion)]
forall a b. HasDebugCallStack =&gt; String -&gt; [a] -&gt; [b] -&gt; [(a, b)]
</span><a href="GHC.Utils.Misc.html#zipEqual"><span class="hs-identifier hs-var">zipEqual</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;liftCoSubstWith&quot;</span></span><span> </span><span class="annot"><span class="annottext">[CoVar]
</span><a href="#local-6989586621682578979"><span class="hs-identifier hs-var">tvs</span></a></span><span> </span><span class="annot"><span class="annottext">[Coercion]
</span><a href="#local-6989586621682578980"><span class="hs-identifier hs-var">cos</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682578981"><span class="hs-identifier hs-var">ty</span></a></span><span>
</span><span id="line-2032"></span><span>
</span><span id="line-2033"></span><span class="hs-comment">-- | @liftCoSubst role lc ty@ produces a coercion (at role @role@)</span><span>
</span><span id="line-2034"></span><span class="hs-comment">-- that coerces between @lc_left(ty)@ and @lc_right(ty)@, where</span><span>
</span><span id="line-2035"></span><span class="hs-comment">-- @lc_left@ is a substitution mapping type variables to the left-hand</span><span>
</span><span id="line-2036"></span><span class="hs-comment">-- types of the mapped coercions in @lc@, and similar for @lc_right@.</span><span>
</span><span id="line-2037"></span><span class="annot"><a href="GHC.Core.Coercion.html#liftCoSubst"><span class="hs-identifier hs-type">liftCoSubst</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Utils.Misc.html#HasDebugCallStack"><span class="hs-identifier hs-type">HasDebugCallStack</span></a></span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="Language.Haskell.Syntax.Basic.html#Role"><span class="hs-identifier hs-type">Role</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Core.Coercion.html#LiftingContext"><span class="hs-identifier hs-type">LiftingContext</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#Type"><span class="hs-identifier hs-type">Type</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#Coercion"><span class="hs-identifier hs-type">Coercion</span></a></span><span>
</span><span id="line-2038"></span><span class="hs-pragma">{-# INLINE</span><span> </span><span class="annot"><a href="GHC.Core.Coercion.html#liftCoSubst"><span class="hs-pragma hs-type">liftCoSubst</span></a></span><span> </span><span class="hs-pragma">#-}</span><span>
</span><span id="line-2039"></span><span class="hs-comment">-- Inlining this function is worth 2% of allocation in T9872d,</span><span>
</span><span id="line-2040"></span><span id="liftCoSubst"><span class="annot"><span class="annottext">liftCoSubst :: HasDebugCallStack =&gt; Role -&gt; LiftingContext -&gt; Type -&gt; Coercion
</span><a href="GHC.Core.Coercion.html#liftCoSubst"><span class="hs-identifier hs-var hs-var">liftCoSubst</span></a></span></span><span> </span><span id="local-6989586621682578984"><span class="annot"><span class="annottext">Role
</span><a href="#local-6989586621682578984"><span class="hs-identifier hs-var">r</span></a></span></span><span> </span><span id="local-6989586621682578985"><span class="annot"><span class="annottext">lc :: LiftingContext
</span><a href="#local-6989586621682578985"><span class="hs-identifier hs-var">lc</span></a></span></span><span class="hs-glyph">@</span><span class="hs-special">(</span><span class="annot"><a href="GHC.Core.Coercion.html#LC"><span class="hs-identifier hs-type">LC</span></a></span><span> </span><span id="local-6989586621682578986"><span class="annot"><span class="annottext">Subst
</span><a href="#local-6989586621682578986"><span class="hs-identifier hs-var">subst</span></a></span></span><span> </span><span id="local-6989586621682578987"><span class="annot"><span class="annottext">LiftCoEnv
</span><a href="#local-6989586621682578987"><span class="hs-identifier hs-var">env</span></a></span></span><span class="hs-special">)</span><span> </span><span id="local-6989586621682578988"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682578988"><span class="hs-identifier hs-var">ty</span></a></span></span><span>
</span><span id="line-2041"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">LiftCoEnv -&gt; Bool
forall a. VarEnv a -&gt; Bool
</span><a href="GHC.Types.Var.Env.html#isEmptyVarEnv"><span class="hs-identifier hs-var">isEmptyVarEnv</span></a></span><span> </span><span class="annot"><span class="annottext">LiftCoEnv
</span><a href="#local-6989586621682578987"><span class="hs-identifier hs-var">env</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Role -&gt; Type -&gt; Coercion
</span><a href="GHC.Core.Coercion.html#mkReflCo"><span class="hs-identifier hs-var">mkReflCo</span></a></span><span> </span><span class="annot"><span class="annottext">Role
</span><a href="#local-6989586621682578984"><span class="hs-identifier hs-var">r</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">HasDebugCallStack =&gt; Subst -&gt; Type -&gt; Type
Subst -&gt; Type -&gt; Type
</span><a href="GHC.Core.TyCo.Subst.html#substTy"><span class="hs-identifier hs-var">substTy</span></a></span><span> </span><span class="annot"><span class="annottext">Subst
</span><a href="#local-6989586621682578986"><span class="hs-identifier hs-var">subst</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682578988"><span class="hs-identifier hs-var">ty</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-2042"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">otherwise</span></span><span>         </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">LiftingContext -&gt; Role -&gt; Type -&gt; Coercion
</span><a href="GHC.Core.Coercion.html#ty_co_subst"><span class="hs-identifier hs-var">ty_co_subst</span></a></span><span> </span><span class="annot"><span class="annottext">LiftingContext
</span><a href="#local-6989586621682578985"><span class="hs-identifier hs-var">lc</span></a></span><span> </span><span class="annot"><span class="annottext">Role
</span><a href="#local-6989586621682578984"><span class="hs-identifier hs-var">r</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682578988"><span class="hs-identifier hs-var">ty</span></a></span><span>
</span><span id="line-2043"></span><span>
</span><span id="line-2044"></span><span class="annot"><a href="GHC.Core.Coercion.html#emptyLiftingContext"><span class="hs-identifier hs-type">emptyLiftingContext</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Types.Var.Env.html#InScopeSet"><span class="hs-identifier hs-type">InScopeSet</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Core.Coercion.html#LiftingContext"><span class="hs-identifier hs-type">LiftingContext</span></a></span><span>
</span><span id="line-2045"></span><span id="emptyLiftingContext"><span class="annot"><span class="annottext">emptyLiftingContext :: InScopeSet -&gt; LiftingContext
</span><a href="GHC.Core.Coercion.html#emptyLiftingContext"><span class="hs-identifier hs-var hs-var">emptyLiftingContext</span></a></span></span><span> </span><span id="local-6989586621682578990"><span class="annot"><span class="annottext">InScopeSet
</span><a href="#local-6989586621682578990"><span class="hs-identifier hs-var">in_scope</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Subst -&gt; LiftCoEnv -&gt; LiftingContext
</span><a href="GHC.Core.Coercion.html#LC"><span class="hs-identifier hs-var">LC</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">InScopeSet -&gt; Subst
</span><a href="GHC.Core.TyCo.Subst.html#mkEmptySubst"><span class="hs-identifier hs-var">mkEmptySubst</span></a></span><span> </span><span class="annot"><span class="annottext">InScopeSet
</span><a href="#local-6989586621682578990"><span class="hs-identifier hs-var">in_scope</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">LiftCoEnv
forall a. VarEnv a
</span><a href="GHC.Types.Var.Env.html#emptyVarEnv"><span class="hs-identifier hs-var">emptyVarEnv</span></a></span><span>
</span><span id="line-2046"></span><span>
</span><span id="line-2047"></span><span class="annot"><a href="GHC.Core.Coercion.html#mkLiftingContext"><span class="hs-identifier hs-type">mkLiftingContext</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><span class="hs-special">(</span><span class="annot"><a href="GHC.Types.Var.html#TyCoVar"><span class="hs-identifier hs-type">TyCoVar</span></a></span><span class="hs-special">,</span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#Coercion"><span class="hs-identifier hs-type">Coercion</span></a></span><span class="hs-special">)</span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Core.Coercion.html#LiftingContext"><span class="hs-identifier hs-type">LiftingContext</span></a></span><span>
</span><span id="line-2048"></span><span id="mkLiftingContext"><span class="annot"><span class="annottext">mkLiftingContext :: [(CoVar, Coercion)] -&gt; LiftingContext
</span><a href="GHC.Core.Coercion.html#mkLiftingContext"><span class="hs-identifier hs-var hs-var">mkLiftingContext</span></a></span></span><span> </span><span id="local-6989586621682578992"><span class="annot"><span class="annottext">[(CoVar, Coercion)]
</span><a href="#local-6989586621682578992"><span class="hs-identifier hs-var">pairs</span></a></span></span><span>
</span><span id="line-2049"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Subst -&gt; LiftCoEnv -&gt; LiftingContext
</span><a href="GHC.Core.Coercion.html#LC"><span class="hs-identifier hs-var">LC</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">InScopeSet -&gt; Subst
</span><a href="GHC.Core.TyCo.Subst.html#mkEmptySubst"><span class="hs-identifier hs-var">mkEmptySubst</span></a></span><span> </span><span class="annot"><span class="annottext">(InScopeSet -&gt; Subst) -&gt; InScopeSet -&gt; Subst
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">VarSet -&gt; InScopeSet
</span><a href="GHC.Types.Var.Env.html#mkInScopeSet"><span class="hs-identifier hs-var">mkInScopeSet</span></a></span><span> </span><span class="annot"><span class="annottext">(VarSet -&gt; InScopeSet) -&gt; VarSet -&gt; InScopeSet
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">[Coercion] -&gt; VarSet
</span><a href="GHC.Core.TyCo.FVs.html#tyCoVarsOfCos"><span class="hs-identifier hs-var">tyCoVarsOfCos</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">((CoVar, Coercion) -&gt; Coercion)
-&gt; [(CoVar, Coercion)] -&gt; [Coercion]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><span class="hs-identifier hs-var">map</span></span><span> </span><span class="annot"><span class="annottext">(CoVar, Coercion) -&gt; Coercion
forall a b. (a, b) -&gt; b
</span><span class="hs-identifier hs-var">snd</span></span><span> </span><span class="annot"><span class="annottext">[(CoVar, Coercion)]
</span><a href="#local-6989586621682578992"><span class="hs-identifier hs-var">pairs</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-2050"></span><span>       </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[(CoVar, Coercion)] -&gt; LiftCoEnv
forall a. [(CoVar, a)] -&gt; VarEnv a
</span><a href="GHC.Types.Var.Env.html#mkVarEnv"><span class="hs-identifier hs-var">mkVarEnv</span></a></span><span> </span><span class="annot"><span class="annottext">[(CoVar, Coercion)]
</span><a href="#local-6989586621682578992"><span class="hs-identifier hs-var">pairs</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-2051"></span><span>
</span><span id="line-2052"></span><span class="annot"><a href="GHC.Core.Coercion.html#mkSubstLiftingContext"><span class="hs-identifier hs-type">mkSubstLiftingContext</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Core.TyCo.Subst.html#Subst"><span class="hs-identifier hs-type">Subst</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Core.Coercion.html#LiftingContext"><span class="hs-identifier hs-type">LiftingContext</span></a></span><span>
</span><span id="line-2053"></span><span id="mkSubstLiftingContext"><span class="annot"><span class="annottext">mkSubstLiftingContext :: Subst -&gt; LiftingContext
</span><a href="GHC.Core.Coercion.html#mkSubstLiftingContext"><span class="hs-identifier hs-var hs-var">mkSubstLiftingContext</span></a></span></span><span> </span><span id="local-6989586621682578994"><span class="annot"><span class="annottext">Subst
</span><a href="#local-6989586621682578994"><span class="hs-identifier hs-var">subst</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Subst -&gt; LiftCoEnv -&gt; LiftingContext
</span><a href="GHC.Core.Coercion.html#LC"><span class="hs-identifier hs-var">LC</span></a></span><span> </span><span class="annot"><span class="annottext">Subst
</span><a href="#local-6989586621682578994"><span class="hs-identifier hs-var">subst</span></a></span><span> </span><span class="annot"><span class="annottext">LiftCoEnv
forall a. VarEnv a
</span><a href="GHC.Types.Var.Env.html#emptyVarEnv"><span class="hs-identifier hs-var">emptyVarEnv</span></a></span><span>
</span><span id="line-2054"></span><span>
</span><span id="line-2055"></span><span class="annot"><a href="GHC.Core.Coercion.html#liftingContextSubst"><span class="hs-identifier hs-type">liftingContextSubst</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Core.Coercion.html#LiftingContext"><span class="hs-identifier hs-type">LiftingContext</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Core.TyCo.Subst.html#Subst"><span class="hs-identifier hs-type">Subst</span></a></span><span>
</span><span id="line-2056"></span><span id="liftingContextSubst"><span class="annot"><span class="annottext">liftingContextSubst :: LiftingContext -&gt; Subst
</span><a href="GHC.Core.Coercion.html#liftingContextSubst"><span class="hs-identifier hs-var hs-var">liftingContextSubst</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Core.Coercion.html#LC"><span class="hs-identifier hs-type">LC</span></a></span><span> </span><span id="local-6989586621682578995"><span class="annot"><span class="annottext">Subst
</span><a href="#local-6989586621682578995"><span class="hs-identifier hs-var">subst</span></a></span></span><span> </span><span class="annot"><span class="annottext">LiftCoEnv
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Subst
</span><a href="#local-6989586621682578995"><span class="hs-identifier hs-var">subst</span></a></span><span>
</span><span id="line-2057"></span><span>
</span><span id="line-2058"></span><span class="annot"><span class="hs-comment">-- | Extend a lifting context with a new mapping.</span></span><span>
</span><span id="line-2059"></span><span class="annot"><a href="GHC.Core.Coercion.html#extendLiftingContext"><span class="hs-identifier hs-type">extendLiftingContext</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Core.Coercion.html#LiftingContext"><span class="hs-identifier hs-type">LiftingContext</span></a></span><span>  </span><span class="annot"><span class="hs-comment">-- ^ original LC</span></span><span>
</span><span id="line-2060"></span><span>                     </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Types.Var.html#TyCoVar"><span class="hs-identifier hs-type">TyCoVar</span></a></span><span>         </span><span class="annot"><span class="hs-comment">-- ^ new variable to map...</span></span><span>
</span><span id="line-2061"></span><span>                     </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#Coercion"><span class="hs-identifier hs-type">Coercion</span></a></span><span>        </span><span class="annot"><span class="hs-comment">-- ^ ...to this lifted version</span></span><span>
</span><span id="line-2062"></span><span>                     </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Core.Coercion.html#LiftingContext"><span class="hs-identifier hs-type">LiftingContext</span></a></span><span>
</span><span id="line-2063"></span><span>    </span><span class="hs-comment">-- mappings to reflexive coercions are just substitutions</span><span>
</span><span id="line-2064"></span><span id="extendLiftingContext"><span class="annot"><span class="annottext">extendLiftingContext :: LiftingContext -&gt; CoVar -&gt; Coercion -&gt; LiftingContext
</span><a href="GHC.Core.Coercion.html#extendLiftingContext"><span class="hs-identifier hs-var hs-var">extendLiftingContext</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Core.Coercion.html#LC"><span class="hs-identifier hs-type">LC</span></a></span><span> </span><span id="local-6989586621682578996"><span class="annot"><span class="annottext">Subst
</span><a href="#local-6989586621682578996"><span class="hs-identifier hs-var">subst</span></a></span></span><span> </span><span id="local-6989586621682578997"><span class="annot"><span class="annottext">LiftCoEnv
</span><a href="#local-6989586621682578997"><span class="hs-identifier hs-var">env</span></a></span></span><span class="hs-special">)</span><span> </span><span id="local-6989586621682578998"><span class="annot"><span class="annottext">CoVar
</span><a href="#local-6989586621682578998"><span class="hs-identifier hs-var">tv</span></a></span></span><span> </span><span id="local-6989586621682578999"><span class="annot"><span class="annottext">Coercion
</span><a href="#local-6989586621682578999"><span class="hs-identifier hs-var">arg</span></a></span></span><span>
</span><span id="line-2065"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span class="hs-special">(</span><span id="local-6989586621682579000"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682579000"><span class="hs-identifier hs-var">ty</span></a></span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Role
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Coercion -&gt; Maybe (Type, Role)
</span><a href="GHC.Core.Coercion.html#isReflCo_maybe"><span class="hs-identifier hs-var">isReflCo_maybe</span></a></span><span> </span><span class="annot"><span class="annottext">Coercion
</span><a href="#local-6989586621682578999"><span class="hs-identifier hs-var">arg</span></a></span><span>
</span><span id="line-2066"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Subst -&gt; LiftCoEnv -&gt; LiftingContext
</span><a href="GHC.Core.Coercion.html#LC"><span class="hs-identifier hs-var">LC</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Subst -&gt; CoVar -&gt; Type -&gt; Subst
</span><a href="GHC.Core.TyCo.Subst.html#extendTCvSubst"><span class="hs-identifier hs-var">extendTCvSubst</span></a></span><span> </span><span class="annot"><span class="annottext">Subst
</span><a href="#local-6989586621682578996"><span class="hs-identifier hs-var">subst</span></a></span><span> </span><span class="annot"><span class="annottext">CoVar
</span><a href="#local-6989586621682578998"><span class="hs-identifier hs-var">tv</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682579000"><span class="hs-identifier hs-var">ty</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">LiftCoEnv
</span><a href="#local-6989586621682578997"><span class="hs-identifier hs-var">env</span></a></span><span>
</span><span id="line-2067"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">otherwise</span></span><span>
</span><span id="line-2068"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Subst -&gt; LiftCoEnv -&gt; LiftingContext
</span><a href="GHC.Core.Coercion.html#LC"><span class="hs-identifier hs-var">LC</span></a></span><span> </span><span class="annot"><span class="annottext">Subst
</span><a href="#local-6989586621682578996"><span class="hs-identifier hs-var">subst</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">LiftCoEnv -&gt; CoVar -&gt; Coercion -&gt; LiftCoEnv
forall a. VarEnv a -&gt; CoVar -&gt; a -&gt; VarEnv a
</span><a href="GHC.Types.Var.Env.html#extendVarEnv"><span class="hs-identifier hs-var">extendVarEnv</span></a></span><span> </span><span class="annot"><span class="annottext">LiftCoEnv
</span><a href="#local-6989586621682578997"><span class="hs-identifier hs-var">env</span></a></span><span> </span><span class="annot"><span class="annottext">CoVar
</span><a href="#local-6989586621682578998"><span class="hs-identifier hs-var">tv</span></a></span><span> </span><span class="annot"><span class="annottext">Coercion
</span><a href="#local-6989586621682578999"><span class="hs-identifier hs-var">arg</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-2069"></span><span>
</span><span id="line-2070"></span><span class="hs-comment">-- | Extend the substitution component of a lifting context with</span><span>
</span><span id="line-2071"></span><span class="hs-comment">-- a new binding for a coercion variable. Used during coercion optimisation.</span><span>
</span><span id="line-2072"></span><span class="annot"><a href="GHC.Core.Coercion.html#extendLiftingContextCvSubst"><span class="hs-identifier hs-type">extendLiftingContextCvSubst</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Core.Coercion.html#LiftingContext"><span class="hs-identifier hs-type">LiftingContext</span></a></span><span>
</span><span id="line-2073"></span><span>                            </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Types.Var.html#CoVar"><span class="hs-identifier hs-type">CoVar</span></a></span><span>
</span><span id="line-2074"></span><span>                            </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#Coercion"><span class="hs-identifier hs-type">Coercion</span></a></span><span>
</span><span id="line-2075"></span><span>                            </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Core.Coercion.html#LiftingContext"><span class="hs-identifier hs-type">LiftingContext</span></a></span><span>
</span><span id="line-2076"></span><span id="extendLiftingContextCvSubst"><span class="annot"><span class="annottext">extendLiftingContextCvSubst :: LiftingContext -&gt; CoVar -&gt; Coercion -&gt; LiftingContext
</span><a href="GHC.Core.Coercion.html#extendLiftingContextCvSubst"><span class="hs-identifier hs-var hs-var">extendLiftingContextCvSubst</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Core.Coercion.html#LC"><span class="hs-identifier hs-type">LC</span></a></span><span> </span><span id="local-6989586621682579001"><span class="annot"><span class="annottext">Subst
</span><a href="#local-6989586621682579001"><span class="hs-identifier hs-var">subst</span></a></span></span><span> </span><span id="local-6989586621682579002"><span class="annot"><span class="annottext">LiftCoEnv
</span><a href="#local-6989586621682579002"><span class="hs-identifier hs-var">env</span></a></span></span><span class="hs-special">)</span><span> </span><span id="local-6989586621682579003"><span class="annot"><span class="annottext">CoVar
</span><a href="#local-6989586621682579003"><span class="hs-identifier hs-var">cv</span></a></span></span><span> </span><span id="local-6989586621682579004"><span class="annot"><span class="annottext">Coercion
</span><a href="#local-6989586621682579004"><span class="hs-identifier hs-var">co</span></a></span></span><span>
</span><span id="line-2077"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Subst -&gt; LiftCoEnv -&gt; LiftingContext
</span><a href="GHC.Core.Coercion.html#LC"><span class="hs-identifier hs-var">LC</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Subst -&gt; CoVar -&gt; Coercion -&gt; Subst
</span><a href="GHC.Core.TyCo.Subst.html#extendCvSubst"><span class="hs-identifier hs-var">extendCvSubst</span></a></span><span> </span><span class="annot"><span class="annottext">Subst
</span><a href="#local-6989586621682579001"><span class="hs-identifier hs-var">subst</span></a></span><span> </span><span class="annot"><span class="annottext">CoVar
</span><a href="#local-6989586621682579003"><span class="hs-identifier hs-var">cv</span></a></span><span> </span><span class="annot"><span class="annottext">Coercion
</span><a href="#local-6989586621682579004"><span class="hs-identifier hs-var">co</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">LiftCoEnv
</span><a href="#local-6989586621682579002"><span class="hs-identifier hs-var">env</span></a></span><span>
</span><span id="line-2078"></span><span>
</span><span id="line-2079"></span><span class="annot"><span class="hs-comment">-- | Extend a lifting context with a new mapping, and extend the in-scope set</span></span><span>
</span><span id="line-2080"></span><span class="annot"><a href="GHC.Core.Coercion.html#extendLiftingContextAndInScope"><span class="hs-identifier hs-type">extendLiftingContextAndInScope</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Core.Coercion.html#LiftingContext"><span class="hs-identifier hs-type">LiftingContext</span></a></span><span>  </span><span class="annot"><span class="hs-comment">-- ^ Original LC</span></span><span>
</span><span id="line-2081"></span><span>                               </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Types.Var.html#TyCoVar"><span class="hs-identifier hs-type">TyCoVar</span></a></span><span>         </span><span class="annot"><span class="hs-comment">-- ^ new variable to map...</span></span><span>
</span><span id="line-2082"></span><span>                               </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#Coercion"><span class="hs-identifier hs-type">Coercion</span></a></span><span>        </span><span class="annot"><span class="hs-comment">-- ^ to this coercion</span></span><span>
</span><span id="line-2083"></span><span>                               </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Core.Coercion.html#LiftingContext"><span class="hs-identifier hs-type">LiftingContext</span></a></span><span>
</span><span id="line-2084"></span><span id="extendLiftingContextAndInScope"><span class="annot"><span class="annottext">extendLiftingContextAndInScope :: LiftingContext -&gt; CoVar -&gt; Coercion -&gt; LiftingContext
</span><a href="GHC.Core.Coercion.html#extendLiftingContextAndInScope"><span class="hs-identifier hs-var hs-var">extendLiftingContextAndInScope</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Core.Coercion.html#LC"><span class="hs-identifier hs-type">LC</span></a></span><span> </span><span id="local-6989586621682579006"><span class="annot"><span class="annottext">Subst
</span><a href="#local-6989586621682579006"><span class="hs-identifier hs-var">subst</span></a></span></span><span> </span><span id="local-6989586621682579007"><span class="annot"><span class="annottext">LiftCoEnv
</span><a href="#local-6989586621682579007"><span class="hs-identifier hs-var">env</span></a></span></span><span class="hs-special">)</span><span> </span><span id="local-6989586621682579008"><span class="annot"><span class="annottext">CoVar
</span><a href="#local-6989586621682579008"><span class="hs-identifier hs-var">tv</span></a></span></span><span> </span><span id="local-6989586621682579009"><span class="annot"><span class="annottext">Coercion
</span><a href="#local-6989586621682579009"><span class="hs-identifier hs-var">co</span></a></span></span><span>
</span><span id="line-2085"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">LiftingContext -&gt; CoVar -&gt; Coercion -&gt; LiftingContext
</span><a href="GHC.Core.Coercion.html#extendLiftingContext"><span class="hs-identifier hs-var">extendLiftingContext</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Subst -&gt; LiftCoEnv -&gt; LiftingContext
</span><a href="GHC.Core.Coercion.html#LC"><span class="hs-identifier hs-var">LC</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Subst -&gt; VarSet -&gt; Subst
</span><a href="GHC.Core.TyCo.Subst.html#extendSubstInScopeSet"><span class="hs-identifier hs-var">extendSubstInScopeSet</span></a></span><span> </span><span class="annot"><span class="annottext">Subst
</span><a href="#local-6989586621682579006"><span class="hs-identifier hs-var">subst</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Coercion -&gt; VarSet
</span><a href="GHC.Core.TyCo.FVs.html#tyCoVarsOfCo"><span class="hs-identifier hs-var">tyCoVarsOfCo</span></a></span><span> </span><span class="annot"><span class="annottext">Coercion
</span><a href="#local-6989586621682579009"><span class="hs-identifier hs-var">co</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">LiftCoEnv
</span><a href="#local-6989586621682579007"><span class="hs-identifier hs-var">env</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">CoVar
</span><a href="#local-6989586621682579008"><span class="hs-identifier hs-var">tv</span></a></span><span> </span><span class="annot"><span class="annottext">Coercion
</span><a href="#local-6989586621682579009"><span class="hs-identifier hs-var">co</span></a></span><span>
</span><span id="line-2086"></span><span>
</span><span id="line-2087"></span><span class="hs-comment">-- | Extend a lifting context with existential-variable bindings.</span><span>
</span><span id="line-2088"></span><span class="hs-comment">-- See Note [extendLiftingContextEx]</span><span>
</span><span id="line-2089"></span><span class="annot"><a href="GHC.Core.Coercion.html#extendLiftingContextEx"><span class="hs-identifier hs-type">extendLiftingContextEx</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Core.Coercion.html#LiftingContext"><span class="hs-identifier hs-type">LiftingContext</span></a></span><span>    </span><span class="annot"><span class="hs-comment">-- ^ original lifting context</span></span><span>
</span><span id="line-2090"></span><span>                       </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="hs-special">(</span><span class="annot"><a href="GHC.Types.Var.html#TyCoVar"><span class="hs-identifier hs-type">TyCoVar</span></a></span><span class="hs-special">,</span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#Type"><span class="hs-identifier hs-type">Type</span></a></span><span class="hs-special">)</span><span class="hs-special">]</span><span>  </span><span class="annot"><span class="hs-comment">-- ^ ex. var / value pairs</span></span><span>
</span><span id="line-2091"></span><span>                       </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Core.Coercion.html#LiftingContext"><span class="hs-identifier hs-type">LiftingContext</span></a></span><span>
</span><span id="line-2092"></span><span class="hs-comment">-- Note that this is more involved than extendLiftingContext. That function</span><span>
</span><span id="line-2093"></span><span class="hs-comment">-- takes a coercion to extend with, so it's assumed that the caller has taken</span><span>
</span><span id="line-2094"></span><span class="hs-comment">-- into account any of the kind-changing stuff worried about here.</span><span>
</span><span id="line-2095"></span><span id="extendLiftingContextEx"><span class="annot"><span class="annottext">extendLiftingContextEx :: LiftingContext -&gt; [(CoVar, Type)] -&gt; LiftingContext
</span><a href="GHC.Core.Coercion.html#extendLiftingContextEx"><span class="hs-identifier hs-var hs-var">extendLiftingContextEx</span></a></span></span><span> </span><span id="local-6989586621682579011"><span class="annot"><span class="annottext">LiftingContext
</span><a href="#local-6989586621682579011"><span class="hs-identifier hs-var">lc</span></a></span></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">LiftingContext
</span><a href="#local-6989586621682579011"><span class="hs-identifier hs-var">lc</span></a></span><span>
</span><span id="line-2096"></span><span class="annot"><a href="GHC.Core.Coercion.html#extendLiftingContextEx"><span class="hs-identifier hs-var">extendLiftingContextEx</span></a></span><span> </span><span id="local-6989586621682579012"><span class="annot"><span class="annottext">lc :: LiftingContext
</span><a href="#local-6989586621682579012"><span class="hs-identifier hs-var">lc</span></a></span></span><span class="hs-glyph">@</span><span class="hs-special">(</span><span class="annot"><a href="GHC.Core.Coercion.html#LC"><span class="hs-identifier hs-type">LC</span></a></span><span> </span><span id="local-6989586621682579013"><span class="annot"><span class="annottext">Subst
</span><a href="#local-6989586621682579013"><span class="hs-identifier hs-var">subst</span></a></span></span><span> </span><span id="local-6989586621682579014"><span class="annot"><span class="annottext">LiftCoEnv
</span><a href="#local-6989586621682579014"><span class="hs-identifier hs-var">env</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="hs-special">(</span><span id="local-6989586621682579015"><span class="annot"><span class="annottext">CoVar
</span><a href="#local-6989586621682579015"><span class="hs-identifier hs-var">v</span></a></span></span><span class="hs-special">,</span><span id="local-6989586621682579016"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682579016"><span class="hs-identifier hs-var">ty</span></a></span></span><span class="hs-special">)</span><span class="annot"><span class="hs-glyph hs-type">:</span></span><span id="local-6989586621682579017"><span class="annot"><span class="annottext">[(CoVar, Type)]
</span><a href="#local-6989586621682579017"><span class="hs-identifier hs-var">rest</span></a></span></span><span class="hs-special">)</span><span>
</span><span id="line-2097"></span><span class="hs-comment">-- This function adds bindings for *Nominal* coercions. Why? Because it</span><span>
</span><span id="line-2098"></span><span class="hs-comment">-- works with existentially bound variables, which are considered to have</span><span>
</span><span id="line-2099"></span><span class="hs-comment">-- nominal roles.</span><span>
</span><span id="line-2100"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">CoVar -&gt; Bool
</span><a href="GHC.Types.Var.html#isTyVar"><span class="hs-identifier hs-var">isTyVar</span></a></span><span> </span><span class="annot"><span class="annottext">CoVar
</span><a href="#local-6989586621682579015"><span class="hs-identifier hs-var">v</span></a></span><span>
</span><span id="line-2101"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621682579018"><span class="annot"><span class="annottext">lc' :: LiftingContext
</span><a href="#local-6989586621682579018"><span class="hs-identifier hs-var hs-var">lc'</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Subst -&gt; LiftCoEnv -&gt; LiftingContext
</span><a href="GHC.Core.Coercion.html#LC"><span class="hs-identifier hs-var">LC</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Subst
</span><a href="#local-6989586621682579013"><span class="hs-identifier hs-var">subst</span></a></span><span> </span><span class="annot"><span class="annottext">Subst -&gt; VarSet -&gt; Subst
</span><a href="GHC.Core.TyCo.Subst.html#extendSubstInScopeSet"><span class="hs-operator hs-var">`extendSubstInScopeSet`</span></a></span><span> </span><span class="annot"><span class="annottext">Type -&gt; VarSet
</span><a href="GHC.Core.TyCo.FVs.html#tyCoVarsOfType"><span class="hs-identifier hs-var">tyCoVarsOfType</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682579016"><span class="hs-identifier hs-var">ty</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-2102"></span><span>                 </span><span class="hs-special">(</span><span class="annot"><span class="annottext">LiftCoEnv -&gt; CoVar -&gt; Coercion -&gt; LiftCoEnv
forall a. VarEnv a -&gt; CoVar -&gt; a -&gt; VarEnv a
</span><a href="GHC.Types.Var.Env.html#extendVarEnv"><span class="hs-identifier hs-var">extendVarEnv</span></a></span><span> </span><span class="annot"><span class="annottext">LiftCoEnv
</span><a href="#local-6989586621682579014"><span class="hs-identifier hs-var">env</span></a></span><span> </span><span class="annot"><span class="annottext">CoVar
</span><a href="#local-6989586621682579015"><span class="hs-identifier hs-var">v</span></a></span><span> </span><span class="annot"><span class="annottext">(Coercion -&gt; LiftCoEnv) -&gt; Coercion -&gt; LiftCoEnv
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-2103"></span><span>                  </span><span class="annot"><span class="annottext">Role -&gt; Type -&gt; Coercion -&gt; Coercion
</span><a href="GHC.Core.Coercion.html#mkGReflRightCo"><span class="hs-identifier hs-var">mkGReflRightCo</span></a></span><span> </span><span class="annot"><span class="annottext">Role
</span><a href="Language.Haskell.Syntax.Basic.html#Nominal"><span class="hs-identifier hs-var">Nominal</span></a></span><span>
</span><span id="line-2104"></span><span>                                 </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682579016"><span class="hs-identifier hs-var">ty</span></a></span><span>
</span><span id="line-2105"></span><span>                                 </span><span class="hs-special">(</span><span class="annot"><span class="annottext">LiftingContext -&gt; Role -&gt; Type -&gt; Coercion
</span><a href="GHC.Core.Coercion.html#ty_co_subst"><span class="hs-identifier hs-var">ty_co_subst</span></a></span><span> </span><span class="annot"><span class="annottext">LiftingContext
</span><a href="#local-6989586621682579012"><span class="hs-identifier hs-var">lc</span></a></span><span> </span><span class="annot"><span class="annottext">Role
</span><a href="Language.Haskell.Syntax.Basic.html#Nominal"><span class="hs-identifier hs-var">Nominal</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">CoVar -&gt; Type
</span><a href="GHC.Types.Var.html#tyVarKind"><span class="hs-identifier hs-var">tyVarKind</span></a></span><span> </span><span class="annot"><span class="annottext">CoVar
</span><a href="#local-6989586621682579015"><span class="hs-identifier hs-var">v</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-2106"></span><span>    </span><span class="hs-keyword">in</span><span> </span><span class="annot"><span class="annottext">LiftingContext -&gt; [(CoVar, Type)] -&gt; LiftingContext
</span><a href="GHC.Core.Coercion.html#extendLiftingContextEx"><span class="hs-identifier hs-var">extendLiftingContextEx</span></a></span><span> </span><span class="annot"><span class="annottext">LiftingContext
</span><a href="#local-6989586621682579018"><span class="hs-identifier hs-var">lc'</span></a></span><span> </span><span class="annot"><span class="annottext">[(CoVar, Type)]
</span><a href="#local-6989586621682579017"><span class="hs-identifier hs-var">rest</span></a></span><span>
</span><span id="line-2107"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#CoercionTy"><span class="hs-identifier hs-type">CoercionTy</span></a></span><span> </span><span id="local-6989586621682579021"><span class="annot"><span class="annottext">Coercion
</span><a href="#local-6989586621682579021"><span class="hs-identifier hs-var">co</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682579016"><span class="hs-identifier hs-var">ty</span></a></span><span>
</span><span id="line-2108"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-comment">-- co      :: s1 ~r s2</span><span>
</span><span id="line-2109"></span><span>    </span><span class="hs-comment">-- lift_s1 :: s1 ~r s1'</span><span>
</span><span id="line-2110"></span><span>    </span><span class="hs-comment">-- lift_s2 :: s2 ~r s2'</span><span>
</span><span id="line-2111"></span><span>    </span><span class="hs-comment">-- kco     :: (s1 ~r s2) ~N (s1' ~r s2')</span><span>
</span><span id="line-2112"></span><span>    </span><span class="annot"><span class="annottext">Bool -&gt; LiftingContext -&gt; LiftingContext
forall a. HasCallStack =&gt; Bool -&gt; a -&gt; a
</span><a href="GHC.Utils.Panic.Plain.html#assert"><span class="hs-identifier hs-var">assert</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">CoVar -&gt; Bool
</span><a href="GHC.Types.Var.html#isCoVar"><span class="hs-identifier hs-var">isCoVar</span></a></span><span> </span><span class="annot"><span class="annottext">CoVar
</span><a href="#local-6989586621682579015"><span class="hs-identifier hs-var">v</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(LiftingContext -&gt; LiftingContext)
-&gt; LiftingContext -&gt; LiftingContext
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-2113"></span><span>    </span><span class="hs-keyword">let</span><span> </span><span class="hs-special">(</span><span id="local-6989586621682579022"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682579022"><span class="hs-identifier hs-var">s1</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682579023"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682579023"><span class="hs-identifier hs-var">s2</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682579024"><span class="annot"><span class="annottext">Role
</span><a href="#local-6989586621682579024"><span class="hs-identifier hs-var">r</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">HasDebugCallStack =&gt; CoVar -&gt; (Type, Type, Role)
CoVar -&gt; (Type, Type, Role)
</span><a href="GHC.Core.Coercion.html#coVarTypesRole"><span class="hs-identifier hs-var">coVarTypesRole</span></a></span><span> </span><span class="annot"><span class="annottext">CoVar
</span><a href="#local-6989586621682579015"><span class="hs-identifier hs-var">v</span></a></span><span>
</span><span id="line-2114"></span><span>        </span><span id="local-6989586621682579025"><span class="annot"><span class="annottext">lift_s1 :: Coercion
</span><a href="#local-6989586621682579025"><span class="hs-identifier hs-var hs-var">lift_s1</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">LiftingContext -&gt; Role -&gt; Type -&gt; Coercion
</span><a href="GHC.Core.Coercion.html#ty_co_subst"><span class="hs-identifier hs-var">ty_co_subst</span></a></span><span> </span><span class="annot"><span class="annottext">LiftingContext
</span><a href="#local-6989586621682579012"><span class="hs-identifier hs-var">lc</span></a></span><span> </span><span class="annot"><span class="annottext">Role
</span><a href="#local-6989586621682579024"><span class="hs-identifier hs-var">r</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682579022"><span class="hs-identifier hs-var">s1</span></a></span><span>
</span><span id="line-2115"></span><span>        </span><span id="local-6989586621682579026"><span class="annot"><span class="annottext">lift_s2 :: Coercion
</span><a href="#local-6989586621682579026"><span class="hs-identifier hs-var hs-var">lift_s2</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">LiftingContext -&gt; Role -&gt; Type -&gt; Coercion
</span><a href="GHC.Core.Coercion.html#ty_co_subst"><span class="hs-identifier hs-var">ty_co_subst</span></a></span><span> </span><span class="annot"><span class="annottext">LiftingContext
</span><a href="#local-6989586621682579012"><span class="hs-identifier hs-var">lc</span></a></span><span> </span><span class="annot"><span class="annottext">Role
</span><a href="#local-6989586621682579024"><span class="hs-identifier hs-var">r</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682579023"><span class="hs-identifier hs-var">s2</span></a></span><span>
</span><span id="line-2116"></span><span>        </span><span id="local-6989586621682579027"><span class="annot"><span class="annottext">kco :: Coercion
</span><a href="#local-6989586621682579027"><span class="hs-identifier hs-var hs-var">kco</span></a></span></span><span>     </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">HasDebugCallStack =&gt; Role -&gt; TyCon -&gt; [Coercion] -&gt; Coercion
Role -&gt; TyCon -&gt; [Coercion] -&gt; Coercion
</span><a href="GHC.Core.Coercion.html#mkTyConAppCo"><span class="hs-identifier hs-var">mkTyConAppCo</span></a></span><span> </span><span class="annot"><span class="annottext">Role
</span><a href="Language.Haskell.Syntax.Basic.html#Nominal"><span class="hs-identifier hs-var">Nominal</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Role -&gt; TyCon
</span><a href="GHC.Builtin.Types.Prim.html#equalityTyCon"><span class="hs-identifier hs-var">equalityTyCon</span></a></span><span> </span><span class="annot"><span class="annottext">Role
</span><a href="#local-6989586621682579024"><span class="hs-identifier hs-var">r</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-2117"></span><span>                               </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">Coercion -&gt; Coercion
</span><a href="GHC.Core.Coercion.html#mkKindCo"><span class="hs-identifier hs-var">mkKindCo</span></a></span><span> </span><span class="annot"><span class="annottext">Coercion
</span><a href="#local-6989586621682579025"><span class="hs-identifier hs-var">lift_s1</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Coercion -&gt; Coercion
</span><a href="GHC.Core.Coercion.html#mkKindCo"><span class="hs-identifier hs-var">mkKindCo</span></a></span><span> </span><span class="annot"><span class="annottext">Coercion
</span><a href="#local-6989586621682579026"><span class="hs-identifier hs-var">lift_s2</span></a></span><span>
</span><span id="line-2118"></span><span>                               </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Coercion
</span><a href="#local-6989586621682579025"><span class="hs-identifier hs-var">lift_s1</span></a></span><span>         </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Coercion
</span><a href="#local-6989586621682579026"><span class="hs-identifier hs-var">lift_s2</span></a></span><span>          </span><span class="hs-special">]</span><span>
</span><span id="line-2119"></span><span>        </span><span id="local-6989586621682579029"><span class="annot"><span class="annottext">lc' :: LiftingContext
</span><a href="#local-6989586621682579029"><span class="hs-identifier hs-var hs-var">lc'</span></a></span></span><span>     </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Subst -&gt; LiftCoEnv -&gt; LiftingContext
</span><a href="GHC.Core.Coercion.html#LC"><span class="hs-identifier hs-var">LC</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Subst
</span><a href="#local-6989586621682579013"><span class="hs-identifier hs-var">subst</span></a></span><span> </span><span class="annot"><span class="annottext">Subst -&gt; VarSet -&gt; Subst
</span><a href="GHC.Core.TyCo.Subst.html#extendSubstInScopeSet"><span class="hs-operator hs-var">`extendSubstInScopeSet`</span></a></span><span> </span><span class="annot"><span class="annottext">Coercion -&gt; VarSet
</span><a href="GHC.Core.TyCo.FVs.html#tyCoVarsOfCo"><span class="hs-identifier hs-var">tyCoVarsOfCo</span></a></span><span> </span><span class="annot"><span class="annottext">Coercion
</span><a href="#local-6989586621682579021"><span class="hs-identifier hs-var">co</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-2120"></span><span>                     </span><span class="hs-special">(</span><span class="annot"><span class="annottext">LiftCoEnv -&gt; CoVar -&gt; Coercion -&gt; LiftCoEnv
forall a. VarEnv a -&gt; CoVar -&gt; a -&gt; VarEnv a
</span><a href="GHC.Types.Var.Env.html#extendVarEnv"><span class="hs-identifier hs-var">extendVarEnv</span></a></span><span> </span><span class="annot"><span class="annottext">LiftCoEnv
</span><a href="#local-6989586621682579014"><span class="hs-identifier hs-var">env</span></a></span><span> </span><span class="annot"><span class="annottext">CoVar
</span><a href="#local-6989586621682579015"><span class="hs-identifier hs-var">v</span></a></span><span>
</span><span id="line-2121"></span><span>                        </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Role -&gt; Coercion -&gt; Coercion -&gt; Coercion -&gt; Coercion
</span><a href="GHC.Core.Coercion.html#mkProofIrrelCo"><span class="hs-identifier hs-var">mkProofIrrelCo</span></a></span><span> </span><span class="annot"><span class="annottext">Role
</span><a href="Language.Haskell.Syntax.Basic.html#Nominal"><span class="hs-identifier hs-var">Nominal</span></a></span><span> </span><span class="annot"><span class="annottext">Coercion
</span><a href="#local-6989586621682579027"><span class="hs-identifier hs-var">kco</span></a></span><span> </span><span class="annot"><span class="annottext">Coercion
</span><a href="#local-6989586621682579021"><span class="hs-identifier hs-var">co</span></a></span><span> </span><span class="annot"><span class="annottext">(Coercion -&gt; Coercion) -&gt; Coercion -&gt; Coercion
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-2122"></span><span>                          </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Coercion -&gt; Coercion
</span><a href="GHC.Core.Coercion.html#mkSymCo"><span class="hs-identifier hs-var">mkSymCo</span></a></span><span> </span><span class="annot"><span class="annottext">Coercion
</span><a href="#local-6989586621682579025"><span class="hs-identifier hs-var">lift_s1</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">HasDebugCallStack =&gt; Coercion -&gt; Coercion -&gt; Coercion
Coercion -&gt; Coercion -&gt; Coercion
</span><a href="GHC.Core.Coercion.html#mkTransCo"><span class="hs-operator hs-var">`mkTransCo`</span></a></span><span> </span><span class="annot"><span class="annottext">Coercion
</span><a href="#local-6989586621682579021"><span class="hs-identifier hs-var">co</span></a></span><span> </span><span class="annot"><span class="annottext">HasDebugCallStack =&gt; Coercion -&gt; Coercion -&gt; Coercion
Coercion -&gt; Coercion -&gt; Coercion
</span><a href="GHC.Core.Coercion.html#mkTransCo"><span class="hs-operator hs-var">`mkTransCo`</span></a></span><span> </span><span class="annot"><span class="annottext">Coercion
</span><a href="#local-6989586621682579026"><span class="hs-identifier hs-var">lift_s2</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-2123"></span><span>    </span><span class="hs-keyword">in</span><span> </span><span class="annot"><span class="annottext">LiftingContext -&gt; [(CoVar, Type)] -&gt; LiftingContext
</span><a href="GHC.Core.Coercion.html#extendLiftingContextEx"><span class="hs-identifier hs-var">extendLiftingContextEx</span></a></span><span> </span><span class="annot"><span class="annottext">LiftingContext
</span><a href="#local-6989586621682579029"><span class="hs-identifier hs-var">lc'</span></a></span><span> </span><span class="annot"><span class="annottext">[(CoVar, Type)]
</span><a href="#local-6989586621682579017"><span class="hs-identifier hs-var">rest</span></a></span><span>
</span><span id="line-2124"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">otherwise</span></span><span>
</span><span id="line-2125"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">String -&gt; SDoc -&gt; LiftingContext
forall a. HasCallStack =&gt; String -&gt; SDoc -&gt; a
</span><a href="GHC.Utils.Panic.html#pprPanic"><span class="hs-identifier hs-var">pprPanic</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;extendLiftingContextEx&quot;</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">CoVar -&gt; SDoc
forall a. Outputable a =&gt; a -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="annot"><span class="annottext">CoVar
</span><a href="#local-6989586621682579015"><span class="hs-identifier hs-var">v</span></a></span><span> </span><span class="annot"><span class="annottext">SDoc -&gt; SDoc -&gt; SDoc
forall doc. IsLine doc =&gt; doc -&gt; doc -&gt; doc
</span><a href="GHC.Utils.Outputable.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">String -&gt; SDoc
forall doc. IsLine doc =&gt; String -&gt; doc
</span><a href="GHC.Utils.Outputable.html#text"><span class="hs-identifier hs-var">text</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;|-&gt;&quot;</span></span><span> </span><span class="annot"><span class="annottext">SDoc -&gt; SDoc -&gt; SDoc
forall doc. IsLine doc =&gt; doc -&gt; doc -&gt; doc
</span><a href="GHC.Utils.Outputable.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">Type -&gt; SDoc
forall a. Outputable a =&gt; a -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682579016"><span class="hs-identifier hs-var">ty</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-2126"></span><span>
</span><span id="line-2127"></span><span>
</span><span id="line-2128"></span><span class="annot"><span class="hs-comment">-- | Erase the environments in a lifting context</span></span><span>
</span><span id="line-2129"></span><span class="annot"><a href="GHC.Core.Coercion.html#zapLiftingContext"><span class="hs-identifier hs-type">zapLiftingContext</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Core.Coercion.html#LiftingContext"><span class="hs-identifier hs-type">LiftingContext</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Core.Coercion.html#LiftingContext"><span class="hs-identifier hs-type">LiftingContext</span></a></span><span>
</span><span id="line-2130"></span><span id="zapLiftingContext"><span class="annot"><span class="annottext">zapLiftingContext :: LiftingContext -&gt; LiftingContext
</span><a href="GHC.Core.Coercion.html#zapLiftingContext"><span class="hs-identifier hs-var hs-var">zapLiftingContext</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Core.Coercion.html#LC"><span class="hs-identifier hs-type">LC</span></a></span><span> </span><span id="local-6989586621682579030"><span class="annot"><span class="annottext">Subst
</span><a href="#local-6989586621682579030"><span class="hs-identifier hs-var">subst</span></a></span></span><span> </span><span class="annot"><span class="annottext">LiftCoEnv
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Subst -&gt; LiftCoEnv -&gt; LiftingContext
</span><a href="GHC.Core.Coercion.html#LC"><span class="hs-identifier hs-var">LC</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Subst -&gt; Subst
</span><a href="GHC.Core.TyCo.Subst.html#zapSubst"><span class="hs-identifier hs-var">zapSubst</span></a></span><span> </span><span class="annot"><span class="annottext">Subst
</span><a href="#local-6989586621682579030"><span class="hs-identifier hs-var">subst</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">LiftCoEnv
forall a. VarEnv a
</span><a href="GHC.Types.Var.Env.html#emptyVarEnv"><span class="hs-identifier hs-var">emptyVarEnv</span></a></span><span>
</span><span id="line-2131"></span><span>
</span><span id="line-2132"></span><span class="annot"><span class="hs-comment">-- | Like 'substForAllCoBndr', but works on a lifting context</span></span><span>
</span><span id="line-2133"></span><span class="annot"><a href="GHC.Core.Coercion.html#substForAllCoBndrUsingLC"><span class="hs-identifier hs-type">substForAllCoBndrUsingLC</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Types.Basic.html#SwapFlag"><span class="hs-identifier hs-type">SwapFlag</span></a></span><span>
</span><span id="line-2134"></span><span>                         </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#Coercion"><span class="hs-identifier hs-type">Coercion</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#Coercion"><span class="hs-identifier hs-type">Coercion</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-2135"></span><span>                         </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Core.Coercion.html#LiftingContext"><span class="hs-identifier hs-type">LiftingContext</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Types.Var.html#TyCoVar"><span class="hs-identifier hs-type">TyCoVar</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#Coercion"><span class="hs-identifier hs-type">Coercion</span></a></span><span>
</span><span id="line-2136"></span><span>                         </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Core.Coercion.html#LiftingContext"><span class="hs-identifier hs-type">LiftingContext</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Types.Var.html#TyCoVar"><span class="hs-identifier hs-type">TyCoVar</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#Coercion"><span class="hs-identifier hs-type">Coercion</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-2137"></span><span id="substForAllCoBndrUsingLC"><span class="annot"><span class="annottext">substForAllCoBndrUsingLC :: SwapFlag
-&gt; (Coercion -&gt; Coercion)
-&gt; LiftingContext
-&gt; CoVar
-&gt; Coercion
-&gt; (LiftingContext, CoVar, Coercion)
</span><a href="GHC.Core.Coercion.html#substForAllCoBndrUsingLC"><span class="hs-identifier hs-var hs-var">substForAllCoBndrUsingLC</span></a></span></span><span> </span><span id="local-6989586621682579032"><span class="annot"><span class="annottext">SwapFlag
</span><a href="#local-6989586621682579032"><span class="hs-identifier hs-var">sym</span></a></span></span><span> </span><span id="local-6989586621682579033"><span class="annot"><span class="annottext">Coercion -&gt; Coercion
</span><a href="#local-6989586621682579033"><span class="hs-identifier hs-var">sco</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Core.Coercion.html#LC"><span class="hs-identifier hs-type">LC</span></a></span><span> </span><span id="local-6989586621682579034"><span class="annot"><span class="annottext">Subst
</span><a href="#local-6989586621682579034"><span class="hs-identifier hs-var">subst</span></a></span></span><span> </span><span id="local-6989586621682579035"><span class="annot"><span class="annottext">LiftCoEnv
</span><a href="#local-6989586621682579035"><span class="hs-identifier hs-var">lc_env</span></a></span></span><span class="hs-special">)</span><span> </span><span id="local-6989586621682579036"><span class="annot"><span class="annottext">CoVar
</span><a href="#local-6989586621682579036"><span class="hs-identifier hs-var">tv</span></a></span></span><span> </span><span id="local-6989586621682579037"><span class="annot"><span class="annottext">Coercion
</span><a href="#local-6989586621682579037"><span class="hs-identifier hs-var">co</span></a></span></span><span>
</span><span id="line-2138"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Subst -&gt; LiftCoEnv -&gt; LiftingContext
</span><a href="GHC.Core.Coercion.html#LC"><span class="hs-identifier hs-var">LC</span></a></span><span> </span><span class="annot"><span class="annottext">Subst
</span><a href="#local-6989586621682579038"><span class="hs-identifier hs-var">subst'</span></a></span><span> </span><span class="annot"><span class="annottext">LiftCoEnv
</span><a href="#local-6989586621682579035"><span class="hs-identifier hs-var">lc_env</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">CoVar
</span><a href="#local-6989586621682579039"><span class="hs-identifier hs-var">tv'</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Coercion
</span><a href="#local-6989586621682579040"><span class="hs-identifier hs-var">co'</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-2139"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-2140"></span><span>    </span><span class="hs-special">(</span><span id="local-6989586621682579038"><span class="annot"><span class="annottext">Subst
</span><a href="#local-6989586621682579038"><span class="hs-identifier hs-var">subst'</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682579039"><span class="annot"><span class="annottext">CoVar
</span><a href="#local-6989586621682579039"><span class="hs-identifier hs-var">tv'</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682579040"><span class="annot"><span class="annottext">Coercion
</span><a href="#local-6989586621682579040"><span class="hs-identifier hs-var">co'</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">SwapFlag
-&gt; (Coercion -&gt; Coercion)
-&gt; Subst
-&gt; CoVar
-&gt; Coercion
-&gt; (Subst, CoVar, Coercion)
</span><a href="GHC.Core.TyCo.Subst.html#substForAllCoBndrUsing"><span class="hs-identifier hs-var">substForAllCoBndrUsing</span></a></span><span> </span><span class="annot"><span class="annottext">SwapFlag
</span><a href="#local-6989586621682579032"><span class="hs-identifier hs-var">sym</span></a></span><span> </span><span class="annot"><span class="annottext">Coercion -&gt; Coercion
</span><a href="#local-6989586621682579033"><span class="hs-identifier hs-var">sco</span></a></span><span> </span><span class="annot"><span class="annottext">Subst
</span><a href="#local-6989586621682579034"><span class="hs-identifier hs-var">subst</span></a></span><span> </span><span class="annot"><span class="annottext">CoVar
</span><a href="#local-6989586621682579036"><span class="hs-identifier hs-var">tv</span></a></span><span> </span><span class="annot"><span class="annottext">Coercion
</span><a href="#local-6989586621682579037"><span class="hs-identifier hs-var">co</span></a></span><span>
</span><span id="line-2141"></span><span>
</span><span id="line-2142"></span><span class="hs-comment">-- | The \&quot;lifting\&quot; operation which substitutes coercions for type</span><span>
</span><span id="line-2143"></span><span class="hs-comment">--   variables in a type to produce a coercion.</span><span>
</span><span id="line-2144"></span><span class="hs-comment">--</span><span>
</span><span id="line-2145"></span><span class="hs-comment">--   For the inverse operation, see 'liftCoMatch'</span><span>
</span><span id="line-2146"></span><span class="annot"><a href="GHC.Core.Coercion.html#ty_co_subst"><span class="hs-identifier hs-type">ty_co_subst</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Core.Coercion.html#LiftingContext"><span class="hs-identifier hs-type">LiftingContext</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Language.Haskell.Syntax.Basic.html#Role"><span class="hs-identifier hs-type">Role</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#Type"><span class="hs-identifier hs-type">Type</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#Coercion"><span class="hs-identifier hs-type">Coercion</span></a></span><span>
</span><span id="line-2147"></span><span id="ty_co_subst"><span class="annot"><span class="annottext">ty_co_subst :: LiftingContext -&gt; Role -&gt; Type -&gt; Coercion
</span><a href="GHC.Core.Coercion.html#ty_co_subst"><span class="hs-identifier hs-var hs-var">ty_co_subst</span></a></span></span><span> </span><span class="hs-glyph">!</span><span id="local-6989586621682579042"><span class="annot"><span class="annottext">LiftingContext
</span><a href="#local-6989586621682579042"><span class="hs-identifier hs-var">lc</span></a></span></span><span> </span><span id="local-6989586621682579043"><span class="annot"><span class="annottext">Role
</span><a href="#local-6989586621682579043"><span class="hs-keyword hs-var">role</span></a></span></span><span> </span><span id="local-6989586621682579044"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682579044"><span class="hs-identifier hs-var">ty</span></a></span></span><span>
</span><span id="line-2148"></span><span>    </span><span class="hs-comment">-- !lc: making this function strict in lc allows callers to</span><span>
</span><span id="line-2149"></span><span>    </span><span class="hs-comment">-- pass its two components separately, rather than boxing them.</span><span>
</span><span id="line-2150"></span><span>    </span><span class="hs-comment">-- Unfortunately, Boxity Analysis concludes that we need lc boxed</span><span>
</span><span id="line-2151"></span><span>    </span><span class="hs-comment">-- because it's used that way in liftCoSubstTyVarBndrUsing.</span><span>
</span><span id="line-2152"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Role -&gt; Type -&gt; Coercion
</span><a href="#local-6989586621682579045"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="annot"><span class="annottext">Role
</span><a href="#local-6989586621682579043"><span class="hs-keyword hs-var">role</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682579044"><span class="hs-identifier hs-var">ty</span></a></span><span>
</span><span id="line-2153"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-2154"></span><span>    </span><span class="annot"><a href="#local-6989586621682579045"><span class="hs-identifier hs-type">go</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Language.Haskell.Syntax.Basic.html#Role"><span class="hs-identifier hs-type">Role</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#Type"><span class="hs-identifier hs-type">Type</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#Coercion"><span class="hs-identifier hs-type">Coercion</span></a></span><span>
</span><span id="line-2155"></span><span>    </span><span id="local-6989586621682579045"><span class="annot"><span class="annottext">go :: Role -&gt; Type -&gt; Coercion
</span><a href="#local-6989586621682579045"><span class="hs-identifier hs-var hs-var">go</span></a></span></span><span> </span><span id="local-6989586621682579046"><span class="annot"><span class="annottext">Role
</span><a href="#local-6989586621682579046"><span class="hs-identifier hs-var">r</span></a></span></span><span> </span><span id="local-6989586621682579047"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682579047"><span class="hs-identifier hs-var">ty</span></a></span></span><span>                 </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span id="local-6989586621682579048"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682579048"><span class="hs-identifier hs-var">ty'</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Type -&gt; Maybe Type
</span><a href="GHC.Core.Type.html#coreView"><span class="hs-identifier hs-var">coreView</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682579047"><span class="hs-identifier hs-var">ty</span></a></span><span>
</span><span id="line-2156"></span><span>                            </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Role -&gt; Type -&gt; Coercion
</span><a href="#local-6989586621682579045"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="annot"><span class="annottext">Role
</span><a href="#local-6989586621682579046"><span class="hs-identifier hs-var">r</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682579048"><span class="hs-identifier hs-var">ty'</span></a></span><span>
</span><span id="line-2157"></span><span>    </span><span class="annot"><a href="#local-6989586621682579045"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="annot"><span class="annottext">Role
</span><a href="Language.Haskell.Syntax.Basic.html#Phantom"><span class="hs-identifier hs-var">Phantom</span></a></span><span> </span><span id="local-6989586621682579050"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682579050"><span class="hs-identifier hs-var">ty</span></a></span></span><span>           </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Type -&gt; Coercion
</span><a href="#local-6989586621682579051"><span class="hs-identifier hs-var">lift_phantom</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682579050"><span class="hs-identifier hs-var">ty</span></a></span><span>
</span><span id="line-2158"></span><span>    </span><span class="annot"><a href="#local-6989586621682579045"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span id="local-6989586621682579052"><span class="annot"><span class="annottext">Role
</span><a href="#local-6989586621682579052"><span class="hs-identifier hs-var">r</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#TyVarTy"><span class="hs-identifier hs-type">TyVarTy</span></a></span><span> </span><span id="local-6989586621682579054"><span class="annot"><span class="annottext">CoVar
</span><a href="#local-6989586621682579054"><span class="hs-identifier hs-var">tv</span></a></span></span><span class="hs-special">)</span><span>       </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">String -&gt; Maybe Coercion -&gt; Coercion
forall a. HasDebugCallStack =&gt; String -&gt; Maybe a -&gt; a
</span><a href="GHC.Data.Maybe.html#expectJust"><span class="hs-identifier hs-var">expectJust</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;ty_co_subst bad roles&quot;</span></span><span> </span><span class="annot"><span class="annottext">(Maybe Coercion -&gt; Coercion) -&gt; Maybe Coercion -&gt; Coercion
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-2159"></span><span>                              </span><span class="annot"><span class="annottext">LiftingContext -&gt; Role -&gt; CoVar -&gt; Maybe Coercion
</span><a href="GHC.Core.Coercion.html#liftCoSubstTyVar"><span class="hs-identifier hs-var">liftCoSubstTyVar</span></a></span><span> </span><span class="annot"><span class="annottext">LiftingContext
</span><a href="#local-6989586621682579042"><span class="hs-identifier hs-var">lc</span></a></span><span> </span><span class="annot"><span class="annottext">Role
</span><a href="#local-6989586621682579052"><span class="hs-identifier hs-var">r</span></a></span><span> </span><span class="annot"><span class="annottext">CoVar
</span><a href="#local-6989586621682579054"><span class="hs-identifier hs-var">tv</span></a></span><span>
</span><span id="line-2160"></span><span>    </span><span class="annot"><a href="#local-6989586621682579045"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span id="local-6989586621682579056"><span class="annot"><span class="annottext">Role
</span><a href="#local-6989586621682579056"><span class="hs-identifier hs-var">r</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#AppTy"><span class="hs-identifier hs-type">AppTy</span></a></span><span> </span><span id="local-6989586621682579058"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682579058"><span class="hs-identifier hs-var">ty1</span></a></span></span><span> </span><span id="local-6989586621682579059"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682579059"><span class="hs-identifier hs-var">ty2</span></a></span></span><span class="hs-special">)</span><span>    </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Coercion -&gt; Coercion -&gt; Coercion
</span><a href="GHC.Core.Coercion.html#mkAppCo"><span class="hs-identifier hs-var">mkAppCo</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Role -&gt; Type -&gt; Coercion
</span><a href="#local-6989586621682579045"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="annot"><span class="annottext">Role
</span><a href="#local-6989586621682579056"><span class="hs-identifier hs-var">r</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682579058"><span class="hs-identifier hs-var">ty1</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Role -&gt; Type -&gt; Coercion
</span><a href="#local-6989586621682579045"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="annot"><span class="annottext">Role
</span><a href="Language.Haskell.Syntax.Basic.html#Nominal"><span class="hs-identifier hs-var">Nominal</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682579059"><span class="hs-identifier hs-var">ty2</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-2161"></span><span>    </span><span class="annot"><a href="#local-6989586621682579045"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span id="local-6989586621682579060"><span class="annot"><span class="annottext">Role
</span><a href="#local-6989586621682579060"><span class="hs-identifier hs-var">r</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#TyConApp"><span class="hs-identifier hs-type">TyConApp</span></a></span><span> </span><span id="local-6989586621682579062"><span class="annot"><span class="annottext">TyCon
</span><a href="#local-6989586621682579062"><span class="hs-identifier hs-var">tc</span></a></span></span><span> </span><span id="local-6989586621682579063"><span class="annot"><span class="annottext">[Type]
</span><a href="#local-6989586621682579063"><span class="hs-identifier hs-var">tys</span></a></span></span><span class="hs-special">)</span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">HasDebugCallStack =&gt; Role -&gt; TyCon -&gt; [Coercion] -&gt; Coercion
Role -&gt; TyCon -&gt; [Coercion] -&gt; Coercion
</span><a href="GHC.Core.Coercion.html#mkTyConAppCo"><span class="hs-identifier hs-var">mkTyConAppCo</span></a></span><span> </span><span class="annot"><span class="annottext">Role
</span><a href="#local-6989586621682579060"><span class="hs-identifier hs-var">r</span></a></span><span> </span><span class="annot"><span class="annottext">TyCon
</span><a href="#local-6989586621682579062"><span class="hs-identifier hs-var">tc</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(Role -&gt; Type -&gt; Coercion) -&gt; [Role] -&gt; [Type] -&gt; [Coercion]
forall a b c. (a -&gt; b -&gt; c) -&gt; [a] -&gt; [b] -&gt; [c]
</span><span class="hs-identifier hs-var">zipWith</span></span><span> </span><span class="annot"><span class="annottext">Role -&gt; Type -&gt; Coercion
</span><a href="#local-6989586621682579045"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Role -&gt; TyCon -&gt; [Role]
</span><a href="GHC.Core.Coercion.html#tyConRoleListX"><span class="hs-identifier hs-var">tyConRoleListX</span></a></span><span> </span><span class="annot"><span class="annottext">Role
</span><a href="#local-6989586621682579060"><span class="hs-identifier hs-var">r</span></a></span><span> </span><span class="annot"><span class="annottext">TyCon
</span><a href="#local-6989586621682579062"><span class="hs-identifier hs-var">tc</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[Type]
</span><a href="#local-6989586621682579063"><span class="hs-identifier hs-var">tys</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-2162"></span><span>    </span><span class="annot"><a href="#local-6989586621682579045"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span id="local-6989586621682579064"><span class="annot"><span class="annottext">Role
</span><a href="#local-6989586621682579064"><span class="hs-identifier hs-var">r</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#FunTy"><span class="hs-identifier hs-type">FunTy</span></a></span><span> </span><span id="local-6989586621682579066"><span class="annot"><span class="annottext">FunTyFlag
</span><a href="#local-6989586621682579066"><span class="hs-identifier hs-var">af</span></a></span></span><span> </span><span id="local-6989586621682579067"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682579067"><span class="hs-identifier hs-var">w</span></a></span></span><span> </span><span id="local-6989586621682579068"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682579068"><span class="hs-identifier hs-var">t1</span></a></span></span><span> </span><span id="local-6989586621682579069"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682579069"><span class="hs-identifier hs-var">t2</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Role -&gt; FunTyFlag -&gt; Coercion -&gt; Coercion -&gt; Coercion -&gt; Coercion
</span><a href="GHC.Core.Coercion.html#mkFunCo"><span class="hs-identifier hs-var">mkFunCo</span></a></span><span> </span><span class="annot"><span class="annottext">Role
</span><a href="#local-6989586621682579064"><span class="hs-identifier hs-var">r</span></a></span><span> </span><span class="annot"><span class="annottext">FunTyFlag
</span><a href="#local-6989586621682579066"><span class="hs-identifier hs-var">af</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Role -&gt; Type -&gt; Coercion
</span><a href="#local-6989586621682579045"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="annot"><span class="annottext">Role
</span><a href="Language.Haskell.Syntax.Basic.html#Nominal"><span class="hs-identifier hs-var">Nominal</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682579067"><span class="hs-identifier hs-var">w</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Role -&gt; Type -&gt; Coercion
</span><a href="#local-6989586621682579045"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="annot"><span class="annottext">Role
</span><a href="#local-6989586621682579064"><span class="hs-identifier hs-var">r</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682579068"><span class="hs-identifier hs-var">t1</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Role -&gt; Type -&gt; Coercion
</span><a href="#local-6989586621682579045"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="annot"><span class="annottext">Role
</span><a href="#local-6989586621682579064"><span class="hs-identifier hs-var">r</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682579069"><span class="hs-identifier hs-var">t2</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-2163"></span><span>    </span><span class="annot"><a href="#local-6989586621682579045"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span id="local-6989586621682579070"><span class="annot"><span class="annottext">Role
</span><a href="#local-6989586621682579070"><span class="hs-identifier hs-var">r</span></a></span></span><span> </span><span id="local-6989586621682579071"><span class="annot"><span class="annottext">t :: Type
</span><a href="#local-6989586621682579071"><span class="hs-identifier hs-var">t</span></a></span></span><span class="hs-glyph">@</span><span class="hs-special">(</span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#ForAllTy"><span class="hs-identifier hs-type">ForAllTy</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Types.Var.html#Bndr"><span class="hs-identifier hs-type">Bndr</span></a></span><span> </span><span id="local-6989586621682579073"><span class="annot"><span class="annottext">CoVar
</span><a href="#local-6989586621682579073"><span class="hs-identifier hs-var">v</span></a></span></span><span> </span><span id="local-6989586621682579074"><span class="annot"><span class="annottext">ForAllTyFlag
</span><a href="#local-6989586621682579074"><span class="hs-identifier hs-var">vis</span></a></span></span><span class="hs-special">)</span><span> </span><span id="local-6989586621682579075"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682579075"><span class="hs-identifier hs-var">ty</span></a></span></span><span class="hs-special">)</span><span>
</span><span id="line-2164"></span><span>       </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">let</span><span> </span><span class="hs-special">(</span><span id="local-6989586621682579076"><span class="annot"><span class="annottext">LiftingContext
</span><a href="#local-6989586621682579076"><span class="hs-identifier hs-var">lc'</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682579077"><span class="annot"><span class="annottext">CoVar
</span><a href="#local-6989586621682579077"><span class="hs-identifier hs-var">v'</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682579078"><span class="annot"><span class="annottext">Coercion
</span><a href="#local-6989586621682579078"><span class="hs-identifier hs-var">h</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">LiftingContext -&gt; CoVar -&gt; (LiftingContext, CoVar, Coercion)
</span><a href="GHC.Core.Coercion.html#liftCoSubstVarBndr"><span class="hs-identifier hs-var">liftCoSubstVarBndr</span></a></span><span> </span><span class="annot"><span class="annottext">LiftingContext
</span><a href="#local-6989586621682579042"><span class="hs-identifier hs-var">lc</span></a></span><span> </span><span class="annot"><span class="annottext">CoVar
</span><a href="#local-6989586621682579073"><span class="hs-identifier hs-var">v</span></a></span><span>
</span><span id="line-2165"></span><span>             </span><span id="local-6989586621682579080"><span class="annot"><span class="annottext">body_co :: Coercion
</span><a href="#local-6989586621682579080"><span class="hs-identifier hs-var hs-var">body_co</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">LiftingContext -&gt; Role -&gt; Type -&gt; Coercion
</span><a href="GHC.Core.Coercion.html#ty_co_subst"><span class="hs-identifier hs-var">ty_co_subst</span></a></span><span> </span><span class="annot"><span class="annottext">LiftingContext
</span><a href="#local-6989586621682579076"><span class="hs-identifier hs-var">lc'</span></a></span><span> </span><span class="annot"><span class="annottext">Role
</span><a href="#local-6989586621682579070"><span class="hs-identifier hs-var">r</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682579075"><span class="hs-identifier hs-var">ty</span></a></span><span> </span><span class="hs-keyword">in</span><span>
</span><span id="line-2166"></span><span>         </span><span class="hs-keyword">if</span><span> </span><span class="annot"><span class="annottext">CoVar -&gt; Bool
</span><a href="GHC.Types.Var.html#isTyVar"><span class="hs-identifier hs-var">isTyVar</span></a></span><span> </span><span class="annot"><span class="annottext">CoVar
</span><a href="#local-6989586621682579077"><span class="hs-identifier hs-var">v'</span></a></span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Bool -&gt; Bool
</span><span class="hs-operator hs-var">||</span></span><span> </span><span class="annot"><span class="annottext">CoVar -&gt; Coercion -&gt; Bool
</span><a href="GHC.Core.TyCo.FVs.html#almostDevoidCoVarOfCo"><span class="hs-identifier hs-var">almostDevoidCoVarOfCo</span></a></span><span> </span><span class="annot"><span class="annottext">CoVar
</span><a href="#local-6989586621682579077"><span class="hs-identifier hs-var">v'</span></a></span><span> </span><span class="annot"><span class="annottext">Coercion
</span><a href="#local-6989586621682579080"><span class="hs-identifier hs-var">body_co</span></a></span><span>
</span><span id="line-2167"></span><span>           </span><span class="hs-comment">-- Lifting a ForAllTy over a coercion variable could fail as ForAllCo</span><span>
</span><span id="line-2168"></span><span>           </span><span class="hs-comment">-- imposes an extra restriction on where a covar can appear. See</span><span>
</span><span id="line-2169"></span><span>           </span><span class="hs-comment">-- (FC6) of Note [ForAllCo] in GHC.Tc.TyCo.Rep</span><span>
</span><span id="line-2170"></span><span>            </span><span class="hs-comment">-- We specifically check for this and panic because we know that</span><span>
</span><span id="line-2171"></span><span>           </span><span class="hs-comment">-- there's a hole in the type system here (see (FC6), and we'd rather</span><span>
</span><span id="line-2172"></span><span>           </span><span class="hs-comment">-- panic than fall into it.</span><span>
</span><span id="line-2173"></span><span>         </span><span class="hs-keyword">then</span><span> </span><span class="annot"><span class="annottext">HasDebugCallStack =&gt;
CoVar
-&gt; ForAllTyFlag -&gt; ForAllTyFlag -&gt; Coercion -&gt; Coercion -&gt; Coercion
CoVar
-&gt; ForAllTyFlag -&gt; ForAllTyFlag -&gt; Coercion -&gt; Coercion -&gt; Coercion
</span><a href="GHC.Core.Coercion.html#mkForAllCo"><span class="hs-identifier hs-var">mkForAllCo</span></a></span><span> </span><span class="annot"><span class="annottext">CoVar
</span><a href="#local-6989586621682579077"><span class="hs-identifier hs-var">v'</span></a></span><span> </span><span class="annot"><span class="annottext">ForAllTyFlag
</span><a href="#local-6989586621682579074"><span class="hs-identifier hs-var">vis</span></a></span><span> </span><span class="annot"><span class="annottext">ForAllTyFlag
</span><a href="#local-6989586621682579074"><span class="hs-identifier hs-var">vis</span></a></span><span> </span><span class="annot"><span class="annottext">Coercion
</span><a href="#local-6989586621682579078"><span class="hs-identifier hs-var">h</span></a></span><span> </span><span class="annot"><span class="annottext">Coercion
</span><a href="#local-6989586621682579080"><span class="hs-identifier hs-var">body_co</span></a></span><span>
</span><span id="line-2174"></span><span>         </span><span class="hs-keyword">else</span><span> </span><span class="annot"><span class="annottext">String -&gt; SDoc -&gt; Coercion
forall a. HasCallStack =&gt; String -&gt; SDoc -&gt; a
</span><a href="GHC.Utils.Panic.html#pprPanic"><span class="hs-identifier hs-var">pprPanic</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;ty_co_subst: covar is not almost devoid&quot;</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Type -&gt; SDoc
forall a. Outputable a =&gt; a -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682579071"><span class="hs-identifier hs-var">t</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-2175"></span><span>    </span><span class="annot"><a href="#local-6989586621682579045"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span id="local-6989586621682579081"><span class="annot"><span class="annottext">Role
</span><a href="#local-6989586621682579081"><span class="hs-identifier hs-var">r</span></a></span></span><span> </span><span id="local-6989586621682579082"><span class="annot"><span class="annottext">ty :: Type
</span><a href="#local-6989586621682579082"><span class="hs-identifier hs-var">ty</span></a></span></span><span class="hs-glyph">@</span><span class="hs-special">(</span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#LitTy"><span class="hs-identifier hs-type">LitTy</span></a></span><span> </span><span class="hs-special">{</span><span class="hs-special">}</span><span class="hs-special">)</span><span>     </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Coercion -&gt; Coercion
forall a. HasCallStack =&gt; Bool -&gt; a -&gt; a
</span><a href="GHC.Utils.Panic.Plain.html#assert"><span class="hs-identifier hs-var">assert</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Role
</span><a href="#local-6989586621682579081"><span class="hs-identifier hs-var">r</span></a></span><span> </span><span class="annot"><span class="annottext">Role -&gt; Role -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">==</span></span><span> </span><span class="annot"><span class="annottext">Role
</span><a href="Language.Haskell.Syntax.Basic.html#Nominal"><span class="hs-identifier hs-var">Nominal</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(Coercion -&gt; Coercion) -&gt; Coercion -&gt; Coercion
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-2176"></span><span>                             </span><span class="annot"><span class="annottext">Type -&gt; Coercion
</span><a href="GHC.Core.Coercion.html#mkNomReflCo"><span class="hs-identifier hs-var">mkNomReflCo</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682579082"><span class="hs-identifier hs-var">ty</span></a></span><span>
</span><span id="line-2177"></span><span>    </span><span class="annot"><a href="#local-6989586621682579045"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span id="local-6989586621682579084"><span class="annot"><span class="annottext">Role
</span><a href="#local-6989586621682579084"><span class="hs-identifier hs-var">r</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#CastTy"><span class="hs-identifier hs-type">CastTy</span></a></span><span> </span><span id="local-6989586621682579085"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682579085"><span class="hs-identifier hs-var">ty</span></a></span></span><span> </span><span id="local-6989586621682579086"><span class="annot"><span class="annottext">Coercion
</span><a href="#local-6989586621682579086"><span class="hs-identifier hs-var">co</span></a></span></span><span class="hs-special">)</span><span>    </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Coercion -&gt; Coercion -&gt; Coercion -&gt; Coercion
</span><a href="GHC.Core.Coercion.html#castCoercionKind"><span class="hs-identifier hs-var">castCoercionKind</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Role -&gt; Type -&gt; Coercion
</span><a href="#local-6989586621682579045"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="annot"><span class="annottext">Role
</span><a href="#local-6989586621682579084"><span class="hs-identifier hs-var">r</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682579085"><span class="hs-identifier hs-var">ty</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">LiftingContext -&gt; Coercion -&gt; Coercion
</span><a href="GHC.Core.Coercion.html#substLeftCo"><span class="hs-identifier hs-var">substLeftCo</span></a></span><span> </span><span class="annot"><span class="annottext">LiftingContext
</span><a href="#local-6989586621682579042"><span class="hs-identifier hs-var">lc</span></a></span><span> </span><span class="annot"><span class="annottext">Coercion
</span><a href="#local-6989586621682579086"><span class="hs-identifier hs-var">co</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-2178"></span><span>                                                        </span><span class="hs-special">(</span><span class="annot"><span class="annottext">LiftingContext -&gt; Coercion -&gt; Coercion
</span><a href="GHC.Core.Coercion.html#substRightCo"><span class="hs-identifier hs-var">substRightCo</span></a></span><span> </span><span class="annot"><span class="annottext">LiftingContext
</span><a href="#local-6989586621682579042"><span class="hs-identifier hs-var">lc</span></a></span><span> </span><span class="annot"><span class="annottext">Coercion
</span><a href="#local-6989586621682579086"><span class="hs-identifier hs-var">co</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-2179"></span><span>    </span><span class="annot"><a href="#local-6989586621682579045"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span id="local-6989586621682579087"><span class="annot"><span class="annottext">Role
</span><a href="#local-6989586621682579087"><span class="hs-identifier hs-var">r</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#CoercionTy"><span class="hs-identifier hs-type">CoercionTy</span></a></span><span> </span><span id="local-6989586621682579088"><span class="annot"><span class="annottext">Coercion
</span><a href="#local-6989586621682579088"><span class="hs-identifier hs-var">co</span></a></span></span><span class="hs-special">)</span><span>   </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Role -&gt; Coercion -&gt; Coercion -&gt; Coercion -&gt; Coercion
</span><a href="GHC.Core.Coercion.html#mkProofIrrelCo"><span class="hs-identifier hs-var">mkProofIrrelCo</span></a></span><span> </span><span class="annot"><span class="annottext">Role
</span><a href="#local-6989586621682579087"><span class="hs-identifier hs-var">r</span></a></span><span> </span><span class="annot"><span class="annottext">Coercion
</span><a href="#local-6989586621682579089"><span class="hs-identifier hs-var">kco</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">LiftingContext -&gt; Coercion -&gt; Coercion
</span><a href="GHC.Core.Coercion.html#substLeftCo"><span class="hs-identifier hs-var">substLeftCo</span></a></span><span> </span><span class="annot"><span class="annottext">LiftingContext
</span><a href="#local-6989586621682579042"><span class="hs-identifier hs-var">lc</span></a></span><span> </span><span class="annot"><span class="annottext">Coercion
</span><a href="#local-6989586621682579088"><span class="hs-identifier hs-var">co</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-2180"></span><span>                                                  </span><span class="hs-special">(</span><span class="annot"><span class="annottext">LiftingContext -&gt; Coercion -&gt; Coercion
</span><a href="GHC.Core.Coercion.html#substRightCo"><span class="hs-identifier hs-var">substRightCo</span></a></span><span> </span><span class="annot"><span class="annottext">LiftingContext
</span><a href="#local-6989586621682579042"><span class="hs-identifier hs-var">lc</span></a></span><span> </span><span class="annot"><span class="annottext">Coercion
</span><a href="#local-6989586621682579088"><span class="hs-identifier hs-var">co</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-2181"></span><span>      </span><span class="hs-keyword">where</span><span> </span><span id="local-6989586621682579089"><span class="annot"><span class="annottext">kco :: Coercion
</span><a href="#local-6989586621682579089"><span class="hs-identifier hs-var hs-var">kco</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Role -&gt; Type -&gt; Coercion
</span><a href="#local-6989586621682579045"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="annot"><span class="annottext">Role
</span><a href="Language.Haskell.Syntax.Basic.html#Nominal"><span class="hs-identifier hs-var">Nominal</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Coercion -&gt; Type
</span><a href="GHC.Core.Coercion.html#coercionType"><span class="hs-identifier hs-var">coercionType</span></a></span><span> </span><span class="annot"><span class="annottext">Coercion
</span><a href="#local-6989586621682579088"><span class="hs-identifier hs-var">co</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-2182"></span><span>
</span><span id="line-2183"></span><span>    </span><span id="local-6989586621682579051"><span class="annot"><span class="annottext">lift_phantom :: Type -&gt; Coercion
</span><a href="#local-6989586621682579051"><span class="hs-identifier hs-var hs-var">lift_phantom</span></a></span></span><span> </span><span id="local-6989586621682579090"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682579090"><span class="hs-identifier hs-var">ty</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Coercion -&gt; Type -&gt; Type -&gt; Coercion
</span><a href="GHC.Core.Coercion.html#mkPhantomCo"><span class="hs-identifier hs-var">mkPhantomCo</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Role -&gt; Type -&gt; Coercion
</span><a href="#local-6989586621682579045"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="annot"><span class="annottext">Role
</span><a href="Language.Haskell.Syntax.Basic.html#Nominal"><span class="hs-identifier hs-var">Nominal</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">HasDebugCallStack =&gt; Type -&gt; Type
Type -&gt; Type
</span><a href="GHC.Core.Type.html#typeKind"><span class="hs-identifier hs-var">typeKind</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682579090"><span class="hs-identifier hs-var">ty</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-2184"></span><span>                                  </span><span class="hs-special">(</span><span class="annot"><span class="annottext">HasDebugCallStack =&gt; Subst -&gt; Type -&gt; Type
Subst -&gt; Type -&gt; Type
</span><a href="GHC.Core.TyCo.Subst.html#substTy"><span class="hs-identifier hs-var">substTy</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">LiftingContext -&gt; Subst
</span><a href="GHC.Core.Coercion.html#lcSubstLeft"><span class="hs-identifier hs-var">lcSubstLeft</span></a></span><span>  </span><span class="annot"><span class="annottext">LiftingContext
</span><a href="#local-6989586621682579042"><span class="hs-identifier hs-var">lc</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682579090"><span class="hs-identifier hs-var">ty</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-2185"></span><span>                                  </span><span class="hs-special">(</span><span class="annot"><span class="annottext">HasDebugCallStack =&gt; Subst -&gt; Type -&gt; Type
Subst -&gt; Type -&gt; Type
</span><a href="GHC.Core.TyCo.Subst.html#substTy"><span class="hs-identifier hs-var">substTy</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">LiftingContext -&gt; Subst
</span><a href="GHC.Core.Coercion.html#lcSubstRight"><span class="hs-identifier hs-var">lcSubstRight</span></a></span><span> </span><span class="annot"><span class="annottext">LiftingContext
</span><a href="#local-6989586621682579042"><span class="hs-identifier hs-var">lc</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682579090"><span class="hs-identifier hs-var">ty</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-2186"></span><span>
</span><span id="line-2187"></span><span class="hs-comment">{-
Note [liftCoSubstTyVar]
~~~~~~~~~~~~~~~~~~~~~~~~~
This function can fail if a coercion in the environment is of too low a role.

liftCoSubstTyVar is called from two places: in liftCoSubst (naturally), and
also in matchAxiom in GHC.Core.Coercion.Opt. From liftCoSubst, the so-called lifting
lemma guarantees that the roles work out. If we fail in this
case, we really should panic -- something is deeply wrong. But, in matchAxiom,
failing is fine. matchAxiom is trying to find a set of coercions
that match, but it may fail, and this is healthy behavior.
-}</span><span>
</span><span id="line-2199"></span><span>
</span><span id="line-2200"></span><span class="hs-comment">-- See Note [liftCoSubstTyVar]</span><span>
</span><span id="line-2201"></span><span class="annot"><a href="GHC.Core.Coercion.html#liftCoSubstTyVar"><span class="hs-identifier hs-type">liftCoSubstTyVar</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Core.Coercion.html#LiftingContext"><span class="hs-identifier hs-type">LiftingContext</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Language.Haskell.Syntax.Basic.html#Role"><span class="hs-identifier hs-type">Role</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Types.Var.html#TyVar"><span class="hs-identifier hs-type">TyVar</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Maybe</span></span><span> </span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#Coercion"><span class="hs-identifier hs-type">Coercion</span></a></span><span>
</span><span id="line-2202"></span><span id="liftCoSubstTyVar"><span class="annot"><span class="annottext">liftCoSubstTyVar :: LiftingContext -&gt; Role -&gt; CoVar -&gt; Maybe Coercion
</span><a href="GHC.Core.Coercion.html#liftCoSubstTyVar"><span class="hs-identifier hs-var hs-var">liftCoSubstTyVar</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Core.Coercion.html#LC"><span class="hs-identifier hs-type">LC</span></a></span><span> </span><span id="local-6989586621682579091"><span class="annot"><span class="annottext">Subst
</span><a href="#local-6989586621682579091"><span class="hs-identifier hs-var">subst</span></a></span></span><span> </span><span id="local-6989586621682579092"><span class="annot"><span class="annottext">LiftCoEnv
</span><a href="#local-6989586621682579092"><span class="hs-identifier hs-var">env</span></a></span></span><span class="hs-special">)</span><span> </span><span id="local-6989586621682579093"><span class="annot"><span class="annottext">Role
</span><a href="#local-6989586621682579093"><span class="hs-identifier hs-var">r</span></a></span></span><span> </span><span id="local-6989586621682579094"><span class="annot"><span class="annottext">CoVar
</span><a href="#local-6989586621682579094"><span class="hs-identifier hs-var">v</span></a></span></span><span>
</span><span id="line-2203"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span id="local-6989586621682579095"><span class="annot"><span class="annottext">Coercion
</span><a href="#local-6989586621682579095"><span class="hs-identifier hs-var">co_arg</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">LiftCoEnv -&gt; CoVar -&gt; Maybe Coercion
forall a. VarEnv a -&gt; CoVar -&gt; Maybe a
</span><a href="GHC.Types.Var.Env.html#lookupVarEnv"><span class="hs-identifier hs-var">lookupVarEnv</span></a></span><span> </span><span class="annot"><span class="annottext">LiftCoEnv
</span><a href="#local-6989586621682579092"><span class="hs-identifier hs-var">env</span></a></span><span> </span><span class="annot"><span class="annottext">CoVar
</span><a href="#local-6989586621682579094"><span class="hs-identifier hs-var">v</span></a></span><span>
</span><span id="line-2204"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Role -&gt; Role -&gt; Coercion -&gt; Maybe Coercion
</span><a href="GHC.Core.Coercion.html#downgradeRole_maybe"><span class="hs-identifier hs-var">downgradeRole_maybe</span></a></span><span> </span><span class="annot"><span class="annottext">Role
</span><a href="#local-6989586621682579093"><span class="hs-identifier hs-var">r</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Coercion -&gt; Role
</span><a href="GHC.Core.Coercion.html#coercionRole"><span class="hs-identifier hs-var">coercionRole</span></a></span><span> </span><span class="annot"><span class="annottext">Coercion
</span><a href="#local-6989586621682579095"><span class="hs-identifier hs-var">co_arg</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Coercion
</span><a href="#local-6989586621682579095"><span class="hs-identifier hs-var">co_arg</span></a></span><span>
</span><span id="line-2205"></span><span>
</span><span id="line-2206"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">otherwise</span></span><span>
</span><span id="line-2207"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Coercion -&gt; Maybe Coercion
forall a. a -&gt; Maybe a
</span><span class="hs-identifier hs-var">Just</span></span><span> </span><span class="annot"><span class="annottext">(Coercion -&gt; Maybe Coercion) -&gt; Coercion -&gt; Maybe Coercion
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Role -&gt; Type -&gt; Coercion
</span><a href="GHC.Core.Coercion.html#mkReflCo"><span class="hs-identifier hs-var">mkReflCo</span></a></span><span> </span><span class="annot"><span class="annottext">Role
</span><a href="#local-6989586621682579093"><span class="hs-identifier hs-var">r</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Subst -&gt; CoVar -&gt; Type
</span><a href="GHC.Core.TyCo.Subst.html#substTyVar"><span class="hs-identifier hs-var">substTyVar</span></a></span><span> </span><span class="annot"><span class="annottext">Subst
</span><a href="#local-6989586621682579091"><span class="hs-identifier hs-var">subst</span></a></span><span> </span><span class="annot"><span class="annottext">CoVar
</span><a href="#local-6989586621682579094"><span class="hs-identifier hs-var">v</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-2208"></span><span>
</span><span id="line-2209"></span><span class="hs-comment">{- Note [liftCoSubstVarBndr]
   ~~~~~~~~~~~~~~~~~~~~~~~~~
callback:
  'liftCoSubstVarBndrUsing' needs to be general enough to work in two
  situations:

    - in this module, which manipulates 'Coercion's, and
    - in GHC.Core.FamInstEnv, where we work with 'Reduction's, which contain
      a coercion as well as a type.

  To achieve this, we require that the return type of the 'callback' function
  contain a coercion within it. This is witnessed by the first argument
  to 'liftCoSubstVarBndrUsing': a getter, which allows us to retrieve
  the coercion inside the return type. Thus:

    - in this module, we simply pass 'id' as the getter,
    - in GHC.Core.FamInstEnv, we pass 'reductionCoercion' as the getter.

liftCoSubstTyVarBndrUsing:
  Given
    forall tv:k. t
  We want to get
    forall (tv:k1) (kind_co :: k1 ~ k2) body_co

  We lift the kind k to get the kind_co
    kind_co = ty_co_subst k :: k1 ~ k2

  Now in the LiftingContext, we add the new mapping
    tv |-&gt; (tv :: k1) ~ ((tv |&gt; kind_co) :: k2)

liftCoSubstCoVarBndrUsing:
  Given
    forall cv:(s1 ~ s2). t
  We want to get
    forall (cv:s1'~s2') (kind_co :: (s1'~s2') ~ (t1 ~ t2)) body_co

  We lift s1 and s2 respectively to get
    eta1 :: s1' ~ t1
    eta2 :: s2' ~ t2
  And
    kind_co = TyConAppCo Nominal (~#) eta1 eta2

  Now in the liftingContext, we add the new mapping
    cv |-&gt; (cv :: s1' ~ s2') ~ ((sym eta1;cv;eta2) :: t1 ~ t2)
-}</span><span>
</span><span id="line-2254"></span><span>
</span><span id="line-2255"></span><span class="hs-comment">-- See Note [liftCoSubstVarBndr]</span><span>
</span><span id="line-2256"></span><span class="annot"><a href="GHC.Core.Coercion.html#liftCoSubstVarBndr"><span class="hs-identifier hs-type">liftCoSubstVarBndr</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Core.Coercion.html#LiftingContext"><span class="hs-identifier hs-type">LiftingContext</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Types.Var.html#TyCoVar"><span class="hs-identifier hs-type">TyCoVar</span></a></span><span>
</span><span id="line-2257"></span><span>                   </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Core.Coercion.html#LiftingContext"><span class="hs-identifier hs-type">LiftingContext</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Types.Var.html#TyCoVar"><span class="hs-identifier hs-type">TyCoVar</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#Coercion"><span class="hs-identifier hs-type">Coercion</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-2258"></span><span id="liftCoSubstVarBndr"><span class="annot"><span class="annottext">liftCoSubstVarBndr :: LiftingContext -&gt; CoVar -&gt; (LiftingContext, CoVar, Coercion)
</span><a href="GHC.Core.Coercion.html#liftCoSubstVarBndr"><span class="hs-identifier hs-var hs-var">liftCoSubstVarBndr</span></a></span></span><span> </span><span id="local-6989586621682579098"><span class="annot"><span class="annottext">LiftingContext
</span><a href="#local-6989586621682579098"><span class="hs-identifier hs-var">lc</span></a></span></span><span> </span><span id="local-6989586621682579099"><span class="annot"><span class="annottext">CoVar
</span><a href="#local-6989586621682579099"><span class="hs-identifier hs-var">tv</span></a></span></span><span>
</span><span id="line-2259"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(Coercion -&gt; Coercion)
-&gt; (LiftingContext -&gt; Type -&gt; Coercion)
-&gt; LiftingContext
-&gt; CoVar
-&gt; (LiftingContext, CoVar, Coercion)
forall r.
(r -&gt; Coercion)
-&gt; (LiftingContext -&gt; Type -&gt; r)
-&gt; LiftingContext
-&gt; CoVar
-&gt; (LiftingContext, CoVar, r)
</span><a href="GHC.Core.Coercion.html#liftCoSubstVarBndrUsing"><span class="hs-identifier hs-var">liftCoSubstVarBndrUsing</span></a></span><span> </span><span class="annot"><span class="annottext">Coercion -&gt; Coercion
forall a. a -&gt; a
</span><span class="hs-identifier hs-var">id</span></span><span> </span><span class="annot"><span class="annottext">LiftingContext -&gt; Type -&gt; Coercion
</span><a href="#local-6989586621682579101"><span class="hs-identifier hs-var">callback</span></a></span><span> </span><span class="annot"><span class="annottext">LiftingContext
</span><a href="#local-6989586621682579098"><span class="hs-identifier hs-var">lc</span></a></span><span> </span><span class="annot"><span class="annottext">CoVar
</span><a href="#local-6989586621682579099"><span class="hs-identifier hs-var">tv</span></a></span><span>
</span><span id="line-2260"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-2261"></span><span>    </span><span id="local-6989586621682579101"><span class="annot"><span class="annottext">callback :: LiftingContext -&gt; Type -&gt; Coercion
</span><a href="#local-6989586621682579101"><span class="hs-identifier hs-var hs-var">callback</span></a></span></span><span> </span><span id="local-6989586621682579102"><span class="annot"><span class="annottext">LiftingContext
</span><a href="#local-6989586621682579102"><span class="hs-identifier hs-var">lc'</span></a></span></span><span> </span><span id="local-6989586621682579103"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682579103"><span class="hs-identifier hs-var">ty'</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">LiftingContext -&gt; Role -&gt; Type -&gt; Coercion
</span><a href="GHC.Core.Coercion.html#ty_co_subst"><span class="hs-identifier hs-var">ty_co_subst</span></a></span><span> </span><span class="annot"><span class="annottext">LiftingContext
</span><a href="#local-6989586621682579102"><span class="hs-identifier hs-var">lc'</span></a></span><span> </span><span class="annot"><span class="annottext">Role
</span><a href="Language.Haskell.Syntax.Basic.html#Nominal"><span class="hs-identifier hs-var">Nominal</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682579103"><span class="hs-identifier hs-var">ty'</span></a></span><span>
</span><span id="line-2262"></span><span>
</span><span id="line-2263"></span><span class="hs-comment">-- the callback must produce a nominal coercion</span><span>
</span><span id="line-2264"></span><span id="local-6989586621682577373"><span class="annot"><a href="GHC.Core.Coercion.html#liftCoSubstVarBndrUsing"><span class="hs-identifier hs-type">liftCoSubstVarBndrUsing</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621682577373"><span class="hs-identifier hs-type">r</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#CoercionN"><span class="hs-identifier hs-type">CoercionN</span></a></span><span class="hs-special">)</span><span>              </span><span class="annot"><span class="hs-comment">-- ^ coercion getter</span></span><span>
</span><span id="line-2265"></span><span>                        </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Core.Coercion.html#LiftingContext"><span class="hs-identifier hs-type">LiftingContext</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#Type"><span class="hs-identifier hs-type">Type</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621682577373"><span class="hs-identifier hs-type">r</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="hs-comment">-- ^ callback</span></span><span>
</span><span id="line-2266"></span><span>                        </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Core.Coercion.html#LiftingContext"><span class="hs-identifier hs-type">LiftingContext</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Types.Var.html#TyCoVar"><span class="hs-identifier hs-type">TyCoVar</span></a></span><span>
</span><span id="line-2267"></span><span>                        </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Core.Coercion.html#LiftingContext"><span class="hs-identifier hs-type">LiftingContext</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Types.Var.html#TyCoVar"><span class="hs-identifier hs-type">TyCoVar</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="#local-6989586621682577373"><span class="hs-identifier hs-type">r</span></a></span><span class="hs-special">)</span></span><span>
</span><span id="line-2268"></span><span id="liftCoSubstVarBndrUsing"><span class="annot"><span class="annottext">liftCoSubstVarBndrUsing :: forall r.
(r -&gt; Coercion)
-&gt; (LiftingContext -&gt; Type -&gt; r)
-&gt; LiftingContext
-&gt; CoVar
-&gt; (LiftingContext, CoVar, r)
</span><a href="GHC.Core.Coercion.html#liftCoSubstVarBndrUsing"><span class="hs-identifier hs-var hs-var">liftCoSubstVarBndrUsing</span></a></span></span><span> </span><span id="local-6989586621682579104"><span class="annot"><span class="annottext">r -&gt; Coercion
</span><a href="#local-6989586621682579104"><span class="hs-identifier hs-var">view_co</span></a></span></span><span> </span><span id="local-6989586621682579105"><span class="annot"><span class="annottext">LiftingContext -&gt; Type -&gt; r
</span><a href="#local-6989586621682579105"><span class="hs-identifier hs-var">fun</span></a></span></span><span> </span><span id="local-6989586621682579106"><span class="annot"><span class="annottext">LiftingContext
</span><a href="#local-6989586621682579106"><span class="hs-identifier hs-var">lc</span></a></span></span><span> </span><span id="local-6989586621682579107"><span class="annot"><span class="annottext">CoVar
</span><a href="#local-6989586621682579107"><span class="hs-identifier hs-var">old_var</span></a></span></span><span>
</span><span id="line-2269"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">CoVar -&gt; Bool
</span><a href="GHC.Types.Var.html#isTyVar"><span class="hs-identifier hs-var">isTyVar</span></a></span><span> </span><span class="annot"><span class="annottext">CoVar
</span><a href="#local-6989586621682579107"><span class="hs-identifier hs-var">old_var</span></a></span><span>
</span><span id="line-2270"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(r -&gt; Coercion)
-&gt; (LiftingContext -&gt; Type -&gt; r)
-&gt; LiftingContext
-&gt; CoVar
-&gt; (LiftingContext, CoVar, r)
forall r.
(r -&gt; Coercion)
-&gt; (LiftingContext -&gt; Type -&gt; r)
-&gt; LiftingContext
-&gt; CoVar
-&gt; (LiftingContext, CoVar, r)
</span><a href="GHC.Core.Coercion.html#liftCoSubstTyVarBndrUsing"><span class="hs-identifier hs-var">liftCoSubstTyVarBndrUsing</span></a></span><span> </span><span class="annot"><span class="annottext">r -&gt; Coercion
</span><a href="#local-6989586621682579104"><span class="hs-identifier hs-var">view_co</span></a></span><span> </span><span class="annot"><span class="annottext">LiftingContext -&gt; Type -&gt; r
</span><a href="#local-6989586621682579105"><span class="hs-identifier hs-var">fun</span></a></span><span> </span><span class="annot"><span class="annottext">LiftingContext
</span><a href="#local-6989586621682579106"><span class="hs-identifier hs-var">lc</span></a></span><span> </span><span class="annot"><span class="annottext">CoVar
</span><a href="#local-6989586621682579107"><span class="hs-identifier hs-var">old_var</span></a></span><span>
</span><span id="line-2271"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">otherwise</span></span><span>
</span><span id="line-2272"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(r -&gt; Coercion)
-&gt; (LiftingContext -&gt; Type -&gt; r)
-&gt; LiftingContext
-&gt; CoVar
-&gt; (LiftingContext, CoVar, r)
forall r.
(r -&gt; Coercion)
-&gt; (LiftingContext -&gt; Type -&gt; r)
-&gt; LiftingContext
-&gt; CoVar
-&gt; (LiftingContext, CoVar, r)
</span><a href="GHC.Core.Coercion.html#liftCoSubstCoVarBndrUsing"><span class="hs-identifier hs-var">liftCoSubstCoVarBndrUsing</span></a></span><span> </span><span class="annot"><span class="annottext">r -&gt; Coercion
</span><a href="#local-6989586621682579104"><span class="hs-identifier hs-var">view_co</span></a></span><span> </span><span class="annot"><span class="annottext">LiftingContext -&gt; Type -&gt; r
</span><a href="#local-6989586621682579105"><span class="hs-identifier hs-var">fun</span></a></span><span> </span><span class="annot"><span class="annottext">LiftingContext
</span><a href="#local-6989586621682579106"><span class="hs-identifier hs-var">lc</span></a></span><span> </span><span class="annot"><span class="annottext">CoVar
</span><a href="#local-6989586621682579107"><span class="hs-identifier hs-var">old_var</span></a></span><span>
</span><span id="line-2273"></span><span>
</span><span id="line-2274"></span><span class="hs-comment">-- Works for tyvar binder</span><span>
</span><span id="line-2275"></span><span id="local-6989586621682579110"><span class="annot"><a href="GHC.Core.Coercion.html#liftCoSubstTyVarBndrUsing"><span class="hs-identifier hs-type">liftCoSubstTyVarBndrUsing</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621682579110"><span class="hs-identifier hs-type">r</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#CoercionN"><span class="hs-identifier hs-type">CoercionN</span></a></span><span class="hs-special">)</span><span>              </span><span class="annot"><span class="hs-comment">-- ^ coercion getter</span></span><span>
</span><span id="line-2276"></span><span>                          </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Core.Coercion.html#LiftingContext"><span class="hs-identifier hs-type">LiftingContext</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#Type"><span class="hs-identifier hs-type">Type</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621682579110"><span class="hs-identifier hs-type">r</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="hs-comment">-- ^ callback</span></span><span>
</span><span id="line-2277"></span><span>                          </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Core.Coercion.html#LiftingContext"><span class="hs-identifier hs-type">LiftingContext</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Types.Var.html#TyVar"><span class="hs-identifier hs-type">TyVar</span></a></span><span>
</span><span id="line-2278"></span><span>                          </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Core.Coercion.html#LiftingContext"><span class="hs-identifier hs-type">LiftingContext</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Types.Var.html#TyVar"><span class="hs-identifier hs-type">TyVar</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="#local-6989586621682579110"><span class="hs-identifier hs-type">r</span></a></span><span class="hs-special">)</span></span><span>
</span><span id="line-2279"></span><span id="liftCoSubstTyVarBndrUsing"><span class="annot"><span class="annottext">liftCoSubstTyVarBndrUsing :: forall r.
(r -&gt; Coercion)
-&gt; (LiftingContext -&gt; Type -&gt; r)
-&gt; LiftingContext
-&gt; CoVar
-&gt; (LiftingContext, CoVar, r)
</span><a href="GHC.Core.Coercion.html#liftCoSubstTyVarBndrUsing"><span class="hs-identifier hs-var hs-var">liftCoSubstTyVarBndrUsing</span></a></span></span><span> </span><span id="local-6989586621682579114"><span class="annot"><span class="annottext">r -&gt; Coercion
</span><a href="#local-6989586621682579114"><span class="hs-identifier hs-var">view_co</span></a></span></span><span> </span><span id="local-6989586621682579115"><span class="annot"><span class="annottext">LiftingContext -&gt; Type -&gt; r
</span><a href="#local-6989586621682579115"><span class="hs-identifier hs-var">fun</span></a></span></span><span> </span><span id="local-6989586621682579116"><span class="annot"><span class="annottext">lc :: LiftingContext
</span><a href="#local-6989586621682579116"><span class="hs-identifier hs-var">lc</span></a></span></span><span class="hs-glyph">@</span><span class="hs-special">(</span><span class="annot"><a href="GHC.Core.Coercion.html#LC"><span class="hs-identifier hs-type">LC</span></a></span><span> </span><span id="local-6989586621682579117"><span class="annot"><span class="annottext">Subst
</span><a href="#local-6989586621682579117"><span class="hs-identifier hs-var">subst</span></a></span></span><span> </span><span id="local-6989586621682579118"><span class="annot"><span class="annottext">LiftCoEnv
</span><a href="#local-6989586621682579118"><span class="hs-identifier hs-var">cenv</span></a></span></span><span class="hs-special">)</span><span> </span><span id="local-6989586621682579119"><span class="annot"><span class="annottext">CoVar
</span><a href="#local-6989586621682579119"><span class="hs-identifier hs-var">old_var</span></a></span></span><span>
</span><span id="line-2280"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Bool -&gt; (LiftingContext, CoVar, r) -&gt; (LiftingContext, CoVar, r)
forall a. HasCallStack =&gt; Bool -&gt; a -&gt; a
</span><a href="GHC.Utils.Panic.Plain.html#assert"><span class="hs-identifier hs-var">assert</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">CoVar -&gt; Bool
</span><a href="GHC.Types.Var.html#isTyVar"><span class="hs-identifier hs-var">isTyVar</span></a></span><span> </span><span class="annot"><span class="annottext">CoVar
</span><a href="#local-6989586621682579119"><span class="hs-identifier hs-var">old_var</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">((LiftingContext, CoVar, r) -&gt; (LiftingContext, CoVar, r))
-&gt; (LiftingContext, CoVar, r) -&gt; (LiftingContext, CoVar, r)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-2281"></span><span>    </span><span class="hs-special">(</span><span> </span><span class="annot"><span class="annottext">Subst -&gt; LiftCoEnv -&gt; LiftingContext
</span><a href="GHC.Core.Coercion.html#LC"><span class="hs-identifier hs-var">LC</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Subst
</span><a href="#local-6989586621682579117"><span class="hs-identifier hs-var">subst</span></a></span><span> </span><span class="annot"><span class="annottext">Subst -&gt; CoVar -&gt; Subst
</span><a href="GHC.Core.TyCo.Subst.html#extendSubstInScope"><span class="hs-operator hs-var">`extendSubstInScope`</span></a></span><span> </span><span class="annot"><span class="annottext">CoVar
</span><a href="#local-6989586621682579121"><span class="hs-identifier hs-var">new_var</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">LiftCoEnv
</span><a href="#local-6989586621682579122"><span class="hs-identifier hs-var">new_cenv</span></a></span><span>
</span><span id="line-2282"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">CoVar
</span><a href="#local-6989586621682579121"><span class="hs-identifier hs-var">new_var</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">r
</span><a href="#local-6989586621682579123"><span class="hs-identifier hs-var">stuff</span></a></span><span> </span><span class="hs-special">)</span><span>
</span><span id="line-2283"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-2284"></span><span>    </span><span id="local-6989586621682579124"><span class="annot"><span class="annottext">old_kind :: Type
</span><a href="#local-6989586621682579124"><span class="hs-identifier hs-var hs-var">old_kind</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">CoVar -&gt; Type
</span><a href="GHC.Types.Var.html#tyVarKind"><span class="hs-identifier hs-var">tyVarKind</span></a></span><span> </span><span class="annot"><span class="annottext">CoVar
</span><a href="#local-6989586621682579119"><span class="hs-identifier hs-var">old_var</span></a></span><span>
</span><span id="line-2285"></span><span>    </span><span id="local-6989586621682579123"><span class="annot"><span class="annottext">stuff :: r
</span><a href="#local-6989586621682579123"><span class="hs-identifier hs-var hs-var">stuff</span></a></span></span><span>    </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">LiftingContext -&gt; Type -&gt; r
</span><a href="#local-6989586621682579115"><span class="hs-identifier hs-var">fun</span></a></span><span> </span><span class="annot"><span class="annottext">LiftingContext
</span><a href="#local-6989586621682579116"><span class="hs-identifier hs-var">lc</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682579124"><span class="hs-identifier hs-var">old_kind</span></a></span><span>
</span><span id="line-2286"></span><span>    </span><span id="local-6989586621682579125"><span class="annot"><span class="annottext">eta :: Coercion
</span><a href="#local-6989586621682579125"><span class="hs-identifier hs-var hs-var">eta</span></a></span></span><span>      </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">r -&gt; Coercion
</span><a href="#local-6989586621682579114"><span class="hs-identifier hs-var">view_co</span></a></span><span> </span><span class="annot"><span class="annottext">r
</span><a href="#local-6989586621682579123"><span class="hs-identifier hs-var">stuff</span></a></span><span>
</span><span id="line-2287"></span><span>    </span><span id="local-6989586621682579126"><span class="annot"><span class="annottext">k1 :: Type
</span><a href="#local-6989586621682579126"><span class="hs-identifier hs-var hs-var">k1</span></a></span></span><span>       </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">HasDebugCallStack =&gt; Coercion -&gt; Type
Coercion -&gt; Type
</span><a href="GHC.Core.Coercion.html#coercionLKind"><span class="hs-identifier hs-var">coercionLKind</span></a></span><span> </span><span class="annot"><span class="annottext">Coercion
</span><a href="#local-6989586621682579125"><span class="hs-identifier hs-var">eta</span></a></span><span>
</span><span id="line-2288"></span><span>    </span><span id="local-6989586621682579121"><span class="annot"><span class="annottext">new_var :: CoVar
</span><a href="#local-6989586621682579121"><span class="hs-identifier hs-var hs-var">new_var</span></a></span></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">InScopeSet -&gt; CoVar -&gt; CoVar
</span><a href="GHC.Types.Var.Env.html#uniqAway"><span class="hs-identifier hs-var">uniqAway</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Subst -&gt; InScopeSet
</span><a href="GHC.Core.TyCo.Subst.html#getSubstInScope"><span class="hs-identifier hs-var">getSubstInScope</span></a></span><span> </span><span class="annot"><span class="annottext">Subst
</span><a href="#local-6989586621682579117"><span class="hs-identifier hs-var">subst</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">CoVar -&gt; Type -&gt; CoVar
</span><a href="GHC.Types.Var.html#setVarType"><span class="hs-identifier hs-var">setVarType</span></a></span><span> </span><span class="annot"><span class="annottext">CoVar
</span><a href="#local-6989586621682579119"><span class="hs-identifier hs-var">old_var</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682579126"><span class="hs-identifier hs-var">k1</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-2289"></span><span>
</span><span id="line-2290"></span><span>    </span><span id="local-6989586621682579130"><span class="annot"><span class="annottext">lifted :: Coercion
</span><a href="#local-6989586621682579130"><span class="hs-identifier hs-var hs-var">lifted</span></a></span></span><span>   </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Role -&gt; Type -&gt; Coercion -&gt; Coercion
</span><a href="GHC.Core.Coercion.html#mkGReflRightCo"><span class="hs-identifier hs-var">mkGReflRightCo</span></a></span><span> </span><span class="annot"><span class="annottext">Role
</span><a href="Language.Haskell.Syntax.Basic.html#Nominal"><span class="hs-identifier hs-var">Nominal</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">CoVar -&gt; Type
</span><a href="GHC.Core.TyCo.Rep.html#TyVarTy"><span class="hs-identifier hs-var">TyVarTy</span></a></span><span> </span><span class="annot"><span class="annottext">CoVar
</span><a href="#local-6989586621682579121"><span class="hs-identifier hs-var">new_var</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Coercion
</span><a href="#local-6989586621682579125"><span class="hs-identifier hs-var">eta</span></a></span><span>
</span><span id="line-2291"></span><span>               </span><span class="hs-comment">-- :: new_var ~ new_var |&gt; eta</span><span>
</span><span id="line-2292"></span><span>    </span><span id="local-6989586621682579122"><span class="annot"><span class="annottext">new_cenv :: LiftCoEnv
</span><a href="#local-6989586621682579122"><span class="hs-identifier hs-var hs-var">new_cenv</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">LiftCoEnv -&gt; CoVar -&gt; Coercion -&gt; LiftCoEnv
forall a. VarEnv a -&gt; CoVar -&gt; a -&gt; VarEnv a
</span><a href="GHC.Types.Var.Env.html#extendVarEnv"><span class="hs-identifier hs-var">extendVarEnv</span></a></span><span> </span><span class="annot"><span class="annottext">LiftCoEnv
</span><a href="#local-6989586621682579118"><span class="hs-identifier hs-var">cenv</span></a></span><span> </span><span class="annot"><span class="annottext">CoVar
</span><a href="#local-6989586621682579119"><span class="hs-identifier hs-var">old_var</span></a></span><span> </span><span class="annot"><span class="annottext">Coercion
</span><a href="#local-6989586621682579130"><span class="hs-identifier hs-var">lifted</span></a></span><span>
</span><span id="line-2293"></span><span>
</span><span id="line-2294"></span><span class="hs-comment">-- Works for covar binder</span><span>
</span><span id="line-2295"></span><span id="local-6989586621682579131"><span class="annot"><a href="GHC.Core.Coercion.html#liftCoSubstCoVarBndrUsing"><span class="hs-identifier hs-type">liftCoSubstCoVarBndrUsing</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621682579131"><span class="hs-identifier hs-type">r</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#CoercionN"><span class="hs-identifier hs-type">CoercionN</span></a></span><span class="hs-special">)</span><span>              </span><span class="annot"><span class="hs-comment">-- ^ coercion getter</span></span><span>
</span><span id="line-2296"></span><span>                          </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Core.Coercion.html#LiftingContext"><span class="hs-identifier hs-type">LiftingContext</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#Type"><span class="hs-identifier hs-type">Type</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621682579131"><span class="hs-identifier hs-type">r</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="hs-comment">-- ^ callback</span></span><span>
</span><span id="line-2297"></span><span>                          </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Core.Coercion.html#LiftingContext"><span class="hs-identifier hs-type">LiftingContext</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Types.Var.html#CoVar"><span class="hs-identifier hs-type">CoVar</span></a></span><span>
</span><span id="line-2298"></span><span>                          </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Core.Coercion.html#LiftingContext"><span class="hs-identifier hs-type">LiftingContext</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Types.Var.html#CoVar"><span class="hs-identifier hs-type">CoVar</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="#local-6989586621682579131"><span class="hs-identifier hs-type">r</span></a></span><span class="hs-special">)</span></span><span>
</span><span id="line-2299"></span><span id="liftCoSubstCoVarBndrUsing"><span class="annot"><span class="annottext">liftCoSubstCoVarBndrUsing :: forall r.
(r -&gt; Coercion)
-&gt; (LiftingContext -&gt; Type -&gt; r)
-&gt; LiftingContext
-&gt; CoVar
-&gt; (LiftingContext, CoVar, r)
</span><a href="GHC.Core.Coercion.html#liftCoSubstCoVarBndrUsing"><span class="hs-identifier hs-var hs-var">liftCoSubstCoVarBndrUsing</span></a></span></span><span> </span><span id="local-6989586621682579139"><span class="annot"><span class="annottext">r -&gt; Coercion
</span><a href="#local-6989586621682579139"><span class="hs-identifier hs-var">view_co</span></a></span></span><span> </span><span id="local-6989586621682579140"><span class="annot"><span class="annottext">LiftingContext -&gt; Type -&gt; r
</span><a href="#local-6989586621682579140"><span class="hs-identifier hs-var">fun</span></a></span></span><span> </span><span id="local-6989586621682579141"><span class="annot"><span class="annottext">lc :: LiftingContext
</span><a href="#local-6989586621682579141"><span class="hs-identifier hs-var">lc</span></a></span></span><span class="hs-glyph">@</span><span class="hs-special">(</span><span class="annot"><a href="GHC.Core.Coercion.html#LC"><span class="hs-identifier hs-type">LC</span></a></span><span> </span><span id="local-6989586621682579142"><span class="annot"><span class="annottext">Subst
</span><a href="#local-6989586621682579142"><span class="hs-identifier hs-var">subst</span></a></span></span><span> </span><span id="local-6989586621682579143"><span class="annot"><span class="annottext">LiftCoEnv
</span><a href="#local-6989586621682579143"><span class="hs-identifier hs-var">cenv</span></a></span></span><span class="hs-special">)</span><span> </span><span id="local-6989586621682579144"><span class="annot"><span class="annottext">CoVar
</span><a href="#local-6989586621682579144"><span class="hs-identifier hs-var">old_var</span></a></span></span><span>
</span><span id="line-2300"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Bool -&gt; (LiftingContext, CoVar, r) -&gt; (LiftingContext, CoVar, r)
forall a. HasCallStack =&gt; Bool -&gt; a -&gt; a
</span><a href="GHC.Utils.Panic.Plain.html#assert"><span class="hs-identifier hs-var">assert</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">CoVar -&gt; Bool
</span><a href="GHC.Types.Var.html#isCoVar"><span class="hs-identifier hs-var">isCoVar</span></a></span><span> </span><span class="annot"><span class="annottext">CoVar
</span><a href="#local-6989586621682579144"><span class="hs-identifier hs-var">old_var</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">((LiftingContext, CoVar, r) -&gt; (LiftingContext, CoVar, r))
-&gt; (LiftingContext, CoVar, r) -&gt; (LiftingContext, CoVar, r)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-2301"></span><span>    </span><span class="hs-special">(</span><span> </span><span class="annot"><span class="annottext">Subst -&gt; LiftCoEnv -&gt; LiftingContext
</span><a href="GHC.Core.Coercion.html#LC"><span class="hs-identifier hs-var">LC</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Subst
</span><a href="#local-6989586621682579142"><span class="hs-identifier hs-var">subst</span></a></span><span> </span><span class="annot"><span class="annottext">Subst -&gt; CoVar -&gt; Subst
</span><a href="GHC.Core.TyCo.Subst.html#extendSubstInScope"><span class="hs-operator hs-var">`extendSubstInScope`</span></a></span><span> </span><span class="annot"><span class="annottext">CoVar
</span><a href="#local-6989586621682579145"><span class="hs-identifier hs-var">new_var</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">LiftCoEnv
</span><a href="#local-6989586621682579146"><span class="hs-identifier hs-var">new_cenv</span></a></span><span>
</span><span id="line-2302"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">CoVar
</span><a href="#local-6989586621682579145"><span class="hs-identifier hs-var">new_var</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">r
</span><a href="#local-6989586621682579147"><span class="hs-identifier hs-var">stuff</span></a></span><span> </span><span class="hs-special">)</span><span>
</span><span id="line-2303"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-2304"></span><span>    </span><span id="local-6989586621682579148"><span class="annot"><span class="annottext">old_kind :: Type
</span><a href="#local-6989586621682579148"><span class="hs-identifier hs-var hs-var">old_kind</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">CoVar -&gt; Type
</span><a href="GHC.Core.Coercion.html#coVarKind"><span class="hs-identifier hs-var">coVarKind</span></a></span><span> </span><span class="annot"><span class="annottext">CoVar
</span><a href="#local-6989586621682579144"><span class="hs-identifier hs-var">old_var</span></a></span><span>
</span><span id="line-2305"></span><span>    </span><span id="local-6989586621682579147"><span class="annot"><span class="annottext">stuff :: r
</span><a href="#local-6989586621682579147"><span class="hs-identifier hs-var hs-var">stuff</span></a></span></span><span>    </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">LiftingContext -&gt; Type -&gt; r
</span><a href="#local-6989586621682579140"><span class="hs-identifier hs-var">fun</span></a></span><span> </span><span class="annot"><span class="annottext">LiftingContext
</span><a href="#local-6989586621682579141"><span class="hs-identifier hs-var">lc</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682579148"><span class="hs-identifier hs-var">old_kind</span></a></span><span>
</span><span id="line-2306"></span><span>    </span><span id="local-6989586621682579149"><span class="annot"><span class="annottext">eta :: Coercion
</span><a href="#local-6989586621682579149"><span class="hs-identifier hs-var hs-var">eta</span></a></span></span><span>      </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">r -&gt; Coercion
</span><a href="#local-6989586621682579139"><span class="hs-identifier hs-var">view_co</span></a></span><span> </span><span class="annot"><span class="annottext">r
</span><a href="#local-6989586621682579147"><span class="hs-identifier hs-var">stuff</span></a></span><span>
</span><span id="line-2307"></span><span>    </span><span id="local-6989586621682579150"><span class="annot"><span class="annottext">k1 :: Type
</span><a href="#local-6989586621682579150"><span class="hs-identifier hs-var hs-var">k1</span></a></span></span><span>       </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">HasDebugCallStack =&gt; Coercion -&gt; Type
Coercion -&gt; Type
</span><a href="GHC.Core.Coercion.html#coercionLKind"><span class="hs-identifier hs-var">coercionLKind</span></a></span><span> </span><span class="annot"><span class="annottext">Coercion
</span><a href="#local-6989586621682579149"><span class="hs-identifier hs-var">eta</span></a></span><span>
</span><span id="line-2308"></span><span>    </span><span id="local-6989586621682579145"><span class="annot"><span class="annottext">new_var :: CoVar
</span><a href="#local-6989586621682579145"><span class="hs-identifier hs-var hs-var">new_var</span></a></span></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">InScopeSet -&gt; CoVar -&gt; CoVar
</span><a href="GHC.Types.Var.Env.html#uniqAway"><span class="hs-identifier hs-var">uniqAway</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Subst -&gt; InScopeSet
</span><a href="GHC.Core.TyCo.Subst.html#getSubstInScope"><span class="hs-identifier hs-var">getSubstInScope</span></a></span><span> </span><span class="annot"><span class="annottext">Subst
</span><a href="#local-6989586621682579142"><span class="hs-identifier hs-var">subst</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">CoVar -&gt; Type -&gt; CoVar
</span><a href="GHC.Types.Var.html#setVarType"><span class="hs-identifier hs-var">setVarType</span></a></span><span> </span><span class="annot"><span class="annottext">CoVar
</span><a href="#local-6989586621682579144"><span class="hs-identifier hs-var">old_var</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682579150"><span class="hs-identifier hs-var">k1</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-2309"></span><span>
</span><span id="line-2310"></span><span>    </span><span class="hs-comment">-- old_var :: s1  ~r s2</span><span>
</span><span id="line-2311"></span><span>    </span><span class="hs-comment">-- eta     :: (s1' ~r s2') ~N (t1 ~r t2)</span><span>
</span><span id="line-2312"></span><span>    </span><span class="hs-comment">-- eta1    :: s1' ~r t1</span><span>
</span><span id="line-2313"></span><span>    </span><span class="hs-comment">-- eta2    :: s2' ~r t2</span><span>
</span><span id="line-2314"></span><span>    </span><span class="hs-comment">-- co1     :: s1' ~r s2'</span><span>
</span><span id="line-2315"></span><span>    </span><span class="hs-comment">-- co2     :: t1  ~r t2</span><span>
</span><span id="line-2316"></span><span>    </span><span class="hs-comment">-- lifted  :: co1 ~N co2</span><span>
</span><span id="line-2317"></span><span>
</span><span id="line-2318"></span><span>    </span><span id="local-6989586621682579151"><span class="annot"><span class="annottext">role :: Role
</span><a href="#local-6989586621682579151"><span class="hs-keyword hs-var hs-var">role</span></a></span></span><span>   </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">CoVar -&gt; Role
</span><a href="GHC.Core.Coercion.html#coVarRole"><span class="hs-identifier hs-var">coVarRole</span></a></span><span> </span><span class="annot"><span class="annottext">CoVar
</span><a href="#local-6989586621682579144"><span class="hs-identifier hs-var">old_var</span></a></span><span>
</span><span id="line-2319"></span><span>    </span><span id="local-6989586621682579152"><span class="annot"><span class="annottext">eta' :: Coercion
</span><a href="#local-6989586621682579152"><span class="hs-identifier hs-var hs-var">eta'</span></a></span></span><span>   </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Role -&gt; Role -&gt; Coercion -&gt; Coercion
</span><a href="GHC.Core.Coercion.html#downgradeRole"><span class="hs-identifier hs-var">downgradeRole</span></a></span><span> </span><span class="annot"><span class="annottext">Role
</span><a href="#local-6989586621682579151"><span class="hs-keyword hs-var">role</span></a></span><span> </span><span class="annot"><span class="annottext">Role
</span><a href="Language.Haskell.Syntax.Basic.html#Nominal"><span class="hs-identifier hs-var">Nominal</span></a></span><span> </span><span class="annot"><span class="annottext">Coercion
</span><a href="#local-6989586621682579149"><span class="hs-identifier hs-var">eta</span></a></span><span>
</span><span id="line-2320"></span><span>    </span><span id="local-6989586621682579153"><span class="annot"><span class="annottext">eta1 :: Coercion
</span><a href="#local-6989586621682579153"><span class="hs-identifier hs-var hs-var">eta1</span></a></span></span><span>   </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">HasDebugCallStack =&gt; CoSel -&gt; Coercion -&gt; Coercion
CoSel -&gt; Coercion -&gt; Coercion
</span><a href="GHC.Core.Coercion.html#mkSelCo"><span class="hs-identifier hs-var">mkSelCo</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Arity -&gt; Role -&gt; CoSel
</span><a href="GHC.Core.TyCo.Rep.html#SelTyCon"><span class="hs-identifier hs-var">SelTyCon</span></a></span><span> </span><span class="annot"><span class="annottext">Arity
</span><span class="hs-number">2</span></span><span> </span><span class="annot"><span class="annottext">Role
</span><a href="#local-6989586621682579151"><span class="hs-keyword hs-var">role</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Coercion
</span><a href="#local-6989586621682579152"><span class="hs-identifier hs-var">eta'</span></a></span><span>
</span><span id="line-2321"></span><span>    </span><span id="local-6989586621682579154"><span class="annot"><span class="annottext">eta2 :: Coercion
</span><a href="#local-6989586621682579154"><span class="hs-identifier hs-var hs-var">eta2</span></a></span></span><span>   </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">HasDebugCallStack =&gt; CoSel -&gt; Coercion -&gt; Coercion
CoSel -&gt; Coercion -&gt; Coercion
</span><a href="GHC.Core.Coercion.html#mkSelCo"><span class="hs-identifier hs-var">mkSelCo</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Arity -&gt; Role -&gt; CoSel
</span><a href="GHC.Core.TyCo.Rep.html#SelTyCon"><span class="hs-identifier hs-var">SelTyCon</span></a></span><span> </span><span class="annot"><span class="annottext">Arity
</span><span class="hs-number">3</span></span><span> </span><span class="annot"><span class="annottext">Role
</span><a href="#local-6989586621682579151"><span class="hs-keyword hs-var">role</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Coercion
</span><a href="#local-6989586621682579152"><span class="hs-identifier hs-var">eta'</span></a></span><span>
</span><span id="line-2322"></span><span>
</span><span id="line-2323"></span><span>    </span><span id="local-6989586621682579155"><span class="annot"><span class="annottext">co1 :: Coercion
</span><a href="#local-6989586621682579155"><span class="hs-identifier hs-var hs-var">co1</span></a></span></span><span>     </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">CoVar -&gt; Coercion
</span><a href="GHC.Core.Coercion.html#mkCoVarCo"><span class="hs-identifier hs-var">mkCoVarCo</span></a></span><span> </span><span class="annot"><span class="annottext">CoVar
</span><a href="#local-6989586621682579145"><span class="hs-identifier hs-var">new_var</span></a></span><span>
</span><span id="line-2324"></span><span>    </span><span id="local-6989586621682579156"><span class="annot"><span class="annottext">co2 :: Coercion
</span><a href="#local-6989586621682579156"><span class="hs-identifier hs-var hs-var">co2</span></a></span></span><span>     </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Coercion -&gt; Coercion
</span><a href="GHC.Core.Coercion.html#mkSymCo"><span class="hs-identifier hs-var">mkSymCo</span></a></span><span> </span><span class="annot"><span class="annottext">Coercion
</span><a href="#local-6989586621682579153"><span class="hs-identifier hs-var">eta1</span></a></span><span> </span><span class="annot"><span class="annottext">HasDebugCallStack =&gt; Coercion -&gt; Coercion -&gt; Coercion
Coercion -&gt; Coercion -&gt; Coercion
</span><a href="GHC.Core.Coercion.html#mkTransCo"><span class="hs-operator hs-var">`mkTransCo`</span></a></span><span> </span><span class="annot"><span class="annottext">Coercion
</span><a href="#local-6989586621682579155"><span class="hs-identifier hs-var">co1</span></a></span><span> </span><span class="annot"><span class="annottext">HasDebugCallStack =&gt; Coercion -&gt; Coercion -&gt; Coercion
Coercion -&gt; Coercion -&gt; Coercion
</span><a href="GHC.Core.Coercion.html#mkTransCo"><span class="hs-operator hs-var">`mkTransCo`</span></a></span><span> </span><span class="annot"><span class="annottext">Coercion
</span><a href="#local-6989586621682579154"><span class="hs-identifier hs-var">eta2</span></a></span><span>
</span><span id="line-2325"></span><span>    </span><span id="local-6989586621682579157"><span class="annot"><span class="annottext">lifted :: Coercion
</span><a href="#local-6989586621682579157"><span class="hs-identifier hs-var hs-var">lifted</span></a></span></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Role -&gt; Coercion -&gt; Coercion -&gt; Coercion -&gt; Coercion
</span><a href="GHC.Core.Coercion.html#mkProofIrrelCo"><span class="hs-identifier hs-var">mkProofIrrelCo</span></a></span><span> </span><span class="annot"><span class="annottext">Role
</span><a href="Language.Haskell.Syntax.Basic.html#Nominal"><span class="hs-identifier hs-var">Nominal</span></a></span><span> </span><span class="annot"><span class="annottext">Coercion
</span><a href="#local-6989586621682579149"><span class="hs-identifier hs-var">eta</span></a></span><span> </span><span class="annot"><span class="annottext">Coercion
</span><a href="#local-6989586621682579155"><span class="hs-identifier hs-var">co1</span></a></span><span> </span><span class="annot"><span class="annottext">Coercion
</span><a href="#local-6989586621682579156"><span class="hs-identifier hs-var">co2</span></a></span><span>
</span><span id="line-2326"></span><span>
</span><span id="line-2327"></span><span>    </span><span id="local-6989586621682579146"><span class="annot"><span class="annottext">new_cenv :: LiftCoEnv
</span><a href="#local-6989586621682579146"><span class="hs-identifier hs-var hs-var">new_cenv</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">LiftCoEnv -&gt; CoVar -&gt; Coercion -&gt; LiftCoEnv
forall a. VarEnv a -&gt; CoVar -&gt; a -&gt; VarEnv a
</span><a href="GHC.Types.Var.Env.html#extendVarEnv"><span class="hs-identifier hs-var">extendVarEnv</span></a></span><span> </span><span class="annot"><span class="annottext">LiftCoEnv
</span><a href="#local-6989586621682579143"><span class="hs-identifier hs-var">cenv</span></a></span><span> </span><span class="annot"><span class="annottext">CoVar
</span><a href="#local-6989586621682579144"><span class="hs-identifier hs-var">old_var</span></a></span><span> </span><span class="annot"><span class="annottext">Coercion
</span><a href="#local-6989586621682579157"><span class="hs-identifier hs-var">lifted</span></a></span><span>
</span><span id="line-2328"></span><span>
</span><span id="line-2329"></span><span class="annot"><span class="hs-comment">-- | Is a var in the domain of a lifting context?</span></span><span>
</span><span id="line-2330"></span><span class="annot"><a href="GHC.Core.Coercion.html#isMappedByLC"><span class="hs-identifier hs-type">isMappedByLC</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Types.Var.html#TyCoVar"><span class="hs-identifier hs-type">TyCoVar</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Core.Coercion.html#LiftingContext"><span class="hs-identifier hs-type">LiftingContext</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Bool</span></span><span>
</span><span id="line-2331"></span><span id="isMappedByLC"><span class="annot"><span class="annottext">isMappedByLC :: CoVar -&gt; LiftingContext -&gt; Bool
</span><a href="GHC.Core.Coercion.html#isMappedByLC"><span class="hs-identifier hs-var hs-var">isMappedByLC</span></a></span></span><span> </span><span id="local-6989586621682579158"><span class="annot"><span class="annottext">CoVar
</span><a href="#local-6989586621682579158"><span class="hs-identifier hs-var">tv</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Core.Coercion.html#LC"><span class="hs-identifier hs-type">LC</span></a></span><span> </span><span class="annot"><span class="annottext">Subst
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621682579159"><span class="annot"><span class="annottext">LiftCoEnv
</span><a href="#local-6989586621682579159"><span class="hs-identifier hs-var">env</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">CoVar
</span><a href="#local-6989586621682579158"><span class="hs-identifier hs-var">tv</span></a></span><span> </span><span class="annot"><span class="annottext">CoVar -&gt; LiftCoEnv -&gt; Bool
forall a. CoVar -&gt; VarEnv a -&gt; Bool
</span><a href="GHC.Types.Var.Env.html#elemVarEnv"><span class="hs-operator hs-var">`elemVarEnv`</span></a></span><span> </span><span class="annot"><span class="annottext">LiftCoEnv
</span><a href="#local-6989586621682579159"><span class="hs-identifier hs-var">env</span></a></span><span>
</span><span id="line-2332"></span><span>
</span><span id="line-2333"></span><span class="hs-comment">-- If [a |-&gt; g] is in the substitution and g :: t1 ~ t2, substitute a for t1</span><span>
</span><span id="line-2334"></span><span class="hs-comment">-- If [a |-&gt; (g1, g2)] is in the substitution, substitute a for g1</span><span>
</span><span id="line-2335"></span><span class="annot"><a href="GHC.Core.Coercion.html#substLeftCo"><span class="hs-identifier hs-type">substLeftCo</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Core.Coercion.html#LiftingContext"><span class="hs-identifier hs-type">LiftingContext</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#Coercion"><span class="hs-identifier hs-type">Coercion</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#Coercion"><span class="hs-identifier hs-type">Coercion</span></a></span><span>
</span><span id="line-2336"></span><span id="substLeftCo"><span class="annot"><span class="annottext">substLeftCo :: LiftingContext -&gt; Coercion -&gt; Coercion
</span><a href="GHC.Core.Coercion.html#substLeftCo"><span class="hs-identifier hs-var hs-var">substLeftCo</span></a></span></span><span> </span><span id="local-6989586621682579161"><span class="annot"><span class="annottext">LiftingContext
</span><a href="#local-6989586621682579161"><span class="hs-identifier hs-var">lc</span></a></span></span><span> </span><span id="local-6989586621682579162"><span class="annot"><span class="annottext">Coercion
</span><a href="#local-6989586621682579162"><span class="hs-identifier hs-var">co</span></a></span></span><span>
</span><span id="line-2337"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">HasDebugCallStack =&gt; Subst -&gt; Coercion -&gt; Coercion
Subst -&gt; Coercion -&gt; Coercion
</span><a href="GHC.Core.TyCo.Subst.html#substCo"><span class="hs-identifier hs-var">substCo</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">LiftingContext -&gt; Subst
</span><a href="GHC.Core.Coercion.html#lcSubstLeft"><span class="hs-identifier hs-var">lcSubstLeft</span></a></span><span> </span><span class="annot"><span class="annottext">LiftingContext
</span><a href="#local-6989586621682579161"><span class="hs-identifier hs-var">lc</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Coercion
</span><a href="#local-6989586621682579162"><span class="hs-identifier hs-var">co</span></a></span><span>
</span><span id="line-2338"></span><span>
</span><span id="line-2339"></span><span class="hs-comment">-- Ditto, but for t2 and g2</span><span>
</span><span id="line-2340"></span><span class="annot"><a href="GHC.Core.Coercion.html#substRightCo"><span class="hs-identifier hs-type">substRightCo</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Core.Coercion.html#LiftingContext"><span class="hs-identifier hs-type">LiftingContext</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#Coercion"><span class="hs-identifier hs-type">Coercion</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#Coercion"><span class="hs-identifier hs-type">Coercion</span></a></span><span>
</span><span id="line-2341"></span><span id="substRightCo"><span class="annot"><span class="annottext">substRightCo :: LiftingContext -&gt; Coercion -&gt; Coercion
</span><a href="GHC.Core.Coercion.html#substRightCo"><span class="hs-identifier hs-var hs-var">substRightCo</span></a></span></span><span> </span><span id="local-6989586621682579163"><span class="annot"><span class="annottext">LiftingContext
</span><a href="#local-6989586621682579163"><span class="hs-identifier hs-var">lc</span></a></span></span><span> </span><span id="local-6989586621682579164"><span class="annot"><span class="annottext">Coercion
</span><a href="#local-6989586621682579164"><span class="hs-identifier hs-var">co</span></a></span></span><span>
</span><span id="line-2342"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">HasDebugCallStack =&gt; Subst -&gt; Coercion -&gt; Coercion
Subst -&gt; Coercion -&gt; Coercion
</span><a href="GHC.Core.TyCo.Subst.html#substCo"><span class="hs-identifier hs-var">substCo</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">LiftingContext -&gt; Subst
</span><a href="GHC.Core.Coercion.html#lcSubstRight"><span class="hs-identifier hs-var">lcSubstRight</span></a></span><span> </span><span class="annot"><span class="annottext">LiftingContext
</span><a href="#local-6989586621682579163"><span class="hs-identifier hs-var">lc</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Coercion
</span><a href="#local-6989586621682579164"><span class="hs-identifier hs-var">co</span></a></span><span>
</span><span id="line-2343"></span><span>
</span><span id="line-2344"></span><span class="annot"><span class="hs-comment">-- | Apply &quot;sym&quot; to all coercions in a 'LiftCoEnv'</span></span><span>
</span><span id="line-2345"></span><span class="annot"><a href="GHC.Core.Coercion.html#swapLiftCoEnv"><span class="hs-identifier hs-type">swapLiftCoEnv</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Core.Coercion.html#LiftCoEnv"><span class="hs-identifier hs-type">LiftCoEnv</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Core.Coercion.html#LiftCoEnv"><span class="hs-identifier hs-type">LiftCoEnv</span></a></span><span>
</span><span id="line-2346"></span><span id="swapLiftCoEnv"><span class="annot"><span class="annottext">swapLiftCoEnv :: LiftCoEnv -&gt; LiftCoEnv
</span><a href="GHC.Core.Coercion.html#swapLiftCoEnv"><span class="hs-identifier hs-var hs-var">swapLiftCoEnv</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(Coercion -&gt; Coercion) -&gt; LiftCoEnv -&gt; LiftCoEnv
forall a b. (a -&gt; b) -&gt; VarEnv a -&gt; VarEnv b
</span><a href="GHC.Types.Var.Env.html#mapVarEnv"><span class="hs-identifier hs-var">mapVarEnv</span></a></span><span> </span><span class="annot"><span class="annottext">Coercion -&gt; Coercion
</span><a href="GHC.Core.Coercion.html#mkSymCo"><span class="hs-identifier hs-var">mkSymCo</span></a></span><span>
</span><span id="line-2347"></span><span>
</span><span id="line-2348"></span><span class="annot"><a href="GHC.Core.Coercion.html#lcSubstLeft"><span class="hs-identifier hs-type">lcSubstLeft</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Core.Coercion.html#LiftingContext"><span class="hs-identifier hs-type">LiftingContext</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Core.TyCo.Subst.html#Subst"><span class="hs-identifier hs-type">Subst</span></a></span><span>
</span><span id="line-2349"></span><span id="lcSubstLeft"><span class="annot"><span class="annottext">lcSubstLeft :: LiftingContext -&gt; Subst
</span><a href="GHC.Core.Coercion.html#lcSubstLeft"><span class="hs-identifier hs-var hs-var">lcSubstLeft</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Core.Coercion.html#LC"><span class="hs-identifier hs-type">LC</span></a></span><span> </span><span id="local-6989586621682579166"><span class="annot"><span class="annottext">Subst
</span><a href="#local-6989586621682579166"><span class="hs-identifier hs-var">subst</span></a></span></span><span> </span><span id="local-6989586621682579167"><span class="annot"><span class="annottext">LiftCoEnv
</span><a href="#local-6989586621682579167"><span class="hs-identifier hs-var">lc_env</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Subst -&gt; LiftCoEnv -&gt; Subst
</span><a href="GHC.Core.Coercion.html#liftEnvSubstLeft"><span class="hs-identifier hs-var">liftEnvSubstLeft</span></a></span><span> </span><span class="annot"><span class="annottext">Subst
</span><a href="#local-6989586621682579166"><span class="hs-identifier hs-var">subst</span></a></span><span> </span><span class="annot"><span class="annottext">LiftCoEnv
</span><a href="#local-6989586621682579167"><span class="hs-identifier hs-var">lc_env</span></a></span><span>
</span><span id="line-2350"></span><span>
</span><span id="line-2351"></span><span class="annot"><a href="GHC.Core.Coercion.html#lcSubstRight"><span class="hs-identifier hs-type">lcSubstRight</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Core.Coercion.html#LiftingContext"><span class="hs-identifier hs-type">LiftingContext</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Core.TyCo.Subst.html#Subst"><span class="hs-identifier hs-type">Subst</span></a></span><span>
</span><span id="line-2352"></span><span id="lcSubstRight"><span class="annot"><span class="annottext">lcSubstRight :: LiftingContext -&gt; Subst
</span><a href="GHC.Core.Coercion.html#lcSubstRight"><span class="hs-identifier hs-var hs-var">lcSubstRight</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Core.Coercion.html#LC"><span class="hs-identifier hs-type">LC</span></a></span><span> </span><span id="local-6989586621682579168"><span class="annot"><span class="annottext">Subst
</span><a href="#local-6989586621682579168"><span class="hs-identifier hs-var">subst</span></a></span></span><span> </span><span id="local-6989586621682579169"><span class="annot"><span class="annottext">LiftCoEnv
</span><a href="#local-6989586621682579169"><span class="hs-identifier hs-var">lc_env</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Subst -&gt; LiftCoEnv -&gt; Subst
</span><a href="GHC.Core.Coercion.html#liftEnvSubstRight"><span class="hs-identifier hs-var">liftEnvSubstRight</span></a></span><span> </span><span class="annot"><span class="annottext">Subst
</span><a href="#local-6989586621682579168"><span class="hs-identifier hs-var">subst</span></a></span><span> </span><span class="annot"><span class="annottext">LiftCoEnv
</span><a href="#local-6989586621682579169"><span class="hs-identifier hs-var">lc_env</span></a></span><span>
</span><span id="line-2353"></span><span>
</span><span id="line-2354"></span><span class="annot"><a href="GHC.Core.Coercion.html#liftEnvSubstLeft"><span class="hs-identifier hs-type">liftEnvSubstLeft</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Core.TyCo.Subst.html#Subst"><span class="hs-identifier hs-type">Subst</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Core.Coercion.html#LiftCoEnv"><span class="hs-identifier hs-type">LiftCoEnv</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Core.TyCo.Subst.html#Subst"><span class="hs-identifier hs-type">Subst</span></a></span><span>
</span><span id="line-2355"></span><span id="liftEnvSubstLeft"><span class="annot"><span class="annottext">liftEnvSubstLeft :: Subst -&gt; LiftCoEnv -&gt; Subst
</span><a href="GHC.Core.Coercion.html#liftEnvSubstLeft"><span class="hs-identifier hs-var hs-var">liftEnvSubstLeft</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(forall a. Pair a -&gt; a) -&gt; Subst -&gt; LiftCoEnv -&gt; Subst
</span><a href="GHC.Core.Coercion.html#liftEnvSubst"><span class="hs-identifier hs-var">liftEnvSubst</span></a></span><span> </span><span class="annot"><span class="annottext">Pair a -&gt; a
forall a. Pair a -&gt; a
</span><a href="GHC.Data.Pair.html#pFst"><span class="hs-identifier hs-var">pFst</span></a></span><span>
</span><span id="line-2356"></span><span>
</span><span id="line-2357"></span><span class="annot"><a href="GHC.Core.Coercion.html#liftEnvSubstRight"><span class="hs-identifier hs-type">liftEnvSubstRight</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Core.TyCo.Subst.html#Subst"><span class="hs-identifier hs-type">Subst</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Core.Coercion.html#LiftCoEnv"><span class="hs-identifier hs-type">LiftCoEnv</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Core.TyCo.Subst.html#Subst"><span class="hs-identifier hs-type">Subst</span></a></span><span>
</span><span id="line-2358"></span><span id="liftEnvSubstRight"><span class="annot"><span class="annottext">liftEnvSubstRight :: Subst -&gt; LiftCoEnv -&gt; Subst
</span><a href="GHC.Core.Coercion.html#liftEnvSubstRight"><span class="hs-identifier hs-var hs-var">liftEnvSubstRight</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(forall a. Pair a -&gt; a) -&gt; Subst -&gt; LiftCoEnv -&gt; Subst
</span><a href="GHC.Core.Coercion.html#liftEnvSubst"><span class="hs-identifier hs-var">liftEnvSubst</span></a></span><span> </span><span class="annot"><span class="annottext">Pair a -&gt; a
forall a. Pair a -&gt; a
</span><a href="GHC.Data.Pair.html#pSnd"><span class="hs-identifier hs-var">pSnd</span></a></span><span>
</span><span id="line-2359"></span><span>
</span><span id="line-2360"></span><span class="annot"><a href="GHC.Core.Coercion.html#liftEnvSubst"><span class="hs-identifier hs-type">liftEnvSubst</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="hs-keyword">forall</span><span> </span><span id="local-6989586621682577381"><span class="annot"><a href="#local-6989586621682577381"><span class="hs-identifier hs-type">a</span></a></span></span><span class="hs-operator">.</span><span> </span><span class="annot"><a href="GHC.Data.Pair.html#Pair"><span class="hs-identifier hs-type">Pair</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682577381"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621682577381"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Core.TyCo.Subst.html#Subst"><span class="hs-identifier hs-type">Subst</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Core.Coercion.html#LiftCoEnv"><span class="hs-identifier hs-type">LiftCoEnv</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Core.TyCo.Subst.html#Subst"><span class="hs-identifier hs-type">Subst</span></a></span><span>
</span><span id="line-2361"></span><span id="liftEnvSubst"><span class="annot"><span class="annottext">liftEnvSubst :: (forall a. Pair a -&gt; a) -&gt; Subst -&gt; LiftCoEnv -&gt; Subst
</span><a href="GHC.Core.Coercion.html#liftEnvSubst"><span class="hs-identifier hs-var hs-var">liftEnvSubst</span></a></span></span><span> </span><span id="local-6989586621682579173"><span class="annot"><span class="annottext">forall a. Pair a -&gt; a
</span><a href="#local-6989586621682579173"><span class="hs-identifier hs-var">selector</span></a></span></span><span> </span><span id="local-6989586621682579174"><span class="annot"><span class="annottext">Subst
</span><a href="#local-6989586621682579174"><span class="hs-identifier hs-var">subst</span></a></span></span><span> </span><span id="local-6989586621682579175"><span class="annot"><span class="annottext">LiftCoEnv
</span><a href="#local-6989586621682579175"><span class="hs-identifier hs-var">lc_env</span></a></span></span><span>
</span><span id="line-2362"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Subst -&gt; Subst -&gt; Subst
</span><a href="GHC.Core.TyCo.Subst.html#composeTCvSubst"><span class="hs-identifier hs-var">composeTCvSubst</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">InScopeSet -&gt; IdSubstEnv -&gt; TvSubstEnv -&gt; LiftCoEnv -&gt; Subst
</span><a href="GHC.Core.TyCo.Subst.html#Subst"><span class="hs-identifier hs-var">Subst</span></a></span><span> </span><span class="annot"><span class="annottext">InScopeSet
</span><a href="#local-6989586621682579178"><span class="hs-identifier hs-var">in_scope</span></a></span><span> </span><span class="annot"><span class="annottext">IdSubstEnv
</span><a href="GHC.Core.TyCo.Subst.html#emptyIdSubstEnv"><span class="hs-identifier hs-var">emptyIdSubstEnv</span></a></span><span> </span><span class="annot"><span class="annottext">TvSubstEnv
</span><a href="#local-6989586621682579180"><span class="hs-identifier hs-var">tenv</span></a></span><span> </span><span class="annot"><span class="annottext">LiftCoEnv
</span><a href="#local-6989586621682579181"><span class="hs-identifier hs-var">cenv</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Subst
</span><a href="#local-6989586621682579174"><span class="hs-identifier hs-var">subst</span></a></span><span>
</span><span id="line-2363"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-2364"></span><span>    </span><span id="local-6989586621682579182"><span class="annot"><span class="annottext">pairs :: [(Unique, Coercion)]
</span><a href="#local-6989586621682579182"><span class="hs-identifier hs-var hs-var">pairs</span></a></span></span><span>            </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">LiftCoEnv -&gt; [(Unique, Coercion)]
forall {k} (key :: k) elt. UniqFM key elt -&gt; [(Unique, elt)]
</span><a href="GHC.Types.Unique.FM.html#nonDetUFMToList"><span class="hs-identifier hs-var">nonDetUFMToList</span></a></span><span> </span><span class="annot"><span class="annottext">LiftCoEnv
</span><a href="#local-6989586621682579175"><span class="hs-identifier hs-var">lc_env</span></a></span><span>
</span><span id="line-2365"></span><span>                       </span><span class="hs-comment">-- It's OK to use nonDetUFMToList here because we</span><span>
</span><span id="line-2366"></span><span>                       </span><span class="hs-comment">-- immediately forget the ordering by creating</span><span>
</span><span id="line-2367"></span><span>                       </span><span class="hs-comment">-- a VarEnv</span><span>
</span><span id="line-2368"></span><span>    </span><span class="hs-special">(</span><span id="local-6989586621682579184"><span class="annot"><span class="annottext">[(Unique, Type)]
</span><a href="#local-6989586621682579184"><span class="hs-identifier hs-var">tpairs</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682579185"><span class="annot"><span class="annottext">[(Unique, Coercion)]
</span><a href="#local-6989586621682579185"><span class="hs-identifier hs-var">cpairs</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">((Unique, Coercion) -&gt; Either (Unique, Type) (Unique, Coercion))
-&gt; [(Unique, Coercion)] -&gt; ([(Unique, Type)], [(Unique, Coercion)])
forall a b c. (a -&gt; Either b c) -&gt; [a] -&gt; ([b], [c])
</span><a href="GHC.Utils.Misc.html#partitionWith"><span class="hs-identifier hs-var">partitionWith</span></a></span><span> </span><span class="annot"><span class="annottext">(Unique, Coercion) -&gt; Either (Unique, Type) (Unique, Coercion)
</span><a href="#local-6989586621682579187"><span class="hs-identifier hs-var">ty_or_co</span></a></span><span> </span><span class="annot"><span class="annottext">[(Unique, Coercion)]
</span><a href="#local-6989586621682579182"><span class="hs-identifier hs-var">pairs</span></a></span><span>
</span><span id="line-2369"></span><span>    </span><span class="hs-comment">-- Make sure the in-scope set is wide enough to cover the range of the</span><span>
</span><span id="line-2370"></span><span>    </span><span class="hs-comment">-- substitution (#22235).</span><span>
</span><span id="line-2371"></span><span>    </span><span id="local-6989586621682579178"><span class="annot"><span class="annottext">in_scope :: InScopeSet
</span><a href="#local-6989586621682579178"><span class="hs-identifier hs-var hs-var">in_scope</span></a></span></span><span>         </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">VarSet -&gt; InScopeSet
</span><a href="GHC.Types.Var.Env.html#mkInScopeSet"><span class="hs-identifier hs-var">mkInScopeSet</span></a></span><span> </span><span class="annot"><span class="annottext">(VarSet -&gt; InScopeSet) -&gt; VarSet -&gt; InScopeSet
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-2372"></span><span>                       </span><span class="annot"><span class="annottext">[Type] -&gt; VarSet
</span><a href="GHC.Core.TyCo.FVs.html#tyCoVarsOfTypes"><span class="hs-identifier hs-var">tyCoVarsOfTypes</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">((Unique, Type) -&gt; Type) -&gt; [(Unique, Type)] -&gt; [Type]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><span class="hs-identifier hs-var">map</span></span><span> </span><span class="annot"><span class="annottext">(Unique, Type) -&gt; Type
forall a b. (a, b) -&gt; b
</span><span class="hs-identifier hs-var">snd</span></span><span> </span><span class="annot"><span class="annottext">[(Unique, Type)]
</span><a href="#local-6989586621682579184"><span class="hs-identifier hs-var">tpairs</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">VarSet -&gt; VarSet -&gt; VarSet
</span><a href="GHC.Types.Var.Set.html#unionVarSet"><span class="hs-operator hs-var">`unionVarSet`</span></a></span><span>
</span><span id="line-2373"></span><span>                       </span><span class="annot"><span class="annottext">[Coercion] -&gt; VarSet
</span><a href="GHC.Core.TyCo.FVs.html#tyCoVarsOfCos"><span class="hs-identifier hs-var">tyCoVarsOfCos</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">((Unique, Coercion) -&gt; Coercion)
-&gt; [(Unique, Coercion)] -&gt; [Coercion]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><span class="hs-identifier hs-var">map</span></span><span> </span><span class="annot"><span class="annottext">(Unique, Coercion) -&gt; Coercion
forall a b. (a, b) -&gt; b
</span><span class="hs-identifier hs-var">snd</span></span><span> </span><span class="annot"><span class="annottext">[(Unique, Coercion)]
</span><a href="#local-6989586621682579185"><span class="hs-identifier hs-var">cpairs</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-2374"></span><span>    </span><span id="local-6989586621682579180"><span class="annot"><span class="annottext">tenv :: TvSubstEnv
</span><a href="#local-6989586621682579180"><span class="hs-identifier hs-var hs-var">tenv</span></a></span></span><span>             </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[(Unique, Type)] -&gt; TvSubstEnv
forall a. [(Unique, a)] -&gt; VarEnv a
</span><a href="GHC.Types.Var.Env.html#mkVarEnv_Directly"><span class="hs-identifier hs-var">mkVarEnv_Directly</span></a></span><span> </span><span class="annot"><span class="annottext">[(Unique, Type)]
</span><a href="#local-6989586621682579184"><span class="hs-identifier hs-var">tpairs</span></a></span><span>
</span><span id="line-2375"></span><span>    </span><span id="local-6989586621682579181"><span class="annot"><span class="annottext">cenv :: LiftCoEnv
</span><a href="#local-6989586621682579181"><span class="hs-identifier hs-var hs-var">cenv</span></a></span></span><span>             </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[(Unique, Coercion)] -&gt; LiftCoEnv
forall a. [(Unique, a)] -&gt; VarEnv a
</span><a href="GHC.Types.Var.Env.html#mkVarEnv_Directly"><span class="hs-identifier hs-var">mkVarEnv_Directly</span></a></span><span> </span><span class="annot"><span class="annottext">[(Unique, Coercion)]
</span><a href="#local-6989586621682579185"><span class="hs-identifier hs-var">cpairs</span></a></span><span>
</span><span id="line-2376"></span><span>
</span><span id="line-2377"></span><span>    </span><span class="annot"><a href="#local-6989586621682579187"><span class="hs-identifier hs-type">ty_or_co</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Types.Unique.html#Unique"><span class="hs-identifier hs-type">Unique</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#Coercion"><span class="hs-identifier hs-type">Coercion</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Either</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Types.Unique.html#Unique"><span class="hs-identifier hs-type">Unique</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#Type"><span class="hs-identifier hs-type">Type</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Types.Unique.html#Unique"><span class="hs-identifier hs-type">Unique</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#Coercion"><span class="hs-identifier hs-type">Coercion</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-2378"></span><span>    </span><span id="local-6989586621682579187"><span class="annot"><span class="annottext">ty_or_co :: (Unique, Coercion) -&gt; Either (Unique, Type) (Unique, Coercion)
</span><a href="#local-6989586621682579187"><span class="hs-identifier hs-var hs-var">ty_or_co</span></a></span></span><span> </span><span class="hs-special">(</span><span id="local-6989586621682579189"><span class="annot"><span class="annottext">Unique
</span><a href="#local-6989586621682579189"><span class="hs-identifier hs-var">u</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682579190"><span class="annot"><span class="annottext">Coercion
</span><a href="#local-6989586621682579190"><span class="hs-identifier hs-var">co</span></a></span></span><span class="hs-special">)</span><span>
</span><span id="line-2379"></span><span>      </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span id="local-6989586621682579191"><span class="annot"><span class="annottext">Coercion
</span><a href="#local-6989586621682579191"><span class="hs-identifier hs-var">equality_co</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Type -&gt; Maybe Coercion
</span><a href="GHC.Core.Type.html#isCoercionTy_maybe"><span class="hs-identifier hs-var">isCoercionTy_maybe</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682579193"><span class="hs-identifier hs-var">equality_ty</span></a></span><span>
</span><span id="line-2380"></span><span>      </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(Unique, Coercion) -&gt; Either (Unique, Type) (Unique, Coercion)
forall a b. b -&gt; Either a b
</span><span class="hs-identifier hs-var">Right</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Unique
</span><a href="#local-6989586621682579189"><span class="hs-identifier hs-var">u</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Coercion
</span><a href="#local-6989586621682579191"><span class="hs-identifier hs-var">equality_co</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-2381"></span><span>      </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">otherwise</span></span><span>
</span><span id="line-2382"></span><span>      </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(Unique, Type) -&gt; Either (Unique, Type) (Unique, Coercion)
forall a b. a -&gt; Either a b
</span><span class="hs-identifier hs-var">Left</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Unique
</span><a href="#local-6989586621682579189"><span class="hs-identifier hs-var">u</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682579193"><span class="hs-identifier hs-var">equality_ty</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-2383"></span><span>      </span><span class="hs-keyword">where</span><span>
</span><span id="line-2384"></span><span>        </span><span id="local-6989586621682579193"><span class="annot"><span class="annottext">equality_ty :: Type
</span><a href="#local-6989586621682579193"><span class="hs-identifier hs-var hs-var">equality_ty</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Pair Type -&gt; Type
forall a. Pair a -&gt; a
</span><a href="#local-6989586621682579173"><span class="hs-identifier hs-var">selector</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">HasDebugCallStack =&gt; Coercion -&gt; Pair Type
Coercion -&gt; Pair Type
</span><a href="GHC.Core.Coercion.html#coercionKind"><span class="hs-identifier hs-var">coercionKind</span></a></span><span> </span><span class="annot"><span class="annottext">Coercion
</span><a href="#local-6989586621682579190"><span class="hs-identifier hs-var">co</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-2385"></span><span>
</span><span id="line-2386"></span><span class="annot"><span class="hs-comment">-- | Lookup a 'CoVar' in the substitution in a 'LiftingContext'</span></span><span>
</span><span id="line-2387"></span><span class="annot"><a href="GHC.Core.Coercion.html#lcLookupCoVar"><span class="hs-identifier hs-type">lcLookupCoVar</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Core.Coercion.html#LiftingContext"><span class="hs-identifier hs-type">LiftingContext</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Types.Var.html#CoVar"><span class="hs-identifier hs-type">CoVar</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Maybe</span></span><span> </span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#Coercion"><span class="hs-identifier hs-type">Coercion</span></a></span><span>
</span><span id="line-2388"></span><span id="lcLookupCoVar"><span class="annot"><span class="annottext">lcLookupCoVar :: LiftingContext -&gt; CoVar -&gt; Maybe Coercion
</span><a href="GHC.Core.Coercion.html#lcLookupCoVar"><span class="hs-identifier hs-var hs-var">lcLookupCoVar</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Core.Coercion.html#LC"><span class="hs-identifier hs-type">LC</span></a></span><span> </span><span id="local-6989586621682579194"><span class="annot"><span class="annottext">Subst
</span><a href="#local-6989586621682579194"><span class="hs-identifier hs-var">subst</span></a></span></span><span> </span><span class="annot"><span class="annottext">LiftCoEnv
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span> </span><span id="local-6989586621682579195"><span class="annot"><span class="annottext">CoVar
</span><a href="#local-6989586621682579195"><span class="hs-identifier hs-var">cv</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Subst -&gt; CoVar -&gt; Maybe Coercion
</span><a href="GHC.Core.TyCo.Subst.html#lookupCoVar"><span class="hs-identifier hs-var">lookupCoVar</span></a></span><span> </span><span class="annot"><span class="annottext">Subst
</span><a href="#local-6989586621682579194"><span class="hs-identifier hs-var">subst</span></a></span><span> </span><span class="annot"><span class="annottext">CoVar
</span><a href="#local-6989586621682579195"><span class="hs-identifier hs-var">cv</span></a></span><span>
</span><span id="line-2389"></span><span>
</span><span id="line-2390"></span><span class="annot"><span class="hs-comment">-- | Get the 'InScopeSet' from a 'LiftingContext'</span></span><span>
</span><span id="line-2391"></span><span class="annot"><a href="GHC.Core.Coercion.html#lcInScopeSet"><span class="hs-identifier hs-type">lcInScopeSet</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Core.Coercion.html#LiftingContext"><span class="hs-identifier hs-type">LiftingContext</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Types.Var.Env.html#InScopeSet"><span class="hs-identifier hs-type">InScopeSet</span></a></span><span>
</span><span id="line-2392"></span><span id="lcInScopeSet"><span class="annot"><span class="annottext">lcInScopeSet :: LiftingContext -&gt; InScopeSet
</span><a href="GHC.Core.Coercion.html#lcInScopeSet"><span class="hs-identifier hs-var hs-var">lcInScopeSet</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Core.Coercion.html#LC"><span class="hs-identifier hs-type">LC</span></a></span><span> </span><span id="local-6989586621682579196"><span class="annot"><span class="annottext">Subst
</span><a href="#local-6989586621682579196"><span class="hs-identifier hs-var">subst</span></a></span></span><span> </span><span class="annot"><span class="annottext">LiftCoEnv
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Subst -&gt; InScopeSet
</span><a href="GHC.Core.TyCo.Subst.html#getSubstInScope"><span class="hs-identifier hs-var">getSubstInScope</span></a></span><span> </span><span class="annot"><span class="annottext">Subst
</span><a href="#local-6989586621682579196"><span class="hs-identifier hs-var">subst</span></a></span><span>
</span><span id="line-2393"></span><span>
</span><span id="line-2394"></span><span class="hs-comment">{-
%************************************************************************
%*                                                                      *
            Sequencing on coercions
%*                                                                      *
%************************************************************************
-}</span><span>
</span><span id="line-2401"></span><span>
</span><span id="line-2402"></span><span class="annot"><a href="GHC.Core.Coercion.html#seqMCo"><span class="hs-identifier hs-type">seqMCo</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#MCoercion"><span class="hs-identifier hs-type">MCoercion</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-2403"></span><span id="seqMCo"><span class="annot"><span class="annottext">seqMCo :: MCoercion -&gt; ()
</span><a href="GHC.Core.Coercion.html#seqMCo"><span class="hs-identifier hs-var hs-var">seqMCo</span></a></span></span><span> </span><span class="annot"><span class="annottext">MCoercion
</span><a href="GHC.Core.TyCo.Rep.html#MRefl"><span class="hs-identifier hs-var">MRefl</span></a></span><span>    </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-2404"></span><span class="annot"><a href="GHC.Core.Coercion.html#seqMCo"><span class="hs-identifier hs-var">seqMCo</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#MCo"><span class="hs-identifier hs-type">MCo</span></a></span><span> </span><span id="local-6989586621682579198"><span class="annot"><span class="annottext">Coercion
</span><a href="#local-6989586621682579198"><span class="hs-identifier hs-var">co</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Coercion -&gt; ()
</span><a href="GHC.Core.Coercion.html#seqCo"><span class="hs-identifier hs-var">seqCo</span></a></span><span> </span><span class="annot"><span class="annottext">Coercion
</span><a href="#local-6989586621682579198"><span class="hs-identifier hs-var">co</span></a></span><span>
</span><span id="line-2405"></span><span>
</span><span id="line-2406"></span><span class="annot"><a href="GHC.Core.Coercion.html#seqCo"><span class="hs-identifier hs-type">seqCo</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#Coercion"><span class="hs-identifier hs-type">Coercion</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-2407"></span><span id="seqCo"><span class="annot"><span class="annottext">seqCo :: Coercion -&gt; ()
</span><a href="GHC.Core.Coercion.html#seqCo"><span class="hs-identifier hs-var hs-var">seqCo</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#Refl"><span class="hs-identifier hs-type">Refl</span></a></span><span> </span><span id="local-6989586621682579199"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682579199"><span class="hs-identifier hs-var">ty</span></a></span></span><span class="hs-special">)</span><span>             </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Type -&gt; ()
</span><a href="GHC.Core.Type.html#seqType"><span class="hs-identifier hs-var">seqType</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682579199"><span class="hs-identifier hs-var">ty</span></a></span><span>
</span><span id="line-2408"></span><span class="annot"><a href="GHC.Core.Coercion.html#seqCo"><span class="hs-identifier hs-var">seqCo</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#GRefl"><span class="hs-identifier hs-type">GRefl</span></a></span><span> </span><span id="local-6989586621682579201"><span class="annot"><span class="annottext">Role
</span><a href="#local-6989586621682579201"><span class="hs-identifier hs-var">r</span></a></span></span><span> </span><span id="local-6989586621682579202"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682579202"><span class="hs-identifier hs-var">ty</span></a></span></span><span> </span><span id="local-6989586621682579203"><span class="annot"><span class="annottext">MCoercion
</span><a href="#local-6989586621682579203"><span class="hs-identifier hs-var">mco</span></a></span></span><span class="hs-special">)</span><span>      </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Role
</span><a href="#local-6989586621682579201"><span class="hs-identifier hs-var">r</span></a></span><span> </span><span class="annot"><span class="annottext">Role -&gt; () -&gt; ()
forall a b. a -&gt; b -&gt; b
</span><span class="hs-operator hs-var">`seq`</span></span><span> </span><span class="annot"><span class="annottext">Type -&gt; ()
</span><a href="GHC.Core.Type.html#seqType"><span class="hs-identifier hs-var">seqType</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682579202"><span class="hs-identifier hs-var">ty</span></a></span><span> </span><span class="annot"><span class="annottext">() -&gt; () -&gt; ()
forall a b. a -&gt; b -&gt; b
</span><span class="hs-operator hs-var">`seq`</span></span><span> </span><span class="annot"><span class="annottext">MCoercion -&gt; ()
</span><a href="GHC.Core.Coercion.html#seqMCo"><span class="hs-identifier hs-var">seqMCo</span></a></span><span> </span><span class="annot"><span class="annottext">MCoercion
</span><a href="#local-6989586621682579203"><span class="hs-identifier hs-var">mco</span></a></span><span>
</span><span id="line-2409"></span><span class="annot"><a href="GHC.Core.Coercion.html#seqCo"><span class="hs-identifier hs-var">seqCo</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#TyConAppCo"><span class="hs-identifier hs-type">TyConAppCo</span></a></span><span> </span><span id="local-6989586621682579204"><span class="annot"><span class="annottext">Role
</span><a href="#local-6989586621682579204"><span class="hs-identifier hs-var">r</span></a></span></span><span> </span><span id="local-6989586621682579205"><span class="annot"><span class="annottext">TyCon
</span><a href="#local-6989586621682579205"><span class="hs-identifier hs-var">tc</span></a></span></span><span> </span><span id="local-6989586621682579206"><span class="annot"><span class="annottext">[Coercion]
</span><a href="#local-6989586621682579206"><span class="hs-identifier hs-var">cos</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Role
</span><a href="#local-6989586621682579204"><span class="hs-identifier hs-var">r</span></a></span><span> </span><span class="annot"><span class="annottext">Role -&gt; () -&gt; ()
forall a b. a -&gt; b -&gt; b
</span><span class="hs-operator hs-var">`seq`</span></span><span> </span><span class="annot"><span class="annottext">TyCon
</span><a href="#local-6989586621682579205"><span class="hs-identifier hs-var">tc</span></a></span><span> </span><span class="annot"><span class="annottext">TyCon -&gt; () -&gt; ()
forall a b. a -&gt; b -&gt; b
</span><span class="hs-operator hs-var">`seq`</span></span><span> </span><span class="annot"><span class="annottext">[Coercion] -&gt; ()
</span><a href="GHC.Core.Coercion.html#seqCos"><span class="hs-identifier hs-var">seqCos</span></a></span><span> </span><span class="annot"><span class="annottext">[Coercion]
</span><a href="#local-6989586621682579206"><span class="hs-identifier hs-var">cos</span></a></span><span>
</span><span id="line-2410"></span><span class="annot"><a href="GHC.Core.Coercion.html#seqCo"><span class="hs-identifier hs-var">seqCo</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#AppCo"><span class="hs-identifier hs-type">AppCo</span></a></span><span> </span><span id="local-6989586621682579208"><span class="annot"><span class="annottext">Coercion
</span><a href="#local-6989586621682579208"><span class="hs-identifier hs-var">co1</span></a></span></span><span> </span><span id="local-6989586621682579209"><span class="annot"><span class="annottext">Coercion
</span><a href="#local-6989586621682579209"><span class="hs-identifier hs-var">co2</span></a></span></span><span class="hs-special">)</span><span>       </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Coercion -&gt; ()
</span><a href="GHC.Core.Coercion.html#seqCo"><span class="hs-identifier hs-var">seqCo</span></a></span><span> </span><span class="annot"><span class="annottext">Coercion
</span><a href="#local-6989586621682579208"><span class="hs-identifier hs-var">co1</span></a></span><span> </span><span class="annot"><span class="annottext">() -&gt; () -&gt; ()
forall a b. a -&gt; b -&gt; b
</span><span class="hs-operator hs-var">`seq`</span></span><span> </span><span class="annot"><span class="annottext">Coercion -&gt; ()
</span><a href="GHC.Core.Coercion.html#seqCo"><span class="hs-identifier hs-var">seqCo</span></a></span><span> </span><span class="annot"><span class="annottext">Coercion
</span><a href="#local-6989586621682579209"><span class="hs-identifier hs-var">co2</span></a></span><span>
</span><span id="line-2411"></span><span class="annot"><a href="GHC.Core.Coercion.html#seqCo"><span class="hs-identifier hs-var">seqCo</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#CoVarCo"><span class="hs-identifier hs-type">CoVarCo</span></a></span><span> </span><span id="local-6989586621682579210"><span class="annot"><span class="annottext">CoVar
</span><a href="#local-6989586621682579210"><span class="hs-identifier hs-var">cv</span></a></span></span><span class="hs-special">)</span><span>          </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">CoVar
</span><a href="#local-6989586621682579210"><span class="hs-identifier hs-var">cv</span></a></span><span> </span><span class="annot"><span class="annottext">CoVar -&gt; () -&gt; ()
forall a b. a -&gt; b -&gt; b
</span><span class="hs-operator hs-var">`seq`</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-2412"></span><span class="annot"><a href="GHC.Core.Coercion.html#seqCo"><span class="hs-identifier hs-var">seqCo</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#HoleCo"><span class="hs-identifier hs-type">HoleCo</span></a></span><span> </span><span id="local-6989586621682579211"><span class="annot"><span class="annottext">CoercionHole
</span><a href="#local-6989586621682579211"><span class="hs-identifier hs-var">h</span></a></span></span><span class="hs-special">)</span><span>            </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">CoercionHole -&gt; CoVar
</span><a href="GHC.Core.TyCo.Rep.html#coHoleCoVar"><span class="hs-identifier hs-var">coHoleCoVar</span></a></span><span> </span><span class="annot"><span class="annottext">CoercionHole
</span><a href="#local-6989586621682579211"><span class="hs-identifier hs-var">h</span></a></span><span> </span><span class="annot"><span class="annottext">CoVar -&gt; () -&gt; ()
forall a b. a -&gt; b -&gt; b
</span><span class="hs-operator hs-var">`seq`</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-2413"></span><span class="annot"><a href="GHC.Core.Coercion.html#seqCo"><span class="hs-identifier hs-var">seqCo</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#SymCo"><span class="hs-identifier hs-type">SymCo</span></a></span><span> </span><span id="local-6989586621682579212"><span class="annot"><span class="annottext">Coercion
</span><a href="#local-6989586621682579212"><span class="hs-identifier hs-var">co</span></a></span></span><span class="hs-special">)</span><span>            </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Coercion -&gt; ()
</span><a href="GHC.Core.Coercion.html#seqCo"><span class="hs-identifier hs-var">seqCo</span></a></span><span> </span><span class="annot"><span class="annottext">Coercion
</span><a href="#local-6989586621682579212"><span class="hs-identifier hs-var">co</span></a></span><span>
</span><span id="line-2414"></span><span class="annot"><a href="GHC.Core.Coercion.html#seqCo"><span class="hs-identifier hs-var">seqCo</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#TransCo"><span class="hs-identifier hs-type">TransCo</span></a></span><span> </span><span id="local-6989586621682579213"><span class="annot"><span class="annottext">Coercion
</span><a href="#local-6989586621682579213"><span class="hs-identifier hs-var">co1</span></a></span></span><span> </span><span id="local-6989586621682579214"><span class="annot"><span class="annottext">Coercion
</span><a href="#local-6989586621682579214"><span class="hs-identifier hs-var">co2</span></a></span></span><span class="hs-special">)</span><span>     </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Coercion -&gt; ()
</span><a href="GHC.Core.Coercion.html#seqCo"><span class="hs-identifier hs-var">seqCo</span></a></span><span> </span><span class="annot"><span class="annottext">Coercion
</span><a href="#local-6989586621682579213"><span class="hs-identifier hs-var">co1</span></a></span><span> </span><span class="annot"><span class="annottext">() -&gt; () -&gt; ()
forall a b. a -&gt; b -&gt; b
</span><span class="hs-operator hs-var">`seq`</span></span><span> </span><span class="annot"><span class="annottext">Coercion -&gt; ()
</span><a href="GHC.Core.Coercion.html#seqCo"><span class="hs-identifier hs-var">seqCo</span></a></span><span> </span><span class="annot"><span class="annottext">Coercion
</span><a href="#local-6989586621682579214"><span class="hs-identifier hs-var">co2</span></a></span><span>
</span><span id="line-2415"></span><span class="annot"><a href="GHC.Core.Coercion.html#seqCo"><span class="hs-identifier hs-var">seqCo</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#SelCo"><span class="hs-identifier hs-type">SelCo</span></a></span><span> </span><span id="local-6989586621682579215"><span class="annot"><span class="annottext">CoSel
</span><a href="#local-6989586621682579215"><span class="hs-identifier hs-var">n</span></a></span></span><span> </span><span id="local-6989586621682579216"><span class="annot"><span class="annottext">Coercion
</span><a href="#local-6989586621682579216"><span class="hs-identifier hs-var">co</span></a></span></span><span class="hs-special">)</span><span>          </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">CoSel
</span><a href="#local-6989586621682579215"><span class="hs-identifier hs-var">n</span></a></span><span> </span><span class="annot"><span class="annottext">CoSel -&gt; () -&gt; ()
forall a b. a -&gt; b -&gt; b
</span><span class="hs-operator hs-var">`seq`</span></span><span> </span><span class="annot"><span class="annottext">Coercion -&gt; ()
</span><a href="GHC.Core.Coercion.html#seqCo"><span class="hs-identifier hs-var">seqCo</span></a></span><span> </span><span class="annot"><span class="annottext">Coercion
</span><a href="#local-6989586621682579216"><span class="hs-identifier hs-var">co</span></a></span><span>
</span><span id="line-2416"></span><span class="annot"><a href="GHC.Core.Coercion.html#seqCo"><span class="hs-identifier hs-var">seqCo</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#LRCo"><span class="hs-identifier hs-type">LRCo</span></a></span><span> </span><span id="local-6989586621682579217"><span class="annot"><span class="annottext">LeftOrRight
</span><a href="#local-6989586621682579217"><span class="hs-identifier hs-var">lr</span></a></span></span><span> </span><span id="local-6989586621682579218"><span class="annot"><span class="annottext">Coercion
</span><a href="#local-6989586621682579218"><span class="hs-identifier hs-var">co</span></a></span></span><span class="hs-special">)</span><span>          </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">LeftOrRight
</span><a href="#local-6989586621682579217"><span class="hs-identifier hs-var">lr</span></a></span><span> </span><span class="annot"><span class="annottext">LeftOrRight -&gt; () -&gt; ()
forall a b. a -&gt; b -&gt; b
</span><span class="hs-operator hs-var">`seq`</span></span><span> </span><span class="annot"><span class="annottext">Coercion -&gt; ()
</span><a href="GHC.Core.Coercion.html#seqCo"><span class="hs-identifier hs-var">seqCo</span></a></span><span> </span><span class="annot"><span class="annottext">Coercion
</span><a href="#local-6989586621682579218"><span class="hs-identifier hs-var">co</span></a></span><span>
</span><span id="line-2417"></span><span class="annot"><a href="GHC.Core.Coercion.html#seqCo"><span class="hs-identifier hs-var">seqCo</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#InstCo"><span class="hs-identifier hs-type">InstCo</span></a></span><span> </span><span id="local-6989586621682579219"><span class="annot"><span class="annottext">Coercion
</span><a href="#local-6989586621682579219"><span class="hs-identifier hs-var">co</span></a></span></span><span> </span><span id="local-6989586621682579220"><span class="annot"><span class="annottext">Coercion
</span><a href="#local-6989586621682579220"><span class="hs-identifier hs-var">arg</span></a></span></span><span class="hs-special">)</span><span>       </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Coercion -&gt; ()
</span><a href="GHC.Core.Coercion.html#seqCo"><span class="hs-identifier hs-var">seqCo</span></a></span><span> </span><span class="annot"><span class="annottext">Coercion
</span><a href="#local-6989586621682579219"><span class="hs-identifier hs-var">co</span></a></span><span> </span><span class="annot"><span class="annottext">() -&gt; () -&gt; ()
forall a b. a -&gt; b -&gt; b
</span><span class="hs-operator hs-var">`seq`</span></span><span> </span><span class="annot"><span class="annottext">Coercion -&gt; ()
</span><a href="GHC.Core.Coercion.html#seqCo"><span class="hs-identifier hs-var">seqCo</span></a></span><span> </span><span class="annot"><span class="annottext">Coercion
</span><a href="#local-6989586621682579220"><span class="hs-identifier hs-var">arg</span></a></span><span>
</span><span id="line-2418"></span><span class="annot"><a href="GHC.Core.Coercion.html#seqCo"><span class="hs-identifier hs-var">seqCo</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#KindCo"><span class="hs-identifier hs-type">KindCo</span></a></span><span> </span><span id="local-6989586621682579221"><span class="annot"><span class="annottext">Coercion
</span><a href="#local-6989586621682579221"><span class="hs-identifier hs-var">co</span></a></span></span><span class="hs-special">)</span><span>           </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Coercion -&gt; ()
</span><a href="GHC.Core.Coercion.html#seqCo"><span class="hs-identifier hs-var">seqCo</span></a></span><span> </span><span class="annot"><span class="annottext">Coercion
</span><a href="#local-6989586621682579221"><span class="hs-identifier hs-var">co</span></a></span><span>
</span><span id="line-2419"></span><span class="annot"><a href="GHC.Core.Coercion.html#seqCo"><span class="hs-identifier hs-var">seqCo</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#SubCo"><span class="hs-identifier hs-type">SubCo</span></a></span><span> </span><span id="local-6989586621682579222"><span class="annot"><span class="annottext">Coercion
</span><a href="#local-6989586621682579222"><span class="hs-identifier hs-var">co</span></a></span></span><span class="hs-special">)</span><span>            </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Coercion -&gt; ()
</span><a href="GHC.Core.Coercion.html#seqCo"><span class="hs-identifier hs-var">seqCo</span></a></span><span> </span><span class="annot"><span class="annottext">Coercion
</span><a href="#local-6989586621682579222"><span class="hs-identifier hs-var">co</span></a></span><span>
</span><span id="line-2420"></span><span class="annot"><a href="GHC.Core.Coercion.html#seqCo"><span class="hs-identifier hs-var">seqCo</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#AxiomCo"><span class="hs-identifier hs-type">AxiomCo</span></a></span><span> </span><span class="annot"><span class="annottext">CoAxiomRule
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621682579223"><span class="annot"><span class="annottext">[Coercion]
</span><a href="#local-6989586621682579223"><span class="hs-identifier hs-var">cs</span></a></span></span><span class="hs-special">)</span><span>        </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[Coercion] -&gt; ()
</span><a href="GHC.Core.Coercion.html#seqCos"><span class="hs-identifier hs-var">seqCos</span></a></span><span> </span><span class="annot"><span class="annottext">[Coercion]
</span><a href="#local-6989586621682579223"><span class="hs-identifier hs-var">cs</span></a></span><span>
</span><span id="line-2421"></span><span class="annot"><a href="GHC.Core.Coercion.html#seqCo"><span class="hs-identifier hs-var">seqCo</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#ForAllCo"><span class="hs-identifier hs-type">ForAllCo</span></a></span><span> </span><span id="local-6989586621682579224"><span class="annot"><span class="annottext">CoVar
</span><a href="#local-6989586621682579224"><span class="hs-identifier hs-var">tv</span></a></span></span><span> </span><span id="local-6989586621682579225"><span class="annot"><span class="annottext">ForAllTyFlag
</span><a href="#local-6989586621682579225"><span class="hs-identifier hs-var">visL</span></a></span></span><span> </span><span id="local-6989586621682579226"><span class="annot"><span class="annottext">ForAllTyFlag
</span><a href="#local-6989586621682579226"><span class="hs-identifier hs-var">visR</span></a></span></span><span> </span><span id="local-6989586621682579227"><span class="annot"><span class="annottext">Coercion
</span><a href="#local-6989586621682579227"><span class="hs-identifier hs-var">k</span></a></span></span><span> </span><span id="local-6989586621682579228"><span class="annot"><span class="annottext">Coercion
</span><a href="#local-6989586621682579228"><span class="hs-identifier hs-var">co</span></a></span></span><span class="hs-special">)</span><span>
</span><span id="line-2422"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Type -&gt; ()
</span><a href="GHC.Core.Type.html#seqType"><span class="hs-identifier hs-var">seqType</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">CoVar -&gt; Type
</span><a href="GHC.Types.Var.html#varType"><span class="hs-identifier hs-var">varType</span></a></span><span> </span><span class="annot"><span class="annottext">CoVar
</span><a href="#local-6989586621682579224"><span class="hs-identifier hs-var">tv</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">() -&gt; () -&gt; ()
forall a b. a -&gt; b -&gt; b
</span><span class="hs-operator hs-var">`seq`</span></span><span> </span><span class="annot"><span class="annottext">ForAllTyFlag -&gt; ()
forall a. NFData a =&gt; a -&gt; ()
</span><a href="../../deepseq-1.5.1.0-6837/src/Control.DeepSeq.html#rnf"><span class="hs-identifier hs-var">rnf</span></a></span><span> </span><span class="annot"><span class="annottext">ForAllTyFlag
</span><a href="#local-6989586621682579225"><span class="hs-identifier hs-var">visL</span></a></span><span> </span><span class="annot"><span class="annottext">() -&gt; () -&gt; ()
forall a b. a -&gt; b -&gt; b
</span><span class="hs-operator hs-var">`seq`</span></span><span> </span><span class="annot"><span class="annottext">ForAllTyFlag -&gt; ()
forall a. NFData a =&gt; a -&gt; ()
</span><a href="../../deepseq-1.5.1.0-6837/src/Control.DeepSeq.html#rnf"><span class="hs-identifier hs-var">rnf</span></a></span><span> </span><span class="annot"><span class="annottext">ForAllTyFlag
</span><a href="#local-6989586621682579226"><span class="hs-identifier hs-var">visR</span></a></span><span> </span><span class="annot"><span class="annottext">() -&gt; () -&gt; ()
forall a b. a -&gt; b -&gt; b
</span><span class="hs-operator hs-var">`seq`</span></span><span>
</span><span id="line-2423"></span><span>    </span><span class="annot"><span class="annottext">Coercion -&gt; ()
</span><a href="GHC.Core.Coercion.html#seqCo"><span class="hs-identifier hs-var">seqCo</span></a></span><span> </span><span class="annot"><span class="annottext">Coercion
</span><a href="#local-6989586621682579227"><span class="hs-identifier hs-var">k</span></a></span><span> </span><span class="annot"><span class="annottext">() -&gt; () -&gt; ()
forall a b. a -&gt; b -&gt; b
</span><span class="hs-operator hs-var">`seq`</span></span><span> </span><span class="annot"><span class="annottext">Coercion -&gt; ()
</span><a href="GHC.Core.Coercion.html#seqCo"><span class="hs-identifier hs-var">seqCo</span></a></span><span> </span><span class="annot"><span class="annottext">Coercion
</span><a href="#local-6989586621682579228"><span class="hs-identifier hs-var">co</span></a></span><span>
</span><span id="line-2424"></span><span class="annot"><a href="GHC.Core.Coercion.html#seqCo"><span class="hs-identifier hs-var">seqCo</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#FunCo"><span class="hs-identifier hs-type">FunCo</span></a></span><span> </span><span id="local-6989586621682579230"><span class="annot"><span class="annottext">Role
</span><a href="#local-6989586621682579230"><span class="hs-identifier hs-var">r</span></a></span></span><span> </span><span id="local-6989586621682579231"><span class="annot"><span class="annottext">FunTyFlag
</span><a href="#local-6989586621682579231"><span class="hs-identifier hs-var">af1</span></a></span></span><span> </span><span id="local-6989586621682579232"><span class="annot"><span class="annottext">FunTyFlag
</span><a href="#local-6989586621682579232"><span class="hs-identifier hs-var">af2</span></a></span></span><span> </span><span id="local-6989586621682579233"><span class="annot"><span class="annottext">Coercion
</span><a href="#local-6989586621682579233"><span class="hs-identifier hs-var">w</span></a></span></span><span> </span><span id="local-6989586621682579234"><span class="annot"><span class="annottext">Coercion
</span><a href="#local-6989586621682579234"><span class="hs-identifier hs-var">co1</span></a></span></span><span> </span><span id="local-6989586621682579235"><span class="annot"><span class="annottext">Coercion
</span><a href="#local-6989586621682579235"><span class="hs-identifier hs-var">co2</span></a></span></span><span class="hs-special">)</span><span>
</span><span id="line-2425"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Role
</span><a href="#local-6989586621682579230"><span class="hs-identifier hs-var">r</span></a></span><span> </span><span class="annot"><span class="annottext">Role -&gt; () -&gt; ()
forall a b. a -&gt; b -&gt; b
</span><span class="hs-operator hs-var">`seq`</span></span><span> </span><span class="annot"><span class="annottext">FunTyFlag
</span><a href="#local-6989586621682579231"><span class="hs-identifier hs-var">af1</span></a></span><span> </span><span class="annot"><span class="annottext">FunTyFlag -&gt; () -&gt; ()
forall a b. a -&gt; b -&gt; b
</span><span class="hs-operator hs-var">`seq`</span></span><span> </span><span class="annot"><span class="annottext">FunTyFlag
</span><a href="#local-6989586621682579232"><span class="hs-identifier hs-var">af2</span></a></span><span> </span><span class="annot"><span class="annottext">FunTyFlag -&gt; () -&gt; ()
forall a b. a -&gt; b -&gt; b
</span><span class="hs-operator hs-var">`seq`</span></span><span> </span><span class="annot"><span class="annottext">Coercion -&gt; ()
</span><a href="GHC.Core.Coercion.html#seqCo"><span class="hs-identifier hs-var">seqCo</span></a></span><span> </span><span class="annot"><span class="annottext">Coercion
</span><a href="#local-6989586621682579233"><span class="hs-identifier hs-var">w</span></a></span><span> </span><span class="annot"><span class="annottext">() -&gt; () -&gt; ()
forall a b. a -&gt; b -&gt; b
</span><span class="hs-operator hs-var">`seq`</span></span><span> </span><span class="annot"><span class="annottext">Coercion -&gt; ()
</span><a href="GHC.Core.Coercion.html#seqCo"><span class="hs-identifier hs-var">seqCo</span></a></span><span> </span><span class="annot"><span class="annottext">Coercion
</span><a href="#local-6989586621682579234"><span class="hs-identifier hs-var">co1</span></a></span><span> </span><span class="annot"><span class="annottext">() -&gt; () -&gt; ()
forall a b. a -&gt; b -&gt; b
</span><span class="hs-operator hs-var">`seq`</span></span><span> </span><span class="annot"><span class="annottext">Coercion -&gt; ()
</span><a href="GHC.Core.Coercion.html#seqCo"><span class="hs-identifier hs-var">seqCo</span></a></span><span> </span><span class="annot"><span class="annottext">Coercion
</span><a href="#local-6989586621682579235"><span class="hs-identifier hs-var">co2</span></a></span><span>
</span><span id="line-2426"></span><span class="annot"><a href="GHC.Core.Coercion.html#seqCo"><span class="hs-identifier hs-var">seqCo</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#UnivCo"><span class="hs-identifier hs-type">UnivCo</span></a></span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">uco_prov :: Coercion -&gt; UnivCoProvenance
</span><a href="GHC.Core.TyCo.Rep.html#uco_prov"><span class="hs-identifier hs-var">uco_prov</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="local-6989586621682579236"><span class="annot"><span class="annottext">UnivCoProvenance
</span><a href="#local-6989586621682579236"><span class="hs-identifier hs-var">p</span></a></span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">uco_role :: Coercion -&gt; Role
</span><a href="GHC.Core.TyCo.Rep.html#uco_role"><span class="hs-identifier hs-var">uco_role</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="local-6989586621682579237"><span class="annot"><span class="annottext">Role
</span><a href="#local-6989586621682579237"><span class="hs-identifier hs-var">r</span></a></span></span><span>
</span><span id="line-2427"></span><span>              </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">uco_lty :: Coercion -&gt; Type
</span><a href="GHC.Core.TyCo.Rep.html#uco_lty"><span class="hs-identifier hs-var">uco_lty</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="local-6989586621682579238"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682579238"><span class="hs-identifier hs-var">t1</span></a></span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">uco_rty :: Coercion -&gt; Type
</span><a href="GHC.Core.TyCo.Rep.html#uco_rty"><span class="hs-identifier hs-var">uco_rty</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="local-6989586621682579239"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682579239"><span class="hs-identifier hs-var">t2</span></a></span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">uco_deps :: Coercion -&gt; [Coercion]
</span><a href="GHC.Core.TyCo.Rep.html#uco_deps"><span class="hs-identifier hs-var">uco_deps</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="local-6989586621682579240"><span class="annot"><span class="annottext">[Coercion]
</span><a href="#local-6989586621682579240"><span class="hs-identifier hs-var">deps</span></a></span></span><span> </span><span class="hs-special">}</span><span class="hs-special">)</span><span>
</span><span id="line-2428"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">UnivCoProvenance
</span><a href="#local-6989586621682579236"><span class="hs-identifier hs-var">p</span></a></span><span> </span><span class="annot"><span class="annottext">UnivCoProvenance -&gt; () -&gt; ()
forall a b. a -&gt; b -&gt; b
</span><span class="hs-operator hs-var">`seq`</span></span><span> </span><span class="annot"><span class="annottext">Role
</span><a href="#local-6989586621682579237"><span class="hs-identifier hs-var">r</span></a></span><span> </span><span class="annot"><span class="annottext">Role -&gt; () -&gt; ()
forall a b. a -&gt; b -&gt; b
</span><span class="hs-operator hs-var">`seq`</span></span><span> </span><span class="annot"><span class="annottext">Type -&gt; ()
</span><a href="GHC.Core.Type.html#seqType"><span class="hs-identifier hs-var">seqType</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682579238"><span class="hs-identifier hs-var">t1</span></a></span><span> </span><span class="annot"><span class="annottext">() -&gt; () -&gt; ()
forall a b. a -&gt; b -&gt; b
</span><span class="hs-operator hs-var">`seq`</span></span><span> </span><span class="annot"><span class="annottext">Type -&gt; ()
</span><a href="GHC.Core.Type.html#seqType"><span class="hs-identifier hs-var">seqType</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682579239"><span class="hs-identifier hs-var">t2</span></a></span><span> </span><span class="annot"><span class="annottext">() -&gt; () -&gt; ()
forall a b. a -&gt; b -&gt; b
</span><span class="hs-operator hs-var">`seq`</span></span><span> </span><span class="annot"><span class="annottext">[Coercion] -&gt; ()
</span><a href="GHC.Core.Coercion.html#seqCos"><span class="hs-identifier hs-var">seqCos</span></a></span><span> </span><span class="annot"><span class="annottext">[Coercion]
</span><a href="#local-6989586621682579240"><span class="hs-identifier hs-var">deps</span></a></span><span>
</span><span id="line-2429"></span><span>
</span><span id="line-2430"></span><span class="annot"><a href="GHC.Core.Coercion.html#seqCos"><span class="hs-identifier hs-type">seqCos</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#Coercion"><span class="hs-identifier hs-type">Coercion</span></a></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-2431"></span><span id="seqCos"><span class="annot"><span class="annottext">seqCos :: [Coercion] -&gt; ()
</span><a href="GHC.Core.Coercion.html#seqCos"><span class="hs-identifier hs-var hs-var">seqCos</span></a></span></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span>       </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-2432"></span><span class="annot"><a href="GHC.Core.Coercion.html#seqCos"><span class="hs-identifier hs-var">seqCos</span></a></span><span> </span><span class="hs-special">(</span><span id="local-6989586621682579241"><span class="annot"><span class="annottext">Coercion
</span><a href="#local-6989586621682579241"><span class="hs-identifier hs-var">co</span></a></span></span><span class="annot"><span class="hs-glyph hs-type">:</span></span><span id="local-6989586621682579242"><span class="annot"><span class="annottext">[Coercion]
</span><a href="#local-6989586621682579242"><span class="hs-identifier hs-var">cos</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Coercion -&gt; ()
</span><a href="GHC.Core.Coercion.html#seqCo"><span class="hs-identifier hs-var">seqCo</span></a></span><span> </span><span class="annot"><span class="annottext">Coercion
</span><a href="#local-6989586621682579241"><span class="hs-identifier hs-var">co</span></a></span><span> </span><span class="annot"><span class="annottext">() -&gt; () -&gt; ()
forall a b. a -&gt; b -&gt; b
</span><span class="hs-operator hs-var">`seq`</span></span><span> </span><span class="annot"><span class="annottext">[Coercion] -&gt; ()
</span><a href="GHC.Core.Coercion.html#seqCos"><span class="hs-identifier hs-var">seqCos</span></a></span><span> </span><span class="annot"><span class="annottext">[Coercion]
</span><a href="#local-6989586621682579242"><span class="hs-identifier hs-var">cos</span></a></span><span>
</span><span id="line-2433"></span><span>
</span><span id="line-2434"></span><span class="hs-comment">{-
%************************************************************************
%*                                                                      *
             The kind of a type, and of a coercion
%*                                                                      *
%************************************************************************
-}</span><span>
</span><span id="line-2441"></span><span>
</span><span id="line-2442"></span><span class="hs-comment">{- Note [coercionKind performance]
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
coercionKind, coercionLKind, and coercionRKind are very &quot;hot&quot; functions; in some
coercion-heavy programs they can have a material effect on compile time/allocation.

Hence
* Rather than making one function which returns a pair (lots of allocation and
  de-allocation) we have two functions, coercionLKind and coercionRKind, which
  return the left and right kind respectively.

* Both are defined by a single worker function `coercion_lr_kind`, which takes a
  flag of type `LeftOrRight`.  This worker function is marked INLINE, and inlined
  at its precisely-two call-sites in coercionLKind and coercionRKind.

Take care when making changes here... it's easy to accidentally add allocation!
-}</span><span>
</span><span id="line-2458"></span><span>
</span><span id="line-2459"></span><span class="annot"><span class="hs-comment">-- | Apply 'coercionKind' to multiple 'Coercion's</span></span><span>
</span><span id="line-2460"></span><span class="annot"><a href="GHC.Core.Coercion.html#coercionKinds"><span class="hs-identifier hs-type">coercionKinds</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#Coercion"><span class="hs-identifier hs-type">Coercion</span></a></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Data.Pair.html#Pair"><span class="hs-identifier hs-type">Pair</span></a></span><span> </span><span class="hs-special">[</span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#Type"><span class="hs-identifier hs-type">Type</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-2461"></span><span id="coercionKinds"><span class="annot"><span class="annottext">coercionKinds :: [Coercion] -&gt; Pair [Type]
</span><a href="GHC.Core.Coercion.html#coercionKinds"><span class="hs-identifier hs-var hs-var">coercionKinds</span></a></span></span><span> </span><span id="local-6989586621682579243"><span class="annot"><span class="annottext">[Coercion]
</span><a href="#local-6989586621682579243"><span class="hs-identifier hs-var">tys</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[Pair Type] -&gt; Pair [Type]
forall (t :: * -&gt; *) (f :: * -&gt; *) a.
(Traversable t, Applicative f) =&gt;
t (f a) -&gt; f (t a)
forall (f :: * -&gt; *) a. Applicative f =&gt; [f a] -&gt; f [a]
</span><span class="hs-identifier hs-var">sequenceA</span></span><span> </span><span class="annot"><span class="annottext">([Pair Type] -&gt; Pair [Type]) -&gt; [Pair Type] -&gt; Pair [Type]
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">(Coercion -&gt; Pair Type) -&gt; [Coercion] -&gt; [Pair Type]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><span class="hs-identifier hs-var">map</span></span><span> </span><span class="annot"><span class="annottext">HasDebugCallStack =&gt; Coercion -&gt; Pair Type
Coercion -&gt; Pair Type
</span><a href="GHC.Core.Coercion.html#coercionKind"><span class="hs-identifier hs-var">coercionKind</span></a></span><span> </span><span class="annot"><span class="annottext">[Coercion]
</span><a href="#local-6989586621682579243"><span class="hs-identifier hs-var">tys</span></a></span><span>
</span><span id="line-2462"></span><span>
</span><span id="line-2463"></span><span class="annot"><span class="hs-comment">-- | Get a coercion's kind and role.</span></span><span>
</span><span id="line-2464"></span><span class="annot"><a href="GHC.Core.Coercion.html#coercionKindRole"><span class="hs-identifier hs-type">coercionKindRole</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#Coercion"><span class="hs-identifier hs-type">Coercion</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Data.Pair.html#Pair"><span class="hs-identifier hs-type">Pair</span></a></span><span> </span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#Type"><span class="hs-identifier hs-type">Type</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Language.Haskell.Syntax.Basic.html#Role"><span class="hs-identifier hs-type">Role</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-2465"></span><span id="coercionKindRole"><span class="annot"><span class="annottext">coercionKindRole :: Coercion -&gt; (Pair Type, Role)
</span><a href="GHC.Core.Coercion.html#coercionKindRole"><span class="hs-identifier hs-var hs-var">coercionKindRole</span></a></span></span><span> </span><span id="local-6989586621682579245"><span class="annot"><span class="annottext">Coercion
</span><a href="#local-6989586621682579245"><span class="hs-identifier hs-var">co</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">HasDebugCallStack =&gt; Coercion -&gt; Pair Type
Coercion -&gt; Pair Type
</span><a href="GHC.Core.Coercion.html#coercionKind"><span class="hs-identifier hs-var">coercionKind</span></a></span><span> </span><span class="annot"><span class="annottext">Coercion
</span><a href="#local-6989586621682579245"><span class="hs-identifier hs-var">co</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Coercion -&gt; Role
</span><a href="GHC.Core.Coercion.html#coercionRole"><span class="hs-identifier hs-var">coercionRole</span></a></span><span> </span><span class="annot"><span class="annottext">Coercion
</span><a href="#local-6989586621682579245"><span class="hs-identifier hs-var">co</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-2466"></span><span>
</span><span id="line-2467"></span><span class="annot"><a href="GHC.Core.Coercion.html#coercionType"><span class="hs-identifier hs-type">coercionType</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#Coercion"><span class="hs-identifier hs-type">Coercion</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#Type"><span class="hs-identifier hs-type">Type</span></a></span><span>
</span><span id="line-2468"></span><span id="coercionType"><span class="annot"><span class="annottext">coercionType :: Coercion -&gt; Type
</span><a href="GHC.Core.Coercion.html#coercionType"><span class="hs-identifier hs-var hs-var">coercionType</span></a></span></span><span> </span><span id="local-6989586621682579246"><span class="annot"><span class="annottext">Coercion
</span><a href="#local-6989586621682579246"><span class="hs-identifier hs-var">co</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">Coercion -&gt; (Pair Type, Role)
</span><a href="GHC.Core.Coercion.html#coercionKindRole"><span class="hs-identifier hs-var">coercionKindRole</span></a></span><span> </span><span class="annot"><span class="annottext">Coercion
</span><a href="#local-6989586621682579246"><span class="hs-identifier hs-var">co</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-2469"></span><span>  </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Data.Pair.html#Pair"><span class="hs-identifier hs-type">Pair</span></a></span><span> </span><span id="local-6989586621682579247"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682579247"><span class="hs-identifier hs-var">ty1</span></a></span></span><span> </span><span id="local-6989586621682579248"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682579248"><span class="hs-identifier hs-var">ty2</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682579249"><span class="annot"><span class="annottext">Role
</span><a href="#local-6989586621682579249"><span class="hs-identifier hs-var">r</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Role -&gt; Type -&gt; Type -&gt; Type
</span><a href="GHC.Core.Coercion.html#mkCoercionType"><span class="hs-identifier hs-var">mkCoercionType</span></a></span><span> </span><span class="annot"><span class="annottext">Role
</span><a href="#local-6989586621682579249"><span class="hs-identifier hs-var">r</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682579247"><span class="hs-identifier hs-var">ty1</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682579248"><span class="hs-identifier hs-var">ty2</span></a></span><span>
</span><span id="line-2470"></span><span>
</span><span id="line-2471"></span><span class="hs-comment">------------------</span><span>
</span><span id="line-2472"></span><span class="hs-comment">-- | If it is the case that</span><span>
</span><span id="line-2473"></span><span class="hs-comment">--</span><span>
</span><span id="line-2474"></span><span class="hs-comment">-- &gt; c :: (t1 ~ t2)</span><span>
</span><span id="line-2475"></span><span class="hs-comment">--</span><span>
</span><span id="line-2476"></span><span class="hs-comment">-- i.e. the kind of @c@ relates @t1@ and @t2@, then @coercionKind c = Pair t1 t2@.</span><span>
</span><span id="line-2477"></span><span>
</span><span id="line-2478"></span><span class="annot"><a href="GHC.Core.Coercion.html#coercionKind"><span class="hs-identifier hs-type">coercionKind</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Utils.Misc.html#HasDebugCallStack"><span class="hs-identifier hs-type">HasDebugCallStack</span></a></span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#Coercion"><span class="hs-identifier hs-type">Coercion</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Data.Pair.html#Pair"><span class="hs-identifier hs-type">Pair</span></a></span><span> </span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#Type"><span class="hs-identifier hs-type">Type</span></a></span><span>
</span><span id="line-2479"></span><span class="hs-comment">-- See Note [coercionKind performance]</span><span>
</span><span id="line-2480"></span><span id="coercionKind"><span class="annot"><span class="annottext">coercionKind :: HasDebugCallStack =&gt; Coercion -&gt; Pair Type
</span><a href="GHC.Core.Coercion.html#coercionKind"><span class="hs-identifier hs-var hs-var">coercionKind</span></a></span></span><span> </span><span id="local-6989586621682579253"><span class="annot"><span class="annottext">Coercion
</span><a href="#local-6989586621682579253"><span class="hs-identifier hs-var">co</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Type -&gt; Type -&gt; Pair Type
forall a. a -&gt; a -&gt; Pair a
</span><a href="GHC.Data.Pair.html#Pair"><span class="hs-identifier hs-var">Pair</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">HasDebugCallStack =&gt; Coercion -&gt; Type
Coercion -&gt; Type
</span><a href="GHC.Core.Coercion.html#coercionLKind"><span class="hs-identifier hs-var">coercionLKind</span></a></span><span> </span><span class="annot"><span class="annottext">Coercion
</span><a href="#local-6989586621682579253"><span class="hs-identifier hs-var">co</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">HasDebugCallStack =&gt; Coercion -&gt; Type
Coercion -&gt; Type
</span><a href="GHC.Core.Coercion.html#coercionRKind"><span class="hs-identifier hs-var">coercionRKind</span></a></span><span> </span><span class="annot"><span class="annottext">Coercion
</span><a href="#local-6989586621682579253"><span class="hs-identifier hs-var">co</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-2481"></span><span>
</span><span id="line-2482"></span><span class="annot"><a href="GHC.Core.Coercion.html#coercionLKind"><span class="hs-identifier hs-type">coercionLKind</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Core.Coercion.html#coercionRKind"><span class="hs-identifier hs-type">coercionRKind</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Utils.Misc.html#HasDebugCallStack"><span class="hs-identifier hs-type">HasDebugCallStack</span></a></span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#Coercion"><span class="hs-identifier hs-type">Coercion</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#Type"><span class="hs-identifier hs-type">Type</span></a></span><span>
</span><span id="line-2483"></span><span class="hs-comment">-- See Note [coercionKind performance]</span><span>
</span><span id="line-2484"></span><span id="coercionLKind"><span class="annot"><span class="annottext">coercionLKind :: HasDebugCallStack =&gt; Coercion -&gt; Type
</span><a href="GHC.Core.Coercion.html#coercionLKind"><span class="hs-identifier hs-var hs-var">coercionLKind</span></a></span></span><span> </span><span id="local-6989586621682579256"><span class="annot"><span class="annottext">Coercion
</span><a href="#local-6989586621682579256"><span class="hs-identifier hs-var">co</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">HasDebugCallStack =&gt; LeftOrRight -&gt; Coercion -&gt; Type
LeftOrRight -&gt; Coercion -&gt; Type
</span><a href="GHC.Core.Coercion.html#coercion_lr_kind"><span class="hs-identifier hs-var">coercion_lr_kind</span></a></span><span> </span><span class="annot"><span class="annottext">LeftOrRight
</span><a href="GHC.Types.Basic.html#CLeft"><span class="hs-identifier hs-var">CLeft</span></a></span><span>  </span><span class="annot"><span class="annottext">Coercion
</span><a href="#local-6989586621682579256"><span class="hs-identifier hs-var">co</span></a></span><span>
</span><span id="line-2485"></span><span id="coercionRKind"><span class="annot"><span class="annottext">coercionRKind :: HasDebugCallStack =&gt; Coercion -&gt; Type
</span><a href="GHC.Core.Coercion.html#coercionRKind"><span class="hs-identifier hs-var hs-var">coercionRKind</span></a></span></span><span> </span><span id="local-6989586621682579260"><span class="annot"><span class="annottext">Coercion
</span><a href="#local-6989586621682579260"><span class="hs-identifier hs-var">co</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">HasDebugCallStack =&gt; LeftOrRight -&gt; Coercion -&gt; Type
LeftOrRight -&gt; Coercion -&gt; Type
</span><a href="GHC.Core.Coercion.html#coercion_lr_kind"><span class="hs-identifier hs-var">coercion_lr_kind</span></a></span><span> </span><span class="annot"><span class="annottext">LeftOrRight
</span><a href="GHC.Types.Basic.html#CRight"><span class="hs-identifier hs-var">CRight</span></a></span><span> </span><span class="annot"><span class="annottext">Coercion
</span><a href="#local-6989586621682579260"><span class="hs-identifier hs-var">co</span></a></span><span>
</span><span id="line-2486"></span><span>
</span><span id="line-2487"></span><span class="annot"><a href="GHC.Core.Coercion.html#coercion_lr_kind"><span class="hs-identifier hs-type">coercion_lr_kind</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Utils.Misc.html#HasDebugCallStack"><span class="hs-identifier hs-type">HasDebugCallStack</span></a></span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="GHC.Types.Basic.html#LeftOrRight"><span class="hs-identifier hs-type">LeftOrRight</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#Coercion"><span class="hs-identifier hs-type">Coercion</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#Type"><span class="hs-identifier hs-type">Type</span></a></span><span>
</span><span id="line-2488"></span><span class="hs-pragma">{-# INLINE</span><span> </span><span class="annot"><a href="GHC.Core.Coercion.html#coercion_lr_kind"><span class="hs-pragma hs-type">coercion_lr_kind</span></a></span><span> </span><span class="hs-pragma">#-}</span><span>
</span><span id="line-2489"></span><span class="hs-comment">-- See Note [coercionKind performance]</span><span>
</span><span id="line-2490"></span><span id="coercion_lr_kind"><span class="annot"><span class="annottext">coercion_lr_kind :: HasDebugCallStack =&gt; LeftOrRight -&gt; Coercion -&gt; Type
</span><a href="GHC.Core.Coercion.html#coercion_lr_kind"><span class="hs-identifier hs-var hs-var">coercion_lr_kind</span></a></span></span><span> </span><span id="local-6989586621682579283"><span class="annot"><span class="annottext">LeftOrRight
</span><a href="#local-6989586621682579283"><span class="hs-identifier hs-var">which</span></a></span></span><span> </span><span id="local-6989586621682579284"><span class="annot"><span class="annottext">Coercion
</span><a href="#local-6989586621682579284"><span class="hs-identifier hs-var">orig_co</span></a></span></span><span>
</span><span id="line-2491"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Coercion -&gt; Type
</span><a href="#local-6989586621682579285"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="annot"><span class="annottext">Coercion
</span><a href="#local-6989586621682579284"><span class="hs-identifier hs-var">orig_co</span></a></span><span>
</span><span id="line-2492"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-2493"></span><span>    </span><span id="local-6989586621682579285"><span class="annot"><span class="annottext">go :: Coercion -&gt; Type
</span><a href="#local-6989586621682579285"><span class="hs-identifier hs-var hs-var">go</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#Refl"><span class="hs-identifier hs-type">Refl</span></a></span><span> </span><span id="local-6989586621682579286"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682579286"><span class="hs-identifier hs-var">ty</span></a></span></span><span class="hs-special">)</span><span>              </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682579286"><span class="hs-identifier hs-var">ty</span></a></span><span>
</span><span id="line-2494"></span><span>    </span><span class="annot"><a href="#local-6989586621682579285"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#GRefl"><span class="hs-identifier hs-type">GRefl</span></a></span><span> </span><span class="annot"><span class="annottext">Role
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621682579287"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682579287"><span class="hs-identifier hs-var">ty</span></a></span></span><span> </span><span class="annot"><span class="annottext">MCoercion
</span><a href="GHC.Core.TyCo.Rep.html#MRefl"><span class="hs-identifier hs-var">MRefl</span></a></span><span class="hs-special">)</span><span>     </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682579287"><span class="hs-identifier hs-var">ty</span></a></span><span>
</span><span id="line-2495"></span><span>    </span><span class="annot"><a href="#local-6989586621682579285"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#GRefl"><span class="hs-identifier hs-type">GRefl</span></a></span><span> </span><span class="annot"><span class="annottext">Role
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621682579288"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682579288"><span class="hs-identifier hs-var">ty</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#MCo"><span class="hs-identifier hs-type">MCo</span></a></span><span> </span><span id="local-6989586621682579289"><span class="annot"><span class="annottext">Coercion
</span><a href="#local-6989586621682579289"><span class="hs-identifier hs-var">co1</span></a></span></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">LeftOrRight -&gt; (Type, Type) -&gt; Type
forall a. LeftOrRight -&gt; (a, a) -&gt; a
</span><a href="GHC.Types.Basic.html#pickLR"><span class="hs-identifier hs-var">pickLR</span></a></span><span> </span><span class="annot"><span class="annottext">LeftOrRight
</span><a href="#local-6989586621682579283"><span class="hs-identifier hs-var">which</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682579288"><span class="hs-identifier hs-var">ty</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Type -&gt; Coercion -&gt; Type
</span><a href="GHC.Core.Type.html#mkCastTy"><span class="hs-identifier hs-var">mkCastTy</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682579288"><span class="hs-identifier hs-var">ty</span></a></span><span> </span><span class="annot"><span class="annottext">Coercion
</span><a href="#local-6989586621682579289"><span class="hs-identifier hs-var">co1</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-2496"></span><span>    </span><span class="annot"><a href="#local-6989586621682579285"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#TyConAppCo"><span class="hs-identifier hs-type">TyConAppCo</span></a></span><span> </span><span class="annot"><span class="annottext">Role
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621682579290"><span class="annot"><span class="annottext">TyCon
</span><a href="#local-6989586621682579290"><span class="hs-identifier hs-var">tc</span></a></span></span><span> </span><span id="local-6989586621682579291"><span class="annot"><span class="annottext">[Coercion]
</span><a href="#local-6989586621682579291"><span class="hs-identifier hs-var">cos</span></a></span></span><span class="hs-special">)</span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">TyCon -&gt; [Type] -&gt; Type
</span><a href="GHC.Core.Type.html#mkTyConApp"><span class="hs-identifier hs-var">mkTyConApp</span></a></span><span> </span><span class="annot"><span class="annottext">TyCon
</span><a href="#local-6989586621682579290"><span class="hs-identifier hs-var">tc</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(Coercion -&gt; Type) -&gt; [Coercion] -&gt; [Type]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><span class="hs-identifier hs-var">map</span></span><span> </span><span class="annot"><span class="annottext">Coercion -&gt; Type
</span><a href="#local-6989586621682579285"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="annot"><span class="annottext">[Coercion]
</span><a href="#local-6989586621682579291"><span class="hs-identifier hs-var">cos</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-2497"></span><span>    </span><span class="annot"><a href="#local-6989586621682579285"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#AppCo"><span class="hs-identifier hs-type">AppCo</span></a></span><span> </span><span id="local-6989586621682579292"><span class="annot"><span class="annottext">Coercion
</span><a href="#local-6989586621682579292"><span class="hs-identifier hs-var">co1</span></a></span></span><span> </span><span id="local-6989586621682579293"><span class="annot"><span class="annottext">Coercion
</span><a href="#local-6989586621682579293"><span class="hs-identifier hs-var">co2</span></a></span></span><span class="hs-special">)</span><span>        </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Type -&gt; Type -&gt; Type
</span><a href="GHC.Core.Type.html#mkAppTy"><span class="hs-identifier hs-var">mkAppTy</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Coercion -&gt; Type
</span><a href="#local-6989586621682579285"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="annot"><span class="annottext">Coercion
</span><a href="#local-6989586621682579292"><span class="hs-identifier hs-var">co1</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Coercion -&gt; Type
</span><a href="#local-6989586621682579285"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="annot"><span class="annottext">Coercion
</span><a href="#local-6989586621682579293"><span class="hs-identifier hs-var">co2</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-2498"></span><span>    </span><span class="annot"><a href="#local-6989586621682579285"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#CoVarCo"><span class="hs-identifier hs-type">CoVarCo</span></a></span><span> </span><span id="local-6989586621682579294"><span class="annot"><span class="annottext">CoVar
</span><a href="#local-6989586621682579294"><span class="hs-identifier hs-var">cv</span></a></span></span><span class="hs-special">)</span><span>           </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">CoVar -&gt; Type
</span><a href="#local-6989586621682579295"><span class="hs-identifier hs-var">go_covar</span></a></span><span> </span><span class="annot"><span class="annottext">CoVar
</span><a href="#local-6989586621682579294"><span class="hs-identifier hs-var">cv</span></a></span><span>
</span><span id="line-2499"></span><span>    </span><span class="annot"><a href="#local-6989586621682579285"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#HoleCo"><span class="hs-identifier hs-type">HoleCo</span></a></span><span> </span><span id="local-6989586621682579296"><span class="annot"><span class="annottext">CoercionHole
</span><a href="#local-6989586621682579296"><span class="hs-identifier hs-var">h</span></a></span></span><span class="hs-special">)</span><span>             </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">CoVar -&gt; Type
</span><a href="#local-6989586621682579295"><span class="hs-identifier hs-var">go_covar</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">CoercionHole -&gt; CoVar
</span><a href="GHC.Core.TyCo.Rep.html#coHoleCoVar"><span class="hs-identifier hs-var">coHoleCoVar</span></a></span><span> </span><span class="annot"><span class="annottext">CoercionHole
</span><a href="#local-6989586621682579296"><span class="hs-identifier hs-var">h</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-2500"></span><span>    </span><span class="annot"><a href="#local-6989586621682579285"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#SymCo"><span class="hs-identifier hs-type">SymCo</span></a></span><span> </span><span id="local-6989586621682579297"><span class="annot"><span class="annottext">Coercion
</span><a href="#local-6989586621682579297"><span class="hs-identifier hs-var">co</span></a></span></span><span class="hs-special">)</span><span>             </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">LeftOrRight -&gt; (Type, Type) -&gt; Type
forall a. LeftOrRight -&gt; (a, a) -&gt; a
</span><a href="GHC.Types.Basic.html#pickLR"><span class="hs-identifier hs-var">pickLR</span></a></span><span> </span><span class="annot"><span class="annottext">LeftOrRight
</span><a href="#local-6989586621682579283"><span class="hs-identifier hs-var">which</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">HasDebugCallStack =&gt; Coercion -&gt; Type
Coercion -&gt; Type
</span><a href="GHC.Core.Coercion.html#coercionRKind"><span class="hs-identifier hs-var">coercionRKind</span></a></span><span> </span><span class="annot"><span class="annottext">Coercion
</span><a href="#local-6989586621682579297"><span class="hs-identifier hs-var">co</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">HasDebugCallStack =&gt; Coercion -&gt; Type
Coercion -&gt; Type
</span><a href="GHC.Core.Coercion.html#coercionLKind"><span class="hs-identifier hs-var">coercionLKind</span></a></span><span> </span><span class="annot"><span class="annottext">Coercion
</span><a href="#local-6989586621682579297"><span class="hs-identifier hs-var">co</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-2501"></span><span>    </span><span class="annot"><a href="#local-6989586621682579285"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#TransCo"><span class="hs-identifier hs-type">TransCo</span></a></span><span> </span><span id="local-6989586621682579298"><span class="annot"><span class="annottext">Coercion
</span><a href="#local-6989586621682579298"><span class="hs-identifier hs-var">co1</span></a></span></span><span> </span><span id="local-6989586621682579299"><span class="annot"><span class="annottext">Coercion
</span><a href="#local-6989586621682579299"><span class="hs-identifier hs-var">co2</span></a></span></span><span class="hs-special">)</span><span>      </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">LeftOrRight -&gt; (Type, Type) -&gt; Type
forall a. LeftOrRight -&gt; (a, a) -&gt; a
</span><a href="GHC.Types.Basic.html#pickLR"><span class="hs-identifier hs-var">pickLR</span></a></span><span> </span><span class="annot"><span class="annottext">LeftOrRight
</span><a href="#local-6989586621682579283"><span class="hs-identifier hs-var">which</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Coercion -&gt; Type
</span><a href="#local-6989586621682579285"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="annot"><span class="annottext">Coercion
</span><a href="#local-6989586621682579298"><span class="hs-identifier hs-var">co1</span></a></span><span class="hs-special">,</span><span>           </span><span class="annot"><span class="annottext">Coercion -&gt; Type
</span><a href="#local-6989586621682579285"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="annot"><span class="annottext">Coercion
</span><a href="#local-6989586621682579299"><span class="hs-identifier hs-var">co2</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-2502"></span><span>    </span><span class="annot"><a href="#local-6989586621682579285"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#LRCo"><span class="hs-identifier hs-type">LRCo</span></a></span><span> </span><span id="local-6989586621682579300"><span class="annot"><span class="annottext">LeftOrRight
</span><a href="#local-6989586621682579300"><span class="hs-identifier hs-var">lr</span></a></span></span><span> </span><span id="local-6989586621682579301"><span class="annot"><span class="annottext">Coercion
</span><a href="#local-6989586621682579301"><span class="hs-identifier hs-var">co</span></a></span></span><span class="hs-special">)</span><span>           </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">LeftOrRight -&gt; (Type, Type) -&gt; Type
forall a. LeftOrRight -&gt; (a, a) -&gt; a
</span><a href="GHC.Types.Basic.html#pickLR"><span class="hs-identifier hs-var">pickLR</span></a></span><span> </span><span class="annot"><span class="annottext">LeftOrRight
</span><a href="#local-6989586621682579300"><span class="hs-identifier hs-var">lr</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Type -&gt; (Type, Type)
</span><a href="GHC.Core.Type.html#splitAppTy"><span class="hs-identifier hs-var">splitAppTy</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Coercion -&gt; Type
</span><a href="#local-6989586621682579285"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="annot"><span class="annottext">Coercion
</span><a href="#local-6989586621682579301"><span class="hs-identifier hs-var">co</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-2503"></span><span>    </span><span class="annot"><a href="#local-6989586621682579285"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#InstCo"><span class="hs-identifier hs-type">InstCo</span></a></span><span> </span><span id="local-6989586621682579302"><span class="annot"><span class="annottext">Coercion
</span><a href="#local-6989586621682579302"><span class="hs-identifier hs-var">aco</span></a></span></span><span> </span><span id="local-6989586621682579303"><span class="annot"><span class="annottext">Coercion
</span><a href="#local-6989586621682579303"><span class="hs-identifier hs-var">arg</span></a></span></span><span class="hs-special">)</span><span>       </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Coercion -&gt; [Type] -&gt; Type
</span><a href="#local-6989586621682579304"><span class="hs-identifier hs-var">go_app</span></a></span><span> </span><span class="annot"><span class="annottext">Coercion
</span><a href="#local-6989586621682579302"><span class="hs-identifier hs-var">aco</span></a></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">Coercion -&gt; Type
</span><a href="#local-6989586621682579285"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="annot"><span class="annottext">Coercion
</span><a href="#local-6989586621682579303"><span class="hs-identifier hs-var">arg</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-2504"></span><span>    </span><span class="annot"><a href="#local-6989586621682579285"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#KindCo"><span class="hs-identifier hs-type">KindCo</span></a></span><span> </span><span id="local-6989586621682579305"><span class="annot"><span class="annottext">Coercion
</span><a href="#local-6989586621682579305"><span class="hs-identifier hs-var">co</span></a></span></span><span class="hs-special">)</span><span>            </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">HasDebugCallStack =&gt; Type -&gt; Type
Type -&gt; Type
</span><a href="GHC.Core.Type.html#typeKind"><span class="hs-identifier hs-var">typeKind</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Coercion -&gt; Type
</span><a href="#local-6989586621682579285"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="annot"><span class="annottext">Coercion
</span><a href="#local-6989586621682579305"><span class="hs-identifier hs-var">co</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-2505"></span><span>    </span><span class="annot"><a href="#local-6989586621682579285"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#SubCo"><span class="hs-identifier hs-type">SubCo</span></a></span><span> </span><span id="local-6989586621682579306"><span class="annot"><span class="annottext">Coercion
</span><a href="#local-6989586621682579306"><span class="hs-identifier hs-var">co</span></a></span></span><span class="hs-special">)</span><span>             </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Coercion -&gt; Type
</span><a href="#local-6989586621682579285"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="annot"><span class="annottext">Coercion
</span><a href="#local-6989586621682579306"><span class="hs-identifier hs-var">co</span></a></span><span>
</span><span id="line-2506"></span><span>    </span><span class="annot"><a href="#local-6989586621682579285"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#SelCo"><span class="hs-identifier hs-type">SelCo</span></a></span><span> </span><span id="local-6989586621682579307"><span class="annot"><span class="annottext">CoSel
</span><a href="#local-6989586621682579307"><span class="hs-identifier hs-var">d</span></a></span></span><span> </span><span id="local-6989586621682579308"><span class="annot"><span class="annottext">Coercion
</span><a href="#local-6989586621682579308"><span class="hs-identifier hs-var">co</span></a></span></span><span class="hs-special">)</span><span>           </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">HasDebugCallStack =&gt; CoSel -&gt; Type -&gt; Type
CoSel -&gt; Type -&gt; Type
</span><a href="GHC.Core.Coercion.html#selectFromType"><span class="hs-identifier hs-var">selectFromType</span></a></span><span> </span><span class="annot"><span class="annottext">CoSel
</span><a href="#local-6989586621682579307"><span class="hs-identifier hs-var">d</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Coercion -&gt; Type
</span><a href="#local-6989586621682579285"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="annot"><span class="annottext">Coercion
</span><a href="#local-6989586621682579308"><span class="hs-identifier hs-var">co</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-2507"></span><span>    </span><span class="annot"><a href="#local-6989586621682579285"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#AxiomCo"><span class="hs-identifier hs-type">AxiomCo</span></a></span><span> </span><span id="local-6989586621682579309"><span class="annot"><span class="annottext">CoAxiomRule
</span><a href="#local-6989586621682579309"><span class="hs-identifier hs-var">ax</span></a></span></span><span> </span><span id="local-6989586621682579310"><span class="annot"><span class="annottext">[Coercion]
</span><a href="#local-6989586621682579310"><span class="hs-identifier hs-var">cos</span></a></span></span><span class="hs-special">)</span><span>       </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">CoAxiomRule -&gt; [Coercion] -&gt; Type
</span><a href="#local-6989586621682579311"><span class="hs-identifier hs-var">go_ax</span></a></span><span> </span><span class="annot"><span class="annottext">CoAxiomRule
</span><a href="#local-6989586621682579309"><span class="hs-identifier hs-var">ax</span></a></span><span> </span><span class="annot"><span class="annottext">[Coercion]
</span><a href="#local-6989586621682579310"><span class="hs-identifier hs-var">cos</span></a></span><span>
</span><span id="line-2508"></span><span>
</span><span id="line-2509"></span><span>    </span><span class="annot"><a href="#local-6989586621682579285"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#UnivCo"><span class="hs-identifier hs-type">UnivCo</span></a></span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">uco_lty :: Coercion -&gt; Type
</span><a href="GHC.Core.TyCo.Rep.html#uco_lty"><span class="hs-identifier hs-var">uco_lty</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="local-6989586621682579312"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682579312"><span class="hs-identifier hs-var">lty</span></a></span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">uco_rty :: Coercion -&gt; Type
</span><a href="GHC.Core.TyCo.Rep.html#uco_rty"><span class="hs-identifier hs-var">uco_rty</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="local-6989586621682579313"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682579313"><span class="hs-identifier hs-var">rty</span></a></span></span><span class="hs-special">}</span><span class="hs-special">)</span><span>
</span><span id="line-2510"></span><span>      </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">LeftOrRight -&gt; (Type, Type) -&gt; Type
forall a. LeftOrRight -&gt; (a, a) -&gt; a
</span><a href="GHC.Types.Basic.html#pickLR"><span class="hs-identifier hs-var">pickLR</span></a></span><span> </span><span class="annot"><span class="annottext">LeftOrRight
</span><a href="#local-6989586621682579283"><span class="hs-identifier hs-var">which</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682579312"><span class="hs-identifier hs-var">lty</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682579313"><span class="hs-identifier hs-var">rty</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-2511"></span><span>    </span><span class="annot"><a href="#local-6989586621682579285"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#FunCo"><span class="hs-identifier hs-type">FunCo</span></a></span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">fco_afl :: Coercion -&gt; FunTyFlag
</span><a href="GHC.Core.TyCo.Rep.html#fco_afl"><span class="hs-identifier hs-var">fco_afl</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="local-6989586621682579314"><span class="annot"><span class="annottext">FunTyFlag
</span><a href="#local-6989586621682579314"><span class="hs-identifier hs-var">afl</span></a></span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">fco_afr :: Coercion -&gt; FunTyFlag
</span><a href="GHC.Core.TyCo.Rep.html#fco_afr"><span class="hs-identifier hs-var">fco_afr</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="local-6989586621682579315"><span class="annot"><span class="annottext">FunTyFlag
</span><a href="#local-6989586621682579315"><span class="hs-identifier hs-var">afr</span></a></span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">fco_mult :: Coercion -&gt; Coercion
</span><a href="GHC.Core.TyCo.Rep.html#fco_mult"><span class="hs-identifier hs-var">fco_mult</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="local-6989586621682579316"><span class="annot"><span class="annottext">Coercion
</span><a href="#local-6989586621682579316"><span class="hs-identifier hs-var">mult</span></a></span></span><span>
</span><span id="line-2512"></span><span>              </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">fco_arg :: Coercion -&gt; Coercion
</span><a href="GHC.Core.TyCo.Rep.html#fco_arg"><span class="hs-identifier hs-var">fco_arg</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="local-6989586621682579317"><span class="annot"><span class="annottext">Coercion
</span><a href="#local-6989586621682579317"><span class="hs-identifier hs-var">arg</span></a></span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">fco_res :: Coercion -&gt; Coercion
</span><a href="GHC.Core.TyCo.Rep.html#fco_res"><span class="hs-identifier hs-var">fco_res</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="local-6989586621682579318"><span class="annot"><span class="annottext">Coercion
</span><a href="#local-6989586621682579318"><span class="hs-identifier hs-var">res</span></a></span></span><span class="hs-special">}</span><span class="hs-special">)</span><span>
</span><span id="line-2513"></span><span>      </span><span class="hs-glyph">=</span><span> </span><span class="hs-comment">-- See Note [FunCo]</span><span>
</span><span id="line-2514"></span><span>        </span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#FunTy"><span class="hs-identifier hs-type">FunTy</span></a></span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">ft_af :: FunTyFlag
</span><a href="GHC.Core.TyCo.Rep.html#ft_af"><span class="hs-identifier hs-var">ft_af</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">LeftOrRight -&gt; (FunTyFlag, FunTyFlag) -&gt; FunTyFlag
forall a. LeftOrRight -&gt; (a, a) -&gt; a
</span><a href="GHC.Types.Basic.html#pickLR"><span class="hs-identifier hs-var">pickLR</span></a></span><span> </span><span class="annot"><span class="annottext">LeftOrRight
</span><a href="#local-6989586621682579283"><span class="hs-identifier hs-var">which</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">FunTyFlag
</span><a href="#local-6989586621682579314"><span class="hs-identifier hs-var">afl</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">FunTyFlag
</span><a href="#local-6989586621682579315"><span class="hs-identifier hs-var">afr</span></a></span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">ft_mult :: Type
</span><a href="GHC.Core.TyCo.Rep.html#ft_mult"><span class="hs-identifier hs-var">ft_mult</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Coercion -&gt; Type
</span><a href="#local-6989586621682579285"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="annot"><span class="annottext">Coercion
</span><a href="#local-6989586621682579316"><span class="hs-identifier hs-var">mult</span></a></span><span>
</span><span id="line-2515"></span><span>              </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">ft_arg :: Type
</span><a href="GHC.Core.TyCo.Rep.html#ft_arg"><span class="hs-identifier hs-var">ft_arg</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Coercion -&gt; Type
</span><a href="#local-6989586621682579285"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="annot"><span class="annottext">Coercion
</span><a href="#local-6989586621682579317"><span class="hs-identifier hs-var">arg</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">ft_res :: Type
</span><a href="GHC.Core.TyCo.Rep.html#ft_res"><span class="hs-identifier hs-var">ft_res</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Coercion -&gt; Type
</span><a href="#local-6989586621682579285"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="annot"><span class="annottext">Coercion
</span><a href="#local-6989586621682579318"><span class="hs-identifier hs-var">res</span></a></span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-2516"></span><span>
</span><span id="line-2517"></span><span>    </span><span class="annot"><a href="#local-6989586621682579285"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span id="local-6989586621682579323"><span class="annot"><span class="annottext">co :: Coercion
</span><a href="#local-6989586621682579323"><span class="hs-identifier hs-var">co</span></a></span></span><span class="hs-glyph">@</span><span class="hs-special">(</span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#ForAllCo"><span class="hs-identifier hs-type">ForAllCo</span></a></span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">fco_tcv :: Coercion -&gt; CoVar
</span><a href="GHC.Core.TyCo.Rep.html#fco_tcv"><span class="hs-identifier hs-var">fco_tcv</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="local-6989586621682579324"><span class="annot"><span class="annottext">CoVar
</span><a href="#local-6989586621682579324"><span class="hs-identifier hs-var">tv1</span></a></span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">fco_visL :: Coercion -&gt; ForAllTyFlag
</span><a href="GHC.Core.TyCo.Rep.html#fco_visL"><span class="hs-identifier hs-var">fco_visL</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="local-6989586621682579325"><span class="annot"><span class="annottext">ForAllTyFlag
</span><a href="#local-6989586621682579325"><span class="hs-identifier hs-var">visL</span></a></span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">fco_visR :: Coercion -&gt; ForAllTyFlag
</span><a href="GHC.Core.TyCo.Rep.html#fco_visR"><span class="hs-identifier hs-var">fco_visR</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="local-6989586621682579326"><span class="annot"><span class="annottext">ForAllTyFlag
</span><a href="#local-6989586621682579326"><span class="hs-identifier hs-var">visR</span></a></span></span><span>
</span><span id="line-2518"></span><span>                    </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">fco_kind :: Coercion -&gt; Coercion
</span><a href="GHC.Core.TyCo.Rep.html#fco_kind"><span class="hs-identifier hs-var">fco_kind</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="local-6989586621682579327"><span class="annot"><span class="annottext">Coercion
</span><a href="#local-6989586621682579327"><span class="hs-identifier hs-var">k_co</span></a></span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">fco_body :: Coercion -&gt; Coercion
</span><a href="GHC.Core.TyCo.Rep.html#fco_body"><span class="hs-identifier hs-var">fco_body</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="local-6989586621682579328"><span class="annot"><span class="annottext">Coercion
</span><a href="#local-6989586621682579328"><span class="hs-identifier hs-var">co1</span></a></span></span><span> </span><span class="hs-special">}</span><span class="hs-special">)</span><span>
</span><span id="line-2519"></span><span>      </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">LeftOrRight
</span><a href="#local-6989586621682579283"><span class="hs-identifier hs-var">which</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-2520"></span><span>          </span><span class="annot"><span class="annottext">LeftOrRight
</span><a href="GHC.Types.Basic.html#CLeft"><span class="hs-identifier hs-var">CLeft</span></a></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">CoVar -&gt; ForAllTyFlag -&gt; Type -&gt; Type
</span><a href="GHC.Core.Type.html#mkTyCoForAllTy"><span class="hs-identifier hs-var">mkTyCoForAllTy</span></a></span><span> </span><span class="annot"><span class="annottext">CoVar
</span><a href="#local-6989586621682579324"><span class="hs-identifier hs-var">tv1</span></a></span><span> </span><span class="annot"><span class="annottext">ForAllTyFlag
</span><a href="#local-6989586621682579325"><span class="hs-identifier hs-var">visL</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Coercion -&gt; Type
</span><a href="#local-6989586621682579285"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="annot"><span class="annottext">Coercion
</span><a href="#local-6989586621682579328"><span class="hs-identifier hs-var">co1</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-2521"></span><span>          </span><span class="annot"><span class="annottext">LeftOrRight
</span><a href="GHC.Types.Basic.html#CRight"><span class="hs-identifier hs-var">CRight</span></a></span><span> </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Coercion -&gt; Bool
</span><a href="GHC.Core.Coercion.html#isGReflCo"><span class="hs-identifier hs-var">isGReflCo</span></a></span><span> </span><span class="annot"><span class="annottext">Coercion
</span><a href="#local-6989586621682579327"><span class="hs-identifier hs-var">k_co</span></a></span><span>  </span><span class="hs-comment">-- kind_co always has kind `Type`, thus `isGReflCo`</span><span>
</span><span id="line-2522"></span><span>                 </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">CoVar -&gt; ForAllTyFlag -&gt; Type -&gt; Type
</span><a href="GHC.Core.Type.html#mkTyCoForAllTy"><span class="hs-identifier hs-var">mkTyCoForAllTy</span></a></span><span> </span><span class="annot"><span class="annottext">CoVar
</span><a href="#local-6989586621682579324"><span class="hs-identifier hs-var">tv1</span></a></span><span> </span><span class="annot"><span class="annottext">ForAllTyFlag
</span><a href="#local-6989586621682579326"><span class="hs-identifier hs-var">visR</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Coercion -&gt; Type
</span><a href="#local-6989586621682579285"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="annot"><span class="annottext">Coercion
</span><a href="#local-6989586621682579328"><span class="hs-identifier hs-var">co1</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-2523"></span><span>                 </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">otherwise</span></span><span>
</span><span id="line-2524"></span><span>                 </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Subst -&gt; Coercion -&gt; Type
</span><a href="#local-6989586621682579329"><span class="hs-identifier hs-var">go_forall_right</span></a></span><span> </span><span class="annot"><span class="annottext">Subst
</span><a href="#local-6989586621682579330"><span class="hs-identifier hs-var">empty_subst</span></a></span><span> </span><span class="annot"><span class="annottext">Coercion
</span><a href="#local-6989586621682579323"><span class="hs-identifier hs-var">co</span></a></span><span>
</span><span id="line-2525"></span><span>      </span><span class="hs-keyword">where</span><span>
</span><span id="line-2526"></span><span>         </span><span id="local-6989586621682579330"><span class="annot"><span class="annottext">empty_subst :: Subst
</span><a href="#local-6989586621682579330"><span class="hs-identifier hs-var hs-var">empty_subst</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">InScopeSet -&gt; Subst
</span><a href="GHC.Core.TyCo.Subst.html#mkEmptySubst"><span class="hs-identifier hs-var">mkEmptySubst</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">VarSet -&gt; InScopeSet
</span><a href="GHC.Types.Var.Env.html#mkInScopeSet"><span class="hs-identifier hs-var">mkInScopeSet</span></a></span><span> </span><span class="annot"><span class="annottext">(VarSet -&gt; InScopeSet) -&gt; VarSet -&gt; InScopeSet
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Coercion -&gt; VarSet
</span><a href="GHC.Core.TyCo.FVs.html#tyCoVarsOfCo"><span class="hs-identifier hs-var">tyCoVarsOfCo</span></a></span><span> </span><span class="annot"><span class="annottext">Coercion
</span><a href="#local-6989586621682579323"><span class="hs-identifier hs-var">co</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-2527"></span><span>
</span><span id="line-2528"></span><span>    </span><span class="hs-comment">-------------</span><span>
</span><span id="line-2529"></span><span>    </span><span id="local-6989586621682579295"><span class="annot"><span class="annottext">go_covar :: CoVar -&gt; Type
</span><a href="#local-6989586621682579295"><span class="hs-identifier hs-var hs-var">go_covar</span></a></span></span><span> </span><span id="local-6989586621682579331"><span class="annot"><span class="annottext">CoVar
</span><a href="#local-6989586621682579331"><span class="hs-identifier hs-var">cv</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">LeftOrRight -&gt; (Type, Type) -&gt; Type
forall a. LeftOrRight -&gt; (a, a) -&gt; a
</span><a href="GHC.Types.Basic.html#pickLR"><span class="hs-identifier hs-var">pickLR</span></a></span><span> </span><span class="annot"><span class="annottext">LeftOrRight
</span><a href="#local-6989586621682579283"><span class="hs-identifier hs-var">which</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">HasDebugCallStack =&gt; CoVar -&gt; Type
CoVar -&gt; Type
</span><a href="GHC.Core.Coercion.html#coVarLType"><span class="hs-identifier hs-var">coVarLType</span></a></span><span> </span><span class="annot"><span class="annottext">CoVar
</span><a href="#local-6989586621682579331"><span class="hs-identifier hs-var">cv</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">HasDebugCallStack =&gt; CoVar -&gt; Type
CoVar -&gt; Type
</span><a href="GHC.Core.Coercion.html#coVarRType"><span class="hs-identifier hs-var">coVarRType</span></a></span><span> </span><span class="annot"><span class="annottext">CoVar
</span><a href="#local-6989586621682579331"><span class="hs-identifier hs-var">cv</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-2530"></span><span>
</span><span id="line-2531"></span><span>    </span><span class="hs-comment">-------------</span><span>
</span><span id="line-2532"></span><span>    </span><span class="annot"><a href="#local-6989586621682579304"><span class="hs-identifier hs-type">go_app</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#Coercion"><span class="hs-identifier hs-type">Coercion</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#Type"><span class="hs-identifier hs-type">Type</span></a></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#Type"><span class="hs-identifier hs-type">Type</span></a></span><span>
</span><span id="line-2533"></span><span>    </span><span class="hs-comment">-- Collect up all the arguments and apply all at once</span><span>
</span><span id="line-2534"></span><span>    </span><span class="hs-comment">-- See Note [Nested InstCos]</span><span>
</span><span id="line-2535"></span><span>    </span><span id="local-6989586621682579304"><span class="annot"><span class="annottext">go_app :: Coercion -&gt; [Type] -&gt; Type
</span><a href="#local-6989586621682579304"><span class="hs-identifier hs-var hs-var">go_app</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#InstCo"><span class="hs-identifier hs-type">InstCo</span></a></span><span> </span><span id="local-6989586621682579332"><span class="annot"><span class="annottext">Coercion
</span><a href="#local-6989586621682579332"><span class="hs-identifier hs-var">co</span></a></span></span><span> </span><span id="local-6989586621682579333"><span class="annot"><span class="annottext">Coercion
</span><a href="#local-6989586621682579333"><span class="hs-identifier hs-var">arg</span></a></span></span><span class="hs-special">)</span><span> </span><span id="local-6989586621682579334"><span class="annot"><span class="annottext">[Type]
</span><a href="#local-6989586621682579334"><span class="hs-identifier hs-var">args</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Coercion -&gt; [Type] -&gt; Type
</span><a href="#local-6989586621682579304"><span class="hs-identifier hs-var">go_app</span></a></span><span> </span><span class="annot"><span class="annottext">Coercion
</span><a href="#local-6989586621682579332"><span class="hs-identifier hs-var">co</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Coercion -&gt; Type
</span><a href="#local-6989586621682579285"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="annot"><span class="annottext">Coercion
</span><a href="#local-6989586621682579333"><span class="hs-identifier hs-var">arg</span></a></span><span class="annot"><span class="annottext">Type -&gt; [Type] -&gt; [Type]
forall a. a -&gt; [a] -&gt; [a]
</span><span class="hs-glyph hs-var">:</span></span><span class="annot"><span class="annottext">[Type]
</span><a href="#local-6989586621682579334"><span class="hs-identifier hs-var">args</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-2536"></span><span>    </span><span class="annot"><a href="#local-6989586621682579304"><span class="hs-identifier hs-var">go_app</span></a></span><span> </span><span id="local-6989586621682579335"><span class="annot"><span class="annottext">Coercion
</span><a href="#local-6989586621682579335"><span class="hs-identifier hs-var">co</span></a></span></span><span>              </span><span id="local-6989586621682579336"><span class="annot"><span class="annottext">[Type]
</span><a href="#local-6989586621682579336"><span class="hs-identifier hs-var">args</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">HasDebugCallStack =&gt; Type -&gt; [Type] -&gt; Type
Type -&gt; [Type] -&gt; Type
</span><a href="GHC.Core.Type.html#piResultTys"><span class="hs-identifier hs-var">piResultTys</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Coercion -&gt; Type
</span><a href="#local-6989586621682579285"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="annot"><span class="annottext">Coercion
</span><a href="#local-6989586621682579335"><span class="hs-identifier hs-var">co</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[Type]
</span><a href="#local-6989586621682579336"><span class="hs-identifier hs-var">args</span></a></span><span>
</span><span id="line-2537"></span><span>
</span><span id="line-2538"></span><span>    </span><span class="hs-comment">-------------</span><span>
</span><span id="line-2539"></span><span>    </span><span id="local-6989586621682579311"><span class="annot"><span class="annottext">go_ax :: CoAxiomRule -&gt; [Coercion] -&gt; Type
</span><a href="#local-6989586621682579311"><span class="hs-identifier hs-var hs-var">go_ax</span></a></span></span><span> </span><span id="local-6989586621682579338"><span class="annot"><span class="annottext">axr :: CoAxiomRule
</span><a href="#local-6989586621682579338"><span class="hs-identifier hs-var">axr</span></a></span></span><span class="hs-glyph">@</span><span class="hs-special">(</span><span class="annot"><a href="GHC.Core.Coercion.Axiom.html#BuiltInFamRew"><span class="hs-identifier hs-type">BuiltInFamRew</span></a></span><span>  </span><span id="local-6989586621682579340"><span class="annot"><span class="annottext">BuiltInFamRewrite
</span><a href="#local-6989586621682579340"><span class="hs-identifier hs-var">bif</span></a></span></span><span class="hs-special">)</span><span> </span><span id="local-6989586621682579341"><span class="annot"><span class="annottext">[Coercion]
</span><a href="#local-6989586621682579341"><span class="hs-identifier hs-var">cos</span></a></span></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">CoAxiomRule -&gt; Maybe (Pair Type) -&gt; Type
</span><a href="#local-6989586621682579342"><span class="hs-identifier hs-var">check_bif_res</span></a></span><span> </span><span class="annot"><span class="annottext">CoAxiomRule
</span><a href="#local-6989586621682579338"><span class="hs-identifier hs-var">axr</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">BuiltInFamRewrite -&gt; [Pair Type] -&gt; Maybe (Pair Type)
</span><a href="GHC.Core.Coercion.Axiom.html#bifrw_proves"><span class="hs-identifier hs-var">bifrw_proves</span></a></span><span>  </span><span class="annot"><span class="annottext">BuiltInFamRewrite
</span><a href="#local-6989586621682579340"><span class="hs-identifier hs-var">bif</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(Coercion -&gt; Pair Type) -&gt; [Coercion] -&gt; [Pair Type]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><span class="hs-identifier hs-var">map</span></span><span> </span><span class="annot"><span class="annottext">HasDebugCallStack =&gt; Coercion -&gt; Pair Type
Coercion -&gt; Pair Type
</span><a href="GHC.Core.Coercion.html#coercionKind"><span class="hs-identifier hs-var">coercionKind</span></a></span><span> </span><span class="annot"><span class="annottext">[Coercion]
</span><a href="#local-6989586621682579341"><span class="hs-identifier hs-var">cos</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-2540"></span><span>    </span><span class="annot"><a href="#local-6989586621682579311"><span class="hs-identifier hs-var">go_ax</span></a></span><span> </span><span id="local-6989586621682579344"><span class="annot"><span class="annottext">axr :: CoAxiomRule
</span><a href="#local-6989586621682579344"><span class="hs-identifier hs-var">axr</span></a></span></span><span class="hs-glyph">@</span><span class="hs-special">(</span><span class="annot"><a href="GHC.Core.Coercion.Axiom.html#BuiltInFamInj"><span class="hs-identifier hs-type">BuiltInFamInj</span></a></span><span> </span><span id="local-6989586621682579346"><span class="annot"><span class="annottext">BuiltInFamInjectivity
</span><a href="#local-6989586621682579346"><span class="hs-identifier hs-var">bif</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-special">[</span><span id="local-6989586621682579347"><span class="annot"><span class="annottext">Coercion
</span><a href="#local-6989586621682579347"><span class="hs-identifier hs-var">co</span></a></span></span><span class="hs-special">]</span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">CoAxiomRule -&gt; Maybe (Pair Type) -&gt; Type
</span><a href="#local-6989586621682579342"><span class="hs-identifier hs-var">check_bif_res</span></a></span><span> </span><span class="annot"><span class="annottext">CoAxiomRule
</span><a href="#local-6989586621682579344"><span class="hs-identifier hs-var">axr</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">BuiltInFamInjectivity -&gt; Pair Type -&gt; Maybe (Pair Type)
</span><a href="GHC.Core.Coercion.Axiom.html#bifinj_proves"><span class="hs-identifier hs-var">bifinj_proves</span></a></span><span> </span><span class="annot"><span class="annottext">BuiltInFamInjectivity
</span><a href="#local-6989586621682579346"><span class="hs-identifier hs-var">bif</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">HasDebugCallStack =&gt; Coercion -&gt; Pair Type
Coercion -&gt; Pair Type
</span><a href="GHC.Core.Coercion.html#coercionKind"><span class="hs-identifier hs-var">coercionKind</span></a></span><span> </span><span class="annot"><span class="annottext">Coercion
</span><a href="#local-6989586621682579347"><span class="hs-identifier hs-var">co</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-2541"></span><span>    </span><span class="annot"><a href="#local-6989586621682579311"><span class="hs-identifier hs-var">go_ax</span></a></span><span> </span><span id="local-6989586621682579349"><span class="annot"><span class="annottext">axr :: CoAxiomRule
</span><a href="#local-6989586621682579349"><span class="hs-identifier hs-var">axr</span></a></span></span><span class="hs-glyph">@</span><span class="hs-special">(</span><span class="annot"><a href="GHC.Core.Coercion.Axiom.html#BuiltInFamInj"><span class="hs-identifier hs-type">BuiltInFamInj</span></a></span><span> </span><span class="hs-special">{</span><span class="hs-special">}</span><span class="hs-special">)</span><span>  </span><span class="annot"><span class="annottext">[Coercion]
</span><span class="hs-identifier">_</span></span><span>     </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">CoAxiomRule -&gt; Type
</span><a href="#local-6989586621682579350"><span class="hs-identifier hs-var">crash</span></a></span><span> </span><span class="annot"><span class="annottext">CoAxiomRule
</span><a href="#local-6989586621682579349"><span class="hs-identifier hs-var">axr</span></a></span><span>
</span><span id="line-2542"></span><span>    </span><span class="annot"><a href="#local-6989586621682579311"><span class="hs-identifier hs-var">go_ax</span></a></span><span>     </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Core.Coercion.Axiom.html#UnbranchedAxiom"><span class="hs-identifier hs-type">UnbranchedAxiom</span></a></span><span> </span><span id="local-6989586621682579351"><span class="annot"><span class="annottext">CoAxiom Unbranched
</span><a href="#local-6989586621682579351"><span class="hs-identifier hs-var">ax</span></a></span></span><span class="hs-special">)</span><span> </span><span id="local-6989586621682579352"><span class="annot"><span class="annottext">[Coercion]
</span><a href="#local-6989586621682579352"><span class="hs-identifier hs-var">cos</span></a></span></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">CoAxiom Unbranched -&gt; CoAxBranch -&gt; [Coercion] -&gt; Type
forall (br :: BranchFlag).
CoAxiom br -&gt; CoAxBranch -&gt; [Coercion] -&gt; Type
</span><a href="#local-6989586621682579353"><span class="hs-identifier hs-var">go_branch</span></a></span><span> </span><span class="annot"><span class="annottext">CoAxiom Unbranched
</span><a href="#local-6989586621682579351"><span class="hs-identifier hs-var">ax</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">CoAxiom Unbranched -&gt; CoAxBranch
</span><a href="GHC.Core.Coercion.Axiom.html#coAxiomSingleBranch"><span class="hs-identifier hs-var">coAxiomSingleBranch</span></a></span><span> </span><span class="annot"><span class="annottext">CoAxiom Unbranched
</span><a href="#local-6989586621682579351"><span class="hs-identifier hs-var">ax</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[Coercion]
</span><a href="#local-6989586621682579352"><span class="hs-identifier hs-var">cos</span></a></span><span>
</span><span id="line-2543"></span><span>    </span><span class="annot"><a href="#local-6989586621682579311"><span class="hs-identifier hs-var">go_ax</span></a></span><span>     </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Core.Coercion.Axiom.html#BranchedAxiom"><span class="hs-identifier hs-type">BranchedAxiom</span></a></span><span> </span><span id="local-6989586621682579356"><span class="annot"><span class="annottext">CoAxiom Branched
</span><a href="#local-6989586621682579356"><span class="hs-identifier hs-var">ax</span></a></span></span><span> </span><span id="local-6989586621682579357"><span class="annot"><span class="annottext">Arity
</span><a href="#local-6989586621682579357"><span class="hs-identifier hs-var">i</span></a></span></span><span class="hs-special">)</span><span> </span><span id="local-6989586621682579358"><span class="annot"><span class="annottext">[Coercion]
</span><a href="#local-6989586621682579358"><span class="hs-identifier hs-var">cos</span></a></span></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">CoAxiom Branched -&gt; CoAxBranch -&gt; [Coercion] -&gt; Type
forall (br :: BranchFlag).
CoAxiom br -&gt; CoAxBranch -&gt; [Coercion] -&gt; Type
</span><a href="#local-6989586621682579353"><span class="hs-identifier hs-var">go_branch</span></a></span><span> </span><span class="annot"><span class="annottext">CoAxiom Branched
</span><a href="#local-6989586621682579356"><span class="hs-identifier hs-var">ax</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">CoAxiom Branched -&gt; Arity -&gt; CoAxBranch
forall (br :: BranchFlag). CoAxiom br -&gt; Arity -&gt; CoAxBranch
</span><a href="GHC.Core.Coercion.Axiom.html#coAxiomNthBranch"><span class="hs-identifier hs-var">coAxiomNthBranch</span></a></span><span> </span><span class="annot"><span class="annottext">CoAxiom Branched
</span><a href="#local-6989586621682579356"><span class="hs-identifier hs-var">ax</span></a></span><span> </span><span class="annot"><span class="annottext">Arity
</span><a href="#local-6989586621682579357"><span class="hs-identifier hs-var">i</span></a></span><span class="hs-special">)</span><span>  </span><span class="annot"><span class="annottext">[Coercion]
</span><a href="#local-6989586621682579358"><span class="hs-identifier hs-var">cos</span></a></span><span>
</span><span id="line-2544"></span><span>
</span><span id="line-2545"></span><span>    </span><span class="hs-comment">-------------</span><span>
</span><span id="line-2546"></span><span>    </span><span id="local-6989586621682579342"><span class="annot"><span class="annottext">check_bif_res :: CoAxiomRule -&gt; Maybe (Pair Type) -&gt; Type
</span><a href="#local-6989586621682579342"><span class="hs-identifier hs-var hs-var">check_bif_res</span></a></span></span><span> </span><span class="annot"><span class="annottext">CoAxiomRule
</span><span class="hs-identifier">_</span></span><span>   </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Data.Pair.html#Pair"><span class="hs-identifier hs-type">Pair</span></a></span><span> </span><span id="local-6989586621682579359"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682579359"><span class="hs-identifier hs-var">lhs</span></a></span></span><span> </span><span id="local-6989586621682579360"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682579360"><span class="hs-identifier hs-var">rhs</span></a></span></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">LeftOrRight -&gt; (Type, Type) -&gt; Type
forall a. LeftOrRight -&gt; (a, a) -&gt; a
</span><a href="GHC.Types.Basic.html#pickLR"><span class="hs-identifier hs-var">pickLR</span></a></span><span> </span><span class="annot"><span class="annottext">LeftOrRight
</span><a href="#local-6989586621682579283"><span class="hs-identifier hs-var">which</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682579359"><span class="hs-identifier hs-var">lhs</span></a></span><span class="hs-special">,</span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682579360"><span class="hs-identifier hs-var">rhs</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-2547"></span><span>    </span><span class="annot"><a href="#local-6989586621682579342"><span class="hs-identifier hs-var">check_bif_res</span></a></span><span> </span><span id="local-6989586621682579361"><span class="annot"><span class="annottext">CoAxiomRule
</span><a href="#local-6989586621682579361"><span class="hs-identifier hs-var">axr</span></a></span></span><span> </span><span class="annot"><span class="annottext">Maybe (Pair Type)
</span><span class="hs-identifier hs-var">Nothing</span></span><span>               </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">CoAxiomRule -&gt; Type
</span><a href="#local-6989586621682579350"><span class="hs-identifier hs-var">crash</span></a></span><span> </span><span class="annot"><span class="annottext">CoAxiomRule
</span><a href="#local-6989586621682579361"><span class="hs-identifier hs-var">axr</span></a></span><span>
</span><span id="line-2548"></span><span>
</span><span id="line-2549"></span><span>    </span><span class="annot"><a href="#local-6989586621682579350"><span class="hs-identifier hs-type">crash</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Core.Coercion.Axiom.html#CoAxiomRule"><span class="hs-identifier hs-type">CoAxiomRule</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#Type"><span class="hs-identifier hs-type">Type</span></a></span><span>
</span><span id="line-2550"></span><span>    </span><span id="local-6989586621682579350"><span class="annot"><span class="annottext">crash :: CoAxiomRule -&gt; Type
</span><a href="#local-6989586621682579350"><span class="hs-identifier hs-var hs-var">crash</span></a></span></span><span> </span><span id="local-6989586621682579362"><span class="annot"><span class="annottext">CoAxiomRule
</span><a href="#local-6989586621682579362"><span class="hs-identifier hs-var">axr</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">String -&gt; SDoc -&gt; Type
forall a. HasCallStack =&gt; String -&gt; SDoc -&gt; a
</span><a href="GHC.Utils.Panic.html#pprPanic"><span class="hs-identifier hs-var">pprPanic</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;coercionKind&quot;</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">CoAxiomRule -&gt; SDoc
forall a. Outputable a =&gt; a -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="annot"><span class="annottext">CoAxiomRule
</span><a href="#local-6989586621682579362"><span class="hs-identifier hs-var">axr</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-2551"></span><span>
</span><span id="line-2552"></span><span>    </span><span class="hs-comment">-------------</span><span>
</span><span id="line-2553"></span><span>    </span><span id="local-6989586621682577402"><span class="annot"><a href="#local-6989586621682579353"><span class="hs-identifier hs-type">go_branch</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Core.Coercion.Axiom.html#CoAxiom"><span class="hs-identifier hs-type">CoAxiom</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682577402"><span class="hs-identifier hs-type">br</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Core.Coercion.Axiom.html#CoAxBranch"><span class="hs-identifier hs-type">CoAxBranch</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#Coercion"><span class="hs-identifier hs-type">Coercion</span></a></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#Type"><span class="hs-identifier hs-type">Type</span></a></span></span><span>
</span><span id="line-2554"></span><span>    </span><span id="local-6989586621682579353"><span class="annot"><span class="annottext">go_branch :: forall (br :: BranchFlag).
CoAxiom br -&gt; CoAxBranch -&gt; [Coercion] -&gt; Type
</span><a href="#local-6989586621682579353"><span class="hs-identifier hs-var hs-var">go_branch</span></a></span></span><span> </span><span id="local-6989586621682579367"><span class="annot"><span class="annottext">CoAxiom br
</span><a href="#local-6989586621682579367"><span class="hs-identifier hs-var">ax</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Core.Coercion.Axiom.html#CoAxBranch"><span class="hs-identifier hs-type">CoAxBranch</span></a></span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">cab_tvs :: CoAxBranch -&gt; [CoVar]
</span><a href="GHC.Core.Coercion.Axiom.html#cab_tvs"><span class="hs-identifier hs-var">cab_tvs</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="local-6989586621682579368"><span class="annot"><span class="annottext">[CoVar]
</span><a href="#local-6989586621682579368"><span class="hs-identifier hs-var">tvs</span></a></span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">cab_cvs :: CoAxBranch -&gt; [CoVar]
</span><a href="GHC.Core.Coercion.Axiom.html#cab_cvs"><span class="hs-identifier hs-var">cab_cvs</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="local-6989586621682579370"><span class="annot"><span class="annottext">[CoVar]
</span><a href="#local-6989586621682579370"><span class="hs-identifier hs-var">cvs</span></a></span></span><span>
</span><span id="line-2555"></span><span>                             </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">cab_lhs :: CoAxBranch -&gt; [Type]
</span><a href="GHC.Core.Coercion.Axiom.html#cab_lhs"><span class="hs-identifier hs-var">cab_lhs</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="local-6989586621682579371"><span class="annot"><span class="annottext">[Type]
</span><a href="#local-6989586621682579371"><span class="hs-identifier hs-var">lhs_tys</span></a></span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">cab_rhs :: CoAxBranch -&gt; Type
</span><a href="GHC.Core.Coercion.Axiom.html#cab_rhs"><span class="hs-identifier hs-var">cab_rhs</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="local-6989586621682579372"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682579372"><span class="hs-identifier hs-var">rhs_ty</span></a></span></span><span> </span><span class="hs-special">}</span><span class="hs-special">)</span><span> </span><span id="local-6989586621682579373"><span class="annot"><span class="annottext">[Coercion]
</span><a href="#local-6989586621682579373"><span class="hs-identifier hs-var">cos</span></a></span></span><span>
</span><span id="line-2556"></span><span>      </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Type -&gt; Type
forall a. HasCallStack =&gt; Bool -&gt; a -&gt; a
</span><a href="GHC.Utils.Panic.Plain.html#assert"><span class="hs-identifier hs-var">assert</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[Coercion]
</span><a href="#local-6989586621682579373"><span class="hs-identifier hs-var">cos</span></a></span><span> </span><span class="annot"><span class="annottext">[Coercion] -&gt; [CoVar] -&gt; Bool
forall a b. [a] -&gt; [b] -&gt; Bool
</span><a href="GHC.Utils.Misc.html#equalLength"><span class="hs-operator hs-var">`equalLength`</span></a></span><span> </span><span class="annot"><span class="annottext">[CoVar]
</span><a href="#local-6989586621682579374"><span class="hs-identifier hs-var">tcvs</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(Type -&gt; Type) -&gt; Type -&gt; Type
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-2557"></span><span>                  </span><span class="hs-comment">-- Invariant of AxiomRuleCo: cos should</span><span>
</span><span id="line-2558"></span><span>                  </span><span class="hs-comment">-- exactly saturate the axiom branch</span><span>
</span><span id="line-2559"></span><span>        </span><span class="hs-keyword">let</span><span> </span><span class="hs-special">(</span><span id="local-6989586621682579375"><span class="annot"><span class="annottext">[Type]
</span><a href="#local-6989586621682579375"><span class="hs-identifier hs-var">tys1</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682579376"><span class="annot"><span class="annottext">[Type]
</span><a href="#local-6989586621682579376"><span class="hs-identifier hs-var">cotys1</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[CoVar] -&gt; [Type] -&gt; ([Type], [Type])
forall b a. [b] -&gt; [a] -&gt; ([a], [a])
</span><a href="GHC.Utils.Misc.html#splitAtList"><span class="hs-identifier hs-var">splitAtList</span></a></span><span> </span><span class="annot"><span class="annottext">[CoVar]
</span><a href="#local-6989586621682579368"><span class="hs-identifier hs-var">tvs</span></a></span><span> </span><span class="annot"><span class="annottext">[Type]
</span><a href="#local-6989586621682579377"><span class="hs-identifier hs-var">tys</span></a></span><span>
</span><span id="line-2560"></span><span>            </span><span id="local-6989586621682579378"><span class="annot"><span class="annottext">cos1 :: [Coercion]
</span><a href="#local-6989586621682579378"><span class="hs-identifier hs-var hs-var">cos1</span></a></span></span><span>           </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(Type -&gt; Coercion) -&gt; [Type] -&gt; [Coercion]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><span class="hs-identifier hs-var">map</span></span><span> </span><span class="annot"><span class="annottext">Type -&gt; Coercion
</span><a href="GHC.Core.Type.html#stripCoercionTy"><span class="hs-identifier hs-var">stripCoercionTy</span></a></span><span> </span><span class="annot"><span class="annottext">[Type]
</span><a href="#local-6989586621682579376"><span class="hs-identifier hs-var">cotys1</span></a></span><span>
</span><span id="line-2561"></span><span>        </span><span class="hs-keyword">in</span><span>
</span><span id="line-2562"></span><span>        </span><span class="hs-comment">-- You might think to use</span><span>
</span><span id="line-2563"></span><span>        </span><span class="hs-comment">--        substTy (zipTCvSubst tcvs ltys) (pickLR ...)</span><span>
</span><span id="line-2564"></span><span>        </span><span class="hs-comment">-- but #25066 makes it much less efficient than the silly calls below</span><span>
</span><span id="line-2565"></span><span>        </span><span class="annot"><span class="annottext">[CoVar] -&gt; [Type] -&gt; Type -&gt; Type
HasDebugCallStack =&gt; [CoVar] -&gt; [Type] -&gt; Type -&gt; Type
</span><a href="GHC.Core.TyCo.Subst.html#substTyWith"><span class="hs-identifier hs-var">substTyWith</span></a></span><span> </span><span class="annot"><span class="annottext">[CoVar]
</span><a href="#local-6989586621682579368"><span class="hs-identifier hs-var">tvs</span></a></span><span> </span><span class="annot"><span class="annottext">[Type]
</span><a href="#local-6989586621682579375"><span class="hs-identifier hs-var">tys1</span></a></span><span>       </span><span class="annot"><span class="annottext">(Type -&gt; Type) -&gt; Type -&gt; Type
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-2566"></span><span>        </span><span class="annot"><span class="annottext">[CoVar] -&gt; [Coercion] -&gt; Type -&gt; Type
</span><a href="GHC.Core.TyCo.Subst.html#substTyWithCoVars"><span class="hs-identifier hs-var">substTyWithCoVars</span></a></span><span> </span><span class="annot"><span class="annottext">[CoVar]
</span><a href="#local-6989586621682579370"><span class="hs-identifier hs-var">cvs</span></a></span><span> </span><span class="annot"><span class="annottext">[Coercion]
</span><a href="#local-6989586621682579378"><span class="hs-identifier hs-var">cos1</span></a></span><span> </span><span class="annot"><span class="annottext">(Type -&gt; Type) -&gt; Type -&gt; Type
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-2567"></span><span>        </span><span class="annot"><span class="annottext">LeftOrRight -&gt; (Type, Type) -&gt; Type
forall a. LeftOrRight -&gt; (a, a) -&gt; a
</span><a href="GHC.Types.Basic.html#pickLR"><span class="hs-identifier hs-var">pickLR</span></a></span><span> </span><span class="annot"><span class="annottext">LeftOrRight
</span><a href="#local-6989586621682579283"><span class="hs-identifier hs-var">which</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TyCon -&gt; [Type] -&gt; Type
</span><a href="GHC.Core.Type.html#mkTyConApp"><span class="hs-identifier hs-var">mkTyConApp</span></a></span><span> </span><span class="annot"><span class="annottext">TyCon
</span><a href="#local-6989586621682579380"><span class="hs-identifier hs-var">tc</span></a></span><span> </span><span class="annot"><span class="annottext">[Type]
</span><a href="#local-6989586621682579371"><span class="hs-identifier hs-var">lhs_tys</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682579372"><span class="hs-identifier hs-var">rhs_ty</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-2568"></span><span>     </span><span class="hs-keyword">where</span><span>
</span><span id="line-2569"></span><span>       </span><span id="local-6989586621682579380"><span class="annot"><span class="annottext">tc :: TyCon
</span><a href="#local-6989586621682579380"><span class="hs-identifier hs-var hs-var">tc</span></a></span></span><span>   </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">CoAxiom br -&gt; TyCon
forall (br :: BranchFlag). CoAxiom br -&gt; TyCon
</span><a href="GHC.Core.Coercion.Axiom.html#coAxiomTyCon"><span class="hs-identifier hs-var">coAxiomTyCon</span></a></span><span> </span><span class="annot"><span class="annottext">CoAxiom br
</span><a href="#local-6989586621682579367"><span class="hs-identifier hs-var">ax</span></a></span><span>
</span><span id="line-2570"></span><span>       </span><span id="local-6989586621682579374"><span class="annot"><span class="annottext">tcvs :: [CoVar]
</span><a href="#local-6989586621682579374"><span class="hs-identifier hs-var hs-var">tcvs</span></a></span></span><span> </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">[CoVar] -&gt; Bool
forall a. [a] -&gt; Bool
forall (t :: * -&gt; *) a. Foldable t =&gt; t a -&gt; Bool
</span><span class="hs-identifier hs-var">null</span></span><span> </span><span class="annot"><span class="annottext">[CoVar]
</span><a href="#local-6989586621682579370"><span class="hs-identifier hs-var">cvs</span></a></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[CoVar]
</span><a href="#local-6989586621682579368"><span class="hs-identifier hs-var">tvs</span></a></span><span>  </span><span class="hs-comment">-- Very common case (currently always!)</span><span>
</span><span id="line-2571"></span><span>            </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">otherwise</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[CoVar]
</span><a href="#local-6989586621682579368"><span class="hs-identifier hs-var">tvs</span></a></span><span> </span><span class="annot"><span class="annottext">[CoVar] -&gt; [CoVar] -&gt; [CoVar]
forall a. [a] -&gt; [a] -&gt; [a]
</span><span class="hs-operator hs-var">++</span></span><span> </span><span class="annot"><span class="annottext">[CoVar]
</span><a href="#local-6989586621682579370"><span class="hs-identifier hs-var">cvs</span></a></span><span>
</span><span id="line-2572"></span><span>       </span><span id="local-6989586621682579377"><span class="annot"><span class="annottext">tys :: [Type]
</span><a href="#local-6989586621682579377"><span class="hs-identifier hs-var hs-var">tys</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(Coercion -&gt; Type) -&gt; [Coercion] -&gt; [Type]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><span class="hs-identifier hs-var">map</span></span><span> </span><span class="annot"><span class="annottext">Coercion -&gt; Type
</span><a href="#local-6989586621682579285"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="annot"><span class="annottext">[Coercion]
</span><a href="#local-6989586621682579373"><span class="hs-identifier hs-var">cos</span></a></span><span>
</span><span id="line-2573"></span><span>
</span><span id="line-2574"></span><span>    </span><span class="hs-comment">-------------</span><span>
</span><span id="line-2575"></span><span>    </span><span id="local-6989586621682579329"><span class="annot"><span class="annottext">go_forall_right :: Subst -&gt; Coercion -&gt; Type
</span><a href="#local-6989586621682579329"><span class="hs-identifier hs-var hs-var">go_forall_right</span></a></span></span><span> </span><span id="local-6989586621682579381"><span class="annot"><span class="annottext">Subst
</span><a href="#local-6989586621682579381"><span class="hs-identifier hs-var">subst</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#ForAllCo"><span class="hs-identifier hs-type">ForAllCo</span></a></span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">fco_tcv :: Coercion -&gt; CoVar
</span><a href="GHC.Core.TyCo.Rep.html#fco_tcv"><span class="hs-identifier hs-var">fco_tcv</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="local-6989586621682579382"><span class="annot"><span class="annottext">CoVar
</span><a href="#local-6989586621682579382"><span class="hs-identifier hs-var">tv1</span></a></span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">fco_visR :: Coercion -&gt; ForAllTyFlag
</span><a href="GHC.Core.TyCo.Rep.html#fco_visR"><span class="hs-identifier hs-var">fco_visR</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="local-6989586621682579383"><span class="annot"><span class="annottext">ForAllTyFlag
</span><a href="#local-6989586621682579383"><span class="hs-identifier hs-var">visR</span></a></span></span><span>
</span><span id="line-2576"></span><span>                                    </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">fco_kind :: Coercion -&gt; Coercion
</span><a href="GHC.Core.TyCo.Rep.html#fco_kind"><span class="hs-identifier hs-var">fco_kind</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="local-6989586621682579384"><span class="annot"><span class="annottext">Coercion
</span><a href="#local-6989586621682579384"><span class="hs-identifier hs-var">k_co</span></a></span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">fco_body :: Coercion -&gt; Coercion
</span><a href="GHC.Core.TyCo.Rep.html#fco_body"><span class="hs-identifier hs-var">fco_body</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="local-6989586621682579385"><span class="annot"><span class="annottext">Coercion
</span><a href="#local-6989586621682579385"><span class="hs-identifier hs-var">co</span></a></span></span><span> </span><span class="hs-special">}</span><span class="hs-special">)</span><span>
</span><span id="line-2577"></span><span>      </span><span class="hs-comment">-- See Note [Nested ForAllCos]</span><span>
</span><span id="line-2578"></span><span>      </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">CoVar -&gt; Bool
</span><a href="GHC.Types.Var.html#isTyVar"><span class="hs-identifier hs-var">isTyVar</span></a></span><span> </span><span class="annot"><span class="annottext">CoVar
</span><a href="#local-6989586621682579382"><span class="hs-identifier hs-var">tv1</span></a></span><span>
</span><span id="line-2579"></span><span>      </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ForAllTyBinder -&gt; Type -&gt; Type
</span><a href="GHC.Core.TyCo.Rep.html#mkForAllTy"><span class="hs-identifier hs-var">mkForAllTy</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">CoVar -&gt; ForAllTyFlag -&gt; ForAllTyBinder
forall var argf. var -&gt; argf -&gt; VarBndr var argf
</span><a href="GHC.Types.Var.html#Bndr"><span class="hs-identifier hs-var">Bndr</span></a></span><span> </span><span class="annot"><span class="annottext">CoVar
</span><a href="#local-6989586621682579386"><span class="hs-identifier hs-var">tv2</span></a></span><span> </span><span class="annot"><span class="annottext">ForAllTyFlag
</span><a href="#local-6989586621682579383"><span class="hs-identifier hs-var">visR</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Subst -&gt; Coercion -&gt; Type
</span><a href="#local-6989586621682579329"><span class="hs-identifier hs-var">go_forall_right</span></a></span><span> </span><span class="annot"><span class="annottext">Subst
</span><a href="#local-6989586621682579387"><span class="hs-identifier hs-var">subst'</span></a></span><span> </span><span class="annot"><span class="annottext">Coercion
</span><a href="#local-6989586621682579385"><span class="hs-identifier hs-var">co</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-2580"></span><span>      </span><span class="hs-keyword">where</span><span>
</span><span id="line-2581"></span><span>        </span><span id="local-6989586621682579388"><span class="annot"><span class="annottext">k2 :: Type
</span><a href="#local-6989586621682579388"><span class="hs-identifier hs-var hs-var">k2</span></a></span></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">HasDebugCallStack =&gt; Coercion -&gt; Type
Coercion -&gt; Type
</span><a href="GHC.Core.Coercion.html#coercionRKind"><span class="hs-identifier hs-var">coercionRKind</span></a></span><span> </span><span class="annot"><span class="annottext">Coercion
</span><a href="#local-6989586621682579384"><span class="hs-identifier hs-var">k_co</span></a></span><span>
</span><span id="line-2582"></span><span>        </span><span id="local-6989586621682579386"><span class="annot"><span class="annottext">tv2 :: CoVar
</span><a href="#local-6989586621682579386"><span class="hs-identifier hs-var hs-var">tv2</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">CoVar -&gt; Type -&gt; CoVar
</span><a href="GHC.Types.Var.html#setTyVarKind"><span class="hs-identifier hs-var">setTyVarKind</span></a></span><span> </span><span class="annot"><span class="annottext">CoVar
</span><a href="#local-6989586621682579382"><span class="hs-identifier hs-var">tv1</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">HasDebugCallStack =&gt; Subst -&gt; Type -&gt; Type
Subst -&gt; Type -&gt; Type
</span><a href="GHC.Core.TyCo.Subst.html#substTy"><span class="hs-identifier hs-var">substTy</span></a></span><span> </span><span class="annot"><span class="annottext">Subst
</span><a href="#local-6989586621682579381"><span class="hs-identifier hs-var">subst</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682579388"><span class="hs-identifier hs-var">k2</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-2583"></span><span>        </span><span id="local-6989586621682579387"><span class="annot"><span class="annottext">subst' :: Subst
</span><a href="#local-6989586621682579387"><span class="hs-identifier hs-var hs-var">subst'</span></a></span></span><span> </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Coercion -&gt; Bool
</span><a href="GHC.Core.Coercion.html#isGReflCo"><span class="hs-identifier hs-var">isGReflCo</span></a></span><span> </span><span class="annot"><span class="annottext">Coercion
</span><a href="#local-6989586621682579384"><span class="hs-identifier hs-var">k_co</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Subst -&gt; CoVar -&gt; Subst
</span><a href="GHC.Core.TyCo.Subst.html#extendSubstInScope"><span class="hs-identifier hs-var">extendSubstInScope</span></a></span><span> </span><span class="annot"><span class="annottext">Subst
</span><a href="#local-6989586621682579381"><span class="hs-identifier hs-var">subst</span></a></span><span> </span><span class="annot"><span class="annottext">CoVar
</span><a href="#local-6989586621682579382"><span class="hs-identifier hs-var">tv1</span></a></span><span>
</span><span id="line-2584"></span><span>                 </span><span class="hs-comment">-- kind_co always has kind @Type@, thus @isGReflCo@</span><span>
</span><span id="line-2585"></span><span>               </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">otherwise</span></span><span>      </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Subst -&gt; CoVar -&gt; Type -&gt; Subst
</span><a href="GHC.Core.TyCo.Subst.html#extendTvSubst"><span class="hs-identifier hs-var">extendTvSubst</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Subst -&gt; CoVar -&gt; Subst
</span><a href="GHC.Core.TyCo.Subst.html#extendSubstInScope"><span class="hs-identifier hs-var">extendSubstInScope</span></a></span><span> </span><span class="annot"><span class="annottext">Subst
</span><a href="#local-6989586621682579381"><span class="hs-identifier hs-var">subst</span></a></span><span> </span><span class="annot"><span class="annottext">CoVar
</span><a href="#local-6989586621682579386"><span class="hs-identifier hs-var">tv2</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">CoVar
</span><a href="#local-6989586621682579382"><span class="hs-identifier hs-var">tv1</span></a></span><span> </span><span class="annot"><span class="annottext">(Type -&gt; Subst) -&gt; Type -&gt; Subst
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-2586"></span><span>                                  </span><span class="annot"><span class="annottext">CoVar -&gt; Type
</span><a href="GHC.Core.TyCo.Rep.html#TyVarTy"><span class="hs-identifier hs-var">TyVarTy</span></a></span><span> </span><span class="annot"><span class="annottext">CoVar
</span><a href="#local-6989586621682579386"><span class="hs-identifier hs-var">tv2</span></a></span><span> </span><span class="annot"><span class="annottext">Type -&gt; Coercion -&gt; Type
</span><a href="GHC.Core.Type.html#mkCastTy"><span class="hs-operator hs-var">`mkCastTy`</span></a></span><span> </span><span class="annot"><span class="annottext">Coercion -&gt; Coercion
</span><a href="GHC.Core.Coercion.html#mkSymCo"><span class="hs-identifier hs-var">mkSymCo</span></a></span><span> </span><span class="annot"><span class="annottext">Coercion
</span><a href="#local-6989586621682579384"><span class="hs-identifier hs-var">k_co</span></a></span><span>
</span><span id="line-2587"></span><span>
</span><span id="line-2588"></span><span>    </span><span class="annot"><a href="#local-6989586621682579329"><span class="hs-identifier hs-var">go_forall_right</span></a></span><span> </span><span id="local-6989586621682579391"><span class="annot"><span class="annottext">Subst
</span><a href="#local-6989586621682579391"><span class="hs-identifier hs-var">subst</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#ForAllCo"><span class="hs-identifier hs-type">ForAllCo</span></a></span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">fco_tcv :: Coercion -&gt; CoVar
</span><a href="GHC.Core.TyCo.Rep.html#fco_tcv"><span class="hs-identifier hs-var">fco_tcv</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="local-6989586621682579392"><span class="annot"><span class="annottext">CoVar
</span><a href="#local-6989586621682579392"><span class="hs-identifier hs-var">cv1</span></a></span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">fco_visR :: Coercion -&gt; ForAllTyFlag
</span><a href="GHC.Core.TyCo.Rep.html#fco_visR"><span class="hs-identifier hs-var">fco_visR</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="local-6989586621682579393"><span class="annot"><span class="annottext">ForAllTyFlag
</span><a href="#local-6989586621682579393"><span class="hs-identifier hs-var">visR</span></a></span></span><span>
</span><span id="line-2589"></span><span>                                    </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">fco_kind :: Coercion -&gt; Coercion
</span><a href="GHC.Core.TyCo.Rep.html#fco_kind"><span class="hs-identifier hs-var">fco_kind</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="local-6989586621682579394"><span class="annot"><span class="annottext">Coercion
</span><a href="#local-6989586621682579394"><span class="hs-identifier hs-var">k_co</span></a></span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">fco_body :: Coercion -&gt; Coercion
</span><a href="GHC.Core.TyCo.Rep.html#fco_body"><span class="hs-identifier hs-var">fco_body</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="local-6989586621682579395"><span class="annot"><span class="annottext">Coercion
</span><a href="#local-6989586621682579395"><span class="hs-identifier hs-var">co</span></a></span></span><span> </span><span class="hs-special">}</span><span class="hs-special">)</span><span>
</span><span id="line-2590"></span><span>      </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">CoVar -&gt; Bool
</span><a href="GHC.Types.Var.html#isCoVar"><span class="hs-identifier hs-var">isCoVar</span></a></span><span> </span><span class="annot"><span class="annottext">CoVar
</span><a href="#local-6989586621682579392"><span class="hs-identifier hs-var">cv1</span></a></span><span>
</span><span id="line-2591"></span><span>      </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">CoVar -&gt; ForAllTyFlag -&gt; Type -&gt; Type
</span><a href="GHC.Core.Type.html#mkTyCoForAllTy"><span class="hs-identifier hs-var">mkTyCoForAllTy</span></a></span><span> </span><span class="annot"><span class="annottext">CoVar
</span><a href="#local-6989586621682579396"><span class="hs-identifier hs-var">cv2</span></a></span><span> </span><span class="annot"><span class="annottext">ForAllTyFlag
</span><a href="#local-6989586621682579393"><span class="hs-identifier hs-var">visR</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Subst -&gt; Coercion -&gt; Type
</span><a href="#local-6989586621682579329"><span class="hs-identifier hs-var">go_forall_right</span></a></span><span> </span><span class="annot"><span class="annottext">Subst
</span><a href="#local-6989586621682579397"><span class="hs-identifier hs-var">subst'</span></a></span><span> </span><span class="annot"><span class="annottext">Coercion
</span><a href="#local-6989586621682579395"><span class="hs-identifier hs-var">co</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-2592"></span><span>      </span><span class="hs-keyword">where</span><span>
</span><span id="line-2593"></span><span>        </span><span id="local-6989586621682579398"><span class="annot"><span class="annottext">k2 :: Type
</span><a href="#local-6989586621682579398"><span class="hs-identifier hs-var hs-var">k2</span></a></span></span><span>    </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">HasDebugCallStack =&gt; Coercion -&gt; Type
Coercion -&gt; Type
</span><a href="GHC.Core.Coercion.html#coercionRKind"><span class="hs-identifier hs-var">coercionRKind</span></a></span><span> </span><span class="annot"><span class="annottext">Coercion
</span><a href="#local-6989586621682579394"><span class="hs-identifier hs-var">k_co</span></a></span><span>
</span><span id="line-2594"></span><span>        </span><span id="local-6989586621682579399"><span class="annot"><span class="annottext">r :: Role
</span><a href="#local-6989586621682579399"><span class="hs-identifier hs-var hs-var">r</span></a></span></span><span>     </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">CoVar -&gt; Role
</span><a href="GHC.Core.Coercion.html#coVarRole"><span class="hs-identifier hs-var">coVarRole</span></a></span><span> </span><span class="annot"><span class="annottext">CoVar
</span><a href="#local-6989586621682579392"><span class="hs-identifier hs-var">cv1</span></a></span><span>
</span><span id="line-2595"></span><span>        </span><span id="local-6989586621682579400"><span class="annot"><span class="annottext">k_co' :: Coercion
</span><a href="#local-6989586621682579400"><span class="hs-identifier hs-var hs-var">k_co'</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Role -&gt; Role -&gt; Coercion -&gt; Coercion
</span><a href="GHC.Core.Coercion.html#downgradeRole"><span class="hs-identifier hs-var">downgradeRole</span></a></span><span> </span><span class="annot"><span class="annottext">Role
</span><a href="#local-6989586621682579399"><span class="hs-identifier hs-var">r</span></a></span><span> </span><span class="annot"><span class="annottext">Role
</span><a href="Language.Haskell.Syntax.Basic.html#Nominal"><span class="hs-identifier hs-var">Nominal</span></a></span><span> </span><span class="annot"><span class="annottext">Coercion
</span><a href="#local-6989586621682579394"><span class="hs-identifier hs-var">k_co</span></a></span><span>
</span><span id="line-2596"></span><span>        </span><span id="local-6989586621682579401"><span class="annot"><span class="annottext">eta1 :: Coercion
</span><a href="#local-6989586621682579401"><span class="hs-identifier hs-var hs-var">eta1</span></a></span></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">HasDebugCallStack =&gt; CoSel -&gt; Coercion -&gt; Coercion
CoSel -&gt; Coercion -&gt; Coercion
</span><a href="GHC.Core.Coercion.html#mkSelCo"><span class="hs-identifier hs-var">mkSelCo</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Arity -&gt; Role -&gt; CoSel
</span><a href="GHC.Core.TyCo.Rep.html#SelTyCon"><span class="hs-identifier hs-var">SelTyCon</span></a></span><span> </span><span class="annot"><span class="annottext">Arity
</span><span class="hs-number">2</span></span><span> </span><span class="annot"><span class="annottext">Role
</span><a href="#local-6989586621682579399"><span class="hs-identifier hs-var">r</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Coercion
</span><a href="#local-6989586621682579400"><span class="hs-identifier hs-var">k_co'</span></a></span><span>
</span><span id="line-2597"></span><span>        </span><span id="local-6989586621682579402"><span class="annot"><span class="annottext">eta2 :: Coercion
</span><a href="#local-6989586621682579402"><span class="hs-identifier hs-var hs-var">eta2</span></a></span></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">HasDebugCallStack =&gt; CoSel -&gt; Coercion -&gt; Coercion
CoSel -&gt; Coercion -&gt; Coercion
</span><a href="GHC.Core.Coercion.html#mkSelCo"><span class="hs-identifier hs-var">mkSelCo</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Arity -&gt; Role -&gt; CoSel
</span><a href="GHC.Core.TyCo.Rep.html#SelTyCon"><span class="hs-identifier hs-var">SelTyCon</span></a></span><span> </span><span class="annot"><span class="annottext">Arity
</span><span class="hs-number">3</span></span><span> </span><span class="annot"><span class="annottext">Role
</span><a href="#local-6989586621682579399"><span class="hs-identifier hs-var">r</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Coercion
</span><a href="#local-6989586621682579400"><span class="hs-identifier hs-var">k_co'</span></a></span><span>
</span><span id="line-2598"></span><span>
</span><span id="line-2599"></span><span>        </span><span class="hs-comment">-- k_co :: (t1 ~r t2) ~N (s1 ~r s2)</span><span>
</span><span id="line-2600"></span><span>        </span><span class="hs-comment">-- k1    = t1 ~r t2</span><span>
</span><span id="line-2601"></span><span>        </span><span class="hs-comment">-- k2    = s1 ~r s2</span><span>
</span><span id="line-2602"></span><span>        </span><span class="hs-comment">-- cv1  :: t1 ~r t2</span><span>
</span><span id="line-2603"></span><span>        </span><span class="hs-comment">-- cv2  :: s1 ~r s2</span><span>
</span><span id="line-2604"></span><span>        </span><span class="hs-comment">-- eta1 :: t1 ~r s1</span><span>
</span><span id="line-2605"></span><span>        </span><span class="hs-comment">-- eta2 :: t2 ~r s2</span><span>
</span><span id="line-2606"></span><span>        </span><span class="hs-comment">-- n_subst  = (eta1 ; cv2 ; sym eta2) :: t1 ~r t2</span><span>
</span><span id="line-2607"></span><span>
</span><span id="line-2608"></span><span>        </span><span id="local-6989586621682579396"><span class="annot"><span class="annottext">cv2 :: CoVar
</span><a href="#local-6989586621682579396"><span class="hs-identifier hs-var hs-var">cv2</span></a></span></span><span>     </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">CoVar -&gt; Type -&gt; CoVar
</span><a href="GHC.Types.Var.html#setVarType"><span class="hs-identifier hs-var">setVarType</span></a></span><span> </span><span class="annot"><span class="annottext">CoVar
</span><a href="#local-6989586621682579392"><span class="hs-identifier hs-var">cv1</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">HasDebugCallStack =&gt; Subst -&gt; Type -&gt; Type
Subst -&gt; Type -&gt; Type
</span><a href="GHC.Core.TyCo.Subst.html#substTy"><span class="hs-identifier hs-var">substTy</span></a></span><span> </span><span class="annot"><span class="annottext">Subst
</span><a href="#local-6989586621682579391"><span class="hs-identifier hs-var">subst</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682579398"><span class="hs-identifier hs-var">k2</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-2609"></span><span>        </span><span id="local-6989586621682579403"><span class="annot"><span class="annottext">n_subst :: Coercion
</span><a href="#local-6989586621682579403"><span class="hs-identifier hs-var hs-var">n_subst</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Coercion
</span><a href="#local-6989586621682579401"><span class="hs-identifier hs-var">eta1</span></a></span><span> </span><span class="annot"><span class="annottext">HasDebugCallStack =&gt; Coercion -&gt; Coercion -&gt; Coercion
Coercion -&gt; Coercion -&gt; Coercion
</span><a href="GHC.Core.Coercion.html#mkTransCo"><span class="hs-operator hs-var">`mkTransCo`</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">CoVar -&gt; Coercion
</span><a href="GHC.Core.Coercion.html#mkCoVarCo"><span class="hs-identifier hs-var">mkCoVarCo</span></a></span><span> </span><span class="annot"><span class="annottext">CoVar
</span><a href="#local-6989586621682579396"><span class="hs-identifier hs-var">cv2</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">HasDebugCallStack =&gt; Coercion -&gt; Coercion -&gt; Coercion
Coercion -&gt; Coercion -&gt; Coercion
</span><a href="GHC.Core.Coercion.html#mkTransCo"><span class="hs-operator hs-var">`mkTransCo`</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Coercion -&gt; Coercion
</span><a href="GHC.Core.Coercion.html#mkSymCo"><span class="hs-identifier hs-var">mkSymCo</span></a></span><span> </span><span class="annot"><span class="annottext">Coercion
</span><a href="#local-6989586621682579402"><span class="hs-identifier hs-var">eta2</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-2610"></span><span>        </span><span id="local-6989586621682579397"><span class="annot"><span class="annottext">subst' :: Subst
</span><a href="#local-6989586621682579397"><span class="hs-identifier hs-var hs-var">subst'</span></a></span></span><span>  </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Coercion -&gt; Bool
</span><a href="GHC.Core.Coercion.html#isReflCo"><span class="hs-identifier hs-var">isReflCo</span></a></span><span> </span><span class="annot"><span class="annottext">Coercion
</span><a href="#local-6989586621682579394"><span class="hs-identifier hs-var">k_co</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Subst -&gt; CoVar -&gt; Subst
</span><a href="GHC.Core.TyCo.Subst.html#extendSubstInScope"><span class="hs-identifier hs-var">extendSubstInScope</span></a></span><span> </span><span class="annot"><span class="annottext">Subst
</span><a href="#local-6989586621682579391"><span class="hs-identifier hs-var">subst</span></a></span><span> </span><span class="annot"><span class="annottext">CoVar
</span><a href="#local-6989586621682579392"><span class="hs-identifier hs-var">cv1</span></a></span><span>
</span><span id="line-2611"></span><span>                </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">otherwise</span></span><span>     </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Subst -&gt; CoVar -&gt; Coercion -&gt; Subst
</span><a href="GHC.Core.TyCo.Subst.html#extendCvSubst"><span class="hs-identifier hs-var">extendCvSubst</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Subst -&gt; CoVar -&gt; Subst
</span><a href="GHC.Core.TyCo.Subst.html#extendSubstInScope"><span class="hs-identifier hs-var">extendSubstInScope</span></a></span><span> </span><span class="annot"><span class="annottext">Subst
</span><a href="#local-6989586621682579391"><span class="hs-identifier hs-var">subst</span></a></span><span> </span><span class="annot"><span class="annottext">CoVar
</span><a href="#local-6989586621682579396"><span class="hs-identifier hs-var">cv2</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-2612"></span><span>                                                </span><span class="annot"><span class="annottext">CoVar
</span><a href="#local-6989586621682579392"><span class="hs-identifier hs-var">cv1</span></a></span><span> </span><span class="annot"><span class="annottext">Coercion
</span><a href="#local-6989586621682579403"><span class="hs-identifier hs-var">n_subst</span></a></span><span>
</span><span id="line-2613"></span><span>
</span><span id="line-2614"></span><span>    </span><span class="annot"><a href="#local-6989586621682579329"><span class="hs-identifier hs-var">go_forall_right</span></a></span><span> </span><span id="local-6989586621682579404"><span class="annot"><span class="annottext">Subst
</span><a href="#local-6989586621682579404"><span class="hs-identifier hs-var">subst</span></a></span></span><span> </span><span id="local-6989586621682579405"><span class="annot"><span class="annottext">Coercion
</span><a href="#local-6989586621682579405"><span class="hs-identifier hs-var">other_co</span></a></span></span><span>
</span><span id="line-2615"></span><span>      </span><span class="hs-comment">-- when other_co is not a ForAllCo</span><span>
</span><span id="line-2616"></span><span>      </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">HasDebugCallStack =&gt; Subst -&gt; Type -&gt; Type
Subst -&gt; Type -&gt; Type
</span><a href="GHC.Core.TyCo.Subst.html#substTy"><span class="hs-identifier hs-var">substTy</span></a></span><span> </span><span class="annot"><span class="annottext">Subst
</span><a href="#local-6989586621682579404"><span class="hs-identifier hs-var">subst</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Coercion -&gt; Type
</span><a href="#local-6989586621682579285"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="annot"><span class="annottext">Coercion
</span><a href="#local-6989586621682579405"><span class="hs-identifier hs-var">other_co</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-2617"></span><span>
</span><span id="line-2618"></span><span class="hs-comment">{- Note [Nested ForAllCos]
~~~~~~~~~~~~~~~~~~~~~~~~~~
Suppose we need `coercionKind (ForAllCo a1 (ForAllCo a2 ... (ForAllCo an co)...) )`.
We do not want to perform `n` single-type-variable substitutions over the kind
of `co`; rather we want to do one substitution which substitutes for all of
`a1`, `a2` ... simultaneously.  If we do one at a time we get the performance
hole reported in #11735.

Solution: gather up the type variables for nested `ForAllCos`, and
substitute for them all at once.  Remarkably, for #11735 this single
change reduces /total/ compile time by a factor of more than ten.

Note [Nested InstCos]
~~~~~~~~~~~~~~~~~~~~~
In #5631 we found that 70% of the entire compilation time was
being spent in coercionKind!  The reason was that we had
   (g @ ty1 @ ty2 .. @ ty100)    -- The &quot;@s&quot; are InstCos
where
   g :: forall a1 a2 .. a100. phi
If we deal with the InstCos one at a time, we'll do this:
   1.  Find the kind of (g @ ty1 .. @ ty99) : forall a100. phi'
   2.  Substitute phi'[ ty100/a100 ], a single tyvar-&gt;type subst
But this is a *quadratic* algorithm, and the blew up #5631.
So it's very important to do the substitution simultaneously;
cf Type.piResultTys (which in fact we call here).
-}</span><span>
</span><span id="line-2644"></span><span>
</span><span id="line-2645"></span><span class="annot"><span class="hs-comment">-- | Retrieve the role from a coercion.</span></span><span>
</span><span id="line-2646"></span><span class="annot"><a href="GHC.Core.Coercion.html#coercionRole"><span class="hs-identifier hs-type">coercionRole</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#Coercion"><span class="hs-identifier hs-type">Coercion</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Language.Haskell.Syntax.Basic.html#Role"><span class="hs-identifier hs-type">Role</span></a></span><span>
</span><span id="line-2647"></span><span id="coercionRole"><span class="annot"><span class="annottext">coercionRole :: Coercion -&gt; Role
</span><a href="GHC.Core.Coercion.html#coercionRole"><span class="hs-identifier hs-var hs-var">coercionRole</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Coercion -&gt; Role
</span><a href="#local-6989586621682579406"><span class="hs-identifier hs-var">go</span></a></span><span>
</span><span id="line-2648"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-2649"></span><span>    </span><span id="local-6989586621682579406"><span class="annot"><span class="annottext">go :: Coercion -&gt; Role
</span><a href="#local-6989586621682579406"><span class="hs-identifier hs-var hs-var">go</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#Refl"><span class="hs-identifier hs-type">Refl</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span>                     </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Role
</span><a href="Language.Haskell.Syntax.Basic.html#Nominal"><span class="hs-identifier hs-var">Nominal</span></a></span><span>
</span><span id="line-2650"></span><span>    </span><span class="annot"><a href="#local-6989586621682579406"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#GRefl"><span class="hs-identifier hs-type">GRefl</span></a></span><span> </span><span id="local-6989586621682579407"><span class="annot"><span class="annottext">Role
</span><a href="#local-6989586621682579407"><span class="hs-identifier hs-var">r</span></a></span></span><span> </span><span class="annot"><span class="annottext">Type
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">MCoercion
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span>                </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Role
</span><a href="#local-6989586621682579407"><span class="hs-identifier hs-var">r</span></a></span><span>
</span><span id="line-2651"></span><span>    </span><span class="annot"><a href="#local-6989586621682579406"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#TyConAppCo"><span class="hs-identifier hs-type">TyConAppCo</span></a></span><span> </span><span id="local-6989586621682579408"><span class="annot"><span class="annottext">Role
</span><a href="#local-6989586621682579408"><span class="hs-identifier hs-var">r</span></a></span></span><span> </span><span class="annot"><span class="annottext">TyCon
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">[Coercion]
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span>           </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Role
</span><a href="#local-6989586621682579408"><span class="hs-identifier hs-var">r</span></a></span><span>
</span><span id="line-2652"></span><span>    </span><span class="annot"><a href="#local-6989586621682579406"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#AppCo"><span class="hs-identifier hs-type">AppCo</span></a></span><span> </span><span id="local-6989586621682579409"><span class="annot"><span class="annottext">Coercion
</span><a href="#local-6989586621682579409"><span class="hs-identifier hs-var">co1</span></a></span></span><span> </span><span class="annot"><span class="annottext">Coercion
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span>                </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Coercion -&gt; Role
</span><a href="#local-6989586621682579406"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="annot"><span class="annottext">Coercion
</span><a href="#local-6989586621682579409"><span class="hs-identifier hs-var">co1</span></a></span><span>
</span><span id="line-2653"></span><span>    </span><span class="annot"><a href="#local-6989586621682579406"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#ForAllCo"><span class="hs-identifier hs-type">ForAllCo</span></a></span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">fco_body :: Coercion -&gt; Coercion
</span><a href="GHC.Core.TyCo.Rep.html#fco_body"><span class="hs-identifier hs-var">fco_body</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="local-6989586621682579410"><span class="annot"><span class="annottext">Coercion
</span><a href="#local-6989586621682579410"><span class="hs-identifier hs-var">co</span></a></span></span><span> </span><span class="hs-special">}</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Coercion -&gt; Role
</span><a href="#local-6989586621682579406"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="annot"><span class="annottext">Coercion
</span><a href="#local-6989586621682579410"><span class="hs-identifier hs-var">co</span></a></span><span>
</span><span id="line-2654"></span><span>    </span><span class="annot"><a href="#local-6989586621682579406"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#FunCo"><span class="hs-identifier hs-type">FunCo</span></a></span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">fco_role :: Coercion -&gt; Role
</span><a href="GHC.Core.TyCo.Rep.html#fco_role"><span class="hs-identifier hs-var">fco_role</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="local-6989586621682579411"><span class="annot"><span class="annottext">Role
</span><a href="#local-6989586621682579411"><span class="hs-identifier hs-var">r</span></a></span></span><span> </span><span class="hs-special">}</span><span class="hs-special">)</span><span>     </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Role
</span><a href="#local-6989586621682579411"><span class="hs-identifier hs-var">r</span></a></span><span>
</span><span id="line-2655"></span><span>    </span><span class="annot"><a href="#local-6989586621682579406"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#CoVarCo"><span class="hs-identifier hs-type">CoVarCo</span></a></span><span> </span><span id="local-6989586621682579412"><span class="annot"><span class="annottext">CoVar
</span><a href="#local-6989586621682579412"><span class="hs-identifier hs-var">cv</span></a></span></span><span class="hs-special">)</span><span>                 </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">CoVar -&gt; Role
</span><a href="GHC.Core.Coercion.html#coVarRole"><span class="hs-identifier hs-var">coVarRole</span></a></span><span> </span><span class="annot"><span class="annottext">CoVar
</span><a href="#local-6989586621682579412"><span class="hs-identifier hs-var">cv</span></a></span><span>
</span><span id="line-2656"></span><span>    </span><span class="annot"><a href="#local-6989586621682579406"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#HoleCo"><span class="hs-identifier hs-type">HoleCo</span></a></span><span> </span><span id="local-6989586621682579413"><span class="annot"><span class="annottext">CoercionHole
</span><a href="#local-6989586621682579413"><span class="hs-identifier hs-var">h</span></a></span></span><span class="hs-special">)</span><span>                   </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">CoVar -&gt; Role
</span><a href="GHC.Core.Coercion.html#coVarRole"><span class="hs-identifier hs-var">coVarRole</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">CoercionHole -&gt; CoVar
</span><a href="GHC.Core.TyCo.Rep.html#coHoleCoVar"><span class="hs-identifier hs-var">coHoleCoVar</span></a></span><span> </span><span class="annot"><span class="annottext">CoercionHole
</span><a href="#local-6989586621682579413"><span class="hs-identifier hs-var">h</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-2657"></span><span>    </span><span class="annot"><a href="#local-6989586621682579406"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#UnivCo"><span class="hs-identifier hs-type">UnivCo</span></a></span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">uco_role :: Coercion -&gt; Role
</span><a href="GHC.Core.TyCo.Rep.html#uco_role"><span class="hs-identifier hs-var">uco_role</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="local-6989586621682579414"><span class="annot"><span class="annottext">Role
</span><a href="#local-6989586621682579414"><span class="hs-identifier hs-var">r</span></a></span></span><span> </span><span class="hs-special">}</span><span class="hs-special">)</span><span>    </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Role
</span><a href="#local-6989586621682579414"><span class="hs-identifier hs-var">r</span></a></span><span>
</span><span id="line-2658"></span><span>    </span><span class="annot"><a href="#local-6989586621682579406"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#SymCo"><span class="hs-identifier hs-type">SymCo</span></a></span><span> </span><span id="local-6989586621682579415"><span class="annot"><span class="annottext">Coercion
</span><a href="#local-6989586621682579415"><span class="hs-identifier hs-var">co</span></a></span></span><span class="hs-special">)</span><span>                   </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Coercion -&gt; Role
</span><a href="#local-6989586621682579406"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="annot"><span class="annottext">Coercion
</span><a href="#local-6989586621682579415"><span class="hs-identifier hs-var">co</span></a></span><span>
</span><span id="line-2659"></span><span>    </span><span class="annot"><a href="#local-6989586621682579406"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#TransCo"><span class="hs-identifier hs-type">TransCo</span></a></span><span> </span><span id="local-6989586621682579416"><span class="annot"><span class="annottext">Coercion
</span><a href="#local-6989586621682579416"><span class="hs-identifier hs-var">co1</span></a></span></span><span> </span><span id="local-6989586621682579417"><span class="annot"><span class="annottext">Coercion
</span><a href="#local-6989586621682579417"><span class="hs-identifier hs-var">_co2</span></a></span></span><span class="hs-special">)</span><span>           </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Coercion -&gt; Role
</span><a href="#local-6989586621682579406"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="annot"><span class="annottext">Coercion
</span><a href="#local-6989586621682579416"><span class="hs-identifier hs-var">co1</span></a></span><span>
</span><span id="line-2660"></span><span>    </span><span class="annot"><a href="#local-6989586621682579406"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#SelCo"><span class="hs-identifier hs-type">SelCo</span></a></span><span> </span><span id="local-6989586621682579418"><span class="annot"><span class="annottext">CoSel
</span><a href="#local-6989586621682579418"><span class="hs-identifier hs-var">cs</span></a></span></span><span> </span><span id="local-6989586621682579419"><span class="annot"><span class="annottext">Coercion
</span><a href="#local-6989586621682579419"><span class="hs-identifier hs-var">co</span></a></span></span><span class="hs-special">)</span><span>                </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">CoSel -&gt; Role -&gt; Role
</span><a href="GHC.Core.Coercion.html#mkSelCoResRole"><span class="hs-identifier hs-var">mkSelCoResRole</span></a></span><span> </span><span class="annot"><span class="annottext">CoSel
</span><a href="#local-6989586621682579418"><span class="hs-identifier hs-var">cs</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Coercion -&gt; Role
</span><a href="GHC.Core.Coercion.html#coercionRole"><span class="hs-identifier hs-var">coercionRole</span></a></span><span> </span><span class="annot"><span class="annottext">Coercion
</span><a href="#local-6989586621682579419"><span class="hs-identifier hs-var">co</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-2661"></span><span>    </span><span class="annot"><a href="#local-6989586621682579406"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#LRCo"><span class="hs-identifier hs-type">LRCo</span></a></span><span> </span><span class="hs-special">{</span><span class="hs-special">}</span><span class="hs-special">)</span><span>                    </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Role
</span><a href="Language.Haskell.Syntax.Basic.html#Nominal"><span class="hs-identifier hs-var">Nominal</span></a></span><span>
</span><span id="line-2662"></span><span>    </span><span class="annot"><a href="#local-6989586621682579406"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#InstCo"><span class="hs-identifier hs-type">InstCo</span></a></span><span> </span><span id="local-6989586621682579420"><span class="annot"><span class="annottext">Coercion
</span><a href="#local-6989586621682579420"><span class="hs-identifier hs-var">co</span></a></span></span><span> </span><span class="annot"><span class="annottext">Coercion
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span>                </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Coercion -&gt; Role
</span><a href="#local-6989586621682579406"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="annot"><span class="annottext">Coercion
</span><a href="#local-6989586621682579420"><span class="hs-identifier hs-var">co</span></a></span><span>
</span><span id="line-2663"></span><span>    </span><span class="annot"><a href="#local-6989586621682579406"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#KindCo"><span class="hs-identifier hs-type">KindCo</span></a></span><span> </span><span class="hs-special">{</span><span class="hs-special">}</span><span class="hs-special">)</span><span>                  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Role
</span><a href="Language.Haskell.Syntax.Basic.html#Nominal"><span class="hs-identifier hs-var">Nominal</span></a></span><span>
</span><span id="line-2664"></span><span>    </span><span class="annot"><a href="#local-6989586621682579406"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#SubCo"><span class="hs-identifier hs-type">SubCo</span></a></span><span> </span><span class="annot"><span class="annottext">Coercion
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span>                    </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Role
</span><a href="Language.Haskell.Syntax.Basic.html#Representational"><span class="hs-identifier hs-var">Representational</span></a></span><span>
</span><span id="line-2665"></span><span>    </span><span class="annot"><a href="#local-6989586621682579406"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#AxiomCo"><span class="hs-identifier hs-type">AxiomCo</span></a></span><span> </span><span id="local-6989586621682579421"><span class="annot"><span class="annottext">CoAxiomRule
</span><a href="#local-6989586621682579421"><span class="hs-identifier hs-var">ax</span></a></span></span><span> </span><span class="annot"><span class="annottext">[Coercion]
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span>               </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">CoAxiomRule -&gt; Role
</span><a href="GHC.Core.Coercion.Axiom.html#coAxiomRuleRole"><span class="hs-identifier hs-var">coAxiomRuleRole</span></a></span><span> </span><span class="annot"><span class="annottext">CoAxiomRule
</span><a href="#local-6989586621682579421"><span class="hs-identifier hs-var">ax</span></a></span><span>
</span><span id="line-2666"></span><span>
</span><span id="line-2667"></span><span class="hs-comment">-- | Makes a coercion type from two types: the types whose equality</span><span>
</span><span id="line-2668"></span><span class="hs-comment">-- is proven by the relevant 'Coercion'</span><span>
</span><span id="line-2669"></span><span class="annot"><a href="GHC.Core.Coercion.html#mkCoercionType"><span class="hs-identifier hs-type">mkCoercionType</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Language.Haskell.Syntax.Basic.html#Role"><span class="hs-identifier hs-type">Role</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#Type"><span class="hs-identifier hs-type">Type</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#Type"><span class="hs-identifier hs-type">Type</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#Type"><span class="hs-identifier hs-type">Type</span></a></span><span>
</span><span id="line-2670"></span><span id="mkCoercionType"><span class="annot"><span class="annottext">mkCoercionType :: Role -&gt; Type -&gt; Type -&gt; Type
</span><a href="GHC.Core.Coercion.html#mkCoercionType"><span class="hs-identifier hs-var hs-var">mkCoercionType</span></a></span></span><span> </span><span class="annot"><span class="annottext">Role
</span><a href="Language.Haskell.Syntax.Basic.html#Nominal"><span class="hs-identifier hs-var">Nominal</span></a></span><span>          </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Type -&gt; Type -&gt; Type
</span><a href="GHC.Core.Coercion.html#mkPrimEqPred"><span class="hs-identifier hs-var">mkPrimEqPred</span></a></span><span>
</span><span id="line-2671"></span><span class="annot"><a href="GHC.Core.Coercion.html#mkCoercionType"><span class="hs-identifier hs-var">mkCoercionType</span></a></span><span> </span><span class="annot"><span class="annottext">Role
</span><a href="Language.Haskell.Syntax.Basic.html#Representational"><span class="hs-identifier hs-var">Representational</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Type -&gt; Type -&gt; Type
</span><a href="GHC.Core.Coercion.html#mkReprPrimEqPred"><span class="hs-identifier hs-var">mkReprPrimEqPred</span></a></span><span>
</span><span id="line-2672"></span><span class="annot"><a href="GHC.Core.Coercion.html#mkCoercionType"><span class="hs-identifier hs-var">mkCoercionType</span></a></span><span> </span><span class="annot"><span class="annottext">Role
</span><a href="Language.Haskell.Syntax.Basic.html#Phantom"><span class="hs-identifier hs-var">Phantom</span></a></span><span>          </span><span class="hs-glyph">=</span><span> </span><span class="hs-glyph">\</span><span id="local-6989586621682579423"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682579423"><span class="hs-identifier hs-var">ty1</span></a></span></span><span> </span><span id="local-6989586621682579424"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682579424"><span class="hs-identifier hs-var">ty2</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-2673"></span><span>  </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621682579425"><span class="annot"><span class="annottext">ki1 :: Type
</span><a href="#local-6989586621682579425"><span class="hs-identifier hs-var hs-var">ki1</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">HasDebugCallStack =&gt; Type -&gt; Type
Type -&gt; Type
</span><a href="GHC.Core.Type.html#typeKind"><span class="hs-identifier hs-var">typeKind</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682579423"><span class="hs-identifier hs-var">ty1</span></a></span><span>
</span><span id="line-2674"></span><span>      </span><span id="local-6989586621682579426"><span class="annot"><span class="annottext">ki2 :: Type
</span><a href="#local-6989586621682579426"><span class="hs-identifier hs-var hs-var">ki2</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">HasDebugCallStack =&gt; Type -&gt; Type
Type -&gt; Type
</span><a href="GHC.Core.Type.html#typeKind"><span class="hs-identifier hs-var">typeKind</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682579424"><span class="hs-identifier hs-var">ty2</span></a></span><span>
</span><span id="line-2675"></span><span>  </span><span class="hs-keyword">in</span><span>
</span><span id="line-2676"></span><span>  </span><span class="annot"><span class="annottext">TyCon -&gt; [Type] -&gt; Type
</span><a href="GHC.Core.TyCo.Rep.html#TyConApp"><span class="hs-identifier hs-var">TyConApp</span></a></span><span> </span><span class="annot"><span class="annottext">TyCon
</span><a href="GHC.Builtin.Types.Prim.html#eqPhantPrimTyCon"><span class="hs-identifier hs-var">eqPhantPrimTyCon</span></a></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682579425"><span class="hs-identifier hs-var">ki1</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682579426"><span class="hs-identifier hs-var">ki2</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682579423"><span class="hs-identifier hs-var">ty1</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682579424"><span class="hs-identifier hs-var">ty2</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-2677"></span><span>
</span><span id="line-2678"></span><span class="hs-comment">-- | Creates a primitive nominal type equality predicate.</span><span>
</span><span id="line-2679"></span><span class="hs-comment">--      t1 ~# t2</span><span>
</span><span id="line-2680"></span><span class="hs-comment">-- Invariant: the types are not Coercions</span><span>
</span><span id="line-2681"></span><span class="annot"><a href="GHC.Core.Coercion.html#mkPrimEqPred"><span class="hs-identifier hs-type">mkPrimEqPred</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#Type"><span class="hs-identifier hs-type">Type</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#Type"><span class="hs-identifier hs-type">Type</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#Type"><span class="hs-identifier hs-type">Type</span></a></span><span>
</span><span id="line-2682"></span><span id="mkPrimEqPred"><span class="annot"><span class="annottext">mkPrimEqPred :: Type -&gt; Type -&gt; Type
</span><a href="GHC.Core.Coercion.html#mkPrimEqPred"><span class="hs-identifier hs-var hs-var">mkPrimEqPred</span></a></span></span><span> </span><span id="local-6989586621682579428"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682579428"><span class="hs-identifier hs-var">ty1</span></a></span></span><span> </span><span id="local-6989586621682579429"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682579429"><span class="hs-identifier hs-var">ty2</span></a></span></span><span>
</span><span id="line-2683"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">TyCon -&gt; [Type] -&gt; Type
</span><a href="GHC.Core.Type.html#mkTyConApp"><span class="hs-identifier hs-var">mkTyConApp</span></a></span><span> </span><span class="annot"><span class="annottext">TyCon
</span><a href="GHC.Builtin.Types.Prim.html#eqPrimTyCon"><span class="hs-identifier hs-var">eqPrimTyCon</span></a></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682579431"><span class="hs-identifier hs-var">k1</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682579432"><span class="hs-identifier hs-var">k2</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682579428"><span class="hs-identifier hs-var">ty1</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682579429"><span class="hs-identifier hs-var">ty2</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-2684"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-2685"></span><span>    </span><span id="local-6989586621682579431"><span class="annot"><span class="annottext">k1 :: Type
</span><a href="#local-6989586621682579431"><span class="hs-identifier hs-var hs-var">k1</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">HasDebugCallStack =&gt; Type -&gt; Type
Type -&gt; Type
</span><a href="GHC.Core.Type.html#typeKind"><span class="hs-identifier hs-var">typeKind</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682579428"><span class="hs-identifier hs-var">ty1</span></a></span><span>
</span><span id="line-2686"></span><span>    </span><span id="local-6989586621682579432"><span class="annot"><span class="annottext">k2 :: Type
</span><a href="#local-6989586621682579432"><span class="hs-identifier hs-var hs-var">k2</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">HasDebugCallStack =&gt; Type -&gt; Type
Type -&gt; Type
</span><a href="GHC.Core.Type.html#typeKind"><span class="hs-identifier hs-var">typeKind</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682579429"><span class="hs-identifier hs-var">ty2</span></a></span><span>
</span><span id="line-2687"></span><span>
</span><span id="line-2688"></span><span class="hs-comment">-- | Creates a primitive representational type equality predicate.</span><span>
</span><span id="line-2689"></span><span class="hs-comment">--      t1 ~R# t2</span><span>
</span><span id="line-2690"></span><span class="hs-comment">-- Invariant: the types are not Coercions</span><span>
</span><span id="line-2691"></span><span class="annot"><a href="GHC.Core.Coercion.html#mkReprPrimEqPred"><span class="hs-identifier hs-type">mkReprPrimEqPred</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#Type"><span class="hs-identifier hs-type">Type</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#Type"><span class="hs-identifier hs-type">Type</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#Type"><span class="hs-identifier hs-type">Type</span></a></span><span>
</span><span id="line-2692"></span><span id="mkReprPrimEqPred"><span class="annot"><span class="annottext">mkReprPrimEqPred :: Type -&gt; Type -&gt; Type
</span><a href="GHC.Core.Coercion.html#mkReprPrimEqPred"><span class="hs-identifier hs-var hs-var">mkReprPrimEqPred</span></a></span></span><span> </span><span id="local-6989586621682579433"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682579433"><span class="hs-identifier hs-var">ty1</span></a></span></span><span>  </span><span id="local-6989586621682579434"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682579434"><span class="hs-identifier hs-var">ty2</span></a></span></span><span>
</span><span id="line-2693"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">TyCon -&gt; [Type] -&gt; Type
</span><a href="GHC.Core.Type.html#mkTyConApp"><span class="hs-identifier hs-var">mkTyConApp</span></a></span><span> </span><span class="annot"><span class="annottext">TyCon
</span><a href="GHC.Builtin.Types.Prim.html#eqReprPrimTyCon"><span class="hs-identifier hs-var">eqReprPrimTyCon</span></a></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682579436"><span class="hs-identifier hs-var">k1</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682579437"><span class="hs-identifier hs-var">k2</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682579433"><span class="hs-identifier hs-var">ty1</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682579434"><span class="hs-identifier hs-var">ty2</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-2694"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-2695"></span><span>    </span><span id="local-6989586621682579436"><span class="annot"><span class="annottext">k1 :: Type
</span><a href="#local-6989586621682579436"><span class="hs-identifier hs-var hs-var">k1</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">HasDebugCallStack =&gt; Type -&gt; Type
Type -&gt; Type
</span><a href="GHC.Core.Type.html#typeKind"><span class="hs-identifier hs-var">typeKind</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682579433"><span class="hs-identifier hs-var">ty1</span></a></span><span>
</span><span id="line-2696"></span><span>    </span><span id="local-6989586621682579437"><span class="annot"><span class="annottext">k2 :: Type
</span><a href="#local-6989586621682579437"><span class="hs-identifier hs-var hs-var">k2</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">HasDebugCallStack =&gt; Type -&gt; Type
Type -&gt; Type
</span><a href="GHC.Core.Type.html#typeKind"><span class="hs-identifier hs-var">typeKind</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682579434"><span class="hs-identifier hs-var">ty2</span></a></span><span>
</span><span id="line-2697"></span><span>
</span><span id="line-2698"></span><span class="annot"><span class="hs-comment">-- | Makes a lifted equality predicate at the given role</span></span><span>
</span><span id="line-2699"></span><span class="annot"><a href="GHC.Core.Coercion.html#mkPrimEqPredRole"><span class="hs-identifier hs-type">mkPrimEqPredRole</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Language.Haskell.Syntax.Basic.html#Role"><span class="hs-identifier hs-type">Role</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#Type"><span class="hs-identifier hs-type">Type</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#Type"><span class="hs-identifier hs-type">Type</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#PredType"><span class="hs-identifier hs-type">PredType</span></a></span><span>
</span><span id="line-2700"></span><span id="mkPrimEqPredRole"><span class="annot"><span class="annottext">mkPrimEqPredRole :: Role -&gt; Type -&gt; Type -&gt; Type
</span><a href="GHC.Core.Coercion.html#mkPrimEqPredRole"><span class="hs-identifier hs-var hs-var">mkPrimEqPredRole</span></a></span></span><span> </span><span class="annot"><span class="annottext">Role
</span><a href="Language.Haskell.Syntax.Basic.html#Nominal"><span class="hs-identifier hs-var">Nominal</span></a></span><span>          </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Type -&gt; Type -&gt; Type
</span><a href="GHC.Core.Coercion.html#mkPrimEqPred"><span class="hs-identifier hs-var">mkPrimEqPred</span></a></span><span>
</span><span id="line-2701"></span><span class="annot"><a href="GHC.Core.Coercion.html#mkPrimEqPredRole"><span class="hs-identifier hs-var">mkPrimEqPredRole</span></a></span><span> </span><span class="annot"><span class="annottext">Role
</span><a href="Language.Haskell.Syntax.Basic.html#Representational"><span class="hs-identifier hs-var">Representational</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Type -&gt; Type -&gt; Type
</span><a href="GHC.Core.Coercion.html#mkReprPrimEqPred"><span class="hs-identifier hs-var">mkReprPrimEqPred</span></a></span><span>
</span><span id="line-2702"></span><span class="annot"><a href="GHC.Core.Coercion.html#mkPrimEqPredRole"><span class="hs-identifier hs-var">mkPrimEqPredRole</span></a></span><span> </span><span class="annot"><span class="annottext">Role
</span><a href="Language.Haskell.Syntax.Basic.html#Phantom"><span class="hs-identifier hs-var">Phantom</span></a></span><span>          </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">String -&gt; Type -&gt; Type -&gt; Type
forall a. HasCallStack =&gt; String -&gt; a
</span><a href="GHC.Utils.Panic.Plain.html#panic"><span class="hs-identifier hs-var">panic</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;mkPrimEqPredRole phantom&quot;</span></span><span>
</span><span id="line-2703"></span><span>
</span><span id="line-2704"></span><span class="hs-comment">-- | Creates a primitive nominal type equality predicate with an explicit</span><span>
</span><span id="line-2705"></span><span class="hs-comment">--   (but homogeneous) kind: (~#) k k ty1 ty2</span><span>
</span><span id="line-2706"></span><span class="annot"><a href="GHC.Core.Coercion.html#mkNomPrimEqPred"><span class="hs-identifier hs-type">mkNomPrimEqPred</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#Kind"><span class="hs-identifier hs-type">Kind</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#Type"><span class="hs-identifier hs-type">Type</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#Type"><span class="hs-identifier hs-type">Type</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#Type"><span class="hs-identifier hs-type">Type</span></a></span><span>
</span><span id="line-2707"></span><span id="mkNomPrimEqPred"><span class="annot"><span class="annottext">mkNomPrimEqPred :: Type -&gt; Type -&gt; Type -&gt; Type
</span><a href="GHC.Core.Coercion.html#mkNomPrimEqPred"><span class="hs-identifier hs-var hs-var">mkNomPrimEqPred</span></a></span></span><span> </span><span id="local-6989586621682579440"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682579440"><span class="hs-identifier hs-var">k</span></a></span></span><span> </span><span id="local-6989586621682579441"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682579441"><span class="hs-identifier hs-var">ty1</span></a></span></span><span> </span><span id="local-6989586621682579442"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682579442"><span class="hs-identifier hs-var">ty2</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">TyCon -&gt; [Type] -&gt; Type
</span><a href="GHC.Core.Type.html#mkTyConApp"><span class="hs-identifier hs-var">mkTyConApp</span></a></span><span> </span><span class="annot"><span class="annottext">TyCon
</span><a href="GHC.Builtin.Types.Prim.html#eqPrimTyCon"><span class="hs-identifier hs-var">eqPrimTyCon</span></a></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682579440"><span class="hs-identifier hs-var">k</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682579440"><span class="hs-identifier hs-var">k</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682579441"><span class="hs-identifier hs-var">ty1</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682579442"><span class="hs-identifier hs-var">ty2</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-2708"></span><span>
</span><span id="line-2709"></span><span class="hs-comment">-- | Assuming that two types are the same, ignoring coercions, find</span><span>
</span><span id="line-2710"></span><span class="hs-comment">-- a nominal coercion between the types. This is useful when optimizing</span><span>
</span><span id="line-2711"></span><span class="hs-comment">-- transitivity over coercion applications, where splitting two</span><span>
</span><span id="line-2712"></span><span class="hs-comment">-- AppCos might yield different kinds. See Note [EtaAppCo] in</span><span>
</span><span id="line-2713"></span><span class="hs-comment">-- &quot;GHC.Core.Coercion.Opt&quot;.</span><span>
</span><span id="line-2714"></span><span class="annot"><a href="GHC.Core.Coercion.html#buildCoercion"><span class="hs-identifier hs-type">buildCoercion</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Utils.Misc.html#HasDebugCallStack"><span class="hs-identifier hs-type">HasDebugCallStack</span></a></span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#Type"><span class="hs-identifier hs-type">Type</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#Type"><span class="hs-identifier hs-type">Type</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#CoercionN"><span class="hs-identifier hs-type">CoercionN</span></a></span><span>
</span><span id="line-2715"></span><span id="buildCoercion"><span class="annot"><span class="annottext">buildCoercion :: HasDebugCallStack =&gt; Type -&gt; Type -&gt; Coercion
</span><a href="GHC.Core.Coercion.html#buildCoercion"><span class="hs-identifier hs-var hs-var">buildCoercion</span></a></span></span><span> </span><span id="local-6989586621682579491"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682579491"><span class="hs-identifier hs-var">orig_ty1</span></a></span></span><span> </span><span id="local-6989586621682579492"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682579492"><span class="hs-identifier hs-var">orig_ty2</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Type -&gt; Type -&gt; Coercion
</span><a href="#local-6989586621682579493"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682579491"><span class="hs-identifier hs-var">orig_ty1</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682579492"><span class="hs-identifier hs-var">orig_ty2</span></a></span><span>
</span><span id="line-2716"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-2717"></span><span>    </span><span id="local-6989586621682579493"><span class="annot"><span class="annottext">go :: Type -&gt; Type -&gt; Coercion
</span><a href="#local-6989586621682579493"><span class="hs-identifier hs-var hs-var">go</span></a></span></span><span> </span><span id="local-6989586621682579494"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682579494"><span class="hs-identifier hs-var">ty1</span></a></span></span><span> </span><span id="local-6989586621682579495"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682579495"><span class="hs-identifier hs-var">ty2</span></a></span></span><span> </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span id="local-6989586621682579496"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682579496"><span class="hs-identifier hs-var">ty1'</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Type -&gt; Maybe Type
</span><a href="GHC.Core.Type.html#coreView"><span class="hs-identifier hs-var">coreView</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682579494"><span class="hs-identifier hs-var">ty1</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Type -&gt; Type -&gt; Coercion
</span><a href="#local-6989586621682579493"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682579496"><span class="hs-identifier hs-var">ty1'</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682579495"><span class="hs-identifier hs-var">ty2</span></a></span><span>
</span><span id="line-2718"></span><span>               </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span id="local-6989586621682579497"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682579497"><span class="hs-identifier hs-var">ty2'</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Type -&gt; Maybe Type
</span><a href="GHC.Core.Type.html#coreView"><span class="hs-identifier hs-var">coreView</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682579495"><span class="hs-identifier hs-var">ty2</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Type -&gt; Type -&gt; Coercion
</span><a href="#local-6989586621682579493"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682579494"><span class="hs-identifier hs-var">ty1</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682579497"><span class="hs-identifier hs-var">ty2'</span></a></span><span>
</span><span id="line-2719"></span><span>
</span><span id="line-2720"></span><span>    </span><span class="annot"><a href="#local-6989586621682579493"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#CastTy"><span class="hs-identifier hs-type">CastTy</span></a></span><span> </span><span id="local-6989586621682579498"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682579498"><span class="hs-identifier hs-var">ty1</span></a></span></span><span> </span><span id="local-6989586621682579499"><span class="annot"><span class="annottext">Coercion
</span><a href="#local-6989586621682579499"><span class="hs-identifier hs-var">co</span></a></span></span><span class="hs-special">)</span><span> </span><span id="local-6989586621682579500"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682579500"><span class="hs-identifier hs-var">ty2</span></a></span></span><span>
</span><span id="line-2721"></span><span>      </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621682579501"><span class="annot"><span class="annottext">co' :: Coercion
</span><a href="#local-6989586621682579501"><span class="hs-identifier hs-var hs-var">co'</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Type -&gt; Type -&gt; Coercion
</span><a href="#local-6989586621682579493"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682579498"><span class="hs-identifier hs-var">ty1</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682579500"><span class="hs-identifier hs-var">ty2</span></a></span><span>
</span><span id="line-2722"></span><span>            </span><span id="local-6989586621682579502"><span class="annot"><span class="annottext">r :: Role
</span><a href="#local-6989586621682579502"><span class="hs-identifier hs-var hs-var">r</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Coercion -&gt; Role
</span><a href="GHC.Core.Coercion.html#coercionRole"><span class="hs-identifier hs-var">coercionRole</span></a></span><span> </span><span class="annot"><span class="annottext">Coercion
</span><a href="#local-6989586621682579501"><span class="hs-identifier hs-var">co'</span></a></span><span>
</span><span id="line-2723"></span><span>        </span><span class="hs-keyword">in</span><span>  </span><span class="annot"><span class="annottext">Role -&gt; Type -&gt; Coercion -&gt; Coercion -&gt; Coercion
</span><a href="GHC.Core.Coercion.html#mkCoherenceLeftCo"><span class="hs-identifier hs-var">mkCoherenceLeftCo</span></a></span><span> </span><span class="annot"><span class="annottext">Role
</span><a href="#local-6989586621682579502"><span class="hs-identifier hs-var">r</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682579498"><span class="hs-identifier hs-var">ty1</span></a></span><span> </span><span class="annot"><span class="annottext">Coercion
</span><a href="#local-6989586621682579499"><span class="hs-identifier hs-var">co</span></a></span><span> </span><span class="annot"><span class="annottext">Coercion
</span><a href="#local-6989586621682579501"><span class="hs-identifier hs-var">co'</span></a></span><span>
</span><span id="line-2724"></span><span>
</span><span id="line-2725"></span><span>    </span><span class="annot"><a href="#local-6989586621682579493"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span id="local-6989586621682579503"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682579503"><span class="hs-identifier hs-var">ty1</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#CastTy"><span class="hs-identifier hs-type">CastTy</span></a></span><span> </span><span id="local-6989586621682579504"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682579504"><span class="hs-identifier hs-var">ty2</span></a></span></span><span> </span><span id="local-6989586621682579505"><span class="annot"><span class="annottext">Coercion
</span><a href="#local-6989586621682579505"><span class="hs-identifier hs-var">co</span></a></span></span><span class="hs-special">)</span><span>
</span><span id="line-2726"></span><span>      </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621682579506"><span class="annot"><span class="annottext">co' :: Coercion
</span><a href="#local-6989586621682579506"><span class="hs-identifier hs-var hs-var">co'</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Type -&gt; Type -&gt; Coercion
</span><a href="#local-6989586621682579493"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682579503"><span class="hs-identifier hs-var">ty1</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682579504"><span class="hs-identifier hs-var">ty2</span></a></span><span>
</span><span id="line-2727"></span><span>            </span><span id="local-6989586621682579507"><span class="annot"><span class="annottext">r :: Role
</span><a href="#local-6989586621682579507"><span class="hs-identifier hs-var hs-var">r</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Coercion -&gt; Role
</span><a href="GHC.Core.Coercion.html#coercionRole"><span class="hs-identifier hs-var">coercionRole</span></a></span><span> </span><span class="annot"><span class="annottext">Coercion
</span><a href="#local-6989586621682579506"><span class="hs-identifier hs-var">co'</span></a></span><span>
</span><span id="line-2728"></span><span>        </span><span class="hs-keyword">in</span><span>  </span><span class="annot"><span class="annottext">HasDebugCallStack =&gt;
Role -&gt; Type -&gt; Coercion -&gt; Coercion -&gt; Coercion
Role -&gt; Type -&gt; Coercion -&gt; Coercion -&gt; Coercion
</span><a href="GHC.Core.Coercion.html#mkCoherenceRightCo"><span class="hs-identifier hs-var">mkCoherenceRightCo</span></a></span><span> </span><span class="annot"><span class="annottext">Role
</span><a href="#local-6989586621682579507"><span class="hs-identifier hs-var">r</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682579504"><span class="hs-identifier hs-var">ty2</span></a></span><span> </span><span class="annot"><span class="annottext">Coercion
</span><a href="#local-6989586621682579505"><span class="hs-identifier hs-var">co</span></a></span><span> </span><span class="annot"><span class="annottext">Coercion
</span><a href="#local-6989586621682579506"><span class="hs-identifier hs-var">co'</span></a></span><span>
</span><span id="line-2729"></span><span>
</span><span id="line-2730"></span><span>    </span><span class="annot"><a href="#local-6989586621682579493"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span id="local-6989586621682579508"><span class="annot"><span class="annottext">ty1 :: Type
</span><a href="#local-6989586621682579508"><span class="hs-identifier hs-var">ty1</span></a></span></span><span class="hs-glyph">@</span><span class="hs-special">(</span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#TyVarTy"><span class="hs-identifier hs-type">TyVarTy</span></a></span><span> </span><span id="local-6989586621682579509"><span class="annot"><span class="annottext">CoVar
</span><a href="#local-6989586621682579509"><span class="hs-identifier hs-var">tv1</span></a></span></span><span class="hs-special">)</span><span> </span><span id="local-6989586621682579510"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682579510"><span class="hs-identifier hs-var">_tyvarty</span></a></span></span><span>
</span><span id="line-2731"></span><span>      </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Coercion -&gt; Coercion
forall a. HasCallStack =&gt; Bool -&gt; a -&gt; a
</span><a href="GHC.Utils.Panic.Plain.html#assert"><span class="hs-identifier hs-var">assert</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682579510"><span class="hs-identifier hs-var">_tyvarty</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-2732"></span><span>                  </span><span class="hs-special">{</span><span> </span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#TyVarTy"><span class="hs-identifier hs-type">TyVarTy</span></a></span><span> </span><span id="local-6989586621682579511"><span class="annot"><span class="annottext">CoVar
</span><a href="#local-6989586621682579511"><span class="hs-identifier hs-var">tv2</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">CoVar
</span><a href="#local-6989586621682579509"><span class="hs-identifier hs-var">tv1</span></a></span><span> </span><span class="annot"><span class="annottext">CoVar -&gt; CoVar -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">==</span></span><span> </span><span class="annot"><span class="annottext">CoVar
</span><a href="#local-6989586621682579511"><span class="hs-identifier hs-var">tv2</span></a></span><span>
</span><span id="line-2733"></span><span>                  </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="annottext">Type
</span><span class="hs-identifier">_</span></span><span>           </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">False</span></span><span>      </span><span class="hs-special">}</span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(Coercion -&gt; Coercion) -&gt; Coercion -&gt; Coercion
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-2734"></span><span>        </span><span class="annot"><span class="annottext">Type -&gt; Coercion
</span><a href="GHC.Core.Coercion.html#mkNomReflCo"><span class="hs-identifier hs-var">mkNomReflCo</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682579508"><span class="hs-identifier hs-var">ty1</span></a></span><span>
</span><span id="line-2735"></span><span>
</span><span id="line-2736"></span><span>    </span><span class="annot"><a href="#local-6989586621682579493"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#FunTy"><span class="hs-identifier hs-type">FunTy</span></a></span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">ft_af :: Type -&gt; FunTyFlag
</span><a href="GHC.Core.TyCo.Rep.html#ft_af"><span class="hs-identifier hs-var">ft_af</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="local-6989586621682579512"><span class="annot"><span class="annottext">FunTyFlag
</span><a href="#local-6989586621682579512"><span class="hs-identifier hs-var">af1</span></a></span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">ft_mult :: Type -&gt; Type
</span><a href="GHC.Core.TyCo.Rep.html#ft_mult"><span class="hs-identifier hs-var">ft_mult</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="local-6989586621682579513"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682579513"><span class="hs-identifier hs-var">w1</span></a></span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">ft_arg :: Type -&gt; Type
</span><a href="GHC.Core.TyCo.Rep.html#ft_arg"><span class="hs-identifier hs-var">ft_arg</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="local-6989586621682579514"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682579514"><span class="hs-identifier hs-var">arg1</span></a></span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">ft_res :: Type -&gt; Type
</span><a href="GHC.Core.TyCo.Rep.html#ft_res"><span class="hs-identifier hs-var">ft_res</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="local-6989586621682579515"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682579515"><span class="hs-identifier hs-var">res1</span></a></span></span><span> </span><span class="hs-special">}</span><span class="hs-special">)</span><span>
</span><span id="line-2737"></span><span>       </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#FunTy"><span class="hs-identifier hs-type">FunTy</span></a></span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">ft_af :: Type -&gt; FunTyFlag
</span><a href="GHC.Core.TyCo.Rep.html#ft_af"><span class="hs-identifier hs-var">ft_af</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="local-6989586621682579516"><span class="annot"><span class="annottext">FunTyFlag
</span><a href="#local-6989586621682579516"><span class="hs-identifier hs-var">af2</span></a></span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">ft_mult :: Type -&gt; Type
</span><a href="GHC.Core.TyCo.Rep.html#ft_mult"><span class="hs-identifier hs-var">ft_mult</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="local-6989586621682579517"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682579517"><span class="hs-identifier hs-var">w2</span></a></span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">ft_arg :: Type -&gt; Type
</span><a href="GHC.Core.TyCo.Rep.html#ft_arg"><span class="hs-identifier hs-var">ft_arg</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="local-6989586621682579518"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682579518"><span class="hs-identifier hs-var">arg2</span></a></span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">ft_res :: Type -&gt; Type
</span><a href="GHC.Core.TyCo.Rep.html#ft_res"><span class="hs-identifier hs-var">ft_res</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="local-6989586621682579519"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682579519"><span class="hs-identifier hs-var">res2</span></a></span></span><span> </span><span class="hs-special">}</span><span class="hs-special">)</span><span>
</span><span id="line-2738"></span><span>      </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Coercion -&gt; Coercion
forall a. HasCallStack =&gt; Bool -&gt; a -&gt; a
</span><a href="GHC.Utils.Panic.Plain.html#assert"><span class="hs-identifier hs-var">assert</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">FunTyFlag
</span><a href="#local-6989586621682579512"><span class="hs-identifier hs-var">af1</span></a></span><span> </span><span class="annot"><span class="annottext">FunTyFlag -&gt; FunTyFlag -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">==</span></span><span> </span><span class="annot"><span class="annottext">FunTyFlag
</span><a href="#local-6989586621682579516"><span class="hs-identifier hs-var">af2</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(Coercion -&gt; Coercion) -&gt; Coercion -&gt; Coercion
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-2739"></span><span>        </span><span class="annot"><span class="annottext">Role -&gt; FunTyFlag -&gt; Coercion -&gt; Coercion -&gt; Coercion -&gt; Coercion
</span><a href="GHC.Core.Coercion.html#mkFunCo"><span class="hs-identifier hs-var">mkFunCo</span></a></span><span> </span><span class="annot"><span class="annottext">Role
</span><a href="Language.Haskell.Syntax.Basic.html#Nominal"><span class="hs-identifier hs-var">Nominal</span></a></span><span> </span><span class="annot"><span class="annottext">FunTyFlag
</span><a href="#local-6989586621682579512"><span class="hs-identifier hs-var">af1</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Type -&gt; Type -&gt; Coercion
</span><a href="#local-6989586621682579493"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682579513"><span class="hs-identifier hs-var">w1</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682579517"><span class="hs-identifier hs-var">w2</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Type -&gt; Type -&gt; Coercion
</span><a href="#local-6989586621682579493"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682579514"><span class="hs-identifier hs-var">arg1</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682579518"><span class="hs-identifier hs-var">arg2</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Type -&gt; Type -&gt; Coercion
</span><a href="#local-6989586621682579493"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682579515"><span class="hs-identifier hs-var">res1</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682579519"><span class="hs-identifier hs-var">res2</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-2740"></span><span>
</span><span id="line-2741"></span><span>    </span><span class="annot"><a href="#local-6989586621682579493"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#TyConApp"><span class="hs-identifier hs-type">TyConApp</span></a></span><span> </span><span id="local-6989586621682579520"><span class="annot"><span class="annottext">TyCon
</span><a href="#local-6989586621682579520"><span class="hs-identifier hs-var">tc1</span></a></span></span><span> </span><span id="local-6989586621682579521"><span class="annot"><span class="annottext">[Type]
</span><a href="#local-6989586621682579521"><span class="hs-identifier hs-var">args1</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#TyConApp"><span class="hs-identifier hs-type">TyConApp</span></a></span><span> </span><span id="local-6989586621682579522"><span class="annot"><span class="annottext">TyCon
</span><a href="#local-6989586621682579522"><span class="hs-identifier hs-var">tc2</span></a></span></span><span> </span><span id="local-6989586621682579523"><span class="annot"><span class="annottext">[Type]
</span><a href="#local-6989586621682579523"><span class="hs-identifier hs-var">args2</span></a></span></span><span class="hs-special">)</span><span>
</span><span id="line-2742"></span><span>      </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Bool -&gt; SDoc -&gt; Coercion -&gt; Coercion
forall a. HasCallStack =&gt; Bool -&gt; SDoc -&gt; a -&gt; a
</span><a href="GHC.Utils.Panic.html#assertPpr"><span class="hs-identifier hs-var">assertPpr</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TyCon
</span><a href="#local-6989586621682579520"><span class="hs-identifier hs-var">tc1</span></a></span><span> </span><span class="annot"><span class="annottext">TyCon -&gt; TyCon -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">==</span></span><span> </span><span class="annot"><span class="annottext">TyCon
</span><a href="#local-6989586621682579522"><span class="hs-identifier hs-var">tc2</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[SDoc] -&gt; SDoc
forall doc. IsDoc doc =&gt; [doc] -&gt; doc
</span><a href="GHC.Utils.Outputable.html#vcat"><span class="hs-identifier hs-var">vcat</span></a></span><span> </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">TyCon -&gt; SDoc
forall a. Outputable a =&gt; a -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="annot"><span class="annottext">TyCon
</span><a href="#local-6989586621682579520"><span class="hs-identifier hs-var">tc1</span></a></span><span> </span><span class="annot"><span class="annottext">SDoc -&gt; SDoc -&gt; SDoc
forall doc. IsLine doc =&gt; doc -&gt; doc -&gt; doc
</span><a href="GHC.Utils.Outputable.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">TyCon -&gt; SDoc
forall a. Outputable a =&gt; a -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="annot"><span class="annottext">TyCon
</span><a href="#local-6989586621682579522"><span class="hs-identifier hs-var">tc2</span></a></span><span>
</span><span id="line-2743"></span><span>                                     </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">String -&gt; SDoc
forall doc. IsLine doc =&gt; String -&gt; doc
</span><a href="GHC.Utils.Outputable.html#text"><span class="hs-identifier hs-var">text</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;orig_ty1:&quot;</span></span><span> </span><span class="annot"><span class="annottext">SDoc -&gt; SDoc -&gt; SDoc
forall doc. IsLine doc =&gt; doc -&gt; doc -&gt; doc
</span><a href="GHC.Utils.Outputable.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">Type -&gt; SDoc
forall a. Outputable a =&gt; a -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682579491"><span class="hs-identifier hs-var">orig_ty1</span></a></span><span>
</span><span id="line-2744"></span><span>                                     </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">String -&gt; SDoc
forall doc. IsLine doc =&gt; String -&gt; doc
</span><a href="GHC.Utils.Outputable.html#text"><span class="hs-identifier hs-var">text</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;orig_ty2:&quot;</span></span><span> </span><span class="annot"><span class="annottext">SDoc -&gt; SDoc -&gt; SDoc
forall doc. IsLine doc =&gt; doc -&gt; doc -&gt; doc
</span><a href="GHC.Utils.Outputable.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">Type -&gt; SDoc
forall a. Outputable a =&gt; a -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682579492"><span class="hs-identifier hs-var">orig_ty2</span></a></span><span>
</span><span id="line-2745"></span><span>                                     </span><span class="hs-special">]</span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(Coercion -&gt; Coercion) -&gt; Coercion -&gt; Coercion
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-2746"></span><span>        </span><span class="annot"><span class="annottext">HasDebugCallStack =&gt; Role -&gt; TyCon -&gt; [Coercion] -&gt; Coercion
Role -&gt; TyCon -&gt; [Coercion] -&gt; Coercion
</span><a href="GHC.Core.Coercion.html#mkTyConAppCo"><span class="hs-identifier hs-var">mkTyConAppCo</span></a></span><span> </span><span class="annot"><span class="annottext">Role
</span><a href="Language.Haskell.Syntax.Basic.html#Nominal"><span class="hs-identifier hs-var">Nominal</span></a></span><span> </span><span class="annot"><span class="annottext">TyCon
</span><a href="#local-6989586621682579520"><span class="hs-identifier hs-var">tc1</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(Type -&gt; Type -&gt; Coercion) -&gt; [Type] -&gt; [Type] -&gt; [Coercion]
forall a b c. (a -&gt; b -&gt; c) -&gt; [a] -&gt; [b] -&gt; [c]
</span><span class="hs-identifier hs-var">zipWith</span></span><span> </span><span class="annot"><span class="annottext">Type -&gt; Type -&gt; Coercion
</span><a href="#local-6989586621682579493"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="annot"><span class="annottext">[Type]
</span><a href="#local-6989586621682579521"><span class="hs-identifier hs-var">args1</span></a></span><span> </span><span class="annot"><span class="annottext">[Type]
</span><a href="#local-6989586621682579523"><span class="hs-identifier hs-var">args2</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-2747"></span><span>
</span><span id="line-2748"></span><span>    </span><span class="annot"><a href="#local-6989586621682579493"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#AppTy"><span class="hs-identifier hs-type">AppTy</span></a></span><span> </span><span id="local-6989586621682579524"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682579524"><span class="hs-identifier hs-var">ty1a</span></a></span></span><span> </span><span id="local-6989586621682579525"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682579525"><span class="hs-identifier hs-var">ty1b</span></a></span></span><span class="hs-special">)</span><span> </span><span id="local-6989586621682579526"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682579526"><span class="hs-identifier hs-var">ty2</span></a></span></span><span>
</span><span id="line-2749"></span><span>      </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span class="hs-special">(</span><span id="local-6989586621682579527"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682579527"><span class="hs-identifier hs-var">ty2a</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682579528"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682579528"><span class="hs-identifier hs-var">ty2b</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">HasDebugCallStack =&gt; Type -&gt; Maybe (Type, Type)
Type -&gt; Maybe (Type, Type)
</span><a href="GHC.Core.Type.html#splitAppTyNoView_maybe"><span class="hs-identifier hs-var">splitAppTyNoView_maybe</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682579526"><span class="hs-identifier hs-var">ty2</span></a></span><span>
</span><span id="line-2750"></span><span>      </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Coercion -&gt; Coercion -&gt; Coercion
</span><a href="GHC.Core.Coercion.html#mkAppCo"><span class="hs-identifier hs-var">mkAppCo</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Type -&gt; Type -&gt; Coercion
</span><a href="#local-6989586621682579493"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682579524"><span class="hs-identifier hs-var">ty1a</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682579527"><span class="hs-identifier hs-var">ty2a</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Type -&gt; Type -&gt; Coercion
</span><a href="#local-6989586621682579493"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682579525"><span class="hs-identifier hs-var">ty1b</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682579528"><span class="hs-identifier hs-var">ty2b</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-2751"></span><span>
</span><span id="line-2752"></span><span>    </span><span class="annot"><a href="#local-6989586621682579493"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span id="local-6989586621682579530"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682579530"><span class="hs-identifier hs-var">ty1</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#AppTy"><span class="hs-identifier hs-type">AppTy</span></a></span><span> </span><span id="local-6989586621682579531"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682579531"><span class="hs-identifier hs-var">ty2a</span></a></span></span><span> </span><span id="local-6989586621682579532"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682579532"><span class="hs-identifier hs-var">ty2b</span></a></span></span><span class="hs-special">)</span><span>
</span><span id="line-2753"></span><span>      </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span class="hs-special">(</span><span id="local-6989586621682579533"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682579533"><span class="hs-identifier hs-var">ty1a</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682579534"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682579534"><span class="hs-identifier hs-var">ty1b</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">HasDebugCallStack =&gt; Type -&gt; Maybe (Type, Type)
Type -&gt; Maybe (Type, Type)
</span><a href="GHC.Core.Type.html#splitAppTyNoView_maybe"><span class="hs-identifier hs-var">splitAppTyNoView_maybe</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682579530"><span class="hs-identifier hs-var">ty1</span></a></span><span>
</span><span id="line-2754"></span><span>      </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Coercion -&gt; Coercion -&gt; Coercion
</span><a href="GHC.Core.Coercion.html#mkAppCo"><span class="hs-identifier hs-var">mkAppCo</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Type -&gt; Type -&gt; Coercion
</span><a href="#local-6989586621682579493"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682579533"><span class="hs-identifier hs-var">ty1a</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682579531"><span class="hs-identifier hs-var">ty2a</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Type -&gt; Type -&gt; Coercion
</span><a href="#local-6989586621682579493"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682579534"><span class="hs-identifier hs-var">ty1b</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682579532"><span class="hs-identifier hs-var">ty2b</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-2755"></span><span>
</span><span id="line-2756"></span><span>    </span><span class="annot"><a href="#local-6989586621682579493"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#ForAllTy"><span class="hs-identifier hs-type">ForAllTy</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Types.Var.html#Bndr"><span class="hs-identifier hs-type">Bndr</span></a></span><span> </span><span id="local-6989586621682579535"><span class="annot"><span class="annottext">CoVar
</span><a href="#local-6989586621682579535"><span class="hs-identifier hs-var">tv1</span></a></span></span><span> </span><span id="local-6989586621682579536"><span class="annot"><span class="annottext">ForAllTyFlag
</span><a href="#local-6989586621682579536"><span class="hs-identifier hs-var">flag1</span></a></span></span><span class="hs-special">)</span><span> </span><span id="local-6989586621682579537"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682579537"><span class="hs-identifier hs-var">ty1</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#ForAllTy"><span class="hs-identifier hs-type">ForAllTy</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Types.Var.html#Bndr"><span class="hs-identifier hs-type">Bndr</span></a></span><span> </span><span id="local-6989586621682579538"><span class="annot"><span class="annottext">CoVar
</span><a href="#local-6989586621682579538"><span class="hs-identifier hs-var">tv2</span></a></span></span><span> </span><span id="local-6989586621682579539"><span class="annot"><span class="annottext">ForAllTyFlag
</span><a href="#local-6989586621682579539"><span class="hs-identifier hs-var">flag2</span></a></span></span><span class="hs-special">)</span><span> </span><span id="local-6989586621682579540"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682579540"><span class="hs-identifier hs-var">ty2</span></a></span></span><span class="hs-special">)</span><span>
</span><span id="line-2757"></span><span>      </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">CoVar -&gt; Bool
</span><a href="GHC.Types.Var.html#isTyVar"><span class="hs-identifier hs-var">isTyVar</span></a></span><span> </span><span class="annot"><span class="annottext">CoVar
</span><a href="#local-6989586621682579535"><span class="hs-identifier hs-var">tv1</span></a></span><span>
</span><span id="line-2758"></span><span>      </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Coercion -&gt; Coercion
forall a. HasCallStack =&gt; Bool -&gt; a -&gt; a
</span><a href="GHC.Utils.Panic.Plain.html#assert"><span class="hs-identifier hs-var">assert</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">CoVar -&gt; Bool
</span><a href="GHC.Types.Var.html#isTyVar"><span class="hs-identifier hs-var">isTyVar</span></a></span><span> </span><span class="annot"><span class="annottext">CoVar
</span><a href="#local-6989586621682579538"><span class="hs-identifier hs-var">tv2</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(Coercion -&gt; Coercion) -&gt; Coercion -&gt; Coercion
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-2759"></span><span>        </span><span class="annot"><span class="annottext">HasDebugCallStack =&gt;
CoVar
-&gt; ForAllTyFlag -&gt; ForAllTyFlag -&gt; Coercion -&gt; Coercion -&gt; Coercion
CoVar
-&gt; ForAllTyFlag -&gt; ForAllTyFlag -&gt; Coercion -&gt; Coercion -&gt; Coercion
</span><a href="GHC.Core.Coercion.html#mkForAllCo"><span class="hs-identifier hs-var">mkForAllCo</span></a></span><span> </span><span class="annot"><span class="annottext">CoVar
</span><a href="#local-6989586621682579535"><span class="hs-identifier hs-var">tv1</span></a></span><span> </span><span class="annot"><span class="annottext">ForAllTyFlag
</span><a href="#local-6989586621682579536"><span class="hs-identifier hs-var">flag1</span></a></span><span> </span><span class="annot"><span class="annottext">ForAllTyFlag
</span><a href="#local-6989586621682579539"><span class="hs-identifier hs-var">flag2</span></a></span><span> </span><span class="annot"><span class="annottext">Coercion
</span><a href="#local-6989586621682579541"><span class="hs-identifier hs-var">kind_co</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Type -&gt; Type -&gt; Coercion
</span><a href="#local-6989586621682579493"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682579537"><span class="hs-identifier hs-var">ty1</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682579542"><span class="hs-identifier hs-var">ty2'</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-2760"></span><span>      </span><span class="hs-keyword">where</span><span> </span><span id="local-6989586621682579541"><span class="annot"><span class="annottext">kind_co :: Coercion
</span><a href="#local-6989586621682579541"><span class="hs-identifier hs-var hs-var">kind_co</span></a></span></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Type -&gt; Type -&gt; Coercion
</span><a href="#local-6989586621682579493"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">CoVar -&gt; Type
</span><a href="GHC.Types.Var.html#tyVarKind"><span class="hs-identifier hs-var">tyVarKind</span></a></span><span> </span><span class="annot"><span class="annottext">CoVar
</span><a href="#local-6989586621682579535"><span class="hs-identifier hs-var">tv1</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">CoVar -&gt; Type
</span><a href="GHC.Types.Var.html#tyVarKind"><span class="hs-identifier hs-var">tyVarKind</span></a></span><span> </span><span class="annot"><span class="annottext">CoVar
</span><a href="#local-6989586621682579538"><span class="hs-identifier hs-var">tv2</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-2761"></span><span>            </span><span id="local-6989586621682579543"><span class="annot"><span class="annottext">in_scope :: InScopeSet
</span><a href="#local-6989586621682579543"><span class="hs-identifier hs-var hs-var">in_scope</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">VarSet -&gt; InScopeSet
</span><a href="GHC.Types.Var.Env.html#mkInScopeSet"><span class="hs-identifier hs-var">mkInScopeSet</span></a></span><span> </span><span class="annot"><span class="annottext">(VarSet -&gt; InScopeSet) -&gt; VarSet -&gt; InScopeSet
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Type -&gt; VarSet
</span><a href="GHC.Core.TyCo.FVs.html#tyCoVarsOfType"><span class="hs-identifier hs-var">tyCoVarsOfType</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682579540"><span class="hs-identifier hs-var">ty2</span></a></span><span> </span><span class="annot"><span class="annottext">VarSet -&gt; VarSet -&gt; VarSet
</span><a href="GHC.Types.Var.Set.html#unionVarSet"><span class="hs-operator hs-var">`unionVarSet`</span></a></span><span> </span><span class="annot"><span class="annottext">Coercion -&gt; VarSet
</span><a href="GHC.Core.TyCo.FVs.html#tyCoVarsOfCo"><span class="hs-identifier hs-var">tyCoVarsOfCo</span></a></span><span> </span><span class="annot"><span class="annottext">Coercion
</span><a href="#local-6989586621682579541"><span class="hs-identifier hs-var">kind_co</span></a></span><span>
</span><span id="line-2762"></span><span>            </span><span id="local-6989586621682579542"><span class="annot"><span class="annottext">ty2' :: Type
</span><a href="#local-6989586621682579542"><span class="hs-identifier hs-var hs-var">ty2'</span></a></span></span><span>     </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">HasDebugCallStack =&gt;
InScopeSet -&gt; [CoVar] -&gt; [Type] -&gt; Type -&gt; Type
InScopeSet -&gt; [CoVar] -&gt; [Type] -&gt; Type -&gt; Type
</span><a href="GHC.Core.TyCo.Subst.html#substTyWithInScope"><span class="hs-identifier hs-var">substTyWithInScope</span></a></span><span> </span><span class="annot"><span class="annottext">InScopeSet
</span><a href="#local-6989586621682579543"><span class="hs-identifier hs-var">in_scope</span></a></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">CoVar
</span><a href="#local-6989586621682579538"><span class="hs-identifier hs-var">tv2</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-2763"></span><span>                         </span><span class="hs-special">[</span><span class="annot"><span class="annottext">CoVar -&gt; Type
</span><a href="GHC.Core.TyCo.Rep.html#mkTyVarTy"><span class="hs-identifier hs-var">mkTyVarTy</span></a></span><span> </span><span class="annot"><span class="annottext">CoVar
</span><a href="#local-6989586621682579535"><span class="hs-identifier hs-var">tv1</span></a></span><span> </span><span class="annot"><span class="annottext">Type -&gt; Coercion -&gt; Type
</span><a href="GHC.Core.Type.html#mkCastTy"><span class="hs-operator hs-var">`mkCastTy`</span></a></span><span> </span><span class="annot"><span class="annottext">Coercion
</span><a href="#local-6989586621682579541"><span class="hs-identifier hs-var">kind_co</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-2764"></span><span>                         </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682579540"><span class="hs-identifier hs-var">ty2</span></a></span><span>
</span><span id="line-2765"></span><span>
</span><span id="line-2766"></span><span>    </span><span class="annot"><a href="#local-6989586621682579493"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#ForAllTy"><span class="hs-identifier hs-type">ForAllTy</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Types.Var.html#Bndr"><span class="hs-identifier hs-type">Bndr</span></a></span><span> </span><span id="local-6989586621682579546"><span class="annot"><span class="annottext">CoVar
</span><a href="#local-6989586621682579546"><span class="hs-identifier hs-var">cv1</span></a></span></span><span> </span><span id="local-6989586621682579547"><span class="annot"><span class="annottext">ForAllTyFlag
</span><a href="#local-6989586621682579547"><span class="hs-identifier hs-var">flag1</span></a></span></span><span class="hs-special">)</span><span> </span><span id="local-6989586621682579548"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682579548"><span class="hs-identifier hs-var">ty1</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#ForAllTy"><span class="hs-identifier hs-type">ForAllTy</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Types.Var.html#Bndr"><span class="hs-identifier hs-type">Bndr</span></a></span><span> </span><span id="local-6989586621682579549"><span class="annot"><span class="annottext">CoVar
</span><a href="#local-6989586621682579549"><span class="hs-identifier hs-var">cv2</span></a></span></span><span> </span><span id="local-6989586621682579550"><span class="annot"><span class="annottext">ForAllTyFlag
</span><a href="#local-6989586621682579550"><span class="hs-identifier hs-var">flag2</span></a></span></span><span class="hs-special">)</span><span> </span><span id="local-6989586621682579551"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682579551"><span class="hs-identifier hs-var">ty2</span></a></span></span><span class="hs-special">)</span><span>
</span><span id="line-2767"></span><span>      </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Coercion -&gt; Coercion
forall a. HasCallStack =&gt; Bool -&gt; a -&gt; a
</span><a href="GHC.Utils.Panic.Plain.html#assert"><span class="hs-identifier hs-var">assert</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">CoVar -&gt; Bool
</span><a href="GHC.Types.Var.html#isCoVar"><span class="hs-identifier hs-var">isCoVar</span></a></span><span> </span><span class="annot"><span class="annottext">CoVar
</span><a href="#local-6989586621682579546"><span class="hs-identifier hs-var">cv1</span></a></span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Bool -&gt; Bool
</span><span class="hs-operator hs-var">&amp;&amp;</span></span><span> </span><span class="annot"><span class="annottext">CoVar -&gt; Bool
</span><a href="GHC.Types.Var.html#isCoVar"><span class="hs-identifier hs-var">isCoVar</span></a></span><span> </span><span class="annot"><span class="annottext">CoVar
</span><a href="#local-6989586621682579549"><span class="hs-identifier hs-var">cv2</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(Coercion -&gt; Coercion) -&gt; Coercion -&gt; Coercion
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-2768"></span><span>        </span><span class="annot"><span class="annottext">HasDebugCallStack =&gt;
CoVar
-&gt; ForAllTyFlag -&gt; ForAllTyFlag -&gt; Coercion -&gt; Coercion -&gt; Coercion
CoVar
-&gt; ForAllTyFlag -&gt; ForAllTyFlag -&gt; Coercion -&gt; Coercion -&gt; Coercion
</span><a href="GHC.Core.Coercion.html#mkForAllCo"><span class="hs-identifier hs-var">mkForAllCo</span></a></span><span> </span><span class="annot"><span class="annottext">CoVar
</span><a href="#local-6989586621682579546"><span class="hs-identifier hs-var">cv1</span></a></span><span> </span><span class="annot"><span class="annottext">ForAllTyFlag
</span><a href="#local-6989586621682579547"><span class="hs-identifier hs-var">flag1</span></a></span><span> </span><span class="annot"><span class="annottext">ForAllTyFlag
</span><a href="#local-6989586621682579550"><span class="hs-identifier hs-var">flag2</span></a></span><span> </span><span class="annot"><span class="annottext">Coercion
</span><a href="#local-6989586621682579552"><span class="hs-identifier hs-var">kind_co</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Type -&gt; Type -&gt; Coercion
</span><a href="#local-6989586621682579493"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682579548"><span class="hs-identifier hs-var">ty1</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682579553"><span class="hs-identifier hs-var">ty2'</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-2769"></span><span>      </span><span class="hs-keyword">where</span><span> </span><span id="local-6989586621682579554"><span class="annot"><span class="annottext">s1 :: Type
</span><a href="#local-6989586621682579554"><span class="hs-identifier hs-var hs-var">s1</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">CoVar -&gt; Type
</span><a href="GHC.Types.Var.html#varType"><span class="hs-identifier hs-var">varType</span></a></span><span> </span><span class="annot"><span class="annottext">CoVar
</span><a href="#local-6989586621682579546"><span class="hs-identifier hs-var">cv1</span></a></span><span>
</span><span id="line-2770"></span><span>            </span><span id="local-6989586621682579555"><span class="annot"><span class="annottext">s2 :: Type
</span><a href="#local-6989586621682579555"><span class="hs-identifier hs-var hs-var">s2</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">CoVar -&gt; Type
</span><a href="GHC.Types.Var.html#varType"><span class="hs-identifier hs-var">varType</span></a></span><span> </span><span class="annot"><span class="annottext">CoVar
</span><a href="#local-6989586621682579549"><span class="hs-identifier hs-var">cv2</span></a></span><span>
</span><span id="line-2771"></span><span>            </span><span id="local-6989586621682579552"><span class="annot"><span class="annottext">kind_co :: Coercion
</span><a href="#local-6989586621682579552"><span class="hs-identifier hs-var hs-var">kind_co</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Type -&gt; Type -&gt; Coercion
</span><a href="#local-6989586621682579493"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682579554"><span class="hs-identifier hs-var">s1</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682579555"><span class="hs-identifier hs-var">s2</span></a></span><span>
</span><span id="line-2772"></span><span>
</span><span id="line-2773"></span><span>            </span><span class="hs-comment">-- s1 = t1 ~r t2</span><span>
</span><span id="line-2774"></span><span>            </span><span class="hs-comment">-- s2 = t3 ~r t4</span><span>
</span><span id="line-2775"></span><span>            </span><span class="hs-comment">-- kind_co :: (t1 ~r t2) ~N (t3 ~r t4)</span><span>
</span><span id="line-2776"></span><span>            </span><span class="hs-comment">-- eta1 :: t1 ~r t3</span><span>
</span><span id="line-2777"></span><span>            </span><span class="hs-comment">-- eta2 :: t2 ~r t4</span><span>
</span><span id="line-2778"></span><span>
</span><span id="line-2779"></span><span>            </span><span id="local-6989586621682579556"><span class="annot"><span class="annottext">r :: Role
</span><a href="#local-6989586621682579556"><span class="hs-identifier hs-var hs-var">r</span></a></span></span><span>    </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">CoVar -&gt; Role
</span><a href="GHC.Core.Coercion.html#coVarRole"><span class="hs-identifier hs-var">coVarRole</span></a></span><span> </span><span class="annot"><span class="annottext">CoVar
</span><a href="#local-6989586621682579546"><span class="hs-identifier hs-var">cv1</span></a></span><span>
</span><span id="line-2780"></span><span>            </span><span id="local-6989586621682579557"><span class="annot"><span class="annottext">kind_co' :: Coercion
</span><a href="#local-6989586621682579557"><span class="hs-identifier hs-var hs-var">kind_co'</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Role -&gt; Role -&gt; Coercion -&gt; Coercion
</span><a href="GHC.Core.Coercion.html#downgradeRole"><span class="hs-identifier hs-var">downgradeRole</span></a></span><span> </span><span class="annot"><span class="annottext">Role
</span><a href="#local-6989586621682579556"><span class="hs-identifier hs-var">r</span></a></span><span> </span><span class="annot"><span class="annottext">Role
</span><a href="Language.Haskell.Syntax.Basic.html#Nominal"><span class="hs-identifier hs-var">Nominal</span></a></span><span> </span><span class="annot"><span class="annottext">Coercion
</span><a href="#local-6989586621682579552"><span class="hs-identifier hs-var">kind_co</span></a></span><span>
</span><span id="line-2781"></span><span>            </span><span id="local-6989586621682579558"><span class="annot"><span class="annottext">eta1 :: Coercion
</span><a href="#local-6989586621682579558"><span class="hs-identifier hs-var hs-var">eta1</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">HasDebugCallStack =&gt; CoSel -&gt; Coercion -&gt; Coercion
CoSel -&gt; Coercion -&gt; Coercion
</span><a href="GHC.Core.Coercion.html#mkSelCo"><span class="hs-identifier hs-var">mkSelCo</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Arity -&gt; Role -&gt; CoSel
</span><a href="GHC.Core.TyCo.Rep.html#SelTyCon"><span class="hs-identifier hs-var">SelTyCon</span></a></span><span> </span><span class="annot"><span class="annottext">Arity
</span><span class="hs-number">2</span></span><span> </span><span class="annot"><span class="annottext">Role
</span><a href="#local-6989586621682579556"><span class="hs-identifier hs-var">r</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Coercion
</span><a href="#local-6989586621682579557"><span class="hs-identifier hs-var">kind_co'</span></a></span><span>
</span><span id="line-2782"></span><span>            </span><span id="local-6989586621682579559"><span class="annot"><span class="annottext">eta2 :: Coercion
</span><a href="#local-6989586621682579559"><span class="hs-identifier hs-var hs-var">eta2</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">HasDebugCallStack =&gt; CoSel -&gt; Coercion -&gt; Coercion
CoSel -&gt; Coercion -&gt; Coercion
</span><a href="GHC.Core.Coercion.html#mkSelCo"><span class="hs-identifier hs-var">mkSelCo</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Arity -&gt; Role -&gt; CoSel
</span><a href="GHC.Core.TyCo.Rep.html#SelTyCon"><span class="hs-identifier hs-var">SelTyCon</span></a></span><span> </span><span class="annot"><span class="annottext">Arity
</span><span class="hs-number">3</span></span><span> </span><span class="annot"><span class="annottext">Role
</span><a href="#local-6989586621682579556"><span class="hs-identifier hs-var">r</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Coercion
</span><a href="#local-6989586621682579557"><span class="hs-identifier hs-var">kind_co'</span></a></span><span>
</span><span id="line-2783"></span><span>
</span><span id="line-2784"></span><span>            </span><span id="local-6989586621682579560"><span class="annot"><span class="annottext">subst :: Subst
</span><a href="#local-6989586621682579560"><span class="hs-identifier hs-var hs-var">subst</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">InScopeSet -&gt; Subst
</span><a href="GHC.Core.TyCo.Subst.html#mkEmptySubst"><span class="hs-identifier hs-var">mkEmptySubst</span></a></span><span> </span><span class="annot"><span class="annottext">(InScopeSet -&gt; Subst) -&gt; InScopeSet -&gt; Subst
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">VarSet -&gt; InScopeSet
</span><a href="GHC.Types.Var.Env.html#mkInScopeSet"><span class="hs-identifier hs-var">mkInScopeSet</span></a></span><span> </span><span class="annot"><span class="annottext">(VarSet -&gt; InScopeSet) -&gt; VarSet -&gt; InScopeSet
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-2785"></span><span>                      </span><span class="annot"><span class="annottext">Type -&gt; VarSet
</span><a href="GHC.Core.TyCo.FVs.html#tyCoVarsOfType"><span class="hs-identifier hs-var">tyCoVarsOfType</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682579551"><span class="hs-identifier hs-var">ty2</span></a></span><span> </span><span class="annot"><span class="annottext">VarSet -&gt; VarSet -&gt; VarSet
</span><a href="GHC.Types.Var.Set.html#unionVarSet"><span class="hs-operator hs-var">`unionVarSet`</span></a></span><span> </span><span class="annot"><span class="annottext">Coercion -&gt; VarSet
</span><a href="GHC.Core.TyCo.FVs.html#tyCoVarsOfCo"><span class="hs-identifier hs-var">tyCoVarsOfCo</span></a></span><span> </span><span class="annot"><span class="annottext">Coercion
</span><a href="#local-6989586621682579552"><span class="hs-identifier hs-var">kind_co</span></a></span><span>
</span><span id="line-2786"></span><span>            </span><span id="local-6989586621682579553"><span class="annot"><span class="annottext">ty2' :: Type
</span><a href="#local-6989586621682579553"><span class="hs-identifier hs-var hs-var">ty2'</span></a></span></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">HasDebugCallStack =&gt; Subst -&gt; Type -&gt; Type
Subst -&gt; Type -&gt; Type
</span><a href="GHC.Core.TyCo.Subst.html#substTy"><span class="hs-identifier hs-var">substTy</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Subst -&gt; CoVar -&gt; Coercion -&gt; Subst
</span><a href="GHC.Core.TyCo.Subst.html#extendCvSubst"><span class="hs-identifier hs-var">extendCvSubst</span></a></span><span> </span><span class="annot"><span class="annottext">Subst
</span><a href="#local-6989586621682579560"><span class="hs-identifier hs-var">subst</span></a></span><span> </span><span class="annot"><span class="annottext">CoVar
</span><a href="#local-6989586621682579549"><span class="hs-identifier hs-var">cv2</span></a></span><span> </span><span class="annot"><span class="annottext">(Coercion -&gt; Subst) -&gt; Coercion -&gt; Subst
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Coercion -&gt; Coercion
</span><a href="GHC.Core.Coercion.html#mkSymCo"><span class="hs-identifier hs-var">mkSymCo</span></a></span><span> </span><span class="annot"><span class="annottext">Coercion
</span><a href="#local-6989586621682579558"><span class="hs-identifier hs-var">eta1</span></a></span><span> </span><span class="annot"><span class="annottext">HasDebugCallStack =&gt; Coercion -&gt; Coercion -&gt; Coercion
Coercion -&gt; Coercion -&gt; Coercion
</span><a href="GHC.Core.Coercion.html#mkTransCo"><span class="hs-operator hs-var">`mkTransCo`</span></a></span><span>
</span><span id="line-2787"></span><span>                                                       </span><span class="annot"><span class="annottext">CoVar -&gt; Coercion
</span><a href="GHC.Core.Coercion.html#mkCoVarCo"><span class="hs-identifier hs-var">mkCoVarCo</span></a></span><span> </span><span class="annot"><span class="annottext">CoVar
</span><a href="#local-6989586621682579546"><span class="hs-identifier hs-var">cv1</span></a></span><span> </span><span class="annot"><span class="annottext">HasDebugCallStack =&gt; Coercion -&gt; Coercion -&gt; Coercion
Coercion -&gt; Coercion -&gt; Coercion
</span><a href="GHC.Core.Coercion.html#mkTransCo"><span class="hs-operator hs-var">`mkTransCo`</span></a></span><span>
</span><span id="line-2788"></span><span>                                                       </span><span class="annot"><span class="annottext">Coercion
</span><a href="#local-6989586621682579559"><span class="hs-identifier hs-var">eta2</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-2789"></span><span>                            </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682579551"><span class="hs-identifier hs-var">ty2</span></a></span><span>
</span><span id="line-2790"></span><span>
</span><span id="line-2791"></span><span>    </span><span class="annot"><a href="#local-6989586621682579493"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span id="local-6989586621682579561"><span class="annot"><span class="annottext">ty1 :: Type
</span><a href="#local-6989586621682579561"><span class="hs-identifier hs-var">ty1</span></a></span></span><span class="hs-glyph">@</span><span class="hs-special">(</span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#LitTy"><span class="hs-identifier hs-type">LitTy</span></a></span><span> </span><span id="local-6989586621682579562"><span class="annot"><span class="annottext">TyLit
</span><a href="#local-6989586621682579562"><span class="hs-identifier hs-var">lit1</span></a></span></span><span class="hs-special">)</span><span> </span><span id="local-6989586621682579563"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682579563"><span class="hs-identifier hs-var">_lit2</span></a></span></span><span>
</span><span id="line-2792"></span><span>      </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Coercion -&gt; Coercion
forall a. HasCallStack =&gt; Bool -&gt; a -&gt; a
</span><a href="GHC.Utils.Panic.Plain.html#assert"><span class="hs-identifier hs-var">assert</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682579563"><span class="hs-identifier hs-var">_lit2</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-2793"></span><span>                  </span><span class="hs-special">{</span><span> </span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#LitTy"><span class="hs-identifier hs-type">LitTy</span></a></span><span> </span><span id="local-6989586621682579564"><span class="annot"><span class="annottext">TyLit
</span><a href="#local-6989586621682579564"><span class="hs-identifier hs-var">lit2</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">TyLit
</span><a href="#local-6989586621682579562"><span class="hs-identifier hs-var">lit1</span></a></span><span> </span><span class="annot"><span class="annottext">TyLit -&gt; TyLit -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">==</span></span><span> </span><span class="annot"><span class="annottext">TyLit
</span><a href="#local-6989586621682579564"><span class="hs-identifier hs-var">lit2</span></a></span><span>
</span><span id="line-2794"></span><span>                  </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="annottext">Type
</span><span class="hs-identifier">_</span></span><span>          </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">False</span></span><span>        </span><span class="hs-special">}</span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(Coercion -&gt; Coercion) -&gt; Coercion -&gt; Coercion
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-2795"></span><span>        </span><span class="annot"><span class="annottext">Type -&gt; Coercion
</span><a href="GHC.Core.Coercion.html#mkNomReflCo"><span class="hs-identifier hs-var">mkNomReflCo</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682579561"><span class="hs-identifier hs-var">ty1</span></a></span><span>
</span><span id="line-2796"></span><span>
</span><span id="line-2797"></span><span>    </span><span class="annot"><a href="#local-6989586621682579493"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#CoercionTy"><span class="hs-identifier hs-type">CoercionTy</span></a></span><span> </span><span id="local-6989586621682579565"><span class="annot"><span class="annottext">Coercion
</span><a href="#local-6989586621682579565"><span class="hs-identifier hs-var">co1</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#CoercionTy"><span class="hs-identifier hs-type">CoercionTy</span></a></span><span> </span><span id="local-6989586621682579566"><span class="annot"><span class="annottext">Coercion
</span><a href="#local-6989586621682579566"><span class="hs-identifier hs-var">co2</span></a></span></span><span class="hs-special">)</span><span>
</span><span id="line-2798"></span><span>      </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Role -&gt; Coercion -&gt; Coercion -&gt; Coercion -&gt; Coercion
</span><a href="GHC.Core.Coercion.html#mkProofIrrelCo"><span class="hs-identifier hs-var">mkProofIrrelCo</span></a></span><span> </span><span class="annot"><span class="annottext">Role
</span><a href="Language.Haskell.Syntax.Basic.html#Nominal"><span class="hs-identifier hs-var">Nominal</span></a></span><span> </span><span class="annot"><span class="annottext">Coercion
</span><a href="#local-6989586621682579567"><span class="hs-identifier hs-var">kind_co</span></a></span><span> </span><span class="annot"><span class="annottext">Coercion
</span><a href="#local-6989586621682579565"><span class="hs-identifier hs-var">co1</span></a></span><span> </span><span class="annot"><span class="annottext">Coercion
</span><a href="#local-6989586621682579566"><span class="hs-identifier hs-var">co2</span></a></span><span>
</span><span id="line-2799"></span><span>      </span><span class="hs-keyword">where</span><span>
</span><span id="line-2800"></span><span>        </span><span id="local-6989586621682579567"><span class="annot"><span class="annottext">kind_co :: Coercion
</span><a href="#local-6989586621682579567"><span class="hs-identifier hs-var hs-var">kind_co</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Type -&gt; Type -&gt; Coercion
</span><a href="#local-6989586621682579493"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Coercion -&gt; Type
</span><a href="GHC.Core.Coercion.html#coercionType"><span class="hs-identifier hs-var">coercionType</span></a></span><span> </span><span class="annot"><span class="annottext">Coercion
</span><a href="#local-6989586621682579565"><span class="hs-identifier hs-var">co1</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Coercion -&gt; Type
</span><a href="GHC.Core.Coercion.html#coercionType"><span class="hs-identifier hs-var">coercionType</span></a></span><span> </span><span class="annot"><span class="annottext">Coercion
</span><a href="#local-6989586621682579566"><span class="hs-identifier hs-var">co2</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-2801"></span><span>
</span><span id="line-2802"></span><span>    </span><span class="annot"><a href="#local-6989586621682579493"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span id="local-6989586621682579568"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682579568"><span class="hs-identifier hs-var">ty1</span></a></span></span><span> </span><span id="local-6989586621682579569"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682579569"><span class="hs-identifier hs-var">ty2</span></a></span></span><span>
</span><span id="line-2803"></span><span>      </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">String -&gt; SDoc -&gt; Coercion
forall a. HasCallStack =&gt; String -&gt; SDoc -&gt; a
</span><a href="GHC.Utils.Panic.html#pprPanic"><span class="hs-identifier hs-var">pprPanic</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;buildKindCoercion&quot;</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[SDoc] -&gt; SDoc
forall doc. IsDoc doc =&gt; [doc] -&gt; doc
</span><a href="GHC.Utils.Outputable.html#vcat"><span class="hs-identifier hs-var">vcat</span></a></span><span> </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">Type -&gt; SDoc
forall a. Outputable a =&gt; a -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682579491"><span class="hs-identifier hs-var">orig_ty1</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Type -&gt; SDoc
forall a. Outputable a =&gt; a -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682579492"><span class="hs-identifier hs-var">orig_ty2</span></a></span><span>
</span><span id="line-2804"></span><span>                                           </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Type -&gt; SDoc
forall a. Outputable a =&gt; a -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682579568"><span class="hs-identifier hs-var">ty1</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Type -&gt; SDoc
forall a. Outputable a =&gt; a -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682579569"><span class="hs-identifier hs-var">ty2</span></a></span><span> </span><span class="hs-special">]</span><span class="hs-special">)</span><span>
</span><span id="line-2805"></span><span>
</span><span id="line-2806"></span><span>
</span><span id="line-2807"></span><span class="hs-comment">{-
%************************************************************************
%*                                                                      *
       Coercion holes
%*                                                                      *
%************************************************************************
-}</span><span>
</span><span id="line-2814"></span><span>
</span><span id="line-2815"></span><span class="annot"><a href="GHC.Core.Coercion.html#has_co_hole_ty"><span class="hs-identifier hs-type">has_co_hole_ty</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#Type"><span class="hs-identifier hs-type">Type</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Monoid.Any</span></span><span>
</span><span id="line-2816"></span><span class="annot"><a href="GHC.Core.Coercion.html#has_co_hole_co"><span class="hs-identifier hs-type">has_co_hole_co</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#Coercion"><span class="hs-identifier hs-type">Coercion</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Monoid.Any</span></span><span>
</span><span id="line-2817"></span><span class="hs-special">(</span><span id="has_co_hole_ty"><span class="annot"><span class="annottext">Type -&gt; Any
</span><a href="GHC.Core.Coercion.html#has_co_hole_ty"><span class="hs-identifier hs-var">has_co_hole_ty</span></a></span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">[Type] -&gt; Any
</span><span class="hs-identifier">_</span></span><span class="hs-special">,</span><span> </span><span id="has_co_hole_co"><span class="annot"><span class="annottext">Coercion -&gt; Any
</span><a href="GHC.Core.Coercion.html#has_co_hole_co"><span class="hs-identifier hs-var">has_co_hole_co</span></a></span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">[Coercion] -&gt; Any
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span>
</span><span id="line-2818"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">TyCoFolder () Any
-&gt; ()
-&gt; (Type -&gt; Any, [Type] -&gt; Any, Coercion -&gt; Any, [Coercion] -&gt; Any)
forall a env.
Monoid a =&gt;
TyCoFolder env a
-&gt; env -&gt; (Type -&gt; a, [Type] -&gt; a, Coercion -&gt; a, [Coercion] -&gt; a)
</span><a href="GHC.Core.TyCo.Rep.html#foldTyCo"><span class="hs-identifier hs-var">foldTyCo</span></a></span><span> </span><span class="annot"><span class="annottext">TyCoFolder () Any
forall {env}. TyCoFolder env Any
</span><a href="#local-6989586621682579574"><span class="hs-identifier hs-var">folder</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-2819"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-2820"></span><span>    </span><span id="local-6989586621682579574"><span class="annot"><span class="annottext">folder :: TyCoFolder env Any
</span><a href="#local-6989586621682579574"><span class="hs-identifier hs-var hs-var">folder</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#TyCoFolder"><span class="hs-identifier hs-type">TyCoFolder</span></a></span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">tcf_view :: Type -&gt; Maybe Type
</span><a href="GHC.Core.TyCo.Rep.html#tcf_view"><span class="hs-identifier hs-var">tcf_view</span></a></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Type -&gt; Maybe Type
</span><a href="GHC.Core.TyCo.Rep.html#noView"><span class="hs-identifier hs-var">noView</span></a></span><span>
</span><span id="line-2821"></span><span>                        </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">tcf_tyvar :: env -&gt; CoVar -&gt; Any
</span><a href="GHC.Core.TyCo.Rep.html#tcf_tyvar"><span class="hs-identifier hs-var">tcf_tyvar</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Any -&gt; env -&gt; CoVar -&gt; Any
forall a b c. a -&gt; b -&gt; c -&gt; a
</span><a href="GHC.Utils.Misc.html#const2"><span class="hs-identifier hs-var">const2</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Bool -&gt; Any
</span><span class="hs-identifier hs-var">Monoid.Any</span></span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">False</span></span><span class="hs-special">)</span><span>
</span><span id="line-2822"></span><span>                        </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">tcf_covar :: env -&gt; CoVar -&gt; Any
</span><a href="GHC.Core.TyCo.Rep.html#tcf_covar"><span class="hs-identifier hs-var">tcf_covar</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Any -&gt; env -&gt; CoVar -&gt; Any
forall a b c. a -&gt; b -&gt; c -&gt; a
</span><a href="GHC.Utils.Misc.html#const2"><span class="hs-identifier hs-var">const2</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Bool -&gt; Any
</span><span class="hs-identifier hs-var">Monoid.Any</span></span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">False</span></span><span class="hs-special">)</span><span>
</span><span id="line-2823"></span><span>                        </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">tcf_hole :: env -&gt; CoercionHole -&gt; Any
</span><a href="GHC.Core.TyCo.Rep.html#tcf_hole"><span class="hs-identifier hs-var">tcf_hole</span></a></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-glyph">\</span><span class="annot"><span class="annottext">env
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621682579583"><span class="annot"><span class="annottext">CoercionHole
</span><a href="#local-6989586621682579583"><span class="hs-identifier hs-var">hole</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Any
</span><span class="hs-identifier hs-var">Monoid.Any</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">CoercionHole -&gt; Bool
</span><a href="GHC.Core.TyCo.Rep.html#isHeteroKindCoHole"><span class="hs-identifier hs-var">isHeteroKindCoHole</span></a></span><span> </span><span class="annot"><span class="annottext">CoercionHole
</span><a href="#local-6989586621682579583"><span class="hs-identifier hs-var">hole</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-2824"></span><span>                        </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">tcf_tycobinder :: env -&gt; CoVar -&gt; ForAllTyFlag -&gt; env
</span><a href="GHC.Core.TyCo.Rep.html#tcf_tycobinder"><span class="hs-identifier hs-var">tcf_tycobinder</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">env -&gt; CoVar -&gt; ForAllTyFlag -&gt; env
forall a b c. a -&gt; b -&gt; c -&gt; a
</span><a href="GHC.Utils.Misc.html#const2"><span class="hs-identifier hs-var">const2</span></a></span><span>
</span><span id="line-2825"></span><span>                        </span><span class="hs-special">}</span><span>
</span><span id="line-2826"></span><span>
</span><span id="line-2827"></span><span class="hs-comment">-- | Is there a hetero-kind coercion hole in this type?</span><span>
</span><span id="line-2828"></span><span class="hs-comment">--   (That is, a coercion hole with ch_hetero_kind=True.)</span><span>
</span><span id="line-2829"></span><span class="hs-comment">-- See wrinkle (EIK2) of Note [Equalities with incompatible kinds] in GHC.Tc.Solver.Equality</span><span>
</span><span id="line-2830"></span><span class="annot"><a href="GHC.Core.Coercion.html#hasCoercionHoleTy"><span class="hs-identifier hs-type">hasCoercionHoleTy</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#Type"><span class="hs-identifier hs-type">Type</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Bool</span></span><span>
</span><span id="line-2831"></span><span id="hasCoercionHoleTy"><span class="annot"><span class="annottext">hasCoercionHoleTy :: Type -&gt; Bool
</span><a href="GHC.Core.Coercion.html#hasCoercionHoleTy"><span class="hs-identifier hs-var hs-var">hasCoercionHoleTy</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Any -&gt; Bool
</span><span class="hs-identifier hs-var">Monoid.getAny</span></span><span> </span><span class="annot"><span class="annottext">(Any -&gt; Bool) -&gt; (Type -&gt; Any) -&gt; Type -&gt; Bool
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">Type -&gt; Any
</span><a href="GHC.Core.Coercion.html#has_co_hole_ty"><span class="hs-identifier hs-var">has_co_hole_ty</span></a></span><span>
</span><span id="line-2832"></span><span>
</span><span id="line-2833"></span><span class="annot"><span class="hs-comment">-- | Is there a hetero-kind coercion hole in this coercion?</span></span><span>
</span><span id="line-2834"></span><span class="annot"><a href="GHC.Core.Coercion.html#hasCoercionHoleCo"><span class="hs-identifier hs-type">hasCoercionHoleCo</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#Coercion"><span class="hs-identifier hs-type">Coercion</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Bool</span></span><span>
</span><span id="line-2835"></span><span id="hasCoercionHoleCo"><span class="annot"><span class="annottext">hasCoercionHoleCo :: Coercion -&gt; Bool
</span><a href="GHC.Core.Coercion.html#hasCoercionHoleCo"><span class="hs-identifier hs-var hs-var">hasCoercionHoleCo</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Any -&gt; Bool
</span><span class="hs-identifier hs-var">Monoid.getAny</span></span><span> </span><span class="annot"><span class="annottext">(Any -&gt; Bool) -&gt; (Coercion -&gt; Any) -&gt; Coercion -&gt; Bool
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">Coercion -&gt; Any
</span><a href="GHC.Core.Coercion.html#has_co_hole_co"><span class="hs-identifier hs-var">has_co_hole_co</span></a></span><span>
</span><span id="line-2836"></span><span>
</span><span id="line-2837"></span><span class="annot"><a href="GHC.Core.Coercion.html#hasThisCoercionHoleTy"><span class="hs-identifier hs-type">hasThisCoercionHoleTy</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#Type"><span class="hs-identifier hs-type">Type</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#CoercionHole"><span class="hs-identifier hs-type">CoercionHole</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Bool</span></span><span>
</span><span id="line-2838"></span><span id="hasThisCoercionHoleTy"><span class="annot"><span class="annottext">hasThisCoercionHoleTy :: Type -&gt; CoercionHole -&gt; Bool
</span><a href="GHC.Core.Coercion.html#hasThisCoercionHoleTy"><span class="hs-identifier hs-var hs-var">hasThisCoercionHoleTy</span></a></span></span><span> </span><span id="local-6989586621682579587"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682579587"><span class="hs-identifier hs-var">ty</span></a></span></span><span> </span><span id="local-6989586621682579588"><span class="annot"><span class="annottext">CoercionHole
</span><a href="#local-6989586621682579588"><span class="hs-identifier hs-var">hole</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Any -&gt; Bool
</span><span class="hs-identifier hs-var">Monoid.getAny</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Type -&gt; Any
</span><a href="#local-6989586621682579589"><span class="hs-identifier hs-var">f</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682579587"><span class="hs-identifier hs-var">ty</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-2839"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-2840"></span><span>    </span><span class="hs-special">(</span><span id="local-6989586621682579589"><span class="annot"><span class="annottext">Type -&gt; Any
</span><a href="#local-6989586621682579589"><span class="hs-identifier hs-var">f</span></a></span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">[Type] -&gt; Any
</span><span class="hs-identifier">_</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Coercion -&gt; Any
</span><span class="hs-identifier">_</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">[Coercion] -&gt; Any
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">TyCoFolder () Any
-&gt; ()
-&gt; (Type -&gt; Any, [Type] -&gt; Any, Coercion -&gt; Any, [Coercion] -&gt; Any)
forall a env.
Monoid a =&gt;
TyCoFolder env a
-&gt; env -&gt; (Type -&gt; a, [Type] -&gt; a, Coercion -&gt; a, [Coercion] -&gt; a)
</span><a href="GHC.Core.TyCo.Rep.html#foldTyCo"><span class="hs-identifier hs-var">foldTyCo</span></a></span><span> </span><span class="annot"><span class="annottext">TyCoFolder () Any
</span><a href="#local-6989586621682579590"><span class="hs-identifier hs-var">folder</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-2841"></span><span>
</span><span id="line-2842"></span><span>    </span><span id="local-6989586621682579590"><span class="annot"><span class="annottext">folder :: TyCoFolder () Any
</span><a href="#local-6989586621682579590"><span class="hs-identifier hs-var hs-var">folder</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#TyCoFolder"><span class="hs-identifier hs-type">TyCoFolder</span></a></span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">tcf_view :: Type -&gt; Maybe Type
</span><a href="GHC.Core.TyCo.Rep.html#tcf_view"><span class="hs-identifier hs-var">tcf_view</span></a></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Type -&gt; Maybe Type
</span><a href="GHC.Core.TyCo.Rep.html#noView"><span class="hs-identifier hs-var">noView</span></a></span><span>
</span><span id="line-2843"></span><span>                        </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">tcf_tyvar :: () -&gt; CoVar -&gt; Any
</span><a href="GHC.Core.TyCo.Rep.html#tcf_tyvar"><span class="hs-identifier hs-var">tcf_tyvar</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Any -&gt; () -&gt; CoVar -&gt; Any
forall a b c. a -&gt; b -&gt; c -&gt; a
</span><a href="GHC.Utils.Misc.html#const2"><span class="hs-identifier hs-var">const2</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Bool -&gt; Any
</span><span class="hs-identifier hs-var">Monoid.Any</span></span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">False</span></span><span class="hs-special">)</span><span>
</span><span id="line-2844"></span><span>                        </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">tcf_covar :: () -&gt; CoVar -&gt; Any
</span><a href="GHC.Core.TyCo.Rep.html#tcf_covar"><span class="hs-identifier hs-var">tcf_covar</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Any -&gt; () -&gt; CoVar -&gt; Any
forall a b c. a -&gt; b -&gt; c -&gt; a
</span><a href="GHC.Utils.Misc.html#const2"><span class="hs-identifier hs-var">const2</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Bool -&gt; Any
</span><span class="hs-identifier hs-var">Monoid.Any</span></span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">False</span></span><span class="hs-special">)</span><span>
</span><span id="line-2845"></span><span>                        </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">tcf_hole :: () -&gt; CoercionHole -&gt; Any
</span><a href="GHC.Core.TyCo.Rep.html#tcf_hole"><span class="hs-identifier hs-var">tcf_hole</span></a></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-glyph">\</span><span> </span><span class="annot"><span class="annottext">()
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621682579591"><span class="annot"><span class="annottext">CoercionHole
</span><a href="#local-6989586621682579591"><span class="hs-identifier hs-var">h</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Any
</span><span class="hs-identifier hs-var">Monoid.Any</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">CoercionHole -&gt; Unique
forall a. Uniquable a =&gt; a -&gt; Unique
</span><a href="GHC.Types.Unique.html#getUnique"><span class="hs-identifier hs-var">getUnique</span></a></span><span> </span><span class="annot"><span class="annottext">CoercionHole
</span><a href="#local-6989586621682579591"><span class="hs-identifier hs-var">h</span></a></span><span> </span><span class="annot"><span class="annottext">Unique -&gt; Unique -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">==</span></span><span> </span><span class="annot"><span class="annottext">CoercionHole -&gt; Unique
forall a. Uniquable a =&gt; a -&gt; Unique
</span><a href="GHC.Types.Unique.html#getUnique"><span class="hs-identifier hs-var">getUnique</span></a></span><span> </span><span class="annot"><span class="annottext">CoercionHole
</span><a href="#local-6989586621682579588"><span class="hs-identifier hs-var">hole</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-2846"></span><span>                        </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">tcf_tycobinder :: () -&gt; CoVar -&gt; ForAllTyFlag -&gt; ()
</span><a href="GHC.Core.TyCo.Rep.html#tcf_tycobinder"><span class="hs-identifier hs-var">tcf_tycobinder</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">() -&gt; CoVar -&gt; ForAllTyFlag -&gt; ()
forall a b c. a -&gt; b -&gt; c -&gt; a
</span><a href="GHC.Utils.Misc.html#const2"><span class="hs-identifier hs-var">const2</span></a></span><span>
</span><span id="line-2847"></span><span>                        </span><span class="hs-special">}</span><span>
</span><span id="line-2848"></span><span>
</span><span id="line-2849"></span><span class="annot"><span class="hs-comment">-- | Set the type of a 'CoercionHole'</span></span><span>
</span><span id="line-2850"></span><span class="annot"><a href="GHC.Core.Coercion.html#setCoHoleType"><span class="hs-identifier hs-type">setCoHoleType</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#CoercionHole"><span class="hs-identifier hs-type">CoercionHole</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#Type"><span class="hs-identifier hs-type">Type</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#CoercionHole"><span class="hs-identifier hs-type">CoercionHole</span></a></span><span>
</span><span id="line-2851"></span><span id="setCoHoleType"><span class="annot"><span class="annottext">setCoHoleType :: CoercionHole -&gt; Type -&gt; CoercionHole
</span><a href="GHC.Core.Coercion.html#setCoHoleType"><span class="hs-identifier hs-var hs-var">setCoHoleType</span></a></span></span><span> </span><span id="local-6989586621682579594"><span class="annot"><span class="annottext">CoercionHole
</span><a href="#local-6989586621682579594"><span class="hs-identifier hs-var">h</span></a></span></span><span> </span><span id="local-6989586621682579595"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682579595"><span class="hs-identifier hs-var">t</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">CoercionHole -&gt; CoVar -&gt; CoercionHole
</span><a href="GHC.Core.TyCo.Rep.html#setCoHoleCoVar"><span class="hs-identifier hs-var">setCoHoleCoVar</span></a></span><span> </span><span class="annot"><span class="annottext">CoercionHole
</span><a href="#local-6989586621682579594"><span class="hs-identifier hs-var">h</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">CoVar -&gt; Type -&gt; CoVar
</span><a href="GHC.Types.Var.html#setVarType"><span class="hs-identifier hs-var">setVarType</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">CoercionHole -&gt; CoVar
</span><a href="GHC.Core.TyCo.Rep.html#coHoleCoVar"><span class="hs-identifier hs-var">coHoleCoVar</span></a></span><span> </span><span class="annot"><span class="annottext">CoercionHole
</span><a href="#local-6989586621682579594"><span class="hs-identifier hs-var">h</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682579595"><span class="hs-identifier hs-var">t</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-2852"></span></pre></body></html>