<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><link rel="stylesheet" type="text/css" href="style.css" /><script type="text/javascript" src="highlight.js"></script></head><body><pre><span>
</span><span id="line-2"></span><span class="hs-comment">{-
(c) The University of Glasgow 2006
(c) The AQUA Project, Glasgow University, 1996-1998
-}</span><span>
</span><span id="line-6"></span><span>
</span><span id="line-7"></span><span class="hs-comment">-- | Zonking types within the typechecker.</span><span>
</span><span id="line-8"></span><span class="hs-comment">--</span><span>
</span><span id="line-9"></span><span class="hs-comment">-- Distinct from the final zonking pass in &quot;GHC.Tc.Zonk.Type&quot;;</span><span>
</span><span id="line-10"></span><span class="hs-comment">-- see Note [Module structure for zonking] in GHC.Tc.Zonk.Type.</span><span>
</span><span id="line-11"></span><span class="hs-keyword">module</span><span> </span><span class="annot"><a href="GHC.Tc.Zonk.TcType.html"><span class="hs-identifier">GHC.Tc.Zonk.TcType</span></a></span><span>
</span><span id="line-12"></span><span>  </span><span class="hs-special">(</span><span> </span><span class="annot"><span class="hs-comment">-- * Zonking (within the typechecker)</span></span><span>
</span><span id="line-13"></span><span>
</span><span id="line-14"></span><span>    </span><span class="annot"><span class="hs-comment">-- ** The 'ZonkM' monad and 'ZonkGblEnv'</span></span><span>
</span><span id="line-15"></span><span>    </span><span class="hs-keyword">module</span><span> </span><span class="annot"><a href="GHC.Tc.Zonk.Monad.html"><span class="hs-identifier">GHC.Tc.Zonk.Monad</span></a></span><span>
</span><span id="line-16"></span><span>
</span><span id="line-17"></span><span>    </span><span class="annot"><span class="hs-comment">-- ** Zonking types</span></span><span>
</span><span id="line-18"></span><span>  </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Tc.Zonk.TcType.html#zonkTcType"><span class="hs-identifier">zonkTcType</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Tc.Zonk.TcType.html#zonkTcTypes"><span class="hs-identifier">zonkTcTypes</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Tc.Zonk.TcType.html#zonkScaledTcType"><span class="hs-identifier">zonkScaledTcType</span></a></span><span>
</span><span id="line-19"></span><span>  </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Tc.Zonk.TcType.html#zonkTcTyVar"><span class="hs-identifier">zonkTcTyVar</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Tc.Zonk.TcType.html#zonkTcTyVars"><span class="hs-identifier">zonkTcTyVars</span></a></span><span>
</span><span id="line-20"></span><span>  </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Tc.Zonk.TcType.html#zonkTcTyVarToTcTyVar"><span class="hs-identifier">zonkTcTyVarToTcTyVar</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Tc.Zonk.TcType.html#zonkTcTyVarsToTcTyVars"><span class="hs-identifier">zonkTcTyVarsToTcTyVars</span></a></span><span>
</span><span id="line-21"></span><span>  </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Tc.Zonk.TcType.html#zonkInvisTVBinder"><span class="hs-identifier">zonkInvisTVBinder</span></a></span><span>
</span><span id="line-22"></span><span>  </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Tc.Zonk.TcType.html#zonkCo"><span class="hs-identifier">zonkCo</span></a></span><span>
</span><span id="line-23"></span><span>
</span><span id="line-24"></span><span>    </span><span class="annot"><span class="hs-comment">-- ** Zonking 'TyCon's</span></span><span>
</span><span id="line-25"></span><span>  </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Tc.Zonk.TcType.html#zonkTcTyCon"><span class="hs-identifier">zonkTcTyCon</span></a></span><span>
</span><span id="line-26"></span><span>
</span><span id="line-27"></span><span>    </span><span class="annot"><span class="hs-comment">-- *** FreeVars</span></span><span>
</span><span id="line-28"></span><span>  </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Tc.Zonk.TcType.html#zonkTcTypeAndFV"><span class="hs-identifier">zonkTcTypeAndFV</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Tc.Zonk.TcType.html#zonkTyCoVarsAndFV"><span class="hs-identifier">zonkTyCoVarsAndFV</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Tc.Zonk.TcType.html#zonkTyCoVarsAndFVList"><span class="hs-identifier">zonkTyCoVarsAndFVList</span></a></span><span>
</span><span id="line-29"></span><span>  </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Tc.Zonk.TcType.html#zonkDTyCoVarSetAndFV"><span class="hs-identifier">zonkDTyCoVarSetAndFV</span></a></span><span>
</span><span id="line-30"></span><span>
</span><span id="line-31"></span><span>    </span><span class="annot"><span class="hs-comment">-- ** Zonking 'CoVar's and 'Id's</span></span><span>
</span><span id="line-32"></span><span>  </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Tc.Zonk.TcType.html#zonkId"><span class="hs-identifier">zonkId</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Tc.Zonk.TcType.html#zonkCoVar"><span class="hs-identifier">zonkCoVar</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Tc.Zonk.TcType.html#zonkTyCoVar"><span class="hs-identifier">zonkTyCoVar</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Tc.Zonk.TcType.html#zonkTyCoVarKind"><span class="hs-identifier">zonkTyCoVarKind</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Tc.Zonk.TcType.html#zonkTyCoVarBndrKind"><span class="hs-identifier">zonkTyCoVarBndrKind</span></a></span><span>
</span><span id="line-33"></span><span>
</span><span id="line-34"></span><span>    </span><span class="annot"><span class="hs-comment">-- ** Zonking skolem info</span></span><span>
</span><span id="line-35"></span><span>  </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Tc.Zonk.TcType.html#zonkSkolemInfo"><span class="hs-identifier">zonkSkolemInfo</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Tc.Zonk.TcType.html#zonkSkolemInfoAnon"><span class="hs-identifier">zonkSkolemInfoAnon</span></a></span><span>
</span><span id="line-36"></span><span>
</span><span id="line-37"></span><span>    </span><span class="annot"><span class="hs-comment">-- ** Zonking constraints</span></span><span>
</span><span id="line-38"></span><span>  </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Tc.Zonk.TcType.html#zonkCt"><span class="hs-identifier">zonkCt</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Tc.Zonk.TcType.html#zonkWC"><span class="hs-identifier">zonkWC</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Tc.Zonk.TcType.html#zonkSimples"><span class="hs-identifier">zonkSimples</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Tc.Zonk.TcType.html#zonkImplication"><span class="hs-identifier">zonkImplication</span></a></span><span>
</span><span id="line-39"></span><span>
</span><span id="line-40"></span><span>    </span><span class="annot"><span class="hs-comment">-- * Tidying</span></span><span>
</span><span id="line-41"></span><span>  </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Tc.Zonk.TcType.html#tcInitTidyEnv"><span class="hs-identifier">tcInitTidyEnv</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Tc.Zonk.TcType.html#tcInitOpenTidyEnv"><span class="hs-identifier">tcInitOpenTidyEnv</span></a></span><span>
</span><span id="line-42"></span><span>  </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Tc.Zonk.TcType.html#tidyCt"><span class="hs-identifier">tidyCt</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Tc.Zonk.TcType.html#tidyEvVar"><span class="hs-identifier">tidyEvVar</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Tc.Zonk.TcType.html#tidyDelayedError"><span class="hs-identifier">tidyDelayedError</span></a></span><span>
</span><span id="line-43"></span><span>
</span><span id="line-44"></span><span>    </span><span class="annot"><span class="hs-comment">-- ** Zonk &amp; tidy</span></span><span>
</span><span id="line-45"></span><span>  </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Tc.Zonk.TcType.html#zonkTidyTcType"><span class="hs-identifier">zonkTidyTcType</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Tc.Zonk.TcType.html#zonkTidyTcTypes"><span class="hs-identifier">zonkTidyTcTypes</span></a></span><span>
</span><span id="line-46"></span><span>  </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Tc.Zonk.TcType.html#zonkTidyOrigin"><span class="hs-identifier">zonkTidyOrigin</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Tc.Zonk.TcType.html#zonkTidyOrigins"><span class="hs-identifier">zonkTidyOrigins</span></a></span><span>
</span><span id="line-47"></span><span>  </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Tc.Zonk.TcType.html#zonkTidyFRRInfos"><span class="hs-identifier">zonkTidyFRRInfos</span></a></span><span>
</span><span id="line-48"></span><span>
</span><span id="line-49"></span><span>    </span><span class="annot"><span class="hs-comment">-- * Writing to metavariables</span></span><span>
</span><span id="line-50"></span><span>  </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Tc.Zonk.TcType.html#writeMetaTyVar"><span class="hs-identifier">writeMetaTyVar</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Tc.Zonk.TcType.html#writeMetaTyVarRef"><span class="hs-identifier">writeMetaTyVarRef</span></a></span><span>
</span><span id="line-51"></span><span>
</span><span id="line-52"></span><span>    </span><span class="annot"><span class="hs-comment">-- * Handling coercion holes</span></span><span>
</span><span id="line-53"></span><span>  </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Tc.Zonk.TcType.html#checkCoercionHole"><span class="hs-identifier">checkCoercionHole</span></a></span><span>
</span><span id="line-54"></span><span>
</span><span id="line-55"></span><span>  </span><span class="hs-special">)</span><span>
</span><span id="line-56"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-57"></span><span>
</span><span id="line-58"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Prelude.html"><span class="hs-identifier">GHC.Prelude</span></a></span><span>
</span><span id="line-59"></span><span>
</span><span id="line-60"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Types.Name.html"><span class="hs-identifier">GHC.Types.Name</span></a></span><span>
</span><span id="line-61"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Types.Var.html"><span class="hs-identifier">GHC.Types.Var</span></a></span><span>
</span><span id="line-62"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Types.Var.Env.html"><span class="hs-identifier">GHC.Types.Var.Env</span></a></span><span>
</span><span id="line-63"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Types.Var.Set.html"><span class="hs-identifier">GHC.Types.Var.Set</span></a></span><span>
</span><span id="line-64"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Types.Unique.Set.html"><span class="hs-identifier">GHC.Types.Unique.Set</span></a></span><span>
</span><span id="line-65"></span><span>
</span><span id="line-66"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Tc.Errors.Types.html"><span class="hs-identifier">GHC.Tc.Errors.Types</span></a></span><span>
</span><span id="line-67"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Tc.Errors.Ppr.html"><span class="hs-identifier">GHC.Tc.Errors.Ppr</span></a></span><span>
</span><span id="line-68"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Tc.Types.Constraint.html"><span class="hs-identifier">GHC.Tc.Types.Constraint</span></a></span><span>
</span><span id="line-69"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Tc.Types.Origin.html"><span class="hs-identifier">GHC.Tc.Types.Origin</span></a></span><span>
</span><span id="line-70"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Tc.Types.TcRef.html"><span class="hs-identifier">GHC.Tc.Types.TcRef</span></a></span><span>
</span><span id="line-71"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Tc.Types.Evidence.html"><span class="hs-identifier">GHC.Tc.Types.Evidence</span></a></span><span>
</span><span id="line-72"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Tc.Types.BasicTypes.html"><span class="hs-identifier">GHC.Tc.Types.BasicTypes</span></a></span><span>
</span><span id="line-73"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.TcType.html"><span class="hs-identifier">GHC.Tc.Utils.TcType</span></a></span><span>
</span><span id="line-74"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Tc.Zonk.Monad.html"><span class="hs-identifier">GHC.Tc.Zonk.Monad</span></a></span><span>
</span><span id="line-75"></span><span>
</span><span id="line-76"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Core.InstEnv.html"><span class="hs-identifier">GHC.Core.InstEnv</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Core.InstEnv.html#ClsInst"><span class="hs-identifier">ClsInst</span></a></span><span class="hs-special">(</span><span class="annot"><a href="GHC.Core.InstEnv.html#is_tys"><span class="hs-identifier">is_tys</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-77"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Core.TyCo.Rep.html"><span class="hs-identifier">GHC.Core.TyCo.Rep</span></a></span><span>
</span><span id="line-78"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Core.TyCon.html"><span class="hs-identifier">GHC.Core.TyCon</span></a></span><span>
</span><span id="line-79"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Core.Type.html"><span class="hs-identifier">GHC.Core.Type</span></a></span><span>
</span><span id="line-80"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Core.Coercion.html"><span class="hs-identifier">GHC.Core.Coercion</span></a></span><span>
</span><span id="line-81"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Core.Predicate.html"><span class="hs-identifier">GHC.Core.Predicate</span></a></span><span>
</span><span id="line-82"></span><span>
</span><span id="line-83"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Utils.Constants.html"><span class="hs-identifier">GHC.Utils.Constants</span></a></span><span>
</span><span id="line-84"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Utils.Outputable.html"><span class="hs-identifier">GHC.Utils.Outputable</span></a></span><span>
</span><span id="line-85"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Utils.Misc.html"><span class="hs-identifier">GHC.Utils.Misc</span></a></span><span>
</span><span id="line-86"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Utils.Monad.html"><span class="hs-identifier">GHC.Utils.Monad</span></a></span><span> </span><span class="hs-special">(</span><span> </span><span class="annot"><a href="GHC.Utils.Monad.html#mapAccumLM"><span class="hs-identifier">mapAccumLM</span></a></span><span> </span><span class="hs-special">)</span><span>
</span><span id="line-87"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Utils.Panic.html"><span class="hs-identifier">GHC.Utils.Panic</span></a></span><span>
</span><span id="line-88"></span><span>
</span><span id="line-89"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Data.Bag.html"><span class="hs-identifier">GHC.Data.Bag</span></a></span><span>
</span><span id="line-90"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Data.Pair.html"><span class="hs-identifier">GHC.Data.Pair</span></a></span><span>
</span><span id="line-91"></span><span>
</span><span id="line-92"></span><span class="annot"><span class="hs-comment">{- *********************************************************************
*                                                                      *
                    Writing to metavariables
*                                                                      *
************************************************************************
-}</span></span><span>
</span><span id="line-98"></span><span>
</span><span id="line-99"></span><span class="hs-comment">-- | Write into a currently-empty MetaTyVar.</span><span>
</span><span id="line-100"></span><span class="hs-comment">--</span><span>
</span><span id="line-101"></span><span class="hs-comment">-- Works with both type and kind variables.</span><span>
</span><span id="line-102"></span><span class="annot"><a href="GHC.Tc.Zonk.TcType.html#writeMetaTyVar"><span class="hs-identifier hs-type">writeMetaTyVar</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Utils.Misc.html#HasDebugCallStack"><span class="hs-identifier hs-type">HasDebugCallStack</span></a></span><span>
</span><span id="line-103"></span><span>               </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="GHC.Types.Var.html#TcTyVar"><span class="hs-identifier hs-type">TcTyVar</span></a></span><span> </span><span class="annot"><span class="hs-comment">-- ^ the type varfiable to write to</span></span><span>
</span><span id="line-104"></span><span>               </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.TcType.html#TcType"><span class="hs-identifier hs-type">TcType</span></a></span><span>  </span><span class="annot"><span class="hs-comment">-- ^ the type to write into the mutable reference</span></span><span>
</span><span id="line-105"></span><span>               </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Zonk.Monad.html#ZonkM"><span class="hs-identifier hs-type">ZonkM</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-106"></span><span id="writeMetaTyVar"><span class="annot"><span class="annottext">writeMetaTyVar :: HasDebugCallStack =&gt; CoVar -&gt; Type -&gt; ZonkM ()
</span><a href="GHC.Tc.Zonk.TcType.html#writeMetaTyVar"><span class="hs-identifier hs-var hs-var">writeMetaTyVar</span></a></span></span><span> </span><span id="local-6989586621682915037"><span class="annot"><span class="annottext">CoVar
</span><a href="#local-6989586621682915037"><span class="hs-identifier hs-var">tyvar</span></a></span></span><span> </span><span id="local-6989586621682915038"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682915038"><span class="hs-identifier hs-var">ty</span></a></span></span><span>
</span><span id="line-107"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Bool
</span><span class="hs-identifier hs-var">not</span></span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="GHC.Utils.Constants.html#debugIsOn"><span class="hs-identifier hs-var">debugIsOn</span></a></span><span>
</span><span id="line-108"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">HasDebugCallStack =&gt; CoVar -&gt; TcRef MetaDetails -&gt; Type -&gt; ZonkM ()
CoVar -&gt; TcRef MetaDetails -&gt; Type -&gt; ZonkM ()
</span><a href="GHC.Tc.Zonk.TcType.html#writeMetaTyVarRef"><span class="hs-identifier hs-var">writeMetaTyVarRef</span></a></span><span> </span><span class="annot"><span class="annottext">CoVar
</span><a href="#local-6989586621682915037"><span class="hs-identifier hs-var">tyvar</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">CoVar -&gt; TcRef MetaDetails
</span><a href="GHC.Tc.Utils.TcType.html#metaTyVarRef"><span class="hs-identifier hs-var">metaTyVarRef</span></a></span><span> </span><span class="annot"><span class="annottext">CoVar
</span><a href="#local-6989586621682915037"><span class="hs-identifier hs-var">tyvar</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682915038"><span class="hs-identifier hs-var">ty</span></a></span><span>
</span><span id="line-109"></span><span>
</span><span id="line-110"></span><span class="hs-comment">-- Everything from here on only happens if DEBUG is on</span><span>
</span><span id="line-111"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Bool
</span><span class="hs-identifier hs-var">not</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">CoVar -&gt; Bool
</span><a href="GHC.Types.Var.html#isTcTyVar"><span class="hs-identifier hs-var">isTcTyVar</span></a></span><span> </span><span class="annot"><span class="annottext">CoVar
</span><a href="#local-6989586621682915037"><span class="hs-identifier hs-var">tyvar</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-112"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Bool -&gt; SDoc -&gt; ZonkM ()
forall (m :: * -&gt; *).
(HasCallStack, Applicative m) =&gt;
Bool -&gt; SDoc -&gt; m ()
</span><a href="GHC.Utils.Panic.html#massertPpr"><span class="hs-identifier hs-var">massertPpr</span></a></span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">False</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">String -&gt; SDoc
forall doc. IsLine doc =&gt; String -&gt; doc
</span><a href="GHC.Utils.Outputable.html#text"><span class="hs-identifier hs-var">text</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;Writing to non-tc tyvar&quot;</span></span><span> </span><span class="annot"><span class="annottext">SDoc -&gt; SDoc -&gt; SDoc
forall doc. IsLine doc =&gt; doc -&gt; doc -&gt; doc
</span><a href="GHC.Utils.Outputable.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">CoVar -&gt; SDoc
forall a. Outputable a =&gt; a -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="annot"><span class="annottext">CoVar
</span><a href="#local-6989586621682915037"><span class="hs-identifier hs-var">tyvar</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-113"></span><span>
</span><span id="line-114"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.TcType.html#MetaTv"><span class="hs-identifier hs-type">MetaTv</span></a></span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">mtv_ref :: TcTyVarDetails -&gt; TcRef MetaDetails
</span><a href="GHC.Tc.Utils.TcType.html#mtv_ref"><span class="hs-identifier hs-var">mtv_ref</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="local-6989586621682915049"><span class="annot"><span class="annottext">TcRef MetaDetails
</span><a href="#local-6989586621682915049"><span class="hs-identifier hs-var">ref</span></a></span></span><span> </span><span class="hs-special">}</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">CoVar -&gt; TcTyVarDetails
</span><a href="GHC.Types.Var.html#tcTyVarDetails"><span class="hs-identifier hs-var">tcTyVarDetails</span></a></span><span> </span><span class="annot"><span class="annottext">CoVar
</span><a href="#local-6989586621682915037"><span class="hs-identifier hs-var">tyvar</span></a></span><span>
</span><span id="line-115"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">HasDebugCallStack =&gt; CoVar -&gt; TcRef MetaDetails -&gt; Type -&gt; ZonkM ()
CoVar -&gt; TcRef MetaDetails -&gt; Type -&gt; ZonkM ()
</span><a href="GHC.Tc.Zonk.TcType.html#writeMetaTyVarRef"><span class="hs-identifier hs-var">writeMetaTyVarRef</span></a></span><span> </span><span class="annot"><span class="annottext">CoVar
</span><a href="#local-6989586621682915037"><span class="hs-identifier hs-var">tyvar</span></a></span><span> </span><span class="annot"><span class="annottext">TcRef MetaDetails
</span><a href="#local-6989586621682915049"><span class="hs-identifier hs-var">ref</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682915038"><span class="hs-identifier hs-var">ty</span></a></span><span>
</span><span id="line-116"></span><span>
</span><span id="line-117"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">otherwise</span></span><span>
</span><span id="line-118"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Bool -&gt; SDoc -&gt; ZonkM ()
forall (m :: * -&gt; *).
(HasCallStack, Applicative m) =&gt;
Bool -&gt; SDoc -&gt; m ()
</span><a href="GHC.Utils.Panic.html#massertPpr"><span class="hs-identifier hs-var">massertPpr</span></a></span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">False</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">String -&gt; SDoc
forall doc. IsLine doc =&gt; String -&gt; doc
</span><a href="GHC.Utils.Outputable.html#text"><span class="hs-identifier hs-var">text</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;Writing to non-meta tyvar&quot;</span></span><span> </span><span class="annot"><span class="annottext">SDoc -&gt; SDoc -&gt; SDoc
forall doc. IsLine doc =&gt; doc -&gt; doc -&gt; doc
</span><a href="GHC.Utils.Outputable.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">CoVar -&gt; SDoc
forall a. Outputable a =&gt; a -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="annot"><span class="annottext">CoVar
</span><a href="#local-6989586621682915037"><span class="hs-identifier hs-var">tyvar</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-119"></span><span class="hs-pragma">{-# INLINE</span><span> </span><span class="annot"><a href="GHC.Tc.Zonk.TcType.html#writeMetaTyVar"><span class="hs-pragma hs-type">writeMetaTyVar</span></a></span><span> </span><span class="hs-pragma">#-}</span><span> </span><span class="hs-comment">-- See NOTE [Inlining writeMetaTyVar]</span><span>
</span><span id="line-120"></span><span>
</span><span id="line-121"></span><span class="annot"><span class="hs-comment">-- | Write into the 'MetaDetails' mutable references of a 'MetaTv'.</span></span><span>
</span><span id="line-122"></span><span class="annot"><a href="GHC.Tc.Zonk.TcType.html#writeMetaTyVarRef"><span class="hs-identifier hs-type">writeMetaTyVarRef</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Utils.Misc.html#HasDebugCallStack"><span class="hs-identifier hs-type">HasDebugCallStack</span></a></span><span>
</span><span id="line-123"></span><span>                  </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="GHC.Types.Var.html#TcTyVar"><span class="hs-identifier hs-type">TcTyVar</span></a></span><span> </span><span class="annot"><span class="hs-comment">-- ^ for debug assertions only;</span></span><span>
</span><span id="line-124"></span><span>                  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.TcRef.html#TcRef"><span class="hs-identifier hs-type">TcRef</span></a></span><span> </span><span class="annot"><a href="GHC.Tc.Utils.TcType.html#MetaDetails"><span class="hs-identifier hs-type">MetaDetails</span></a></span><span> </span><span class="annot"><span class="hs-comment">-- ^ ref cell must be for the same tyvar</span></span><span>
</span><span id="line-125"></span><span>                  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.TcType.html#TcType"><span class="hs-identifier hs-type">TcType</span></a></span><span> </span><span class="annot"><span class="hs-comment">-- ^ the type to write to the mutable reference</span></span><span>
</span><span id="line-126"></span><span>                  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Zonk.Monad.html#ZonkM"><span class="hs-identifier hs-type">ZonkM</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-127"></span><span id="writeMetaTyVarRef"><span class="annot"><span class="annottext">writeMetaTyVarRef :: HasDebugCallStack =&gt; CoVar -&gt; TcRef MetaDetails -&gt; Type -&gt; ZonkM ()
</span><a href="GHC.Tc.Zonk.TcType.html#writeMetaTyVarRef"><span class="hs-identifier hs-var hs-var">writeMetaTyVarRef</span></a></span></span><span> </span><span id="local-6989586621682915119"><span class="annot"><span class="annottext">CoVar
</span><a href="#local-6989586621682915119"><span class="hs-identifier hs-var">tyvar</span></a></span></span><span> </span><span id="local-6989586621682915120"><span class="annot"><span class="annottext">TcRef MetaDetails
</span><a href="#local-6989586621682915120"><span class="hs-identifier hs-var">ref</span></a></span></span><span> </span><span id="local-6989586621682915121"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682915121"><span class="hs-identifier hs-var">ty</span></a></span></span><span>
</span><span id="line-128"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Bool
</span><span class="hs-identifier hs-var">not</span></span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="GHC.Utils.Constants.html#debugIsOn"><span class="hs-identifier hs-var">debugIsOn</span></a></span><span>
</span><span id="line-129"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">String -&gt; SDoc -&gt; ZonkM ()
</span><a href="GHC.Tc.Zonk.Monad.html#traceZonk"><span class="hs-identifier hs-var">traceZonk</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;writeMetaTyVar&quot;</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">CoVar -&gt; SDoc
forall a. Outputable a =&gt; a -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="annot"><span class="annottext">CoVar
</span><a href="#local-6989586621682915119"><span class="hs-identifier hs-var">tyvar</span></a></span><span> </span><span class="annot"><span class="annottext">SDoc -&gt; SDoc -&gt; SDoc
forall doc. IsLine doc =&gt; doc -&gt; doc -&gt; doc
</span><a href="GHC.Utils.Outputable.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">SDoc
</span><a href="GHC.Utils.Outputable.html#dcolon"><span class="hs-identifier hs-var">dcolon</span></a></span><span> </span><span class="annot"><span class="annottext">SDoc -&gt; SDoc -&gt; SDoc
forall doc. IsLine doc =&gt; doc -&gt; doc -&gt; doc
</span><a href="GHC.Utils.Outputable.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">Type -&gt; SDoc
forall a. Outputable a =&gt; a -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">CoVar -&gt; Type
</span><a href="GHC.Types.Var.html#tyVarKind"><span class="hs-identifier hs-var">tyVarKind</span></a></span><span> </span><span class="annot"><span class="annottext">CoVar
</span><a href="#local-6989586621682915119"><span class="hs-identifier hs-var">tyvar</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-130"></span><span>                                     </span><span class="annot"><span class="annottext">SDoc -&gt; SDoc -&gt; SDoc
forall doc. IsLine doc =&gt; doc -&gt; doc -&gt; doc
</span><a href="GHC.Utils.Outputable.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">String -&gt; SDoc
forall doc. IsLine doc =&gt; String -&gt; doc
</span><a href="GHC.Utils.Outputable.html#text"><span class="hs-identifier hs-var">text</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;:=&quot;</span></span><span> </span><span class="annot"><span class="annottext">SDoc -&gt; SDoc -&gt; SDoc
forall doc. IsLine doc =&gt; doc -&gt; doc -&gt; doc
</span><a href="GHC.Utils.Outputable.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">Type -&gt; SDoc
forall a. Outputable a =&gt; a -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682915121"><span class="hs-identifier hs-var">ty</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-131"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="annottext">TcRef MetaDetails -&gt; MetaDetails -&gt; ZonkM ()
forall (m :: * -&gt; *) a. MonadIO m =&gt; TcRef a -&gt; a -&gt; m ()
</span><a href="GHC.Tc.Types.TcRef.html#writeTcRef"><span class="hs-identifier hs-var">writeTcRef</span></a></span><span> </span><span class="annot"><span class="annottext">TcRef MetaDetails
</span><a href="#local-6989586621682915120"><span class="hs-identifier hs-var">ref</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Type -&gt; MetaDetails
</span><a href="GHC.Tc.Utils.TcType.html#Indirect"><span class="hs-identifier hs-var">Indirect</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682915121"><span class="hs-identifier hs-var">ty</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-132"></span><span>
</span><span id="line-133"></span><span>  </span><span class="hs-comment">-- Everything from here on only happens if DEBUG is on</span><span>
</span><span id="line-134"></span><span>  </span><span class="hs-comment">-- Need to zonk 'ty' because we may only recently have promoted</span><span>
</span><span id="line-135"></span><span>  </span><span class="hs-comment">-- its free meta-tyvars (see GHC.Tc.Utils.Unify.checkPromoteFreeVars)</span><span>
</span><span id="line-136"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">otherwise</span></span><span>
</span><span id="line-137"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span id="local-6989586621682915127"><span class="annot"><a href="#local-6989586621682915127"><span class="hs-identifier hs-var">meta_details</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">TcRef MetaDetails -&gt; ZonkM MetaDetails
forall (m :: * -&gt; *) a. MonadIO m =&gt; TcRef a -&gt; m a
</span><a href="GHC.Tc.Types.TcRef.html#readTcRef"><span class="hs-identifier hs-var">readTcRef</span></a></span><span> </span><span class="annot"><span class="annottext">TcRef MetaDetails
</span><a href="#local-6989586621682915120"><span class="hs-identifier hs-var">ref</span></a></span><span class="hs-special">;</span><span>
</span><span id="line-138"></span><span>       </span><span class="hs-comment">-- Zonk kinds to allow the error check to work</span><span>
</span><span id="line-139"></span><span>       </span><span class="hs-special">;</span><span> </span><span id="local-6989586621682915129"><span class="annot"><a href="#local-6989586621682915129"><span class="hs-identifier hs-var">zonked_tv_kind</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><a href="GHC.Tc.Zonk.TcType.html#zonkTcType"><span class="hs-identifier hs-type">zonkTcType</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682915130"><span class="hs-identifier hs-type">tv_kind</span></a></span><span>
</span><span id="line-140"></span><span>       </span><span class="hs-special">;</span><span> </span><span id="local-6989586621682915131"><span class="annot"><a href="#local-6989586621682915131"><span class="hs-identifier hs-var">zonked_ty</span></a></span></span><span>      </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><a href="GHC.Tc.Zonk.TcType.html#zonkTcType"><span class="hs-identifier hs-type">zonkTcType</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682915121"><span class="hs-identifier hs-type">ty</span></a></span><span>
</span><span id="line-141"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621682915132"><span class="annot"><a href="#local-6989586621682915132"><span class="hs-identifier hs-var hs-var">zonked_ty_kind</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">HasDebugCallStack =&gt; Type -&gt; Type
Type -&gt; Type
</span><a href="GHC.Core.Type.html#typeKind"><span class="hs-identifier hs-var">typeKind</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682915131"><span class="hs-identifier hs-var">zonked_ty</span></a></span><span>
</span><span id="line-142"></span><span>             </span><span id="local-6989586621682915134"><span class="annot"><a href="#local-6989586621682915134"><span class="hs-identifier hs-var hs-var">zonked_ty_lvl</span></a></span></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Type -&gt; TcLevel
</span><a href="GHC.Tc.Utils.TcType.html#tcTypeLevel"><span class="hs-identifier hs-var">tcTypeLevel</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682915131"><span class="hs-identifier hs-var">zonked_ty</span></a></span><span>
</span><span id="line-143"></span><span>             </span><span id="local-6989586621682915136"><span class="annot"><a href="#local-6989586621682915136"><span class="hs-identifier hs-var hs-var">level_check_ok</span></a></span></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Bool
</span><span class="hs-identifier hs-var">not</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TcLevel
</span><a href="#local-6989586621682915134"><span class="hs-identifier hs-var">zonked_ty_lvl</span></a></span><span> </span><span class="annot"><span class="annottext">TcLevel -&gt; TcLevel -&gt; Bool
</span><a href="GHC.Tc.Utils.TcType.html#strictlyDeeperThan"><span class="hs-operator hs-var">`strictlyDeeperThan`</span></a></span><span> </span><span class="annot"><span class="annottext">TcLevel
</span><a href="#local-6989586621682915138"><span class="hs-identifier hs-var">tv_lvl</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-144"></span><span>             </span><span id="local-6989586621682915139"><span class="annot"><a href="#local-6989586621682915139"><span class="hs-identifier hs-var hs-var">level_check_msg</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">TcLevel -&gt; SDoc
forall a. Outputable a =&gt; a -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="annot"><span class="annottext">TcLevel
</span><a href="#local-6989586621682915134"><span class="hs-identifier hs-var">zonked_ty_lvl</span></a></span><span> </span><span class="annot"><span class="annottext">SDoc -&gt; SDoc -&gt; SDoc
forall doc. IsDoc doc =&gt; doc -&gt; doc -&gt; doc
</span><a href="GHC.Utils.Outputable.html#%24%24"><span class="hs-operator hs-var">$$</span></a></span><span> </span><span class="annot"><span class="annottext">TcLevel -&gt; SDoc
forall a. Outputable a =&gt; a -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="annot"><span class="annottext">TcLevel
</span><a href="#local-6989586621682915138"><span class="hs-identifier hs-var">tv_lvl</span></a></span><span> </span><span class="annot"><span class="annottext">SDoc -&gt; SDoc -&gt; SDoc
forall doc. IsDoc doc =&gt; doc -&gt; doc -&gt; doc
</span><a href="GHC.Utils.Outputable.html#%24%24"><span class="hs-operator hs-var">$$</span></a></span><span> </span><span class="annot"><span class="annottext">CoVar -&gt; SDoc
forall a. Outputable a =&gt; a -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="annot"><span class="annottext">CoVar
</span><a href="#local-6989586621682915119"><span class="hs-identifier hs-var">tyvar</span></a></span><span> </span><span class="annot"><span class="annottext">SDoc -&gt; SDoc -&gt; SDoc
forall doc. IsDoc doc =&gt; doc -&gt; doc -&gt; doc
</span><a href="GHC.Utils.Outputable.html#%24%24"><span class="hs-operator hs-var">$$</span></a></span><span> </span><span class="annot"><span class="annottext">Type -&gt; SDoc
forall a. Outputable a =&gt; a -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682915121"><span class="hs-identifier hs-var">ty</span></a></span><span> </span><span class="annot"><span class="annottext">SDoc -&gt; SDoc -&gt; SDoc
forall doc. IsDoc doc =&gt; doc -&gt; doc -&gt; doc
</span><a href="GHC.Utils.Outputable.html#%24%24"><span class="hs-operator hs-var">$$</span></a></span><span> </span><span class="annot"><span class="annottext">Type -&gt; SDoc
forall a. Outputable a =&gt; a -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682915131"><span class="hs-identifier hs-var">zonked_ty</span></a></span><span>
</span><span id="line-145"></span><span>             </span><span id="local-6989586621682915141"><span class="annot"><a href="#local-6989586621682915141"><span class="hs-identifier hs-var hs-var">kind_check_ok</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682915132"><span class="hs-identifier hs-var">zonked_ty_kind</span></a></span><span> </span><span class="annot"><span class="annottext">HasCallStack =&gt; Type -&gt; Type -&gt; Bool
Type -&gt; Type -&gt; Bool
</span><a href="GHC.Core.TyCo.Compare.html#eqType"><span class="hs-operator hs-var">`eqType`</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682915129"><span class="hs-identifier hs-var">zonked_tv_kind</span></a></span><span>
</span><span id="line-146"></span><span>             </span><span class="hs-comment">-- Note [Extra-constraint holes in partial type signatures] in GHC.Tc.Gen.HsType</span><span>
</span><span id="line-147"></span><span>
</span><span id="line-148"></span><span>             </span><span id="local-6989586621682915143"><span class="annot"><a href="#local-6989586621682915143"><span class="hs-identifier hs-var hs-var">kind_msg</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">SDoc -&gt; Int -&gt; SDoc -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#hang"><span class="hs-identifier hs-var">hang</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">String -&gt; SDoc
forall doc. IsLine doc =&gt; String -&gt; doc
</span><a href="GHC.Utils.Outputable.html#text"><span class="hs-identifier hs-var">text</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;Ill-kinded update to meta tyvar&quot;</span></span><span class="hs-special">)</span><span>
</span><span id="line-149"></span><span>                           </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">2</span></span><span> </span><span class="hs-special">(</span><span>    </span><span class="annot"><span class="annottext">CoVar -&gt; SDoc
forall a. Outputable a =&gt; a -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="annot"><span class="annottext">CoVar
</span><a href="#local-6989586621682915119"><span class="hs-identifier hs-var">tyvar</span></a></span><span> </span><span class="annot"><span class="annottext">SDoc -&gt; SDoc -&gt; SDoc
forall doc. IsLine doc =&gt; doc -&gt; doc -&gt; doc
</span><a href="GHC.Utils.Outputable.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">String -&gt; SDoc
forall doc. IsLine doc =&gt; String -&gt; doc
</span><a href="GHC.Utils.Outputable.html#text"><span class="hs-identifier hs-var">text</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;::&quot;</span></span><span> </span><span class="annot"><span class="annottext">SDoc -&gt; SDoc -&gt; SDoc
forall doc. IsLine doc =&gt; doc -&gt; doc -&gt; doc
</span><a href="GHC.Utils.Outputable.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Type -&gt; SDoc
forall a. Outputable a =&gt; a -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682915130"><span class="hs-identifier hs-var">tv_kind</span></a></span><span> </span><span class="annot"><span class="annottext">SDoc -&gt; SDoc -&gt; SDoc
forall doc. IsDoc doc =&gt; doc -&gt; doc -&gt; doc
</span><a href="GHC.Utils.Outputable.html#%24%24"><span class="hs-operator hs-var">$$</span></a></span><span> </span><span class="annot"><span class="annottext">Type -&gt; SDoc
forall a. Outputable a =&gt; a -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682915129"><span class="hs-identifier hs-var">zonked_tv_kind</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-150"></span><span>                              </span><span class="annot"><span class="annottext">SDoc -&gt; SDoc -&gt; SDoc
forall doc. IsLine doc =&gt; doc -&gt; doc -&gt; doc
</span><a href="GHC.Utils.Outputable.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">String -&gt; SDoc
forall doc. IsLine doc =&gt; String -&gt; doc
</span><a href="GHC.Utils.Outputable.html#text"><span class="hs-identifier hs-var">text</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;:=&quot;</span></span><span>
</span><span id="line-151"></span><span>                              </span><span class="annot"><span class="annottext">SDoc -&gt; SDoc -&gt; SDoc
forall doc. IsLine doc =&gt; doc -&gt; doc -&gt; doc
</span><a href="GHC.Utils.Outputable.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">Type -&gt; SDoc
forall a. Outputable a =&gt; a -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682915121"><span class="hs-identifier hs-var">ty</span></a></span><span> </span><span class="annot"><span class="annottext">SDoc -&gt; SDoc -&gt; SDoc
forall doc. IsLine doc =&gt; doc -&gt; doc -&gt; doc
</span><a href="GHC.Utils.Outputable.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">String -&gt; SDoc
forall doc. IsLine doc =&gt; String -&gt; doc
</span><a href="GHC.Utils.Outputable.html#text"><span class="hs-identifier hs-var">text</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;::&quot;</span></span><span> </span><span class="annot"><span class="annottext">SDoc -&gt; SDoc -&gt; SDoc
forall doc. IsLine doc =&gt; doc -&gt; doc -&gt; doc
</span><a href="GHC.Utils.Outputable.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Type -&gt; SDoc
forall a. Outputable a =&gt; a -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682915132"><span class="hs-identifier hs-var">zonked_ty_kind</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">)</span><span>
</span><span id="line-152"></span><span>
</span><span id="line-153"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="annot"><a href="GHC.Tc.Zonk.Monad.html#traceZonk"><span class="hs-identifier hs-type">traceZonk</span></a></span><span> </span><span class="annot"><span class="hs-string">&quot;writeMetaTyVar&quot;</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-type">ppr</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682915119"><span class="hs-identifier hs-type">tyvar</span></a></span><span> </span><span class="annot"><a href="GHC.Utils.Outputable.html#%3C%2B%3E"><span class="hs-operator hs-type">&lt;+&gt;</span></a></span><span> </span><span class="annot"><a href="GHC.Utils.Outputable.html#text"><span class="hs-identifier hs-type">text</span></a></span><span> </span><span class="annot"><span class="hs-string">&quot;:=&quot;</span></span><span> </span><span class="annot"><a href="GHC.Utils.Outputable.html#%3C%2B%3E"><span class="hs-operator hs-type">&lt;+&gt;</span></a></span><span> </span><span class="annot"><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-type">ppr</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682915121"><span class="hs-identifier hs-type">ty</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-154"></span><span>
</span><span id="line-155"></span><span>       </span><span class="hs-comment">-- Check for double updates</span><span>
</span><span id="line-156"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="annot"><a href="GHC.Utils.Panic.html#massertPpr"><span class="hs-identifier hs-type">massertPpr</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Tc.Utils.TcType.html#isFlexi"><span class="hs-identifier hs-type">isFlexi</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682915127"><span class="hs-identifier hs-type">meta_details</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621682915146"><span class="hs-identifier hs-type">double_upd_msg</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682915127"><span class="hs-identifier hs-type">meta_details</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-157"></span><span>
</span><span id="line-158"></span><span>       </span><span class="hs-comment">-- Check for level OK</span><span>
</span><span id="line-159"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="annot"><a href="GHC.Utils.Panic.html#massertPpr"><span class="hs-identifier hs-type">massertPpr</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682915136"><span class="hs-identifier hs-type">level_check_ok</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682915139"><span class="hs-identifier hs-type">level_check_msg</span></a></span><span>
</span><span id="line-160"></span><span>
</span><span id="line-161"></span><span>       </span><span class="hs-comment">-- Check Kinds ok</span><span>
</span><span id="line-162"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="annot"><a href="GHC.Utils.Panic.html#massertPpr"><span class="hs-identifier hs-type">massertPpr</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682915141"><span class="hs-identifier hs-type">kind_check_ok</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682915143"><span class="hs-identifier hs-type">kind_msg</span></a></span><span>
</span><span id="line-163"></span><span>
</span><span id="line-164"></span><span>       </span><span class="hs-comment">-- Do the write</span><span>
</span><span id="line-165"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.TcRef.html#writeTcRef"><span class="hs-identifier hs-type">writeTcRef</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682915120"><span class="hs-identifier hs-type">ref</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Tc.Utils.TcType.html#Indirect"><span class="hs-identifier hs-type">Indirect</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682915121"><span class="hs-identifier hs-type">ty</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-166"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-167"></span><span>    </span><span id="local-6989586621682915130"><span class="annot"><span class="annottext">tv_kind :: Type
</span><a href="#local-6989586621682915130"><span class="hs-identifier hs-var hs-var">tv_kind</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">CoVar -&gt; Type
</span><a href="GHC.Types.Var.html#tyVarKind"><span class="hs-identifier hs-var">tyVarKind</span></a></span><span> </span><span class="annot"><span class="annottext">CoVar
</span><a href="#local-6989586621682915119"><span class="hs-identifier hs-var">tyvar</span></a></span><span>
</span><span id="line-168"></span><span>
</span><span id="line-169"></span><span>    </span><span id="local-6989586621682915138"><span class="annot"><span class="annottext">tv_lvl :: TcLevel
</span><a href="#local-6989586621682915138"><span class="hs-identifier hs-var hs-var">tv_lvl</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">CoVar -&gt; TcLevel
</span><a href="GHC.Tc.Utils.TcType.html#tcTyVarLevel"><span class="hs-identifier hs-var">tcTyVarLevel</span></a></span><span> </span><span class="annot"><span class="annottext">CoVar
</span><a href="#local-6989586621682915119"><span class="hs-identifier hs-var">tyvar</span></a></span><span>
</span><span id="line-170"></span><span>
</span><span id="line-171"></span><span>
</span><span id="line-172"></span><span>    </span><span id="local-6989586621682915146"><span class="annot"><span class="annottext">double_upd_msg :: MetaDetails -&gt; SDoc
</span><a href="#local-6989586621682915146"><span class="hs-identifier hs-var hs-var">double_upd_msg</span></a></span></span><span> </span><span id="local-6989586621682915148"><span class="annot"><span class="annottext">MetaDetails
</span><a href="#local-6989586621682915148"><span class="hs-identifier hs-var">details</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">SDoc -&gt; Int -&gt; SDoc -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#hang"><span class="hs-identifier hs-var">hang</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">String -&gt; SDoc
forall doc. IsLine doc =&gt; String -&gt; doc
</span><a href="GHC.Utils.Outputable.html#text"><span class="hs-identifier hs-var">text</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;Double update of meta tyvar&quot;</span></span><span class="hs-special">)</span><span>
</span><span id="line-173"></span><span>                                </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">2</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">CoVar -&gt; SDoc
forall a. Outputable a =&gt; a -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="annot"><span class="annottext">CoVar
</span><a href="#local-6989586621682915119"><span class="hs-identifier hs-var">tyvar</span></a></span><span> </span><span class="annot"><span class="annottext">SDoc -&gt; SDoc -&gt; SDoc
forall doc. IsDoc doc =&gt; doc -&gt; doc -&gt; doc
</span><a href="GHC.Utils.Outputable.html#%24%24"><span class="hs-operator hs-var">$$</span></a></span><span> </span><span class="annot"><span class="annottext">MetaDetails -&gt; SDoc
forall a. Outputable a =&gt; a -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="annot"><span class="annottext">MetaDetails
</span><a href="#local-6989586621682915148"><span class="hs-identifier hs-var">details</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-174"></span><span class="hs-pragma">{-# INLINE</span><span> </span><span class="annot"><a href="GHC.Tc.Zonk.TcType.html#writeMetaTyVarRef"><span class="hs-pragma hs-type">writeMetaTyVarRef</span></a></span><span> </span><span class="hs-pragma">#-}</span><span> </span><span class="hs-comment">-- See NOTE [Inlining writeMetaTyVar]</span><span>
</span><span id="line-175"></span><span>
</span><span id="line-176"></span><span class="hs-comment">{- NOTE [Inlining writeMetaTyVar]
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
writeMetaTyVar is defined in the ZonkM monad, but it is often used within
TcM with the following idiom:

  liftZonkM $ writeMetaTyVar tv ty

Using liftZonkM within TcM generally means extracting out a ZonkGblEnv
from the TcM monad to pass to the inner ZonkM computation (see the definition
of liftZonkM). This can cause writeMetaTyVar to allocate a ZonkGblEnv, which we
would much rather avoid!
Instead, we should directly pass the bits of the ZonkGblEnv that writeMetaTyVar
needs (the Logger and NamePprCtxt, which are needed for the traceZonk call
in writeMetaTyVar). This is achieved by inlining writeMetaTyVar and writeMetaTyVarRef.
These functions just wrap writeTcRef, with some extra tracing
(and some assertions if running in debug mode), so it's fine to inline them.

See for example test T5631, which regresses without this change.
-}</span><span>
</span><span id="line-195"></span><span>
</span><span id="line-196"></span><span class="hs-comment">{-
************************************************************************
*                                                                      *
     Zonking -- the main work-horses: zonkTcType, zonkTcTyVar
*                                                                      *
************************************************************************
-}</span><span>
</span><span id="line-203"></span><span>
</span><span id="line-204"></span><span class="annot"><a href="GHC.Tc.Zonk.TcType.html#zonkScaledTcType"><span class="hs-identifier hs-type">zonkScaledTcType</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#Scaled"><span class="hs-identifier hs-type">Scaled</span></a></span><span> </span><span class="annot"><a href="GHC.Tc.Utils.TcType.html#TcType"><span class="hs-identifier hs-type">TcType</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Zonk.Monad.html#ZonkM"><span class="hs-identifier hs-type">ZonkM</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#Scaled"><span class="hs-identifier hs-type">Scaled</span></a></span><span> </span><span class="annot"><a href="GHC.Tc.Utils.TcType.html#TcType"><span class="hs-identifier hs-type">TcType</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-205"></span><span id="zonkScaledTcType"><span class="annot"><span class="annottext">zonkScaledTcType :: Scaled Type -&gt; ZonkM (Scaled Type)
</span><a href="GHC.Tc.Zonk.TcType.html#zonkScaledTcType"><span class="hs-identifier hs-var hs-var">zonkScaledTcType</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#Scaled"><span class="hs-identifier hs-type">Scaled</span></a></span><span> </span><span id="local-6989586621682915150"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682915150"><span class="hs-identifier hs-var">m</span></a></span></span><span> </span><span id="local-6989586621682915151"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682915151"><span class="hs-identifier hs-var">ty</span></a></span></span><span class="hs-special">)</span><span>
</span><span id="line-206"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Type -&gt; Type -&gt; Scaled Type
forall a. Type -&gt; a -&gt; Scaled a
</span><a href="GHC.Core.TyCo.Rep.html#Scaled"><span class="hs-identifier hs-var">Scaled</span></a></span><span> </span><span class="annot"><span class="annottext">(Type -&gt; Type -&gt; Scaled Type)
-&gt; ZonkM Type -&gt; ZonkM (Type -&gt; Scaled Type)
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="annot"><span class="annottext">Type -&gt; ZonkM Type
</span><a href="GHC.Tc.Zonk.TcType.html#zonkTcType"><span class="hs-identifier hs-var">zonkTcType</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682915150"><span class="hs-identifier hs-var">m</span></a></span><span> </span><span class="annot"><span class="annottext">ZonkM (Type -&gt; Scaled Type) -&gt; ZonkM Type -&gt; ZonkM (Scaled Type)
forall a b. ZonkM (a -&gt; b) -&gt; ZonkM a -&gt; ZonkM b
forall (f :: * -&gt; *) a b. Applicative f =&gt; f (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;*&gt;</span></span><span> </span><span class="annot"><span class="annottext">Type -&gt; ZonkM Type
</span><a href="GHC.Tc.Zonk.TcType.html#zonkTcType"><span class="hs-identifier hs-var">zonkTcType</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682915151"><span class="hs-identifier hs-var">ty</span></a></span><span>
</span><span id="line-207"></span><span>
</span><span id="line-208"></span><span class="hs-comment">-- For unbound, mutable tyvars, zonkType uses the function given to it</span><span>
</span><span id="line-209"></span><span class="hs-comment">-- For tyvars bound at a for-all, zonkType zonks them to an immutable</span><span>
</span><span id="line-210"></span><span class="hs-comment">--      type variable and zonks the kind too</span><span>
</span><span id="line-211"></span><span class="annot"><a href="GHC.Tc.Zonk.TcType.html#zonkTcType"><span class="hs-identifier hs-type">zonkTcType</span></a></span><span>  </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.TcType.html#TcType"><span class="hs-identifier hs-type">TcType</span></a></span><span>   </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Zonk.Monad.html#ZonkM"><span class="hs-identifier hs-type">ZonkM</span></a></span><span> </span><span class="annot"><a href="GHC.Tc.Utils.TcType.html#TcType"><span class="hs-identifier hs-type">TcType</span></a></span><span>
</span><span id="line-212"></span><span class="annot"><a href="GHC.Tc.Zonk.TcType.html#zonkTcTypes"><span class="hs-identifier hs-type">zonkTcTypes</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="GHC.Tc.Utils.TcType.html#TcType"><span class="hs-identifier hs-type">TcType</span></a></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Zonk.Monad.html#ZonkM"><span class="hs-identifier hs-type">ZonkM</span></a></span><span> </span><span class="hs-special">[</span><span class="annot"><a href="GHC.Tc.Utils.TcType.html#TcType"><span class="hs-identifier hs-type">TcType</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-213"></span><span class="annot"><a href="GHC.Tc.Zonk.TcType.html#zonkCo"><span class="hs-identifier hs-type">zonkCo</span></a></span><span>      </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#Coercion"><span class="hs-identifier hs-type">Coercion</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Zonk.Monad.html#ZonkM"><span class="hs-identifier hs-type">ZonkM</span></a></span><span> </span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#Coercion"><span class="hs-identifier hs-type">Coercion</span></a></span><span>
</span><span id="line-214"></span><span class="hs-special">(</span><span id="zonkTcType"><span class="annot"><span class="annottext">Type -&gt; ZonkM Type
</span><a href="GHC.Tc.Zonk.TcType.html#zonkTcType"><span class="hs-identifier hs-var">zonkTcType</span></a></span></span><span class="hs-special">,</span><span> </span><span id="zonkTcTypes"><span class="annot"><span class="annottext">[Type] -&gt; ZonkM [Type]
</span><a href="GHC.Tc.Zonk.TcType.html#zonkTcTypes"><span class="hs-identifier hs-var">zonkTcTypes</span></a></span></span><span class="hs-special">,</span><span> </span><span id="zonkCo"><span class="annot"><span class="annottext">Coercion -&gt; ZonkM Coercion
</span><a href="GHC.Tc.Zonk.TcType.html#zonkCo"><span class="hs-identifier hs-var">zonkCo</span></a></span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">[Coercion] -&gt; ZonkM [Coercion]
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span>
</span><span id="line-215"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">TyCoMapper () ZonkM
-&gt; (Type -&gt; ZonkM Type, [Type] -&gt; ZonkM [Type],
    Coercion -&gt; ZonkM Coercion, [Coercion] -&gt; ZonkM [Coercion])
forall (m :: * -&gt; *).
Monad m =&gt;
TyCoMapper () m
-&gt; (Type -&gt; m Type, [Type] -&gt; m [Type], Coercion -&gt; m Coercion,
    [Coercion] -&gt; m [Coercion])
</span><a href="GHC.Core.Type.html#mapTyCo"><span class="hs-identifier hs-var">mapTyCo</span></a></span><span> </span><span class="annot"><span class="annottext">TyCoMapper () ZonkM
</span><a href="#local-6989586621682915161"><span class="hs-identifier hs-var">zonkTcTypeMapper</span></a></span><span>
</span><span id="line-216"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-217"></span><span>    </span><span class="hs-comment">-- A suitable TyCoMapper for zonking a type during type-checking,</span><span>
</span><span id="line-218"></span><span>    </span><span class="hs-comment">-- before all metavars are filled in.</span><span>
</span><span id="line-219"></span><span>    </span><span class="annot"><a href="#local-6989586621682915161"><span class="hs-identifier hs-type">zonkTcTypeMapper</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Core.Type.html#TyCoMapper"><span class="hs-identifier hs-type">TyCoMapper</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span> </span><span class="annot"><a href="GHC.Tc.Zonk.Monad.html#ZonkM"><span class="hs-identifier hs-type">ZonkM</span></a></span><span>
</span><span id="line-220"></span><span>    </span><span id="local-6989586621682915161"><span class="annot"><span class="annottext">zonkTcTypeMapper :: TyCoMapper () ZonkM
</span><a href="#local-6989586621682915161"><span class="hs-identifier hs-var hs-var">zonkTcTypeMapper</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="GHC.Core.Type.html#TyCoMapper"><span class="hs-identifier hs-type">TyCoMapper</span></a></span><span>
</span><span id="line-221"></span><span>      </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">tcm_tyvar :: () -&gt; CoVar -&gt; ZonkM Type
</span><a href="GHC.Core.Type.html#tcm_tyvar"><span class="hs-identifier hs-var">tcm_tyvar</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(CoVar -&gt; ZonkM Type) -&gt; () -&gt; CoVar -&gt; ZonkM Type
forall a b. a -&gt; b -&gt; a
</span><span class="hs-identifier hs-var">const</span></span><span> </span><span class="annot"><span class="annottext">CoVar -&gt; ZonkM Type
</span><a href="GHC.Tc.Zonk.TcType.html#zonkTcTyVar"><span class="hs-identifier hs-var">zonkTcTyVar</span></a></span><span>
</span><span id="line-222"></span><span>      </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">tcm_covar :: () -&gt; CoVar -&gt; ZonkM Coercion
</span><a href="GHC.Core.Type.html#tcm_covar"><span class="hs-identifier hs-var">tcm_covar</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(CoVar -&gt; ZonkM Coercion) -&gt; () -&gt; CoVar -&gt; ZonkM Coercion
forall a b. a -&gt; b -&gt; a
</span><span class="hs-identifier hs-var">const</span></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span id="local-6989586621682915166"><span class="annot"><span class="annottext">CoVar
</span><a href="#local-6989586621682915166"><span class="hs-identifier hs-var">cv</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">CoVar -&gt; Coercion
</span><a href="GHC.Core.Coercion.html#mkCoVarCo"><span class="hs-identifier hs-var">mkCoVarCo</span></a></span><span> </span><span class="annot"><span class="annottext">(CoVar -&gt; Coercion) -&gt; ZonkM CoVar -&gt; ZonkM Coercion
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="annot"><span class="annottext">CoVar -&gt; ZonkM CoVar
</span><a href="GHC.Tc.Zonk.TcType.html#zonkTyCoVarKind"><span class="hs-identifier hs-var">zonkTyCoVarKind</span></a></span><span> </span><span class="annot"><span class="annottext">CoVar
</span><a href="#local-6989586621682915166"><span class="hs-identifier hs-var">cv</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-223"></span><span>      </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">tcm_hole :: () -&gt; CoercionHole -&gt; ZonkM Coercion
</span><a href="GHC.Core.Type.html#tcm_hole"><span class="hs-identifier hs-var">tcm_hole</span></a></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">() -&gt; CoercionHole -&gt; ZonkM Coercion
</span><a href="#local-6989586621682915169"><span class="hs-identifier hs-var">hole</span></a></span><span>
</span><span id="line-224"></span><span>      </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">tcm_tycobinder :: forall r.
() -&gt; CoVar -&gt; ForAllTyFlag -&gt; (() -&gt; CoVar -&gt; ZonkM r) -&gt; ZonkM r
</span><a href="GHC.Core.Type.html#tcm_tycobinder"><span class="hs-identifier hs-var">tcm_tycobinder</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-glyph">\</span><span> </span><span id="local-6989586621682915172"><span class="annot"><span class="annottext">()
</span><a href="#local-6989586621682915172"><span class="hs-identifier hs-var">_env</span></a></span></span><span> </span><span id="local-6989586621682915173"><span class="annot"><span class="annottext">CoVar
</span><a href="#local-6989586621682915173"><span class="hs-identifier hs-var">tcv</span></a></span></span><span> </span><span id="local-6989586621682915174"><span class="annot"><span class="annottext">ForAllTyFlag
</span><a href="#local-6989586621682915174"><span class="hs-identifier hs-var">_vis</span></a></span></span><span> </span><span id="local-6989586621682915175"><span class="annot"><span class="annottext">() -&gt; CoVar -&gt; ZonkM r
</span><a href="#local-6989586621682915175"><span class="hs-identifier hs-var">k</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">CoVar -&gt; ZonkM CoVar
</span><a href="GHC.Tc.Zonk.TcType.html#zonkTyCoVarKind"><span class="hs-identifier hs-var">zonkTyCoVarKind</span></a></span><span> </span><span class="annot"><span class="annottext">CoVar
</span><a href="#local-6989586621682915173"><span class="hs-identifier hs-var">tcv</span></a></span><span> </span><span class="annot"><span class="annottext">ZonkM CoVar -&gt; (CoVar -&gt; ZonkM r) -&gt; ZonkM r
forall a b. ZonkM a -&gt; (a -&gt; ZonkM b) -&gt; ZonkM b
forall (m :: * -&gt; *) a b. Monad m =&gt; m a -&gt; (a -&gt; m b) -&gt; m b
</span><span class="hs-operator hs-var">&gt;&gt;=</span></span><span> </span><span class="annot"><span class="annottext">() -&gt; CoVar -&gt; ZonkM r
</span><a href="#local-6989586621682915175"><span class="hs-identifier hs-var">k</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-225"></span><span>      </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">tcm_tycon :: TyCon -&gt; ZonkM TyCon
</span><a href="GHC.Core.Type.html#tcm_tycon"><span class="hs-identifier hs-var">tcm_tycon</span></a></span><span>      </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">TyCon -&gt; ZonkM TyCon
</span><a href="GHC.Tc.Zonk.TcType.html#zonkTcTyCon"><span class="hs-identifier hs-var">zonkTcTyCon</span></a></span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-226"></span><span>      </span><span class="hs-keyword">where</span><span>
</span><span id="line-227"></span><span>        </span><span class="annot"><a href="#local-6989586621682915169"><span class="hs-identifier hs-type">hole</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#CoercionHole"><span class="hs-identifier hs-type">CoercionHole</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Zonk.Monad.html#ZonkM"><span class="hs-identifier hs-type">ZonkM</span></a></span><span> </span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#Coercion"><span class="hs-identifier hs-type">Coercion</span></a></span><span>
</span><span id="line-228"></span><span>        </span><span id="local-6989586621682915169"><span class="annot"><span class="annottext">hole :: () -&gt; CoercionHole -&gt; ZonkM Coercion
</span><a href="#local-6989586621682915169"><span class="hs-identifier hs-var hs-var">hole</span></a></span></span><span> </span><span class="annot"><span class="annottext">()
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621682915177"><span class="annot"><span class="annottext">hole :: CoercionHole
</span><a href="#local-6989586621682915177"><span class="hs-identifier hs-var">hole</span></a></span></span><span class="hs-glyph">@</span><span class="hs-special">(</span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#CoercionHole"><span class="hs-identifier hs-type">CoercionHole</span></a></span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">ch_ref :: CoercionHole -&gt; IORef (Maybe Coercion)
</span><a href="GHC.Core.TyCo.Rep.html#ch_ref"><span class="hs-identifier hs-var">ch_ref</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="local-6989586621682915180"><span class="annot"><span class="annottext">IORef (Maybe Coercion)
</span><a href="#local-6989586621682915180"><span class="hs-identifier hs-var">ref</span></a></span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">ch_co_var :: CoercionHole -&gt; CoVar
</span><a href="GHC.Core.TyCo.Rep.html#ch_co_var"><span class="hs-identifier hs-var">ch_co_var</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="local-6989586621682915182"><span class="annot"><span class="annottext">CoVar
</span><a href="#local-6989586621682915182"><span class="hs-identifier hs-var">cv</span></a></span></span><span> </span><span class="hs-special">}</span><span class="hs-special">)</span><span>
</span><span id="line-229"></span><span>          </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span id="local-6989586621682915183"><span class="annot"><a href="#local-6989586621682915183"><span class="hs-identifier hs-var">contents</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">IORef (Maybe Coercion) -&gt; ZonkM (Maybe Coercion)
forall (m :: * -&gt; *) a. MonadIO m =&gt; TcRef a -&gt; m a
</span><a href="GHC.Tc.Types.TcRef.html#readTcRef"><span class="hs-identifier hs-var">readTcRef</span></a></span><span> </span><span class="annot"><span class="annottext">IORef (Maybe Coercion)
</span><a href="#local-6989586621682915180"><span class="hs-identifier hs-var">ref</span></a></span><span>
</span><span id="line-230"></span><span>               </span><span class="hs-special">;</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><a href="#local-6989586621682915183"><span class="hs-identifier hs-type">contents</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-231"></span><span>                   </span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span id="local-6989586621682915184"><span class="annot"><span class="annottext">Coercion
</span><a href="#local-6989586621682915184"><span class="hs-identifier hs-var">co</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span id="local-6989586621682915185"><span class="annot"><a href="#local-6989586621682915185"><span class="hs-identifier hs-var">co'</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Coercion -&gt; ZonkM Coercion
</span><a href="GHC.Tc.Zonk.TcType.html#zonkCo"><span class="hs-identifier hs-var">zonkCo</span></a></span><span> </span><span class="annot"><span class="annottext">Coercion
</span><a href="#local-6989586621682915184"><span class="hs-identifier hs-var">co</span></a></span><span>
</span><span id="line-232"></span><span>                                 </span><span class="hs-special">;</span><span> </span><span class="annot"><a href="GHC.Tc.Zonk.TcType.html#checkCoercionHole"><span class="hs-identifier hs-type">checkCoercionHole</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682915182"><span class="hs-identifier hs-type">cv</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682915185"><span class="hs-identifier hs-type">co'</span></a></span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-233"></span><span>                   </span><span class="annot"><span class="annottext">Maybe Coercion
</span><span class="hs-identifier hs-var">Nothing</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span id="local-6989586621682915186"><span class="annot"><a href="#local-6989586621682915186"><span class="hs-identifier hs-var">cv'</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">CoVar -&gt; ZonkM CoVar
</span><a href="GHC.Tc.Zonk.TcType.html#zonkCoVar"><span class="hs-identifier hs-var">zonkCoVar</span></a></span><span> </span><span class="annot"><span class="annottext">CoVar
</span><a href="#local-6989586621682915182"><span class="hs-identifier hs-var">cv</span></a></span><span>
</span><span id="line-234"></span><span>                                 </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">return</span></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#HoleCo"><span class="hs-identifier hs-type">HoleCo</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621682915177"><span class="hs-identifier hs-type">hole</span></a></span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#ch_co_var"><span class="hs-identifier hs-var">ch_co_var</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="#local-6989586621682915186"><span class="hs-identifier hs-type">cv'</span></a></span><span> </span><span class="hs-special">}</span><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-235"></span><span>
</span><span id="line-236"></span><span class="annot"><a href="GHC.Tc.Zonk.TcType.html#zonkTcTyCon"><span class="hs-identifier hs-type">zonkTcTyCon</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.TcType.html#TcTyCon"><span class="hs-identifier hs-type">TcTyCon</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Zonk.Monad.html#ZonkM"><span class="hs-identifier hs-type">ZonkM</span></a></span><span> </span><span class="annot"><a href="GHC.Tc.Utils.TcType.html#TcTyCon"><span class="hs-identifier hs-type">TcTyCon</span></a></span><span>
</span><span id="line-237"></span><span class="hs-comment">-- Only called on TcTyCons</span><span>
</span><span id="line-238"></span><span class="hs-comment">-- A non-poly TcTyCon may have unification</span><span>
</span><span id="line-239"></span><span class="hs-comment">-- variables that need zonking, but poly ones cannot</span><span>
</span><span id="line-240"></span><span id="zonkTcTyCon"><span class="annot"><span class="annottext">zonkTcTyCon :: TyCon -&gt; ZonkM TyCon
</span><a href="GHC.Tc.Zonk.TcType.html#zonkTcTyCon"><span class="hs-identifier hs-var hs-var">zonkTcTyCon</span></a></span></span><span> </span><span id="local-6989586621682915189"><span class="annot"><span class="annottext">TyCon
</span><a href="#local-6989586621682915189"><span class="hs-identifier hs-var">tc</span></a></span></span><span>
</span><span id="line-241"></span><span> </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">TyCon -&gt; Bool
</span><a href="GHC.Core.TyCon.html#isMonoTcTyCon"><span class="hs-identifier hs-var">isMonoTcTyCon</span></a></span><span> </span><span class="annot"><span class="annottext">TyCon
</span><a href="#local-6989586621682915189"><span class="hs-identifier hs-var">tc</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span id="local-6989586621682915191"><span class="annot"><a href="#local-6989586621682915191"><span class="hs-identifier hs-var">tck'</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Type -&gt; ZonkM Type
</span><a href="GHC.Tc.Zonk.TcType.html#zonkTcType"><span class="hs-identifier hs-var">zonkTcType</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TyCon -&gt; Type
</span><a href="GHC.Core.TyCon.html#tyConKind"><span class="hs-identifier hs-var">tyConKind</span></a></span><span> </span><span class="annot"><span class="annottext">TyCon
</span><a href="#local-6989586621682915189"><span class="hs-identifier hs-var">tc</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-242"></span><span>                         </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">return</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Core.TyCon.html#setTcTyConKind"><span class="hs-identifier hs-type">setTcTyConKind</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682915189"><span class="hs-identifier hs-type">tc</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682915191"><span class="hs-identifier hs-type">tck'</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-243"></span><span> </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">otherwise</span></span><span>        </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">TyCon -&gt; ZonkM TyCon
forall a. a -&gt; ZonkM a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="annot"><span class="annottext">TyCon
</span><a href="#local-6989586621682915189"><span class="hs-identifier hs-var">tc</span></a></span><span>
</span><span id="line-244"></span><span>
</span><span id="line-245"></span><span class="annot"><a href="GHC.Tc.Zonk.TcType.html#zonkTcTyVar"><span class="hs-identifier hs-type">zonkTcTyVar</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Types.Var.html#TcTyVar"><span class="hs-identifier hs-type">TcTyVar</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Zonk.Monad.html#ZonkM"><span class="hs-identifier hs-type">ZonkM</span></a></span><span> </span><span class="annot"><a href="GHC.Tc.Utils.TcType.html#TcType"><span class="hs-identifier hs-type">TcType</span></a></span><span>
</span><span id="line-246"></span><span class="hs-comment">-- Simply look through all Flexis</span><span>
</span><span id="line-247"></span><span id="zonkTcTyVar"><span class="annot"><span class="annottext">zonkTcTyVar :: CoVar -&gt; ZonkM Type
</span><a href="GHC.Tc.Zonk.TcType.html#zonkTcTyVar"><span class="hs-identifier hs-var hs-var">zonkTcTyVar</span></a></span></span><span> </span><span id="local-6989586621682915194"><span class="annot"><span class="annottext">CoVar
</span><a href="#local-6989586621682915194"><span class="hs-identifier hs-var">tv</span></a></span></span><span>
</span><span id="line-248"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">CoVar -&gt; Bool
</span><a href="GHC.Types.Var.html#isTcTyVar"><span class="hs-identifier hs-var">isTcTyVar</span></a></span><span> </span><span class="annot"><span class="annottext">CoVar
</span><a href="#local-6989586621682915194"><span class="hs-identifier hs-var">tv</span></a></span><span>
</span><span id="line-249"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">CoVar -&gt; TcTyVarDetails
</span><a href="GHC.Types.Var.html#tcTyVarDetails"><span class="hs-identifier hs-var">tcTyVarDetails</span></a></span><span> </span><span class="annot"><span class="annottext">CoVar
</span><a href="#local-6989586621682915194"><span class="hs-identifier hs-var">tv</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-250"></span><span>      </span><span class="annot"><a href="GHC.Tc.Utils.TcType.html#SkolemTv"><span class="hs-identifier hs-type">SkolemTv</span></a></span><span> </span><span class="hs-special">{</span><span class="hs-special">}</span><span>   </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">ZonkM Type
</span><a href="#local-6989586621682915196"><span class="hs-identifier hs-var">zonk_kind_and_return</span></a></span><span>
</span><span id="line-251"></span><span>      </span><span class="annot"><a href="GHC.Tc.Utils.TcType.html#RuntimeUnk"><span class="hs-identifier hs-type">RuntimeUnk</span></a></span><span> </span><span class="hs-special">{</span><span class="hs-special">}</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">ZonkM Type
</span><a href="#local-6989586621682915196"><span class="hs-identifier hs-var">zonk_kind_and_return</span></a></span><span>
</span><span id="line-252"></span><span>      </span><span class="annot"><a href="GHC.Tc.Utils.TcType.html#MetaTv"><span class="hs-identifier hs-type">MetaTv</span></a></span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">mtv_ref :: TcTyVarDetails -&gt; TcRef MetaDetails
</span><a href="GHC.Tc.Utils.TcType.html#mtv_ref"><span class="hs-identifier hs-var">mtv_ref</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="local-6989586621682915198"><span class="annot"><span class="annottext">TcRef MetaDetails
</span><a href="#local-6989586621682915198"><span class="hs-identifier hs-var">ref</span></a></span></span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-253"></span><span>         </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span id="local-6989586621682915199"><span class="annot"><a href="#local-6989586621682915199"><span class="hs-identifier hs-var">cts</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">TcRef MetaDetails -&gt; ZonkM MetaDetails
forall (m :: * -&gt; *) a. MonadIO m =&gt; TcRef a -&gt; m a
</span><a href="GHC.Tc.Types.TcRef.html#readTcRef"><span class="hs-identifier hs-var">readTcRef</span></a></span><span> </span><span class="annot"><span class="annottext">TcRef MetaDetails
</span><a href="#local-6989586621682915198"><span class="hs-identifier hs-var">ref</span></a></span><span>
</span><span id="line-254"></span><span>               </span><span class="hs-special">;</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><a href="#local-6989586621682915199"><span class="hs-identifier hs-type">cts</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-255"></span><span>                    </span><span class="annot"><span class="annottext">MetaDetails
</span><a href="GHC.Tc.Utils.TcType.html#Flexi"><span class="hs-identifier hs-var">Flexi</span></a></span><span>       </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">ZonkM Type
</span><a href="#local-6989586621682915196"><span class="hs-identifier hs-var">zonk_kind_and_return</span></a></span><span>
</span><span id="line-256"></span><span>                    </span><span class="annot"><a href="GHC.Tc.Utils.TcType.html#Indirect"><span class="hs-identifier hs-type">Indirect</span></a></span><span> </span><span id="local-6989586621682915201"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682915201"><span class="hs-identifier hs-var">ty</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span id="local-6989586621682915202"><span class="annot"><a href="#local-6989586621682915202"><span class="hs-identifier hs-var">zty</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Type -&gt; ZonkM Type
</span><a href="GHC.Tc.Zonk.TcType.html#zonkTcType"><span class="hs-identifier hs-var">zonkTcType</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682915201"><span class="hs-identifier hs-var">ty</span></a></span><span>
</span><span id="line-257"></span><span>                                      </span><span class="hs-special">;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.TcRef.html#writeTcRef"><span class="hs-identifier hs-type">writeTcRef</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682915198"><span class="hs-identifier hs-type">ref</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Tc.Utils.TcType.html#Indirect"><span class="hs-identifier hs-type">Indirect</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682915202"><span class="hs-identifier hs-type">zty</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-258"></span><span>                                        </span><span class="hs-comment">-- See Note [Sharing in zonking]</span><span>
</span><span id="line-259"></span><span>                                      </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">return</span></span><span> </span><span class="annot"><a href="#local-6989586621682915202"><span class="hs-identifier hs-type">zty</span></a></span><span> </span><span class="hs-special">}</span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-260"></span><span>
</span><span id="line-261"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">otherwise</span></span><span> </span><span class="hs-comment">-- coercion variable</span><span>
</span><span id="line-262"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ZonkM Type
</span><a href="#local-6989586621682915196"><span class="hs-identifier hs-var">zonk_kind_and_return</span></a></span><span>
</span><span id="line-263"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-264"></span><span>    </span><span id="local-6989586621682915196"><span class="annot"><span class="annottext">zonk_kind_and_return :: ZonkM Type
</span><a href="#local-6989586621682915196"><span class="hs-identifier hs-var hs-var">zonk_kind_and_return</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span id="local-6989586621682915203"><span class="annot"><a href="#local-6989586621682915203"><span class="hs-identifier hs-var">z_tv</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">CoVar -&gt; ZonkM CoVar
</span><a href="GHC.Tc.Zonk.TcType.html#zonkTyCoVarKind"><span class="hs-identifier hs-var">zonkTyCoVarKind</span></a></span><span> </span><span class="annot"><span class="annottext">CoVar
</span><a href="#local-6989586621682915194"><span class="hs-identifier hs-var">tv</span></a></span><span>
</span><span id="line-265"></span><span>                              </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">return</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#mkTyVarTy"><span class="hs-identifier hs-type">mkTyVarTy</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682915203"><span class="hs-identifier hs-type">z_tv</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-266"></span><span>
</span><span id="line-267"></span><span class="hs-comment">-- Variant that assumes that any result of zonking is still a TyVar.</span><span>
</span><span id="line-268"></span><span class="hs-comment">-- Should be used only on skolems and TyVarTvs</span><span>
</span><span id="line-269"></span><span class="annot"><a href="GHC.Tc.Zonk.TcType.html#zonkTcTyVarsToTcTyVars"><span class="hs-identifier hs-type">zonkTcTyVarsToTcTyVars</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Utils.Misc.html#HasDebugCallStack"><span class="hs-identifier hs-type">HasDebugCallStack</span></a></span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="GHC.Types.Var.html#TcTyVar"><span class="hs-identifier hs-type">TcTyVar</span></a></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Zonk.Monad.html#ZonkM"><span class="hs-identifier hs-type">ZonkM</span></a></span><span> </span><span class="hs-special">[</span><span class="annot"><a href="GHC.Types.Var.html#TcTyVar"><span class="hs-identifier hs-type">TcTyVar</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-270"></span><span id="zonkTcTyVarsToTcTyVars"><span class="annot"><span class="annottext">zonkTcTyVarsToTcTyVars :: HasDebugCallStack =&gt; [CoVar] -&gt; ZonkM [CoVar]
</span><a href="GHC.Tc.Zonk.TcType.html#zonkTcTyVarsToTcTyVars"><span class="hs-identifier hs-var hs-var">zonkTcTyVarsToTcTyVars</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(CoVar -&gt; ZonkM CoVar) -&gt; [CoVar] -&gt; ZonkM [CoVar]
forall (t :: * -&gt; *) (m :: * -&gt; *) a b.
(Traversable t, Monad m) =&gt;
(a -&gt; m b) -&gt; t a -&gt; m (t b)
forall (m :: * -&gt; *) a b. Monad m =&gt; (a -&gt; m b) -&gt; [a] -&gt; m [b]
</span><span class="hs-identifier hs-var">mapM</span></span><span> </span><span class="annot"><span class="annottext">HasDebugCallStack =&gt; CoVar -&gt; ZonkM CoVar
CoVar -&gt; ZonkM CoVar
</span><a href="GHC.Tc.Zonk.TcType.html#zonkTcTyVarToTcTyVar"><span class="hs-identifier hs-var">zonkTcTyVarToTcTyVar</span></a></span><span>
</span><span id="line-271"></span><span>
</span><span id="line-272"></span><span class="annot"><a href="GHC.Tc.Zonk.TcType.html#zonkTcTyVarToTcTyVar"><span class="hs-identifier hs-type">zonkTcTyVarToTcTyVar</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Utils.Misc.html#HasDebugCallStack"><span class="hs-identifier hs-type">HasDebugCallStack</span></a></span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="GHC.Types.Var.html#TcTyVar"><span class="hs-identifier hs-type">TcTyVar</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Zonk.Monad.html#ZonkM"><span class="hs-identifier hs-type">ZonkM</span></a></span><span> </span><span class="annot"><a href="GHC.Types.Var.html#TcTyVar"><span class="hs-identifier hs-type">TcTyVar</span></a></span><span>
</span><span id="line-273"></span><span id="zonkTcTyVarToTcTyVar"><span class="annot"><span class="annottext">zonkTcTyVarToTcTyVar :: HasDebugCallStack =&gt; CoVar -&gt; ZonkM CoVar
</span><a href="GHC.Tc.Zonk.TcType.html#zonkTcTyVarToTcTyVar"><span class="hs-identifier hs-var hs-var">zonkTcTyVarToTcTyVar</span></a></span></span><span> </span><span id="local-6989586621682915218"><span class="annot"><span class="annottext">CoVar
</span><a href="#local-6989586621682915218"><span class="hs-identifier hs-var">tv</span></a></span></span><span>
</span><span id="line-274"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span id="local-6989586621682915219"><span class="annot"><a href="#local-6989586621682915219"><span class="hs-identifier hs-var">ty</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">CoVar -&gt; ZonkM Type
</span><a href="GHC.Tc.Zonk.TcType.html#zonkTcTyVar"><span class="hs-identifier hs-var">zonkTcTyVar</span></a></span><span> </span><span class="annot"><span class="annottext">CoVar
</span><a href="#local-6989586621682915218"><span class="hs-identifier hs-var">tv</span></a></span><span>
</span><span id="line-275"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621682915220"><span class="annot"><a href="#local-6989586621682915220"><span class="hs-identifier hs-var hs-var">tv'</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">Type -&gt; Maybe CoVar
</span><a href="GHC.Core.Type.html#getTyVar_maybe"><span class="hs-identifier hs-var">getTyVar_maybe</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682915219"><span class="hs-identifier hs-var">ty</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-276"></span><span>                     </span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span id="local-6989586621682915222"><span class="annot"><span class="annottext">CoVar
</span><a href="#local-6989586621682915222"><span class="hs-identifier hs-var">tv'</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">CoVar
</span><a href="#local-6989586621682915222"><span class="hs-identifier hs-var">tv'</span></a></span><span>
</span><span id="line-277"></span><span>                     </span><span class="annot"><span class="annottext">Maybe CoVar
</span><span class="hs-identifier hs-var">Nothing</span></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">String -&gt; SDoc -&gt; CoVar
forall a. HasCallStack =&gt; String -&gt; SDoc -&gt; a
</span><a href="GHC.Utils.Panic.html#pprPanic"><span class="hs-identifier hs-var">pprPanic</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;zonkTcTyVarToTcTyVar&quot;</span></span><span>
</span><span id="line-278"></span><span>                                          </span><span class="hs-special">(</span><span class="annot"><span class="annottext">CoVar -&gt; SDoc
forall a. Outputable a =&gt; a -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="annot"><span class="annottext">CoVar
</span><a href="#local-6989586621682915218"><span class="hs-identifier hs-var">tv</span></a></span><span> </span><span class="annot"><span class="annottext">SDoc -&gt; SDoc -&gt; SDoc
forall doc. IsDoc doc =&gt; doc -&gt; doc -&gt; doc
</span><a href="GHC.Utils.Outputable.html#%24%24"><span class="hs-operator hs-var">$$</span></a></span><span> </span><span class="annot"><span class="annottext">Type -&gt; SDoc
forall a. Outputable a =&gt; a -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682915219"><span class="hs-identifier hs-var">ty</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-279"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">return</span></span><span> </span><span class="annot"><a href="#local-6989586621682915220"><span class="hs-identifier hs-type">tv'</span></a></span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-280"></span><span>
</span><span id="line-281"></span><span id="local-6989586621682914757"><span class="annot"><a href="GHC.Tc.Zonk.TcType.html#zonkInvisTVBinder"><span class="hs-identifier hs-type">zonkInvisTVBinder</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Types.Var.html#VarBndr"><span class="hs-identifier hs-type">VarBndr</span></a></span><span> </span><span class="annot"><a href="GHC.Types.Var.html#TcTyVar"><span class="hs-identifier hs-type">TcTyVar</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682914757"><span class="hs-identifier hs-type">spec</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Zonk.Monad.html#ZonkM"><span class="hs-identifier hs-type">ZonkM</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Types.Var.html#VarBndr"><span class="hs-identifier hs-type">VarBndr</span></a></span><span> </span><span class="annot"><a href="GHC.Types.Var.html#TcTyVar"><span class="hs-identifier hs-type">TcTyVar</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682914757"><span class="hs-identifier hs-type">spec</span></a></span><span class="hs-special">)</span></span><span>
</span><span id="line-282"></span><span id="zonkInvisTVBinder"><span class="annot"><span class="annottext">zonkInvisTVBinder :: forall spec. VarBndr CoVar spec -&gt; ZonkM (VarBndr CoVar spec)
</span><a href="GHC.Tc.Zonk.TcType.html#zonkInvisTVBinder"><span class="hs-identifier hs-var hs-var">zonkInvisTVBinder</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Types.Var.html#Bndr"><span class="hs-identifier hs-type">Bndr</span></a></span><span> </span><span id="local-6989586621682915228"><span class="annot"><span class="annottext">CoVar
</span><a href="#local-6989586621682915228"><span class="hs-identifier hs-var">tv</span></a></span></span><span> </span><span id="local-6989586621682915229"><span class="annot"><span class="annottext">spec
</span><a href="#local-6989586621682915229"><span class="hs-identifier hs-var">spec</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span id="local-6989586621682915230"><span class="annot"><a href="#local-6989586621682915230"><span class="hs-identifier hs-var">tv'</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">HasDebugCallStack =&gt; CoVar -&gt; ZonkM CoVar
CoVar -&gt; ZonkM CoVar
</span><a href="GHC.Tc.Zonk.TcType.html#zonkTcTyVarToTcTyVar"><span class="hs-identifier hs-var">zonkTcTyVarToTcTyVar</span></a></span><span> </span><span class="annot"><span class="annottext">CoVar
</span><a href="#local-6989586621682915228"><span class="hs-identifier hs-var">tv</span></a></span><span>
</span><span id="line-283"></span><span>                                      </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">return</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Types.Var.html#Bndr"><span class="hs-identifier hs-type">Bndr</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682915230"><span class="hs-identifier hs-type">tv'</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682915229"><span class="hs-identifier hs-type">spec</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-284"></span><span>
</span><span id="line-285"></span><span class="annot"><span class="hs-comment">{- *********************************************************************
*                                                                      *
              Zonking types
*                                                                      *
********************************************************************* -}</span></span><span>
</span><span id="line-290"></span><span>
</span><span id="line-291"></span><span class="annot"><a href="GHC.Tc.Zonk.TcType.html#zonkTcTypeAndFV"><span class="hs-identifier hs-type">zonkTcTypeAndFV</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.TcType.html#TcType"><span class="hs-identifier hs-type">TcType</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Zonk.Monad.html#ZonkM"><span class="hs-identifier hs-type">ZonkM</span></a></span><span> </span><span class="annot"><a href="GHC.Types.Var.Set.html#DTyCoVarSet"><span class="hs-identifier hs-type">DTyCoVarSet</span></a></span><span>
</span><span id="line-292"></span><span class="hs-comment">-- Zonk a type and take its free variables</span><span>
</span><span id="line-293"></span><span class="hs-comment">-- With kind polymorphism it can be essential to zonk *first*</span><span>
</span><span id="line-294"></span><span class="hs-comment">-- so that we find the right set of free variables.  Eg</span><span>
</span><span id="line-295"></span><span class="hs-comment">--    forall k1. forall (a:k2). a</span><span>
</span><span id="line-296"></span><span class="hs-comment">-- where k2:=k1 is in the substitution.  We don't want</span><span>
</span><span id="line-297"></span><span class="hs-comment">-- k2 to look free in this type!</span><span>
</span><span id="line-298"></span><span id="zonkTcTypeAndFV"><span class="annot"><span class="annottext">zonkTcTypeAndFV :: Type -&gt; ZonkM DTyCoVarSet
</span><a href="GHC.Tc.Zonk.TcType.html#zonkTcTypeAndFV"><span class="hs-identifier hs-var hs-var">zonkTcTypeAndFV</span></a></span></span><span> </span><span id="local-6989586621682915231"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682915231"><span class="hs-identifier hs-var">ty</span></a></span></span><span>
</span><span id="line-299"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Type -&gt; DTyCoVarSet
</span><a href="GHC.Core.TyCo.FVs.html#tyCoVarsOfTypeDSet"><span class="hs-identifier hs-var">tyCoVarsOfTypeDSet</span></a></span><span> </span><span class="annot"><span class="annottext">(Type -&gt; DTyCoVarSet) -&gt; ZonkM Type -&gt; ZonkM DTyCoVarSet
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="annot"><span class="annottext">Type -&gt; ZonkM Type
</span><a href="GHC.Tc.Zonk.TcType.html#zonkTcType"><span class="hs-identifier hs-var">zonkTcType</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682915231"><span class="hs-identifier hs-var">ty</span></a></span><span>
</span><span id="line-300"></span><span>
</span><span id="line-301"></span><span class="annot"><a href="GHC.Tc.Zonk.TcType.html#zonkTyCoVar"><span class="hs-identifier hs-type">zonkTyCoVar</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Types.Var.html#TyCoVar"><span class="hs-identifier hs-type">TyCoVar</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Zonk.Monad.html#ZonkM"><span class="hs-identifier hs-type">ZonkM</span></a></span><span> </span><span class="annot"><a href="GHC.Tc.Utils.TcType.html#TcType"><span class="hs-identifier hs-type">TcType</span></a></span><span>
</span><span id="line-302"></span><span class="hs-comment">-- Works on TyVars and TcTyVars</span><span>
</span><span id="line-303"></span><span id="zonkTyCoVar"><span class="annot"><span class="annottext">zonkTyCoVar :: CoVar -&gt; ZonkM Type
</span><a href="GHC.Tc.Zonk.TcType.html#zonkTyCoVar"><span class="hs-identifier hs-var hs-var">zonkTyCoVar</span></a></span></span><span> </span><span id="local-6989586621682915234"><span class="annot"><span class="annottext">CoVar
</span><a href="#local-6989586621682915234"><span class="hs-identifier hs-var">tv</span></a></span></span><span> </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">CoVar -&gt; Bool
</span><a href="GHC.Types.Var.html#isTcTyVar"><span class="hs-identifier hs-var">isTcTyVar</span></a></span><span> </span><span class="annot"><span class="annottext">CoVar
</span><a href="#local-6989586621682915234"><span class="hs-identifier hs-var">tv</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">CoVar -&gt; ZonkM Type
</span><a href="GHC.Tc.Zonk.TcType.html#zonkTcTyVar"><span class="hs-identifier hs-var">zonkTcTyVar</span></a></span><span> </span><span class="annot"><span class="annottext">CoVar
</span><a href="#local-6989586621682915234"><span class="hs-identifier hs-var">tv</span></a></span><span>
</span><span id="line-304"></span><span>               </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">CoVar -&gt; Bool
</span><a href="GHC.Types.Var.html#isTyVar"><span class="hs-identifier hs-var">isTyVar</span></a></span><span>   </span><span class="annot"><span class="annottext">CoVar
</span><a href="#local-6989586621682915234"><span class="hs-identifier hs-var">tv</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">CoVar -&gt; Type
</span><a href="GHC.Core.TyCo.Rep.html#mkTyVarTy"><span class="hs-identifier hs-var">mkTyVarTy</span></a></span><span> </span><span class="annot"><span class="annottext">(CoVar -&gt; Type) -&gt; ZonkM CoVar -&gt; ZonkM Type
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="annot"><span class="annottext">CoVar -&gt; ZonkM CoVar
</span><a href="GHC.Tc.Zonk.TcType.html#zonkTyCoVarKind"><span class="hs-identifier hs-var">zonkTyCoVarKind</span></a></span><span> </span><span class="annot"><span class="annottext">CoVar
</span><a href="#local-6989586621682915234"><span class="hs-identifier hs-var">tv</span></a></span><span>
</span><span id="line-305"></span><span>               </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">otherwise</span></span><span>    </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Bool -&gt; SDoc -&gt; ZonkM Type -&gt; ZonkM Type
forall a. HasCallStack =&gt; Bool -&gt; SDoc -&gt; a -&gt; a
</span><a href="GHC.Utils.Panic.html#assertPpr"><span class="hs-identifier hs-var">assertPpr</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">CoVar -&gt; Bool
</span><a href="GHC.Types.Var.html#isCoVar"><span class="hs-identifier hs-var">isCoVar</span></a></span><span> </span><span class="annot"><span class="annottext">CoVar
</span><a href="#local-6989586621682915234"><span class="hs-identifier hs-var">tv</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">CoVar -&gt; SDoc
forall a. Outputable a =&gt; a -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="annot"><span class="annottext">CoVar
</span><a href="#local-6989586621682915234"><span class="hs-identifier hs-var">tv</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(ZonkM Type -&gt; ZonkM Type) -&gt; ZonkM Type -&gt; ZonkM Type
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-306"></span><span>                                </span><span class="annot"><span class="annottext">Coercion -&gt; Type
</span><a href="GHC.Core.Type.html#mkCoercionTy"><span class="hs-identifier hs-var">mkCoercionTy</span></a></span><span> </span><span class="annot"><span class="annottext">(Coercion -&gt; Type) -&gt; (CoVar -&gt; Coercion) -&gt; CoVar -&gt; Type
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">CoVar -&gt; Coercion
</span><a href="GHC.Core.Coercion.html#mkCoVarCo"><span class="hs-identifier hs-var">mkCoVarCo</span></a></span><span> </span><span class="annot"><span class="annottext">(CoVar -&gt; Type) -&gt; ZonkM CoVar -&gt; ZonkM Type
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="annot"><span class="annottext">CoVar -&gt; ZonkM CoVar
</span><a href="GHC.Tc.Zonk.TcType.html#zonkTyCoVarKind"><span class="hs-identifier hs-var">zonkTyCoVarKind</span></a></span><span> </span><span class="annot"><span class="annottext">CoVar
</span><a href="#local-6989586621682915234"><span class="hs-identifier hs-var">tv</span></a></span><span>
</span><span id="line-307"></span><span>   </span><span class="hs-comment">-- Hackily, when typechecking type and class decls</span><span>
</span><span id="line-308"></span><span>   </span><span class="hs-comment">-- we have TyVars in scope added (only) in</span><span>
</span><span id="line-309"></span><span>   </span><span class="hs-comment">-- GHC.Tc.Gen.HsType.bindTyClTyVars, but it seems</span><span>
</span><span id="line-310"></span><span>   </span><span class="hs-comment">-- painful to make them into TcTyVars there</span><span>
</span><span id="line-311"></span><span>
</span><span id="line-312"></span><span class="annot"><a href="GHC.Tc.Zonk.TcType.html#zonkTyCoVarsAndFV"><span class="hs-identifier hs-type">zonkTyCoVarsAndFV</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Types.Var.Set.html#TyCoVarSet"><span class="hs-identifier hs-type">TyCoVarSet</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Zonk.Monad.html#ZonkM"><span class="hs-identifier hs-type">ZonkM</span></a></span><span> </span><span class="annot"><a href="GHC.Types.Var.Set.html#TyCoVarSet"><span class="hs-identifier hs-type">TyCoVarSet</span></a></span><span>
</span><span id="line-313"></span><span id="zonkTyCoVarsAndFV"><span class="annot"><span class="annottext">zonkTyCoVarsAndFV :: TyCoVarSet -&gt; ZonkM TyCoVarSet
</span><a href="GHC.Tc.Zonk.TcType.html#zonkTyCoVarsAndFV"><span class="hs-identifier hs-var hs-var">zonkTyCoVarsAndFV</span></a></span></span><span> </span><span id="local-6989586621682915240"><span class="annot"><span class="annottext">TyCoVarSet
</span><a href="#local-6989586621682915240"><span class="hs-identifier hs-var">tycovars</span></a></span></span><span>
</span><span id="line-314"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[Type] -&gt; TyCoVarSet
</span><a href="GHC.Core.TyCo.FVs.html#tyCoVarsOfTypes"><span class="hs-identifier hs-var">tyCoVarsOfTypes</span></a></span><span> </span><span class="annot"><span class="annottext">([Type] -&gt; TyCoVarSet) -&gt; ZonkM [Type] -&gt; ZonkM TyCoVarSet
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="annot"><span class="annottext">(CoVar -&gt; ZonkM Type) -&gt; [CoVar] -&gt; ZonkM [Type]
forall (t :: * -&gt; *) (m :: * -&gt; *) a b.
(Traversable t, Monad m) =&gt;
(a -&gt; m b) -&gt; t a -&gt; m (t b)
forall (m :: * -&gt; *) a b. Monad m =&gt; (a -&gt; m b) -&gt; [a] -&gt; m [b]
</span><span class="hs-identifier hs-var">mapM</span></span><span> </span><span class="annot"><span class="annottext">CoVar -&gt; ZonkM Type
</span><a href="GHC.Tc.Zonk.TcType.html#zonkTyCoVar"><span class="hs-identifier hs-var">zonkTyCoVar</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TyCoVarSet -&gt; [CoVar]
forall elt. UniqSet elt -&gt; [elt]
</span><a href="GHC.Types.Unique.Set.html#nonDetEltsUniqSet"><span class="hs-identifier hs-var">nonDetEltsUniqSet</span></a></span><span> </span><span class="annot"><span class="annottext">TyCoVarSet
</span><a href="#local-6989586621682915240"><span class="hs-identifier hs-var">tycovars</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-315"></span><span>  </span><span class="hs-comment">-- It's OK to use nonDetEltsUniqSet here because we immediately forget about</span><span>
</span><span id="line-316"></span><span>  </span><span class="hs-comment">-- the ordering by turning it into a nondeterministic set and the order</span><span>
</span><span id="line-317"></span><span>  </span><span class="hs-comment">-- of zonking doesn't matter for determinism.</span><span>
</span><span id="line-318"></span><span>
</span><span id="line-319"></span><span class="annot"><a href="GHC.Tc.Zonk.TcType.html#zonkDTyCoVarSetAndFV"><span class="hs-identifier hs-type">zonkDTyCoVarSetAndFV</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Types.Var.Set.html#DTyCoVarSet"><span class="hs-identifier hs-type">DTyCoVarSet</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Zonk.Monad.html#ZonkM"><span class="hs-identifier hs-type">ZonkM</span></a></span><span> </span><span class="annot"><a href="GHC.Types.Var.Set.html#DTyCoVarSet"><span class="hs-identifier hs-type">DTyCoVarSet</span></a></span><span>
</span><span id="line-320"></span><span id="zonkDTyCoVarSetAndFV"><span class="annot"><span class="annottext">zonkDTyCoVarSetAndFV :: DTyCoVarSet -&gt; ZonkM DTyCoVarSet
</span><a href="GHC.Tc.Zonk.TcType.html#zonkDTyCoVarSetAndFV"><span class="hs-identifier hs-var hs-var">zonkDTyCoVarSetAndFV</span></a></span></span><span> </span><span id="local-6989586621682915243"><span class="annot"><span class="annottext">DTyCoVarSet
</span><a href="#local-6989586621682915243"><span class="hs-identifier hs-var">tycovars</span></a></span></span><span>
</span><span id="line-321"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[CoVar] -&gt; DTyCoVarSet
</span><a href="GHC.Types.Var.Set.html#mkDVarSet"><span class="hs-identifier hs-var">mkDVarSet</span></a></span><span> </span><span class="annot"><span class="annottext">([CoVar] -&gt; DTyCoVarSet) -&gt; ZonkM [CoVar] -&gt; ZonkM DTyCoVarSet
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[CoVar] -&gt; ZonkM [CoVar]
</span><a href="GHC.Tc.Zonk.TcType.html#zonkTyCoVarsAndFVList"><span class="hs-identifier hs-var">zonkTyCoVarsAndFVList</span></a></span><span> </span><span class="annot"><span class="annottext">([CoVar] -&gt; ZonkM [CoVar]) -&gt; [CoVar] -&gt; ZonkM [CoVar]
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">DTyCoVarSet -&gt; [CoVar]
</span><a href="GHC.Types.Var.Set.html#dVarSetElems"><span class="hs-identifier hs-var">dVarSetElems</span></a></span><span> </span><span class="annot"><span class="annottext">DTyCoVarSet
</span><a href="#local-6989586621682915243"><span class="hs-identifier hs-var">tycovars</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-322"></span><span>
</span><span id="line-323"></span><span class="hs-comment">-- Takes a list of TyCoVars, zonks them and returns a</span><span>
</span><span id="line-324"></span><span class="hs-comment">-- deterministically ordered list of their free variables.</span><span>
</span><span id="line-325"></span><span class="annot"><a href="GHC.Tc.Zonk.TcType.html#zonkTyCoVarsAndFVList"><span class="hs-identifier hs-type">zonkTyCoVarsAndFVList</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="GHC.Types.Var.html#TyCoVar"><span class="hs-identifier hs-type">TyCoVar</span></a></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Zonk.Monad.html#ZonkM"><span class="hs-identifier hs-type">ZonkM</span></a></span><span> </span><span class="hs-special">[</span><span class="annot"><a href="GHC.Types.Var.html#TyCoVar"><span class="hs-identifier hs-type">TyCoVar</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-326"></span><span id="zonkTyCoVarsAndFVList"><span class="annot"><span class="annottext">zonkTyCoVarsAndFVList :: [CoVar] -&gt; ZonkM [CoVar]
</span><a href="GHC.Tc.Zonk.TcType.html#zonkTyCoVarsAndFVList"><span class="hs-identifier hs-var hs-var">zonkTyCoVarsAndFVList</span></a></span></span><span> </span><span id="local-6989586621682915246"><span class="annot"><span class="annottext">[CoVar]
</span><a href="#local-6989586621682915246"><span class="hs-identifier hs-var">tycovars</span></a></span></span><span>
</span><span id="line-327"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[Type] -&gt; [CoVar]
</span><a href="GHC.Core.TyCo.FVs.html#tyCoVarsOfTypesList"><span class="hs-identifier hs-var">tyCoVarsOfTypesList</span></a></span><span> </span><span class="annot"><span class="annottext">([Type] -&gt; [CoVar]) -&gt; ZonkM [Type] -&gt; ZonkM [CoVar]
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="annot"><span class="annottext">(CoVar -&gt; ZonkM Type) -&gt; [CoVar] -&gt; ZonkM [Type]
forall (t :: * -&gt; *) (m :: * -&gt; *) a b.
(Traversable t, Monad m) =&gt;
(a -&gt; m b) -&gt; t a -&gt; m (t b)
forall (m :: * -&gt; *) a b. Monad m =&gt; (a -&gt; m b) -&gt; [a] -&gt; m [b]
</span><span class="hs-identifier hs-var">mapM</span></span><span> </span><span class="annot"><span class="annottext">CoVar -&gt; ZonkM Type
</span><a href="GHC.Tc.Zonk.TcType.html#zonkTyCoVar"><span class="hs-identifier hs-var">zonkTyCoVar</span></a></span><span> </span><span class="annot"><span class="annottext">[CoVar]
</span><a href="#local-6989586621682915246"><span class="hs-identifier hs-var">tycovars</span></a></span><span>
</span><span id="line-328"></span><span>
</span><span id="line-329"></span><span class="annot"><a href="GHC.Tc.Zonk.TcType.html#zonkTcTyVars"><span class="hs-identifier hs-type">zonkTcTyVars</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="GHC.Types.Var.html#TcTyVar"><span class="hs-identifier hs-type">TcTyVar</span></a></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Zonk.Monad.html#ZonkM"><span class="hs-identifier hs-type">ZonkM</span></a></span><span> </span><span class="hs-special">[</span><span class="annot"><a href="GHC.Tc.Utils.TcType.html#TcType"><span class="hs-identifier hs-type">TcType</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-330"></span><span id="zonkTcTyVars"><span class="annot"><span class="annottext">zonkTcTyVars :: [CoVar] -&gt; ZonkM [Type]
</span><a href="GHC.Tc.Zonk.TcType.html#zonkTcTyVars"><span class="hs-identifier hs-var hs-var">zonkTcTyVars</span></a></span></span><span> </span><span id="local-6989586621682915248"><span class="annot"><span class="annottext">[CoVar]
</span><a href="#local-6989586621682915248"><span class="hs-identifier hs-var">tyvars</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(CoVar -&gt; ZonkM Type) -&gt; [CoVar] -&gt; ZonkM [Type]
forall (t :: * -&gt; *) (m :: * -&gt; *) a b.
(Traversable t, Monad m) =&gt;
(a -&gt; m b) -&gt; t a -&gt; m (t b)
forall (m :: * -&gt; *) a b. Monad m =&gt; (a -&gt; m b) -&gt; [a] -&gt; m [b]
</span><span class="hs-identifier hs-var">mapM</span></span><span> </span><span class="annot"><span class="annottext">CoVar -&gt; ZonkM Type
</span><a href="GHC.Tc.Zonk.TcType.html#zonkTcTyVar"><span class="hs-identifier hs-var">zonkTcTyVar</span></a></span><span> </span><span class="annot"><span class="annottext">[CoVar]
</span><a href="#local-6989586621682915248"><span class="hs-identifier hs-var">tyvars</span></a></span><span>
</span><span id="line-331"></span><span>
</span><span id="line-332"></span><span class="hs-comment">-----------------  Types</span><span>
</span><span id="line-333"></span><span class="annot"><a href="GHC.Tc.Zonk.TcType.html#zonkTyCoVarKind"><span class="hs-identifier hs-type">zonkTyCoVarKind</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Types.Var.html#TyCoVar"><span class="hs-identifier hs-type">TyCoVar</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Zonk.Monad.html#ZonkM"><span class="hs-identifier hs-type">ZonkM</span></a></span><span> </span><span class="annot"><a href="GHC.Types.Var.html#TyCoVar"><span class="hs-identifier hs-type">TyCoVar</span></a></span><span>
</span><span id="line-334"></span><span id="zonkTyCoVarKind"><span class="annot"><span class="annottext">zonkTyCoVarKind :: CoVar -&gt; ZonkM CoVar
</span><a href="GHC.Tc.Zonk.TcType.html#zonkTyCoVarKind"><span class="hs-identifier hs-var hs-var">zonkTyCoVarKind</span></a></span></span><span> </span><span id="local-6989586621682915249"><span class="annot"><span class="annottext">CoVar
</span><a href="#local-6989586621682915249"><span class="hs-identifier hs-var">tv</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span id="local-6989586621682915250"><span class="annot"><a href="#local-6989586621682915250"><span class="hs-identifier hs-var">kind'</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Type -&gt; ZonkM Type
</span><a href="GHC.Tc.Zonk.TcType.html#zonkTcType"><span class="hs-identifier hs-var">zonkTcType</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">CoVar -&gt; Type
</span><a href="GHC.Types.Var.html#tyVarKind"><span class="hs-identifier hs-var">tyVarKind</span></a></span><span> </span><span class="annot"><span class="annottext">CoVar
</span><a href="#local-6989586621682915249"><span class="hs-identifier hs-var">tv</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-335"></span><span>                        </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">return</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Types.Var.html#setTyVarKind"><span class="hs-identifier hs-type">setTyVarKind</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682915249"><span class="hs-identifier hs-type">tv</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682915250"><span class="hs-identifier hs-type">kind'</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-336"></span><span>
</span><span id="line-337"></span><span id="local-6989586621682915252"><span class="annot"><a href="GHC.Tc.Zonk.TcType.html#zonkTyCoVarBndrKind"><span class="hs-identifier hs-type">zonkTyCoVarBndrKind</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Types.Var.html#VarBndr"><span class="hs-identifier hs-type">VarBndr</span></a></span><span> </span><span class="annot"><a href="GHC.Types.Var.html#TyCoVar"><span class="hs-identifier hs-type">TyCoVar</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682915252"><span class="hs-identifier hs-type">flag</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Zonk.Monad.html#ZonkM"><span class="hs-identifier hs-type">ZonkM</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Types.Var.html#VarBndr"><span class="hs-identifier hs-type">VarBndr</span></a></span><span> </span><span class="annot"><a href="GHC.Types.Var.html#TyCoVar"><span class="hs-identifier hs-type">TyCoVar</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682915252"><span class="hs-identifier hs-type">flag</span></a></span><span class="hs-special">)</span></span><span>
</span><span id="line-338"></span><span id="zonkTyCoVarBndrKind"><span class="annot"><span class="annottext">zonkTyCoVarBndrKind :: forall spec. VarBndr CoVar spec -&gt; ZonkM (VarBndr CoVar spec)
</span><a href="GHC.Tc.Zonk.TcType.html#zonkTyCoVarBndrKind"><span class="hs-identifier hs-var hs-var">zonkTyCoVarBndrKind</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Types.Var.html#Bndr"><span class="hs-identifier hs-type">Bndr</span></a></span><span> </span><span id="local-6989586621682915255"><span class="annot"><span class="annottext">CoVar
</span><a href="#local-6989586621682915255"><span class="hs-identifier hs-var">tv</span></a></span></span><span> </span><span id="local-6989586621682915256"><span class="annot"><span class="annottext">flag
</span><a href="#local-6989586621682915256"><span class="hs-identifier hs-var">flag</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-339"></span><span>  </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span id="local-6989586621682915257"><span class="annot"><a href="#local-6989586621682915257"><span class="hs-identifier hs-var">tv'</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">CoVar -&gt; ZonkM CoVar
</span><a href="GHC.Tc.Zonk.TcType.html#zonkTyCoVarKind"><span class="hs-identifier hs-var">zonkTyCoVarKind</span></a></span><span> </span><span class="annot"><span class="annottext">CoVar
</span><a href="#local-6989586621682915255"><span class="hs-identifier hs-var">tv</span></a></span><span>
</span><span id="line-340"></span><span>     </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">return</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Types.Var.html#Bndr"><span class="hs-identifier hs-type">Bndr</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682915257"><span class="hs-identifier hs-type">tv'</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682915256"><span class="hs-identifier hs-type">flag</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-341"></span><span>
</span><span id="line-342"></span><span class="annot"><span class="hs-comment">-- | zonkId is used *during* typechecking just to zonk the 'Id''s type</span></span><span>
</span><span id="line-343"></span><span class="annot"><a href="GHC.Tc.Zonk.TcType.html#zonkId"><span class="hs-identifier hs-type">zonkId</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Tc.Types.BasicTypes.html#TcId"><span class="hs-identifier hs-type">TcId</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Zonk.Monad.html#ZonkM"><span class="hs-identifier hs-type">ZonkM</span></a></span><span> </span><span class="annot"><a href="GHC.Tc.Types.BasicTypes.html#TcId"><span class="hs-identifier hs-type">TcId</span></a></span><span>
</span><span id="line-344"></span><span id="zonkId"><span class="annot"><span class="annottext">zonkId :: CoVar -&gt; ZonkM CoVar
</span><a href="GHC.Tc.Zonk.TcType.html#zonkId"><span class="hs-identifier hs-var hs-var">zonkId</span></a></span></span><span> </span><span id="local-6989586621682915259"><span class="annot"><span class="annottext">CoVar
</span><a href="#local-6989586621682915259"><span class="hs-identifier hs-var">id</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(Type -&gt; ZonkM Type) -&gt; CoVar -&gt; ZonkM CoVar
forall (m :: * -&gt; *).
Monad m =&gt;
(Type -&gt; m Type) -&gt; CoVar -&gt; m CoVar
</span><a href="GHC.Types.Var.html#updateIdTypeAndMultM"><span class="hs-identifier hs-var">updateIdTypeAndMultM</span></a></span><span> </span><span class="annot"><span class="annottext">Type -&gt; ZonkM Type
</span><a href="GHC.Tc.Zonk.TcType.html#zonkTcType"><span class="hs-identifier hs-var">zonkTcType</span></a></span><span> </span><span class="annot"><span class="annottext">CoVar
</span><a href="#local-6989586621682915259"><span class="hs-identifier hs-var">id</span></a></span><span>
</span><span id="line-345"></span><span>
</span><span id="line-346"></span><span class="annot"><a href="GHC.Tc.Zonk.TcType.html#zonkCoVar"><span class="hs-identifier hs-type">zonkCoVar</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Types.Var.html#CoVar"><span class="hs-identifier hs-type">CoVar</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Zonk.Monad.html#ZonkM"><span class="hs-identifier hs-type">ZonkM</span></a></span><span> </span><span class="annot"><a href="GHC.Types.Var.html#CoVar"><span class="hs-identifier hs-type">CoVar</span></a></span><span>
</span><span id="line-347"></span><span id="zonkCoVar"><span class="annot"><span class="annottext">zonkCoVar :: CoVar -&gt; ZonkM CoVar
</span><a href="GHC.Tc.Zonk.TcType.html#zonkCoVar"><span class="hs-identifier hs-var hs-var">zonkCoVar</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">CoVar -&gt; ZonkM CoVar
</span><a href="GHC.Tc.Zonk.TcType.html#zonkId"><span class="hs-identifier hs-var">zonkId</span></a></span><span>
</span><span id="line-348"></span><span>
</span><span id="line-349"></span><span class="hs-comment">{-
************************************************************************
*                                                                      *
        Coercion holes
*                                                                      *
************************************************************************
-}</span><span>
</span><span id="line-356"></span><span>
</span><span id="line-357"></span><span class="hs-comment">-- | Check that a coercion is appropriate for filling a hole. (The hole</span><span>
</span><span id="line-358"></span><span class="hs-comment">-- itself is needed only for printing.)</span><span>
</span><span id="line-359"></span><span class="hs-comment">-- Always returns the checked coercion, but this return value is necessary</span><span>
</span><span id="line-360"></span><span class="hs-comment">-- so that the input coercion is forced only when the output is forced.</span><span>
</span><span id="line-361"></span><span class="annot"><a href="GHC.Tc.Zonk.TcType.html#checkCoercionHole"><span class="hs-identifier hs-type">checkCoercionHole</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Types.Var.html#CoVar"><span class="hs-identifier hs-type">CoVar</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#Coercion"><span class="hs-identifier hs-type">Coercion</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Zonk.Monad.html#ZonkM"><span class="hs-identifier hs-type">ZonkM</span></a></span><span> </span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#Coercion"><span class="hs-identifier hs-type">Coercion</span></a></span><span>
</span><span id="line-362"></span><span id="checkCoercionHole"><span class="annot"><span class="annottext">checkCoercionHole :: CoVar -&gt; Coercion -&gt; ZonkM Coercion
</span><a href="GHC.Tc.Zonk.TcType.html#checkCoercionHole"><span class="hs-identifier hs-var hs-var">checkCoercionHole</span></a></span></span><span> </span><span id="local-6989586621682915261"><span class="annot"><span class="annottext">CoVar
</span><a href="#local-6989586621682915261"><span class="hs-identifier hs-var">cv</span></a></span></span><span> </span><span id="local-6989586621682915262"><span class="annot"><span class="annottext">Coercion
</span><a href="#local-6989586621682915262"><span class="hs-identifier hs-var">co</span></a></span></span><span>
</span><span id="line-363"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="GHC.Utils.Constants.html#debugIsOn"><span class="hs-identifier hs-var">debugIsOn</span></a></span><span>
</span><span id="line-364"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span id="local-6989586621682915263"><span class="annot"><a href="#local-6989586621682915263"><span class="hs-identifier hs-var">cv_ty</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Type -&gt; ZonkM Type
</span><a href="GHC.Tc.Zonk.TcType.html#zonkTcType"><span class="hs-identifier hs-var">zonkTcType</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">CoVar -&gt; Type
</span><a href="GHC.Types.Var.html#varType"><span class="hs-identifier hs-var">varType</span></a></span><span> </span><span class="annot"><span class="annottext">CoVar
</span><a href="#local-6989586621682915261"><span class="hs-identifier hs-var">cv</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-365"></span><span>                  </span><span class="hs-comment">-- co is already zonked, but cv might not be</span><span>
</span><span id="line-366"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">return</span></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span>
</span><span id="line-367"></span><span>         </span><span class="annot"><a href="GHC.Utils.Panic.html#assertPpr"><span class="hs-identifier hs-type">assertPpr</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621682915265"><span class="hs-identifier hs-type">ok</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682915263"><span class="hs-identifier hs-type">cv_ty</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-368"></span><span>                   </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Utils.Outputable.html#text"><span class="hs-identifier hs-type">text</span></a></span><span> </span><span class="annot"><span class="hs-string">&quot;Bad coercion hole&quot;</span></span><span> </span><span class="annot"><a href="GHC.Utils.Outputable.html#%3C%2B%3E"><span class="hs-operator hs-type">&lt;+&gt;</span></a></span><span>
</span><span id="line-369"></span><span>                    </span><span class="annot"><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-type">ppr</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682915261"><span class="hs-identifier hs-type">cv</span></a></span><span> </span><span class="annot"><a href="GHC.Utils.Outputable.html#%3C%3E"><span class="hs-operator hs-type">&lt;&gt;</span></a></span><span> </span><span class="annot"><a href="GHC.Utils.Outputable.html#colon"><span class="hs-identifier hs-type">colon</span></a></span><span> </span><span class="annot"><a href="GHC.Utils.Outputable.html#%3C%2B%3E"><span class="hs-operator hs-type">&lt;+&gt;</span></a></span><span> </span><span class="annot"><a href="GHC.Utils.Outputable.html#vcat"><span class="hs-identifier hs-type">vcat</span></a></span><span> </span><span class="hs-special">[</span><span> </span><span class="annot"><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-type">ppr</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682915269"><span class="hs-identifier hs-type">t1</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-type">ppr</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682915270"><span class="hs-identifier hs-type">t2</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-type">ppr</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682915271"><span class="hs-keyword hs-type">role</span></a></span><span>
</span><span id="line-370"></span><span>                                             </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-type">ppr</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682915263"><span class="hs-identifier hs-type">cv_ty</span></a></span><span> </span><span class="hs-special">]</span><span class="hs-special">)</span><span>
</span><span id="line-371"></span><span>         </span><span class="annot"><a href="#local-6989586621682915262"><span class="hs-identifier hs-type">co</span></a></span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-372"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">otherwise</span></span><span>
</span><span id="line-373"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Coercion -&gt; ZonkM Coercion
forall a. a -&gt; ZonkM a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="annot"><span class="annottext">Coercion
</span><a href="#local-6989586621682915262"><span class="hs-identifier hs-var">co</span></a></span><span>
</span><span id="line-374"></span><span>
</span><span id="line-375"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-376"></span><span>    </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Data.Pair.html#Pair"><span class="hs-identifier hs-type">Pair</span></a></span><span> </span><span id="local-6989586621682915269"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682915269"><span class="hs-identifier hs-var">t1</span></a></span></span><span> </span><span id="local-6989586621682915270"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682915270"><span class="hs-identifier hs-var">t2</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682915271"><span class="annot"><span class="annottext">Role
</span><a href="#local-6989586621682915271"><span class="hs-keyword hs-var">role</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Coercion -&gt; (Pair Type, Role)
</span><a href="GHC.Core.Coercion.html#coercionKindRole"><span class="hs-identifier hs-var">coercionKindRole</span></a></span><span> </span><span class="annot"><span class="annottext">Coercion
</span><a href="#local-6989586621682915262"><span class="hs-identifier hs-var">co</span></a></span><span>
</span><span id="line-377"></span><span>    </span><span id="local-6989586621682915265"><span class="annot"><span class="annottext">ok :: Type -&gt; Bool
</span><a href="#local-6989586621682915265"><span class="hs-identifier hs-var hs-var">ok</span></a></span></span><span> </span><span id="local-6989586621682915274"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682915274"><span class="hs-identifier hs-var">cv_ty</span></a></span></span><span> </span><span class="hs-glyph">|</span><span> </span><span class="annot"><a href="GHC.Core.Predicate.html#EqPred"><span class="hs-identifier hs-type">EqPred</span></a></span><span> </span><span id="local-6989586621682915276"><span class="annot"><span class="annottext">EqRel
</span><a href="#local-6989586621682915276"><span class="hs-identifier hs-var">cv_rel</span></a></span></span><span> </span><span id="local-6989586621682915277"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682915277"><span class="hs-identifier hs-var">cv_t1</span></a></span></span><span> </span><span id="local-6989586621682915278"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682915278"><span class="hs-identifier hs-var">cv_t2</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Type -&gt; Pred
</span><a href="GHC.Core.Predicate.html#classifyPredType"><span class="hs-identifier hs-var">classifyPredType</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682915274"><span class="hs-identifier hs-var">cv_ty</span></a></span><span>
</span><span id="line-378"></span><span>             </span><span class="hs-glyph">=</span><span>  </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682915269"><span class="hs-identifier hs-var">t1</span></a></span><span> </span><span class="annot"><span class="annottext">HasCallStack =&gt; Type -&gt; Type -&gt; Bool
Type -&gt; Type -&gt; Bool
</span><a href="GHC.Core.TyCo.Compare.html#eqType"><span class="hs-operator hs-var">`eqType`</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682915277"><span class="hs-identifier hs-var">cv_t1</span></a></span><span>
</span><span id="line-379"></span><span>             </span><span class="annot"><span class="annottext">Bool -&gt; Bool -&gt; Bool
</span><span class="hs-operator hs-var">&amp;&amp;</span></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682915270"><span class="hs-identifier hs-var">t2</span></a></span><span> </span><span class="annot"><span class="annottext">HasCallStack =&gt; Type -&gt; Type -&gt; Bool
Type -&gt; Type -&gt; Bool
</span><a href="GHC.Core.TyCo.Compare.html#eqType"><span class="hs-operator hs-var">`eqType`</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682915278"><span class="hs-identifier hs-var">cv_t2</span></a></span><span>
</span><span id="line-380"></span><span>             </span><span class="annot"><span class="annottext">Bool -&gt; Bool -&gt; Bool
</span><span class="hs-operator hs-var">&amp;&amp;</span></span><span> </span><span class="annot"><span class="annottext">Role
</span><a href="#local-6989586621682915271"><span class="hs-keyword hs-var">role</span></a></span><span> </span><span class="annot"><span class="annottext">Role -&gt; Role -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">==</span></span><span> </span><span class="annot"><span class="annottext">EqRel -&gt; Role
</span><a href="GHC.Core.Predicate.html#eqRelRole"><span class="hs-identifier hs-var">eqRelRole</span></a></span><span> </span><span class="annot"><span class="annottext">EqRel
</span><a href="#local-6989586621682915276"><span class="hs-identifier hs-var">cv_rel</span></a></span><span>
</span><span id="line-381"></span><span>             </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">otherwise</span></span><span>
</span><span id="line-382"></span><span>             </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">False</span></span><span>
</span><span id="line-383"></span><span>
</span><span id="line-384"></span><span>
</span><span id="line-385"></span><span class="hs-comment">{-
************************************************************************
*                                                                      *
              Zonking constraints
*                                                                      *
************************************************************************
-}</span><span>
</span><span id="line-392"></span><span>
</span><span id="line-393"></span><span class="annot"><a href="GHC.Tc.Zonk.TcType.html#zonkImplication"><span class="hs-identifier hs-type">zonkImplication</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Tc.Types.Constraint.html#Implication"><span class="hs-identifier hs-type">Implication</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Zonk.Monad.html#ZonkM"><span class="hs-identifier hs-type">ZonkM</span></a></span><span> </span><span class="annot"><a href="GHC.Tc.Types.Constraint.html#Implication"><span class="hs-identifier hs-type">Implication</span></a></span><span>
</span><span id="line-394"></span><span id="zonkImplication"><span class="annot"><span class="annottext">zonkImplication :: Implication -&gt; ZonkM Implication
</span><a href="GHC.Tc.Zonk.TcType.html#zonkImplication"><span class="hs-identifier hs-var hs-var">zonkImplication</span></a></span></span><span> </span><span id="local-6989586621682915282"><span class="annot"><span class="annottext">implic :: Implication
</span><a href="#local-6989586621682915282"><span class="hs-identifier hs-var">implic</span></a></span></span><span class="hs-glyph">@</span><span class="hs-special">(</span><span class="annot"><a href="GHC.Tc.Types.Constraint.html#Implic"><span class="hs-identifier hs-type">Implic</span></a></span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">ic_skols :: Implication -&gt; [CoVar]
</span><a href="GHC.Tc.Types.Constraint.html#ic_skols"><span class="hs-identifier hs-var">ic_skols</span></a></span><span>  </span><span class="hs-glyph">=</span><span> </span><span id="local-6989586621682915285"><span class="annot"><span class="annottext">[CoVar]
</span><a href="#local-6989586621682915285"><span class="hs-identifier hs-var">skols</span></a></span></span><span>
</span><span id="line-395"></span><span>                               </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">ic_given :: Implication -&gt; [CoVar]
</span><a href="GHC.Tc.Types.Constraint.html#ic_given"><span class="hs-identifier hs-var">ic_given</span></a></span><span>  </span><span class="hs-glyph">=</span><span> </span><span id="local-6989586621682915287"><span class="annot"><span class="annottext">[CoVar]
</span><a href="#local-6989586621682915287"><span class="hs-identifier hs-var">given</span></a></span></span><span>
</span><span id="line-396"></span><span>                               </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">ic_wanted :: Implication -&gt; WantedConstraints
</span><a href="GHC.Tc.Types.Constraint.html#ic_wanted"><span class="hs-identifier hs-var">ic_wanted</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="local-6989586621682915289"><span class="annot"><span class="annottext">WantedConstraints
</span><a href="#local-6989586621682915289"><span class="hs-identifier hs-var">wanted</span></a></span></span><span>
</span><span id="line-397"></span><span>                               </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">ic_info :: Implication -&gt; SkolemInfoAnon
</span><a href="GHC.Tc.Types.Constraint.html#ic_info"><span class="hs-identifier hs-var">ic_info</span></a></span><span>   </span><span class="hs-glyph">=</span><span> </span><span id="local-6989586621682915291"><span class="annot"><span class="annottext">SkolemInfoAnon
</span><a href="#local-6989586621682915291"><span class="hs-identifier hs-var">info</span></a></span></span><span> </span><span class="hs-special">}</span><span class="hs-special">)</span><span>
</span><span id="line-398"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span id="local-6989586621682915292"><span class="annot"><a href="#local-6989586621682915292"><span class="hs-identifier hs-var">skols'</span></a></span></span><span>  </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">(CoVar -&gt; ZonkM CoVar) -&gt; [CoVar] -&gt; ZonkM [CoVar]
forall (t :: * -&gt; *) (m :: * -&gt; *) a b.
(Traversable t, Monad m) =&gt;
(a -&gt; m b) -&gt; t a -&gt; m (t b)
forall (m :: * -&gt; *) a b. Monad m =&gt; (a -&gt; m b) -&gt; [a] -&gt; m [b]
</span><span class="hs-identifier hs-var">mapM</span></span><span> </span><span class="annot"><span class="annottext">CoVar -&gt; ZonkM CoVar
</span><a href="GHC.Tc.Zonk.TcType.html#zonkTyCoVarKind"><span class="hs-identifier hs-var">zonkTyCoVarKind</span></a></span><span> </span><span class="annot"><span class="annottext">[CoVar]
</span><a href="#local-6989586621682915285"><span class="hs-identifier hs-var">skols</span></a></span><span>  </span><span class="hs-comment">-- Need to zonk their kinds!</span><span>
</span><span id="line-399"></span><span>                                                </span><span class="hs-comment">-- as #7230 showed</span><span>
</span><span id="line-400"></span><span>       </span><span class="hs-special">;</span><span> </span><span id="local-6989586621682915293"><span class="annot"><a href="#local-6989586621682915293"><span class="hs-identifier hs-var">given'</span></a></span></span><span>  </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="hs-identifier hs-type">mapM</span></span><span> </span><span class="annot"><a href="GHC.Tc.Zonk.TcType.html#zonkEvVar"><span class="hs-identifier hs-type">zonkEvVar</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682915287"><span class="hs-identifier hs-type">given</span></a></span><span>
</span><span id="line-401"></span><span>       </span><span class="hs-special">;</span><span> </span><span id="local-6989586621682915295"><span class="annot"><a href="#local-6989586621682915295"><span class="hs-identifier hs-var">info'</span></a></span></span><span>   </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><a href="GHC.Tc.Zonk.TcType.html#zonkSkolemInfoAnon"><span class="hs-identifier hs-type">zonkSkolemInfoAnon</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682915291"><span class="hs-identifier hs-type">info</span></a></span><span>
</span><span id="line-402"></span><span>       </span><span class="hs-special">;</span><span> </span><span id="local-6989586621682915296"><span class="annot"><a href="#local-6989586621682915296"><span class="hs-identifier hs-var">wanted'</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><a href="GHC.Tc.Zonk.TcType.html#zonkWCRec"><span class="hs-identifier hs-type">zonkWCRec</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682915289"><span class="hs-identifier hs-type">wanted</span></a></span><span>
</span><span id="line-403"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">return</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621682915282"><span class="hs-identifier hs-type">implic</span></a></span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><a href="GHC.Tc.Types.Constraint.html#ic_skols"><span class="hs-identifier hs-var">ic_skols</span></a></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="#local-6989586621682915292"><span class="hs-identifier hs-type">skols'</span></a></span><span>
</span><span id="line-404"></span><span>                        </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Tc.Types.Constraint.html#ic_given"><span class="hs-identifier hs-var">ic_given</span></a></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="#local-6989586621682915293"><span class="hs-identifier hs-type">given'</span></a></span><span>
</span><span id="line-405"></span><span>                        </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Tc.Types.Constraint.html#ic_wanted"><span class="hs-identifier hs-var">ic_wanted</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="#local-6989586621682915296"><span class="hs-identifier hs-type">wanted'</span></a></span><span>
</span><span id="line-406"></span><span>                        </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Tc.Types.Constraint.html#ic_info"><span class="hs-identifier hs-var">ic_info</span></a></span><span>   </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="#local-6989586621682915295"><span class="hs-identifier hs-type">info'</span></a></span><span> </span><span class="hs-special">}</span><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-407"></span><span>
</span><span id="line-408"></span><span class="annot"><a href="GHC.Tc.Zonk.TcType.html#zonkEvVar"><span class="hs-identifier hs-type">zonkEvVar</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Types.Var.html#EvVar"><span class="hs-identifier hs-type">EvVar</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Zonk.Monad.html#ZonkM"><span class="hs-identifier hs-type">ZonkM</span></a></span><span> </span><span class="annot"><a href="GHC.Types.Var.html#EvVar"><span class="hs-identifier hs-type">EvVar</span></a></span><span>
</span><span id="line-409"></span><span id="zonkEvVar"><span class="annot"><span class="annottext">zonkEvVar :: CoVar -&gt; ZonkM CoVar
</span><a href="GHC.Tc.Zonk.TcType.html#zonkEvVar"><span class="hs-identifier hs-var hs-var">zonkEvVar</span></a></span></span><span> </span><span id="local-6989586621682915299"><span class="annot"><span class="annottext">CoVar
</span><a href="#local-6989586621682915299"><span class="hs-identifier hs-var">var</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(Type -&gt; ZonkM Type) -&gt; CoVar -&gt; ZonkM CoVar
forall (m :: * -&gt; *).
Monad m =&gt;
(Type -&gt; m Type) -&gt; CoVar -&gt; m CoVar
</span><a href="GHC.Types.Var.html#updateIdTypeAndMultM"><span class="hs-identifier hs-var">updateIdTypeAndMultM</span></a></span><span> </span><span class="annot"><span class="annottext">Type -&gt; ZonkM Type
</span><a href="GHC.Tc.Zonk.TcType.html#zonkTcType"><span class="hs-identifier hs-var">zonkTcType</span></a></span><span> </span><span class="annot"><span class="annottext">CoVar
</span><a href="#local-6989586621682915299"><span class="hs-identifier hs-var">var</span></a></span><span>
</span><span id="line-410"></span><span>
</span><span id="line-411"></span><span>
</span><span id="line-412"></span><span class="annot"><a href="GHC.Tc.Zonk.TcType.html#zonkWC"><span class="hs-identifier hs-type">zonkWC</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Tc.Types.Constraint.html#WantedConstraints"><span class="hs-identifier hs-type">WantedConstraints</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Zonk.Monad.html#ZonkM"><span class="hs-identifier hs-type">ZonkM</span></a></span><span> </span><span class="annot"><a href="GHC.Tc.Types.Constraint.html#WantedConstraints"><span class="hs-identifier hs-type">WantedConstraints</span></a></span><span>
</span><span id="line-413"></span><span id="zonkWC"><span class="annot"><span class="annottext">zonkWC :: WantedConstraints -&gt; ZonkM WantedConstraints
</span><a href="GHC.Tc.Zonk.TcType.html#zonkWC"><span class="hs-identifier hs-var hs-var">zonkWC</span></a></span></span><span> </span><span id="local-6989586621682915300"><span class="annot"><span class="annottext">WantedConstraints
</span><a href="#local-6989586621682915300"><span class="hs-identifier hs-var">wc</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">WantedConstraints -&gt; ZonkM WantedConstraints
</span><a href="GHC.Tc.Zonk.TcType.html#zonkWCRec"><span class="hs-identifier hs-var">zonkWCRec</span></a></span><span> </span><span class="annot"><span class="annottext">WantedConstraints
</span><a href="#local-6989586621682915300"><span class="hs-identifier hs-var">wc</span></a></span><span>
</span><span id="line-414"></span><span>
</span><span id="line-415"></span><span class="annot"><a href="GHC.Tc.Zonk.TcType.html#zonkWCRec"><span class="hs-identifier hs-type">zonkWCRec</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Tc.Types.Constraint.html#WantedConstraints"><span class="hs-identifier hs-type">WantedConstraints</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Zonk.Monad.html#ZonkM"><span class="hs-identifier hs-type">ZonkM</span></a></span><span> </span><span class="annot"><a href="GHC.Tc.Types.Constraint.html#WantedConstraints"><span class="hs-identifier hs-type">WantedConstraints</span></a></span><span>
</span><span id="line-416"></span><span id="zonkWCRec"><span class="annot"><span class="annottext">zonkWCRec :: WantedConstraints -&gt; ZonkM WantedConstraints
</span><a href="GHC.Tc.Zonk.TcType.html#zonkWCRec"><span class="hs-identifier hs-var hs-var">zonkWCRec</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Tc.Types.Constraint.html#WC"><span class="hs-identifier hs-type">WC</span></a></span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">wc_simple :: WantedConstraints -&gt; Bag Ct
</span><a href="GHC.Tc.Types.Constraint.html#wc_simple"><span class="hs-identifier hs-var">wc_simple</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="local-6989586621682915303"><span class="annot"><span class="annottext">Bag Ct
</span><a href="#local-6989586621682915303"><span class="hs-identifier hs-var">simple</span></a></span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">wc_impl :: WantedConstraints -&gt; Bag Implication
</span><a href="GHC.Tc.Types.Constraint.html#wc_impl"><span class="hs-identifier hs-var">wc_impl</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="local-6989586621682915305"><span class="annot"><span class="annottext">Bag Implication
</span><a href="#local-6989586621682915305"><span class="hs-identifier hs-var">implic</span></a></span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">wc_errors :: WantedConstraints -&gt; Bag DelayedError
</span><a href="GHC.Tc.Types.Constraint.html#wc_errors"><span class="hs-identifier hs-var">wc_errors</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="local-6989586621682915307"><span class="annot"><span class="annottext">Bag DelayedError
</span><a href="#local-6989586621682915307"><span class="hs-identifier hs-var">errs</span></a></span></span><span> </span><span class="hs-special">}</span><span class="hs-special">)</span><span>
</span><span id="line-417"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span id="local-6989586621682915308"><span class="annot"><a href="#local-6989586621682915308"><span class="hs-identifier hs-var">simple'</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Bag Ct -&gt; ZonkM (Bag Ct)
</span><a href="GHC.Tc.Zonk.TcType.html#zonkSimples"><span class="hs-identifier hs-var">zonkSimples</span></a></span><span> </span><span class="annot"><span class="annottext">Bag Ct
</span><a href="#local-6989586621682915303"><span class="hs-identifier hs-var">simple</span></a></span><span>
</span><span id="line-418"></span><span>       </span><span class="hs-special">;</span><span> </span><span id="local-6989586621682915309"><span class="annot"><a href="#local-6989586621682915309"><span class="hs-identifier hs-var">implic'</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><a href="GHC.Data.Bag.html#mapBagM"><span class="hs-identifier hs-type">mapBagM</span></a></span><span> </span><span class="annot"><a href="GHC.Tc.Zonk.TcType.html#zonkImplication"><span class="hs-identifier hs-type">zonkImplication</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682915305"><span class="hs-identifier hs-type">implic</span></a></span><span>
</span><span id="line-419"></span><span>       </span><span class="hs-special">;</span><span> </span><span id="local-6989586621682915311"><span class="annot"><a href="#local-6989586621682915311"><span class="hs-identifier hs-var">errs'</span></a></span></span><span>   </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><a href="GHC.Data.Bag.html#mapBagM"><span class="hs-identifier hs-type">mapBagM</span></a></span><span> </span><span class="annot"><a href="GHC.Tc.Zonk.TcType.html#zonkDelayedError"><span class="hs-identifier hs-type">zonkDelayedError</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682915307"><span class="hs-identifier hs-type">errs</span></a></span><span>
</span><span id="line-420"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">return</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Tc.Types.Constraint.html#WC"><span class="hs-identifier hs-type">WC</span></a></span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><a href="GHC.Tc.Types.Constraint.html#wc_simple"><span class="hs-identifier hs-var">wc_simple</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="#local-6989586621682915308"><span class="hs-identifier hs-type">simple'</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Tc.Types.Constraint.html#wc_impl"><span class="hs-identifier hs-var">wc_impl</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="#local-6989586621682915309"><span class="hs-identifier hs-type">implic'</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Tc.Types.Constraint.html#wc_errors"><span class="hs-identifier hs-var">wc_errors</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="#local-6989586621682915311"><span class="hs-identifier hs-type">errs'</span></a></span><span> </span><span class="hs-special">}</span><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-421"></span><span>
</span><span id="line-422"></span><span class="annot"><a href="GHC.Tc.Zonk.TcType.html#zonkSimples"><span class="hs-identifier hs-type">zonkSimples</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Tc.Types.Constraint.html#Cts"><span class="hs-identifier hs-type">Cts</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Zonk.Monad.html#ZonkM"><span class="hs-identifier hs-type">ZonkM</span></a></span><span> </span><span class="annot"><a href="GHC.Tc.Types.Constraint.html#Cts"><span class="hs-identifier hs-type">Cts</span></a></span><span>
</span><span id="line-423"></span><span id="zonkSimples"><span class="annot"><span class="annottext">zonkSimples :: Bag Ct -&gt; ZonkM (Bag Ct)
</span><a href="GHC.Tc.Zonk.TcType.html#zonkSimples"><span class="hs-identifier hs-var hs-var">zonkSimples</span></a></span></span><span> </span><span id="local-6989586621682915314"><span class="annot"><span class="annottext">Bag Ct
</span><a href="#local-6989586621682915314"><span class="hs-identifier hs-var">cts</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span id="local-6989586621682915315"><span class="annot"><a href="#local-6989586621682915315"><span class="hs-identifier hs-var">cts'</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">(Ct -&gt; ZonkM Ct) -&gt; Bag Ct -&gt; ZonkM (Bag Ct)
forall (m :: * -&gt; *) a b.
Monad m =&gt;
(a -&gt; m b) -&gt; Bag a -&gt; m (Bag b)
</span><a href="GHC.Data.Bag.html#mapBagM"><span class="hs-identifier hs-var">mapBagM</span></a></span><span> </span><span class="annot"><span class="annottext">Ct -&gt; ZonkM Ct
</span><a href="GHC.Tc.Zonk.TcType.html#zonkCt"><span class="hs-identifier hs-var">zonkCt</span></a></span><span> </span><span class="annot"><span class="annottext">Bag Ct
</span><a href="#local-6989586621682915314"><span class="hs-identifier hs-var">cts</span></a></span><span>
</span><span id="line-424"></span><span>                     </span><span class="hs-special">;</span><span> </span><span class="annot"><a href="GHC.Tc.Zonk.Monad.html#traceZonk"><span class="hs-identifier hs-type">traceZonk</span></a></span><span> </span><span class="annot"><span class="hs-string">&quot;zonkSimples done:&quot;</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-type">ppr</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682915315"><span class="hs-identifier hs-type">cts'</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-425"></span><span>                     </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">return</span></span><span> </span><span class="annot"><a href="#local-6989586621682915315"><span class="hs-identifier hs-type">cts'</span></a></span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-426"></span><span>
</span><span id="line-427"></span><span class="annot"><a href="GHC.Tc.Zonk.TcType.html#zonkDelayedError"><span class="hs-identifier hs-type">zonkDelayedError</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Tc.Types.Constraint.html#DelayedError"><span class="hs-identifier hs-type">DelayedError</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Zonk.Monad.html#ZonkM"><span class="hs-identifier hs-type">ZonkM</span></a></span><span> </span><span class="annot"><a href="GHC.Tc.Types.Constraint.html#DelayedError"><span class="hs-identifier hs-type">DelayedError</span></a></span><span>
</span><span id="line-428"></span><span id="zonkDelayedError"><span class="annot"><span class="annottext">zonkDelayedError :: DelayedError -&gt; ZonkM DelayedError
</span><a href="GHC.Tc.Zonk.TcType.html#zonkDelayedError"><span class="hs-identifier hs-var hs-var">zonkDelayedError</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Tc.Types.Constraint.html#DE_Hole"><span class="hs-identifier hs-type">DE_Hole</span></a></span><span> </span><span id="local-6989586621682915317"><span class="annot"><span class="annottext">Hole
</span><a href="#local-6989586621682915317"><span class="hs-identifier hs-var">hole</span></a></span></span><span class="hs-special">)</span><span>
</span><span id="line-429"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Hole -&gt; DelayedError
</span><a href="GHC.Tc.Types.Constraint.html#DE_Hole"><span class="hs-identifier hs-var">DE_Hole</span></a></span><span> </span><span class="annot"><span class="annottext">(Hole -&gt; DelayedError) -&gt; ZonkM Hole -&gt; ZonkM DelayedError
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="annot"><span class="annottext">Hole -&gt; ZonkM Hole
</span><a href="GHC.Tc.Zonk.TcType.html#zonkHole"><span class="hs-identifier hs-var">zonkHole</span></a></span><span> </span><span class="annot"><span class="annottext">Hole
</span><a href="#local-6989586621682915317"><span class="hs-identifier hs-var">hole</span></a></span><span>
</span><span id="line-430"></span><span class="annot"><a href="GHC.Tc.Zonk.TcType.html#zonkDelayedError"><span class="hs-identifier hs-var">zonkDelayedError</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Tc.Types.Constraint.html#DE_NotConcrete"><span class="hs-identifier hs-type">DE_NotConcrete</span></a></span><span> </span><span id="local-6989586621682915320"><span class="annot"><span class="annottext">NotConcreteError
</span><a href="#local-6989586621682915320"><span class="hs-identifier hs-var">err</span></a></span></span><span class="hs-special">)</span><span>
</span><span id="line-431"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">NotConcreteError -&gt; DelayedError
</span><a href="GHC.Tc.Types.Constraint.html#DE_NotConcrete"><span class="hs-identifier hs-var">DE_NotConcrete</span></a></span><span> </span><span class="annot"><span class="annottext">(NotConcreteError -&gt; DelayedError)
-&gt; ZonkM NotConcreteError -&gt; ZonkM DelayedError
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="annot"><span class="annottext">NotConcreteError -&gt; ZonkM NotConcreteError
</span><a href="GHC.Tc.Zonk.TcType.html#zonkNotConcreteError"><span class="hs-identifier hs-var">zonkNotConcreteError</span></a></span><span> </span><span class="annot"><span class="annottext">NotConcreteError
</span><a href="#local-6989586621682915320"><span class="hs-identifier hs-var">err</span></a></span><span>
</span><span id="line-432"></span><span>
</span><span id="line-433"></span><span class="annot"><a href="GHC.Tc.Zonk.TcType.html#zonkHole"><span class="hs-identifier hs-type">zonkHole</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Tc.Types.Constraint.html#Hole"><span class="hs-identifier hs-type">Hole</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Zonk.Monad.html#ZonkM"><span class="hs-identifier hs-type">ZonkM</span></a></span><span> </span><span class="annot"><a href="GHC.Tc.Types.Constraint.html#Hole"><span class="hs-identifier hs-type">Hole</span></a></span><span>
</span><span id="line-434"></span><span id="zonkHole"><span class="annot"><span class="annottext">zonkHole :: Hole -&gt; ZonkM Hole
</span><a href="GHC.Tc.Zonk.TcType.html#zonkHole"><span class="hs-identifier hs-var hs-var">zonkHole</span></a></span></span><span> </span><span id="local-6989586621682915322"><span class="annot"><span class="annottext">hole :: Hole
</span><a href="#local-6989586621682915322"><span class="hs-identifier hs-var">hole</span></a></span></span><span class="hs-glyph">@</span><span class="hs-special">(</span><span class="annot"><a href="GHC.Tc.Types.Constraint.html#Hole"><span class="hs-identifier hs-type">Hole</span></a></span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">hole_ty :: Hole -&gt; Type
</span><a href="GHC.Tc.Types.Constraint.html#hole_ty"><span class="hs-identifier hs-var">hole_ty</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="local-6989586621682915325"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682915325"><span class="hs-identifier hs-var">ty</span></a></span></span><span> </span><span class="hs-special">}</span><span class="hs-special">)</span><span>
</span><span id="line-435"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span id="local-6989586621682915326"><span class="annot"><a href="#local-6989586621682915326"><span class="hs-identifier hs-var">ty'</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Type -&gt; ZonkM Type
</span><a href="GHC.Tc.Zonk.TcType.html#zonkTcType"><span class="hs-identifier hs-var">zonkTcType</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682915325"><span class="hs-identifier hs-var">ty</span></a></span><span>
</span><span id="line-436"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">return</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621682915322"><span class="hs-identifier hs-type">hole</span></a></span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><a href="GHC.Tc.Types.Constraint.html#hole_ty"><span class="hs-identifier hs-var">hole_ty</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="#local-6989586621682915326"><span class="hs-identifier hs-type">ty'</span></a></span><span> </span><span class="hs-special">}</span><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-437"></span><span>
</span><span id="line-438"></span><span class="annot"><a href="GHC.Tc.Zonk.TcType.html#zonkNotConcreteError"><span class="hs-identifier hs-type">zonkNotConcreteError</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Tc.Types.Constraint.html#NotConcreteError"><span class="hs-identifier hs-type">NotConcreteError</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Zonk.Monad.html#ZonkM"><span class="hs-identifier hs-type">ZonkM</span></a></span><span> </span><span class="annot"><a href="GHC.Tc.Types.Constraint.html#NotConcreteError"><span class="hs-identifier hs-type">NotConcreteError</span></a></span><span>
</span><span id="line-439"></span><span id="zonkNotConcreteError"><span class="annot"><span class="annottext">zonkNotConcreteError :: NotConcreteError -&gt; ZonkM NotConcreteError
</span><a href="GHC.Tc.Zonk.TcType.html#zonkNotConcreteError"><span class="hs-identifier hs-var hs-var">zonkNotConcreteError</span></a></span></span><span> </span><span id="local-6989586621682915327"><span class="annot"><span class="annottext">err :: NotConcreteError
</span><a href="#local-6989586621682915327"><span class="hs-identifier hs-var">err</span></a></span></span><span class="hs-glyph">@</span><span class="hs-special">(</span><span class="annot"><a href="GHC.Tc.Types.Constraint.html#NCE_FRR"><span class="hs-identifier hs-type">NCE_FRR</span></a></span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">nce_frr_origin :: NotConcreteError -&gt; FixedRuntimeRepOrigin
</span><a href="GHC.Tc.Types.Constraint.html#nce_frr_origin"><span class="hs-identifier hs-var">nce_frr_origin</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="local-6989586621682915330"><span class="annot"><span class="annottext">FixedRuntimeRepOrigin
</span><a href="#local-6989586621682915330"><span class="hs-identifier hs-var">frr_orig</span></a></span></span><span> </span><span class="hs-special">}</span><span class="hs-special">)</span><span>
</span><span id="line-440"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span id="local-6989586621682915331"><span class="annot"><a href="#local-6989586621682915331"><span class="hs-identifier hs-var">frr_orig</span></a></span></span><span>  </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">FixedRuntimeRepOrigin -&gt; ZonkM FixedRuntimeRepOrigin
</span><a href="GHC.Tc.Zonk.TcType.html#zonkFRROrigin"><span class="hs-identifier hs-var">zonkFRROrigin</span></a></span><span> </span><span class="annot"><span class="annottext">FixedRuntimeRepOrigin
</span><a href="#local-6989586621682915330"><span class="hs-identifier hs-var">frr_orig</span></a></span><span>
</span><span id="line-441"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">return</span></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="annot"><a href="#local-6989586621682915327"><span class="hs-identifier hs-type">err</span></a></span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><a href="GHC.Tc.Types.Constraint.html#nce_frr_origin"><span class="hs-identifier hs-var">nce_frr_origin</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="#local-6989586621682915331"><span class="hs-identifier hs-type">frr_orig</span></a></span><span>  </span><span class="hs-special">}</span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-442"></span><span>
</span><span id="line-443"></span><span class="annot"><a href="GHC.Tc.Zonk.TcType.html#zonkFRROrigin"><span class="hs-identifier hs-type">zonkFRROrigin</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Tc.Types.Origin.html#FixedRuntimeRepOrigin"><span class="hs-identifier hs-type">FixedRuntimeRepOrigin</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Zonk.Monad.html#ZonkM"><span class="hs-identifier hs-type">ZonkM</span></a></span><span> </span><span class="annot"><a href="GHC.Tc.Types.Origin.html#FixedRuntimeRepOrigin"><span class="hs-identifier hs-type">FixedRuntimeRepOrigin</span></a></span><span>
</span><span id="line-444"></span><span id="zonkFRROrigin"><span class="annot"><span class="annottext">zonkFRROrigin :: FixedRuntimeRepOrigin -&gt; ZonkM FixedRuntimeRepOrigin
</span><a href="GHC.Tc.Zonk.TcType.html#zonkFRROrigin"><span class="hs-identifier hs-var hs-var">zonkFRROrigin</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Tc.Types.Origin.html#FixedRuntimeRepOrigin"><span class="hs-identifier hs-type">FixedRuntimeRepOrigin</span></a></span><span> </span><span id="local-6989586621682915334"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682915334"><span class="hs-identifier hs-var">ty</span></a></span></span><span> </span><span id="local-6989586621682915335"><span class="annot"><span class="annottext">FixedRuntimeRepContext
</span><a href="#local-6989586621682915335"><span class="hs-identifier hs-var">orig</span></a></span></span><span class="hs-special">)</span><span>
</span><span id="line-445"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span id="local-6989586621682915336"><span class="annot"><a href="#local-6989586621682915336"><span class="hs-identifier hs-var">ty'</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Type -&gt; ZonkM Type
</span><a href="GHC.Tc.Zonk.TcType.html#zonkTcType"><span class="hs-identifier hs-var">zonkTcType</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682915334"><span class="hs-identifier hs-var">ty</span></a></span><span>
</span><span id="line-446"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">return</span></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="annot"><a href="GHC.Tc.Types.Origin.html#FixedRuntimeRepOrigin"><span class="hs-identifier hs-type">FixedRuntimeRepOrigin</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682915336"><span class="hs-identifier hs-type">ty'</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682915335"><span class="hs-identifier hs-type">orig</span></a></span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-447"></span><span>
</span><span id="line-448"></span><span class="hs-comment">{- Note [zonkCt behaviour]
~~~~~~~~~~~~~~~~~~~~~~~~~~
zonkCt tries to maintain the canonical form of a Ct.  For example,
  - a CDictCan should stay a CDictCan;
  - a CIrredCan should stay a CIrredCan with its cc_reason flag intact

Why?, for example:
- For CDictCan, the @GHC.Tc.Solver.expandSuperClasses@ step, which runs after the
  simple wanted and plugin loop, looks for @CDictCan@s. If a plugin is in use,
  constraints are zonked before being passed to the plugin. This means if we
  don't preserve a canonical form, @expandSuperClasses@ fails to expand
  superclasses. This is what happened in #11525.

- For CIrredCan we want to see if a constraint is insoluble with insolubleWC

On the other hand, we change CEqCan to CNonCanonical, because of all of
CEqCan's invariants, which can break during zonking. (Example: a ~R alpha, where
we have alpha := N Int, where N is a newtype.) Besides, the constraint
will be canonicalised again, so there is little benefit in keeping the
CEqCan structure.

NB: Constraints are always rewritten etc by the canonicaliser in
GHC.Tc.Solver.Solve.solveCt even if they come in as CDictCan. Only canonical
constraints that are actually in the inert set carry all the guarantees. So it
is okay if zonkCt creates e.g. a CDictCan where the cc_tyars are /not/ fully
reduced.
-}</span><span>
</span><span id="line-475"></span><span>
</span><span id="line-476"></span><span class="annot"><a href="GHC.Tc.Zonk.TcType.html#zonkCt"><span class="hs-identifier hs-type">zonkCt</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Tc.Types.Constraint.html#Ct"><span class="hs-identifier hs-type">Ct</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Zonk.Monad.html#ZonkM"><span class="hs-identifier hs-type">ZonkM</span></a></span><span> </span><span class="annot"><a href="GHC.Tc.Types.Constraint.html#Ct"><span class="hs-identifier hs-type">Ct</span></a></span><span>
</span><span id="line-477"></span><span class="hs-comment">-- See Note [zonkCt behaviour]</span><span>
</span><span id="line-478"></span><span id="zonkCt"><span class="annot"><span class="annottext">zonkCt :: Ct -&gt; ZonkM Ct
</span><a href="GHC.Tc.Zonk.TcType.html#zonkCt"><span class="hs-identifier hs-var hs-var">zonkCt</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Tc.Types.Constraint.html#CDictCan"><span class="hs-identifier hs-type">CDictCan</span></a></span><span> </span><span id="local-6989586621682915338"><span class="annot"><span class="annottext">dict :: DictCt
</span><a href="#local-6989586621682915338"><span class="hs-identifier hs-var">dict</span></a></span></span><span class="hs-glyph">@</span><span class="hs-special">(</span><span class="annot"><a href="GHC.Tc.Types.Constraint.html#DictCt"><span class="hs-identifier hs-type">DictCt</span></a></span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">di_ev :: DictCt -&gt; CtEvidence
</span><a href="GHC.Tc.Types.Constraint.html#di_ev"><span class="hs-identifier hs-var">di_ev</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="local-6989586621682915341"><span class="annot"><span class="annottext">CtEvidence
</span><a href="#local-6989586621682915341"><span class="hs-identifier hs-var">ev</span></a></span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">di_tys :: DictCt -&gt; [Type]
</span><a href="GHC.Tc.Types.Constraint.html#di_tys"><span class="hs-identifier hs-var">di_tys</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="local-6989586621682915343"><span class="annot"><span class="annottext">[Type]
</span><a href="#local-6989586621682915343"><span class="hs-identifier hs-var">args</span></a></span></span><span> </span><span class="hs-special">}</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-479"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span id="local-6989586621682915344"><span class="annot"><a href="#local-6989586621682915344"><span class="hs-identifier hs-var">ev'</span></a></span></span><span>   </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">CtEvidence -&gt; ZonkM CtEvidence
</span><a href="GHC.Tc.Zonk.TcType.html#zonkCtEvidence"><span class="hs-identifier hs-var">zonkCtEvidence</span></a></span><span> </span><span class="annot"><span class="annottext">CtEvidence
</span><a href="#local-6989586621682915341"><span class="hs-identifier hs-var">ev</span></a></span><span>
</span><span id="line-480"></span><span>       </span><span class="hs-special">;</span><span> </span><span id="local-6989586621682915346"><span class="annot"><a href="#local-6989586621682915346"><span class="hs-identifier hs-var">args'</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="hs-identifier hs-type">mapM</span></span><span> </span><span class="annot"><a href="GHC.Tc.Zonk.TcType.html#zonkTcType"><span class="hs-identifier hs-type">zonkTcType</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682915343"><span class="hs-identifier hs-type">args</span></a></span><span>
</span><span id="line-481"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">return</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Tc.Types.Constraint.html#CDictCan"><span class="hs-identifier hs-type">CDictCan</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621682915338"><span class="hs-identifier hs-type">dict</span></a></span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><a href="GHC.Tc.Types.Constraint.html#di_ev"><span class="hs-identifier hs-var">di_ev</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="#local-6989586621682915344"><span class="hs-identifier hs-type">ev'</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Tc.Types.Constraint.html#di_tys"><span class="hs-identifier hs-var">di_tys</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="#local-6989586621682915346"><span class="hs-identifier hs-type">args'</span></a></span><span> </span><span class="hs-special">}</span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-482"></span><span>
</span><span id="line-483"></span><span class="annot"><a href="GHC.Tc.Zonk.TcType.html#zonkCt"><span class="hs-identifier hs-var">zonkCt</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Tc.Types.Constraint.html#CEqCan"><span class="hs-identifier hs-type">CEqCan</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Tc.Types.Constraint.html#EqCt"><span class="hs-identifier hs-type">EqCt</span></a></span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">eq_ev :: EqCt -&gt; CtEvidence
</span><a href="GHC.Tc.Types.Constraint.html#eq_ev"><span class="hs-identifier hs-var">eq_ev</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="local-6989586621682915350"><span class="annot"><span class="annottext">CtEvidence
</span><a href="#local-6989586621682915350"><span class="hs-identifier hs-var">ev</span></a></span></span><span> </span><span class="hs-special">}</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-484"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">CtEvidence -&gt; Ct
</span><a href="GHC.Tc.Types.Constraint.html#mkNonCanonical"><span class="hs-identifier hs-var">mkNonCanonical</span></a></span><span> </span><span class="annot"><span class="annottext">(CtEvidence -&gt; Ct) -&gt; ZonkM CtEvidence -&gt; ZonkM Ct
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="annot"><span class="annottext">CtEvidence -&gt; ZonkM CtEvidence
</span><a href="GHC.Tc.Zonk.TcType.html#zonkCtEvidence"><span class="hs-identifier hs-var">zonkCtEvidence</span></a></span><span> </span><span class="annot"><span class="annottext">CtEvidence
</span><a href="#local-6989586621682915350"><span class="hs-identifier hs-var">ev</span></a></span><span>
</span><span id="line-485"></span><span>
</span><span id="line-486"></span><span class="annot"><a href="GHC.Tc.Zonk.TcType.html#zonkCt"><span class="hs-identifier hs-var">zonkCt</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Tc.Types.Constraint.html#CIrredCan"><span class="hs-identifier hs-type">CIrredCan</span></a></span><span> </span><span id="local-6989586621682915353"><span class="annot"><span class="annottext">ir :: IrredCt
</span><a href="#local-6989586621682915353"><span class="hs-identifier hs-var">ir</span></a></span></span><span class="hs-glyph">@</span><span class="hs-special">(</span><span class="annot"><a href="GHC.Tc.Types.Constraint.html#IrredCt"><span class="hs-identifier hs-type">IrredCt</span></a></span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">ir_ev :: IrredCt -&gt; CtEvidence
</span><a href="GHC.Tc.Types.Constraint.html#ir_ev"><span class="hs-identifier hs-var">ir_ev</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="local-6989586621682915356"><span class="annot"><span class="annottext">CtEvidence
</span><a href="#local-6989586621682915356"><span class="hs-identifier hs-var">ev</span></a></span></span><span> </span><span class="hs-special">}</span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-comment">-- Preserve the ir_reason flag</span><span>
</span><span id="line-487"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span id="local-6989586621682915357"><span class="annot"><a href="#local-6989586621682915357"><span class="hs-identifier hs-var">ev'</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">CtEvidence -&gt; ZonkM CtEvidence
</span><a href="GHC.Tc.Zonk.TcType.html#zonkCtEvidence"><span class="hs-identifier hs-var">zonkCtEvidence</span></a></span><span> </span><span class="annot"><span class="annottext">CtEvidence
</span><a href="#local-6989586621682915356"><span class="hs-identifier hs-var">ev</span></a></span><span>
</span><span id="line-488"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">return</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Tc.Types.Constraint.html#CIrredCan"><span class="hs-identifier hs-type">CIrredCan</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621682915353"><span class="hs-identifier hs-type">ir</span></a></span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><a href="GHC.Tc.Types.Constraint.html#ir_ev"><span class="hs-identifier hs-var">ir_ev</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="#local-6989586621682915357"><span class="hs-identifier hs-type">ev'</span></a></span><span> </span><span class="hs-special">}</span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-489"></span><span>
</span><span id="line-490"></span><span class="annot"><a href="GHC.Tc.Zonk.TcType.html#zonkCt"><span class="hs-identifier hs-var">zonkCt</span></a></span><span> </span><span id="local-6989586621682915358"><span class="annot"><span class="annottext">Ct
</span><a href="#local-6989586621682915358"><span class="hs-identifier hs-var">ct</span></a></span></span><span>
</span><span id="line-491"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span id="local-6989586621682915359"><span class="annot"><a href="#local-6989586621682915359"><span class="hs-identifier hs-var">fl'</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">CtEvidence -&gt; ZonkM CtEvidence
</span><a href="GHC.Tc.Zonk.TcType.html#zonkCtEvidence"><span class="hs-identifier hs-var">zonkCtEvidence</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Ct -&gt; CtEvidence
</span><a href="GHC.Tc.Types.Constraint.html#ctEvidence"><span class="hs-identifier hs-var">ctEvidence</span></a></span><span> </span><span class="annot"><span class="annottext">Ct
</span><a href="#local-6989586621682915358"><span class="hs-identifier hs-var">ct</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-492"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">return</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Tc.Types.Constraint.html#mkNonCanonical"><span class="hs-identifier hs-type">mkNonCanonical</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682915359"><span class="hs-identifier hs-type">fl'</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-493"></span><span>
</span><span id="line-494"></span><span class="annot"><a href="GHC.Tc.Zonk.TcType.html#zonkCtEvidence"><span class="hs-identifier hs-type">zonkCtEvidence</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Tc.Types.Constraint.html#CtEvidence"><span class="hs-identifier hs-type">CtEvidence</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Zonk.Monad.html#ZonkM"><span class="hs-identifier hs-type">ZonkM</span></a></span><span> </span><span class="annot"><a href="GHC.Tc.Types.Constraint.html#CtEvidence"><span class="hs-identifier hs-type">CtEvidence</span></a></span><span>
</span><span id="line-495"></span><span id="zonkCtEvidence"><span class="annot"><span class="annottext">zonkCtEvidence :: CtEvidence -&gt; ZonkM CtEvidence
</span><a href="GHC.Tc.Zonk.TcType.html#zonkCtEvidence"><span class="hs-identifier hs-var hs-var">zonkCtEvidence</span></a></span></span><span> </span><span id="local-6989586621682915361"><span class="annot"><span class="annottext">CtEvidence
</span><a href="#local-6989586621682915361"><span class="hs-identifier hs-var">ctev</span></a></span></span><span>
</span><span id="line-496"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621682915362"><span class="annot"><span class="annottext">pred :: Type
</span><a href="#local-6989586621682915362"><span class="hs-identifier hs-var hs-var hs-var">pred</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">CtEvidence -&gt; Type
</span><a href="GHC.Tc.Types.Constraint.html#ctev_pred"><span class="hs-identifier hs-var">ctev_pred</span></a></span><span> </span><span class="annot"><span class="annottext">CtEvidence
</span><a href="#local-6989586621682915361"><span class="hs-identifier hs-var">ctev</span></a></span><span>
</span><span id="line-497"></span><span>       </span><span class="hs-special">;</span><span> </span><span id="local-6989586621682915364"><span class="annot"><a href="#local-6989586621682915364"><span class="hs-identifier hs-var">pred'</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Type -&gt; ZonkM Type
</span><a href="GHC.Tc.Zonk.TcType.html#zonkTcType"><span class="hs-identifier hs-var">zonkTcType</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682915362"><span class="hs-identifier hs-var">pred</span></a></span><span>
</span><span id="line-498"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">return</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Tc.Types.Constraint.html#setCtEvPredType"><span class="hs-identifier hs-type">setCtEvPredType</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682915361"><span class="hs-identifier hs-type">ctev</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682915364"><span class="hs-identifier hs-type">pred'</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-499"></span><span>
</span><span id="line-500"></span><span class="annot"><a href="GHC.Tc.Zonk.TcType.html#zonkSkolemInfo"><span class="hs-identifier hs-type">zonkSkolemInfo</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Tc.Types.Origin.html#SkolemInfo"><span class="hs-identifier hs-type">SkolemInfo</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Zonk.Monad.html#ZonkM"><span class="hs-identifier hs-type">ZonkM</span></a></span><span> </span><span class="annot"><a href="GHC.Tc.Types.Origin.html#SkolemInfo"><span class="hs-identifier hs-type">SkolemInfo</span></a></span><span>
</span><span id="line-501"></span><span id="zonkSkolemInfo"><span class="annot"><span class="annottext">zonkSkolemInfo :: SkolemInfo -&gt; ZonkM SkolemInfo
</span><a href="GHC.Tc.Zonk.TcType.html#zonkSkolemInfo"><span class="hs-identifier hs-var hs-var">zonkSkolemInfo</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Tc.Types.Origin.html#SkolemInfo"><span class="hs-identifier hs-type">SkolemInfo</span></a></span><span> </span><span id="local-6989586621682915367"><span class="annot"><span class="annottext">Unique
</span><a href="#local-6989586621682915367"><span class="hs-identifier hs-var">u</span></a></span></span><span> </span><span id="local-6989586621682915368"><span class="annot"><span class="annottext">SkolemInfoAnon
</span><a href="#local-6989586621682915368"><span class="hs-identifier hs-var">sk</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Unique -&gt; SkolemInfoAnon -&gt; SkolemInfo
</span><a href="GHC.Tc.Types.Origin.html#SkolemInfo"><span class="hs-identifier hs-var">SkolemInfo</span></a></span><span> </span><span class="annot"><span class="annottext">Unique
</span><a href="#local-6989586621682915367"><span class="hs-identifier hs-var">u</span></a></span><span> </span><span class="annot"><span class="annottext">(SkolemInfoAnon -&gt; SkolemInfo)
-&gt; ZonkM SkolemInfoAnon -&gt; ZonkM SkolemInfo
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="annot"><span class="annottext">SkolemInfoAnon -&gt; ZonkM SkolemInfoAnon
</span><a href="GHC.Tc.Zonk.TcType.html#zonkSkolemInfoAnon"><span class="hs-identifier hs-var">zonkSkolemInfoAnon</span></a></span><span> </span><span class="annot"><span class="annottext">SkolemInfoAnon
</span><a href="#local-6989586621682915368"><span class="hs-identifier hs-var">sk</span></a></span><span>
</span><span id="line-502"></span><span>
</span><span id="line-503"></span><span class="annot"><a href="GHC.Tc.Zonk.TcType.html#zonkSkolemInfoAnon"><span class="hs-identifier hs-type">zonkSkolemInfoAnon</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Tc.Types.Origin.html#SkolemInfoAnon"><span class="hs-identifier hs-type">SkolemInfoAnon</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Zonk.Monad.html#ZonkM"><span class="hs-identifier hs-type">ZonkM</span></a></span><span> </span><span class="annot"><a href="GHC.Tc.Types.Origin.html#SkolemInfoAnon"><span class="hs-identifier hs-type">SkolemInfoAnon</span></a></span><span>
</span><span id="line-504"></span><span id="zonkSkolemInfoAnon"><span class="annot"><span class="annottext">zonkSkolemInfoAnon :: SkolemInfoAnon -&gt; ZonkM SkolemInfoAnon
</span><a href="GHC.Tc.Zonk.TcType.html#zonkSkolemInfoAnon"><span class="hs-identifier hs-var hs-var">zonkSkolemInfoAnon</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Tc.Types.Origin.html#SigSkol"><span class="hs-identifier hs-type">SigSkol</span></a></span><span> </span><span id="local-6989586621682915370"><span class="annot"><span class="annottext">UserTypeCtxt
</span><a href="#local-6989586621682915370"><span class="hs-identifier hs-var">cx</span></a></span></span><span> </span><span id="local-6989586621682915371"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682915371"><span class="hs-identifier hs-var">ty</span></a></span></span><span> </span><span id="local-6989586621682915372"><span class="annot"><span class="annottext">[(Name, CoVar)]
</span><a href="#local-6989586621682915372"><span class="hs-identifier hs-var">tv_prs</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span id="local-6989586621682915373"><span class="annot"><a href="#local-6989586621682915373"><span class="hs-identifier hs-var">ty'</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Type -&gt; ZonkM Type
</span><a href="GHC.Tc.Zonk.TcType.html#zonkTcType"><span class="hs-identifier hs-var">zonkTcType</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682915371"><span class="hs-identifier hs-var">ty</span></a></span><span>
</span><span id="line-505"></span><span>                                               </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">return</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Tc.Types.Origin.html#SigSkol"><span class="hs-identifier hs-type">SigSkol</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682915370"><span class="hs-identifier hs-type">cx</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682915373"><span class="hs-identifier hs-type">ty'</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682915372"><span class="hs-identifier hs-type">tv_prs</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-506"></span><span class="annot"><a href="GHC.Tc.Zonk.TcType.html#zonkSkolemInfoAnon"><span class="hs-identifier hs-var">zonkSkolemInfoAnon</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Tc.Types.Origin.html#InferSkol"><span class="hs-identifier hs-type">InferSkol</span></a></span><span> </span><span id="local-6989586621682915375"><span class="annot"><span class="annottext">[(Name, Type)]
</span><a href="#local-6989586621682915375"><span class="hs-identifier hs-var">ntys</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span id="local-6989586621682915376"><span class="annot"><a href="#local-6989586621682915376"><span class="hs-identifier hs-var">ntys'</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">((Name, Type) -&gt; ZonkM (Name, Type))
-&gt; [(Name, Type)] -&gt; ZonkM [(Name, Type)]
forall (t :: * -&gt; *) (m :: * -&gt; *) a b.
(Traversable t, Monad m) =&gt;
(a -&gt; m b) -&gt; t a -&gt; m (t b)
forall (m :: * -&gt; *) a b. Monad m =&gt; (a -&gt; m b) -&gt; [a] -&gt; m [b]
</span><span class="hs-identifier hs-var">mapM</span></span><span> </span><span class="annot"><span class="annottext">(Name, Type) -&gt; ZonkM (Name, Type)
forall {a}. (a, Type) -&gt; ZonkM (a, Type)
</span><a href="#local-6989586621682915377"><span class="hs-identifier hs-var">do_one</span></a></span><span> </span><span class="annot"><span class="annottext">[(Name, Type)]
</span><a href="#local-6989586621682915375"><span class="hs-identifier hs-var">ntys</span></a></span><span>
</span><span id="line-507"></span><span>                                     </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">return</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Tc.Types.Origin.html#InferSkol"><span class="hs-identifier hs-type">InferSkol</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682915376"><span class="hs-identifier hs-type">ntys'</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-508"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-509"></span><span>    </span><span id="local-6989586621682915377"><span class="annot"><span class="annottext">do_one :: (a, Type) -&gt; ZonkM (a, Type)
</span><a href="#local-6989586621682915377"><span class="hs-identifier hs-var hs-var">do_one</span></a></span></span><span> </span><span class="hs-special">(</span><span id="local-6989586621682915380"><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621682915380"><span class="hs-identifier hs-var">n</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682915381"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682915381"><span class="hs-identifier hs-var">ty</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span id="local-6989586621682915382"><span class="annot"><a href="#local-6989586621682915382"><span class="hs-identifier hs-var">ty'</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Type -&gt; ZonkM Type
</span><a href="GHC.Tc.Zonk.TcType.html#zonkTcType"><span class="hs-identifier hs-var">zonkTcType</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682915381"><span class="hs-identifier hs-var">ty</span></a></span><span class="hs-special">;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">return</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621682915380"><span class="hs-identifier hs-type">n</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="#local-6989586621682915382"><span class="hs-identifier hs-type">ty'</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-510"></span><span class="annot"><a href="GHC.Tc.Zonk.TcType.html#zonkSkolemInfoAnon"><span class="hs-identifier hs-var">zonkSkolemInfoAnon</span></a></span><span> </span><span id="local-6989586621682915383"><span class="annot"><span class="annottext">SkolemInfoAnon
</span><a href="#local-6989586621682915383"><span class="hs-identifier hs-var">skol_info</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">SkolemInfoAnon -&gt; ZonkM SkolemInfoAnon
forall a. a -&gt; ZonkM a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="annot"><span class="annottext">SkolemInfoAnon
</span><a href="#local-6989586621682915383"><span class="hs-identifier hs-var">skol_info</span></a></span><span>
</span><span id="line-511"></span><span>
</span><span id="line-512"></span><span class="hs-comment">{- Note [Sharing in zonking]
~~~~~~~~~~~~~~~~~~~~~~~~~~~~
Suppose we have
   alpha :-&gt; beta :-&gt; gamma :-&gt; ty
where the &quot;:-&gt;&quot; means that the unification variable has been
filled in with Indirect. Then when zonking alpha, it'd be nice
to short-circuit beta too, so we end up with
   alpha :-&gt; zty
   beta  :-&gt; zty
   gamma :-&gt; zty
where zty is the zonked version of ty.  That way, if we come across
beta later, we'll have less work to do.  (And indeed the same for
alpha.)

This is easily achieved: just overwrite (Indirect ty) with (Indirect
zty).  Non-systematic perf comparisons suggest that this is a modest
win.

But c.f Note [Sharing when zonking to Type] in GHC.Tc.Zonk.Type.

%************************************************************************
%*                                                                      *
                 Tidying
*                                                                      *
************************************************************************
-}</span><span>
</span><span id="line-538"></span><span>
</span><span id="line-539"></span><span class="annot"><a href="GHC.Tc.Zonk.TcType.html#tcInitTidyEnv"><span class="hs-identifier hs-type">tcInitTidyEnv</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Tc.Zonk.Monad.html#ZonkM"><span class="hs-identifier hs-type">ZonkM</span></a></span><span> </span><span class="annot"><a href="GHC.Types.Var.Env.html#TidyEnv"><span class="hs-identifier hs-type">TidyEnv</span></a></span><span>
</span><span id="line-540"></span><span class="hs-comment">-- We initialise the &quot;tidy-env&quot;, used for tidying types before printing,</span><span>
</span><span id="line-541"></span><span class="hs-comment">-- by building a reverse map from the in-scope type variables to the</span><span>
</span><span id="line-542"></span><span class="hs-comment">-- OccName that the programmer originally used for them</span><span>
</span><span id="line-543"></span><span id="tcInitTidyEnv"><span class="annot"><span class="annottext">tcInitTidyEnv :: ZonkM TidyEnv
</span><a href="GHC.Tc.Zonk.TcType.html#tcInitTidyEnv"><span class="hs-identifier hs-var hs-var">tcInitTidyEnv</span></a></span></span><span>
</span><span id="line-544"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>  </span><span class="hs-special">{</span><span> </span><span class="annot"><a href="GHC.Tc.Zonk.Monad.html#ZonkGblEnv"><span class="hs-identifier hs-type">ZonkGblEnv</span></a></span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><a href="GHC.Tc.Zonk.Monad.html#zge_binder_stack"><span class="hs-identifier hs-var">zge_binder_stack</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="local-6989586621682915385"><span class="annot"><a href="#local-6989586621682915385"><span class="hs-identifier hs-var">bndrs</span></a></span></span><span> </span><span class="hs-special">}</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">ZonkM ZonkGblEnv
</span><a href="GHC.Tc.Zonk.Monad.html#getZonkGblEnv"><span class="hs-identifier hs-var">getZonkGblEnv</span></a></span><span>
</span><span id="line-545"></span><span>        </span><span class="hs-special">;</span><span> </span><span class="annot"><a href="#local-6989586621682915387"><span class="hs-identifier hs-type">go</span></a></span><span> </span><span class="annot"><a href="GHC.Types.Var.Env.html#emptyTidyEnv"><span class="hs-identifier hs-type">emptyTidyEnv</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682915385"><span class="hs-identifier hs-type">bndrs</span></a></span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-546"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-547"></span><span>    </span><span id="local-6989586621682915387"><span class="annot"><span class="annottext">go :: TidyEnv -&gt; TcBinderStack -&gt; ZonkM TidyEnv
</span><a href="#local-6989586621682915387"><span class="hs-identifier hs-var hs-var">go</span></a></span></span><span> </span><span class="hs-special">(</span><span id="local-6989586621682915392"><span class="annot"><span class="annottext">TidyOccEnv
</span><a href="#local-6989586621682915392"><span class="hs-identifier hs-var">env</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682915393"><span class="annot"><span class="annottext">VarEnv CoVar
</span><a href="#local-6989586621682915393"><span class="hs-identifier hs-var">subst</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span>
</span><span id="line-548"></span><span>      </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">TidyEnv -&gt; ZonkM TidyEnv
forall a. a -&gt; ZonkM a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TidyOccEnv
</span><a href="#local-6989586621682915392"><span class="hs-identifier hs-var">env</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">VarEnv CoVar
</span><a href="#local-6989586621682915393"><span class="hs-identifier hs-var">subst</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-549"></span><span>    </span><span class="annot"><a href="#local-6989586621682915387"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="hs-special">(</span><span id="local-6989586621682915394"><span class="annot"><span class="annottext">TidyOccEnv
</span><a href="#local-6989586621682915394"><span class="hs-identifier hs-var">env</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682915395"><span class="annot"><span class="annottext">VarEnv CoVar
</span><a href="#local-6989586621682915395"><span class="hs-identifier hs-var">subst</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span id="local-6989586621682915396"><span class="annot"><span class="annottext">TcBinder
</span><a href="#local-6989586621682915396"><span class="hs-identifier hs-var">b</span></a></span></span><span> </span><span class="annot"><span class="hs-glyph hs-type">:</span></span><span> </span><span id="local-6989586621682915397"><span class="annot"><span class="annottext">TcBinderStack
</span><a href="#local-6989586621682915397"><span class="hs-identifier hs-var">bs</span></a></span></span><span class="hs-special">)</span><span>
</span><span id="line-550"></span><span>      </span><span class="hs-glyph">|</span><span> </span><span class="annot"><a href="GHC.Tc.Types.BasicTypes.html#TcTvBndr"><span class="hs-identifier hs-type">TcTvBndr</span></a></span><span> </span><span id="local-6989586621682915399"><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621682915399"><span class="hs-identifier hs-var">name</span></a></span></span><span> </span><span id="local-6989586621682915400"><span class="annot"><span class="annottext">CoVar
</span><a href="#local-6989586621682915400"><span class="hs-identifier hs-var">tyvar</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">TcBinder
</span><a href="#local-6989586621682915396"><span class="hs-identifier hs-var">b</span></a></span><span>
</span><span id="line-551"></span><span>       </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span class="hs-keyword">let</span><span> </span><span class="hs-special">(</span><span id="local-6989586621682915401"><span class="annot"><span class="annottext">TidyOccEnv
</span><a href="#local-6989586621682915401"><span class="hs-identifier hs-var hs-var">env'</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682915402"><span class="annot"><span class="annottext">OccName
</span><a href="#local-6989586621682915402"><span class="hs-identifier hs-var hs-var">occ'</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">TidyOccEnv -&gt; OccName -&gt; (TidyOccEnv, OccName)
</span><a href="GHC.Types.Name.Occurrence.html#tidyOccName"><span class="hs-identifier hs-var">tidyOccName</span></a></span><span> </span><span class="annot"><span class="annottext">TidyOccEnv
</span><a href="#local-6989586621682915394"><span class="hs-identifier hs-var">env</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Name -&gt; OccName
</span><a href="GHC.Types.Name.html#nameOccName"><span class="hs-identifier hs-var">nameOccName</span></a></span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621682915399"><span class="hs-identifier hs-var">name</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-552"></span><span>                  </span><span id="local-6989586621682915405"><span class="annot"><span class="annottext">name' :: Name
</span><a href="#local-6989586621682915405"><span class="hs-identifier hs-var hs-var hs-var">name'</span></a></span></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Name -&gt; OccName -&gt; Name
</span><a href="GHC.Types.Name.html#tidyNameOcc"><span class="hs-identifier hs-var">tidyNameOcc</span></a></span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621682915399"><span class="hs-identifier hs-var">name</span></a></span><span> </span><span class="annot"><span class="annottext">OccName
</span><a href="#local-6989586621682915402"><span class="hs-identifier hs-var">occ'</span></a></span><span>
</span><span id="line-553"></span><span>                  </span><span id="local-6989586621682915407"><span class="annot"><span class="annottext">tyvar1 :: CoVar
</span><a href="#local-6989586621682915407"><span class="hs-identifier hs-var hs-var hs-var">tyvar1</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">CoVar -&gt; Name -&gt; CoVar
</span><a href="GHC.Types.Var.html#setTyVarName"><span class="hs-identifier hs-var">setTyVarName</span></a></span><span> </span><span class="annot"><span class="annottext">CoVar
</span><a href="#local-6989586621682915400"><span class="hs-identifier hs-var">tyvar</span></a></span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621682915405"><span class="hs-identifier hs-var">name'</span></a></span><span>
</span><span id="line-554"></span><span>            </span><span class="hs-special">;</span><span> </span><span id="local-6989586621682915409"><span class="annot"><a href="#local-6989586621682915409"><span class="hs-identifier hs-var">tyvar2</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">HasDebugCallStack =&gt; CoVar -&gt; ZonkM CoVar
CoVar -&gt; ZonkM CoVar
</span><a href="GHC.Tc.Zonk.TcType.html#zonkTcTyVarToTcTyVar"><span class="hs-identifier hs-var">zonkTcTyVarToTcTyVar</span></a></span><span> </span><span class="annot"><span class="annottext">CoVar
</span><a href="#local-6989586621682915407"><span class="hs-identifier hs-var">tyvar1</span></a></span><span>
</span><span id="line-555"></span><span>              </span><span class="hs-comment">-- Be sure to zonk here!  Tidying applies to zonked</span><span>
</span><span id="line-556"></span><span>              </span><span class="hs-comment">-- types, so if we don't zonk we may create an</span><span>
</span><span id="line-557"></span><span>              </span><span class="hs-comment">-- ill-kinded type (#14175)</span><span>
</span><span id="line-558"></span><span>            </span><span class="hs-special">;</span><span> </span><span class="annot"><a href="#local-6989586621682915387"><span class="hs-identifier hs-type">go</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621682915401"><span class="hs-identifier hs-type">env'</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Types.Var.Env.html#extendVarEnv"><span class="hs-identifier hs-type">extendVarEnv</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682915395"><span class="hs-identifier hs-type">subst</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682915400"><span class="hs-identifier hs-type">tyvar</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682915409"><span class="hs-identifier hs-type">tyvar2</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><a href="#local-6989586621682915397"><span class="hs-identifier hs-type">bs</span></a></span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-559"></span><span>      </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">otherwise</span></span><span>
</span><span id="line-560"></span><span>      </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">TidyEnv -&gt; TcBinderStack -&gt; ZonkM TidyEnv
</span><a href="#local-6989586621682915387"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TidyOccEnv
</span><a href="#local-6989586621682915394"><span class="hs-identifier hs-var">env</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">VarEnv CoVar
</span><a href="#local-6989586621682915395"><span class="hs-identifier hs-var">subst</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">TcBinderStack
</span><a href="#local-6989586621682915397"><span class="hs-identifier hs-var">bs</span></a></span><span>
</span><span id="line-561"></span><span>
</span><span id="line-562"></span><span class="hs-comment">-- | Get a 'TidyEnv' that includes mappings for all vars free in the given</span><span>
</span><span id="line-563"></span><span class="hs-comment">-- type. Useful when tidying open types.</span><span>
</span><span id="line-564"></span><span class="annot"><a href="GHC.Tc.Zonk.TcType.html#tcInitOpenTidyEnv"><span class="hs-identifier hs-type">tcInitOpenTidyEnv</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="GHC.Types.Var.html#TyCoVar"><span class="hs-identifier hs-type">TyCoVar</span></a></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Zonk.Monad.html#ZonkM"><span class="hs-identifier hs-type">ZonkM</span></a></span><span> </span><span class="annot"><a href="GHC.Types.Var.Env.html#TidyEnv"><span class="hs-identifier hs-type">TidyEnv</span></a></span><span>
</span><span id="line-565"></span><span id="tcInitOpenTidyEnv"><span class="annot"><span class="annottext">tcInitOpenTidyEnv :: [CoVar] -&gt; ZonkM TidyEnv
</span><a href="GHC.Tc.Zonk.TcType.html#tcInitOpenTidyEnv"><span class="hs-identifier hs-var hs-var">tcInitOpenTidyEnv</span></a></span></span><span> </span><span id="local-6989586621682915411"><span class="annot"><span class="annottext">[CoVar]
</span><a href="#local-6989586621682915411"><span class="hs-identifier hs-var">tvs</span></a></span></span><span>
</span><span id="line-566"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span id="local-6989586621682915412"><span class="annot"><a href="#local-6989586621682915412"><span class="hs-identifier hs-var">env1</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">ZonkM TidyEnv
</span><a href="GHC.Tc.Zonk.TcType.html#tcInitTidyEnv"><span class="hs-identifier hs-var">tcInitTidyEnv</span></a></span><span>
</span><span id="line-567"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">return</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Core.TyCo.Tidy.html#tidyFreeTyCoVars"><span class="hs-identifier hs-type">tidyFreeTyCoVars</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682915412"><span class="hs-identifier hs-type">env1</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682915411"><span class="hs-identifier hs-type">tvs</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-568"></span><span>
</span><span id="line-569"></span><span class="annot"><a href="GHC.Tc.Zonk.TcType.html#zonkTidyTcType"><span class="hs-identifier hs-type">zonkTidyTcType</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Types.Var.Env.html#TidyEnv"><span class="hs-identifier hs-type">TidyEnv</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.TcType.html#TcType"><span class="hs-identifier hs-type">TcType</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Zonk.Monad.html#ZonkM"><span class="hs-identifier hs-type">ZonkM</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Types.Var.Env.html#TidyEnv"><span class="hs-identifier hs-type">TidyEnv</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.TcType.html#TcType"><span class="hs-identifier hs-type">TcType</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-570"></span><span id="zonkTidyTcType"><span class="annot"><span class="annottext">zonkTidyTcType :: TidyEnv -&gt; Type -&gt; ZonkM (TidyEnv, Type)
</span><a href="GHC.Tc.Zonk.TcType.html#zonkTidyTcType"><span class="hs-identifier hs-var hs-var">zonkTidyTcType</span></a></span></span><span> </span><span id="local-6989586621682915414"><span class="annot"><span class="annottext">TidyEnv
</span><a href="#local-6989586621682915414"><span class="hs-identifier hs-var">env</span></a></span></span><span> </span><span id="local-6989586621682915415"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682915415"><span class="hs-identifier hs-var">ty</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span id="local-6989586621682915416"><span class="annot"><a href="#local-6989586621682915416"><span class="hs-identifier hs-var">ty'</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Type -&gt; ZonkM Type
</span><a href="GHC.Tc.Zonk.TcType.html#zonkTcType"><span class="hs-identifier hs-var">zonkTcType</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682915415"><span class="hs-identifier hs-var">ty</span></a></span><span>
</span><span id="line-571"></span><span>                           </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">return</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Core.TyCo.Tidy.html#tidyOpenTypeX"><span class="hs-identifier hs-type">tidyOpenTypeX</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682915414"><span class="hs-identifier hs-type">env</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682915416"><span class="hs-identifier hs-type">ty'</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-572"></span><span>
</span><span id="line-573"></span><span class="annot"><a href="GHC.Tc.Zonk.TcType.html#zonkTidyTcTypes"><span class="hs-identifier hs-type">zonkTidyTcTypes</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Types.Var.Env.html#TidyEnv"><span class="hs-identifier hs-type">TidyEnv</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="GHC.Tc.Utils.TcType.html#TcType"><span class="hs-identifier hs-type">TcType</span></a></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Zonk.Monad.html#ZonkM"><span class="hs-identifier hs-type">ZonkM</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Types.Var.Env.html#TidyEnv"><span class="hs-identifier hs-type">TidyEnv</span></a></span><span class="hs-special">,</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="GHC.Tc.Utils.TcType.html#TcType"><span class="hs-identifier hs-type">TcType</span></a></span><span class="hs-special">]</span><span class="hs-special">)</span><span>
</span><span id="line-574"></span><span id="zonkTidyTcTypes"><span class="annot"><span class="annottext">zonkTidyTcTypes :: TidyEnv -&gt; [Type] -&gt; ZonkM (TidyEnv, [Type])
</span><a href="GHC.Tc.Zonk.TcType.html#zonkTidyTcTypes"><span class="hs-identifier hs-var hs-var">zonkTidyTcTypes</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[Type] -&gt; TidyEnv -&gt; [Type] -&gt; ZonkM (TidyEnv, [Type])
</span><a href="#local-6989586621682915418"><span class="hs-identifier hs-var">zonkTidyTcTypes'</span></a></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span>
</span><span id="line-575"></span><span>  </span><span class="hs-keyword">where</span><span> </span><span id="local-6989586621682915418"><span class="annot"><span class="annottext">zonkTidyTcTypes' :: [Type] -&gt; TidyEnv -&gt; [Type] -&gt; ZonkM (TidyEnv, [Type])
</span><a href="#local-6989586621682915418"><span class="hs-identifier hs-var hs-var">zonkTidyTcTypes'</span></a></span></span><span> </span><span id="local-6989586621682915421"><span class="annot"><span class="annottext">[Type]
</span><a href="#local-6989586621682915421"><span class="hs-identifier hs-var">zs</span></a></span></span><span> </span><span id="local-6989586621682915422"><span class="annot"><span class="annottext">TidyEnv
</span><a href="#local-6989586621682915422"><span class="hs-identifier hs-var">env</span></a></span></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(TidyEnv, [Type]) -&gt; ZonkM (TidyEnv, [Type])
forall a. a -&gt; ZonkM a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TidyEnv
</span><a href="#local-6989586621682915422"><span class="hs-identifier hs-var">env</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">[Type] -&gt; [Type]
forall a. [a] -&gt; [a]
</span><span class="hs-identifier hs-var">reverse</span></span><span> </span><span class="annot"><span class="annottext">[Type]
</span><a href="#local-6989586621682915421"><span class="hs-identifier hs-var">zs</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-576"></span><span>        </span><span class="annot"><a href="#local-6989586621682915418"><span class="hs-identifier hs-var">zonkTidyTcTypes'</span></a></span><span> </span><span id="local-6989586621682915424"><span class="annot"><span class="annottext">[Type]
</span><a href="#local-6989586621682915424"><span class="hs-identifier hs-var">zs</span></a></span></span><span> </span><span id="local-6989586621682915425"><span class="annot"><span class="annottext">TidyEnv
</span><a href="#local-6989586621682915425"><span class="hs-identifier hs-var">env</span></a></span></span><span> </span><span class="hs-special">(</span><span id="local-6989586621682915426"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682915426"><span class="hs-identifier hs-var">ty</span></a></span></span><span class="annot"><span class="hs-glyph hs-type">:</span></span><span id="local-6989586621682915427"><span class="annot"><span class="annottext">[Type]
</span><a href="#local-6989586621682915427"><span class="hs-identifier hs-var">tys</span></a></span></span><span class="hs-special">)</span><span>
</span><span id="line-577"></span><span>          </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span class="hs-special">(</span><span id="local-6989586621682915428"><span class="annot"><a href="#local-6989586621682915428"><span class="hs-identifier hs-var">env'</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682915429"><span class="annot"><a href="#local-6989586621682915429"><span class="hs-identifier hs-var">ty'</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">TidyEnv -&gt; Type -&gt; ZonkM (TidyEnv, Type)
</span><a href="GHC.Tc.Zonk.TcType.html#zonkTidyTcType"><span class="hs-identifier hs-var">zonkTidyTcType</span></a></span><span> </span><span class="annot"><span class="annottext">TidyEnv
</span><a href="#local-6989586621682915425"><span class="hs-identifier hs-var">env</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682915426"><span class="hs-identifier hs-var">ty</span></a></span><span>
</span><span id="line-578"></span><span>               </span><span class="hs-special">;</span><span> </span><span class="annot"><a href="#local-6989586621682915418"><span class="hs-identifier hs-type">zonkTidyTcTypes'</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621682915429"><span class="hs-identifier hs-type">ty'</span></a></span><span class="annot"><span class="hs-glyph hs-type">:</span></span><span class="annot"><a href="#local-6989586621682915424"><span class="hs-identifier hs-type">zs</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><a href="#local-6989586621682915428"><span class="hs-identifier hs-type">env'</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682915427"><span class="hs-identifier hs-type">tys</span></a></span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-579"></span><span>
</span><span id="line-580"></span><span class="annot"><a href="GHC.Tc.Zonk.TcType.html#zonkTidyOrigin"><span class="hs-identifier hs-type">zonkTidyOrigin</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Types.Var.Env.html#TidyEnv"><span class="hs-identifier hs-type">TidyEnv</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.Origin.html#CtOrigin"><span class="hs-identifier hs-type">CtOrigin</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Zonk.Monad.html#ZonkM"><span class="hs-identifier hs-type">ZonkM</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Types.Var.Env.html#TidyEnv"><span class="hs-identifier hs-type">TidyEnv</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Tc.Types.Origin.html#CtOrigin"><span class="hs-identifier hs-type">CtOrigin</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-581"></span><span id="zonkTidyOrigin"><span class="annot"><span class="annottext">zonkTidyOrigin :: TidyEnv -&gt; CtOrigin -&gt; ZonkM (TidyEnv, CtOrigin)
</span><a href="GHC.Tc.Zonk.TcType.html#zonkTidyOrigin"><span class="hs-identifier hs-var hs-var">zonkTidyOrigin</span></a></span></span><span> </span><span id="local-6989586621682915430"><span class="annot"><span class="annottext">TidyEnv
</span><a href="#local-6989586621682915430"><span class="hs-identifier hs-var">env</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Tc.Types.Origin.html#GivenOrigin"><span class="hs-identifier hs-type">GivenOrigin</span></a></span><span> </span><span id="local-6989586621682915432"><span class="annot"><span class="annottext">SkolemInfoAnon
</span><a href="#local-6989586621682915432"><span class="hs-identifier hs-var">skol_info</span></a></span></span><span class="hs-special">)</span><span>
</span><span id="line-582"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span id="local-6989586621682915433"><span class="annot"><a href="#local-6989586621682915433"><span class="hs-identifier hs-var">skol_info1</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">SkolemInfoAnon -&gt; ZonkM SkolemInfoAnon
</span><a href="GHC.Tc.Zonk.TcType.html#zonkSkolemInfoAnon"><span class="hs-identifier hs-var">zonkSkolemInfoAnon</span></a></span><span> </span><span class="annot"><span class="annottext">SkolemInfoAnon
</span><a href="#local-6989586621682915432"><span class="hs-identifier hs-var">skol_info</span></a></span><span>
</span><span id="line-583"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621682915434"><span class="annot"><a href="#local-6989586621682915434"><span class="hs-identifier hs-var hs-var">skol_info2</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">TidyEnv -&gt; SkolemInfoAnon -&gt; SkolemInfoAnon
</span><a href="GHC.Tc.Errors.Ppr.html#tidySkolemInfoAnon"><span class="hs-identifier hs-var">tidySkolemInfoAnon</span></a></span><span> </span><span class="annot"><span class="annottext">TidyEnv
</span><a href="#local-6989586621682915430"><span class="hs-identifier hs-var">env</span></a></span><span> </span><span class="annot"><span class="annottext">SkolemInfoAnon
</span><a href="#local-6989586621682915433"><span class="hs-identifier hs-var">skol_info1</span></a></span><span>
</span><span id="line-584"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">return</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621682915430"><span class="hs-identifier hs-type">env</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Tc.Types.Origin.html#GivenOrigin"><span class="hs-identifier hs-type">GivenOrigin</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682915434"><span class="hs-identifier hs-type">skol_info2</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-585"></span><span class="annot"><a href="GHC.Tc.Zonk.TcType.html#zonkTidyOrigin"><span class="hs-identifier hs-var">zonkTidyOrigin</span></a></span><span> </span><span id="local-6989586621682915436"><span class="annot"><span class="annottext">TidyEnv
</span><a href="#local-6989586621682915436"><span class="hs-identifier hs-var">env</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Tc.Types.Origin.html#GivenSCOrigin"><span class="hs-identifier hs-type">GivenSCOrigin</span></a></span><span> </span><span id="local-6989586621682915438"><span class="annot"><span class="annottext">SkolemInfoAnon
</span><a href="#local-6989586621682915438"><span class="hs-identifier hs-var">skol_info</span></a></span></span><span> </span><span id="local-6989586621682915439"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621682915439"><span class="hs-identifier hs-var">sc_depth</span></a></span></span><span> </span><span id="local-6989586621682915440"><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621682915440"><span class="hs-identifier hs-var">blocked</span></a></span></span><span class="hs-special">)</span><span>
</span><span id="line-586"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span id="local-6989586621682915441"><span class="annot"><a href="#local-6989586621682915441"><span class="hs-identifier hs-var">skol_info1</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">SkolemInfoAnon -&gt; ZonkM SkolemInfoAnon
</span><a href="GHC.Tc.Zonk.TcType.html#zonkSkolemInfoAnon"><span class="hs-identifier hs-var">zonkSkolemInfoAnon</span></a></span><span> </span><span class="annot"><span class="annottext">SkolemInfoAnon
</span><a href="#local-6989586621682915438"><span class="hs-identifier hs-var">skol_info</span></a></span><span>
</span><span id="line-587"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621682915442"><span class="annot"><a href="#local-6989586621682915442"><span class="hs-identifier hs-var hs-var">skol_info2</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">TidyEnv -&gt; SkolemInfoAnon -&gt; SkolemInfoAnon
</span><a href="GHC.Tc.Errors.Ppr.html#tidySkolemInfoAnon"><span class="hs-identifier hs-var">tidySkolemInfoAnon</span></a></span><span> </span><span class="annot"><span class="annottext">TidyEnv
</span><a href="#local-6989586621682915436"><span class="hs-identifier hs-var">env</span></a></span><span> </span><span class="annot"><span class="annottext">SkolemInfoAnon
</span><a href="#local-6989586621682915441"><span class="hs-identifier hs-var">skol_info1</span></a></span><span>
</span><span id="line-588"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">return</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621682915436"><span class="hs-identifier hs-type">env</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Tc.Types.Origin.html#GivenSCOrigin"><span class="hs-identifier hs-type">GivenSCOrigin</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682915442"><span class="hs-identifier hs-type">skol_info2</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682915439"><span class="hs-identifier hs-type">sc_depth</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682915440"><span class="hs-identifier hs-type">blocked</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-589"></span><span class="annot"><a href="GHC.Tc.Zonk.TcType.html#zonkTidyOrigin"><span class="hs-identifier hs-var">zonkTidyOrigin</span></a></span><span> </span><span id="local-6989586621682915443"><span class="annot"><span class="annottext">TidyEnv
</span><a href="#local-6989586621682915443"><span class="hs-identifier hs-var">env</span></a></span></span><span> </span><span id="local-6989586621682915444"><span class="annot"><span class="annottext">orig :: CtOrigin
</span><a href="#local-6989586621682915444"><span class="hs-identifier hs-var">orig</span></a></span></span><span class="hs-glyph">@</span><span class="hs-special">(</span><span class="annot"><a href="GHC.Tc.Types.Origin.html#TypeEqOrigin"><span class="hs-identifier hs-type">TypeEqOrigin</span></a></span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">uo_actual :: CtOrigin -&gt; Type
</span><a href="GHC.Tc.Types.Origin.html#uo_actual"><span class="hs-identifier hs-var">uo_actual</span></a></span><span>   </span><span class="hs-glyph">=</span><span> </span><span id="local-6989586621682915447"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682915447"><span class="hs-identifier hs-var">act</span></a></span></span><span>
</span><span id="line-590"></span><span>                                      </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">uo_expected :: CtOrigin -&gt; Type
</span><a href="GHC.Tc.Types.Origin.html#uo_expected"><span class="hs-identifier hs-var">uo_expected</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="local-6989586621682915449"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682915449"><span class="hs-identifier hs-var">exp</span></a></span></span><span> </span><span class="hs-special">}</span><span class="hs-special">)</span><span>
</span><span id="line-591"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span class="hs-special">(</span><span id="local-6989586621682915450"><span class="annot"><a href="#local-6989586621682915450"><span class="hs-identifier hs-var">env1</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682915451"><span class="annot"><a href="#local-6989586621682915451"><span class="hs-identifier hs-var">act'</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">TidyEnv -&gt; Type -&gt; ZonkM (TidyEnv, Type)
</span><a href="GHC.Tc.Zonk.TcType.html#zonkTidyTcType"><span class="hs-identifier hs-var">zonkTidyTcType</span></a></span><span> </span><span class="annot"><span class="annottext">TidyEnv
</span><a href="#local-6989586621682915443"><span class="hs-identifier hs-var">env</span></a></span><span>  </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682915447"><span class="hs-identifier hs-var">act</span></a></span><span>
</span><span id="line-592"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="hs-special">(</span><span id="local-6989586621682915452"><span class="annot"><a href="#local-6989586621682915452"><span class="hs-identifier hs-var">env2</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682915453"><span class="annot"><a href="#local-6989586621682915453"><span class="hs-identifier hs-var">exp'</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><a href="GHC.Tc.Zonk.TcType.html#zonkTidyTcType"><span class="hs-identifier hs-type">zonkTidyTcType</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682915450"><span class="hs-identifier hs-type">env1</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682915449"><span class="hs-identifier hs-type">exp</span></a></span><span>
</span><span id="line-593"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">return</span></span><span> </span><span class="hs-special">(</span><span> </span><span class="annot"><a href="#local-6989586621682915452"><span class="hs-identifier hs-type">env2</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="#local-6989586621682915444"><span class="hs-identifier hs-type">orig</span></a></span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><a href="GHC.Tc.Types.Origin.html#uo_actual"><span class="hs-identifier hs-var">uo_actual</span></a></span><span>   </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="#local-6989586621682915451"><span class="hs-identifier hs-type">act'</span></a></span><span>
</span><span id="line-594"></span><span>                             </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Tc.Types.Origin.html#uo_expected"><span class="hs-identifier hs-var">uo_expected</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="#local-6989586621682915453"><span class="hs-identifier hs-type">exp'</span></a></span><span> </span><span class="hs-special">}</span><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-595"></span><span class="annot"><a href="GHC.Tc.Zonk.TcType.html#zonkTidyOrigin"><span class="hs-identifier hs-var">zonkTidyOrigin</span></a></span><span> </span><span id="local-6989586621682915454"><span class="annot"><span class="annottext">TidyEnv
</span><a href="#local-6989586621682915454"><span class="hs-identifier hs-var">env</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Tc.Types.Origin.html#KindEqOrigin"><span class="hs-identifier hs-type">KindEqOrigin</span></a></span><span> </span><span id="local-6989586621682915456"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682915456"><span class="hs-identifier hs-var">ty1</span></a></span></span><span> </span><span id="local-6989586621682915457"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682915457"><span class="hs-identifier hs-var">ty2</span></a></span></span><span> </span><span id="local-6989586621682915458"><span class="annot"><span class="annottext">CtOrigin
</span><a href="#local-6989586621682915458"><span class="hs-identifier hs-var">orig</span></a></span></span><span> </span><span id="local-6989586621682915459"><span class="annot"><span class="annottext">Maybe TypeOrKind
</span><a href="#local-6989586621682915459"><span class="hs-identifier hs-var">t_or_k</span></a></span></span><span class="hs-special">)</span><span>
</span><span id="line-596"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span class="hs-special">(</span><span id="local-6989586621682915460"><span class="annot"><a href="#local-6989586621682915460"><span class="hs-identifier hs-var">env1</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682915461"><span class="annot"><a href="#local-6989586621682915461"><span class="hs-identifier hs-var">ty1'</span></a></span></span><span class="hs-special">)</span><span>  </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">TidyEnv -&gt; Type -&gt; ZonkM (TidyEnv, Type)
</span><a href="GHC.Tc.Zonk.TcType.html#zonkTidyTcType"><span class="hs-identifier hs-var">zonkTidyTcType</span></a></span><span> </span><span class="annot"><span class="annottext">TidyEnv
</span><a href="#local-6989586621682915454"><span class="hs-identifier hs-var">env</span></a></span><span>  </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682915456"><span class="hs-identifier hs-var">ty1</span></a></span><span>
</span><span id="line-597"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="hs-special">(</span><span id="local-6989586621682915462"><span class="annot"><a href="#local-6989586621682915462"><span class="hs-identifier hs-var">env2</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682915463"><span class="annot"><a href="#local-6989586621682915463"><span class="hs-identifier hs-var">ty2'</span></a></span></span><span class="hs-special">)</span><span>  </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><a href="GHC.Tc.Zonk.TcType.html#zonkTidyTcType"><span class="hs-identifier hs-type">zonkTidyTcType</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682915460"><span class="hs-identifier hs-type">env1</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682915457"><span class="hs-identifier hs-type">ty2</span></a></span><span>
</span><span id="line-598"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="hs-special">(</span><span id="local-6989586621682915464"><span class="annot"><a href="#local-6989586621682915464"><span class="hs-identifier hs-var">env3</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682915465"><span class="annot"><a href="#local-6989586621682915465"><span class="hs-identifier hs-var">orig'</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><a href="GHC.Tc.Zonk.TcType.html#zonkTidyOrigin"><span class="hs-identifier hs-type">zonkTidyOrigin</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682915462"><span class="hs-identifier hs-type">env2</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682915458"><span class="hs-identifier hs-type">orig</span></a></span><span>
</span><span id="line-599"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">return</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621682915464"><span class="hs-identifier hs-type">env3</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Tc.Types.Origin.html#KindEqOrigin"><span class="hs-identifier hs-type">KindEqOrigin</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682915461"><span class="hs-identifier hs-type">ty1'</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682915463"><span class="hs-identifier hs-type">ty2'</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682915465"><span class="hs-identifier hs-type">orig'</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682915459"><span class="hs-identifier hs-type">t_or_k</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-600"></span><span class="annot"><a href="GHC.Tc.Zonk.TcType.html#zonkTidyOrigin"><span class="hs-identifier hs-var">zonkTidyOrigin</span></a></span><span> </span><span id="local-6989586621682915466"><span class="annot"><span class="annottext">TidyEnv
</span><a href="#local-6989586621682915466"><span class="hs-identifier hs-var">env</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Tc.Types.Origin.html#FunDepOrigin1"><span class="hs-identifier hs-type">FunDepOrigin1</span></a></span><span> </span><span id="local-6989586621682915468"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682915468"><span class="hs-identifier hs-var">p1</span></a></span></span><span> </span><span id="local-6989586621682915469"><span class="annot"><span class="annottext">CtOrigin
</span><a href="#local-6989586621682915469"><span class="hs-identifier hs-var">o1</span></a></span></span><span> </span><span id="local-6989586621682915470"><span class="annot"><span class="annottext">RealSrcSpan
</span><a href="#local-6989586621682915470"><span class="hs-identifier hs-var">l1</span></a></span></span><span> </span><span id="local-6989586621682915471"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682915471"><span class="hs-identifier hs-var">p2</span></a></span></span><span> </span><span id="local-6989586621682915472"><span class="annot"><span class="annottext">CtOrigin
</span><a href="#local-6989586621682915472"><span class="hs-identifier hs-var">o2</span></a></span></span><span> </span><span id="local-6989586621682915473"><span class="annot"><span class="annottext">RealSrcSpan
</span><a href="#local-6989586621682915473"><span class="hs-identifier hs-var">l2</span></a></span></span><span class="hs-special">)</span><span>
</span><span id="line-601"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span class="hs-special">(</span><span id="local-6989586621682915474"><span class="annot"><a href="#local-6989586621682915474"><span class="hs-identifier hs-var">env1</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682915475"><span class="annot"><a href="#local-6989586621682915475"><span class="hs-identifier hs-var">p1'</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">TidyEnv -&gt; Type -&gt; ZonkM (TidyEnv, Type)
</span><a href="GHC.Tc.Zonk.TcType.html#zonkTidyTcType"><span class="hs-identifier hs-var">zonkTidyTcType</span></a></span><span> </span><span class="annot"><span class="annottext">TidyEnv
</span><a href="#local-6989586621682915466"><span class="hs-identifier hs-var">env</span></a></span><span>  </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682915468"><span class="hs-identifier hs-var">p1</span></a></span><span>
</span><span id="line-602"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="hs-special">(</span><span id="local-6989586621682915476"><span class="annot"><a href="#local-6989586621682915476"><span class="hs-identifier hs-var">env2</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682915477"><span class="annot"><a href="#local-6989586621682915477"><span class="hs-identifier hs-var">o1'</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><a href="GHC.Tc.Zonk.TcType.html#zonkTidyOrigin"><span class="hs-identifier hs-type">zonkTidyOrigin</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682915474"><span class="hs-identifier hs-type">env1</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682915469"><span class="hs-identifier hs-type">o1</span></a></span><span>
</span><span id="line-603"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="hs-special">(</span><span id="local-6989586621682915478"><span class="annot"><a href="#local-6989586621682915478"><span class="hs-identifier hs-var">env3</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682915479"><span class="annot"><a href="#local-6989586621682915479"><span class="hs-identifier hs-var">p2'</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><a href="GHC.Tc.Zonk.TcType.html#zonkTidyTcType"><span class="hs-identifier hs-type">zonkTidyTcType</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682915476"><span class="hs-identifier hs-type">env2</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682915471"><span class="hs-identifier hs-type">p2</span></a></span><span>
</span><span id="line-604"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="hs-special">(</span><span id="local-6989586621682915480"><span class="annot"><a href="#local-6989586621682915480"><span class="hs-identifier hs-var">env4</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682915481"><span class="annot"><a href="#local-6989586621682915481"><span class="hs-identifier hs-var">o2'</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><a href="GHC.Tc.Zonk.TcType.html#zonkTidyOrigin"><span class="hs-identifier hs-type">zonkTidyOrigin</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682915478"><span class="hs-identifier hs-type">env3</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682915472"><span class="hs-identifier hs-type">o2</span></a></span><span>
</span><span id="line-605"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">return</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621682915480"><span class="hs-identifier hs-type">env4</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Tc.Types.Origin.html#FunDepOrigin1"><span class="hs-identifier hs-type">FunDepOrigin1</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682915475"><span class="hs-identifier hs-type">p1'</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682915477"><span class="hs-identifier hs-type">o1'</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682915470"><span class="hs-identifier hs-type">l1</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682915479"><span class="hs-identifier hs-type">p2'</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682915481"><span class="hs-identifier hs-type">o2'</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682915473"><span class="hs-identifier hs-type">l2</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-606"></span><span class="annot"><a href="GHC.Tc.Zonk.TcType.html#zonkTidyOrigin"><span class="hs-identifier hs-var">zonkTidyOrigin</span></a></span><span> </span><span id="local-6989586621682915482"><span class="annot"><span class="annottext">TidyEnv
</span><a href="#local-6989586621682915482"><span class="hs-identifier hs-var">env</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Tc.Types.Origin.html#FunDepOrigin2"><span class="hs-identifier hs-type">FunDepOrigin2</span></a></span><span> </span><span id="local-6989586621682915484"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682915484"><span class="hs-identifier hs-var">p1</span></a></span></span><span> </span><span id="local-6989586621682915485"><span class="annot"><span class="annottext">CtOrigin
</span><a href="#local-6989586621682915485"><span class="hs-identifier hs-var">o1</span></a></span></span><span> </span><span id="local-6989586621682915486"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682915486"><span class="hs-identifier hs-var">p2</span></a></span></span><span> </span><span id="local-6989586621682915487"><span class="annot"><span class="annottext">SrcSpan
</span><a href="#local-6989586621682915487"><span class="hs-identifier hs-var">l2</span></a></span></span><span class="hs-special">)</span><span>
</span><span id="line-607"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span class="hs-special">(</span><span id="local-6989586621682915488"><span class="annot"><a href="#local-6989586621682915488"><span class="hs-identifier hs-var">env1</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682915489"><span class="annot"><a href="#local-6989586621682915489"><span class="hs-identifier hs-var">p1'</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">TidyEnv -&gt; Type -&gt; ZonkM (TidyEnv, Type)
</span><a href="GHC.Tc.Zonk.TcType.html#zonkTidyTcType"><span class="hs-identifier hs-var">zonkTidyTcType</span></a></span><span> </span><span class="annot"><span class="annottext">TidyEnv
</span><a href="#local-6989586621682915482"><span class="hs-identifier hs-var">env</span></a></span><span>  </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682915484"><span class="hs-identifier hs-var">p1</span></a></span><span>
</span><span id="line-608"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="hs-special">(</span><span id="local-6989586621682915490"><span class="annot"><a href="#local-6989586621682915490"><span class="hs-identifier hs-var">env2</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682915491"><span class="annot"><a href="#local-6989586621682915491"><span class="hs-identifier hs-var">p2'</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><a href="GHC.Tc.Zonk.TcType.html#zonkTidyTcType"><span class="hs-identifier hs-type">zonkTidyTcType</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682915488"><span class="hs-identifier hs-type">env1</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682915486"><span class="hs-identifier hs-type">p2</span></a></span><span>
</span><span id="line-609"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="hs-special">(</span><span id="local-6989586621682915492"><span class="annot"><a href="#local-6989586621682915492"><span class="hs-identifier hs-var">env3</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682915493"><span class="annot"><a href="#local-6989586621682915493"><span class="hs-identifier hs-var">o1'</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><a href="GHC.Tc.Zonk.TcType.html#zonkTidyOrigin"><span class="hs-identifier hs-type">zonkTidyOrigin</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682915490"><span class="hs-identifier hs-type">env2</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682915485"><span class="hs-identifier hs-type">o1</span></a></span><span>
</span><span id="line-610"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">return</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621682915492"><span class="hs-identifier hs-type">env3</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Tc.Types.Origin.html#FunDepOrigin2"><span class="hs-identifier hs-type">FunDepOrigin2</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682915489"><span class="hs-identifier hs-type">p1'</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682915493"><span class="hs-identifier hs-type">o1'</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682915491"><span class="hs-identifier hs-type">p2'</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682915487"><span class="hs-identifier hs-type">l2</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-611"></span><span class="annot"><a href="GHC.Tc.Zonk.TcType.html#zonkTidyOrigin"><span class="hs-identifier hs-var">zonkTidyOrigin</span></a></span><span> </span><span id="local-6989586621682915494"><span class="annot"><span class="annottext">TidyEnv
</span><a href="#local-6989586621682915494"><span class="hs-identifier hs-var">env</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Tc.Types.Origin.html#InjTFOrigin1"><span class="hs-identifier hs-type">InjTFOrigin1</span></a></span><span> </span><span id="local-6989586621682915496"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682915496"><span class="hs-identifier hs-var">pred1</span></a></span></span><span> </span><span id="local-6989586621682915497"><span class="annot"><span class="annottext">CtOrigin
</span><a href="#local-6989586621682915497"><span class="hs-identifier hs-var">orig1</span></a></span></span><span> </span><span id="local-6989586621682915498"><span class="annot"><span class="annottext">RealSrcSpan
</span><a href="#local-6989586621682915498"><span class="hs-identifier hs-var">loc1</span></a></span></span><span> </span><span id="local-6989586621682915499"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682915499"><span class="hs-identifier hs-var">pred2</span></a></span></span><span> </span><span id="local-6989586621682915500"><span class="annot"><span class="annottext">CtOrigin
</span><a href="#local-6989586621682915500"><span class="hs-identifier hs-var">orig2</span></a></span></span><span> </span><span id="local-6989586621682915501"><span class="annot"><span class="annottext">RealSrcSpan
</span><a href="#local-6989586621682915501"><span class="hs-identifier hs-var">loc2</span></a></span></span><span class="hs-special">)</span><span>
</span><span id="line-612"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span class="hs-special">(</span><span id="local-6989586621682915502"><span class="annot"><a href="#local-6989586621682915502"><span class="hs-identifier hs-var">env1</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682915503"><span class="annot"><a href="#local-6989586621682915503"><span class="hs-identifier hs-var">pred1'</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">TidyEnv -&gt; Type -&gt; ZonkM (TidyEnv, Type)
</span><a href="GHC.Tc.Zonk.TcType.html#zonkTidyTcType"><span class="hs-identifier hs-var">zonkTidyTcType</span></a></span><span> </span><span class="annot"><span class="annottext">TidyEnv
</span><a href="#local-6989586621682915494"><span class="hs-identifier hs-var">env</span></a></span><span>  </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682915496"><span class="hs-identifier hs-var">pred1</span></a></span><span>
</span><span id="line-613"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="hs-special">(</span><span id="local-6989586621682915504"><span class="annot"><a href="#local-6989586621682915504"><span class="hs-identifier hs-var">env2</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682915505"><span class="annot"><a href="#local-6989586621682915505"><span class="hs-identifier hs-var">orig1'</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><a href="GHC.Tc.Zonk.TcType.html#zonkTidyOrigin"><span class="hs-identifier hs-type">zonkTidyOrigin</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682915502"><span class="hs-identifier hs-type">env1</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682915497"><span class="hs-identifier hs-type">orig1</span></a></span><span>
</span><span id="line-614"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="hs-special">(</span><span id="local-6989586621682915506"><span class="annot"><a href="#local-6989586621682915506"><span class="hs-identifier hs-var">env3</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682915507"><span class="annot"><a href="#local-6989586621682915507"><span class="hs-identifier hs-var">pred2'</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><a href="GHC.Tc.Zonk.TcType.html#zonkTidyTcType"><span class="hs-identifier hs-type">zonkTidyTcType</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682915504"><span class="hs-identifier hs-type">env2</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682915499"><span class="hs-identifier hs-type">pred2</span></a></span><span>
</span><span id="line-615"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="hs-special">(</span><span id="local-6989586621682915508"><span class="annot"><a href="#local-6989586621682915508"><span class="hs-identifier hs-var">env4</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682915509"><span class="annot"><a href="#local-6989586621682915509"><span class="hs-identifier hs-var">orig2'</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><a href="GHC.Tc.Zonk.TcType.html#zonkTidyOrigin"><span class="hs-identifier hs-type">zonkTidyOrigin</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682915506"><span class="hs-identifier hs-type">env3</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682915500"><span class="hs-identifier hs-type">orig2</span></a></span><span>
</span><span id="line-616"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">return</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621682915508"><span class="hs-identifier hs-type">env4</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Tc.Types.Origin.html#InjTFOrigin1"><span class="hs-identifier hs-type">InjTFOrigin1</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682915503"><span class="hs-identifier hs-type">pred1'</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682915505"><span class="hs-identifier hs-type">orig1'</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682915498"><span class="hs-identifier hs-type">loc1</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682915507"><span class="hs-identifier hs-type">pred2'</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682915509"><span class="hs-identifier hs-type">orig2'</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682915501"><span class="hs-identifier hs-type">loc2</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-617"></span><span class="annot"><a href="GHC.Tc.Zonk.TcType.html#zonkTidyOrigin"><span class="hs-identifier hs-var">zonkTidyOrigin</span></a></span><span> </span><span id="local-6989586621682915510"><span class="annot"><span class="annottext">TidyEnv
</span><a href="#local-6989586621682915510"><span class="hs-identifier hs-var">env</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Tc.Types.Origin.html#CycleBreakerOrigin"><span class="hs-identifier hs-type">CycleBreakerOrigin</span></a></span><span> </span><span id="local-6989586621682915512"><span class="annot"><span class="annottext">CtOrigin
</span><a href="#local-6989586621682915512"><span class="hs-identifier hs-var">orig</span></a></span></span><span class="hs-special">)</span><span>
</span><span id="line-618"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span class="hs-special">(</span><span id="local-6989586621682915513"><span class="annot"><a href="#local-6989586621682915513"><span class="hs-identifier hs-var">env1</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682915514"><span class="annot"><a href="#local-6989586621682915514"><span class="hs-identifier hs-var">orig'</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">TidyEnv -&gt; CtOrigin -&gt; ZonkM (TidyEnv, CtOrigin)
</span><a href="GHC.Tc.Zonk.TcType.html#zonkTidyOrigin"><span class="hs-identifier hs-var">zonkTidyOrigin</span></a></span><span> </span><span class="annot"><span class="annottext">TidyEnv
</span><a href="#local-6989586621682915510"><span class="hs-identifier hs-var">env</span></a></span><span> </span><span class="annot"><span class="annottext">CtOrigin
</span><a href="#local-6989586621682915512"><span class="hs-identifier hs-var">orig</span></a></span><span>
</span><span id="line-619"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">return</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621682915513"><span class="hs-identifier hs-type">env1</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Tc.Types.Origin.html#CycleBreakerOrigin"><span class="hs-identifier hs-type">CycleBreakerOrigin</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682915514"><span class="hs-identifier hs-type">orig'</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-620"></span><span class="annot"><a href="GHC.Tc.Zonk.TcType.html#zonkTidyOrigin"><span class="hs-identifier hs-var">zonkTidyOrigin</span></a></span><span> </span><span id="local-6989586621682915515"><span class="annot"><span class="annottext">TidyEnv
</span><a href="#local-6989586621682915515"><span class="hs-identifier hs-var">env</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Tc.Types.Origin.html#InstProvidedOrigin"><span class="hs-identifier hs-type">InstProvidedOrigin</span></a></span><span> </span><span id="local-6989586621682915517"><span class="annot"><span class="annottext">Module
</span><a href="#local-6989586621682915517"><span class="hs-identifier hs-var">mod</span></a></span></span><span> </span><span id="local-6989586621682915518"><span class="annot"><span class="annottext">ClsInst
</span><a href="#local-6989586621682915518"><span class="hs-identifier hs-var">cls_inst</span></a></span></span><span class="hs-special">)</span><span>
</span><span id="line-621"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span class="hs-special">(</span><span id="local-6989586621682915519"><span class="annot"><a href="#local-6989586621682915519"><span class="hs-identifier hs-var">env1</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682915520"><span class="annot"><a href="#local-6989586621682915520"><span class="hs-identifier hs-var">is_tys'</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">(TidyEnv -&gt; Type -&gt; ZonkM (TidyEnv, Type))
-&gt; TidyEnv -&gt; [Type] -&gt; ZonkM (TidyEnv, [Type])
forall (m :: * -&gt; *) (t :: * -&gt; *) acc x y.
(Monad m, Traversable t) =&gt;
(acc -&gt; x -&gt; m (acc, y)) -&gt; acc -&gt; t x -&gt; m (acc, t y)
</span><a href="GHC.Utils.Monad.html#mapAccumLM"><span class="hs-identifier hs-var">mapAccumLM</span></a></span><span> </span><span class="annot"><span class="annottext">TidyEnv -&gt; Type -&gt; ZonkM (TidyEnv, Type)
</span><a href="GHC.Tc.Zonk.TcType.html#zonkTidyTcType"><span class="hs-identifier hs-var">zonkTidyTcType</span></a></span><span> </span><span class="annot"><span class="annottext">TidyEnv
</span><a href="#local-6989586621682915515"><span class="hs-identifier hs-var">env</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ClsInst -&gt; [Type]
</span><a href="GHC.Core.InstEnv.html#is_tys"><span class="hs-identifier hs-var">is_tys</span></a></span><span> </span><span class="annot"><span class="annottext">ClsInst
</span><a href="#local-6989586621682915518"><span class="hs-identifier hs-var">cls_inst</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-622"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">return</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621682915519"><span class="hs-identifier hs-type">env1</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Tc.Types.Origin.html#InstProvidedOrigin"><span class="hs-identifier hs-type">InstProvidedOrigin</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682915517"><span class="hs-identifier hs-type">mod</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621682915518"><span class="hs-identifier hs-type">cls_inst</span></a></span><span> </span><span class="hs-special">{</span><span class="annot"><a href="GHC.Core.InstEnv.html#is_tys"><span class="hs-identifier hs-var">is_tys</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="#local-6989586621682915520"><span class="hs-identifier hs-type">is_tys'</span></a></span><span class="hs-special">}</span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-623"></span><span class="annot"><a href="GHC.Tc.Zonk.TcType.html#zonkTidyOrigin"><span class="hs-identifier hs-var">zonkTidyOrigin</span></a></span><span> </span><span id="local-6989586621682915521"><span class="annot"><span class="annottext">TidyEnv
</span><a href="#local-6989586621682915521"><span class="hs-identifier hs-var">env</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Tc.Types.Origin.html#WantedSuperclassOrigin"><span class="hs-identifier hs-type">WantedSuperclassOrigin</span></a></span><span> </span><span id="local-6989586621682915523"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682915523"><span class="hs-identifier hs-var">pty</span></a></span></span><span> </span><span id="local-6989586621682915524"><span class="annot"><span class="annottext">CtOrigin
</span><a href="#local-6989586621682915524"><span class="hs-identifier hs-var">orig</span></a></span></span><span class="hs-special">)</span><span>
</span><span id="line-624"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span class="hs-special">(</span><span id="local-6989586621682915525"><span class="annot"><a href="#local-6989586621682915525"><span class="hs-identifier hs-var">env1</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682915526"><span class="annot"><a href="#local-6989586621682915526"><span class="hs-identifier hs-var">pty'</span></a></span></span><span class="hs-special">)</span><span>  </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">TidyEnv -&gt; Type -&gt; ZonkM (TidyEnv, Type)
</span><a href="GHC.Tc.Zonk.TcType.html#zonkTidyTcType"><span class="hs-identifier hs-var">zonkTidyTcType</span></a></span><span> </span><span class="annot"><span class="annottext">TidyEnv
</span><a href="#local-6989586621682915521"><span class="hs-identifier hs-var">env</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682915523"><span class="hs-identifier hs-var">pty</span></a></span><span>
</span><span id="line-625"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="hs-special">(</span><span id="local-6989586621682915527"><span class="annot"><a href="#local-6989586621682915527"><span class="hs-identifier hs-var">env2</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682915528"><span class="annot"><a href="#local-6989586621682915528"><span class="hs-identifier hs-var">orig'</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><a href="GHC.Tc.Zonk.TcType.html#zonkTidyOrigin"><span class="hs-identifier hs-type">zonkTidyOrigin</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682915525"><span class="hs-identifier hs-type">env1</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682915524"><span class="hs-identifier hs-type">orig</span></a></span><span>
</span><span id="line-626"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">return</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621682915527"><span class="hs-identifier hs-type">env2</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Tc.Types.Origin.html#WantedSuperclassOrigin"><span class="hs-identifier hs-type">WantedSuperclassOrigin</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682915526"><span class="hs-identifier hs-type">pty'</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682915528"><span class="hs-identifier hs-type">orig'</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-627"></span><span class="annot"><a href="GHC.Tc.Zonk.TcType.html#zonkTidyOrigin"><span class="hs-identifier hs-var">zonkTidyOrigin</span></a></span><span> </span><span id="local-6989586621682915529"><span class="annot"><span class="annottext">TidyEnv
</span><a href="#local-6989586621682915529"><span class="hs-identifier hs-var">env</span></a></span></span><span> </span><span id="local-6989586621682915530"><span class="annot"><span class="annottext">CtOrigin
</span><a href="#local-6989586621682915530"><span class="hs-identifier hs-var">orig</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(TidyEnv, CtOrigin) -&gt; ZonkM (TidyEnv, CtOrigin)
forall a. a -&gt; ZonkM a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TidyEnv
</span><a href="#local-6989586621682915529"><span class="hs-identifier hs-var">env</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">CtOrigin
</span><a href="#local-6989586621682915530"><span class="hs-identifier hs-var">orig</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-628"></span><span>
</span><span id="line-629"></span><span class="annot"><a href="GHC.Tc.Zonk.TcType.html#zonkTidyOrigins"><span class="hs-identifier hs-type">zonkTidyOrigins</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Types.Var.Env.html#TidyEnv"><span class="hs-identifier hs-type">TidyEnv</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="GHC.Tc.Types.Origin.html#CtOrigin"><span class="hs-identifier hs-type">CtOrigin</span></a></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Zonk.Monad.html#ZonkM"><span class="hs-identifier hs-type">ZonkM</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Types.Var.Env.html#TidyEnv"><span class="hs-identifier hs-type">TidyEnv</span></a></span><span class="hs-special">,</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="GHC.Tc.Types.Origin.html#CtOrigin"><span class="hs-identifier hs-type">CtOrigin</span></a></span><span class="hs-special">]</span><span class="hs-special">)</span><span>
</span><span id="line-630"></span><span id="zonkTidyOrigins"><span class="annot"><span class="annottext">zonkTidyOrigins :: TidyEnv -&gt; [CtOrigin] -&gt; ZonkM (TidyEnv, [CtOrigin])
</span><a href="GHC.Tc.Zonk.TcType.html#zonkTidyOrigins"><span class="hs-identifier hs-var hs-var">zonkTidyOrigins</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(TidyEnv -&gt; CtOrigin -&gt; ZonkM (TidyEnv, CtOrigin))
-&gt; TidyEnv -&gt; [CtOrigin] -&gt; ZonkM (TidyEnv, [CtOrigin])
forall (m :: * -&gt; *) (t :: * -&gt; *) acc x y.
(Monad m, Traversable t) =&gt;
(acc -&gt; x -&gt; m (acc, y)) -&gt; acc -&gt; t x -&gt; m (acc, t y)
</span><a href="GHC.Utils.Monad.html#mapAccumLM"><span class="hs-identifier hs-var">mapAccumLM</span></a></span><span> </span><span class="annot"><span class="annottext">TidyEnv -&gt; CtOrigin -&gt; ZonkM (TidyEnv, CtOrigin)
</span><a href="GHC.Tc.Zonk.TcType.html#zonkTidyOrigin"><span class="hs-identifier hs-var">zonkTidyOrigin</span></a></span><span>
</span><span id="line-631"></span><span>
</span><span id="line-632"></span><span class="annot"><a href="GHC.Tc.Zonk.TcType.html#zonkTidyFRRInfos"><span class="hs-identifier hs-type">zonkTidyFRRInfos</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Types.Var.Env.html#TidyEnv"><span class="hs-identifier hs-type">TidyEnv</span></a></span><span>
</span><span id="line-633"></span><span>                 </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="GHC.Tc.Errors.Types.html#FixedRuntimeRepErrorInfo"><span class="hs-identifier hs-type">FixedRuntimeRepErrorInfo</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-634"></span><span>                 </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Zonk.Monad.html#ZonkM"><span class="hs-identifier hs-type">ZonkM</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Types.Var.Env.html#TidyEnv"><span class="hs-identifier hs-type">TidyEnv</span></a></span><span class="hs-special">,</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="GHC.Tc.Errors.Types.html#FixedRuntimeRepErrorInfo"><span class="hs-identifier hs-type">FixedRuntimeRepErrorInfo</span></a></span><span class="hs-special">]</span><span class="hs-special">)</span><span>
</span><span id="line-635"></span><span id="zonkTidyFRRInfos"><span class="annot"><span class="annottext">zonkTidyFRRInfos :: TidyEnv
-&gt; [FixedRuntimeRepErrorInfo]
-&gt; ZonkM (TidyEnv, [FixedRuntimeRepErrorInfo])
</span><a href="GHC.Tc.Zonk.TcType.html#zonkTidyFRRInfos"><span class="hs-identifier hs-var hs-var">zonkTidyFRRInfos</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[FixedRuntimeRepErrorInfo]
-&gt; TidyEnv
-&gt; [FixedRuntimeRepErrorInfo]
-&gt; ZonkM (TidyEnv, [FixedRuntimeRepErrorInfo])
</span><a href="#local-6989586621682915531"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span>
</span><span id="line-636"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-637"></span><span>    </span><span id="local-6989586621682915531"><span class="annot"><span class="annottext">go :: [FixedRuntimeRepErrorInfo]
-&gt; TidyEnv
-&gt; [FixedRuntimeRepErrorInfo]
-&gt; ZonkM (TidyEnv, [FixedRuntimeRepErrorInfo])
</span><a href="#local-6989586621682915531"><span class="hs-identifier hs-var hs-var">go</span></a></span></span><span> </span><span id="local-6989586621682915535"><span class="annot"><span class="annottext">[FixedRuntimeRepErrorInfo]
</span><a href="#local-6989586621682915535"><span class="hs-identifier hs-var">zs</span></a></span></span><span> </span><span id="local-6989586621682915536"><span class="annot"><span class="annottext">TidyEnv
</span><a href="#local-6989586621682915536"><span class="hs-identifier hs-var">env</span></a></span></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(TidyEnv, [FixedRuntimeRepErrorInfo])
-&gt; ZonkM (TidyEnv, [FixedRuntimeRepErrorInfo])
forall a. a -&gt; ZonkM a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TidyEnv
</span><a href="#local-6989586621682915536"><span class="hs-identifier hs-var">env</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">[FixedRuntimeRepErrorInfo] -&gt; [FixedRuntimeRepErrorInfo]
forall a. [a] -&gt; [a]
</span><span class="hs-identifier hs-var">reverse</span></span><span> </span><span class="annot"><span class="annottext">[FixedRuntimeRepErrorInfo]
</span><a href="#local-6989586621682915535"><span class="hs-identifier hs-var">zs</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-638"></span><span>    </span><span class="annot"><a href="#local-6989586621682915531"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span id="local-6989586621682915537"><span class="annot"><span class="annottext">[FixedRuntimeRepErrorInfo]
</span><a href="#local-6989586621682915537"><span class="hs-identifier hs-var">zs</span></a></span></span><span> </span><span id="local-6989586621682915538"><span class="annot"><span class="annottext">TidyEnv
</span><a href="#local-6989586621682915538"><span class="hs-identifier hs-var">env</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Tc.Errors.Types.html#FRR_Info"><span class="hs-identifier hs-type">FRR_Info</span></a></span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">frr_info_origin :: FixedRuntimeRepErrorInfo -&gt; FixedRuntimeRepOrigin
</span><a href="GHC.Tc.Errors.Types.html#frr_info_origin"><span class="hs-identifier hs-var">frr_info_origin</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="GHC.Tc.Types.Origin.html#FixedRuntimeRepOrigin"><span class="hs-identifier hs-type">FixedRuntimeRepOrigin</span></a></span><span> </span><span id="local-6989586621682915541"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682915541"><span class="hs-identifier hs-var">ty</span></a></span></span><span> </span><span id="local-6989586621682915542"><span class="annot"><span class="annottext">FixedRuntimeRepContext
</span><a href="#local-6989586621682915542"><span class="hs-identifier hs-var">orig</span></a></span></span><span>
</span><span id="line-639"></span><span>                        </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">frr_info_not_concrete :: FixedRuntimeRepErrorInfo -&gt; Maybe (CoVar, Type)
</span><a href="GHC.Tc.Errors.Types.html#frr_info_not_concrete"><span class="hs-identifier hs-var">frr_info_not_concrete</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="local-6989586621682915544"><span class="annot"><span class="annottext">Maybe (CoVar, Type)
</span><a href="#local-6989586621682915544"><span class="hs-identifier hs-var">mb_not_conc</span></a></span></span><span> </span><span class="hs-special">}</span><span> </span><span class="annot"><span class="hs-glyph hs-type">:</span></span><span> </span><span id="local-6989586621682915545"><span class="annot"><span class="annottext">[FixedRuntimeRepErrorInfo]
</span><a href="#local-6989586621682915545"><span class="hs-identifier hs-var">tys</span></a></span></span><span class="hs-special">)</span><span>
</span><span id="line-640"></span><span>      </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span class="hs-special">(</span><span id="local-6989586621682915546"><span class="annot"><a href="#local-6989586621682915546"><span class="hs-identifier hs-var">env</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682915547"><span class="annot"><a href="#local-6989586621682915547"><span class="hs-identifier hs-var">ty</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">TidyEnv -&gt; Type -&gt; ZonkM (TidyEnv, Type)
</span><a href="GHC.Tc.Zonk.TcType.html#zonkTidyTcType"><span class="hs-identifier hs-var">zonkTidyTcType</span></a></span><span> </span><span class="annot"><span class="annottext">TidyEnv
</span><a href="#local-6989586621682915538"><span class="hs-identifier hs-var">env</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682915541"><span class="hs-identifier hs-var">ty</span></a></span><span>
</span><span id="line-641"></span><span>           </span><span class="hs-special">;</span><span> </span><span class="hs-special">(</span><span id="local-6989586621682915548"><span class="annot"><a href="#local-6989586621682915548"><span class="hs-identifier hs-var">env</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682915549"><span class="annot"><a href="#local-6989586621682915549"><span class="hs-identifier hs-var">mb_not_conc</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><a href="#local-6989586621682915550"><span class="hs-identifier hs-type">go_mb_not_conc</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682915546"><span class="hs-identifier hs-type">env</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682915544"><span class="hs-identifier hs-type">mb_not_conc</span></a></span><span>
</span><span id="line-642"></span><span>           </span><span class="hs-special">;</span><span> </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621682915551"><span class="annot"><a href="#local-6989586621682915551"><span class="hs-identifier hs-var hs-var">info</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="GHC.Tc.Errors.Types.html#FRR_Info"><span class="hs-identifier hs-type">FRR_Info</span></a></span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">frr_info_origin :: FixedRuntimeRepOrigin
</span><a href="GHC.Tc.Errors.Types.html#frr_info_origin"><span class="hs-identifier hs-var">frr_info_origin</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Type -&gt; FixedRuntimeRepContext -&gt; FixedRuntimeRepOrigin
</span><a href="GHC.Tc.Types.Origin.html#FixedRuntimeRepOrigin"><span class="hs-identifier hs-var">FixedRuntimeRepOrigin</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682915547"><span class="hs-identifier hs-var">ty</span></a></span><span> </span><span class="annot"><span class="annottext">FixedRuntimeRepContext
</span><a href="#local-6989586621682915542"><span class="hs-identifier hs-var">orig</span></a></span><span>
</span><span id="line-643"></span><span>                                 </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">frr_info_not_concrete :: Maybe (CoVar, Type)
</span><a href="GHC.Tc.Errors.Types.html#frr_info_not_concrete"><span class="hs-identifier hs-var">frr_info_not_concrete</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Maybe (CoVar, Type)
</span><a href="#local-6989586621682915549"><span class="hs-identifier hs-var">mb_not_conc</span></a></span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-644"></span><span>           </span><span class="hs-special">;</span><span> </span><span class="annot"><a href="#local-6989586621682915531"><span class="hs-identifier hs-type">go</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621682915551"><span class="hs-identifier hs-type">info</span></a></span><span class="annot"><span class="hs-glyph hs-type">:</span></span><span class="annot"><a href="#local-6989586621682915537"><span class="hs-identifier hs-type">zs</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><a href="#local-6989586621682915548"><span class="hs-identifier hs-type">env</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682915545"><span class="hs-identifier hs-type">tys</span></a></span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-645"></span><span>
</span><span id="line-646"></span><span>    </span><span id="local-6989586621682915550"><span class="annot"><span class="annottext">go_mb_not_conc :: TidyEnv
-&gt; Maybe (CoVar, Type) -&gt; ZonkM (TidyEnv, Maybe (CoVar, Type))
</span><a href="#local-6989586621682915550"><span class="hs-identifier hs-var hs-var">go_mb_not_conc</span></a></span></span><span> </span><span id="local-6989586621682915557"><span class="annot"><span class="annottext">TidyEnv
</span><a href="#local-6989586621682915557"><span class="hs-identifier hs-var">env</span></a></span></span><span> </span><span class="annot"><span class="annottext">Maybe (CoVar, Type)
</span><span class="hs-identifier hs-var">Nothing</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(TidyEnv, Maybe (CoVar, Type))
-&gt; ZonkM (TidyEnv, Maybe (CoVar, Type))
forall a. a -&gt; ZonkM a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TidyEnv
</span><a href="#local-6989586621682915557"><span class="hs-identifier hs-var">env</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Maybe (CoVar, Type)
forall a. Maybe a
</span><span class="hs-identifier hs-var">Nothing</span></span><span class="hs-special">)</span><span>
</span><span id="line-647"></span><span>    </span><span class="annot"><a href="#local-6989586621682915550"><span class="hs-identifier hs-var">go_mb_not_conc</span></a></span><span> </span><span id="local-6989586621682915558"><span class="annot"><span class="annottext">TidyEnv
</span><a href="#local-6989586621682915558"><span class="hs-identifier hs-var">env</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span class="hs-special">(</span><span id="local-6989586621682915559"><span class="annot"><span class="annottext">CoVar
</span><a href="#local-6989586621682915559"><span class="hs-identifier hs-var">tv</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682915560"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682915560"><span class="hs-identifier hs-var">ty</span></a></span></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-648"></span><span>      </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span class="hs-special">(</span><span id="local-6989586621682915561"><span class="annot"><a href="#local-6989586621682915561"><span class="hs-identifier hs-var">env</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682915562"><span class="annot"><a href="#local-6989586621682915562"><span class="hs-identifier hs-var">tv</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">(TidyEnv, CoVar) -&gt; ZonkM (TidyEnv, CoVar)
forall a. a -&gt; ZonkM a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="annot"><span class="annottext">((TidyEnv, CoVar) -&gt; ZonkM (TidyEnv, CoVar))
-&gt; (TidyEnv, CoVar) -&gt; ZonkM (TidyEnv, CoVar)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">TidyEnv -&gt; CoVar -&gt; (TidyEnv, CoVar)
</span><a href="GHC.Core.TyCo.Tidy.html#tidyFreeTyCoVarX"><span class="hs-identifier hs-var">tidyFreeTyCoVarX</span></a></span><span> </span><span class="annot"><span class="annottext">TidyEnv
</span><a href="#local-6989586621682915558"><span class="hs-identifier hs-var">env</span></a></span><span> </span><span class="annot"><span class="annottext">CoVar
</span><a href="#local-6989586621682915559"><span class="hs-identifier hs-var">tv</span></a></span><span>
</span><span id="line-649"></span><span>           </span><span class="hs-special">;</span><span> </span><span class="hs-special">(</span><span id="local-6989586621682915564"><span class="annot"><a href="#local-6989586621682915564"><span class="hs-identifier hs-var">env</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682915565"><span class="annot"><a href="#local-6989586621682915565"><span class="hs-identifier hs-var">ty</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><a href="GHC.Tc.Zonk.TcType.html#zonkTidyTcType"><span class="hs-identifier hs-type">zonkTidyTcType</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682915561"><span class="hs-identifier hs-type">env</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682915560"><span class="hs-identifier hs-type">ty</span></a></span><span>
</span><span id="line-650"></span><span>           </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">return</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621682915564"><span class="hs-identifier hs-type">env</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621682915562"><span class="hs-identifier hs-type">tv</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="#local-6989586621682915565"><span class="hs-identifier hs-type">ty</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-651"></span><span>
</span><span id="line-652"></span><span class="hs-comment">----------------</span><span>
</span><span id="line-653"></span><span class="annot"><a href="GHC.Tc.Zonk.TcType.html#tidyCt"><span class="hs-identifier hs-type">tidyCt</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Types.Var.Env.html#TidyEnv"><span class="hs-identifier hs-type">TidyEnv</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.Constraint.html#Ct"><span class="hs-identifier hs-type">Ct</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.Constraint.html#Ct"><span class="hs-identifier hs-type">Ct</span></a></span><span>
</span><span id="line-654"></span><span class="hs-comment">-- Used only in error reporting</span><span>
</span><span id="line-655"></span><span id="tidyCt"><span class="annot"><span class="annottext">tidyCt :: TidyEnv -&gt; Ct -&gt; Ct
</span><a href="GHC.Tc.Zonk.TcType.html#tidyCt"><span class="hs-identifier hs-var hs-var">tidyCt</span></a></span></span><span> </span><span id="local-6989586621682915566"><span class="annot"><span class="annottext">TidyEnv
</span><a href="#local-6989586621682915566"><span class="hs-identifier hs-var">env</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(CtEvidence -&gt; CtEvidence) -&gt; Ct -&gt; Ct
</span><a href="GHC.Tc.Types.Constraint.html#updCtEvidence"><span class="hs-identifier hs-var">updCtEvidence</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TidyEnv -&gt; CtEvidence -&gt; CtEvidence
</span><a href="GHC.Tc.Zonk.TcType.html#tidyCtEvidence"><span class="hs-identifier hs-var">tidyCtEvidence</span></a></span><span> </span><span class="annot"><span class="annottext">TidyEnv
</span><a href="#local-6989586621682915566"><span class="hs-identifier hs-var">env</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-656"></span><span>
</span><span id="line-657"></span><span class="annot"><a href="GHC.Tc.Zonk.TcType.html#tidyCtEvidence"><span class="hs-identifier hs-type">tidyCtEvidence</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Types.Var.Env.html#TidyEnv"><span class="hs-identifier hs-type">TidyEnv</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.Constraint.html#CtEvidence"><span class="hs-identifier hs-type">CtEvidence</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.Constraint.html#CtEvidence"><span class="hs-identifier hs-type">CtEvidence</span></a></span><span>
</span><span id="line-658"></span><span>     </span><span class="hs-comment">-- NB: we do not tidy the ctev_evar field because we don't</span><span>
</span><span id="line-659"></span><span>     </span><span class="hs-comment">--     show it in error messages</span><span>
</span><span id="line-660"></span><span id="tidyCtEvidence"><span class="annot"><span class="annottext">tidyCtEvidence :: TidyEnv -&gt; CtEvidence -&gt; CtEvidence
</span><a href="GHC.Tc.Zonk.TcType.html#tidyCtEvidence"><span class="hs-identifier hs-var hs-var">tidyCtEvidence</span></a></span></span><span> </span><span id="local-6989586621682915569"><span class="annot"><span class="annottext">TidyEnv
</span><a href="#local-6989586621682915569"><span class="hs-identifier hs-var">env</span></a></span></span><span> </span><span id="local-6989586621682915570"><span class="annot"><span class="annottext">CtEvidence
</span><a href="#local-6989586621682915570"><span class="hs-identifier hs-var">ctev</span></a></span></span><span>
</span><span id="line-661"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">CtEvidence
</span><a href="#local-6989586621682915570"><span class="hs-identifier hs-var">ctev</span></a></span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><a href="GHC.Tc.Types.Constraint.html#ctev_pred"><span class="hs-identifier hs-var">ctev_pred</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="GHC.Core.TyCo.Tidy.html#tidyOpenType"><span class="hs-identifier hs-type">tidyOpenType</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682915569"><span class="hs-identifier hs-type">env</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="annot"><a href="GHC.Tc.Types.Constraint.html#ctev_pred"><span class="hs-identifier hs-var">ctev_pred</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682915570"><span class="hs-identifier hs-type">ctev</span></a></span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-662"></span><span>  </span><span class="hs-comment">-- tidyOpenType: for (beta ~ (forall a. a-&gt;a), don't gratuitously</span><span>
</span><span id="line-663"></span><span>  </span><span class="hs-comment">-- rename the 'forall a' just because of an 'a' in scope somewhere</span><span>
</span><span id="line-664"></span><span>  </span><span class="hs-comment">-- else entirely.</span><span>
</span><span id="line-665"></span><span>
</span><span id="line-666"></span><span class="annot"><a href="GHC.Tc.Zonk.TcType.html#tidyHole"><span class="hs-identifier hs-type">tidyHole</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Types.Var.Env.html#TidyEnv"><span class="hs-identifier hs-type">TidyEnv</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.Constraint.html#Hole"><span class="hs-identifier hs-type">Hole</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.Constraint.html#Hole"><span class="hs-identifier hs-type">Hole</span></a></span><span>
</span><span id="line-667"></span><span id="tidyHole"><span class="annot"><span class="annottext">tidyHole :: TidyEnv -&gt; Hole -&gt; Hole
</span><a href="GHC.Tc.Zonk.TcType.html#tidyHole"><span class="hs-identifier hs-var hs-var">tidyHole</span></a></span></span><span> </span><span id="local-6989586621682915573"><span class="annot"><span class="annottext">TidyEnv
</span><a href="#local-6989586621682915573"><span class="hs-identifier hs-var">env</span></a></span></span><span> </span><span id="local-6989586621682915574"><span class="annot"><span class="annottext">h :: Hole
</span><a href="#local-6989586621682915574"><span class="hs-identifier hs-var">h</span></a></span></span><span class="hs-glyph">@</span><span class="hs-special">(</span><span class="annot"><a href="GHC.Tc.Types.Constraint.html#Hole"><span class="hs-identifier hs-type">Hole</span></a></span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">hole_ty :: Hole -&gt; Type
</span><a href="GHC.Tc.Types.Constraint.html#hole_ty"><span class="hs-identifier hs-var">hole_ty</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="local-6989586621682915575"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682915575"><span class="hs-identifier hs-var">ty</span></a></span></span><span> </span><span class="hs-special">}</span><span class="hs-special">)</span><span>
</span><span id="line-668"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Hole
</span><a href="#local-6989586621682915574"><span class="hs-identifier hs-var">h</span></a></span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><a href="GHC.Tc.Types.Constraint.html#hole_ty"><span class="hs-identifier hs-var">hole_ty</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="GHC.Core.TyCo.Tidy.html#tidyOpenType"><span class="hs-identifier hs-type">tidyOpenType</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682915573"><span class="hs-identifier hs-type">env</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682915575"><span class="hs-identifier hs-type">ty</span></a></span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-669"></span><span>  </span><span class="hs-comment">-- tidyOpenType: for, say, (b -&gt; (forall a. a-&gt;a)), don't gratuitously</span><span>
</span><span id="line-670"></span><span>  </span><span class="hs-comment">-- rename the 'forall a' just because of an 'a' in scope somewhere</span><span>
</span><span id="line-671"></span><span>  </span><span class="hs-comment">-- else entirely.</span><span>
</span><span id="line-672"></span><span>
</span><span id="line-673"></span><span class="annot"><a href="GHC.Tc.Zonk.TcType.html#tidyDelayedError"><span class="hs-identifier hs-type">tidyDelayedError</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Types.Var.Env.html#TidyEnv"><span class="hs-identifier hs-type">TidyEnv</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.Constraint.html#DelayedError"><span class="hs-identifier hs-type">DelayedError</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.Constraint.html#DelayedError"><span class="hs-identifier hs-type">DelayedError</span></a></span><span>
</span><span id="line-674"></span><span id="tidyDelayedError"><span class="annot"><span class="annottext">tidyDelayedError :: TidyEnv -&gt; DelayedError -&gt; DelayedError
</span><a href="GHC.Tc.Zonk.TcType.html#tidyDelayedError"><span class="hs-identifier hs-var hs-var">tidyDelayedError</span></a></span></span><span> </span><span id="local-6989586621682915576"><span class="annot"><span class="annottext">TidyEnv
</span><a href="#local-6989586621682915576"><span class="hs-identifier hs-var">env</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Tc.Types.Constraint.html#DE_Hole"><span class="hs-identifier hs-type">DE_Hole</span></a></span><span> </span><span id="local-6989586621682915577"><span class="annot"><span class="annottext">Hole
</span><a href="#local-6989586621682915577"><span class="hs-identifier hs-var">hole</span></a></span></span><span class="hs-special">)</span><span>       </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Hole -&gt; DelayedError
</span><a href="GHC.Tc.Types.Constraint.html#DE_Hole"><span class="hs-identifier hs-var">DE_Hole</span></a></span><span>        </span><span class="annot"><span class="annottext">(Hole -&gt; DelayedError) -&gt; Hole -&gt; DelayedError
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">TidyEnv -&gt; Hole -&gt; Hole
</span><a href="GHC.Tc.Zonk.TcType.html#tidyHole"><span class="hs-identifier hs-var">tidyHole</span></a></span><span> </span><span class="annot"><span class="annottext">TidyEnv
</span><a href="#local-6989586621682915576"><span class="hs-identifier hs-var">env</span></a></span><span> </span><span class="annot"><span class="annottext">Hole
</span><a href="#local-6989586621682915577"><span class="hs-identifier hs-var">hole</span></a></span><span>
</span><span id="line-675"></span><span class="annot"><a href="GHC.Tc.Zonk.TcType.html#tidyDelayedError"><span class="hs-identifier hs-var">tidyDelayedError</span></a></span><span> </span><span id="local-6989586621682915578"><span class="annot"><span class="annottext">TidyEnv
</span><a href="#local-6989586621682915578"><span class="hs-identifier hs-var">env</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Tc.Types.Constraint.html#DE_NotConcrete"><span class="hs-identifier hs-type">DE_NotConcrete</span></a></span><span> </span><span id="local-6989586621682915579"><span class="annot"><span class="annottext">NotConcreteError
</span><a href="#local-6989586621682915579"><span class="hs-identifier hs-var">err</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">NotConcreteError -&gt; DelayedError
</span><a href="GHC.Tc.Types.Constraint.html#DE_NotConcrete"><span class="hs-identifier hs-var">DE_NotConcrete</span></a></span><span> </span><span class="annot"><span class="annottext">(NotConcreteError -&gt; DelayedError)
-&gt; NotConcreteError -&gt; DelayedError
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">TidyEnv -&gt; NotConcreteError -&gt; NotConcreteError
</span><a href="GHC.Tc.Zonk.TcType.html#tidyConcreteError"><span class="hs-identifier hs-var">tidyConcreteError</span></a></span><span> </span><span class="annot"><span class="annottext">TidyEnv
</span><a href="#local-6989586621682915578"><span class="hs-identifier hs-var">env</span></a></span><span> </span><span class="annot"><span class="annottext">NotConcreteError
</span><a href="#local-6989586621682915579"><span class="hs-identifier hs-var">err</span></a></span><span>
</span><span id="line-676"></span><span>
</span><span id="line-677"></span><span class="annot"><a href="GHC.Tc.Zonk.TcType.html#tidyConcreteError"><span class="hs-identifier hs-type">tidyConcreteError</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Types.Var.Env.html#TidyEnv"><span class="hs-identifier hs-type">TidyEnv</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.Constraint.html#NotConcreteError"><span class="hs-identifier hs-type">NotConcreteError</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.Constraint.html#NotConcreteError"><span class="hs-identifier hs-type">NotConcreteError</span></a></span><span>
</span><span id="line-678"></span><span id="tidyConcreteError"><span class="annot"><span class="annottext">tidyConcreteError :: TidyEnv -&gt; NotConcreteError -&gt; NotConcreteError
</span><a href="GHC.Tc.Zonk.TcType.html#tidyConcreteError"><span class="hs-identifier hs-var hs-var">tidyConcreteError</span></a></span></span><span> </span><span id="local-6989586621682915581"><span class="annot"><span class="annottext">TidyEnv
</span><a href="#local-6989586621682915581"><span class="hs-identifier hs-var">env</span></a></span></span><span> </span><span id="local-6989586621682915582"><span class="annot"><span class="annottext">err :: NotConcreteError
</span><a href="#local-6989586621682915582"><span class="hs-identifier hs-var">err</span></a></span></span><span class="hs-glyph">@</span><span class="hs-special">(</span><span class="annot"><a href="GHC.Tc.Types.Constraint.html#NCE_FRR"><span class="hs-identifier hs-type">NCE_FRR</span></a></span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">nce_frr_origin :: NotConcreteError -&gt; FixedRuntimeRepOrigin
</span><a href="GHC.Tc.Types.Constraint.html#nce_frr_origin"><span class="hs-identifier hs-var">nce_frr_origin</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="local-6989586621682915583"><span class="annot"><span class="annottext">FixedRuntimeRepOrigin
</span><a href="#local-6989586621682915583"><span class="hs-identifier hs-var">frr_orig</span></a></span></span><span> </span><span class="hs-special">}</span><span class="hs-special">)</span><span>
</span><span id="line-679"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">NotConcreteError
</span><a href="#local-6989586621682915582"><span class="hs-identifier hs-var">err</span></a></span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><a href="GHC.Tc.Types.Constraint.html#nce_frr_origin"><span class="hs-identifier hs-var">nce_frr_origin</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="GHC.Tc.Zonk.TcType.html#tidyFRROrigin"><span class="hs-identifier hs-type">tidyFRROrigin</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682915581"><span class="hs-identifier hs-type">env</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682915583"><span class="hs-identifier hs-type">frr_orig</span></a></span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-680"></span><span>
</span><span id="line-681"></span><span class="annot"><a href="GHC.Tc.Zonk.TcType.html#tidyFRROrigin"><span class="hs-identifier hs-type">tidyFRROrigin</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Types.Var.Env.html#TidyEnv"><span class="hs-identifier hs-type">TidyEnv</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.Origin.html#FixedRuntimeRepOrigin"><span class="hs-identifier hs-type">FixedRuntimeRepOrigin</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.Origin.html#FixedRuntimeRepOrigin"><span class="hs-identifier hs-type">FixedRuntimeRepOrigin</span></a></span><span>
</span><span id="line-682"></span><span id="tidyFRROrigin"><span class="annot"><span class="annottext">tidyFRROrigin :: TidyEnv -&gt; FixedRuntimeRepOrigin -&gt; FixedRuntimeRepOrigin
</span><a href="GHC.Tc.Zonk.TcType.html#tidyFRROrigin"><span class="hs-identifier hs-var hs-var">tidyFRROrigin</span></a></span></span><span> </span><span id="local-6989586621682915585"><span class="annot"><span class="annottext">TidyEnv
</span><a href="#local-6989586621682915585"><span class="hs-identifier hs-var">env</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Tc.Types.Origin.html#FixedRuntimeRepOrigin"><span class="hs-identifier hs-type">FixedRuntimeRepOrigin</span></a></span><span> </span><span id="local-6989586621682915586"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682915586"><span class="hs-identifier hs-var">ty</span></a></span></span><span> </span><span id="local-6989586621682915587"><span class="annot"><span class="annottext">FixedRuntimeRepContext
</span><a href="#local-6989586621682915587"><span class="hs-identifier hs-var">orig</span></a></span></span><span class="hs-special">)</span><span>
</span><span id="line-683"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Type -&gt; FixedRuntimeRepContext -&gt; FixedRuntimeRepOrigin
</span><a href="GHC.Tc.Types.Origin.html#FixedRuntimeRepOrigin"><span class="hs-identifier hs-var">FixedRuntimeRepOrigin</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TidyEnv -&gt; Type -&gt; Type
</span><a href="GHC.Core.TyCo.Tidy.html#tidyType"><span class="hs-identifier hs-var">tidyType</span></a></span><span> </span><span class="annot"><span class="annottext">TidyEnv
</span><a href="#local-6989586621682915585"><span class="hs-identifier hs-var">env</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682915586"><span class="hs-identifier hs-var">ty</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">FixedRuntimeRepContext
</span><a href="#local-6989586621682915587"><span class="hs-identifier hs-var">orig</span></a></span><span>
</span><span id="line-684"></span><span>  </span><span class="hs-comment">-- No need for tidyOpenType because all the free tyvars are already tidied</span><span>
</span><span id="line-685"></span><span>
</span><span id="line-686"></span><span class="hs-comment">----------------</span><span>
</span><span id="line-687"></span><span class="annot"><a href="GHC.Tc.Zonk.TcType.html#tidyEvVar"><span class="hs-identifier hs-type">tidyEvVar</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Types.Var.Env.html#TidyEnv"><span class="hs-identifier hs-type">TidyEnv</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Types.Var.html#EvVar"><span class="hs-identifier hs-type">EvVar</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Types.Var.html#EvVar"><span class="hs-identifier hs-type">EvVar</span></a></span><span>
</span><span id="line-688"></span><span id="tidyEvVar"><span class="annot"><span class="annottext">tidyEvVar :: TidyEnv -&gt; CoVar -&gt; CoVar
</span><a href="GHC.Tc.Zonk.TcType.html#tidyEvVar"><span class="hs-identifier hs-var hs-var">tidyEvVar</span></a></span></span><span> </span><span id="local-6989586621682915589"><span class="annot"><span class="annottext">TidyEnv
</span><a href="#local-6989586621682915589"><span class="hs-identifier hs-var">env</span></a></span></span><span> </span><span id="local-6989586621682915590"><span class="annot"><span class="annottext">CoVar
</span><a href="#local-6989586621682915590"><span class="hs-identifier hs-var">var</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(Type -&gt; Type) -&gt; CoVar -&gt; CoVar
</span><a href="GHC.Types.Var.html#updateIdTypeAndMult"><span class="hs-identifier hs-var">updateIdTypeAndMult</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TidyEnv -&gt; Type -&gt; Type
</span><a href="GHC.Core.TyCo.Tidy.html#tidyType"><span class="hs-identifier hs-var">tidyType</span></a></span><span> </span><span class="annot"><span class="annottext">TidyEnv
</span><a href="#local-6989586621682915589"><span class="hs-identifier hs-var">env</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">CoVar
</span><a href="#local-6989586621682915590"><span class="hs-identifier hs-var">var</span></a></span><span>
</span><span id="line-689"></span><span>  </span><span class="hs-comment">-- No need for tidyOpenType because all the free tyvars are already tidied</span><span>
</span><span id="line-690"></span></pre></body></html>