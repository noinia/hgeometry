<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><link rel="stylesheet" type="text/css" href="style.css" /><script type="text/javascript" src="highlight.js"></script></head><body><pre><span id="local-6989586621683006002"><span id="local-6989586621683006003"></span></span><span class="hs-pragma">{-# LANGUAGE BinaryLiterals, ScopedTypeVariables #-}</span><span>
</span><span id="line-2"></span><span>
</span><span id="line-3"></span><span class="hs-comment">--</span><span>
</span><span id="line-4"></span><span class="hs-comment">--  (c) The University of Glasgow 2002-2006</span><span>
</span><span id="line-5"></span><span class="hs-comment">--</span><span>
</span><span id="line-6"></span><span>
</span><span id="line-7"></span><span class="hs-pragma">{-# OPTIONS_GHC -O2 #-}</span><span>
</span><span id="line-8"></span><span class="hs-comment">-- We always optimise this, otherwise performance of a non-optimised</span><span>
</span><span id="line-9"></span><span class="hs-comment">-- compiler is severely affected</span><span>
</span><span id="line-10"></span><span>
</span><span id="line-11"></span><span class="annot"><span class="hs-comment">-- | Binary interface file support.</span></span><span>
</span><span id="line-12"></span><span class="hs-keyword">module</span><span> </span><span class="annot"><a href="GHC.Iface.Binary.html"><span class="hs-identifier">GHC.Iface.Binary</span></a></span><span> </span><span class="hs-special">(</span><span>
</span><span id="line-13"></span><span>        </span><span class="annot"><span class="hs-comment">-- * Public API for interface file serialisation</span></span><span>
</span><span id="line-14"></span><span>        </span><span class="annot"><a href="GHC.Iface.Binary.html#writeBinIface"><span class="hs-identifier">writeBinIface</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-15"></span><span>        </span><span class="annot"><a href="GHC.Iface.Binary.html#readBinIface"><span class="hs-identifier">readBinIface</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-16"></span><span>        </span><span class="annot"><a href="GHC.Iface.Binary.html#readBinIfaceHeader"><span class="hs-identifier">readBinIfaceHeader</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-17"></span><span>        </span><span class="annot"><a href="GHC.Iface.Binary.html#CompressionIFace"><span class="hs-identifier">CompressionIFace</span></a></span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span>
</span><span id="line-18"></span><span>        </span><span class="annot"><a href="GHC.Iface.Binary.html#getSymtabName"><span class="hs-identifier">getSymtabName</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-19"></span><span>        </span><span class="annot"><a href="GHC.Iface.Binary.html#CheckHiWay"><span class="hs-identifier">CheckHiWay</span></a></span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span>
</span><span id="line-20"></span><span>        </span><span class="annot"><a href="GHC.Iface.Binary.html#TraceBinIFace"><span class="hs-identifier">TraceBinIFace</span></a></span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span>
</span><span id="line-21"></span><span>        </span><span class="annot"><a href="GHC.Iface.Binary.html#getIfaceWithExtFields"><span class="hs-identifier">getIfaceWithExtFields</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-22"></span><span>        </span><span class="annot"><a href="GHC.Iface.Binary.html#putIfaceWithExtFields"><span class="hs-identifier">putIfaceWithExtFields</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-23"></span><span>        </span><span class="annot"><a href="GHC.Iface.Binary.html#getWithUserData"><span class="hs-identifier">getWithUserData</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-24"></span><span>        </span><span class="annot"><a href="GHC.Iface.Binary.html#putWithUserData"><span class="hs-identifier">putWithUserData</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-25"></span><span>
</span><span id="line-26"></span><span>        </span><span class="annot"><span class="hs-comment">-- * Internal serialisation functions</span></span><span>
</span><span id="line-27"></span><span>        </span><span class="annot"><a href="GHC.Iface.Binary.html#getSymbolTable"><span class="hs-identifier">getSymbolTable</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-28"></span><span>        </span><span class="annot"><a href="GHC.Iface.Binary.html#putName"><span class="hs-identifier">putName</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-29"></span><span>        </span><span class="annot"><a href="GHC.Iface.Binary.html#putSymbolTable"><span class="hs-identifier">putSymbolTable</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-30"></span><span>        </span><span class="annot"><a href="GHC.Iface.Binary.html#BinSymbolTable"><span class="hs-identifier">BinSymbolTable</span></a></span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span>
</span><span id="line-31"></span><span>        </span><span class="annot"><a href="GHC.Iface.Binary.html#initWriteIfaceType"><span class="hs-identifier">initWriteIfaceType</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Iface.Binary.html#initReadIfaceTypeTable"><span class="hs-identifier">initReadIfaceTypeTable</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-32"></span><span>        </span><span class="annot"><a href="GHC.Iface.Binary.html#putAllTables"><span class="hs-identifier">putAllTables</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-33"></span><span>    </span><span class="hs-special">)</span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-34"></span><span>
</span><span id="line-35"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Prelude.html"><span class="hs-identifier">GHC.Prelude</span></a></span><span>
</span><span id="line-36"></span><span>
</span><span id="line-37"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Builtin.Utils.html"><span class="hs-identifier">GHC.Builtin.Utils</span></a></span><span>   </span><span class="hs-special">(</span><span> </span><span class="annot"><a href="GHC.Builtin.Utils.html#isKnownKeyName"><span class="hs-identifier">isKnownKeyName</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Builtin.Utils.html#lookupKnownKeyName"><span class="hs-identifier">lookupKnownKeyName</span></a></span><span> </span><span class="hs-special">)</span><span>
</span><span id="line-38"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Unit.html"><span class="hs-identifier">GHC.Unit</span></a></span><span>
</span><span id="line-39"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Unit.Module.ModIface.html"><span class="hs-identifier">GHC.Unit.Module.ModIface</span></a></span><span>
</span><span id="line-40"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Types.Name.html"><span class="hs-identifier">GHC.Types.Name</span></a></span><span>
</span><span id="line-41"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Platform.Profile.html"><span class="hs-identifier">GHC.Platform.Profile</span></a></span><span>
</span><span id="line-42"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Types.Unique.FM.html"><span class="hs-identifier">GHC.Types.Unique.FM</span></a></span><span>
</span><span id="line-43"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Utils.Panic.html"><span class="hs-identifier">GHC.Utils.Panic</span></a></span><span>
</span><span id="line-44"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Utils.Binary.html"><span class="hs-identifier">GHC.Utils.Binary</span></a></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">Binary</span></span><span>
</span><span id="line-45"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Data.FastMutInt.html"><span class="hs-identifier">GHC.Data.FastMutInt</span></a></span><span>
</span><span id="line-46"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Data.FastString.html"><span class="hs-identifier">GHC.Data.FastString</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Data.FastString.html#FastString"><span class="hs-identifier">FastString</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-47"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Types.Unique.html"><span class="hs-identifier">GHC.Types.Unique</span></a></span><span>
</span><span id="line-48"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Utils.Outputable.html"><span class="hs-identifier">GHC.Utils.Outputable</span></a></span><span>
</span><span id="line-49"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Types.Name.Cache.html"><span class="hs-identifier">GHC.Types.Name.Cache</span></a></span><span>
</span><span id="line-50"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Types.SrcLoc.html"><span class="hs-identifier">GHC.Types.SrcLoc</span></a></span><span>
</span><span id="line-51"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Platform.html"><span class="hs-identifier">GHC.Platform</span></a></span><span>
</span><span id="line-52"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Settings.Constants.html"><span class="hs-identifier">GHC.Settings.Constants</span></a></span><span>
</span><span id="line-53"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Utils.Fingerprint.html"><span class="hs-identifier">GHC.Utils.Fingerprint</span></a></span><span>
</span><span id="line-54"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Iface.Type.html"><span class="hs-identifier">GHC.Iface.Type</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Iface.Type.html#IfaceType"><span class="hs-identifier">IfaceType</span></a></span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Iface.Type.html#getIfaceType"><span class="hs-identifier">getIfaceType</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Iface.Type.html#putIfaceType"><span class="hs-identifier">putIfaceType</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Iface.Type.html#ifaceTypeSharedByte"><span class="hs-identifier">ifaceTypeSharedByte</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-55"></span><span>
</span><span id="line-56"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="../../base-4.21.0.0-ae91/src/Control.Monad.html"><span class="hs-identifier">Control.Monad</span></a></span><span>
</span><span id="line-57"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="../../array-0.5.8.0-9044/src/Data.Array.html"><span class="hs-identifier">Data.Array</span></a></span><span>
</span><span id="line-58"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="../../array-0.5.8.0-9044/src/Data.Array.IO.html"><span class="hs-identifier">Data.Array.IO</span></a></span><span>
</span><span id="line-59"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="../../array-0.5.8.0-9044/src/Data.Array.Unsafe.html"><span class="hs-identifier">Data.Array.Unsafe</span></a></span><span>
</span><span id="line-60"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="../../base-4.21.0.0-ae91/src/Data.Char.html"><span class="hs-identifier">Data.Char</span></a></span><span>
</span><span id="line-61"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="../../base-4.21.0.0-ae91/src/Data.IORef.html"><span class="hs-identifier">Data.IORef</span></a></span><span>
</span><span id="line-62"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="../../containers-0.7-5a8f/src/Data.Map.Strict.html"><span class="hs-identifier">Data.Map.Strict</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../../containers-0.7-5a8f/src/Data.Map.Internal.html#Map"><span class="hs-identifier">Map</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-63"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="../../base-4.21.0.0-ae91/src/Data.Word.html"><span class="hs-identifier">Data.Word</span></a></span><span>
</span><span id="line-64"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="../../base-4.21.0.0-ae91/src/System.IO.Unsafe.html"><span class="hs-identifier">System.IO.Unsafe</span></a></span><span>
</span><span id="line-65"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="../../base-4.21.0.0-ae91/src/Data.Typeable.html"><span class="hs-identifier">Data.Typeable</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">Typeable</span></span><span class="hs-special">)</span><span>
</span><span id="line-66"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><a href="GHC.Data.Strict.html"><span class="hs-identifier">GHC.Data.Strict</span></a></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">Strict</span></span><span>
</span><span id="line-67"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="../../base-4.21.0.0-ae91/src/Data.Function.html"><span class="hs-identifier">Data.Function</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-operator">(&amp;)</span></span><span class="hs-special">)</span><span>
</span><span id="line-68"></span><span>
</span><span id="line-69"></span><span>
</span><span id="line-70"></span><span class="hs-comment">-- ---------------------------------------------------------------------------</span><span>
</span><span id="line-71"></span><span class="hs-comment">-- Reading and writing binary interface files</span><span>
</span><span id="line-72"></span><span class="hs-comment">--</span><span>
</span><span id="line-73"></span><span>
</span><span id="line-74"></span><span class="hs-keyword">data</span><span> </span><span id="CheckHiWay"><span class="annot"><a href="GHC.Iface.Binary.html#CheckHiWay"><span class="hs-identifier hs-var">CheckHiWay</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="CheckHiWay"><span class="annot"><a href="GHC.Iface.Binary.html#CheckHiWay"><span class="hs-identifier hs-var">CheckHiWay</span></a></span></span><span> </span><span class="hs-glyph">|</span><span> </span><span id="IgnoreHiWay"><span class="annot"><a href="GHC.Iface.Binary.html#IgnoreHiWay"><span class="hs-identifier hs-var">IgnoreHiWay</span></a></span></span><span>
</span><span id="line-75"></span><span>    </span><span class="hs-keyword">deriving</span><span> </span><span id="local-6989586621683006270"><span id="local-6989586621683006275"><span class="annot"><span class="annottext">CheckHiWay -&gt; CheckHiWay -&gt; Bool
(CheckHiWay -&gt; CheckHiWay -&gt; Bool)
-&gt; (CheckHiWay -&gt; CheckHiWay -&gt; Bool) -&gt; Eq CheckHiWay
forall a. (a -&gt; a -&gt; Bool) -&gt; (a -&gt; a -&gt; Bool) -&gt; Eq a
$c== :: CheckHiWay -&gt; CheckHiWay -&gt; Bool
== :: CheckHiWay -&gt; CheckHiWay -&gt; Bool
$c/= :: CheckHiWay -&gt; CheckHiWay -&gt; Bool
/= :: CheckHiWay -&gt; CheckHiWay -&gt; Bool
</span><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var hs-var">Eq</span></span></span></span><span>
</span><span id="line-76"></span><span>
</span><span id="line-77"></span><span class="hs-keyword">data</span><span> </span><span id="TraceBinIFace"><span class="annot"><a href="GHC.Iface.Binary.html#TraceBinIFace"><span class="hs-identifier hs-var">TraceBinIFace</span></a></span></span><span>
</span><span id="line-78"></span><span>   </span><span class="hs-glyph">=</span><span> </span><span id="TraceBinIFace"><span class="annot"><a href="GHC.Iface.Binary.html#TraceBinIFace"><span class="hs-identifier hs-var">TraceBinIFace</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Utils.Outputable.html#SDoc"><span class="hs-identifier hs-type">SDoc</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-79"></span><span>   </span><span class="hs-glyph">|</span><span> </span><span id="QuietBinIFace"><span class="annot"><a href="GHC.Iface.Binary.html#QuietBinIFace"><span class="hs-identifier hs-var">QuietBinIFace</span></a></span></span><span>
</span><span id="line-80"></span><span>
</span><span id="line-81"></span><span class="hs-comment">-- | The compression/deduplication level of 'ModIface' files.</span><span>
</span><span id="line-82"></span><span class="hs-comment">--</span><span>
</span><span id="line-83"></span><span class="hs-comment">-- A 'ModIface' contains many duplicated symbols and names. To keep interface</span><span>
</span><span id="line-84"></span><span class="hs-comment">-- files small, we deduplicate them during serialisation.</span><span>
</span><span id="line-85"></span><span class="hs-comment">-- It is impossible to write an interface file with *no* compression/deduplication.</span><span>
</span><span id="line-86"></span><span class="hs-comment">--</span><span>
</span><span id="line-87"></span><span class="hs-comment">-- We support different levels of compression/deduplication, with different</span><span>
</span><span id="line-88"></span><span class="hs-comment">-- trade-offs for run-time performance and memory usage.</span><span>
</span><span id="line-89"></span><span class="hs-comment">-- If you don't have any specific requirements, then 'SafeExtraCompression' is a good default.</span><span>
</span><span id="line-90"></span><span class="hs-keyword">data</span><span> </span><span id="CompressionIFace"><span class="annot"><a href="GHC.Iface.Binary.html#CompressionIFace"><span class="hs-identifier hs-var">CompressionIFace</span></a></span></span><span>
</span><span id="line-91"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span id="NormalCompression"><span class="annot"><a href="GHC.Iface.Binary.html#NormalCompression"><span class="hs-identifier hs-var">NormalCompression</span></a></span></span><span>
</span><span id="line-92"></span><span>  </span><span class="hs-comment">-- ^ Perform the normal compression operations,</span><span>
</span><span id="line-93"></span><span>  </span><span class="hs-comment">-- such as deduplicating 'Name's and 'FastString's</span><span>
</span><span id="line-94"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span id="SafeExtraCompression"><span class="annot"><a href="GHC.Iface.Binary.html#SafeExtraCompression"><span class="hs-identifier hs-var">SafeExtraCompression</span></a></span></span><span>
</span><span id="line-95"></span><span>  </span><span class="hs-comment">-- ^ Perform some extra compression steps that have minimal impact</span><span>
</span><span id="line-96"></span><span>  </span><span class="hs-comment">-- on the run-time of 'ghc'.</span><span>
</span><span id="line-97"></span><span>  </span><span class="hs-comment">--</span><span>
</span><span id="line-98"></span><span>  </span><span class="hs-comment">-- This reduces the size of '.hi' files significantly in some cases</span><span>
</span><span id="line-99"></span><span>  </span><span class="hs-comment">-- and reduces overall memory usage in certain scenarios.</span><span>
</span><span id="line-100"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span id="MaximumCompression"><span class="annot"><a href="GHC.Iface.Binary.html#MaximumCompression"><span class="hs-identifier hs-var">MaximumCompression</span></a></span></span><span>
</span><span id="line-101"></span><span>  </span><span class="hs-comment">-- ^ Try to compress as much as possible.</span><span>
</span><span id="line-102"></span><span>  </span><span class="hs-comment">--</span><span>
</span><span id="line-103"></span><span>  </span><span class="hs-comment">-- Yields the smallest '.hi' files but at the cost of additional run-time.</span><span>
</span><span id="line-104"></span><span>  </span><span class="hs-keyword">deriving</span><span> </span><span class="hs-special">(</span><span id="local-6989586621683006286"><span id="local-6989586621683006288"><span id="local-6989586621683006292"><span class="annot"><span class="annottext">Int -&gt; CompressionIFace -&gt; ShowS
[CompressionIFace] -&gt; ShowS
CompressionIFace -&gt; String
(Int -&gt; CompressionIFace -&gt; ShowS)
-&gt; (CompressionIFace -&gt; String)
-&gt; ([CompressionIFace] -&gt; ShowS)
-&gt; Show CompressionIFace
forall a.
(Int -&gt; a -&gt; ShowS) -&gt; (a -&gt; String) -&gt; ([a] -&gt; ShowS) -&gt; Show a
$cshowsPrec :: Int -&gt; CompressionIFace -&gt; ShowS
showsPrec :: Int -&gt; CompressionIFace -&gt; ShowS
$cshow :: CompressionIFace -&gt; String
show :: CompressionIFace -&gt; String
$cshowList :: [CompressionIFace] -&gt; ShowS
showList :: [CompressionIFace] -&gt; ShowS
</span><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var">Show</span></span></span></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621683006297"><span id="local-6989586621683006301"><span class="annot"><span class="annottext">CompressionIFace -&gt; CompressionIFace -&gt; Bool
(CompressionIFace -&gt; CompressionIFace -&gt; Bool)
-&gt; (CompressionIFace -&gt; CompressionIFace -&gt; Bool)
-&gt; Eq CompressionIFace
forall a. (a -&gt; a -&gt; Bool) -&gt; (a -&gt; a -&gt; Bool) -&gt; Eq a
$c== :: CompressionIFace -&gt; CompressionIFace -&gt; Bool
== :: CompressionIFace -&gt; CompressionIFace -&gt; Bool
$c/= :: CompressionIFace -&gt; CompressionIFace -&gt; Bool
/= :: CompressionIFace -&gt; CompressionIFace -&gt; Bool
</span><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var hs-var">Eq</span></span></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621683006307"><span id="local-6989586621683006311"><span id="local-6989586621683006315"><span id="local-6989586621683006319"><span id="local-6989586621683006322"><span id="local-6989586621683006325"><span id="local-6989586621683006328"><span class="annot"><span class="annottext">Eq CompressionIFace
Eq CompressionIFace =&gt;
(CompressionIFace -&gt; CompressionIFace -&gt; Ordering)
-&gt; (CompressionIFace -&gt; CompressionIFace -&gt; Bool)
-&gt; (CompressionIFace -&gt; CompressionIFace -&gt; Bool)
-&gt; (CompressionIFace -&gt; CompressionIFace -&gt; Bool)
-&gt; (CompressionIFace -&gt; CompressionIFace -&gt; Bool)
-&gt; (CompressionIFace -&gt; CompressionIFace -&gt; CompressionIFace)
-&gt; (CompressionIFace -&gt; CompressionIFace -&gt; CompressionIFace)
-&gt; Ord CompressionIFace
CompressionIFace -&gt; CompressionIFace -&gt; Bool
CompressionIFace -&gt; CompressionIFace -&gt; Ordering
CompressionIFace -&gt; CompressionIFace -&gt; CompressionIFace
forall a.
Eq a =&gt;
(a -&gt; a -&gt; Ordering)
-&gt; (a -&gt; a -&gt; Bool)
-&gt; (a -&gt; a -&gt; Bool)
-&gt; (a -&gt; a -&gt; Bool)
-&gt; (a -&gt; a -&gt; Bool)
-&gt; (a -&gt; a -&gt; a)
-&gt; (a -&gt; a -&gt; a)
-&gt; Ord a
$ccompare :: CompressionIFace -&gt; CompressionIFace -&gt; Ordering
compare :: CompressionIFace -&gt; CompressionIFace -&gt; Ordering
$c&lt; :: CompressionIFace -&gt; CompressionIFace -&gt; Bool
&lt; :: CompressionIFace -&gt; CompressionIFace -&gt; Bool
$c&lt;= :: CompressionIFace -&gt; CompressionIFace -&gt; Bool
&lt;= :: CompressionIFace -&gt; CompressionIFace -&gt; Bool
$c&gt; :: CompressionIFace -&gt; CompressionIFace -&gt; Bool
&gt; :: CompressionIFace -&gt; CompressionIFace -&gt; Bool
$c&gt;= :: CompressionIFace -&gt; CompressionIFace -&gt; Bool
&gt;= :: CompressionIFace -&gt; CompressionIFace -&gt; Bool
$cmax :: CompressionIFace -&gt; CompressionIFace -&gt; CompressionIFace
max :: CompressionIFace -&gt; CompressionIFace -&gt; CompressionIFace
$cmin :: CompressionIFace -&gt; CompressionIFace -&gt; CompressionIFace
min :: CompressionIFace -&gt; CompressionIFace -&gt; CompressionIFace
</span><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var">Ord</span></span></span></span></span></span></span></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621683006336"><span id="local-6989586621683006338"><span class="annot"><span class="annottext">CompressionIFace
CompressionIFace -&gt; CompressionIFace -&gt; Bounded CompressionIFace
forall a. a -&gt; a -&gt; Bounded a
$cminBound :: CompressionIFace
minBound :: CompressionIFace
$cmaxBound :: CompressionIFace
maxBound :: CompressionIFace
</span><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var hs-var">Bounded</span></span></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621683006344"><span id="local-6989586621683006350"><span id="local-6989586621683006355"><span id="local-6989586621683006361"><span id="local-6989586621683006364"><span id="local-6989586621683006369"><span id="local-6989586621683006376"><span id="local-6989586621683006380"><span class="annot"><span class="annottext">Int -&gt; CompressionIFace
CompressionIFace -&gt; Int
CompressionIFace -&gt; [CompressionIFace]
CompressionIFace -&gt; CompressionIFace
CompressionIFace -&gt; CompressionIFace -&gt; [CompressionIFace]
CompressionIFace
-&gt; CompressionIFace -&gt; CompressionIFace -&gt; [CompressionIFace]
(CompressionIFace -&gt; CompressionIFace)
-&gt; (CompressionIFace -&gt; CompressionIFace)
-&gt; (Int -&gt; CompressionIFace)
-&gt; (CompressionIFace -&gt; Int)
-&gt; (CompressionIFace -&gt; [CompressionIFace])
-&gt; (CompressionIFace -&gt; CompressionIFace -&gt; [CompressionIFace])
-&gt; (CompressionIFace -&gt; CompressionIFace -&gt; [CompressionIFace])
-&gt; (CompressionIFace
    -&gt; CompressionIFace -&gt; CompressionIFace -&gt; [CompressionIFace])
-&gt; Enum CompressionIFace
forall a.
(a -&gt; a)
-&gt; (a -&gt; a)
-&gt; (Int -&gt; a)
-&gt; (a -&gt; Int)
-&gt; (a -&gt; [a])
-&gt; (a -&gt; a -&gt; [a])
-&gt; (a -&gt; a -&gt; [a])
-&gt; (a -&gt; a -&gt; a -&gt; [a])
-&gt; Enum a
$csucc :: CompressionIFace -&gt; CompressionIFace
succ :: CompressionIFace -&gt; CompressionIFace
$cpred :: CompressionIFace -&gt; CompressionIFace
pred :: CompressionIFace -&gt; CompressionIFace
$ctoEnum :: Int -&gt; CompressionIFace
toEnum :: Int -&gt; CompressionIFace
$cfromEnum :: CompressionIFace -&gt; Int
fromEnum :: CompressionIFace -&gt; Int
$cenumFrom :: CompressionIFace -&gt; [CompressionIFace]
enumFrom :: CompressionIFace -&gt; [CompressionIFace]
$cenumFromThen :: CompressionIFace -&gt; CompressionIFace -&gt; [CompressionIFace]
enumFromThen :: CompressionIFace -&gt; CompressionIFace -&gt; [CompressionIFace]
$cenumFromTo :: CompressionIFace -&gt; CompressionIFace -&gt; [CompressionIFace]
enumFromTo :: CompressionIFace -&gt; CompressionIFace -&gt; [CompressionIFace]
$cenumFromThenTo :: CompressionIFace
-&gt; CompressionIFace -&gt; CompressionIFace -&gt; [CompressionIFace]
enumFromThenTo :: CompressionIFace
-&gt; CompressionIFace -&gt; CompressionIFace -&gt; [CompressionIFace]
</span><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var">Enum</span></span></span></span></span></span></span></span></span></span><span class="hs-special">)</span><span>
</span><span id="line-105"></span><span>
</span><span id="line-106"></span><span class="hs-keyword">instance</span><span> </span><span class="annot"><a href="GHC.Utils.Outputable.html#Outputable"><span class="hs-identifier hs-type">Outputable</span></a></span><span> </span><span class="annot"><a href="GHC.Iface.Binary.html#CompressionIFace"><span class="hs-identifier hs-type">CompressionIFace</span></a></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-107"></span><span>  </span><span id="local-6989586621683006391"><span class="annot"><span class="annottext">ppr :: CompressionIFace -&gt; SDoc
</span><a href="#local-6989586621683006391"><span class="hs-identifier hs-var hs-var hs-var">ppr</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">String -&gt; SDoc
forall doc. IsLine doc =&gt; String -&gt; doc
</span><a href="GHC.Utils.Outputable.html#text"><span class="hs-identifier hs-var">text</span></a></span><span> </span><span class="annot"><span class="annottext">(String -&gt; SDoc)
-&gt; (CompressionIFace -&gt; String) -&gt; CompressionIFace -&gt; SDoc
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">CompressionIFace -&gt; String
forall a. Show a =&gt; a -&gt; String
</span><span class="hs-identifier hs-var">show</span></span><span>
</span><span id="line-108"></span><span>
</span><span id="line-109"></span><span class="hs-comment">-- | Read an interface file header, checking the magic number, version, and</span><span>
</span><span id="line-110"></span><span class="hs-comment">-- way. Returns the hash of the source file and a BinHandle which points at the</span><span>
</span><span id="line-111"></span><span class="hs-comment">-- start of the rest of the interface file data.</span><span>
</span><span id="line-112"></span><span class="annot"><a href="GHC.Iface.Binary.html#readBinIfaceHeader"><span class="hs-identifier hs-type">readBinIfaceHeader</span></a></span><span>
</span><span id="line-113"></span><span>  </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Platform.Profile.html#Profile"><span class="hs-identifier hs-type">Profile</span></a></span><span>
</span><span id="line-114"></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Types.Name.Cache.html#NameCache"><span class="hs-identifier hs-type">NameCache</span></a></span><span>
</span><span id="line-115"></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Iface.Binary.html#CheckHiWay"><span class="hs-identifier hs-type">CheckHiWay</span></a></span><span>
</span><span id="line-116"></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Iface.Binary.html#TraceBinIFace"><span class="hs-identifier hs-type">TraceBinIFace</span></a></span><span>
</span><span id="line-117"></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">FilePath</span></span><span>
</span><span id="line-118"></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Fingerprint</span></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Utils.Binary.html#ReadBinHandle"><span class="hs-identifier hs-type">ReadBinHandle</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-119"></span><span id="readBinIfaceHeader"><span class="annot"><span class="annottext">readBinIfaceHeader :: Profile
-&gt; NameCache
-&gt; CheckHiWay
-&gt; TraceBinIFace
-&gt; String
-&gt; IO (Fingerprint, ReadBinHandle)
</span><a href="GHC.Iface.Binary.html#readBinIfaceHeader"><span class="hs-identifier hs-var hs-var">readBinIfaceHeader</span></a></span></span><span> </span><span id="local-6989586621683006397"><span class="annot"><span class="annottext">Profile
</span><a href="#local-6989586621683006397"><span class="hs-identifier hs-var">profile</span></a></span></span><span> </span><span id="local-6989586621683006398"><span class="annot"><span class="annottext">NameCache
</span><a href="#local-6989586621683006398"><span class="hs-identifier hs-var">_name_cache</span></a></span></span><span> </span><span id="local-6989586621683006399"><span class="annot"><span class="annottext">CheckHiWay
</span><a href="#local-6989586621683006399"><span class="hs-identifier hs-var">checkHiWay</span></a></span></span><span> </span><span id="local-6989586621683006400"><span class="annot"><span class="annottext">TraceBinIFace
</span><a href="#local-6989586621683006400"><span class="hs-identifier hs-var">traceBinIFace</span></a></span></span><span> </span><span id="local-6989586621683006401"><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621683006401"><span class="hs-identifier hs-var">hi_path</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-120"></span><span>    </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621683006402"><span class="annot"><span class="annottext">platform :: Platform
</span><a href="#local-6989586621683006402"><span class="hs-identifier hs-var hs-var hs-var">platform</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Profile -&gt; Platform
</span><a href="GHC.Platform.Profile.html#profilePlatform"><span class="hs-identifier hs-var">profilePlatform</span></a></span><span> </span><span class="annot"><span class="annottext">Profile
</span><a href="#local-6989586621683006397"><span class="hs-identifier hs-var">profile</span></a></span><span>
</span><span id="line-121"></span><span>
</span><span id="line-122"></span><span>        </span><span id="local-6989586621683005842"><span class="annot"><a href="#local-6989586621683006404"><span class="hs-identifier hs-type">wantedGot</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">String</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621683005842"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621683005842"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621683005842"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Utils.Outputable.html#SDoc"><span class="hs-identifier hs-type">SDoc</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span></span><span>
</span><span id="line-123"></span><span>        </span><span id="local-6989586621683006404"><span class="annot"><span class="annottext">wantedGot :: forall a. String -&gt; a -&gt; a -&gt; (a -&gt; SDoc) -&gt; IO ()
</span><a href="#local-6989586621683006404"><span class="hs-identifier hs-var hs-var hs-var">wantedGot</span></a></span></span><span> </span><span id="local-6989586621683006417"><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621683006417"><span class="hs-identifier hs-var">what</span></a></span></span><span> </span><span id="local-6989586621683006418"><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621683006418"><span class="hs-identifier hs-var">wanted</span></a></span></span><span> </span><span id="local-6989586621683006419"><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621683006419"><span class="hs-identifier hs-var">got</span></a></span></span><span> </span><span id="local-6989586621683006420"><span class="annot"><span class="annottext">a -&gt; SDoc
</span><a href="#local-6989586621683006420"><span class="hs-identifier hs-var">ppr'</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-124"></span><span>            </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">TraceBinIFace
</span><a href="#local-6989586621683006400"><span class="hs-identifier hs-var">traceBinIFace</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-125"></span><span>               </span><span class="annot"><span class="annottext">TraceBinIFace
</span><a href="GHC.Iface.Binary.html#QuietBinIFace"><span class="hs-identifier hs-var">QuietBinIFace</span></a></span><span>         </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">() -&gt; IO ()
forall a. a -&gt; IO a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-126"></span><span>               </span><span class="annot"><a href="GHC.Iface.Binary.html#TraceBinIFace"><span class="hs-identifier hs-type">TraceBinIFace</span></a></span><span> </span><span id="local-6989586621683006421"><span class="annot"><span class="annottext">SDoc -&gt; IO ()
</span><a href="#local-6989586621683006421"><span class="hs-identifier hs-var">printer</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">SDoc -&gt; IO ()
</span><a href="#local-6989586621683006421"><span class="hs-identifier hs-var">printer</span></a></span><span> </span><span class="annot"><span class="annottext">(SDoc -&gt; IO ()) -&gt; SDoc -&gt; IO ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-127"></span><span>                     </span><span class="annot"><span class="annottext">String -&gt; SDoc
forall doc. IsLine doc =&gt; String -&gt; doc
</span><a href="GHC.Utils.Outputable.html#text"><span class="hs-identifier hs-var">text</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621683006417"><span class="hs-identifier hs-var">what</span></a></span><span> </span><span class="annot"><span class="annottext">SDoc -&gt; SDoc -&gt; SDoc
forall doc. IsLine doc =&gt; doc -&gt; doc -&gt; doc
</span><a href="GHC.Utils.Outputable.html#%3C%3E"><span class="hs-operator hs-var">&lt;&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">String -&gt; SDoc
forall doc. IsLine doc =&gt; String -&gt; doc
</span><a href="GHC.Utils.Outputable.html#text"><span class="hs-identifier hs-var">text</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;: &quot;</span></span><span> </span><span class="annot"><span class="annottext">SDoc -&gt; SDoc -&gt; SDoc
forall doc. IsLine doc =&gt; doc -&gt; doc -&gt; doc
</span><a href="GHC.Utils.Outputable.html#%3C%3E"><span class="hs-operator hs-var">&lt;&gt;</span></a></span><span>
</span><span id="line-128"></span><span>                     </span><span class="annot"><span class="annottext">[SDoc] -&gt; SDoc
forall doc. IsDoc doc =&gt; [doc] -&gt; doc
</span><a href="GHC.Utils.Outputable.html#vcat"><span class="hs-identifier hs-var">vcat</span></a></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">String -&gt; SDoc
forall doc. IsLine doc =&gt; String -&gt; doc
</span><a href="GHC.Utils.Outputable.html#text"><span class="hs-identifier hs-var">text</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;Wanted &quot;</span></span><span> </span><span class="annot"><span class="annottext">SDoc -&gt; SDoc -&gt; SDoc
forall doc. IsLine doc =&gt; doc -&gt; doc -&gt; doc
</span><a href="GHC.Utils.Outputable.html#%3C%3E"><span class="hs-operator hs-var">&lt;&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">a -&gt; SDoc
</span><a href="#local-6989586621683006420"><span class="hs-identifier hs-var">ppr'</span></a></span><span> </span><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621683006418"><span class="hs-identifier hs-var">wanted</span></a></span><span> </span><span class="annot"><span class="annottext">SDoc -&gt; SDoc -&gt; SDoc
forall doc. IsLine doc =&gt; doc -&gt; doc -&gt; doc
</span><a href="GHC.Utils.Outputable.html#%3C%3E"><span class="hs-operator hs-var">&lt;&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">String -&gt; SDoc
forall doc. IsLine doc =&gt; String -&gt; doc
</span><a href="GHC.Utils.Outputable.html#text"><span class="hs-identifier hs-var">text</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;,&quot;</span></span><span class="hs-special">,</span><span>
</span><span id="line-129"></span><span>                           </span><span class="annot"><span class="annottext">String -&gt; SDoc
forall doc. IsLine doc =&gt; String -&gt; doc
</span><a href="GHC.Utils.Outputable.html#text"><span class="hs-identifier hs-var">text</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;got    &quot;</span></span><span> </span><span class="annot"><span class="annottext">SDoc -&gt; SDoc -&gt; SDoc
forall doc. IsLine doc =&gt; doc -&gt; doc -&gt; doc
</span><a href="GHC.Utils.Outputable.html#%3C%3E"><span class="hs-operator hs-var">&lt;&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">a -&gt; SDoc
</span><a href="#local-6989586621683006420"><span class="hs-identifier hs-var">ppr'</span></a></span><span> </span><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621683006419"><span class="hs-identifier hs-var">got</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-130"></span><span>
</span><span id="line-131"></span><span>        </span><span id="local-6989586621683005851"><span class="annot"><a href="#local-6989586621683006424"><span class="hs-identifier hs-type">errorOnMismatch</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Eq</span></span><span> </span><span class="annot"><a href="#local-6989586621683005851"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Show</span></span><span> </span><span class="annot"><a href="#local-6989586621683005851"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">String</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621683005851"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621683005851"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span></span><span>
</span><span id="line-132"></span><span>        </span><span id="local-6989586621683006424"><span class="annot"><span class="annottext">errorOnMismatch :: forall a. (Eq a, Show a) =&gt; String -&gt; a -&gt; a -&gt; IO ()
</span><a href="#local-6989586621683006424"><span class="hs-identifier hs-var hs-var hs-var">errorOnMismatch</span></a></span></span><span> </span><span id="local-6989586621683006431"><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621683006431"><span class="hs-identifier hs-var">what</span></a></span></span><span> </span><span id="local-6989586621683006432"><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621683006432"><span class="hs-identifier hs-var">wanted</span></a></span></span><span> </span><span id="local-6989586621683006433"><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621683006433"><span class="hs-identifier hs-var">got</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-133"></span><span>            </span><span class="hs-comment">-- This will be caught by readIface which will emit an error</span><span>
</span><span id="line-134"></span><span>            </span><span class="hs-comment">-- msg containing the iface module name.</span><span>
</span><span id="line-135"></span><span>            </span><span class="annot"><span class="annottext">Bool -&gt; IO () -&gt; IO ()
forall (f :: * -&gt; *). Applicative f =&gt; Bool -&gt; f () -&gt; f ()
</span><span class="hs-identifier hs-var">when</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621683006432"><span class="hs-identifier hs-var">wanted</span></a></span><span> </span><span class="annot"><span class="annottext">a -&gt; a -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">/=</span></span><span> </span><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621683006433"><span class="hs-identifier hs-var">got</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(IO () -&gt; IO ()) -&gt; IO () -&gt; IO ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">GhcException -&gt; IO ()
forall a. GhcException -&gt; IO a
</span><a href="GHC.Utils.Panic.html#throwGhcExceptionIO"><span class="hs-identifier hs-var">throwGhcExceptionIO</span></a></span><span> </span><span class="annot"><span class="annottext">(GhcException -&gt; IO ()) -&gt; GhcException -&gt; IO ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">String -&gt; GhcException
</span><a href="GHC.Utils.Panic.html#ProgramError"><span class="hs-identifier hs-var">ProgramError</span></a></span><span>
</span><span id="line-136"></span><span>                         </span><span class="hs-special">(</span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621683006431"><span class="hs-identifier hs-var">what</span></a></span><span> </span><span class="annot"><span class="annottext">String -&gt; ShowS
forall a. [a] -&gt; [a] -&gt; [a]
</span><span class="hs-operator hs-var">++</span></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot; (wanted &quot;</span></span><span> </span><span class="annot"><span class="annottext">String -&gt; ShowS
forall a. [a] -&gt; [a] -&gt; [a]
</span><span class="hs-operator hs-var">++</span></span><span> </span><span class="annot"><span class="annottext">a -&gt; String
forall a. Show a =&gt; a -&gt; String
</span><span class="hs-identifier hs-var">show</span></span><span> </span><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621683006432"><span class="hs-identifier hs-var">wanted</span></a></span><span>
</span><span id="line-137"></span><span>                               </span><span class="annot"><span class="annottext">String -&gt; ShowS
forall a. [a] -&gt; [a] -&gt; [a]
</span><span class="hs-operator hs-var">++</span></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;, got &quot;</span></span><span>    </span><span class="annot"><span class="annottext">String -&gt; ShowS
forall a. [a] -&gt; [a] -&gt; [a]
</span><span class="hs-operator hs-var">++</span></span><span> </span><span class="annot"><span class="annottext">a -&gt; String
forall a. Show a =&gt; a -&gt; String
</span><span class="hs-identifier hs-var">show</span></span><span> </span><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621683006433"><span class="hs-identifier hs-var">got</span></a></span><span> </span><span class="annot"><span class="annottext">String -&gt; ShowS
forall a. [a] -&gt; [a] -&gt; [a]
</span><span class="hs-operator hs-var">++</span></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;)&quot;</span></span><span class="hs-special">)</span><span>
</span><span id="line-138"></span><span>    </span><span id="local-6989586621683006438"><span class="annot"><a href="#local-6989586621683006438"><span class="hs-identifier hs-var">bh</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">String -&gt; IO ReadBinHandle
</span><a href="GHC.Utils.Binary.html#readBinMem"><span class="hs-identifier hs-var">Binary.readBinMem</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621683006401"><span class="hs-identifier hs-var">hi_path</span></a></span><span>
</span><span id="line-139"></span><span>
</span><span id="line-140"></span><span>    </span><span class="hs-comment">-- Read the magic number to check that this really is a GHC .hi file</span><span>
</span><span id="line-141"></span><span>    </span><span class="hs-comment">-- (This magic number does not change when we change</span><span>
</span><span id="line-142"></span><span>    </span><span class="hs-comment">--  GHC interface file format)</span><span>
</span><span id="line-143"></span><span>    </span><span id="local-6989586621683006440"><span class="annot"><a href="#local-6989586621683006440"><span class="hs-identifier hs-var">magic</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><a href="GHC.Utils.Binary.html#get"><span class="hs-identifier hs-type">get</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683006438"><span class="hs-identifier hs-type">bh</span></a></span><span>
</span><span id="line-144"></span><span>    </span><span class="annot"><a href="#local-6989586621683006404"><span class="hs-identifier hs-type">wantedGot</span></a></span><span> </span><span class="annot"><span class="hs-string">&quot;Magic&quot;</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Iface.Binary.html#binaryInterfaceMagic"><span class="hs-identifier hs-type">binaryInterfaceMagic</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683006402"><span class="hs-identifier hs-type">platform</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><a href="#local-6989586621683006440"><span class="hs-identifier hs-type">magic</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-type">ppr</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">.</span></span><span> </span><span class="annot"><a href="GHC.Utils.Binary.html#unFixedLength"><span class="hs-identifier hs-var">unFixedLength</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-145"></span><span>    </span><span class="annot"><a href="#local-6989586621683006424"><span class="hs-identifier hs-type">errorOnMismatch</span></a></span><span> </span><span class="annot"><span class="hs-string">&quot;magic number mismatch: old/corrupt interface file?&quot;</span></span><span>
</span><span id="line-146"></span><span>        </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Utils.Binary.html#unFixedLength"><span class="hs-identifier hs-var">unFixedLength</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="annot"><a href="GHC.Iface.Binary.html#binaryInterfaceMagic"><span class="hs-identifier hs-type">binaryInterfaceMagic</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683006402"><span class="hs-identifier hs-type">platform</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Utils.Binary.html#unFixedLength"><span class="hs-identifier hs-var">unFixedLength</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683006440"><span class="hs-identifier hs-type">magic</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-147"></span><span>
</span><span id="line-148"></span><span>    </span><span class="hs-comment">-- Check the interface file version and profile tag.</span><span>
</span><span id="line-149"></span><span>    </span><span id="local-6989586621683006444"><span class="annot"><a href="#local-6989586621683006444"><span class="hs-identifier hs-var">check_ver</span></a></span></span><span>  </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><a href="GHC.Utils.Binary.html#get"><span class="hs-identifier hs-type">get</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683006438"><span class="hs-identifier hs-type">bh</span></a></span><span>
</span><span id="line-150"></span><span>    </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621683006446"><span class="annot"><a href="#local-6989586621683006446"><span class="hs-identifier hs-var hs-var">our_ver</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Integer -&gt; String
forall a. Show a =&gt; a -&gt; String
</span><span class="hs-identifier hs-var">show</span></span><span> </span><span class="annot"><span class="annottext">Integer
</span><a href="GHC.Settings.Constants.html#hiVersion"><span class="hs-identifier hs-var">hiVersion</span></a></span><span>
</span><span id="line-151"></span><span>    </span><span class="annot"><a href="#local-6989586621683006404"><span class="hs-identifier hs-type">wantedGot</span></a></span><span> </span><span class="annot"><span class="hs-string">&quot;Version&quot;</span></span><span> </span><span class="annot"><a href="#local-6989586621683006446"><span class="hs-identifier hs-type">our_ver</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683006444"><span class="hs-identifier hs-type">check_ver</span></a></span><span> </span><span class="annot"><a href="GHC.Utils.Outputable.html#text"><span class="hs-identifier hs-type">text</span></a></span><span>
</span><span id="line-152"></span><span>    </span><span class="annot"><a href="#local-6989586621683006424"><span class="hs-identifier hs-type">errorOnMismatch</span></a></span><span> </span><span class="annot"><span class="hs-string">&quot;mismatched interface file versions&quot;</span></span><span> </span><span class="annot"><a href="#local-6989586621683006446"><span class="hs-identifier hs-type">our_ver</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683006444"><span class="hs-identifier hs-type">check_ver</span></a></span><span>
</span><span id="line-153"></span><span>
</span><span id="line-154"></span><span>    </span><span id="local-6989586621683006448"><span class="annot"><a href="#local-6989586621683006448"><span class="hs-identifier hs-var">check_tag</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><a href="GHC.Utils.Binary.html#get"><span class="hs-identifier hs-type">get</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683006438"><span class="hs-identifier hs-type">bh</span></a></span><span>
</span><span id="line-155"></span><span>    </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621683006449"><span class="annot"><a href="#local-6989586621683006449"><span class="hs-identifier hs-var hs-var">tag</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Profile -&gt; String
</span><a href="GHC.Platform.Profile.html#profileBuildTag"><span class="hs-identifier hs-var">profileBuildTag</span></a></span><span> </span><span class="annot"><span class="annottext">Profile
</span><a href="#local-6989586621683006397"><span class="hs-identifier hs-var">profile</span></a></span><span>
</span><span id="line-156"></span><span>    </span><span class="annot"><a href="#local-6989586621683006404"><span class="hs-identifier hs-type">wantedGot</span></a></span><span> </span><span class="annot"><span class="hs-string">&quot;Way&quot;</span></span><span> </span><span class="annot"><a href="#local-6989586621683006449"><span class="hs-identifier hs-type">tag</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683006448"><span class="hs-identifier hs-type">check_tag</span></a></span><span> </span><span class="annot"><a href="GHC.Utils.Outputable.html#text"><span class="hs-identifier hs-type">text</span></a></span><span>
</span><span id="line-157"></span><span>    </span><span class="annot"><span class="hs-identifier hs-type">when</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621683006399"><span class="hs-identifier hs-type">checkHiWay</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">==</span></span><span> </span><span class="annot"><a href="GHC.Iface.Binary.html#CheckHiWay"><span class="hs-identifier hs-type">CheckHiWay</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span>
</span><span id="line-158"></span><span>        </span><span class="annot"><a href="#local-6989586621683006424"><span class="hs-identifier hs-type">errorOnMismatch</span></a></span><span> </span><span class="annot"><span class="hs-string">&quot;mismatched interface file profile tag&quot;</span></span><span> </span><span class="annot"><a href="#local-6989586621683006449"><span class="hs-identifier hs-type">tag</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683006448"><span class="hs-identifier hs-type">check_tag</span></a></span><span>
</span><span id="line-159"></span><span>
</span><span id="line-160"></span><span>    </span><span id="local-6989586621683006451"><span class="annot"><a href="#local-6989586621683006451"><span class="hs-identifier hs-var">src_hash</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><a href="GHC.Utils.Binary.html#get"><span class="hs-identifier hs-type">get</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683006438"><span class="hs-identifier hs-type">bh</span></a></span><span>
</span><span id="line-161"></span><span>    </span><span class="annot"><span class="hs-identifier hs-type">pure</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621683006451"><span class="hs-identifier hs-type">src_hash</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="#local-6989586621683006438"><span class="hs-identifier hs-type">bh</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-162"></span><span>
</span><span id="line-163"></span><span class="hs-comment">-- | Read an interface file.</span><span>
</span><span id="line-164"></span><span class="hs-comment">--</span><span>
</span><span id="line-165"></span><span class="hs-comment">-- See Note [Deduplication during iface binary serialisation] for details.</span><span>
</span><span id="line-166"></span><span class="annot"><a href="GHC.Iface.Binary.html#readBinIface"><span class="hs-identifier hs-type">readBinIface</span></a></span><span>
</span><span id="line-167"></span><span>  </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Platform.Profile.html#Profile"><span class="hs-identifier hs-type">Profile</span></a></span><span>
</span><span id="line-168"></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Types.Name.Cache.html#NameCache"><span class="hs-identifier hs-type">NameCache</span></a></span><span>
</span><span id="line-169"></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Iface.Binary.html#CheckHiWay"><span class="hs-identifier hs-type">CheckHiWay</span></a></span><span>
</span><span id="line-170"></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Iface.Binary.html#TraceBinIFace"><span class="hs-identifier hs-type">TraceBinIFace</span></a></span><span>
</span><span id="line-171"></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">FilePath</span></span><span>
</span><span id="line-172"></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="annot"><a href="GHC.Unit.Module.ModIface.html#ModIface"><span class="hs-identifier hs-type">ModIface</span></a></span><span>
</span><span id="line-173"></span><span id="readBinIface"><span class="annot"><span class="annottext">readBinIface :: Profile
-&gt; NameCache
-&gt; CheckHiWay
-&gt; TraceBinIFace
-&gt; String
-&gt; IO (ModIface_ 'ModIfaceFinal)
</span><a href="GHC.Iface.Binary.html#readBinIface"><span class="hs-identifier hs-var hs-var">readBinIface</span></a></span></span><span> </span><span id="local-6989586621683006452"><span class="annot"><span class="annottext">Profile
</span><a href="#local-6989586621683006452"><span class="hs-identifier hs-var">profile</span></a></span></span><span> </span><span id="local-6989586621683006453"><span class="annot"><span class="annottext">NameCache
</span><a href="#local-6989586621683006453"><span class="hs-identifier hs-var">name_cache</span></a></span></span><span> </span><span id="local-6989586621683006454"><span class="annot"><span class="annottext">CheckHiWay
</span><a href="#local-6989586621683006454"><span class="hs-identifier hs-var">checkHiWay</span></a></span></span><span> </span><span id="local-6989586621683006455"><span class="annot"><span class="annottext">TraceBinIFace
</span><a href="#local-6989586621683006455"><span class="hs-identifier hs-var">traceBinIface</span></a></span></span><span> </span><span id="local-6989586621683006456"><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621683006456"><span class="hs-identifier hs-var">hi_path</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-174"></span><span>    </span><span class="hs-special">(</span><span id="local-6989586621683006457"><span class="annot"><a href="#local-6989586621683006457"><span class="hs-identifier hs-var">src_hash</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621683006458"><span class="annot"><a href="#local-6989586621683006458"><span class="hs-identifier hs-var">bh</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Profile
-&gt; NameCache
-&gt; CheckHiWay
-&gt; TraceBinIFace
-&gt; String
-&gt; IO (Fingerprint, ReadBinHandle)
</span><a href="GHC.Iface.Binary.html#readBinIfaceHeader"><span class="hs-identifier hs-var">readBinIfaceHeader</span></a></span><span> </span><span class="annot"><span class="annottext">Profile
</span><a href="#local-6989586621683006452"><span class="hs-identifier hs-var">profile</span></a></span><span> </span><span class="annot"><span class="annottext">NameCache
</span><a href="#local-6989586621683006453"><span class="hs-identifier hs-var">name_cache</span></a></span><span> </span><span class="annot"><span class="annottext">CheckHiWay
</span><a href="#local-6989586621683006454"><span class="hs-identifier hs-var">checkHiWay</span></a></span><span> </span><span class="annot"><span class="annottext">TraceBinIFace
</span><a href="#local-6989586621683006455"><span class="hs-identifier hs-var">traceBinIface</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621683006456"><span class="hs-identifier hs-var">hi_path</span></a></span><span>
</span><span id="line-175"></span><span>
</span><span id="line-176"></span><span>    </span><span id="local-6989586621683006459"><span class="annot"><a href="#local-6989586621683006459"><span class="hs-identifier hs-var">mod_iface</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><a href="GHC.Iface.Binary.html#getIfaceWithExtFields"><span class="hs-identifier hs-type">getIfaceWithExtFields</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683006453"><span class="hs-identifier hs-type">name_cache</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683006458"><span class="hs-identifier hs-type">bh</span></a></span><span>
</span><span id="line-177"></span><span>
</span><span id="line-178"></span><span>    </span><span class="annot"><span class="hs-identifier hs-type">return</span></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="annot"><a href="#local-6989586621683006459"><span class="hs-identifier hs-type">mod_iface</span></a></span><span>
</span><span id="line-179"></span><span>      </span><span class="annot"><span class="hs-operator hs-type">&amp;</span></span><span> </span><span class="annot"><a href="GHC.Unit.Module.ModIface.html#addSourceFingerprint"><span class="hs-identifier hs-type">addSourceFingerprint</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683006457"><span class="hs-identifier hs-type">src_hash</span></a></span><span>
</span><span id="line-180"></span><span>
</span><span id="line-181"></span><span>
</span><span id="line-182"></span><span class="annot"><a href="GHC.Iface.Binary.html#getIfaceWithExtFields"><span class="hs-identifier hs-type">getIfaceWithExtFields</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Types.Name.Cache.html#NameCache"><span class="hs-identifier hs-type">NameCache</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Utils.Binary.html#ReadBinHandle"><span class="hs-identifier hs-type">ReadBinHandle</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="annot"><a href="GHC.Unit.Module.ModIface.html#ModIface"><span class="hs-identifier hs-type">ModIface</span></a></span><span>
</span><span id="line-183"></span><span id="getIfaceWithExtFields"><span class="annot"><span class="annottext">getIfaceWithExtFields :: NameCache -&gt; ReadBinHandle -&gt; IO (ModIface_ 'ModIfaceFinal)
</span><a href="GHC.Iface.Binary.html#getIfaceWithExtFields"><span class="hs-identifier hs-var hs-var">getIfaceWithExtFields</span></a></span></span><span> </span><span id="local-6989586621683006461"><span class="annot"><span class="annottext">NameCache
</span><a href="#local-6989586621683006461"><span class="hs-identifier hs-var">name_cache</span></a></span></span><span> </span><span id="local-6989586621683006462"><span class="annot"><span class="annottext">ReadBinHandle
</span><a href="#local-6989586621683006462"><span class="hs-identifier hs-var">bh</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-184"></span><span>  </span><span class="hs-comment">-- Start offset for the byte array that contains the serialised 'ModIface'.</span><span>
</span><span id="line-185"></span><span>  </span><span id="local-6989586621683006463"><span class="annot"><a href="#local-6989586621683006463"><span class="hs-identifier hs-var">start</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">ReadBinHandle -&gt; IO (Bin (ZonkAny 1))
forall {k} (a :: k). ReadBinHandle -&gt; IO (Bin a)
</span><a href="GHC.Utils.Binary.html#tellBinReader"><span class="hs-identifier hs-var">tellBinReader</span></a></span><span> </span><span class="annot"><span class="annottext">ReadBinHandle
</span><a href="#local-6989586621683006462"><span class="hs-identifier hs-var">bh</span></a></span><span>
</span><span id="line-186"></span><span>  </span><span id="local-6989586621683006465"><span class="annot"><a href="#local-6989586621683006465"><span class="hs-identifier hs-var">extFields_p_rel</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><a href="GHC.Utils.Binary.html#getRelBin"><span class="hs-identifier hs-type">getRelBin</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683006462"><span class="hs-identifier hs-type">bh</span></a></span><span>
</span><span id="line-187"></span><span>
</span><span id="line-188"></span><span>  </span><span id="local-6989586621683006467"><span class="annot"><a href="#local-6989586621683006467"><span class="hs-identifier hs-var">mod_iface</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><a href="GHC.Iface.Binary.html#getWithUserData"><span class="hs-identifier hs-type">getWithUserData</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683006461"><span class="hs-identifier hs-type">name_cache</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683006462"><span class="hs-identifier hs-type">bh</span></a></span><span>
</span><span id="line-189"></span><span>
</span><span id="line-190"></span><span>  </span><span class="annot"><a href="GHC.Utils.Binary.html#seekBinReaderRel"><span class="hs-identifier hs-type">seekBinReaderRel</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683006462"><span class="hs-identifier hs-type">bh</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683006465"><span class="hs-identifier hs-type">extFields_p_rel</span></a></span><span>
</span><span id="line-191"></span><span>  </span><span id="local-6989586621683006469"><span class="annot"><a href="#local-6989586621683006469"><span class="hs-identifier hs-var">extFields</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><a href="GHC.Utils.Binary.html#get"><span class="hs-identifier hs-type">get</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683006462"><span class="hs-identifier hs-type">bh</span></a></span><span>
</span><span id="line-192"></span><span>  </span><span class="hs-comment">-- Store the 'ModIface' byte array, so that we can avoid serialisation if</span><span>
</span><span id="line-193"></span><span>  </span><span class="hs-comment">-- the 'ModIface' isn't modified.</span><span>
</span><span id="line-194"></span><span>  </span><span class="hs-comment">-- See Note [Sharing of ModIface]</span><span>
</span><span id="line-195"></span><span>  </span><span id="local-6989586621683006470"><span class="annot"><a href="#local-6989586621683006470"><span class="hs-identifier hs-var">modIfaceBinData</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><a href="GHC.Utils.Binary.html#freezeBinHandle"><span class="hs-identifier hs-type">freezeBinHandle</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683006462"><span class="hs-identifier hs-type">bh</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683006463"><span class="hs-identifier hs-type">start</span></a></span><span>
</span><span id="line-196"></span><span>  </span><span class="annot"><span class="hs-identifier hs-type">pure</span></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="annot"><a href="#local-6989586621683006467"><span class="hs-identifier hs-type">mod_iface</span></a></span><span>
</span><span id="line-197"></span><span>    </span><span class="annot"><span class="hs-operator hs-type">&amp;</span></span><span> </span><span class="annot"><a href="GHC.Unit.Module.ModIface.html#set_mi_ext_fields"><span class="hs-identifier hs-type">set_mi_ext_fields</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683006469"><span class="hs-identifier hs-type">extFields</span></a></span><span>
</span><span id="line-198"></span><span>    </span><span class="annot"><span class="hs-operator hs-type">&amp;</span></span><span> </span><span class="annot"><a href="GHC.Unit.Module.ModIface.html#set_mi_hi_bytes"><span class="hs-identifier hs-type">set_mi_hi_bytes</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Unit.Module.ModIface.html#FullIfaceBinHandle"><span class="hs-identifier hs-type">FullIfaceBinHandle</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="annot"><a href="GHC.Data.Strict.html#Just"><span class="hs-identifier hs-type">Strict.Just</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683006470"><span class="hs-identifier hs-type">modIfaceBinData</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-199"></span><span>
</span><span id="line-200"></span><span class="hs-comment">-- | This performs a get action after reading the dictionary and symbol</span><span>
</span><span id="line-201"></span><span class="hs-comment">-- table. It is necessary to run this before trying to deserialise any</span><span>
</span><span id="line-202"></span><span class="hs-comment">-- Names or FastStrings.</span><span>
</span><span id="line-203"></span><span id="local-6989586621683005872"><span class="annot"><a href="GHC.Iface.Binary.html#getWithUserData"><span class="hs-identifier hs-type">getWithUserData</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Utils.Binary.html#Binary"><span class="hs-identifier hs-type">Binary</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683005872"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="GHC.Types.Name.Cache.html#NameCache"><span class="hs-identifier hs-type">NameCache</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Utils.Binary.html#ReadBinHandle"><span class="hs-identifier hs-type">ReadBinHandle</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="annot"><a href="#local-6989586621683005872"><span class="hs-identifier hs-type">a</span></a></span></span><span>
</span><span id="line-204"></span><span id="getWithUserData"><span class="annot"><span class="annottext">getWithUserData :: forall a. Binary a =&gt; NameCache -&gt; ReadBinHandle -&gt; IO a
</span><a href="GHC.Iface.Binary.html#getWithUserData"><span class="hs-identifier hs-var hs-var">getWithUserData</span></a></span></span><span> </span><span id="local-6989586621683006479"><span class="annot"><span class="annottext">NameCache
</span><a href="#local-6989586621683006479"><span class="hs-identifier hs-var">name_cache</span></a></span></span><span> </span><span id="local-6989586621683006480"><span class="annot"><span class="annottext">ReadBinHandle
</span><a href="#local-6989586621683006480"><span class="hs-identifier hs-var">bh</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-205"></span><span>  </span><span id="local-6989586621683006481"><span class="annot"><a href="#local-6989586621683006481"><span class="hs-identifier hs-var">bh</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">NameCache -&gt; ReadBinHandle -&gt; IO ReadBinHandle
</span><a href="GHC.Iface.Binary.html#getTables"><span class="hs-identifier hs-var">getTables</span></a></span><span> </span><span class="annot"><span class="annottext">NameCache
</span><a href="#local-6989586621683006479"><span class="hs-identifier hs-var">name_cache</span></a></span><span> </span><span class="annot"><span class="annottext">ReadBinHandle
</span><a href="#local-6989586621683006480"><span class="hs-identifier hs-var">bh</span></a></span><span>
</span><span id="line-206"></span><span>  </span><span class="annot"><a href="GHC.Utils.Binary.html#get"><span class="hs-identifier hs-type">get</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683006481"><span class="hs-identifier hs-type">bh</span></a></span><span>
</span><span id="line-207"></span><span>
</span><span id="line-208"></span><span class="hs-comment">-- | Setup a BinHandle to read something written using putWithTables</span><span>
</span><span id="line-209"></span><span class="hs-comment">--</span><span>
</span><span id="line-210"></span><span class="hs-comment">-- Reading names has the side effect of adding them into the given NameCache.</span><span>
</span><span id="line-211"></span><span class="annot"><a href="GHC.Iface.Binary.html#getTables"><span class="hs-identifier hs-type">getTables</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Types.Name.Cache.html#NameCache"><span class="hs-identifier hs-type">NameCache</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Utils.Binary.html#ReadBinHandle"><span class="hs-identifier hs-type">ReadBinHandle</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="annot"><a href="GHC.Utils.Binary.html#ReadBinHandle"><span class="hs-identifier hs-type">ReadBinHandle</span></a></span><span>
</span><span id="line-212"></span><span id="getTables"><span class="annot"><span class="annottext">getTables :: NameCache -&gt; ReadBinHandle -&gt; IO ReadBinHandle
</span><a href="GHC.Iface.Binary.html#getTables"><span class="hs-identifier hs-var hs-var">getTables</span></a></span></span><span> </span><span id="local-6989586621683006483"><span class="annot"><span class="annottext">NameCache
</span><a href="#local-6989586621683006483"><span class="hs-identifier hs-var">name_cache</span></a></span></span><span> </span><span id="local-6989586621683006484"><span class="annot"><span class="annottext">ReadBinHandle
</span><a href="#local-6989586621683006484"><span class="hs-identifier hs-var">bh</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-213"></span><span>    </span><span id="local-6989586621683006485"><span class="annot"><a href="#local-6989586621683006485"><span class="hs-identifier hs-var">bhRef</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">ReaderUserData -&gt; IO (IORef ReaderUserData)
forall a. a -&gt; IO (IORef a)
</span><span class="hs-identifier hs-var">newIORef</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">String -&gt; ReaderUserData
forall a. HasCallStack =&gt; String -&gt; a
</span><span class="hs-identifier hs-var">error</span></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;used too soon&quot;</span></span><span class="hs-special">)</span><span>
</span><span id="line-214"></span><span>    </span><span class="hs-comment">-- It is important this is passed to 'getTable'</span><span>
</span><span id="line-215"></span><span>    </span><span class="hs-comment">-- See Note [Lazy ReaderUserData during IfaceType serialisation]</span><span>
</span><span id="line-216"></span><span>    </span><span id="local-6989586621683006488"><span class="annot"><a href="#local-6989586621683006488"><span class="hs-identifier hs-var">ud</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="hs-identifier hs-type">unsafeInterleaveIO</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">readIORef</span></span><span> </span><span class="annot"><a href="#local-6989586621683006485"><span class="hs-identifier hs-type">bhRef</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-217"></span><span>
</span><span id="line-218"></span><span>    </span><span id="local-6989586621683006491"><span class="annot"><a href="#local-6989586621683006491"><span class="hs-identifier hs-var">fsReaderTable</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><a href="GHC.Utils.Binary.html#initFastStringReaderTable"><span class="hs-identifier hs-type">initFastStringReaderTable</span></a></span><span>
</span><span id="line-219"></span><span>    </span><span id="local-6989586621683006493"><span class="annot"><a href="#local-6989586621683006493"><span class="hs-identifier hs-var">nameReaderTable</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><a href="GHC.Iface.Binary.html#initNameReaderTable"><span class="hs-identifier hs-type">initNameReaderTable</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683006483"><span class="hs-identifier hs-type">name_cache</span></a></span><span>
</span><span id="line-220"></span><span>    </span><span id="local-6989586621683006495"><span class="annot"><a href="#local-6989586621683006495"><span class="hs-identifier hs-var">ifaceTypeReaderTable</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><a href="GHC.Iface.Binary.html#initReadIfaceTypeTable"><span class="hs-identifier hs-type">initReadIfaceTypeTable</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683006488"><span class="hs-identifier hs-type">ud</span></a></span><span>
</span><span id="line-221"></span><span>
</span><span id="line-222"></span><span>    </span><span class="hs-keyword">let</span><span> </span><span class="hs-comment">-- For any 'ReaderTable', we decode the table that is found at the location</span><span>
</span><span id="line-223"></span><span>        </span><span class="hs-comment">-- the forward reference points to.</span><span>
</span><span id="line-224"></span><span>        </span><span class="hs-comment">-- After decoding the table, we create a 'BinaryReader' and immediately</span><span>
</span><span id="line-225"></span><span>        </span><span class="hs-comment">-- add it to the 'ReaderUserData' of 'ReadBinHandle'.</span><span>
</span><span id="line-226"></span><span>        </span><span id="local-6989586621683005892"><span class="annot"><a href="#local-6989586621683006496"><span class="hs-identifier hs-type">decodeReaderTable</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Typeable</span></span><span> </span><span class="annot"><a href="#local-6989586621683005892"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="GHC.Utils.Binary.html#ReaderTable"><span class="hs-identifier hs-type">ReaderTable</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683005892"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Utils.Binary.html#ReadBinHandle"><span class="hs-identifier hs-type">ReadBinHandle</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="annot"><a href="GHC.Utils.Binary.html#ReadBinHandle"><span class="hs-identifier hs-type">ReadBinHandle</span></a></span></span><span>
</span><span id="line-227"></span><span>        </span><span id="local-6989586621683006496"><span class="annot"><a href="#local-6989586621683006496"><span class="hs-identifier hs-var hs-var">decodeReaderTable</span></a></span></span><span> </span><span id="local-6989586621683006501"><span class="annot"><span class="annottext">ReaderTable a
</span><a href="#local-6989586621683006501"><span class="hs-identifier hs-var">tbl</span></a></span></span><span> </span><span id="local-6989586621683006502"><span class="annot"><span class="annottext">ReadBinHandle
</span><a href="#local-6989586621683006502"><span class="hs-identifier hs-var">bh0</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-228"></span><span>          </span><span id="local-6989586621683006503"><span class="annot"><a href="#local-6989586621683006503"><span class="hs-identifier hs-var">table</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">ReadBinHandle -&gt; IO (SymbolTable a) -&gt; IO (SymbolTable a)
forall a. ReadBinHandle -&gt; IO a -&gt; IO a
</span><a href="GHC.Utils.Binary.html#forwardGetRel"><span class="hs-identifier hs-var">Binary.forwardGetRel</span></a></span><span> </span><span class="annot"><span class="annottext">ReadBinHandle
</span><a href="#local-6989586621683006484"><span class="hs-identifier hs-var">bh</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ReaderTable a -&gt; ReadBinHandle -&gt; IO (SymbolTable a)
forall a. ReaderTable a -&gt; ReadBinHandle -&gt; IO (SymbolTable a)
</span><a href="GHC.Utils.Binary.html#getTable"><span class="hs-identifier hs-var">getTable</span></a></span><span> </span><span class="annot"><span class="annottext">ReaderTable a
</span><a href="#local-6989586621683006501"><span class="hs-identifier hs-var">tbl</span></a></span><span> </span><span class="annot"><span class="annottext">ReadBinHandle
</span><a href="#local-6989586621683006502"><span class="hs-identifier hs-var">bh0</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-229"></span><span>          </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621683006506"><span class="annot"><a href="#local-6989586621683006506"><span class="hs-identifier hs-var hs-var">binaryReader</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ReaderTable a -&gt; SymbolTable a -&gt; BinaryReader a
forall a. ReaderTable a -&gt; SymbolTable a -&gt; BinaryReader a
</span><a href="GHC.Utils.Binary.html#mkReaderFromTable"><span class="hs-identifier hs-var">mkReaderFromTable</span></a></span><span> </span><span class="annot"><span class="annottext">ReaderTable a
</span><a href="#local-6989586621683006501"><span class="hs-identifier hs-var">tbl</span></a></span><span> </span><span class="annot"><span class="annottext">SymbolTable a
</span><a href="#local-6989586621683006503"><span class="hs-identifier hs-var">table</span></a></span><span>
</span><span id="line-230"></span><span>          </span><span class="annot"><span class="hs-identifier hs-type">pure</span></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="annot"><a href="GHC.Utils.Binary.html#addReaderToUserData"><span class="hs-identifier hs-type">addReaderToUserData</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683006506"><span class="hs-identifier hs-type">binaryReader</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683006502"><span class="hs-identifier hs-type">bh0</span></a></span><span>
</span><span id="line-231"></span><span>
</span><span id="line-232"></span><span>    </span><span class="hs-comment">-- Decode all the tables and populate the 'ReaderUserData'.</span><span>
</span><span id="line-233"></span><span>    </span><span id="local-6989586621683006509"><span class="annot"><a href="#local-6989586621683006509"><span class="hs-identifier hs-var">bhFinal</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="hs-identifier hs-type">foldM</span></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span id="local-6989586621683006511"><span class="annot"><span class="annottext">ReadBinHandle
</span><a href="#local-6989586621683006511"><span class="hs-identifier hs-var">bh0</span></a></span></span><span> </span><span id="local-6989586621683006512"><span class="annot"><span class="annottext">ReadBinHandle -&gt; IO ReadBinHandle
</span><a href="#local-6989586621683006512"><span class="hs-identifier hs-var">act</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">ReadBinHandle -&gt; IO ReadBinHandle
</span><a href="#local-6989586621683006512"><span class="hs-identifier hs-var">act</span></a></span><span> </span><span class="annot"><span class="annottext">ReadBinHandle
</span><a href="#local-6989586621683006511"><span class="hs-identifier hs-var">bh0</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><a href="#local-6989586621683006484"><span class="hs-identifier hs-type">bh</span></a></span><span>
</span><span id="line-234"></span><span>      </span><span class="hs-comment">-- The order of these deserialisation matters!</span><span>
</span><span id="line-235"></span><span>      </span><span class="hs-comment">--</span><span>
</span><span id="line-236"></span><span>      </span><span class="hs-comment">-- See Note [Order of deduplication tables during iface binary serialisation] for details.</span><span>
</span><span id="line-237"></span><span>      </span><span class="hs-special">[</span><span> </span><span class="annot"><a href="#local-6989586621683006496"><span class="hs-identifier hs-type">decodeReaderTable</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683006491"><span class="hs-identifier hs-type">fsReaderTable</span></a></span><span>
</span><span id="line-238"></span><span>      </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="#local-6989586621683006496"><span class="hs-identifier hs-type">decodeReaderTable</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683006493"><span class="hs-identifier hs-type">nameReaderTable</span></a></span><span>
</span><span id="line-239"></span><span>      </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="#local-6989586621683006496"><span class="hs-identifier hs-type">decodeReaderTable</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683006495"><span class="hs-identifier hs-type">ifaceTypeReaderTable</span></a></span><span>
</span><span id="line-240"></span><span>      </span><span class="hs-special">]</span><span>
</span><span id="line-241"></span><span>
</span><span id="line-242"></span><span>    </span><span class="annot"><span class="hs-identifier hs-type">writeIORef</span></span><span> </span><span class="annot"><a href="#local-6989586621683006485"><span class="hs-identifier hs-type">bhRef</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Utils.Binary.html#getReaderUserData"><span class="hs-identifier hs-type">getReaderUserData</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683006509"><span class="hs-identifier hs-type">bhFinal</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-243"></span><span>    </span><span class="annot"><span class="hs-identifier hs-type">pure</span></span><span> </span><span class="annot"><a href="#local-6989586621683006509"><span class="hs-identifier hs-type">bhFinal</span></a></span><span>
</span><span id="line-244"></span><span>
</span><span id="line-245"></span><span class="hs-comment">-- | Write an interface file.</span><span>
</span><span id="line-246"></span><span class="hs-comment">--</span><span>
</span><span id="line-247"></span><span class="hs-comment">-- See Note [Deduplication during iface binary serialisation] for details.</span><span>
</span><span id="line-248"></span><span class="annot"><a href="GHC.Iface.Binary.html#writeBinIface"><span class="hs-identifier hs-type">writeBinIface</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Platform.Profile.html#Profile"><span class="hs-identifier hs-type">Profile</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Iface.Binary.html#TraceBinIFace"><span class="hs-identifier hs-type">TraceBinIFace</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Iface.Binary.html#CompressionIFace"><span class="hs-identifier hs-type">CompressionIFace</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">FilePath</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Unit.Module.ModIface.html#ModIface"><span class="hs-identifier hs-type">ModIface</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-249"></span><span id="writeBinIface"><span class="annot"><span class="annottext">writeBinIface :: Profile
-&gt; TraceBinIFace
-&gt; CompressionIFace
-&gt; String
-&gt; ModIface_ 'ModIfaceFinal
-&gt; IO ()
</span><a href="GHC.Iface.Binary.html#writeBinIface"><span class="hs-identifier hs-var hs-var">writeBinIface</span></a></span></span><span> </span><span id="local-6989586621683006515"><span class="annot"><span class="annottext">Profile
</span><a href="#local-6989586621683006515"><span class="hs-identifier hs-var">profile</span></a></span></span><span> </span><span id="local-6989586621683006516"><span class="annot"><span class="annottext">TraceBinIFace
</span><a href="#local-6989586621683006516"><span class="hs-identifier hs-var">traceBinIface</span></a></span></span><span> </span><span id="local-6989586621683006517"><span class="annot"><span class="annottext">CompressionIFace
</span><a href="#local-6989586621683006517"><span class="hs-identifier hs-var">compressionLevel</span></a></span></span><span> </span><span id="local-6989586621683006518"><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621683006518"><span class="hs-identifier hs-var">hi_path</span></a></span></span><span> </span><span id="local-6989586621683006519"><span class="annot"><span class="annottext">ModIface_ 'ModIfaceFinal
</span><a href="#local-6989586621683006519"><span class="hs-identifier hs-var">mod_iface</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-250"></span><span>    </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">TraceBinIFace
</span><a href="#local-6989586621683006516"><span class="hs-identifier hs-var">traceBinIface</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-251"></span><span>      </span><span class="annot"><span class="annottext">TraceBinIFace
</span><a href="GHC.Iface.Binary.html#QuietBinIFace"><span class="hs-identifier hs-var">QuietBinIFace</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">() -&gt; IO ()
forall a. a -&gt; IO a
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">pure</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-252"></span><span>      </span><span class="annot"><a href="GHC.Iface.Binary.html#TraceBinIFace"><span class="hs-identifier hs-type">TraceBinIFace</span></a></span><span> </span><span id="local-6989586621683006520"><span class="annot"><span class="annottext">SDoc -&gt; IO ()
</span><a href="#local-6989586621683006520"><span class="hs-identifier hs-var">printer</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-253"></span><span>        </span><span class="annot"><span class="annottext">SDoc -&gt; IO ()
</span><a href="#local-6989586621683006520"><span class="hs-identifier hs-var">printer</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">String -&gt; SDoc
forall doc. IsLine doc =&gt; String -&gt; doc
</span><a href="GHC.Utils.Outputable.html#text"><span class="hs-identifier hs-var">text</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;writeBinIface compression level:&quot;</span></span><span> </span><span class="annot"><span class="annottext">SDoc -&gt; SDoc -&gt; SDoc
forall doc. IsLine doc =&gt; doc -&gt; doc -&gt; doc
</span><a href="GHC.Utils.Outputable.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">CompressionIFace -&gt; SDoc
forall a. Outputable a =&gt; a -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="annot"><span class="annottext">CompressionIFace
</span><a href="#local-6989586621683006517"><span class="hs-identifier hs-var">compressionLevel</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-254"></span><span>
</span><span id="line-255"></span><span>    </span><span id="local-6989586621683006522"><span class="annot"><a href="#local-6989586621683006522"><span class="hs-identifier hs-var">bh</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Int -&gt; IO WriteBinHandle
</span><a href="GHC.Utils.Binary.html#openBinMem"><span class="hs-identifier hs-var">openBinMem</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="GHC.Iface.Binary.html#initBinMemSize"><span class="hs-identifier hs-var">initBinMemSize</span></a></span><span>
</span><span id="line-256"></span><span>    </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621683006525"><span class="annot"><a href="#local-6989586621683006525"><span class="hs-identifier hs-var hs-var">platform</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Profile -&gt; Platform
</span><a href="GHC.Platform.Profile.html#profilePlatform"><span class="hs-identifier hs-var">profilePlatform</span></a></span><span> </span><span class="annot"><span class="annottext">Profile
</span><a href="#local-6989586621683006515"><span class="hs-identifier hs-var">profile</span></a></span><span>
</span><span id="line-257"></span><span>    </span><span class="annot"><a href="GHC.Utils.Binary.html#put_"><span class="hs-identifier hs-type">put_</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683006522"><span class="hs-identifier hs-type">bh</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Iface.Binary.html#binaryInterfaceMagic"><span class="hs-identifier hs-type">binaryInterfaceMagic</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683006525"><span class="hs-identifier hs-type">platform</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-258"></span><span>
</span><span id="line-259"></span><span>    </span><span class="hs-comment">-- The version, profile tag, and source hash go next</span><span>
</span><span id="line-260"></span><span>    </span><span class="annot"><a href="GHC.Utils.Binary.html#put_"><span class="hs-identifier hs-type">put_</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683006522"><span class="hs-identifier hs-type">bh</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">show</span></span><span> </span><span class="annot"><a href="GHC.Settings.Constants.html#hiVersion"><span class="hs-identifier hs-type">hiVersion</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-261"></span><span>    </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621683006527"><span class="annot"><a href="#local-6989586621683006527"><span class="hs-identifier hs-var hs-var">tag</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Profile -&gt; String
</span><a href="GHC.Platform.Profile.html#profileBuildTag"><span class="hs-identifier hs-var">profileBuildTag</span></a></span><span> </span><span class="annot"><span class="annottext">Profile
</span><a href="#local-6989586621683006515"><span class="hs-identifier hs-var">profile</span></a></span><span>
</span><span id="line-262"></span><span>    </span><span class="annot"><a href="GHC.Utils.Binary.html#put_"><span class="hs-identifier hs-type">put_</span></a></span><span>  </span><span class="annot"><a href="#local-6989586621683006522"><span class="hs-identifier hs-type">bh</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683006527"><span class="hs-identifier hs-type">tag</span></a></span><span>
</span><span id="line-263"></span><span>    </span><span class="annot"><a href="GHC.Utils.Binary.html#put_"><span class="hs-identifier hs-type">put_</span></a></span><span>  </span><span class="annot"><a href="#local-6989586621683006522"><span class="hs-identifier hs-type">bh</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Unit.Module.ModIface.html#mi_src_hash"><span class="hs-identifier hs-var">mi_src_hash</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683006519"><span class="hs-identifier hs-type">mod_iface</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-264"></span><span>
</span><span id="line-265"></span><span>    </span><span class="annot"><a href="GHC.Iface.Binary.html#putIfaceWithExtFields"><span class="hs-identifier hs-type">putIfaceWithExtFields</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683006516"><span class="hs-identifier hs-type">traceBinIface</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683006517"><span class="hs-identifier hs-type">compressionLevel</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683006522"><span class="hs-identifier hs-type">bh</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683006519"><span class="hs-identifier hs-type">mod_iface</span></a></span><span>
</span><span id="line-266"></span><span>
</span><span id="line-267"></span><span>    </span><span class="hs-comment">-- And send the result to the file</span><span>
</span><span id="line-268"></span><span>    </span><span class="annot"><a href="GHC.Utils.Binary.html#writeBinMem"><span class="hs-identifier hs-type">writeBinMem</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683006522"><span class="hs-identifier hs-type">bh</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683006518"><span class="hs-identifier hs-type">hi_path</span></a></span><span>
</span><span id="line-269"></span><span>
</span><span id="line-270"></span><span class="hs-comment">-- | Puts the 'ModIface' to the 'WriteBinHandle'.</span><span>
</span><span id="line-271"></span><span class="hs-comment">--</span><span>
</span><span id="line-272"></span><span class="hs-comment">-- This avoids serialisation of the 'ModIface' if the fields 'mi_hi_bytes' contains a</span><span>
</span><span id="line-273"></span><span class="hs-comment">-- 'Just' value. This field is populated by reading the 'ModIface' using</span><span>
</span><span id="line-274"></span><span class="hs-comment">-- 'getIfaceWithExtFields' and not modifying it in any way afterwards.</span><span>
</span><span id="line-275"></span><span class="annot"><a href="GHC.Iface.Binary.html#putIfaceWithExtFields"><span class="hs-identifier hs-type">putIfaceWithExtFields</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Iface.Binary.html#TraceBinIFace"><span class="hs-identifier hs-type">TraceBinIFace</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Iface.Binary.html#CompressionIFace"><span class="hs-identifier hs-type">CompressionIFace</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Utils.Binary.html#WriteBinHandle"><span class="hs-identifier hs-type">WriteBinHandle</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Unit.Module.ModIface.html#ModIface"><span class="hs-identifier hs-type">ModIface</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-276"></span><span id="putIfaceWithExtFields"><span class="annot"><span class="annottext">putIfaceWithExtFields :: TraceBinIFace
-&gt; CompressionIFace
-&gt; WriteBinHandle
-&gt; ModIface_ 'ModIfaceFinal
-&gt; IO ()
</span><a href="GHC.Iface.Binary.html#putIfaceWithExtFields"><span class="hs-identifier hs-var hs-var">putIfaceWithExtFields</span></a></span></span><span> </span><span id="local-6989586621683006531"><span class="annot"><span class="annottext">TraceBinIFace
</span><a href="#local-6989586621683006531"><span class="hs-identifier hs-var">traceBinIface</span></a></span></span><span> </span><span id="local-6989586621683006532"><span class="annot"><span class="annottext">CompressionIFace
</span><a href="#local-6989586621683006532"><span class="hs-identifier hs-var">compressionLevel</span></a></span></span><span> </span><span id="local-6989586621683006533"><span class="annot"><span class="annottext">WriteBinHandle
</span><a href="#local-6989586621683006533"><span class="hs-identifier hs-var">bh</span></a></span></span><span> </span><span id="local-6989586621683006534"><span class="annot"><span class="annottext">ModIface_ 'ModIfaceFinal
</span><a href="#local-6989586621683006534"><span class="hs-identifier hs-var">mod_iface</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-277"></span><span>  </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">ModIface_ 'ModIfaceFinal -&gt; IfaceBinHandle 'ModIfaceFinal
forall (phase :: ModIfacePhase).
ModIface_ phase -&gt; IfaceBinHandle phase
</span><a href="GHC.Unit.Module.ModIface.html#mi_hi_bytes"><span class="hs-identifier hs-var">mi_hi_bytes</span></a></span><span> </span><span class="annot"><span class="annottext">ModIface_ 'ModIfaceFinal
</span><a href="#local-6989586621683006534"><span class="hs-identifier hs-var">mod_iface</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-278"></span><span>    </span><span class="annot"><a href="GHC.Unit.Module.ModIface.html#FullIfaceBinHandle"><span class="hs-identifier hs-type">FullIfaceBinHandle</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe FullBinData
</span><a href="GHC.Data.Strict.html#Nothing"><span class="hs-identifier hs-var">Strict.Nothing</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-279"></span><span>      </span><span class="annot"><span class="annottext">WriteBinHandle -&gt; (() -&gt; IO ()) -&gt; IO () -&gt; IO ()
forall b a. WriteBinHandle -&gt; (b -&gt; IO a) -&gt; IO b -&gt; IO ()
</span><a href="GHC.Utils.Binary.html#forwardPutRel_"><span class="hs-identifier hs-var">forwardPutRel_</span></a></span><span> </span><span class="annot"><span class="annottext">WriteBinHandle
</span><a href="#local-6989586621683006533"><span class="hs-identifier hs-var">bh</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span class="annot"><span class="annottext">()
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">WriteBinHandle -&gt; ExtensibleFields -&gt; IO ()
forall a. Binary a =&gt; WriteBinHandle -&gt; a -&gt; IO ()
</span><a href="GHC.Utils.Binary.html#put_"><span class="hs-identifier hs-var">put_</span></a></span><span> </span><span class="annot"><span class="annottext">WriteBinHandle
</span><a href="#local-6989586621683006533"><span class="hs-identifier hs-var">bh</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ModIface_ 'ModIfaceFinal -&gt; ExtensibleFields
forall (phase :: ModIfacePhase).
ModIface_ phase -&gt; ExtensibleFields
</span><a href="GHC.Unit.Module.ModIface.html#mi_ext_fields"><span class="hs-identifier hs-var">mi_ext_fields</span></a></span><span> </span><span class="annot"><span class="annottext">ModIface_ 'ModIfaceFinal
</span><a href="#local-6989586621683006534"><span class="hs-identifier hs-var">mod_iface</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(IO () -&gt; IO ()) -&gt; IO () -&gt; IO ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-280"></span><span>        </span><span class="annot"><span class="annottext">TraceBinIFace
-&gt; CompressionIFace
-&gt; WriteBinHandle
-&gt; ModIface_ 'ModIfaceFinal
-&gt; IO ()
forall a.
Binary a =&gt;
TraceBinIFace -&gt; CompressionIFace -&gt; WriteBinHandle -&gt; a -&gt; IO ()
</span><a href="GHC.Iface.Binary.html#putWithUserData"><span class="hs-identifier hs-var">putWithUserData</span></a></span><span> </span><span class="annot"><span class="annottext">TraceBinIFace
</span><a href="#local-6989586621683006531"><span class="hs-identifier hs-var">traceBinIface</span></a></span><span> </span><span class="annot"><span class="annottext">CompressionIFace
</span><a href="#local-6989586621683006532"><span class="hs-identifier hs-var">compressionLevel</span></a></span><span> </span><span class="annot"><span class="annottext">WriteBinHandle
</span><a href="#local-6989586621683006533"><span class="hs-identifier hs-var">bh</span></a></span><span> </span><span class="annot"><span class="annottext">ModIface_ 'ModIfaceFinal
</span><a href="#local-6989586621683006534"><span class="hs-identifier hs-var">mod_iface</span></a></span><span>
</span><span id="line-281"></span><span>    </span><span class="annot"><a href="GHC.Unit.Module.ModIface.html#FullIfaceBinHandle"><span class="hs-identifier hs-type">FullIfaceBinHandle</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Data.Strict.html#Just"><span class="hs-identifier hs-type">Strict.Just</span></a></span><span> </span><span id="local-6989586621683006542"><span class="annot"><span class="annottext">FullBinData
</span><a href="#local-6989586621683006542"><span class="hs-identifier hs-var">binData</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">WriteBinHandle -&gt; FullBinData -&gt; IO ()
</span><a href="GHC.Utils.Binary.html#putFullBinData"><span class="hs-identifier hs-var">putFullBinData</span></a></span><span> </span><span class="annot"><span class="annottext">WriteBinHandle
</span><a href="#local-6989586621683006533"><span class="hs-identifier hs-var">bh</span></a></span><span> </span><span class="annot"><span class="annottext">FullBinData
</span><a href="#local-6989586621683006542"><span class="hs-identifier hs-var">binData</span></a></span><span>
</span><span id="line-282"></span><span>
</span><span id="line-283"></span><span class="hs-comment">-- | Put a piece of data with an initialised `UserData` field. This</span><span>
</span><span id="line-284"></span><span class="hs-comment">-- is necessary if you want to serialise Names or FastStrings.</span><span>
</span><span id="line-285"></span><span class="hs-comment">-- It also writes a symbol table and the dictionary.</span><span>
</span><span id="line-286"></span><span class="hs-comment">-- This segment should be read using `getWithUserData`.</span><span>
</span><span id="line-287"></span><span id="local-6989586621683005911"><span class="annot"><a href="GHC.Iface.Binary.html#putWithUserData"><span class="hs-identifier hs-type">putWithUserData</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Utils.Binary.html#Binary"><span class="hs-identifier hs-type">Binary</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683005911"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="GHC.Iface.Binary.html#TraceBinIFace"><span class="hs-identifier hs-type">TraceBinIFace</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Iface.Binary.html#CompressionIFace"><span class="hs-identifier hs-type">CompressionIFace</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Utils.Binary.html#WriteBinHandle"><span class="hs-identifier hs-type">WriteBinHandle</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621683005911"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span></span><span>
</span><span id="line-288"></span><span id="putWithUserData"><span class="annot"><span class="annottext">putWithUserData :: forall a.
Binary a =&gt;
TraceBinIFace -&gt; CompressionIFace -&gt; WriteBinHandle -&gt; a -&gt; IO ()
</span><a href="GHC.Iface.Binary.html#putWithUserData"><span class="hs-identifier hs-var hs-var">putWithUserData</span></a></span></span><span> </span><span id="local-6989586621683006565"><span class="annot"><span class="annottext">TraceBinIFace
</span><a href="#local-6989586621683006565"><span class="hs-identifier hs-var">traceBinIface</span></a></span></span><span> </span><span id="local-6989586621683006566"><span class="annot"><span class="annottext">CompressionIFace
</span><a href="#local-6989586621683006566"><span class="hs-identifier hs-var">compressionLevel</span></a></span></span><span> </span><span id="local-6989586621683006567"><span class="annot"><span class="annottext">WriteBinHandle
</span><a href="#local-6989586621683006567"><span class="hs-identifier hs-var">bh</span></a></span></span><span> </span><span id="local-6989586621683006568"><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621683006568"><span class="hs-identifier hs-var">payload</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-289"></span><span>  </span><span class="hs-special">(</span><span id="local-6989586621683006569"><span class="annot"><a href="#local-6989586621683006569"><span class="hs-identifier hs-var">name_count</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621683006570"><span class="annot"><a href="#local-6989586621683006570"><span class="hs-identifier hs-var">fs_count</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621683006571"><span class="annot"><a href="#local-6989586621683006571"><span class="hs-identifier hs-var">ifacetype_count</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621683006572"><span class="annot"><a href="#local-6989586621683006572"><span class="hs-identifier hs-var">_b</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">CompressionIFace
-&gt; WriteBinHandle
-&gt; (WriteBinHandle -&gt; IO (Bin a))
-&gt; IO (Int, Int, Int, Bin a)
forall b.
CompressionIFace
-&gt; WriteBinHandle
-&gt; (WriteBinHandle -&gt; IO b)
-&gt; IO (Int, Int, Int, b)
</span><a href="GHC.Iface.Binary.html#putWithTables"><span class="hs-identifier hs-var">putWithTables</span></a></span><span> </span><span class="annot"><span class="annottext">CompressionIFace
</span><a href="#local-6989586621683006566"><span class="hs-identifier hs-var">compressionLevel</span></a></span><span> </span><span class="annot"><span class="annottext">WriteBinHandle
</span><a href="#local-6989586621683006567"><span class="hs-identifier hs-var">bh</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span id="local-6989586621683006574"><span class="annot"><span class="annottext">WriteBinHandle
</span><a href="#local-6989586621683006574"><span class="hs-identifier hs-var">bh'</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">WriteBinHandle -&gt; a -&gt; IO (Bin a)
forall a. Binary a =&gt; WriteBinHandle -&gt; a -&gt; IO (Bin a)
</span><a href="GHC.Utils.Binary.html#put"><span class="hs-identifier hs-var">put</span></a></span><span> </span><span class="annot"><span class="annottext">WriteBinHandle
</span><a href="#local-6989586621683006574"><span class="hs-identifier hs-var">bh'</span></a></span><span> </span><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621683006568"><span class="hs-identifier hs-var">payload</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-290"></span><span>
</span><span id="line-291"></span><span>  </span><span class="hs-keyword">case</span><span> </span><span class="annot"><a href="#local-6989586621683006565"><span class="hs-identifier hs-type">traceBinIface</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-292"></span><span>    </span><span class="annot"><span class="annottext">TraceBinIFace
</span><a href="GHC.Iface.Binary.html#QuietBinIFace"><span class="hs-identifier hs-var">QuietBinIFace</span></a></span><span>         </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">() -&gt; IO ()
forall a. a -&gt; IO a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-293"></span><span>    </span><span class="annot"><a href="GHC.Iface.Binary.html#TraceBinIFace"><span class="hs-identifier hs-type">TraceBinIFace</span></a></span><span> </span><span id="local-6989586621683006576"><span class="annot"><span class="annottext">SDoc -&gt; IO ()
</span><a href="#local-6989586621683006576"><span class="hs-identifier hs-var">printer</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-294"></span><span>       </span><span class="annot"><span class="annottext">SDoc -&gt; IO ()
</span><a href="#local-6989586621683006576"><span class="hs-identifier hs-var">printer</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">String -&gt; SDoc
forall doc. IsLine doc =&gt; String -&gt; doc
</span><a href="GHC.Utils.Outputable.html#text"><span class="hs-identifier hs-var">text</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;writeBinIface:&quot;</span></span><span> </span><span class="annot"><span class="annottext">SDoc -&gt; SDoc -&gt; SDoc
forall doc. IsLine doc =&gt; doc -&gt; doc -&gt; doc
</span><a href="GHC.Utils.Outputable.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">Int -&gt; SDoc
forall doc. IsLine doc =&gt; Int -&gt; doc
</span><a href="GHC.Utils.Outputable.html#int"><span class="hs-identifier hs-var">int</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621683006569"><span class="hs-identifier hs-var">name_count</span></a></span><span>
</span><span id="line-295"></span><span>                                      </span><span class="annot"><span class="annottext">SDoc -&gt; SDoc -&gt; SDoc
forall doc. IsLine doc =&gt; doc -&gt; doc -&gt; doc
</span><a href="GHC.Utils.Outputable.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">String -&gt; SDoc
forall doc. IsLine doc =&gt; String -&gt; doc
</span><a href="GHC.Utils.Outputable.html#text"><span class="hs-identifier hs-var">text</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;Names&quot;</span></span><span class="hs-special">)</span><span>
</span><span id="line-296"></span><span>       </span><span class="annot"><span class="annottext">SDoc -&gt; IO ()
</span><a href="#local-6989586621683006576"><span class="hs-identifier hs-var">printer</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">String -&gt; SDoc
forall doc. IsLine doc =&gt; String -&gt; doc
</span><a href="GHC.Utils.Outputable.html#text"><span class="hs-identifier hs-var">text</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;writeBinIface:&quot;</span></span><span> </span><span class="annot"><span class="annottext">SDoc -&gt; SDoc -&gt; SDoc
forall doc. IsLine doc =&gt; doc -&gt; doc -&gt; doc
</span><a href="GHC.Utils.Outputable.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">Int -&gt; SDoc
forall doc. IsLine doc =&gt; Int -&gt; doc
</span><a href="GHC.Utils.Outputable.html#int"><span class="hs-identifier hs-var">int</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621683006570"><span class="hs-identifier hs-var">fs_count</span></a></span><span>
</span><span id="line-297"></span><span>                                      </span><span class="annot"><span class="annottext">SDoc -&gt; SDoc -&gt; SDoc
forall doc. IsLine doc =&gt; doc -&gt; doc -&gt; doc
</span><a href="GHC.Utils.Outputable.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">String -&gt; SDoc
forall doc. IsLine doc =&gt; String -&gt; doc
</span><a href="GHC.Utils.Outputable.html#text"><span class="hs-identifier hs-var">text</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;dict entries&quot;</span></span><span class="hs-special">)</span><span>
</span><span id="line-298"></span><span>       </span><span class="annot"><span class="annottext">SDoc -&gt; IO ()
</span><a href="#local-6989586621683006576"><span class="hs-identifier hs-var">printer</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">String -&gt; SDoc
forall doc. IsLine doc =&gt; String -&gt; doc
</span><a href="GHC.Utils.Outputable.html#text"><span class="hs-identifier hs-var">text</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;writeBinIface:&quot;</span></span><span> </span><span class="annot"><span class="annottext">SDoc -&gt; SDoc -&gt; SDoc
forall doc. IsLine doc =&gt; doc -&gt; doc -&gt; doc
</span><a href="GHC.Utils.Outputable.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">Int -&gt; SDoc
forall doc. IsLine doc =&gt; Int -&gt; doc
</span><a href="GHC.Utils.Outputable.html#int"><span class="hs-identifier hs-var">int</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621683006571"><span class="hs-identifier hs-var">ifacetype_count</span></a></span><span>
</span><span id="line-299"></span><span>                                      </span><span class="annot"><span class="annottext">SDoc -&gt; SDoc -&gt; SDoc
forall doc. IsLine doc =&gt; doc -&gt; doc -&gt; doc
</span><a href="GHC.Utils.Outputable.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">String -&gt; SDoc
forall doc. IsLine doc =&gt; String -&gt; doc
</span><a href="GHC.Utils.Outputable.html#text"><span class="hs-identifier hs-var">text</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;iface type entries&quot;</span></span><span class="hs-special">)</span><span>
</span><span id="line-300"></span><span>
</span><span id="line-301"></span><span class="hs-comment">-- | Write name/symbol/ifacetype tables</span><span>
</span><span id="line-302"></span><span class="hs-comment">--</span><span>
</span><span id="line-303"></span><span class="hs-comment">-- 1. setup the given BinHandle with Name/FastString/IfaceType table handling</span><span>
</span><span id="line-304"></span><span class="hs-comment">-- 2. write the following</span><span>
</span><span id="line-305"></span><span class="hs-comment">--    - FastString table pointer</span><span>
</span><span id="line-306"></span><span class="hs-comment">--    - Name table pointer</span><span>
</span><span id="line-307"></span><span class="hs-comment">--    - IfaceType table pointer</span><span>
</span><span id="line-308"></span><span class="hs-comment">--    - payload</span><span>
</span><span id="line-309"></span><span class="hs-comment">--    - IfaceType table</span><span>
</span><span id="line-310"></span><span class="hs-comment">--    - Name table</span><span>
</span><span id="line-311"></span><span class="hs-comment">--    - FastString table</span><span>
</span><span id="line-312"></span><span class="hs-comment">--</span><span>
</span><span id="line-313"></span><span class="hs-comment">-- It returns (number of names, number of FastStrings, number of IfaceTypes, payload write result)</span><span>
</span><span id="line-314"></span><span class="hs-comment">--</span><span>
</span><span id="line-315"></span><span class="hs-comment">-- See Note [Order of deduplication tables during iface binary serialisation]</span><span>
</span><span id="line-316"></span><span id="local-6989586621683005913"><span class="annot"><a href="GHC.Iface.Binary.html#putWithTables"><span class="hs-identifier hs-type">putWithTables</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Iface.Binary.html#CompressionIFace"><span class="hs-identifier hs-type">CompressionIFace</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Utils.Binary.html#WriteBinHandle"><span class="hs-identifier hs-type">WriteBinHandle</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Utils.Binary.html#WriteBinHandle"><span class="hs-identifier hs-type">WriteBinHandle</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="annot"><a href="#local-6989586621683005913"><span class="hs-identifier hs-type">b</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Int</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Int</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Int</span></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="#local-6989586621683005913"><span class="hs-identifier hs-type">b</span></a></span><span class="hs-special">)</span></span><span>
</span><span id="line-317"></span><span id="putWithTables"><span class="annot"><span class="annottext">putWithTables :: forall b.
CompressionIFace
-&gt; WriteBinHandle
-&gt; (WriteBinHandle -&gt; IO b)
-&gt; IO (Int, Int, Int, b)
</span><a href="GHC.Iface.Binary.html#putWithTables"><span class="hs-identifier hs-var hs-var">putWithTables</span></a></span></span><span> </span><span id="local-6989586621683006589"><span class="annot"><span class="annottext">CompressionIFace
</span><a href="#local-6989586621683006589"><span class="hs-identifier hs-var">compressionLevel</span></a></span></span><span> </span><span id="local-6989586621683006590"><span class="annot"><span class="annottext">WriteBinHandle
</span><a href="#local-6989586621683006590"><span class="hs-identifier hs-var">bh'</span></a></span></span><span> </span><span id="local-6989586621683006591"><span class="annot"><span class="annottext">WriteBinHandle -&gt; IO b
</span><a href="#local-6989586621683006591"><span class="hs-identifier hs-var">put_payload</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-318"></span><span>  </span><span class="hs-comment">-- Initialise deduplicating tables.</span><span>
</span><span id="line-319"></span><span>  </span><span class="hs-special">(</span><span id="local-6989586621683006592"><span class="annot"><a href="#local-6989586621683006592"><span class="hs-identifier hs-var">fast_wt</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621683006593"><span class="annot"><a href="#local-6989586621683006593"><span class="hs-identifier hs-var">fsWriter</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">IO (WriterTable, BinaryWriter FastString)
</span><a href="GHC.Utils.Binary.html#initFastStringWriterTable"><span class="hs-identifier hs-var">initFastStringWriterTable</span></a></span><span>
</span><span id="line-320"></span><span>  </span><span class="hs-special">(</span><span id="local-6989586621683006595"><span class="annot"><a href="#local-6989586621683006595"><span class="hs-identifier hs-var">name_wt</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621683006596"><span class="annot"><a href="#local-6989586621683006596"><span class="hs-identifier hs-var">nameWriter</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><a href="GHC.Iface.Binary.html#initNameWriterTable"><span class="hs-identifier hs-type">initNameWriterTable</span></a></span><span>
</span><span id="line-321"></span><span>  </span><span class="hs-special">(</span><span id="local-6989586621683006598"><span class="annot"><a href="#local-6989586621683006598"><span class="hs-identifier hs-var">ifaceType_wt</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621683006599"><span class="annot"><a href="#local-6989586621683006599"><span class="hs-identifier hs-var">ifaceTypeWriter</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><a href="GHC.Iface.Binary.html#initWriteIfaceType"><span class="hs-identifier hs-type">initWriteIfaceType</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683006589"><span class="hs-identifier hs-type">compressionLevel</span></a></span><span>
</span><span id="line-322"></span><span>
</span><span id="line-323"></span><span>  </span><span class="hs-comment">-- Initialise the 'WriterUserData'.</span><span>
</span><span id="line-324"></span><span>  </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621683006600"><span class="annot"><a href="#local-6989586621683006600"><span class="hs-identifier hs-var hs-var">writerUserData</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[SomeBinaryWriter] -&gt; WriterUserData
</span><a href="GHC.Utils.Binary.html#mkWriterUserData"><span class="hs-identifier hs-var">mkWriterUserData</span></a></span><span>
</span><span id="line-325"></span><span>        </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">forall a. Typeable a =&gt; BinaryWriter a -&gt; SomeBinaryWriter
</span><a href="GHC.Utils.Binary.html#mkSomeBinaryWriter"><span class="hs-identifier hs-var">mkSomeBinaryWriter</span></a></span><span> </span><span class="hs-glyph">@</span><span class="annot"><a href="GHC.Data.FastString.html#FastString"><span class="hs-identifier hs-type">FastString</span></a></span><span> </span><span class="annot"><span class="annottext">BinaryWriter FastString
</span><a href="#local-6989586621683006593"><span class="hs-identifier hs-var">fsWriter</span></a></span><span>
</span><span id="line-326"></span><span>        </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">forall a. Typeable a =&gt; BinaryWriter a -&gt; SomeBinaryWriter
</span><a href="GHC.Utils.Binary.html#mkSomeBinaryWriter"><span class="hs-identifier hs-var">mkSomeBinaryWriter</span></a></span><span> </span><span class="hs-glyph">@</span><span class="annot"><a href="GHC.Types.Name.html#Name"><span class="hs-identifier hs-type">Name</span></a></span><span> </span><span class="annot"><span class="annottext">BinaryWriter Name
</span><a href="#local-6989586621683006596"><span class="hs-identifier hs-var">nameWriter</span></a></span><span>
</span><span id="line-327"></span><span>        </span><span class="hs-comment">-- We sometimes serialise binding and non-binding names differently, but</span><span>
</span><span id="line-328"></span><span>        </span><span class="hs-comment">-- not during 'ModIface' serialisation. Here, we serialise both to the same</span><span>
</span><span id="line-329"></span><span>        </span><span class="hs-comment">-- deduplication table.</span><span>
</span><span id="line-330"></span><span>        </span><span class="hs-comment">--</span><span>
</span><span id="line-331"></span><span>        </span><span class="hs-comment">-- See Note [Binary UserData]</span><span>
</span><span id="line-332"></span><span>        </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">forall a. Typeable a =&gt; BinaryWriter a -&gt; SomeBinaryWriter
</span><a href="GHC.Utils.Binary.html#mkSomeBinaryWriter"><span class="hs-identifier hs-var">mkSomeBinaryWriter</span></a></span><span> </span><span class="hs-glyph">@</span><span class="annot"><a href="GHC.Utils.Binary.html#BindingName"><span class="hs-identifier hs-type">BindingName</span></a></span><span>  </span><span class="annot"><span class="annottext">(BinaryWriter BindingName -&gt; SomeBinaryWriter)
-&gt; BinaryWriter BindingName -&gt; SomeBinaryWriter
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">(WriteBinHandle -&gt; BindingName -&gt; IO ())
-&gt; BinaryWriter BindingName
forall s. (WriteBinHandle -&gt; s -&gt; IO ()) -&gt; BinaryWriter s
</span><a href="GHC.Utils.Binary.html#mkWriter"><span class="hs-identifier hs-var">mkWriter</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span id="local-6989586621683006604"><span class="annot"><span class="annottext">WriteBinHandle
</span><a href="#local-6989586621683006604"><span class="hs-identifier hs-var">bh</span></a></span></span><span> </span><span id="local-6989586621683006605"><span class="annot"><span class="annottext">BindingName
</span><a href="#local-6989586621683006605"><span class="hs-identifier hs-var">name</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">BinaryWriter Name -&gt; WriteBinHandle -&gt; Name -&gt; IO ()
forall s. BinaryWriter s -&gt; WriteBinHandle -&gt; s -&gt; IO ()
</span><a href="GHC.Utils.Binary.html#putEntry"><span class="hs-identifier hs-var">putEntry</span></a></span><span> </span><span class="annot"><span class="annottext">BinaryWriter Name
</span><a href="#local-6989586621683006596"><span class="hs-identifier hs-var">nameWriter</span></a></span><span> </span><span class="annot"><span class="annottext">WriteBinHandle
</span><a href="#local-6989586621683006604"><span class="hs-identifier hs-var">bh</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">BindingName -&gt; Name
</span><a href="GHC.Utils.Binary.html#getBindingName"><span class="hs-identifier hs-var">getBindingName</span></a></span><span> </span><span class="annot"><span class="annottext">BindingName
</span><a href="#local-6989586621683006605"><span class="hs-identifier hs-var">name</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-333"></span><span>        </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">forall a. Typeable a =&gt; BinaryWriter a -&gt; SomeBinaryWriter
</span><a href="GHC.Utils.Binary.html#mkSomeBinaryWriter"><span class="hs-identifier hs-var">mkSomeBinaryWriter</span></a></span><span> </span><span class="hs-glyph">@</span><span class="annot"><a href="GHC.Iface.Type.html#IfaceType"><span class="hs-identifier hs-type">IfaceType</span></a></span><span> </span><span class="annot"><span class="annottext">BinaryWriter IfaceType
</span><a href="#local-6989586621683006599"><span class="hs-identifier hs-var">ifaceTypeWriter</span></a></span><span>
</span><span id="line-334"></span><span>        </span><span class="hs-special">]</span><span>
</span><span id="line-335"></span><span>  </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621683006608"><span class="annot"><a href="#local-6989586621683006608"><span class="hs-identifier hs-var hs-var">bh</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">WriteBinHandle -&gt; WriterUserData -&gt; WriteBinHandle
</span><a href="GHC.Utils.Binary.html#setWriterUserData"><span class="hs-identifier hs-var">setWriterUserData</span></a></span><span> </span><span class="annot"><span class="annottext">WriteBinHandle
</span><a href="#local-6989586621683006590"><span class="hs-identifier hs-var">bh'</span></a></span><span> </span><span class="annot"><span class="annottext">WriterUserData
</span><a href="#local-6989586621683006600"><span class="hs-identifier hs-var">writerUserData</span></a></span><span>
</span><span id="line-336"></span><span>
</span><span id="line-337"></span><span>  </span><span class="hs-special">(</span><span class="hs-special">[</span><span id="local-6989586621683006610"><span class="annot"><a href="#local-6989586621683006610"><span class="hs-identifier hs-var">fs_count</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621683006611"><span class="annot"><a href="#local-6989586621683006611"><span class="hs-identifier hs-var">name_count</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621683006612"><span class="annot"><a href="#local-6989586621683006612"><span class="hs-identifier hs-var">ifacetype_count</span></a></span></span><span class="hs-special">]</span><span> </span><span class="hs-special">,</span><span> </span><span id="local-6989586621683006613"><span class="annot"><a href="#local-6989586621683006613"><span class="hs-identifier hs-var">r</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span>
</span><span id="line-338"></span><span>    </span><span class="hs-comment">-- The order of these entries matters!</span><span>
</span><span id="line-339"></span><span>    </span><span class="hs-comment">--</span><span>
</span><span id="line-340"></span><span>    </span><span class="hs-comment">-- See Note [Order of deduplication tables during iface binary serialisation] for details.</span><span>
</span><span id="line-341"></span><span>    </span><span class="annot"><a href="GHC.Iface.Binary.html#putAllTables"><span class="hs-identifier hs-type">putAllTables</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683006608"><span class="hs-identifier hs-type">bh</span></a></span><span> </span><span class="hs-special">[</span><span class="annot"><a href="#local-6989586621683006592"><span class="hs-identifier hs-type">fast_wt</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="#local-6989586621683006595"><span class="hs-identifier hs-type">name_wt</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="#local-6989586621683006598"><span class="hs-identifier hs-type">ifaceType_wt</span></a></span><span class="hs-special">]</span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-342"></span><span>      </span><span class="annot"><a href="#local-6989586621683006591"><span class="hs-identifier hs-type">put_payload</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683006608"><span class="hs-identifier hs-type">bh</span></a></span><span>
</span><span id="line-343"></span><span>
</span><span id="line-344"></span><span>  </span><span class="annot"><span class="hs-identifier hs-type">return</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621683006611"><span class="hs-identifier hs-type">name_count</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="#local-6989586621683006610"><span class="hs-identifier hs-type">fs_count</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="#local-6989586621683006612"><span class="hs-identifier hs-type">ifacetype_count</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="#local-6989586621683006613"><span class="hs-identifier hs-type">r</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-345"></span><span>
</span><span id="line-346"></span><span class="hs-comment">-- | Write all deduplication tables to disk after serialising the</span><span>
</span><span id="line-347"></span><span class="hs-comment">-- main payload.</span><span>
</span><span id="line-348"></span><span class="hs-comment">--</span><span>
</span><span id="line-349"></span><span class="hs-comment">-- Writes forward pointers to the deduplication tables before writing the payload</span><span>
</span><span id="line-350"></span><span class="hs-comment">-- to allow deserialisation *before* the payload is read again.</span><span>
</span><span id="line-351"></span><span id="local-6989586621683005924"><span class="annot"><a href="GHC.Iface.Binary.html#putAllTables"><span class="hs-identifier hs-type">putAllTables</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Utils.Binary.html#WriteBinHandle"><span class="hs-identifier hs-type">WriteBinHandle</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="GHC.Utils.Binary.html#WriterTable"><span class="hs-identifier hs-type">WriterTable</span></a></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="annot"><a href="#local-6989586621683005924"><span class="hs-identifier hs-type">b</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">[</span><span class="annot"><span class="hs-identifier hs-type">Int</span></span><span class="hs-special">]</span><span class="hs-special">,</span><span> </span><span class="annot"><a href="#local-6989586621683005924"><span class="hs-identifier hs-type">b</span></a></span><span class="hs-special">)</span></span><span>
</span><span id="line-352"></span><span id="putAllTables"><span class="annot"><span class="annottext">putAllTables :: forall b. WriteBinHandle -&gt; [WriterTable] -&gt; IO b -&gt; IO ([Int], b)
</span><a href="GHC.Iface.Binary.html#putAllTables"><span class="hs-identifier hs-var hs-var">putAllTables</span></a></span></span><span> </span><span class="annot"><span class="annottext">WriteBinHandle
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><span id="local-6989586621683006618"><span class="annot"><span class="annottext">IO b
</span><a href="#local-6989586621683006618"><span class="hs-identifier hs-var">act</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-353"></span><span>  </span><span id="local-6989586621683006619"><span class="annot"><a href="#local-6989586621683006619"><span class="hs-identifier hs-var">a</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">IO b
</span><a href="#local-6989586621683006618"><span class="hs-identifier hs-var">act</span></a></span><span>
</span><span id="line-354"></span><span>  </span><span class="annot"><span class="hs-identifier hs-type">pure</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">[</span><span class="hs-special">]</span><span class="hs-special">,</span><span> </span><span class="annot"><a href="#local-6989586621683006619"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-355"></span><span class="annot"><a href="GHC.Iface.Binary.html#putAllTables"><span class="hs-identifier hs-var">putAllTables</span></a></span><span> </span><span id="local-6989586621683006620"><span class="annot"><span class="annottext">WriteBinHandle
</span><a href="#local-6989586621683006620"><span class="hs-identifier hs-var">bh</span></a></span></span><span> </span><span class="hs-special">(</span><span id="local-6989586621683006621"><span class="annot"><span class="annottext">WriterTable
</span><a href="#local-6989586621683006621"><span class="hs-identifier hs-var">x</span></a></span></span><span> </span><span class="annot"><span class="hs-glyph hs-type">:</span></span><span> </span><span id="local-6989586621683006622"><span class="annot"><span class="annottext">[WriterTable]
</span><a href="#local-6989586621683006622"><span class="hs-identifier hs-var">xs</span></a></span></span><span class="hs-special">)</span><span> </span><span id="local-6989586621683006623"><span class="annot"><span class="annottext">IO b
</span><a href="#local-6989586621683006623"><span class="hs-identifier hs-var">act</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-356"></span><span>  </span><span class="hs-special">(</span><span id="local-6989586621683006624"><span class="annot"><a href="#local-6989586621683006624"><span class="hs-identifier hs-var">r</span></a></span></span><span class="hs-special">,</span><span> </span><span class="hs-special">(</span><span id="local-6989586621683006625"><span class="annot"><a href="#local-6989586621683006625"><span class="hs-identifier hs-var">res</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621683006626"><span class="annot"><a href="#local-6989586621683006626"><span class="hs-identifier hs-var">a</span></a></span></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">WriteBinHandle
-&gt; (([Int], b) -&gt; IO Int) -&gt; IO ([Int], b) -&gt; IO (Int, ([Int], b))
forall b a. WriteBinHandle -&gt; (b -&gt; IO a) -&gt; IO b -&gt; IO (a, b)
</span><a href="GHC.Utils.Binary.html#forwardPutRel"><span class="hs-identifier hs-var">forwardPutRel</span></a></span><span> </span><span class="annot"><span class="annottext">WriteBinHandle
</span><a href="#local-6989586621683006620"><span class="hs-identifier hs-var">bh</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">IO Int -&gt; ([Int], b) -&gt; IO Int
forall a b. a -&gt; b -&gt; a
</span><span class="hs-identifier hs-var">const</span></span><span> </span><span class="annot"><span class="annottext">(IO Int -&gt; ([Int], b) -&gt; IO Int) -&gt; IO Int -&gt; ([Int], b) -&gt; IO Int
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">WriterTable -&gt; WriteBinHandle -&gt; IO Int
</span><a href="GHC.Utils.Binary.html#putTable"><span class="hs-identifier hs-var">putTable</span></a></span><span> </span><span class="annot"><span class="annottext">WriterTable
</span><a href="#local-6989586621683006621"><span class="hs-identifier hs-var">x</span></a></span><span> </span><span class="annot"><span class="annottext">WriteBinHandle
</span><a href="#local-6989586621683006620"><span class="hs-identifier hs-var">bh</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(IO ([Int], b) -&gt; IO (Int, ([Int], b)))
-&gt; IO ([Int], b) -&gt; IO (Int, ([Int], b))
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-357"></span><span>    </span><span class="annot"><span class="annottext">WriteBinHandle -&gt; [WriterTable] -&gt; IO b -&gt; IO ([Int], b)
forall b. WriteBinHandle -&gt; [WriterTable] -&gt; IO b -&gt; IO ([Int], b)
</span><a href="GHC.Iface.Binary.html#putAllTables"><span class="hs-identifier hs-var">putAllTables</span></a></span><span> </span><span class="annot"><span class="annottext">WriteBinHandle
</span><a href="#local-6989586621683006620"><span class="hs-identifier hs-var">bh</span></a></span><span> </span><span class="annot"><span class="annottext">[WriterTable]
</span><a href="#local-6989586621683006622"><span class="hs-identifier hs-var">xs</span></a></span><span> </span><span class="annot"><span class="annottext">IO b
</span><a href="#local-6989586621683006623"><span class="hs-identifier hs-var">act</span></a></span><span>
</span><span id="line-358"></span><span>  </span><span class="annot"><span class="hs-identifier hs-type">pure</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621683006624"><span class="hs-identifier hs-type">r</span></a></span><span> </span><span class="annot"><span class="hs-glyph hs-type">:</span></span><span> </span><span class="annot"><a href="#local-6989586621683006625"><span class="hs-identifier hs-type">res</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="#local-6989586621683006626"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-359"></span><span>
</span><span id="line-360"></span><span class="annot"><span class="hs-comment">-- | Initial ram buffer to allocate for writing interface files</span></span><span>
</span><span id="line-361"></span><span class="annot"><a href="GHC.Iface.Binary.html#initBinMemSize"><span class="hs-identifier hs-type">initBinMemSize</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Int</span></span><span>
</span><span id="line-362"></span><span id="initBinMemSize"><span class="annot"><span class="annottext">initBinMemSize :: Int
</span><a href="GHC.Iface.Binary.html#initBinMemSize"><span class="hs-identifier hs-var hs-var">initBinMemSize</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">1024</span></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Int
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">*</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">1024</span></span><span>
</span><span id="line-363"></span><span>
</span><span id="line-364"></span><span class="annot"><a href="GHC.Iface.Binary.html#binaryInterfaceMagic"><span class="hs-identifier hs-type">binaryInterfaceMagic</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Platform.html#Platform"><span class="hs-identifier hs-type">Platform</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Utils.Binary.html#FixedLengthEncoding"><span class="hs-identifier hs-type">FixedLengthEncoding</span></a></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Word32</span></span><span>
</span><span id="line-365"></span><span id="binaryInterfaceMagic"><span class="annot"><span class="annottext">binaryInterfaceMagic :: Platform -&gt; FixedLengthEncoding Word32
</span><a href="GHC.Iface.Binary.html#binaryInterfaceMagic"><span class="hs-identifier hs-var hs-var">binaryInterfaceMagic</span></a></span></span><span> </span><span id="local-6989586621683006631"><span class="annot"><span class="annottext">Platform
</span><a href="#local-6989586621683006631"><span class="hs-identifier hs-var">platform</span></a></span></span><span>
</span><span id="line-366"></span><span> </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Platform -&gt; Bool
</span><a href="GHC.Platform.html#target32Bit"><span class="hs-identifier hs-var">target32Bit</span></a></span><span> </span><span class="annot"><span class="annottext">Platform
</span><a href="#local-6989586621683006631"><span class="hs-identifier hs-var">platform</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Word32 -&gt; FixedLengthEncoding Word32
forall a. a -&gt; FixedLengthEncoding a
</span><a href="GHC.Utils.Binary.html#FixedLengthEncoding"><span class="hs-identifier hs-var">FixedLengthEncoding</span></a></span><span> </span><span class="annot"><span class="annottext">Word32
</span><span class="hs-number">0x1face</span></span><span>
</span><span id="line-367"></span><span> </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">otherwise</span></span><span>            </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Word32 -&gt; FixedLengthEncoding Word32
forall a. a -&gt; FixedLengthEncoding a
</span><a href="GHC.Utils.Binary.html#FixedLengthEncoding"><span class="hs-identifier hs-var">FixedLengthEncoding</span></a></span><span> </span><span class="annot"><span class="annottext">Word32
</span><span class="hs-number">0x1face64</span></span><span>
</span><span id="line-368"></span><span>
</span><span id="line-369"></span><span>
</span><span id="line-370"></span><span class="hs-comment">{-
Note [Deduplication during iface binary serialisation]
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
When we serialise a 'ModIface', many symbols are redundant.
For example, there can be many duplicated 'FastString's and 'Name's.
To save space, we deduplicate duplicated symbols, such as 'FastString' and 'Name',
by maintaining a table of already seen symbols.

Besides saving a lot of disk space, this additionally enables us to automatically share
these symbols when we read the 'ModIface' from disk, without additional mechanisms such as 'FastStringTable'.

The general idea is, when serialising a value of type 'Name', we first have to create a deduplication
table (see 'putWithTables.initNameWriterTable' for example). Then, we create a 'BinaryWriter' function
which we add to the 'WriterUserData'. When this 'BinaryWriter' is used to serialise a value of type 'Name',
it looks up whether we have seen this value before. If so, we write an index to disk.
If we haven't seen the value before, we add it to the deduplication table and produce a new index.

Both the 'ReaderUserData' and 'WriterUserData' can contain many 'BinaryReader's and 'BinaryWriter's
respectively, which can each individually be tweaked to use a deduplication table, or to serialise
the value without deduplication.

After the payload (e.g., the 'ModIface') has been serialised to disk, we serialise the deduplication tables
to disk. This happens in 'putAllTables', where we serialise all tables that we use during 'ModIface'
serialisation. See 'initNameWriterTable' and 'putSymbolTable' for an implementation example.
This uses the 'real' serialisation function, e.g., 'serialiseName'.
However, these tables need to be deserialised before we can read the 'ModIface' from disk.
Thus, we write before the 'ModIface' a forward pointer to the deduplication table, so we can
read this table before deserialising the 'ModIface'.

To add a deduplication table for a type, let us assume 'IfaceTyCon', you need to do the following:

* The 'Binary' instance 'IfaceTyCon' needs to dynamically look up the serialiser function instead of
  serialising the value of 'IfaceTyCon'. It needs to look up the serialiser in the 'ReaderUserData' and
  'WriterUserData' respectively.
  This allows us to change the serialisation of 'IfaceTyCon' at run-time.
  We can still serialise 'IfaceTyCon' to disk directly, or use a deduplication table to reduce the size of
  the .hi file.

  For example:

  @
    instance Binary IfaceTyCon where
      put_ bh ty = case findUserDataWriter (Proxy @IfaceTyCon) bh of
        tbl -&gt; putEntry tbl bh ty
      get bh     = case findUserDataReader (Proxy @IfaceTyCon) bh of
        tbl -&gt; getEntry tbl bh
  @

  We include the signatures of 'findUserDataWriter' and 'findUserDataReader' to make this code example
  easier to understand:

  @
    findUserDataReader :: Typeable a =&gt; Proxy a -&gt; ReadBinHandle -&gt; BinaryReader a
    findUserDataWriter :: Typeable a =&gt; Proxy a -&gt; WriteBinHandle -&gt; BinaryWriter a
  @

  where 'BinaryReader' and 'BinaryWriter' correspond to the 'Binary' class methods
  'get' and 'put_' respectively, thus:

  @
    newtype BinaryReader s = BinaryReader { getEntry :: ReadBinHandle -&gt; IO s }

    newtype BinaryWriter s = BinaryWriter { putEntry :: WriteBinHandle -&gt; s -&gt; IO () }
  @

  'findUserData*' looks up the serialisation function for 'IfaceTyCon', which we then subsequently
  use to serialise said 'IfaceTyCon'. If no such serialiser can be found, 'findUserData*'
  crashes at run-time.

* Whenever a value of 'IfaceTyCon' needs to be serialised, there are two serialisation functions involved:

  * The literal serialiser that puts/gets the value to/from disk:
      Writes or reads a value of type 'IfaceTyCon' from the 'Write/ReadBinHandle'.
      This serialiser is primarily used to write the values stored in the deduplication table.
      It is also used to read the values from disk.

  * The deduplicating serialiser:
      Replaces the serialised value of 'IfaceTyCon' with an offset that is stored in the
      deduplication table.
      This serialiser is used while serialising the payload.

  We need to add the deduplicating serialiser to the 'ReaderUserData' and 'WriterUserData'
  respectively, so that 'findUserData*' can find them.

  For example, adding a serialiser for writing 'IfaceTyCon's:

  @
    let bh0 :: WriteBinHandle = ...
        putIfaceTyCon = ... -- Serialises 'IfaceTyCon' to disk
        bh = addWriterToUserData (mkSomeBinaryWriter putIfaceTyCon) bh0
  @

  Naturally, you have to do something similar for reading values of 'IfaceTyCon'.

  The provided code example implements the previous behaviour:
  serialise all values of type 'IfaceTyCon' directly. No deduplication is happening.

  Now, instead of literally putting the value, we can introduce a deduplication table!
  Instead of specifying 'putIfaceTyCon', which writes a value of 'IfaceTyCon' directly to disk,
  we provide a function that looks up values in a table and provides an index of each value
  we have already seen.
  If the particular 'IfaceTyCon' we want to serialise isn't already in the de-dup table,
  we allocate a new index and extend the table.

  See the definition of 'initNameWriterTable' and 'initNameReaderTable' for example deduplication tables.

* Storing the deduplication table.

  After the deduplicating the elements in the payload (e.g., 'ModIface'), we now have a deduplication
  table full with all the values.
  We serialise this table to disk using the real serialiser (e.g., 'putIfaceTyCon').

  When serialisation is complete, we write out the de-dup table in 'putAllTables',
  serialising each 'IfaceTyCon' in the table.  Of course, doing so might in turn serialise
  another de-dup'd thing (e.g. a FastString), thereby extending its respective de-dup table.

Note [Order of deduplication tables during iface binary serialisation]
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
Serialisation of 'ModIface' uses tables to deduplicate symbols that occur often.
See Note [Deduplication during iface binary serialisation].

After 'ModIface' has been written to disk, we write the deduplication tables.
Writing a table may add additional entries to *other* deduplication tables, thus
we need to make sure that the symbol table we serialise only depends on
deduplication tables that haven't been written to disk yet.

For example, assume we maintain deduplication tables for 'FastString' and 'Name'.
The symbol 'Name' depends on 'FastString', so serialising a 'Name' may add a 'FastString'
to the 'FastString' deduplication table.
Thus, 'Name' table needs to be serialised to disk before the 'FastString' table.

When we read the 'ModIface' from disk, we consequentially need to read the 'FastString'
deduplication table from disk, before we can deserialise the 'Name' deduplication table.
Therefore, before we serialise the tables, we write forward pointers that allow us to jump ahead
to the table we need to deserialise first.
What deduplication tables exist and the order of serialisation is currently statically specified
in 'putWithTables'. 'putWithTables' also takes care of the serialisation of used deduplication tables.
The deserialisation of the deduplication tables happens 'getTables', using 'Binary' utility
functions such as 'forwardGetRel'.

Here, a visualisation of the table structure we currently have (ignoring 'ExtensibleFields'):

&#9484;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9488;
&#9474;   Headers    &#9474;
&#9500;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9508;
&#9474;   Ptr FS     &#9500;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9488;
&#9500;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9508;        &#9474;
&#9474;   Ptr Name   &#9500;&#9472;&#9472;&#9472;&#9472;&#9472;&#9488;  &#9474;
&#9500;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9508;     &#9474;  &#9474;
&#9474;              &#9474;     &#9474;  &#9474;
&#9474;   ModIface   &#9474;     &#9474;  &#9474;
&#9474;   Payload    &#9474;     &#9474;  &#9474;
&#9474;              &#9474;     &#9474;  &#9474;
&#9500;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9508;     &#9474;  &#9474;
&#9474;              &#9474;     &#9474;  &#9474;
&#9474;  Name Table  &#9474;&#9668;&#9472;&#9472;&#9472;&#9472;&#9496;  &#9474;
&#9474;              &#9474;        &#9474;
&#9500;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9508;        &#9474;
&#9474;              &#9474;        &#9474;
&#9474;   FS Table   &#9474;&#9668;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9496;
&#9474;              &#9474;
&#9492;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9496;

-}</span><span>
</span><span id="line-534"></span><span>
</span><span id="line-535"></span><span class="hs-comment">{-
Note [Lazy ReaderUserData during IfaceType serialisation]
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
Serialising recursive data types, such as 'IfaceType', requires some trickery
to inject the deduplication table at the right moment.

When we serialise a value of 'IfaceType', we might encounter new 'IfaceType' values.
For example, 'IfaceAppTy' has an 'IfaceType' field, which we want to deduplicate as well.
Thus, when we serialise an 'IfaceType', we might add new 'IfaceType's to the 'GenericSymbolTable'
(i.e., the deduplication table). These 'IfaceType's are then subsequently also serialised to disk,
and uncover new 'IfaceType' values, etc...
In other words, when we serialise an 'IfaceType' we write it out using a post-order traversal.
See 'putGenericSymbolTable' for the implementation.

Now, when we deserialise the deduplication table, reading the first element of the deduplication table
will fail, as deserialisation requires that we read the child elements first. Remember, we wrote them to disk
using a post-order traversal.
To make this work, we therefore use 'lazyGet'' to lazily read the parent 'IfaceType', but delay the actual
deserialisation. We just assume that once you need to force a value, the deduplication table for 'IfaceType'
will be available.

That's where 'bhRef' comes into play:

@
    bhRef &lt;- newIORef (error &quot;used too soon&quot;)
    ud &lt;- unsafeInterleaveIO (readIORef bhRef)
    ...
    ifaceTypeReaderTable &lt;- initReadIfaceTypeTable ud
    ...
    writeIORef bhRef (getReaderUserData bhFinal)
@

'ud' is the 'ReaderUserData' that will eventually contain the deduplication table for 'IfaceType'.
As deserialisation of the 'IfaceType' needs the deduplication table, we provide a
promise that it will exist in the future (represented by @unsafeInterleaveIO (readIORef bhRef)@).
We pass 'ud' to 'initReadIfaceTypeTable', so the deserialisation will use the promised deduplication table.

Once we have &quot;read&quot; the deduplication table, it will be available in 'bhFinal', and we fulfill the promise
that the deduplication table for 'IfaceType' exists when forced.
-}</span><span>
</span><span id="line-575"></span><span>
</span><span id="line-576"></span><span class="hs-comment">-- -----------------------------------------------------------------------------</span><span>
</span><span id="line-577"></span><span class="hs-comment">-- The symbol table</span><span>
</span><span id="line-578"></span><span class="hs-comment">--</span><span>
</span><span id="line-579"></span><span>
</span><span id="line-580"></span><span class="annot"><a href="GHC.Iface.Binary.html#initReadIfaceTypeTable"><span class="hs-identifier hs-type">initReadIfaceTypeTable</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Utils.Binary.html#ReaderUserData"><span class="hs-identifier hs-type">ReaderUserData</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Utils.Binary.html#ReaderTable"><span class="hs-identifier hs-type">ReaderTable</span></a></span><span> </span><span class="annot"><a href="GHC.Iface.Type.html#IfaceType"><span class="hs-identifier hs-type">IfaceType</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-581"></span><span id="initReadIfaceTypeTable"><span class="annot"><span class="annottext">initReadIfaceTypeTable :: ReaderUserData -&gt; IO (ReaderTable IfaceType)
</span><a href="GHC.Iface.Binary.html#initReadIfaceTypeTable"><span class="hs-identifier hs-var hs-var">initReadIfaceTypeTable</span></a></span></span><span> </span><span id="local-6989586621683006634"><span class="annot"><span class="annottext">ReaderUserData
</span><a href="#local-6989586621683006634"><span class="hs-identifier hs-var">ud</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-582"></span><span>  </span><span class="annot"><span class="annottext">ReaderTable IfaceType -&gt; IO (ReaderTable IfaceType)
forall a. a -&gt; IO a
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">pure</span></span><span> </span><span class="annot"><span class="annottext">(ReaderTable IfaceType -&gt; IO (ReaderTable IfaceType))
-&gt; ReaderTable IfaceType -&gt; IO (ReaderTable IfaceType)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-583"></span><span>    </span><span class="annot"><a href="GHC.Utils.Binary.html#ReaderTable"><span class="hs-identifier hs-type">ReaderTable</span></a></span><span>
</span><span id="line-584"></span><span>      </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">getTable :: ReadBinHandle -&gt; IO (SymbolTable IfaceType)
</span><a href="GHC.Utils.Binary.html#getTable"><span class="hs-identifier hs-var">getTable</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(ReadBinHandle -&gt; IO IfaceType)
-&gt; ReadBinHandle -&gt; IO (SymbolTable IfaceType)
forall a.
(ReadBinHandle -&gt; IO a) -&gt; ReadBinHandle -&gt; IO (SymbolTable a)
</span><a href="GHC.Utils.Binary.html#getGenericSymbolTable"><span class="hs-identifier hs-var">getGenericSymbolTable</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span id="local-6989586621683006637"><span class="annot"><span class="annottext">ReadBinHandle
</span><a href="#local-6989586621683006637"><span class="hs-identifier hs-var">bh</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">(ReadBinHandle -&gt; IO IfaceType) -&gt; ReadBinHandle -&gt; IO IfaceType
forall a. (ReadBinHandle -&gt; IO a) -&gt; ReadBinHandle -&gt; IO a
</span><a href="GHC.Utils.Binary.html#lazyGet%27"><span class="hs-identifier hs-var">lazyGet'</span></a></span><span> </span><span class="annot"><span class="annottext">HasCallStack =&gt; ReadBinHandle -&gt; IO IfaceType
ReadBinHandle -&gt; IO IfaceType
</span><a href="GHC.Iface.Type.html#getIfaceType"><span class="hs-identifier hs-var">getIfaceType</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ReadBinHandle -&gt; ReaderUserData -&gt; ReadBinHandle
</span><a href="GHC.Utils.Binary.html#setReaderUserData"><span class="hs-identifier hs-var">setReaderUserData</span></a></span><span> </span><span class="annot"><span class="annottext">ReadBinHandle
</span><a href="#local-6989586621683006637"><span class="hs-identifier hs-var">bh</span></a></span><span> </span><span class="annot"><span class="annottext">ReaderUserData
</span><a href="#local-6989586621683006634"><span class="hs-identifier hs-var">ud</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-585"></span><span>      </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">mkReaderFromTable :: SymbolTable IfaceType -&gt; BinaryReader IfaceType
</span><a href="GHC.Utils.Binary.html#mkReaderFromTable"><span class="hs-identifier hs-var">mkReaderFromTable</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-glyph">\</span><span id="local-6989586621683006640"><span class="annot"><span class="annottext">SymbolTable IfaceType
</span><a href="#local-6989586621683006640"><span class="hs-identifier hs-var">tbl</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">(ReadBinHandle -&gt; IO IfaceType) -&gt; BinaryReader IfaceType
forall s. (ReadBinHandle -&gt; IO s) -&gt; BinaryReader s
</span><a href="GHC.Utils.Binary.html#mkReader"><span class="hs-identifier hs-var">mkReader</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">SymbolTable IfaceType -&gt; ReadBinHandle -&gt; IO IfaceType
forall a. Binary a =&gt; SymbolTable a -&gt; ReadBinHandle -&gt; IO a
</span><a href="GHC.Utils.Binary.html#getGenericSymtab"><span class="hs-identifier hs-var">getGenericSymtab</span></a></span><span> </span><span class="annot"><span class="annottext">SymbolTable IfaceType
</span><a href="#local-6989586621683006640"><span class="hs-identifier hs-var">tbl</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-586"></span><span>      </span><span class="hs-special">}</span><span>
</span><span id="line-587"></span><span>
</span><span id="line-588"></span><span class="annot"><a href="GHC.Iface.Binary.html#initWriteIfaceType"><span class="hs-identifier hs-type">initWriteIfaceType</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Iface.Binary.html#CompressionIFace"><span class="hs-identifier hs-type">CompressionIFace</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Utils.Binary.html#WriterTable"><span class="hs-identifier hs-type">WriterTable</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Utils.Binary.html#BinaryWriter"><span class="hs-identifier hs-type">BinaryWriter</span></a></span><span> </span><span class="annot"><a href="GHC.Iface.Type.html#IfaceType"><span class="hs-identifier hs-type">IfaceType</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-589"></span><span id="initWriteIfaceType"><span class="annot"><span class="annottext">initWriteIfaceType :: CompressionIFace -&gt; IO (WriterTable, BinaryWriter IfaceType)
</span><a href="GHC.Iface.Binary.html#initWriteIfaceType"><span class="hs-identifier hs-var hs-var">initWriteIfaceType</span></a></span></span><span> </span><span id="local-6989586621683006643"><span class="annot"><span class="annottext">CompressionIFace
</span><a href="#local-6989586621683006643"><span class="hs-identifier hs-var">compressionLevel</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-590"></span><span>  </span><span id="local-6989586621683006644"><span class="annot"><a href="#local-6989586621683006644"><span class="hs-identifier hs-var">sym_tab</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *). TrieMap m =&gt; IO (GenericSymbolTable m)
</span><a href="GHC.Utils.Binary.html#initGenericSymbolTable"><span class="hs-identifier hs-var">initGenericSymbolTable</span></a></span><span> </span><span class="hs-glyph">@</span><span class="hs-special">(</span><span class="annot"><a href="../../containers-0.7-5a8f/src/Data.Map.Internal.html#Map"><span class="hs-identifier hs-type">Map</span></a></span><span> </span><span class="annot"><a href="GHC.Iface.Type.html#IfaceType"><span class="hs-identifier hs-type">IfaceType</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-591"></span><span>  </span><span class="annot"><span class="hs-identifier hs-type">pure</span></span><span>
</span><span id="line-592"></span><span>    </span><span class="hs-special">(</span><span> </span><span class="annot"><a href="GHC.Utils.Binary.html#WriterTable"><span class="hs-identifier hs-type">WriterTable</span></a></span><span>
</span><span id="line-593"></span><span>        </span><span class="hs-special">{</span><span> </span><span class="annot"><a href="GHC.Utils.Binary.html#putTable"><span class="hs-identifier hs-var">putTable</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="GHC.Utils.Binary.html#putGenericSymbolTable"><span class="hs-identifier hs-type">putGenericSymbolTable</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683006644"><span class="hs-identifier hs-type">sym_tab</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Utils.Binary.html#lazyPut%27"><span class="hs-identifier hs-type">lazyPut'</span></a></span><span> </span><span class="annot"><a href="GHC.Iface.Type.html#putIfaceType"><span class="hs-identifier hs-type">putIfaceType</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-594"></span><span>        </span><span class="hs-special">}</span><span>
</span><span id="line-595"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Utils.Binary.html#mkWriter"><span class="hs-identifier hs-type">mkWriter</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="annot"><a href="#local-6989586621683006649"><span class="hs-identifier hs-type">ifaceWriter</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683006644"><span class="hs-identifier hs-type">sym_tab</span></a></span><span>
</span><span id="line-596"></span><span>    </span><span class="hs-special">)</span><span>
</span><span id="line-597"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-598"></span><span>    </span><span id="local-6989586621683006649"><span class="annot"><span class="annottext">ifaceWriter :: GenericSymbolTable (Map IfaceType)
-&gt; WriteBinHandle -&gt; IfaceType -&gt; IO ()
</span><a href="#local-6989586621683006649"><span class="hs-identifier hs-var hs-var">ifaceWriter</span></a></span></span><span> </span><span id="local-6989586621683006650"><span class="annot"><span class="annottext">GenericSymbolTable (Map IfaceType)
</span><a href="#local-6989586621683006650"><span class="hs-identifier hs-var">sym_tab</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">CompressionIFace
</span><a href="#local-6989586621683006643"><span class="hs-identifier hs-var">compressionLevel</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-599"></span><span>      </span><span class="annot"><span class="annottext">CompressionIFace
</span><a href="GHC.Iface.Binary.html#NormalCompression"><span class="hs-identifier hs-var">NormalCompression</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">WriteBinHandle -&gt; IfaceType -&gt; IO ()
</span><a href="#local-6989586621683006651"><span class="hs-identifier hs-var">literalIfaceTypeSerialiser</span></a></span><span>
</span><span id="line-600"></span><span>      </span><span class="annot"><span class="annottext">CompressionIFace
</span><a href="GHC.Iface.Binary.html#SafeExtraCompression"><span class="hs-identifier hs-var">SafeExtraCompression</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">GenericSymbolTable (Map IfaceType)
-&gt; WriteBinHandle -&gt; IfaceType -&gt; IO ()
forall {m :: * -&gt; *}.
(Key m ~ IfaceType, TrieMap m) =&gt;
GenericSymbolTable m -&gt; WriteBinHandle -&gt; IfaceType -&gt; IO ()
</span><a href="#local-6989586621683006652"><span class="hs-identifier hs-var">ifaceTyConAppSerialiser</span></a></span><span> </span><span class="annot"><span class="annottext">GenericSymbolTable (Map IfaceType)
</span><a href="#local-6989586621683006650"><span class="hs-identifier hs-var">sym_tab</span></a></span><span>
</span><span id="line-601"></span><span>      </span><span class="annot"><span class="annottext">CompressionIFace
</span><a href="GHC.Iface.Binary.html#MaximumCompression"><span class="hs-identifier hs-var">MaximumCompression</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">GenericSymbolTable (Map IfaceType)
-&gt; WriteBinHandle -&gt; Key (Map IfaceType) -&gt; IO ()
forall {m :: * -&gt; *}.
TrieMap m =&gt;
GenericSymbolTable m -&gt; WriteBinHandle -&gt; Key m -&gt; IO ()
</span><a href="#local-6989586621683006653"><span class="hs-identifier hs-var">fullIfaceTypeSerialiser</span></a></span><span> </span><span class="annot"><span class="annottext">GenericSymbolTable (Map IfaceType)
</span><a href="#local-6989586621683006650"><span class="hs-identifier hs-var">sym_tab</span></a></span><span>
</span><span id="line-602"></span><span>
</span><span id="line-603"></span><span>    </span><span id="local-6989586621683006652"><span class="annot"><span class="annottext">ifaceTyConAppSerialiser :: GenericSymbolTable m -&gt; WriteBinHandle -&gt; IfaceType -&gt; IO ()
</span><a href="#local-6989586621683006652"><span class="hs-identifier hs-var hs-var">ifaceTyConAppSerialiser</span></a></span></span><span> </span><span id="local-6989586621683006664"><span class="annot"><span class="annottext">GenericSymbolTable m
</span><a href="#local-6989586621683006664"><span class="hs-identifier hs-var">sym_tab</span></a></span></span><span> </span><span id="local-6989586621683006665"><span class="annot"><span class="annottext">WriteBinHandle
</span><a href="#local-6989586621683006665"><span class="hs-identifier hs-var">bh</span></a></span></span><span> </span><span id="local-6989586621683006666"><span class="annot"><span class="annottext">IfaceType
</span><a href="#local-6989586621683006666"><span class="hs-identifier hs-var">ty</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">IfaceType
</span><a href="#local-6989586621683006666"><span class="hs-identifier hs-var">ty</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-604"></span><span>      </span><span class="annot"><a href="GHC.Iface.Type.html#IfaceTyConApp"><span class="hs-identifier hs-type">IfaceTyConApp</span></a></span><span> </span><span class="hs-special">{</span><span class="hs-special">}</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-605"></span><span>        </span><span class="annot"><span class="annottext">WriteBinHandle -&gt; Word8 -&gt; IO ()
forall a. Binary a =&gt; WriteBinHandle -&gt; a -&gt; IO ()
</span><a href="GHC.Utils.Binary.html#put_"><span class="hs-identifier hs-var">put_</span></a></span><span> </span><span class="annot"><span class="annottext">WriteBinHandle
</span><a href="#local-6989586621683006665"><span class="hs-identifier hs-var">bh</span></a></span><span> </span><span class="annot"><span class="annottext">Word8
</span><a href="GHC.Iface.Type.html#ifaceTypeSharedByte"><span class="hs-identifier hs-var">ifaceTypeSharedByte</span></a></span><span>
</span><span id="line-606"></span><span>        </span><span class="annot"><span class="annottext">GenericSymbolTable m -&gt; WriteBinHandle -&gt; Key m -&gt; IO ()
forall {m :: * -&gt; *}.
TrieMap m =&gt;
GenericSymbolTable m -&gt; WriteBinHandle -&gt; Key m -&gt; IO ()
</span><a href="GHC.Utils.Binary.html#putGenericSymTab"><span class="hs-identifier hs-var">putGenericSymTab</span></a></span><span> </span><span class="annot"><span class="annottext">GenericSymbolTable m
</span><a href="#local-6989586621683006664"><span class="hs-identifier hs-var">sym_tab</span></a></span><span> </span><span class="annot"><span class="annottext">WriteBinHandle
</span><a href="#local-6989586621683006665"><span class="hs-identifier hs-var">bh</span></a></span><span> </span><span class="annot"><span class="annottext">IfaceType
Key m
</span><a href="#local-6989586621683006666"><span class="hs-identifier hs-var">ty</span></a></span><span>
</span><span id="line-607"></span><span>      </span><span class="annot"><span class="annottext">IfaceType
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">WriteBinHandle -&gt; IfaceType -&gt; IO ()
</span><a href="GHC.Iface.Type.html#putIfaceType"><span class="hs-identifier hs-var">putIfaceType</span></a></span><span> </span><span class="annot"><span class="annottext">WriteBinHandle
</span><a href="#local-6989586621683006665"><span class="hs-identifier hs-var">bh</span></a></span><span> </span><span class="annot"><span class="annottext">IfaceType
</span><a href="#local-6989586621683006666"><span class="hs-identifier hs-var">ty</span></a></span><span>
</span><span id="line-608"></span><span>
</span><span id="line-609"></span><span>    </span><span id="local-6989586621683006653"><span class="annot"><span class="annottext">fullIfaceTypeSerialiser :: GenericSymbolTable m -&gt; WriteBinHandle -&gt; Key m -&gt; IO ()
</span><a href="#local-6989586621683006653"><span class="hs-identifier hs-var hs-var">fullIfaceTypeSerialiser</span></a></span></span><span> </span><span id="local-6989586621683006675"><span class="annot"><span class="annottext">GenericSymbolTable m
</span><a href="#local-6989586621683006675"><span class="hs-identifier hs-var">sym_tab</span></a></span></span><span> </span><span id="local-6989586621683006676"><span class="annot"><span class="annottext">WriteBinHandle
</span><a href="#local-6989586621683006676"><span class="hs-identifier hs-var">bh</span></a></span></span><span> </span><span id="local-6989586621683006677"><span class="annot"><span class="annottext">Key m
</span><a href="#local-6989586621683006677"><span class="hs-identifier hs-var">ty</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-610"></span><span>      </span><span class="annot"><span class="annottext">WriteBinHandle -&gt; Word8 -&gt; IO ()
forall a. Binary a =&gt; WriteBinHandle -&gt; a -&gt; IO ()
</span><a href="GHC.Utils.Binary.html#put_"><span class="hs-identifier hs-var">put_</span></a></span><span> </span><span class="annot"><span class="annottext">WriteBinHandle
</span><a href="#local-6989586621683006676"><span class="hs-identifier hs-var">bh</span></a></span><span> </span><span class="annot"><span class="annottext">Word8
</span><a href="GHC.Iface.Type.html#ifaceTypeSharedByte"><span class="hs-identifier hs-var">ifaceTypeSharedByte</span></a></span><span>
</span><span id="line-611"></span><span>      </span><span class="annot"><span class="annottext">GenericSymbolTable m -&gt; WriteBinHandle -&gt; Key m -&gt; IO ()
forall {m :: * -&gt; *}.
TrieMap m =&gt;
GenericSymbolTable m -&gt; WriteBinHandle -&gt; Key m -&gt; IO ()
</span><a href="GHC.Utils.Binary.html#putGenericSymTab"><span class="hs-identifier hs-var">putGenericSymTab</span></a></span><span> </span><span class="annot"><span class="annottext">GenericSymbolTable m
</span><a href="#local-6989586621683006675"><span class="hs-identifier hs-var">sym_tab</span></a></span><span> </span><span class="annot"><span class="annottext">WriteBinHandle
</span><a href="#local-6989586621683006676"><span class="hs-identifier hs-var">bh</span></a></span><span> </span><span class="annot"><span class="annottext">Key m
</span><a href="#local-6989586621683006677"><span class="hs-identifier hs-var">ty</span></a></span><span>
</span><span id="line-612"></span><span>
</span><span id="line-613"></span><span>    </span><span id="local-6989586621683006651"><span class="annot"><span class="annottext">literalIfaceTypeSerialiser :: WriteBinHandle -&gt; IfaceType -&gt; IO ()
</span><a href="#local-6989586621683006651"><span class="hs-identifier hs-var hs-var">literalIfaceTypeSerialiser</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">WriteBinHandle -&gt; IfaceType -&gt; IO ()
</span><a href="GHC.Iface.Type.html#putIfaceType"><span class="hs-identifier hs-var">putIfaceType</span></a></span><span>
</span><span id="line-614"></span><span>
</span><span id="line-615"></span><span>
</span><span id="line-616"></span><span class="annot"><a href="GHC.Iface.Binary.html#initNameReaderTable"><span class="hs-identifier hs-type">initNameReaderTable</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Types.Name.Cache.html#NameCache"><span class="hs-identifier hs-type">NameCache</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Utils.Binary.html#ReaderTable"><span class="hs-identifier hs-type">ReaderTable</span></a></span><span> </span><span class="annot"><a href="GHC.Types.Name.html#Name"><span class="hs-identifier hs-type">Name</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-617"></span><span id="initNameReaderTable"><span class="annot"><span class="annottext">initNameReaderTable :: NameCache -&gt; IO (ReaderTable Name)
</span><a href="GHC.Iface.Binary.html#initNameReaderTable"><span class="hs-identifier hs-var hs-var">initNameReaderTable</span></a></span></span><span> </span><span id="local-6989586621683006678"><span class="annot"><span class="annottext">NameCache
</span><a href="#local-6989586621683006678"><span class="hs-identifier hs-var">cache</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-618"></span><span>  </span><span class="annot"><span class="annottext">ReaderTable Name -&gt; IO (ReaderTable Name)
forall a. a -&gt; IO a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="annot"><span class="annottext">(ReaderTable Name -&gt; IO (ReaderTable Name))
-&gt; ReaderTable Name -&gt; IO (ReaderTable Name)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-619"></span><span>    </span><span class="annot"><a href="GHC.Utils.Binary.html#ReaderTable"><span class="hs-identifier hs-type">ReaderTable</span></a></span><span>
</span><span id="line-620"></span><span>      </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">getTable :: ReadBinHandle -&gt; IO (SymbolTable Name)
</span><a href="GHC.Utils.Binary.html#getTable"><span class="hs-identifier hs-var">getTable</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-glyph">\</span><span id="local-6989586621683006679"><span class="annot"><span class="annottext">ReadBinHandle
</span><a href="#local-6989586621683006679"><span class="hs-identifier hs-var">bh</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">ReadBinHandle -&gt; NameCache -&gt; IO (SymbolTable Name)
</span><a href="GHC.Iface.Binary.html#getSymbolTable"><span class="hs-identifier hs-var">getSymbolTable</span></a></span><span> </span><span class="annot"><span class="annottext">ReadBinHandle
</span><a href="#local-6989586621683006679"><span class="hs-identifier hs-var">bh</span></a></span><span> </span><span class="annot"><span class="annottext">NameCache
</span><a href="#local-6989586621683006678"><span class="hs-identifier hs-var">cache</span></a></span><span>
</span><span id="line-621"></span><span>      </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">mkReaderFromTable :: SymbolTable Name -&gt; BinaryReader Name
</span><a href="GHC.Utils.Binary.html#mkReaderFromTable"><span class="hs-identifier hs-var">mkReaderFromTable</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-glyph">\</span><span id="local-6989586621683006680"><span class="annot"><span class="annottext">SymbolTable Name
</span><a href="#local-6989586621683006680"><span class="hs-identifier hs-var">tbl</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">(ReadBinHandle -&gt; IO Name) -&gt; BinaryReader Name
forall s. (ReadBinHandle -&gt; IO s) -&gt; BinaryReader s
</span><a href="GHC.Utils.Binary.html#mkReader"><span class="hs-identifier hs-var">mkReader</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">SymbolTable Name -&gt; ReadBinHandle -&gt; IO Name
</span><a href="GHC.Iface.Binary.html#getSymtabName"><span class="hs-identifier hs-var">getSymtabName</span></a></span><span> </span><span class="annot"><span class="annottext">SymbolTable Name
</span><a href="#local-6989586621683006680"><span class="hs-identifier hs-var">tbl</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-622"></span><span>      </span><span class="hs-special">}</span><span>
</span><span id="line-623"></span><span>
</span><span id="line-624"></span><span class="hs-keyword">data</span><span> </span><span id="BinSymbolTable"><span class="annot"><a href="GHC.Iface.Binary.html#BinSymbolTable"><span class="hs-identifier hs-var">BinSymbolTable</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="BinSymbolTable"><span class="annot"><a href="GHC.Iface.Binary.html#BinSymbolTable"><span class="hs-identifier hs-var">BinSymbolTable</span></a></span></span><span> </span><span class="hs-special">{</span><span>
</span><span id="line-625"></span><span>        </span><span id="bin_symtab_next"><span class="annot"><span class="annottext">BinSymbolTable -&gt; FastMutInt
</span><a href="GHC.Iface.Binary.html#bin_symtab_next"><span class="hs-identifier hs-var hs-var">bin_symtab_next</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-glyph">!</span><span class="annot"><a href="GHC.Data.FastMutInt.html#FastMutInt"><span class="hs-identifier hs-type">FastMutInt</span></a></span><span class="hs-special">,</span><span> </span><span class="hs-comment">-- The next index to use</span><span>
</span><span id="line-626"></span><span>        </span><span id="bin_symtab_map"><span class="annot"><span class="annottext">BinSymbolTable -&gt; IORef (UniqFM Name (Int, Name))
</span><a href="GHC.Iface.Binary.html#bin_symtab_map"><span class="hs-identifier hs-var hs-var">bin_symtab_map</span></a></span></span><span>  </span><span class="hs-glyph">::</span><span> </span><span class="hs-glyph">!</span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">IORef</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Types.Unique.FM.html#UniqFM"><span class="hs-identifier hs-type">UniqFM</span></a></span><span> </span><span class="annot"><a href="GHC.Types.Name.html#Name"><span class="hs-identifier hs-type">Name</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Int</span></span><span class="hs-special">,</span><span class="annot"><a href="GHC.Types.Name.html#Name"><span class="hs-identifier hs-type">Name</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-627"></span><span>                                </span><span class="hs-comment">-- indexed by Name</span><span>
</span><span id="line-628"></span><span>  </span><span class="hs-special">}</span><span>
</span><span id="line-629"></span><span>
</span><span id="line-630"></span><span class="annot"><a href="GHC.Iface.Binary.html#initNameWriterTable"><span class="hs-identifier hs-type">initNameWriterTable</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Utils.Binary.html#WriterTable"><span class="hs-identifier hs-type">WriterTable</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Utils.Binary.html#BinaryWriter"><span class="hs-identifier hs-type">BinaryWriter</span></a></span><span> </span><span class="annot"><a href="GHC.Types.Name.html#Name"><span class="hs-identifier hs-type">Name</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-631"></span><span id="initNameWriterTable"><span class="annot"><span class="annottext">initNameWriterTable :: IO (WriterTable, BinaryWriter Name)
</span><a href="GHC.Iface.Binary.html#initNameWriterTable"><span class="hs-identifier hs-var hs-var">initNameWriterTable</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-632"></span><span>  </span><span id="local-6989586621683006684"><span class="annot"><a href="#local-6989586621683006684"><span class="hs-identifier hs-var">symtab_next</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Int -&gt; IO FastMutInt
</span><a href="GHC.Data.FastMutInt.html#newFastMutInt"><span class="hs-identifier hs-var">newFastMutInt</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">0</span></span><span>
</span><span id="line-633"></span><span>  </span><span id="local-6989586621683006686"><span class="annot"><a href="#local-6989586621683006686"><span class="hs-identifier hs-var">symtab_map</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="hs-identifier hs-type">newIORef</span></span><span> </span><span class="annot"><a href="GHC.Types.Unique.FM.html#emptyUFM"><span class="hs-identifier hs-type">emptyUFM</span></a></span><span>
</span><span id="line-634"></span><span>  </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621683006688"><span class="annot"><a href="#local-6989586621683006688"><span class="hs-identifier hs-var hs-var">bin_symtab</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-635"></span><span>        </span><span class="annot"><a href="GHC.Iface.Binary.html#BinSymbolTable"><span class="hs-identifier hs-type">BinSymbolTable</span></a></span><span>
</span><span id="line-636"></span><span>          </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">bin_symtab_next :: FastMutInt
</span><a href="GHC.Iface.Binary.html#bin_symtab_next"><span class="hs-identifier hs-var">bin_symtab_next</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">FastMutInt
</span><a href="#local-6989586621683006684"><span class="hs-identifier hs-var">symtab_next</span></a></span><span>
</span><span id="line-637"></span><span>          </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">bin_symtab_map :: IORef (UniqFM Name (Int, Name))
</span><a href="GHC.Iface.Binary.html#bin_symtab_map"><span class="hs-identifier hs-var">bin_symtab_map</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">IORef (UniqFM Name (Int, Name))
</span><a href="#local-6989586621683006686"><span class="hs-identifier hs-var">symtab_map</span></a></span><span>
</span><span id="line-638"></span><span>          </span><span class="hs-special">}</span><span>
</span><span id="line-639"></span><span>
</span><span id="line-640"></span><span>  </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621683006689"><span class="annot"><a href="#local-6989586621683006689"><span class="hs-identifier hs-var hs-var">put_symtab</span></a></span></span><span> </span><span id="local-6989586621683006690"><span class="annot"><span class="annottext">WriteBinHandle
</span><a href="#local-6989586621683006690"><span class="hs-identifier hs-var">bh</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-641"></span><span>        </span><span id="local-6989586621683006691"><span class="annot"><a href="#local-6989586621683006691"><span class="hs-identifier hs-var">name_count</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">FastMutInt -&gt; IO Int
</span><a href="GHC.Data.FastMutInt.html#readFastMutInt"><span class="hs-identifier hs-var">readFastMutInt</span></a></span><span> </span><span class="annot"><span class="annottext">FastMutInt
</span><a href="#local-6989586621683006684"><span class="hs-identifier hs-var">symtab_next</span></a></span><span>
</span><span id="line-642"></span><span>        </span><span id="local-6989586621683006693"><span class="annot"><a href="#local-6989586621683006693"><span class="hs-identifier hs-var">symtab_map</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="hs-identifier hs-type">readIORef</span></span><span> </span><span class="annot"><a href="#local-6989586621683006686"><span class="hs-identifier hs-type">symtab_map</span></a></span><span>
</span><span id="line-643"></span><span>        </span><span class="annot"><a href="GHC.Iface.Binary.html#putSymbolTable"><span class="hs-identifier hs-type">putSymbolTable</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683006690"><span class="hs-identifier hs-type">bh</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683006691"><span class="hs-identifier hs-type">name_count</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683006693"><span class="hs-identifier hs-type">symtab_map</span></a></span><span>
</span><span id="line-644"></span><span>        </span><span class="annot"><span class="hs-identifier hs-type">pure</span></span><span> </span><span class="annot"><a href="#local-6989586621683006691"><span class="hs-identifier hs-type">name_count</span></a></span><span>
</span><span id="line-645"></span><span>
</span><span id="line-646"></span><span>  </span><span class="annot"><span class="hs-identifier hs-type">return</span></span><span>
</span><span id="line-647"></span><span>    </span><span class="hs-special">(</span><span> </span><span class="annot"><a href="GHC.Utils.Binary.html#WriterTable"><span class="hs-identifier hs-type">WriterTable</span></a></span><span>
</span><span id="line-648"></span><span>        </span><span class="hs-special">{</span><span> </span><span class="annot"><a href="GHC.Utils.Binary.html#putTable"><span class="hs-identifier hs-var">putTable</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="#local-6989586621683006689"><span class="hs-identifier hs-type">put_symtab</span></a></span><span>
</span><span id="line-649"></span><span>        </span><span class="hs-special">}</span><span>
</span><span id="line-650"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Utils.Binary.html#mkWriter"><span class="hs-identifier hs-type">mkWriter</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="annot"><a href="GHC.Iface.Binary.html#putName"><span class="hs-identifier hs-type">putName</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683006688"><span class="hs-identifier hs-type">bin_symtab</span></a></span><span>
</span><span id="line-651"></span><span>    </span><span class="hs-special">)</span><span>
</span><span id="line-652"></span><span>
</span><span id="line-653"></span><span>
</span><span id="line-654"></span><span class="annot"><a href="GHC.Iface.Binary.html#putSymbolTable"><span class="hs-identifier hs-type">putSymbolTable</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Utils.Binary.html#WriteBinHandle"><span class="hs-identifier hs-type">WriteBinHandle</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Int</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Types.Unique.FM.html#UniqFM"><span class="hs-identifier hs-type">UniqFM</span></a></span><span> </span><span class="annot"><a href="GHC.Types.Name.html#Name"><span class="hs-identifier hs-type">Name</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Int</span></span><span class="hs-special">,</span><span class="annot"><a href="GHC.Types.Name.html#Name"><span class="hs-identifier hs-type">Name</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-655"></span><span id="putSymbolTable"><span class="annot"><span class="annottext">putSymbolTable :: WriteBinHandle -&gt; Int -&gt; UniqFM Name (Int, Name) -&gt; IO ()
</span><a href="GHC.Iface.Binary.html#putSymbolTable"><span class="hs-identifier hs-var hs-var">putSymbolTable</span></a></span></span><span> </span><span id="local-6989586621683006694"><span class="annot"><span class="annottext">WriteBinHandle
</span><a href="#local-6989586621683006694"><span class="hs-identifier hs-var">bh</span></a></span></span><span> </span><span id="local-6989586621683006695"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621683006695"><span class="hs-identifier hs-var">name_count</span></a></span></span><span> </span><span id="local-6989586621683006696"><span class="annot"><span class="annottext">UniqFM Name (Int, Name)
</span><a href="#local-6989586621683006696"><span class="hs-identifier hs-var">symtab</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-656"></span><span>    </span><span class="annot"><span class="annottext">WriteBinHandle -&gt; Int -&gt; IO ()
forall a. Binary a =&gt; WriteBinHandle -&gt; a -&gt; IO ()
</span><a href="GHC.Utils.Binary.html#put_"><span class="hs-identifier hs-var">put_</span></a></span><span> </span><span class="annot"><span class="annottext">WriteBinHandle
</span><a href="#local-6989586621683006694"><span class="hs-identifier hs-var">bh</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621683006695"><span class="hs-identifier hs-var">name_count</span></a></span><span>
</span><span id="line-657"></span><span>    </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621683006697"><span class="annot"><span class="annottext">names :: [Name]
</span><a href="#local-6989586621683006697"><span class="hs-identifier hs-var hs-var">names</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">SymbolTable Name -&gt; [Name]
forall i e. Array i e -&gt; [e]
</span><span class="hs-identifier hs-var">elems</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(Int, Int) -&gt; [(Int, Name)] -&gt; SymbolTable Name
forall i e. Ix i =&gt; (i, i) -&gt; [(i, e)] -&gt; Array i e
</span><span class="hs-identifier hs-var">array</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">0</span></span><span class="hs-special">,</span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621683006695"><span class="hs-identifier hs-var">name_count</span></a></span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Int
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-glyph hs-var">-</span></span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">1</span></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">UniqFM Name (Int, Name) -&gt; [(Int, Name)]
forall {k} (key :: k) elt. UniqFM key elt -&gt; [elt]
</span><a href="GHC.Types.Unique.FM.html#nonDetEltsUFM"><span class="hs-identifier hs-var">nonDetEltsUFM</span></a></span><span> </span><span class="annot"><span class="annottext">UniqFM Name (Int, Name)
</span><a href="#local-6989586621683006696"><span class="hs-identifier hs-var">symtab</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-658"></span><span>      </span><span class="hs-comment">-- It's OK to use nonDetEltsUFM here because the elements have</span><span>
</span><span id="line-659"></span><span>      </span><span class="hs-comment">-- indices that array uses to create order</span><span>
</span><span id="line-660"></span><span>    </span><span class="annot"><span class="annottext">(Name -&gt; IO ()) -&gt; [Name] -&gt; IO ()
forall (t :: * -&gt; *) (m :: * -&gt; *) a b.
(Foldable t, Monad m) =&gt;
(a -&gt; m b) -&gt; t a -&gt; m ()
</span><span class="hs-identifier hs-var">mapM_</span></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span id="local-6989586621683006702"><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621683006702"><span class="hs-identifier hs-var">n</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">WriteBinHandle -&gt; Name -&gt; UniqFM Name (Int, Name) -&gt; IO ()
forall {k} (key :: k).
WriteBinHandle -&gt; Name -&gt; UniqFM key (Int, Name) -&gt; IO ()
</span><a href="GHC.Iface.Binary.html#serialiseName"><span class="hs-identifier hs-var">serialiseName</span></a></span><span> </span><span class="annot"><span class="annottext">WriteBinHandle
</span><a href="#local-6989586621683006694"><span class="hs-identifier hs-var">bh</span></a></span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621683006702"><span class="hs-identifier hs-var">n</span></a></span><span> </span><span class="annot"><span class="annottext">UniqFM Name (Int, Name)
</span><a href="#local-6989586621683006696"><span class="hs-identifier hs-var">symtab</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[Name]
</span><a href="#local-6989586621683006697"><span class="hs-identifier hs-var">names</span></a></span><span>
</span><span id="line-661"></span><span>
</span><span id="line-662"></span><span>
</span><span id="line-663"></span><span class="annot"><a href="GHC.Iface.Binary.html#getSymbolTable"><span class="hs-identifier hs-type">getSymbolTable</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Utils.Binary.html#ReadBinHandle"><span class="hs-identifier hs-type">ReadBinHandle</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Types.Name.Cache.html#NameCache"><span class="hs-identifier hs-type">NameCache</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Utils.Binary.html#SymbolTable"><span class="hs-identifier hs-type">SymbolTable</span></a></span><span> </span><span class="annot"><a href="GHC.Types.Name.html#Name"><span class="hs-identifier hs-type">Name</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-664"></span><span id="getSymbolTable"><span class="annot"><span class="annottext">getSymbolTable :: ReadBinHandle -&gt; NameCache -&gt; IO (SymbolTable Name)
</span><a href="GHC.Iface.Binary.html#getSymbolTable"><span class="hs-identifier hs-var hs-var">getSymbolTable</span></a></span></span><span> </span><span id="local-6989586621683006704"><span class="annot"><span class="annottext">ReadBinHandle
</span><a href="#local-6989586621683006704"><span class="hs-identifier hs-var">bh</span></a></span></span><span> </span><span id="local-6989586621683006705"><span class="annot"><span class="annottext">NameCache
</span><a href="#local-6989586621683006705"><span class="hs-identifier hs-var">name_cache</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-665"></span><span>    </span><span id="local-6989586621683006706"><span class="annot"><a href="#local-6989586621683006706"><span class="hs-identifier hs-var">sz</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">ReadBinHandle -&gt; IO Int
forall a. Binary a =&gt; ReadBinHandle -&gt; IO a
</span><a href="GHC.Utils.Binary.html#get"><span class="hs-identifier hs-var">get</span></a></span><span> </span><span class="annot"><span class="annottext">ReadBinHandle
</span><a href="#local-6989586621683006704"><span class="hs-identifier hs-var">bh</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Int</span></span><span>
</span><span id="line-666"></span><span>    </span><span class="hs-comment">-- create an array of Names for the symbols and add them to the NameCache</span><span>
</span><span id="line-667"></span><span>    </span><span class="annot"><a href="GHC.Types.Name.Cache.html#updateNameCache%27"><span class="hs-identifier hs-type">updateNameCache'</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683006705"><span class="hs-identifier hs-type">name_cache</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="hs-glyph">\</span><span id="local-6989586621683006708"><span class="annot"><span class="annottext">OrigNameCache
</span><a href="#local-6989586621683006708"><span class="hs-identifier hs-var">cache0</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-668"></span><span>        </span><span id="local-6989586621683006709"><span class="annot"><a href="#local-6989586621683006709"><span class="hs-identifier hs-var">mut_arr</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">(Int, Int) -&gt; IO (IOArray Int Name)
forall i. Ix i =&gt; (i, i) -&gt; IO (IOArray i Name)
forall (a :: * -&gt; * -&gt; *) e (m :: * -&gt; *) i.
(MArray a e m, Ix i) =&gt;
(i, i) -&gt; m (a i e)
</span><a href="../../array-0.5.8.0-9044/src/Data.Array.Base.html#newArray_"><span class="hs-identifier hs-var">newArray_</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">0</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621683006706"><span class="hs-identifier hs-var">sz</span></a></span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Int
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-glyph hs-var">-</span></span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">1</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">IOArray</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Int</span></span><span> </span><span class="annot"><a href="GHC.Types.Name.html#Name"><span class="hs-identifier hs-type">Name</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-669"></span><span>        </span><span id="local-6989586621683006711"><span class="annot"><a href="#local-6989586621683006711"><span class="hs-identifier hs-var">cache</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><a href="GHC.Utils.Binary.html#foldGet%27"><span class="hs-identifier hs-type">foldGet'</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">fromIntegral</span></span><span> </span><span class="annot"><a href="#local-6989586621683006706"><span class="hs-identifier hs-type">sz</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><a href="#local-6989586621683006704"><span class="hs-identifier hs-type">bh</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683006708"><span class="hs-identifier hs-type">cache0</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="hs-glyph">\</span><span id="local-6989586621683006713"><span class="annot"><span class="annottext">Word
</span><a href="#local-6989586621683006713"><span class="hs-identifier hs-var">i</span></a></span></span><span> </span><span class="hs-special">(</span><span id="local-6989586621683006714"><span class="annot"><span class="annottext">Unit
</span><a href="#local-6989586621683006714"><span class="hs-identifier hs-var">uid</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621683006715"><span class="annot"><span class="annottext">ModuleName
</span><a href="#local-6989586621683006715"><span class="hs-identifier hs-var">mod_name</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621683006716"><span class="annot"><span class="annottext">OccName
</span><a href="#local-6989586621683006716"><span class="hs-identifier hs-var">occ</span></a></span></span><span class="hs-special">)</span><span> </span><span id="local-6989586621683006717"><span class="annot"><span class="annottext">OrigNameCache
</span><a href="#local-6989586621683006717"><span class="hs-identifier hs-var">cache</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-670"></span><span>          </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621683006718"><span class="annot"><span class="annottext">mod :: GenModule Unit
</span><a href="#local-6989586621683006718"><span class="hs-identifier hs-var hs-var">mod</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Unit -&gt; ModuleName -&gt; GenModule Unit
forall u. u -&gt; ModuleName -&gt; GenModule u
</span><a href="GHC.Unit.Types.html#mkModule"><span class="hs-identifier hs-var">mkModule</span></a></span><span> </span><span class="annot"><span class="annottext">Unit
</span><a href="#local-6989586621683006714"><span class="hs-identifier hs-var">uid</span></a></span><span> </span><span class="annot"><span class="annottext">ModuleName
</span><a href="#local-6989586621683006715"><span class="hs-identifier hs-var">mod_name</span></a></span><span>
</span><span id="line-671"></span><span>          </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">OrigNameCache -&gt; GenModule Unit -&gt; OccName -&gt; Maybe Name
</span><a href="GHC.Types.Name.Cache.html#lookupOrigNameCache"><span class="hs-identifier hs-var">lookupOrigNameCache</span></a></span><span> </span><span class="annot"><span class="annottext">OrigNameCache
</span><a href="#local-6989586621683006717"><span class="hs-identifier hs-var">cache</span></a></span><span> </span><span class="annot"><span class="annottext">GenModule Unit
</span><a href="#local-6989586621683006718"><span class="hs-identifier hs-var">mod</span></a></span><span> </span><span class="annot"><span class="annottext">OccName
</span><a href="#local-6989586621683006716"><span class="hs-identifier hs-var">occ</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-672"></span><span>            </span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span id="local-6989586621683006721"><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621683006721"><span class="hs-identifier hs-var">name</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-673"></span><span>              </span><span class="annot"><span class="annottext">IOArray Int Name -&gt; Int -&gt; Name -&gt; IO ()
forall (a :: * -&gt; * -&gt; *) e (m :: * -&gt; *) i.
(MArray a e m, Ix i) =&gt;
a i e -&gt; i -&gt; e -&gt; m ()
</span><a href="../../array-0.5.8.0-9044/src/Data.Array.Base.html#writeArray"><span class="hs-identifier hs-var">writeArray</span></a></span><span> </span><span class="annot"><span class="annottext">IOArray Int Name
</span><a href="#local-6989586621683006709"><span class="hs-identifier hs-var">mut_arr</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Word -&gt; Int
forall a b. (Integral a, Num b) =&gt; a -&gt; b
</span><span class="hs-identifier hs-var">fromIntegral</span></span><span> </span><span class="annot"><span class="annottext">Word
</span><a href="#local-6989586621683006713"><span class="hs-identifier hs-var">i</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621683006721"><span class="hs-identifier hs-var">name</span></a></span><span>
</span><span id="line-674"></span><span>              </span><span class="annot"><span class="annottext">OrigNameCache -&gt; IO OrigNameCache
forall a. a -&gt; IO a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="annot"><span class="annottext">OrigNameCache
</span><a href="#local-6989586621683006717"><span class="hs-identifier hs-var">cache</span></a></span><span>
</span><span id="line-675"></span><span>            </span><span class="annot"><span class="annottext">Maybe Name
</span><span class="hs-identifier hs-var">Nothing</span></span><span>   </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-676"></span><span>              </span><span id="local-6989586621683006723"><span class="annot"><a href="#local-6989586621683006723"><span class="hs-identifier hs-var">uniq</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">NameCache -&gt; IO Unique
</span><a href="GHC.Types.Name.Cache.html#takeUniqFromNameCache"><span class="hs-identifier hs-var">takeUniqFromNameCache</span></a></span><span> </span><span class="annot"><span class="annottext">NameCache
</span><a href="#local-6989586621683006705"><span class="hs-identifier hs-var">name_cache</span></a></span><span>
</span><span id="line-677"></span><span>              </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621683006725"><span class="annot"><a href="#local-6989586621683006725"><span class="hs-identifier hs-var hs-var">name</span></a></span></span><span>      </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Unique -&gt; GenModule Unit -&gt; OccName -&gt; SrcSpan -&gt; Name
</span><a href="GHC.Types.Name.html#mkExternalName"><span class="hs-identifier hs-var">mkExternalName</span></a></span><span> </span><span class="annot"><span class="annottext">Unique
</span><a href="#local-6989586621683006723"><span class="hs-identifier hs-var">uniq</span></a></span><span> </span><span class="annot"><span class="annottext">GenModule Unit
</span><a href="#local-6989586621683006718"><span class="hs-identifier hs-var">mod</span></a></span><span> </span><span class="annot"><span class="annottext">OccName
</span><a href="#local-6989586621683006716"><span class="hs-identifier hs-var">occ</span></a></span><span> </span><span class="annot"><span class="annottext">SrcSpan
</span><a href="GHC.Types.SrcLoc.html#noSrcSpan"><span class="hs-identifier hs-var">noSrcSpan</span></a></span><span>
</span><span id="line-678"></span><span>                  </span><span id="local-6989586621683006728"><span class="annot"><a href="#local-6989586621683006728"><span class="hs-identifier hs-var hs-var">new_cache</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">OrigNameCache -&gt; GenModule Unit -&gt; OccName -&gt; Name -&gt; OrigNameCache
</span><a href="GHC.Types.Name.Cache.html#extendOrigNameCache"><span class="hs-identifier hs-var">extendOrigNameCache</span></a></span><span> </span><span class="annot"><span class="annottext">OrigNameCache
</span><a href="#local-6989586621683006717"><span class="hs-identifier hs-var">cache</span></a></span><span> </span><span class="annot"><span class="annottext">GenModule Unit
</span><a href="#local-6989586621683006718"><span class="hs-identifier hs-var">mod</span></a></span><span> </span><span class="annot"><span class="annottext">OccName
</span><a href="#local-6989586621683006716"><span class="hs-identifier hs-var">occ</span></a></span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621683006725"><span class="hs-identifier hs-var">name</span></a></span><span>
</span><span id="line-679"></span><span>              </span><span class="annot"><a href="../../array-0.5.8.0-9044/src/Data.Array.Base.html#writeArray"><span class="hs-identifier hs-type">writeArray</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683006709"><span class="hs-identifier hs-type">mut_arr</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">fromIntegral</span></span><span> </span><span class="annot"><a href="#local-6989586621683006713"><span class="hs-identifier hs-type">i</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><a href="#local-6989586621683006725"><span class="hs-identifier hs-type">name</span></a></span><span>
</span><span id="line-680"></span><span>              </span><span class="annot"><span class="hs-identifier hs-type">return</span></span><span> </span><span class="annot"><a href="#local-6989586621683006728"><span class="hs-identifier hs-type">new_cache</span></a></span><span>
</span><span id="line-681"></span><span>        </span><span id="local-6989586621683006730"><span class="annot"><a href="#local-6989586621683006730"><span class="hs-identifier hs-var">arr</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><a href="../../array-0.5.8.0-9044/src/Data.Array.Base.html#unsafeFreeze"><span class="hs-identifier hs-type">unsafeFreeze</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683006709"><span class="hs-identifier hs-type">mut_arr</span></a></span><span>
</span><span id="line-682"></span><span>        </span><span class="annot"><span class="hs-identifier hs-type">return</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621683006711"><span class="hs-identifier hs-type">cache</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="#local-6989586621683006730"><span class="hs-identifier hs-type">arr</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-683"></span><span>
</span><span id="line-684"></span><span id="local-6989586621683005961"><span class="annot"><a href="GHC.Iface.Binary.html#serialiseName"><span class="hs-identifier hs-type">serialiseName</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Utils.Binary.html#WriteBinHandle"><span class="hs-identifier hs-type">WriteBinHandle</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Types.Name.html#Name"><span class="hs-identifier hs-type">Name</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Types.Unique.FM.html#UniqFM"><span class="hs-identifier hs-type">UniqFM</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683005961"><span class="hs-identifier hs-type">key</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Int</span></span><span class="hs-special">,</span><span class="annot"><a href="GHC.Types.Name.html#Name"><span class="hs-identifier hs-type">Name</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span></span><span>
</span><span id="line-685"></span><span id="serialiseName"><span class="annot"><span class="annottext">serialiseName :: forall {k} (key :: k).
WriteBinHandle -&gt; Name -&gt; UniqFM key (Int, Name) -&gt; IO ()
</span><a href="GHC.Iface.Binary.html#serialiseName"><span class="hs-identifier hs-var hs-var">serialiseName</span></a></span></span><span> </span><span id="local-6989586621683006738"><span class="annot"><span class="annottext">WriteBinHandle
</span><a href="#local-6989586621683006738"><span class="hs-identifier hs-var">bh</span></a></span></span><span> </span><span id="local-6989586621683006739"><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621683006739"><span class="hs-identifier hs-var">name</span></a></span></span><span> </span><span class="annot"><span class="annottext">UniqFM key (Int, Name)
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-686"></span><span>    </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621683006740"><span class="annot"><span class="annottext">mod :: GenModule Unit
</span><a href="#local-6989586621683006740"><span class="hs-identifier hs-var hs-var">mod</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Bool -&gt; SDoc -&gt; GenModule Unit -&gt; GenModule Unit
forall a. HasCallStack =&gt; Bool -&gt; SDoc -&gt; a -&gt; a
</span><a href="GHC.Utils.Panic.html#assertPpr"><span class="hs-identifier hs-var">assertPpr</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Name -&gt; Bool
</span><a href="GHC.Types.Name.html#isExternalName"><span class="hs-identifier hs-var">isExternalName</span></a></span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621683006739"><span class="hs-identifier hs-var">name</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Name -&gt; SDoc
forall a. Outputable a =&gt; a -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621683006739"><span class="hs-identifier hs-var">name</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">HasDebugCallStack =&gt; Name -&gt; GenModule Unit
Name -&gt; GenModule Unit
</span><a href="GHC.Types.Name.html#nameModule"><span class="hs-identifier hs-var">nameModule</span></a></span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621683006739"><span class="hs-identifier hs-var">name</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-687"></span><span>    </span><span class="annot"><span class="annottext">WriteBinHandle -&gt; (Unit, ModuleName, OccName) -&gt; IO ()
forall a. Binary a =&gt; WriteBinHandle -&gt; a -&gt; IO ()
</span><a href="GHC.Utils.Binary.html#put_"><span class="hs-identifier hs-var">put_</span></a></span><span> </span><span class="annot"><span class="annottext">WriteBinHandle
</span><a href="#local-6989586621683006738"><span class="hs-identifier hs-var">bh</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">GenModule Unit -&gt; Unit
forall unit. GenModule unit -&gt; unit
</span><a href="GHC.Unit.Types.html#moduleUnit"><span class="hs-identifier hs-var">moduleUnit</span></a></span><span> </span><span class="annot"><span class="annottext">GenModule Unit
</span><a href="#local-6989586621683006740"><span class="hs-identifier hs-var">mod</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">GenModule Unit -&gt; ModuleName
forall unit. GenModule unit -&gt; ModuleName
</span><a href="GHC.Unit.Types.html#moduleName"><span class="hs-identifier hs-var">moduleName</span></a></span><span> </span><span class="annot"><span class="annottext">GenModule Unit
</span><a href="#local-6989586621683006740"><span class="hs-identifier hs-var">mod</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Name -&gt; OccName
</span><a href="GHC.Types.Name.html#nameOccName"><span class="hs-identifier hs-var">nameOccName</span></a></span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621683006739"><span class="hs-identifier hs-var">name</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-688"></span><span>
</span><span id="line-689"></span><span>
</span><span id="line-690"></span><span class="hs-comment">-- Note [Symbol table representation of names]</span><span>
</span><span id="line-691"></span><span class="hs-comment">-- ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~</span><span>
</span><span id="line-692"></span><span class="hs-comment">--</span><span>
</span><span id="line-693"></span><span class="hs-comment">-- An occurrence of a name in an interface file is serialized as a single 32-bit</span><span>
</span><span id="line-694"></span><span class="hs-comment">-- word. The format of this word is:</span><span>
</span><span id="line-695"></span><span class="hs-comment">--  00xxxxxx xxxxxxxx xxxxxxxx xxxxxxxx</span><span>
</span><span id="line-696"></span><span class="hs-comment">--   A normal name. x is an index into the symbol table</span><span>
</span><span id="line-697"></span><span class="hs-comment">--  10xxxxxx xxyyyyyy yyyyyyyy yyyyyyyy</span><span>
</span><span id="line-698"></span><span class="hs-comment">--   A known-key name. x is the Unique's Char, y is the int part. We assume that</span><span>
</span><span id="line-699"></span><span class="hs-comment">--   all known-key uniques fit in this space. This is asserted by</span><span>
</span><span id="line-700"></span><span class="hs-comment">--   GHC.Builtin.Utils.knownKeyNamesOkay.</span><span>
</span><span id="line-701"></span><span class="hs-comment">--</span><span>
</span><span id="line-702"></span><span class="hs-comment">-- During serialization we check for known-key things using isKnownKeyName.</span><span>
</span><span id="line-703"></span><span class="hs-comment">-- During deserialization we use lookupKnownKeyName to get from the unique back</span><span>
</span><span id="line-704"></span><span class="hs-comment">-- to its corresponding Name.</span><span>
</span><span id="line-705"></span><span>
</span><span id="line-706"></span><span>
</span><span id="line-707"></span><span class="hs-comment">-- See Note [Symbol table representation of names]</span><span>
</span><span id="line-708"></span><span class="annot"><a href="GHC.Iface.Binary.html#putName"><span class="hs-identifier hs-type">putName</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Iface.Binary.html#BinSymbolTable"><span class="hs-identifier hs-type">BinSymbolTable</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Utils.Binary.html#WriteBinHandle"><span class="hs-identifier hs-type">WriteBinHandle</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Types.Name.html#Name"><span class="hs-identifier hs-type">Name</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-709"></span><span id="putName"><span class="annot"><span class="annottext">putName :: BinSymbolTable -&gt; WriteBinHandle -&gt; Name -&gt; IO ()
</span><a href="GHC.Iface.Binary.html#putName"><span class="hs-identifier hs-var hs-var">putName</span></a></span></span><span> </span><span class="annot"><a href="GHC.Iface.Binary.html#BinSymbolTable"><span class="hs-identifier hs-type">BinSymbolTable</span></a></span><span class="hs-special">{</span><span>
</span><span id="line-710"></span><span>               </span><span class="annot"><span class="annottext">bin_symtab_map :: BinSymbolTable -&gt; IORef (UniqFM Name (Int, Name))
</span><a href="GHC.Iface.Binary.html#bin_symtab_map"><span class="hs-identifier hs-var">bin_symtab_map</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="local-6989586621683006747"><span class="annot"><span class="annottext">IORef (UniqFM Name (Int, Name))
</span><a href="#local-6989586621683006747"><span class="hs-identifier hs-var">symtab_map_ref</span></a></span></span><span class="hs-special">,</span><span>
</span><span id="line-711"></span><span>               </span><span class="annot"><span class="annottext">bin_symtab_next :: BinSymbolTable -&gt; FastMutInt
</span><a href="GHC.Iface.Binary.html#bin_symtab_next"><span class="hs-identifier hs-var">bin_symtab_next</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="local-6989586621683006748"><span class="annot"><span class="annottext">FastMutInt
</span><a href="#local-6989586621683006748"><span class="hs-identifier hs-var">symtab_next</span></a></span></span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-712"></span><span>        </span><span id="local-6989586621683006749"><span class="annot"><span class="annottext">WriteBinHandle
</span><a href="#local-6989586621683006749"><span class="hs-identifier hs-var">bh</span></a></span></span><span> </span><span id="local-6989586621683006750"><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621683006750"><span class="hs-identifier hs-var">name</span></a></span></span><span>
</span><span id="line-713"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Name -&gt; Bool
</span><a href="GHC.Builtin.Utils.html#isKnownKeyName"><span class="hs-identifier hs-var">isKnownKeyName</span></a></span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621683006750"><span class="hs-identifier hs-var">name</span></a></span><span>
</span><span id="line-714"></span><span>  </span><span class="hs-special">,</span><span> </span><span class="hs-keyword">let</span><span> </span><span class="hs-special">(</span><span id="local-6989586621683006751"><span class="annot"><span class="annottext">Char
</span><a href="#local-6989586621683006751"><span class="hs-identifier hs-var">c</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621683006752"><span class="annot"><span class="annottext">Word64
</span><a href="#local-6989586621683006752"><span class="hs-identifier hs-var">u</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Unique -&gt; (Char, Word64)
</span><a href="GHC.Types.Unique.html#unpkUnique"><span class="hs-identifier hs-var">unpkUnique</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Name -&gt; Unique
</span><a href="GHC.Types.Name.html#nameUnique"><span class="hs-identifier hs-var">nameUnique</span></a></span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621683006750"><span class="hs-identifier hs-var">name</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-comment">-- INVARIANT: (ord c) fits in 8 bits</span><span>
</span><span id="line-715"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-comment">-- assert (u &lt; 2^(22 :: Int))</span><span>
</span><span id="line-716"></span><span>    </span><span class="annot"><span class="annottext">WriteBinHandle -&gt; Word32 -&gt; IO ()
forall a. Binary a =&gt; WriteBinHandle -&gt; a -&gt; IO ()
</span><a href="GHC.Utils.Binary.html#put_"><span class="hs-identifier hs-var">put_</span></a></span><span> </span><span class="annot"><span class="annottext">WriteBinHandle
</span><a href="#local-6989586621683006749"><span class="hs-identifier hs-var">bh</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Word32
</span><span class="hs-number">0x80000000</span></span><span>
</span><span id="line-717"></span><span>             </span><span class="annot"><span class="annottext">Word32 -&gt; Word32 -&gt; Word32
forall a. Bits a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">.|.</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int -&gt; Word32
forall a b. (Integral a, Num b) =&gt; a -&gt; b
</span><span class="hs-identifier hs-var">fromIntegral</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Char -&gt; Int
</span><span class="hs-identifier hs-var">ord</span></span><span> </span><span class="annot"><span class="annottext">Char
</span><a href="#local-6989586621683006751"><span class="hs-identifier hs-var">c</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Word32 -&gt; Int -&gt; Word32
forall a. Bits a =&gt; a -&gt; Int -&gt; a
</span><a href="GHC.Prelude.Basic.html#shiftL"><span class="hs-operator hs-var">`shiftL`</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">22</span></span><span class="hs-special">)</span><span>
</span><span id="line-718"></span><span>             </span><span class="annot"><span class="annottext">Word32 -&gt; Word32 -&gt; Word32
forall a. Bits a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">.|.</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Word64 -&gt; Word32
forall a b. (Integral a, Num b) =&gt; a -&gt; b
</span><span class="hs-identifier hs-var">fromIntegral</span></span><span> </span><span class="annot"><span class="annottext">Word64
</span><a href="#local-6989586621683006752"><span class="hs-identifier hs-var">u</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Word32</span></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-719"></span><span>
</span><span id="line-720"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">otherwise</span></span><span>
</span><span id="line-721"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span id="local-6989586621683006758"><span class="annot"><a href="#local-6989586621683006758"><span class="hs-identifier hs-var">symtab_map</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">IORef (UniqFM Name (Int, Name)) -&gt; IO (UniqFM Name (Int, Name))
forall a. IORef a -&gt; IO a
</span><span class="hs-identifier hs-var">readIORef</span></span><span> </span><span class="annot"><span class="annottext">IORef (UniqFM Name (Int, Name))
</span><a href="#local-6989586621683006747"><span class="hs-identifier hs-var">symtab_map_ref</span></a></span><span>
</span><span id="line-722"></span><span>       </span><span class="hs-keyword">case</span><span> </span><span class="annot"><a href="GHC.Types.Unique.FM.html#lookupUFM"><span class="hs-identifier hs-type">lookupUFM</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683006758"><span class="hs-identifier hs-type">symtab_map</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683006750"><span class="hs-identifier hs-type">name</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-723"></span><span>         </span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span class="hs-special">(</span><span id="local-6989586621683006760"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621683006760"><span class="hs-identifier hs-var">off</span></a></span></span><span class="hs-special">,</span><span class="annot"><span class="annottext">Name
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">WriteBinHandle -&gt; Word32 -&gt; IO ()
forall a. Binary a =&gt; WriteBinHandle -&gt; a -&gt; IO ()
</span><a href="GHC.Utils.Binary.html#put_"><span class="hs-identifier hs-var">put_</span></a></span><span> </span><span class="annot"><span class="annottext">WriteBinHandle
</span><a href="#local-6989586621683006749"><span class="hs-identifier hs-var">bh</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int -&gt; Word32
forall a b. (Integral a, Num b) =&gt; a -&gt; b
</span><span class="hs-identifier hs-var">fromIntegral</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621683006760"><span class="hs-identifier hs-var">off</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Word32</span></span><span class="hs-special">)</span><span>
</span><span id="line-724"></span><span>         </span><span class="annot"><span class="annottext">Maybe (Int, Name)
</span><span class="hs-identifier hs-var">Nothing</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-725"></span><span>            </span><span id="local-6989586621683006761"><span class="annot"><a href="#local-6989586621683006761"><span class="hs-identifier hs-var">off</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">FastMutInt -&gt; IO Int
</span><a href="GHC.Data.FastMutInt.html#readFastMutInt"><span class="hs-identifier hs-var">readFastMutInt</span></a></span><span> </span><span class="annot"><span class="annottext">FastMutInt
</span><a href="#local-6989586621683006748"><span class="hs-identifier hs-var">symtab_next</span></a></span><span>
</span><span id="line-726"></span><span>            </span><span class="hs-comment">-- massert (off &lt; 2^(30 :: Int))</span><span>
</span><span id="line-727"></span><span>            </span><span class="annot"><a href="GHC.Data.FastMutInt.html#writeFastMutInt"><span class="hs-identifier hs-type">writeFastMutInt</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683006748"><span class="hs-identifier hs-type">symtab_next</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621683006761"><span class="hs-identifier hs-type">off</span></a></span><span class="annot"><span class="hs-operator hs-type">+</span></span><span class="annot"><span class="hs-number">1</span></span><span class="hs-special">)</span><span>
</span><span id="line-728"></span><span>            </span><span class="annot"><span class="hs-identifier hs-type">writeIORef</span></span><span> </span><span class="annot"><a href="#local-6989586621683006747"><span class="hs-identifier hs-type">symtab_map_ref</span></a></span><span>
</span><span id="line-729"></span><span>                </span><span class="annot"><span class="hs-operator hs-type">$!</span></span><span> </span><span class="annot"><a href="GHC.Types.Unique.FM.html#addToUFM"><span class="hs-identifier hs-type">addToUFM</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683006758"><span class="hs-identifier hs-type">symtab_map</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683006750"><span class="hs-identifier hs-type">name</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621683006761"><span class="hs-identifier hs-type">off</span></a></span><span class="hs-special">,</span><span class="annot"><a href="#local-6989586621683006750"><span class="hs-identifier hs-type">name</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-730"></span><span>            </span><span class="annot"><a href="GHC.Utils.Binary.html#put_"><span class="hs-identifier hs-type">put_</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683006749"><span class="hs-identifier hs-type">bh</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">fromIntegral</span></span><span> </span><span class="annot"><a href="#local-6989586621683006761"><span class="hs-identifier hs-type">off</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Word32</span></span><span class="hs-special">)</span><span>
</span><span id="line-731"></span><span>
</span><span id="line-732"></span><span class="hs-comment">-- See Note [Symbol table representation of names]</span><span>
</span><span id="line-733"></span><span class="annot"><a href="GHC.Iface.Binary.html#getSymtabName"><span class="hs-identifier hs-type">getSymtabName</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Utils.Binary.html#SymbolTable"><span class="hs-identifier hs-type">SymbolTable</span></a></span><span> </span><span class="annot"><a href="GHC.Types.Name.html#Name"><span class="hs-identifier hs-type">Name</span></a></span><span>
</span><span id="line-734"></span><span>              </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Utils.Binary.html#ReadBinHandle"><span class="hs-identifier hs-type">ReadBinHandle</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="annot"><a href="GHC.Types.Name.html#Name"><span class="hs-identifier hs-type">Name</span></a></span><span>
</span><span id="line-735"></span><span id="getSymtabName"><span class="annot"><span class="annottext">getSymtabName :: SymbolTable Name -&gt; ReadBinHandle -&gt; IO Name
</span><a href="GHC.Iface.Binary.html#getSymtabName"><span class="hs-identifier hs-var hs-var">getSymtabName</span></a></span></span><span> </span><span id="local-6989586621683006766"><span class="annot"><span class="annottext">SymbolTable Name
</span><a href="#local-6989586621683006766"><span class="hs-identifier hs-var">symtab</span></a></span></span><span> </span><span id="local-6989586621683006767"><span class="annot"><span class="annottext">ReadBinHandle
</span><a href="#local-6989586621683006767"><span class="hs-identifier hs-var">bh</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-736"></span><span>    </span><span id="local-6989586621683006768"><span class="annot"><a href="#local-6989586621683006768"><span class="hs-identifier hs-var">i</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier">Word32</span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">ReadBinHandle -&gt; IO Word32
forall a. Binary a =&gt; ReadBinHandle -&gt; IO a
</span><a href="GHC.Utils.Binary.html#get"><span class="hs-identifier hs-var">get</span></a></span><span> </span><span class="annot"><span class="annottext">ReadBinHandle
</span><a href="#local-6989586621683006767"><span class="hs-identifier hs-var">bh</span></a></span><span>
</span><span id="line-737"></span><span>    </span><span class="hs-keyword">case</span><span> </span><span class="annot"><a href="#local-6989586621683006768"><span class="hs-identifier hs-type">i</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">.&amp;.</span></span><span> </span><span class="annot"><span class="hs-number">0xC0000000</span></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-738"></span><span>      </span><span class="annot"><span class="annottext">Word32
</span><span class="hs-number">0x00000000</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Name -&gt; IO Name
forall a. a -&gt; IO a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="annot"><span class="annottext">(Name -&gt; IO Name) -&gt; Name -&gt; IO Name
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$!</span></span><span> </span><span class="annot"><span class="annottext">SymbolTable Name
</span><a href="#local-6989586621683006766"><span class="hs-identifier hs-var">symtab</span></a></span><span> </span><span class="annot"><span class="annottext">SymbolTable Name -&gt; Int -&gt; Name
forall i e. Ix i =&gt; Array i e -&gt; i -&gt; e
</span><span class="hs-operator hs-var">!</span></span><span> </span><span class="annot"><span class="annottext">Word32 -&gt; Int
forall a b. (Integral a, Num b) =&gt; a -&gt; b
</span><span class="hs-identifier hs-var">fromIntegral</span></span><span> </span><span class="annot"><span class="annottext">Word32
</span><a href="#local-6989586621683006768"><span class="hs-identifier hs-var">i</span></a></span><span>
</span><span id="line-739"></span><span>
</span><span id="line-740"></span><span>      </span><span class="annot"><span class="annottext">Word32
</span><span class="hs-number">0x80000000</span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-741"></span><span>        </span><span class="hs-keyword">let</span><span>
</span><span id="line-742"></span><span>          </span><span id="local-6989586621683006771"><span class="annot"><span class="annottext">tag :: Char
</span><a href="#local-6989586621683006771"><span class="hs-identifier hs-var hs-var">tag</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Int -&gt; Char
</span><span class="hs-identifier hs-var">chr</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Word32 -&gt; Int
forall a b. (Integral a, Num b) =&gt; a -&gt; b
</span><span class="hs-identifier hs-var">fromIntegral</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">(</span><span class="annot"><span class="annottext">Word32
</span><a href="#local-6989586621683006768"><span class="hs-identifier hs-var">i</span></a></span><span> </span><span class="annot"><span class="annottext">Word32 -&gt; Word32 -&gt; Word32
forall a. Bits a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">.&amp;.</span></span><span> </span><span class="annot"><span class="annottext">Word32
</span><span class="hs-number">0x3FC00000</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Word32 -&gt; Int -&gt; Word32
forall a. Bits a =&gt; a -&gt; Int -&gt; a
</span><a href="GHC.Prelude.Basic.html#shiftR"><span class="hs-operator hs-var">`shiftR`</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">22</span></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-743"></span><span>          </span><span id="local-6989586621683006774"><span class="annot"><span class="annottext">ix :: Word64
</span><a href="#local-6989586621683006774"><span class="hs-identifier hs-var hs-var">ix</span></a></span></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Word32 -&gt; Word64
forall a b. (Integral a, Num b) =&gt; a -&gt; b
</span><span class="hs-identifier hs-var">fromIntegral</span></span><span> </span><span class="annot"><span class="annottext">Word32
</span><a href="#local-6989586621683006768"><span class="hs-identifier hs-var">i</span></a></span><span> </span><span class="annot"><span class="annottext">Word64 -&gt; Word64 -&gt; Word64
forall a. Bits a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">.&amp;.</span></span><span> </span><span class="annot"><span class="annottext">Word64
</span><span class="hs-number">0x003FFFFF</span></span><span>
</span><span id="line-744"></span><span>          </span><span id="local-6989586621683006775"><span class="annot"><span class="annottext">u :: Unique
</span><a href="#local-6989586621683006775"><span class="hs-identifier hs-var hs-var">u</span></a></span></span><span>   </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Char -&gt; Word64 -&gt; Unique
</span><a href="GHC.Types.Unique.html#mkUnique"><span class="hs-identifier hs-var">mkUnique</span></a></span><span> </span><span class="annot"><span class="annottext">Char
</span><a href="#local-6989586621683006771"><span class="hs-identifier hs-var">tag</span></a></span><span> </span><span class="annot"><span class="annottext">Word64
</span><a href="#local-6989586621683006774"><span class="hs-identifier hs-var">ix</span></a></span><span>
</span><span id="line-745"></span><span>        </span><span class="hs-keyword">in</span><span>
</span><span id="line-746"></span><span>          </span><span class="annot"><span class="annottext">Name -&gt; IO Name
forall a. a -&gt; IO a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="annot"><span class="annottext">(Name -&gt; IO Name) -&gt; Name -&gt; IO Name
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$!</span></span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">Unique -&gt; Maybe Name
</span><a href="GHC.Builtin.Utils.html#lookupKnownKeyName"><span class="hs-identifier hs-var">lookupKnownKeyName</span></a></span><span> </span><span class="annot"><span class="annottext">Unique
</span><a href="#local-6989586621683006775"><span class="hs-identifier hs-var">u</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-747"></span><span>                      </span><span class="annot"><span class="annottext">Maybe Name
</span><span class="hs-identifier hs-var">Nothing</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">String -&gt; SDoc -&gt; Name
forall a. HasCallStack =&gt; String -&gt; SDoc -&gt; a
</span><a href="GHC.Utils.Panic.html#pprPanic"><span class="hs-identifier hs-var">pprPanic</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;getSymtabName:unknown known-key unique&quot;</span></span><span>
</span><span id="line-748"></span><span>                                          </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Word32 -&gt; SDoc
forall a. Outputable a =&gt; a -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="annot"><span class="annottext">Word32
</span><a href="#local-6989586621683006768"><span class="hs-identifier hs-var">i</span></a></span><span> </span><span class="annot"><span class="annottext">SDoc -&gt; SDoc -&gt; SDoc
forall doc. IsDoc doc =&gt; doc -&gt; doc -&gt; doc
</span><a href="GHC.Utils.Outputable.html#%24%24"><span class="hs-operator hs-var">$$</span></a></span><span> </span><span class="annot"><span class="annottext">Unique -&gt; SDoc
forall a. Outputable a =&gt; a -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="annot"><span class="annottext">Unique
</span><a href="#local-6989586621683006775"><span class="hs-identifier hs-var">u</span></a></span><span> </span><span class="annot"><span class="annottext">SDoc -&gt; SDoc -&gt; SDoc
forall doc. IsDoc doc =&gt; doc -&gt; doc -&gt; doc
</span><a href="GHC.Utils.Outputable.html#%24%24"><span class="hs-operator hs-var">$$</span></a></span><span> </span><span class="annot"><span class="annottext">Char -&gt; SDoc
forall doc. IsLine doc =&gt; Char -&gt; doc
</span><a href="GHC.Utils.Outputable.html#char"><span class="hs-identifier hs-var">char</span></a></span><span> </span><span class="annot"><span class="annottext">Char
</span><a href="#local-6989586621683006771"><span class="hs-identifier hs-var">tag</span></a></span><span> </span><span class="annot"><span class="annottext">SDoc -&gt; SDoc -&gt; SDoc
forall doc. IsDoc doc =&gt; doc -&gt; doc -&gt; doc
</span><a href="GHC.Utils.Outputable.html#%24%24"><span class="hs-operator hs-var">$$</span></a></span><span> </span><span class="annot"><span class="annottext">Word64 -&gt; SDoc
forall a. Outputable a =&gt; a -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="annot"><span class="annottext">Word64
</span><a href="#local-6989586621683006774"><span class="hs-identifier hs-var">ix</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-749"></span><span>                      </span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span id="local-6989586621683006780"><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621683006780"><span class="hs-identifier hs-var">n</span></a></span></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621683006780"><span class="hs-identifier hs-var">n</span></a></span><span>
</span><span id="line-750"></span><span>
</span><span id="line-751"></span><span>      </span><span class="annot"><span class="annottext">Word32
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">String -&gt; SDoc -&gt; IO Name
forall a. HasCallStack =&gt; String -&gt; SDoc -&gt; a
</span><a href="GHC.Utils.Panic.html#pprPanic"><span class="hs-identifier hs-var">pprPanic</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;getSymtabName:unknown name tag&quot;</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Word32 -&gt; SDoc
forall a. Outputable a =&gt; a -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="annot"><span class="annottext">Word32
</span><a href="#local-6989586621683006768"><span class="hs-identifier hs-var">i</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-752"></span></pre></body></html>