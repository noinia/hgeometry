<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><link rel="stylesheet" type="text/css" href="style.css" /><script type="text/javascript" src="highlight.js"></script></head><body><pre><span class="hs-pragma">{-# LANGUAGE MagicHash #-}</span><span>
</span><span id="line-2"></span><span>
</span><span id="line-3"></span><span class="hs-comment">-----------------------------------------------------------------------------</span><span>
</span><span id="line-4"></span><span class="hs-comment">--</span><span>
</span><span id="line-5"></span><span class="hs-comment">-- GHC Interactive support for inspecting arbitrary closures at runtime</span><span>
</span><span id="line-6"></span><span class="hs-comment">--</span><span>
</span><span id="line-7"></span><span class="hs-comment">-- Pepe Iborra (supported by Google SoC) 2006</span><span>
</span><span id="line-8"></span><span class="hs-comment">--</span><span>
</span><span id="line-9"></span><span class="hs-comment">-----------------------------------------------------------------------------</span><span>
</span><span id="line-10"></span><span class="hs-keyword">module</span><span> </span><span class="annot"><a href="GHC.Runtime.Heap.Inspect.html"><span class="hs-identifier">GHC.Runtime.Heap.Inspect</span></a></span><span class="hs-special">(</span><span>
</span><span id="line-11"></span><span>     </span><span class="annot"><span class="hs-comment">-- * Entry points and types</span></span><span>
</span><span id="line-12"></span><span>     </span><span class="annot"><a href="GHC.Runtime.Heap.Inspect.html#cvObtainTerm"><span class="hs-identifier">cvObtainTerm</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-13"></span><span>     </span><span class="annot"><a href="GHC.Runtime.Heap.Inspect.html#cvReconstructType"><span class="hs-identifier">cvReconstructType</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-14"></span><span>     </span><span class="annot"><a href="GHC.Runtime.Heap.Inspect.html#improveRTTIType"><span class="hs-identifier">improveRTTIType</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-15"></span><span>     </span><span class="annot"><a href="GHC.Runtime.Heap.Inspect.html#Term"><span class="hs-identifier">Term</span></a></span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span>
</span><span id="line-16"></span><span>
</span><span id="line-17"></span><span>     </span><span class="annot"><span class="hs-comment">-- * Utils</span></span><span>
</span><span id="line-18"></span><span>     </span><span class="annot"><a href="GHC.Runtime.Heap.Inspect.html#isFullyEvaluatedTerm"><span class="hs-identifier">isFullyEvaluatedTerm</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-19"></span><span>     </span><span class="annot"><a href="GHC.Runtime.Heap.Inspect.html#termType"><span class="hs-identifier">termType</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Runtime.Heap.Inspect.html#mapTermType"><span class="hs-identifier">mapTermType</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Runtime.Heap.Inspect.html#termTyCoVars"><span class="hs-identifier">termTyCoVars</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-20"></span><span>     </span><span class="annot"><a href="GHC.Runtime.Heap.Inspect.html#foldTerm"><span class="hs-identifier">foldTerm</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Runtime.Heap.Inspect.html#TermFold"><span class="hs-identifier">TermFold</span></a></span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span>
</span><span id="line-21"></span><span>     </span><span class="annot"><a href="GHC.Runtime.Heap.Inspect.html#cPprTerm"><span class="hs-identifier">cPprTerm</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Runtime.Heap.Inspect.html#cPprTermBase"><span class="hs-identifier">cPprTermBase</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-22"></span><span>
</span><span id="line-23"></span><span>     </span><span class="annot"><a href="GHC.Runtime.Heap.Inspect.html#constrClosToName"><span class="hs-identifier">constrClosToName</span></a></span><span> </span><span class="hs-comment">-- exported to use in test T4891</span><span>
</span><span id="line-24"></span><span> </span><span class="hs-special">)</span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-25"></span><span>
</span><span id="line-26"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Prelude.html"><span class="hs-identifier">GHC.Prelude</span></a></span><span> </span><span class="hs-keyword">hiding</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Prelude.Basic.html#head"><span class="hs-identifier">head</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">init</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">last</span></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Prelude.Basic.html#tail"><span class="hs-identifier">tail</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-27"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Platform.html"><span class="hs-identifier">GHC.Platform</span></a></span><span>
</span><span id="line-28"></span><span>
</span><span id="line-29"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Runtime.Interpreter.html"><span class="hs-identifier">GHC.Runtime.Interpreter</span></a></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">GHCi</span></span><span>
</span><span id="line-30"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="../../ghci-9.12.2-bd10/src/GHCi.RemoteTypes.html"><span class="hs-identifier">GHCi.RemoteTypes</span></a></span><span>
</span><span id="line-31"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Driver.Env.html"><span class="hs-identifier">GHC.Driver.Env</span></a></span><span>
</span><span id="line-32"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="../../ghci-9.12.2-bd10/src/GHCi.Message.html"><span class="hs-identifier">GHCi.Message</span></a></span><span> </span><span class="hs-special">(</span><span> </span><span class="annot"><a href="../../ghci-9.12.2-bd10/src/GHCi.Message.html#fromSerializableException"><span class="hs-identifier">fromSerializableException</span></a></span><span> </span><span class="hs-special">)</span><span>
</span><span id="line-33"></span><span>
</span><span id="line-34"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Core.DataCon.html"><span class="hs-identifier">GHC.Core.DataCon</span></a></span><span>
</span><span id="line-35"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Core.Type.html"><span class="hs-identifier">GHC.Core.Type</span></a></span><span>
</span><span id="line-36"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Types.RepType.html"><span class="hs-identifier">GHC.Types.RepType</span></a></span><span>
</span><span id="line-37"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Core.Multiplicity.html"><span class="hs-identifier">GHC.Core.Multiplicity</span></a></span><span>
</span><span id="line-38"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><a href="GHC.Core.Unify.html"><span class="hs-identifier">GHC.Core.Unify</span></a></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">U</span></span><span>
</span><span id="line-39"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Core.TyCon.html"><span class="hs-identifier">GHC.Core.TyCon</span></a></span><span>
</span><span id="line-40"></span><span>
</span><span id="line-41"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.Monad.html"><span class="hs-identifier">GHC.Tc.Utils.Monad</span></a></span><span>
</span><span id="line-42"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.TcType.html"><span class="hs-identifier">GHC.Tc.Utils.TcType</span></a></span><span>
</span><span id="line-43"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.TcMType.html"><span class="hs-identifier">GHC.Tc.Utils.TcMType</span></a></span><span>
</span><span id="line-44"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Tc.Zonk.Type.html"><span class="hs-identifier">GHC.Tc.Zonk.Type</span></a></span><span>
</span><span id="line-45"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.Unify.html"><span class="hs-identifier">GHC.Tc.Utils.Unify</span></a></span><span>
</span><span id="line-46"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.Env.html"><span class="hs-identifier">GHC.Tc.Utils.Env</span></a></span><span>
</span><span id="line-47"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Tc.Zonk.TcType.html"><span class="hs-identifier">GHC.Tc.Zonk.TcType</span></a></span><span>
</span><span id="line-48"></span><span>
</span><span id="line-49"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Types.Var.html"><span class="hs-identifier">GHC.Types.Var</span></a></span><span>
</span><span id="line-50"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Types.Name.html"><span class="hs-identifier">GHC.Types.Name</span></a></span><span>
</span><span id="line-51"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Types.Name.Occurrence.html"><span class="hs-identifier">GHC.Types.Name.Occurrence</span></a></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">OccName</span></span><span>
</span><span id="line-52"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Unit.Module.html"><span class="hs-identifier">GHC.Unit.Module</span></a></span><span>
</span><span id="line-53"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Iface.Env.html"><span class="hs-identifier">GHC.Iface.Env</span></a></span><span>
</span><span id="line-54"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Utils.Misc.html"><span class="hs-identifier">GHC.Utils.Misc</span></a></span><span>
</span><span id="line-55"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Types.Var.Set.html"><span class="hs-identifier">GHC.Types.Var.Set</span></a></span><span>
</span><span id="line-56"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Types.Basic.html"><span class="hs-identifier">GHC.Types.Basic</span></a></span><span> </span><span class="hs-special">(</span><span> </span><span class="annot"><a href="Language.Haskell.Syntax.Basic.html#Boxity"><span class="hs-identifier">Boxity</span></a></span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span> </span><span class="hs-special">)</span><span>
</span><span id="line-57"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Builtin.Types.Prim.html"><span class="hs-identifier">GHC.Builtin.Types.Prim</span></a></span><span>
</span><span id="line-58"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Builtin.Types.html"><span class="hs-identifier">GHC.Builtin.Types</span></a></span><span>
</span><span id="line-59"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Driver.DynFlags.html"><span class="hs-identifier">GHC.Driver.DynFlags</span></a></span><span>
</span><span id="line-60"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Driver.Ppr.html"><span class="hs-identifier">GHC.Driver.Ppr</span></a></span><span>
</span><span id="line-61"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Utils.Outputable.html"><span class="hs-identifier">GHC.Utils.Outputable</span></a></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">Ppr</span></span><span>
</span><span id="line-62"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Utils.Panic.html"><span class="hs-identifier">GHC.Utils.Panic</span></a></span><span>
</span><span id="line-63"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="../../base-4.21.0.0-ae91/src/GHC.Char.html"><span class="hs-identifier">GHC.Char</span></a></span><span>
</span><span id="line-64"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="../../ghc-heap-9.12.2-4363/src/GHC.Exts.Heap.html"><span class="hs-identifier">GHC.Exts.Heap</span></a></span><span>
</span><span id="line-65"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Runtime.Heap.Layout.html"><span class="hs-identifier">GHC.Runtime.Heap.Layout</span></a></span><span> </span><span class="hs-special">(</span><span> </span><span class="annot"><a href="GHC.Runtime.Heap.Layout.html#roundUpTo"><span class="hs-identifier">roundUpTo</span></a></span><span> </span><span class="hs-special">)</span><span>
</span><span id="line-66"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="../../base-4.21.0.0-ae91/src/GHC.IO.html"><span class="hs-identifier">GHC.IO</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">throwIO</span></span><span class="hs-special">)</span><span>
</span><span id="line-67"></span><span>
</span><span id="line-68"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="../../base-4.21.0.0-ae91/src/Control.Monad.html"><span class="hs-identifier">Control.Monad</span></a></span><span>
</span><span id="line-69"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="../../base-4.21.0.0-ae91/src/Data.Maybe.html"><span class="hs-identifier">Data.Maybe</span></a></span><span>
</span><span id="line-70"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="../../base-4.21.0.0-ae91/src/Data.List.html"><span class="hs-identifier">Data.List</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-operator">(\\)</span></span><span class="hs-special">)</span><span>
</span><span id="line-71"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="../../base-4.21.0.0-ae91/src/Data.List.NonEmpty.html"><span class="hs-identifier">Data.List.NonEmpty</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">NonEmpty</span></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-72"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><a href="../../base-4.21.0.0-ae91/src/Data.List.NonEmpty.html"><span class="hs-identifier">Data.List.NonEmpty</span></a></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">NE</span></span><span>
</span><span id="line-73"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="../../base-4.21.0.0-ae91/src/GHC.Exts.html"><span class="hs-identifier">GHC.Exts</span></a></span><span>
</span><span id="line-74"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><a href="../../containers-0.7-5a8f/src/Data.Sequence.html"><span class="hs-identifier">Data.Sequence</span></a></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">Seq</span></span><span>
</span><span id="line-75"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="../../containers-0.7-5a8f/src/Data.Sequence.html"><span class="hs-identifier">Data.Sequence</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../../containers-0.7-5a8f/src/Data.Sequence.Internal.html#viewl"><span class="hs-identifier">viewl</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="../../containers-0.7-5a8f/src/Data.Sequence.Internal.html#ViewL"><span class="hs-identifier">ViewL</span></a></span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-76"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="../../base-4.21.0.0-ae91/src/Foreign.html"><span class="hs-identifier">Foreign</span></a></span><span> </span><span class="hs-keyword">hiding</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">shiftL</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">shiftR</span></span><span class="hs-special">)</span><span>
</span><span id="line-77"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="../../base-4.21.0.0-ae91/src/System.IO.Unsafe.html"><span class="hs-identifier">System.IO.Unsafe</span></a></span><span>
</span><span id="line-78"></span><span>
</span><span id="line-79"></span><span class="hs-comment">---------------------------------------------</span><span>
</span><span id="line-80"></span><span class="annot"><span class="hs-comment">-- * A representation of semi evaluated Terms</span></span><span>
</span><span id="line-81"></span><span class="hs-comment">---------------------------------------------</span><span>
</span><span id="line-82"></span><span>
</span><span id="line-83"></span><span class="hs-keyword">data</span><span> </span><span id="Term"><span class="annot"><a href="GHC.Runtime.Heap.Inspect.html#Term"><span class="hs-identifier hs-var">Term</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="Term"><span class="annot"><a href="GHC.Runtime.Heap.Inspect.html#Term"><span class="hs-identifier hs-var">Term</span></a></span></span><span> </span><span class="hs-special">{</span><span> </span><span id="ty"><span class="annot"><span class="annottext">Term -&gt; Type
</span><a href="GHC.Runtime.Heap.Inspect.html#ty"><span class="hs-identifier hs-var hs-var">ty</span></a></span></span><span>        </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Runtime.Heap.Inspect.html#RttiType"><span class="hs-identifier hs-type">RttiType</span></a></span><span>
</span><span id="line-84"></span><span>                 </span><span class="hs-special">,</span><span> </span><span id="dc"><span class="annot"><span class="annottext">Term -&gt; Either String DataCon
</span><a href="GHC.Runtime.Heap.Inspect.html#dc"><span class="hs-identifier hs-var hs-var">dc</span></a></span></span><span>        </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Either</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">String</span></span><span> </span><span class="annot"><a href="GHC.Core.DataCon.html#DataCon"><span class="hs-identifier hs-type">DataCon</span></a></span><span>
</span><span id="line-85"></span><span>                               </span><span class="hs-comment">-- Carries a text representation if the datacon is</span><span>
</span><span id="line-86"></span><span>                               </span><span class="hs-comment">-- not exported by the .hi file, which is the case</span><span>
</span><span id="line-87"></span><span>                               </span><span class="hs-comment">-- for private constructors in -O0 compiled libraries</span><span>
</span><span id="line-88"></span><span>                 </span><span class="hs-special">,</span><span> </span><span id="val"><span class="annot"><span class="annottext">Term -&gt; ForeignHValue
</span><a href="GHC.Runtime.Heap.Inspect.html#val"><span class="hs-identifier hs-var hs-var">val</span></a></span></span><span>       </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="../../ghci-9.12.2-bd10/src/GHCi.RemoteTypes.html#ForeignHValue"><span class="hs-identifier hs-type">ForeignHValue</span></a></span><span>
</span><span id="line-89"></span><span>                 </span><span class="hs-special">,</span><span> </span><span id="subTerms"><span class="annot"><span class="annottext">Term -&gt; [Term]
</span><a href="GHC.Runtime.Heap.Inspect.html#subTerms"><span class="hs-identifier hs-var hs-var">subTerms</span></a></span></span><span>  </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="GHC.Runtime.Heap.Inspect.html#Term"><span class="hs-identifier hs-type">Term</span></a></span><span class="hs-special">]</span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-90"></span><span>
</span><span id="line-91"></span><span>          </span><span class="hs-glyph">|</span><span> </span><span id="Prim"><span class="annot"><a href="GHC.Runtime.Heap.Inspect.html#Prim"><span class="hs-identifier hs-var">Prim</span></a></span></span><span> </span><span class="hs-special">{</span><span> </span><span id="ty"><span class="annot"><a href="GHC.Runtime.Heap.Inspect.html#ty"><span class="hs-identifier hs-var">ty</span></a></span></span><span>        </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Runtime.Heap.Inspect.html#RttiType"><span class="hs-identifier hs-type">RttiType</span></a></span><span>
</span><span id="line-92"></span><span>                 </span><span class="hs-special">,</span><span> </span><span id="valRaw"><span class="annot"><span class="annottext">Term -&gt; [Word]
</span><a href="GHC.Runtime.Heap.Inspect.html#valRaw"><span class="hs-identifier hs-var hs-var">valRaw</span></a></span></span><span>    </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><span class="annot"><span class="hs-identifier hs-type">Word</span></span><span class="hs-special">]</span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-93"></span><span>
</span><span id="line-94"></span><span>          </span><span class="hs-glyph">|</span><span> </span><span id="Suspension"><span class="annot"><a href="GHC.Runtime.Heap.Inspect.html#Suspension"><span class="hs-identifier hs-var">Suspension</span></a></span></span><span> </span><span class="hs-special">{</span><span> </span><span id="ctype"><span class="annot"><span class="annottext">Term -&gt; ClosureType
</span><a href="GHC.Runtime.Heap.Inspect.html#ctype"><span class="hs-identifier hs-var hs-var">ctype</span></a></span></span><span>    </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">ClosureType</span></span><span>
</span><span id="line-95"></span><span>                       </span><span class="hs-special">,</span><span> </span><span id="ty"><span class="annot"><a href="GHC.Runtime.Heap.Inspect.html#ty"><span class="hs-identifier hs-var">ty</span></a></span></span><span>       </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Runtime.Heap.Inspect.html#RttiType"><span class="hs-identifier hs-type">RttiType</span></a></span><span>
</span><span id="line-96"></span><span>                       </span><span class="hs-special">,</span><span> </span><span id="val"><span class="annot"><a href="GHC.Runtime.Heap.Inspect.html#val"><span class="hs-identifier hs-var">val</span></a></span></span><span>      </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="../../ghci-9.12.2-bd10/src/GHCi.RemoteTypes.html#ForeignHValue"><span class="hs-identifier hs-type">ForeignHValue</span></a></span><span>
</span><span id="line-97"></span><span>                       </span><span class="hs-special">,</span><span> </span><span id="bound_to"><span class="annot"><span class="annottext">Term -&gt; Maybe Name
</span><a href="GHC.Runtime.Heap.Inspect.html#bound_to"><span class="hs-identifier hs-var hs-var">bound_to</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Maybe</span></span><span> </span><span class="annot"><a href="GHC.Types.Name.html#Name"><span class="hs-identifier hs-type">Name</span></a></span><span>   </span><span class="hs-comment">-- Useful for printing</span><span>
</span><span id="line-98"></span><span>                       </span><span class="hs-special">}</span><span>
</span><span id="line-99"></span><span>          </span><span class="hs-glyph">|</span><span> </span><span id="NewtypeWrap"><span class="annot"><a href="GHC.Runtime.Heap.Inspect.html#NewtypeWrap"><span class="hs-identifier hs-var">NewtypeWrap</span></a></span></span><span class="hs-special">{</span><span>       </span><span class="hs-comment">-- At runtime there are no newtypes, and hence no</span><span>
</span><span id="line-100"></span><span>                               </span><span class="hs-comment">-- newtype constructors. A NewtypeWrap is just a</span><span>
</span><span id="line-101"></span><span>                               </span><span class="hs-comment">-- made-up tag saying &quot;heads up, there used to be</span><span>
</span><span id="line-102"></span><span>                               </span><span class="hs-comment">-- a newtype constructor here&quot;.</span><span>
</span><span id="line-103"></span><span>                         </span><span id="ty"><span class="annot"><a href="GHC.Runtime.Heap.Inspect.html#ty"><span class="hs-identifier hs-var">ty</span></a></span></span><span>           </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Runtime.Heap.Inspect.html#RttiType"><span class="hs-identifier hs-type">RttiType</span></a></span><span>
</span><span id="line-104"></span><span>                       </span><span class="hs-special">,</span><span> </span><span id="dc"><span class="annot"><a href="GHC.Runtime.Heap.Inspect.html#dc"><span class="hs-identifier hs-var">dc</span></a></span></span><span>           </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Either</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">String</span></span><span> </span><span class="annot"><a href="GHC.Core.DataCon.html#DataCon"><span class="hs-identifier hs-type">DataCon</span></a></span><span>
</span><span id="line-105"></span><span>                       </span><span class="hs-special">,</span><span> </span><span id="wrapped_term"><span class="annot"><span class="annottext">Term -&gt; Term
</span><a href="GHC.Runtime.Heap.Inspect.html#wrapped_term"><span class="hs-identifier hs-var hs-var">wrapped_term</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Runtime.Heap.Inspect.html#Term"><span class="hs-identifier hs-type">Term</span></a></span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-106"></span><span>          </span><span class="hs-glyph">|</span><span> </span><span id="RefWrap"><span class="annot"><a href="GHC.Runtime.Heap.Inspect.html#RefWrap"><span class="hs-identifier hs-var">RefWrap</span></a></span></span><span>    </span><span class="hs-special">{</span><span>       </span><span class="hs-comment">-- The contents of a reference</span><span>
</span><span id="line-107"></span><span>                         </span><span id="ty"><span class="annot"><a href="GHC.Runtime.Heap.Inspect.html#ty"><span class="hs-identifier hs-var">ty</span></a></span></span><span>           </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Runtime.Heap.Inspect.html#RttiType"><span class="hs-identifier hs-type">RttiType</span></a></span><span>
</span><span id="line-108"></span><span>                       </span><span class="hs-special">,</span><span> </span><span id="wrapped_term"><span class="annot"><a href="GHC.Runtime.Heap.Inspect.html#wrapped_term"><span class="hs-identifier hs-var">wrapped_term</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Runtime.Heap.Inspect.html#Term"><span class="hs-identifier hs-type">Term</span></a></span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-109"></span><span>
</span><span id="line-110"></span><span class="annot"><a href="GHC.Runtime.Heap.Inspect.html#termType"><span class="hs-identifier hs-type">termType</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Runtime.Heap.Inspect.html#Term"><span class="hs-identifier hs-type">Term</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Runtime.Heap.Inspect.html#RttiType"><span class="hs-identifier hs-type">RttiType</span></a></span><span>
</span><span id="line-111"></span><span id="termType"><span class="annot"><span class="annottext">termType :: Term -&gt; Type
</span><a href="GHC.Runtime.Heap.Inspect.html#termType"><span class="hs-identifier hs-var hs-var">termType</span></a></span></span><span> </span><span id="local-6989586621683021747"><span class="annot"><span class="annottext">Term
</span><a href="#local-6989586621683021747"><span class="hs-identifier hs-var">t</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Term -&gt; Type
</span><a href="GHC.Runtime.Heap.Inspect.html#ty"><span class="hs-identifier hs-var">ty</span></a></span><span> </span><span class="annot"><span class="annottext">Term
</span><a href="#local-6989586621683021747"><span class="hs-identifier hs-var">t</span></a></span><span>
</span><span id="line-112"></span><span>
</span><span id="line-113"></span><span class="annot"><a href="GHC.Runtime.Heap.Inspect.html#isFullyEvaluatedTerm"><span class="hs-identifier hs-type">isFullyEvaluatedTerm</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Runtime.Heap.Inspect.html#Term"><span class="hs-identifier hs-type">Term</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Bool</span></span><span>
</span><span id="line-114"></span><span id="isFullyEvaluatedTerm"><span class="annot"><span class="annottext">isFullyEvaluatedTerm :: Term -&gt; Bool
</span><a href="GHC.Runtime.Heap.Inspect.html#isFullyEvaluatedTerm"><span class="hs-identifier hs-var hs-var">isFullyEvaluatedTerm</span></a></span></span><span> </span><span class="annot"><a href="GHC.Runtime.Heap.Inspect.html#Term"><span class="hs-identifier hs-type">Term</span></a></span><span> </span><span class="hs-special">{</span><span class="annot"><span class="annottext">subTerms :: Term -&gt; [Term]
</span><a href="GHC.Runtime.Heap.Inspect.html#subTerms"><span class="hs-identifier hs-var">subTerms</span></a></span><span class="hs-glyph">=</span><span id="local-6989586621683021748"><span class="annot"><span class="annottext">[Term]
</span><a href="#local-6989586621683021748"><span class="hs-identifier hs-var">tt</span></a></span></span><span class="hs-special">}</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(Term -&gt; Bool) -&gt; [Term] -&gt; Bool
forall (t :: * -&gt; *) a. Foldable t =&gt; (a -&gt; Bool) -&gt; t a -&gt; Bool
</span><span class="hs-identifier hs-var">all</span></span><span> </span><span class="annot"><span class="annottext">Term -&gt; Bool
</span><a href="GHC.Runtime.Heap.Inspect.html#isFullyEvaluatedTerm"><span class="hs-identifier hs-var">isFullyEvaluatedTerm</span></a></span><span> </span><span class="annot"><span class="annottext">[Term]
</span><a href="#local-6989586621683021748"><span class="hs-identifier hs-var">tt</span></a></span><span>
</span><span id="line-115"></span><span class="annot"><a href="GHC.Runtime.Heap.Inspect.html#isFullyEvaluatedTerm"><span class="hs-identifier hs-var">isFullyEvaluatedTerm</span></a></span><span> </span><span class="annot"><a href="GHC.Runtime.Heap.Inspect.html#Prim"><span class="hs-identifier hs-type">Prim</span></a></span><span> </span><span class="hs-special">{</span><span class="hs-special">}</span><span>            </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">True</span></span><span>
</span><span id="line-116"></span><span class="annot"><a href="GHC.Runtime.Heap.Inspect.html#isFullyEvaluatedTerm"><span class="hs-identifier hs-var">isFullyEvaluatedTerm</span></a></span><span> </span><span class="annot"><a href="GHC.Runtime.Heap.Inspect.html#NewtypeWrap"><span class="hs-identifier hs-type">NewtypeWrap</span></a></span><span class="hs-special">{</span><span class="annot"><span class="annottext">wrapped_term :: Term -&gt; Term
</span><a href="GHC.Runtime.Heap.Inspect.html#wrapped_term"><span class="hs-identifier hs-var">wrapped_term</span></a></span><span class="hs-glyph">=</span><span id="local-6989586621683021750"><span class="annot"><span class="annottext">Term
</span><a href="#local-6989586621683021750"><span class="hs-identifier hs-var">t</span></a></span></span><span class="hs-special">}</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Term -&gt; Bool
</span><a href="GHC.Runtime.Heap.Inspect.html#isFullyEvaluatedTerm"><span class="hs-identifier hs-var">isFullyEvaluatedTerm</span></a></span><span> </span><span class="annot"><span class="annottext">Term
</span><a href="#local-6989586621683021750"><span class="hs-identifier hs-var">t</span></a></span><span>
</span><span id="line-117"></span><span class="annot"><a href="GHC.Runtime.Heap.Inspect.html#isFullyEvaluatedTerm"><span class="hs-identifier hs-var">isFullyEvaluatedTerm</span></a></span><span> </span><span class="annot"><a href="GHC.Runtime.Heap.Inspect.html#RefWrap"><span class="hs-identifier hs-type">RefWrap</span></a></span><span class="hs-special">{</span><span class="annot"><span class="annottext">wrapped_term :: Term -&gt; Term
</span><a href="GHC.Runtime.Heap.Inspect.html#wrapped_term"><span class="hs-identifier hs-var">wrapped_term</span></a></span><span class="hs-glyph">=</span><span id="local-6989586621683021751"><span class="annot"><span class="annottext">Term
</span><a href="#local-6989586621683021751"><span class="hs-identifier hs-var">t</span></a></span></span><span class="hs-special">}</span><span>     </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Term -&gt; Bool
</span><a href="GHC.Runtime.Heap.Inspect.html#isFullyEvaluatedTerm"><span class="hs-identifier hs-var">isFullyEvaluatedTerm</span></a></span><span> </span><span class="annot"><span class="annottext">Term
</span><a href="#local-6989586621683021751"><span class="hs-identifier hs-var">t</span></a></span><span>
</span><span id="line-118"></span><span class="annot"><a href="GHC.Runtime.Heap.Inspect.html#isFullyEvaluatedTerm"><span class="hs-identifier hs-var">isFullyEvaluatedTerm</span></a></span><span> </span><span class="annot"><span class="annottext">Term
</span><span class="hs-identifier">_</span></span><span>                  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">False</span></span><span>
</span><span id="line-119"></span><span>
</span><span id="line-120"></span><span class="hs-keyword">instance</span><span> </span><span class="annot"><a href="GHC.Utils.Outputable.html#Outputable"><span class="hs-identifier hs-type">Outputable</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Runtime.Heap.Inspect.html#Term"><span class="hs-identifier hs-type">Term</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-121"></span><span> </span><span id="local-6989586621683021759"><span class="annot"><span class="annottext">ppr :: Term -&gt; SDoc
</span><a href="#local-6989586621683021759"><span class="hs-identifier hs-var hs-var hs-var">ppr</span></a></span></span><span> </span><span id="local-6989586621683021761"><span class="annot"><span class="annottext">Term
</span><a href="#local-6989586621683021761"><span class="hs-identifier hs-var">t</span></a></span></span><span> </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span id="local-6989586621683021762"><span class="annot"><span class="annottext">SDoc
</span><a href="#local-6989586621683021762"><span class="hs-identifier hs-var">doc</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">CustomTermPrinter Maybe -&gt; Term -&gt; Maybe SDoc
forall (m :: * -&gt; *).
Monad m =&gt;
CustomTermPrinter m -&gt; Term -&gt; m SDoc
</span><a href="GHC.Runtime.Heap.Inspect.html#cPprTerm"><span class="hs-identifier hs-var">cPprTerm</span></a></span><span> </span><span class="annot"><span class="annottext">CustomTermPrinter Maybe
forall (m :: * -&gt; *). Monad m =&gt; CustomTermPrinter m
</span><a href="GHC.Runtime.Heap.Inspect.html#cPprTermBase"><span class="hs-identifier hs-var">cPprTermBase</span></a></span><span> </span><span class="annot"><span class="annottext">Term
</span><a href="#local-6989586621683021761"><span class="hs-identifier hs-var">t</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">SDoc
</span><a href="#local-6989586621683021762"><span class="hs-identifier hs-var">doc</span></a></span><span>
</span><span id="line-122"></span><span>       </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">otherwise</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">String -&gt; SDoc
forall a. HasCallStack =&gt; String -&gt; a
</span><a href="GHC.Utils.Panic.Plain.html#panic"><span class="hs-identifier hs-var">panic</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;Outputable Term instance&quot;</span></span><span>
</span><span id="line-123"></span><span>
</span><span id="line-124"></span><span class="hs-comment">----------------------------------------</span><span>
</span><span id="line-125"></span><span class="hs-comment">-- Runtime Closure information functions</span><span>
</span><span id="line-126"></span><span class="hs-comment">----------------------------------------</span><span>
</span><span id="line-127"></span><span>
</span><span id="line-128"></span><span id="local-6989586621683020872"><span class="annot"><a href="GHC.Runtime.Heap.Inspect.html#isThunk"><span class="hs-identifier hs-type">isThunk</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="../../ghc-heap-9.12.2-4363/src/GHC.Exts.Heap.Closures.html#GenClosure"><span class="hs-identifier hs-type">GenClosure</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683020872"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Bool</span></span></span><span>
</span><span id="line-129"></span><span id="isThunk"><span class="annot"><span class="annottext">isThunk :: forall a. GenClosure a -&gt; Bool
</span><a href="GHC.Runtime.Heap.Inspect.html#isThunk"><span class="hs-identifier hs-var hs-var">isThunk</span></a></span></span><span> </span><span class="annot"><a href="../../ghc-heap-9.12.2-4363/src/GHC.Exts.Heap.Closures.html#ThunkClosure"><span class="hs-identifier hs-type">ThunkClosure</span></a></span><span class="hs-special">{</span><span class="hs-special">}</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">True</span></span><span>
</span><span id="line-130"></span><span class="annot"><a href="GHC.Runtime.Heap.Inspect.html#isThunk"><span class="hs-identifier hs-var">isThunk</span></a></span><span> </span><span class="annot"><a href="../../ghc-heap-9.12.2-4363/src/GHC.Exts.Heap.Closures.html#APClosure"><span class="hs-identifier hs-type">APClosure</span></a></span><span class="hs-special">{</span><span class="hs-special">}</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">True</span></span><span>
</span><span id="line-131"></span><span class="annot"><a href="GHC.Runtime.Heap.Inspect.html#isThunk"><span class="hs-identifier hs-var">isThunk</span></a></span><span> </span><span class="annot"><a href="../../ghc-heap-9.12.2-4363/src/GHC.Exts.Heap.Closures.html#APStackClosure"><span class="hs-identifier hs-type">APStackClosure</span></a></span><span class="hs-special">{</span><span class="hs-special">}</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">True</span></span><span>
</span><span id="line-132"></span><span class="annot"><a href="GHC.Runtime.Heap.Inspect.html#isThunk"><span class="hs-identifier hs-var">isThunk</span></a></span><span> </span><span class="annot"><span class="annottext">GenClosure a
</span><span class="hs-identifier">_</span></span><span>             </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">False</span></span><span>
</span><span id="line-133"></span><span>
</span><span id="line-134"></span><span class="hs-comment">-- Lookup the name in a constructor closure</span><span>
</span><span id="line-135"></span><span id="local-6989586621683020875"><span class="annot"><a href="GHC.Runtime.Heap.Inspect.html#constrClosToName"><span class="hs-identifier hs-type">constrClosToName</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Driver.Env.Types.html#HscEnv"><span class="hs-identifier hs-type">HscEnv</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="../../ghc-heap-9.12.2-4363/src/GHC.Exts.Heap.Closures.html#GenClosure"><span class="hs-identifier hs-type">GenClosure</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683020875"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Either</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">String</span></span><span> </span><span class="annot"><a href="GHC.Types.Name.html#Name"><span class="hs-identifier hs-type">Name</span></a></span><span class="hs-special">)</span></span><span>
</span><span id="line-136"></span><span id="constrClosToName"><span class="annot"><span class="annottext">constrClosToName :: forall a. HscEnv -&gt; GenClosure a -&gt; IO (Either String Name)
</span><a href="GHC.Runtime.Heap.Inspect.html#constrClosToName"><span class="hs-identifier hs-var hs-var">constrClosToName</span></a></span></span><span> </span><span id="local-6989586621683021774"><span class="annot"><span class="annottext">HscEnv
</span><a href="#local-6989586621683021774"><span class="hs-identifier hs-var">hsc_env</span></a></span></span><span> </span><span class="annot"><a href="../../ghc-heap-9.12.2-4363/src/GHC.Exts.Heap.Closures.html#ConstrClosure"><span class="hs-identifier hs-type">ConstrClosure</span></a></span><span class="hs-special">{</span><span class="annot"><span class="annottext">pkg :: forall b. GenClosure b -&gt; String
</span><a href="../../ghc-heap-9.12.2-4363/src/GHC.Exts.Heap.Closures.html#pkg"><span class="hs-identifier hs-var">pkg</span></a></span><span class="hs-glyph">=</span><span id="local-6989586621683021777"><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621683021777"><span class="hs-identifier hs-var">pkg</span></a></span></span><span class="hs-special">,</span><span class="annot"><span class="annottext">modl :: forall b. GenClosure b -&gt; String
</span><a href="../../ghc-heap-9.12.2-4363/src/GHC.Exts.Heap.Closures.html#modl"><span class="hs-identifier hs-var">modl</span></a></span><span class="hs-glyph">=</span><span id="local-6989586621683021779"><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621683021779"><span class="hs-identifier hs-var">mod</span></a></span></span><span class="hs-special">,</span><span class="annot"><span class="annottext">name :: forall b. GenClosure b -&gt; String
</span><a href="../../ghc-heap-9.12.2-4363/src/GHC.Exts.Heap.Closures.html#name"><span class="hs-identifier hs-var">name</span></a></span><span class="hs-glyph">=</span><span id="local-6989586621683021781"><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621683021781"><span class="hs-identifier hs-var">occ</span></a></span></span><span class="hs-special">}</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-137"></span><span>   </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621683021782"><span class="annot"><span class="annottext">occName :: OccName
</span><a href="#local-6989586621683021782"><span class="hs-identifier hs-var hs-var">occName</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">NameSpace -&gt; String -&gt; OccName
</span><a href="GHC.Types.Name.Occurrence.html#mkOccName"><span class="hs-identifier hs-var">mkOccName</span></a></span><span> </span><span class="annot"><span class="annottext">NameSpace
</span><a href="GHC.Types.Name.Occurrence.html#dataName"><span class="hs-identifier hs-var">OccName.dataName</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621683021781"><span class="hs-identifier hs-var">occ</span></a></span><span>
</span><span id="line-138"></span><span>       </span><span id="local-6989586621683021785"><span class="annot"><span class="annottext">modName :: GenModule Unit
</span><a href="#local-6989586621683021785"><span class="hs-identifier hs-var hs-var">modName</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Unit -&gt; ModuleName -&gt; GenModule Unit
forall u. u -&gt; ModuleName -&gt; GenModule u
</span><a href="GHC.Unit.Types.html#mkModule"><span class="hs-identifier hs-var">mkModule</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">String -&gt; Unit
</span><a href="GHC.Unit.Types.html#stringToUnit"><span class="hs-identifier hs-var">stringToUnit</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621683021777"><span class="hs-identifier hs-var">pkg</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">String -&gt; ModuleName
</span><a href="Language.Haskell.Syntax.Module.Name.html#mkModuleName"><span class="hs-identifier hs-var">mkModuleName</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621683021779"><span class="hs-identifier hs-var">mod</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-139"></span><span>   </span><span class="annot"><span class="annottext">Name -&gt; Either String Name
forall a b. b -&gt; Either a b
</span><span class="hs-identifier hs-var">Right</span></span><span> </span><span class="annot"><span class="annottext">(Name -&gt; Either String Name) -&gt; IO Name -&gt; IO (Either String Name)
forall a b. (a -&gt; b) -&gt; IO a -&gt; IO b
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">`fmap`</span></span><span> </span><span class="annot"><span class="annottext">NameCache -&gt; GenModule Unit -&gt; OccName -&gt; IO Name
</span><a href="GHC.Iface.Env.html#lookupNameCache"><span class="hs-identifier hs-var">lookupNameCache</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">HscEnv -&gt; NameCache
</span><a href="GHC.Driver.Env.Types.html#hsc_NC"><span class="hs-identifier hs-var">hsc_NC</span></a></span><span> </span><span class="annot"><span class="annottext">HscEnv
</span><a href="#local-6989586621683021774"><span class="hs-identifier hs-var">hsc_env</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">GenModule Unit
</span><a href="#local-6989586621683021785"><span class="hs-identifier hs-var">modName</span></a></span><span> </span><span class="annot"><span class="annottext">OccName
</span><a href="#local-6989586621683021782"><span class="hs-identifier hs-var">occName</span></a></span><span>
</span><span id="line-140"></span><span class="annot"><a href="GHC.Runtime.Heap.Inspect.html#constrClosToName"><span class="hs-identifier hs-var">constrClosToName</span></a></span><span> </span><span id="local-6989586621683021791"><span class="annot"><span class="annottext">HscEnv
</span><a href="#local-6989586621683021791"><span class="hs-identifier hs-var">_hsc_env</span></a></span></span><span> </span><span id="local-6989586621683021792"><span class="annot"><span class="annottext">GenClosure a
</span><a href="#local-6989586621683021792"><span class="hs-identifier hs-var">clos</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-141"></span><span>   </span><span class="annot"><span class="annottext">Either String Name -&gt; IO (Either String Name)
forall a. a -&gt; IO a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">String -&gt; Either String Name
forall a b. a -&gt; Either a b
</span><span class="hs-identifier hs-var">Left</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;conClosToName: Expected ConstrClosure, got &quot;</span></span><span> </span><span class="annot"><span class="annottext">String -&gt; String -&gt; String
forall a. [a] -&gt; [a] -&gt; [a]
</span><span class="hs-operator hs-var">++</span></span><span> </span><span class="annot"><span class="annottext">GenClosure () -&gt; String
forall a. Show a =&gt; a -&gt; String
</span><span class="hs-identifier hs-var">show</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(a -&gt; ()) -&gt; GenClosure a -&gt; GenClosure ()
forall a b. (a -&gt; b) -&gt; GenClosure a -&gt; GenClosure b
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-identifier hs-var">fmap</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">() -&gt; a -&gt; ()
forall a b. a -&gt; b -&gt; a
</span><span class="hs-identifier hs-var">const</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">GenClosure a
</span><a href="#local-6989586621683021792"><span class="hs-identifier hs-var">clos</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-142"></span><span>
</span><span id="line-143"></span><span class="hs-comment">-----------------------------------</span><span>
</span><span id="line-144"></span><span class="annot"><span class="hs-comment">-- * Traversals for Terms</span></span><span>
</span><span id="line-145"></span><span class="hs-comment">-----------------------------------</span><span>
</span><span id="line-146"></span><span class="hs-keyword">type</span><span> </span><span id="TermProcessor"><span class="annot"><a href="GHC.Runtime.Heap.Inspect.html#TermProcessor"><span class="hs-identifier hs-var">TermProcessor</span></a></span></span><span> </span><span id="local-6989586621683021795"><span class="annot"><a href="#local-6989586621683021795"><span class="hs-identifier hs-type">a</span></a></span></span><span> </span><span id="local-6989586621683021796"><span class="annot"><a href="#local-6989586621683021796"><span class="hs-identifier hs-type">b</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="GHC.Runtime.Heap.Inspect.html#RttiType"><span class="hs-identifier hs-type">RttiType</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Either</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">String</span></span><span> </span><span class="annot"><a href="GHC.Core.DataCon.html#DataCon"><span class="hs-identifier hs-type">DataCon</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="../../ghci-9.12.2-bd10/src/GHCi.RemoteTypes.html#ForeignHValue"><span class="hs-identifier hs-type">ForeignHValue</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="#local-6989586621683021795"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621683021796"><span class="hs-identifier hs-type">b</span></a></span><span>
</span><span id="line-147"></span><span>
</span><span id="line-148"></span><span class="hs-keyword">data</span><span> </span><span id="TermFold"><span class="annot"><a href="GHC.Runtime.Heap.Inspect.html#TermFold"><span class="hs-identifier hs-var">TermFold</span></a></span></span><span> </span><span id="local-6989586621683020896"><span class="annot"><a href="#local-6989586621683020896"><span class="hs-identifier hs-type">a</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="TermFold"><span class="annot"><a href="GHC.Runtime.Heap.Inspect.html#TermFold"><span class="hs-identifier hs-var">TermFold</span></a></span></span><span> </span><span class="hs-special">{</span><span> </span><span id="fTerm"><span class="annot"><span class="annottext">forall a. TermFold a -&gt; TermProcessor a a
</span><a href="GHC.Runtime.Heap.Inspect.html#fTerm"><span class="hs-identifier hs-var hs-var">fTerm</span></a></span></span><span>        </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Runtime.Heap.Inspect.html#TermProcessor"><span class="hs-identifier hs-type">TermProcessor</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683020896"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683020896"><span class="hs-identifier hs-type">a</span></a></span><span>
</span><span id="line-149"></span><span>                           </span><span class="hs-special">,</span><span> </span><span id="fPrim"><span class="annot"><span class="annottext">forall a. TermFold a -&gt; Type -&gt; [Word] -&gt; a
</span><a href="GHC.Runtime.Heap.Inspect.html#fPrim"><span class="hs-identifier hs-var hs-var">fPrim</span></a></span></span><span>        </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Runtime.Heap.Inspect.html#RttiType"><span class="hs-identifier hs-type">RttiType</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><span class="hs-identifier hs-type">Word</span></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621683020896"><span class="hs-identifier hs-type">a</span></a></span><span>
</span><span id="line-150"></span><span>                           </span><span class="hs-special">,</span><span> </span><span id="fSuspension"><span class="annot"><span class="annottext">forall a.
TermFold a
-&gt; ClosureType -&gt; Type -&gt; ForeignHValue -&gt; Maybe Name -&gt; a
</span><a href="GHC.Runtime.Heap.Inspect.html#fSuspension"><span class="hs-identifier hs-var hs-var">fSuspension</span></a></span></span><span>  </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">ClosureType</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Runtime.Heap.Inspect.html#RttiType"><span class="hs-identifier hs-type">RttiType</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="../../ghci-9.12.2-bd10/src/GHCi.RemoteTypes.html#ForeignHValue"><span class="hs-identifier hs-type">ForeignHValue</span></a></span><span>
</span><span id="line-151"></span><span>                                            </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Maybe</span></span><span> </span><span class="annot"><a href="GHC.Types.Name.html#Name"><span class="hs-identifier hs-type">Name</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621683020896"><span class="hs-identifier hs-type">a</span></a></span><span>
</span><span id="line-152"></span><span>                           </span><span class="hs-special">,</span><span> </span><span id="fNewtypeWrap"><span class="annot"><span class="annottext">forall a. TermFold a -&gt; Type -&gt; Either String DataCon -&gt; a -&gt; a
</span><a href="GHC.Runtime.Heap.Inspect.html#fNewtypeWrap"><span class="hs-identifier hs-var hs-var">fNewtypeWrap</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Runtime.Heap.Inspect.html#RttiType"><span class="hs-identifier hs-type">RttiType</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Either</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">String</span></span><span> </span><span class="annot"><a href="GHC.Core.DataCon.html#DataCon"><span class="hs-identifier hs-type">DataCon</span></a></span><span>
</span><span id="line-153"></span><span>                                            </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621683020896"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621683020896"><span class="hs-identifier hs-type">a</span></a></span><span>
</span><span id="line-154"></span><span>                           </span><span class="hs-special">,</span><span> </span><span id="fRefWrap"><span class="annot"><span class="annottext">forall a. TermFold a -&gt; Type -&gt; a -&gt; a
</span><a href="GHC.Runtime.Heap.Inspect.html#fRefWrap"><span class="hs-identifier hs-var hs-var">fRefWrap</span></a></span></span><span>     </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Runtime.Heap.Inspect.html#RttiType"><span class="hs-identifier hs-type">RttiType</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621683020896"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621683020896"><span class="hs-identifier hs-type">a</span></a></span><span>
</span><span id="line-155"></span><span>                           </span><span class="hs-special">}</span><span>
</span><span id="line-156"></span><span>
</span><span id="line-157"></span><span>
</span><span id="line-158"></span><span class="hs-keyword">data</span><span> </span><span id="TermFoldM"><span class="annot"><a href="GHC.Runtime.Heap.Inspect.html#TermFoldM"><span class="hs-identifier hs-var">TermFoldM</span></a></span></span><span> </span><span id="local-6989586621683020904"><span class="annot"><a href="#local-6989586621683020904"><span class="hs-identifier hs-type">m</span></a></span></span><span> </span><span id="local-6989586621683020905"><span class="annot"><a href="#local-6989586621683020905"><span class="hs-identifier hs-type">a</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-159"></span><span>                   </span><span id="TermFoldM"><span class="annot"><a href="GHC.Runtime.Heap.Inspect.html#TermFoldM"><span class="hs-identifier hs-var">TermFoldM</span></a></span></span><span> </span><span class="hs-special">{</span><span id="fTermM"><span class="annot"><span class="annottext">forall (m :: * -&gt; *) a. TermFoldM m a -&gt; TermProcessor a (m a)
</span><a href="GHC.Runtime.Heap.Inspect.html#fTermM"><span class="hs-identifier hs-var hs-var">fTermM</span></a></span></span><span>        </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Runtime.Heap.Inspect.html#TermProcessor"><span class="hs-identifier hs-type">TermProcessor</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683020905"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621683020904"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683020905"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-160"></span><span>                            </span><span class="hs-special">,</span><span> </span><span id="fPrimM"><span class="annot"><span class="annottext">forall (m :: * -&gt; *) a. TermFoldM m a -&gt; Type -&gt; [Word] -&gt; m a
</span><a href="GHC.Runtime.Heap.Inspect.html#fPrimM"><span class="hs-identifier hs-var hs-var">fPrimM</span></a></span></span><span>        </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Runtime.Heap.Inspect.html#RttiType"><span class="hs-identifier hs-type">RttiType</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><span class="hs-identifier hs-type">Word</span></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621683020904"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683020905"><span class="hs-identifier hs-type">a</span></a></span><span>
</span><span id="line-161"></span><span>                            </span><span class="hs-special">,</span><span> </span><span id="fSuspensionM"><span class="annot"><span class="annottext">forall (m :: * -&gt; *) a.
TermFoldM m a
-&gt; ClosureType -&gt; Type -&gt; ForeignHValue -&gt; Maybe Name -&gt; m a
</span><a href="GHC.Runtime.Heap.Inspect.html#fSuspensionM"><span class="hs-identifier hs-var hs-var">fSuspensionM</span></a></span></span><span>  </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">ClosureType</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Runtime.Heap.Inspect.html#RttiType"><span class="hs-identifier hs-type">RttiType</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="../../ghci-9.12.2-bd10/src/GHCi.RemoteTypes.html#ForeignHValue"><span class="hs-identifier hs-type">ForeignHValue</span></a></span><span>
</span><span id="line-162"></span><span>                                             </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Maybe</span></span><span> </span><span class="annot"><a href="GHC.Types.Name.html#Name"><span class="hs-identifier hs-type">Name</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621683020904"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683020905"><span class="hs-identifier hs-type">a</span></a></span><span>
</span><span id="line-163"></span><span>                            </span><span class="hs-special">,</span><span> </span><span id="fNewtypeWrapM"><span class="annot"><span class="annottext">forall (m :: * -&gt; *) a.
TermFoldM m a -&gt; Type -&gt; Either String DataCon -&gt; a -&gt; m a
</span><a href="GHC.Runtime.Heap.Inspect.html#fNewtypeWrapM"><span class="hs-identifier hs-var hs-var">fNewtypeWrapM</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Runtime.Heap.Inspect.html#RttiType"><span class="hs-identifier hs-type">RttiType</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Either</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">String</span></span><span> </span><span class="annot"><a href="GHC.Core.DataCon.html#DataCon"><span class="hs-identifier hs-type">DataCon</span></a></span><span>
</span><span id="line-164"></span><span>                                            </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621683020905"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621683020904"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683020905"><span class="hs-identifier hs-type">a</span></a></span><span>
</span><span id="line-165"></span><span>                            </span><span class="hs-special">,</span><span> </span><span id="fRefWrapM"><span class="annot"><span class="annottext">forall (m :: * -&gt; *) a. TermFoldM m a -&gt; Type -&gt; a -&gt; m a
</span><a href="GHC.Runtime.Heap.Inspect.html#fRefWrapM"><span class="hs-identifier hs-var hs-var">fRefWrapM</span></a></span></span><span>     </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Runtime.Heap.Inspect.html#RttiType"><span class="hs-identifier hs-type">RttiType</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621683020905"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621683020904"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683020905"><span class="hs-identifier hs-type">a</span></a></span><span>
</span><span id="line-166"></span><span>                           </span><span class="hs-special">}</span><span>
</span><span id="line-167"></span><span>
</span><span id="line-168"></span><span id="local-6989586621683020917"><span class="annot"><a href="GHC.Runtime.Heap.Inspect.html#foldTerm"><span class="hs-identifier hs-type">foldTerm</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Runtime.Heap.Inspect.html#TermFold"><span class="hs-identifier hs-type">TermFold</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683020917"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Runtime.Heap.Inspect.html#Term"><span class="hs-identifier hs-type">Term</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621683020917"><span class="hs-identifier hs-type">a</span></a></span></span><span>
</span><span id="line-169"></span><span id="foldTerm"><span class="annot"><span class="annottext">foldTerm :: forall a. TermFold a -&gt; Term -&gt; a
</span><a href="GHC.Runtime.Heap.Inspect.html#foldTerm"><span class="hs-identifier hs-var hs-var">foldTerm</span></a></span></span><span> </span><span id="local-6989586621683021809"><span class="annot"><span class="annottext">TermFold a
</span><a href="#local-6989586621683021809"><span class="hs-identifier hs-var">tf</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Runtime.Heap.Inspect.html#Term"><span class="hs-identifier hs-type">Term</span></a></span><span> </span><span id="local-6989586621683021810"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621683021810"><span class="hs-identifier hs-var">ty</span></a></span></span><span> </span><span id="local-6989586621683021811"><span class="annot"><span class="annottext">Either String DataCon
</span><a href="#local-6989586621683021811"><span class="hs-identifier hs-var">dc</span></a></span></span><span> </span><span id="local-6989586621683021812"><span class="annot"><span class="annottext">ForeignHValue
</span><a href="#local-6989586621683021812"><span class="hs-identifier hs-var">v</span></a></span></span><span> </span><span id="local-6989586621683021813"><span class="annot"><span class="annottext">[Term]
</span><a href="#local-6989586621683021813"><span class="hs-identifier hs-var">tt</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">TermFold a -&gt; TermProcessor a a
forall a. TermFold a -&gt; TermProcessor a a
</span><a href="GHC.Runtime.Heap.Inspect.html#fTerm"><span class="hs-identifier hs-var">fTerm</span></a></span><span> </span><span class="annot"><span class="annottext">TermFold a
</span><a href="#local-6989586621683021809"><span class="hs-identifier hs-var">tf</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621683021810"><span class="hs-identifier hs-var">ty</span></a></span><span> </span><span class="annot"><span class="annottext">Either String DataCon
</span><a href="#local-6989586621683021811"><span class="hs-identifier hs-var">dc</span></a></span><span> </span><span class="annot"><span class="annottext">ForeignHValue
</span><a href="#local-6989586621683021812"><span class="hs-identifier hs-var">v</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(Term -&gt; a) -&gt; [Term] -&gt; [a]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><span class="hs-identifier hs-var">map</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TermFold a -&gt; Term -&gt; a
forall a. TermFold a -&gt; Term -&gt; a
</span><a href="GHC.Runtime.Heap.Inspect.html#foldTerm"><span class="hs-identifier hs-var">foldTerm</span></a></span><span> </span><span class="annot"><span class="annottext">TermFold a
</span><a href="#local-6989586621683021809"><span class="hs-identifier hs-var">tf</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[Term]
</span><a href="#local-6989586621683021813"><span class="hs-identifier hs-var">tt</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-170"></span><span class="annot"><a href="GHC.Runtime.Heap.Inspect.html#foldTerm"><span class="hs-identifier hs-var">foldTerm</span></a></span><span> </span><span id="local-6989586621683021814"><span class="annot"><span class="annottext">TermFold a
</span><a href="#local-6989586621683021814"><span class="hs-identifier hs-var">tf</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Runtime.Heap.Inspect.html#Prim"><span class="hs-identifier hs-type">Prim</span></a></span><span> </span><span id="local-6989586621683021815"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621683021815"><span class="hs-identifier hs-var">ty</span></a></span></span><span>    </span><span id="local-6989586621683021816"><span class="annot"><span class="annottext">[Word]
</span><a href="#local-6989586621683021816"><span class="hs-identifier hs-var">v</span></a></span></span><span>   </span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">TermFold a -&gt; Type -&gt; [Word] -&gt; a
forall a. TermFold a -&gt; Type -&gt; [Word] -&gt; a
</span><a href="GHC.Runtime.Heap.Inspect.html#fPrim"><span class="hs-identifier hs-var">fPrim</span></a></span><span> </span><span class="annot"><span class="annottext">TermFold a
</span><a href="#local-6989586621683021814"><span class="hs-identifier hs-var">tf</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621683021815"><span class="hs-identifier hs-var">ty</span></a></span><span> </span><span class="annot"><span class="annottext">[Word]
</span><a href="#local-6989586621683021816"><span class="hs-identifier hs-var">v</span></a></span><span>
</span><span id="line-171"></span><span class="annot"><a href="GHC.Runtime.Heap.Inspect.html#foldTerm"><span class="hs-identifier hs-var">foldTerm</span></a></span><span> </span><span id="local-6989586621683021817"><span class="annot"><span class="annottext">TermFold a
</span><a href="#local-6989586621683021817"><span class="hs-identifier hs-var">tf</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Runtime.Heap.Inspect.html#Suspension"><span class="hs-identifier hs-type">Suspension</span></a></span><span> </span><span id="local-6989586621683021818"><span class="annot"><span class="annottext">ClosureType
</span><a href="#local-6989586621683021818"><span class="hs-identifier hs-var">ct</span></a></span></span><span> </span><span id="local-6989586621683021819"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621683021819"><span class="hs-identifier hs-var">ty</span></a></span></span><span> </span><span id="local-6989586621683021820"><span class="annot"><span class="annottext">ForeignHValue
</span><a href="#local-6989586621683021820"><span class="hs-identifier hs-var">v</span></a></span></span><span> </span><span id="local-6989586621683021821"><span class="annot"><span class="annottext">Maybe Name
</span><a href="#local-6989586621683021821"><span class="hs-identifier hs-var">b</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">TermFold a
-&gt; ClosureType -&gt; Type -&gt; ForeignHValue -&gt; Maybe Name -&gt; a
forall a.
TermFold a
-&gt; ClosureType -&gt; Type -&gt; ForeignHValue -&gt; Maybe Name -&gt; a
</span><a href="GHC.Runtime.Heap.Inspect.html#fSuspension"><span class="hs-identifier hs-var">fSuspension</span></a></span><span> </span><span class="annot"><span class="annottext">TermFold a
</span><a href="#local-6989586621683021817"><span class="hs-identifier hs-var">tf</span></a></span><span> </span><span class="annot"><span class="annottext">ClosureType
</span><a href="#local-6989586621683021818"><span class="hs-identifier hs-var">ct</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621683021819"><span class="hs-identifier hs-var">ty</span></a></span><span> </span><span class="annot"><span class="annottext">ForeignHValue
</span><a href="#local-6989586621683021820"><span class="hs-identifier hs-var">v</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe Name
</span><a href="#local-6989586621683021821"><span class="hs-identifier hs-var">b</span></a></span><span>
</span><span id="line-172"></span><span class="annot"><a href="GHC.Runtime.Heap.Inspect.html#foldTerm"><span class="hs-identifier hs-var">foldTerm</span></a></span><span> </span><span id="local-6989586621683021822"><span class="annot"><span class="annottext">TermFold a
</span><a href="#local-6989586621683021822"><span class="hs-identifier hs-var">tf</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Runtime.Heap.Inspect.html#NewtypeWrap"><span class="hs-identifier hs-type">NewtypeWrap</span></a></span><span> </span><span id="local-6989586621683021823"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621683021823"><span class="hs-identifier hs-var">ty</span></a></span></span><span> </span><span id="local-6989586621683021824"><span class="annot"><span class="annottext">Either String DataCon
</span><a href="#local-6989586621683021824"><span class="hs-identifier hs-var">dc</span></a></span></span><span> </span><span id="local-6989586621683021825"><span class="annot"><span class="annottext">Term
</span><a href="#local-6989586621683021825"><span class="hs-identifier hs-var">t</span></a></span></span><span class="hs-special">)</span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">TermFold a -&gt; Type -&gt; Either String DataCon -&gt; a -&gt; a
forall a. TermFold a -&gt; Type -&gt; Either String DataCon -&gt; a -&gt; a
</span><a href="GHC.Runtime.Heap.Inspect.html#fNewtypeWrap"><span class="hs-identifier hs-var">fNewtypeWrap</span></a></span><span> </span><span class="annot"><span class="annottext">TermFold a
</span><a href="#local-6989586621683021822"><span class="hs-identifier hs-var">tf</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621683021823"><span class="hs-identifier hs-var">ty</span></a></span><span> </span><span class="annot"><span class="annottext">Either String DataCon
</span><a href="#local-6989586621683021824"><span class="hs-identifier hs-var">dc</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TermFold a -&gt; Term -&gt; a
forall a. TermFold a -&gt; Term -&gt; a
</span><a href="GHC.Runtime.Heap.Inspect.html#foldTerm"><span class="hs-identifier hs-var">foldTerm</span></a></span><span> </span><span class="annot"><span class="annottext">TermFold a
</span><a href="#local-6989586621683021822"><span class="hs-identifier hs-var">tf</span></a></span><span> </span><span class="annot"><span class="annottext">Term
</span><a href="#local-6989586621683021825"><span class="hs-identifier hs-var">t</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-173"></span><span class="annot"><a href="GHC.Runtime.Heap.Inspect.html#foldTerm"><span class="hs-identifier hs-var">foldTerm</span></a></span><span> </span><span id="local-6989586621683021826"><span class="annot"><span class="annottext">TermFold a
</span><a href="#local-6989586621683021826"><span class="hs-identifier hs-var">tf</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Runtime.Heap.Inspect.html#RefWrap"><span class="hs-identifier hs-type">RefWrap</span></a></span><span> </span><span id="local-6989586621683021827"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621683021827"><span class="hs-identifier hs-var">ty</span></a></span></span><span> </span><span id="local-6989586621683021828"><span class="annot"><span class="annottext">Term
</span><a href="#local-6989586621683021828"><span class="hs-identifier hs-var">t</span></a></span></span><span class="hs-special">)</span><span>         </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">TermFold a -&gt; Type -&gt; a -&gt; a
forall a. TermFold a -&gt; Type -&gt; a -&gt; a
</span><a href="GHC.Runtime.Heap.Inspect.html#fRefWrap"><span class="hs-identifier hs-var">fRefWrap</span></a></span><span> </span><span class="annot"><span class="annottext">TermFold a
</span><a href="#local-6989586621683021826"><span class="hs-identifier hs-var">tf</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621683021827"><span class="hs-identifier hs-var">ty</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TermFold a -&gt; Term -&gt; a
forall a. TermFold a -&gt; Term -&gt; a
</span><a href="GHC.Runtime.Heap.Inspect.html#foldTerm"><span class="hs-identifier hs-var">foldTerm</span></a></span><span> </span><span class="annot"><span class="annottext">TermFold a
</span><a href="#local-6989586621683021826"><span class="hs-identifier hs-var">tf</span></a></span><span> </span><span class="annot"><span class="annottext">Term
</span><a href="#local-6989586621683021828"><span class="hs-identifier hs-var">t</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-174"></span><span>
</span><span id="line-175"></span><span>
</span><span id="line-176"></span><span id="local-6989586621683020921"><span id="local-6989586621683020922"><span class="annot"><a href="GHC.Runtime.Heap.Inspect.html#foldTermM"><span class="hs-identifier hs-type">foldTermM</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Monad</span></span><span> </span><span class="annot"><a href="#local-6989586621683020921"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="GHC.Runtime.Heap.Inspect.html#TermFoldM"><span class="hs-identifier hs-type">TermFoldM</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683020921"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683020922"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Runtime.Heap.Inspect.html#Term"><span class="hs-identifier hs-type">Term</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621683020921"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683020922"><span class="hs-identifier hs-type">a</span></a></span></span></span><span>
</span><span id="line-177"></span><span id="foldTermM"><span class="annot"><span class="annottext">foldTermM :: forall (m :: * -&gt; *) a. Monad m =&gt; TermFoldM m a -&gt; Term -&gt; m a
</span><a href="GHC.Runtime.Heap.Inspect.html#foldTermM"><span class="hs-identifier hs-var hs-var">foldTermM</span></a></span></span><span> </span><span id="local-6989586621683021839"><span class="annot"><span class="annottext">TermFoldM m a
</span><a href="#local-6989586621683021839"><span class="hs-identifier hs-var">tf</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Runtime.Heap.Inspect.html#Term"><span class="hs-identifier hs-type">Term</span></a></span><span> </span><span id="local-6989586621683021840"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621683021840"><span class="hs-identifier hs-var">ty</span></a></span></span><span> </span><span id="local-6989586621683021841"><span class="annot"><span class="annottext">Either String DataCon
</span><a href="#local-6989586621683021841"><span class="hs-identifier hs-var">dc</span></a></span></span><span> </span><span id="local-6989586621683021842"><span class="annot"><span class="annottext">ForeignHValue
</span><a href="#local-6989586621683021842"><span class="hs-identifier hs-var">v</span></a></span></span><span> </span><span id="local-6989586621683021843"><span class="annot"><span class="annottext">[Term]
</span><a href="#local-6989586621683021843"><span class="hs-identifier hs-var">tt</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(Term -&gt; m a) -&gt; [Term] -&gt; m [a]
forall (t :: * -&gt; *) (m :: * -&gt; *) a b.
(Traversable t, Monad m) =&gt;
(a -&gt; m b) -&gt; t a -&gt; m (t b)
forall (m :: * -&gt; *) a b. Monad m =&gt; (a -&gt; m b) -&gt; [a] -&gt; m [b]
</span><span class="hs-identifier hs-var">mapM</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TermFoldM m a -&gt; Term -&gt; m a
forall (m :: * -&gt; *) a. Monad m =&gt; TermFoldM m a -&gt; Term -&gt; m a
</span><a href="GHC.Runtime.Heap.Inspect.html#foldTermM"><span class="hs-identifier hs-var">foldTermM</span></a></span><span> </span><span class="annot"><span class="annottext">TermFoldM m a
</span><a href="#local-6989586621683021839"><span class="hs-identifier hs-var">tf</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[Term]
</span><a href="#local-6989586621683021843"><span class="hs-identifier hs-var">tt</span></a></span><span> </span><span class="annot"><span class="annottext">m [a] -&gt; ([a] -&gt; m a) -&gt; m a
forall a b. m a -&gt; (a -&gt; m b) -&gt; m b
forall (m :: * -&gt; *) a b. Monad m =&gt; m a -&gt; (a -&gt; m b) -&gt; m b
</span><span class="hs-operator hs-var">&gt;&gt;=</span></span><span> </span><span class="annot"><span class="annottext">TermFoldM m a -&gt; TermProcessor a (m a)
forall (m :: * -&gt; *) a. TermFoldM m a -&gt; TermProcessor a (m a)
</span><a href="GHC.Runtime.Heap.Inspect.html#fTermM"><span class="hs-identifier hs-var">fTermM</span></a></span><span> </span><span class="annot"><span class="annottext">TermFoldM m a
</span><a href="#local-6989586621683021839"><span class="hs-identifier hs-var">tf</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621683021840"><span class="hs-identifier hs-var">ty</span></a></span><span> </span><span class="annot"><span class="annottext">Either String DataCon
</span><a href="#local-6989586621683021841"><span class="hs-identifier hs-var">dc</span></a></span><span> </span><span class="annot"><span class="annottext">ForeignHValue
</span><a href="#local-6989586621683021842"><span class="hs-identifier hs-var">v</span></a></span><span>
</span><span id="line-178"></span><span class="annot"><a href="GHC.Runtime.Heap.Inspect.html#foldTermM"><span class="hs-identifier hs-var">foldTermM</span></a></span><span> </span><span id="local-6989586621683021845"><span class="annot"><span class="annottext">TermFoldM m a
</span><a href="#local-6989586621683021845"><span class="hs-identifier hs-var">tf</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Runtime.Heap.Inspect.html#Prim"><span class="hs-identifier hs-type">Prim</span></a></span><span> </span><span id="local-6989586621683021846"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621683021846"><span class="hs-identifier hs-var">ty</span></a></span></span><span>    </span><span id="local-6989586621683021847"><span class="annot"><span class="annottext">[Word]
</span><a href="#local-6989586621683021847"><span class="hs-identifier hs-var">v</span></a></span></span><span>   </span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">TermFoldM m a -&gt; Type -&gt; [Word] -&gt; m a
forall (m :: * -&gt; *) a. TermFoldM m a -&gt; Type -&gt; [Word] -&gt; m a
</span><a href="GHC.Runtime.Heap.Inspect.html#fPrimM"><span class="hs-identifier hs-var">fPrimM</span></a></span><span> </span><span class="annot"><span class="annottext">TermFoldM m a
</span><a href="#local-6989586621683021845"><span class="hs-identifier hs-var">tf</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621683021846"><span class="hs-identifier hs-var">ty</span></a></span><span> </span><span class="annot"><span class="annottext">[Word]
</span><a href="#local-6989586621683021847"><span class="hs-identifier hs-var">v</span></a></span><span>
</span><span id="line-179"></span><span class="annot"><a href="GHC.Runtime.Heap.Inspect.html#foldTermM"><span class="hs-identifier hs-var">foldTermM</span></a></span><span> </span><span id="local-6989586621683021848"><span class="annot"><span class="annottext">TermFoldM m a
</span><a href="#local-6989586621683021848"><span class="hs-identifier hs-var">tf</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Runtime.Heap.Inspect.html#Suspension"><span class="hs-identifier hs-type">Suspension</span></a></span><span> </span><span id="local-6989586621683021849"><span class="annot"><span class="annottext">ClosureType
</span><a href="#local-6989586621683021849"><span class="hs-identifier hs-var">ct</span></a></span></span><span> </span><span id="local-6989586621683021850"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621683021850"><span class="hs-identifier hs-var">ty</span></a></span></span><span> </span><span id="local-6989586621683021851"><span class="annot"><span class="annottext">ForeignHValue
</span><a href="#local-6989586621683021851"><span class="hs-identifier hs-var">v</span></a></span></span><span> </span><span id="local-6989586621683021852"><span class="annot"><span class="annottext">Maybe Name
</span><a href="#local-6989586621683021852"><span class="hs-identifier hs-var">b</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">TermFoldM m a
-&gt; ClosureType -&gt; Type -&gt; ForeignHValue -&gt; Maybe Name -&gt; m a
forall (m :: * -&gt; *) a.
TermFoldM m a
-&gt; ClosureType -&gt; Type -&gt; ForeignHValue -&gt; Maybe Name -&gt; m a
</span><a href="GHC.Runtime.Heap.Inspect.html#fSuspensionM"><span class="hs-identifier hs-var">fSuspensionM</span></a></span><span> </span><span class="annot"><span class="annottext">TermFoldM m a
</span><a href="#local-6989586621683021848"><span class="hs-identifier hs-var">tf</span></a></span><span> </span><span class="annot"><span class="annottext">ClosureType
</span><a href="#local-6989586621683021849"><span class="hs-identifier hs-var">ct</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621683021850"><span class="hs-identifier hs-var">ty</span></a></span><span> </span><span class="annot"><span class="annottext">ForeignHValue
</span><a href="#local-6989586621683021851"><span class="hs-identifier hs-var">v</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe Name
</span><a href="#local-6989586621683021852"><span class="hs-identifier hs-var">b</span></a></span><span>
</span><span id="line-180"></span><span class="annot"><a href="GHC.Runtime.Heap.Inspect.html#foldTermM"><span class="hs-identifier hs-var">foldTermM</span></a></span><span> </span><span id="local-6989586621683021853"><span class="annot"><span class="annottext">TermFoldM m a
</span><a href="#local-6989586621683021853"><span class="hs-identifier hs-var">tf</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Runtime.Heap.Inspect.html#NewtypeWrap"><span class="hs-identifier hs-type">NewtypeWrap</span></a></span><span> </span><span id="local-6989586621683021854"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621683021854"><span class="hs-identifier hs-var">ty</span></a></span></span><span> </span><span id="local-6989586621683021855"><span class="annot"><span class="annottext">Either String DataCon
</span><a href="#local-6989586621683021855"><span class="hs-identifier hs-var">dc</span></a></span></span><span> </span><span id="local-6989586621683021856"><span class="annot"><span class="annottext">Term
</span><a href="#local-6989586621683021856"><span class="hs-identifier hs-var">t</span></a></span></span><span class="hs-special">)</span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">TermFoldM m a -&gt; Term -&gt; m a
forall (m :: * -&gt; *) a. Monad m =&gt; TermFoldM m a -&gt; Term -&gt; m a
</span><a href="GHC.Runtime.Heap.Inspect.html#foldTermM"><span class="hs-identifier hs-var">foldTermM</span></a></span><span> </span><span class="annot"><span class="annottext">TermFoldM m a
</span><a href="#local-6989586621683021853"><span class="hs-identifier hs-var">tf</span></a></span><span> </span><span class="annot"><span class="annottext">Term
</span><a href="#local-6989586621683021856"><span class="hs-identifier hs-var">t</span></a></span><span> </span><span class="annot"><span class="annottext">m a -&gt; (a -&gt; m a) -&gt; m a
forall a b. m a -&gt; (a -&gt; m b) -&gt; m b
forall (m :: * -&gt; *) a b. Monad m =&gt; m a -&gt; (a -&gt; m b) -&gt; m b
</span><span class="hs-operator hs-var">&gt;&gt;=</span></span><span>  </span><span class="annot"><span class="annottext">TermFoldM m a -&gt; Type -&gt; Either String DataCon -&gt; a -&gt; m a
forall (m :: * -&gt; *) a.
TermFoldM m a -&gt; Type -&gt; Either String DataCon -&gt; a -&gt; m a
</span><a href="GHC.Runtime.Heap.Inspect.html#fNewtypeWrapM"><span class="hs-identifier hs-var">fNewtypeWrapM</span></a></span><span> </span><span class="annot"><span class="annottext">TermFoldM m a
</span><a href="#local-6989586621683021853"><span class="hs-identifier hs-var">tf</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621683021854"><span class="hs-identifier hs-var">ty</span></a></span><span> </span><span class="annot"><span class="annottext">Either String DataCon
</span><a href="#local-6989586621683021855"><span class="hs-identifier hs-var">dc</span></a></span><span>
</span><span id="line-181"></span><span class="annot"><a href="GHC.Runtime.Heap.Inspect.html#foldTermM"><span class="hs-identifier hs-var">foldTermM</span></a></span><span> </span><span id="local-6989586621683021857"><span class="annot"><span class="annottext">TermFoldM m a
</span><a href="#local-6989586621683021857"><span class="hs-identifier hs-var">tf</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Runtime.Heap.Inspect.html#RefWrap"><span class="hs-identifier hs-type">RefWrap</span></a></span><span> </span><span id="local-6989586621683021858"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621683021858"><span class="hs-identifier hs-var">ty</span></a></span></span><span> </span><span id="local-6989586621683021859"><span class="annot"><span class="annottext">Term
</span><a href="#local-6989586621683021859"><span class="hs-identifier hs-var">t</span></a></span></span><span class="hs-special">)</span><span>         </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">TermFoldM m a -&gt; Term -&gt; m a
forall (m :: * -&gt; *) a. Monad m =&gt; TermFoldM m a -&gt; Term -&gt; m a
</span><a href="GHC.Runtime.Heap.Inspect.html#foldTermM"><span class="hs-identifier hs-var">foldTermM</span></a></span><span> </span><span class="annot"><span class="annottext">TermFoldM m a
</span><a href="#local-6989586621683021857"><span class="hs-identifier hs-var">tf</span></a></span><span> </span><span class="annot"><span class="annottext">Term
</span><a href="#local-6989586621683021859"><span class="hs-identifier hs-var">t</span></a></span><span> </span><span class="annot"><span class="annottext">m a -&gt; (a -&gt; m a) -&gt; m a
forall a b. m a -&gt; (a -&gt; m b) -&gt; m b
forall (m :: * -&gt; *) a b. Monad m =&gt; m a -&gt; (a -&gt; m b) -&gt; m b
</span><span class="hs-operator hs-var">&gt;&gt;=</span></span><span> </span><span class="annot"><span class="annottext">TermFoldM m a -&gt; Type -&gt; a -&gt; m a
forall (m :: * -&gt; *) a. TermFoldM m a -&gt; Type -&gt; a -&gt; m a
</span><a href="GHC.Runtime.Heap.Inspect.html#fRefWrapM"><span class="hs-identifier hs-var">fRefWrapM</span></a></span><span> </span><span class="annot"><span class="annottext">TermFoldM m a
</span><a href="#local-6989586621683021857"><span class="hs-identifier hs-var">tf</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621683021858"><span class="hs-identifier hs-var">ty</span></a></span><span>
</span><span id="line-182"></span><span>
</span><span id="line-183"></span><span class="annot"><a href="GHC.Runtime.Heap.Inspect.html#idTermFold"><span class="hs-identifier hs-type">idTermFold</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Runtime.Heap.Inspect.html#TermFold"><span class="hs-identifier hs-type">TermFold</span></a></span><span> </span><span class="annot"><a href="GHC.Runtime.Heap.Inspect.html#Term"><span class="hs-identifier hs-type">Term</span></a></span><span>
</span><span id="line-184"></span><span id="idTermFold"><span class="annot"><span class="annottext">idTermFold :: TermFold Term
</span><a href="GHC.Runtime.Heap.Inspect.html#idTermFold"><span class="hs-identifier hs-var hs-var">idTermFold</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="GHC.Runtime.Heap.Inspect.html#TermFold"><span class="hs-identifier hs-type">TermFold</span></a></span><span> </span><span class="hs-special">{</span><span>
</span><span id="line-185"></span><span>              </span><span class="annot"><span class="annottext">fTerm :: TermProcessor Term Term
</span><a href="GHC.Runtime.Heap.Inspect.html#fTerm"><span class="hs-identifier hs-var">fTerm</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">TermProcessor Term Term
</span><a href="GHC.Runtime.Heap.Inspect.html#Term"><span class="hs-identifier hs-var">Term</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-186"></span><span>              </span><span class="annot"><span class="annottext">fPrim :: Type -&gt; [Word] -&gt; Term
</span><a href="GHC.Runtime.Heap.Inspect.html#fPrim"><span class="hs-identifier hs-var">fPrim</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Type -&gt; [Word] -&gt; Term
</span><a href="GHC.Runtime.Heap.Inspect.html#Prim"><span class="hs-identifier hs-var">Prim</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-187"></span><span>              </span><span class="annot"><span class="annottext">fSuspension :: ClosureType -&gt; Type -&gt; ForeignHValue -&gt; Maybe Name -&gt; Term
</span><a href="GHC.Runtime.Heap.Inspect.html#fSuspension"><span class="hs-identifier hs-var">fSuspension</span></a></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ClosureType -&gt; Type -&gt; ForeignHValue -&gt; Maybe Name -&gt; Term
</span><a href="GHC.Runtime.Heap.Inspect.html#Suspension"><span class="hs-identifier hs-var">Suspension</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-188"></span><span>              </span><span class="annot"><span class="annottext">fNewtypeWrap :: Type -&gt; Either String DataCon -&gt; Term -&gt; Term
</span><a href="GHC.Runtime.Heap.Inspect.html#fNewtypeWrap"><span class="hs-identifier hs-var">fNewtypeWrap</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Type -&gt; Either String DataCon -&gt; Term -&gt; Term
</span><a href="GHC.Runtime.Heap.Inspect.html#NewtypeWrap"><span class="hs-identifier hs-var">NewtypeWrap</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-189"></span><span>              </span><span class="annot"><span class="annottext">fRefWrap :: Type -&gt; Term -&gt; Term
</span><a href="GHC.Runtime.Heap.Inspect.html#fRefWrap"><span class="hs-identifier hs-var">fRefWrap</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Type -&gt; Term -&gt; Term
</span><a href="GHC.Runtime.Heap.Inspect.html#RefWrap"><span class="hs-identifier hs-var">RefWrap</span></a></span><span>
</span><span id="line-190"></span><span>                      </span><span class="hs-special">}</span><span>
</span><span id="line-191"></span><span>
</span><span id="line-192"></span><span class="annot"><a href="GHC.Runtime.Heap.Inspect.html#mapTermType"><span class="hs-identifier hs-type">mapTermType</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Runtime.Heap.Inspect.html#RttiType"><span class="hs-identifier hs-type">RttiType</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#Type"><span class="hs-identifier hs-type">Type</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Runtime.Heap.Inspect.html#Term"><span class="hs-identifier hs-type">Term</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Runtime.Heap.Inspect.html#Term"><span class="hs-identifier hs-type">Term</span></a></span><span>
</span><span id="line-193"></span><span id="mapTermType"><span class="annot"><span class="annottext">mapTermType :: (Type -&gt; Type) -&gt; Term -&gt; Term
</span><a href="GHC.Runtime.Heap.Inspect.html#mapTermType"><span class="hs-identifier hs-var hs-var">mapTermType</span></a></span></span><span> </span><span id="local-6989586621683021861"><span class="annot"><span class="annottext">Type -&gt; Type
</span><a href="#local-6989586621683021861"><span class="hs-identifier hs-var">f</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">TermFold Term -&gt; Term -&gt; Term
forall a. TermFold a -&gt; Term -&gt; a
</span><a href="GHC.Runtime.Heap.Inspect.html#foldTerm"><span class="hs-identifier hs-var">foldTerm</span></a></span><span> </span><span class="annot"><span class="annottext">TermFold Term
</span><a href="GHC.Runtime.Heap.Inspect.html#idTermFold"><span class="hs-identifier hs-var">idTermFold</span></a></span><span> </span><span class="hs-special">{</span><span>
</span><span id="line-194"></span><span>          </span><span class="annot"><a href="GHC.Runtime.Heap.Inspect.html#fTerm"><span class="hs-identifier hs-var">fTerm</span></a></span><span>       </span><span class="hs-glyph">=</span><span> </span><span class="hs-glyph">\</span><span id="local-6989586621683021862"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621683021862"><span class="hs-identifier hs-var">ty</span></a></span></span><span> </span><span id="local-6989586621683021863"><span class="annot"><span class="annottext">Either String DataCon
</span><a href="#local-6989586621683021863"><span class="hs-identifier hs-var">dc</span></a></span></span><span> </span><span id="local-6989586621683021864"><span class="annot"><span class="annottext">ForeignHValue
</span><a href="#local-6989586621683021864"><span class="hs-identifier hs-var">hval</span></a></span></span><span> </span><span id="local-6989586621683021865"><span class="annot"><span class="annottext">[Term]
</span><a href="#local-6989586621683021865"><span class="hs-identifier hs-var">tt</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">TermProcessor Term Term
</span><a href="GHC.Runtime.Heap.Inspect.html#Term"><span class="hs-identifier hs-var">Term</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Type -&gt; Type
</span><a href="#local-6989586621683021861"><span class="hs-identifier hs-var">f</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621683021862"><span class="hs-identifier hs-var">ty</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Either String DataCon
</span><a href="#local-6989586621683021863"><span class="hs-identifier hs-var">dc</span></a></span><span> </span><span class="annot"><span class="annottext">ForeignHValue
</span><a href="#local-6989586621683021864"><span class="hs-identifier hs-var">hval</span></a></span><span> </span><span class="annot"><span class="annottext">[Term]
</span><a href="#local-6989586621683021865"><span class="hs-identifier hs-var">tt</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-195"></span><span>          </span><span class="annot"><a href="GHC.Runtime.Heap.Inspect.html#fSuspension"><span class="hs-identifier hs-var">fSuspension</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-glyph">\</span><span id="local-6989586621683021866"><span class="annot"><span class="annottext">ClosureType
</span><a href="#local-6989586621683021866"><span class="hs-identifier hs-var">ct</span></a></span></span><span> </span><span id="local-6989586621683021867"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621683021867"><span class="hs-identifier hs-var">ty</span></a></span></span><span> </span><span id="local-6989586621683021868"><span class="annot"><span class="annottext">ForeignHValue
</span><a href="#local-6989586621683021868"><span class="hs-identifier hs-var">hval</span></a></span></span><span> </span><span id="local-6989586621683021869"><span class="annot"><span class="annottext">Maybe Name
</span><a href="#local-6989586621683021869"><span class="hs-identifier hs-var">n</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-196"></span><span>                          </span><span class="annot"><span class="annottext">ClosureType -&gt; Type -&gt; ForeignHValue -&gt; Maybe Name -&gt; Term
</span><a href="GHC.Runtime.Heap.Inspect.html#Suspension"><span class="hs-identifier hs-var">Suspension</span></a></span><span> </span><span class="annot"><span class="annottext">ClosureType
</span><a href="#local-6989586621683021866"><span class="hs-identifier hs-var">ct</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Type -&gt; Type
</span><a href="#local-6989586621683021861"><span class="hs-identifier hs-var">f</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621683021867"><span class="hs-identifier hs-var">ty</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">ForeignHValue
</span><a href="#local-6989586621683021868"><span class="hs-identifier hs-var">hval</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe Name
</span><a href="#local-6989586621683021869"><span class="hs-identifier hs-var">n</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-197"></span><span>          </span><span class="annot"><a href="GHC.Runtime.Heap.Inspect.html#fNewtypeWrap"><span class="hs-identifier hs-var">fNewtypeWrap</span></a></span><span class="hs-glyph">=</span><span> </span><span class="hs-glyph">\</span><span id="local-6989586621683021870"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621683021870"><span class="hs-identifier hs-var">ty</span></a></span></span><span> </span><span id="local-6989586621683021871"><span class="annot"><span class="annottext">Either String DataCon
</span><a href="#local-6989586621683021871"><span class="hs-identifier hs-var">dc</span></a></span></span><span> </span><span id="local-6989586621683021872"><span class="annot"><span class="annottext">Term
</span><a href="#local-6989586621683021872"><span class="hs-identifier hs-var">t</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Type -&gt; Either String DataCon -&gt; Term -&gt; Term
</span><a href="GHC.Runtime.Heap.Inspect.html#NewtypeWrap"><span class="hs-identifier hs-var">NewtypeWrap</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Type -&gt; Type
</span><a href="#local-6989586621683021861"><span class="hs-identifier hs-var">f</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621683021870"><span class="hs-identifier hs-var">ty</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Either String DataCon
</span><a href="#local-6989586621683021871"><span class="hs-identifier hs-var">dc</span></a></span><span> </span><span class="annot"><span class="annottext">Term
</span><a href="#local-6989586621683021872"><span class="hs-identifier hs-var">t</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-198"></span><span>          </span><span class="annot"><a href="GHC.Runtime.Heap.Inspect.html#fRefWrap"><span class="hs-identifier hs-var">fRefWrap</span></a></span><span>    </span><span class="hs-glyph">=</span><span> </span><span class="hs-glyph">\</span><span id="local-6989586621683021873"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621683021873"><span class="hs-identifier hs-var">ty</span></a></span></span><span> </span><span id="local-6989586621683021874"><span class="annot"><span class="annottext">Term
</span><a href="#local-6989586621683021874"><span class="hs-identifier hs-var">t</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Type -&gt; Term -&gt; Term
</span><a href="GHC.Runtime.Heap.Inspect.html#RefWrap"><span class="hs-identifier hs-var">RefWrap</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Type -&gt; Type
</span><a href="#local-6989586621683021861"><span class="hs-identifier hs-var">f</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621683021873"><span class="hs-identifier hs-var">ty</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Term
</span><a href="#local-6989586621683021874"><span class="hs-identifier hs-var">t</span></a></span><span class="hs-special">}</span><span>
</span><span id="line-199"></span><span>
</span><span id="line-200"></span><span id="local-6989586621683020931"><span class="annot"><a href="GHC.Runtime.Heap.Inspect.html#mapTermTypeM"><span class="hs-identifier hs-type">mapTermTypeM</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Monad</span></span><span> </span><span class="annot"><a href="#local-6989586621683020931"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="hs-glyph">=&gt;</span><span>  </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Runtime.Heap.Inspect.html#RttiType"><span class="hs-identifier hs-type">RttiType</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621683020931"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#Type"><span class="hs-identifier hs-type">Type</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Runtime.Heap.Inspect.html#Term"><span class="hs-identifier hs-type">Term</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621683020931"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="annot"><a href="GHC.Runtime.Heap.Inspect.html#Term"><span class="hs-identifier hs-type">Term</span></a></span></span><span>
</span><span id="line-201"></span><span id="mapTermTypeM"><span class="annot"><span class="annottext">mapTermTypeM :: forall (m :: * -&gt; *). Monad m =&gt; (Type -&gt; m Type) -&gt; Term -&gt; m Term
</span><a href="GHC.Runtime.Heap.Inspect.html#mapTermTypeM"><span class="hs-identifier hs-var hs-var">mapTermTypeM</span></a></span></span><span> </span><span id="local-6989586621683021887"><span class="annot"><span class="annottext">Type -&gt; m Type
</span><a href="#local-6989586621683021887"><span class="hs-identifier hs-var">f</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">TermFoldM m Term -&gt; Term -&gt; m Term
forall (m :: * -&gt; *) a. Monad m =&gt; TermFoldM m a -&gt; Term -&gt; m a
</span><a href="GHC.Runtime.Heap.Inspect.html#foldTermM"><span class="hs-identifier hs-var">foldTermM</span></a></span><span> </span><span class="annot"><a href="GHC.Runtime.Heap.Inspect.html#TermFoldM"><span class="hs-identifier hs-type">TermFoldM</span></a></span><span> </span><span class="hs-special">{</span><span>
</span><span id="line-202"></span><span>          </span><span class="annot"><span class="annottext">fTermM :: TermProcessor Term (m Term)
</span><a href="GHC.Runtime.Heap.Inspect.html#fTermM"><span class="hs-identifier hs-var">fTermM</span></a></span><span>       </span><span class="hs-glyph">=</span><span> </span><span class="hs-glyph">\</span><span id="local-6989586621683021888"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621683021888"><span class="hs-identifier hs-var">ty</span></a></span></span><span> </span><span id="local-6989586621683021889"><span class="annot"><span class="annottext">Either String DataCon
</span><a href="#local-6989586621683021889"><span class="hs-identifier hs-var">dc</span></a></span></span><span> </span><span id="local-6989586621683021890"><span class="annot"><span class="annottext">ForeignHValue
</span><a href="#local-6989586621683021890"><span class="hs-identifier hs-var">hval</span></a></span></span><span> </span><span id="local-6989586621683021891"><span class="annot"><span class="annottext">[Term]
</span><a href="#local-6989586621683021891"><span class="hs-identifier hs-var">tt</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Type -&gt; m Type
</span><a href="#local-6989586621683021887"><span class="hs-identifier hs-var">f</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621683021888"><span class="hs-identifier hs-var">ty</span></a></span><span> </span><span class="annot"><span class="annottext">m Type -&gt; (Type -&gt; m Term) -&gt; m Term
forall a b. m a -&gt; (a -&gt; m b) -&gt; m b
forall (m :: * -&gt; *) a b. Monad m =&gt; m a -&gt; (a -&gt; m b) -&gt; m b
</span><span class="hs-operator hs-var">&gt;&gt;=</span></span><span> </span><span class="hs-glyph">\</span><span id="local-6989586621683021892"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621683021892"><span class="hs-identifier hs-var">ty'</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Term -&gt; m Term
forall a. a -&gt; m a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="annot"><span class="annottext">(Term -&gt; m Term) -&gt; Term -&gt; m Term
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">TermProcessor Term Term
</span><a href="GHC.Runtime.Heap.Inspect.html#Term"><span class="hs-identifier hs-var">Term</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621683021892"><span class="hs-identifier hs-var">ty'</span></a></span><span>  </span><span class="annot"><span class="annottext">Either String DataCon
</span><a href="#local-6989586621683021889"><span class="hs-identifier hs-var">dc</span></a></span><span> </span><span class="annot"><span class="annottext">ForeignHValue
</span><a href="#local-6989586621683021890"><span class="hs-identifier hs-var">hval</span></a></span><span> </span><span class="annot"><span class="annottext">[Term]
</span><a href="#local-6989586621683021891"><span class="hs-identifier hs-var">tt</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-203"></span><span>          </span><span class="annot"><span class="annottext">fPrimM :: Type -&gt; [Word] -&gt; m Term
</span><a href="GHC.Runtime.Heap.Inspect.html#fPrimM"><span class="hs-identifier hs-var">fPrimM</span></a></span><span>       </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Term -&gt; m Term
forall a. a -&gt; m a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span class="annot"><span class="annottext">(Term -&gt; m Term) -&gt; ([Word] -&gt; Term) -&gt; [Word] -&gt; m Term
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(([Word] -&gt; Term) -&gt; [Word] -&gt; m Term)
-&gt; (Type -&gt; [Word] -&gt; Term) -&gt; Type -&gt; [Word] -&gt; m Term
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">Type -&gt; [Word] -&gt; Term
</span><a href="GHC.Runtime.Heap.Inspect.html#Prim"><span class="hs-identifier hs-var">Prim</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-204"></span><span>          </span><span class="annot"><span class="annottext">fSuspensionM :: ClosureType -&gt; Type -&gt; ForeignHValue -&gt; Maybe Name -&gt; m Term
</span><a href="GHC.Runtime.Heap.Inspect.html#fSuspensionM"><span class="hs-identifier hs-var">fSuspensionM</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-glyph">\</span><span id="local-6989586621683021894"><span class="annot"><span class="annottext">ClosureType
</span><a href="#local-6989586621683021894"><span class="hs-identifier hs-var">ct</span></a></span></span><span> </span><span id="local-6989586621683021895"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621683021895"><span class="hs-identifier hs-var">ty</span></a></span></span><span> </span><span id="local-6989586621683021896"><span class="annot"><span class="annottext">ForeignHValue
</span><a href="#local-6989586621683021896"><span class="hs-identifier hs-var">hval</span></a></span></span><span> </span><span id="local-6989586621683021897"><span class="annot"><span class="annottext">Maybe Name
</span><a href="#local-6989586621683021897"><span class="hs-identifier hs-var">n</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-205"></span><span>                          </span><span class="annot"><span class="annottext">Type -&gt; m Type
</span><a href="#local-6989586621683021887"><span class="hs-identifier hs-var">f</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621683021895"><span class="hs-identifier hs-var">ty</span></a></span><span> </span><span class="annot"><span class="annottext">m Type -&gt; (Type -&gt; m Term) -&gt; m Term
forall a b. m a -&gt; (a -&gt; m b) -&gt; m b
forall (m :: * -&gt; *) a b. Monad m =&gt; m a -&gt; (a -&gt; m b) -&gt; m b
</span><span class="hs-operator hs-var">&gt;&gt;=</span></span><span> </span><span class="hs-glyph">\</span><span id="local-6989586621683021898"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621683021898"><span class="hs-identifier hs-var">ty'</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Term -&gt; m Term
forall a. a -&gt; m a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="annot"><span class="annottext">(Term -&gt; m Term) -&gt; Term -&gt; m Term
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">ClosureType -&gt; Type -&gt; ForeignHValue -&gt; Maybe Name -&gt; Term
</span><a href="GHC.Runtime.Heap.Inspect.html#Suspension"><span class="hs-identifier hs-var">Suspension</span></a></span><span> </span><span class="annot"><span class="annottext">ClosureType
</span><a href="#local-6989586621683021894"><span class="hs-identifier hs-var">ct</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621683021898"><span class="hs-identifier hs-var">ty'</span></a></span><span> </span><span class="annot"><span class="annottext">ForeignHValue
</span><a href="#local-6989586621683021896"><span class="hs-identifier hs-var">hval</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe Name
</span><a href="#local-6989586621683021897"><span class="hs-identifier hs-var">n</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-206"></span><span>          </span><span class="annot"><span class="annottext">fNewtypeWrapM :: Type -&gt; Either String DataCon -&gt; Term -&gt; m Term
</span><a href="GHC.Runtime.Heap.Inspect.html#fNewtypeWrapM"><span class="hs-identifier hs-var">fNewtypeWrapM</span></a></span><span class="hs-glyph">=</span><span> </span><span class="hs-glyph">\</span><span id="local-6989586621683021899"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621683021899"><span class="hs-identifier hs-var">ty</span></a></span></span><span> </span><span id="local-6989586621683021900"><span class="annot"><span class="annottext">Either String DataCon
</span><a href="#local-6989586621683021900"><span class="hs-identifier hs-var">dc</span></a></span></span><span> </span><span id="local-6989586621683021901"><span class="annot"><span class="annottext">Term
</span><a href="#local-6989586621683021901"><span class="hs-identifier hs-var">t</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Type -&gt; m Type
</span><a href="#local-6989586621683021887"><span class="hs-identifier hs-var">f</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621683021899"><span class="hs-identifier hs-var">ty</span></a></span><span> </span><span class="annot"><span class="annottext">m Type -&gt; (Type -&gt; m Term) -&gt; m Term
forall a b. m a -&gt; (a -&gt; m b) -&gt; m b
forall (m :: * -&gt; *) a b. Monad m =&gt; m a -&gt; (a -&gt; m b) -&gt; m b
</span><span class="hs-operator hs-var">&gt;&gt;=</span></span><span> </span><span class="hs-glyph">\</span><span id="local-6989586621683021902"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621683021902"><span class="hs-identifier hs-var">ty'</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Term -&gt; m Term
forall a. a -&gt; m a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="annot"><span class="annottext">(Term -&gt; m Term) -&gt; Term -&gt; m Term
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Type -&gt; Either String DataCon -&gt; Term -&gt; Term
</span><a href="GHC.Runtime.Heap.Inspect.html#NewtypeWrap"><span class="hs-identifier hs-var">NewtypeWrap</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621683021902"><span class="hs-identifier hs-var">ty'</span></a></span><span> </span><span class="annot"><span class="annottext">Either String DataCon
</span><a href="#local-6989586621683021900"><span class="hs-identifier hs-var">dc</span></a></span><span> </span><span class="annot"><span class="annottext">Term
</span><a href="#local-6989586621683021901"><span class="hs-identifier hs-var">t</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-207"></span><span>          </span><span class="annot"><span class="annottext">fRefWrapM :: Type -&gt; Term -&gt; m Term
</span><a href="GHC.Runtime.Heap.Inspect.html#fRefWrapM"><span class="hs-identifier hs-var">fRefWrapM</span></a></span><span>    </span><span class="hs-glyph">=</span><span> </span><span class="hs-glyph">\</span><span id="local-6989586621683021903"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621683021903"><span class="hs-identifier hs-var">ty</span></a></span></span><span> </span><span id="local-6989586621683021904"><span class="annot"><span class="annottext">Term
</span><a href="#local-6989586621683021904"><span class="hs-identifier hs-var">t</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Type -&gt; m Type
</span><a href="#local-6989586621683021887"><span class="hs-identifier hs-var">f</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621683021903"><span class="hs-identifier hs-var">ty</span></a></span><span> </span><span class="annot"><span class="annottext">m Type -&gt; (Type -&gt; m Term) -&gt; m Term
forall a b. m a -&gt; (a -&gt; m b) -&gt; m b
forall (m :: * -&gt; *) a b. Monad m =&gt; m a -&gt; (a -&gt; m b) -&gt; m b
</span><span class="hs-operator hs-var">&gt;&gt;=</span></span><span> </span><span class="hs-glyph">\</span><span id="local-6989586621683021905"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621683021905"><span class="hs-identifier hs-var">ty'</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Term -&gt; m Term
forall a. a -&gt; m a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="annot"><span class="annottext">(Term -&gt; m Term) -&gt; Term -&gt; m Term
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Type -&gt; Term -&gt; Term
</span><a href="GHC.Runtime.Heap.Inspect.html#RefWrap"><span class="hs-identifier hs-var">RefWrap</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621683021905"><span class="hs-identifier hs-var">ty'</span></a></span><span> </span><span class="annot"><span class="annottext">Term
</span><a href="#local-6989586621683021904"><span class="hs-identifier hs-var">t</span></a></span><span class="hs-special">}</span><span>
</span><span id="line-208"></span><span>
</span><span id="line-209"></span><span class="annot"><a href="GHC.Runtime.Heap.Inspect.html#termTyCoVars"><span class="hs-identifier hs-type">termTyCoVars</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Runtime.Heap.Inspect.html#Term"><span class="hs-identifier hs-type">Term</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Types.Var.Set.html#TyCoVarSet"><span class="hs-identifier hs-type">TyCoVarSet</span></a></span><span>
</span><span id="line-210"></span><span id="termTyCoVars"><span class="annot"><span class="annottext">termTyCoVars :: Term -&gt; TyCoVarSet
</span><a href="GHC.Runtime.Heap.Inspect.html#termTyCoVars"><span class="hs-identifier hs-var hs-var">termTyCoVars</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">TermFold TyCoVarSet -&gt; Term -&gt; TyCoVarSet
forall a. TermFold a -&gt; Term -&gt; a
</span><a href="GHC.Runtime.Heap.Inspect.html#foldTerm"><span class="hs-identifier hs-var">foldTerm</span></a></span><span> </span><span class="annot"><a href="GHC.Runtime.Heap.Inspect.html#TermFold"><span class="hs-identifier hs-type">TermFold</span></a></span><span> </span><span class="hs-special">{</span><span>
</span><span id="line-211"></span><span>            </span><span class="annot"><span class="annottext">fTerm :: TermProcessor TyCoVarSet TyCoVarSet
</span><a href="GHC.Runtime.Heap.Inspect.html#fTerm"><span class="hs-identifier hs-var">fTerm</span></a></span><span>       </span><span class="hs-glyph">=</span><span> </span><span class="hs-glyph">\</span><span id="local-6989586621683021906"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621683021906"><span class="hs-identifier hs-var">ty</span></a></span></span><span> </span><span class="annot"><span class="annottext">Either String DataCon
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">ForeignHValue
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621683021907"><span class="annot"><span class="annottext">[TyCoVarSet]
</span><a href="#local-6989586621683021907"><span class="hs-identifier hs-var">tt</span></a></span></span><span>   </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-212"></span><span>                          </span><span class="annot"><span class="annottext">Type -&gt; TyCoVarSet
</span><a href="GHC.Core.TyCo.FVs.html#tyCoVarsOfType"><span class="hs-identifier hs-var">tyCoVarsOfType</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621683021906"><span class="hs-identifier hs-var">ty</span></a></span><span> </span><span class="annot"><span class="annottext">TyCoVarSet -&gt; TyCoVarSet -&gt; TyCoVarSet
</span><a href="GHC.Types.Var.Set.html#unionVarSet"><span class="hs-operator hs-var">`unionVarSet`</span></a></span><span> </span><span class="annot"><span class="annottext">[TyCoVarSet] -&gt; TyCoVarSet
</span><a href="#local-6989586621683021910"><span class="hs-identifier hs-var">concatVarEnv</span></a></span><span> </span><span class="annot"><span class="annottext">[TyCoVarSet]
</span><a href="#local-6989586621683021907"><span class="hs-identifier hs-var">tt</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-213"></span><span>            </span><span class="annot"><span class="annottext">fSuspension :: ClosureType -&gt; Type -&gt; ForeignHValue -&gt; Maybe Name -&gt; TyCoVarSet
</span><a href="GHC.Runtime.Heap.Inspect.html#fSuspension"><span class="hs-identifier hs-var">fSuspension</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-glyph">\</span><span class="annot"><span class="annottext">ClosureType
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621683021911"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621683021911"><span class="hs-identifier hs-var">ty</span></a></span></span><span> </span><span class="annot"><span class="annottext">ForeignHValue
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">Maybe Name
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Type -&gt; TyCoVarSet
</span><a href="GHC.Core.TyCo.FVs.html#tyCoVarsOfType"><span class="hs-identifier hs-var">tyCoVarsOfType</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621683021911"><span class="hs-identifier hs-var">ty</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-214"></span><span>            </span><span class="annot"><span class="annottext">fPrim :: Type -&gt; [Word] -&gt; TyCoVarSet
</span><a href="GHC.Runtime.Heap.Inspect.html#fPrim"><span class="hs-identifier hs-var">fPrim</span></a></span><span>       </span><span class="hs-glyph">=</span><span> </span><span class="hs-glyph">\</span><span> </span><span class="annot"><span class="annottext">Type
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">[Word]
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">TyCoVarSet
</span><a href="GHC.Types.Var.Set.html#emptyVarSet"><span class="hs-identifier hs-var">emptyVarSet</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-215"></span><span>            </span><span class="annot"><span class="annottext">fNewtypeWrap :: Type -&gt; Either String DataCon -&gt; TyCoVarSet -&gt; TyCoVarSet
</span><a href="GHC.Runtime.Heap.Inspect.html#fNewtypeWrap"><span class="hs-identifier hs-var">fNewtypeWrap</span></a></span><span class="hs-glyph">=</span><span> </span><span class="hs-glyph">\</span><span id="local-6989586621683021913"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621683021913"><span class="hs-identifier hs-var">ty</span></a></span></span><span> </span><span class="annot"><span class="annottext">Either String DataCon
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621683021914"><span class="annot"><span class="annottext">TyCoVarSet
</span><a href="#local-6989586621683021914"><span class="hs-identifier hs-var">t</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Type -&gt; TyCoVarSet
</span><a href="GHC.Core.TyCo.FVs.html#tyCoVarsOfType"><span class="hs-identifier hs-var">tyCoVarsOfType</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621683021913"><span class="hs-identifier hs-var">ty</span></a></span><span> </span><span class="annot"><span class="annottext">TyCoVarSet -&gt; TyCoVarSet -&gt; TyCoVarSet
</span><a href="GHC.Types.Var.Set.html#unionVarSet"><span class="hs-operator hs-var">`unionVarSet`</span></a></span><span> </span><span class="annot"><span class="annottext">TyCoVarSet
</span><a href="#local-6989586621683021914"><span class="hs-identifier hs-var">t</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-216"></span><span>            </span><span class="annot"><span class="annottext">fRefWrap :: Type -&gt; TyCoVarSet -&gt; TyCoVarSet
</span><a href="GHC.Runtime.Heap.Inspect.html#fRefWrap"><span class="hs-identifier hs-var">fRefWrap</span></a></span><span>    </span><span class="hs-glyph">=</span><span> </span><span class="hs-glyph">\</span><span id="local-6989586621683021915"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621683021915"><span class="hs-identifier hs-var">ty</span></a></span></span><span> </span><span id="local-6989586621683021916"><span class="annot"><span class="annottext">TyCoVarSet
</span><a href="#local-6989586621683021916"><span class="hs-identifier hs-var">t</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Type -&gt; TyCoVarSet
</span><a href="GHC.Core.TyCo.FVs.html#tyCoVarsOfType"><span class="hs-identifier hs-var">tyCoVarsOfType</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621683021915"><span class="hs-identifier hs-var">ty</span></a></span><span> </span><span class="annot"><span class="annottext">TyCoVarSet -&gt; TyCoVarSet -&gt; TyCoVarSet
</span><a href="GHC.Types.Var.Set.html#unionVarSet"><span class="hs-operator hs-var">`unionVarSet`</span></a></span><span> </span><span class="annot"><span class="annottext">TyCoVarSet
</span><a href="#local-6989586621683021916"><span class="hs-identifier hs-var">t</span></a></span><span class="hs-special">}</span><span>
</span><span id="line-217"></span><span>    </span><span class="hs-keyword">where</span><span> </span><span id="local-6989586621683021910"><span class="annot"><span class="annottext">concatVarEnv :: [TyCoVarSet] -&gt; TyCoVarSet
</span><a href="#local-6989586621683021910"><span class="hs-identifier hs-var hs-var">concatVarEnv</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(TyCoVarSet -&gt; TyCoVarSet -&gt; TyCoVarSet)
-&gt; TyCoVarSet -&gt; [TyCoVarSet] -&gt; TyCoVarSet
forall a b. (a -&gt; b -&gt; b) -&gt; b -&gt; [a] -&gt; b
forall (t :: * -&gt; *) a b.
Foldable t =&gt;
(a -&gt; b -&gt; b) -&gt; b -&gt; t a -&gt; b
</span><span class="hs-identifier hs-var">foldr</span></span><span> </span><span class="annot"><span class="annottext">TyCoVarSet -&gt; TyCoVarSet -&gt; TyCoVarSet
</span><a href="GHC.Types.Var.Set.html#unionVarSet"><span class="hs-identifier hs-var">unionVarSet</span></a></span><span> </span><span class="annot"><span class="annottext">TyCoVarSet
</span><a href="GHC.Types.Var.Set.html#emptyVarSet"><span class="hs-identifier hs-var">emptyVarSet</span></a></span><span>
</span><span id="line-218"></span><span>
</span><span id="line-219"></span><span class="hs-comment">----------------------------------</span><span>
</span><span id="line-220"></span><span class="hs-comment">-- Pretty printing of terms</span><span>
</span><span id="line-221"></span><span class="hs-comment">----------------------------------</span><span>
</span><span id="line-222"></span><span>
</span><span id="line-223"></span><span class="hs-keyword">type</span><span> </span><span id="Precedence"><span class="annot"><a href="GHC.Runtime.Heap.Inspect.html#Precedence"><span class="hs-identifier hs-var">Precedence</span></a></span></span><span>        </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Int</span></span><span>
</span><span id="line-224"></span><span class="hs-keyword">type</span><span> </span><span id="TermPrinterM"><span class="annot"><a href="GHC.Runtime.Heap.Inspect.html#TermPrinterM"><span class="hs-identifier hs-var">TermPrinterM</span></a></span></span><span> </span><span id="local-6989586621683021920"><span class="annot"><a href="#local-6989586621683021920"><span class="hs-identifier hs-type">m</span></a></span></span><span>    </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="GHC.Runtime.Heap.Inspect.html#Precedence"><span class="hs-identifier hs-type">Precedence</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Runtime.Heap.Inspect.html#Term"><span class="hs-identifier hs-type">Term</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621683021920"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="annot"><a href="GHC.Utils.Outputable.html#SDoc"><span class="hs-identifier hs-type">SDoc</span></a></span><span>
</span><span id="line-225"></span><span>
</span><span id="line-226"></span><span class="annot"><a href="GHC.Runtime.Heap.Inspect.html#app_prec"><span class="hs-identifier hs-type">app_prec</span></a></span><span class="hs-special">,</span><span class="annot"><a href="GHC.Runtime.Heap.Inspect.html#cons_prec"><span class="hs-identifier hs-type">cons_prec</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Runtime.Heap.Inspect.html#max_prec"><span class="hs-identifier hs-type">max_prec</span></a></span><span> </span><span class="hs-glyph">::</span><span class="annot"><span class="hs-identifier hs-type">Int</span></span><span>
</span><span id="line-227"></span><span id="max_prec"><span class="annot"><span class="annottext">max_prec :: Int
</span><a href="GHC.Runtime.Heap.Inspect.html#max_prec"><span class="hs-identifier hs-var hs-var">max_prec</span></a></span></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">10</span></span><span>
</span><span id="line-228"></span><span id="app_prec"><span class="annot"><span class="annottext">app_prec :: Int
</span><a href="GHC.Runtime.Heap.Inspect.html#app_prec"><span class="hs-identifier hs-var hs-var">app_prec</span></a></span></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="GHC.Runtime.Heap.Inspect.html#max_prec"><span class="hs-identifier hs-var">max_prec</span></a></span><span>
</span><span id="line-229"></span><span id="cons_prec"><span class="annot"><span class="annottext">cons_prec :: Int
</span><a href="GHC.Runtime.Heap.Inspect.html#cons_prec"><span class="hs-identifier hs-var hs-var">cons_prec</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">5</span></span><span> </span><span class="hs-comment">-- TODO Extract this info from GHC itself</span><span>
</span><span id="line-230"></span><span>
</span><span id="line-231"></span><span id="local-6989586621683020944"><span class="annot"><a href="GHC.Runtime.Heap.Inspect.html#pprTermM"><span class="hs-identifier hs-type">pprTermM</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Runtime.Heap.Inspect.html#ppr_termM"><span class="hs-identifier hs-type">ppr_termM</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Runtime.Heap.Inspect.html#pprNewtypeWrap"><span class="hs-identifier hs-type">pprNewtypeWrap</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Monad</span></span><span> </span><span class="annot"><a href="#local-6989586621683020944"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="GHC.Runtime.Heap.Inspect.html#TermPrinterM"><span class="hs-identifier hs-type">TermPrinterM</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683020944"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Runtime.Heap.Inspect.html#TermPrinterM"><span class="hs-identifier hs-type">TermPrinterM</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683020944"><span class="hs-identifier hs-type">m</span></a></span></span><span>
</span><span id="line-232"></span><span id="pprTermM"><span class="annot"><span class="annottext">pprTermM :: forall (m :: * -&gt; *). Monad m =&gt; TermPrinterM m -&gt; TermPrinterM m
</span><a href="GHC.Runtime.Heap.Inspect.html#pprTermM"><span class="hs-identifier hs-var hs-var">pprTermM</span></a></span></span><span> </span><span id="local-6989586621683021930"><span class="annot"><span class="annottext">TermPrinterM m
</span><a href="#local-6989586621683021930"><span class="hs-identifier hs-var">y</span></a></span></span><span> </span><span id="local-6989586621683021931"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621683021931"><span class="hs-identifier hs-var">p</span></a></span></span><span> </span><span id="local-6989586621683021932"><span class="annot"><span class="annottext">Term
</span><a href="#local-6989586621683021932"><span class="hs-identifier hs-var">t</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">SDoc -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#pprDeeper"><span class="hs-identifier hs-var">pprDeeper</span></a></span><span> </span><span class="annot"><span class="annottext">(SDoc -&gt; SDoc) -&gt; m SDoc -&gt; m SDoc
forall (m :: * -&gt; *) a1 r. Monad m =&gt; (a1 -&gt; r) -&gt; m a1 -&gt; m r
</span><span class="hs-operator hs-var">`liftM`</span></span><span> </span><span class="annot"><span class="annottext">TermPrinterM m -&gt; TermPrinterM m
forall (m :: * -&gt; *). Monad m =&gt; TermPrinterM m -&gt; TermPrinterM m
</span><a href="GHC.Runtime.Heap.Inspect.html#ppr_termM"><span class="hs-identifier hs-var">ppr_termM</span></a></span><span> </span><span class="annot"><span class="annottext">TermPrinterM m
</span><a href="#local-6989586621683021930"><span class="hs-identifier hs-var">y</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621683021931"><span class="hs-identifier hs-var">p</span></a></span><span> </span><span class="annot"><span class="annottext">Term
</span><a href="#local-6989586621683021932"><span class="hs-identifier hs-var">t</span></a></span><span>
</span><span id="line-233"></span><span>
</span><span id="line-234"></span><span id="ppr_termM"><span class="annot"><span class="annottext">ppr_termM :: forall (m :: * -&gt; *). Monad m =&gt; TermPrinterM m -&gt; TermPrinterM m
</span><a href="GHC.Runtime.Heap.Inspect.html#ppr_termM"><span class="hs-identifier hs-var hs-var">ppr_termM</span></a></span></span><span> </span><span id="local-6989586621683021963"><span class="annot"><span class="annottext">TermPrinterM m
</span><a href="#local-6989586621683021963"><span class="hs-identifier hs-var">y</span></a></span></span><span> </span><span id="local-6989586621683021964"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621683021964"><span class="hs-identifier hs-var">p</span></a></span></span><span> </span><span class="annot"><a href="GHC.Runtime.Heap.Inspect.html#Term"><span class="hs-identifier hs-type">Term</span></a></span><span class="hs-special">{</span><span class="annot"><span class="annottext">dc :: Term -&gt; Either String DataCon
</span><a href="GHC.Runtime.Heap.Inspect.html#dc"><span class="hs-identifier hs-var">dc</span></a></span><span class="hs-glyph">=</span><span class="annot"><span class="hs-identifier hs-type">Left</span></span><span> </span><span id="local-6989586621683021965"><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621683021965"><span class="hs-identifier hs-var">dc_tag</span></a></span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">subTerms :: Term -&gt; [Term]
</span><a href="GHC.Runtime.Heap.Inspect.html#subTerms"><span class="hs-identifier hs-var">subTerms</span></a></span><span class="hs-glyph">=</span><span id="local-6989586621683021966"><span class="annot"><span class="annottext">[Term]
</span><a href="#local-6989586621683021966"><span class="hs-identifier hs-var">tt</span></a></span></span><span class="hs-special">}</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-235"></span><span>  </span><span id="local-6989586621683021967"><span class="annot"><a href="#local-6989586621683021967"><span class="hs-identifier hs-var">tt_docs</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">(Term -&gt; m SDoc) -&gt; [Term] -&gt; m [SDoc]
forall (t :: * -&gt; *) (m :: * -&gt; *) a b.
(Traversable t, Monad m) =&gt;
(a -&gt; m b) -&gt; t a -&gt; m (t b)
forall (m :: * -&gt; *) a b. Monad m =&gt; (a -&gt; m b) -&gt; [a] -&gt; m [b]
</span><span class="hs-identifier hs-var">mapM</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TermPrinterM m
</span><a href="#local-6989586621683021963"><span class="hs-identifier hs-var">y</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="GHC.Runtime.Heap.Inspect.html#app_prec"><span class="hs-identifier hs-var">app_prec</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[Term]
</span><a href="#local-6989586621683021966"><span class="hs-identifier hs-var">tt</span></a></span><span>
</span><span id="line-236"></span><span>  </span><span class="annot"><span class="hs-identifier hs-type">return</span></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="annot"><a href="GHC.Utils.Outputable.html#cparen"><span class="hs-identifier hs-type">cparen</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">not</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">null</span></span><span> </span><span class="annot"><a href="#local-6989586621683021966"><span class="hs-identifier hs-type">tt</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="hs-operator hs-type">&amp;&amp;</span></span><span> </span><span class="annot"><a href="#local-6989586621683021964"><span class="hs-identifier hs-type">p</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">&gt;=</span></span><span> </span><span class="annot"><a href="GHC.Runtime.Heap.Inspect.html#app_prec"><span class="hs-identifier hs-type">app_prec</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-237"></span><span>                  </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Utils.Outputable.html#text"><span class="hs-identifier hs-type">text</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683021965"><span class="hs-identifier hs-type">dc_tag</span></a></span><span> </span><span class="annot"><a href="GHC.Utils.Outputable.html#%3C%2B%3E"><span class="hs-operator hs-type">&lt;+&gt;</span></a></span><span> </span><span class="annot"><a href="GHC.Utils.Outputable.html#pprDeeperList"><span class="hs-identifier hs-type">pprDeeperList</span></a></span><span> </span><span class="annot"><a href="GHC.Utils.Outputable.html#fsep"><span class="hs-identifier hs-type">fsep</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683021967"><span class="hs-identifier hs-type">tt_docs</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-238"></span><span>
</span><span id="line-239"></span><span class="annot"><a href="GHC.Runtime.Heap.Inspect.html#ppr_termM"><span class="hs-identifier hs-var">ppr_termM</span></a></span><span> </span><span id="local-6989586621683021976"><span class="annot"><span class="annottext">TermPrinterM m
</span><a href="#local-6989586621683021976"><span class="hs-identifier hs-var">y</span></a></span></span><span> </span><span id="local-6989586621683021977"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621683021977"><span class="hs-identifier hs-var">p</span></a></span></span><span> </span><span class="annot"><a href="GHC.Runtime.Heap.Inspect.html#Term"><span class="hs-identifier hs-type">Term</span></a></span><span class="hs-special">{</span><span class="annot"><span class="annottext">dc :: Term -&gt; Either String DataCon
</span><a href="GHC.Runtime.Heap.Inspect.html#dc"><span class="hs-identifier hs-var">dc</span></a></span><span class="hs-glyph">=</span><span class="annot"><span class="hs-identifier hs-type">Right</span></span><span> </span><span id="local-6989586621683021978"><span class="annot"><span class="annottext">DataCon
</span><a href="#local-6989586621683021978"><span class="hs-identifier hs-var">dc</span></a></span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">subTerms :: Term -&gt; [Term]
</span><a href="GHC.Runtime.Heap.Inspect.html#subTerms"><span class="hs-identifier hs-var">subTerms</span></a></span><span class="hs-glyph">=</span><span id="local-6989586621683021979"><span class="annot"><span class="annottext">[Term]
</span><a href="#local-6989586621683021979"><span class="hs-identifier hs-var">tt</span></a></span></span><span class="hs-special">}</span><span>
</span><span id="line-240"></span><span class="hs-comment">{-  | dataConIsInfix dc, (t1:t2:tt') &lt;- tt  --TODO fixity
  = parens (ppr_term1 True t1 &lt;+&gt; ppr dc &lt;+&gt; ppr_term1 True ppr t2)
    &lt;+&gt; hsep (map (ppr_term1 True) tt)
-}</span><span> </span><span class="hs-comment">-- TODO Printing infix constructors properly</span><span>
</span><span id="line-244"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span id="local-6989586621683021980"><span class="annot"><a href="#local-6989586621683021980"><span class="hs-identifier hs-var">tt_docs'</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">(Term -&gt; m SDoc) -&gt; [Term] -&gt; m [SDoc]
forall (t :: * -&gt; *) (m :: * -&gt; *) a b.
(Traversable t, Monad m) =&gt;
(a -&gt; m b) -&gt; t a -&gt; m (t b)
forall (m :: * -&gt; *) a b. Monad m =&gt; (a -&gt; m b) -&gt; [a] -&gt; m [b]
</span><span class="hs-identifier hs-var">mapM</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TermPrinterM m
</span><a href="#local-6989586621683021976"><span class="hs-identifier hs-var">y</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="GHC.Runtime.Heap.Inspect.html#app_prec"><span class="hs-identifier hs-var">app_prec</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[Term]
</span><a href="#local-6989586621683021979"><span class="hs-identifier hs-var">tt</span></a></span><span>
</span><span id="line-245"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">return</span></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="annot"><a href="GHC.Utils.Outputable.html#ifPprDebug"><span class="hs-identifier hs-type">ifPprDebug</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621683021982"><span class="hs-identifier hs-type">show_tm</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683021980"><span class="hs-identifier hs-type">tt_docs'</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-246"></span><span>                             </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621683021982"><span class="hs-identifier hs-type">show_tm</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Utils.Misc.html#dropList"><span class="hs-identifier hs-type">dropList</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Core.DataCon.html#dataConTheta"><span class="hs-identifier hs-type">dataConTheta</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683021978"><span class="hs-identifier hs-type">dc</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><a href="#local-6989586621683021980"><span class="hs-identifier hs-type">tt_docs'</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-247"></span><span>                  </span><span class="hs-comment">-- Don't show the dictionary arguments to</span><span>
</span><span id="line-248"></span><span>                  </span><span class="hs-comment">-- constructors unless -dppr-debug is on</span><span>
</span><span id="line-249"></span><span>       </span><span class="hs-special">}</span><span>
</span><span id="line-250"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-251"></span><span>    </span><span id="local-6989586621683021982"><span class="annot"><span class="annottext">show_tm :: [SDoc] -&gt; SDoc
</span><a href="#local-6989586621683021982"><span class="hs-identifier hs-var hs-var">show_tm</span></a></span></span><span> </span><span id="local-6989586621683021985"><span class="annot"><span class="annottext">[SDoc]
</span><a href="#local-6989586621683021985"><span class="hs-identifier hs-var">tt_docs</span></a></span></span><span>
</span><span id="line-252"></span><span>      </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">[SDoc] -&gt; Bool
forall a. [a] -&gt; Bool
forall (t :: * -&gt; *) a. Foldable t =&gt; t a -&gt; Bool
</span><span class="hs-identifier hs-var">null</span></span><span> </span><span class="annot"><span class="annottext">[SDoc]
</span><a href="#local-6989586621683021985"><span class="hs-identifier hs-var">tt_docs</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">DataCon -&gt; SDoc
forall a. Outputable a =&gt; a -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="annot"><span class="annottext">DataCon
</span><a href="#local-6989586621683021978"><span class="hs-identifier hs-var">dc</span></a></span><span>
</span><span id="line-253"></span><span>      </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">otherwise</span></span><span>    </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Bool -&gt; SDoc -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#cparen"><span class="hs-identifier hs-var">cparen</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621683021977"><span class="hs-identifier hs-var">p</span></a></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Bool
forall a. Ord a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">&gt;=</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="GHC.Runtime.Heap.Inspect.html#app_prec"><span class="hs-identifier hs-var">app_prec</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(SDoc -&gt; SDoc) -&gt; SDoc -&gt; SDoc
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-254"></span><span>                       </span><span class="annot"><span class="annottext">[SDoc] -&gt; SDoc
forall doc. IsLine doc =&gt; [doc] -&gt; doc
</span><a href="GHC.Utils.Outputable.html#sep"><span class="hs-identifier hs-var">sep</span></a></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">DataCon -&gt; SDoc
forall a. Outputable a =&gt; a -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="annot"><span class="annottext">DataCon
</span><a href="#local-6989586621683021978"><span class="hs-identifier hs-var">dc</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Int -&gt; SDoc -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#nest"><span class="hs-identifier hs-var">nest</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">2</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">([SDoc] -&gt; SDoc) -&gt; [SDoc] -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#pprDeeperList"><span class="hs-identifier hs-var">pprDeeperList</span></a></span><span> </span><span class="annot"><span class="annottext">[SDoc] -&gt; SDoc
forall doc. IsLine doc =&gt; [doc] -&gt; doc
</span><a href="GHC.Utils.Outputable.html#fsep"><span class="hs-identifier hs-var">fsep</span></a></span><span> </span><span class="annot"><span class="annottext">[SDoc]
</span><a href="#local-6989586621683021985"><span class="hs-identifier hs-var">tt_docs</span></a></span><span class="hs-special">)</span><span class="hs-special">]</span><span>
</span><span id="line-255"></span><span>
</span><span id="line-256"></span><span class="annot"><a href="GHC.Runtime.Heap.Inspect.html#ppr_termM"><span class="hs-identifier hs-var">ppr_termM</span></a></span><span> </span><span id="local-6989586621683021988"><span class="annot"><span class="annottext">TermPrinterM m
</span><a href="#local-6989586621683021988"><span class="hs-identifier hs-var">y</span></a></span></span><span> </span><span id="local-6989586621683021989"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621683021989"><span class="hs-identifier hs-var">p</span></a></span></span><span> </span><span id="local-6989586621683021990"><span class="annot"><span class="annottext">t :: Term
</span><a href="#local-6989586621683021990"><span class="hs-identifier hs-var">t</span></a></span></span><span class="hs-glyph">@</span><span class="annot"><a href="GHC.Runtime.Heap.Inspect.html#NewtypeWrap"><span class="hs-identifier hs-type">NewtypeWrap</span></a></span><span class="hs-special">{</span><span class="hs-special">}</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">TermPrinterM m -&gt; TermPrinterM m
forall (m :: * -&gt; *). Monad m =&gt; TermPrinterM m -&gt; TermPrinterM m
</span><a href="GHC.Runtime.Heap.Inspect.html#pprNewtypeWrap"><span class="hs-identifier hs-var">pprNewtypeWrap</span></a></span><span> </span><span class="annot"><span class="annottext">TermPrinterM m
</span><a href="#local-6989586621683021988"><span class="hs-identifier hs-var">y</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621683021989"><span class="hs-identifier hs-var">p</span></a></span><span> </span><span class="annot"><span class="annottext">Term
</span><a href="#local-6989586621683021990"><span class="hs-identifier hs-var">t</span></a></span><span>
</span><span id="line-257"></span><span class="annot"><a href="GHC.Runtime.Heap.Inspect.html#ppr_termM"><span class="hs-identifier hs-var">ppr_termM</span></a></span><span> </span><span id="local-6989586621683021991"><span class="annot"><span class="annottext">TermPrinterM m
</span><a href="#local-6989586621683021991"><span class="hs-identifier hs-var">y</span></a></span></span><span> </span><span id="local-6989586621683021992"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621683021992"><span class="hs-identifier hs-var">p</span></a></span></span><span> </span><span class="annot"><a href="GHC.Runtime.Heap.Inspect.html#RefWrap"><span class="hs-identifier hs-type">RefWrap</span></a></span><span class="hs-special">{</span><span class="annot"><span class="annottext">wrapped_term :: Term -&gt; Term
</span><a href="GHC.Runtime.Heap.Inspect.html#wrapped_term"><span class="hs-identifier hs-var">wrapped_term</span></a></span><span class="hs-glyph">=</span><span id="local-6989586621683021993"><span class="annot"><span class="annottext">Term
</span><a href="#local-6989586621683021993"><span class="hs-identifier hs-var">t</span></a></span></span><span class="hs-special">}</span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-258"></span><span>  </span><span id="local-6989586621683021994"><span class="annot"><a href="#local-6989586621683021994"><span class="hs-identifier hs-var">contents</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">TermPrinterM m
</span><a href="#local-6989586621683021991"><span class="hs-identifier hs-var">y</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="GHC.Runtime.Heap.Inspect.html#app_prec"><span class="hs-identifier hs-var">app_prec</span></a></span><span> </span><span class="annot"><span class="annottext">Term
</span><a href="#local-6989586621683021993"><span class="hs-identifier hs-var">t</span></a></span><span>
</span><span id="line-259"></span><span>  </span><span class="annot"><span class="hs-identifier hs-type">return</span></span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="annot"><a href="GHC.Utils.Outputable.html#cparen"><span class="hs-identifier hs-type">cparen</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621683021992"><span class="hs-identifier hs-type">p</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">&gt;=</span></span><span> </span><span class="annot"><a href="GHC.Runtime.Heap.Inspect.html#app_prec"><span class="hs-identifier hs-type">app_prec</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Utils.Outputable.html#text"><span class="hs-identifier hs-type">text</span></a></span><span> </span><span class="annot"><span class="hs-string">&quot;GHC.Prim.MutVar#&quot;</span></span><span> </span><span class="annot"><a href="GHC.Utils.Outputable.html#%3C%2B%3E"><span class="hs-operator hs-type">&lt;+&gt;</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683021994"><span class="hs-identifier hs-type">contents</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-260"></span><span>  </span><span class="hs-comment">-- The constructor name is wired in here ^^^ for the sake of simplicity.</span><span>
</span><span id="line-261"></span><span>  </span><span class="hs-comment">-- I don't think mutvars are going to change in a near future.</span><span>
</span><span id="line-262"></span><span>  </span><span class="hs-comment">-- In any case this is solely a presentation matter: MutVar# is</span><span>
</span><span id="line-263"></span><span>  </span><span class="hs-comment">-- a datatype with no constructors, implemented by the RTS</span><span>
</span><span id="line-264"></span><span>  </span><span class="hs-comment">-- (hence there is no way to obtain a datacon and print it).</span><span>
</span><span id="line-265"></span><span class="annot"><a href="GHC.Runtime.Heap.Inspect.html#ppr_termM"><span class="hs-identifier hs-var">ppr_termM</span></a></span><span> </span><span class="annot"><span class="annottext">TermPrinterM m
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621683021995"><span class="annot"><span class="annottext">Term
</span><a href="#local-6989586621683021995"><span class="hs-identifier hs-var">t</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Term -&gt; m SDoc
forall (m :: * -&gt; *). Monad m =&gt; Term -&gt; m SDoc
</span><a href="GHC.Runtime.Heap.Inspect.html#ppr_termM1"><span class="hs-identifier hs-var">ppr_termM1</span></a></span><span> </span><span class="annot"><span class="annottext">Term
</span><a href="#local-6989586621683021995"><span class="hs-identifier hs-var">t</span></a></span><span>
</span><span id="line-266"></span><span>
</span><span id="line-267"></span><span>
</span><span id="line-268"></span><span id="local-6989586621683020957"><span class="annot"><a href="GHC.Runtime.Heap.Inspect.html#ppr_termM1"><span class="hs-identifier hs-type">ppr_termM1</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Monad</span></span><span> </span><span class="annot"><a href="#local-6989586621683020957"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="GHC.Runtime.Heap.Inspect.html#Term"><span class="hs-identifier hs-type">Term</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621683020957"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="annot"><a href="GHC.Utils.Outputable.html#SDoc"><span class="hs-identifier hs-type">SDoc</span></a></span></span><span>
</span><span id="line-269"></span><span id="ppr_termM1"><span class="annot"><span class="annottext">ppr_termM1 :: forall (m :: * -&gt; *). Monad m =&gt; Term -&gt; m SDoc
</span><a href="GHC.Runtime.Heap.Inspect.html#ppr_termM1"><span class="hs-identifier hs-var hs-var">ppr_termM1</span></a></span></span><span> </span><span class="annot"><a href="GHC.Runtime.Heap.Inspect.html#Prim"><span class="hs-identifier hs-type">Prim</span></a></span><span class="hs-special">{</span><span class="annot"><span class="annottext">valRaw :: Term -&gt; [Word]
</span><a href="GHC.Runtime.Heap.Inspect.html#valRaw"><span class="hs-identifier hs-var">valRaw</span></a></span><span class="hs-glyph">=</span><span id="local-6989586621683022016"><span class="annot"><span class="annottext">[Word]
</span><a href="#local-6989586621683022016"><span class="hs-identifier hs-var">words</span></a></span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">ty :: Term -&gt; Type
</span><a href="GHC.Runtime.Heap.Inspect.html#ty"><span class="hs-identifier hs-var">ty</span></a></span><span class="hs-glyph">=</span><span id="local-6989586621683022017"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621683022017"><span class="hs-identifier hs-var">ty</span></a></span></span><span class="hs-special">}</span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-270"></span><span>    </span><span class="annot"><span class="annottext">SDoc -&gt; m SDoc
forall a. a -&gt; m a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="annot"><span class="annottext">(SDoc -&gt; m SDoc) -&gt; SDoc -&gt; m SDoc
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">TyCon -&gt; [Word] -&gt; SDoc
</span><a href="GHC.Runtime.Heap.Inspect.html#repPrim"><span class="hs-identifier hs-var">repPrim</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">HasDebugCallStack =&gt; Type -&gt; TyCon
Type -&gt; TyCon
</span><a href="GHC.Core.Type.html#tyConAppTyCon"><span class="hs-identifier hs-var">tyConAppTyCon</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621683022017"><span class="hs-identifier hs-var">ty</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[Word]
</span><a href="#local-6989586621683022016"><span class="hs-identifier hs-var">words</span></a></span><span>
</span><span id="line-271"></span><span class="annot"><a href="GHC.Runtime.Heap.Inspect.html#ppr_termM1"><span class="hs-identifier hs-var">ppr_termM1</span></a></span><span> </span><span class="annot"><a href="GHC.Runtime.Heap.Inspect.html#Suspension"><span class="hs-identifier hs-type">Suspension</span></a></span><span class="hs-special">{</span><span class="annot"><span class="annottext">ty :: Term -&gt; Type
</span><a href="GHC.Runtime.Heap.Inspect.html#ty"><span class="hs-identifier hs-var">ty</span></a></span><span class="hs-glyph">=</span><span id="local-6989586621683022020"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621683022020"><span class="hs-identifier hs-var">ty</span></a></span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">bound_to :: Term -&gt; Maybe Name
</span><a href="GHC.Runtime.Heap.Inspect.html#bound_to"><span class="hs-identifier hs-var">bound_to</span></a></span><span class="hs-glyph">=</span><span class="annot"><span class="annottext">Maybe Name
</span><span class="hs-identifier hs-var">Nothing</span></span><span class="hs-special">}</span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-272"></span><span>    </span><span class="annot"><span class="annottext">SDoc -&gt; m SDoc
forall a. a -&gt; m a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Char -&gt; SDoc
forall doc. IsLine doc =&gt; Char -&gt; doc
</span><a href="GHC.Utils.Outputable.html#char"><span class="hs-identifier hs-var">char</span></a></span><span> </span><span class="annot"><span class="annottext">Char
</span><span class="hs-char">'_'</span></span><span> </span><span class="annot"><span class="annottext">SDoc -&gt; SDoc -&gt; SDoc
forall doc. IsLine doc =&gt; doc -&gt; doc -&gt; doc
</span><a href="GHC.Utils.Outputable.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">SDoc -&gt; SDoc
forall doc. IsOutput doc =&gt; doc -&gt; doc
</span><a href="GHC.Utils.Outputable.html#whenPprDebug"><span class="hs-identifier hs-var">whenPprDebug</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">SDoc
</span><a href="GHC.Utils.Outputable.html#dcolon"><span class="hs-identifier hs-var">dcolon</span></a></span><span> </span><span class="annot"><span class="annottext">SDoc -&gt; SDoc -&gt; SDoc
forall doc. IsLine doc =&gt; doc -&gt; doc -&gt; doc
</span><a href="GHC.Utils.Outputable.html#%3C%3E"><span class="hs-operator hs-var">&lt;&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">Type -&gt; SDoc
</span><a href="GHC.Core.TyCo.Ppr.html#pprSigmaType"><span class="hs-identifier hs-var">pprSigmaType</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621683022020"><span class="hs-identifier hs-var">ty</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-273"></span><span class="annot"><a href="GHC.Runtime.Heap.Inspect.html#ppr_termM1"><span class="hs-identifier hs-var">ppr_termM1</span></a></span><span> </span><span class="annot"><a href="GHC.Runtime.Heap.Inspect.html#Suspension"><span class="hs-identifier hs-type">Suspension</span></a></span><span class="hs-special">{</span><span class="annot"><span class="annottext">ty :: Term -&gt; Type
</span><a href="GHC.Runtime.Heap.Inspect.html#ty"><span class="hs-identifier hs-var">ty</span></a></span><span class="hs-glyph">=</span><span id="local-6989586621683022026"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621683022026"><span class="hs-identifier hs-var">ty</span></a></span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">bound_to :: Term -&gt; Maybe Name
</span><a href="GHC.Runtime.Heap.Inspect.html#bound_to"><span class="hs-identifier hs-var">bound_to</span></a></span><span class="hs-glyph">=</span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span id="local-6989586621683022027"><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621683022027"><span class="hs-identifier hs-var">n</span></a></span></span><span class="hs-special">}</span><span>
</span><span id="line-274"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">otherwise</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">SDoc -&gt; m SDoc
forall a. a -&gt; m a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span class="annot"><span class="annottext">(SDoc -&gt; m SDoc) -&gt; SDoc -&gt; m SDoc
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">SDoc -&gt; SDoc
forall doc. IsLine doc =&gt; doc -&gt; doc
</span><a href="GHC.Utils.Outputable.html#parens"><span class="hs-identifier hs-var">parens</span></a></span><span class="annot"><span class="annottext">(SDoc -&gt; SDoc) -&gt; SDoc -&gt; SDoc
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Name -&gt; SDoc
forall a. Outputable a =&gt; a -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621683022027"><span class="hs-identifier hs-var">n</span></a></span><span> </span><span class="annot"><span class="annottext">SDoc -&gt; SDoc -&gt; SDoc
forall doc. IsLine doc =&gt; doc -&gt; doc -&gt; doc
</span><a href="GHC.Utils.Outputable.html#%3C%3E"><span class="hs-operator hs-var">&lt;&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">SDoc
</span><a href="GHC.Utils.Outputable.html#dcolon"><span class="hs-identifier hs-var">dcolon</span></a></span><span> </span><span class="annot"><span class="annottext">SDoc -&gt; SDoc -&gt; SDoc
forall doc. IsLine doc =&gt; doc -&gt; doc -&gt; doc
</span><a href="GHC.Utils.Outputable.html#%3C%3E"><span class="hs-operator hs-var">&lt;&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">Type -&gt; SDoc
</span><a href="GHC.Core.TyCo.Ppr.html#pprSigmaType"><span class="hs-identifier hs-var">pprSigmaType</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621683022026"><span class="hs-identifier hs-var">ty</span></a></span><span>
</span><span id="line-275"></span><span class="annot"><a href="GHC.Runtime.Heap.Inspect.html#ppr_termM1"><span class="hs-identifier hs-var">ppr_termM1</span></a></span><span> </span><span class="annot"><a href="GHC.Runtime.Heap.Inspect.html#Term"><span class="hs-identifier hs-type">Term</span></a></span><span class="hs-special">{</span><span class="hs-special">}</span><span>        </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">String -&gt; m SDoc
forall a. HasCallStack =&gt; String -&gt; a
</span><a href="GHC.Utils.Panic.Plain.html#panic"><span class="hs-identifier hs-var">panic</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;ppr_termM1 - Term&quot;</span></span><span>
</span><span id="line-276"></span><span class="annot"><a href="GHC.Runtime.Heap.Inspect.html#ppr_termM1"><span class="hs-identifier hs-var">ppr_termM1</span></a></span><span> </span><span class="annot"><a href="GHC.Runtime.Heap.Inspect.html#RefWrap"><span class="hs-identifier hs-type">RefWrap</span></a></span><span class="hs-special">{</span><span class="hs-special">}</span><span>     </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">String -&gt; m SDoc
forall a. HasCallStack =&gt; String -&gt; a
</span><a href="GHC.Utils.Panic.Plain.html#panic"><span class="hs-identifier hs-var">panic</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;ppr_termM1 - RefWrap&quot;</span></span><span>
</span><span id="line-277"></span><span class="annot"><a href="GHC.Runtime.Heap.Inspect.html#ppr_termM1"><span class="hs-identifier hs-var">ppr_termM1</span></a></span><span> </span><span class="annot"><a href="GHC.Runtime.Heap.Inspect.html#NewtypeWrap"><span class="hs-identifier hs-type">NewtypeWrap</span></a></span><span class="hs-special">{</span><span class="hs-special">}</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">String -&gt; m SDoc
forall a. HasCallStack =&gt; String -&gt; a
</span><a href="GHC.Utils.Panic.Plain.html#panic"><span class="hs-identifier hs-var">panic</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;ppr_termM1 - NewtypeWrap&quot;</span></span><span>
</span><span id="line-278"></span><span>
</span><span id="line-279"></span><span id="pprNewtypeWrap"><span class="annot"><span class="annottext">pprNewtypeWrap :: forall (m :: * -&gt; *). Monad m =&gt; TermPrinterM m -&gt; TermPrinterM m
</span><a href="GHC.Runtime.Heap.Inspect.html#pprNewtypeWrap"><span class="hs-identifier hs-var hs-var">pprNewtypeWrap</span></a></span></span><span> </span><span id="local-6989586621683022040"><span class="annot"><span class="annottext">TermPrinterM m
</span><a href="#local-6989586621683022040"><span class="hs-identifier hs-var">y</span></a></span></span><span> </span><span id="local-6989586621683022041"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621683022041"><span class="hs-identifier hs-var">p</span></a></span></span><span> </span><span class="annot"><a href="GHC.Runtime.Heap.Inspect.html#NewtypeWrap"><span class="hs-identifier hs-type">NewtypeWrap</span></a></span><span class="hs-special">{</span><span class="annot"><span class="annottext">ty :: Term -&gt; Type
</span><a href="GHC.Runtime.Heap.Inspect.html#ty"><span class="hs-identifier hs-var">ty</span></a></span><span class="hs-glyph">=</span><span id="local-6989586621683022042"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621683022042"><span class="hs-identifier hs-var">ty</span></a></span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">wrapped_term :: Term -&gt; Term
</span><a href="GHC.Runtime.Heap.Inspect.html#wrapped_term"><span class="hs-identifier hs-var">wrapped_term</span></a></span><span class="hs-glyph">=</span><span id="local-6989586621683022043"><span class="annot"><span class="annottext">Term
</span><a href="#local-6989586621683022043"><span class="hs-identifier hs-var">t</span></a></span></span><span class="hs-special">}</span><span>
</span><span id="line-280"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span class="hs-special">(</span><span id="local-6989586621683022044"><span class="annot"><span class="annottext">TyCon
</span><a href="#local-6989586621683022044"><span class="hs-identifier hs-var">tc</span></a></span></span><span class="hs-special">,</span><span class="annot"><span class="annottext">[Type]
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">HasDebugCallStack =&gt; Type -&gt; Maybe (TyCon, [Type])
Type -&gt; Maybe (TyCon, [Type])
</span><a href="GHC.Core.Type.html#tcSplitTyConApp_maybe"><span class="hs-identifier hs-var">tcSplitTyConApp_maybe</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621683022042"><span class="hs-identifier hs-var">ty</span></a></span><span>
</span><span id="line-281"></span><span>  </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Bool -&gt; Bool
forall a. HasCallStack =&gt; Bool -&gt; a -&gt; a
</span><a href="GHC.Utils.Panic.Plain.html#assert"><span class="hs-identifier hs-var">assert</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TyCon -&gt; Bool
</span><a href="GHC.Core.TyCon.html#isNewTyCon"><span class="hs-identifier hs-var">isNewTyCon</span></a></span><span> </span><span class="annot"><span class="annottext">TyCon
</span><a href="#local-6989586621683022044"><span class="hs-identifier hs-var">tc</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">True</span></span><span>
</span><span id="line-282"></span><span>  </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span id="local-6989586621683022048"><span class="annot"><span class="annottext">DataCon
</span><a href="#local-6989586621683022048"><span class="hs-identifier hs-var">new_dc</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">TyCon -&gt; Maybe DataCon
</span><a href="GHC.Core.TyCon.html#tyConSingleDataCon_maybe"><span class="hs-identifier hs-var">tyConSingleDataCon_maybe</span></a></span><span> </span><span class="annot"><span class="annottext">TyCon
</span><a href="#local-6989586621683022044"><span class="hs-identifier hs-var">tc</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-283"></span><span>             </span><span id="local-6989586621683022050"><span class="annot"><a href="#local-6989586621683022050"><span class="hs-identifier hs-var">real_term</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">TermPrinterM m
</span><a href="#local-6989586621683022040"><span class="hs-identifier hs-var">y</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="GHC.Runtime.Heap.Inspect.html#max_prec"><span class="hs-identifier hs-var">max_prec</span></a></span><span> </span><span class="annot"><span class="annottext">Term
</span><a href="#local-6989586621683022043"><span class="hs-identifier hs-var">t</span></a></span><span>
</span><span id="line-284"></span><span>             </span><span class="annot"><span class="hs-identifier hs-type">return</span></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="annot"><a href="GHC.Utils.Outputable.html#cparen"><span class="hs-identifier hs-type">cparen</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621683022041"><span class="hs-identifier hs-type">p</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">&gt;=</span></span><span> </span><span class="annot"><a href="GHC.Runtime.Heap.Inspect.html#app_prec"><span class="hs-identifier hs-type">app_prec</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-type">ppr</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683022048"><span class="hs-identifier hs-type">new_dc</span></a></span><span> </span><span class="annot"><a href="GHC.Utils.Outputable.html#%3C%2B%3E"><span class="hs-operator hs-type">&lt;+&gt;</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683022050"><span class="hs-identifier hs-type">real_term</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-285"></span><span class="annot"><a href="GHC.Runtime.Heap.Inspect.html#pprNewtypeWrap"><span class="hs-identifier hs-var">pprNewtypeWrap</span></a></span><span> </span><span class="annot"><span class="annottext">TermPrinterM m
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">Term
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">String -&gt; m SDoc
forall a. HasCallStack =&gt; String -&gt; a
</span><a href="GHC.Utils.Panic.Plain.html#panic"><span class="hs-identifier hs-var">panic</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;pprNewtypeWrap&quot;</span></span><span>
</span><span id="line-286"></span><span>
</span><span id="line-287"></span><span class="hs-comment">-------------------------------------------------------</span><span>
</span><span id="line-288"></span><span class="hs-comment">-- Custom Term Pretty Printers</span><span>
</span><span id="line-289"></span><span class="hs-comment">-------------------------------------------------------</span><span>
</span><span id="line-290"></span><span>
</span><span id="line-291"></span><span class="hs-comment">-- We can want to customize the representation of a</span><span>
</span><span id="line-292"></span><span class="hs-comment">--  term depending on its type.</span><span>
</span><span id="line-293"></span><span class="hs-comment">-- However, note that custom printers have to work with</span><span>
</span><span id="line-294"></span><span class="hs-comment">--  type representations, instead of directly with types.</span><span>
</span><span id="line-295"></span><span class="hs-comment">-- We cannot use type classes here, unless we employ some</span><span>
</span><span id="line-296"></span><span class="hs-comment">--  typerep trickery (e.g. Weirich's RepLib tricks),</span><span>
</span><span id="line-297"></span><span class="hs-comment">--  which I didn't. Therefore, this code replicates a lot</span><span>
</span><span id="line-298"></span><span class="hs-comment">--  of what type classes provide for free.</span><span>
</span><span id="line-299"></span><span>
</span><span id="line-300"></span><span class="hs-keyword">type</span><span> </span><span id="CustomTermPrinter"><span class="annot"><a href="GHC.Runtime.Heap.Inspect.html#CustomTermPrinter"><span class="hs-identifier hs-var">CustomTermPrinter</span></a></span></span><span> </span><span id="local-6989586621683022051"><span class="annot"><a href="#local-6989586621683022051"><span class="hs-identifier hs-type">m</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="GHC.Runtime.Heap.Inspect.html#TermPrinterM"><span class="hs-identifier hs-type">TermPrinterM</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683022051"><span class="hs-identifier hs-type">m</span></a></span><span>
</span><span id="line-301"></span><span>                         </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="GHC.Runtime.Heap.Inspect.html#Precedence"><span class="hs-identifier hs-type">Precedence</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Runtime.Heap.Inspect.html#Term"><span class="hs-identifier hs-type">Term</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621683022051"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Maybe</span></span><span> </span><span class="annot"><a href="GHC.Utils.Outputable.html#SDoc"><span class="hs-identifier hs-type">SDoc</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">]</span><span>
</span><span id="line-302"></span><span>
</span><span id="line-303"></span><span class="hs-comment">-- | Takes a list of custom printers with a explicit recursion knot and a term,</span><span>
</span><span id="line-304"></span><span class="hs-comment">-- and returns the output of the first successful printer, or the default printer</span><span>
</span><span id="line-305"></span><span id="local-6989586621683020869"><span class="annot"><a href="GHC.Runtime.Heap.Inspect.html#cPprTerm"><span class="hs-identifier hs-type">cPprTerm</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Monad</span></span><span> </span><span class="annot"><a href="#local-6989586621683020869"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="GHC.Runtime.Heap.Inspect.html#CustomTermPrinter"><span class="hs-identifier hs-type">CustomTermPrinter</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683020869"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Runtime.Heap.Inspect.html#Term"><span class="hs-identifier hs-type">Term</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621683020869"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="annot"><a href="GHC.Utils.Outputable.html#SDoc"><span class="hs-identifier hs-type">SDoc</span></a></span></span><span>
</span><span id="line-306"></span><span id="cPprTerm"><span class="annot"><span class="annottext">cPprTerm :: forall (m :: * -&gt; *).
Monad m =&gt;
CustomTermPrinter m -&gt; Term -&gt; m SDoc
</span><a href="GHC.Runtime.Heap.Inspect.html#cPprTerm"><span class="hs-identifier hs-var hs-var">cPprTerm</span></a></span></span><span> </span><span id="local-6989586621683022063"><span class="annot"><span class="annottext">CustomTermPrinter m
</span><a href="#local-6989586621683022063"><span class="hs-identifier hs-var">printers_</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">TermPrinterM m
</span><a href="#local-6989586621683022064"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">0</span></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-307"></span><span>  </span><span id="local-6989586621683022065"><span class="annot"><span class="annottext">printers :: [Int -&gt; Term -&gt; m (Maybe SDoc)]
</span><a href="#local-6989586621683022065"><span class="hs-identifier hs-var hs-var">printers</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">CustomTermPrinter m
</span><a href="#local-6989586621683022063"><span class="hs-identifier hs-var">printers_</span></a></span><span> </span><span class="annot"><span class="annottext">TermPrinterM m
</span><a href="#local-6989586621683022064"><span class="hs-identifier hs-var">go</span></a></span><span>
</span><span id="line-308"></span><span>  </span><span id="local-6989586621683022064"><span class="annot"><span class="annottext">go :: TermPrinterM m
</span><a href="#local-6989586621683022064"><span class="hs-identifier hs-var hs-var">go</span></a></span></span><span> </span><span id="local-6989586621683022066"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621683022066"><span class="hs-identifier hs-var">prec</span></a></span></span><span> </span><span id="local-6989586621683022067"><span class="annot"><span class="annottext">Term
</span><a href="#local-6989586621683022067"><span class="hs-identifier hs-var">t</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-309"></span><span>    </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621683022068"><span class="annot"><span class="annottext">default_ :: m (Maybe SDoc)
</span><a href="#local-6989586621683022068"><span class="hs-identifier hs-var hs-var hs-var">default_</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">SDoc -&gt; Maybe SDoc
forall a. a -&gt; Maybe a
</span><span class="hs-identifier hs-var">Just</span></span><span> </span><span class="annot"><span class="annottext">(SDoc -&gt; Maybe SDoc) -&gt; m SDoc -&gt; m (Maybe SDoc)
forall (m :: * -&gt; *) a1 r. Monad m =&gt; (a1 -&gt; r) -&gt; m a1 -&gt; m r
</span><span class="hs-operator hs-var">`liftM`</span></span><span> </span><span class="annot"><span class="annottext">TermPrinterM m -&gt; TermPrinterM m
forall (m :: * -&gt; *). Monad m =&gt; TermPrinterM m -&gt; TermPrinterM m
</span><a href="GHC.Runtime.Heap.Inspect.html#pprTermM"><span class="hs-identifier hs-var">pprTermM</span></a></span><span> </span><span class="annot"><span class="annottext">TermPrinterM m
</span><a href="#local-6989586621683022064"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621683022066"><span class="hs-identifier hs-var">prec</span></a></span><span> </span><span class="annot"><span class="annottext">Term
</span><a href="#local-6989586621683022067"><span class="hs-identifier hs-var">t</span></a></span><span>
</span><span id="line-310"></span><span>        </span><span id="local-6989586621683022069"><span class="annot"><span class="annottext">mb_customDocs :: [m (Maybe SDoc)]
</span><a href="#local-6989586621683022069"><span class="hs-identifier hs-var hs-var hs-var">mb_customDocs</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">Int -&gt; Term -&gt; m (Maybe SDoc)
</span><a href="#local-6989586621683022070"><span class="hs-identifier hs-var">pp</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621683022066"><span class="hs-identifier hs-var">prec</span></a></span><span> </span><span class="annot"><span class="annottext">Term
</span><a href="#local-6989586621683022067"><span class="hs-identifier hs-var">t</span></a></span><span> </span><span class="hs-glyph">|</span><span> </span><span id="local-6989586621683022070"><span class="annot"><span class="annottext">Int -&gt; Term -&gt; m (Maybe SDoc)
</span><a href="#local-6989586621683022070"><span class="hs-identifier hs-var">pp</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">[Int -&gt; Term -&gt; m (Maybe SDoc)]
</span><a href="#local-6989586621683022065"><span class="hs-identifier hs-var">printers</span></a></span><span class="hs-special">]</span><span> </span><span class="annot"><span class="annottext">[m (Maybe SDoc)] -&gt; [m (Maybe SDoc)] -&gt; [m (Maybe SDoc)]
forall a. [a] -&gt; [a] -&gt; [a]
</span><span class="hs-operator hs-var">++</span></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">m (Maybe SDoc)
</span><a href="#local-6989586621683022068"><span class="hs-identifier hs-var">default_</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-311"></span><span>    </span><span id="local-6989586621683022071"><span class="annot"><a href="#local-6989586621683022071"><span class="hs-identifier hs-var">mdoc</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">[m (Maybe SDoc)] -&gt; m (Maybe SDoc)
forall {m :: * -&gt; *} {a}. Monad m =&gt; [m (Maybe a)] -&gt; m (Maybe a)
</span><a href="#local-6989586621683022072"><span class="hs-identifier hs-var">firstJustM</span></a></span><span> </span><span class="annot"><span class="annottext">[m (Maybe SDoc)]
</span><a href="#local-6989586621683022069"><span class="hs-identifier hs-var">mb_customDocs</span></a></span><span>
</span><span id="line-312"></span><span>    </span><span class="hs-keyword">case</span><span> </span><span class="annot"><a href="#local-6989586621683022071"><span class="hs-identifier hs-type">mdoc</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-313"></span><span>      </span><span class="annot"><span class="annottext">Maybe SDoc
</span><span class="hs-identifier hs-var">Nothing</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">String -&gt; m SDoc
forall a. HasCallStack =&gt; String -&gt; a
</span><a href="GHC.Utils.Panic.Plain.html#panic"><span class="hs-identifier hs-var">panic</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;cPprTerm&quot;</span></span><span>
</span><span id="line-314"></span><span>      </span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span id="local-6989586621683022073"><span class="annot"><span class="annottext">SDoc
</span><a href="#local-6989586621683022073"><span class="hs-identifier hs-var">doc</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">SDoc -&gt; m SDoc
forall a. a -&gt; m a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="annot"><span class="annottext">(SDoc -&gt; m SDoc) -&gt; SDoc -&gt; m SDoc
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Bool -&gt; SDoc -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#cparen"><span class="hs-identifier hs-var">cparen</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621683022066"><span class="hs-identifier hs-var">prec</span></a></span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Bool
forall a. Ord a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">&gt;</span></span><span class="annot"><span class="annottext">Int
</span><a href="GHC.Runtime.Heap.Inspect.html#app_prec"><span class="hs-identifier hs-var">app_prec</span></a></span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Int
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">+</span></span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">1</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">SDoc
</span><a href="#local-6989586621683022073"><span class="hs-identifier hs-var">doc</span></a></span><span>
</span><span id="line-315"></span><span>
</span><span id="line-316"></span><span>  </span><span id="local-6989586621683022072"><span class="annot"><span class="annottext">firstJustM :: [m (Maybe a)] -&gt; m (Maybe a)
</span><a href="#local-6989586621683022072"><span class="hs-identifier hs-var hs-var">firstJustM</span></a></span></span><span> </span><span class="hs-special">(</span><span id="local-6989586621683022086"><span class="annot"><span class="annottext">m (Maybe a)
</span><a href="#local-6989586621683022086"><span class="hs-identifier hs-var">mb</span></a></span></span><span class="annot"><span class="hs-glyph hs-type">:</span></span><span id="local-6989586621683022087"><span class="annot"><span class="annottext">[m (Maybe a)]
</span><a href="#local-6989586621683022087"><span class="hs-identifier hs-var">mbs</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">m (Maybe a)
</span><a href="#local-6989586621683022086"><span class="hs-identifier hs-var">mb</span></a></span><span> </span><span class="annot"><span class="annottext">m (Maybe a) -&gt; (Maybe a -&gt; m (Maybe a)) -&gt; m (Maybe a)
forall a b. m a -&gt; (a -&gt; m b) -&gt; m b
forall (m :: * -&gt; *) a b. Monad m =&gt; m a -&gt; (a -&gt; m b) -&gt; m b
</span><span class="hs-operator hs-var">&gt;&gt;=</span></span><span> </span><span class="annot"><span class="annottext">m (Maybe a) -&gt; (a -&gt; m (Maybe a)) -&gt; Maybe a -&gt; m (Maybe a)
forall b a. b -&gt; (a -&gt; b) -&gt; Maybe a -&gt; b
</span><span class="hs-identifier hs-var">maybe</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[m (Maybe a)] -&gt; m (Maybe a)
</span><a href="#local-6989586621683022072"><span class="hs-identifier hs-var">firstJustM</span></a></span><span> </span><span class="annot"><span class="annottext">[m (Maybe a)]
</span><a href="#local-6989586621683022087"><span class="hs-identifier hs-var">mbs</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Maybe a -&gt; m (Maybe a)
forall a. a -&gt; m a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="annot"><span class="annottext">(Maybe a -&gt; m (Maybe a)) -&gt; (a -&gt; Maybe a) -&gt; a -&gt; m (Maybe a)
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">a -&gt; Maybe a
forall a. a -&gt; Maybe a
</span><span class="hs-identifier hs-var">Just</span></span><span class="hs-special">)</span><span>
</span><span id="line-317"></span><span>  </span><span class="annot"><a href="#local-6989586621683022072"><span class="hs-identifier hs-var">firstJustM</span></a></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Maybe a -&gt; m (Maybe a)
forall a. a -&gt; m a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="annot"><span class="annottext">Maybe a
forall a. Maybe a
</span><span class="hs-identifier hs-var">Nothing</span></span><span>
</span><span id="line-318"></span><span>
</span><span id="line-319"></span><span class="hs-comment">-- Default set of custom printers. Note that the recursion knot is explicit</span><span>
</span><span id="line-320"></span><span class="annot"><a href="GHC.Runtime.Heap.Inspect.html#cPprTermBase"><span class="hs-identifier hs-type">cPprTermBase</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-keyword">forall</span><span> </span><span id="local-6989586621683020870"><span class="annot"><a href="#local-6989586621683020870"><span class="hs-identifier hs-type">m</span></a></span></span><span class="hs-operator">.</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Monad</span></span><span> </span><span class="annot"><a href="#local-6989586621683020870"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="GHC.Runtime.Heap.Inspect.html#CustomTermPrinter"><span class="hs-identifier hs-type">CustomTermPrinter</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683020870"><span class="hs-identifier hs-type">m</span></a></span><span>
</span><span id="line-321"></span><span id="cPprTermBase"><span class="annot"><span class="annottext">cPprTermBase :: forall (m :: * -&gt; *). Monad m =&gt; CustomTermPrinter m
</span><a href="GHC.Runtime.Heap.Inspect.html#cPprTermBase"><span class="hs-identifier hs-var hs-var">cPprTermBase</span></a></span></span><span> </span><span id="local-6989586621683022199"><span class="annot"><span class="annottext">TermPrinterM m
</span><a href="#local-6989586621683022199"><span class="hs-identifier hs-var">y</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-322"></span><span>  </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">(Term -&gt; Bool) -&gt; TermPrinterM m -&gt; Int -&gt; Term -&gt; m (Maybe SDoc)
</span><a href="#local-6989586621683022200"><span class="hs-identifier hs-var">ifTerm</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Type -&gt; Bool
</span><a href="#local-6989586621683022201"><span class="hs-identifier hs-var">isTupleTy</span></a></span><span class="annot"><span class="annottext">(Type -&gt; Bool) -&gt; (Term -&gt; Type) -&gt; Term -&gt; Bool
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span class="annot"><span class="annottext">Term -&gt; Type
</span><a href="GHC.Runtime.Heap.Inspect.html#ty"><span class="hs-identifier hs-var">ty</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span id="local-6989586621683022202"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621683022202"><span class="hs-identifier hs-var">_p</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">([SDoc] -&gt; SDoc) -&gt; m [SDoc] -&gt; m SDoc
forall (m :: * -&gt; *) a1 r. Monad m =&gt; (a1 -&gt; r) -&gt; m a1 -&gt; m r
</span><span class="hs-identifier hs-var">liftM</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">SDoc -&gt; SDoc
forall doc. IsLine doc =&gt; doc -&gt; doc
</span><a href="GHC.Utils.Outputable.html#parens"><span class="hs-identifier hs-var">parens</span></a></span><span> </span><span class="annot"><span class="annottext">(SDoc -&gt; SDoc) -&gt; ([SDoc] -&gt; SDoc) -&gt; [SDoc] -&gt; SDoc
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">[SDoc] -&gt; SDoc
forall doc. IsLine doc =&gt; [doc] -&gt; doc
</span><a href="GHC.Utils.Outputable.html#hcat"><span class="hs-identifier hs-var">hcat</span></a></span><span> </span><span class="annot"><span class="annottext">([SDoc] -&gt; SDoc) -&gt; ([SDoc] -&gt; [SDoc]) -&gt; [SDoc] -&gt; SDoc
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">SDoc -&gt; [SDoc] -&gt; [SDoc]
forall doc. IsLine doc =&gt; doc -&gt; [doc] -&gt; [doc]
</span><a href="GHC.Utils.Outputable.html#punctuate"><span class="hs-identifier hs-var">punctuate</span></a></span><span> </span><span class="annot"><span class="annottext">SDoc
forall doc. IsLine doc =&gt; doc
</span><a href="GHC.Utils.Outputable.html#comma"><span class="hs-identifier hs-var">comma</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-323"></span><span>                                      </span><span class="annot"><span class="annottext">(m [SDoc] -&gt; m SDoc) -&gt; (Term -&gt; m [SDoc]) -&gt; Term -&gt; m SDoc
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">(Term -&gt; m SDoc) -&gt; [Term] -&gt; m [SDoc]
forall (t :: * -&gt; *) (m :: * -&gt; *) a b.
(Traversable t, Monad m) =&gt;
(a -&gt; m b) -&gt; t a -&gt; m (t b)
forall (m :: * -&gt; *) a b. Monad m =&gt; (a -&gt; m b) -&gt; [a] -&gt; m [b]
</span><span class="hs-identifier hs-var">mapM</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TermPrinterM m
</span><a href="#local-6989586621683022199"><span class="hs-identifier hs-var">y</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">-</span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">1</span></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-324"></span><span>                                      </span><span class="annot"><span class="annottext">([Term] -&gt; m [SDoc]) -&gt; (Term -&gt; [Term]) -&gt; Term -&gt; m [SDoc]
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">Term -&gt; [Term]
</span><a href="GHC.Runtime.Heap.Inspect.html#subTerms"><span class="hs-identifier hs-var">subTerms</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-325"></span><span>  </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">(Term -&gt; Bool) -&gt; TermPrinterM m -&gt; Int -&gt; Term -&gt; m (Maybe SDoc)
</span><a href="#local-6989586621683022200"><span class="hs-identifier hs-var">ifTerm</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span id="local-6989586621683022206"><span class="annot"><span class="annottext">Term
</span><a href="#local-6989586621683022206"><span class="hs-identifier hs-var">t</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">TyCon -&gt; Type -&gt; Bool
</span><a href="#local-6989586621683022207"><span class="hs-identifier hs-var">isTyCon</span></a></span><span> </span><span class="annot"><span class="annottext">TyCon
</span><a href="GHC.Builtin.Types.html#listTyCon"><span class="hs-identifier hs-var">listTyCon</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Term -&gt; Type
</span><a href="GHC.Runtime.Heap.Inspect.html#ty"><span class="hs-identifier hs-var">ty</span></a></span><span> </span><span class="annot"><span class="annottext">Term
</span><a href="#local-6989586621683022206"><span class="hs-identifier hs-var">t</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Bool -&gt; Bool
</span><span class="hs-operator hs-var">&amp;&amp;</span></span><span> </span><span class="annot"><span class="annottext">Term -&gt; [Term]
</span><a href="GHC.Runtime.Heap.Inspect.html#subTerms"><span class="hs-identifier hs-var">subTerms</span></a></span><span> </span><span class="annot"><span class="annottext">Term
</span><a href="#local-6989586621683022206"><span class="hs-identifier hs-var">t</span></a></span><span> </span><span class="annot"><span class="annottext">[Term] -&gt; Int -&gt; Bool
forall a. [a] -&gt; Int -&gt; Bool
</span><a href="GHC.Utils.Misc.html#lengthIs"><span class="hs-operator hs-var">`lengthIs`</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">2</span></span><span class="hs-special">)</span><span>
</span><span id="line-326"></span><span>           </span><span class="annot"><span class="annottext">TermPrinterM m
</span><a href="#local-6989586621683022210"><span class="hs-identifier hs-var">ppr_list</span></a></span><span>
</span><span id="line-327"></span><span>  </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">(Term -&gt; Bool)
-&gt; (Int -&gt; Term -&gt; m (Maybe SDoc)) -&gt; Int -&gt; Term -&gt; m (Maybe SDoc)
</span><a href="#local-6989586621683022211"><span class="hs-identifier hs-var">ifTerm'</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TyCon -&gt; Type -&gt; Bool
</span><a href="#local-6989586621683022207"><span class="hs-identifier hs-var">isTyCon</span></a></span><span> </span><span class="annot"><span class="annottext">TyCon
</span><a href="GHC.Builtin.Types.html#intTyCon"><span class="hs-identifier hs-var">intTyCon</span></a></span><span>     </span><span class="annot"><span class="annottext">(Type -&gt; Bool) -&gt; (Term -&gt; Type) -&gt; Term -&gt; Bool
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">Term -&gt; Type
</span><a href="GHC.Runtime.Heap.Inspect.html#ty"><span class="hs-identifier hs-var">ty</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Int -&gt; Term -&gt; m (Maybe SDoc)
</span><a href="#local-6989586621683022213"><span class="hs-identifier hs-var">ppr_int</span></a></span><span>
</span><span id="line-328"></span><span>  </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">(Term -&gt; Bool)
-&gt; (Int -&gt; Term -&gt; m (Maybe SDoc)) -&gt; Int -&gt; Term -&gt; m (Maybe SDoc)
</span><a href="#local-6989586621683022211"><span class="hs-identifier hs-var">ifTerm'</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TyCon -&gt; Type -&gt; Bool
</span><a href="#local-6989586621683022207"><span class="hs-identifier hs-var">isTyCon</span></a></span><span> </span><span class="annot"><span class="annottext">TyCon
</span><a href="GHC.Builtin.Types.html#charTyCon"><span class="hs-identifier hs-var">charTyCon</span></a></span><span>    </span><span class="annot"><span class="annottext">(Type -&gt; Bool) -&gt; (Term -&gt; Type) -&gt; Term -&gt; Bool
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">Term -&gt; Type
</span><a href="GHC.Runtime.Heap.Inspect.html#ty"><span class="hs-identifier hs-var">ty</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Int -&gt; Term -&gt; m (Maybe SDoc)
</span><a href="#local-6989586621683022215"><span class="hs-identifier hs-var">ppr_char</span></a></span><span>
</span><span id="line-329"></span><span>  </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">(Term -&gt; Bool)
-&gt; (Int -&gt; Term -&gt; m (Maybe SDoc)) -&gt; Int -&gt; Term -&gt; m (Maybe SDoc)
</span><a href="#local-6989586621683022211"><span class="hs-identifier hs-var">ifTerm'</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TyCon -&gt; Type -&gt; Bool
</span><a href="#local-6989586621683022207"><span class="hs-identifier hs-var">isTyCon</span></a></span><span> </span><span class="annot"><span class="annottext">TyCon
</span><a href="GHC.Builtin.Types.html#floatTyCon"><span class="hs-identifier hs-var">floatTyCon</span></a></span><span>   </span><span class="annot"><span class="annottext">(Type -&gt; Bool) -&gt; (Term -&gt; Type) -&gt; Term -&gt; Bool
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">Term -&gt; Type
</span><a href="GHC.Runtime.Heap.Inspect.html#ty"><span class="hs-identifier hs-var">ty</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Int -&gt; Term -&gt; m (Maybe SDoc)
</span><a href="#local-6989586621683022217"><span class="hs-identifier hs-var">ppr_float</span></a></span><span>
</span><span id="line-330"></span><span>  </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">(Term -&gt; Bool)
-&gt; (Int -&gt; Term -&gt; m (Maybe SDoc)) -&gt; Int -&gt; Term -&gt; m (Maybe SDoc)
</span><a href="#local-6989586621683022211"><span class="hs-identifier hs-var">ifTerm'</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TyCon -&gt; Type -&gt; Bool
</span><a href="#local-6989586621683022207"><span class="hs-identifier hs-var">isTyCon</span></a></span><span> </span><span class="annot"><span class="annottext">TyCon
</span><a href="GHC.Builtin.Types.html#doubleTyCon"><span class="hs-identifier hs-var">doubleTyCon</span></a></span><span>  </span><span class="annot"><span class="annottext">(Type -&gt; Bool) -&gt; (Term -&gt; Type) -&gt; Term -&gt; Bool
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">Term -&gt; Type
</span><a href="GHC.Runtime.Heap.Inspect.html#ty"><span class="hs-identifier hs-var">ty</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Int -&gt; Term -&gt; m (Maybe SDoc)
</span><a href="#local-6989586621683022219"><span class="hs-identifier hs-var">ppr_double</span></a></span><span>
</span><span id="line-331"></span><span>  </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">(Term -&gt; Bool)
-&gt; (Int -&gt; Term -&gt; m (Maybe SDoc)) -&gt; Int -&gt; Term -&gt; m (Maybe SDoc)
</span><a href="#local-6989586621683022211"><span class="hs-identifier hs-var">ifTerm'</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TyCon -&gt; Type -&gt; Bool
</span><a href="#local-6989586621683022207"><span class="hs-identifier hs-var">isTyCon</span></a></span><span> </span><span class="annot"><span class="annottext">TyCon
</span><a href="GHC.Builtin.Types.html#integerTyCon"><span class="hs-identifier hs-var">integerTyCon</span></a></span><span> </span><span class="annot"><span class="annottext">(Type -&gt; Bool) -&gt; (Term -&gt; Type) -&gt; Term -&gt; Bool
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">Term -&gt; Type
</span><a href="GHC.Runtime.Heap.Inspect.html#ty"><span class="hs-identifier hs-var">ty</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Int -&gt; Term -&gt; m (Maybe SDoc)
</span><a href="#local-6989586621683022221"><span class="hs-identifier hs-var">ppr_integer</span></a></span><span>
</span><span id="line-332"></span><span>  </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">(Term -&gt; Bool)
-&gt; (Int -&gt; Term -&gt; m (Maybe SDoc)) -&gt; Int -&gt; Term -&gt; m (Maybe SDoc)
</span><a href="#local-6989586621683022211"><span class="hs-identifier hs-var">ifTerm'</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TyCon -&gt; Type -&gt; Bool
</span><a href="#local-6989586621683022207"><span class="hs-identifier hs-var">isTyCon</span></a></span><span> </span><span class="annot"><span class="annottext">TyCon
</span><a href="GHC.Builtin.Types.html#naturalTyCon"><span class="hs-identifier hs-var">naturalTyCon</span></a></span><span> </span><span class="annot"><span class="annottext">(Type -&gt; Bool) -&gt; (Term -&gt; Type) -&gt; Term -&gt; Bool
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">Term -&gt; Type
</span><a href="GHC.Runtime.Heap.Inspect.html#ty"><span class="hs-identifier hs-var">ty</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Int -&gt; Term -&gt; m (Maybe SDoc)
</span><a href="#local-6989586621683022223"><span class="hs-identifier hs-var">ppr_natural</span></a></span><span>
</span><span id="line-333"></span><span>  </span><span class="hs-special">]</span><span>
</span><span id="line-334"></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-335"></span><span>   </span><span class="annot"><a href="#local-6989586621683022200"><span class="hs-identifier hs-type">ifTerm</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Runtime.Heap.Inspect.html#Term"><span class="hs-identifier hs-type">Term</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Bool</span></span><span class="hs-special">)</span><span>
</span><span id="line-336"></span><span>          </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Runtime.Heap.Inspect.html#Precedence"><span class="hs-identifier hs-type">Precedence</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Runtime.Heap.Inspect.html#Term"><span class="hs-identifier hs-type">Term</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621683020870"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="annot"><a href="GHC.Utils.Outputable.html#SDoc"><span class="hs-identifier hs-type">SDoc</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-337"></span><span>          </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Runtime.Heap.Inspect.html#Precedence"><span class="hs-identifier hs-type">Precedence</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Runtime.Heap.Inspect.html#Term"><span class="hs-identifier hs-type">Term</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621683020870"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Maybe</span></span><span> </span><span class="annot"><a href="GHC.Utils.Outputable.html#SDoc"><span class="hs-identifier hs-type">SDoc</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-338"></span><span>   </span><span id="local-6989586621683022200"><span class="annot"><span class="annottext">ifTerm :: (Term -&gt; Bool) -&gt; TermPrinterM m -&gt; Int -&gt; Term -&gt; m (Maybe SDoc)
</span><a href="#local-6989586621683022200"><span class="hs-identifier hs-var hs-var">ifTerm</span></a></span></span><span> </span><span id="local-6989586621683022224"><span class="annot"><span class="annottext">Term -&gt; Bool
</span><a href="#local-6989586621683022224"><span class="hs-identifier hs-var">pred</span></a></span></span><span> </span><span id="local-6989586621683022225"><span class="annot"><span class="annottext">TermPrinterM m
</span><a href="#local-6989586621683022225"><span class="hs-identifier hs-var">f</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(Term -&gt; Bool)
-&gt; (Int -&gt; Term -&gt; m (Maybe SDoc)) -&gt; Int -&gt; Term -&gt; m (Maybe SDoc)
</span><a href="#local-6989586621683022211"><span class="hs-identifier hs-var">ifTerm'</span></a></span><span> </span><span class="annot"><span class="annottext">Term -&gt; Bool
</span><a href="#local-6989586621683022224"><span class="hs-identifier hs-var">pred</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span id="local-6989586621683022226"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621683022226"><span class="hs-identifier hs-var">prec</span></a></span></span><span> </span><span id="local-6989586621683022227"><span class="annot"><span class="annottext">Term
</span><a href="#local-6989586621683022227"><span class="hs-identifier hs-var">t</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">SDoc -&gt; Maybe SDoc
forall a. a -&gt; Maybe a
</span><span class="hs-identifier hs-var">Just</span></span><span> </span><span class="annot"><span class="annottext">(SDoc -&gt; Maybe SDoc) -&gt; m SDoc -&gt; m (Maybe SDoc)
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="annot"><span class="annottext">TermPrinterM m
</span><a href="#local-6989586621683022225"><span class="hs-identifier hs-var">f</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621683022226"><span class="hs-identifier hs-var">prec</span></a></span><span> </span><span class="annot"><span class="annottext">Term
</span><a href="#local-6989586621683022227"><span class="hs-identifier hs-var">t</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-339"></span><span>
</span><span id="line-340"></span><span>   </span><span class="annot"><a href="#local-6989586621683022211"><span class="hs-identifier hs-type">ifTerm'</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Runtime.Heap.Inspect.html#Term"><span class="hs-identifier hs-type">Term</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Bool</span></span><span class="hs-special">)</span><span>
</span><span id="line-341"></span><span>          </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Runtime.Heap.Inspect.html#Precedence"><span class="hs-identifier hs-type">Precedence</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Runtime.Heap.Inspect.html#Term"><span class="hs-identifier hs-type">Term</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621683020870"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Maybe</span></span><span> </span><span class="annot"><a href="GHC.Utils.Outputable.html#SDoc"><span class="hs-identifier hs-type">SDoc</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-342"></span><span>          </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Runtime.Heap.Inspect.html#Precedence"><span class="hs-identifier hs-type">Precedence</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Runtime.Heap.Inspect.html#Term"><span class="hs-identifier hs-type">Term</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621683020870"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Maybe</span></span><span> </span><span class="annot"><a href="GHC.Utils.Outputable.html#SDoc"><span class="hs-identifier hs-type">SDoc</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-343"></span><span>   </span><span id="local-6989586621683022211"><span class="annot"><span class="annottext">ifTerm' :: (Term -&gt; Bool)
-&gt; (Int -&gt; Term -&gt; m (Maybe SDoc)) -&gt; Int -&gt; Term -&gt; m (Maybe SDoc)
</span><a href="#local-6989586621683022211"><span class="hs-identifier hs-var hs-var">ifTerm'</span></a></span></span><span> </span><span id="local-6989586621683022229"><span class="annot"><span class="annottext">Term -&gt; Bool
</span><a href="#local-6989586621683022229"><span class="hs-identifier hs-var">pred</span></a></span></span><span> </span><span id="local-6989586621683022230"><span class="annot"><span class="annottext">Int -&gt; Term -&gt; m (Maybe SDoc)
</span><a href="#local-6989586621683022230"><span class="hs-identifier hs-var">f</span></a></span></span><span> </span><span id="local-6989586621683022231"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621683022231"><span class="hs-identifier hs-var">prec</span></a></span></span><span> </span><span id="local-6989586621683022232"><span class="annot"><span class="annottext">t :: Term
</span><a href="#local-6989586621683022232"><span class="hs-identifier hs-var">t</span></a></span></span><span class="hs-glyph">@</span><span class="annot"><a href="GHC.Runtime.Heap.Inspect.html#Term"><span class="hs-identifier hs-type">Term</span></a></span><span class="hs-special">{</span><span class="hs-special">}</span><span>
</span><span id="line-344"></span><span>       </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Term -&gt; Bool
</span><a href="#local-6989586621683022229"><span class="hs-identifier hs-var">pred</span></a></span><span> </span><span class="annot"><span class="annottext">Term
</span><a href="#local-6989586621683022232"><span class="hs-identifier hs-var">t</span></a></span><span>    </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Int -&gt; Term -&gt; m (Maybe SDoc)
</span><a href="#local-6989586621683022230"><span class="hs-identifier hs-var">f</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621683022231"><span class="hs-identifier hs-var">prec</span></a></span><span> </span><span class="annot"><span class="annottext">Term
</span><a href="#local-6989586621683022232"><span class="hs-identifier hs-var">t</span></a></span><span>
</span><span id="line-345"></span><span>   </span><span class="annot"><a href="#local-6989586621683022211"><span class="hs-identifier hs-var">ifTerm'</span></a></span><span> </span><span class="annot"><span class="annottext">Term -&gt; Bool
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Term -&gt; m (Maybe SDoc)
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">Term
</span><span class="hs-identifier">_</span></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Maybe SDoc -&gt; m (Maybe SDoc)
forall a. a -&gt; m a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="annot"><span class="annottext">Maybe SDoc
forall a. Maybe a
</span><span class="hs-identifier hs-var">Nothing</span></span><span>
</span><span id="line-346"></span><span>
</span><span id="line-347"></span><span>   </span><span id="local-6989586621683022201"><span class="annot"><span class="annottext">isTupleTy :: Type -&gt; Bool
</span><a href="#local-6989586621683022201"><span class="hs-identifier hs-var hs-var">isTupleTy</span></a></span></span><span> </span><span id="local-6989586621683022236"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621683022236"><span class="hs-identifier hs-var">ty</span></a></span></span><span>    </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Maybe Bool -&gt; Bool
forall a. a -&gt; Maybe a -&gt; a
</span><span class="hs-identifier hs-var">fromMaybe</span></span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">False</span></span><span> </span><span class="annot"><span class="annottext">(Maybe Bool -&gt; Bool) -&gt; Maybe Bool -&gt; Bool
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-348"></span><span>     </span><span class="hs-special">(</span><span id="local-6989586621683022238"><span class="annot"><a href="#local-6989586621683022238"><span class="hs-identifier hs-var">tc</span></a></span></span><span class="hs-special">,</span><span class="annot"><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">HasDebugCallStack =&gt; Type -&gt; Maybe (TyCon, [Type])
Type -&gt; Maybe (TyCon, [Type])
</span><a href="GHC.Core.Type.html#tcSplitTyConApp_maybe"><span class="hs-identifier hs-var">tcSplitTyConApp_maybe</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621683022236"><span class="hs-identifier hs-var">ty</span></a></span><span>
</span><span id="line-349"></span><span>     </span><span class="annot"><span class="hs-identifier hs-type">return</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Core.TyCon.html#isBoxedTupleTyCon"><span class="hs-identifier hs-type">isBoxedTupleTyCon</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683022238"><span class="hs-identifier hs-type">tc</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-350"></span><span>
</span><span id="line-351"></span><span>   </span><span id="local-6989586621683022207"><span class="annot"><span class="annottext">isTyCon :: TyCon -&gt; Type -&gt; Bool
</span><a href="#local-6989586621683022207"><span class="hs-identifier hs-var hs-var">isTyCon</span></a></span></span><span> </span><span id="local-6989586621683022244"><span class="annot"><span class="annottext">TyCon
</span><a href="#local-6989586621683022244"><span class="hs-identifier hs-var">a_tc</span></a></span></span><span> </span><span id="local-6989586621683022245"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621683022245"><span class="hs-identifier hs-var">ty</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Maybe Bool -&gt; Bool
forall a. a -&gt; Maybe a -&gt; a
</span><span class="hs-identifier hs-var">fromMaybe</span></span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">False</span></span><span> </span><span class="annot"><span class="annottext">(Maybe Bool -&gt; Bool) -&gt; Maybe Bool -&gt; Bool
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-352"></span><span>     </span><span class="hs-special">(</span><span id="local-6989586621683022246"><span class="annot"><a href="#local-6989586621683022246"><span class="hs-identifier hs-var">tc</span></a></span></span><span class="hs-special">,</span><span class="annot"><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">HasDebugCallStack =&gt; Type -&gt; Maybe (TyCon, [Type])
Type -&gt; Maybe (TyCon, [Type])
</span><a href="GHC.Core.Type.html#tcSplitTyConApp_maybe"><span class="hs-identifier hs-var">tcSplitTyConApp_maybe</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621683022245"><span class="hs-identifier hs-var">ty</span></a></span><span>
</span><span id="line-353"></span><span>     </span><span class="annot"><span class="hs-identifier hs-type">return</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621683022244"><span class="hs-identifier hs-type">a_tc</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">==</span></span><span> </span><span class="annot"><a href="#local-6989586621683022246"><span class="hs-identifier hs-type">tc</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-354"></span><span>
</span><span id="line-355"></span><span>   </span><span class="annot"><a href="#local-6989586621683022213"><span class="hs-identifier hs-type">ppr_int</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="#local-6989586621683022215"><span class="hs-identifier hs-type">ppr_char</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="#local-6989586621683022217"><span class="hs-identifier hs-type">ppr_float</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="#local-6989586621683022219"><span class="hs-identifier hs-type">ppr_double</span></a></span><span>
</span><span id="line-356"></span><span>      </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Runtime.Heap.Inspect.html#Precedence"><span class="hs-identifier hs-type">Precedence</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Runtime.Heap.Inspect.html#Term"><span class="hs-identifier hs-type">Term</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621683020870"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Maybe</span></span><span> </span><span class="annot"><a href="GHC.Utils.Outputable.html#SDoc"><span class="hs-identifier hs-type">SDoc</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-357"></span><span>   </span><span id="local-6989586621683022213"><span class="annot"><span class="annottext">ppr_int :: Int -&gt; Term -&gt; m (Maybe SDoc)
</span><a href="#local-6989586621683022213"><span class="hs-identifier hs-var hs-var">ppr_int</span></a></span></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><a href="GHC.Runtime.Heap.Inspect.html#Term"><span class="hs-identifier hs-type">Term</span></a></span><span class="hs-special">{</span><span class="annot"><span class="annottext">subTerms :: Term -&gt; [Term]
</span><a href="GHC.Runtime.Heap.Inspect.html#subTerms"><span class="hs-identifier hs-var">subTerms</span></a></span><span class="hs-glyph">=</span><span class="hs-special">[</span><span class="annot"><a href="GHC.Runtime.Heap.Inspect.html#Prim"><span class="hs-identifier hs-type">Prim</span></a></span><span class="hs-special">{</span><span class="annot"><span class="annottext">valRaw :: Term -&gt; [Word]
</span><a href="GHC.Runtime.Heap.Inspect.html#valRaw"><span class="hs-identifier hs-var">valRaw</span></a></span><span class="hs-glyph">=</span><span class="hs-special">[</span><span id="local-6989586621683022247"><span class="annot"><span class="annottext">Word
</span><a href="#local-6989586621683022247"><span class="hs-identifier hs-var">w</span></a></span></span><span class="hs-special">]</span><span class="hs-special">}</span><span class="hs-special">]</span><span class="hs-special">}</span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-358"></span><span>      </span><span class="annot"><span class="annottext">Maybe SDoc -&gt; m (Maybe SDoc)
forall a. a -&gt; m a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">SDoc -&gt; Maybe SDoc
forall a. a -&gt; Maybe a
</span><span class="hs-identifier hs-var">Just</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int -&gt; SDoc
forall doc. IsLine doc =&gt; Int -&gt; doc
</span><a href="GHC.Utils.Outputable.html#int"><span class="hs-identifier hs-var">Ppr.int</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Word -&gt; Int
forall a b. (Integral a, Num b) =&gt; a -&gt; b
</span><span class="hs-identifier hs-var">fromIntegral</span></span><span> </span><span class="annot"><span class="annottext">Word
</span><a href="#local-6989586621683022247"><span class="hs-identifier hs-var">w</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-359"></span><span>   </span><span class="annot"><a href="#local-6989586621683022213"><span class="hs-identifier hs-var">ppr_int</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">Term
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Maybe SDoc -&gt; m (Maybe SDoc)
forall a. a -&gt; m a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="annot"><span class="annottext">Maybe SDoc
forall a. Maybe a
</span><span class="hs-identifier hs-var">Nothing</span></span><span>
</span><span id="line-360"></span><span>
</span><span id="line-361"></span><span>   </span><span id="local-6989586621683022215"><span class="annot"><span class="annottext">ppr_char :: Int -&gt; Term -&gt; m (Maybe SDoc)
</span><a href="#local-6989586621683022215"><span class="hs-identifier hs-var hs-var">ppr_char</span></a></span></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><a href="GHC.Runtime.Heap.Inspect.html#Term"><span class="hs-identifier hs-type">Term</span></a></span><span class="hs-special">{</span><span class="annot"><span class="annottext">subTerms :: Term -&gt; [Term]
</span><a href="GHC.Runtime.Heap.Inspect.html#subTerms"><span class="hs-identifier hs-var">subTerms</span></a></span><span class="hs-glyph">=</span><span class="hs-special">[</span><span class="annot"><a href="GHC.Runtime.Heap.Inspect.html#Prim"><span class="hs-identifier hs-type">Prim</span></a></span><span class="hs-special">{</span><span class="annot"><span class="annottext">valRaw :: Term -&gt; [Word]
</span><a href="GHC.Runtime.Heap.Inspect.html#valRaw"><span class="hs-identifier hs-var">valRaw</span></a></span><span class="hs-glyph">=</span><span class="hs-special">[</span><span id="local-6989586621683022249"><span class="annot"><span class="annottext">Word
</span><a href="#local-6989586621683022249"><span class="hs-identifier hs-var">w</span></a></span></span><span class="hs-special">]</span><span class="hs-special">}</span><span class="hs-special">]</span><span class="hs-special">}</span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-362"></span><span>      </span><span class="annot"><span class="annottext">Maybe SDoc -&gt; m (Maybe SDoc)
forall a. a -&gt; m a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">SDoc -&gt; Maybe SDoc
forall a. a -&gt; Maybe a
</span><span class="hs-identifier hs-var">Just</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Char -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#pprHsChar"><span class="hs-identifier hs-var">Ppr.pprHsChar</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int -&gt; Char
</span><span class="hs-identifier hs-var">chr</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Word -&gt; Int
forall a b. (Integral a, Num b) =&gt; a -&gt; b
</span><span class="hs-identifier hs-var">fromIntegral</span></span><span> </span><span class="annot"><span class="annottext">Word
</span><a href="#local-6989586621683022249"><span class="hs-identifier hs-var">w</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-363"></span><span>   </span><span class="annot"><a href="#local-6989586621683022215"><span class="hs-identifier hs-var">ppr_char</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">Term
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Maybe SDoc -&gt; m (Maybe SDoc)
forall a. a -&gt; m a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="annot"><span class="annottext">Maybe SDoc
forall a. Maybe a
</span><span class="hs-identifier hs-var">Nothing</span></span><span>
</span><span id="line-364"></span><span>
</span><span id="line-365"></span><span>   </span><span id="local-6989586621683022217"><span class="annot"><span class="annottext">ppr_float :: Int -&gt; Term -&gt; m (Maybe SDoc)
</span><a href="#local-6989586621683022217"><span class="hs-identifier hs-var hs-var">ppr_float</span></a></span></span><span>   </span><span class="annot"><span class="annottext">Int
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><a href="GHC.Runtime.Heap.Inspect.html#Term"><span class="hs-identifier hs-type">Term</span></a></span><span class="hs-special">{</span><span class="annot"><span class="annottext">subTerms :: Term -&gt; [Term]
</span><a href="GHC.Runtime.Heap.Inspect.html#subTerms"><span class="hs-identifier hs-var">subTerms</span></a></span><span class="hs-glyph">=</span><span class="hs-special">[</span><span class="annot"><a href="GHC.Runtime.Heap.Inspect.html#Prim"><span class="hs-identifier hs-type">Prim</span></a></span><span class="hs-special">{</span><span class="annot"><span class="annottext">valRaw :: Term -&gt; [Word]
</span><a href="GHC.Runtime.Heap.Inspect.html#valRaw"><span class="hs-identifier hs-var">valRaw</span></a></span><span class="hs-glyph">=</span><span class="hs-special">[</span><span id="local-6989586621683022252"><span class="annot"><span class="annottext">Word
</span><a href="#local-6989586621683022252"><span class="hs-identifier hs-var">w</span></a></span></span><span class="hs-special">]</span><span class="hs-special">}</span><span class="hs-special">]</span><span class="hs-special">}</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-366"></span><span>      </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621683022253"><span class="annot"><span class="annottext">f :: Float
</span><a href="#local-6989586621683022253"><span class="hs-identifier hs-var hs-var">f</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">IO Float -&gt; Float
forall a. IO a -&gt; a
</span><span class="hs-identifier hs-var">unsafeDupablePerformIO</span></span><span> </span><span class="annot"><span class="annottext">(IO Float -&gt; Float) -&gt; IO Float -&gt; Float
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-367"></span><span>                </span><span class="annot"><span class="annottext">(Ptr Word -&gt; IO Float) -&gt; IO Float
forall a b. Storable a =&gt; (Ptr a -&gt; IO b) -&gt; IO b
</span><span class="hs-identifier hs-var">alloca</span></span><span> </span><span class="annot"><span class="annottext">((Ptr Word -&gt; IO Float) -&gt; IO Float)
-&gt; (Ptr Word -&gt; IO Float) -&gt; IO Float
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-glyph">\</span><span id="local-6989586621683022256"><span class="annot"><span class="annottext">Ptr Word
</span><a href="#local-6989586621683022256"><span class="hs-identifier hs-var">p</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Ptr Word -&gt; Word -&gt; IO ()
forall a. Storable a =&gt; Ptr a -&gt; a -&gt; IO ()
</span><span class="hs-identifier hs-var">poke</span></span><span> </span><span class="annot"><span class="annottext">Ptr Word
</span><a href="#local-6989586621683022256"><span class="hs-identifier hs-var">p</span></a></span><span> </span><span class="annot"><span class="annottext">Word
</span><a href="#local-6989586621683022252"><span class="hs-identifier hs-var">w</span></a></span><span> </span><span class="annot"><span class="annottext">IO () -&gt; IO Float -&gt; IO Float
forall a b. IO a -&gt; IO b -&gt; IO b
forall (m :: * -&gt; *) a b. Monad m =&gt; m a -&gt; m b -&gt; m b
</span><span class="hs-operator hs-var">&gt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">Ptr Float -&gt; IO Float
forall a. Storable a =&gt; Ptr a -&gt; IO a
</span><span class="hs-identifier hs-var">peek</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Ptr Word -&gt; Ptr Float
forall a b. Ptr a -&gt; Ptr b
</span><span class="hs-identifier hs-var">castPtr</span></span><span> </span><span class="annot"><span class="annottext">Ptr Word
</span><a href="#local-6989586621683022256"><span class="hs-identifier hs-var">p</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-368"></span><span>      </span><span class="annot"><span class="annottext">Maybe SDoc -&gt; m (Maybe SDoc)
forall a. a -&gt; m a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">SDoc -&gt; Maybe SDoc
forall a. a -&gt; Maybe a
</span><span class="hs-identifier hs-var">Just</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Float -&gt; SDoc
forall doc. IsLine doc =&gt; Float -&gt; doc
</span><a href="GHC.Utils.Outputable.html#float"><span class="hs-identifier hs-var">Ppr.float</span></a></span><span> </span><span class="annot"><span class="annottext">Float
</span><a href="#local-6989586621683022253"><span class="hs-identifier hs-var">f</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-369"></span><span>   </span><span class="annot"><a href="#local-6989586621683022217"><span class="hs-identifier hs-var">ppr_float</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">Term
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Maybe SDoc -&gt; m (Maybe SDoc)
forall a. a -&gt; m a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="annot"><span class="annottext">Maybe SDoc
forall a. Maybe a
</span><span class="hs-identifier hs-var">Nothing</span></span><span>
</span><span id="line-370"></span><span>
</span><span id="line-371"></span><span>   </span><span id="local-6989586621683022219"><span class="annot"><span class="annottext">ppr_double :: Int -&gt; Term -&gt; m (Maybe SDoc)
</span><a href="#local-6989586621683022219"><span class="hs-identifier hs-var hs-var">ppr_double</span></a></span></span><span>  </span><span class="annot"><span class="annottext">Int
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><a href="GHC.Runtime.Heap.Inspect.html#Term"><span class="hs-identifier hs-type">Term</span></a></span><span class="hs-special">{</span><span class="annot"><span class="annottext">subTerms :: Term -&gt; [Term]
</span><a href="GHC.Runtime.Heap.Inspect.html#subTerms"><span class="hs-identifier hs-var">subTerms</span></a></span><span class="hs-glyph">=</span><span class="hs-special">[</span><span class="annot"><a href="GHC.Runtime.Heap.Inspect.html#Prim"><span class="hs-identifier hs-type">Prim</span></a></span><span class="hs-special">{</span><span class="annot"><span class="annottext">valRaw :: Term -&gt; [Word]
</span><a href="GHC.Runtime.Heap.Inspect.html#valRaw"><span class="hs-identifier hs-var">valRaw</span></a></span><span class="hs-glyph">=</span><span class="hs-special">[</span><span id="local-6989586621683022261"><span class="annot"><span class="annottext">Word
</span><a href="#local-6989586621683022261"><span class="hs-identifier hs-var">w</span></a></span></span><span class="hs-special">]</span><span class="hs-special">}</span><span class="hs-special">]</span><span class="hs-special">}</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-372"></span><span>      </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621683022262"><span class="annot"><span class="annottext">f :: Double
</span><a href="#local-6989586621683022262"><span class="hs-identifier hs-var hs-var">f</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">IO Double -&gt; Double
forall a. IO a -&gt; a
</span><span class="hs-identifier hs-var">unsafeDupablePerformIO</span></span><span> </span><span class="annot"><span class="annottext">(IO Double -&gt; Double) -&gt; IO Double -&gt; Double
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-373"></span><span>                </span><span class="annot"><span class="annottext">(Ptr Word -&gt; IO Double) -&gt; IO Double
forall a b. Storable a =&gt; (Ptr a -&gt; IO b) -&gt; IO b
</span><span class="hs-identifier hs-var">alloca</span></span><span> </span><span class="annot"><span class="annottext">((Ptr Word -&gt; IO Double) -&gt; IO Double)
-&gt; (Ptr Word -&gt; IO Double) -&gt; IO Double
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-glyph">\</span><span id="local-6989586621683022263"><span class="annot"><span class="annottext">Ptr Word
</span><a href="#local-6989586621683022263"><span class="hs-identifier hs-var">p</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Ptr Word -&gt; Word -&gt; IO ()
forall a. Storable a =&gt; Ptr a -&gt; a -&gt; IO ()
</span><span class="hs-identifier hs-var">poke</span></span><span> </span><span class="annot"><span class="annottext">Ptr Word
</span><a href="#local-6989586621683022263"><span class="hs-identifier hs-var">p</span></a></span><span> </span><span class="annot"><span class="annottext">Word
</span><a href="#local-6989586621683022261"><span class="hs-identifier hs-var">w</span></a></span><span> </span><span class="annot"><span class="annottext">IO () -&gt; IO Double -&gt; IO Double
forall a b. IO a -&gt; IO b -&gt; IO b
forall (m :: * -&gt; *) a b. Monad m =&gt; m a -&gt; m b -&gt; m b
</span><span class="hs-operator hs-var">&gt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">Ptr Double -&gt; IO Double
forall a. Storable a =&gt; Ptr a -&gt; IO a
</span><span class="hs-identifier hs-var">peek</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Ptr Word -&gt; Ptr Double
forall a b. Ptr a -&gt; Ptr b
</span><span class="hs-identifier hs-var">castPtr</span></span><span> </span><span class="annot"><span class="annottext">Ptr Word
</span><a href="#local-6989586621683022263"><span class="hs-identifier hs-var">p</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-374"></span><span>      </span><span class="annot"><span class="annottext">Maybe SDoc -&gt; m (Maybe SDoc)
forall a. a -&gt; m a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">SDoc -&gt; Maybe SDoc
forall a. a -&gt; Maybe a
</span><span class="hs-identifier hs-var">Just</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Double -&gt; SDoc
forall doc. IsLine doc =&gt; Double -&gt; doc
</span><a href="GHC.Utils.Outputable.html#double"><span class="hs-identifier hs-var">Ppr.double</span></a></span><span> </span><span class="annot"><span class="annottext">Double
</span><a href="#local-6989586621683022262"><span class="hs-identifier hs-var">f</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-375"></span><span>   </span><span class="hs-comment">-- let's assume that if we get two words, we're on a 32-bit</span><span>
</span><span id="line-376"></span><span>   </span><span class="hs-comment">-- machine. There's no good way to get a Platform to check the word</span><span>
</span><span id="line-377"></span><span>   </span><span class="hs-comment">-- size here.</span><span>
</span><span id="line-378"></span><span>   </span><span class="annot"><a href="#local-6989586621683022219"><span class="hs-identifier hs-var">ppr_double</span></a></span><span>  </span><span class="annot"><span class="annottext">Int
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><a href="GHC.Runtime.Heap.Inspect.html#Term"><span class="hs-identifier hs-type">Term</span></a></span><span class="hs-special">{</span><span class="annot"><span class="annottext">subTerms :: Term -&gt; [Term]
</span><a href="GHC.Runtime.Heap.Inspect.html#subTerms"><span class="hs-identifier hs-var">subTerms</span></a></span><span class="hs-glyph">=</span><span class="hs-special">[</span><span class="annot"><a href="GHC.Runtime.Heap.Inspect.html#Prim"><span class="hs-identifier hs-type">Prim</span></a></span><span class="hs-special">{</span><span class="annot"><span class="annottext">valRaw :: Term -&gt; [Word]
</span><a href="GHC.Runtime.Heap.Inspect.html#valRaw"><span class="hs-identifier hs-var">valRaw</span></a></span><span class="hs-glyph">=</span><span class="hs-special">[</span><span id="local-6989586621683022265"><span class="annot"><span class="annottext">Word
</span><a href="#local-6989586621683022265"><span class="hs-identifier hs-var">w1</span></a></span></span><span class="hs-special">,</span><span id="local-6989586621683022266"><span class="annot"><span class="annottext">Word
</span><a href="#local-6989586621683022266"><span class="hs-identifier hs-var">w2</span></a></span></span><span class="hs-special">]</span><span class="hs-special">}</span><span class="hs-special">]</span><span class="hs-special">}</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-379"></span><span>      </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621683022267"><span class="annot"><span class="annottext">f :: Double
</span><a href="#local-6989586621683022267"><span class="hs-identifier hs-var hs-var">f</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">IO Double -&gt; Double
forall a. IO a -&gt; a
</span><span class="hs-identifier hs-var">unsafeDupablePerformIO</span></span><span> </span><span class="annot"><span class="annottext">(IO Double -&gt; Double) -&gt; IO Double -&gt; Double
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-380"></span><span>                </span><span class="annot"><span class="annottext">(Ptr Word32 -&gt; IO Double) -&gt; IO Double
forall a b. Storable a =&gt; (Ptr a -&gt; IO b) -&gt; IO b
</span><span class="hs-identifier hs-var">alloca</span></span><span> </span><span class="annot"><span class="annottext">((Ptr Word32 -&gt; IO Double) -&gt; IO Double)
-&gt; (Ptr Word32 -&gt; IO Double) -&gt; IO Double
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-glyph">\</span><span id="local-6989586621683022268"><span class="annot"><span class="annottext">Ptr Word32
</span><a href="#local-6989586621683022268"><span class="hs-identifier hs-var">p</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-381"></span><span>                  </span><span class="annot"><span class="annottext">Ptr Word32 -&gt; Word32 -&gt; IO ()
forall a. Storable a =&gt; Ptr a -&gt; a -&gt; IO ()
</span><span class="hs-identifier hs-var">poke</span></span><span> </span><span class="annot"><span class="annottext">Ptr Word32
</span><a href="#local-6989586621683022268"><span class="hs-identifier hs-var">p</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Word -&gt; Word32
forall a b. (Integral a, Num b) =&gt; a -&gt; b
</span><span class="hs-identifier hs-var">fromIntegral</span></span><span> </span><span class="annot"><span class="annottext">Word
</span><a href="#local-6989586621683022265"><span class="hs-identifier hs-var">w1</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Word32</span></span><span class="hs-special">)</span><span>
</span><span id="line-382"></span><span>                  </span><span class="annot"><span class="annottext">Ptr Word32 -&gt; Word32 -&gt; IO ()
forall a. Storable a =&gt; Ptr a -&gt; a -&gt; IO ()
</span><span class="hs-identifier hs-var">poke</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Ptr Word32
</span><a href="#local-6989586621683022268"><span class="hs-identifier hs-var">p</span></a></span><span> </span><span class="annot"><span class="annottext">Ptr Word32 -&gt; Int -&gt; Ptr Word32
forall a b. Ptr a -&gt; Int -&gt; Ptr b
</span><span class="hs-operator hs-var">`plusPtr`</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">4</span></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Word -&gt; Word32
forall a b. (Integral a, Num b) =&gt; a -&gt; b
</span><span class="hs-identifier hs-var">fromIntegral</span></span><span> </span><span class="annot"><span class="annottext">Word
</span><a href="#local-6989586621683022266"><span class="hs-identifier hs-var">w2</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Word32</span></span><span class="hs-special">)</span><span>
</span><span id="line-383"></span><span>                  </span><span class="annot"><span class="annottext">Ptr Double -&gt; IO Double
forall a. Storable a =&gt; Ptr a -&gt; IO a
</span><span class="hs-identifier hs-var">peek</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Ptr Word32 -&gt; Ptr Double
forall a b. Ptr a -&gt; Ptr b
</span><span class="hs-identifier hs-var">castPtr</span></span><span> </span><span class="annot"><span class="annottext">Ptr Word32
</span><a href="#local-6989586621683022268"><span class="hs-identifier hs-var">p</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-384"></span><span>      </span><span class="annot"><span class="annottext">Maybe SDoc -&gt; m (Maybe SDoc)
forall a. a -&gt; m a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">SDoc -&gt; Maybe SDoc
forall a. a -&gt; Maybe a
</span><span class="hs-identifier hs-var">Just</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Double -&gt; SDoc
forall doc. IsLine doc =&gt; Double -&gt; doc
</span><a href="GHC.Utils.Outputable.html#double"><span class="hs-identifier hs-var">Ppr.double</span></a></span><span> </span><span class="annot"><span class="annottext">Double
</span><a href="#local-6989586621683022267"><span class="hs-identifier hs-var">f</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-385"></span><span>   </span><span class="annot"><a href="#local-6989586621683022219"><span class="hs-identifier hs-var">ppr_double</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">Term
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Maybe SDoc -&gt; m (Maybe SDoc)
forall a. a -&gt; m a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="annot"><span class="annottext">Maybe SDoc
forall a. Maybe a
</span><span class="hs-identifier hs-var">Nothing</span></span><span>
</span><span id="line-386"></span><span>
</span><span id="line-387"></span><span>   </span><span class="annot"><a href="#local-6989586621683022270"><span class="hs-identifier hs-type">ppr_bignat</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Bool</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Runtime.Heap.Inspect.html#Precedence"><span class="hs-identifier hs-type">Precedence</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><span class="hs-identifier hs-type">Word</span></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621683020870"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Maybe</span></span><span> </span><span class="annot"><a href="GHC.Utils.Outputable.html#SDoc"><span class="hs-identifier hs-type">SDoc</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-388"></span><span>   </span><span id="local-6989586621683022270"><span class="annot"><span class="annottext">ppr_bignat :: Bool -&gt; Int -&gt; [Word] -&gt; m (Maybe SDoc)
</span><a href="#local-6989586621683022270"><span class="hs-identifier hs-var hs-var">ppr_bignat</span></a></span></span><span> </span><span id="local-6989586621683022271"><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621683022271"><span class="hs-identifier hs-var">sign</span></a></span></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621683022272"><span class="annot"><span class="annottext">[Word]
</span><a href="#local-6989586621683022272"><span class="hs-identifier hs-var">ws</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-389"></span><span>      </span><span class="hs-keyword">let</span><span>
</span><span id="line-390"></span><span>         </span><span id="local-6989586621683022275"><span class="annot"><span class="annottext">wordSize :: Int
</span><a href="#local-6989586621683022275"><span class="hs-identifier hs-var hs-var">wordSize</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Word -&gt; Int
forall b. FiniteBits b =&gt; b -&gt; Int
</span><span class="hs-identifier hs-var">finiteBitSize</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Word
</span><span class="hs-number">0</span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Word</span></span><span class="hs-special">)</span><span> </span><span class="hs-comment">-- does the word size depend on the target?</span><span>
</span><span id="line-391"></span><span>         </span><span id="local-6989586621683022303"><span class="annot"><span class="annottext">makeInteger :: t -&gt; Int -&gt; [a] -&gt; t
</span><a href="#local-6989586621683022303"><span class="hs-identifier hs-var hs-var">makeInteger</span></a></span></span><span> </span><span id="local-6989586621683022304"><span class="annot"><span class="annottext">t
</span><a href="#local-6989586621683022304"><span class="hs-identifier hs-var">n</span></a></span></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span>     </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">t
</span><a href="#local-6989586621683022304"><span class="hs-identifier hs-var">n</span></a></span><span>
</span><span id="line-392"></span><span>         </span><span class="annot"><a href="#local-6989586621683022303"><span class="hs-identifier hs-var">makeInteger</span></a></span><span> </span><span id="local-6989586621683022305"><span class="annot"><span class="annottext">t
</span><a href="#local-6989586621683022305"><span class="hs-identifier hs-var">n</span></a></span></span><span> </span><span id="local-6989586621683022306"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621683022306"><span class="hs-identifier hs-var">s</span></a></span></span><span> </span><span class="hs-special">(</span><span id="local-6989586621683022307"><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621683022307"><span class="hs-identifier hs-var">x</span></a></span></span><span class="annot"><span class="hs-glyph hs-type">:</span></span><span id="local-6989586621683022308"><span class="annot"><span class="annottext">[a]
</span><a href="#local-6989586621683022308"><span class="hs-identifier hs-var">xs</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">t -&gt; Int -&gt; [a] -&gt; t
</span><a href="#local-6989586621683022303"><span class="hs-identifier hs-var">makeInteger</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">t
</span><a href="#local-6989586621683022305"><span class="hs-identifier hs-var">n</span></a></span><span> </span><span class="annot"><span class="annottext">t -&gt; t -&gt; t
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">+</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">a -&gt; t
forall a b. (Integral a, Num b) =&gt; a -&gt; b
</span><span class="hs-identifier hs-var">fromIntegral</span></span><span> </span><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621683022307"><span class="hs-identifier hs-var">x</span></a></span><span> </span><span class="annot"><span class="annottext">t -&gt; Int -&gt; t
forall a. Bits a =&gt; a -&gt; Int -&gt; a
</span><a href="GHC.Prelude.Basic.html#shiftL"><span class="hs-operator hs-var">`shiftL`</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621683022306"><span class="hs-identifier hs-var">s</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621683022306"><span class="hs-identifier hs-var">s</span></a></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Int
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">+</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621683022275"><span class="hs-identifier hs-var">wordSize</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[a]
</span><a href="#local-6989586621683022308"><span class="hs-identifier hs-var">xs</span></a></span><span>
</span><span id="line-393"></span><span>         </span><span id="local-6989586621683022310"><span class="annot"><span class="annottext">signf :: Integer
</span><a href="#local-6989586621683022310"><span class="hs-identifier hs-var hs-var">signf</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621683022271"><span class="hs-identifier hs-var">sign</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-394"></span><span>                  </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">False</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Integer
</span><span class="hs-number">1</span></span><span>
</span><span id="line-395"></span><span>                  </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">True</span></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-glyph">-</span><span class="annot"><span class="annottext">Integer
</span><span class="hs-number">1</span></span><span>
</span><span id="line-396"></span><span>      </span><span class="annot"><span class="annottext">Maybe SDoc -&gt; m (Maybe SDoc)
forall a. a -&gt; m a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="annot"><span class="annottext">(Maybe SDoc -&gt; m (Maybe SDoc)) -&gt; Maybe SDoc -&gt; m (Maybe SDoc)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">SDoc -&gt; Maybe SDoc
forall a. a -&gt; Maybe a
</span><span class="hs-identifier hs-var">Just</span></span><span> </span><span class="annot"><span class="annottext">(SDoc -&gt; Maybe SDoc) -&gt; SDoc -&gt; Maybe SDoc
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Integer -&gt; SDoc
forall doc. IsLine doc =&gt; Integer -&gt; doc
</span><a href="GHC.Utils.Outputable.html#integer"><span class="hs-identifier hs-var">Ppr.integer</span></a></span><span> </span><span class="annot"><span class="annottext">(Integer -&gt; SDoc) -&gt; Integer -&gt; SDoc
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Integer
</span><a href="#local-6989586621683022310"><span class="hs-identifier hs-var">signf</span></a></span><span> </span><span class="annot"><span class="annottext">Integer -&gt; Integer -&gt; Integer
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">*</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Integer -&gt; Int -&gt; [Word] -&gt; Integer
forall {t} {a}. (Bits t, Integral a, Num t) =&gt; t -&gt; Int -&gt; [a] -&gt; t
</span><a href="#local-6989586621683022303"><span class="hs-identifier hs-var">makeInteger</span></a></span><span> </span><span class="annot"><span class="annottext">Integer
</span><span class="hs-number">0</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">0</span></span><span> </span><span class="annot"><span class="annottext">[Word]
</span><a href="#local-6989586621683022272"><span class="hs-identifier hs-var">ws</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-397"></span><span>
</span><span id="line-398"></span><span>   </span><span class="hs-comment">-- Reconstructing Bignums is a bit of a pain. This depends deeply on their</span><span>
</span><span id="line-399"></span><span>   </span><span class="hs-comment">-- representation, so it'll break if that changes (but there are several</span><span>
</span><span id="line-400"></span><span>   </span><span class="hs-comment">-- tests in tests/ghci.debugger/scripts that will tell us if this is wrong).</span><span>
</span><span id="line-401"></span><span>   </span><span class="hs-comment">--</span><span>
</span><span id="line-402"></span><span>   </span><span class="hs-comment">--   data Integer</span><span>
</span><span id="line-403"></span><span>   </span><span class="hs-comment">--     = IS !Int#</span><span>
</span><span id="line-404"></span><span>   </span><span class="hs-comment">--     | IP !BigNat</span><span>
</span><span id="line-405"></span><span>   </span><span class="hs-comment">--     | IN !BigNat</span><span>
</span><span id="line-406"></span><span>   </span><span class="hs-comment">--</span><span>
</span><span id="line-407"></span><span>   </span><span class="hs-comment">--   data Natural</span><span>
</span><span id="line-408"></span><span>   </span><span class="hs-comment">--     = NS !Word#</span><span>
</span><span id="line-409"></span><span>   </span><span class="hs-comment">--     | NB !BigNat</span><span>
</span><span id="line-410"></span><span>   </span><span class="hs-comment">--</span><span>
</span><span id="line-411"></span><span>   </span><span class="hs-comment">--   type BigNat = ByteArray#</span><span>
</span><span id="line-412"></span><span>
</span><span id="line-413"></span><span>   </span><span class="annot"><a href="#local-6989586621683022221"><span class="hs-identifier hs-type">ppr_integer</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Runtime.Heap.Inspect.html#Precedence"><span class="hs-identifier hs-type">Precedence</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Runtime.Heap.Inspect.html#Term"><span class="hs-identifier hs-type">Term</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621683020870"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Maybe</span></span><span> </span><span class="annot"><a href="GHC.Utils.Outputable.html#SDoc"><span class="hs-identifier hs-type">SDoc</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-414"></span><span>   </span><span id="local-6989586621683022221"><span class="annot"><span class="annottext">ppr_integer :: Int -&gt; Term -&gt; m (Maybe SDoc)
</span><a href="#local-6989586621683022221"><span class="hs-identifier hs-var hs-var">ppr_integer</span></a></span></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><a href="GHC.Runtime.Heap.Inspect.html#Term"><span class="hs-identifier hs-type">Term</span></a></span><span class="hs-special">{</span><span class="annot"><span class="annottext">dc :: Term -&gt; Either String DataCon
</span><a href="GHC.Runtime.Heap.Inspect.html#dc"><span class="hs-identifier hs-var">dc</span></a></span><span class="hs-glyph">=</span><span class="annot"><span class="hs-identifier hs-type">Right</span></span><span> </span><span id="local-6989586621683022313"><span class="annot"><span class="annottext">DataCon
</span><a href="#local-6989586621683022313"><span class="hs-identifier hs-var">con</span></a></span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">subTerms :: Term -&gt; [Term]
</span><a href="GHC.Runtime.Heap.Inspect.html#subTerms"><span class="hs-identifier hs-var">subTerms</span></a></span><span class="hs-glyph">=</span><span class="hs-special">[</span><span class="annot"><a href="GHC.Runtime.Heap.Inspect.html#Prim"><span class="hs-identifier hs-type">Prim</span></a></span><span class="hs-special">{</span><span class="annot"><span class="annottext">valRaw :: Term -&gt; [Word]
</span><a href="GHC.Runtime.Heap.Inspect.html#valRaw"><span class="hs-identifier hs-var">valRaw</span></a></span><span class="hs-glyph">=</span><span id="local-6989586621683022314"><span class="annot"><span class="annottext">[Word]
</span><a href="#local-6989586621683022314"><span class="hs-identifier hs-var">ws</span></a></span></span><span class="hs-special">}</span><span class="hs-special">]</span><span class="hs-special">}</span><span>
</span><span id="line-415"></span><span>      </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">DataCon
</span><a href="#local-6989586621683022313"><span class="hs-identifier hs-var">con</span></a></span><span> </span><span class="annot"><span class="annottext">DataCon -&gt; DataCon -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">==</span></span><span> </span><span class="annot"><span class="annottext">DataCon
</span><a href="GHC.Builtin.Types.html#integerISDataCon"><span class="hs-identifier hs-var">integerISDataCon</span></a></span><span>
</span><span id="line-416"></span><span>      </span><span class="hs-special">,</span><span> </span><span class="hs-special">[</span><span class="annot"><span class="hs-identifier hs-type">W#</span></span><span> </span><span id="local-6989586621683022316"><span class="annot"><span class="annottext">Word#
</span><a href="#local-6989586621683022316"><span class="hs-identifier hs-var">w</span></a></span></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">[Word]
</span><a href="#local-6989586621683022314"><span class="hs-identifier hs-var">ws</span></a></span><span>
</span><span id="line-417"></span><span>      </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Maybe SDoc -&gt; m (Maybe SDoc)
forall a. a -&gt; m a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">SDoc -&gt; Maybe SDoc
forall a. a -&gt; Maybe a
</span><span class="hs-identifier hs-var">Just</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Integer -&gt; SDoc
forall doc. IsLine doc =&gt; Integer -&gt; doc
</span><a href="GHC.Utils.Outputable.html#integer"><span class="hs-identifier hs-var">Ppr.integer</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int -&gt; Integer
forall a b. (Integral a, Num b) =&gt; a -&gt; b
</span><span class="hs-identifier hs-var">fromIntegral</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int# -&gt; Int
</span><span class="hs-identifier hs-var">I#</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Word# -&gt; Int#
</span><span class="hs-identifier hs-var">word2Int#</span></span><span> </span><span class="annot"><span class="annottext">Word#
</span><a href="#local-6989586621683022316"><span class="hs-identifier hs-var">w</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-418"></span><span>   </span><span class="annot"><a href="#local-6989586621683022221"><span class="hs-identifier hs-var">ppr_integer</span></a></span><span> </span><span id="local-6989586621683022317"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621683022317"><span class="hs-identifier hs-var">p</span></a></span></span><span> </span><span class="annot"><a href="GHC.Runtime.Heap.Inspect.html#Term"><span class="hs-identifier hs-type">Term</span></a></span><span class="hs-special">{</span><span class="annot"><span class="annottext">dc :: Term -&gt; Either String DataCon
</span><a href="GHC.Runtime.Heap.Inspect.html#dc"><span class="hs-identifier hs-var">dc</span></a></span><span class="hs-glyph">=</span><span class="annot"><span class="hs-identifier hs-type">Right</span></span><span> </span><span id="local-6989586621683022318"><span class="annot"><span class="annottext">DataCon
</span><a href="#local-6989586621683022318"><span class="hs-identifier hs-var">con</span></a></span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">subTerms :: Term -&gt; [Term]
</span><a href="GHC.Runtime.Heap.Inspect.html#subTerms"><span class="hs-identifier hs-var">subTerms</span></a></span><span class="hs-glyph">=</span><span class="hs-special">[</span><span class="annot"><a href="GHC.Runtime.Heap.Inspect.html#Term"><span class="hs-identifier hs-type">Term</span></a></span><span class="hs-special">{</span><span class="annot"><span class="annottext">subTerms :: Term -&gt; [Term]
</span><a href="GHC.Runtime.Heap.Inspect.html#subTerms"><span class="hs-identifier hs-var">subTerms</span></a></span><span class="hs-glyph">=</span><span class="hs-special">[</span><span class="annot"><a href="GHC.Runtime.Heap.Inspect.html#Prim"><span class="hs-identifier hs-type">Prim</span></a></span><span class="hs-special">{</span><span class="annot"><span class="annottext">valRaw :: Term -&gt; [Word]
</span><a href="GHC.Runtime.Heap.Inspect.html#valRaw"><span class="hs-identifier hs-var">valRaw</span></a></span><span class="hs-glyph">=</span><span id="local-6989586621683022319"><span class="annot"><span class="annottext">[Word]
</span><a href="#local-6989586621683022319"><span class="hs-identifier hs-var">ws</span></a></span></span><span class="hs-special">}</span><span class="hs-special">]</span><span class="hs-special">}</span><span class="hs-special">]</span><span class="hs-special">}</span><span>
</span><span id="line-419"></span><span>      </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">DataCon
</span><a href="#local-6989586621683022318"><span class="hs-identifier hs-var">con</span></a></span><span> </span><span class="annot"><span class="annottext">DataCon -&gt; DataCon -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">==</span></span><span> </span><span class="annot"><span class="annottext">DataCon
</span><a href="GHC.Builtin.Types.html#integerIPDataCon"><span class="hs-identifier hs-var">integerIPDataCon</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Int -&gt; [Word] -&gt; m (Maybe SDoc)
</span><a href="#local-6989586621683022270"><span class="hs-identifier hs-var">ppr_bignat</span></a></span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">False</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621683022317"><span class="hs-identifier hs-var">p</span></a></span><span> </span><span class="annot"><span class="annottext">[Word]
</span><a href="#local-6989586621683022319"><span class="hs-identifier hs-var">ws</span></a></span><span>
</span><span id="line-420"></span><span>      </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">DataCon
</span><a href="#local-6989586621683022318"><span class="hs-identifier hs-var">con</span></a></span><span> </span><span class="annot"><span class="annottext">DataCon -&gt; DataCon -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">==</span></span><span> </span><span class="annot"><span class="annottext">DataCon
</span><a href="GHC.Builtin.Types.html#integerINDataCon"><span class="hs-identifier hs-var">integerINDataCon</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Int -&gt; [Word] -&gt; m (Maybe SDoc)
</span><a href="#local-6989586621683022270"><span class="hs-identifier hs-var">ppr_bignat</span></a></span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">True</span></span><span>  </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621683022317"><span class="hs-identifier hs-var">p</span></a></span><span> </span><span class="annot"><span class="annottext">[Word]
</span><a href="#local-6989586621683022319"><span class="hs-identifier hs-var">ws</span></a></span><span>
</span><span id="line-421"></span><span>      </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">otherwise</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">String -&gt; m (Maybe SDoc)
forall a. HasCallStack =&gt; String -&gt; a
</span><a href="GHC.Utils.Panic.Plain.html#panic"><span class="hs-identifier hs-var">panic</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;Unexpected Integer constructor&quot;</span></span><span>
</span><span id="line-422"></span><span>   </span><span class="annot"><a href="#local-6989586621683022221"><span class="hs-identifier hs-var">ppr_integer</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">Term
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Maybe SDoc -&gt; m (Maybe SDoc)
forall a. a -&gt; m a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="annot"><span class="annottext">Maybe SDoc
forall a. Maybe a
</span><span class="hs-identifier hs-var">Nothing</span></span><span>
</span><span id="line-423"></span><span>
</span><span id="line-424"></span><span>   </span><span class="annot"><a href="#local-6989586621683022223"><span class="hs-identifier hs-type">ppr_natural</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Runtime.Heap.Inspect.html#Precedence"><span class="hs-identifier hs-type">Precedence</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Runtime.Heap.Inspect.html#Term"><span class="hs-identifier hs-type">Term</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621683020870"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Maybe</span></span><span> </span><span class="annot"><a href="GHC.Utils.Outputable.html#SDoc"><span class="hs-identifier hs-type">SDoc</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-425"></span><span>   </span><span id="local-6989586621683022223"><span class="annot"><span class="annottext">ppr_natural :: Int -&gt; Term -&gt; m (Maybe SDoc)
</span><a href="#local-6989586621683022223"><span class="hs-identifier hs-var hs-var">ppr_natural</span></a></span></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><a href="GHC.Runtime.Heap.Inspect.html#Term"><span class="hs-identifier hs-type">Term</span></a></span><span class="hs-special">{</span><span class="annot"><span class="annottext">dc :: Term -&gt; Either String DataCon
</span><a href="GHC.Runtime.Heap.Inspect.html#dc"><span class="hs-identifier hs-var">dc</span></a></span><span class="hs-glyph">=</span><span class="annot"><span class="hs-identifier hs-type">Right</span></span><span> </span><span id="local-6989586621683022322"><span class="annot"><span class="annottext">DataCon
</span><a href="#local-6989586621683022322"><span class="hs-identifier hs-var">con</span></a></span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">subTerms :: Term -&gt; [Term]
</span><a href="GHC.Runtime.Heap.Inspect.html#subTerms"><span class="hs-identifier hs-var">subTerms</span></a></span><span class="hs-glyph">=</span><span class="hs-special">[</span><span class="annot"><a href="GHC.Runtime.Heap.Inspect.html#Prim"><span class="hs-identifier hs-type">Prim</span></a></span><span class="hs-special">{</span><span class="annot"><span class="annottext">valRaw :: Term -&gt; [Word]
</span><a href="GHC.Runtime.Heap.Inspect.html#valRaw"><span class="hs-identifier hs-var">valRaw</span></a></span><span class="hs-glyph">=</span><span id="local-6989586621683022323"><span class="annot"><span class="annottext">[Word]
</span><a href="#local-6989586621683022323"><span class="hs-identifier hs-var">ws</span></a></span></span><span class="hs-special">}</span><span class="hs-special">]</span><span class="hs-special">}</span><span>
</span><span id="line-426"></span><span>      </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">DataCon
</span><a href="#local-6989586621683022322"><span class="hs-identifier hs-var">con</span></a></span><span> </span><span class="annot"><span class="annottext">DataCon -&gt; DataCon -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">==</span></span><span> </span><span class="annot"><span class="annottext">DataCon
</span><a href="GHC.Builtin.Types.html#naturalNSDataCon"><span class="hs-identifier hs-var">naturalNSDataCon</span></a></span><span>
</span><span id="line-427"></span><span>      </span><span class="hs-special">,</span><span> </span><span class="hs-special">[</span><span id="local-6989586621683022325"><span class="annot"><span class="annottext">Word
</span><a href="#local-6989586621683022325"><span class="hs-identifier hs-var">w</span></a></span></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">[Word]
</span><a href="#local-6989586621683022323"><span class="hs-identifier hs-var">ws</span></a></span><span>
</span><span id="line-428"></span><span>      </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Maybe SDoc -&gt; m (Maybe SDoc)
forall a. a -&gt; m a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">SDoc -&gt; Maybe SDoc
forall a. a -&gt; Maybe a
</span><span class="hs-identifier hs-var">Just</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Integer -&gt; SDoc
forall doc. IsLine doc =&gt; Integer -&gt; doc
</span><a href="GHC.Utils.Outputable.html#integer"><span class="hs-identifier hs-var">Ppr.integer</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Word -&gt; Integer
forall a b. (Integral a, Num b) =&gt; a -&gt; b
</span><span class="hs-identifier hs-var">fromIntegral</span></span><span> </span><span class="annot"><span class="annottext">Word
</span><a href="#local-6989586621683022325"><span class="hs-identifier hs-var">w</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-429"></span><span>   </span><span class="annot"><a href="#local-6989586621683022223"><span class="hs-identifier hs-var">ppr_natural</span></a></span><span> </span><span id="local-6989586621683022326"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621683022326"><span class="hs-identifier hs-var">p</span></a></span></span><span> </span><span class="annot"><a href="GHC.Runtime.Heap.Inspect.html#Term"><span class="hs-identifier hs-type">Term</span></a></span><span class="hs-special">{</span><span class="annot"><span class="annottext">dc :: Term -&gt; Either String DataCon
</span><a href="GHC.Runtime.Heap.Inspect.html#dc"><span class="hs-identifier hs-var">dc</span></a></span><span class="hs-glyph">=</span><span class="annot"><span class="hs-identifier hs-type">Right</span></span><span> </span><span id="local-6989586621683022327"><span class="annot"><span class="annottext">DataCon
</span><a href="#local-6989586621683022327"><span class="hs-identifier hs-var">con</span></a></span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">subTerms :: Term -&gt; [Term]
</span><a href="GHC.Runtime.Heap.Inspect.html#subTerms"><span class="hs-identifier hs-var">subTerms</span></a></span><span class="hs-glyph">=</span><span class="hs-special">[</span><span class="annot"><a href="GHC.Runtime.Heap.Inspect.html#Term"><span class="hs-identifier hs-type">Term</span></a></span><span class="hs-special">{</span><span class="annot"><span class="annottext">subTerms :: Term -&gt; [Term]
</span><a href="GHC.Runtime.Heap.Inspect.html#subTerms"><span class="hs-identifier hs-var">subTerms</span></a></span><span class="hs-glyph">=</span><span class="hs-special">[</span><span class="annot"><a href="GHC.Runtime.Heap.Inspect.html#Prim"><span class="hs-identifier hs-type">Prim</span></a></span><span class="hs-special">{</span><span class="annot"><span class="annottext">valRaw :: Term -&gt; [Word]
</span><a href="GHC.Runtime.Heap.Inspect.html#valRaw"><span class="hs-identifier hs-var">valRaw</span></a></span><span class="hs-glyph">=</span><span id="local-6989586621683022328"><span class="annot"><span class="annottext">[Word]
</span><a href="#local-6989586621683022328"><span class="hs-identifier hs-var">ws</span></a></span></span><span class="hs-special">}</span><span class="hs-special">]</span><span class="hs-special">}</span><span class="hs-special">]</span><span class="hs-special">}</span><span>
</span><span id="line-430"></span><span>      </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">DataCon
</span><a href="#local-6989586621683022327"><span class="hs-identifier hs-var">con</span></a></span><span> </span><span class="annot"><span class="annottext">DataCon -&gt; DataCon -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">==</span></span><span> </span><span class="annot"><span class="annottext">DataCon
</span><a href="GHC.Builtin.Types.html#naturalNBDataCon"><span class="hs-identifier hs-var">naturalNBDataCon</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Int -&gt; [Word] -&gt; m (Maybe SDoc)
</span><a href="#local-6989586621683022270"><span class="hs-identifier hs-var">ppr_bignat</span></a></span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">False</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621683022326"><span class="hs-identifier hs-var">p</span></a></span><span> </span><span class="annot"><span class="annottext">[Word]
</span><a href="#local-6989586621683022328"><span class="hs-identifier hs-var">ws</span></a></span><span>
</span><span id="line-431"></span><span>      </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">otherwise</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">String -&gt; m (Maybe SDoc)
forall a. HasCallStack =&gt; String -&gt; a
</span><a href="GHC.Utils.Panic.Plain.html#panic"><span class="hs-identifier hs-var">panic</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;Unexpected Natural constructor&quot;</span></span><span>
</span><span id="line-432"></span><span>   </span><span class="annot"><a href="#local-6989586621683022223"><span class="hs-identifier hs-var">ppr_natural</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">Term
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Maybe SDoc -&gt; m (Maybe SDoc)
forall a. a -&gt; m a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="annot"><span class="annottext">Maybe SDoc
forall a. Maybe a
</span><span class="hs-identifier hs-var">Nothing</span></span><span>
</span><span id="line-433"></span><span>
</span><span id="line-434"></span><span>   </span><span class="hs-comment">--Note pprinting of list terms is not lazy</span><span>
</span><span id="line-435"></span><span>   </span><span class="annot"><a href="#local-6989586621683022210"><span class="hs-identifier hs-type">ppr_list</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Runtime.Heap.Inspect.html#Precedence"><span class="hs-identifier hs-type">Precedence</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Runtime.Heap.Inspect.html#Term"><span class="hs-identifier hs-type">Term</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621683020870"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="annot"><a href="GHC.Utils.Outputable.html#SDoc"><span class="hs-identifier hs-type">SDoc</span></a></span><span>
</span><span id="line-436"></span><span>   </span><span id="local-6989586621683022210"><span class="annot"><span class="annottext">ppr_list :: TermPrinterM m
</span><a href="#local-6989586621683022210"><span class="hs-identifier hs-var hs-var">ppr_list</span></a></span></span><span> </span><span id="local-6989586621683022330"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621683022330"><span class="hs-identifier hs-var">p</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Runtime.Heap.Inspect.html#Term"><span class="hs-identifier hs-type">Term</span></a></span><span class="hs-special">{</span><span class="annot"><span class="annottext">subTerms :: Term -&gt; [Term]
</span><a href="GHC.Runtime.Heap.Inspect.html#subTerms"><span class="hs-identifier hs-var">subTerms</span></a></span><span class="hs-glyph">=</span><span class="hs-special">[</span><span id="local-6989586621683022331"><span class="annot"><span class="annottext">Term
</span><a href="#local-6989586621683022331"><span class="hs-identifier hs-var">h</span></a></span></span><span class="hs-special">,</span><span id="local-6989586621683022332"><span class="annot"><span class="annottext">Term
</span><a href="#local-6989586621683022332"><span class="hs-identifier hs-var">t</span></a></span></span><span class="hs-special">]</span><span class="hs-special">}</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-437"></span><span>       </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621683022333"><span class="annot"><span class="annottext">elems :: NonEmpty Term
</span><a href="#local-6989586621683022333"><span class="hs-identifier hs-var hs-var hs-var">elems</span></a></span></span><span>      </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Term
</span><a href="#local-6989586621683022331"><span class="hs-identifier hs-var">h</span></a></span><span> </span><span class="annot"><span class="annottext">Term -&gt; [Term] -&gt; NonEmpty Term
forall a. a -&gt; [a] -&gt; NonEmpty a
</span><span class="hs-operator hs-var">:|</span></span><span> </span><span class="annot"><span class="annottext">Term -&gt; [Term]
</span><a href="#local-6989586621683022335"><span class="hs-identifier hs-var">getListTerms</span></a></span><span> </span><span class="annot"><span class="annottext">Term
</span><a href="#local-6989586621683022332"><span class="hs-identifier hs-var">t</span></a></span><span>
</span><span id="line-438"></span><span>           </span><span id="local-6989586621683022336"><span class="annot"><span class="annottext">elemList :: [Item (NonEmpty Term)]
</span><a href="#local-6989586621683022336"><span class="hs-identifier hs-var hs-var hs-var">elemList</span></a></span></span><span>   </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">NonEmpty Term -&gt; [Item (NonEmpty Term)]
forall l. IsList l =&gt; l -&gt; [Item l]
</span><span class="hs-identifier hs-var">toList</span></span><span> </span><span class="annot"><span class="annottext">NonEmpty Term
</span><a href="#local-6989586621683022333"><span class="hs-identifier hs-var">elems</span></a></span><span>
</span><span id="line-439"></span><span>           </span><span id="local-6989586621683022337"><span class="annot"><span class="annottext">isConsLast :: Bool
</span><a href="#local-6989586621683022337"><span class="hs-identifier hs-var hs-var hs-var">isConsLast</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Bool
</span><span class="hs-identifier hs-var">not</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Term -&gt; Type
</span><a href="GHC.Runtime.Heap.Inspect.html#termType"><span class="hs-identifier hs-var">termType</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">NonEmpty Term -&gt; Term
forall a. NonEmpty a -&gt; a
</span><a href="../../base-4.21.0.0-ae91/src/Data.List.NonEmpty.html#last"><span class="hs-identifier hs-var">NE.last</span></a></span><span> </span><span class="annot"><span class="annottext">NonEmpty Term
</span><a href="#local-6989586621683022333"><span class="hs-identifier hs-var">elems</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">HasCallStack =&gt; Type -&gt; Type -&gt; Bool
Type -&gt; Type -&gt; Bool
</span><a href="GHC.Core.TyCo.Compare.html#eqType"><span class="hs-operator hs-var">`eqType`</span></a></span><span> </span><span class="annot"><span class="annottext">Term -&gt; Type
</span><a href="GHC.Runtime.Heap.Inspect.html#termType"><span class="hs-identifier hs-var">termType</span></a></span><span> </span><span class="annot"><span class="annottext">Term
</span><a href="#local-6989586621683022331"><span class="hs-identifier hs-var">h</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-440"></span><span>           </span><span id="local-6989586621683022340"><span class="annot"><span class="annottext">is_string :: Bool
</span><a href="#local-6989586621683022340"><span class="hs-identifier hs-var hs-var hs-var">is_string</span></a></span></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(Term -&gt; Bool) -&gt; NonEmpty Term -&gt; Bool
forall (t :: * -&gt; *) a. Foldable t =&gt; (a -&gt; Bool) -&gt; t a -&gt; Bool
</span><span class="hs-identifier hs-var">all</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Type -&gt; Bool
</span><a href="GHC.Tc.Utils.TcType.html#isCharTy"><span class="hs-identifier hs-var">isCharTy</span></a></span><span> </span><span class="annot"><span class="annottext">(Type -&gt; Bool) -&gt; (Term -&gt; Type) -&gt; Term -&gt; Bool
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">Term -&gt; Type
</span><a href="GHC.Runtime.Heap.Inspect.html#ty"><span class="hs-identifier hs-var">ty</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">NonEmpty Term
</span><a href="#local-6989586621683022333"><span class="hs-identifier hs-var">elems</span></a></span><span>
</span><span id="line-441"></span><span>           </span><span id="local-6989586621683022342"><span class="annot"><span class="annottext">chars :: String
</span><a href="#local-6989586621683022342"><span class="hs-identifier hs-var hs-var hs-var">chars</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">Int -&gt; Char
</span><span class="hs-identifier hs-var">chr</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Word -&gt; Int
forall a b. (Integral a, Num b) =&gt; a -&gt; b
</span><span class="hs-identifier hs-var">fromIntegral</span></span><span> </span><span class="annot"><span class="annottext">Word
</span><a href="#local-6989586621683022343"><span class="hs-identifier hs-var">w</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-442"></span><span>                   </span><span class="hs-glyph">|</span><span> </span><span class="annot"><a href="GHC.Runtime.Heap.Inspect.html#Term"><span class="hs-identifier hs-type">Term</span></a></span><span class="hs-special">{</span><span class="annot"><span class="annottext">subTerms :: Term -&gt; [Term]
</span><a href="GHC.Runtime.Heap.Inspect.html#subTerms"><span class="hs-identifier hs-var">subTerms</span></a></span><span class="hs-glyph">=</span><span class="hs-special">[</span><span class="annot"><a href="GHC.Runtime.Heap.Inspect.html#Prim"><span class="hs-identifier hs-type">Prim</span></a></span><span class="hs-special">{</span><span class="annot"><span class="annottext">valRaw :: Term -&gt; [Word]
</span><a href="GHC.Runtime.Heap.Inspect.html#valRaw"><span class="hs-identifier hs-var">valRaw</span></a></span><span class="hs-glyph">=</span><span class="hs-special">[</span><span id="local-6989586621683022343"><span class="annot"><span class="annottext">Word
</span><a href="#local-6989586621683022343"><span class="hs-identifier hs-var">w</span></a></span></span><span class="hs-special">]</span><span class="hs-special">}</span><span class="hs-special">]</span><span class="hs-special">}</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">[Item (NonEmpty Term)]
[Term]
</span><a href="#local-6989586621683022336"><span class="hs-identifier hs-var">elemList</span></a></span><span> </span><span class="hs-special">]</span><span>
</span><span id="line-443"></span><span>
</span><span id="line-444"></span><span>       </span><span id="local-6989586621683022344"><span class="annot"><a href="#local-6989586621683022344"><span class="hs-identifier hs-var">print_elems</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">(Term -&gt; m SDoc) -&gt; [Term] -&gt; m [SDoc]
forall (t :: * -&gt; *) (m :: * -&gt; *) a b.
(Traversable t, Monad m) =&gt;
(a -&gt; m b) -&gt; t a -&gt; m (t b)
forall (m :: * -&gt; *) a b. Monad m =&gt; (a -&gt; m b) -&gt; [a] -&gt; m [b]
</span><span class="hs-identifier hs-var">mapM</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TermPrinterM m
</span><a href="#local-6989586621683022199"><span class="hs-identifier hs-var">y</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="GHC.Runtime.Heap.Inspect.html#cons_prec"><span class="hs-identifier hs-var">cons_prec</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[Item (NonEmpty Term)]
[Term]
</span><a href="#local-6989586621683022336"><span class="hs-identifier hs-var">elemList</span></a></span><span>
</span><span id="line-445"></span><span>       </span><span class="hs-keyword">if</span><span> </span><span class="annot"><a href="#local-6989586621683022340"><span class="hs-identifier hs-type">is_string</span></a></span><span>
</span><span id="line-446"></span><span>        </span><span class="hs-keyword">then</span><span> </span><span class="annot"><span class="hs-identifier hs-type">return</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Utils.Outputable.html#doubleQuotes"><span class="hs-identifier hs-type">Ppr.doubleQuotes</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Utils.Outputable.html#text"><span class="hs-identifier hs-type">Ppr.text</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683022342"><span class="hs-identifier hs-type">chars</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-447"></span><span>        </span><span class="hs-keyword">else</span><span> </span><span class="hs-keyword">if</span><span> </span><span class="annot"><a href="#local-6989586621683022337"><span class="hs-identifier hs-type">isConsLast</span></a></span><span>
</span><span id="line-448"></span><span>        </span><span class="hs-keyword">then</span><span> </span><span class="annot"><span class="hs-identifier hs-type">return</span></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="annot"><a href="GHC.Utils.Outputable.html#cparen"><span class="hs-identifier hs-type">cparen</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621683022330"><span class="hs-identifier hs-type">p</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">&gt;=</span></span><span> </span><span class="annot"><a href="GHC.Runtime.Heap.Inspect.html#cons_prec"><span class="hs-identifier hs-type">cons_prec</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-449"></span><span>                    </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="annot"><a href="GHC.Utils.Outputable.html#pprDeeperList"><span class="hs-identifier hs-type">pprDeeperList</span></a></span><span> </span><span class="annot"><a href="GHC.Utils.Outputable.html#fsep"><span class="hs-identifier hs-type">fsep</span></a></span><span>
</span><span id="line-450"></span><span>                    </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="annot"><a href="GHC.Utils.Outputable.html#punctuate"><span class="hs-identifier hs-type">punctuate</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Utils.Outputable.html#space"><span class="hs-identifier hs-type">space</span></a></span><span class="annot"><a href="GHC.Utils.Outputable.html#%3C%3E"><span class="hs-operator hs-type">&lt;&gt;</span></a></span><span class="annot"><a href="GHC.Utils.Outputable.html#colon"><span class="hs-identifier hs-type">colon</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><a href="#local-6989586621683022344"><span class="hs-identifier hs-type">print_elems</span></a></span><span>
</span><span id="line-451"></span><span>        </span><span class="hs-keyword">else</span><span> </span><span class="annot"><span class="hs-identifier hs-type">return</span></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="annot"><a href="GHC.Utils.Outputable.html#brackets"><span class="hs-identifier hs-type">brackets</span></a></span><span>
</span><span id="line-452"></span><span>                    </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="annot"><a href="GHC.Utils.Outputable.html#pprDeeperList"><span class="hs-identifier hs-type">pprDeeperList</span></a></span><span> </span><span class="annot"><a href="GHC.Utils.Outputable.html#fcat"><span class="hs-identifier hs-type">fcat</span></a></span><span>
</span><span id="line-453"></span><span>                    </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="annot"><a href="GHC.Utils.Outputable.html#punctuate"><span class="hs-identifier hs-type">punctuate</span></a></span><span> </span><span class="annot"><a href="GHC.Utils.Outputable.html#comma"><span class="hs-identifier hs-type">comma</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683022344"><span class="hs-identifier hs-type">print_elems</span></a></span><span>
</span><span id="line-454"></span><span>
</span><span id="line-455"></span><span>        </span><span class="hs-keyword">where</span><span> </span><span id="local-6989586621683022335"><span class="annot"><span class="annottext">getListTerms :: Term -&gt; [Term]
</span><a href="#local-6989586621683022335"><span class="hs-identifier hs-var hs-var">getListTerms</span></a></span></span><span> </span><span class="annot"><a href="GHC.Runtime.Heap.Inspect.html#Term"><span class="hs-identifier hs-type">Term</span></a></span><span class="hs-special">{</span><span class="annot"><span class="annottext">subTerms :: Term -&gt; [Term]
</span><a href="GHC.Runtime.Heap.Inspect.html#subTerms"><span class="hs-identifier hs-var">subTerms</span></a></span><span class="hs-glyph">=</span><span class="hs-special">[</span><span id="local-6989586621683022353"><span class="annot"><span class="annottext">Term
</span><a href="#local-6989586621683022353"><span class="hs-identifier hs-var">h</span></a></span></span><span class="hs-special">,</span><span id="local-6989586621683022354"><span class="annot"><span class="annottext">Term
</span><a href="#local-6989586621683022354"><span class="hs-identifier hs-var">t</span></a></span></span><span class="hs-special">]</span><span class="hs-special">}</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Term
</span><a href="#local-6989586621683022353"><span class="hs-identifier hs-var">h</span></a></span><span> </span><span class="annot"><span class="annottext">Term -&gt; [Term] -&gt; [Term]
forall a. a -&gt; [a] -&gt; [a]
</span><span class="hs-glyph hs-var">:</span></span><span> </span><span class="annot"><span class="annottext">Term -&gt; [Term]
</span><a href="#local-6989586621683022335"><span class="hs-identifier hs-var">getListTerms</span></a></span><span> </span><span class="annot"><span class="annottext">Term
</span><a href="#local-6989586621683022354"><span class="hs-identifier hs-var">t</span></a></span><span>
</span><span id="line-456"></span><span>              </span><span class="annot"><a href="#local-6989586621683022335"><span class="hs-identifier hs-var">getListTerms</span></a></span><span> </span><span class="annot"><a href="GHC.Runtime.Heap.Inspect.html#Term"><span class="hs-identifier hs-type">Term</span></a></span><span class="hs-special">{</span><span class="annot"><span class="annottext">subTerms :: Term -&gt; [Term]
</span><a href="GHC.Runtime.Heap.Inspect.html#subTerms"><span class="hs-identifier hs-var">subTerms</span></a></span><span class="hs-glyph">=</span><span class="hs-special">[</span><span class="hs-special">]</span><span class="hs-special">}</span><span>    </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span>
</span><span id="line-457"></span><span>              </span><span class="annot"><a href="#local-6989586621683022335"><span class="hs-identifier hs-var">getListTerms</span></a></span><span> </span><span id="local-6989586621683022355"><span class="annot"><span class="annottext">t :: Term
</span><a href="#local-6989586621683022355"><span class="hs-identifier hs-var">t</span></a></span></span><span class="hs-glyph">@</span><span class="annot"><a href="GHC.Runtime.Heap.Inspect.html#Suspension"><span class="hs-identifier hs-type">Suspension</span></a></span><span class="hs-special">{</span><span class="hs-special">}</span><span>       </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">Term
</span><a href="#local-6989586621683022355"><span class="hs-identifier hs-var">t</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-458"></span><span>              </span><span class="annot"><a href="#local-6989586621683022335"><span class="hs-identifier hs-var">getListTerms</span></a></span><span> </span><span id="local-6989586621683022356"><span class="annot"><span class="annottext">Term
</span><a href="#local-6989586621683022356"><span class="hs-identifier hs-var">t</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">String -&gt; SDoc -&gt; [Term]
forall a. HasCallStack =&gt; String -&gt; SDoc -&gt; a
</span><a href="GHC.Utils.Panic.html#pprPanic"><span class="hs-identifier hs-var">pprPanic</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;getListTerms&quot;</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Term -&gt; SDoc
forall a. Outputable a =&gt; a -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="annot"><span class="annottext">Term
</span><a href="#local-6989586621683022356"><span class="hs-identifier hs-var">t</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-459"></span><span>   </span><span class="annot"><a href="#local-6989586621683022210"><span class="hs-identifier hs-var">ppr_list</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">Term
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">String -&gt; m SDoc
forall a. HasCallStack =&gt; String -&gt; a
</span><a href="GHC.Utils.Panic.Plain.html#panic"><span class="hs-identifier hs-var">panic</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;doList&quot;</span></span><span>
</span><span id="line-460"></span><span>
</span><span id="line-461"></span><span>
</span><span id="line-462"></span><span class="annot"><a href="GHC.Runtime.Heap.Inspect.html#repPrim"><span class="hs-identifier hs-type">repPrim</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Core.TyCon.html#TyCon"><span class="hs-identifier hs-type">TyCon</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><span class="hs-identifier hs-type">Word</span></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Utils.Outputable.html#SDoc"><span class="hs-identifier hs-type">SDoc</span></a></span><span>
</span><span id="line-463"></span><span id="repPrim"><span class="annot"><span class="annottext">repPrim :: TyCon -&gt; [Word] -&gt; SDoc
</span><a href="GHC.Runtime.Heap.Inspect.html#repPrim"><span class="hs-identifier hs-var hs-var">repPrim</span></a></span></span><span> </span><span id="local-6989586621683022358"><span class="annot"><span class="annottext">TyCon
</span><a href="#local-6989586621683022358"><span class="hs-identifier hs-var">t</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[Word] -&gt; SDoc
</span><a href="#local-6989586621683022359"><span class="hs-identifier hs-var">rep</span></a></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-464"></span><span>   </span><span id="local-6989586621683022359"><span class="annot"><span class="annottext">rep :: [Word] -&gt; SDoc
</span><a href="#local-6989586621683022359"><span class="hs-identifier hs-var hs-var">rep</span></a></span></span><span> </span><span id="local-6989586621683022360"><span class="annot"><span class="annottext">[Word]
</span><a href="#local-6989586621683022360"><span class="hs-identifier hs-var">x</span></a></span></span><span>
</span><span id="line-465"></span><span>    </span><span class="hs-comment">-- Char# uses native machine words, whereas Char's Storable instance uses</span><span>
</span><span id="line-466"></span><span>    </span><span class="hs-comment">-- Int32, so we have to read it as an Int.</span><span>
</span><span id="line-467"></span><span>    </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">TyCon
</span><a href="#local-6989586621683022358"><span class="hs-identifier hs-var">t</span></a></span><span> </span><span class="annot"><span class="annottext">TyCon -&gt; TyCon -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">==</span></span><span> </span><span class="annot"><span class="annottext">TyCon
</span><a href="GHC.Builtin.Types.Prim.html#charPrimTyCon"><span class="hs-identifier hs-var">charPrimTyCon</span></a></span><span>             </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">String -&gt; SDoc
forall doc. IsLine doc =&gt; String -&gt; doc
</span><a href="GHC.Utils.Outputable.html#text"><span class="hs-identifier hs-var">text</span></a></span><span> </span><span class="annot"><span class="annottext">(String -&gt; SDoc) -&gt; String -&gt; SDoc
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Char -&gt; String
forall a. Show a =&gt; a -&gt; String
</span><span class="hs-identifier hs-var">show</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int -&gt; Char
</span><span class="hs-identifier hs-var">chr</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[Word] -&gt; Int
forall {a} {b}. (Storable a, Storable b) =&gt; [a] -&gt; b
</span><a href="#local-6989586621683022362"><span class="hs-identifier hs-var">build</span></a></span><span> </span><span class="annot"><span class="annottext">[Word]
</span><a href="#local-6989586621683022360"><span class="hs-identifier hs-var">x</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Int</span></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-468"></span><span>    </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">TyCon
</span><a href="#local-6989586621683022358"><span class="hs-identifier hs-var">t</span></a></span><span> </span><span class="annot"><span class="annottext">TyCon -&gt; TyCon -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">==</span></span><span> </span><span class="annot"><span class="annottext">TyCon
</span><a href="GHC.Builtin.Types.Prim.html#intPrimTyCon"><span class="hs-identifier hs-var">intPrimTyCon</span></a></span><span>              </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">String -&gt; SDoc
forall doc. IsLine doc =&gt; String -&gt; doc
</span><a href="GHC.Utils.Outputable.html#text"><span class="hs-identifier hs-var">text</span></a></span><span> </span><span class="annot"><span class="annottext">(String -&gt; SDoc) -&gt; String -&gt; SDoc
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Int -&gt; String
forall a. Show a =&gt; a -&gt; String
</span><span class="hs-identifier hs-var">show</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[Word] -&gt; Int
forall {a} {b}. (Storable a, Storable b) =&gt; [a] -&gt; b
</span><a href="#local-6989586621683022362"><span class="hs-identifier hs-var">build</span></a></span><span> </span><span class="annot"><span class="annottext">[Word]
</span><a href="#local-6989586621683022360"><span class="hs-identifier hs-var">x</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Int</span></span><span class="hs-special">)</span><span>
</span><span id="line-469"></span><span>    </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">TyCon
</span><a href="#local-6989586621683022358"><span class="hs-identifier hs-var">t</span></a></span><span> </span><span class="annot"><span class="annottext">TyCon -&gt; TyCon -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">==</span></span><span> </span><span class="annot"><span class="annottext">TyCon
</span><a href="GHC.Builtin.Types.Prim.html#wordPrimTyCon"><span class="hs-identifier hs-var">wordPrimTyCon</span></a></span><span>             </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">String -&gt; SDoc
forall doc. IsLine doc =&gt; String -&gt; doc
</span><a href="GHC.Utils.Outputable.html#text"><span class="hs-identifier hs-var">text</span></a></span><span> </span><span class="annot"><span class="annottext">(String -&gt; SDoc) -&gt; String -&gt; SDoc
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Word -&gt; String
forall a. Show a =&gt; a -&gt; String
</span><span class="hs-identifier hs-var">show</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[Word] -&gt; Word
forall {a} {b}. (Storable a, Storable b) =&gt; [a] -&gt; b
</span><a href="#local-6989586621683022362"><span class="hs-identifier hs-var">build</span></a></span><span> </span><span class="annot"><span class="annottext">[Word]
</span><a href="#local-6989586621683022360"><span class="hs-identifier hs-var">x</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Word</span></span><span class="hs-special">)</span><span>
</span><span id="line-470"></span><span>    </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">TyCon
</span><a href="#local-6989586621683022358"><span class="hs-identifier hs-var">t</span></a></span><span> </span><span class="annot"><span class="annottext">TyCon -&gt; TyCon -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">==</span></span><span> </span><span class="annot"><span class="annottext">TyCon
</span><a href="GHC.Builtin.Types.Prim.html#floatPrimTyCon"><span class="hs-identifier hs-var">floatPrimTyCon</span></a></span><span>            </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">String -&gt; SDoc
forall doc. IsLine doc =&gt; String -&gt; doc
</span><a href="GHC.Utils.Outputable.html#text"><span class="hs-identifier hs-var">text</span></a></span><span> </span><span class="annot"><span class="annottext">(String -&gt; SDoc) -&gt; String -&gt; SDoc
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Float -&gt; String
forall a. Show a =&gt; a -&gt; String
</span><span class="hs-identifier hs-var">show</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[Word] -&gt; Float
forall {a} {b}. (Storable a, Storable b) =&gt; [a] -&gt; b
</span><a href="#local-6989586621683022362"><span class="hs-identifier hs-var">build</span></a></span><span> </span><span class="annot"><span class="annottext">[Word]
</span><a href="#local-6989586621683022360"><span class="hs-identifier hs-var">x</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Float</span></span><span class="hs-special">)</span><span>
</span><span id="line-471"></span><span>    </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">TyCon
</span><a href="#local-6989586621683022358"><span class="hs-identifier hs-var">t</span></a></span><span> </span><span class="annot"><span class="annottext">TyCon -&gt; TyCon -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">==</span></span><span> </span><span class="annot"><span class="annottext">TyCon
</span><a href="GHC.Builtin.Types.Prim.html#doublePrimTyCon"><span class="hs-identifier hs-var">doublePrimTyCon</span></a></span><span>           </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">String -&gt; SDoc
forall doc. IsLine doc =&gt; String -&gt; doc
</span><a href="GHC.Utils.Outputable.html#text"><span class="hs-identifier hs-var">text</span></a></span><span> </span><span class="annot"><span class="annottext">(String -&gt; SDoc) -&gt; String -&gt; SDoc
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Double -&gt; String
forall a. Show a =&gt; a -&gt; String
</span><span class="hs-identifier hs-var">show</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[Word] -&gt; Double
forall {a} {b}. (Storable a, Storable b) =&gt; [a] -&gt; b
</span><a href="#local-6989586621683022362"><span class="hs-identifier hs-var">build</span></a></span><span> </span><span class="annot"><span class="annottext">[Word]
</span><a href="#local-6989586621683022360"><span class="hs-identifier hs-var">x</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Double</span></span><span class="hs-special">)</span><span>
</span><span id="line-472"></span><span>    </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">TyCon
</span><a href="#local-6989586621683022358"><span class="hs-identifier hs-var">t</span></a></span><span> </span><span class="annot"><span class="annottext">TyCon -&gt; TyCon -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">==</span></span><span> </span><span class="annot"><span class="annottext">TyCon
</span><a href="GHC.Builtin.Types.Prim.html#int8PrimTyCon"><span class="hs-identifier hs-var">int8PrimTyCon</span></a></span><span>             </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">String -&gt; SDoc
forall doc. IsLine doc =&gt; String -&gt; doc
</span><a href="GHC.Utils.Outputable.html#text"><span class="hs-identifier hs-var">text</span></a></span><span> </span><span class="annot"><span class="annottext">(String -&gt; SDoc) -&gt; String -&gt; SDoc
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Int8 -&gt; String
forall a. Show a =&gt; a -&gt; String
</span><span class="hs-identifier hs-var">show</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[Word] -&gt; Int8
forall {a} {b}. (Storable a, Storable b) =&gt; [a] -&gt; b
</span><a href="#local-6989586621683022362"><span class="hs-identifier hs-var">build</span></a></span><span> </span><span class="annot"><span class="annottext">[Word]
</span><a href="#local-6989586621683022360"><span class="hs-identifier hs-var">x</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Int8</span></span><span class="hs-special">)</span><span>
</span><span id="line-473"></span><span>    </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">TyCon
</span><a href="#local-6989586621683022358"><span class="hs-identifier hs-var">t</span></a></span><span> </span><span class="annot"><span class="annottext">TyCon -&gt; TyCon -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">==</span></span><span> </span><span class="annot"><span class="annottext">TyCon
</span><a href="GHC.Builtin.Types.Prim.html#word8PrimTyCon"><span class="hs-identifier hs-var">word8PrimTyCon</span></a></span><span>            </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">String -&gt; SDoc
forall doc. IsLine doc =&gt; String -&gt; doc
</span><a href="GHC.Utils.Outputable.html#text"><span class="hs-identifier hs-var">text</span></a></span><span> </span><span class="annot"><span class="annottext">(String -&gt; SDoc) -&gt; String -&gt; SDoc
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Word8 -&gt; String
forall a. Show a =&gt; a -&gt; String
</span><span class="hs-identifier hs-var">show</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[Word] -&gt; Word8
forall {a} {b}. (Storable a, Storable b) =&gt; [a] -&gt; b
</span><a href="#local-6989586621683022362"><span class="hs-identifier hs-var">build</span></a></span><span> </span><span class="annot"><span class="annottext">[Word]
</span><a href="#local-6989586621683022360"><span class="hs-identifier hs-var">x</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Word8</span></span><span class="hs-special">)</span><span>
</span><span id="line-474"></span><span>    </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">TyCon
</span><a href="#local-6989586621683022358"><span class="hs-identifier hs-var">t</span></a></span><span> </span><span class="annot"><span class="annottext">TyCon -&gt; TyCon -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">==</span></span><span> </span><span class="annot"><span class="annottext">TyCon
</span><a href="GHC.Builtin.Types.Prim.html#int16PrimTyCon"><span class="hs-identifier hs-var">int16PrimTyCon</span></a></span><span>            </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">String -&gt; SDoc
forall doc. IsLine doc =&gt; String -&gt; doc
</span><a href="GHC.Utils.Outputable.html#text"><span class="hs-identifier hs-var">text</span></a></span><span> </span><span class="annot"><span class="annottext">(String -&gt; SDoc) -&gt; String -&gt; SDoc
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Int16 -&gt; String
forall a. Show a =&gt; a -&gt; String
</span><span class="hs-identifier hs-var">show</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[Word] -&gt; Int16
forall {a} {b}. (Storable a, Storable b) =&gt; [a] -&gt; b
</span><a href="#local-6989586621683022362"><span class="hs-identifier hs-var">build</span></a></span><span> </span><span class="annot"><span class="annottext">[Word]
</span><a href="#local-6989586621683022360"><span class="hs-identifier hs-var">x</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Int16</span></span><span class="hs-special">)</span><span>
</span><span id="line-475"></span><span>    </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">TyCon
</span><a href="#local-6989586621683022358"><span class="hs-identifier hs-var">t</span></a></span><span> </span><span class="annot"><span class="annottext">TyCon -&gt; TyCon -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">==</span></span><span> </span><span class="annot"><span class="annottext">TyCon
</span><a href="GHC.Builtin.Types.Prim.html#word16PrimTyCon"><span class="hs-identifier hs-var">word16PrimTyCon</span></a></span><span>           </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">String -&gt; SDoc
forall doc. IsLine doc =&gt; String -&gt; doc
</span><a href="GHC.Utils.Outputable.html#text"><span class="hs-identifier hs-var">text</span></a></span><span> </span><span class="annot"><span class="annottext">(String -&gt; SDoc) -&gt; String -&gt; SDoc
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Word16 -&gt; String
forall a. Show a =&gt; a -&gt; String
</span><span class="hs-identifier hs-var">show</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[Word] -&gt; Word16
forall {a} {b}. (Storable a, Storable b) =&gt; [a] -&gt; b
</span><a href="#local-6989586621683022362"><span class="hs-identifier hs-var">build</span></a></span><span> </span><span class="annot"><span class="annottext">[Word]
</span><a href="#local-6989586621683022360"><span class="hs-identifier hs-var">x</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Word16</span></span><span class="hs-special">)</span><span>
</span><span id="line-476"></span><span>    </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">TyCon
</span><a href="#local-6989586621683022358"><span class="hs-identifier hs-var">t</span></a></span><span> </span><span class="annot"><span class="annottext">TyCon -&gt; TyCon -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">==</span></span><span> </span><span class="annot"><span class="annottext">TyCon
</span><a href="GHC.Builtin.Types.Prim.html#int32PrimTyCon"><span class="hs-identifier hs-var">int32PrimTyCon</span></a></span><span>            </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">String -&gt; SDoc
forall doc. IsLine doc =&gt; String -&gt; doc
</span><a href="GHC.Utils.Outputable.html#text"><span class="hs-identifier hs-var">text</span></a></span><span> </span><span class="annot"><span class="annottext">(String -&gt; SDoc) -&gt; String -&gt; SDoc
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Int32 -&gt; String
forall a. Show a =&gt; a -&gt; String
</span><span class="hs-identifier hs-var">show</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[Word] -&gt; Int32
forall {a} {b}. (Storable a, Storable b) =&gt; [a] -&gt; b
</span><a href="#local-6989586621683022362"><span class="hs-identifier hs-var">build</span></a></span><span> </span><span class="annot"><span class="annottext">[Word]
</span><a href="#local-6989586621683022360"><span class="hs-identifier hs-var">x</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Int32</span></span><span class="hs-special">)</span><span>
</span><span id="line-477"></span><span>    </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">TyCon
</span><a href="#local-6989586621683022358"><span class="hs-identifier hs-var">t</span></a></span><span> </span><span class="annot"><span class="annottext">TyCon -&gt; TyCon -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">==</span></span><span> </span><span class="annot"><span class="annottext">TyCon
</span><a href="GHC.Builtin.Types.Prim.html#word32PrimTyCon"><span class="hs-identifier hs-var">word32PrimTyCon</span></a></span><span>           </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">String -&gt; SDoc
forall doc. IsLine doc =&gt; String -&gt; doc
</span><a href="GHC.Utils.Outputable.html#text"><span class="hs-identifier hs-var">text</span></a></span><span> </span><span class="annot"><span class="annottext">(String -&gt; SDoc) -&gt; String -&gt; SDoc
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Word32 -&gt; String
forall a. Show a =&gt; a -&gt; String
</span><span class="hs-identifier hs-var">show</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[Word] -&gt; Word32
forall {a} {b}. (Storable a, Storable b) =&gt; [a] -&gt; b
</span><a href="#local-6989586621683022362"><span class="hs-identifier hs-var">build</span></a></span><span> </span><span class="annot"><span class="annottext">[Word]
</span><a href="#local-6989586621683022360"><span class="hs-identifier hs-var">x</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Word32</span></span><span class="hs-special">)</span><span>
</span><span id="line-478"></span><span>    </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">TyCon
</span><a href="#local-6989586621683022358"><span class="hs-identifier hs-var">t</span></a></span><span> </span><span class="annot"><span class="annottext">TyCon -&gt; TyCon -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">==</span></span><span> </span><span class="annot"><span class="annottext">TyCon
</span><a href="GHC.Builtin.Types.Prim.html#int64PrimTyCon"><span class="hs-identifier hs-var">int64PrimTyCon</span></a></span><span>            </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">String -&gt; SDoc
forall doc. IsLine doc =&gt; String -&gt; doc
</span><a href="GHC.Utils.Outputable.html#text"><span class="hs-identifier hs-var">text</span></a></span><span> </span><span class="annot"><span class="annottext">(String -&gt; SDoc) -&gt; String -&gt; SDoc
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Int64 -&gt; String
forall a. Show a =&gt; a -&gt; String
</span><span class="hs-identifier hs-var">show</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[Word] -&gt; Int64
forall {a} {b}. (Storable a, Storable b) =&gt; [a] -&gt; b
</span><a href="#local-6989586621683022362"><span class="hs-identifier hs-var">build</span></a></span><span> </span><span class="annot"><span class="annottext">[Word]
</span><a href="#local-6989586621683022360"><span class="hs-identifier hs-var">x</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Int64</span></span><span class="hs-special">)</span><span>
</span><span id="line-479"></span><span>    </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">TyCon
</span><a href="#local-6989586621683022358"><span class="hs-identifier hs-var">t</span></a></span><span> </span><span class="annot"><span class="annottext">TyCon -&gt; TyCon -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">==</span></span><span> </span><span class="annot"><span class="annottext">TyCon
</span><a href="GHC.Builtin.Types.Prim.html#word64PrimTyCon"><span class="hs-identifier hs-var">word64PrimTyCon</span></a></span><span>           </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">String -&gt; SDoc
forall doc. IsLine doc =&gt; String -&gt; doc
</span><a href="GHC.Utils.Outputable.html#text"><span class="hs-identifier hs-var">text</span></a></span><span> </span><span class="annot"><span class="annottext">(String -&gt; SDoc) -&gt; String -&gt; SDoc
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Word64 -&gt; String
forall a. Show a =&gt; a -&gt; String
</span><span class="hs-identifier hs-var">show</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[Word] -&gt; Word64
forall {a} {b}. (Storable a, Storable b) =&gt; [a] -&gt; b
</span><a href="#local-6989586621683022362"><span class="hs-identifier hs-var">build</span></a></span><span> </span><span class="annot"><span class="annottext">[Word]
</span><a href="#local-6989586621683022360"><span class="hs-identifier hs-var">x</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Word64</span></span><span class="hs-special">)</span><span>
</span><span id="line-480"></span><span>    </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">TyCon
</span><a href="#local-6989586621683022358"><span class="hs-identifier hs-var">t</span></a></span><span> </span><span class="annot"><span class="annottext">TyCon -&gt; TyCon -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">==</span></span><span> </span><span class="annot"><span class="annottext">TyCon
</span><a href="GHC.Builtin.Types.Prim.html#addrPrimTyCon"><span class="hs-identifier hs-var">addrPrimTyCon</span></a></span><span>             </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">String -&gt; SDoc
forall doc. IsLine doc =&gt; String -&gt; doc
</span><a href="GHC.Utils.Outputable.html#text"><span class="hs-identifier hs-var">text</span></a></span><span> </span><span class="annot"><span class="annottext">(String -&gt; SDoc) -&gt; String -&gt; SDoc
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Ptr (ZonkAny 0) -&gt; String
forall a. Show a =&gt; a -&gt; String
</span><span class="hs-identifier hs-var">show</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Ptr (ZonkAny 1)
forall a. Ptr a
</span><span class="hs-identifier hs-var">nullPtr</span></span><span> </span><span class="annot"><span class="annottext">Ptr (ZonkAny 1) -&gt; Int -&gt; Ptr (ZonkAny 0)
forall a b. Ptr a -&gt; Int -&gt; Ptr b
</span><span class="hs-operator hs-var">`plusPtr`</span></span><span> </span><span class="annot"><span class="annottext">[Word] -&gt; Int
forall {a} {b}. (Storable a, Storable b) =&gt; [a] -&gt; b
</span><a href="#local-6989586621683022362"><span class="hs-identifier hs-var">build</span></a></span><span> </span><span class="annot"><span class="annottext">[Word]
</span><a href="#local-6989586621683022360"><span class="hs-identifier hs-var">x</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-481"></span><span>    </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">otherwise</span></span><span>                      </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Char -&gt; SDoc
forall doc. IsLine doc =&gt; Char -&gt; doc
</span><a href="GHC.Utils.Outputable.html#char"><span class="hs-identifier hs-var">char</span></a></span><span> </span><span class="annot"><span class="annottext">Char
</span><span class="hs-char">'&lt;'</span></span><span> </span><span class="annot"><span class="annottext">SDoc -&gt; SDoc -&gt; SDoc
forall doc. IsLine doc =&gt; doc -&gt; doc -&gt; doc
</span><a href="GHC.Utils.Outputable.html#%3C%3E"><span class="hs-operator hs-var">&lt;&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">TyCon -&gt; SDoc
forall a. Outputable a =&gt; a -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="annot"><span class="annottext">TyCon
</span><a href="#local-6989586621683022358"><span class="hs-identifier hs-var">t</span></a></span><span> </span><span class="annot"><span class="annottext">SDoc -&gt; SDoc -&gt; SDoc
forall doc. IsLine doc =&gt; doc -&gt; doc -&gt; doc
</span><a href="GHC.Utils.Outputable.html#%3C%3E"><span class="hs-operator hs-var">&lt;&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">Char -&gt; SDoc
forall doc. IsLine doc =&gt; Char -&gt; doc
</span><a href="GHC.Utils.Outputable.html#char"><span class="hs-identifier hs-var">char</span></a></span><span> </span><span class="annot"><span class="annottext">Char
</span><span class="hs-char">'&gt;'</span></span><span>
</span><span id="line-482"></span><span>    </span><span class="hs-keyword">where</span><span> </span><span id="local-6989586621683022362"><span class="annot"><span class="annottext">build :: [a] -&gt; b
</span><a href="#local-6989586621683022362"><span class="hs-identifier hs-var hs-var">build</span></a></span></span><span> </span><span id="local-6989586621683022381"><span class="annot"><span class="annottext">[a]
</span><a href="#local-6989586621683022381"><span class="hs-identifier hs-var">ww</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">IO b -&gt; b
forall a. IO a -&gt; a
</span><span class="hs-identifier hs-var">unsafePerformIO</span></span><span> </span><span class="annot"><span class="annottext">(IO b -&gt; b) -&gt; IO b -&gt; b
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">[a] -&gt; (Ptr a -&gt; IO b) -&gt; IO b
forall a b. Storable a =&gt; [a] -&gt; (Ptr a -&gt; IO b) -&gt; IO b
</span><span class="hs-identifier hs-var">withArray</span></span><span> </span><span class="annot"><span class="annottext">[a]
</span><a href="#local-6989586621683022381"><span class="hs-identifier hs-var">ww</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Ptr b -&gt; IO b
forall a. Storable a =&gt; Ptr a -&gt; IO a
</span><span class="hs-identifier hs-var">peek</span></span><span> </span><span class="annot"><span class="annottext">(Ptr b -&gt; IO b) -&gt; (Ptr a -&gt; Ptr b) -&gt; Ptr a -&gt; IO b
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">Ptr a -&gt; Ptr b
forall a b. Ptr a -&gt; Ptr b
</span><span class="hs-identifier hs-var">castPtr</span></span><span class="hs-special">)</span><span>
</span><span id="line-483"></span><span class="hs-comment">--   This ^^^ relies on the representation of Haskell heap values being</span><span>
</span><span id="line-484"></span><span class="hs-comment">--   the same as in a C array.</span><span>
</span><span id="line-485"></span><span>
</span><span id="line-486"></span><span class="hs-comment">-----------------------------------</span><span>
</span><span id="line-487"></span><span class="hs-comment">-- Type Reconstruction</span><span>
</span><span id="line-488"></span><span class="hs-comment">-----------------------------------</span><span>
</span><span id="line-489"></span><span class="hs-comment">{-
Type Reconstruction is type inference done on heap closures.
The algorithm walks the heap generating a set of equations, which
are solved with syntactic unification.
A type reconstruction equation looks like:

  &lt;datacon reptype&gt;  =  &lt;actual heap contents&gt;

The full equation set is generated by traversing all the subterms, starting
from a given term.

The only difficult part is that newtypes are only found in the lhs of equations.
Right hand sides are missing them. We can either (a) drop them from the lhs, or
(b) reconstruct them in the rhs when possible.

The function congruenceNewtypes takes a shot at (b)
-}</span><span>
</span><span id="line-506"></span><span>
</span><span id="line-507"></span><span>
</span><span id="line-508"></span><span class="hs-comment">-- See Note [RttiType]</span><span>
</span><span id="line-509"></span><span class="hs-keyword">type</span><span> </span><span id="RttiType"><span class="annot"><a href="GHC.Runtime.Heap.Inspect.html#RttiType"><span class="hs-identifier hs-var">RttiType</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#Type"><span class="hs-identifier hs-type">Type</span></a></span><span>
</span><span id="line-510"></span><span>
</span><span id="line-511"></span><span class="hs-comment">-- An incomplete type as stored in GHCi:</span><span>
</span><span id="line-512"></span><span class="hs-comment">--  no polymorphism: no quantifiers &amp; all tyvars are skolem.</span><span>
</span><span id="line-513"></span><span class="hs-keyword">type</span><span> </span><span id="GhciType"><span class="annot"><a href="GHC.Runtime.Heap.Inspect.html#GhciType"><span class="hs-identifier hs-var">GhciType</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#Type"><span class="hs-identifier hs-type">Type</span></a></span><span>
</span><span id="line-514"></span><span>
</span><span id="line-515"></span><span>
</span><span id="line-516"></span><span class="hs-comment">-- The Type Reconstruction monad</span><span>
</span><span id="line-517"></span><span class="hs-comment">--------------------------------</span><span>
</span><span id="line-518"></span><span class="hs-keyword">type</span><span> </span><span id="TR"><span class="annot"><a href="GHC.Runtime.Heap.Inspect.html#TR"><span class="hs-identifier hs-var">TR</span></a></span></span><span> </span><span id="local-6989586621683022385"><span class="annot"><a href="#local-6989586621683022385"><span class="hs-identifier hs-type">a</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#TcM"><span class="hs-identifier hs-type">TcM</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683022385"><span class="hs-identifier hs-type">a</span></a></span><span>
</span><span id="line-519"></span><span>
</span><span id="line-520"></span><span id="local-6989586621683021015"><span class="annot"><a href="GHC.Runtime.Heap.Inspect.html#runTR"><span class="hs-identifier hs-type">runTR</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Driver.Env.Types.html#HscEnv"><span class="hs-identifier hs-type">HscEnv</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Runtime.Heap.Inspect.html#TR"><span class="hs-identifier hs-type">TR</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683021015"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="annot"><a href="#local-6989586621683021015"><span class="hs-identifier hs-type">a</span></a></span></span><span>
</span><span id="line-521"></span><span id="runTR"><span class="annot"><span class="annottext">runTR :: forall a. HscEnv -&gt; TR a -&gt; IO a
</span><a href="GHC.Runtime.Heap.Inspect.html#runTR"><span class="hs-identifier hs-var hs-var">runTR</span></a></span></span><span> </span><span id="local-6989586621683022391"><span class="annot"><span class="annottext">HscEnv
</span><a href="#local-6989586621683022391"><span class="hs-identifier hs-var">hsc_env</span></a></span></span><span> </span><span id="local-6989586621683022392"><span class="annot"><span class="annottext">TR a
</span><a href="#local-6989586621683022392"><span class="hs-identifier hs-var">thing</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-522"></span><span>  </span><span id="local-6989586621683022393"><span class="annot"><a href="#local-6989586621683022393"><span class="hs-identifier hs-var">mb_val</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">HscEnv -&gt; TR a -&gt; IO (Maybe a)
forall a. HscEnv -&gt; TR a -&gt; IO (Maybe a)
</span><a href="GHC.Runtime.Heap.Inspect.html#runTR_maybe"><span class="hs-identifier hs-var">runTR_maybe</span></a></span><span> </span><span class="annot"><span class="annottext">HscEnv
</span><a href="#local-6989586621683022391"><span class="hs-identifier hs-var">hsc_env</span></a></span><span> </span><span class="annot"><span class="annottext">TR a
</span><a href="#local-6989586621683022392"><span class="hs-identifier hs-var">thing</span></a></span><span>
</span><span id="line-523"></span><span>  </span><span class="hs-keyword">case</span><span> </span><span class="annot"><a href="#local-6989586621683022393"><span class="hs-identifier hs-type">mb_val</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-524"></span><span>    </span><span class="annot"><span class="annottext">Maybe a
</span><span class="hs-identifier hs-var">Nothing</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">String -&gt; IO a
forall a. HasCallStack =&gt; String -&gt; a
</span><span class="hs-identifier hs-var">error</span></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;unable to :print the term&quot;</span></span><span>
</span><span id="line-525"></span><span>    </span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span id="local-6989586621683022396"><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621683022396"><span class="hs-identifier hs-var">x</span></a></span></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">a -&gt; IO a
forall a. a -&gt; IO a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621683022396"><span class="hs-identifier hs-var">x</span></a></span><span>
</span><span id="line-526"></span><span>
</span><span id="line-527"></span><span id="local-6989586621683021018"><span class="annot"><a href="GHC.Runtime.Heap.Inspect.html#runTR_maybe"><span class="hs-identifier hs-type">runTR_maybe</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Driver.Env.Types.html#HscEnv"><span class="hs-identifier hs-type">HscEnv</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Runtime.Heap.Inspect.html#TR"><span class="hs-identifier hs-type">TR</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683021018"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Maybe</span></span><span> </span><span class="annot"><a href="#local-6989586621683021018"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">)</span></span><span>
</span><span id="line-528"></span><span id="runTR_maybe"><span class="annot"><span class="annottext">runTR_maybe :: forall a. HscEnv -&gt; TR a -&gt; IO (Maybe a)
</span><a href="GHC.Runtime.Heap.Inspect.html#runTR_maybe"><span class="hs-identifier hs-var hs-var">runTR_maybe</span></a></span></span><span> </span><span id="local-6989586621683022399"><span class="annot"><span class="annottext">HscEnv
</span><a href="#local-6989586621683022399"><span class="hs-identifier hs-var">hsc_env</span></a></span></span><span> </span><span id="local-6989586621683022400"><span class="annot"><span class="annottext">TR a
</span><a href="#local-6989586621683022400"><span class="hs-identifier hs-var">thing_inside</span></a></span></span><span>
</span><span id="line-529"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span class="hs-special">(</span><span id="local-6989586621683022401"><span class="annot"><a href="#local-6989586621683022401"><span class="hs-identifier hs-var">_errs</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621683022402"><span class="annot"><a href="#local-6989586621683022402"><span class="hs-identifier hs-var">res</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">HscEnv -&gt; TR a -&gt; IO (Messages TcRnMessage, Maybe a)
forall a. HscEnv -&gt; TcM a -&gt; IO (Messages TcRnMessage, Maybe a)
</span><a href="GHC.Tc.Utils.Monad.html#initTcInteractive"><span class="hs-identifier hs-var">initTcInteractive</span></a></span><span> </span><span class="annot"><span class="annottext">HscEnv
</span><a href="#local-6989586621683022399"><span class="hs-identifier hs-var">hsc_env</span></a></span><span> </span><span class="annot"><span class="annottext">TR a
</span><a href="#local-6989586621683022400"><span class="hs-identifier hs-var">thing_inside</span></a></span><span>
</span><span id="line-530"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">return</span></span><span> </span><span class="annot"><a href="#local-6989586621683022402"><span class="hs-identifier hs-type">res</span></a></span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-531"></span><span>
</span><span id="line-532"></span><span class="annot"><span class="hs-comment">-- | Term Reconstruction trace</span></span><span>
</span><span id="line-533"></span><span class="annot"><a href="GHC.Runtime.Heap.Inspect.html#traceTR"><span class="hs-identifier hs-type">traceTR</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Utils.Outputable.html#SDoc"><span class="hs-identifier hs-type">SDoc</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Runtime.Heap.Inspect.html#TR"><span class="hs-identifier hs-type">TR</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-534"></span><span id="traceTR"><span class="annot"><span class="annottext">traceTR :: SDoc -&gt; TR ()
</span><a href="GHC.Runtime.Heap.Inspect.html#traceTR"><span class="hs-identifier hs-var hs-var">traceTR</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">TR () -&gt; TR ()
forall a. TcM a -&gt; TcM a
</span><a href="GHC.Runtime.Heap.Inspect.html#liftTcM"><span class="hs-identifier hs-var">liftTcM</span></a></span><span> </span><span class="annot"><span class="annottext">(TR () -&gt; TR ()) -&gt; (SDoc -&gt; TR ()) -&gt; SDoc -&gt; TR ()
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">DumpFlag -&gt; SDoc -&gt; TR ()
</span><a href="GHC.Tc.Utils.Monad.html#traceOptTcRn"><span class="hs-identifier hs-var">traceOptTcRn</span></a></span><span> </span><span class="annot"><span class="annottext">DumpFlag
</span><a href="GHC.Driver.Flags.html#Opt_D_dump_rtti"><span class="hs-identifier hs-var">Opt_D_dump_rtti</span></a></span><span>
</span><span id="line-535"></span><span>
</span><span id="line-536"></span><span>
</span><span id="line-537"></span><span class="hs-comment">-- Semantically different to recoverM in GHC.Tc.Utils.Monad</span><span>
</span><span id="line-538"></span><span class="hs-comment">-- recoverM retains the errors in the first action,</span><span>
</span><span id="line-539"></span><span class="hs-comment">--  whereas recoverTc here does not</span><span>
</span><span id="line-540"></span><span id="local-6989586621683021027"><span class="annot"><a href="GHC.Runtime.Heap.Inspect.html#recoverTR"><span class="hs-identifier hs-type">recoverTR</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Runtime.Heap.Inspect.html#TR"><span class="hs-identifier hs-type">TR</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683021027"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Runtime.Heap.Inspect.html#TR"><span class="hs-identifier hs-type">TR</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683021027"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Runtime.Heap.Inspect.html#TR"><span class="hs-identifier hs-type">TR</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683021027"><span class="hs-identifier hs-type">a</span></a></span></span><span>
</span><span id="line-541"></span><span id="recoverTR"><span class="annot"><span class="annottext">recoverTR :: forall a. TR a -&gt; TR a -&gt; TR a
</span><a href="GHC.Runtime.Heap.Inspect.html#recoverTR"><span class="hs-identifier hs-var hs-var">recoverTR</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">TcM a -&gt; TcM a -&gt; TcM a
forall a. TR a -&gt; TR a -&gt; TR a
</span><a href="GHC.Tc.Utils.Monad.html#tryTcDiscardingErrs"><span class="hs-identifier hs-var">tryTcDiscardingErrs</span></a></span><span>
</span><span id="line-542"></span><span>
</span><span id="line-543"></span><span id="local-6989586621683021029"><span class="annot"><a href="GHC.Runtime.Heap.Inspect.html#trIO"><span class="hs-identifier hs-type">trIO</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="annot"><a href="#local-6989586621683021029"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Runtime.Heap.Inspect.html#TR"><span class="hs-identifier hs-type">TR</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683021029"><span class="hs-identifier hs-type">a</span></a></span></span><span>
</span><span id="line-544"></span><span id="trIO"><span class="annot"><span class="annottext">trIO :: forall a. IO a -&gt; TR a
</span><a href="GHC.Runtime.Heap.Inspect.html#trIO"><span class="hs-identifier hs-var hs-var">trIO</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">TcM a -&gt; TcM a
forall a. TcM a -&gt; TcM a
</span><a href="GHC.Runtime.Heap.Inspect.html#liftTcM"><span class="hs-identifier hs-var">liftTcM</span></a></span><span> </span><span class="annot"><span class="annottext">(TcM a -&gt; TcM a) -&gt; (IO a -&gt; TcM a) -&gt; IO a -&gt; TcM a
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">IO a -&gt; TcM a
forall a. IO a -&gt; TR a
forall (m :: * -&gt; *) a. MonadIO m =&gt; IO a -&gt; m a
</span><span class="hs-identifier hs-var">liftIO</span></span><span>
</span><span id="line-545"></span><span>
</span><span id="line-546"></span><span id="local-6989586621683021025"><span class="annot"><a href="GHC.Runtime.Heap.Inspect.html#liftTcM"><span class="hs-identifier hs-type">liftTcM</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#TcM"><span class="hs-identifier hs-type">TcM</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683021025"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Runtime.Heap.Inspect.html#TR"><span class="hs-identifier hs-type">TR</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683021025"><span class="hs-identifier hs-type">a</span></a></span></span><span>
</span><span id="line-547"></span><span id="liftTcM"><span class="annot"><span class="annottext">liftTcM :: forall a. TcM a -&gt; TcM a
</span><a href="GHC.Runtime.Heap.Inspect.html#liftTcM"><span class="hs-identifier hs-var hs-var">liftTcM</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">TcM a -&gt; TcM a
forall a. a -&gt; a
</span><span class="hs-identifier hs-var">id</span></span><span>
</span><span id="line-548"></span><span>
</span><span id="line-549"></span><span class="hs-comment">-- When we make new unification variables in the GHCi debugger,</span><span>
</span><span id="line-550"></span><span class="hs-comment">-- we use RuntimeUnkTvs.   See Note [RuntimeUnkTv].</span><span>
</span><span id="line-551"></span><span class="annot"><a href="GHC.Runtime.Heap.Inspect.html#newVar"><span class="hs-identifier hs-type">newVar</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#Kind"><span class="hs-identifier hs-type">Kind</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Runtime.Heap.Inspect.html#TR"><span class="hs-identifier hs-type">TR</span></a></span><span> </span><span class="annot"><a href="GHC.Tc.Utils.TcType.html#TcType"><span class="hs-identifier hs-type">TcType</span></a></span><span>
</span><span id="line-552"></span><span id="newVar"><span class="annot"><span class="annottext">newVar :: Type -&gt; TR Type
</span><a href="GHC.Runtime.Heap.Inspect.html#newVar"><span class="hs-identifier hs-var hs-var">newVar</span></a></span></span><span> </span><span id="local-6989586621683022417"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621683022417"><span class="hs-identifier hs-var">kind</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">TR Type -&gt; TR Type
forall a. TcM a -&gt; TcM a
</span><a href="GHC.Runtime.Heap.Inspect.html#liftTcM"><span class="hs-identifier hs-var">liftTcM</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span id="local-6989586621683022418"><span class="annot"><a href="#local-6989586621683022418"><span class="hs-identifier hs-var">tv</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">MetaInfo -&gt; Type -&gt; TcM TyVar
</span><a href="GHC.Tc.Utils.TcMType.html#newAnonMetaTyVar"><span class="hs-identifier hs-var">newAnonMetaTyVar</span></a></span><span> </span><span class="annot"><span class="annottext">MetaInfo
</span><a href="GHC.Tc.Utils.TcType.html#RuntimeUnkTv"><span class="hs-identifier hs-var">RuntimeUnkTv</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621683022417"><span class="hs-identifier hs-var">kind</span></a></span><span>
</span><span id="line-553"></span><span>                          </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">return</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#mkTyVarTy"><span class="hs-identifier hs-type">mkTyVarTy</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683022418"><span class="hs-identifier hs-type">tv</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span class="hs-special">)</span><span>
</span><span id="line-554"></span><span>
</span><span id="line-555"></span><span class="annot"><a href="GHC.Runtime.Heap.Inspect.html#newOpenVar"><span class="hs-identifier hs-type">newOpenVar</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Runtime.Heap.Inspect.html#TR"><span class="hs-identifier hs-type">TR</span></a></span><span> </span><span class="annot"><a href="GHC.Tc.Utils.TcType.html#TcType"><span class="hs-identifier hs-type">TcType</span></a></span><span>
</span><span id="line-556"></span><span id="newOpenVar"><span class="annot"><span class="annottext">newOpenVar :: TR Type
</span><a href="GHC.Runtime.Heap.Inspect.html#newOpenVar"><span class="hs-identifier hs-var hs-var">newOpenVar</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">TR Type -&gt; TR Type
forall a. TcM a -&gt; TcM a
</span><a href="GHC.Runtime.Heap.Inspect.html#liftTcM"><span class="hs-identifier hs-var">liftTcM</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span id="local-6989586621683022423"><span class="annot"><a href="#local-6989586621683022423"><span class="hs-identifier hs-var">kind</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">TR Type
</span><a href="GHC.Tc.Utils.TcMType.html#newOpenTypeKind"><span class="hs-identifier hs-var">newOpenTypeKind</span></a></span><span>
</span><span id="line-557"></span><span>                         </span><span class="hs-special">;</span><span> </span><span class="annot"><a href="GHC.Runtime.Heap.Inspect.html#newVar"><span class="hs-identifier hs-type">newVar</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683022423"><span class="hs-identifier hs-type">kind</span></a></span><span> </span><span class="hs-special">}</span><span class="hs-special">)</span><span>
</span><span id="line-558"></span><span>
</span><span id="line-559"></span><span class="hs-comment">{- Note [RttiType]
~~~~~~~~~~~~~~~~~~
The type synonym `type RttiType = Type` is the type synonym used
by the debugger for the types of the data type `Term`.

For a long time the `RttiType` carried the following comment:

&gt;     A (non-mutable) tau type containing
&gt;     existentially quantified tyvars.
&gt;          (since GHC type language currently does not support
&gt;          existentials, we leave these variables unquantified)

The tau type part is only correct for terms representing the results
of fully saturated functions that return non-function (data) values
and not functions.

For non-function values, the GHC runtime always works with concrete
types eg `[Maybe Int]`, but never with polymorphic types like eg
`(Traversable t, Monad m) =&gt; t (m a)`. The concrete types, don't
need a quantification. They are always tau types.

The debugger binds the terms of :print commands and of the free
variables at a breakpoint to names. These newly bound names can
be used in new GHCi expressions. If these names represent functions,
then the type checker expects that the types of these functions are
fully-fledged. They must contain the necessary `forall`s and type
constraints. Hence the types of terms that represent functions must
be sigmas and not taus.
(See #12449)
-}</span><span>
</span><span id="line-589"></span><span>
</span><span id="line-590"></span><span class="hs-comment">{- Note [RuntimeUnkTv]
~~~~~~~~~~~~~~~~~~~~~~
In the GHCi debugger we use unification variables whose MetaInfo is
RuntimeUnkTv.  The special property of a RuntimeUnkTv is that it can
unify with a polytype (see GHC.Tc.Utils.Unify.checkTypeEq).
If we don't do this `:print &lt;term&gt;` will fail if the type of &lt;term&gt;
has nested `forall`s or `=&gt;`s.

This is because the GHCi debugger's internals will attempt to unify a
metavariable with the type of &lt;term&gt; and then display the result, but
if the type has nested `forall`s or `=&gt;`s, then unification will fail
unless we do something special.  As a result, `:print` will bail out
and the unhelpful result will be `&lt;term&gt; = (_t1::t1)` (where `t1` is a
metavariable).

Beware: &lt;term&gt; can have nested `forall`s even if its definition doesn't use
RankNTypes! Here is an example from #14828:

  class Functor f where
    fmap :: (a -&gt; b) -&gt; f a -&gt; f b

Somewhat surprisingly, `:print fmap` considers the type of fmap to have
nested foralls. This is because the GHCi debugger sees the type
`fmap :: forall f. Functor f =&gt; forall a b. (a -&gt; b) -&gt; f a -&gt; f b`.
We could envision deeply instantiating this type to get the type
`forall f a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b`,
but this trick wouldn't work for higher-rank types.

Instead, we adopt a simpler fix: allow RuntimeUnkTv to unify with a
polytype (specifically, see ghci_tv in GHC.Tc.Utils.Unify.preCheck).
This allows metavariables to unify with types that have
nested (or higher-rank) `forall`s/`=&gt;`s, which makes `:print fmap`
display as
`fmap = (_t1::forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b)`,
as expected.
-}</span><span>
</span><span id="line-626"></span><span>
</span><span id="line-627"></span><span>
</span><span id="line-628"></span><span class="annot"><a href="GHC.Runtime.Heap.Inspect.html#instTyVars"><span class="hs-identifier hs-type">instTyVars</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="GHC.Types.Var.html#TyVar"><span class="hs-identifier hs-type">TyVar</span></a></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Runtime.Heap.Inspect.html#TR"><span class="hs-identifier hs-type">TR</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Core.TyCo.Subst.html#Subst"><span class="hs-identifier hs-type">Subst</span></a></span><span class="hs-special">,</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="GHC.Types.Var.html#TcTyVar"><span class="hs-identifier hs-type">TcTyVar</span></a></span><span class="hs-special">]</span><span class="hs-special">)</span><span>
</span><span id="line-629"></span><span class="hs-comment">-- Instantiate fresh mutable type variables from some TyVars</span><span>
</span><span id="line-630"></span><span class="hs-comment">-- This function preserves the print-name, which helps error messages</span><span>
</span><span id="line-631"></span><span id="instTyVars"><span class="annot"><span class="annottext">instTyVars :: [TyVar] -&gt; TR (Subst, [TyVar])
</span><a href="GHC.Runtime.Heap.Inspect.html#instTyVars"><span class="hs-identifier hs-var hs-var">instTyVars</span></a></span></span><span> </span><span id="local-6989586621683022427"><span class="annot"><span class="annottext">[TyVar]
</span><a href="#local-6989586621683022427"><span class="hs-identifier hs-var">tvs</span></a></span></span><span>
</span><span id="line-632"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">TR (Subst, [TyVar]) -&gt; TR (Subst, [TyVar])
forall a. TcM a -&gt; TcM a
</span><a href="GHC.Runtime.Heap.Inspect.html#liftTcM"><span class="hs-identifier hs-var">liftTcM</span></a></span><span> </span><span class="annot"><span class="annottext">(TR (Subst, [TyVar]) -&gt; TR (Subst, [TyVar]))
-&gt; TR (Subst, [TyVar]) -&gt; TR (Subst, [TyVar])
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">((Subst, [TyVar]), WantedConstraints) -&gt; (Subst, [TyVar])
forall a b. (a, b) -&gt; a
</span><span class="hs-identifier hs-var">fst</span></span><span> </span><span class="annot"><span class="annottext">(((Subst, [TyVar]), WantedConstraints) -&gt; (Subst, [TyVar]))
-&gt; IOEnv
     (Env TcGblEnv TcLclEnv) ((Subst, [TyVar]), WantedConstraints)
-&gt; TR (Subst, [TyVar])
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="annot"><span class="annottext">TR (Subst, [TyVar])
-&gt; IOEnv
     (Env TcGblEnv TcLclEnv) ((Subst, [TyVar]), WantedConstraints)
forall a. TcM a -&gt; TcM (a, WantedConstraints)
</span><a href="GHC.Tc.Utils.Monad.html#captureConstraints"><span class="hs-identifier hs-var">captureConstraints</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[TyVar] -&gt; TR (Subst, [TyVar])
</span><a href="GHC.Tc.Utils.TcMType.html#newMetaTyVars"><span class="hs-identifier hs-var">newMetaTyVars</span></a></span><span> </span><span class="annot"><span class="annottext">[TyVar]
</span><a href="#local-6989586621683022427"><span class="hs-identifier hs-var">tvs</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-633"></span><span>
</span><span id="line-634"></span><span class="hs-keyword">type</span><span> </span><span id="RttiInstantiation"><span class="annot"><a href="GHC.Runtime.Heap.Inspect.html#RttiInstantiation"><span class="hs-identifier hs-var">RttiInstantiation</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">[</span><span class="hs-special">(</span><span class="annot"><a href="GHC.Types.Var.html#TcTyVar"><span class="hs-identifier hs-type">TcTyVar</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Types.Var.html#TyVar"><span class="hs-identifier hs-type">TyVar</span></a></span><span class="hs-special">)</span><span class="hs-special">]</span><span>
</span><span id="line-635"></span><span>   </span><span class="hs-comment">-- Associates the typechecker-world meta type variables</span><span>
</span><span id="line-636"></span><span>   </span><span class="hs-comment">-- (which are mutable and may be refined), to their</span><span>
</span><span id="line-637"></span><span>   </span><span class="hs-comment">-- debugger-world RuntimeUnk counterparts.</span><span>
</span><span id="line-638"></span><span>   </span><span class="hs-comment">-- If the TcTyVar has not been refined by the runtime type</span><span>
</span><span id="line-639"></span><span>   </span><span class="hs-comment">-- elaboration, then we want to turn it back into the</span><span>
</span><span id="line-640"></span><span>   </span><span class="hs-comment">-- original RuntimeUnk</span><span>
</span><span id="line-641"></span><span>   </span><span class="hs-comment">--</span><span>
</span><span id="line-642"></span><span>   </span><span class="hs-comment">-- July 20: I'm not convinced that the little dance from</span><span>
</span><span id="line-643"></span><span>   </span><span class="hs-comment">-- RuntimeUnkTv unification variables to RuntimeUnk skolems</span><span>
</span><span id="line-644"></span><span>   </span><span class="hs-comment">-- is buying us anything.  ToDo: get rid of it.</span><span>
</span><span id="line-645"></span><span>
</span><span id="line-646"></span><span class="hs-comment">-- | Returns the instantiated type scheme ty', and the</span><span>
</span><span id="line-647"></span><span class="hs-comment">--   mapping from new (instantiated) -to- old (skolem) type variables</span><span>
</span><span id="line-648"></span><span class="annot"><a href="GHC.Runtime.Heap.Inspect.html#instScheme"><span class="hs-identifier hs-type">instScheme</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Runtime.Heap.Inspect.html#QuantifiedType"><span class="hs-identifier hs-type">QuantifiedType</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Runtime.Heap.Inspect.html#TR"><span class="hs-identifier hs-type">TR</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Tc.Utils.TcType.html#TcType"><span class="hs-identifier hs-type">TcType</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Runtime.Heap.Inspect.html#RttiInstantiation"><span class="hs-identifier hs-type">RttiInstantiation</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-649"></span><span id="instScheme"><span class="annot"><span class="annottext">instScheme :: QuantifiedType -&gt; TR (Type, RttiInstantiation)
</span><a href="GHC.Runtime.Heap.Inspect.html#instScheme"><span class="hs-identifier hs-var hs-var">instScheme</span></a></span></span><span> </span><span class="hs-special">(</span><span id="local-6989586621683022432"><span class="annot"><span class="annottext">[TyVar]
</span><a href="#local-6989586621683022432"><span class="hs-identifier hs-var">tvs</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621683022433"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621683022433"><span class="hs-identifier hs-var">ty</span></a></span></span><span class="hs-special">)</span><span>
</span><span id="line-650"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span class="hs-special">(</span><span id="local-6989586621683022434"><span class="annot"><a href="#local-6989586621683022434"><span class="hs-identifier hs-var">subst</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621683022435"><span class="annot"><a href="#local-6989586621683022435"><span class="hs-identifier hs-var">tvs'</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">[TyVar] -&gt; TR (Subst, [TyVar])
</span><a href="GHC.Runtime.Heap.Inspect.html#instTyVars"><span class="hs-identifier hs-var">instTyVars</span></a></span><span> </span><span class="annot"><span class="annottext">[TyVar]
</span><a href="#local-6989586621683022432"><span class="hs-identifier hs-var">tvs</span></a></span><span>
</span><span id="line-651"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621683022436"><span class="annot"><a href="#local-6989586621683022436"><span class="hs-identifier hs-var hs-var">rtti_inst</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">[</span><span class="hs-special">(</span><span class="annot"><span class="annottext">TyVar
</span><a href="#local-6989586621683022437"><span class="hs-identifier hs-var">tv'</span></a></span><span class="hs-special">,</span><span class="annot"><span class="annottext">TyVar
</span><a href="#local-6989586621683022438"><span class="hs-identifier hs-var">tv</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">|</span><span> </span><span class="hs-special">(</span><span id="local-6989586621683022437"><span class="annot"><span class="annottext">TyVar
</span><a href="#local-6989586621683022437"><span class="hs-identifier hs-var">tv'</span></a></span></span><span class="hs-special">,</span><span id="local-6989586621683022438"><span class="annot"><span class="annottext">TyVar
</span><a href="#local-6989586621683022438"><span class="hs-identifier hs-var">tv</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">[TyVar]
</span><a href="#local-6989586621683022435"><span class="hs-identifier hs-var">tvs'</span></a></span><span> </span><span class="annot"><span class="annottext">[TyVar] -&gt; [TyVar] -&gt; RttiInstantiation
forall a b. [a] -&gt; [b] -&gt; [(a, b)]
</span><span class="hs-operator hs-var">`zip`</span></span><span> </span><span class="annot"><span class="annottext">[TyVar]
</span><a href="#local-6989586621683022432"><span class="hs-identifier hs-var">tvs</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-652"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="annot"><a href="GHC.Runtime.Heap.Inspect.html#traceTR"><span class="hs-identifier hs-type">traceTR</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Utils.Outputable.html#text"><span class="hs-identifier hs-type">text</span></a></span><span> </span><span class="annot"><span class="hs-string">&quot;instScheme&quot;</span></span><span> </span><span class="annot"><a href="GHC.Utils.Outputable.html#%3C%2B%3E"><span class="hs-operator hs-type">&lt;+&gt;</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-type">ppr</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683022432"><span class="hs-identifier hs-type">tvs</span></a></span><span> </span><span class="annot"><a href="GHC.Utils.Outputable.html#%24%24"><span class="hs-operator hs-type">$$</span></a></span><span> </span><span class="annot"><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-type">ppr</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683022433"><span class="hs-identifier hs-type">ty</span></a></span><span> </span><span class="annot"><a href="GHC.Utils.Outputable.html#%24%24"><span class="hs-operator hs-type">$$</span></a></span><span> </span><span class="annot"><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-type">ppr</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683022435"><span class="hs-identifier hs-type">tvs'</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-653"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">return</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Core.TyCo.Subst.html#substTy"><span class="hs-identifier hs-type">substTy</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683022434"><span class="hs-identifier hs-type">subst</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683022433"><span class="hs-identifier hs-type">ty</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="#local-6989586621683022436"><span class="hs-identifier hs-type">rtti_inst</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-654"></span><span>
</span><span id="line-655"></span><span class="annot"><a href="GHC.Runtime.Heap.Inspect.html#applyRevSubst"><span class="hs-identifier hs-type">applyRevSubst</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Runtime.Heap.Inspect.html#RttiInstantiation"><span class="hs-identifier hs-type">RttiInstantiation</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Runtime.Heap.Inspect.html#TR"><span class="hs-identifier hs-type">TR</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-656"></span><span class="hs-comment">-- Apply the *reverse* substitution in-place to any un-filled-in</span><span>
</span><span id="line-657"></span><span class="hs-comment">-- meta tyvars.  This recovers the original debugger-world variable</span><span>
</span><span id="line-658"></span><span class="hs-comment">-- unless it has been refined by new information from the heap</span><span>
</span><span id="line-659"></span><span id="applyRevSubst"><span class="annot"><span class="annottext">applyRevSubst :: RttiInstantiation -&gt; TR ()
</span><a href="GHC.Runtime.Heap.Inspect.html#applyRevSubst"><span class="hs-identifier hs-var hs-var">applyRevSubst</span></a></span></span><span> </span><span id="local-6989586621683022442"><span class="annot"><span class="annottext">RttiInstantiation
</span><a href="#local-6989586621683022442"><span class="hs-identifier hs-var">pairs</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">TR () -&gt; TR ()
forall a. TcM a -&gt; TcM a
</span><a href="GHC.Runtime.Heap.Inspect.html#liftTcM"><span class="hs-identifier hs-var">liftTcM</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ZonkM () -&gt; TR ()
forall a. ZonkM a -&gt; TcM a
</span><a href="GHC.Tc.Utils.Monad.html#liftZonkM"><span class="hs-identifier hs-var">liftZonkM</span></a></span><span> </span><span class="annot"><span class="annottext">(ZonkM () -&gt; TR ()) -&gt; ZonkM () -&gt; TR ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">((TyVar, TyVar) -&gt; ZonkM ()) -&gt; RttiInstantiation -&gt; ZonkM ()
forall (t :: * -&gt; *) (m :: * -&gt; *) a b.
(Foldable t, Monad m) =&gt;
(a -&gt; m b) -&gt; t a -&gt; m ()
</span><span class="hs-identifier hs-var">mapM_</span></span><span> </span><span class="annot"><span class="annottext">(TyVar, TyVar) -&gt; ZonkM ()
</span><a href="#local-6989586621683022445"><span class="hs-identifier hs-var">do_pair</span></a></span><span> </span><span class="annot"><span class="annottext">RttiInstantiation
</span><a href="#local-6989586621683022442"><span class="hs-identifier hs-var">pairs</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-660"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-661"></span><span>    </span><span id="local-6989586621683022445"><span class="annot"><span class="annottext">do_pair :: (TyVar, TyVar) -&gt; ZonkM ()
</span><a href="#local-6989586621683022445"><span class="hs-identifier hs-var hs-var">do_pair</span></a></span></span><span> </span><span class="hs-special">(</span><span id="local-6989586621683022449"><span class="annot"><span class="annottext">TyVar
</span><a href="#local-6989586621683022449"><span class="hs-identifier hs-var">tc_tv</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621683022450"><span class="annot"><span class="annottext">TyVar
</span><a href="#local-6989586621683022450"><span class="hs-identifier hs-var">rtti_tv</span></a></span></span><span class="hs-special">)</span><span>
</span><span id="line-662"></span><span>      </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span id="local-6989586621683022451"><span class="annot"><a href="#local-6989586621683022451"><span class="hs-identifier hs-var">tc_ty</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">TyVar -&gt; ZonkM Type
</span><a href="GHC.Tc.Zonk.TcType.html#zonkTcTyVar"><span class="hs-identifier hs-var">zonkTcTyVar</span></a></span><span> </span><span class="annot"><span class="annottext">TyVar
</span><a href="#local-6989586621683022449"><span class="hs-identifier hs-var">tc_tv</span></a></span><span>
</span><span id="line-663"></span><span>           </span><span class="hs-special">;</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><a href="GHC.Core.Type.html#getTyVar_maybe"><span class="hs-identifier hs-type">getTyVar_maybe</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683022451"><span class="hs-identifier hs-type">tc_ty</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-664"></span><span>               </span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span id="local-6989586621683022454"><span class="annot"><span class="annottext">TyVar
</span><a href="#local-6989586621683022454"><span class="hs-identifier hs-var">tv</span></a></span></span><span> </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">TyVar -&gt; Bool
</span><a href="GHC.Tc.Utils.TcType.html#isMetaTyVar"><span class="hs-identifier hs-var">isMetaTyVar</span></a></span><span> </span><span class="annot"><span class="annottext">TyVar
</span><a href="#local-6989586621683022454"><span class="hs-identifier hs-var">tv</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">HasDebugCallStack =&gt; TyVar -&gt; Type -&gt; ZonkM ()
TyVar -&gt; Type -&gt; ZonkM ()
</span><a href="GHC.Tc.Zonk.TcType.html#writeMetaTyVar"><span class="hs-identifier hs-var">writeMetaTyVar</span></a></span><span> </span><span class="annot"><span class="annottext">TyVar
</span><a href="#local-6989586621683022454"><span class="hs-identifier hs-var">tv</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TyVar -&gt; Type
</span><a href="GHC.Core.TyCo.Rep.html#mkTyVarTy"><span class="hs-identifier hs-var">mkTyVarTy</span></a></span><span> </span><span class="annot"><span class="annottext">TyVar
</span><a href="#local-6989586621683022450"><span class="hs-identifier hs-var">rtti_tv</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-665"></span><span>               </span><span class="annot"><span class="annottext">Maybe TyVar
</span><span class="hs-identifier">_</span></span><span>                        </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">() -&gt; ZonkM ()
forall a. a -&gt; ZonkM a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-666"></span><span>
</span><span id="line-667"></span><span class="hs-comment">-- Adds a constraint of the form t1 == t2</span><span>
</span><span id="line-668"></span><span class="hs-comment">-- t1 is expected to come from walking the heap</span><span>
</span><span id="line-669"></span><span class="hs-comment">-- t2 is expected to come from a datacon signature</span><span>
</span><span id="line-670"></span><span class="hs-comment">-- Before unification, congruenceNewtypes needs to</span><span>
</span><span id="line-671"></span><span class="hs-comment">-- do its magic.</span><span>
</span><span id="line-672"></span><span class="annot"><a href="GHC.Runtime.Heap.Inspect.html#addConstraint"><span class="hs-identifier hs-type">addConstraint</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.TcType.html#TcType"><span class="hs-identifier hs-type">TcType</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.TcType.html#TcType"><span class="hs-identifier hs-type">TcType</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Runtime.Heap.Inspect.html#TR"><span class="hs-identifier hs-type">TR</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-673"></span><span id="addConstraint"><span class="annot"><span class="annottext">addConstraint :: Type -&gt; Type -&gt; TR ()
</span><a href="GHC.Runtime.Heap.Inspect.html#addConstraint"><span class="hs-identifier hs-var hs-var">addConstraint</span></a></span></span><span> </span><span id="local-6989586621683022458"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621683022458"><span class="hs-identifier hs-var">actual</span></a></span></span><span> </span><span id="local-6989586621683022459"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621683022459"><span class="hs-identifier hs-var">expected</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-674"></span><span>    </span><span class="annot"><span class="annottext">SDoc -&gt; TR ()
</span><a href="GHC.Runtime.Heap.Inspect.html#traceTR"><span class="hs-identifier hs-var">traceTR</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">String -&gt; SDoc
forall doc. IsLine doc =&gt; String -&gt; doc
</span><a href="GHC.Utils.Outputable.html#text"><span class="hs-identifier hs-var">text</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;add constraint:&quot;</span></span><span> </span><span class="annot"><span class="annottext">SDoc -&gt; SDoc -&gt; SDoc
forall doc. IsLine doc =&gt; doc -&gt; doc -&gt; doc
</span><a href="GHC.Utils.Outputable.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">[SDoc] -&gt; SDoc
forall doc. IsLine doc =&gt; [doc] -&gt; doc
</span><a href="GHC.Utils.Outputable.html#fsep"><span class="hs-identifier hs-var">fsep</span></a></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">Type -&gt; SDoc
forall a. Outputable a =&gt; a -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621683022458"><span class="hs-identifier hs-var">actual</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">SDoc
forall doc. IsLine doc =&gt; doc
</span><a href="GHC.Utils.Outputable.html#equals"><span class="hs-identifier hs-var">equals</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Type -&gt; SDoc
forall a. Outputable a =&gt; a -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621683022459"><span class="hs-identifier hs-var">expected</span></a></span><span class="hs-special">]</span><span class="hs-special">)</span><span>
</span><span id="line-675"></span><span>    </span><span class="annot"><span class="annottext">TR () -&gt; TR () -&gt; TR ()
forall a. TR a -&gt; TR a -&gt; TR a
</span><a href="GHC.Runtime.Heap.Inspect.html#recoverTR"><span class="hs-identifier hs-var">recoverTR</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">SDoc -&gt; TR ()
</span><a href="GHC.Runtime.Heap.Inspect.html#traceTR"><span class="hs-identifier hs-var">traceTR</span></a></span><span> </span><span class="annot"><span class="annottext">(SDoc -&gt; TR ()) -&gt; SDoc -&gt; TR ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">[SDoc] -&gt; SDoc
forall doc. IsLine doc =&gt; [doc] -&gt; doc
</span><a href="GHC.Utils.Outputable.html#fsep"><span class="hs-identifier hs-var">fsep</span></a></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">String -&gt; SDoc
forall doc. IsLine doc =&gt; String -&gt; doc
</span><a href="GHC.Utils.Outputable.html#text"><span class="hs-identifier hs-var">text</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;Failed to unify&quot;</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Type -&gt; SDoc
forall a. Outputable a =&gt; a -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621683022458"><span class="hs-identifier hs-var">actual</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-676"></span><span>                                    </span><span class="annot"><span class="annottext">String -&gt; SDoc
forall doc. IsLine doc =&gt; String -&gt; doc
</span><a href="GHC.Utils.Outputable.html#text"><span class="hs-identifier hs-var">text</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;with&quot;</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Type -&gt; SDoc
forall a. Outputable a =&gt; a -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621683022459"><span class="hs-identifier hs-var">expected</span></a></span><span class="hs-special">]</span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(TR () -&gt; TR ()) -&gt; TR () -&gt; TR ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-677"></span><span>      </span><span class="annot"><span class="annottext">TcM (TcCoercionN, WantedConstraints) -&gt; TR ()
forall a. TcM a -&gt; TR ()
</span><a href="GHC.Tc.Utils.Monad.html#discardResult"><span class="hs-identifier hs-var">discardResult</span></a></span><span> </span><span class="annot"><span class="annottext">(TcM (TcCoercionN, WantedConstraints) -&gt; TR ())
-&gt; TcM (TcCoercionN, WantedConstraints) -&gt; TR ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-678"></span><span>      </span><span class="annot"><span class="annottext">TcM TcCoercionN -&gt; TcM (TcCoercionN, WantedConstraints)
forall a. TcM a -&gt; TcM (a, WantedConstraints)
</span><a href="GHC.Tc.Utils.Monad.html#captureConstraints"><span class="hs-identifier hs-var">captureConstraints</span></a></span><span> </span><span class="annot"><span class="annottext">(TcM TcCoercionN -&gt; TcM (TcCoercionN, WantedConstraints))
-&gt; TcM TcCoercionN -&gt; TcM (TcCoercionN, WantedConstraints)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-679"></span><span>      </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span class="hs-special">(</span><span id="local-6989586621683022462"><span class="annot"><a href="#local-6989586621683022462"><span class="hs-identifier hs-var">ty1</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621683022463"><span class="annot"><a href="#local-6989586621683022463"><span class="hs-identifier hs-var">ty2</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Type -&gt; Type -&gt; TR (Type, Type)
</span><a href="GHC.Runtime.Heap.Inspect.html#congruenceNewtypes"><span class="hs-identifier hs-var">congruenceNewtypes</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621683022458"><span class="hs-identifier hs-var">actual</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621683022459"><span class="hs-identifier hs-var">expected</span></a></span><span>
</span><span id="line-680"></span><span>         </span><span class="hs-special">;</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.Unify.html#unifyType"><span class="hs-identifier hs-type">unifyType</span></a></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Nothing</span></span><span> </span><span class="annot"><a href="#local-6989586621683022462"><span class="hs-identifier hs-type">ty1</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683022463"><span class="hs-identifier hs-type">ty2</span></a></span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-681"></span><span>     </span><span class="hs-comment">-- TOMDO: what about the coercion?</span><span>
</span><span id="line-682"></span><span>     </span><span class="hs-comment">-- we should consider family instances</span><span>
</span><span id="line-683"></span><span>
</span><span id="line-684"></span><span>
</span><span id="line-685"></span><span class="hs-comment">-- | Term reconstruction</span><span>
</span><span id="line-686"></span><span class="hs-comment">--</span><span>
</span><span id="line-687"></span><span class="hs-comment">-- Given a pointer to a heap object (`HValue`) and its type, build a `Term`</span><span>
</span><span id="line-688"></span><span class="hs-comment">-- representation of the object. Subterms (objects in the payload) are also</span><span>
</span><span id="line-689"></span><span class="hs-comment">-- built up to the given `max_depth`. After `max_depth` any subterms will appear</span><span>
</span><span id="line-690"></span><span class="hs-comment">-- as `Suspension`s. Any thunks found while traversing the object will be forced</span><span>
</span><span id="line-691"></span><span class="hs-comment">-- based on `force` parameter.</span><span>
</span><span id="line-692"></span><span class="hs-comment">--</span><span>
</span><span id="line-693"></span><span class="hs-comment">-- Types of terms will be refined based on constructors we find during term</span><span>
</span><span id="line-694"></span><span class="hs-comment">-- reconstruction. See `cvReconstructType` for an overview of how type</span><span>
</span><span id="line-695"></span><span class="hs-comment">-- reconstruction works.</span><span>
</span><span id="line-696"></span><span class="hs-comment">--</span><span>
</span><span id="line-697"></span><span class="annot"><a href="GHC.Runtime.Heap.Inspect.html#cvObtainTerm"><span class="hs-identifier hs-type">cvObtainTerm</span></a></span><span>
</span><span id="line-698"></span><span>    </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Driver.Env.Types.html#HscEnv"><span class="hs-identifier hs-type">HscEnv</span></a></span><span>
</span><span id="line-699"></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Int</span></span><span>      </span><span class="annot"><span class="hs-comment">-- ^ How many times to recurse for subterms</span></span><span>
</span><span id="line-700"></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Bool</span></span><span>     </span><span class="annot"><span class="hs-comment">-- ^ Force thunks</span></span><span>
</span><span id="line-701"></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Runtime.Heap.Inspect.html#RttiType"><span class="hs-identifier hs-type">RttiType</span></a></span><span> </span><span class="annot"><span class="hs-comment">-- ^ Type of the object to reconstruct</span></span><span>
</span><span id="line-702"></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="../../ghci-9.12.2-bd10/src/GHCi.RemoteTypes.html#ForeignHValue"><span class="hs-identifier hs-type">ForeignHValue</span></a></span><span>   </span><span class="annot"><span class="hs-comment">-- ^ Object to reconstruct</span></span><span>
</span><span id="line-703"></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="annot"><a href="GHC.Runtime.Heap.Inspect.html#Term"><span class="hs-identifier hs-type">Term</span></a></span><span>
</span><span id="line-704"></span><span id="cvObtainTerm"><span class="annot"><span class="annottext">cvObtainTerm :: HscEnv -&gt; Int -&gt; Bool -&gt; Type -&gt; ForeignHValue -&gt; IO Term
</span><a href="GHC.Runtime.Heap.Inspect.html#cvObtainTerm"><span class="hs-identifier hs-var hs-var">cvObtainTerm</span></a></span></span><span> </span><span id="local-6989586621683022468"><span class="annot"><span class="annottext">HscEnv
</span><a href="#local-6989586621683022468"><span class="hs-identifier hs-var">hsc_env</span></a></span></span><span> </span><span id="local-6989586621683022469"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621683022469"><span class="hs-identifier hs-var">max_depth</span></a></span></span><span> </span><span id="local-6989586621683022470"><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621683022470"><span class="hs-identifier hs-var">force</span></a></span></span><span> </span><span id="local-6989586621683022471"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621683022471"><span class="hs-identifier hs-var">old_ty</span></a></span></span><span> </span><span id="local-6989586621683022472"><span class="annot"><span class="annottext">ForeignHValue
</span><a href="#local-6989586621683022472"><span class="hs-identifier hs-var">hval</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">HscEnv -&gt; TR Term -&gt; IO Term
forall a. HscEnv -&gt; TR a -&gt; IO a
</span><a href="GHC.Runtime.Heap.Inspect.html#runTR"><span class="hs-identifier hs-var">runTR</span></a></span><span> </span><span class="annot"><span class="annottext">HscEnv
</span><a href="#local-6989586621683022468"><span class="hs-identifier hs-var">hsc_env</span></a></span><span> </span><span class="annot"><span class="annottext">(TR Term -&gt; IO Term) -&gt; TR Term -&gt; IO Term
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-705"></span><span>  </span><span class="hs-comment">-- we quantify existential tyvars as universal,</span><span>
</span><span id="line-706"></span><span>  </span><span class="hs-comment">-- as this is needed to be able to manipulate</span><span>
</span><span id="line-707"></span><span>  </span><span class="hs-comment">-- them properly</span><span>
</span><span id="line-708"></span><span>   </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621683022473"><span class="annot"><span class="annottext">quant_old_ty :: QuantifiedType
</span><a href="#local-6989586621683022473"><span class="hs-identifier hs-var hs-var">quant_old_ty</span></a></span></span><span class="hs-glyph">@</span><span class="hs-special">(</span><span id="local-6989586621683022474"><span class="annot"><span class="annottext">[TyVar]
</span><a href="#local-6989586621683022474"><span class="hs-identifier hs-var hs-var">old_tvs</span></a></span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Type
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Type -&gt; QuantifiedType
</span><a href="GHC.Runtime.Heap.Inspect.html#quantifyType"><span class="hs-identifier hs-var">quantifyType</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621683022471"><span class="hs-identifier hs-var">old_ty</span></a></span><span>
</span><span id="line-709"></span><span>   </span><span class="annot"><span class="annottext">SDoc -&gt; TR ()
</span><a href="GHC.Runtime.Heap.Inspect.html#traceTR"><span class="hs-identifier hs-var">traceTR</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">String -&gt; SDoc
forall doc. IsLine doc =&gt; String -&gt; doc
</span><a href="GHC.Utils.Outputable.html#text"><span class="hs-identifier hs-var">text</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;Term reconstruction started with initial type &quot;</span></span><span> </span><span class="annot"><span class="annottext">SDoc -&gt; SDoc -&gt; SDoc
forall doc. IsLine doc =&gt; doc -&gt; doc -&gt; doc
</span><a href="GHC.Utils.Outputable.html#%3C%3E"><span class="hs-operator hs-var">&lt;&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">Type -&gt; SDoc
forall a. Outputable a =&gt; a -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621683022471"><span class="hs-identifier hs-var">old_ty</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-710"></span><span>   </span><span id="local-6989586621683022476"><span class="annot"><a href="#local-6989586621683022476"><span class="hs-identifier hs-var">term</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span>
</span><span id="line-711"></span><span>     </span><span class="hs-keyword">if</span><span> </span><span class="annot"><span class="annottext">[TyVar] -&gt; Bool
forall a. [a] -&gt; Bool
forall (t :: * -&gt; *) a. Foldable t =&gt; t a -&gt; Bool
</span><span class="hs-identifier hs-var">null</span></span><span> </span><span class="annot"><span class="annottext">[TyVar]
</span><a href="#local-6989586621683022474"><span class="hs-identifier hs-var">old_tvs</span></a></span><span>
</span><span id="line-712"></span><span>      </span><span class="hs-keyword">then</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-713"></span><span>        </span><span id="local-6989586621683022477"><span class="annot"><a href="#local-6989586621683022477"><span class="hs-identifier hs-var">term</span></a></span></span><span>  </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Int -&gt; Type -&gt; Type -&gt; ForeignHValue -&gt; TR Term
</span><a href="#local-6989586621683022478"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621683022469"><span class="hs-identifier hs-var">max_depth</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621683022471"><span class="hs-identifier hs-var">old_ty</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621683022471"><span class="hs-identifier hs-var">old_ty</span></a></span><span> </span><span class="annot"><span class="annottext">ForeignHValue
</span><a href="#local-6989586621683022472"><span class="hs-identifier hs-var">hval</span></a></span><span>
</span><span id="line-714"></span><span>        </span><span id="local-6989586621683022479"><span class="annot"><a href="#local-6989586621683022479"><span class="hs-identifier hs-var">term'</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><a href="GHC.Runtime.Heap.Inspect.html#zonkTerm"><span class="hs-identifier hs-type">zonkTerm</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683022477"><span class="hs-identifier hs-type">term</span></a></span><span>
</span><span id="line-715"></span><span>        </span><span class="annot"><span class="hs-identifier hs-type">return</span></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="annot"><a href="#local-6989586621683022481"><span class="hs-identifier hs-type">fixFunDictionaries</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="annot"><a href="#local-6989586621683022482"><span class="hs-identifier hs-type">expandNewtypes</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683022479"><span class="hs-identifier hs-type">term'</span></a></span><span>
</span><span id="line-716"></span><span>      </span><span class="hs-keyword">else</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-717"></span><span>              </span><span class="hs-special">(</span><span id="local-6989586621683022483"><span class="annot"><a href="#local-6989586621683022483"><span class="hs-identifier hs-var">old_ty'</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621683022484"><span class="annot"><a href="#local-6989586621683022484"><span class="hs-identifier hs-var">rev_subst</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">QuantifiedType -&gt; TR (Type, RttiInstantiation)
</span><a href="GHC.Runtime.Heap.Inspect.html#instScheme"><span class="hs-identifier hs-var">instScheme</span></a></span><span> </span><span class="annot"><span class="annottext">QuantifiedType
</span><a href="#local-6989586621683022473"><span class="hs-identifier hs-var">quant_old_ty</span></a></span><span>
</span><span id="line-718"></span><span>              </span><span id="local-6989586621683022485"><span class="annot"><a href="#local-6989586621683022485"><span class="hs-identifier hs-var">my_ty</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><a href="GHC.Runtime.Heap.Inspect.html#newOpenVar"><span class="hs-identifier hs-type">newOpenVar</span></a></span><span>
</span><span id="line-719"></span><span>              </span><span class="annot"><span class="hs-identifier hs-type">when</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Runtime.Heap.Inspect.html#check1"><span class="hs-identifier hs-type">check1</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683022474"><span class="hs-identifier hs-type">old_tvs</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Runtime.Heap.Inspect.html#traceTR"><span class="hs-identifier hs-type">traceTR</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Utils.Outputable.html#text"><span class="hs-identifier hs-type">text</span></a></span><span> </span><span class="annot"><span class="hs-string">&quot;check1 passed&quot;</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="hs-operator hs-type">&gt;&gt;</span></span><span>
</span><span id="line-720"></span><span>                                          </span><span class="annot"><a href="GHC.Runtime.Heap.Inspect.html#addConstraint"><span class="hs-identifier hs-type">addConstraint</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683022485"><span class="hs-identifier hs-type">my_ty</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683022483"><span class="hs-identifier hs-type">old_ty'</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-721"></span><span>              </span><span id="local-6989586621683022488"><span class="annot"><a href="#local-6989586621683022488"><span class="hs-identifier hs-var">term</span></a></span></span><span>  </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><a href="#local-6989586621683022478"><span class="hs-identifier hs-type">go</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683022469"><span class="hs-identifier hs-type">max_depth</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683022485"><span class="hs-identifier hs-type">my_ty</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683022471"><span class="hs-identifier hs-type">old_ty</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683022472"><span class="hs-identifier hs-type">hval</span></a></span><span>
</span><span id="line-722"></span><span>              </span><span id="local-6989586621683022489"><span class="annot"><a href="#local-6989586621683022489"><span class="hs-identifier hs-var">new_ty</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><a href="GHC.Runtime.Heap.Inspect.html#liftTcM"><span class="hs-identifier hs-type">liftTcM</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="annot"><a href="GHC.Tc.Utils.Monad.html#liftZonkM"><span class="hs-identifier hs-type">liftZonkM</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="annot"><a href="GHC.Tc.Zonk.TcType.html#zonkTcType"><span class="hs-identifier hs-type">zonkTcType</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Runtime.Heap.Inspect.html#termType"><span class="hs-identifier hs-type">termType</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683022488"><span class="hs-identifier hs-type">term</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-723"></span><span>              </span><span class="hs-keyword">if</span><span> </span><span class="annot"><a href="GHC.Runtime.Heap.Inspect.html#isMonomorphic"><span class="hs-identifier hs-type">isMonomorphic</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683022489"><span class="hs-identifier hs-type">new_ty</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">||</span></span><span> </span><span class="annot"><a href="GHC.Runtime.Heap.Inspect.html#check2"><span class="hs-identifier hs-type">check2</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683022489"><span class="hs-identifier hs-type">new_ty</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683022471"><span class="hs-identifier hs-type">old_ty</span></a></span><span>
</span><span id="line-724"></span><span>                 </span><span class="hs-keyword">then</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-725"></span><span>                      </span><span class="annot"><a href="GHC.Runtime.Heap.Inspect.html#traceTR"><span class="hs-identifier hs-type">traceTR</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Utils.Outputable.html#text"><span class="hs-identifier hs-type">text</span></a></span><span> </span><span class="annot"><span class="hs-string">&quot;check2 passed&quot;</span></span><span class="hs-special">)</span><span>
</span><span id="line-726"></span><span>                      </span><span class="annot"><a href="GHC.Runtime.Heap.Inspect.html#addConstraint"><span class="hs-identifier hs-type">addConstraint</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683022489"><span class="hs-identifier hs-type">new_ty</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683022483"><span class="hs-identifier hs-type">old_ty'</span></a></span><span>
</span><span id="line-727"></span><span>                      </span><span class="annot"><a href="GHC.Runtime.Heap.Inspect.html#applyRevSubst"><span class="hs-identifier hs-type">applyRevSubst</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683022484"><span class="hs-identifier hs-type">rev_subst</span></a></span><span>
</span><span id="line-728"></span><span>                      </span><span id="local-6989586621683022494"><span class="annot"><a href="#local-6989586621683022494"><span class="hs-identifier hs-var">zterm'</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><a href="GHC.Runtime.Heap.Inspect.html#zonkTerm"><span class="hs-identifier hs-type">zonkTerm</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683022488"><span class="hs-identifier hs-type">term</span></a></span><span>
</span><span id="line-729"></span><span>                      </span><span class="annot"><span class="hs-identifier hs-type">return</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621683022481"><span class="hs-identifier hs-type">fixFunDictionaries</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">.</span></span><span> </span><span class="annot"><a href="#local-6989586621683022482"><span class="hs-identifier hs-type">expandNewtypes</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><a href="#local-6989586621683022494"><span class="hs-identifier hs-type">zterm'</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-730"></span><span>                 </span><span class="hs-keyword">else</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-731"></span><span>                      </span><span class="annot"><a href="GHC.Runtime.Heap.Inspect.html#traceTR"><span class="hs-identifier hs-type">traceTR</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Utils.Outputable.html#text"><span class="hs-identifier hs-type">text</span></a></span><span> </span><span class="annot"><span class="hs-string">&quot;check2 failed&quot;</span></span><span> </span><span class="annot"><a href="GHC.Utils.Outputable.html#%3C%2B%3E"><span class="hs-operator hs-type">&lt;+&gt;</span></a></span><span> </span><span class="annot"><a href="GHC.Utils.Outputable.html#parens"><span class="hs-identifier hs-type">parens</span></a></span><span>
</span><span id="line-732"></span><span>                                       </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-type">ppr</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683022488"><span class="hs-identifier hs-type">term</span></a></span><span> </span><span class="annot"><a href="GHC.Utils.Outputable.html#%3C%2B%3E"><span class="hs-operator hs-type">&lt;+&gt;</span></a></span><span> </span><span class="annot"><a href="GHC.Utils.Outputable.html#text"><span class="hs-identifier hs-type">text</span></a></span><span> </span><span class="annot"><span class="hs-string">&quot;::&quot;</span></span><span> </span><span class="annot"><a href="GHC.Utils.Outputable.html#%3C%2B%3E"><span class="hs-operator hs-type">&lt;+&gt;</span></a></span><span> </span><span class="annot"><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-type">ppr</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683022489"><span class="hs-identifier hs-type">new_ty</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-733"></span><span>                      </span><span class="hs-comment">-- we have unsound types. Replace constructor types in</span><span>
</span><span id="line-734"></span><span>                      </span><span class="hs-comment">-- subterms with tyvars</span><span>
</span><span id="line-735"></span><span>                      </span><span id="local-6989586621683022495"><span class="annot"><a href="#local-6989586621683022495"><span class="hs-identifier hs-var">zterm'</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><a href="GHC.Runtime.Heap.Inspect.html#mapTermTypeM"><span class="hs-identifier hs-type">mapTermTypeM</span></a></span><span>
</span><span id="line-736"></span><span>                                 </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span id="local-6989586621683022496"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621683022496"><span class="hs-identifier hs-var">ty</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">HasDebugCallStack =&gt; Type -&gt; Maybe (TyCon, [Type])
Type -&gt; Maybe (TyCon, [Type])
</span><a href="GHC.Core.Type.html#splitTyConApp_maybe"><span class="hs-identifier hs-var">splitTyConApp_maybe</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621683022496"><span class="hs-identifier hs-var">ty</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-737"></span><span>                                           </span><span class="hs-comment">-- SPJ: I have no idea why we are</span><span>
</span><span id="line-738"></span><span>                                           </span><span class="hs-comment">--      matching on (:) here, nor</span><span>
</span><span id="line-739"></span><span>                                           </span><span class="hs-comment">--      what the isFunTy is for</span><span>
</span><span id="line-740"></span><span>                                           </span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span class="hs-special">(</span><span id="local-6989586621683022498"><span class="annot"><span class="annottext">TyCon
</span><a href="#local-6989586621683022498"><span class="hs-identifier hs-var">_tc</span></a></span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Type
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="hs-glyph hs-type">:</span></span><span> </span><span class="annot"><span class="annottext">[Type]
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Bool
</span><span class="hs-identifier hs-var">not</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Type -&gt; Bool
</span><a href="GHC.Core.Type.html#isFunTy"><span class="hs-identifier hs-var">isFunTy</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621683022496"><span class="hs-identifier hs-var">ty</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-741"></span><span>                                                             </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">TR Type
</span><a href="GHC.Runtime.Heap.Inspect.html#newOpenVar"><span class="hs-identifier hs-var">newOpenVar</span></a></span><span>
</span><span id="line-742"></span><span>                                           </span><span class="annot"><span class="annottext">Maybe (TyCon, [Type])
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Type -&gt; TR Type
forall a. a -&gt; IOEnv (Env TcGblEnv TcLclEnv) a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621683022496"><span class="hs-identifier hs-var">ty</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-743"></span><span>                                 </span><span class="annot"><a href="#local-6989586621683022488"><span class="hs-identifier hs-type">term</span></a></span><span>
</span><span id="line-744"></span><span>                      </span><span class="annot"><a href="GHC.Runtime.Heap.Inspect.html#zonkTerm"><span class="hs-identifier hs-type">zonkTerm</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683022495"><span class="hs-identifier hs-type">zterm'</span></a></span><span>
</span><span id="line-745"></span><span>   </span><span class="annot"><a href="GHC.Runtime.Heap.Inspect.html#traceTR"><span class="hs-identifier hs-type">traceTR</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Utils.Outputable.html#text"><span class="hs-identifier hs-type">text</span></a></span><span> </span><span class="annot"><span class="hs-string">&quot;Term reconstruction completed.&quot;</span></span><span> </span><span class="annot"><a href="GHC.Utils.Outputable.html#%24%24"><span class="hs-operator hs-type">$$</span></a></span><span>
</span><span id="line-746"></span><span>            </span><span class="annot"><a href="GHC.Utils.Outputable.html#text"><span class="hs-identifier hs-type">text</span></a></span><span> </span><span class="annot"><span class="hs-string">&quot;Term obtained: &quot;</span></span><span> </span><span class="annot"><a href="GHC.Utils.Outputable.html#%3C%3E"><span class="hs-operator hs-type">&lt;&gt;</span></a></span><span> </span><span class="annot"><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-type">ppr</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683022476"><span class="hs-identifier hs-type">term</span></a></span><span> </span><span class="annot"><a href="GHC.Utils.Outputable.html#%24%24"><span class="hs-operator hs-type">$$</span></a></span><span>
</span><span id="line-747"></span><span>            </span><span class="annot"><a href="GHC.Utils.Outputable.html#text"><span class="hs-identifier hs-type">text</span></a></span><span> </span><span class="annot"><span class="hs-string">&quot;Type obtained: &quot;</span></span><span> </span><span class="annot"><a href="GHC.Utils.Outputable.html#%3C%3E"><span class="hs-operator hs-type">&lt;&gt;</span></a></span><span> </span><span class="annot"><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-type">ppr</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Runtime.Heap.Inspect.html#termType"><span class="hs-identifier hs-type">termType</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683022476"><span class="hs-identifier hs-type">term</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-748"></span><span>   </span><span class="annot"><span class="hs-identifier hs-type">return</span></span><span> </span><span class="annot"><a href="#local-6989586621683022476"><span class="hs-identifier hs-type">term</span></a></span><span>
</span><span id="line-749"></span><span>    </span><span class="hs-keyword">where</span><span>
</span><span id="line-750"></span><span>  </span><span id="local-6989586621683022500"><span class="annot"><span class="annottext">interp :: Interp
</span><a href="#local-6989586621683022500"><span class="hs-identifier hs-var hs-var">interp</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">HscEnv -&gt; Interp
</span><a href="GHC.Driver.Env.html#hscInterp"><span class="hs-identifier hs-var">hscInterp</span></a></span><span> </span><span class="annot"><span class="annottext">HscEnv
</span><a href="#local-6989586621683022468"><span class="hs-identifier hs-var">hsc_env</span></a></span><span>
</span><span id="line-751"></span><span>  </span><span id="local-6989586621683022502"><span class="annot"><span class="annottext">unit_env :: UnitEnv
</span><a href="#local-6989586621683022502"><span class="hs-identifier hs-var hs-var">unit_env</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">HscEnv -&gt; UnitEnv
</span><a href="GHC.Driver.Env.Types.html#hsc_unit_env"><span class="hs-identifier hs-var">hsc_unit_env</span></a></span><span> </span><span class="annot"><span class="annottext">HscEnv
</span><a href="#local-6989586621683022468"><span class="hs-identifier hs-var">hsc_env</span></a></span><span>
</span><span id="line-752"></span><span>
</span><span id="line-753"></span><span>  </span><span class="annot"><a href="#local-6989586621683022478"><span class="hs-identifier hs-type">go</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Int</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#Type"><span class="hs-identifier hs-type">Type</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#Type"><span class="hs-identifier hs-type">Type</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="../../ghci-9.12.2-bd10/src/GHCi.RemoteTypes.html#ForeignHValue"><span class="hs-identifier hs-type">ForeignHValue</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#TcM"><span class="hs-identifier hs-type">TcM</span></a></span><span> </span><span class="annot"><a href="GHC.Runtime.Heap.Inspect.html#Term"><span class="hs-identifier hs-type">Term</span></a></span><span>
</span><span id="line-754"></span><span>   </span><span class="hs-comment">-- [SPJ May 11] I don't understand the difference between my_ty and old_ty</span><span>
</span><span id="line-755"></span><span>
</span><span id="line-756"></span><span>  </span><span id="local-6989586621683022478"><span class="annot"><span class="annottext">go :: Int -&gt; Type -&gt; Type -&gt; ForeignHValue -&gt; TR Term
</span><a href="#local-6989586621683022478"><span class="hs-identifier hs-var hs-var">go</span></a></span></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">0</span></span><span> </span><span id="local-6989586621683022504"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621683022504"><span class="hs-identifier hs-var">my_ty</span></a></span></span><span> </span><span id="local-6989586621683022505"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621683022505"><span class="hs-identifier hs-var">_old_ty</span></a></span></span><span> </span><span id="local-6989586621683022506"><span class="annot"><span class="annottext">ForeignHValue
</span><a href="#local-6989586621683022506"><span class="hs-identifier hs-var">a</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-757"></span><span>    </span><span class="annot"><span class="annottext">SDoc -&gt; TR ()
</span><a href="GHC.Runtime.Heap.Inspect.html#traceTR"><span class="hs-identifier hs-var">traceTR</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">String -&gt; SDoc
forall doc. IsLine doc =&gt; String -&gt; doc
</span><a href="GHC.Utils.Outputable.html#text"><span class="hs-identifier hs-var">text</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;Gave up reconstructing a term after&quot;</span></span><span> </span><span class="annot"><span class="annottext">SDoc -&gt; SDoc -&gt; SDoc
forall doc. IsLine doc =&gt; doc -&gt; doc -&gt; doc
</span><a href="GHC.Utils.Outputable.html#%3C%3E"><span class="hs-operator hs-var">&lt;&gt;</span></a></span><span>
</span><span id="line-758"></span><span>                  </span><span class="annot"><span class="annottext">Int -&gt; SDoc
forall doc. IsLine doc =&gt; Int -&gt; doc
</span><a href="GHC.Utils.Outputable.html#int"><span class="hs-identifier hs-var">int</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621683022469"><span class="hs-identifier hs-var">max_depth</span></a></span><span> </span><span class="annot"><span class="annottext">SDoc -&gt; SDoc -&gt; SDoc
forall doc. IsLine doc =&gt; doc -&gt; doc -&gt; doc
</span><a href="GHC.Utils.Outputable.html#%3C%3E"><span class="hs-operator hs-var">&lt;&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">String -&gt; SDoc
forall doc. IsLine doc =&gt; String -&gt; doc
</span><a href="GHC.Utils.Outputable.html#text"><span class="hs-identifier hs-var">text</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot; steps&quot;</span></span><span class="hs-special">)</span><span>
</span><span id="line-759"></span><span>    </span><span id="local-6989586621683022507"><span class="annot"><a href="#local-6989586621683022507"><span class="hs-identifier hs-var">clos</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">IO (GenClosure ForeignHValue) -&gt; TR (GenClosure ForeignHValue)
forall a. IO a -&gt; TR a
</span><a href="GHC.Runtime.Heap.Inspect.html#trIO"><span class="hs-identifier hs-var">trIO</span></a></span><span> </span><span class="annot"><span class="annottext">(IO (GenClosure ForeignHValue) -&gt; TR (GenClosure ForeignHValue))
-&gt; IO (GenClosure ForeignHValue) -&gt; TR (GenClosure ForeignHValue)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Interp -&gt; ForeignHValue -&gt; IO (GenClosure ForeignHValue)
</span><a href="GHC.Runtime.Interpreter.html#getClosure"><span class="hs-identifier hs-var">GHCi.getClosure</span></a></span><span> </span><span class="annot"><span class="annottext">Interp
</span><a href="#local-6989586621683022500"><span class="hs-identifier hs-var">interp</span></a></span><span> </span><span class="annot"><span class="annottext">ForeignHValue
</span><a href="#local-6989586621683022506"><span class="hs-identifier hs-var">a</span></a></span><span>
</span><span id="line-760"></span><span>    </span><span class="annot"><span class="hs-identifier hs-type">return</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Runtime.Heap.Inspect.html#Suspension"><span class="hs-identifier hs-type">Suspension</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../../ghc-heap-9.12.2-4363/src/GHC.Exts.Heap.InfoTable.Types.html#tipe"><span class="hs-identifier hs-var">tipe</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../../ghc-heap-9.12.2-4363/src/GHC.Exts.Heap.Closures.html#info"><span class="hs-identifier hs-var">info</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683022507"><span class="hs-identifier hs-type">clos</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="annot"><a href="#local-6989586621683022504"><span class="hs-identifier hs-type">my_ty</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683022506"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Nothing</span></span><span class="hs-special">)</span><span>
</span><span id="line-761"></span><span>  </span><span class="annot"><a href="#local-6989586621683022478"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="hs-glyph">!</span><span id="local-6989586621683022511"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621683022511"><span class="hs-identifier hs-var">max_depth</span></a></span></span><span> </span><span id="local-6989586621683022512"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621683022512"><span class="hs-identifier hs-var">my_ty</span></a></span></span><span> </span><span id="local-6989586621683022513"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621683022513"><span class="hs-identifier hs-var">old_ty</span></a></span></span><span> </span><span id="local-6989586621683022514"><span class="annot"><span class="annottext">ForeignHValue
</span><a href="#local-6989586621683022514"><span class="hs-identifier hs-var">a</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-762"></span><span>    </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621683022515"><span class="annot"><span class="annottext">monomorphic :: Bool
</span><a href="#local-6989586621683022515"><span class="hs-identifier hs-var hs-var hs-var">monomorphic</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Bool
</span><span class="hs-identifier hs-var">not</span></span><span class="hs-special">(</span><span class="annot"><span class="annottext">Type -&gt; Bool
</span><a href="GHC.Core.Type.html#isTyVarTy"><span class="hs-identifier hs-var">isTyVarTy</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621683022512"><span class="hs-identifier hs-var">my_ty</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-763"></span><span>    </span><span class="hs-comment">-- This ^^^ is a convention. The ancestor tests for</span><span>
</span><span id="line-764"></span><span>    </span><span class="hs-comment">-- monomorphism and passes a type instead of a tv</span><span>
</span><span id="line-765"></span><span>    </span><span id="local-6989586621683022517"><span class="annot"><a href="#local-6989586621683022517"><span class="hs-identifier hs-var">clos</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">IO (GenClosure ForeignHValue) -&gt; TR (GenClosure ForeignHValue)
forall a. IO a -&gt; TR a
</span><a href="GHC.Runtime.Heap.Inspect.html#trIO"><span class="hs-identifier hs-var">trIO</span></a></span><span> </span><span class="annot"><span class="annottext">(IO (GenClosure ForeignHValue) -&gt; TR (GenClosure ForeignHValue))
-&gt; IO (GenClosure ForeignHValue) -&gt; TR (GenClosure ForeignHValue)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Interp -&gt; ForeignHValue -&gt; IO (GenClosure ForeignHValue)
</span><a href="GHC.Runtime.Interpreter.html#getClosure"><span class="hs-identifier hs-var">GHCi.getClosure</span></a></span><span> </span><span class="annot"><span class="annottext">Interp
</span><a href="#local-6989586621683022500"><span class="hs-identifier hs-var">interp</span></a></span><span> </span><span class="annot"><span class="annottext">ForeignHValue
</span><a href="#local-6989586621683022514"><span class="hs-identifier hs-var">a</span></a></span><span>
</span><span id="line-766"></span><span>    </span><span class="hs-keyword">case</span><span> </span><span class="annot"><a href="#local-6989586621683022517"><span class="hs-identifier hs-type">clos</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-767"></span><span class="hs-comment">-- Thunks we may want to force</span><span>
</span><span id="line-768"></span><span>      </span><span id="local-6989586621683022518"><span class="annot"><span class="annottext">GenClosure ForeignHValue
</span><a href="#local-6989586621683022518"><span class="hs-identifier hs-var">t</span></a></span></span><span> </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">GenClosure ForeignHValue -&gt; Bool
forall a. GenClosure a -&gt; Bool
</span><a href="GHC.Runtime.Heap.Inspect.html#isThunk"><span class="hs-identifier hs-var">isThunk</span></a></span><span> </span><span class="annot"><span class="annottext">GenClosure ForeignHValue
</span><a href="#local-6989586621683022518"><span class="hs-identifier hs-var">t</span></a></span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Bool -&gt; Bool
</span><span class="hs-operator hs-var">&amp;&amp;</span></span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621683022470"><span class="hs-identifier hs-var">force</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-769"></span><span>         </span><span class="annot"><span class="annottext">SDoc -&gt; TR ()
</span><a href="GHC.Runtime.Heap.Inspect.html#traceTR"><span class="hs-identifier hs-var">traceTR</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">String -&gt; SDoc
forall doc. IsLine doc =&gt; String -&gt; doc
</span><a href="GHC.Utils.Outputable.html#text"><span class="hs-identifier hs-var">text</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;Forcing a &quot;</span></span><span> </span><span class="annot"><span class="annottext">SDoc -&gt; SDoc -&gt; SDoc
forall doc. IsLine doc =&gt; doc -&gt; doc -&gt; doc
</span><a href="GHC.Utils.Outputable.html#%3C%3E"><span class="hs-operator hs-var">&lt;&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">String -&gt; SDoc
forall doc. IsLine doc =&gt; String -&gt; doc
</span><a href="GHC.Utils.Outputable.html#text"><span class="hs-identifier hs-var">text</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">GenClosure () -&gt; String
forall a. Show a =&gt; a -&gt; String
</span><span class="hs-identifier hs-var">show</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(ForeignHValue -&gt; ()) -&gt; GenClosure ForeignHValue -&gt; GenClosure ()
forall a b. (a -&gt; b) -&gt; GenClosure a -&gt; GenClosure b
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-identifier hs-var">fmap</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">() -&gt; ForeignHValue -&gt; ()
forall a b. a -&gt; b -&gt; a
</span><span class="hs-identifier hs-var">const</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">GenClosure ForeignHValue
</span><a href="#local-6989586621683022518"><span class="hs-identifier hs-var">t</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-770"></span><span>         </span><span id="local-6989586621683022519"><span class="annot"><a href="#local-6989586621683022519"><span class="hs-identifier hs-var">evalRslt</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">IO (EvalResult ()) -&gt; IOEnv (Env TcGblEnv TcLclEnv) (EvalResult ())
forall a. IO a -&gt; TR a
forall (m :: * -&gt; *) a. MonadIO m =&gt; IO a -&gt; m a
</span><span class="hs-identifier hs-var">liftIO</span></span><span> </span><span class="annot"><span class="annottext">(IO (EvalResult ())
 -&gt; IOEnv (Env TcGblEnv TcLclEnv) (EvalResult ()))
-&gt; IO (EvalResult ())
-&gt; IOEnv (Env TcGblEnv TcLclEnv) (EvalResult ())
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Interp -&gt; UnitEnv -&gt; ForeignHValue -&gt; IO (EvalResult ())
</span><a href="GHC.Runtime.Interpreter.html#seqHValue"><span class="hs-identifier hs-var">GHCi.seqHValue</span></a></span><span> </span><span class="annot"><span class="annottext">Interp
</span><a href="#local-6989586621683022500"><span class="hs-identifier hs-var">interp</span></a></span><span> </span><span class="annot"><span class="annottext">UnitEnv
</span><a href="#local-6989586621683022502"><span class="hs-identifier hs-var">unit_env</span></a></span><span> </span><span class="annot"><span class="annottext">ForeignHValue
</span><a href="#local-6989586621683022514"><span class="hs-identifier hs-var">a</span></a></span><span>
</span><span id="line-771"></span><span>         </span><span class="hs-keyword">case</span><span> </span><span class="annot"><a href="#local-6989586621683022519"><span class="hs-identifier hs-type">evalRslt</span></a></span><span> </span><span class="hs-keyword">of</span><span>                                            </span><span class="hs-comment">-- #2950</span><span>
</span><span id="line-772"></span><span>           </span><span class="annot"><a href="../../ghci-9.12.2-bd10/src/GHCi.Message.html#EvalSuccess"><span class="hs-identifier hs-type">EvalSuccess</span></a></span><span> </span><span class="annot"><span class="annottext">()
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Int -&gt; Type -&gt; Type -&gt; ForeignHValue -&gt; TR Term
</span><a href="#local-6989586621683022478"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int -&gt; Int
forall a. Enum a =&gt; a -&gt; a
</span><span class="hs-identifier hs-var">pred</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621683022511"><span class="hs-identifier hs-var">max_depth</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621683022512"><span class="hs-identifier hs-var">my_ty</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621683022513"><span class="hs-identifier hs-var">old_ty</span></a></span><span> </span><span class="annot"><span class="annottext">ForeignHValue
</span><a href="#local-6989586621683022514"><span class="hs-identifier hs-var">a</span></a></span><span>
</span><span id="line-773"></span><span>           </span><span class="annot"><a href="../../ghci-9.12.2-bd10/src/GHCi.Message.html#EvalException"><span class="hs-identifier hs-type">EvalException</span></a></span><span> </span><span id="local-6989586621683022524"><span class="annot"><span class="annottext">SerializableException
</span><a href="#local-6989586621683022524"><span class="hs-identifier hs-var">ex</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-774"></span><span>              </span><span class="hs-comment">-- Report the exception to the UI</span><span>
</span><span id="line-775"></span><span>              </span><span class="annot"><span class="annottext">SDoc -&gt; TR ()
</span><a href="GHC.Runtime.Heap.Inspect.html#traceTR"><span class="hs-identifier hs-var">traceTR</span></a></span><span> </span><span class="annot"><span class="annottext">(SDoc -&gt; TR ()) -&gt; SDoc -&gt; TR ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">String -&gt; SDoc
forall doc. IsLine doc =&gt; String -&gt; doc
</span><a href="GHC.Utils.Outputable.html#text"><span class="hs-identifier hs-var">text</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;Exception occurred:&quot;</span></span><span> </span><span class="annot"><span class="annottext">SDoc -&gt; SDoc -&gt; SDoc
forall doc. IsLine doc =&gt; doc -&gt; doc -&gt; doc
</span><a href="GHC.Utils.Outputable.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">String -&gt; SDoc
forall doc. IsLine doc =&gt; String -&gt; doc
</span><a href="GHC.Utils.Outputable.html#text"><span class="hs-identifier hs-var">text</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">SerializableException -&gt; String
forall a. Show a =&gt; a -&gt; String
</span><span class="hs-identifier hs-var">show</span></span><span> </span><span class="annot"><span class="annottext">SerializableException
</span><a href="#local-6989586621683022524"><span class="hs-identifier hs-var">ex</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-776"></span><span>              </span><span class="annot"><span class="annottext">IO Term -&gt; TR Term
forall a. IO a -&gt; TR a
forall (m :: * -&gt; *) a. MonadIO m =&gt; IO a -&gt; m a
</span><span class="hs-identifier hs-var">liftIO</span></span><span> </span><span class="annot"><span class="annottext">(IO Term -&gt; TR Term) -&gt; IO Term -&gt; TR Term
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">SomeException -&gt; IO Term
forall e a. (HasCallStack, Exception e) =&gt; e -&gt; IO a
</span><span class="hs-identifier hs-var">throwIO</span></span><span> </span><span class="annot"><span class="annottext">(SomeException -&gt; IO Term) -&gt; SomeException -&gt; IO Term
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">SerializableException -&gt; SomeException
</span><a href="../../ghci-9.12.2-bd10/src/GHCi.Message.html#fromSerializableException"><span class="hs-identifier hs-var">fromSerializableException</span></a></span><span> </span><span class="annot"><span class="annottext">SerializableException
</span><a href="#local-6989586621683022524"><span class="hs-identifier hs-var">ex</span></a></span><span>
</span><span id="line-777"></span><span class="hs-comment">-- Blackholes are indirections iff the payload is not TSO or BLOCKING_QUEUE. If</span><span>
</span><span id="line-778"></span><span class="hs-comment">-- the indirection is a TSO or BLOCKING_QUEUE, we return the BLACKHOLE itself as</span><span>
</span><span id="line-779"></span><span class="hs-comment">-- the suspension so that entering it in GHCi will enter the BLACKHOLE instead</span><span>
</span><span id="line-780"></span><span class="hs-comment">-- of entering the TSO or BLOCKING_QUEUE (which leads to runtime panic).</span><span>
</span><span id="line-781"></span><span>      </span><span class="annot"><a href="../../ghc-heap-9.12.2-4363/src/GHC.Exts.Heap.Closures.html#BlackholeClosure"><span class="hs-identifier hs-type">BlackholeClosure</span></a></span><span class="hs-special">{</span><span class="annot"><span class="annottext">indirectee :: forall b. GenClosure b -&gt; b
</span><a href="../../ghc-heap-9.12.2-4363/src/GHC.Exts.Heap.Closures.html#indirectee"><span class="hs-identifier hs-var">indirectee</span></a></span><span class="hs-glyph">=</span><span id="local-6989586621683022527"><span class="annot"><span class="annottext">ForeignHValue
</span><a href="#local-6989586621683022527"><span class="hs-identifier hs-var">ind</span></a></span></span><span class="hs-special">}</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-782"></span><span>         </span><span class="annot"><span class="annottext">SDoc -&gt; TR ()
</span><a href="GHC.Runtime.Heap.Inspect.html#traceTR"><span class="hs-identifier hs-var">traceTR</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">String -&gt; SDoc
forall doc. IsLine doc =&gt; String -&gt; doc
</span><a href="GHC.Utils.Outputable.html#text"><span class="hs-identifier hs-var">text</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;Following a BLACKHOLE&quot;</span></span><span class="hs-special">)</span><span>
</span><span id="line-783"></span><span>         </span><span id="local-6989586621683022528"><span class="annot"><a href="#local-6989586621683022528"><span class="hs-identifier hs-var">ind_clos</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">IO (GenClosure ForeignHValue) -&gt; TR (GenClosure ForeignHValue)
forall a. IO a -&gt; TR a
</span><a href="GHC.Runtime.Heap.Inspect.html#trIO"><span class="hs-identifier hs-var">trIO</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Interp -&gt; ForeignHValue -&gt; IO (GenClosure ForeignHValue)
</span><a href="GHC.Runtime.Interpreter.html#getClosure"><span class="hs-identifier hs-var">GHCi.getClosure</span></a></span><span> </span><span class="annot"><span class="annottext">Interp
</span><a href="#local-6989586621683022500"><span class="hs-identifier hs-var">interp</span></a></span><span> </span><span class="annot"><span class="annottext">ForeignHValue
</span><a href="#local-6989586621683022527"><span class="hs-identifier hs-var">ind</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-784"></span><span>         </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621683022529"><span class="annot"><a href="#local-6989586621683022529"><span class="hs-identifier hs-var hs-var">return_bh_value</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Term -&gt; TR Term
forall a. a -&gt; IOEnv (Env TcGblEnv TcLclEnv) a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ClosureType -&gt; Type -&gt; ForeignHValue -&gt; Maybe Name -&gt; Term
</span><a href="GHC.Runtime.Heap.Inspect.html#Suspension"><span class="hs-identifier hs-var">Suspension</span></a></span><span> </span><span class="annot"><span class="annottext">ClosureType
</span><span class="hs-identifier hs-var">BLACKHOLE</span></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621683022512"><span class="hs-identifier hs-var">my_ty</span></a></span><span> </span><span class="annot"><span class="annottext">ForeignHValue
</span><a href="#local-6989586621683022514"><span class="hs-identifier hs-var">a</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe Name
forall a. Maybe a
</span><span class="hs-identifier hs-var">Nothing</span></span><span class="hs-special">)</span><span>
</span><span id="line-785"></span><span>         </span><span class="hs-keyword">case</span><span> </span><span class="annot"><a href="#local-6989586621683022528"><span class="hs-identifier hs-type">ind_clos</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-786"></span><span>           </span><span class="hs-comment">-- TSO and BLOCKING_QUEUE cases</span><span>
</span><span id="line-787"></span><span>           </span><span class="annot"><a href="../../ghc-heap-9.12.2-4363/src/GHC.Exts.Heap.Closures.html#BlockingQueueClosure"><span class="hs-identifier hs-type">BlockingQueueClosure</span></a></span><span class="hs-special">{</span><span class="hs-special">}</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">TR Term
</span><a href="#local-6989586621683022529"><span class="hs-identifier hs-var">return_bh_value</span></a></span><span>
</span><span id="line-788"></span><span>           </span><span class="annot"><a href="../../ghc-heap-9.12.2-4363/src/GHC.Exts.Heap.Closures.html#OtherClosure"><span class="hs-identifier hs-type">OtherClosure</span></a></span><span> </span><span id="local-6989586621683022533"><span class="annot"><span class="annottext">StgInfoTable
</span><a href="#local-6989586621683022533"><span class="hs-identifier hs-var">info</span></a></span></span><span> </span><span class="annot"><span class="annottext">[ForeignHValue]
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">[Word]
</span><span class="hs-identifier">_</span></span><span>
</span><span id="line-789"></span><span>             </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">StgInfoTable -&gt; ClosureType
</span><a href="../../ghc-heap-9.12.2-4363/src/GHC.Exts.Heap.InfoTable.Types.html#tipe"><span class="hs-identifier hs-var">tipe</span></a></span><span> </span><span class="annot"><span class="annottext">StgInfoTable
</span><a href="#local-6989586621683022533"><span class="hs-identifier hs-var">info</span></a></span><span> </span><span class="annot"><span class="annottext">ClosureType -&gt; ClosureType -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">==</span></span><span> </span><span class="annot"><span class="annottext">ClosureType
</span><span class="hs-identifier hs-var">TSO</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">TR Term
</span><a href="#local-6989586621683022529"><span class="hs-identifier hs-var">return_bh_value</span></a></span><span>
</span><span id="line-790"></span><span>           </span><span class="annot"><a href="../../ghc-heap-9.12.2-4363/src/GHC.Exts.Heap.Closures.html#UnsupportedClosure"><span class="hs-identifier hs-type">UnsupportedClosure</span></a></span><span> </span><span id="local-6989586621683022536"><span class="annot"><span class="annottext">StgInfoTable
</span><a href="#local-6989586621683022536"><span class="hs-identifier hs-var">info</span></a></span></span><span>
</span><span id="line-791"></span><span>             </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">StgInfoTable -&gt; ClosureType
</span><a href="../../ghc-heap-9.12.2-4363/src/GHC.Exts.Heap.InfoTable.Types.html#tipe"><span class="hs-identifier hs-var">tipe</span></a></span><span> </span><span class="annot"><span class="annottext">StgInfoTable
</span><a href="#local-6989586621683022536"><span class="hs-identifier hs-var">info</span></a></span><span> </span><span class="annot"><span class="annottext">ClosureType -&gt; ClosureType -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">==</span></span><span> </span><span class="annot"><span class="annottext">ClosureType
</span><span class="hs-identifier hs-var">TSO</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">TR Term
</span><a href="#local-6989586621683022529"><span class="hs-identifier hs-var">return_bh_value</span></a></span><span>
</span><span id="line-792"></span><span>           </span><span class="hs-comment">-- Otherwise follow the indirectee</span><span>
</span><span id="line-793"></span><span>           </span><span class="hs-comment">-- (NOTE: This code will break if we support TSO in ghc-heap one day)</span><span>
</span><span id="line-794"></span><span>           </span><span class="annot"><span class="annottext">GenClosure ForeignHValue
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Int -&gt; Type -&gt; Type -&gt; ForeignHValue -&gt; TR Term
</span><a href="#local-6989586621683022478"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621683022511"><span class="hs-identifier hs-var">max_depth</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621683022512"><span class="hs-identifier hs-var">my_ty</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621683022513"><span class="hs-identifier hs-var">old_ty</span></a></span><span> </span><span class="annot"><span class="annottext">ForeignHValue
</span><a href="#local-6989586621683022527"><span class="hs-identifier hs-var">ind</span></a></span><span>
</span><span id="line-795"></span><span class="hs-comment">-- We always follow indirections</span><span>
</span><span id="line-796"></span><span>      </span><span class="annot"><a href="../../ghc-heap-9.12.2-4363/src/GHC.Exts.Heap.Closures.html#IndClosure"><span class="hs-identifier hs-type">IndClosure</span></a></span><span class="hs-special">{</span><span class="annot"><span class="annottext">indirectee :: forall b. GenClosure b -&gt; b
</span><a href="../../ghc-heap-9.12.2-4363/src/GHC.Exts.Heap.Closures.html#indirectee"><span class="hs-identifier hs-var">indirectee</span></a></span><span class="hs-glyph">=</span><span id="local-6989586621683022538"><span class="annot"><span class="annottext">ForeignHValue
</span><a href="#local-6989586621683022538"><span class="hs-identifier hs-var">ind</span></a></span></span><span class="hs-special">}</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-797"></span><span>         </span><span class="annot"><span class="annottext">SDoc -&gt; TR ()
</span><a href="GHC.Runtime.Heap.Inspect.html#traceTR"><span class="hs-identifier hs-var">traceTR</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">String -&gt; SDoc
forall doc. IsLine doc =&gt; String -&gt; doc
</span><a href="GHC.Utils.Outputable.html#text"><span class="hs-identifier hs-var">text</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;Following an indirection&quot;</span></span><span> </span><span class="hs-special">)</span><span>
</span><span id="line-798"></span><span>         </span><span class="annot"><span class="annottext">Int -&gt; Type -&gt; Type -&gt; ForeignHValue -&gt; TR Term
</span><a href="#local-6989586621683022478"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621683022511"><span class="hs-identifier hs-var">max_depth</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621683022512"><span class="hs-identifier hs-var">my_ty</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621683022513"><span class="hs-identifier hs-var">old_ty</span></a></span><span> </span><span class="annot"><span class="annottext">ForeignHValue
</span><a href="#local-6989586621683022538"><span class="hs-identifier hs-var">ind</span></a></span><span>
</span><span id="line-799"></span><span class="hs-comment">-- We also follow references</span><span>
</span><span id="line-800"></span><span>      </span><span class="annot"><a href="../../ghc-heap-9.12.2-4363/src/GHC.Exts.Heap.Closures.html#MutVarClosure"><span class="hs-identifier hs-type">MutVarClosure</span></a></span><span class="hs-special">{</span><span class="annot"><span class="annottext">var :: forall b. GenClosure b -&gt; b
</span><a href="../../ghc-heap-9.12.2-4363/src/GHC.Exts.Heap.Closures.html#var"><span class="hs-identifier hs-var">var</span></a></span><span class="hs-glyph">=</span><span id="local-6989586621683022541"><span class="annot"><span class="annottext">ForeignHValue
</span><a href="#local-6989586621683022541"><span class="hs-identifier hs-var">contents</span></a></span></span><span class="hs-special">}</span><span>
</span><span id="line-801"></span><span>         </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span class="hs-special">(</span><span id="local-6989586621683022542"><span class="annot"><span class="annottext">TyCon
</span><a href="#local-6989586621683022542"><span class="hs-identifier hs-var">tycon</span></a></span></span><span class="hs-special">,</span><span class="hs-special">[</span><span id="local-6989586621683022543"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621683022543"><span class="hs-identifier hs-var">lev</span></a></span></span><span class="hs-special">,</span><span id="local-6989586621683022544"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621683022544"><span class="hs-identifier hs-var">world</span></a></span></span><span class="hs-special">,</span><span id="local-6989586621683022545"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621683022545"><span class="hs-identifier hs-var">contents_ty</span></a></span></span><span class="hs-special">]</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">HasDebugCallStack =&gt; Type -&gt; Maybe (TyCon, [Type])
Type -&gt; Maybe (TyCon, [Type])
</span><a href="GHC.Core.Type.html#tcSplitTyConApp_maybe"><span class="hs-identifier hs-var">tcSplitTyConApp_maybe</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621683022513"><span class="hs-identifier hs-var">old_ty</span></a></span><span>
</span><span id="line-802"></span><span>             </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-803"></span><span>                  </span><span class="hs-comment">-- Deal with the MutVar# primitive</span><span>
</span><span id="line-804"></span><span>                  </span><span class="hs-comment">-- It does not have a constructor at all,</span><span>
</span><span id="line-805"></span><span>                  </span><span class="hs-comment">-- so we simulate the following one</span><span>
</span><span id="line-806"></span><span>                  </span><span class="hs-comment">-- MutVar# :: contents_ty -&gt; MutVar# s contents_ty</span><span>
</span><span id="line-807"></span><span>         </span><span class="annot"><span class="annottext">Bool -&gt; TR ()
forall (m :: * -&gt; *). (HasCallStack, Applicative m) =&gt; Bool -&gt; m ()
</span><a href="GHC.Utils.Panic.Plain.html#massert"><span class="hs-identifier hs-var">massert</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TyCon
</span><a href="#local-6989586621683022542"><span class="hs-identifier hs-var">tycon</span></a></span><span> </span><span class="annot"><span class="annottext">TyCon -&gt; TyCon -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">==</span></span><span> </span><span class="annot"><span class="annottext">TyCon
</span><a href="GHC.Builtin.Types.Prim.html#mutVarPrimTyCon"><span class="hs-identifier hs-var">mutVarPrimTyCon</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-808"></span><span>         </span><span class="annot"><span class="annottext">Bool -&gt; TR ()
forall (m :: * -&gt; *). (HasCallStack, Applicative m) =&gt; Bool -&gt; m ()
</span><a href="GHC.Utils.Panic.Plain.html#massert"><span class="hs-identifier hs-var">massert</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">HasDebugCallStack =&gt; Type -&gt; Bool
Type -&gt; Bool
</span><a href="GHC.Core.Type.html#isUnliftedType"><span class="hs-identifier hs-var">isUnliftedType</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621683022512"><span class="hs-identifier hs-var">my_ty</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-809"></span><span>         </span><span class="annot"><span class="annottext">SDoc -&gt; TR ()
</span><a href="GHC.Runtime.Heap.Inspect.html#traceTR"><span class="hs-identifier hs-var">traceTR</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">String -&gt; SDoc
forall doc. IsLine doc =&gt; String -&gt; doc
</span><a href="GHC.Utils.Outputable.html#text"><span class="hs-identifier hs-var">text</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;Following a MutVar&quot;</span></span><span class="hs-special">)</span><span>
</span><span id="line-810"></span><span>         </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621683022549"><span class="annot"><span class="annottext">contents_kind :: Type
</span><a href="#local-6989586621683022549"><span class="hs-identifier hs-var hs-var hs-var">contents_kind</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Type -&gt; Type
</span><a href="GHC.Core.Type.html#mkTYPEapp"><span class="hs-identifier hs-var">mkTYPEapp</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TyCon -&gt; [Type] -&gt; Type
</span><a href="GHC.Core.Type.html#mkTyConApp"><span class="hs-identifier hs-var">mkTyConApp</span></a></span><span> </span><span class="annot"><span class="annottext">TyCon
</span><a href="GHC.Builtin.Types.html#boxedRepDataConTyCon"><span class="hs-identifier hs-var">boxedRepDataConTyCon</span></a></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621683022543"><span class="hs-identifier hs-var">lev</span></a></span><span class="hs-special">]</span><span class="hs-special">)</span><span>
</span><span id="line-811"></span><span>         </span><span id="local-6989586621683022553"><span class="annot"><a href="#local-6989586621683022553"><span class="hs-identifier hs-var">contents_tv</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Type -&gt; TR Type
</span><a href="GHC.Runtime.Heap.Inspect.html#newVar"><span class="hs-identifier hs-var">newVar</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621683022549"><span class="hs-identifier hs-var">contents_kind</span></a></span><span>
</span><span id="line-812"></span><span>         </span><span class="hs-special">(</span><span id="local-6989586621683022554"><span class="annot"><a href="#local-6989586621683022554"><span class="hs-identifier hs-var">mutvar_ty</span></a></span></span><span class="hs-special">,</span><span class="annot"><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><a href="GHC.Runtime.Heap.Inspect.html#instScheme"><span class="hs-identifier hs-type">instScheme</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="annot"><a href="GHC.Runtime.Heap.Inspect.html#quantifyType"><span class="hs-identifier hs-type">quantifyType</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#mkVisFunTyMany"><span class="hs-identifier hs-type">mkVisFunTyMany</span></a></span><span>
</span><span id="line-813"></span><span>                            </span><span class="annot"><a href="#local-6989586621683022545"><span class="hs-identifier hs-type">contents_ty</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Core.Type.html#mkTyConApp"><span class="hs-identifier hs-type">mkTyConApp</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683022542"><span class="hs-identifier hs-type">tycon</span></a></span><span> </span><span class="hs-special">[</span><span class="annot"><a href="#local-6989586621683022543"><span class="hs-identifier hs-type">lev</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="#local-6989586621683022544"><span class="hs-identifier hs-type">world</span></a></span><span class="hs-special">,</span><span class="annot"><a href="#local-6989586621683022545"><span class="hs-identifier hs-type">contents_ty</span></a></span><span class="hs-special">]</span><span class="hs-special">)</span><span>
</span><span id="line-814"></span><span>         </span><span class="annot"><a href="GHC.Runtime.Heap.Inspect.html#addConstraint"><span class="hs-identifier hs-type">addConstraint</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#mkVisFunTyMany"><span class="hs-identifier hs-type">mkVisFunTyMany</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683022553"><span class="hs-identifier hs-type">contents_tv</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683022512"><span class="hs-identifier hs-type">my_ty</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><a href="#local-6989586621683022554"><span class="hs-identifier hs-type">mutvar_ty</span></a></span><span>
</span><span id="line-815"></span><span>         </span><span id="local-6989586621683022556"><span class="annot"><a href="#local-6989586621683022556"><span class="hs-identifier hs-var">x</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><a href="#local-6989586621683022478"><span class="hs-identifier hs-type">go</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">pred</span></span><span> </span><span class="annot"><a href="#local-6989586621683022511"><span class="hs-identifier hs-type">max_depth</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><a href="#local-6989586621683022553"><span class="hs-identifier hs-type">contents_tv</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683022545"><span class="hs-identifier hs-type">contents_ty</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683022541"><span class="hs-identifier hs-type">contents</span></a></span><span>
</span><span id="line-816"></span><span>         </span><span class="annot"><span class="hs-identifier hs-type">return</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Runtime.Heap.Inspect.html#RefWrap"><span class="hs-identifier hs-type">RefWrap</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683022512"><span class="hs-identifier hs-type">my_ty</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683022556"><span class="hs-identifier hs-type">x</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-817"></span><span>
</span><span id="line-818"></span><span> </span><span class="hs-comment">-- The interesting case</span><span>
</span><span id="line-819"></span><span>      </span><span class="annot"><a href="../../ghc-heap-9.12.2-4363/src/GHC.Exts.Heap.Closures.html#ConstrClosure"><span class="hs-identifier hs-type">ConstrClosure</span></a></span><span class="hs-special">{</span><span class="annot"><span class="annottext">ptrArgs :: forall b. GenClosure b -&gt; [b]
</span><a href="../../ghc-heap-9.12.2-4363/src/GHC.Exts.Heap.Closures.html#ptrArgs"><span class="hs-identifier hs-var">ptrArgs</span></a></span><span class="hs-glyph">=</span><span id="local-6989586621683022558"><span class="annot"><span class="annottext">[ForeignHValue]
</span><a href="#local-6989586621683022558"><span class="hs-identifier hs-var">pArgs</span></a></span></span><span class="hs-special">,</span><span class="annot"><span class="annottext">dataArgs :: forall b. GenClosure b -&gt; [Word]
</span><a href="../../ghc-heap-9.12.2-4363/src/GHC.Exts.Heap.Closures.html#dataArgs"><span class="hs-identifier hs-var">dataArgs</span></a></span><span class="hs-glyph">=</span><span id="local-6989586621683022560"><span class="annot"><span class="annottext">[Word]
</span><a href="#local-6989586621683022560"><span class="hs-identifier hs-var">dArgs</span></a></span></span><span class="hs-special">}</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-820"></span><span>        </span><span class="annot"><span class="annottext">SDoc -&gt; TR ()
</span><a href="GHC.Runtime.Heap.Inspect.html#traceTR"><span class="hs-identifier hs-var">traceTR</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">String -&gt; SDoc
forall doc. IsLine doc =&gt; String -&gt; doc
</span><a href="GHC.Utils.Outputable.html#text"><span class="hs-identifier hs-var">text</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;entering a constructor &quot;</span></span><span> </span><span class="annot"><span class="annottext">SDoc -&gt; SDoc -&gt; SDoc
forall doc. IsLine doc =&gt; doc -&gt; doc -&gt; doc
</span><a href="GHC.Utils.Outputable.html#%3C%3E"><span class="hs-operator hs-var">&lt;&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">[Word] -&gt; SDoc
forall a. Outputable a =&gt; a -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="annot"><span class="annottext">[Word]
</span><a href="#local-6989586621683022560"><span class="hs-identifier hs-var">dArgs</span></a></span><span> </span><span class="annot"><span class="annottext">SDoc -&gt; SDoc -&gt; SDoc
forall doc. IsLine doc =&gt; doc -&gt; doc -&gt; doc
</span><a href="GHC.Utils.Outputable.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a></span><span>
</span><span id="line-821"></span><span>                      </span><span class="hs-keyword">if</span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621683022515"><span class="hs-identifier hs-var">monomorphic</span></a></span><span>
</span><span id="line-822"></span><span>                        </span><span class="hs-keyword">then</span><span> </span><span class="annot"><span class="annottext">SDoc -&gt; SDoc
forall doc. IsLine doc =&gt; doc -&gt; doc
</span><a href="GHC.Utils.Outputable.html#parens"><span class="hs-identifier hs-var">parens</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">String -&gt; SDoc
forall doc. IsLine doc =&gt; String -&gt; doc
</span><a href="GHC.Utils.Outputable.html#text"><span class="hs-identifier hs-var">text</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;already monomorphic: &quot;</span></span><span> </span><span class="annot"><span class="annottext">SDoc -&gt; SDoc -&gt; SDoc
forall doc. IsLine doc =&gt; doc -&gt; doc -&gt; doc
</span><a href="GHC.Utils.Outputable.html#%3C%3E"><span class="hs-operator hs-var">&lt;&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">Type -&gt; SDoc
forall a. Outputable a =&gt; a -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621683022512"><span class="hs-identifier hs-var">my_ty</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-823"></span><span>                        </span><span class="hs-keyword">else</span><span> </span><span class="annot"><span class="annottext">SDoc
forall doc. IsOutput doc =&gt; doc
</span><a href="GHC.Utils.Outputable.html#empty"><span class="hs-identifier hs-var">Ppr.empty</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-824"></span><span>        </span><span class="annot"><span class="hs-identifier hs-type">Right</span></span><span> </span><span id="local-6989586621683022562"><span class="annot"><a href="#local-6989586621683022562"><span class="hs-identifier hs-var">dcname</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">IO (Either String Name)
-&gt; IOEnv (Env TcGblEnv TcLclEnv) (Either String Name)
forall a. IO a -&gt; TR a
forall (m :: * -&gt; *) a. MonadIO m =&gt; IO a -&gt; m a
</span><span class="hs-identifier hs-var">liftIO</span></span><span> </span><span class="annot"><span class="annottext">(IO (Either String Name)
 -&gt; IOEnv (Env TcGblEnv TcLclEnv) (Either String Name))
-&gt; IO (Either String Name)
-&gt; IOEnv (Env TcGblEnv TcLclEnv) (Either String Name)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">HscEnv -&gt; GenClosure ForeignHValue -&gt; IO (Either String Name)
forall a. HscEnv -&gt; GenClosure a -&gt; IO (Either String Name)
</span><a href="GHC.Runtime.Heap.Inspect.html#constrClosToName"><span class="hs-identifier hs-var">constrClosToName</span></a></span><span> </span><span class="annot"><span class="annottext">HscEnv
</span><a href="#local-6989586621683022468"><span class="hs-identifier hs-var">hsc_env</span></a></span><span> </span><span class="annot"><span class="annottext">GenClosure ForeignHValue
</span><a href="#local-6989586621683022517"><span class="hs-identifier hs-var">clos</span></a></span><span>
</span><span id="line-825"></span><span>        </span><span class="hs-special">(</span><span id="local-6989586621683022563"><span class="annot"><a href="#local-6989586621683022563"><span class="hs-identifier hs-var">mb_dc</span></a></span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span>   </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.Monad.html#tryTc"><span class="hs-identifier hs-type">tryTc</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Tc.Utils.Env.html#tcLookupDataCon"><span class="hs-identifier hs-type">tcLookupDataCon</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683022562"><span class="hs-identifier hs-type">dcname</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-826"></span><span>        </span><span class="hs-keyword">case</span><span> </span><span class="annot"><a href="#local-6989586621683022563"><span class="hs-identifier hs-type">mb_dc</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-827"></span><span>          </span><span class="annot"><span class="annottext">Maybe DataCon
</span><span class="hs-identifier hs-var">Nothing</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-comment">-- This can happen for private constructors compiled -O0</span><span>
</span><span id="line-828"></span><span>                        </span><span class="hs-comment">-- where the .hi descriptor does not export them</span><span>
</span><span id="line-829"></span><span>                        </span><span class="hs-comment">-- In such case, we return a best approximation:</span><span>
</span><span id="line-830"></span><span>                        </span><span class="hs-comment">--  ignore the unpointed args, and recover the pointed ones</span><span>
</span><span id="line-831"></span><span>                        </span><span class="hs-comment">-- This preserves laziness, and should be safe.</span><span>
</span><span id="line-832"></span><span>                       </span><span class="annot"><span class="annottext">SDoc -&gt; TR ()
</span><a href="GHC.Runtime.Heap.Inspect.html#traceTR"><span class="hs-identifier hs-var">traceTR</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">String -&gt; SDoc
forall doc. IsLine doc =&gt; String -&gt; doc
</span><a href="GHC.Utils.Outputable.html#text"><span class="hs-identifier hs-var">text</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;Not constructor&quot;</span></span><span> </span><span class="annot"><span class="annottext">SDoc -&gt; SDoc -&gt; SDoc
forall doc. IsLine doc =&gt; doc -&gt; doc -&gt; doc
</span><a href="GHC.Utils.Outputable.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">Name -&gt; SDoc
forall a. Outputable a =&gt; a -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621683022562"><span class="hs-identifier hs-var">dcname</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-833"></span><span>                       </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621683022566"><span class="annot"><span class="annottext">dflags :: DynFlags
</span><a href="#local-6989586621683022566"><span class="hs-identifier hs-var hs-var hs-var">dflags</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">HscEnv -&gt; DynFlags
</span><a href="GHC.Driver.Env.Types.html#hsc_dflags"><span class="hs-identifier hs-var">hsc_dflags</span></a></span><span> </span><span class="annot"><span class="annottext">HscEnv
</span><a href="#local-6989586621683022468"><span class="hs-identifier hs-var">hsc_env</span></a></span><span>
</span><span id="line-834"></span><span>                           </span><span id="local-6989586621683022568"><span class="annot"><span class="annottext">tag :: String
</span><a href="#local-6989586621683022568"><span class="hs-identifier hs-var hs-var hs-var">tag</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">DynFlags -&gt; Name -&gt; String
forall a. Outputable a =&gt; DynFlags -&gt; a -&gt; String
</span><a href="GHC.Driver.Ppr.html#showPpr"><span class="hs-identifier hs-var">showPpr</span></a></span><span> </span><span class="annot"><span class="annottext">DynFlags
</span><a href="#local-6989586621683022566"><span class="hs-identifier hs-var">dflags</span></a></span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621683022562"><span class="hs-identifier hs-var">dcname</span></a></span><span>
</span><span id="line-835"></span><span>                       </span><span id="local-6989586621683022570"><span class="annot"><a href="#local-6989586621683022570"><span class="hs-identifier hs-var">vars</span></a></span></span><span>     </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">(ForeignHValue -&gt; TR Type)
-&gt; [ForeignHValue] -&gt; IOEnv (Env TcGblEnv TcLclEnv) [Type]
forall (t :: * -&gt; *) (m :: * -&gt; *) a b.
(Traversable t, Monad m) =&gt;
(a -&gt; m b) -&gt; t a -&gt; m (t b)
forall (m :: * -&gt; *) a b. Monad m =&gt; (a -&gt; m b) -&gt; [a] -&gt; m [b]
</span><span class="hs-identifier hs-var">mapM</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TR Type -&gt; ForeignHValue -&gt; TR Type
forall a b. a -&gt; b -&gt; a
</span><span class="hs-identifier hs-var">const</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Type -&gt; TR Type
</span><a href="GHC.Runtime.Heap.Inspect.html#newVar"><span class="hs-identifier hs-var">newVar</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="GHC.Builtin.Types.html#liftedTypeKind"><span class="hs-identifier hs-var">liftedTypeKind</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[ForeignHValue]
</span><a href="#local-6989586621683022558"><span class="hs-identifier hs-var">pArgs</span></a></span><span>
</span><span id="line-836"></span><span>                       </span><span id="local-6989586621683022572"><span class="annot"><a href="#local-6989586621683022572"><span class="hs-identifier hs-var">subTerms</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="hs-identifier hs-type">sequence</span></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">zipWith</span></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span id="local-6989586621683022575"><span class="annot"><span class="annottext">ForeignHValue
</span><a href="#local-6989586621683022575"><span class="hs-identifier hs-var">x</span></a></span></span><span> </span><span id="local-6989586621683022576"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621683022576"><span class="hs-identifier hs-var">tv</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-837"></span><span>                           </span><span class="annot"><span class="annottext">Int -&gt; Type -&gt; Type -&gt; ForeignHValue -&gt; TR Term
</span><a href="#local-6989586621683022478"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int -&gt; Int
forall a. Enum a =&gt; a -&gt; a
</span><span class="hs-identifier hs-var">pred</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621683022511"><span class="hs-identifier hs-var">max_depth</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621683022576"><span class="hs-identifier hs-var">tv</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621683022576"><span class="hs-identifier hs-var">tv</span></a></span><span> </span><span class="annot"><span class="annottext">ForeignHValue
</span><a href="#local-6989586621683022575"><span class="hs-identifier hs-var">x</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><a href="#local-6989586621683022558"><span class="hs-identifier hs-type">pArgs</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683022570"><span class="hs-identifier hs-type">vars</span></a></span><span>
</span><span id="line-838"></span><span>                       </span><span class="annot"><span class="hs-identifier hs-type">return</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Runtime.Heap.Inspect.html#Term"><span class="hs-identifier hs-type">Term</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683022512"><span class="hs-identifier hs-type">my_ty</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Left</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-char">'&lt;'</span></span><span> </span><span class="annot"><span class="hs-glyph hs-type">:</span></span><span> </span><span class="annot"><a href="#local-6989586621683022568"><span class="hs-identifier hs-type">tag</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">++</span></span><span> </span><span class="annot"><span class="hs-string">&quot;&gt;&quot;</span></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="annot"><a href="#local-6989586621683022514"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683022572"><span class="hs-identifier hs-type">subTerms</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-839"></span><span>          </span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span id="local-6989586621683022577"><span class="annot"><span class="annottext">DataCon
</span><a href="#local-6989586621683022577"><span class="hs-identifier hs-var">dc</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-840"></span><span>            </span><span class="annot"><span class="annottext">SDoc -&gt; TR ()
</span><a href="GHC.Runtime.Heap.Inspect.html#traceTR"><span class="hs-identifier hs-var">traceTR</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">String -&gt; SDoc
forall doc. IsLine doc =&gt; String -&gt; doc
</span><a href="GHC.Utils.Outputable.html#text"><span class="hs-identifier hs-var">text</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;Is constructor&quot;</span></span><span> </span><span class="annot"><span class="annottext">SDoc -&gt; SDoc -&gt; SDoc
forall doc. IsLine doc =&gt; doc -&gt; doc -&gt; doc
</span><a href="GHC.Utils.Outputable.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">DataCon -&gt; SDoc
forall a. Outputable a =&gt; a -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="annot"><span class="annottext">DataCon
</span><a href="#local-6989586621683022577"><span class="hs-identifier hs-var">dc</span></a></span><span> </span><span class="annot"><span class="annottext">SDoc -&gt; SDoc -&gt; SDoc
forall doc. IsDoc doc =&gt; doc -&gt; doc -&gt; doc
</span><a href="GHC.Utils.Outputable.html#%24%24"><span class="hs-operator hs-var">$$</span></a></span><span> </span><span class="annot"><span class="annottext">Type -&gt; SDoc
forall a. Outputable a =&gt; a -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621683022512"><span class="hs-identifier hs-var">my_ty</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-841"></span><span>            </span><span id="local-6989586621683022578"><span class="annot"><a href="#local-6989586621683022578"><span class="hs-identifier hs-var">subTtypes</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">DataCon -&gt; Type -&gt; IOEnv (Env TcGblEnv TcLclEnv) [Type]
</span><a href="GHC.Runtime.Heap.Inspect.html#getDataConArgTys"><span class="hs-identifier hs-var">getDataConArgTys</span></a></span><span> </span><span class="annot"><span class="annottext">DataCon
</span><a href="#local-6989586621683022577"><span class="hs-identifier hs-var">dc</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621683022512"><span class="hs-identifier hs-var">my_ty</span></a></span><span>
</span><span id="line-842"></span><span>            </span><span id="local-6989586621683022580"><span class="annot"><a href="#local-6989586621683022580"><span class="hs-identifier hs-var">subTerms</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><a href="GHC.Runtime.Heap.Inspect.html#extractSubTerms"><span class="hs-identifier hs-type">extractSubTerms</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span id="local-6989586621683022582"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621683022582"><span class="hs-identifier hs-var">ty</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Int -&gt; Type -&gt; Type -&gt; ForeignHValue -&gt; TR Term
</span><a href="#local-6989586621683022478"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int -&gt; Int
forall a. Enum a =&gt; a -&gt; a
</span><span class="hs-identifier hs-var">pred</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621683022511"><span class="hs-identifier hs-var">max_depth</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621683022582"><span class="hs-identifier hs-var">ty</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621683022582"><span class="hs-identifier hs-var">ty</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><a href="#local-6989586621683022517"><span class="hs-identifier hs-type">clos</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683022578"><span class="hs-identifier hs-type">subTtypes</span></a></span><span>
</span><span id="line-843"></span><span>            </span><span class="annot"><span class="hs-identifier hs-type">return</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Runtime.Heap.Inspect.html#Term"><span class="hs-identifier hs-type">Term</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683022512"><span class="hs-identifier hs-type">my_ty</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Right</span></span><span> </span><span class="annot"><a href="#local-6989586621683022577"><span class="hs-identifier hs-type">dc</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><a href="#local-6989586621683022514"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683022580"><span class="hs-identifier hs-type">subTerms</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-844"></span><span>
</span><span id="line-845"></span><span>      </span><span class="hs-comment">-- This is to support printing of Integers. It's not a general</span><span>
</span><span id="line-846"></span><span>      </span><span class="hs-comment">-- mechanism by any means; in particular we lose the size in</span><span>
</span><span id="line-847"></span><span>      </span><span class="hs-comment">-- bytes of the array.</span><span>
</span><span id="line-848"></span><span>      </span><span class="annot"><a href="../../ghc-heap-9.12.2-4363/src/GHC.Exts.Heap.Closures.html#ArrWordsClosure"><span class="hs-identifier hs-type">ArrWordsClosure</span></a></span><span class="hs-special">{</span><span class="annot"><span class="annottext">bytes :: forall b. GenClosure b -&gt; Word
</span><a href="../../ghc-heap-9.12.2-4363/src/GHC.Exts.Heap.Closures.html#bytes"><span class="hs-identifier hs-var">bytes</span></a></span><span class="hs-glyph">=</span><span id="local-6989586621683022585"><span class="annot"><span class="annottext">Word
</span><a href="#local-6989586621683022585"><span class="hs-identifier hs-var">b</span></a></span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">arrWords :: forall b. GenClosure b -&gt; [Word]
</span><a href="../../ghc-heap-9.12.2-4363/src/GHC.Exts.Heap.Closures.html#arrWords"><span class="hs-identifier hs-var">arrWords</span></a></span><span class="hs-glyph">=</span><span id="local-6989586621683022587"><span class="annot"><span class="annottext">[Word]
</span><a href="#local-6989586621683022587"><span class="hs-identifier hs-var">ws</span></a></span></span><span class="hs-special">}</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-849"></span><span>         </span><span class="annot"><span class="annottext">SDoc -&gt; TR ()
</span><a href="GHC.Runtime.Heap.Inspect.html#traceTR"><span class="hs-identifier hs-var">traceTR</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">String -&gt; SDoc
forall doc. IsLine doc =&gt; String -&gt; doc
</span><a href="GHC.Utils.Outputable.html#text"><span class="hs-identifier hs-var">text</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;ByteArray# closure, size &quot;</span></span><span> </span><span class="annot"><span class="annottext">SDoc -&gt; SDoc -&gt; SDoc
forall doc. IsLine doc =&gt; doc -&gt; doc -&gt; doc
</span><a href="GHC.Utils.Outputable.html#%3C%3E"><span class="hs-operator hs-var">&lt;&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">Word -&gt; SDoc
forall a. Outputable a =&gt; a -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="annot"><span class="annottext">Word
</span><a href="#local-6989586621683022585"><span class="hs-identifier hs-var">b</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-850"></span><span>         </span><span class="annot"><span class="annottext">Term -&gt; TR Term
forall a. a -&gt; IOEnv (Env TcGblEnv TcLclEnv) a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TermProcessor Term Term
</span><a href="GHC.Runtime.Heap.Inspect.html#Term"><span class="hs-identifier hs-var">Term</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621683022512"><span class="hs-identifier hs-var">my_ty</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">String -&gt; Either String DataCon
forall a b. a -&gt; Either a b
</span><span class="hs-identifier hs-var">Left</span></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;ByteArray#&quot;</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">ForeignHValue
</span><a href="#local-6989586621683022514"><span class="hs-identifier hs-var">a</span></a></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">Type -&gt; [Word] -&gt; Term
</span><a href="GHC.Runtime.Heap.Inspect.html#Prim"><span class="hs-identifier hs-var">Prim</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621683022512"><span class="hs-identifier hs-var">my_ty</span></a></span><span> </span><span class="annot"><span class="annottext">[Word]
</span><a href="#local-6989586621683022587"><span class="hs-identifier hs-var">ws</span></a></span><span class="hs-special">]</span><span class="hs-special">)</span><span>
</span><span id="line-851"></span><span>
</span><span id="line-852"></span><span class="hs-comment">-- The otherwise case: can be a Thunk,AP,PAP,etc.</span><span>
</span><span id="line-853"></span><span>      </span><span class="annot"><span class="annottext">GenClosure ForeignHValue
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-854"></span><span>         </span><span class="annot"><span class="annottext">SDoc -&gt; TR ()
</span><a href="GHC.Runtime.Heap.Inspect.html#traceTR"><span class="hs-identifier hs-var">traceTR</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">String -&gt; SDoc
forall doc. IsLine doc =&gt; String -&gt; doc
</span><a href="GHC.Utils.Outputable.html#text"><span class="hs-identifier hs-var">text</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;Unknown closure:&quot;</span></span><span> </span><span class="annot"><span class="annottext">SDoc -&gt; SDoc -&gt; SDoc
forall doc. IsLine doc =&gt; doc -&gt; doc -&gt; doc
</span><a href="GHC.Utils.Outputable.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a></span><span>
</span><span id="line-855"></span><span>                  </span><span class="annot"><span class="annottext">String -&gt; SDoc
forall doc. IsLine doc =&gt; String -&gt; doc
</span><a href="GHC.Utils.Outputable.html#text"><span class="hs-identifier hs-var">text</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">GenClosure () -&gt; String
forall a. Show a =&gt; a -&gt; String
</span><span class="hs-identifier hs-var">show</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(ForeignHValue -&gt; ()) -&gt; GenClosure ForeignHValue -&gt; GenClosure ()
forall a b. (a -&gt; b) -&gt; GenClosure a -&gt; GenClosure b
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-identifier hs-var">fmap</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">() -&gt; ForeignHValue -&gt; ()
forall a b. a -&gt; b -&gt; a
</span><span class="hs-identifier hs-var">const</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">GenClosure ForeignHValue
</span><a href="#local-6989586621683022517"><span class="hs-identifier hs-var">clos</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-856"></span><span>         </span><span class="annot"><span class="annottext">Term -&gt; TR Term
forall a. a -&gt; IOEnv (Env TcGblEnv TcLclEnv) a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ClosureType -&gt; Type -&gt; ForeignHValue -&gt; Maybe Name -&gt; Term
</span><a href="GHC.Runtime.Heap.Inspect.html#Suspension"><span class="hs-identifier hs-var">Suspension</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">StgInfoTable -&gt; ClosureType
</span><a href="../../ghc-heap-9.12.2-4363/src/GHC.Exts.Heap.InfoTable.Types.html#tipe"><span class="hs-identifier hs-var">tipe</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">GenClosure ForeignHValue -&gt; StgInfoTable
forall b. GenClosure b -&gt; StgInfoTable
</span><a href="../../ghc-heap-9.12.2-4363/src/GHC.Exts.Heap.Closures.html#info"><span class="hs-identifier hs-var">info</span></a></span><span> </span><span class="annot"><span class="annottext">GenClosure ForeignHValue
</span><a href="#local-6989586621683022517"><span class="hs-identifier hs-var">clos</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621683022512"><span class="hs-identifier hs-var">my_ty</span></a></span><span> </span><span class="annot"><span class="annottext">ForeignHValue
</span><a href="#local-6989586621683022514"><span class="hs-identifier hs-var">a</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe Name
forall a. Maybe a
</span><span class="hs-identifier hs-var">Nothing</span></span><span class="hs-special">)</span><span>
</span><span id="line-857"></span><span>
</span><span id="line-858"></span><span>  </span><span class="hs-comment">-- insert NewtypeWraps around newtypes</span><span>
</span><span id="line-859"></span><span>  </span><span id="local-6989586621683022482"><span class="annot"><span class="annottext">expandNewtypes :: Term -&gt; Term
</span><a href="#local-6989586621683022482"><span class="hs-identifier hs-var hs-var">expandNewtypes</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">TermFold Term -&gt; Term -&gt; Term
forall a. TermFold a -&gt; Term -&gt; a
</span><a href="GHC.Runtime.Heap.Inspect.html#foldTerm"><span class="hs-identifier hs-var">foldTerm</span></a></span><span> </span><span class="annot"><span class="annottext">TermFold Term
</span><a href="GHC.Runtime.Heap.Inspect.html#idTermFold"><span class="hs-identifier hs-var">idTermFold</span></a></span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><a href="GHC.Runtime.Heap.Inspect.html#fTerm"><span class="hs-identifier hs-var">fTerm</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="#local-6989586621683022588"><span class="hs-identifier hs-type">worker</span></a></span><span> </span><span class="hs-special">}</span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-860"></span><span>   </span><span id="local-6989586621683022588"><span class="annot"><span class="annottext">worker :: TermProcessor Term Term
</span><a href="#local-6989586621683022588"><span class="hs-identifier hs-var hs-var">worker</span></a></span></span><span> </span><span id="local-6989586621683022590"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621683022590"><span class="hs-identifier hs-var">ty</span></a></span></span><span> </span><span id="local-6989586621683022591"><span class="annot"><span class="annottext">Either String DataCon
</span><a href="#local-6989586621683022591"><span class="hs-identifier hs-var">dc</span></a></span></span><span> </span><span id="local-6989586621683022592"><span class="annot"><span class="annottext">ForeignHValue
</span><a href="#local-6989586621683022592"><span class="hs-identifier hs-var">hval</span></a></span></span><span> </span><span id="local-6989586621683022593"><span class="annot"><span class="annottext">[Term]
</span><a href="#local-6989586621683022593"><span class="hs-identifier hs-var">tt</span></a></span></span><span>
</span><span id="line-861"></span><span>     </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span class="hs-special">(</span><span id="local-6989586621683022594"><span class="annot"><span class="annottext">TyCon
</span><a href="#local-6989586621683022594"><span class="hs-identifier hs-var">tc</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621683022595"><span class="annot"><span class="annottext">[Type]
</span><a href="#local-6989586621683022595"><span class="hs-identifier hs-var">args</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">HasDebugCallStack =&gt; Type -&gt; Maybe (TyCon, [Type])
Type -&gt; Maybe (TyCon, [Type])
</span><a href="GHC.Core.Type.html#tcSplitTyConApp_maybe"><span class="hs-identifier hs-var">tcSplitTyConApp_maybe</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621683022590"><span class="hs-identifier hs-var">ty</span></a></span><span>
</span><span id="line-862"></span><span>     </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">TyCon -&gt; Bool
</span><a href="GHC.Core.TyCon.html#isNewTyCon"><span class="hs-identifier hs-var">isNewTyCon</span></a></span><span> </span><span class="annot"><span class="annottext">TyCon
</span><a href="#local-6989586621683022594"><span class="hs-identifier hs-var">tc</span></a></span><span>
</span><span id="line-863"></span><span>     </span><span class="hs-special">,</span><span> </span><span id="local-6989586621683022596"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621683022596"><span class="hs-identifier hs-var">wrapped_type</span></a></span></span><span>    </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">TyCon -&gt; [Type] -&gt; Type
</span><a href="GHC.Core.Type.html#newTyConInstRhs"><span class="hs-identifier hs-var">newTyConInstRhs</span></a></span><span> </span><span class="annot"><span class="annottext">TyCon
</span><a href="#local-6989586621683022594"><span class="hs-identifier hs-var">tc</span></a></span><span> </span><span class="annot"><span class="annottext">[Type]
</span><a href="#local-6989586621683022595"><span class="hs-identifier hs-var">args</span></a></span><span>
</span><span id="line-864"></span><span>     </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span id="local-6989586621683022598"><span class="annot"><span class="annottext">DataCon
</span><a href="#local-6989586621683022598"><span class="hs-identifier hs-var">dc'</span></a></span></span><span>        </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">TyCon -&gt; Maybe DataCon
</span><a href="GHC.Core.TyCon.html#tyConSingleDataCon_maybe"><span class="hs-identifier hs-var">tyConSingleDataCon_maybe</span></a></span><span> </span><span class="annot"><span class="annottext">TyCon
</span><a href="#local-6989586621683022594"><span class="hs-identifier hs-var">tc</span></a></span><span>
</span><span id="line-865"></span><span>     </span><span class="hs-special">,</span><span> </span><span id="local-6989586621683022599"><span class="annot"><span class="annottext">Term
</span><a href="#local-6989586621683022599"><span class="hs-identifier hs-var">t'</span></a></span></span><span>              </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">TermProcessor Term Term
</span><a href="#local-6989586621683022588"><span class="hs-identifier hs-var">worker</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621683022596"><span class="hs-identifier hs-var">wrapped_type</span></a></span><span> </span><span class="annot"><span class="annottext">Either String DataCon
</span><a href="#local-6989586621683022591"><span class="hs-identifier hs-var">dc</span></a></span><span> </span><span class="annot"><span class="annottext">ForeignHValue
</span><a href="#local-6989586621683022592"><span class="hs-identifier hs-var">hval</span></a></span><span> </span><span class="annot"><span class="annottext">[Term]
</span><a href="#local-6989586621683022593"><span class="hs-identifier hs-var">tt</span></a></span><span>
</span><span id="line-866"></span><span>     </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Type -&gt; Either String DataCon -&gt; Term -&gt; Term
</span><a href="GHC.Runtime.Heap.Inspect.html#NewtypeWrap"><span class="hs-identifier hs-var">NewtypeWrap</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621683022590"><span class="hs-identifier hs-var">ty</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">DataCon -&gt; Either String DataCon
forall a b. b -&gt; Either a b
</span><span class="hs-identifier hs-var">Right</span></span><span> </span><span class="annot"><span class="annottext">DataCon
</span><a href="#local-6989586621683022598"><span class="hs-identifier hs-var">dc'</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Term
</span><a href="#local-6989586621683022599"><span class="hs-identifier hs-var">t'</span></a></span><span>
</span><span id="line-867"></span><span>     </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">otherwise</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">TermProcessor Term Term
</span><a href="GHC.Runtime.Heap.Inspect.html#Term"><span class="hs-identifier hs-var">Term</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621683022590"><span class="hs-identifier hs-var">ty</span></a></span><span> </span><span class="annot"><span class="annottext">Either String DataCon
</span><a href="#local-6989586621683022591"><span class="hs-identifier hs-var">dc</span></a></span><span> </span><span class="annot"><span class="annottext">ForeignHValue
</span><a href="#local-6989586621683022592"><span class="hs-identifier hs-var">hval</span></a></span><span> </span><span class="annot"><span class="annottext">[Term]
</span><a href="#local-6989586621683022593"><span class="hs-identifier hs-var">tt</span></a></span><span>
</span><span id="line-868"></span><span>
</span><span id="line-869"></span><span>
</span><span id="line-870"></span><span>   </span><span class="hs-comment">-- Avoid returning types where predicates have been expanded to dictionaries.</span><span>
</span><span id="line-871"></span><span>  </span><span id="local-6989586621683022481"><span class="annot"><span class="annottext">fixFunDictionaries :: Term -&gt; Term
</span><a href="#local-6989586621683022481"><span class="hs-identifier hs-var hs-var">fixFunDictionaries</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">TermFold Term -&gt; Term -&gt; Term
forall a. TermFold a -&gt; Term -&gt; a
</span><a href="GHC.Runtime.Heap.Inspect.html#foldTerm"><span class="hs-identifier hs-var">foldTerm</span></a></span><span> </span><span class="annot"><span class="annottext">TermFold Term
</span><a href="GHC.Runtime.Heap.Inspect.html#idTermFold"><span class="hs-identifier hs-var">idTermFold</span></a></span><span> </span><span class="hs-special">{</span><span class="annot"><a href="GHC.Runtime.Heap.Inspect.html#fSuspension"><span class="hs-identifier hs-var">fSuspension</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="#local-6989586621683022600"><span class="hs-identifier hs-type">worker</span></a></span><span class="hs-special">}</span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-872"></span><span>      </span><span id="local-6989586621683022600"><span class="annot"><span class="annottext">worker :: ClosureType -&gt; Type -&gt; ForeignHValue -&gt; Maybe Name -&gt; Term
</span><a href="#local-6989586621683022600"><span class="hs-identifier hs-var hs-var">worker</span></a></span></span><span> </span><span id="local-6989586621683022601"><span class="annot"><span class="annottext">ClosureType
</span><a href="#local-6989586621683022601"><span class="hs-identifier hs-var">ct</span></a></span></span><span> </span><span id="local-6989586621683022602"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621683022602"><span class="hs-identifier hs-var">ty</span></a></span></span><span> </span><span id="local-6989586621683022603"><span class="annot"><span class="annottext">ForeignHValue
</span><a href="#local-6989586621683022603"><span class="hs-identifier hs-var">hval</span></a></span></span><span> </span><span id="local-6989586621683022604"><span class="annot"><span class="annottext">Maybe Name
</span><a href="#local-6989586621683022604"><span class="hs-identifier hs-var">n</span></a></span></span><span> </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Type -&gt; Bool
</span><a href="GHC.Core.Type.html#isFunTy"><span class="hs-identifier hs-var">isFunTy</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621683022602"><span class="hs-identifier hs-var">ty</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ClosureType -&gt; Type -&gt; ForeignHValue -&gt; Maybe Name -&gt; Term
</span><a href="GHC.Runtime.Heap.Inspect.html#Suspension"><span class="hs-identifier hs-var">Suspension</span></a></span><span> </span><span class="annot"><span class="annottext">ClosureType
</span><a href="#local-6989586621683022601"><span class="hs-identifier hs-var">ct</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Type -&gt; Type
</span><a href="GHC.Runtime.Heap.Inspect.html#dictsView"><span class="hs-identifier hs-var">dictsView</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621683022602"><span class="hs-identifier hs-var">ty</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">ForeignHValue
</span><a href="#local-6989586621683022603"><span class="hs-identifier hs-var">hval</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe Name
</span><a href="#local-6989586621683022604"><span class="hs-identifier hs-var">n</span></a></span><span>
</span><span id="line-873"></span><span>                          </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">otherwise</span></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ClosureType -&gt; Type -&gt; ForeignHValue -&gt; Maybe Name -&gt; Term
</span><a href="GHC.Runtime.Heap.Inspect.html#Suspension"><span class="hs-identifier hs-var">Suspension</span></a></span><span> </span><span class="annot"><span class="annottext">ClosureType
</span><a href="#local-6989586621683022601"><span class="hs-identifier hs-var">ct</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621683022602"><span class="hs-identifier hs-var">ty</span></a></span><span> </span><span class="annot"><span class="annottext">ForeignHValue
</span><a href="#local-6989586621683022603"><span class="hs-identifier hs-var">hval</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe Name
</span><a href="#local-6989586621683022604"><span class="hs-identifier hs-var">n</span></a></span><span>
</span><span id="line-874"></span><span>
</span><span id="line-875"></span><span class="annot"><a href="GHC.Runtime.Heap.Inspect.html#extractSubTerms"><span class="hs-identifier hs-type">extractSubTerms</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#Type"><span class="hs-identifier hs-type">Type</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="../../ghci-9.12.2-bd10/src/GHCi.RemoteTypes.html#ForeignHValue"><span class="hs-identifier hs-type">ForeignHValue</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#TcM"><span class="hs-identifier hs-type">TcM</span></a></span><span> </span><span class="annot"><a href="GHC.Runtime.Heap.Inspect.html#Term"><span class="hs-identifier hs-type">Term</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-876"></span><span>                </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="../../ghc-heap-9.12.2-4363/src/GHC.Exts.Heap.Closures.html#GenClosure"><span class="hs-identifier hs-type">GenClosure</span></a></span><span> </span><span class="annot"><a href="../../ghci-9.12.2-bd10/src/GHCi.RemoteTypes.html#ForeignHValue"><span class="hs-identifier hs-type">ForeignHValue</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#Type"><span class="hs-identifier hs-type">Type</span></a></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#TcM"><span class="hs-identifier hs-type">TcM</span></a></span><span> </span><span class="hs-special">[</span><span class="annot"><a href="GHC.Runtime.Heap.Inspect.html#Term"><span class="hs-identifier hs-type">Term</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-877"></span><span id="extractSubTerms"><span class="annot"><span class="annottext">extractSubTerms :: (Type -&gt; ForeignHValue -&gt; TR Term)
-&gt; GenClosure ForeignHValue
-&gt; [Type]
-&gt; IOEnv (Env TcGblEnv TcLclEnv) [Term]
</span><a href="GHC.Runtime.Heap.Inspect.html#extractSubTerms"><span class="hs-identifier hs-var hs-var">extractSubTerms</span></a></span></span><span> </span><span id="local-6989586621683022606"><span class="annot"><span class="annottext">Type -&gt; ForeignHValue -&gt; TR Term
</span><a href="#local-6989586621683022606"><span class="hs-identifier hs-var">recurse</span></a></span></span><span> </span><span id="local-6989586621683022607"><span class="annot"><span class="annottext">GenClosure ForeignHValue
</span><a href="#local-6989586621683022607"><span class="hs-identifier hs-var">clos</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">((Int, Int, [Term]) -&gt; [Term])
-&gt; IOEnv (Env TcGblEnv TcLclEnv) (Int, Int, [Term])
-&gt; IOEnv (Env TcGblEnv TcLclEnv) [Term]
forall (m :: * -&gt; *) a1 r. Monad m =&gt; (a1 -&gt; r) -&gt; m a1 -&gt; m r
</span><span class="hs-identifier hs-var">liftM</span></span><span> </span><span class="annot"><span class="annottext">(Int, Int, [Term]) -&gt; [Term]
forall a b c. (a, b, c) -&gt; c
</span><a href="GHC.Utils.Misc.html#thdOf3"><span class="hs-identifier hs-var">thdOf3</span></a></span><span> </span><span class="annot"><span class="annottext">(IOEnv (Env TcGblEnv TcLclEnv) (Int, Int, [Term])
 -&gt; IOEnv (Env TcGblEnv TcLclEnv) [Term])
-&gt; ([Type] -&gt; IOEnv (Env TcGblEnv TcLclEnv) (Int, Int, [Term]))
-&gt; [Type]
-&gt; IOEnv (Env TcGblEnv TcLclEnv) [Term]
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">Int
-&gt; Int
-&gt; [Type]
-&gt; IOEnv (Env TcGblEnv TcLclEnv) (Int, Int, [Term])
</span><a href="#local-6989586621683022609"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">0</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">0</span></span><span>
</span><span id="line-878"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-879"></span><span>    </span><span id="local-6989586621683022610"><span class="annot"><span class="annottext">array :: [Word]
</span><a href="#local-6989586621683022610"><span class="hs-identifier hs-var hs-var">array</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">GenClosure ForeignHValue -&gt; [Word]
forall b. GenClosure b -&gt; [Word]
</span><a href="../../ghc-heap-9.12.2-4363/src/GHC.Exts.Heap.Closures.html#dataArgs"><span class="hs-identifier hs-var">dataArgs</span></a></span><span> </span><span class="annot"><span class="annottext">GenClosure ForeignHValue
</span><a href="#local-6989586621683022607"><span class="hs-identifier hs-var">clos</span></a></span><span>
</span><span id="line-880"></span><span>
</span><span id="line-881"></span><span>    </span><span id="local-6989586621683022609"><span class="annot"><span class="annottext">go :: Int
-&gt; Int
-&gt; [Type]
-&gt; IOEnv (Env TcGblEnv TcLclEnv) (Int, Int, [Term])
</span><a href="#local-6989586621683022609"><span class="hs-identifier hs-var hs-var">go</span></a></span></span><span> </span><span id="local-6989586621683022611"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621683022611"><span class="hs-identifier hs-var">ptr_i</span></a></span></span><span> </span><span id="local-6989586621683022612"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621683022612"><span class="hs-identifier hs-var">arr_i</span></a></span></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(Int, Int, [Term])
-&gt; IOEnv (Env TcGblEnv TcLclEnv) (Int, Int, [Term])
forall a. a -&gt; IOEnv (Env TcGblEnv TcLclEnv) a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621683022611"><span class="hs-identifier hs-var">ptr_i</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621683022612"><span class="hs-identifier hs-var">arr_i</span></a></span><span class="hs-special">,</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span class="hs-special">)</span><span>
</span><span id="line-882"></span><span>    </span><span class="annot"><a href="#local-6989586621683022609"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span id="local-6989586621683022613"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621683022613"><span class="hs-identifier hs-var">ptr_i</span></a></span></span><span> </span><span id="local-6989586621683022614"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621683022614"><span class="hs-identifier hs-var">arr_i</span></a></span></span><span> </span><span class="hs-special">(</span><span id="local-6989586621683022615"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621683022615"><span class="hs-identifier hs-var">ty</span></a></span></span><span class="annot"><span class="hs-glyph hs-type">:</span></span><span id="local-6989586621683022616"><span class="annot"><span class="annottext">[Type]
</span><a href="#local-6989586621683022616"><span class="hs-identifier hs-var">tys</span></a></span></span><span class="hs-special">)</span><span>
</span><span id="line-883"></span><span>      </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span class="hs-special">(</span><span id="local-6989586621683022617"><span class="annot"><span class="annottext">TyCon
</span><a href="#local-6989586621683022617"><span class="hs-identifier hs-var">tc</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621683022618"><span class="annot"><span class="annottext">[Type]
</span><a href="#local-6989586621683022618"><span class="hs-identifier hs-var">elem_tys</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">HasDebugCallStack =&gt; Type -&gt; Maybe (TyCon, [Type])
Type -&gt; Maybe (TyCon, [Type])
</span><a href="GHC.Core.Type.html#tcSplitTyConApp_maybe"><span class="hs-identifier hs-var">tcSplitTyConApp_maybe</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621683022615"><span class="hs-identifier hs-var">ty</span></a></span><span>
</span><span id="line-884"></span><span>      </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">TyCon -&gt; Bool
</span><a href="GHC.Core.TyCon.html#isUnboxedTupleTyCon"><span class="hs-identifier hs-var">isUnboxedTupleTyCon</span></a></span><span> </span><span class="annot"><span class="annottext">TyCon
</span><a href="#local-6989586621683022617"><span class="hs-identifier hs-var">tc</span></a></span><span>
</span><span id="line-885"></span><span>                </span><span class="hs-comment">-- See Note [Unboxed tuple RuntimeRep vars] in GHC.Core.TyCon</span><span>
</span><span id="line-886"></span><span>      </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">(</span><span id="local-6989586621683022620"><span class="annot"><a href="#local-6989586621683022620"><span class="hs-identifier hs-var">ptr_i</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621683022621"><span class="annot"><a href="#local-6989586621683022621"><span class="hs-identifier hs-var">arr_i</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621683022622"><span class="annot"><a href="#local-6989586621683022622"><span class="hs-identifier hs-var">terms0</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span>
</span><span id="line-887"></span><span>               </span><span class="annot"><span class="annottext">Int
-&gt; Int
-&gt; [Type]
-&gt; IOEnv (Env TcGblEnv TcLclEnv) (Int, Int, [Term])
</span><a href="#local-6989586621683022609"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621683022613"><span class="hs-identifier hs-var">ptr_i</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621683022614"><span class="hs-identifier hs-var">arr_i</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[Type] -&gt; [Type]
</span><a href="GHC.Core.Type.html#dropRuntimeRepArgs"><span class="hs-identifier hs-var">dropRuntimeRepArgs</span></a></span><span> </span><span class="annot"><span class="annottext">[Type]
</span><a href="#local-6989586621683022618"><span class="hs-identifier hs-var">elem_tys</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-888"></span><span>           </span><span class="hs-special">(</span><span id="local-6989586621683022624"><span class="annot"><a href="#local-6989586621683022624"><span class="hs-identifier hs-var">ptr_i</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621683022625"><span class="annot"><a href="#local-6989586621683022625"><span class="hs-identifier hs-var">arr_i</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621683022626"><span class="annot"><a href="#local-6989586621683022626"><span class="hs-identifier hs-var">terms1</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><a href="#local-6989586621683022609"><span class="hs-identifier hs-type">go</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683022620"><span class="hs-identifier hs-type">ptr_i</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683022621"><span class="hs-identifier hs-type">arr_i</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683022616"><span class="hs-identifier hs-type">tys</span></a></span><span>
</span><span id="line-889"></span><span>           </span><span class="annot"><span class="hs-identifier hs-type">return</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621683022624"><span class="hs-identifier hs-type">ptr_i</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="#local-6989586621683022625"><span class="hs-identifier hs-type">arr_i</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="#local-6989586621683022627"><span class="hs-identifier hs-type">unboxedTupleTerm</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683022615"><span class="hs-identifier hs-type">ty</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683022622"><span class="hs-identifier hs-type">terms0</span></a></span><span> </span><span class="annot"><span class="hs-glyph hs-type">:</span></span><span> </span><span class="annot"><a href="#local-6989586621683022626"><span class="hs-identifier hs-type">terms1</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-890"></span><span>      </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">otherwise</span></span><span>
</span><span id="line-891"></span><span>      </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">HasDebugCallStack =&gt; Type -&gt; [PrimRep]
Type -&gt; [PrimRep]
</span><a href="GHC.Types.RepType.html#typePrimRep"><span class="hs-identifier hs-var">typePrimRep</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621683022615"><span class="hs-identifier hs-var">ty</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-892"></span><span>          </span><span class="hs-special">[</span><span id="local-6989586621683022629"><span class="annot"><span class="annottext">PrimRep
</span><a href="#local-6989586621683022629"><span class="hs-identifier hs-var">rep_ty</span></a></span></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-893"></span><span>            </span><span class="hs-special">(</span><span id="local-6989586621683022630"><span class="annot"><a href="#local-6989586621683022630"><span class="hs-identifier hs-var">ptr_i</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621683022631"><span class="annot"><a href="#local-6989586621683022631"><span class="hs-identifier hs-var">arr_i</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621683022632"><span class="annot"><a href="#local-6989586621683022632"><span class="hs-identifier hs-var">term0</span></a></span></span><span class="hs-special">)</span><span>  </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Int
-&gt; Int
-&gt; Type
-&gt; PrimRep
-&gt; IOEnv (Env TcGblEnv TcLclEnv) (Int, Int, Term)
</span><a href="#local-6989586621683022633"><span class="hs-identifier hs-var">go_rep</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621683022613"><span class="hs-identifier hs-var">ptr_i</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621683022614"><span class="hs-identifier hs-var">arr_i</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621683022615"><span class="hs-identifier hs-var">ty</span></a></span><span> </span><span class="annot"><span class="annottext">PrimRep
</span><a href="#local-6989586621683022629"><span class="hs-identifier hs-var">rep_ty</span></a></span><span>
</span><span id="line-894"></span><span>            </span><span class="hs-special">(</span><span id="local-6989586621683022634"><span class="annot"><a href="#local-6989586621683022634"><span class="hs-identifier hs-var">ptr_i</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621683022635"><span class="annot"><a href="#local-6989586621683022635"><span class="hs-identifier hs-var">arr_i</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621683022636"><span class="annot"><a href="#local-6989586621683022636"><span class="hs-identifier hs-var">terms1</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><a href="#local-6989586621683022609"><span class="hs-identifier hs-type">go</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683022630"><span class="hs-identifier hs-type">ptr_i</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683022631"><span class="hs-identifier hs-type">arr_i</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683022616"><span class="hs-identifier hs-type">tys</span></a></span><span>
</span><span id="line-895"></span><span>            </span><span class="annot"><span class="hs-identifier hs-type">return</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621683022634"><span class="hs-identifier hs-type">ptr_i</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="#local-6989586621683022635"><span class="hs-identifier hs-type">arr_i</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="#local-6989586621683022632"><span class="hs-identifier hs-type">term0</span></a></span><span> </span><span class="annot"><span class="hs-glyph hs-type">:</span></span><span> </span><span class="annot"><a href="#local-6989586621683022636"><span class="hs-identifier hs-type">terms1</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-896"></span><span>          </span><span id="local-6989586621683022637"><span class="annot"><span class="annottext">[PrimRep]
</span><a href="#local-6989586621683022637"><span class="hs-identifier hs-var">rep_tys</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-897"></span><span>           </span><span class="hs-special">(</span><span id="local-6989586621683022638"><span class="annot"><a href="#local-6989586621683022638"><span class="hs-identifier hs-var">ptr_i</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621683022639"><span class="annot"><a href="#local-6989586621683022639"><span class="hs-identifier hs-var">arr_i</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621683022640"><span class="annot"><a href="#local-6989586621683022640"><span class="hs-identifier hs-var">terms0</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Int
-&gt; Int
-&gt; [PrimRep]
-&gt; IOEnv (Env TcGblEnv TcLclEnv) (Int, Int, [Term])
</span><a href="#local-6989586621683022641"><span class="hs-identifier hs-var">go_unary_types</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621683022613"><span class="hs-identifier hs-var">ptr_i</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621683022614"><span class="hs-identifier hs-var">arr_i</span></a></span><span> </span><span class="annot"><span class="annottext">[PrimRep]
</span><a href="#local-6989586621683022637"><span class="hs-identifier hs-var">rep_tys</span></a></span><span>
</span><span id="line-898"></span><span>           </span><span class="hs-special">(</span><span id="local-6989586621683022642"><span class="annot"><a href="#local-6989586621683022642"><span class="hs-identifier hs-var">ptr_i</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621683022643"><span class="annot"><a href="#local-6989586621683022643"><span class="hs-identifier hs-var">arr_i</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621683022644"><span class="annot"><a href="#local-6989586621683022644"><span class="hs-identifier hs-var">terms1</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><a href="#local-6989586621683022609"><span class="hs-identifier hs-type">go</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683022638"><span class="hs-identifier hs-type">ptr_i</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683022639"><span class="hs-identifier hs-type">arr_i</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683022616"><span class="hs-identifier hs-type">tys</span></a></span><span>
</span><span id="line-899"></span><span>           </span><span class="annot"><span class="hs-identifier hs-type">return</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621683022642"><span class="hs-identifier hs-type">ptr_i</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="#local-6989586621683022643"><span class="hs-identifier hs-type">arr_i</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="#local-6989586621683022627"><span class="hs-identifier hs-type">unboxedTupleTerm</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683022615"><span class="hs-identifier hs-type">ty</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683022640"><span class="hs-identifier hs-type">terms0</span></a></span><span> </span><span class="annot"><span class="hs-glyph hs-type">:</span></span><span> </span><span class="annot"><a href="#local-6989586621683022644"><span class="hs-identifier hs-type">terms1</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-900"></span><span>
</span><span id="line-901"></span><span>    </span><span id="local-6989586621683022641"><span class="annot"><span class="annottext">go_unary_types :: Int
-&gt; Int
-&gt; [PrimRep]
-&gt; IOEnv (Env TcGblEnv TcLclEnv) (Int, Int, [Term])
</span><a href="#local-6989586621683022641"><span class="hs-identifier hs-var hs-var">go_unary_types</span></a></span></span><span> </span><span id="local-6989586621683022645"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621683022645"><span class="hs-identifier hs-var">ptr_i</span></a></span></span><span> </span><span id="local-6989586621683022646"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621683022646"><span class="hs-identifier hs-var">arr_i</span></a></span></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(Int, Int, [Term])
-&gt; IOEnv (Env TcGblEnv TcLclEnv) (Int, Int, [Term])
forall a. a -&gt; IOEnv (Env TcGblEnv TcLclEnv) a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621683022645"><span class="hs-identifier hs-var">ptr_i</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621683022646"><span class="hs-identifier hs-var">arr_i</span></a></span><span class="hs-special">,</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span class="hs-special">)</span><span>
</span><span id="line-902"></span><span>    </span><span class="annot"><a href="#local-6989586621683022641"><span class="hs-identifier hs-var">go_unary_types</span></a></span><span> </span><span id="local-6989586621683022647"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621683022647"><span class="hs-identifier hs-var">ptr_i</span></a></span></span><span> </span><span id="local-6989586621683022648"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621683022648"><span class="hs-identifier hs-var">arr_i</span></a></span></span><span> </span><span class="hs-special">(</span><span id="local-6989586621683022649"><span class="annot"><span class="annottext">PrimRep
</span><a href="#local-6989586621683022649"><span class="hs-identifier hs-var">rep_ty</span></a></span></span><span class="annot"><span class="hs-glyph hs-type">:</span></span><span id="local-6989586621683022650"><span class="annot"><span class="annottext">[PrimRep]
</span><a href="#local-6989586621683022650"><span class="hs-identifier hs-var">rep_tys</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-903"></span><span>      </span><span id="local-6989586621683022651"><span class="annot"><a href="#local-6989586621683022651"><span class="hs-identifier hs-var">tv</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Type -&gt; TR Type
</span><a href="GHC.Runtime.Heap.Inspect.html#newVar"><span class="hs-identifier hs-var">newVar</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="GHC.Builtin.Types.html#liftedTypeKind"><span class="hs-identifier hs-var">liftedTypeKind</span></a></span><span>
</span><span id="line-904"></span><span>      </span><span class="hs-special">(</span><span id="local-6989586621683022652"><span class="annot"><a href="#local-6989586621683022652"><span class="hs-identifier hs-var">ptr_i</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621683022653"><span class="annot"><a href="#local-6989586621683022653"><span class="hs-identifier hs-var">arr_i</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621683022654"><span class="annot"><a href="#local-6989586621683022654"><span class="hs-identifier hs-var">term0</span></a></span></span><span class="hs-special">)</span><span>  </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><a href="#local-6989586621683022633"><span class="hs-identifier hs-type">go_rep</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683022647"><span class="hs-identifier hs-type">ptr_i</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683022648"><span class="hs-identifier hs-type">arr_i</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683022651"><span class="hs-identifier hs-type">tv</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683022649"><span class="hs-identifier hs-type">rep_ty</span></a></span><span>
</span><span id="line-905"></span><span>      </span><span class="hs-special">(</span><span id="local-6989586621683022655"><span class="annot"><a href="#local-6989586621683022655"><span class="hs-identifier hs-var">ptr_i</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621683022656"><span class="annot"><a href="#local-6989586621683022656"><span class="hs-identifier hs-var">arr_i</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621683022657"><span class="annot"><a href="#local-6989586621683022657"><span class="hs-identifier hs-var">terms1</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><a href="#local-6989586621683022641"><span class="hs-identifier hs-type">go_unary_types</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683022652"><span class="hs-identifier hs-type">ptr_i</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683022653"><span class="hs-identifier hs-type">arr_i</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683022650"><span class="hs-identifier hs-type">rep_tys</span></a></span><span>
</span><span id="line-906"></span><span>      </span><span class="annot"><span class="hs-identifier hs-type">return</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621683022655"><span class="hs-identifier hs-type">ptr_i</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="#local-6989586621683022656"><span class="hs-identifier hs-type">arr_i</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="#local-6989586621683022654"><span class="hs-identifier hs-type">term0</span></a></span><span> </span><span class="annot"><span class="hs-glyph hs-type">:</span></span><span> </span><span class="annot"><a href="#local-6989586621683022657"><span class="hs-identifier hs-type">terms1</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-907"></span><span>
</span><span id="line-908"></span><span>    </span><span id="local-6989586621683022633"><span class="annot"><span class="annottext">go_rep :: Int
-&gt; Int
-&gt; Type
-&gt; PrimRep
-&gt; IOEnv (Env TcGblEnv TcLclEnv) (Int, Int, Term)
</span><a href="#local-6989586621683022633"><span class="hs-identifier hs-var hs-var">go_rep</span></a></span></span><span> </span><span id="local-6989586621683022658"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621683022658"><span class="hs-identifier hs-var">ptr_i</span></a></span></span><span> </span><span id="local-6989586621683022659"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621683022659"><span class="hs-identifier hs-var">arr_i</span></a></span></span><span> </span><span id="local-6989586621683022660"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621683022660"><span class="hs-identifier hs-var">ty</span></a></span></span><span> </span><span id="local-6989586621683022661"><span class="annot"><span class="annottext">PrimRep
</span><a href="#local-6989586621683022661"><span class="hs-identifier hs-var">rep</span></a></span></span><span>
</span><span id="line-909"></span><span>      </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">PrimRep -&gt; Bool
</span><a href="GHC.Core.TyCon.html#isGcPtrRep"><span class="hs-identifier hs-var">isGcPtrRep</span></a></span><span> </span><span class="annot"><span class="annottext">PrimRep
</span><a href="#local-6989586621683022661"><span class="hs-identifier hs-var">rep</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-910"></span><span>          </span><span id="local-6989586621683022663"><span class="annot"><a href="#local-6989586621683022663"><span class="hs-identifier hs-var">t</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Type -&gt; ForeignHValue -&gt; TR Term
</span><a href="#local-6989586621683022606"><span class="hs-identifier hs-var">recurse</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621683022660"><span class="hs-identifier hs-var">ty</span></a></span><span> </span><span class="annot"><span class="annottext">(ForeignHValue -&gt; TR Term) -&gt; ForeignHValue -&gt; TR Term
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">GenClosure ForeignHValue -&gt; [ForeignHValue]
forall b. GenClosure b -&gt; [b]
</span><a href="../../ghc-heap-9.12.2-4363/src/GHC.Exts.Heap.Closures.html#ptrArgs"><span class="hs-identifier hs-var">ptrArgs</span></a></span><span> </span><span class="annot"><span class="annottext">GenClosure ForeignHValue
</span><a href="#local-6989586621683022607"><span class="hs-identifier hs-var">clos</span></a></span><span class="hs-special">)</span><span class="annot"><span class="annottext">[ForeignHValue] -&gt; Int -&gt; ForeignHValue
forall a. HasCallStack =&gt; [a] -&gt; Int -&gt; a
</span><span class="hs-operator hs-var">!!</span></span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621683022658"><span class="hs-identifier hs-var">ptr_i</span></a></span><span>
</span><span id="line-911"></span><span>          </span><span class="annot"><span class="hs-identifier hs-type">return</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621683022658"><span class="hs-identifier hs-type">ptr_i</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">+</span></span><span> </span><span class="annot"><span class="hs-number">1</span></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="#local-6989586621683022659"><span class="hs-identifier hs-type">arr_i</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="#local-6989586621683022663"><span class="hs-identifier hs-type">t</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-912"></span><span>      </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">otherwise</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-913"></span><span>          </span><span class="hs-comment">-- This is a bit involved since we allow packing multiple fields</span><span>
</span><span id="line-914"></span><span>          </span><span class="hs-comment">-- within a single word. See also</span><span>
</span><span id="line-915"></span><span>          </span><span class="hs-comment">-- GHC.StgToCmm.Layout.mkVirtHeapOffsetsWithPadding</span><span>
</span><span id="line-916"></span><span>          </span><span id="local-6989586621683022665"><span class="annot"><a href="#local-6989586621683022665"><span class="hs-identifier hs-var">platform</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">TcRnIf TcGblEnv TcLclEnv Platform
forall a b. TcRnIf a b Platform
</span><a href="GHC.Tc.Types.html#getPlatform"><span class="hs-identifier hs-var">getPlatform</span></a></span><span>
</span><span id="line-917"></span><span>          </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621683022667"><span class="annot"><a href="#local-6989586621683022667"><span class="hs-identifier hs-var hs-var">word_size</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Platform -&gt; Int
</span><a href="GHC.Platform.html#platformWordSizeInBytes"><span class="hs-identifier hs-var">platformWordSizeInBytes</span></a></span><span> </span><span class="annot"><span class="annottext">Platform
</span><a href="#local-6989586621683022665"><span class="hs-identifier hs-var">platform</span></a></span><span>
</span><span id="line-918"></span><span>              </span><span id="local-6989586621683022669"><span class="annot"><a href="#local-6989586621683022669"><span class="hs-identifier hs-var hs-var">endian</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Platform -&gt; ByteOrder
</span><a href="GHC.Platform.html#platformByteOrder"><span class="hs-identifier hs-var">platformByteOrder</span></a></span><span> </span><span class="annot"><span class="annottext">Platform
</span><a href="#local-6989586621683022665"><span class="hs-identifier hs-var">platform</span></a></span><span>
</span><span id="line-919"></span><span>              </span><span id="local-6989586621683022671"><span class="annot"><a href="#local-6989586621683022671"><span class="hs-identifier hs-var hs-var">size_b</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Platform -&gt; PrimRep -&gt; Int
</span><a href="GHC.Core.TyCon.html#primRepSizeB"><span class="hs-identifier hs-var">primRepSizeB</span></a></span><span> </span><span class="annot"><span class="annottext">Platform
</span><a href="#local-6989586621683022665"><span class="hs-identifier hs-var">platform</span></a></span><span> </span><span class="annot"><span class="annottext">PrimRep
</span><a href="#local-6989586621683022661"><span class="hs-identifier hs-var">rep</span></a></span><span>
</span><span id="line-920"></span><span>              </span><span class="hs-comment">-- Align the start offset (eg, 2-byte value should be 2-byte</span><span>
</span><span id="line-921"></span><span>              </span><span class="hs-comment">-- aligned). But not more than to a word. The offset calculation</span><span>
</span><span id="line-922"></span><span>              </span><span class="hs-comment">-- should be the same with the offset calculation in</span><span>
</span><span id="line-923"></span><span>              </span><span class="hs-comment">-- GHC.StgToCmm.Layout.mkVirtHeapOffsetsWithPadding.</span><span>
</span><span id="line-924"></span><span>              </span><span class="hs-glyph">!</span><span id="local-6989586621683022673"><span class="annot"><a href="#local-6989586621683022673"><span class="hs-identifier hs-var hs-var">aligned_idx</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Int
</span><a href="GHC.Runtime.Heap.Layout.html#roundUpTo"><span class="hs-identifier hs-var">roundUpTo</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621683022659"><span class="hs-identifier hs-var">arr_i</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Int
forall a. Ord a =&gt; a -&gt; a -&gt; a
</span><span class="hs-identifier hs-var">min</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621683022667"><span class="hs-identifier hs-var">word_size</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621683022671"><span class="hs-identifier hs-var">size_b</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-925"></span><span>              </span><span class="hs-glyph">!</span><span id="local-6989586621683022675"><span class="annot"><a href="#local-6989586621683022675"><span class="hs-identifier hs-var hs-var">new_arr_i</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621683022673"><span class="hs-identifier hs-var">aligned_idx</span></a></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Int
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">+</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621683022671"><span class="hs-identifier hs-var">size_b</span></a></span><span>
</span><span id="line-926"></span><span>              </span><span id="local-6989586621683022676"><span class="annot"><a href="#local-6989586621683022676"><span class="hs-identifier hs-var hs-var">ws</span></a></span></span><span> </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621683022671"><span class="hs-identifier hs-var">size_b</span></a></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Bool
forall a. Ord a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">&lt;</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621683022667"><span class="hs-identifier hs-var">word_size</span></a></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-927"></span><span>                     </span><span class="hs-special">[</span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Int -&gt; ByteOrder -&gt; Word
</span><a href="#local-6989586621683022678"><span class="hs-identifier hs-var">index</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621683022671"><span class="hs-identifier hs-var">size_b</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621683022673"><span class="hs-identifier hs-var">aligned_idx</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621683022667"><span class="hs-identifier hs-var">word_size</span></a></span><span> </span><span class="annot"><span class="annottext">ByteOrder
</span><a href="#local-6989586621683022669"><span class="hs-identifier hs-var">endian</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-928"></span><span>                 </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">otherwise</span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-929"></span><span>                     </span><span class="hs-keyword">let</span><span> </span><span class="hs-special">(</span><span id="local-6989586621683022679"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621683022679"><span class="hs-identifier hs-var">q</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621683022680"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621683022680"><span class="hs-identifier hs-var">r</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621683022671"><span class="hs-identifier hs-var">size_b</span></a></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; (Int, Int)
forall a. Integral a =&gt; a -&gt; a -&gt; (a, a)
</span><span class="hs-operator hs-var">`quotRem`</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621683022667"><span class="hs-identifier hs-var">word_size</span></a></span><span>
</span><span id="line-930"></span><span>                     </span><span class="hs-keyword">in</span><span> </span><span class="annot"><span class="annottext">Bool -&gt; [Word] -&gt; [Word]
forall a. HasCallStack =&gt; Bool -&gt; a -&gt; a
</span><a href="GHC.Utils.Panic.Plain.html#assert"><span class="hs-identifier hs-var">assert</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621683022680"><span class="hs-identifier hs-var">r</span></a></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">==</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">0</span></span><span> </span><span class="hs-special">)</span><span>
</span><span id="line-931"></span><span>                        </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">[Word]
</span><a href="#local-6989586621683022610"><span class="hs-identifier hs-var">array</span></a></span><span class="annot"><span class="annottext">[Word] -&gt; Int -&gt; Word
forall a. HasCallStack =&gt; [a] -&gt; Int -&gt; a
</span><span class="hs-operator hs-var">!!</span></span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621683022682"><span class="hs-identifier hs-var">i</span></a></span><span>
</span><span id="line-932"></span><span>                        </span><span class="hs-glyph">|</span><span> </span><span id="local-6989586621683022683"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621683022683"><span class="hs-identifier hs-var">o</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">0</span></span><span class="hs-glyph">..</span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621683022679"><span class="hs-identifier hs-var">q</span></a></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Int
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-glyph hs-var">-</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">1</span></span><span class="hs-special">]</span><span>
</span><span id="line-933"></span><span>                        </span><span class="hs-special">,</span><span> </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621683022682"><span class="annot"><span class="annottext">i :: Int
</span><a href="#local-6989586621683022682"><span class="hs-identifier hs-var hs-var">i</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621683022673"><span class="hs-identifier hs-var">aligned_idx</span></a></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Int
forall a. Integral a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">`quot`</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621683022667"><span class="hs-identifier hs-var">word_size</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Int
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">+</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621683022683"><span class="hs-identifier hs-var">o</span></a></span><span>
</span><span id="line-934"></span><span>                        </span><span class="hs-special">]</span><span>
</span><span id="line-935"></span><span>          </span><span class="annot"><span class="hs-identifier hs-type">return</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621683022658"><span class="hs-identifier hs-type">ptr_i</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="#local-6989586621683022675"><span class="hs-identifier hs-type">new_arr_i</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Runtime.Heap.Inspect.html#Prim"><span class="hs-identifier hs-type">Prim</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683022660"><span class="hs-identifier hs-type">ty</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683022676"><span class="hs-identifier hs-type">ws</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-936"></span><span>
</span><span id="line-937"></span><span>    </span><span id="local-6989586621683022627"><span class="annot"><span class="annottext">unboxedTupleTerm :: Type -&gt; [Term] -&gt; Term
</span><a href="#local-6989586621683022627"><span class="hs-identifier hs-var hs-var">unboxedTupleTerm</span></a></span></span><span> </span><span id="local-6989586621683022688"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621683022688"><span class="hs-identifier hs-var">ty</span></a></span></span><span> </span><span id="local-6989586621683022689"><span class="annot"><span class="annottext">[Term]
</span><a href="#local-6989586621683022689"><span class="hs-identifier hs-var">terms</span></a></span></span><span>
</span><span id="line-938"></span><span>      </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">TermProcessor Term Term
</span><a href="GHC.Runtime.Heap.Inspect.html#Term"><span class="hs-identifier hs-var">Term</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621683022688"><span class="hs-identifier hs-var">ty</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">DataCon -&gt; Either String DataCon
forall a b. b -&gt; Either a b
</span><span class="hs-identifier hs-var">Right</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Boxity -&gt; Int -&gt; DataCon
</span><a href="GHC.Builtin.Types.html#tupleDataCon"><span class="hs-identifier hs-var">tupleDataCon</span></a></span><span> </span><span class="annot"><span class="annottext">Boxity
</span><a href="Language.Haskell.Syntax.Basic.html#Unboxed"><span class="hs-identifier hs-var">Unboxed</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[Term] -&gt; Int
forall a. [a] -&gt; Int
forall (t :: * -&gt; *) a. Foldable t =&gt; t a -&gt; Int
</span><span class="hs-identifier hs-var">length</span></span><span> </span><span class="annot"><span class="annottext">[Term]
</span><a href="#local-6989586621683022689"><span class="hs-identifier hs-var">terms</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-939"></span><span>                </span><span class="hs-special">(</span><span class="annot"><span class="annottext">String -&gt; ForeignHValue
forall a. HasCallStack =&gt; String -&gt; a
</span><span class="hs-identifier hs-var">error</span></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;unboxedTupleTerm: no HValue for unboxed tuple&quot;</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[Term]
</span><a href="#local-6989586621683022689"><span class="hs-identifier hs-var">terms</span></a></span><span>
</span><span id="line-940"></span><span>
</span><span id="line-941"></span><span>    </span><span class="hs-comment">-- Extract a sub-word sized field from a word</span><span>
</span><span id="line-942"></span><span>    </span><span class="hs-comment">-- A sub word is aligned to the left-most part of a word on big-endian</span><span>
</span><span id="line-943"></span><span>    </span><span class="hs-comment">-- platforms, and to the right-most part of a word on little-endian</span><span>
</span><span id="line-944"></span><span>    </span><span class="hs-comment">-- platforms.  This allows to write and read it back from memory</span><span>
</span><span id="line-945"></span><span>    </span><span class="hs-comment">-- independent of endianness.  Bits not belonging to a sub word are zeroed</span><span>
</span><span id="line-946"></span><span>    </span><span class="hs-comment">-- out, although, this is strictly speaking not necessary since a sub word</span><span>
</span><span id="line-947"></span><span>    </span><span class="hs-comment">-- is read back from memory by appropriately casted pointers (see e.g.</span><span>
</span><span id="line-948"></span><span>    </span><span class="hs-comment">-- ppr_float of cPprTermBase).</span><span>
</span><span id="line-949"></span><span>    </span><span id="local-6989586621683022678"><span class="annot"><span class="annottext">index :: Int -&gt; Int -&gt; Int -&gt; ByteOrder -&gt; Word
</span><a href="#local-6989586621683022678"><span class="hs-identifier hs-var hs-var">index</span></a></span></span><span> </span><span id="local-6989586621683022693"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621683022693"><span class="hs-identifier hs-var">size_b</span></a></span></span><span> </span><span id="local-6989586621683022694"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621683022694"><span class="hs-identifier hs-var">aligned_idx</span></a></span></span><span> </span><span id="local-6989586621683022695"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621683022695"><span class="hs-identifier hs-var">word_size</span></a></span></span><span> </span><span id="local-6989586621683022696"><span class="annot"><span class="annottext">ByteOrder
</span><a href="#local-6989586621683022696"><span class="hs-identifier hs-var">endian</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">ByteOrder
</span><a href="#local-6989586621683022696"><span class="hs-identifier hs-var">endian</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-950"></span><span>      </span><span class="annot"><span class="annottext">ByteOrder
</span><span class="hs-identifier hs-var">BigEndian</span></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Word
</span><a href="#local-6989586621683022698"><span class="hs-identifier hs-var">word</span></a></span><span> </span><span class="annot"><span class="annottext">Word -&gt; Int -&gt; Word
forall a. Bits a =&gt; a -&gt; Int -&gt; a
</span><a href="GHC.Prelude.Basic.html#shiftL"><span class="hs-operator hs-var">`shiftL`</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621683022699"><span class="hs-identifier hs-var">moveBits</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Word -&gt; Int -&gt; Word
forall a. Bits a =&gt; a -&gt; Int -&gt; a
</span><a href="GHC.Prelude.Basic.html#shiftR"><span class="hs-operator hs-var">`shiftR`</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621683022701"><span class="hs-identifier hs-var">zeroOutBits</span></a></span><span> </span><span class="annot"><span class="annottext">Word -&gt; Int -&gt; Word
forall a. Bits a =&gt; a -&gt; Int -&gt; a
</span><a href="GHC.Prelude.Basic.html#shiftL"><span class="hs-operator hs-var">`shiftL`</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621683022701"><span class="hs-identifier hs-var">zeroOutBits</span></a></span><span>
</span><span id="line-951"></span><span>      </span><span class="annot"><span class="annottext">ByteOrder
</span><span class="hs-identifier hs-var">LittleEndian</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Word
</span><a href="#local-6989586621683022698"><span class="hs-identifier hs-var">word</span></a></span><span> </span><span class="annot"><span class="annottext">Word -&gt; Int -&gt; Word
forall a. Bits a =&gt; a -&gt; Int -&gt; a
</span><a href="GHC.Prelude.Basic.html#shiftR"><span class="hs-operator hs-var">`shiftR`</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621683022699"><span class="hs-identifier hs-var">moveBits</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Word -&gt; Int -&gt; Word
forall a. Bits a =&gt; a -&gt; Int -&gt; a
</span><a href="GHC.Prelude.Basic.html#shiftL"><span class="hs-operator hs-var">`shiftL`</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621683022701"><span class="hs-identifier hs-var">zeroOutBits</span></a></span><span> </span><span class="annot"><span class="annottext">Word -&gt; Int -&gt; Word
forall a. Bits a =&gt; a -&gt; Int -&gt; a
</span><a href="GHC.Prelude.Basic.html#shiftR"><span class="hs-operator hs-var">`shiftR`</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621683022701"><span class="hs-identifier hs-var">zeroOutBits</span></a></span><span>
</span><span id="line-952"></span><span>     </span><span class="hs-keyword">where</span><span>
</span><span id="line-953"></span><span>      </span><span class="hs-special">(</span><span id="local-6989586621683022703"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621683022703"><span class="hs-identifier hs-var">q</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621683022704"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621683022704"><span class="hs-identifier hs-var">r</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621683022694"><span class="hs-identifier hs-var">aligned_idx</span></a></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; (Int, Int)
forall a. Integral a =&gt; a -&gt; a -&gt; (a, a)
</span><span class="hs-operator hs-var">`quotRem`</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621683022695"><span class="hs-identifier hs-var">word_size</span></a></span><span>
</span><span id="line-954"></span><span>      </span><span id="local-6989586621683022698"><span class="annot"><span class="annottext">word :: Word
</span><a href="#local-6989586621683022698"><span class="hs-identifier hs-var hs-var">word</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[Word]
</span><a href="#local-6989586621683022610"><span class="hs-identifier hs-var">array</span></a></span><span class="annot"><span class="annottext">[Word] -&gt; Int -&gt; Word
forall a. HasCallStack =&gt; [a] -&gt; Int -&gt; a
</span><span class="hs-operator hs-var">!!</span></span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621683022703"><span class="hs-identifier hs-var">q</span></a></span><span>
</span><span id="line-955"></span><span>      </span><span id="local-6989586621683022699"><span class="annot"><span class="annottext">moveBits :: Int
</span><a href="#local-6989586621683022699"><span class="hs-identifier hs-var hs-var">moveBits</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621683022704"><span class="hs-identifier hs-var">r</span></a></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Int
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">*</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">8</span></span><span>
</span><span id="line-956"></span><span>      </span><span id="local-6989586621683022701"><span class="annot"><span class="annottext">zeroOutBits :: Int
</span><a href="#local-6989586621683022701"><span class="hs-identifier hs-var hs-var">zeroOutBits</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621683022695"><span class="hs-identifier hs-var">word_size</span></a></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Int
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-glyph hs-var">-</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621683022693"><span class="hs-identifier hs-var">size_b</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Int
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">*</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">8</span></span><span>
</span><span id="line-957"></span><span>
</span><span id="line-958"></span><span>
</span><span id="line-959"></span><span class="hs-comment">-- | Fast, breadth-first Type reconstruction</span><span>
</span><span id="line-960"></span><span class="hs-comment">--</span><span>
</span><span id="line-961"></span><span class="hs-comment">-- Given a heap object (`HValue`) and its (possibly polymorphic) type (usually</span><span>
</span><span id="line-962"></span><span class="hs-comment">-- obtained in GHCi), try to reconstruct a more monomorphic type of the object.</span><span>
</span><span id="line-963"></span><span class="hs-comment">-- This is used for improving type information in debugger. For example, if we</span><span>
</span><span id="line-964"></span><span class="hs-comment">-- have a polymorphic function:</span><span>
</span><span id="line-965"></span><span class="hs-comment">--</span><span>
</span><span id="line-966"></span><span class="hs-comment">--     sumNumList :: Num a =&gt; [a] -&gt; a</span><span>
</span><span id="line-967"></span><span class="hs-comment">--     sumNumList [] = 0</span><span>
</span><span id="line-968"></span><span class="hs-comment">--     sumNumList (x : xs) = x + sumList xs</span><span>
</span><span id="line-969"></span><span class="hs-comment">--</span><span>
</span><span id="line-970"></span><span class="hs-comment">-- and add a breakpoint to it:</span><span>
</span><span id="line-971"></span><span class="hs-comment">--</span><span>
</span><span id="line-972"></span><span class="hs-comment">--     ghci&gt; break sumNumList</span><span>
</span><span id="line-973"></span><span class="hs-comment">--     ghci&gt; sumNumList ([0 .. 9] :: [Int])</span><span>
</span><span id="line-974"></span><span class="hs-comment">--</span><span>
</span><span id="line-975"></span><span class="hs-comment">-- ghci shows us more precise types than just `a`s:</span><span>
</span><span id="line-976"></span><span class="hs-comment">--</span><span>
</span><span id="line-977"></span><span class="hs-comment">--     Stopped in Main.sumNumList, debugger.hs:3:23-39</span><span>
</span><span id="line-978"></span><span class="hs-comment">--     _result :: Int = _</span><span>
</span><span id="line-979"></span><span class="hs-comment">--     x :: Int = 0</span><span>
</span><span id="line-980"></span><span class="hs-comment">--     xs :: [Int] = _</span><span>
</span><span id="line-981"></span><span class="hs-comment">--</span><span>
</span><span id="line-982"></span><span class="annot"><a href="GHC.Runtime.Heap.Inspect.html#cvReconstructType"><span class="hs-identifier hs-type">cvReconstructType</span></a></span><span>
</span><span id="line-983"></span><span>    </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Driver.Env.Types.html#HscEnv"><span class="hs-identifier hs-type">HscEnv</span></a></span><span>
</span><span id="line-984"></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Int</span></span><span>       </span><span class="annot"><span class="hs-comment">-- ^ How many times to recurse for subterms</span></span><span>
</span><span id="line-985"></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Runtime.Heap.Inspect.html#GhciType"><span class="hs-identifier hs-type">GhciType</span></a></span><span>  </span><span class="annot"><span class="hs-comment">-- ^ Type to refine</span></span><span>
</span><span id="line-986"></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="../../ghci-9.12.2-bd10/src/GHCi.RemoteTypes.html#ForeignHValue"><span class="hs-identifier hs-type">ForeignHValue</span></a></span><span>  </span><span class="annot"><span class="hs-comment">-- ^ Refine the type using this value</span></span><span>
</span><span id="line-987"></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Maybe</span></span><span> </span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#Type"><span class="hs-identifier hs-type">Type</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-988"></span><span id="cvReconstructType"><span class="annot"><span class="annottext">cvReconstructType :: HscEnv -&gt; Int -&gt; Type -&gt; ForeignHValue -&gt; IO (Maybe Type)
</span><a href="GHC.Runtime.Heap.Inspect.html#cvReconstructType"><span class="hs-identifier hs-var hs-var">cvReconstructType</span></a></span></span><span> </span><span id="local-6989586621683022705"><span class="annot"><span class="annottext">HscEnv
</span><a href="#local-6989586621683022705"><span class="hs-identifier hs-var">hsc_env</span></a></span></span><span> </span><span id="local-6989586621683022706"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621683022706"><span class="hs-identifier hs-var">max_depth</span></a></span></span><span> </span><span id="local-6989586621683022707"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621683022707"><span class="hs-identifier hs-var">old_ty</span></a></span></span><span> </span><span id="local-6989586621683022708"><span class="annot"><span class="annottext">ForeignHValue
</span><a href="#local-6989586621683022708"><span class="hs-identifier hs-var">hval</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">HscEnv -&gt; TR Type -&gt; IO (Maybe Type)
forall a. HscEnv -&gt; TR a -&gt; IO (Maybe a)
</span><a href="GHC.Runtime.Heap.Inspect.html#runTR_maybe"><span class="hs-identifier hs-var">runTR_maybe</span></a></span><span> </span><span class="annot"><span class="annottext">HscEnv
</span><a href="#local-6989586621683022705"><span class="hs-identifier hs-var">hsc_env</span></a></span><span> </span><span class="annot"><span class="annottext">(TR Type -&gt; IO (Maybe Type)) -&gt; TR Type -&gt; IO (Maybe Type)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-989"></span><span>   </span><span class="annot"><span class="annottext">SDoc -&gt; TR ()
</span><a href="GHC.Runtime.Heap.Inspect.html#traceTR"><span class="hs-identifier hs-var">traceTR</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">String -&gt; SDoc
forall doc. IsLine doc =&gt; String -&gt; doc
</span><a href="GHC.Utils.Outputable.html#text"><span class="hs-identifier hs-var">text</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;RTTI started with initial type &quot;</span></span><span> </span><span class="annot"><span class="annottext">SDoc -&gt; SDoc -&gt; SDoc
forall doc. IsLine doc =&gt; doc -&gt; doc -&gt; doc
</span><a href="GHC.Utils.Outputable.html#%3C%3E"><span class="hs-operator hs-var">&lt;&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">Type -&gt; SDoc
forall a. Outputable a =&gt; a -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621683022707"><span class="hs-identifier hs-var">old_ty</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-990"></span><span>   </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621683022709"><span class="annot"><span class="annottext">sigma_old_ty :: QuantifiedType
</span><a href="#local-6989586621683022709"><span class="hs-identifier hs-var hs-var">sigma_old_ty</span></a></span></span><span class="hs-glyph">@</span><span class="hs-special">(</span><span id="local-6989586621683022710"><span class="annot"><span class="annottext">[TyVar]
</span><a href="#local-6989586621683022710"><span class="hs-identifier hs-var hs-var">old_tvs</span></a></span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Type
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Type -&gt; QuantifiedType
</span><a href="GHC.Runtime.Heap.Inspect.html#quantifyType"><span class="hs-identifier hs-var">quantifyType</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621683022707"><span class="hs-identifier hs-var">old_ty</span></a></span><span>
</span><span id="line-991"></span><span>   </span><span id="local-6989586621683022711"><span class="annot"><a href="#local-6989586621683022711"><span class="hs-identifier hs-var">new_ty</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span>
</span><span id="line-992"></span><span>       </span><span class="hs-keyword">if</span><span> </span><span class="annot"><span class="annottext">[TyVar] -&gt; Bool
forall a. [a] -&gt; Bool
forall (t :: * -&gt; *) a. Foldable t =&gt; t a -&gt; Bool
</span><span class="hs-identifier hs-var">null</span></span><span> </span><span class="annot"><span class="annottext">[TyVar]
</span><a href="#local-6989586621683022710"><span class="hs-identifier hs-var">old_tvs</span></a></span><span>
</span><span id="line-993"></span><span>        </span><span class="hs-keyword">then</span><span> </span><span class="annot"><span class="annottext">Type -&gt; TR Type
forall a. a -&gt; IOEnv (Env TcGblEnv TcLclEnv) a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621683022707"><span class="hs-identifier hs-var">old_ty</span></a></span><span>
</span><span id="line-994"></span><span>        </span><span class="hs-keyword">else</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-995"></span><span>          </span><span class="hs-special">(</span><span id="local-6989586621683022712"><span class="annot"><a href="#local-6989586621683022712"><span class="hs-identifier hs-var">old_ty'</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621683022713"><span class="annot"><a href="#local-6989586621683022713"><span class="hs-identifier hs-var">rev_subst</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">QuantifiedType -&gt; TR (Type, RttiInstantiation)
</span><a href="GHC.Runtime.Heap.Inspect.html#instScheme"><span class="hs-identifier hs-var">instScheme</span></a></span><span> </span><span class="annot"><span class="annottext">QuantifiedType
</span><a href="#local-6989586621683022709"><span class="hs-identifier hs-var">sigma_old_ty</span></a></span><span>
</span><span id="line-996"></span><span>          </span><span id="local-6989586621683022714"><span class="annot"><a href="#local-6989586621683022714"><span class="hs-identifier hs-var">my_ty</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><a href="GHC.Runtime.Heap.Inspect.html#newOpenVar"><span class="hs-identifier hs-type">newOpenVar</span></a></span><span>
</span><span id="line-997"></span><span>          </span><span class="annot"><span class="hs-identifier hs-type">when</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Runtime.Heap.Inspect.html#check1"><span class="hs-identifier hs-type">check1</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683022710"><span class="hs-identifier hs-type">old_tvs</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Runtime.Heap.Inspect.html#traceTR"><span class="hs-identifier hs-type">traceTR</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Utils.Outputable.html#text"><span class="hs-identifier hs-type">text</span></a></span><span> </span><span class="annot"><span class="hs-string">&quot;check1 passed&quot;</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="hs-operator hs-type">&gt;&gt;</span></span><span>
</span><span id="line-998"></span><span>                                      </span><span class="annot"><a href="GHC.Runtime.Heap.Inspect.html#addConstraint"><span class="hs-identifier hs-type">addConstraint</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683022714"><span class="hs-identifier hs-type">my_ty</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683022712"><span class="hs-identifier hs-type">old_ty'</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-999"></span><span>          </span><span class="annot"><a href="#local-6989586621683022715"><span class="hs-identifier hs-type">search</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Runtime.Heap.Inspect.html#isMonomorphic"><span class="hs-identifier hs-type">isMonomorphic</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">`fmap`</span></span><span> </span><span class="annot"><a href="GHC.Tc.Utils.Monad.html#liftZonkM"><span class="hs-identifier hs-type">liftZonkM</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Tc.Zonk.TcType.html#zonkTcType"><span class="hs-identifier hs-type">zonkTcType</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683022714"><span class="hs-identifier hs-type">my_ty</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-1000"></span><span>                 </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span class="hs-special">(</span><span id="local-6989586621683022716"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621683022716"><span class="hs-identifier hs-var">ty</span></a></span></span><span class="hs-special">,</span><span id="local-6989586621683022717"><span class="annot"><span class="annottext">ForeignHValue
</span><a href="#local-6989586621683022717"><span class="hs-identifier hs-var">a</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Type
-&gt; ForeignHValue
-&gt; IOEnv (Env TcGblEnv TcLclEnv) [(Type, ForeignHValue)]
</span><a href="#local-6989586621683022718"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621683022716"><span class="hs-identifier hs-var">ty</span></a></span><span> </span><span class="annot"><span class="annottext">ForeignHValue
</span><a href="#local-6989586621683022717"><span class="hs-identifier hs-var">a</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1001"></span><span>                 </span><span class="hs-special">(</span><span class="annot"><a href="../../containers-0.7-5a8f/src/Data.Sequence.Internal.html#singleton"><span class="hs-identifier hs-type">Seq.singleton</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621683022714"><span class="hs-identifier hs-type">my_ty</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="#local-6989586621683022708"><span class="hs-identifier hs-type">hval</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-1002"></span><span>                 </span><span class="annot"><a href="#local-6989586621683022706"><span class="hs-identifier hs-type">max_depth</span></a></span><span>
</span><span id="line-1003"></span><span>          </span><span id="local-6989586621683022720"><span class="annot"><a href="#local-6989586621683022720"><span class="hs-identifier hs-var">new_ty</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.Monad.html#liftZonkM"><span class="hs-identifier hs-type">liftZonkM</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="annot"><a href="GHC.Tc.Zonk.TcType.html#zonkTcType"><span class="hs-identifier hs-type">zonkTcType</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683022714"><span class="hs-identifier hs-type">my_ty</span></a></span><span>
</span><span id="line-1004"></span><span>          </span><span class="hs-keyword">if</span><span> </span><span class="annot"><a href="GHC.Runtime.Heap.Inspect.html#isMonomorphic"><span class="hs-identifier hs-type">isMonomorphic</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683022720"><span class="hs-identifier hs-type">new_ty</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">||</span></span><span> </span><span class="annot"><a href="GHC.Runtime.Heap.Inspect.html#check2"><span class="hs-identifier hs-type">check2</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683022720"><span class="hs-identifier hs-type">new_ty</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683022707"><span class="hs-identifier hs-type">old_ty</span></a></span><span>
</span><span id="line-1005"></span><span>            </span><span class="hs-keyword">then</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-1006"></span><span>                 </span><span class="annot"><a href="GHC.Runtime.Heap.Inspect.html#traceTR"><span class="hs-identifier hs-type">traceTR</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Utils.Outputable.html#text"><span class="hs-identifier hs-type">text</span></a></span><span> </span><span class="annot"><span class="hs-string">&quot;check2 passed&quot;</span></span><span> </span><span class="annot"><a href="GHC.Utils.Outputable.html#%3C%2B%3E"><span class="hs-operator hs-type">&lt;+&gt;</span></a></span><span> </span><span class="annot"><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-type">ppr</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683022707"><span class="hs-identifier hs-type">old_ty</span></a></span><span> </span><span class="annot"><a href="GHC.Utils.Outputable.html#%24%24"><span class="hs-operator hs-type">$$</span></a></span><span> </span><span class="annot"><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-type">ppr</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683022720"><span class="hs-identifier hs-type">new_ty</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1007"></span><span>                 </span><span class="annot"><a href="GHC.Runtime.Heap.Inspect.html#addConstraint"><span class="hs-identifier hs-type">addConstraint</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683022714"><span class="hs-identifier hs-type">my_ty</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683022712"><span class="hs-identifier hs-type">old_ty'</span></a></span><span>
</span><span id="line-1008"></span><span>                 </span><span class="annot"><a href="GHC.Runtime.Heap.Inspect.html#applyRevSubst"><span class="hs-identifier hs-type">applyRevSubst</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683022713"><span class="hs-identifier hs-type">rev_subst</span></a></span><span>
</span><span id="line-1009"></span><span>                 </span><span class="annot"><a href="GHC.Runtime.Heap.Inspect.html#zonkRttiType"><span class="hs-identifier hs-type">zonkRttiType</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683022720"><span class="hs-identifier hs-type">new_ty</span></a></span><span>
</span><span id="line-1010"></span><span>            </span><span class="hs-keyword">else</span><span> </span><span class="annot"><a href="GHC.Runtime.Heap.Inspect.html#traceTR"><span class="hs-identifier hs-type">traceTR</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Utils.Outputable.html#text"><span class="hs-identifier hs-type">text</span></a></span><span> </span><span class="annot"><span class="hs-string">&quot;check2 failed&quot;</span></span><span> </span><span class="annot"><a href="GHC.Utils.Outputable.html#%3C%2B%3E"><span class="hs-operator hs-type">&lt;+&gt;</span></a></span><span> </span><span class="annot"><a href="GHC.Utils.Outputable.html#parens"><span class="hs-identifier hs-type">parens</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-type">ppr</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683022720"><span class="hs-identifier hs-type">new_ty</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="annot"><span class="hs-operator hs-type">&gt;&gt;</span></span><span>
</span><span id="line-1011"></span><span>                 </span><span class="annot"><span class="hs-identifier hs-type">return</span></span><span> </span><span class="annot"><a href="#local-6989586621683022707"><span class="hs-identifier hs-type">old_ty</span></a></span><span>
</span><span id="line-1012"></span><span>   </span><span class="annot"><a href="GHC.Runtime.Heap.Inspect.html#traceTR"><span class="hs-identifier hs-type">traceTR</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Utils.Outputable.html#text"><span class="hs-identifier hs-type">text</span></a></span><span> </span><span class="annot"><span class="hs-string">&quot;RTTI completed. Type obtained:&quot;</span></span><span> </span><span class="annot"><a href="GHC.Utils.Outputable.html#%3C%2B%3E"><span class="hs-operator hs-type">&lt;+&gt;</span></a></span><span> </span><span class="annot"><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-type">ppr</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683022711"><span class="hs-identifier hs-type">new_ty</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1013"></span><span>   </span><span class="annot"><span class="hs-identifier hs-type">return</span></span><span> </span><span class="annot"><a href="#local-6989586621683022711"><span class="hs-identifier hs-type">new_ty</span></a></span><span>
</span><span id="line-1014"></span><span>    </span><span class="hs-keyword">where</span><span>
</span><span id="line-1015"></span><span>  </span><span id="local-6989586621683022722"><span class="annot"><span class="annottext">interp :: Interp
</span><a href="#local-6989586621683022722"><span class="hs-identifier hs-var hs-var">interp</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">HscEnv -&gt; Interp
</span><a href="GHC.Driver.Env.html#hscInterp"><span class="hs-identifier hs-var">hscInterp</span></a></span><span> </span><span class="annot"><span class="annottext">HscEnv
</span><a href="#local-6989586621683022705"><span class="hs-identifier hs-var">hsc_env</span></a></span><span>
</span><span id="line-1016"></span><span>
</span><span id="line-1017"></span><span class="hs-comment">--  search :: m Bool -&gt; ([a] -&gt; [a] -&gt; [a]) -&gt; [a] -&gt; m ()</span><span>
</span><span id="line-1018"></span><span>  </span><span id="local-6989586621683022715"><span class="annot"><span class="annottext">search :: IOEnv (Env TcGblEnv TcLclEnv) Bool
-&gt; ((Type, ForeignHValue)
    -&gt; IOEnv (Env TcGblEnv TcLclEnv) [(Type, ForeignHValue)])
-&gt; Seq (Type, ForeignHValue)
-&gt; Int
-&gt; TR ()
</span><a href="#local-6989586621683022715"><span class="hs-identifier hs-var hs-var">search</span></a></span></span><span> </span><span class="annot"><span class="annottext">IOEnv (Env TcGblEnv TcLclEnv) Bool
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">(Type, ForeignHValue)
-&gt; IOEnv (Env TcGblEnv TcLclEnv) [(Type, ForeignHValue)]
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">Seq (Type, ForeignHValue)
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">0</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">SDoc -&gt; TR ()
</span><a href="GHC.Runtime.Heap.Inspect.html#traceTR"><span class="hs-identifier hs-var">traceTR</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">String -&gt; SDoc
forall doc. IsLine doc =&gt; String -&gt; doc
</span><a href="GHC.Utils.Outputable.html#text"><span class="hs-identifier hs-var">text</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;Failed to reconstruct a type after &quot;</span></span><span> </span><span class="annot"><span class="annottext">SDoc -&gt; SDoc -&gt; SDoc
forall doc. IsLine doc =&gt; doc -&gt; doc -&gt; doc
</span><a href="GHC.Utils.Outputable.html#%3C%3E"><span class="hs-operator hs-var">&lt;&gt;</span></a></span><span>
</span><span id="line-1019"></span><span>                                </span><span class="annot"><span class="annottext">Int -&gt; SDoc
forall doc. IsLine doc =&gt; Int -&gt; doc
</span><a href="GHC.Utils.Outputable.html#int"><span class="hs-identifier hs-var">int</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621683022706"><span class="hs-identifier hs-var">max_depth</span></a></span><span> </span><span class="annot"><span class="annottext">SDoc -&gt; SDoc -&gt; SDoc
forall doc. IsLine doc =&gt; doc -&gt; doc -&gt; doc
</span><a href="GHC.Utils.Outputable.html#%3C%3E"><span class="hs-operator hs-var">&lt;&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">String -&gt; SDoc
forall doc. IsLine doc =&gt; String -&gt; doc
</span><a href="GHC.Utils.Outputable.html#text"><span class="hs-identifier hs-var">text</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot; steps&quot;</span></span><span class="hs-special">)</span><span>
</span><span id="line-1020"></span><span>  </span><span class="annot"><a href="#local-6989586621683022715"><span class="hs-identifier hs-var">search</span></a></span><span> </span><span id="local-6989586621683022723"><span class="annot"><span class="annottext">IOEnv (Env TcGblEnv TcLclEnv) Bool
</span><a href="#local-6989586621683022723"><span class="hs-identifier hs-var">stop</span></a></span></span><span> </span><span id="local-6989586621683022724"><span class="annot"><span class="annottext">(Type, ForeignHValue)
-&gt; IOEnv (Env TcGblEnv TcLclEnv) [(Type, ForeignHValue)]
</span><a href="#local-6989586621683022724"><span class="hs-identifier hs-var">expand</span></a></span></span><span> </span><span id="local-6989586621683022725"><span class="annot"><span class="annottext">Seq (Type, ForeignHValue)
</span><a href="#local-6989586621683022725"><span class="hs-identifier hs-var">l</span></a></span></span><span> </span><span id="local-6989586621683022726"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621683022726"><span class="hs-identifier hs-var">d</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-1021"></span><span>    </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">Seq (Type, ForeignHValue) -&gt; ViewL (Type, ForeignHValue)
forall a. Seq a -&gt; ViewL a
</span><a href="../../containers-0.7-5a8f/src/Data.Sequence.Internal.html#viewl"><span class="hs-identifier hs-var">viewl</span></a></span><span> </span><span class="annot"><span class="annottext">Seq (Type, ForeignHValue)
</span><a href="#local-6989586621683022725"><span class="hs-identifier hs-var">l</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-1022"></span><span>      </span><span class="annot"><span class="annottext">ViewL (Type, ForeignHValue)
</span><a href="../../containers-0.7-5a8f/src/Data.Sequence.Internal.html#EmptyL"><span class="hs-identifier hs-var">EmptyL</span></a></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">() -&gt; TR ()
forall a. a -&gt; IOEnv (Env TcGblEnv TcLclEnv) a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-1023"></span><span>      </span><span id="local-6989586621683022728"><span class="annot"><span class="annottext">(Type, ForeignHValue)
</span><a href="#local-6989586621683022728"><span class="hs-identifier hs-var">x</span></a></span></span><span> </span><span class="annot"><a href="../../containers-0.7-5a8f/src/Data.Sequence.Internal.html#%3A%3C"><span class="hs-operator hs-type">:&lt;</span></a></span><span> </span><span id="local-6989586621683022730"><span class="annot"><span class="annottext">Seq (Type, ForeignHValue)
</span><a href="#local-6989586621683022730"><span class="hs-identifier hs-var">xx</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">IOEnv (Env TcGblEnv TcLclEnv) Bool -&gt; TR () -&gt; TR ()
forall (m :: * -&gt; *). Monad m =&gt; m Bool -&gt; m () -&gt; m ()
</span><a href="GHC.Utils.Monad.html#unlessM"><span class="hs-identifier hs-var">unlessM</span></a></span><span> </span><span class="annot"><span class="annottext">IOEnv (Env TcGblEnv TcLclEnv) Bool
</span><a href="#local-6989586621683022723"><span class="hs-identifier hs-var">stop</span></a></span><span> </span><span class="annot"><span class="annottext">(TR () -&gt; TR ()) -&gt; TR () -&gt; TR ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-1024"></span><span>                  </span><span id="local-6989586621683022732"><span class="annot"><a href="#local-6989586621683022732"><span class="hs-identifier hs-var">new</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">(Type, ForeignHValue)
-&gt; IOEnv (Env TcGblEnv TcLclEnv) [(Type, ForeignHValue)]
</span><a href="#local-6989586621683022724"><span class="hs-identifier hs-var">expand</span></a></span><span> </span><span class="annot"><span class="annottext">(Type, ForeignHValue)
</span><a href="#local-6989586621683022728"><span class="hs-identifier hs-var">x</span></a></span><span>
</span><span id="line-1025"></span><span>                  </span><span class="annot"><a href="#local-6989586621683022715"><span class="hs-identifier hs-type">search</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683022723"><span class="hs-identifier hs-type">stop</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683022724"><span class="hs-identifier hs-type">expand</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621683022730"><span class="hs-identifier hs-type">xx</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">`mappend`</span></span><span> </span><span class="annot"><a href="../../containers-0.7-5a8f/src/Data.Sequence.Internal.html#fromList"><span class="hs-identifier hs-type">Seq.fromList</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683022732"><span class="hs-identifier hs-type">new</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="hs-operator hs-type">$!</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">pred</span></span><span> </span><span class="annot"><a href="#local-6989586621683022726"><span class="hs-identifier hs-type">d</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1026"></span><span>
</span><span id="line-1027"></span><span>   </span><span class="hs-comment">-- returns unification tasks,since we are going to want a breadth-first search</span><span>
</span><span id="line-1028"></span><span>  </span><span class="annot"><a href="#local-6989586621683022718"><span class="hs-identifier hs-type">go</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#Type"><span class="hs-identifier hs-type">Type</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="../../ghci-9.12.2-bd10/src/GHCi.RemoteTypes.html#ForeignHValue"><span class="hs-identifier hs-type">ForeignHValue</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Runtime.Heap.Inspect.html#TR"><span class="hs-identifier hs-type">TR</span></a></span><span> </span><span class="hs-special">[</span><span class="hs-special">(</span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#Type"><span class="hs-identifier hs-type">Type</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="../../ghci-9.12.2-bd10/src/GHCi.RemoteTypes.html#ForeignHValue"><span class="hs-identifier hs-type">ForeignHValue</span></a></span><span class="hs-special">)</span><span class="hs-special">]</span><span>
</span><span id="line-1029"></span><span>  </span><span id="local-6989586621683022718"><span class="annot"><span class="annottext">go :: Type
-&gt; ForeignHValue
-&gt; IOEnv (Env TcGblEnv TcLclEnv) [(Type, ForeignHValue)]
</span><a href="#local-6989586621683022718"><span class="hs-identifier hs-var hs-var">go</span></a></span></span><span> </span><span id="local-6989586621683022735"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621683022735"><span class="hs-identifier hs-var">my_ty</span></a></span></span><span> </span><span id="local-6989586621683022736"><span class="annot"><span class="annottext">ForeignHValue
</span><a href="#local-6989586621683022736"><span class="hs-identifier hs-var">a</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-1030"></span><span>    </span><span class="annot"><span class="annottext">SDoc -&gt; TR ()
</span><a href="GHC.Runtime.Heap.Inspect.html#traceTR"><span class="hs-identifier hs-var">traceTR</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">String -&gt; SDoc
forall doc. IsLine doc =&gt; String -&gt; doc
</span><a href="GHC.Utils.Outputable.html#text"><span class="hs-identifier hs-var">text</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;go&quot;</span></span><span> </span><span class="annot"><span class="annottext">SDoc -&gt; SDoc -&gt; SDoc
forall doc. IsLine doc =&gt; doc -&gt; doc -&gt; doc
</span><a href="GHC.Utils.Outputable.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">Type -&gt; SDoc
forall a. Outputable a =&gt; a -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621683022735"><span class="hs-identifier hs-var">my_ty</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1031"></span><span>    </span><span id="local-6989586621683022737"><span class="annot"><a href="#local-6989586621683022737"><span class="hs-identifier hs-var">clos</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">IO (GenClosure ForeignHValue) -&gt; TR (GenClosure ForeignHValue)
forall a. IO a -&gt; TR a
</span><a href="GHC.Runtime.Heap.Inspect.html#trIO"><span class="hs-identifier hs-var">trIO</span></a></span><span> </span><span class="annot"><span class="annottext">(IO (GenClosure ForeignHValue) -&gt; TR (GenClosure ForeignHValue))
-&gt; IO (GenClosure ForeignHValue) -&gt; TR (GenClosure ForeignHValue)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Interp -&gt; ForeignHValue -&gt; IO (GenClosure ForeignHValue)
</span><a href="GHC.Runtime.Interpreter.html#getClosure"><span class="hs-identifier hs-var">GHCi.getClosure</span></a></span><span> </span><span class="annot"><span class="annottext">Interp
</span><a href="#local-6989586621683022722"><span class="hs-identifier hs-var">interp</span></a></span><span> </span><span class="annot"><span class="annottext">ForeignHValue
</span><a href="#local-6989586621683022736"><span class="hs-identifier hs-var">a</span></a></span><span>
</span><span id="line-1032"></span><span>    </span><span class="hs-keyword">case</span><span> </span><span class="annot"><a href="#local-6989586621683022737"><span class="hs-identifier hs-type">clos</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-1033"></span><span>      </span><span class="annot"><a href="../../ghc-heap-9.12.2-4363/src/GHC.Exts.Heap.Closures.html#BlackholeClosure"><span class="hs-identifier hs-type">BlackholeClosure</span></a></span><span class="hs-special">{</span><span class="annot"><span class="annottext">indirectee :: forall b. GenClosure b -&gt; b
</span><a href="../../ghc-heap-9.12.2-4363/src/GHC.Exts.Heap.Closures.html#indirectee"><span class="hs-identifier hs-var">indirectee</span></a></span><span class="hs-glyph">=</span><span id="local-6989586621683022738"><span class="annot"><span class="annottext">ForeignHValue
</span><a href="#local-6989586621683022738"><span class="hs-identifier hs-var">ind</span></a></span></span><span class="hs-special">}</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Type
-&gt; ForeignHValue
-&gt; IOEnv (Env TcGblEnv TcLclEnv) [(Type, ForeignHValue)]
</span><a href="#local-6989586621683022718"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621683022735"><span class="hs-identifier hs-var">my_ty</span></a></span><span> </span><span class="annot"><span class="annottext">ForeignHValue
</span><a href="#local-6989586621683022738"><span class="hs-identifier hs-var">ind</span></a></span><span>
</span><span id="line-1034"></span><span>      </span><span class="annot"><a href="../../ghc-heap-9.12.2-4363/src/GHC.Exts.Heap.Closures.html#IndClosure"><span class="hs-identifier hs-type">IndClosure</span></a></span><span class="hs-special">{</span><span class="annot"><span class="annottext">indirectee :: forall b. GenClosure b -&gt; b
</span><a href="../../ghc-heap-9.12.2-4363/src/GHC.Exts.Heap.Closures.html#indirectee"><span class="hs-identifier hs-var">indirectee</span></a></span><span class="hs-glyph">=</span><span id="local-6989586621683022739"><span class="annot"><span class="annottext">ForeignHValue
</span><a href="#local-6989586621683022739"><span class="hs-identifier hs-var">ind</span></a></span></span><span class="hs-special">}</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Type
-&gt; ForeignHValue
-&gt; IOEnv (Env TcGblEnv TcLclEnv) [(Type, ForeignHValue)]
</span><a href="#local-6989586621683022718"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621683022735"><span class="hs-identifier hs-var">my_ty</span></a></span><span> </span><span class="annot"><span class="annottext">ForeignHValue
</span><a href="#local-6989586621683022739"><span class="hs-identifier hs-var">ind</span></a></span><span>
</span><span id="line-1035"></span><span>      </span><span class="annot"><a href="../../ghc-heap-9.12.2-4363/src/GHC.Exts.Heap.Closures.html#MutVarClosure"><span class="hs-identifier hs-type">MutVarClosure</span></a></span><span class="hs-special">{</span><span class="annot"><span class="annottext">var :: forall b. GenClosure b -&gt; b
</span><a href="../../ghc-heap-9.12.2-4363/src/GHC.Exts.Heap.Closures.html#var"><span class="hs-identifier hs-var">var</span></a></span><span class="hs-glyph">=</span><span id="local-6989586621683022740"><span class="annot"><span class="annottext">ForeignHValue
</span><a href="#local-6989586621683022740"><span class="hs-identifier hs-var">contents</span></a></span></span><span class="hs-special">}</span><span>
</span><span id="line-1036"></span><span>        </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span class="hs-special">(</span><span id="local-6989586621683022741"><span class="annot"><span class="annottext">TyCon
</span><a href="#local-6989586621683022741"><span class="hs-identifier hs-var">_tycon</span></a></span></span><span class="hs-special">,</span><span class="hs-special">[</span><span id="local-6989586621683022742"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621683022742"><span class="hs-identifier hs-var">lev</span></a></span></span><span class="hs-special">,</span><span id="local-6989586621683022743"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621683022743"><span class="hs-identifier hs-var">_world</span></a></span></span><span class="hs-special">,</span><span id="local-6989586621683022744"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621683022744"><span class="hs-identifier hs-var">_contents_ty</span></a></span></span><span class="hs-special">]</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">HasDebugCallStack =&gt; Type -&gt; Maybe (TyCon, [Type])
Type -&gt; Maybe (TyCon, [Type])
</span><a href="GHC.Core.Type.html#tcSplitTyConApp_maybe"><span class="hs-identifier hs-var">tcSplitTyConApp_maybe</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621683022735"><span class="hs-identifier hs-var">my_ty</span></a></span><span>
</span><span id="line-1037"></span><span>        </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-1038"></span><span>        </span><span class="annot"><span class="annottext">Bool -&gt; TR ()
forall (m :: * -&gt; *). (HasCallStack, Applicative m) =&gt; Bool -&gt; m ()
</span><a href="GHC.Utils.Panic.Plain.html#massert"><span class="hs-identifier hs-var">massert</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TyCon
</span><a href="#local-6989586621683022741"><span class="hs-identifier hs-var">_tycon</span></a></span><span> </span><span class="annot"><span class="annottext">TyCon -&gt; TyCon -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">==</span></span><span> </span><span class="annot"><span class="annottext">TyCon
</span><a href="GHC.Builtin.Types.Prim.html#mutVarPrimTyCon"><span class="hs-identifier hs-var">mutVarPrimTyCon</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1039"></span><span>        </span><span id="local-6989586621683022745"><span class="annot"><a href="#local-6989586621683022745"><span class="hs-identifier hs-var">tv'</span></a></span></span><span>   </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Type -&gt; TR Type
</span><a href="GHC.Runtime.Heap.Inspect.html#newVar"><span class="hs-identifier hs-var">newVar</span></a></span><span> </span><span class="annot"><span class="annottext">(Type -&gt; TR Type) -&gt; Type -&gt; TR Type
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Type -&gt; Type
</span><a href="GHC.Core.Type.html#mkTYPEapp"><span class="hs-identifier hs-var">mkTYPEapp</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TyCon -&gt; [Type] -&gt; Type
</span><a href="GHC.Core.Type.html#mkTyConApp"><span class="hs-identifier hs-var">mkTyConApp</span></a></span><span> </span><span class="annot"><span class="annottext">TyCon
</span><a href="GHC.Builtin.Types.html#boxedRepDataConTyCon"><span class="hs-identifier hs-var">boxedRepDataConTyCon</span></a></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621683022742"><span class="hs-identifier hs-var">lev</span></a></span><span class="hs-special">]</span><span class="hs-special">)</span><span>
</span><span id="line-1040"></span><span>        </span><span id="local-6989586621683022746"><span class="annot"><a href="#local-6989586621683022746"><span class="hs-identifier hs-var">world</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><a href="GHC.Runtime.Heap.Inspect.html#newVar"><span class="hs-identifier hs-type">newVar</span></a></span><span> </span><span class="annot"><a href="GHC.Builtin.Types.html#liftedTypeKind"><span class="hs-identifier hs-type">liftedTypeKind</span></a></span><span>
</span><span id="line-1041"></span><span>        </span><span class="annot"><a href="GHC.Runtime.Heap.Inspect.html#addConstraint"><span class="hs-identifier hs-type">addConstraint</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683022735"><span class="hs-identifier hs-type">my_ty</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="annot"><a href="GHC.Builtin.Types.Prim.html#mkMutVarPrimTy"><span class="hs-identifier hs-type">mkMutVarPrimTy</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683022746"><span class="hs-identifier hs-type">world</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683022745"><span class="hs-identifier hs-type">tv'</span></a></span><span>
</span><span id="line-1042"></span><span>        </span><span class="annot"><span class="hs-identifier hs-type">return</span></span><span> </span><span class="hs-special">[</span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621683022745"><span class="hs-identifier hs-type">tv'</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="#local-6989586621683022740"><span class="hs-identifier hs-type">contents</span></a></span><span class="hs-special">)</span><span class="hs-special">]</span><span>
</span><span id="line-1043"></span><span>      </span><span class="annot"><a href="../../ghc-heap-9.12.2-4363/src/GHC.Exts.Heap.Closures.html#APClosure"><span class="hs-identifier hs-type">APClosure</span></a></span><span> </span><span class="hs-special">{</span><span class="annot"><span class="annottext">payload :: forall b. GenClosure b -&gt; [b]
</span><a href="../../ghc-heap-9.12.2-4363/src/GHC.Exts.Heap.Closures.html#payload"><span class="hs-identifier hs-var">payload</span></a></span><span class="hs-glyph">=</span><span id="local-6989586621683022749"><span class="annot"><span class="annottext">[ForeignHValue]
</span><a href="#local-6989586621683022749"><span class="hs-identifier hs-var">pLoad</span></a></span></span><span class="hs-special">}</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>                </span><span class="hs-comment">-- #19559 (incr)</span><span>
</span><span id="line-1044"></span><span>        </span><span class="annot"><span class="annottext">(ForeignHValue
 -&gt; IOEnv (Env TcGblEnv TcLclEnv) [(Type, ForeignHValue)])
-&gt; [ForeignHValue] -&gt; TR ()
forall (t :: * -&gt; *) (m :: * -&gt; *) a b.
(Foldable t, Monad m) =&gt;
(a -&gt; m b) -&gt; t a -&gt; m ()
</span><span class="hs-identifier hs-var">mapM_</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Type
-&gt; ForeignHValue
-&gt; IOEnv (Env TcGblEnv TcLclEnv) [(Type, ForeignHValue)]
</span><a href="#local-6989586621683022718"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621683022735"><span class="hs-identifier hs-var">my_ty</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[ForeignHValue]
</span><a href="#local-6989586621683022749"><span class="hs-identifier hs-var">pLoad</span></a></span><span>
</span><span id="line-1045"></span><span>        </span><span class="annot"><span class="annottext">[(Type, ForeignHValue)]
-&gt; IOEnv (Env TcGblEnv TcLclEnv) [(Type, ForeignHValue)]
forall a. a -&gt; IOEnv (Env TcGblEnv TcLclEnv) a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span>
</span><span id="line-1046"></span><span>      </span><span class="annot"><a href="../../ghc-heap-9.12.2-4363/src/GHC.Exts.Heap.Closures.html#ConstrClosure"><span class="hs-identifier hs-type">ConstrClosure</span></a></span><span class="hs-special">{</span><span class="annot"><span class="annottext">ptrArgs :: forall b. GenClosure b -&gt; [b]
</span><a href="../../ghc-heap-9.12.2-4363/src/GHC.Exts.Heap.Closures.html#ptrArgs"><span class="hs-identifier hs-var">ptrArgs</span></a></span><span class="hs-glyph">=</span><span id="local-6989586621683022750"><span class="annot"><span class="annottext">[ForeignHValue]
</span><a href="#local-6989586621683022750"><span class="hs-identifier hs-var">pArgs</span></a></span></span><span class="hs-special">}</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-1047"></span><span>        </span><span class="annot"><span class="hs-identifier hs-type">Right</span></span><span> </span><span id="local-6989586621683022751"><span class="annot"><a href="#local-6989586621683022751"><span class="hs-identifier hs-var">dcname</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">IO (Either String Name)
-&gt; IOEnv (Env TcGblEnv TcLclEnv) (Either String Name)
forall a. IO a -&gt; TR a
forall (m :: * -&gt; *) a. MonadIO m =&gt; IO a -&gt; m a
</span><span class="hs-identifier hs-var">liftIO</span></span><span> </span><span class="annot"><span class="annottext">(IO (Either String Name)
 -&gt; IOEnv (Env TcGblEnv TcLclEnv) (Either String Name))
-&gt; IO (Either String Name)
-&gt; IOEnv (Env TcGblEnv TcLclEnv) (Either String Name)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">HscEnv -&gt; GenClosure ForeignHValue -&gt; IO (Either String Name)
forall a. HscEnv -&gt; GenClosure a -&gt; IO (Either String Name)
</span><a href="GHC.Runtime.Heap.Inspect.html#constrClosToName"><span class="hs-identifier hs-var">constrClosToName</span></a></span><span> </span><span class="annot"><span class="annottext">HscEnv
</span><a href="#local-6989586621683022705"><span class="hs-identifier hs-var">hsc_env</span></a></span><span> </span><span class="annot"><span class="annottext">GenClosure ForeignHValue
</span><a href="#local-6989586621683022737"><span class="hs-identifier hs-var">clos</span></a></span><span>
</span><span id="line-1048"></span><span>        </span><span class="annot"><a href="GHC.Runtime.Heap.Inspect.html#traceTR"><span class="hs-identifier hs-type">traceTR</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Utils.Outputable.html#text"><span class="hs-identifier hs-type">text</span></a></span><span> </span><span class="annot"><span class="hs-string">&quot;Constr1&quot;</span></span><span> </span><span class="annot"><a href="GHC.Utils.Outputable.html#%3C%2B%3E"><span class="hs-operator hs-type">&lt;+&gt;</span></a></span><span> </span><span class="annot"><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-type">ppr</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683022751"><span class="hs-identifier hs-type">dcname</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1049"></span><span>        </span><span class="hs-special">(</span><span id="local-6989586621683022752"><span class="annot"><a href="#local-6989586621683022752"><span class="hs-identifier hs-var">mb_dc</span></a></span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.Monad.html#tryTc"><span class="hs-identifier hs-type">tryTc</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Tc.Utils.Env.html#tcLookupDataCon"><span class="hs-identifier hs-type">tcLookupDataCon</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683022751"><span class="hs-identifier hs-type">dcname</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1050"></span><span>        </span><span class="hs-keyword">case</span><span> </span><span class="annot"><a href="#local-6989586621683022752"><span class="hs-identifier hs-type">mb_dc</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-1051"></span><span>          </span><span class="annot"><span class="annottext">Maybe DataCon
</span><span class="hs-identifier hs-var">Nothing</span></span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-1052"></span><span>            </span><span class="annot"><span class="annottext">[ForeignHValue]
-&gt; (ForeignHValue
    -&gt; IOEnv (Env TcGblEnv TcLclEnv) (Type, ForeignHValue))
-&gt; IOEnv (Env TcGblEnv TcLclEnv) [(Type, ForeignHValue)]
forall (t :: * -&gt; *) (m :: * -&gt; *) a b.
(Traversable t, Monad m) =&gt;
t a -&gt; (a -&gt; m b) -&gt; m (t b)
</span><span class="hs-identifier hs-var">forM</span></span><span> </span><span class="annot"><span class="annottext">[ForeignHValue]
</span><a href="#local-6989586621683022750"><span class="hs-identifier hs-var">pArgs</span></a></span><span> </span><span class="annot"><span class="annottext">((ForeignHValue
  -&gt; IOEnv (Env TcGblEnv TcLclEnv) (Type, ForeignHValue))
 -&gt; IOEnv (Env TcGblEnv TcLclEnv) [(Type, ForeignHValue)])
-&gt; (ForeignHValue
    -&gt; IOEnv (Env TcGblEnv TcLclEnv) (Type, ForeignHValue))
-&gt; IOEnv (Env TcGblEnv TcLclEnv) [(Type, ForeignHValue)]
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-glyph">\</span><span id="local-6989586621683022754"><span class="annot"><span class="annottext">ForeignHValue
</span><a href="#local-6989586621683022754"><span class="hs-identifier hs-var">x</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-1053"></span><span>              </span><span id="local-6989586621683022755"><span class="annot"><a href="#local-6989586621683022755"><span class="hs-identifier hs-var">tv</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Type -&gt; TR Type
</span><a href="GHC.Runtime.Heap.Inspect.html#newVar"><span class="hs-identifier hs-var">newVar</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="GHC.Builtin.Types.html#liftedTypeKind"><span class="hs-identifier hs-var">liftedTypeKind</span></a></span><span>
</span><span id="line-1054"></span><span>              </span><span class="annot"><span class="hs-identifier hs-type">return</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621683022755"><span class="hs-identifier hs-type">tv</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="#local-6989586621683022754"><span class="hs-identifier hs-type">x</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1055"></span><span>
</span><span id="line-1056"></span><span>          </span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span id="local-6989586621683022756"><span class="annot"><span class="annottext">DataCon
</span><a href="#local-6989586621683022756"><span class="hs-identifier hs-var">dc</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-1057"></span><span>            </span><span id="local-6989586621683022757"><span class="annot"><a href="#local-6989586621683022757"><span class="hs-identifier hs-var">arg_tys</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">DataCon -&gt; Type -&gt; IOEnv (Env TcGblEnv TcLclEnv) [Type]
</span><a href="GHC.Runtime.Heap.Inspect.html#getDataConArgTys"><span class="hs-identifier hs-var">getDataConArgTys</span></a></span><span> </span><span class="annot"><span class="annottext">DataCon
</span><a href="#local-6989586621683022756"><span class="hs-identifier hs-var">dc</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621683022735"><span class="hs-identifier hs-var">my_ty</span></a></span><span>
</span><span id="line-1058"></span><span>            </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">_</span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621683022758"><span class="annot"><a href="#local-6989586621683022758"><span class="hs-identifier hs-var">itys</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><a href="GHC.Runtime.Heap.Inspect.html#findPtrTyss"><span class="hs-identifier hs-type">findPtrTyss</span></a></span><span> </span><span class="annot"><span class="hs-number">0</span></span><span> </span><span class="annot"><a href="#local-6989586621683022757"><span class="hs-identifier hs-type">arg_tys</span></a></span><span>
</span><span id="line-1059"></span><span>            </span><span class="annot"><a href="GHC.Runtime.Heap.Inspect.html#traceTR"><span class="hs-identifier hs-type">traceTR</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Utils.Outputable.html#text"><span class="hs-identifier hs-type">text</span></a></span><span> </span><span class="annot"><span class="hs-string">&quot;Constr2&quot;</span></span><span> </span><span class="annot"><a href="GHC.Utils.Outputable.html#%3C%2B%3E"><span class="hs-operator hs-type">&lt;+&gt;</span></a></span><span> </span><span class="annot"><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-type">ppr</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683022751"><span class="hs-identifier hs-type">dcname</span></a></span><span> </span><span class="annot"><a href="GHC.Utils.Outputable.html#%3C%2B%3E"><span class="hs-operator hs-type">&lt;+&gt;</span></a></span><span> </span><span class="annot"><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-type">ppr</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683022757"><span class="hs-identifier hs-type">arg_tys</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1060"></span><span>            </span><span class="annot"><span class="hs-identifier hs-type">return</span></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">zipWith</span></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int
</span><span class="hs-identifier">_</span></span><span class="hs-special">,</span><span id="local-6989586621683022760"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621683022760"><span class="hs-identifier hs-var">ty</span></a></span></span><span class="hs-special">)</span><span> </span><span id="local-6989586621683022761"><span class="annot"><span class="annottext">ForeignHValue
</span><a href="#local-6989586621683022761"><span class="hs-identifier hs-var">x</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621683022760"><span class="hs-identifier hs-var">ty</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">ForeignHValue
</span><a href="#local-6989586621683022761"><span class="hs-identifier hs-var">x</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="annot"><a href="#local-6989586621683022758"><span class="hs-identifier hs-type">itys</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683022750"><span class="hs-identifier hs-type">pArgs</span></a></span><span>
</span><span id="line-1061"></span><span>      </span><span class="annot"><span class="annottext">GenClosure ForeignHValue
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">[(Type, ForeignHValue)]
-&gt; IOEnv (Env TcGblEnv TcLclEnv) [(Type, ForeignHValue)]
forall a. a -&gt; IOEnv (Env TcGblEnv TcLclEnv) a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span>
</span><span id="line-1062"></span><span>
</span><span id="line-1063"></span><span class="annot"><a href="GHC.Runtime.Heap.Inspect.html#findPtrTys"><span class="hs-identifier hs-type">findPtrTys</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Int</span></span><span>  </span><span class="hs-comment">-- Current pointer index</span><span>
</span><span id="line-1064"></span><span>           </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#Type"><span class="hs-identifier hs-type">Type</span></a></span><span> </span><span class="hs-comment">-- Type</span><span>
</span><span id="line-1065"></span><span>           </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Runtime.Heap.Inspect.html#TR"><span class="hs-identifier hs-type">TR</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Int</span></span><span class="hs-special">,</span><span> </span><span class="hs-special">[</span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Int</span></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#Type"><span class="hs-identifier hs-type">Type</span></a></span><span class="hs-special">)</span><span class="hs-special">]</span><span class="hs-special">)</span><span>
</span><span id="line-1066"></span><span id="findPtrTys"><span class="annot"><span class="annottext">findPtrTys :: Int -&gt; Type -&gt; TR (Int, [(Int, Type)])
</span><a href="GHC.Runtime.Heap.Inspect.html#findPtrTys"><span class="hs-identifier hs-var hs-var">findPtrTys</span></a></span></span><span> </span><span id="local-6989586621683022763"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621683022763"><span class="hs-identifier hs-var">i</span></a></span></span><span> </span><span id="local-6989586621683022764"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621683022764"><span class="hs-identifier hs-var">ty</span></a></span></span><span>
</span><span id="line-1067"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span class="hs-special">(</span><span id="local-6989586621683022765"><span class="annot"><span class="annottext">TyCon
</span><a href="#local-6989586621683022765"><span class="hs-identifier hs-var">tc</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621683022766"><span class="annot"><span class="annottext">[Type]
</span><a href="#local-6989586621683022766"><span class="hs-identifier hs-var">elem_tys</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">HasDebugCallStack =&gt; Type -&gt; Maybe (TyCon, [Type])
Type -&gt; Maybe (TyCon, [Type])
</span><a href="GHC.Core.Type.html#tcSplitTyConApp_maybe"><span class="hs-identifier hs-var">tcSplitTyConApp_maybe</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621683022764"><span class="hs-identifier hs-var">ty</span></a></span><span>
</span><span id="line-1068"></span><span>  </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">TyCon -&gt; Bool
</span><a href="GHC.Core.TyCon.html#isUnboxedTupleTyCon"><span class="hs-identifier hs-var">isUnboxedTupleTyCon</span></a></span><span> </span><span class="annot"><span class="annottext">TyCon
</span><a href="#local-6989586621683022765"><span class="hs-identifier hs-var">tc</span></a></span><span>
</span><span id="line-1069"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Int -&gt; [Type] -&gt; TR (Int, [(Int, Type)])
</span><a href="GHC.Runtime.Heap.Inspect.html#findPtrTyss"><span class="hs-identifier hs-var">findPtrTyss</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621683022763"><span class="hs-identifier hs-var">i</span></a></span><span> </span><span class="annot"><span class="annottext">[Type]
</span><a href="#local-6989586621683022766"><span class="hs-identifier hs-var">elem_tys</span></a></span><span>
</span><span id="line-1070"></span><span>
</span><span id="line-1071"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">otherwise</span></span><span>
</span><span id="line-1072"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">HasDebugCallStack =&gt; Type -&gt; [PrimRep]
Type -&gt; [PrimRep]
</span><a href="GHC.Types.RepType.html#typePrimRep"><span class="hs-identifier hs-var">typePrimRep</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621683022764"><span class="hs-identifier hs-var">ty</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-1073"></span><span>      </span><span class="hs-special">[</span><span id="local-6989586621683022767"><span class="annot"><span class="annottext">PrimRep
</span><a href="#local-6989586621683022767"><span class="hs-identifier hs-var">rep</span></a></span></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">PrimRep -&gt; Bool
</span><a href="GHC.Core.TyCon.html#isGcPtrRep"><span class="hs-identifier hs-var">isGcPtrRep</span></a></span><span> </span><span class="annot"><span class="annottext">PrimRep
</span><a href="#local-6989586621683022767"><span class="hs-identifier hs-var">rep</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">(Int, [(Int, Type)]) -&gt; TR (Int, [(Int, Type)])
forall a. a -&gt; IOEnv (Env TcGblEnv TcLclEnv) a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621683022763"><span class="hs-identifier hs-var">i</span></a></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Int
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">+</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">1</span></span><span class="hs-special">,</span><span> </span><span class="hs-special">[</span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621683022763"><span class="hs-identifier hs-var">i</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621683022764"><span class="hs-identifier hs-var">ty</span></a></span><span class="hs-special">)</span><span class="hs-special">]</span><span class="hs-special">)</span><span>
</span><span id="line-1074"></span><span>            </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">otherwise</span></span><span>      </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">(Int, [(Int, Type)]) -&gt; TR (Int, [(Int, Type)])
forall a. a -&gt; IOEnv (Env TcGblEnv TcLclEnv) a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621683022763"><span class="hs-identifier hs-var">i</span></a></span><span class="hs-special">,</span><span>     </span><span class="hs-special">[</span><span class="hs-special">]</span><span class="hs-special">)</span><span>
</span><span id="line-1075"></span><span>      </span><span id="local-6989586621683022768"><span class="annot"><span class="annottext">[PrimRep]
</span><a href="#local-6989586621683022768"><span class="hs-identifier hs-var">prim_reps</span></a></span></span><span>              </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-1076"></span><span>        </span><span class="annot"><span class="annottext">((Int, [(Int, Type)]) -&gt; PrimRep -&gt; TR (Int, [(Int, Type)]))
-&gt; (Int, [(Int, Type)]) -&gt; [PrimRep] -&gt; TR (Int, [(Int, Type)])
forall (t :: * -&gt; *) (m :: * -&gt; *) b a.
(Foldable t, Monad m) =&gt;
(b -&gt; a -&gt; m b) -&gt; b -&gt; t a -&gt; m b
</span><span class="hs-identifier hs-var">foldM</span></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span class="hs-special">(</span><span id="local-6989586621683022770"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621683022770"><span class="hs-identifier hs-var">i</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621683022771"><span class="annot"><span class="annottext">[(Int, Type)]
</span><a href="#local-6989586621683022771"><span class="hs-identifier hs-var">extras</span></a></span></span><span class="hs-special">)</span><span> </span><span id="local-6989586621683022772"><span class="annot"><span class="annottext">PrimRep
</span><a href="#local-6989586621683022772"><span class="hs-identifier hs-var">prim_rep</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-1077"></span><span>                </span><span class="hs-keyword">if</span><span> </span><span class="annot"><span class="annottext">PrimRep -&gt; Bool
</span><a href="GHC.Core.TyCon.html#isGcPtrRep"><span class="hs-identifier hs-var">isGcPtrRep</span></a></span><span> </span><span class="annot"><span class="annottext">PrimRep
</span><a href="#local-6989586621683022772"><span class="hs-identifier hs-var">prim_rep</span></a></span><span>
</span><span id="line-1078"></span><span>                  </span><span class="hs-keyword">then</span><span> </span><span class="annot"><span class="annottext">Type -&gt; TR Type
</span><a href="GHC.Runtime.Heap.Inspect.html#newVar"><span class="hs-identifier hs-var">newVar</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="GHC.Builtin.Types.html#liftedTypeKind"><span class="hs-identifier hs-var">liftedTypeKind</span></a></span><span> </span><span class="annot"><span class="annottext">TR Type
-&gt; (Type -&gt; TR (Int, [(Int, Type)])) -&gt; TR (Int, [(Int, Type)])
forall a b.
IOEnv (Env TcGblEnv TcLclEnv) a
-&gt; (a -&gt; IOEnv (Env TcGblEnv TcLclEnv) b)
-&gt; IOEnv (Env TcGblEnv TcLclEnv) b
forall (m :: * -&gt; *) a b. Monad m =&gt; m a -&gt; (a -&gt; m b) -&gt; m b
</span><span class="hs-operator hs-var">&gt;&gt;=</span></span><span> </span><span class="hs-glyph">\</span><span id="local-6989586621683022773"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621683022773"><span class="hs-identifier hs-var">tv</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">(Int, [(Int, Type)]) -&gt; TR (Int, [(Int, Type)])
forall a. a -&gt; IOEnv (Env TcGblEnv TcLclEnv) a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621683022770"><span class="hs-identifier hs-var">i</span></a></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Int
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">+</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">1</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">[(Int, Type)]
</span><a href="#local-6989586621683022771"><span class="hs-identifier hs-var">extras</span></a></span><span> </span><span class="annot"><span class="annottext">[(Int, Type)] -&gt; [(Int, Type)] -&gt; [(Int, Type)]
forall a. [a] -&gt; [a] -&gt; [a]
</span><span class="hs-operator hs-var">++</span></span><span> </span><span class="hs-special">[</span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621683022770"><span class="hs-identifier hs-var">i</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621683022773"><span class="hs-identifier hs-var">tv</span></a></span><span class="hs-special">)</span><span class="hs-special">]</span><span class="hs-special">)</span><span>
</span><span id="line-1079"></span><span>                  </span><span class="hs-keyword">else</span><span> </span><span class="annot"><span class="annottext">(Int, [(Int, Type)]) -&gt; TR (Int, [(Int, Type)])
forall a. a -&gt; IOEnv (Env TcGblEnv TcLclEnv) a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621683022770"><span class="hs-identifier hs-var">i</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">[(Int, Type)]
</span><a href="#local-6989586621683022771"><span class="hs-identifier hs-var">extras</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-1080"></span><span>              </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621683022763"><span class="hs-identifier hs-var">i</span></a></span><span class="hs-special">,</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[PrimRep]
</span><a href="#local-6989586621683022768"><span class="hs-identifier hs-var">prim_reps</span></a></span><span>
</span><span id="line-1081"></span><span>
</span><span id="line-1082"></span><span class="annot"><a href="GHC.Runtime.Heap.Inspect.html#findPtrTyss"><span class="hs-identifier hs-type">findPtrTyss</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Int</span></span><span>
</span><span id="line-1083"></span><span>            </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#Type"><span class="hs-identifier hs-type">Type</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-1084"></span><span>            </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Runtime.Heap.Inspect.html#TR"><span class="hs-identifier hs-type">TR</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Int</span></span><span class="hs-special">,</span><span> </span><span class="hs-special">[</span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Int</span></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#Type"><span class="hs-identifier hs-type">Type</span></a></span><span class="hs-special">)</span><span class="hs-special">]</span><span class="hs-special">)</span><span>
</span><span id="line-1085"></span><span id="findPtrTyss"><span class="annot"><span class="annottext">findPtrTyss :: Int -&gt; [Type] -&gt; TR (Int, [(Int, Type)])
</span><a href="GHC.Runtime.Heap.Inspect.html#findPtrTyss"><span class="hs-identifier hs-var hs-var">findPtrTyss</span></a></span></span><span> </span><span id="local-6989586621683022774"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621683022774"><span class="hs-identifier hs-var">i</span></a></span></span><span> </span><span id="local-6989586621683022775"><span class="annot"><span class="annottext">[Type]
</span><a href="#local-6989586621683022775"><span class="hs-identifier hs-var">tys</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">((Int, [(Int, Type)]) -&gt; Type -&gt; TR (Int, [(Int, Type)]))
-&gt; (Int, [(Int, Type)]) -&gt; [Type] -&gt; TR (Int, [(Int, Type)])
forall (t :: * -&gt; *) (m :: * -&gt; *) b a.
(Foldable t, Monad m) =&gt;
(b -&gt; a -&gt; m b) -&gt; b -&gt; t a -&gt; m b
</span><span class="hs-identifier hs-var">foldM</span></span><span> </span><span class="annot"><span class="annottext">(Int, [(Int, Type)]) -&gt; Type -&gt; TR (Int, [(Int, Type)])
</span><a href="#local-6989586621683022776"><span class="hs-identifier hs-var">step</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621683022774"><span class="hs-identifier hs-var">i</span></a></span><span class="hs-special">,</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[Type]
</span><a href="#local-6989586621683022775"><span class="hs-identifier hs-var">tys</span></a></span><span>
</span><span id="line-1086"></span><span>  </span><span class="hs-keyword">where</span><span> </span><span id="local-6989586621683022776"><span class="annot"><span class="annottext">step :: (Int, [(Int, Type)]) -&gt; Type -&gt; TR (Int, [(Int, Type)])
</span><a href="#local-6989586621683022776"><span class="hs-identifier hs-var hs-var">step</span></a></span></span><span> </span><span class="hs-special">(</span><span id="local-6989586621683022779"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621683022779"><span class="hs-identifier hs-var">i</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621683022780"><span class="annot"><span class="annottext">[(Int, Type)]
</span><a href="#local-6989586621683022780"><span class="hs-identifier hs-var">discovered</span></a></span></span><span class="hs-special">)</span><span> </span><span id="local-6989586621683022781"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621683022781"><span class="hs-identifier hs-var">elem_ty</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-1087"></span><span>          </span><span class="hs-special">(</span><span id="local-6989586621683022782"><span class="annot"><a href="#local-6989586621683022782"><span class="hs-identifier hs-var">i</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621683022783"><span class="annot"><a href="#local-6989586621683022783"><span class="hs-identifier hs-var">extras</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Int -&gt; Type -&gt; TR (Int, [(Int, Type)])
</span><a href="GHC.Runtime.Heap.Inspect.html#findPtrTys"><span class="hs-identifier hs-var">findPtrTys</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621683022779"><span class="hs-identifier hs-var">i</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621683022781"><span class="hs-identifier hs-var">elem_ty</span></a></span><span>
</span><span id="line-1088"></span><span>          </span><span class="annot"><span class="hs-identifier hs-type">return</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621683022782"><span class="hs-identifier hs-type">i</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="#local-6989586621683022780"><span class="hs-identifier hs-type">discovered</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">++</span></span><span> </span><span class="annot"><a href="#local-6989586621683022783"><span class="hs-identifier hs-type">extras</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1089"></span><span>
</span><span id="line-1090"></span><span>
</span><span id="line-1091"></span><span class="hs-comment">-- Compute the difference between a base type and the type found by RTTI</span><span>
</span><span id="line-1092"></span><span class="hs-comment">-- improveType &lt;base_type&gt; &lt;rtti_type&gt;</span><span>
</span><span id="line-1093"></span><span class="hs-comment">-- The types can contain skolem type variables, which need to be treated as normal vars.</span><span>
</span><span id="line-1094"></span><span class="hs-comment">-- In particular, we want them to unify with things.</span><span>
</span><span id="line-1095"></span><span class="annot"><a href="GHC.Runtime.Heap.Inspect.html#improveRTTIType"><span class="hs-identifier hs-type">improveRTTIType</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Driver.Env.Types.html#HscEnv"><span class="hs-identifier hs-type">HscEnv</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Runtime.Heap.Inspect.html#RttiType"><span class="hs-identifier hs-type">RttiType</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Runtime.Heap.Inspect.html#RttiType"><span class="hs-identifier hs-type">RttiType</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Maybe</span></span><span> </span><span class="annot"><a href="GHC.Core.TyCo.Subst.html#Subst"><span class="hs-identifier hs-type">Subst</span></a></span><span>
</span><span id="line-1096"></span><span id="improveRTTIType"><span class="annot"><span class="annottext">improveRTTIType :: HscEnv -&gt; Type -&gt; Type -&gt; Maybe Subst
</span><a href="GHC.Runtime.Heap.Inspect.html#improveRTTIType"><span class="hs-identifier hs-var hs-var">improveRTTIType</span></a></span></span><span> </span><span class="annot"><span class="annottext">HscEnv
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621683022784"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621683022784"><span class="hs-identifier hs-var">base_ty</span></a></span></span><span> </span><span id="local-6989586621683022785"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621683022785"><span class="hs-identifier hs-var">new_ty</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Type -&gt; Type -&gt; Maybe Subst
</span><a href="GHC.Core.Unify.html#tcUnifyTyKi"><span class="hs-identifier hs-var">U.tcUnifyTyKi</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621683022784"><span class="hs-identifier hs-var">base_ty</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621683022785"><span class="hs-identifier hs-var">new_ty</span></a></span><span>
</span><span id="line-1097"></span><span>
</span><span id="line-1098"></span><span class="annot"><a href="GHC.Runtime.Heap.Inspect.html#getDataConArgTys"><span class="hs-identifier hs-type">getDataConArgTys</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Core.DataCon.html#DataCon"><span class="hs-identifier hs-type">DataCon</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#Type"><span class="hs-identifier hs-type">Type</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Runtime.Heap.Inspect.html#TR"><span class="hs-identifier hs-type">TR</span></a></span><span> </span><span class="hs-special">[</span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#Type"><span class="hs-identifier hs-type">Type</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-1099"></span><span class="hs-comment">-- Given the result type ty of a constructor application (D a b c :: ty)</span><span>
</span><span id="line-1100"></span><span class="hs-comment">-- return the types of the arguments.  This is RTTI-land, so 'ty' might</span><span>
</span><span id="line-1101"></span><span class="hs-comment">-- not be fully known.  Moreover, the arg types might involve existentials;</span><span>
</span><span id="line-1102"></span><span class="hs-comment">-- if so, make up fresh RTTI type variables for them</span><span>
</span><span id="line-1103"></span><span id="getDataConArgTys"><span class="annot"><span class="annottext">getDataConArgTys :: DataCon -&gt; Type -&gt; IOEnv (Env TcGblEnv TcLclEnv) [Type]
</span><a href="GHC.Runtime.Heap.Inspect.html#getDataConArgTys"><span class="hs-identifier hs-var hs-var">getDataConArgTys</span></a></span></span><span> </span><span id="local-6989586621683022787"><span class="annot"><span class="annottext">DataCon
</span><a href="#local-6989586621683022787"><span class="hs-identifier hs-var">dc</span></a></span></span><span> </span><span id="local-6989586621683022788"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621683022788"><span class="hs-identifier hs-var">con_app_ty</span></a></span></span><span>
</span><span id="line-1104"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621683022789"><span class="annot"><span class="annottext">rep_con_app_ty :: Type
</span><a href="#local-6989586621683022789"><span class="hs-identifier hs-var hs-var hs-var">rep_con_app_ty</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Type -&gt; Type
</span><a href="GHC.Types.RepType.html#unwrapType"><span class="hs-identifier hs-var">unwrapType</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621683022788"><span class="hs-identifier hs-var">con_app_ty</span></a></span><span>
</span><span id="line-1105"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="annottext">SDoc -&gt; TR ()
</span><a href="GHC.Runtime.Heap.Inspect.html#traceTR"><span class="hs-identifier hs-var">traceTR</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">String -&gt; SDoc
forall doc. IsLine doc =&gt; String -&gt; doc
</span><a href="GHC.Utils.Outputable.html#text"><span class="hs-identifier hs-var">text</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;getDataConArgTys 1&quot;</span></span><span> </span><span class="annot"><span class="annottext">SDoc -&gt; SDoc -&gt; SDoc
forall doc. IsLine doc =&gt; doc -&gt; doc -&gt; doc
</span><a href="GHC.Utils.Outputable.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Type -&gt; SDoc
forall a. Outputable a =&gt; a -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621683022788"><span class="hs-identifier hs-var">con_app_ty</span></a></span><span> </span><span class="annot"><span class="annottext">SDoc -&gt; SDoc -&gt; SDoc
forall doc. IsDoc doc =&gt; doc -&gt; doc -&gt; doc
</span><a href="GHC.Utils.Outputable.html#%24%24"><span class="hs-operator hs-var">$$</span></a></span><span> </span><span class="annot"><span class="annottext">Type -&gt; SDoc
forall a. Outputable a =&gt; a -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621683022789"><span class="hs-identifier hs-var">rep_con_app_ty</span></a></span><span>
</span><span id="line-1106"></span><span>                   </span><span class="annot"><span class="annottext">SDoc -&gt; SDoc -&gt; SDoc
forall doc. IsDoc doc =&gt; doc -&gt; doc -&gt; doc
</span><a href="GHC.Utils.Outputable.html#%24%24"><span class="hs-operator hs-var">$$</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe (TyCon, [Type]) -&gt; SDoc
forall a. Outputable a =&gt; a -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">HasDebugCallStack =&gt; Type -&gt; Maybe (TyCon, [Type])
Type -&gt; Maybe (TyCon, [Type])
</span><a href="GHC.Core.Type.html#tcSplitTyConApp_maybe"><span class="hs-identifier hs-var">tcSplitTyConApp_maybe</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621683022789"><span class="hs-identifier hs-var">rep_con_app_ty</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-1107"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="annottext">Bool -&gt; (() -&gt; TR ()) -&gt; () -&gt; TR ()
forall a. HasCallStack =&gt; Bool -&gt; a -&gt; a
</span><a href="GHC.Utils.Panic.Plain.html#assert"><span class="hs-identifier hs-var">assert</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(TyVar -&gt; Bool) -&gt; [TyVar] -&gt; Bool
forall (t :: * -&gt; *) a. Foldable t =&gt; (a -&gt; Bool) -&gt; t a -&gt; Bool
</span><span class="hs-identifier hs-var">all</span></span><span> </span><span class="annot"><span class="annottext">TyVar -&gt; Bool
</span><a href="GHC.Types.Var.html#isTyVar"><span class="hs-identifier hs-var">isTyVar</span></a></span><span> </span><span class="annot"><span class="annottext">[TyVar]
</span><a href="#local-6989586621683022792"><span class="hs-identifier hs-var">ex_tvs</span></a></span><span> </span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">() -&gt; TR ()
forall a. a -&gt; IOEnv (Env TcGblEnv TcLclEnv) a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-1108"></span><span>                 </span><span class="hs-comment">-- ex_tvs can only be tyvars as data types in source</span><span>
</span><span id="line-1109"></span><span>                 </span><span class="hs-comment">-- Haskell cannot mention covar yet (Aug 2018)</span><span>
</span><span id="line-1110"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="hs-special">(</span><span id="local-6989586621683022793"><span class="annot"><a href="#local-6989586621683022793"><span class="hs-identifier hs-var">subst</span></a></span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">[TyVar] -&gt; TR (Subst, [TyVar])
</span><a href="GHC.Runtime.Heap.Inspect.html#instTyVars"><span class="hs-identifier hs-var">instTyVars</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[TyVar]
</span><a href="#local-6989586621683022794"><span class="hs-identifier hs-var">univ_tvs</span></a></span><span> </span><span class="annot"><span class="annottext">[TyVar] -&gt; [TyVar] -&gt; [TyVar]
forall a. [a] -&gt; [a] -&gt; [a]
</span><span class="hs-operator hs-var">++</span></span><span> </span><span class="annot"><span class="annottext">[TyVar]
</span><a href="#local-6989586621683022792"><span class="hs-identifier hs-var">ex_tvs</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1111"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="annot"><a href="GHC.Runtime.Heap.Inspect.html#addConstraint"><span class="hs-identifier hs-type">addConstraint</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683022789"><span class="hs-identifier hs-type">rep_con_app_ty</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Core.TyCo.Subst.html#substTy"><span class="hs-identifier hs-type">substTy</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683022793"><span class="hs-identifier hs-type">subst</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Core.DataCon.html#dataConOrigResTy"><span class="hs-identifier hs-type">dataConOrigResTy</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683022787"><span class="hs-identifier hs-type">dc</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-1112"></span><span>              </span><span class="hs-comment">-- See Note [Constructor arg types]</span><span>
</span><span id="line-1113"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621683022796"><span class="annot"><a href="#local-6989586621683022796"><span class="hs-identifier hs-var hs-var">con_arg_tys</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">HasDebugCallStack =&gt; Subst -&gt; [Type] -&gt; [Type]
Subst -&gt; [Type] -&gt; [Type]
</span><a href="GHC.Core.TyCo.Subst.html#substTys"><span class="hs-identifier hs-var">substTys</span></a></span><span> </span><span class="annot"><span class="annottext">Subst
</span><a href="#local-6989586621683022793"><span class="hs-identifier hs-var">subst</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(Scaled Type -&gt; Type) -&gt; [Scaled Type] -&gt; [Type]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><span class="hs-identifier hs-var">map</span></span><span> </span><span class="annot"><span class="annottext">Scaled Type -&gt; Type
forall a. Scaled a -&gt; a
</span><a href="GHC.Core.TyCo.Rep.html#scaledThing"><span class="hs-identifier hs-var">scaledThing</span></a></span><span> </span><span class="annot"><span class="annottext">([Scaled Type] -&gt; [Type]) -&gt; [Scaled Type] -&gt; [Type]
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">DataCon -&gt; [Scaled Type]
</span><a href="GHC.Core.DataCon.html#dataConRepArgTys"><span class="hs-identifier hs-var">dataConRepArgTys</span></a></span><span> </span><span class="annot"><span class="annottext">DataCon
</span><a href="#local-6989586621683022787"><span class="hs-identifier hs-var">dc</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1114"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="annot"><a href="GHC.Runtime.Heap.Inspect.html#traceTR"><span class="hs-identifier hs-type">traceTR</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Utils.Outputable.html#text"><span class="hs-identifier hs-type">text</span></a></span><span> </span><span class="annot"><span class="hs-string">&quot;getDataConArgTys 2&quot;</span></span><span> </span><span class="annot"><a href="GHC.Utils.Outputable.html#%3C%2B%3E"><span class="hs-operator hs-type">&lt;+&gt;</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-type">ppr</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683022789"><span class="hs-identifier hs-type">rep_con_app_ty</span></a></span><span> </span><span class="annot"><a href="GHC.Utils.Outputable.html#%24%24"><span class="hs-operator hs-type">$$</span></a></span><span> </span><span class="annot"><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-type">ppr</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683022796"><span class="hs-identifier hs-type">con_arg_tys</span></a></span><span> </span><span class="annot"><a href="GHC.Utils.Outputable.html#%24%24"><span class="hs-operator hs-type">$$</span></a></span><span> </span><span class="annot"><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-type">ppr</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683022793"><span class="hs-identifier hs-type">subst</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-1115"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">return</span></span><span> </span><span class="annot"><a href="#local-6989586621683022796"><span class="hs-identifier hs-type">con_arg_tys</span></a></span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-1116"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-1117"></span><span>    </span><span id="local-6989586621683022794"><span class="annot"><span class="annottext">univ_tvs :: [TyVar]
</span><a href="#local-6989586621683022794"><span class="hs-identifier hs-var hs-var">univ_tvs</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">DataCon -&gt; [TyVar]
</span><a href="GHC.Core.DataCon.html#dataConUnivTyVars"><span class="hs-identifier hs-var">dataConUnivTyVars</span></a></span><span> </span><span class="annot"><span class="annottext">DataCon
</span><a href="#local-6989586621683022787"><span class="hs-identifier hs-var">dc</span></a></span><span>
</span><span id="line-1118"></span><span>    </span><span id="local-6989586621683022792"><span class="annot"><span class="annottext">ex_tvs :: [TyVar]
</span><a href="#local-6989586621683022792"><span class="hs-identifier hs-var hs-var">ex_tvs</span></a></span></span><span>   </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">DataCon -&gt; [TyVar]
</span><a href="GHC.Core.DataCon.html#dataConExTyCoVars"><span class="hs-identifier hs-var">dataConExTyCoVars</span></a></span><span> </span><span class="annot"><span class="annottext">DataCon
</span><a href="#local-6989586621683022787"><span class="hs-identifier hs-var">dc</span></a></span><span>
</span><span id="line-1119"></span><span>
</span><span id="line-1120"></span><span class="hs-comment">{- Note [Constructor arg types]
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
Consider a GADT (cf #7386)
   data family D a b
   data instance D [a] a where
     MkT :: a -&gt; D [a] (Maybe a)
     ...

In getDataConArgTys
* con_app_ty is the known type (from outside) of the constructor application,
  say D [Int] Int

* The data constructor MkT has a (representation) dataConTyCon = DList,
  say where
    data DList a where
      MkT :: a -&gt; DList a (Maybe a)
      ...

So the dataConTyCon of the data constructor, DList, differs from
the &quot;outside&quot; type, D. So we can't straightforwardly decompose the
&quot;outside&quot; type, and we end up in the &quot;_&quot; branch of the case.

Then we match the dataConOrigResTy of the data constructor against the
outside type, hoping to get a substitution that tells how to instantiate
the *representation* type constructor.   This looks a bit delicate to
me, but it seems to work.
-}</span><span>
</span><span id="line-1147"></span><span>
</span><span id="line-1148"></span><span class="hs-comment">-- Soundness checks</span><span>
</span><span id="line-1149"></span><span class="hs-comment">--------------------</span><span>
</span><span id="line-1150"></span><span class="hs-comment">{-
This is not formalized anywhere, so hold to your seats!
RTTI in the presence of newtypes can be a tricky and unsound business.

Example:
~~~~~~~~~
Suppose we are doing RTTI for a partially evaluated
closure t, the real type of which is t :: MkT Int, for

   newtype MkT a = MkT [Maybe a]

The table below shows the results of RTTI and the improvement
calculated for different combinations of evaluatedness and :type t.
Regard the two first columns as input and the next two as output.

  # |     t     |  :type t  | rtti(t)  | improv.    | result
    ------------------------------------------------------------
  1 |     _     |    t b    |    a     | none       | OK
  2 |     _     |   MkT b   |    a     | none       | OK
  3 |     _     |   t Int   |    a     | none       | OK

  If t is not evaluated at *all*, we are safe.

  4 |  (_ : _)  |    t b    |   [a]    | t = []     | UNSOUND
  5 |  (_ : _)  |   MkT b   |  MkT a   | none       | OK (compensating for the missing newtype)
  6 |  (_ : _)  |   t Int   |  [Int]   | t = []     | UNSOUND

  If a is a minimal whnf, we run into trouble. Note that
  row 5 above does newtype enrichment on the ty_rtty parameter.

  7 | (Just _:_)|    t b    |[Maybe a] | t = [],    | UNSOUND
    |                       |          | b = Maybe a|

  8 | (Just _:_)|   MkT b   |  MkT a   |  none      | OK
  9 | (Just _:_)|   t Int   |   FAIL   |  none      | OK

  And if t is any more evaluated than whnf, we are still in trouble.
  Because constraints are solved in top-down order, when we reach the
  Maybe subterm what we got is already unsound. This explains why the
  row 9 fails to complete.

  10 | (Just _:_)|  t Int  | [Maybe a]   |  FAIL    | OK
  11 | (Just 1:_)|  t Int  | [Maybe Int] |  FAIL    | OK

  We can undo the failure in row 9 by leaving out the constraint
  coming from the type signature of t (i.e., the 2nd column).
  Note that this type information is still used
  to calculate the improvement. But we fail
  when trying to calculate the improvement, as there is no unifier for
  t Int = [Maybe a] or t Int = [Maybe Int].


  Another set of examples with t :: [MkT (Maybe Int)]  \equiv  [[Maybe (Maybe Int)]]

  # |     t     |    :type t    |  rtti(t)    | improvement | result
    ---------------------------------------------------------------------
  1 |(Just _:_) | [t (Maybe a)] | [[Maybe b]] | t = []      |
    |           |               |             | b = Maybe a |

The checks:
~~~~~~~~~~~
Consider a function obtainType that takes a value and a type and produces
the Term representation and a substitution (the improvement).
Assume an auxiliary rtti' function which does the actual job if recovering
the type, but which may produce a false type.

In pseudocode:

  rtti' :: a -&gt; IO Type  -- Does not use the static type information

  obtainType :: a -&gt; Type -&gt; IO (Maybe (Term, Improvement))
  obtainType v old_ty = do
       rtti_ty &lt;- rtti' v
       if monomorphic rtti_ty || (check rtti_ty old_ty)
        then ...
         else return Nothing
  where check rtti_ty old_ty = check1 rtti_ty &amp;&amp;
                              check2 rtti_ty old_ty

  check1 :: Type -&gt; Bool
  check2 :: Type -&gt; Type -&gt; Bool

Now, if rtti' returns a monomorphic type, we are safe.
If that is not the case, then we consider two conditions.


1. To prevent the class of unsoundness displayed by
   rows 4 and 7 in the example: no higher kind tyvars
   accepted.

  check1 (t a)   = NO
  check1 (t Int) = NO
  check1 ([] a)  = YES

2. To prevent the class of unsoundness shown by row 6,
   the rtti type should be structurally more
   defined than the old type we are comparing it to.
  check2 :: NewType -&gt; OldType -&gt; Bool
  check2 a  _        = True
  check2 [a] a       = True
  check2 [a] (t Int) = False
  check2 [a] (t a)   = False  -- By check1 we never reach this equation
  check2 [Int] a     = True
  check2 [Int] (t Int) = True
  check2 [Maybe a]   (t Int) = False
  check2 [Maybe Int] (t Int) = True
  check2 (Maybe [a])   (m [Int]) = False
  check2 (Maybe [Int]) (m [Int]) = True

-}</span><span>
</span><span id="line-1260"></span><span>
</span><span id="line-1261"></span><span class="annot"><a href="GHC.Runtime.Heap.Inspect.html#check1"><span class="hs-identifier hs-type">check1</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="GHC.Types.Var.html#TyVar"><span class="hs-identifier hs-type">TyVar</span></a></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Bool</span></span><span>
</span><span id="line-1262"></span><span id="check1"><span class="annot"><span class="annottext">check1 :: [TyVar] -&gt; Bool
</span><a href="GHC.Runtime.Heap.Inspect.html#check1"><span class="hs-identifier hs-var hs-var">check1</span></a></span></span><span> </span><span id="local-6989586621683022802"><span class="annot"><span class="annottext">[TyVar]
</span><a href="#local-6989586621683022802"><span class="hs-identifier hs-var">tvs</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Bool
</span><span class="hs-identifier hs-var">not</span></span><span> </span><span class="annot"><span class="annottext">(Bool -&gt; Bool) -&gt; Bool -&gt; Bool
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">(Type -&gt; Bool) -&gt; [Type] -&gt; Bool
forall (t :: * -&gt; *) a. Foldable t =&gt; (a -&gt; Bool) -&gt; t a -&gt; Bool
</span><span class="hs-identifier hs-var">any</span></span><span> </span><span class="annot"><span class="annottext">Type -&gt; Bool
</span><a href="#local-6989586621683022804"><span class="hs-identifier hs-var">isHigherKind</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(TyVar -&gt; Type) -&gt; [TyVar] -&gt; [Type]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><span class="hs-identifier hs-var">map</span></span><span> </span><span class="annot"><span class="annottext">TyVar -&gt; Type
</span><a href="GHC.Types.Var.html#tyVarKind"><span class="hs-identifier hs-var">tyVarKind</span></a></span><span> </span><span class="annot"><span class="annottext">[TyVar]
</span><a href="#local-6989586621683022802"><span class="hs-identifier hs-var">tvs</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1263"></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-1264"></span><span>   </span><span id="local-6989586621683022804"><span class="annot"><span class="annottext">isHigherKind :: Type -&gt; Bool
</span><a href="#local-6989586621683022804"><span class="hs-identifier hs-var hs-var">isHigherKind</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Bool
</span><span class="hs-identifier hs-var">not</span></span><span> </span><span class="annot"><span class="annottext">(Bool -&gt; Bool) -&gt; (Type -&gt; Bool) -&gt; Type -&gt; Bool
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">[PiTyBinder] -&gt; Bool
forall a. [a] -&gt; Bool
forall (t :: * -&gt; *) a. Foldable t =&gt; t a -&gt; Bool
</span><span class="hs-identifier hs-var">null</span></span><span> </span><span class="annot"><span class="annottext">([PiTyBinder] -&gt; Bool) -&gt; (Type -&gt; [PiTyBinder]) -&gt; Type -&gt; Bool
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">([PiTyBinder], Type) -&gt; [PiTyBinder]
forall a b. (a, b) -&gt; a
</span><span class="hs-identifier hs-var">fst</span></span><span> </span><span class="annot"><span class="annottext">(([PiTyBinder], Type) -&gt; [PiTyBinder])
-&gt; (Type -&gt; ([PiTyBinder], Type)) -&gt; Type -&gt; [PiTyBinder]
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">Type -&gt; ([PiTyBinder], Type)
</span><a href="GHC.Core.Type.html#splitPiTys"><span class="hs-identifier hs-var">splitPiTys</span></a></span><span>
</span><span id="line-1265"></span><span>
</span><span id="line-1266"></span><span class="annot"><a href="GHC.Runtime.Heap.Inspect.html#check2"><span class="hs-identifier hs-type">check2</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#Type"><span class="hs-identifier hs-type">Type</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#Type"><span class="hs-identifier hs-type">Type</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Bool</span></span><span>
</span><span id="line-1267"></span><span id="check2"><span class="annot"><span class="annottext">check2 :: Type -&gt; Type -&gt; Bool
</span><a href="GHC.Runtime.Heap.Inspect.html#check2"><span class="hs-identifier hs-var hs-var">check2</span></a></span></span><span> </span><span id="local-6989586621683022808"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621683022808"><span class="hs-identifier hs-var">rtti_ty</span></a></span></span><span> </span><span id="local-6989586621683022809"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621683022809"><span class="hs-identifier hs-var">old_ty</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Type -&gt; Type -&gt; Bool
</span><a href="#local-6989586621683022810"><span class="hs-identifier hs-var">check2'</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Type -&gt; Type
</span><a href="#local-6989586621683022811"><span class="hs-identifier hs-var">tauPart</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621683022808"><span class="hs-identifier hs-var">rtti_ty</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Type -&gt; Type
</span><a href="#local-6989586621683022811"><span class="hs-identifier hs-var">tauPart</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621683022809"><span class="hs-identifier hs-var">old_ty</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1268"></span><span>  </span><span class="hs-comment">-- The function `tcSplitTyConApp_maybe` doesn't split foralls or types</span><span>
</span><span id="line-1269"></span><span>  </span><span class="hs-comment">-- headed with (=&gt;). Hence here we need only the tau part of a type.</span><span>
</span><span id="line-1270"></span><span>  </span><span class="hs-comment">-- See Note [Missing test case].</span><span>
</span><span id="line-1271"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-1272"></span><span>    </span><span id="local-6989586621683022810"><span class="annot"><span class="annottext">check2' :: Type -&gt; Type -&gt; Bool
</span><a href="#local-6989586621683022810"><span class="hs-identifier hs-var hs-var">check2'</span></a></span></span><span> </span><span id="local-6989586621683022815"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621683022815"><span class="hs-identifier hs-var">rtti_ty</span></a></span></span><span> </span><span id="local-6989586621683022816"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621683022816"><span class="hs-identifier hs-var">old_ty</span></a></span></span><span>
</span><span id="line-1273"></span><span>      </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TyCon
</span><span class="hs-identifier">_</span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621683022817"><span class="annot"><span class="annottext">[Type]
</span><a href="#local-6989586621683022817"><span class="hs-identifier hs-var">rttis</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">HasDebugCallStack =&gt; Type -&gt; Maybe (TyCon, [Type])
Type -&gt; Maybe (TyCon, [Type])
</span><a href="GHC.Core.Type.html#tcSplitTyConApp_maybe"><span class="hs-identifier hs-var">tcSplitTyConApp_maybe</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621683022815"><span class="hs-identifier hs-var">rtti_ty</span></a></span><span>
</span><span id="line-1274"></span><span>      </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-1275"></span><span>          </span><span class="annot"><span class="annottext">()
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TyCon
</span><span class="hs-identifier">_</span></span><span class="hs-special">,</span><span id="local-6989586621683022818"><span class="annot"><span class="annottext">[Type]
</span><a href="#local-6989586621683022818"><span class="hs-identifier hs-var">olds</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">HasDebugCallStack =&gt; Type -&gt; Maybe (TyCon, [Type])
Type -&gt; Maybe (TyCon, [Type])
</span><a href="GHC.Core.Type.html#tcSplitTyConApp_maybe"><span class="hs-identifier hs-var">tcSplitTyConApp_maybe</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621683022816"><span class="hs-identifier hs-var">old_ty</span></a></span><span>
</span><span id="line-1276"></span><span>            </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">[Bool] -&gt; Bool
forall (t :: * -&gt; *). Foldable t =&gt; t Bool -&gt; Bool
</span><span class="hs-identifier hs-var">and</span></span><span class="annot"><span class="annottext">([Bool] -&gt; Bool) -&gt; [Bool] -&gt; Bool
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">(Type -&gt; Type -&gt; Bool) -&gt; [Type] -&gt; [Type] -&gt; [Bool]
forall a b c. (a -&gt; b -&gt; c) -&gt; [a] -&gt; [b] -&gt; [c]
</span><span class="hs-identifier hs-var">zipWith</span></span><span> </span><span class="annot"><span class="annottext">Type -&gt; Type -&gt; Bool
</span><a href="GHC.Runtime.Heap.Inspect.html#check2"><span class="hs-identifier hs-var">check2</span></a></span><span> </span><span class="annot"><span class="annottext">[Type]
</span><a href="#local-6989586621683022817"><span class="hs-identifier hs-var">rttis</span></a></span><span> </span><span class="annot"><span class="annottext">[Type]
</span><a href="#local-6989586621683022818"><span class="hs-identifier hs-var">olds</span></a></span><span>
</span><span id="line-1277"></span><span>          </span><span class="annot"><span class="annottext">()
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span class="annot"><span class="annottext">(Type, Type)
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Type -&gt; Maybe (Type, Type)
</span><a href="GHC.Core.Type.html#splitAppTy_maybe"><span class="hs-identifier hs-var">splitAppTy_maybe</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621683022816"><span class="hs-identifier hs-var">old_ty</span></a></span><span>
</span><span id="line-1278"></span><span>            </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Type -&gt; Bool
</span><a href="GHC.Runtime.Heap.Inspect.html#isMonomorphicOnNonPhantomArgs"><span class="hs-identifier hs-var">isMonomorphicOnNonPhantomArgs</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621683022815"><span class="hs-identifier hs-var">rtti_ty</span></a></span><span>
</span><span id="line-1279"></span><span>          </span><span class="annot"><span class="annottext">()
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">True</span></span><span>
</span><span id="line-1280"></span><span>      </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">otherwise</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">True</span></span><span>
</span><span id="line-1281"></span><span>    </span><span id="local-6989586621683022811"><span class="annot"><span class="annottext">tauPart :: Type -&gt; Type
</span><a href="#local-6989586621683022811"><span class="hs-identifier hs-var hs-var">tauPart</span></a></span></span><span> </span><span id="local-6989586621683022822"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621683022822"><span class="hs-identifier hs-var">ty</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621683022823"><span class="hs-identifier hs-var">tau</span></a></span><span>
</span><span id="line-1282"></span><span>      </span><span class="hs-keyword">where</span><span>
</span><span id="line-1283"></span><span>        </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[TyVar]
</span><span class="hs-identifier">_</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">[Type]
</span><span class="hs-identifier">_</span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621683022823"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621683022823"><span class="hs-identifier hs-var">tau</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Type -&gt; ([TyVar], [Type], Type)
</span><a href="GHC.Tc.Utils.TcType.html#tcSplitNestedSigmaTys"><span class="hs-identifier hs-var">tcSplitNestedSigmaTys</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621683022822"><span class="hs-identifier hs-var">ty</span></a></span><span>
</span><span id="line-1284"></span><span class="hs-comment">{-
Note [Missing test case]
~~~~~~~~~~~~~~~~~~~~~~~~
Her we miss a test case. It should be a term, with a function `f`
with a non-empty sigma part and an unsound type. The result of
`check2 f` should be different if we omit or do the calls to `tauPart`.
I (R.Senn) was unable to find such a term, and I'm in doubt, whether it exists.
-}</span><span>
</span><span id="line-1292"></span><span>
</span><span id="line-1293"></span><span class="hs-comment">-- Dealing with newtypes</span><span>
</span><span id="line-1294"></span><span class="hs-comment">--------------------------</span><span>
</span><span id="line-1295"></span><span class="hs-comment">{-
 congruenceNewtypes does a parallel fold over two Type values,
 compensating for missing newtypes on both sides.
 This is necessary because newtypes are not present
 in runtime, but sometimes there is evidence available.
   Evidence can come from DataCon signatures or
 from compile-time type inference.
 What we are doing here is an approximation
 of unification modulo a set of equations derived
 from newtype definitions. These equations should be the
 same as the equality coercions generated for newtypes
 in System Fc. The idea is to perform a sort of rewriting,
 taking those equations as rules, before launching unification.

 The caller must ensure the following.
 The 1st type (lhs) comes from the heap structure of ptrs,nptrs.
 The 2nd type (rhs) comes from a DataCon type signature.
 Rewriting (i.e. adding/removing a newtype wrapper) can happen
 in both types, but in the rhs it is restricted to the result type.

   Note that it is very tricky to make this 'rewriting'
 work with the unification implemented by TcM, where
 substitutions are operationally inlined. The order in which
 constraints are unified is vital as we cannot modify
 anything that has been touched by a previous unification step.
Therefore, congruenceNewtypes is sound only if the types
recovered by the RTTI mechanism are unified Top-Down.
-}</span><span>
</span><span id="line-1323"></span><span class="annot"><a href="GHC.Runtime.Heap.Inspect.html#congruenceNewtypes"><span class="hs-identifier hs-type">congruenceNewtypes</span></a></span><span> </span><span class="hs-glyph">::</span><span>  </span><span class="annot"><a href="GHC.Tc.Utils.TcType.html#TcType"><span class="hs-identifier hs-type">TcType</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.TcType.html#TcType"><span class="hs-identifier hs-type">TcType</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Runtime.Heap.Inspect.html#TR"><span class="hs-identifier hs-type">TR</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Tc.Utils.TcType.html#TcType"><span class="hs-identifier hs-type">TcType</span></a></span><span class="hs-special">,</span><span class="annot"><a href="GHC.Tc.Utils.TcType.html#TcType"><span class="hs-identifier hs-type">TcType</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1324"></span><span id="congruenceNewtypes"><span class="annot"><span class="annottext">congruenceNewtypes :: Type -&gt; Type -&gt; TR (Type, Type)
</span><a href="GHC.Runtime.Heap.Inspect.html#congruenceNewtypes"><span class="hs-identifier hs-var hs-var">congruenceNewtypes</span></a></span></span><span> </span><span id="local-6989586621683022825"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621683022825"><span class="hs-identifier hs-var">lhs</span></a></span></span><span> </span><span id="local-6989586621683022826"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621683022826"><span class="hs-identifier hs-var">rhs</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Type -&gt; Type -&gt; TR Type
</span><a href="#local-6989586621683022827"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621683022825"><span class="hs-identifier hs-var">lhs</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621683022826"><span class="hs-identifier hs-var">rhs</span></a></span><span> </span><span class="annot"><span class="annottext">TR Type -&gt; (Type -&gt; TR (Type, Type)) -&gt; TR (Type, Type)
forall a b.
IOEnv (Env TcGblEnv TcLclEnv) a
-&gt; (a -&gt; IOEnv (Env TcGblEnv TcLclEnv) b)
-&gt; IOEnv (Env TcGblEnv TcLclEnv) b
forall (m :: * -&gt; *) a b. Monad m =&gt; m a -&gt; (a -&gt; m b) -&gt; m b
</span><span class="hs-operator hs-var">&gt;&gt;=</span></span><span> </span><span class="hs-glyph">\</span><span id="local-6989586621683022828"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621683022828"><span class="hs-identifier hs-var">rhs'</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">(Type, Type) -&gt; TR (Type, Type)
forall a. a -&gt; IOEnv (Env TcGblEnv TcLclEnv) a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621683022825"><span class="hs-identifier hs-var">lhs</span></a></span><span class="hs-special">,</span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621683022828"><span class="hs-identifier hs-var">rhs'</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1325"></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-1326"></span><span>   </span><span id="local-6989586621683022827"><span class="annot"><span class="annottext">go :: Type -&gt; Type -&gt; TR Type
</span><a href="#local-6989586621683022827"><span class="hs-identifier hs-var hs-var">go</span></a></span></span><span> </span><span id="local-6989586621683022829"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621683022829"><span class="hs-identifier hs-var">l</span></a></span></span><span> </span><span id="local-6989586621683022830"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621683022830"><span class="hs-identifier hs-var">r</span></a></span></span><span>
</span><span id="line-1327"></span><span> </span><span class="hs-comment">-- TyVar lhs inductive case</span><span>
</span><span id="line-1328"></span><span>    </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span id="local-6989586621683022831"><span class="annot"><span class="annottext">TyVar
</span><a href="#local-6989586621683022831"><span class="hs-identifier hs-var">tv</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Type -&gt; Maybe TyVar
</span><a href="GHC.Core.Type.html#getTyVar_maybe"><span class="hs-identifier hs-var">getTyVar_maybe</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621683022829"><span class="hs-identifier hs-var">l</span></a></span><span>
</span><span id="line-1329"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">TyVar -&gt; Bool
</span><a href="GHC.Types.Var.html#isTcTyVar"><span class="hs-identifier hs-var">isTcTyVar</span></a></span><span> </span><span class="annot"><span class="annottext">TyVar
</span><a href="#local-6989586621683022831"><span class="hs-identifier hs-var">tv</span></a></span><span>
</span><span id="line-1330"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">TyVar -&gt; Bool
</span><a href="GHC.Tc.Utils.TcType.html#isMetaTyVar"><span class="hs-identifier hs-var">isMetaTyVar</span></a></span><span> </span><span class="annot"><span class="annottext">TyVar
</span><a href="#local-6989586621683022831"><span class="hs-identifier hs-var">tv</span></a></span><span>
</span><span id="line-1331"></span><span>    </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">TR Type -&gt; TR Type -&gt; TR Type
forall a. TR a -&gt; TR a -&gt; TR a
</span><a href="GHC.Runtime.Heap.Inspect.html#recoverTR"><span class="hs-identifier hs-var">recoverTR</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Type -&gt; TR Type
forall a. a -&gt; IOEnv (Env TcGblEnv TcLclEnv) a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621683022830"><span class="hs-identifier hs-var">r</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(TR Type -&gt; TR Type) -&gt; TR Type -&gt; TR Type
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-1332"></span><span>         </span><span class="annot"><a href="GHC.Tc.Utils.TcType.html#Indirect"><span class="hs-identifier hs-type">Indirect</span></a></span><span> </span><span id="local-6989586621683022834"><span class="annot"><a href="#local-6989586621683022834"><span class="hs-identifier hs-var">ty_v</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">TyVar -&gt; IOEnv (Env TcGblEnv TcLclEnv) MetaDetails
forall (m :: * -&gt; *). MonadIO m =&gt; TyVar -&gt; m MetaDetails
</span><a href="GHC.Tc.Utils.TcMType.html#readMetaTyVar"><span class="hs-identifier hs-var">readMetaTyVar</span></a></span><span> </span><span class="annot"><span class="annottext">TyVar
</span><a href="#local-6989586621683022831"><span class="hs-identifier hs-var">tv</span></a></span><span>
</span><span id="line-1333"></span><span>         </span><span class="annot"><a href="GHC.Runtime.Heap.Inspect.html#traceTR"><span class="hs-identifier hs-type">traceTR</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="annot"><a href="GHC.Utils.Outputable.html#fsep"><span class="hs-identifier hs-type">fsep</span></a></span><span> </span><span class="hs-special">[</span><span class="annot"><a href="GHC.Utils.Outputable.html#text"><span class="hs-identifier hs-type">text</span></a></span><span> </span><span class="annot"><span class="hs-string">&quot;(congruence) Following indirect tyvar:&quot;</span></span><span class="hs-special">,</span><span>
</span><span id="line-1334"></span><span>                          </span><span class="annot"><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-type">ppr</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683022831"><span class="hs-identifier hs-type">tv</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Utils.Outputable.html#equals"><span class="hs-identifier hs-type">equals</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-type">ppr</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683022834"><span class="hs-identifier hs-type">ty_v</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-1335"></span><span>         </span><span class="annot"><a href="#local-6989586621683022827"><span class="hs-identifier hs-type">go</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683022834"><span class="hs-identifier hs-type">ty_v</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683022830"><span class="hs-identifier hs-type">r</span></a></span><span>
</span><span id="line-1336"></span><span class="hs-comment">-- FunTy inductive case</span><span>
</span><span id="line-1337"></span><span>    </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span class="hs-special">(</span><span id="local-6989586621683022836"><span class="annot"><span class="annottext">FunTyFlag
</span><a href="#local-6989586621683022836"><span class="hs-identifier hs-var">af1</span></a></span></span><span class="hs-special">,</span><span id="local-6989586621683022837"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621683022837"><span class="hs-identifier hs-var">w1</span></a></span></span><span class="hs-special">,</span><span id="local-6989586621683022838"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621683022838"><span class="hs-identifier hs-var">l1</span></a></span></span><span class="hs-special">,</span><span id="local-6989586621683022839"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621683022839"><span class="hs-identifier hs-var">l2</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Type -&gt; Maybe (FunTyFlag, Type, Type, Type)
</span><a href="GHC.Core.Type.html#splitFunTy_maybe"><span class="hs-identifier hs-var">splitFunTy_maybe</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621683022829"><span class="hs-identifier hs-var">l</span></a></span><span>
</span><span id="line-1338"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span class="hs-special">(</span><span id="local-6989586621683022841"><span class="annot"><span class="annottext">FunTyFlag
</span><a href="#local-6989586621683022841"><span class="hs-identifier hs-var">af2</span></a></span></span><span class="hs-special">,</span><span id="local-6989586621683022842"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621683022842"><span class="hs-identifier hs-var">w2</span></a></span></span><span class="hs-special">,</span><span id="local-6989586621683022843"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621683022843"><span class="hs-identifier hs-var">r1</span></a></span></span><span class="hs-special">,</span><span id="local-6989586621683022844"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621683022844"><span class="hs-identifier hs-var">r2</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Type -&gt; Maybe (FunTyFlag, Type, Type, Type)
</span><a href="GHC.Core.Type.html#splitFunTy_maybe"><span class="hs-identifier hs-var">splitFunTy_maybe</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621683022830"><span class="hs-identifier hs-var">r</span></a></span><span>
</span><span id="line-1339"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">FunTyFlag
</span><a href="#local-6989586621683022836"><span class="hs-identifier hs-var">af1</span></a></span><span class="annot"><span class="annottext">FunTyFlag -&gt; FunTyFlag -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">==</span></span><span class="annot"><span class="annottext">FunTyFlag
</span><a href="#local-6989586621683022841"><span class="hs-identifier hs-var">af2</span></a></span><span>
</span><span id="line-1340"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621683022837"><span class="hs-identifier hs-var">w1</span></a></span><span> </span><span class="annot"><span class="annottext">HasCallStack =&gt; Type -&gt; Type -&gt; Bool
Type -&gt; Type -&gt; Bool
</span><a href="GHC.Core.TyCo.Compare.html#eqType"><span class="hs-operator hs-var">`eqType`</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621683022842"><span class="hs-identifier hs-var">w2</span></a></span><span>
</span><span id="line-1341"></span><span>    </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span id="local-6989586621683022845"><span class="annot"><a href="#local-6989586621683022845"><span class="hs-identifier hs-var">r2'</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Type -&gt; Type -&gt; TR Type
</span><a href="#local-6989586621683022827"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621683022839"><span class="hs-identifier hs-var">l2</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621683022844"><span class="hs-identifier hs-var">r2</span></a></span><span>
</span><span id="line-1342"></span><span>         </span><span id="local-6989586621683022846"><span class="annot"><a href="#local-6989586621683022846"><span class="hs-identifier hs-var">r1'</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><a href="#local-6989586621683022827"><span class="hs-identifier hs-type">go</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683022838"><span class="hs-identifier hs-type">l1</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683022843"><span class="hs-identifier hs-type">r1</span></a></span><span>
</span><span id="line-1343"></span><span>         </span><span class="annot"><span class="hs-identifier hs-type">return</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#mkFunTy"><span class="hs-identifier hs-type">mkFunTy</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683022836"><span class="hs-identifier hs-type">af1</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683022837"><span class="hs-identifier hs-type">w1</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683022846"><span class="hs-identifier hs-type">r1'</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683022845"><span class="hs-identifier hs-type">r2'</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1344"></span><span class="hs-comment">-- TyconApp Inductive case; this is the interesting bit.</span><span>
</span><span id="line-1345"></span><span>    </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span class="hs-special">(</span><span id="local-6989586621683022848"><span class="annot"><span class="annottext">TyCon
</span><a href="#local-6989586621683022848"><span class="hs-identifier hs-var">tycon_l</span></a></span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">[Type]
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">HasDebugCallStack =&gt; Type -&gt; Maybe (TyCon, [Type])
Type -&gt; Maybe (TyCon, [Type])
</span><a href="GHC.Core.Type.html#tcSplitTyConApp_maybe"><span class="hs-identifier hs-var">tcSplitTyConApp_maybe</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621683022825"><span class="hs-identifier hs-var">lhs</span></a></span><span>
</span><span id="line-1346"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span class="hs-special">(</span><span id="local-6989586621683022849"><span class="annot"><span class="annottext">TyCon
</span><a href="#local-6989586621683022849"><span class="hs-identifier hs-var">tycon_r</span></a></span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">[Type]
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">HasDebugCallStack =&gt; Type -&gt; Maybe (TyCon, [Type])
Type -&gt; Maybe (TyCon, [Type])
</span><a href="GHC.Core.Type.html#tcSplitTyConApp_maybe"><span class="hs-identifier hs-var">tcSplitTyConApp_maybe</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621683022826"><span class="hs-identifier hs-var">rhs</span></a></span><span>
</span><span id="line-1347"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">TyCon
</span><a href="#local-6989586621683022848"><span class="hs-identifier hs-var">tycon_l</span></a></span><span> </span><span class="annot"><span class="annottext">TyCon -&gt; TyCon -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">/=</span></span><span> </span><span class="annot"><span class="annottext">TyCon
</span><a href="#local-6989586621683022849"><span class="hs-identifier hs-var">tycon_r</span></a></span><span>
</span><span id="line-1348"></span><span>    </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">TyCon -&gt; Type -&gt; TR Type
</span><a href="#local-6989586621683022851"><span class="hs-identifier hs-var">upgrade</span></a></span><span> </span><span class="annot"><span class="annottext">TyCon
</span><a href="#local-6989586621683022848"><span class="hs-identifier hs-var">tycon_l</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621683022830"><span class="hs-identifier hs-var">r</span></a></span><span>
</span><span id="line-1349"></span><span>
</span><span id="line-1350"></span><span>    </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">otherwise</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Type -&gt; TR Type
forall a. a -&gt; IOEnv (Env TcGblEnv TcLclEnv) a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621683022830"><span class="hs-identifier hs-var">r</span></a></span><span>
</span><span id="line-1351"></span><span>
</span><span id="line-1352"></span><span>    </span><span class="hs-keyword">where</span><span> </span><span class="annot"><a href="#local-6989586621683022851"><span class="hs-identifier hs-type">upgrade</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Core.TyCon.html#TyCon"><span class="hs-identifier hs-type">TyCon</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#Type"><span class="hs-identifier hs-type">Type</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Runtime.Heap.Inspect.html#TR"><span class="hs-identifier hs-type">TR</span></a></span><span> </span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#Type"><span class="hs-identifier hs-type">Type</span></a></span><span>
</span><span id="line-1353"></span><span>          </span><span id="local-6989586621683022851"><span class="annot"><span class="annottext">upgrade :: TyCon -&gt; Type -&gt; TR Type
</span><a href="#local-6989586621683022851"><span class="hs-identifier hs-var hs-var">upgrade</span></a></span></span><span> </span><span id="local-6989586621683022852"><span class="annot"><span class="annottext">TyCon
</span><a href="#local-6989586621683022852"><span class="hs-identifier hs-var">new_tycon</span></a></span></span><span> </span><span id="local-6989586621683022853"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621683022853"><span class="hs-identifier hs-var">ty</span></a></span></span><span>
</span><span id="line-1354"></span><span>            </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Bool
</span><span class="hs-identifier hs-var">not</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TyCon -&gt; Bool
</span><a href="GHC.Core.TyCon.html#isNewTyCon"><span class="hs-identifier hs-var">isNewTyCon</span></a></span><span> </span><span class="annot"><span class="annottext">TyCon
</span><a href="#local-6989586621683022852"><span class="hs-identifier hs-var">new_tycon</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-1355"></span><span>              </span><span class="annot"><span class="annottext">SDoc -&gt; TR ()
</span><a href="GHC.Runtime.Heap.Inspect.html#traceTR"><span class="hs-identifier hs-var">traceTR</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">String -&gt; SDoc
forall doc. IsLine doc =&gt; String -&gt; doc
</span><a href="GHC.Utils.Outputable.html#text"><span class="hs-identifier hs-var">text</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;(Upgrade) Not matching newtype evidence: &quot;</span></span><span> </span><span class="annot"><span class="annottext">SDoc -&gt; SDoc -&gt; SDoc
forall doc. IsLine doc =&gt; doc -&gt; doc -&gt; doc
</span><a href="GHC.Utils.Outputable.html#%3C%3E"><span class="hs-operator hs-var">&lt;&gt;</span></a></span><span>
</span><span id="line-1356"></span><span>                       </span><span class="annot"><span class="annottext">TyCon -&gt; SDoc
forall a. Outputable a =&gt; a -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="annot"><span class="annottext">TyCon
</span><a href="#local-6989586621683022852"><span class="hs-identifier hs-var">new_tycon</span></a></span><span> </span><span class="annot"><span class="annottext">SDoc -&gt; SDoc -&gt; SDoc
forall doc. IsLine doc =&gt; doc -&gt; doc -&gt; doc
</span><a href="GHC.Utils.Outputable.html#%3C%3E"><span class="hs-operator hs-var">&lt;&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">String -&gt; SDoc
forall doc. IsLine doc =&gt; String -&gt; doc
</span><a href="GHC.Utils.Outputable.html#text"><span class="hs-identifier hs-var">text</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot; for &quot;</span></span><span> </span><span class="annot"><span class="annottext">SDoc -&gt; SDoc -&gt; SDoc
forall doc. IsLine doc =&gt; doc -&gt; doc -&gt; doc
</span><a href="GHC.Utils.Outputable.html#%3C%3E"><span class="hs-operator hs-var">&lt;&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">Type -&gt; SDoc
forall a. Outputable a =&gt; a -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621683022853"><span class="hs-identifier hs-var">ty</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1357"></span><span>              </span><span class="annot"><span class="annottext">Type -&gt; TR Type
forall a. a -&gt; IOEnv (Env TcGblEnv TcLclEnv) a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621683022853"><span class="hs-identifier hs-var">ty</span></a></span><span>
</span><span id="line-1358"></span><span>            </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">otherwise</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-1359"></span><span>               </span><span class="annot"><span class="annottext">SDoc -&gt; TR ()
</span><a href="GHC.Runtime.Heap.Inspect.html#traceTR"><span class="hs-identifier hs-var">traceTR</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">String -&gt; SDoc
forall doc. IsLine doc =&gt; String -&gt; doc
</span><a href="GHC.Utils.Outputable.html#text"><span class="hs-identifier hs-var">text</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;(Upgrade) upgraded &quot;</span></span><span> </span><span class="annot"><span class="annottext">SDoc -&gt; SDoc -&gt; SDoc
forall doc. IsLine doc =&gt; doc -&gt; doc -&gt; doc
</span><a href="GHC.Utils.Outputable.html#%3C%3E"><span class="hs-operator hs-var">&lt;&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">Type -&gt; SDoc
forall a. Outputable a =&gt; a -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621683022853"><span class="hs-identifier hs-var">ty</span></a></span><span> </span><span class="annot"><span class="annottext">SDoc -&gt; SDoc -&gt; SDoc
forall doc. IsLine doc =&gt; doc -&gt; doc -&gt; doc
</span><a href="GHC.Utils.Outputable.html#%3C%3E"><span class="hs-operator hs-var">&lt;&gt;</span></a></span><span>
</span><span id="line-1360"></span><span>                        </span><span class="annot"><span class="annottext">String -&gt; SDoc
forall doc. IsLine doc =&gt; String -&gt; doc
</span><a href="GHC.Utils.Outputable.html#text"><span class="hs-identifier hs-var">text</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot; in presence of newtype evidence &quot;</span></span><span> </span><span class="annot"><span class="annottext">SDoc -&gt; SDoc -&gt; SDoc
forall doc. IsLine doc =&gt; doc -&gt; doc -&gt; doc
</span><a href="GHC.Utils.Outputable.html#%3C%3E"><span class="hs-operator hs-var">&lt;&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">TyCon -&gt; SDoc
forall a. Outputable a =&gt; a -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="annot"><span class="annottext">TyCon
</span><a href="#local-6989586621683022852"><span class="hs-identifier hs-var">new_tycon</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1361"></span><span>               </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">_</span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621683022854"><span class="annot"><a href="#local-6989586621683022854"><span class="hs-identifier hs-var">vars</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">[TyVar] -&gt; TR (Subst, [TyVar])
</span><a href="GHC.Runtime.Heap.Inspect.html#instTyVars"><span class="hs-identifier hs-var">instTyVars</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TyCon -&gt; [TyVar]
</span><a href="GHC.Core.TyCon.html#tyConTyVars"><span class="hs-identifier hs-var">tyConTyVars</span></a></span><span> </span><span class="annot"><span class="annottext">TyCon
</span><a href="#local-6989586621683022852"><span class="hs-identifier hs-var">new_tycon</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1362"></span><span>               </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621683022856"><span class="annot"><a href="#local-6989586621683022856"><span class="hs-identifier hs-var hs-var">ty'</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">TyCon -&gt; [Type] -&gt; Type
</span><a href="GHC.Core.Type.html#mkTyConApp"><span class="hs-identifier hs-var">mkTyConApp</span></a></span><span> </span><span class="annot"><span class="annottext">TyCon
</span><a href="#local-6989586621683022852"><span class="hs-identifier hs-var">new_tycon</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[TyVar] -&gt; [Type]
</span><a href="GHC.Core.TyCo.Rep.html#mkTyVarTys"><span class="hs-identifier hs-var">mkTyVarTys</span></a></span><span> </span><span class="annot"><span class="annottext">[TyVar]
</span><a href="#local-6989586621683022854"><span class="hs-identifier hs-var">vars</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1363"></span><span>                   </span><span id="local-6989586621683022858"><span class="annot"><a href="#local-6989586621683022858"><span class="hs-identifier hs-var hs-var">rep_ty</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Type -&gt; Type
</span><a href="GHC.Types.RepType.html#unwrapType"><span class="hs-identifier hs-var">unwrapType</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621683022856"><span class="hs-identifier hs-var">ty'</span></a></span><span>
</span><span id="line-1364"></span><span>               </span><span class="annot"><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><a href="GHC.Runtime.Heap.Inspect.html#liftTcM"><span class="hs-identifier hs-type">liftTcM</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Tc.Utils.Unify.html#unifyType"><span class="hs-identifier hs-type">unifyType</span></a></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Nothing</span></span><span> </span><span class="annot"><a href="#local-6989586621683022853"><span class="hs-identifier hs-type">ty</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683022858"><span class="hs-identifier hs-type">rep_ty</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1365"></span><span>        </span><span class="hs-comment">-- assumes that reptype doesn't ^^^^ touch tyconApp args</span><span>
</span><span id="line-1366"></span><span>               </span><span class="annot"><span class="hs-identifier hs-type">return</span></span><span> </span><span class="annot"><a href="#local-6989586621683022856"><span class="hs-identifier hs-type">ty'</span></a></span><span>
</span><span id="line-1367"></span><span>
</span><span id="line-1368"></span><span>
</span><span id="line-1369"></span><span class="annot"><a href="GHC.Runtime.Heap.Inspect.html#zonkTerm"><span class="hs-identifier hs-type">zonkTerm</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Runtime.Heap.Inspect.html#Term"><span class="hs-identifier hs-type">Term</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#TcM"><span class="hs-identifier hs-type">TcM</span></a></span><span> </span><span class="annot"><a href="GHC.Runtime.Heap.Inspect.html#Term"><span class="hs-identifier hs-type">Term</span></a></span><span>
</span><span id="line-1370"></span><span id="zonkTerm"><span class="annot"><span class="annottext">zonkTerm :: Term -&gt; TR Term
</span><a href="GHC.Runtime.Heap.Inspect.html#zonkTerm"><span class="hs-identifier hs-var hs-var">zonkTerm</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">TermFoldM TcM Term -&gt; Term -&gt; TR Term
forall (m :: * -&gt; *) a. Monad m =&gt; TermFoldM m a -&gt; Term -&gt; m a
</span><a href="GHC.Runtime.Heap.Inspect.html#foldTermM"><span class="hs-identifier hs-var">foldTermM</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Runtime.Heap.Inspect.html#TermFoldM"><span class="hs-identifier hs-type">TermFoldM</span></a></span><span>
</span><span id="line-1371"></span><span>             </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">fTermM :: TermProcessor Term (TR Term)
</span><a href="GHC.Runtime.Heap.Inspect.html#fTermM"><span class="hs-identifier hs-var">fTermM</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-glyph">\</span><span id="local-6989586621683022859"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621683022859"><span class="hs-identifier hs-var">ty</span></a></span></span><span> </span><span id="local-6989586621683022860"><span class="annot"><span class="annottext">Either String DataCon
</span><a href="#local-6989586621683022860"><span class="hs-identifier hs-var">dc</span></a></span></span><span> </span><span id="local-6989586621683022861"><span class="annot"><span class="annottext">ForeignHValue
</span><a href="#local-6989586621683022861"><span class="hs-identifier hs-var">v</span></a></span></span><span> </span><span id="local-6989586621683022862"><span class="annot"><span class="annottext">[Term]
</span><a href="#local-6989586621683022862"><span class="hs-identifier hs-var">tt</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Type -&gt; TR Type
</span><a href="GHC.Runtime.Heap.Inspect.html#zonkRttiType"><span class="hs-identifier hs-var">zonkRttiType</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621683022859"><span class="hs-identifier hs-var">ty</span></a></span><span>    </span><span class="annot"><span class="annottext">TR Type -&gt; (Type -&gt; TR Term) -&gt; TR Term
forall a b.
IOEnv (Env TcGblEnv TcLclEnv) a
-&gt; (a -&gt; IOEnv (Env TcGblEnv TcLclEnv) b)
-&gt; IOEnv (Env TcGblEnv TcLclEnv) b
forall (m :: * -&gt; *) a b. Monad m =&gt; m a -&gt; (a -&gt; m b) -&gt; m b
</span><span class="hs-operator hs-var">&gt;&gt;=</span></span><span> </span><span class="hs-glyph">\</span><span id="local-6989586621683022863"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621683022863"><span class="hs-identifier hs-var">ty'</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-1372"></span><span>                                       </span><span class="annot"><span class="annottext">Term -&gt; TR Term
forall a. a -&gt; IOEnv (Env TcGblEnv TcLclEnv) a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TermProcessor Term Term
</span><a href="GHC.Runtime.Heap.Inspect.html#Term"><span class="hs-identifier hs-var">Term</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621683022863"><span class="hs-identifier hs-var">ty'</span></a></span><span> </span><span class="annot"><span class="annottext">Either String DataCon
</span><a href="#local-6989586621683022860"><span class="hs-identifier hs-var">dc</span></a></span><span> </span><span class="annot"><span class="annottext">ForeignHValue
</span><a href="#local-6989586621683022861"><span class="hs-identifier hs-var">v</span></a></span><span> </span><span class="annot"><span class="annottext">[Term]
</span><a href="#local-6989586621683022862"><span class="hs-identifier hs-var">tt</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1373"></span><span>             </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">fSuspensionM :: ClosureType -&gt; Type -&gt; ForeignHValue -&gt; Maybe Name -&gt; TR Term
</span><a href="GHC.Runtime.Heap.Inspect.html#fSuspensionM"><span class="hs-identifier hs-var">fSuspensionM</span></a></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-glyph">\</span><span id="local-6989586621683022864"><span class="annot"><span class="annottext">ClosureType
</span><a href="#local-6989586621683022864"><span class="hs-identifier hs-var">ct</span></a></span></span><span> </span><span id="local-6989586621683022865"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621683022865"><span class="hs-identifier hs-var">ty</span></a></span></span><span> </span><span id="local-6989586621683022866"><span class="annot"><span class="annottext">ForeignHValue
</span><a href="#local-6989586621683022866"><span class="hs-identifier hs-var">v</span></a></span></span><span> </span><span id="local-6989586621683022867"><span class="annot"><span class="annottext">Maybe Name
</span><a href="#local-6989586621683022867"><span class="hs-identifier hs-var">b</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Type -&gt; TR Type
</span><a href="GHC.Runtime.Heap.Inspect.html#zonkRttiType"><span class="hs-identifier hs-var">zonkRttiType</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621683022865"><span class="hs-identifier hs-var">ty</span></a></span><span> </span><span class="annot"><span class="annottext">TR Type -&gt; (Type -&gt; TR Term) -&gt; TR Term
forall a b.
IOEnv (Env TcGblEnv TcLclEnv) a
-&gt; (a -&gt; IOEnv (Env TcGblEnv TcLclEnv) b)
-&gt; IOEnv (Env TcGblEnv TcLclEnv) b
forall (m :: * -&gt; *) a b. Monad m =&gt; m a -&gt; (a -&gt; m b) -&gt; m b
</span><span class="hs-operator hs-var">&gt;&gt;=</span></span><span> </span><span class="hs-glyph">\</span><span id="local-6989586621683022868"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621683022868"><span class="hs-identifier hs-var">ty</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-1374"></span><span>                                             </span><span class="annot"><span class="annottext">Term -&gt; TR Term
forall a. a -&gt; IOEnv (Env TcGblEnv TcLclEnv) a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ClosureType -&gt; Type -&gt; ForeignHValue -&gt; Maybe Name -&gt; Term
</span><a href="GHC.Runtime.Heap.Inspect.html#Suspension"><span class="hs-identifier hs-var">Suspension</span></a></span><span> </span><span class="annot"><span class="annottext">ClosureType
</span><a href="#local-6989586621683022864"><span class="hs-identifier hs-var">ct</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621683022868"><span class="hs-identifier hs-var">ty</span></a></span><span> </span><span class="annot"><span class="annottext">ForeignHValue
</span><a href="#local-6989586621683022866"><span class="hs-identifier hs-var">v</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe Name
</span><a href="#local-6989586621683022867"><span class="hs-identifier hs-var">b</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1375"></span><span>             </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">fNewtypeWrapM :: Type -&gt; Either String DataCon -&gt; Term -&gt; TR Term
</span><a href="GHC.Runtime.Heap.Inspect.html#fNewtypeWrapM"><span class="hs-identifier hs-var">fNewtypeWrapM</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-glyph">\</span><span id="local-6989586621683022869"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621683022869"><span class="hs-identifier hs-var">ty</span></a></span></span><span> </span><span id="local-6989586621683022870"><span class="annot"><span class="annottext">Either String DataCon
</span><a href="#local-6989586621683022870"><span class="hs-identifier hs-var">dc</span></a></span></span><span> </span><span id="local-6989586621683022871"><span class="annot"><span class="annottext">Term
</span><a href="#local-6989586621683022871"><span class="hs-identifier hs-var">t</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Type -&gt; TR Type
</span><a href="GHC.Runtime.Heap.Inspect.html#zonkRttiType"><span class="hs-identifier hs-var">zonkRttiType</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621683022869"><span class="hs-identifier hs-var">ty</span></a></span><span> </span><span class="annot"><span class="annottext">TR Type -&gt; (Type -&gt; TR Term) -&gt; TR Term
forall a b.
IOEnv (Env TcGblEnv TcLclEnv) a
-&gt; (a -&gt; IOEnv (Env TcGblEnv TcLclEnv) b)
-&gt; IOEnv (Env TcGblEnv TcLclEnv) b
forall (m :: * -&gt; *) a b. Monad m =&gt; m a -&gt; (a -&gt; m b) -&gt; m b
</span><span class="hs-operator hs-var">&gt;&gt;=</span></span><span> </span><span class="hs-glyph">\</span><span id="local-6989586621683022872"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621683022872"><span class="hs-identifier hs-var">ty'</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-1376"></span><span>                                           </span><span class="annot"><span class="annottext">Term -&gt; TR Term
forall a. a -&gt; IOEnv (Env TcGblEnv TcLclEnv) a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span class="annot"><span class="annottext">(Term -&gt; TR Term) -&gt; Term -&gt; TR Term
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Type -&gt; Either String DataCon -&gt; Term -&gt; Term
</span><a href="GHC.Runtime.Heap.Inspect.html#NewtypeWrap"><span class="hs-identifier hs-var">NewtypeWrap</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621683022872"><span class="hs-identifier hs-var">ty'</span></a></span><span> </span><span class="annot"><span class="annottext">Either String DataCon
</span><a href="#local-6989586621683022870"><span class="hs-identifier hs-var">dc</span></a></span><span> </span><span class="annot"><span class="annottext">Term
</span><a href="#local-6989586621683022871"><span class="hs-identifier hs-var">t</span></a></span><span>
</span><span id="line-1377"></span><span>             </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">fRefWrapM :: Type -&gt; Term -&gt; TR Term
</span><a href="GHC.Runtime.Heap.Inspect.html#fRefWrapM"><span class="hs-identifier hs-var">fRefWrapM</span></a></span><span>     </span><span class="hs-glyph">=</span><span> </span><span class="hs-glyph">\</span><span id="local-6989586621683022873"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621683022873"><span class="hs-identifier hs-var">ty</span></a></span></span><span> </span><span id="local-6989586621683022874"><span class="annot"><span class="annottext">Term
</span><a href="#local-6989586621683022874"><span class="hs-identifier hs-var">t</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">(Type -&gt; Term -&gt; Term)
-&gt; IOEnv (Env TcGblEnv TcLclEnv) (Type -&gt; Term -&gt; Term)
forall a. a -&gt; IOEnv (Env TcGblEnv TcLclEnv) a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="annot"><span class="annottext">Type -&gt; Term -&gt; Term
</span><a href="GHC.Runtime.Heap.Inspect.html#RefWrap"><span class="hs-identifier hs-var">RefWrap</span></a></span><span>  </span><span class="annot"><span class="annottext">IOEnv (Env TcGblEnv TcLclEnv) (Type -&gt; Term -&gt; Term)
-&gt; TR Type -&gt; IOEnv (Env TcGblEnv TcLclEnv) (Term -&gt; Term)
forall (m :: * -&gt; *) a b. Monad m =&gt; m (a -&gt; b) -&gt; m a -&gt; m b
</span><span class="hs-operator hs-var">`ap`</span></span><span>
</span><span id="line-1378"></span><span>                                        </span><span class="annot"><span class="annottext">Type -&gt; TR Type
</span><a href="GHC.Runtime.Heap.Inspect.html#zonkRttiType"><span class="hs-identifier hs-var">zonkRttiType</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621683022873"><span class="hs-identifier hs-var">ty</span></a></span><span> </span><span class="annot"><span class="annottext">IOEnv (Env TcGblEnv TcLclEnv) (Term -&gt; Term) -&gt; TR Term -&gt; TR Term
forall (m :: * -&gt; *) a b. Monad m =&gt; m (a -&gt; b) -&gt; m a -&gt; m b
</span><span class="hs-operator hs-var">`ap`</span></span><span> </span><span class="annot"><span class="annottext">Term -&gt; TR Term
forall a. a -&gt; IOEnv (Env TcGblEnv TcLclEnv) a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="annot"><span class="annottext">Term
</span><a href="#local-6989586621683022874"><span class="hs-identifier hs-var">t</span></a></span><span>
</span><span id="line-1379"></span><span>             </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">fPrimM :: Type -&gt; [Word] -&gt; TR Term
</span><a href="GHC.Runtime.Heap.Inspect.html#fPrimM"><span class="hs-identifier hs-var">fPrimM</span></a></span><span>        </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Term -&gt; TR Term
forall a. a -&gt; IOEnv (Env TcGblEnv TcLclEnv) a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span class="annot"><span class="annottext">(Term -&gt; TR Term) -&gt; ([Word] -&gt; Term) -&gt; [Word] -&gt; TR Term
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(([Word] -&gt; Term) -&gt; [Word] -&gt; TR Term)
-&gt; (Type -&gt; [Word] -&gt; Term) -&gt; Type -&gt; [Word] -&gt; TR Term
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">Type -&gt; [Word] -&gt; Term
</span><a href="GHC.Runtime.Heap.Inspect.html#Prim"><span class="hs-identifier hs-var">Prim</span></a></span><span> </span><span class="hs-special">}</span><span class="hs-special">)</span><span>
</span><span id="line-1380"></span><span>
</span><span id="line-1381"></span><span class="annot"><a href="GHC.Runtime.Heap.Inspect.html#zonkRttiType"><span class="hs-identifier hs-type">zonkRttiType</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.TcType.html#TcType"><span class="hs-identifier hs-type">TcType</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#TcM"><span class="hs-identifier hs-type">TcM</span></a></span><span> </span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#Type"><span class="hs-identifier hs-type">Type</span></a></span><span>
</span><span id="line-1382"></span><span class="hs-comment">-- Zonk the type, replacing any unbound Meta tyvars</span><span>
</span><span id="line-1383"></span><span class="hs-comment">-- by RuntimeUnk skolems, safely out of Meta-tyvar-land</span><span>
</span><span id="line-1384"></span><span id="zonkRttiType"><span class="annot"><span class="annottext">zonkRttiType :: Type -&gt; TR Type
</span><a href="GHC.Runtime.Heap.Inspect.html#zonkRttiType"><span class="hs-identifier hs-var hs-var">zonkRttiType</span></a></span></span><span> </span><span id="local-6989586621683022876"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621683022876"><span class="hs-identifier hs-var">ty</span></a></span></span><span>
</span><span id="line-1385"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ZonkFlexi -&gt; ZonkT TcM Type -&gt; TR Type
forall (m :: * -&gt; *) b. MonadIO m =&gt; ZonkFlexi -&gt; ZonkT m b -&gt; m b
</span><a href="GHC.Tc.Zonk.Env.html#initZonkEnv"><span class="hs-identifier hs-var">initZonkEnv</span></a></span><span> </span><span class="annot"><span class="annottext">ZonkFlexi
</span><a href="GHC.Tc.Zonk.Env.html#RuntimeUnkFlexi"><span class="hs-identifier hs-var">RuntimeUnkFlexi</span></a></span><span> </span><span class="annot"><span class="annottext">(ZonkT TcM Type -&gt; TR Type) -&gt; ZonkT TcM Type -&gt; TR Type
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Type -&gt; ZonkT TcM Type
</span><a href="GHC.Tc.Zonk.Type.html#zonkTcTypeToTypeX"><span class="hs-identifier hs-var">zonkTcTypeToTypeX</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621683022876"><span class="hs-identifier hs-var">ty</span></a></span><span>
</span><span id="line-1386"></span><span>
</span><span id="line-1387"></span><span class="hs-comment">--------------------------------------------------------------------------------</span><span>
</span><span id="line-1388"></span><span class="hs-comment">-- Restore Class predicates out of a representation type</span><span>
</span><span id="line-1389"></span><span class="annot"><a href="GHC.Runtime.Heap.Inspect.html#dictsView"><span class="hs-identifier hs-type">dictsView</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#Type"><span class="hs-identifier hs-type">Type</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#Type"><span class="hs-identifier hs-type">Type</span></a></span><span>
</span><span id="line-1390"></span><span id="dictsView"><span class="annot"><span class="annottext">dictsView :: Type -&gt; Type
</span><a href="GHC.Runtime.Heap.Inspect.html#dictsView"><span class="hs-identifier hs-var hs-var">dictsView</span></a></span></span><span> </span><span id="local-6989586621683022880"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621683022880"><span class="hs-identifier hs-var">ty</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621683022880"><span class="hs-identifier hs-var">ty</span></a></span><span>
</span><span id="line-1391"></span><span>
</span><span id="line-1392"></span><span>
</span><span id="line-1393"></span><span class="hs-comment">-- Use only for RTTI types</span><span>
</span><span id="line-1394"></span><span class="annot"><a href="GHC.Runtime.Heap.Inspect.html#isMonomorphic"><span class="hs-identifier hs-type">isMonomorphic</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Runtime.Heap.Inspect.html#RttiType"><span class="hs-identifier hs-type">RttiType</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Bool</span></span><span>
</span><span id="line-1395"></span><span id="isMonomorphic"><span class="annot"><span class="annottext">isMonomorphic :: Type -&gt; Bool
</span><a href="GHC.Runtime.Heap.Inspect.html#isMonomorphic"><span class="hs-identifier hs-var hs-var">isMonomorphic</span></a></span></span><span> </span><span id="local-6989586621683022881"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621683022881"><span class="hs-identifier hs-var">ty</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621683022882"><span class="hs-identifier hs-var">noExistentials</span></a></span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Bool -&gt; Bool
</span><span class="hs-operator hs-var">&amp;&amp;</span></span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621683022883"><span class="hs-identifier hs-var">noUniversals</span></a></span><span>
</span><span id="line-1396"></span><span> </span><span class="hs-keyword">where</span><span> </span><span class="hs-special">(</span><span id="local-6989586621683022884"><span class="annot"><span class="annottext">[TyVar]
</span><a href="#local-6989586621683022884"><span class="hs-identifier hs-var">tvs</span></a></span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">[Type]
</span><span class="hs-identifier">_</span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621683022885"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621683022885"><span class="hs-identifier hs-var">ty'</span></a></span></span><span class="hs-special">)</span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Type -&gt; ([TyVar], [Type], Type)
</span><a href="GHC.Tc.Utils.TcType.html#tcSplitSigmaTy"><span class="hs-identifier hs-var">tcSplitSigmaTy</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621683022881"><span class="hs-identifier hs-var">ty</span></a></span><span>
</span><span id="line-1397"></span><span>       </span><span id="local-6989586621683022882"><span class="annot"><span class="annottext">noExistentials :: Bool
</span><a href="#local-6989586621683022882"><span class="hs-identifier hs-var hs-var">noExistentials</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Type -&gt; Bool
</span><a href="GHC.Core.TyCo.FVs.html#noFreeVarsOfType"><span class="hs-identifier hs-var">noFreeVarsOfType</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621683022885"><span class="hs-identifier hs-var">ty'</span></a></span><span>
</span><span id="line-1398"></span><span>       </span><span id="local-6989586621683022883"><span class="annot"><span class="annottext">noUniversals :: Bool
</span><a href="#local-6989586621683022883"><span class="hs-identifier hs-var hs-var">noUniversals</span></a></span></span><span>   </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[TyVar] -&gt; Bool
forall a. [a] -&gt; Bool
forall (t :: * -&gt; *) a. Foldable t =&gt; t a -&gt; Bool
</span><span class="hs-identifier hs-var">null</span></span><span> </span><span class="annot"><span class="annottext">[TyVar]
</span><a href="#local-6989586621683022884"><span class="hs-identifier hs-var">tvs</span></a></span><span>
</span><span id="line-1399"></span><span>
</span><span id="line-1400"></span><span class="hs-comment">-- Use only for RTTI types</span><span>
</span><span id="line-1401"></span><span class="annot"><a href="GHC.Runtime.Heap.Inspect.html#isMonomorphicOnNonPhantomArgs"><span class="hs-identifier hs-type">isMonomorphicOnNonPhantomArgs</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Runtime.Heap.Inspect.html#RttiType"><span class="hs-identifier hs-type">RttiType</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Bool</span></span><span>
</span><span id="line-1402"></span><span id="isMonomorphicOnNonPhantomArgs"><span class="annot"><span class="annottext">isMonomorphicOnNonPhantomArgs :: Type -&gt; Bool
</span><a href="GHC.Runtime.Heap.Inspect.html#isMonomorphicOnNonPhantomArgs"><span class="hs-identifier hs-var hs-var">isMonomorphicOnNonPhantomArgs</span></a></span></span><span> </span><span id="local-6989586621683022888"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621683022888"><span class="hs-identifier hs-var">ty</span></a></span></span><span>
</span><span id="line-1403"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span class="hs-special">(</span><span id="local-6989586621683022889"><span class="annot"><span class="annottext">TyCon
</span><a href="#local-6989586621683022889"><span class="hs-identifier hs-var">tc</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621683022890"><span class="annot"><span class="annottext">[Type]
</span><a href="#local-6989586621683022890"><span class="hs-identifier hs-var">all_args</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">HasDebugCallStack =&gt; Type -&gt; Maybe (TyCon, [Type])
Type -&gt; Maybe (TyCon, [Type])
</span><a href="GHC.Core.Type.html#tcSplitTyConApp_maybe"><span class="hs-identifier hs-var">tcSplitTyConApp_maybe</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Type -&gt; Type
</span><a href="GHC.Types.RepType.html#unwrapType"><span class="hs-identifier hs-var">unwrapType</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621683022888"><span class="hs-identifier hs-var">ty</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1404"></span><span>  </span><span class="hs-special">,</span><span> </span><span id="local-6989586621683022891"><span class="annot"><span class="annottext">[TyVar]
</span><a href="#local-6989586621683022891"><span class="hs-identifier hs-var">phantom_vars</span></a></span></span><span>  </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">TyCon -&gt; [TyVar]
</span><a href="GHC.Runtime.Heap.Inspect.html#tyConPhantomTyVars"><span class="hs-identifier hs-var">tyConPhantomTyVars</span></a></span><span> </span><span class="annot"><span class="annottext">TyCon
</span><a href="#local-6989586621683022889"><span class="hs-identifier hs-var">tc</span></a></span><span>
</span><span id="line-1405"></span><span>  </span><span class="hs-special">,</span><span> </span><span id="local-6989586621683022893"><span class="annot"><span class="annottext">[Type]
</span><a href="#local-6989586621683022893"><span class="hs-identifier hs-var">concrete_args</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621683022894"><span class="hs-identifier hs-var">arg</span></a></span><span> </span><span class="hs-glyph">|</span><span> </span><span class="hs-special">(</span><span id="local-6989586621683022895"><span class="annot"><span class="annottext">TyVar
</span><a href="#local-6989586621683022895"><span class="hs-identifier hs-var">tyv</span></a></span></span><span class="hs-special">,</span><span id="local-6989586621683022894"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621683022894"><span class="hs-identifier hs-var">arg</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">TyCon -&gt; [TyVar]
</span><a href="GHC.Core.TyCon.html#tyConTyVars"><span class="hs-identifier hs-var">tyConTyVars</span></a></span><span> </span><span class="annot"><span class="annottext">TyCon
</span><a href="#local-6989586621683022889"><span class="hs-identifier hs-var">tc</span></a></span><span> </span><span class="annot"><span class="annottext">[TyVar] -&gt; [Type] -&gt; [(TyVar, Type)]
forall a b. [a] -&gt; [b] -&gt; [(a, b)]
</span><span class="hs-operator hs-var">`zip`</span></span><span> </span><span class="annot"><span class="annottext">[Type]
</span><a href="#local-6989586621683022890"><span class="hs-identifier hs-var">all_args</span></a></span><span>
</span><span id="line-1406"></span><span>                           </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">TyVar
</span><a href="#local-6989586621683022895"><span class="hs-identifier hs-var">tyv</span></a></span><span> </span><span class="annot"><span class="annottext">TyVar -&gt; [TyVar] -&gt; Bool
forall (t :: * -&gt; *) a. (Foldable t, Eq a) =&gt; a -&gt; t a -&gt; Bool
</span><span class="hs-operator hs-var">`notElem`</span></span><span> </span><span class="annot"><span class="annottext">[TyVar]
</span><a href="#local-6989586621683022891"><span class="hs-identifier hs-var">phantom_vars</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-1407"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(Type -&gt; Bool) -&gt; [Type] -&gt; Bool
forall (t :: * -&gt; *) a. Foldable t =&gt; (a -&gt; Bool) -&gt; t a -&gt; Bool
</span><span class="hs-identifier hs-var">all</span></span><span> </span><span class="annot"><span class="annottext">Type -&gt; Bool
</span><a href="GHC.Runtime.Heap.Inspect.html#isMonomorphicOnNonPhantomArgs"><span class="hs-identifier hs-var">isMonomorphicOnNonPhantomArgs</span></a></span><span> </span><span class="annot"><span class="annottext">[Type]
</span><a href="#local-6989586621683022893"><span class="hs-identifier hs-var">concrete_args</span></a></span><span>
</span><span id="line-1408"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">FunTyFlag
</span><span class="hs-identifier">_</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Type
</span><span class="hs-identifier">_</span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621683022897"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621683022897"><span class="hs-identifier hs-var">ty1</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621683022898"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621683022898"><span class="hs-identifier hs-var">ty2</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Type -&gt; Maybe (FunTyFlag, Type, Type, Type)
</span><a href="GHC.Core.Type.html#splitFunTy_maybe"><span class="hs-identifier hs-var">splitFunTy_maybe</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621683022888"><span class="hs-identifier hs-var">ty</span></a></span><span>
</span><span id="line-1409"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(Type -&gt; Bool) -&gt; [Type] -&gt; Bool
forall (t :: * -&gt; *) a. Foldable t =&gt; (a -&gt; Bool) -&gt; t a -&gt; Bool
</span><span class="hs-identifier hs-var">all</span></span><span> </span><span class="annot"><span class="annottext">Type -&gt; Bool
</span><a href="GHC.Runtime.Heap.Inspect.html#isMonomorphicOnNonPhantomArgs"><span class="hs-identifier hs-var">isMonomorphicOnNonPhantomArgs</span></a></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621683022897"><span class="hs-identifier hs-var">ty1</span></a></span><span class="hs-special">,</span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621683022898"><span class="hs-identifier hs-var">ty2</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-1410"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">otherwise</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Type -&gt; Bool
</span><a href="GHC.Runtime.Heap.Inspect.html#isMonomorphic"><span class="hs-identifier hs-var">isMonomorphic</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621683022888"><span class="hs-identifier hs-var">ty</span></a></span><span>
</span><span id="line-1411"></span><span>
</span><span id="line-1412"></span><span class="annot"><a href="GHC.Runtime.Heap.Inspect.html#tyConPhantomTyVars"><span class="hs-identifier hs-type">tyConPhantomTyVars</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Core.TyCon.html#TyCon"><span class="hs-identifier hs-type">TyCon</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="GHC.Types.Var.html#TyVar"><span class="hs-identifier hs-type">TyVar</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-1413"></span><span id="tyConPhantomTyVars"><span class="annot"><span class="annottext">tyConPhantomTyVars :: TyCon -&gt; [TyVar]
</span><a href="GHC.Runtime.Heap.Inspect.html#tyConPhantomTyVars"><span class="hs-identifier hs-var hs-var">tyConPhantomTyVars</span></a></span></span><span> </span><span id="local-6989586621683022899"><span class="annot"><span class="annottext">TyCon
</span><a href="#local-6989586621683022899"><span class="hs-identifier hs-var">tc</span></a></span></span><span>
</span><span id="line-1414"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">TyCon -&gt; Bool
</span><a href="GHC.Core.TyCon.html#isAlgTyCon"><span class="hs-identifier hs-var">isAlgTyCon</span></a></span><span> </span><span class="annot"><span class="annottext">TyCon
</span><a href="#local-6989586621683022899"><span class="hs-identifier hs-var">tc</span></a></span><span>
</span><span id="line-1415"></span><span>  </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span id="local-6989586621683022901"><span class="annot"><span class="annottext">[DataCon]
</span><a href="#local-6989586621683022901"><span class="hs-identifier hs-var">dcs</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">TyCon -&gt; Maybe [DataCon]
</span><a href="GHC.Core.TyCon.html#tyConDataCons_maybe"><span class="hs-identifier hs-var">tyConDataCons_maybe</span></a></span><span> </span><span class="annot"><span class="annottext">TyCon
</span><a href="#local-6989586621683022899"><span class="hs-identifier hs-var">tc</span></a></span><span>
</span><span id="line-1416"></span><span>  </span><span class="hs-special">,</span><span> </span><span id="local-6989586621683022903"><span class="annot"><span class="annottext">[TyVar]
</span><a href="#local-6989586621683022903"><span class="hs-identifier hs-var">dc_vars</span></a></span></span><span>  </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">(DataCon -&gt; [TyVar]) -&gt; [DataCon] -&gt; [TyVar]
forall (t :: * -&gt; *) a b. Foldable t =&gt; (a -&gt; [b]) -&gt; t a -&gt; [b]
</span><span class="hs-identifier hs-var">concatMap</span></span><span> </span><span class="annot"><span class="annottext">DataCon -&gt; [TyVar]
</span><a href="GHC.Core.DataCon.html#dataConUnivTyVars"><span class="hs-identifier hs-var">dataConUnivTyVars</span></a></span><span> </span><span class="annot"><span class="annottext">[DataCon]
</span><a href="#local-6989586621683022901"><span class="hs-identifier hs-var">dcs</span></a></span><span>
</span><span id="line-1417"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">TyCon -&gt; [TyVar]
</span><a href="GHC.Core.TyCon.html#tyConTyVars"><span class="hs-identifier hs-var">tyConTyVars</span></a></span><span> </span><span class="annot"><span class="annottext">TyCon
</span><a href="#local-6989586621683022899"><span class="hs-identifier hs-var">tc</span></a></span><span> </span><span class="annot"><span class="annottext">[TyVar] -&gt; [TyVar] -&gt; [TyVar]
forall a. Eq a =&gt; [a] -&gt; [a] -&gt; [a]
</span><span class="hs-operator hs-var">\\</span></span><span> </span><span class="annot"><span class="annottext">[TyVar]
</span><a href="#local-6989586621683022903"><span class="hs-identifier hs-var">dc_vars</span></a></span><span>
</span><span id="line-1418"></span><span class="annot"><a href="GHC.Runtime.Heap.Inspect.html#tyConPhantomTyVars"><span class="hs-identifier hs-var">tyConPhantomTyVars</span></a></span><span> </span><span class="annot"><span class="annottext">TyCon
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span>
</span><span id="line-1419"></span><span>
</span><span id="line-1420"></span><span class="hs-keyword">type</span><span> </span><span id="QuantifiedType"><span class="annot"><a href="GHC.Runtime.Heap.Inspect.html#QuantifiedType"><span class="hs-identifier hs-var">QuantifiedType</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><span class="hs-special">[</span><span class="annot"><a href="GHC.Types.Var.html#TyVar"><span class="hs-identifier hs-type">TyVar</span></a></span><span class="hs-special">]</span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#Type"><span class="hs-identifier hs-type">Type</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1421"></span><span>   </span><span class="hs-comment">-- Make the free type variables explicit</span><span>
</span><span id="line-1422"></span><span>
</span><span id="line-1423"></span><span class="annot"><a href="GHC.Runtime.Heap.Inspect.html#quantifyType"><span class="hs-identifier hs-type">quantifyType</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#Type"><span class="hs-identifier hs-type">Type</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Runtime.Heap.Inspect.html#QuantifiedType"><span class="hs-identifier hs-type">QuantifiedType</span></a></span><span>
</span><span id="line-1424"></span><span class="hs-comment">-- Find all free and forall'd tyvars and return them</span><span>
</span><span id="line-1425"></span><span class="hs-comment">-- together with the unmodified input type.</span><span>
</span><span id="line-1426"></span><span id="quantifyType"><span class="annot"><span class="annottext">quantifyType :: Type -&gt; QuantifiedType
</span><a href="GHC.Runtime.Heap.Inspect.html#quantifyType"><span class="hs-identifier hs-var hs-var">quantifyType</span></a></span></span><span> </span><span id="local-6989586621683022905"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621683022905"><span class="hs-identifier hs-var">ty</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><span> </span><span class="annot"><span class="annottext">(TyVar -&gt; Bool) -&gt; [TyVar] -&gt; [TyVar]
forall a. (a -&gt; Bool) -&gt; [a] -&gt; [a]
</span><span class="hs-identifier hs-var">filter</span></span><span> </span><span class="annot"><span class="annottext">TyVar -&gt; Bool
</span><a href="GHC.Types.Var.html#isTyVar"><span class="hs-identifier hs-var">isTyVar</span></a></span><span> </span><span class="annot"><span class="annottext">([TyVar] -&gt; [TyVar]) -&gt; [TyVar] -&gt; [TyVar]
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-1427"></span><span>                    </span><span class="annot"><span class="annottext">Type -&gt; [TyVar]
</span><a href="GHC.Core.TyCo.FVs.html#tyCoVarsOfTypeWellScoped"><span class="hs-identifier hs-var">tyCoVarsOfTypeWellScoped</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621683022907"><span class="hs-identifier hs-var">rho</span></a></span><span>
</span><span id="line-1428"></span><span>                  </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621683022905"><span class="hs-identifier hs-var">ty</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1429"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-1430"></span><span>    </span><span class="hs-special">(</span><span id="local-6989586621683022908"><span class="annot"><span class="annottext">[TyVar]
</span><a href="#local-6989586621683022908"><span class="hs-identifier hs-var">_tvs</span></a></span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">[Type]
</span><span class="hs-identifier">_</span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621683022907"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621683022907"><span class="hs-identifier hs-var">rho</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Type -&gt; ([TyVar], [Type], Type)
</span><a href="GHC.Tc.Utils.TcType.html#tcSplitNestedSigmaTys"><span class="hs-identifier hs-var">tcSplitNestedSigmaTys</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621683022905"><span class="hs-identifier hs-var">ty</span></a></span><span>
</span><span id="line-1431"></span></pre></body></html>