<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><link rel="stylesheet" type="text/css" href="style.css" /><script type="text/javascript" src="highlight.js"></script></head><body><pre><span class="hs-comment">-- -----------------------------------------------------------------------------</span><span>
</span><span id="line-2"></span><span class="hs-comment">--</span><span>
</span><span id="line-3"></span><span class="hs-comment">-- (c) The University of Glasgow 1993-2004</span><span>
</span><span id="line-4"></span><span class="hs-comment">--</span><span>
</span><span id="line-5"></span><span class="hs-comment">--</span><span>
</span><span id="line-6"></span><span class="hs-comment">-- -----------------------------------------------------------------------------</span><span>
</span><span id="line-7"></span><span>
</span><span id="line-8"></span><span class="hs-comment">-- | Note [Native code generator]</span><span>
</span><span id="line-9"></span><span class="hs-comment">-- ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~</span><span>
</span><span id="line-10"></span><span class="hs-comment">--</span><span>
</span><span id="line-11"></span><span class="hs-comment">-- The native-code generator has machine-independent and</span><span>
</span><span id="line-12"></span><span class="hs-comment">-- machine-dependent modules.</span><span>
</span><span id="line-13"></span><span class="hs-comment">--</span><span>
</span><span id="line-14"></span><span class="hs-comment">-- This module (&quot;GHC.CmmToAsm&quot;) is the top-level machine-independent</span><span>
</span><span id="line-15"></span><span class="hs-comment">-- module.  Before entering machine-dependent land, we do some</span><span>
</span><span id="line-16"></span><span class="hs-comment">-- machine-independent optimisations (defined below) on the</span><span>
</span><span id="line-17"></span><span class="hs-comment">-- 'CmmStmts's. (Which ideally would be folded into CmmOpt ...)</span><span>
</span><span id="line-18"></span><span class="hs-comment">--</span><span>
</span><span id="line-19"></span><span class="hs-comment">-- We convert to the machine-specific 'Instr' datatype with</span><span>
</span><span id="line-20"></span><span class="hs-comment">-- 'cmmCodeGen', assuming an infinite supply of registers.  We then use</span><span>
</span><span id="line-21"></span><span class="hs-comment">-- a (mostly) machine-independent register allocator to rejoin</span><span>
</span><span id="line-22"></span><span class="hs-comment">-- reality.  Obviously, 'regAlloc' has machine-specific helper</span><span>
</span><span id="line-23"></span><span class="hs-comment">-- functions (see the used register allocator for details).</span><span>
</span><span id="line-24"></span><span class="hs-comment">--</span><span>
</span><span id="line-25"></span><span class="hs-comment">-- Finally, we order the basic blocks of the function so as to minimise</span><span>
</span><span id="line-26"></span><span class="hs-comment">-- the number of jumps between blocks, by utilising fallthrough wherever</span><span>
</span><span id="line-27"></span><span class="hs-comment">-- possible.</span><span>
</span><span id="line-28"></span><span class="hs-comment">--</span><span>
</span><span id="line-29"></span><span class="hs-comment">-- The machine-dependent bits are generally contained under</span><span>
</span><span id="line-30"></span><span class="hs-comment">--  GHC/CmmToAsm/&lt;Arch&gt;/* and generally breaks down as follows:</span><span>
</span><span id="line-31"></span><span class="hs-comment">--</span><span>
</span><span id="line-32"></span><span class="hs-comment">--   * &quot;Regs&quot;: Everything about the target platform's machine</span><span>
</span><span id="line-33"></span><span class="hs-comment">--     registers (and immediate operands, and addresses, which tend to</span><span>
</span><span id="line-34"></span><span class="hs-comment">--     intermingle/interact with registers).</span><span>
</span><span id="line-35"></span><span class="hs-comment">--</span><span>
</span><span id="line-36"></span><span class="hs-comment">--   * &quot;Instr&quot;:  Includes the 'Instr' datatype plus a miscellany of other things</span><span>
</span><span id="line-37"></span><span class="hs-comment">--     (e.g., 'targetDoubleSize', 'smStablePtrTable', ...)</span><span>
</span><span id="line-38"></span><span class="hs-comment">--</span><span>
</span><span id="line-39"></span><span class="hs-comment">--   * &quot;CodeGen&quot;:  is where 'Cmm' stuff turns into</span><span>
</span><span id="line-40"></span><span class="hs-comment">--     machine instructions.</span><span>
</span><span id="line-41"></span><span class="hs-comment">--</span><span>
</span><span id="line-42"></span><span class="hs-comment">--   * &quot;Ppr&quot;: 'pprInstr' turns an 'Instr' into text (well, really</span><span>
</span><span id="line-43"></span><span class="hs-comment">--     a 'SDoc').</span><span>
</span><span id="line-44"></span><span class="hs-comment">--</span><span>
</span><span id="line-45"></span><span class="hs-comment">-- The register allocators lives under GHC.CmmToAsm.Reg.*, there is both a Linear and a Graph</span><span>
</span><span id="line-46"></span><span class="hs-comment">-- based register allocator. Both of which have their own notes describing them. They</span><span>
</span><span id="line-47"></span><span class="hs-comment">-- are mostly platform independent but there are some platform specific files</span><span>
</span><span id="line-48"></span><span class="hs-comment">-- encoding architecture details under Reg/&lt;Allocator&gt;/&lt;Arch.hs&gt;</span><span>
</span><span id="line-49"></span><span class="hs-comment">--</span><span>
</span><span id="line-50"></span><span class="hs-comment">-- -}</span><span>
</span><span id="line-51"></span><span class="hs-comment">--</span><span>
</span><span id="line-52"></span><span class="hs-keyword">module</span><span> </span><span class="annot"><a href="GHC.CmmToAsm.html"><span class="hs-identifier">GHC.CmmToAsm</span></a></span><span>
</span><span id="line-53"></span><span>   </span><span class="hs-special">(</span><span> </span><span class="annot"><a href="GHC.CmmToAsm.html#nativeCodeGen"><span class="hs-identifier">nativeCodeGen</span></a></span><span>
</span><span id="line-54"></span><span>
</span><span id="line-55"></span><span>   </span><span class="annot"><span class="hs-comment">-- * Test-only exports: see #12744</span></span><span>
</span><span id="line-56"></span><span>   </span><span class="hs-comment">-- used by testGraphNoSpills, which needs to access</span><span>
</span><span id="line-57"></span><span>   </span><span class="hs-comment">-- the register allocator intermediate data structures</span><span>
</span><span id="line-58"></span><span>   </span><span class="hs-comment">-- cmmNativeGen emits</span><span>
</span><span id="line-59"></span><span>   </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.CmmToAsm.html#cmmNativeGen"><span class="hs-identifier">cmmNativeGen</span></a></span><span>
</span><span id="line-60"></span><span>   </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.CmmToAsm.Monad.html#NcgImpl"><span class="hs-identifier">NcgImpl</span></a></span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span>
</span><span id="line-61"></span><span>   </span><span class="hs-special">)</span><span>
</span><span id="line-62"></span><span class="hs-keyword">where</span><span>
</span><span id="line-63"></span><span>
</span><span id="line-64"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Prelude.html"><span class="hs-identifier">GHC.Prelude</span></a></span><span> </span><span class="hs-keyword">hiding</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Prelude.Basic.html#head"><span class="hs-identifier">head</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-65"></span><span>
</span><span id="line-66"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><a href="GHC.CmmToAsm.X86.html"><span class="hs-identifier">GHC.CmmToAsm.X86</span></a></span><span>   </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">X86</span></span><span>
</span><span id="line-67"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><a href="GHC.CmmToAsm.PPC.html"><span class="hs-identifier">GHC.CmmToAsm.PPC</span></a></span><span>   </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">PPC</span></span><span>
</span><span id="line-68"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><a href="GHC.CmmToAsm.AArch64.html"><span class="hs-identifier">GHC.CmmToAsm.AArch64</span></a></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">AArch64</span></span><span>
</span><span id="line-69"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><a href="GHC.CmmToAsm.Wasm.html"><span class="hs-identifier">GHC.CmmToAsm.Wasm</span></a></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">Wasm32</span></span><span>
</span><span id="line-70"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><a href="GHC.CmmToAsm.RV64.html"><span class="hs-identifier">GHC.CmmToAsm.RV64</span></a></span><span>  </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">RV64</span></span><span>
</span><span id="line-71"></span><span>
</span><span id="line-72"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.CmmToAsm.Reg.Liveness.html"><span class="hs-identifier">GHC.CmmToAsm.Reg.Liveness</span></a></span><span>
</span><span id="line-73"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><a href="GHC.CmmToAsm.Reg.Linear.html"><span class="hs-identifier">GHC.CmmToAsm.Reg.Linear</span></a></span><span>                </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">Linear</span></span><span>
</span><span id="line-74"></span><span>
</span><span id="line-75"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><a href="GHC.Data.Graph.Color.html"><span class="hs-identifier">GHC.Data.Graph.Color</span></a></span><span>                   </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">Color</span></span><span>
</span><span id="line-76"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><a href="GHC.CmmToAsm.Reg.Graph.html"><span class="hs-identifier">GHC.CmmToAsm.Reg.Graph</span></a></span><span>                 </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">Color</span></span><span>
</span><span id="line-77"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><a href="GHC.CmmToAsm.Reg.Graph.Stats.html"><span class="hs-identifier">GHC.CmmToAsm.Reg.Graph.Stats</span></a></span><span>           </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">Color</span></span><span>
</span><span id="line-78"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><a href="GHC.CmmToAsm.Reg.Graph.TrivColorable.html"><span class="hs-identifier">GHC.CmmToAsm.Reg.Graph.TrivColorable</span></a></span><span>   </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">Color</span></span><span>
</span><span id="line-79"></span><span>
</span><span id="line-80"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Utils.Asm.html"><span class="hs-identifier">GHC.Utils.Asm</span></a></span><span>
</span><span id="line-81"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.CmmToAsm.Reg.Target.html"><span class="hs-identifier">GHC.CmmToAsm.Reg.Target</span></a></span><span>
</span><span id="line-82"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Platform.html"><span class="hs-identifier">GHC.Platform</span></a></span><span>
</span><span id="line-83"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.CmmToAsm.BlockLayout.html"><span class="hs-identifier">GHC.CmmToAsm.BlockLayout</span></a></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">BlockLayout</span></span><span>
</span><span id="line-84"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Settings.Config.html"><span class="hs-identifier">GHC.Settings.Config</span></a></span><span>
</span><span id="line-85"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.CmmToAsm.Instr.html"><span class="hs-identifier">GHC.CmmToAsm.Instr</span></a></span><span>
</span><span id="line-86"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.CmmToAsm.PIC.html"><span class="hs-identifier">GHC.CmmToAsm.PIC</span></a></span><span>
</span><span id="line-87"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Platform.Reg.html"><span class="hs-identifier">GHC.Platform.Reg</span></a></span><span>
</span><span id="line-88"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Platform.Reg.Class.html"><span class="hs-identifier">GHC.Platform.Reg.Class</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Platform.Reg.Class.html#RegClass"><span class="hs-identifier">RegClass</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-89"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.CmmToAsm.Monad.html"><span class="hs-identifier">GHC.CmmToAsm.Monad</span></a></span><span>
</span><span id="line-90"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.CmmToAsm.CFG.html"><span class="hs-identifier">GHC.CmmToAsm.CFG</span></a></span><span>
</span><span id="line-91"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.CmmToAsm.Dwarf.html"><span class="hs-identifier">GHC.CmmToAsm.Dwarf</span></a></span><span>
</span><span id="line-92"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.CmmToAsm.Config.html"><span class="hs-identifier">GHC.CmmToAsm.Config</span></a></span><span>
</span><span id="line-93"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.CmmToAsm.Types.html"><span class="hs-identifier">GHC.CmmToAsm.Types</span></a></span><span>
</span><span id="line-94"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Cmm.DebugBlock.html"><span class="hs-identifier">GHC.Cmm.DebugBlock</span></a></span><span>
</span><span id="line-95"></span><span>
</span><span id="line-96"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Cmm.BlockId.html"><span class="hs-identifier">GHC.Cmm.BlockId</span></a></span><span>
</span><span id="line-97"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.StgToCmm.CgUtils.html"><span class="hs-identifier">GHC.StgToCmm.CgUtils</span></a></span><span> </span><span class="hs-special">(</span><span> </span><span class="annot"><a href="GHC.StgToCmm.CgUtils.html#fixStgRegisters"><span class="hs-identifier">fixStgRegisters</span></a></span><span> </span><span class="hs-special">)</span><span>
</span><span id="line-98"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Cmm.html"><span class="hs-identifier">GHC.Cmm</span></a></span><span>
</span><span id="line-99"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Cmm.Dataflow.Label.html"><span class="hs-identifier">GHC.Cmm.Dataflow.Label</span></a></span><span>
</span><span id="line-100"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Cmm.GenericOpt.html"><span class="hs-identifier">GHC.Cmm.GenericOpt</span></a></span><span>
</span><span id="line-101"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Cmm.CLabel.html"><span class="hs-identifier">GHC.Cmm.CLabel</span></a></span><span>
</span><span id="line-102"></span><span>
</span><span id="line-103"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Types.Unique.FM.html"><span class="hs-identifier">GHC.Types.Unique.FM</span></a></span><span>
</span><span id="line-104"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Types.Unique.DSM.html"><span class="hs-identifier">GHC.Types.Unique.DSM</span></a></span><span>
</span><span id="line-105"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Driver.DynFlags.html"><span class="hs-identifier">GHC.Driver.DynFlags</span></a></span><span>
</span><span id="line-106"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Driver.Ppr.html"><span class="hs-identifier">GHC.Driver.Ppr</span></a></span><span>
</span><span id="line-107"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Utils.Misc.html"><span class="hs-identifier">GHC.Utils.Misc</span></a></span><span>
</span><span id="line-108"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Utils.Logger.html"><span class="hs-identifier">GHC.Utils.Logger</span></a></span><span>
</span><span id="line-109"></span><span>
</span><span id="line-110"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Utils.BufHandle.html"><span class="hs-identifier">GHC.Utils.BufHandle</span></a></span><span>
</span><span id="line-111"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Utils.Outputable.html"><span class="hs-identifier">GHC.Utils.Outputable</span></a></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">Outputable</span></span><span>
</span><span id="line-112"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Utils.Panic.html"><span class="hs-identifier">GHC.Utils.Panic</span></a></span><span>
</span><span id="line-113"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Utils.Error.html"><span class="hs-identifier">GHC.Utils.Error</span></a></span><span>
</span><span id="line-114"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Utils.Exception.html"><span class="hs-identifier">GHC.Utils.Exception</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">evaluate</span></span><span class="hs-special">)</span><span>
</span><span id="line-115"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Utils.Constants.html"><span class="hs-identifier">GHC.Utils.Constants</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Utils.Constants.html#debugIsOn"><span class="hs-identifier">debugIsOn</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-116"></span><span>
</span><span id="line-117"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Data.FastString.html"><span class="hs-identifier">GHC.Data.FastString</span></a></span><span>
</span><span id="line-118"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Types.Unique.Set.html"><span class="hs-identifier">GHC.Types.Unique.Set</span></a></span><span>
</span><span id="line-119"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Unit.html"><span class="hs-identifier">GHC.Unit</span></a></span><span>
</span><span id="line-120"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.StgToCmm.CgUtils.html"><span class="hs-identifier">GHC.StgToCmm.CgUtils</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.StgToCmm.CgUtils.html#CgStream"><span class="hs-identifier">CgStream</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-121"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Data.Stream.html"><span class="hs-identifier">GHC.Data.Stream</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">liftIO</span></span><span class="hs-special">)</span><span>
</span><span id="line-122"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><a href="GHC.Data.Stream.html"><span class="hs-identifier">GHC.Data.Stream</span></a></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">Stream</span></span><span>
</span><span id="line-123"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Settings.html"><span class="hs-identifier">GHC.Settings</span></a></span><span>
</span><span id="line-124"></span><span>
</span><span id="line-125"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="../../base-4.21.0.0-ae91/src/Data.List.html"><span class="hs-identifier">Data.List</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">sortBy</span></span><span class="hs-special">)</span><span>
</span><span id="line-126"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="../../base-4.21.0.0-ae91/src/Data.List.NonEmpty.html"><span class="hs-identifier">Data.List.NonEmpty</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../../base-4.21.0.0-ae91/src/Data.List.NonEmpty.html#groupAllWith"><span class="hs-identifier">groupAllWith</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="../../base-4.21.0.0-ae91/src/Data.List.NonEmpty.html#head"><span class="hs-identifier">head</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-127"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="../../base-4.21.0.0-ae91/src/Data.Maybe.html"><span class="hs-identifier">Data.Maybe</span></a></span><span>
</span><span id="line-128"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="../../base-4.21.0.0-ae91/src/Data.Ord.html"><span class="hs-identifier">Data.Ord</span></a></span><span>         </span><span class="hs-special">(</span><span> </span><span class="annot"><span class="hs-identifier">comparing</span></span><span> </span><span class="hs-special">)</span><span>
</span><span id="line-129"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="../../base-4.21.0.0-ae91/src/Control.Monad.html"><span class="hs-identifier">Control.Monad</span></a></span><span>
</span><span id="line-130"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="../../base-4.21.0.0-ae91/src/System.IO.html"><span class="hs-identifier">System.IO</span></a></span><span>
</span><span id="line-131"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="../../directory-1.3.9.0-af18/src/System.Directory.html"><span class="hs-identifier">System.Directory</span></a></span><span> </span><span class="hs-special">(</span><span> </span><span class="annot"><a href="../../directory-1.3.9.0-af18/src/System.Directory.html#getCurrentDirectory"><span class="hs-identifier">getCurrentDirectory</span></a></span><span> </span><span class="hs-special">)</span><span>
</span><span id="line-132"></span><span>
</span><span id="line-133"></span><span class="hs-comment">--------------------</span><span>
</span><span id="line-134"></span><span class="annot"><a href="GHC.CmmToAsm.html#nativeCodeGen"><span class="hs-identifier hs-type">nativeCodeGen</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-keyword">forall</span><span> </span><span id="local-6989586621682882063"><span class="annot"><a href="#local-6989586621682882063"><span class="hs-identifier hs-type">a</span></a></span></span><span> </span><span class="hs-operator">.</span><span> </span><span class="annot"><a href="GHC.Utils.Logger.html#Logger"><span class="hs-identifier hs-type">Logger</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Settings.html#ToolSettings"><span class="hs-identifier hs-type">ToolSettings</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.CmmToAsm.Config.html#NCGConfig"><span class="hs-identifier hs-type">NCGConfig</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Unit.Module.Location.html#ModLocation"><span class="hs-identifier hs-type">ModLocation</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Handle</span></span><span>
</span><span id="line-135"></span><span>              </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.StgToCmm.CgUtils.html#CgStream"><span class="hs-identifier hs-type">CgStream</span></a></span><span> </span><span class="annot"><a href="GHC.Cmm.html#RawCmmGroup"><span class="hs-identifier hs-type">RawCmmGroup</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682882063"><span class="hs-identifier hs-type">a</span></a></span><span>
</span><span id="line-136"></span><span>              </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Types.Unique.DSM.html#UniqDSMT"><span class="hs-identifier hs-type">UniqDSMT</span></a></span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="annot"><a href="#local-6989586621682882063"><span class="hs-identifier hs-type">a</span></a></span><span>
</span><span id="line-137"></span><span id="nativeCodeGen"><span class="annot"><span class="annottext">nativeCodeGen :: forall a.
Logger
-&gt; ToolSettings
-&gt; NCGConfig
-&gt; ModLocation
-&gt; Handle
-&gt; CgStream RawCmmGroup a
-&gt; UniqDSMT IO a
</span><a href="GHC.CmmToAsm.html#nativeCodeGen"><span class="hs-identifier hs-var hs-var">nativeCodeGen</span></a></span></span><span> </span><span id="local-6989586621682882582"><span class="annot"><span class="annottext">Logger
</span><a href="#local-6989586621682882582"><span class="hs-identifier hs-var">logger</span></a></span></span><span> </span><span id="local-6989586621682882583"><span class="annot"><span class="annottext">ToolSettings
</span><a href="#local-6989586621682882583"><span class="hs-identifier hs-var">ts</span></a></span></span><span> </span><span id="local-6989586621682882584"><span class="annot"><span class="annottext">NCGConfig
</span><a href="#local-6989586621682882584"><span class="hs-identifier hs-var">config</span></a></span></span><span> </span><span id="local-6989586621682882585"><span class="annot"><span class="annottext">ModLocation
</span><a href="#local-6989586621682882585"><span class="hs-identifier hs-var">modLoc</span></a></span></span><span> </span><span id="local-6989586621682882586"><span class="annot"><span class="annottext">Handle
</span><a href="#local-6989586621682882586"><span class="hs-identifier hs-var">h</span></a></span></span><span> </span><span id="local-6989586621682882587"><span class="annot"><span class="annottext">CgStream RawCmmGroup a
</span><a href="#local-6989586621682882587"><span class="hs-identifier hs-var">cmms</span></a></span></span><span>
</span><span id="line-138"></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621682882588"><span class="annot"><span class="annottext">platform :: Platform
</span><a href="#local-6989586621682882588"><span class="hs-identifier hs-var hs-var">platform</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">NCGConfig -&gt; Platform
</span><a href="GHC.CmmToAsm.Config.html#ncgPlatform"><span class="hs-identifier hs-var">ncgPlatform</span></a></span><span> </span><span class="annot"><span class="annottext">NCGConfig
</span><a href="#local-6989586621682882584"><span class="hs-identifier hs-var">config</span></a></span><span>
</span><span id="line-139"></span><span>       </span><span id="local-6989586621682882088"><span id="local-6989586621682882089"><span id="local-6989586621682882090"><span class="annot"><a href="#local-6989586621682882590"><span class="hs-identifier hs-type">nCG'</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span> </span><span class="annot"><a href="GHC.Utils.Outputable.html#OutputableP"><span class="hs-identifier hs-type">OutputableP</span></a></span><span> </span><span class="annot"><a href="GHC.Platform.html#Platform"><span class="hs-identifier hs-type">Platform</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682882088"><span class="hs-identifier hs-type">statics</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Utils.Outputable.html#Outputable"><span class="hs-identifier hs-type">Outputable</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682882089"><span class="hs-identifier hs-type">jumpDest</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.CmmToAsm.Instr.html#Instruction"><span class="hs-identifier hs-type">Instruction</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682882090"><span class="hs-identifier hs-type">instr</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-140"></span><span>            </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="GHC.CmmToAsm.Monad.html#NcgImpl"><span class="hs-identifier hs-type">NcgImpl</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682882088"><span class="hs-identifier hs-type">statics</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682882090"><span class="hs-identifier hs-type">instr</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682882089"><span class="hs-identifier hs-type">jumpDest</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Types.Unique.DSM.html#UniqDSMT"><span class="hs-identifier hs-type">UniqDSMT</span></a></span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="annot"><a href="#local-6989586621682882063"><span class="hs-identifier hs-type">a</span></a></span></span></span></span><span>
</span><span id="line-141"></span><span>       </span><span id="local-6989586621682882590"><span class="annot"><span class="annottext">nCG' :: forall statics jumpDest instr.
(OutputableP Platform statics, Outputable jumpDest,
 Instruction instr) =&gt;
NcgImpl statics instr jumpDest -&gt; UniqDSMT IO a
</span><a href="#local-6989586621682882590"><span class="hs-identifier hs-var hs-var">nCG'</span></a></span></span><span> </span><span id="local-6989586621682882597"><span class="annot"><span class="annottext">NcgImpl statics instr jumpDest
</span><a href="#local-6989586621682882597"><span class="hs-identifier hs-var">ncgImpl</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Logger
-&gt; NCGConfig
-&gt; ModLocation
-&gt; NcgImpl statics instr jumpDest
-&gt; Handle
-&gt; CgStream RawCmmGroup a
-&gt; UniqDSMT IO a
forall statics jumpDest instr a.
(OutputableP Platform statics, Outputable jumpDest,
 Instruction instr) =&gt;
Logger
-&gt; NCGConfig
-&gt; ModLocation
-&gt; NcgImpl statics instr jumpDest
-&gt; Handle
-&gt; CgStream RawCmmGroup a
-&gt; UniqDSMT IO a
</span><a href="GHC.CmmToAsm.html#nativeCodeGen%27"><span class="hs-identifier hs-var">nativeCodeGen'</span></a></span><span> </span><span class="annot"><span class="annottext">Logger
</span><a href="#local-6989586621682882582"><span class="hs-identifier hs-var">logger</span></a></span><span> </span><span class="annot"><span class="annottext">NCGConfig
</span><a href="#local-6989586621682882584"><span class="hs-identifier hs-var">config</span></a></span><span> </span><span class="annot"><span class="annottext">ModLocation
</span><a href="#local-6989586621682882585"><span class="hs-identifier hs-var">modLoc</span></a></span><span> </span><span class="annot"><span class="annottext">NcgImpl statics instr jumpDest
</span><a href="#local-6989586621682882597"><span class="hs-identifier hs-var">ncgImpl</span></a></span><span> </span><span class="annot"><span class="annottext">Handle
</span><a href="#local-6989586621682882586"><span class="hs-identifier hs-var">h</span></a></span><span> </span><span class="annot"><span class="annottext">CgStream RawCmmGroup a
</span><a href="#local-6989586621682882587"><span class="hs-identifier hs-var">cmms</span></a></span><span>
</span><span id="line-142"></span><span>   </span><span class="hs-keyword">in</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">Platform -&gt; Arch
</span><a href="GHC.Platform.html#platformArch"><span class="hs-identifier hs-var">platformArch</span></a></span><span> </span><span class="annot"><span class="annottext">Platform
</span><a href="#local-6989586621682882588"><span class="hs-identifier hs-var">platform</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-143"></span><span>      </span><span class="annot"><span class="annottext">Arch
</span><span class="hs-identifier hs-var">ArchX86</span></span><span>       </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">NcgImpl (Alignment, RawCmmStatics) Instr JumpDest -&gt; UniqDSMT IO a
forall statics jumpDest instr.
(OutputableP Platform statics, Outputable jumpDest,
 Instruction instr) =&gt;
NcgImpl statics instr jumpDest -&gt; UniqDSMT IO a
</span><a href="#local-6989586621682882590"><span class="hs-identifier hs-var">nCG'</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">NCGConfig -&gt; NcgImpl (Alignment, RawCmmStatics) Instr JumpDest
</span><a href="GHC.CmmToAsm.X86.html#ncgX86"><span class="hs-identifier hs-var">X86.ncgX86</span></a></span><span>     </span><span class="annot"><span class="annottext">NCGConfig
</span><a href="#local-6989586621682882584"><span class="hs-identifier hs-var">config</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-144"></span><span>      </span><span class="annot"><span class="annottext">Arch
</span><span class="hs-identifier hs-var">ArchX86_64</span></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">NcgImpl (Alignment, RawCmmStatics) Instr JumpDest -&gt; UniqDSMT IO a
forall statics jumpDest instr.
(OutputableP Platform statics, Outputable jumpDest,
 Instruction instr) =&gt;
NcgImpl statics instr jumpDest -&gt; UniqDSMT IO a
</span><a href="#local-6989586621682882590"><span class="hs-identifier hs-var">nCG'</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">NCGConfig -&gt; NcgImpl (Alignment, RawCmmStatics) Instr JumpDest
</span><a href="GHC.CmmToAsm.X86.html#ncgX86_64"><span class="hs-identifier hs-var">X86.ncgX86_64</span></a></span><span>  </span><span class="annot"><span class="annottext">NCGConfig
</span><a href="#local-6989586621682882584"><span class="hs-identifier hs-var">config</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-145"></span><span>      </span><span class="annot"><span class="annottext">Arch
</span><span class="hs-identifier hs-var">ArchPPC</span></span><span>       </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">NcgImpl RawCmmStatics Instr JumpDest -&gt; UniqDSMT IO a
forall statics jumpDest instr.
(OutputableP Platform statics, Outputable jumpDest,
 Instruction instr) =&gt;
NcgImpl statics instr jumpDest -&gt; UniqDSMT IO a
</span><a href="#local-6989586621682882590"><span class="hs-identifier hs-var">nCG'</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">NCGConfig -&gt; NcgImpl RawCmmStatics Instr JumpDest
</span><a href="GHC.CmmToAsm.PPC.html#ncgPPC"><span class="hs-identifier hs-var">PPC.ncgPPC</span></a></span><span>     </span><span class="annot"><span class="annottext">NCGConfig
</span><a href="#local-6989586621682882584"><span class="hs-identifier hs-var">config</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-146"></span><span>      </span><span class="annot"><span class="hs-identifier hs-type">ArchPPC_64</span></span><span> </span><span class="annot"><span class="annottext">PPC_64ABI
</span><span class="hs-identifier">_</span></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">NcgImpl RawCmmStatics Instr JumpDest -&gt; UniqDSMT IO a
forall statics jumpDest instr.
(OutputableP Platform statics, Outputable jumpDest,
 Instruction instr) =&gt;
NcgImpl statics instr jumpDest -&gt; UniqDSMT IO a
</span><a href="#local-6989586621682882590"><span class="hs-identifier hs-var">nCG'</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">NCGConfig -&gt; NcgImpl RawCmmStatics Instr JumpDest
</span><a href="GHC.CmmToAsm.PPC.html#ncgPPC"><span class="hs-identifier hs-var">PPC.ncgPPC</span></a></span><span>     </span><span class="annot"><span class="annottext">NCGConfig
</span><a href="#local-6989586621682882584"><span class="hs-identifier hs-var">config</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-147"></span><span>      </span><span class="annot"><span class="annottext">Arch
</span><span class="hs-identifier hs-var">ArchS390X</span></span><span>     </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">String -&gt; UniqDSMT IO a
forall a. HasCallStack =&gt; String -&gt; a
</span><a href="GHC.Utils.Panic.Plain.html#panic"><span class="hs-identifier hs-var">panic</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;nativeCodeGen: No NCG for S390X&quot;</span></span><span>
</span><span id="line-148"></span><span>      </span><span class="annot"><span class="hs-identifier hs-type">ArchARM</span></span><span> </span><span class="hs-special">{</span><span class="hs-special">}</span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">String -&gt; UniqDSMT IO a
forall a. HasCallStack =&gt; String -&gt; a
</span><a href="GHC.Utils.Panic.Plain.html#panic"><span class="hs-identifier hs-var">panic</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;nativeCodeGen: No NCG for ARM&quot;</span></span><span>
</span><span id="line-149"></span><span>      </span><span class="annot"><span class="annottext">Arch
</span><span class="hs-identifier hs-var">ArchAArch64</span></span><span>   </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">NcgImpl RawCmmStatics Instr JumpDest -&gt; UniqDSMT IO a
forall statics jumpDest instr.
(OutputableP Platform statics, Outputable jumpDest,
 Instruction instr) =&gt;
NcgImpl statics instr jumpDest -&gt; UniqDSMT IO a
</span><a href="#local-6989586621682882590"><span class="hs-identifier hs-var">nCG'</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">NCGConfig -&gt; NcgImpl RawCmmStatics Instr JumpDest
</span><a href="GHC.CmmToAsm.AArch64.html#ncgAArch64"><span class="hs-identifier hs-var">AArch64.ncgAArch64</span></a></span><span> </span><span class="annot"><span class="annottext">NCGConfig
</span><a href="#local-6989586621682882584"><span class="hs-identifier hs-var">config</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-150"></span><span>      </span><span class="annot"><span class="annottext">Arch
</span><span class="hs-identifier hs-var">ArchAlpha</span></span><span>     </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">String -&gt; UniqDSMT IO a
forall a. HasCallStack =&gt; String -&gt; a
</span><a href="GHC.Utils.Panic.Plain.html#panic"><span class="hs-identifier hs-var">panic</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;nativeCodeGen: No NCG for Alpha&quot;</span></span><span>
</span><span id="line-151"></span><span>      </span><span class="annot"><span class="annottext">Arch
</span><span class="hs-identifier hs-var">ArchMipseb</span></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">String -&gt; UniqDSMT IO a
forall a. HasCallStack =&gt; String -&gt; a
</span><a href="GHC.Utils.Panic.Plain.html#panic"><span class="hs-identifier hs-var">panic</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;nativeCodeGen: No NCG for mipseb&quot;</span></span><span>
</span><span id="line-152"></span><span>      </span><span class="annot"><span class="annottext">Arch
</span><span class="hs-identifier hs-var">ArchMipsel</span></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">String -&gt; UniqDSMT IO a
forall a. HasCallStack =&gt; String -&gt; a
</span><a href="GHC.Utils.Panic.Plain.html#panic"><span class="hs-identifier hs-var">panic</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;nativeCodeGen: No NCG for mipsel&quot;</span></span><span>
</span><span id="line-153"></span><span>      </span><span class="annot"><span class="annottext">Arch
</span><span class="hs-identifier hs-var">ArchRISCV64</span></span><span>   </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">NcgImpl RawCmmStatics Instr JumpDest -&gt; UniqDSMT IO a
forall statics jumpDest instr.
(OutputableP Platform statics, Outputable jumpDest,
 Instruction instr) =&gt;
NcgImpl statics instr jumpDest -&gt; UniqDSMT IO a
</span><a href="#local-6989586621682882590"><span class="hs-identifier hs-var">nCG'</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">NCGConfig -&gt; NcgImpl RawCmmStatics Instr JumpDest
</span><a href="GHC.CmmToAsm.RV64.html#ncgRV64"><span class="hs-identifier hs-var">RV64.ncgRV64</span></a></span><span> </span><span class="annot"><span class="annottext">NCGConfig
</span><a href="#local-6989586621682882584"><span class="hs-identifier hs-var">config</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-154"></span><span>      </span><span class="annot"><span class="annottext">Arch
</span><span class="hs-identifier hs-var">ArchLoongArch64</span></span><span class="hs-glyph">-&gt;</span><span class="annot"><span class="annottext">String -&gt; UniqDSMT IO a
forall a. HasCallStack =&gt; String -&gt; a
</span><a href="GHC.Utils.Panic.Plain.html#panic"><span class="hs-identifier hs-var">panic</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;nativeCodeGen: No NCG for LoongArch64&quot;</span></span><span>
</span><span id="line-155"></span><span>      </span><span class="annot"><span class="annottext">Arch
</span><span class="hs-identifier hs-var">ArchUnknown</span></span><span>   </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">String -&gt; UniqDSMT IO a
forall a. HasCallStack =&gt; String -&gt; a
</span><a href="GHC.Utils.Panic.Plain.html#panic"><span class="hs-identifier hs-var">panic</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;nativeCodeGen: No NCG for unknown arch&quot;</span></span><span>
</span><span id="line-156"></span><span>      </span><span class="annot"><span class="annottext">Arch
</span><span class="hs-identifier hs-var">ArchJavaScript</span></span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">String -&gt; UniqDSMT IO a
forall a. HasCallStack =&gt; String -&gt; a
</span><a href="GHC.Utils.Panic.Plain.html#panic"><span class="hs-identifier hs-var">panic</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;nativeCodeGen: No NCG for JavaScript&quot;</span></span><span>
</span><span id="line-157"></span><span>      </span><span class="annot"><span class="annottext">Arch
</span><span class="hs-identifier hs-var">ArchWasm32</span></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">NCGConfig
-&gt; Logger
-&gt; Platform
-&gt; ToolSettings
-&gt; ModLocation
-&gt; Handle
-&gt; CgStream RawCmmGroup a
-&gt; UniqDSMT IO a
forall a.
NCGConfig
-&gt; Logger
-&gt; Platform
-&gt; ToolSettings
-&gt; ModLocation
-&gt; Handle
-&gt; CgStream RawCmmGroup a
-&gt; UniqDSMT IO a
</span><a href="GHC.CmmToAsm.Wasm.html#ncgWasm"><span class="hs-identifier hs-var">Wasm32.ncgWasm</span></a></span><span> </span><span class="annot"><span class="annottext">NCGConfig
</span><a href="#local-6989586621682882584"><span class="hs-identifier hs-var">config</span></a></span><span> </span><span class="annot"><span class="annottext">Logger
</span><a href="#local-6989586621682882582"><span class="hs-identifier hs-var">logger</span></a></span><span> </span><span class="annot"><span class="annottext">Platform
</span><a href="#local-6989586621682882588"><span class="hs-identifier hs-var">platform</span></a></span><span> </span><span class="annot"><span class="annottext">ToolSettings
</span><a href="#local-6989586621682882583"><span class="hs-identifier hs-var">ts</span></a></span><span> </span><span class="annot"><span class="annottext">ModLocation
</span><a href="#local-6989586621682882585"><span class="hs-identifier hs-var">modLoc</span></a></span><span> </span><span class="annot"><span class="annottext">Handle
</span><a href="#local-6989586621682882586"><span class="hs-identifier hs-var">h</span></a></span><span> </span><span class="annot"><span class="annottext">CgStream RawCmmGroup a
</span><a href="#local-6989586621682882587"><span class="hs-identifier hs-var">cmms</span></a></span><span>
</span><span id="line-158"></span><span>
</span><span id="line-159"></span><span class="hs-comment">-- | Data accumulated during code generation. Mostly about statistics,</span><span>
</span><span id="line-160"></span><span class="hs-comment">-- but also collects debug data for DWARF generation.</span><span>
</span><span id="line-161"></span><span class="hs-keyword">data</span><span> </span><span id="NativeGenAcc"><span class="annot"><a href="GHC.CmmToAsm.html#NativeGenAcc"><span class="hs-identifier hs-var">NativeGenAcc</span></a></span></span><span> </span><span id="local-6989586621682882103"><span class="annot"><a href="#local-6989586621682882103"><span class="hs-identifier hs-type">statics</span></a></span></span><span> </span><span id="local-6989586621682882104"><span class="annot"><a href="#local-6989586621682882104"><span class="hs-identifier hs-type">instr</span></a></span></span><span>
</span><span id="line-162"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span id="NGS"><span class="annot"><a href="GHC.CmmToAsm.html#NGS"><span class="hs-identifier hs-var">NGS</span></a></span></span><span> </span><span class="hs-special">{</span><span> </span><span id="ngs_imports"><span class="annot"><span class="annottext">forall statics instr. NativeGenAcc statics instr -&gt; [[CLabel]]
</span><a href="GHC.CmmToAsm.html#ngs_imports"><span class="hs-identifier hs-var hs-var">ngs_imports</span></a></span></span><span>     </span><span class="hs-glyph">::</span><span> </span><span class="hs-glyph">!</span><span class="hs-special">[</span><span class="hs-special">[</span><span class="annot"><a href="GHC.Cmm.CLabel.html#CLabel"><span class="hs-identifier hs-type">CLabel</span></a></span><span class="hs-special">]</span><span class="hs-special">]</span><span>
</span><span id="line-163"></span><span>        </span><span class="hs-special">,</span><span> </span><span id="ngs_natives"><span class="annot"><span class="annottext">forall statics instr.
NativeGenAcc statics instr -&gt; [[NatCmmDecl statics instr]]
</span><a href="GHC.CmmToAsm.html#ngs_natives"><span class="hs-identifier hs-var hs-var">ngs_natives</span></a></span></span><span>     </span><span class="hs-glyph">::</span><span> </span><span class="hs-glyph">!</span><span class="hs-special">[</span><span class="hs-special">[</span><span class="annot"><a href="GHC.CmmToAsm.Types.html#NatCmmDecl"><span class="hs-identifier hs-type">NatCmmDecl</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682882103"><span class="hs-identifier hs-type">statics</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682882104"><span class="hs-identifier hs-type">instr</span></a></span><span class="hs-special">]</span><span class="hs-special">]</span><span>
</span><span id="line-164"></span><span>             </span><span class="hs-comment">-- ^ Native code generated, for statistics. This might</span><span>
</span><span id="line-165"></span><span>             </span><span class="hs-comment">-- hold a lot of data, so it is important to clear this</span><span>
</span><span id="line-166"></span><span>             </span><span class="hs-comment">-- field as early as possible if it isn't actually</span><span>
</span><span id="line-167"></span><span>             </span><span class="hs-comment">-- required.</span><span>
</span><span id="line-168"></span><span>        </span><span class="hs-special">,</span><span> </span><span id="ngs_colorStats"><span class="annot"><span class="annottext">forall statics instr.
NativeGenAcc statics instr -&gt; [[RegAllocStats statics instr]]
</span><a href="GHC.CmmToAsm.html#ngs_colorStats"><span class="hs-identifier hs-var hs-var">ngs_colorStats</span></a></span></span><span>  </span><span class="hs-glyph">::</span><span> </span><span class="hs-glyph">!</span><span class="hs-special">[</span><span class="hs-special">[</span><span class="annot"><a href="GHC.CmmToAsm.Reg.Graph.Stats.html#RegAllocStats"><span class="hs-identifier hs-type">Color.RegAllocStats</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682882103"><span class="hs-identifier hs-type">statics</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682882104"><span class="hs-identifier hs-type">instr</span></a></span><span class="hs-special">]</span><span class="hs-special">]</span><span>
</span><span id="line-169"></span><span>        </span><span class="hs-special">,</span><span> </span><span id="ngs_linearStats"><span class="annot"><span class="annottext">forall statics instr.
NativeGenAcc statics instr -&gt; [[RegAllocStats]]
</span><a href="GHC.CmmToAsm.html#ngs_linearStats"><span class="hs-identifier hs-var hs-var">ngs_linearStats</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-glyph">!</span><span class="hs-special">[</span><span class="hs-special">[</span><span class="annot"><a href="GHC.CmmToAsm.Reg.Linear.Base.html#RegAllocStats"><span class="hs-identifier hs-type">Linear.RegAllocStats</span></a></span><span class="hs-special">]</span><span class="hs-special">]</span><span>
</span><span id="line-170"></span><span>        </span><span class="hs-special">,</span><span> </span><span id="ngs_labels"><span class="annot"><span class="annottext">forall statics instr. NativeGenAcc statics instr -&gt; [Label]
</span><a href="GHC.CmmToAsm.html#ngs_labels"><span class="hs-identifier hs-var hs-var">ngs_labels</span></a></span></span><span>      </span><span class="hs-glyph">::</span><span> </span><span class="hs-glyph">!</span><span class="hs-special">[</span><span class="annot"><a href="GHC.Cmm.Dataflow.Label.html#Label"><span class="hs-identifier hs-type">Label</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-171"></span><span>        </span><span class="hs-special">,</span><span> </span><span id="ngs_debug"><span class="annot"><span class="annottext">forall statics instr. NativeGenAcc statics instr -&gt; [DebugBlock]
</span><a href="GHC.CmmToAsm.html#ngs_debug"><span class="hs-identifier hs-var hs-var">ngs_debug</span></a></span></span><span>       </span><span class="hs-glyph">::</span><span> </span><span class="hs-glyph">!</span><span class="hs-special">[</span><span class="annot"><a href="GHC.Cmm.DebugBlock.html#DebugBlock"><span class="hs-identifier hs-type">DebugBlock</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-172"></span><span>        </span><span class="hs-special">,</span><span> </span><span id="ngs_dwarfFiles"><span class="annot"><span class="annottext">forall statics instr. NativeGenAcc statics instr -&gt; DwarfFiles
</span><a href="GHC.CmmToAsm.html#ngs_dwarfFiles"><span class="hs-identifier hs-var hs-var">ngs_dwarfFiles</span></a></span></span><span>  </span><span class="hs-glyph">::</span><span> </span><span class="hs-glyph">!</span><span class="annot"><a href="GHC.CmmToAsm.Monad.html#DwarfFiles"><span class="hs-identifier hs-type">DwarfFiles</span></a></span><span>
</span><span id="line-173"></span><span>        </span><span class="hs-special">,</span><span> </span><span id="ngs_unwinds"><span class="annot"><span class="annottext">forall statics instr.
NativeGenAcc statics instr -&gt; LabelMap [UnwindPoint]
</span><a href="GHC.CmmToAsm.html#ngs_unwinds"><span class="hs-identifier hs-var hs-var">ngs_unwinds</span></a></span></span><span>     </span><span class="hs-glyph">::</span><span> </span><span class="hs-glyph">!</span><span class="hs-special">(</span><span class="annot"><a href="GHC.Cmm.Dataflow.Label.html#LabelMap"><span class="hs-identifier hs-type">LabelMap</span></a></span><span> </span><span class="hs-special">[</span><span class="annot"><a href="GHC.Cmm.DebugBlock.html#UnwindPoint"><span class="hs-identifier hs-type">UnwindPoint</span></a></span><span class="hs-special">]</span><span class="hs-special">)</span><span>
</span><span id="line-174"></span><span>             </span><span class="hs-comment">-- ^ see Note [Unwinding information in the NCG]</span><span>
</span><span id="line-175"></span><span>             </span><span class="hs-comment">-- and Note [What is this unwinding business?] in &quot;GHC.Cmm.DebugBlock&quot;.</span><span>
</span><span id="line-176"></span><span>        </span><span class="hs-special">}</span><span>
</span><span id="line-177"></span><span>
</span><span id="line-178"></span><span class="hs-comment">{-
Note [Unwinding information in the NCG]
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
Unwind information is a type of metadata which allows a debugging tool
to reconstruct the values of machine registers at the time a procedure was
entered. For the most part, the production of unwind information is handled by
the Cmm stage, where it is represented by CmmUnwind nodes.

Unfortunately, the Cmm stage doesn't know everything necessary to produce
accurate unwinding information. For instance, the x86-64 calling convention
requires that the stack pointer be aligned to 16 bytes, which in turn means that
GHC must sometimes add padding to $sp prior to performing a foreign call. When
this happens unwind information must be updated accordingly.
For this reason, we make the NCG backends responsible for producing
unwinding tables (with the extractUnwindPoints function in NcgImpl).

We accumulate the produced unwind tables over CmmGroups in the ngs_unwinds
field of NativeGenAcc. This is a label map which contains an entry for each
procedure, containing a list of unwinding points (e.g. a label and an associated
unwinding table).

See also Note [What is this unwinding business?] in &quot;GHC.Cmm.DebugBlock&quot;.
-}</span><span>
</span><span id="line-201"></span><span>
</span><span id="line-202"></span><span id="local-6989586621682882095"><span id="local-6989586621682882096"><span id="local-6989586621682882097"><span id="local-6989586621682882098"><span class="annot"><a href="GHC.CmmToAsm.html#nativeCodeGen%27"><span class="hs-identifier hs-type">nativeCodeGen'</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Utils.Outputable.html#OutputableP"><span class="hs-identifier hs-type">OutputableP</span></a></span><span> </span><span class="annot"><a href="GHC.Platform.html#Platform"><span class="hs-identifier hs-type">Platform</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682882095"><span class="hs-identifier hs-type">statics</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Utils.Outputable.html#Outputable"><span class="hs-identifier hs-type">Outputable</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682882096"><span class="hs-identifier hs-type">jumpDest</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.CmmToAsm.Instr.html#Instruction"><span class="hs-identifier hs-type">Instruction</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682882097"><span class="hs-identifier hs-type">instr</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-203"></span><span>               </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="GHC.Utils.Logger.html#Logger"><span class="hs-identifier hs-type">Logger</span></a></span><span>
</span><span id="line-204"></span><span>               </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.CmmToAsm.Config.html#NCGConfig"><span class="hs-identifier hs-type">NCGConfig</span></a></span><span>
</span><span id="line-205"></span><span>               </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Unit.Module.Location.html#ModLocation"><span class="hs-identifier hs-type">ModLocation</span></a></span><span>
</span><span id="line-206"></span><span>               </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.CmmToAsm.Monad.html#NcgImpl"><span class="hs-identifier hs-type">NcgImpl</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682882095"><span class="hs-identifier hs-type">statics</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682882097"><span class="hs-identifier hs-type">instr</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682882096"><span class="hs-identifier hs-type">jumpDest</span></a></span><span>
</span><span id="line-207"></span><span>               </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Handle</span></span><span>
</span><span id="line-208"></span><span>               </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.StgToCmm.CgUtils.html#CgStream"><span class="hs-identifier hs-type">CgStream</span></a></span><span> </span><span class="annot"><a href="GHC.Cmm.html#RawCmmGroup"><span class="hs-identifier hs-type">RawCmmGroup</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682882098"><span class="hs-identifier hs-type">a</span></a></span><span>
</span><span id="line-209"></span><span>               </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Types.Unique.DSM.html#UniqDSMT"><span class="hs-identifier hs-type">UniqDSMT</span></a></span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="annot"><a href="#local-6989586621682882098"><span class="hs-identifier hs-type">a</span></a></span></span></span></span></span><span>
</span><span id="line-210"></span><span id="nativeCodeGen%27"><span class="annot"><span class="annottext">nativeCodeGen' :: forall statics jumpDest instr a.
(OutputableP Platform statics, Outputable jumpDest,
 Instruction instr) =&gt;
Logger
-&gt; NCGConfig
-&gt; ModLocation
-&gt; NcgImpl statics instr jumpDest
-&gt; Handle
-&gt; CgStream RawCmmGroup a
-&gt; UniqDSMT IO a
</span><a href="GHC.CmmToAsm.html#nativeCodeGen%27"><span class="hs-identifier hs-var hs-var">nativeCodeGen'</span></a></span></span><span> </span><span id="local-6989586621682882647"><span class="annot"><span class="annottext">Logger
</span><a href="#local-6989586621682882647"><span class="hs-identifier hs-var">logger</span></a></span></span><span> </span><span id="local-6989586621682882648"><span class="annot"><span class="annottext">NCGConfig
</span><a href="#local-6989586621682882648"><span class="hs-identifier hs-var">config</span></a></span></span><span> </span><span id="local-6989586621682882649"><span class="annot"><span class="annottext">ModLocation
</span><a href="#local-6989586621682882649"><span class="hs-identifier hs-var">modLoc</span></a></span></span><span> </span><span id="local-6989586621682882650"><span class="annot"><span class="annottext">NcgImpl statics instr jumpDest
</span><a href="#local-6989586621682882650"><span class="hs-identifier hs-var">ncgImpl</span></a></span></span><span> </span><span id="local-6989586621682882651"><span class="annot"><span class="annottext">Handle
</span><a href="#local-6989586621682882651"><span class="hs-identifier hs-var">h</span></a></span></span><span> </span><span id="local-6989586621682882652"><span class="annot"><span class="annottext">CgStream RawCmmGroup a
</span><a href="#local-6989586621682882652"><span class="hs-identifier hs-var">cmms</span></a></span></span><span>
</span><span id="line-211"></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-212"></span><span>        </span><span class="hs-comment">-- BufHandle is a performance hack.  We could hide it inside</span><span>
</span><span id="line-213"></span><span>        </span><span class="hs-comment">-- Pretty if it weren't for the fact that we do lots of little</span><span>
</span><span id="line-214"></span><span>        </span><span class="hs-comment">-- printDocs here (in order to do codegen in constant space).</span><span>
</span><span id="line-215"></span><span>        </span><span id="local-6989586621682882653"><span class="annot"><a href="#local-6989586621682882653"><span class="hs-identifier hs-var">bufh</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">IO BufHandle -&gt; UniqDSMT IO BufHandle
forall a. IO a -&gt; UniqDSMT IO a
forall (m :: * -&gt; *) a. MonadIO m =&gt; IO a -&gt; m a
</span><span class="hs-identifier hs-var">liftIO</span></span><span> </span><span class="annot"><span class="annottext">(IO BufHandle -&gt; UniqDSMT IO BufHandle)
-&gt; IO BufHandle -&gt; UniqDSMT IO BufHandle
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Handle -&gt; IO BufHandle
</span><a href="GHC.Utils.BufHandle.html#newBufHandle"><span class="hs-identifier hs-var">newBufHandle</span></a></span><span> </span><span class="annot"><span class="annottext">Handle
</span><a href="#local-6989586621682882651"><span class="hs-identifier hs-var">h</span></a></span><span>
</span><span id="line-216"></span><span>        </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621682882655"><span class="annot"><a href="#local-6989586621682882655"><span class="hs-identifier hs-var hs-var">ngs0</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[[CLabel]]
-&gt; [[NatCmmDecl statics instr]]
-&gt; [[RegAllocStats statics instr]]
-&gt; [[RegAllocStats]]
-&gt; [Label]
-&gt; [DebugBlock]
-&gt; DwarfFiles
-&gt; LabelMap [UnwindPoint]
-&gt; NativeGenAcc statics instr
forall statics instr.
[[CLabel]]
-&gt; [[NatCmmDecl statics instr]]
-&gt; [[RegAllocStats statics instr]]
-&gt; [[RegAllocStats]]
-&gt; [Label]
-&gt; [DebugBlock]
-&gt; DwarfFiles
-&gt; LabelMap [UnwindPoint]
-&gt; NativeGenAcc statics instr
</span><a href="GHC.CmmToAsm.html#NGS"><span class="hs-identifier hs-var">NGS</span></a></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><span class="annot"><span class="annottext">DwarfFiles
forall {k} (key :: k) elt. UniqFM key elt
</span><a href="GHC.Types.Unique.FM.html#emptyUFM"><span class="hs-identifier hs-var">emptyUFM</span></a></span><span> </span><span class="annot"><span class="annottext">LabelMap [UnwindPoint]
forall v. LabelMap v
</span><a href="GHC.Cmm.Dataflow.Label.html#mapEmpty"><span class="hs-identifier hs-var">mapEmpty</span></a></span><span>
</span><span id="line-217"></span><span>        </span><span class="hs-special">(</span><span id="local-6989586621682882658"><span class="annot"><a href="#local-6989586621682882658"><span class="hs-identifier hs-var">ngs</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682882659"><span class="annot"><a href="#local-6989586621682882659"><span class="hs-identifier hs-var">a</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><a href="GHC.CmmToAsm.html#cmmNativeGenStream"><span class="hs-identifier hs-type">cmmNativeGenStream</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682882647"><span class="hs-identifier hs-type">logger</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682882648"><span class="hs-identifier hs-type">config</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682882649"><span class="hs-identifier hs-type">modLoc</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682882650"><span class="hs-identifier hs-type">ncgImpl</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682882653"><span class="hs-identifier hs-type">bufh</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682882652"><span class="hs-identifier hs-type">cmms</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682882655"><span class="hs-identifier hs-type">ngs0</span></a></span><span>
</span><span id="line-218"></span><span>        </span><span class="annot"><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><a href="GHC.CmmToAsm.html#finishNativeGen"><span class="hs-identifier hs-type">finishNativeGen</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682882647"><span class="hs-identifier hs-type">logger</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682882648"><span class="hs-identifier hs-type">config</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682882649"><span class="hs-identifier hs-type">modLoc</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682882653"><span class="hs-identifier hs-type">bufh</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682882658"><span class="hs-identifier hs-type">ngs</span></a></span><span>
</span><span id="line-219"></span><span>        </span><span class="annot"><span class="hs-identifier hs-type">return</span></span><span> </span><span class="annot"><a href="#local-6989586621682882659"><span class="hs-identifier hs-type">a</span></a></span><span>
</span><span id="line-220"></span><span>
</span><span id="line-221"></span><span id="local-6989586621682882156"><span id="local-6989586621682882157"><span class="annot"><a href="GHC.CmmToAsm.html#finishNativeGen"><span class="hs-identifier hs-type">finishNativeGen</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.CmmToAsm.Instr.html#Instruction"><span class="hs-identifier hs-type">Instruction</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682882156"><span class="hs-identifier hs-type">instr</span></a></span><span>
</span><span id="line-222"></span><span>                </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="GHC.Utils.Logger.html#Logger"><span class="hs-identifier hs-type">Logger</span></a></span><span>
</span><span id="line-223"></span><span>                </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.CmmToAsm.Config.html#NCGConfig"><span class="hs-identifier hs-type">NCGConfig</span></a></span><span>
</span><span id="line-224"></span><span>                </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Unit.Module.Location.html#ModLocation"><span class="hs-identifier hs-type">ModLocation</span></a></span><span>
</span><span id="line-225"></span><span>                </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Utils.BufHandle.html#BufHandle"><span class="hs-identifier hs-type">BufHandle</span></a></span><span>
</span><span id="line-226"></span><span>                </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.CmmToAsm.html#NativeGenAcc"><span class="hs-identifier hs-type">NativeGenAcc</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682882157"><span class="hs-identifier hs-type">statics</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682882156"><span class="hs-identifier hs-type">instr</span></a></span><span>
</span><span id="line-227"></span><span>                </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Types.Unique.DSM.html#UniqDSMT"><span class="hs-identifier hs-type">UniqDSMT</span></a></span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span></span></span><span>
</span><span id="line-228"></span><span id="finishNativeGen"><span class="annot"><span class="annottext">finishNativeGen :: forall instr statics.
Instruction instr =&gt;
Logger
-&gt; NCGConfig
-&gt; ModLocation
-&gt; BufHandle
-&gt; NativeGenAcc statics instr
-&gt; UniqDSMT IO ()
</span><a href="GHC.CmmToAsm.html#finishNativeGen"><span class="hs-identifier hs-var hs-var">finishNativeGen</span></a></span></span><span> </span><span id="local-6989586621682882700"><span class="annot"><span class="annottext">Logger
</span><a href="#local-6989586621682882700"><span class="hs-identifier hs-var">logger</span></a></span></span><span> </span><span id="local-6989586621682882701"><span class="annot"><span class="annottext">NCGConfig
</span><a href="#local-6989586621682882701"><span class="hs-identifier hs-var">config</span></a></span></span><span> </span><span id="local-6989586621682882702"><span class="annot"><span class="annottext">ModLocation
</span><a href="#local-6989586621682882702"><span class="hs-identifier hs-var">modLoc</span></a></span></span><span> </span><span id="local-6989586621682882703"><span class="annot"><span class="annottext">BufHandle
</span><a href="#local-6989586621682882703"><span class="hs-identifier hs-var">bufh</span></a></span></span><span> </span><span id="local-6989586621682882704"><span class="annot"><span class="annottext">NativeGenAcc statics instr
</span><a href="#local-6989586621682882704"><span class="hs-identifier hs-var">ngs</span></a></span></span><span>
</span><span id="line-229"></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Logger -&gt; SDoc -&gt; (() -&gt; ()) -&gt; UniqDSMT IO () -&gt; UniqDSMT IO ()
forall (m :: * -&gt; *) a.
MonadIO m =&gt;
Logger -&gt; SDoc -&gt; (a -&gt; ()) -&gt; m a -&gt; m a
</span><a href="GHC.Utils.Error.html#withTimingSilent"><span class="hs-identifier hs-var">withTimingSilent</span></a></span><span> </span><span class="annot"><span class="annottext">Logger
</span><a href="#local-6989586621682882700"><span class="hs-identifier hs-var">logger</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">String -&gt; SDoc
forall doc. IsLine doc =&gt; String -&gt; doc
</span><a href="GHC.Utils.Outputable.html#text"><span class="hs-identifier hs-var">text</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;NCG&quot;</span></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">() -&gt; () -&gt; ()
forall a b. a -&gt; b -&gt; b
</span><span class="hs-operator hs-var">`seq`</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(UniqDSMT IO () -&gt; UniqDSMT IO ())
-&gt; UniqDSMT IO () -&gt; UniqDSMT IO ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-230"></span><span>      </span><span class="hs-comment">-- Write debug data and finish</span><span>
</span><span id="line-231"></span><span>      </span><span class="hs-keyword">if</span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Bool
</span><span class="hs-identifier hs-var">not</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">NCGConfig -&gt; Bool
</span><a href="GHC.CmmToAsm.Config.html#ncgDwarfEnabled"><span class="hs-identifier hs-var">ncgDwarfEnabled</span></a></span><span> </span><span class="annot"><span class="annottext">NCGConfig
</span><a href="#local-6989586621682882701"><span class="hs-identifier hs-var">config</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-232"></span><span>        </span><span class="hs-keyword">then</span><span> </span><span class="annot"><span class="annottext">() -&gt; UniqDSMT IO ()
forall a. a -&gt; UniqDSMT IO a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-233"></span><span>        </span><span class="hs-keyword">else</span><span> </span><span class="annot"><span class="annottext">(DUniqSupply -&gt; IO ((), DUniqSupply)) -&gt; UniqDSMT IO ()
forall a. (DUniqSupply -&gt; IO (a, DUniqSupply)) -&gt; UniqDSMT IO a
</span><a href="GHC.Types.Unique.DSM.html#withDUS"><span class="hs-identifier hs-var">withDUS</span></a></span><span> </span><span class="annot"><span class="annottext">((DUniqSupply -&gt; IO ((), DUniqSupply)) -&gt; UniqDSMT IO ())
-&gt; (DUniqSupply -&gt; IO ((), DUniqSupply)) -&gt; UniqDSMT IO ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-glyph">\</span><span id="local-6989586621682882710"><span class="annot"><span class="annottext">DUniqSupply
</span><a href="#local-6989586621682882710"><span class="hs-identifier hs-var">us</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-234"></span><span>           </span><span id="local-6989586621682882711"><span class="annot"><a href="#local-6989586621682882711"><span class="hs-identifier hs-var">compPath</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">IO String
</span><a href="../../directory-1.3.9.0-af18/src/System.Directory.html#getCurrentDirectory"><span class="hs-identifier hs-var">getCurrentDirectory</span></a></span><span>
</span><span id="line-235"></span><span>           </span><span class="hs-keyword">let</span><span> </span><span class="hs-special">(</span><span id="local-6989586621682882712"><span class="annot"><a href="#local-6989586621682882712"><span class="hs-identifier hs-var">dwarf_h</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682882713"><span class="annot"><a href="#local-6989586621682882713"><span class="hs-identifier hs-var">us'</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="GHC.CmmToAsm.Dwarf.html#dwarfGen"><span class="hs-identifier hs-type">dwarfGen</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682882711"><span class="hs-identifier hs-type">compPath</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682882701"><span class="hs-identifier hs-type">config</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682882702"><span class="hs-identifier hs-type">modLoc</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682882710"><span class="hs-identifier hs-type">us</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.CmmToAsm.html#ngs_debug"><span class="hs-identifier hs-var">ngs_debug</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682882704"><span class="hs-identifier hs-type">ngs</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-236"></span><span>               </span><span class="hs-special">(</span><span id="local-6989586621682882715"><span class="annot"><a href="#local-6989586621682882715"><span class="hs-identifier hs-var">dwarf_s</span></a></span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span>   </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="GHC.CmmToAsm.Dwarf.html#dwarfGen"><span class="hs-identifier hs-type">dwarfGen</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682882711"><span class="hs-identifier hs-type">compPath</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682882701"><span class="hs-identifier hs-type">config</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682882702"><span class="hs-identifier hs-type">modLoc</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682882710"><span class="hs-identifier hs-type">us</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.CmmToAsm.html#ngs_debug"><span class="hs-identifier hs-var">ngs_debug</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682882704"><span class="hs-identifier hs-type">ngs</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-237"></span><span>           </span><span class="annot"><a href="GHC.CmmToAsm.html#emitNativeCode"><span class="hs-identifier hs-type">emitNativeCode</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682882700"><span class="hs-identifier hs-type">logger</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682882701"><span class="hs-identifier hs-type">config</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682882703"><span class="hs-identifier hs-type">bufh</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682882712"><span class="hs-identifier hs-type">dwarf_h</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682882715"><span class="hs-identifier hs-type">dwarf_s</span></a></span><span>
</span><span id="line-238"></span><span>           </span><span class="annot"><span class="hs-identifier hs-type">return</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">(</span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="annot"><a href="#local-6989586621682882713"><span class="hs-identifier hs-type">us'</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-239"></span><span>      </span><span class="annot"><span class="annottext">IO () -&gt; UniqDSMT IO ()
forall a. IO a -&gt; UniqDSMT IO a
forall (m :: * -&gt; *) a. MonadIO m =&gt; IO a -&gt; m a
</span><span class="hs-identifier hs-var">liftIO</span></span><span> </span><span class="annot"><span class="annottext">(IO () -&gt; UniqDSMT IO ()) -&gt; IO () -&gt; UniqDSMT IO ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-240"></span><span>
</span><span id="line-241"></span><span>        </span><span class="hs-comment">-- dump global NCG stats for graph coloring allocator</span><span>
</span><span id="line-242"></span><span>        </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621682882717"><span class="annot"><span class="annottext">stats :: [RegAllocStats statics instr]
</span><a href="#local-6989586621682882717"><span class="hs-identifier hs-var hs-var hs-var">stats</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[[RegAllocStats statics instr]] -&gt; [RegAllocStats statics instr]
forall (t :: * -&gt; *) a. Foldable t =&gt; t [a] -&gt; [a]
</span><span class="hs-identifier hs-var">concat</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">NativeGenAcc statics instr -&gt; [[RegAllocStats statics instr]]
forall statics instr.
NativeGenAcc statics instr -&gt; [[RegAllocStats statics instr]]
</span><a href="GHC.CmmToAsm.html#ngs_colorStats"><span class="hs-identifier hs-var">ngs_colorStats</span></a></span><span> </span><span class="annot"><span class="annottext">NativeGenAcc statics instr
</span><a href="#local-6989586621682882704"><span class="hs-identifier hs-var">ngs</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-243"></span><span>            </span><span id="local-6989586621682882719"><span class="annot"><span class="annottext">platform :: Platform
</span><a href="#local-6989586621682882719"><span class="hs-identifier hs-var hs-var hs-var">platform</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">NCGConfig -&gt; Platform
</span><a href="GHC.CmmToAsm.Config.html#ncgPlatform"><span class="hs-identifier hs-var">ncgPlatform</span></a></span><span> </span><span class="annot"><span class="annottext">NCGConfig
</span><a href="#local-6989586621682882701"><span class="hs-identifier hs-var">config</span></a></span><span>
</span><span id="line-244"></span><span>        </span><span class="annot"><span class="annottext">Bool -&gt; IO () -&gt; IO ()
forall (f :: * -&gt; *). Applicative f =&gt; Bool -&gt; f () -&gt; f ()
</span><span class="hs-identifier hs-var">unless</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[RegAllocStats statics instr] -&gt; Bool
forall a. [a] -&gt; Bool
forall (t :: * -&gt; *) a. Foldable t =&gt; t a -&gt; Bool
</span><span class="hs-identifier hs-var">null</span></span><span> </span><span class="annot"><span class="annottext">[RegAllocStats statics instr]
</span><a href="#local-6989586621682882717"><span class="hs-identifier hs-var">stats</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(IO () -&gt; IO ()) -&gt; IO () -&gt; IO ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-245"></span><span>
</span><span id="line-246"></span><span>          </span><span class="hs-comment">-- build the global register conflict graph</span><span>
</span><span id="line-247"></span><span>          </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621682882722"><span class="annot"><span class="annottext">graphGlobal :: Graph VirtualReg RegClass RealReg
</span><a href="#local-6989586621682882722"><span class="hs-identifier hs-var hs-var hs-var">graphGlobal</span></a></span></span><span>
</span><span id="line-248"></span><span>                  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(Graph VirtualReg RegClass RealReg
 -&gt; Graph VirtualReg RegClass RealReg
 -&gt; Graph VirtualReg RegClass RealReg)
-&gt; Graph VirtualReg RegClass RealReg
-&gt; [Graph VirtualReg RegClass RealReg]
-&gt; Graph VirtualReg RegClass RealReg
forall b a. (b -&gt; a -&gt; b) -&gt; b -&gt; [a] -&gt; b
forall (t :: * -&gt; *) b a.
Foldable t =&gt;
(b -&gt; a -&gt; b) -&gt; b -&gt; t a -&gt; b
</span><span class="hs-identifier hs-var">foldl'</span></span><span> </span><span class="annot"><span class="annottext">Graph VirtualReg RegClass RealReg
-&gt; Graph VirtualReg RegClass RealReg
-&gt; Graph VirtualReg RegClass RealReg
forall k cls color.
Graph k cls color -&gt; Graph k cls color -&gt; Graph k cls color
</span><a href="GHC.Data.Graph.Ops.html#union"><span class="hs-identifier hs-var">Color.union</span></a></span><span> </span><span class="annot"><span class="annottext">Graph VirtualReg RegClass RealReg
forall k cls color. Graph k cls color
</span><a href="GHC.Data.Graph.Base.html#initGraph"><span class="hs-identifier hs-var">Color.initGraph</span></a></span><span>
</span><span id="line-249"></span><span>                  </span><span class="annot"><span class="annottext">([Graph VirtualReg RegClass RealReg]
 -&gt; Graph VirtualReg RegClass RealReg)
-&gt; [Graph VirtualReg RegClass RealReg]
-&gt; Graph VirtualReg RegClass RealReg
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">RegAllocStats statics instr -&gt; Graph VirtualReg RegClass RealReg
forall statics instr.
RegAllocStats statics instr -&gt; Graph VirtualReg RegClass RealReg
</span><a href="GHC.CmmToAsm.Reg.Graph.Stats.html#raGraph"><span class="hs-identifier hs-var">Color.raGraph</span></a></span><span> </span><span class="annot"><span class="annottext">RegAllocStats statics instr
</span><a href="#local-6989586621682882727"><span class="hs-identifier hs-var">stat</span></a></span><span>
</span><span id="line-250"></span><span>                          </span><span class="hs-glyph">|</span><span> </span><span id="local-6989586621682882727"><span class="annot"><span class="annottext">stat :: RegAllocStats statics instr
</span><a href="#local-6989586621682882727"><span class="hs-identifier hs-var">stat</span></a></span></span><span class="hs-glyph">@</span><span class="annot"><a href="GHC.CmmToAsm.Reg.Graph.Stats.html#RegAllocStatsStart"><span class="hs-identifier hs-type">Color.RegAllocStatsStart</span></a></span><span class="hs-special">{</span><span class="hs-special">}</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">[RegAllocStats statics instr]
</span><a href="#local-6989586621682882717"><span class="hs-identifier hs-var">stats</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-251"></span><span>
</span><span id="line-252"></span><span>          </span><span class="annot"><span class="annottext">SDoc -&gt; IO ()
</span><a href="#local-6989586621682882729"><span class="hs-identifier hs-var">dump_stats</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[RegAllocStats statics instr]
-&gt; Graph VirtualReg RegClass RealReg -&gt; SDoc
forall statics instr.
[RegAllocStats statics instr]
-&gt; Graph VirtualReg RegClass RealReg -&gt; SDoc
</span><a href="GHC.CmmToAsm.Reg.Graph.Stats.html#pprStats"><span class="hs-identifier hs-var">Color.pprStats</span></a></span><span> </span><span class="annot"><span class="annottext">[RegAllocStats statics instr]
</span><a href="#local-6989586621682882717"><span class="hs-identifier hs-var">stats</span></a></span><span> </span><span class="annot"><span class="annottext">Graph VirtualReg RegClass RealReg
</span><a href="#local-6989586621682882722"><span class="hs-identifier hs-var">graphGlobal</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-253"></span><span>
</span><span id="line-254"></span><span>
</span><span id="line-255"></span><span>          </span><span class="annot"><span class="annottext">Logger -&gt; DumpFlag -&gt; String -&gt; DumpFormat -&gt; SDoc -&gt; IO ()
</span><a href="GHC.Utils.Logger.html#putDumpFileMaybe"><span class="hs-identifier hs-var">putDumpFileMaybe</span></a></span><span> </span><span class="annot"><span class="annottext">Logger
</span><a href="#local-6989586621682882700"><span class="hs-identifier hs-var">logger</span></a></span><span>
</span><span id="line-256"></span><span>                  </span><span class="annot"><span class="annottext">DumpFlag
</span><a href="GHC.Driver.Flags.html#Opt_D_dump_asm_conflicts"><span class="hs-identifier hs-var">Opt_D_dump_asm_conflicts</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;Register conflict graph&quot;</span></span><span>
</span><span id="line-257"></span><span>                  </span><span class="annot"><span class="annottext">DumpFormat
</span><a href="GHC.Utils.Logger.html#FormatText"><span class="hs-identifier hs-var">FormatText</span></a></span><span>
</span><span id="line-258"></span><span>                  </span><span class="annot"><span class="annottext">(SDoc -&gt; IO ()) -&gt; SDoc -&gt; IO ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">(RealReg -&gt; SDoc)
-&gt; Triv VirtualReg RegClass RealReg
-&gt; Graph VirtualReg RegClass RealReg
-&gt; SDoc
forall k cls color.
(Uniquable k, Outputable k, Outputable cls, Outputable color) =&gt;
(color -&gt; SDoc) -&gt; Triv k cls color -&gt; Graph k cls color -&gt; SDoc
</span><a href="GHC.Data.Graph.Ppr.html#dotGraph"><span class="hs-identifier hs-var">Color.dotGraph</span></a></span><span>
</span><span id="line-259"></span><span>                          </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Platform -&gt; RealReg -&gt; SDoc
</span><a href="GHC.CmmToAsm.Reg.Target.html#targetRegDotColor"><span class="hs-identifier hs-var">targetRegDotColor</span></a></span><span> </span><span class="annot"><span class="annottext">Platform
</span><a href="#local-6989586621682882719"><span class="hs-identifier hs-var">platform</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-260"></span><span>                          </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Platform
-&gt; (RegClass -&gt; VirtualReg -&gt; Int)
-&gt; (RegClass -&gt; RealReg -&gt; Int)
-&gt; Triv VirtualReg RegClass RealReg
</span><a href="GHC.CmmToAsm.Reg.Graph.TrivColorable.html#trivColorable"><span class="hs-identifier hs-var">Color.trivColorable</span></a></span><span> </span><span class="annot"><span class="annottext">Platform
</span><a href="#local-6989586621682882719"><span class="hs-identifier hs-var">platform</span></a></span><span>
</span><span id="line-261"></span><span>                                  </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Platform -&gt; RegClass -&gt; VirtualReg -&gt; Int
</span><a href="GHC.CmmToAsm.Reg.Target.html#targetVirtualRegSqueeze"><span class="hs-identifier hs-var">targetVirtualRegSqueeze</span></a></span><span> </span><span class="annot"><span class="annottext">Platform
</span><a href="#local-6989586621682882719"><span class="hs-identifier hs-var">platform</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-262"></span><span>                                  </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Platform -&gt; RegClass -&gt; RealReg -&gt; Int
</span><a href="GHC.CmmToAsm.Reg.Target.html#targetRealRegSqueeze"><span class="hs-identifier hs-var">targetRealRegSqueeze</span></a></span><span> </span><span class="annot"><span class="annottext">Platform
</span><a href="#local-6989586621682882719"><span class="hs-identifier hs-var">platform</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-263"></span><span>                  </span><span class="annot"><span class="annottext">(Graph VirtualReg RegClass RealReg -&gt; SDoc)
-&gt; Graph VirtualReg RegClass RealReg -&gt; SDoc
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Graph VirtualReg RegClass RealReg
</span><a href="#local-6989586621682882722"><span class="hs-identifier hs-var">graphGlobal</span></a></span><span>
</span><span id="line-264"></span><span>
</span><span id="line-265"></span><span>
</span><span id="line-266"></span><span>        </span><span class="hs-comment">-- dump global NCG stats for linear allocator</span><span>
</span><span id="line-267"></span><span>        </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621682882739"><span class="annot"><span class="annottext">linearStats :: [RegAllocStats]
</span><a href="#local-6989586621682882739"><span class="hs-identifier hs-var hs-var hs-var">linearStats</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[[RegAllocStats]] -&gt; [RegAllocStats]
forall (t :: * -&gt; *) a. Foldable t =&gt; t [a] -&gt; [a]
</span><span class="hs-identifier hs-var">concat</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">NativeGenAcc statics instr -&gt; [[RegAllocStats]]
forall statics instr.
NativeGenAcc statics instr -&gt; [[RegAllocStats]]
</span><a href="GHC.CmmToAsm.html#ngs_linearStats"><span class="hs-identifier hs-var">ngs_linearStats</span></a></span><span> </span><span class="annot"><span class="annottext">NativeGenAcc statics instr
</span><a href="#local-6989586621682882704"><span class="hs-identifier hs-var">ngs</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-268"></span><span>        </span><span class="annot"><span class="annottext">Bool -&gt; IO () -&gt; IO ()
forall (f :: * -&gt; *). Applicative f =&gt; Bool -&gt; f () -&gt; f ()
</span><span class="hs-identifier hs-var">unless</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[RegAllocStats] -&gt; Bool
forall a. [a] -&gt; Bool
forall (t :: * -&gt; *) a. Foldable t =&gt; t a -&gt; Bool
</span><span class="hs-identifier hs-var">null</span></span><span> </span><span class="annot"><span class="annottext">[RegAllocStats]
</span><a href="#local-6989586621682882739"><span class="hs-identifier hs-var">linearStats</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(IO () -&gt; IO ()) -&gt; IO () -&gt; IO ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-269"></span><span>          </span><span class="annot"><span class="annottext">SDoc -&gt; IO ()
</span><a href="#local-6989586621682882729"><span class="hs-identifier hs-var">dump_stats</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Platform -&gt; [NatCmmDecl statics instr] -&gt; [RegAllocStats] -&gt; SDoc
forall instr statics.
Instruction instr =&gt;
Platform -&gt; [NatCmmDecl statics instr] -&gt; [RegAllocStats] -&gt; SDoc
</span><a href="GHC.CmmToAsm.Reg.Linear.Stats.html#pprStats"><span class="hs-identifier hs-var">Linear.pprStats</span></a></span><span> </span><span class="annot"><span class="annottext">Platform
</span><a href="#local-6989586621682882719"><span class="hs-identifier hs-var">platform</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[[NatCmmDecl statics instr]] -&gt; [NatCmmDecl statics instr]
forall (t :: * -&gt; *) a. Foldable t =&gt; t [a] -&gt; [a]
</span><span class="hs-identifier hs-var">concat</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">NativeGenAcc statics instr -&gt; [[NatCmmDecl statics instr]]
forall statics instr.
NativeGenAcc statics instr -&gt; [[NatCmmDecl statics instr]]
</span><a href="GHC.CmmToAsm.html#ngs_natives"><span class="hs-identifier hs-var">ngs_natives</span></a></span><span> </span><span class="annot"><span class="annottext">NativeGenAcc statics instr
</span><a href="#local-6989586621682882704"><span class="hs-identifier hs-var">ngs</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[RegAllocStats]
</span><a href="#local-6989586621682882739"><span class="hs-identifier hs-var">linearStats</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-270"></span><span>
</span><span id="line-271"></span><span>        </span><span class="hs-comment">-- write out the imports</span><span>
</span><span id="line-272"></span><span>        </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621682882741"><span class="annot"><span class="annottext">ctx :: SDocContext
</span><a href="#local-6989586621682882741"><span class="hs-identifier hs-var hs-var hs-var">ctx</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">NCGConfig -&gt; SDocContext
</span><a href="GHC.CmmToAsm.Config.html#ncgAsmContext"><span class="hs-identifier hs-var">ncgAsmContext</span></a></span><span> </span><span class="annot"><span class="annottext">NCGConfig
</span><a href="#local-6989586621682882701"><span class="hs-identifier hs-var">config</span></a></span><span>
</span><span id="line-273"></span><span>        </span><span class="annot"><span class="annottext">BufHandle -&gt; SDocContext -&gt; HDoc -&gt; IO ()
</span><a href="GHC.Utils.Outputable.html#bPutHDoc"><span class="hs-identifier hs-var">bPutHDoc</span></a></span><span> </span><span class="annot"><span class="annottext">BufHandle
</span><a href="#local-6989586621682882703"><span class="hs-identifier hs-var">bufh</span></a></span><span> </span><span class="annot"><span class="annottext">SDocContext
</span><a href="#local-6989586621682882741"><span class="hs-identifier hs-var">ctx</span></a></span><span> </span><span class="annot"><span class="annottext">(HDoc -&gt; IO ()) -&gt; HDoc -&gt; IO ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">NCGConfig -&gt; [CLabel] -&gt; HDoc
</span><a href="GHC.CmmToAsm.html#makeImportsDoc"><span class="hs-identifier hs-var">makeImportsDoc</span></a></span><span> </span><span class="annot"><span class="annottext">NCGConfig
</span><a href="#local-6989586621682882701"><span class="hs-identifier hs-var">config</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[[CLabel]] -&gt; [CLabel]
forall (t :: * -&gt; *) a. Foldable t =&gt; t [a] -&gt; [a]
</span><span class="hs-identifier hs-var">concat</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">NativeGenAcc statics instr -&gt; [[CLabel]]
forall statics instr. NativeGenAcc statics instr -&gt; [[CLabel]]
</span><a href="GHC.CmmToAsm.html#ngs_imports"><span class="hs-identifier hs-var">ngs_imports</span></a></span><span> </span><span class="annot"><span class="annottext">NativeGenAcc statics instr
</span><a href="#local-6989586621682882704"><span class="hs-identifier hs-var">ngs</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-274"></span><span>        </span><span class="annot"><span class="annottext">BufHandle -&gt; IO ()
</span><a href="GHC.Utils.BufHandle.html#bFlush"><span class="hs-identifier hs-var">bFlush</span></a></span><span> </span><span class="annot"><span class="annottext">BufHandle
</span><a href="#local-6989586621682882703"><span class="hs-identifier hs-var">bufh</span></a></span><span>
</span><span id="line-275"></span><span>
</span><span id="line-276"></span><span>        </span><span class="annot"><span class="annottext">() -&gt; IO ()
forall a. a -&gt; IO a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-277"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-278"></span><span>    </span><span id="local-6989586621682882729"><span class="annot"><span class="annottext">dump_stats :: SDoc -&gt; IO ()
</span><a href="#local-6989586621682882729"><span class="hs-identifier hs-var hs-var">dump_stats</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Logger
-&gt; PprStyle -&gt; DumpFlag -&gt; String -&gt; DumpFormat -&gt; SDoc -&gt; IO ()
</span><a href="GHC.Utils.Logger.html#logDumpFile"><span class="hs-identifier hs-var">logDumpFile</span></a></span><span> </span><span class="annot"><span class="annottext">Logger
</span><a href="#local-6989586621682882700"><span class="hs-identifier hs-var">logger</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">NamePprCtx -&gt; PprStyle
</span><a href="GHC.Utils.Outputable.html#mkDumpStyle"><span class="hs-identifier hs-var">mkDumpStyle</span></a></span><span> </span><span class="annot"><span class="annottext">NamePprCtx
</span><a href="GHC.Utils.Outputable.html#alwaysQualify"><span class="hs-identifier hs-var">alwaysQualify</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-279"></span><span>                   </span><span class="annot"><span class="annottext">DumpFlag
</span><a href="GHC.Driver.Flags.html#Opt_D_dump_asm_stats"><span class="hs-identifier hs-var">Opt_D_dump_asm_stats</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;NCG stats&quot;</span></span><span>
</span><span id="line-280"></span><span>                   </span><span class="annot"><span class="annottext">DumpFormat
</span><a href="GHC.Utils.Logger.html#FormatText"><span class="hs-identifier hs-var">FormatText</span></a></span><span>
</span><span id="line-281"></span><span>
</span><span id="line-282"></span><span class="annot"><a href="GHC.CmmToAsm.html#cmmNativeGenStream"><span class="hs-identifier hs-type">cmmNativeGenStream</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-keyword">forall</span><span> </span><span id="local-6989586621682882152"><span class="annot"><a href="#local-6989586621682882152"><span class="hs-identifier hs-type">statics</span></a></span></span><span> </span><span id="local-6989586621682882153"><span class="annot"><a href="#local-6989586621682882153"><span class="hs-identifier hs-type">jumpDest</span></a></span></span><span> </span><span id="local-6989586621682882154"><span class="annot"><a href="#local-6989586621682882154"><span class="hs-identifier hs-type">instr</span></a></span></span><span> </span><span id="local-6989586621682882155"><span class="annot"><a href="#local-6989586621682882155"><span class="hs-identifier hs-type">a</span></a></span></span><span> </span><span class="hs-operator">.</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Utils.Outputable.html#OutputableP"><span class="hs-identifier hs-type">OutputableP</span></a></span><span> </span><span class="annot"><a href="GHC.Platform.html#Platform"><span class="hs-identifier hs-type">Platform</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682882152"><span class="hs-identifier hs-type">statics</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Utils.Outputable.html#Outputable"><span class="hs-identifier hs-type">Outputable</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682882153"><span class="hs-identifier hs-type">jumpDest</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.CmmToAsm.Instr.html#Instruction"><span class="hs-identifier hs-type">Instruction</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682882154"><span class="hs-identifier hs-type">instr</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-283"></span><span>              </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="GHC.Utils.Logger.html#Logger"><span class="hs-identifier hs-type">Logger</span></a></span><span>
</span><span id="line-284"></span><span>              </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.CmmToAsm.Config.html#NCGConfig"><span class="hs-identifier hs-type">NCGConfig</span></a></span><span>
</span><span id="line-285"></span><span>              </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Unit.Module.Location.html#ModLocation"><span class="hs-identifier hs-type">ModLocation</span></a></span><span>
</span><span id="line-286"></span><span>              </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.CmmToAsm.Monad.html#NcgImpl"><span class="hs-identifier hs-type">NcgImpl</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682882152"><span class="hs-identifier hs-type">statics</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682882154"><span class="hs-identifier hs-type">instr</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682882153"><span class="hs-identifier hs-type">jumpDest</span></a></span><span>
</span><span id="line-287"></span><span>              </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Utils.BufHandle.html#BufHandle"><span class="hs-identifier hs-type">BufHandle</span></a></span><span>
</span><span id="line-288"></span><span>              </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.StgToCmm.CgUtils.html#CgStream"><span class="hs-identifier hs-type">CgStream</span></a></span><span> </span><span class="annot"><a href="GHC.Cmm.html#RawCmmGroup"><span class="hs-identifier hs-type">RawCmmGroup</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682882155"><span class="hs-identifier hs-type">a</span></a></span><span>
</span><span id="line-289"></span><span>              </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.CmmToAsm.html#NativeGenAcc"><span class="hs-identifier hs-type">NativeGenAcc</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682882152"><span class="hs-identifier hs-type">statics</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682882154"><span class="hs-identifier hs-type">instr</span></a></span><span>
</span><span id="line-290"></span><span>              </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Types.Unique.DSM.html#UniqDSMT"><span class="hs-identifier hs-type">UniqDSMT</span></a></span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.CmmToAsm.html#NativeGenAcc"><span class="hs-identifier hs-type">NativeGenAcc</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682882152"><span class="hs-identifier hs-type">statics</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682882154"><span class="hs-identifier hs-type">instr</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="#local-6989586621682882155"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-291"></span><span>
</span><span id="line-292"></span><span id="cmmNativeGenStream"><span class="annot"><span class="annottext">cmmNativeGenStream :: forall statics jumpDest instr a.
(OutputableP Platform statics, Outputable jumpDest,
 Instruction instr) =&gt;
Logger
-&gt; NCGConfig
-&gt; ModLocation
-&gt; NcgImpl statics instr jumpDest
-&gt; BufHandle
-&gt; CgStream RawCmmGroup a
-&gt; NativeGenAcc statics instr
-&gt; UniqDSMT IO (NativeGenAcc statics instr, a)
</span><a href="GHC.CmmToAsm.html#cmmNativeGenStream"><span class="hs-identifier hs-var hs-var">cmmNativeGenStream</span></a></span></span><span> </span><span id="local-6989586621682882772"><span class="annot"><span class="annottext">Logger
</span><a href="#local-6989586621682882772"><span class="hs-identifier hs-var">logger</span></a></span></span><span> </span><span id="local-6989586621682882773"><span class="annot"><span class="annottext">NCGConfig
</span><a href="#local-6989586621682882773"><span class="hs-identifier hs-var">config</span></a></span></span><span> </span><span id="local-6989586621682882774"><span class="annot"><span class="annottext">ModLocation
</span><a href="#local-6989586621682882774"><span class="hs-identifier hs-var">modLoc</span></a></span></span><span> </span><span id="local-6989586621682882775"><span class="annot"><span class="annottext">NcgImpl statics instr jumpDest
</span><a href="#local-6989586621682882775"><span class="hs-identifier hs-var">ncgImpl</span></a></span></span><span> </span><span id="local-6989586621682882776"><span class="annot"><span class="annottext">BufHandle
</span><a href="#local-6989586621682882776"><span class="hs-identifier hs-var">h</span></a></span></span><span> </span><span id="local-6989586621682882777"><span class="annot"><span class="annottext">CgStream RawCmmGroup a
</span><a href="#local-6989586621682882777"><span class="hs-identifier hs-var">cmm_stream</span></a></span></span><span> </span><span id="local-6989586621682882778"><span class="annot"><span class="annottext">NativeGenAcc statics instr
</span><a href="#local-6989586621682882778"><span class="hs-identifier hs-var">ngs</span></a></span></span><span>
</span><span id="line-293"></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">StreamS (UniqDSMT IO) RawCmmGroup a
-&gt; NativeGenAcc statics instr
-&gt; UniqDSMT IO (NativeGenAcc statics instr, a)
</span><a href="#local-6989586621682882779"><span class="hs-identifier hs-var">loop</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">CgStream RawCmmGroup a -&gt; StreamS (UniqDSMT IO) RawCmmGroup a
forall (m :: * -&gt; *) r' r.
Applicative m =&gt;
Stream m r' r -&gt; StreamS m r' r
</span><a href="GHC.Data.Stream.html#runStream"><span class="hs-identifier hs-var">Stream.runStream</span></a></span><span> </span><span class="annot"><span class="annottext">CgStream RawCmmGroup a
</span><a href="#local-6989586621682882777"><span class="hs-identifier hs-var">cmm_stream</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">NativeGenAcc statics instr
</span><a href="#local-6989586621682882778"><span class="hs-identifier hs-var">ngs</span></a></span><span>
</span><span id="line-294"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-295"></span><span>    </span><span id="local-6989586621682882784"><span class="annot"><span class="annottext">ncglabel :: SDoc
</span><a href="#local-6989586621682882784"><span class="hs-identifier hs-var hs-var">ncglabel</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">String -&gt; SDoc
forall doc. IsLine doc =&gt; String -&gt; doc
</span><a href="GHC.Utils.Outputable.html#text"><span class="hs-identifier hs-var">text</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;NCG&quot;</span></span><span>
</span><span id="line-296"></span><span>    </span><span class="annot"><a href="#local-6989586621682882779"><span class="hs-identifier hs-type">loop</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Data.Stream.html#StreamS"><span class="hs-identifier hs-type">Stream.StreamS</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Types.Unique.DSM.html#UniqDSMT"><span class="hs-identifier hs-type">UniqDSMT</span></a></span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span class="hs-special">)</span><span> </span><span class="annot"><a href="GHC.Cmm.html#RawCmmGroup"><span class="hs-identifier hs-type">RawCmmGroup</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682882155"><span class="hs-identifier hs-type">a</span></a></span><span>
</span><span id="line-297"></span><span>         </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.CmmToAsm.html#NativeGenAcc"><span class="hs-identifier hs-type">NativeGenAcc</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682882152"><span class="hs-identifier hs-type">statics</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682882154"><span class="hs-identifier hs-type">instr</span></a></span><span>
</span><span id="line-298"></span><span>         </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Types.Unique.DSM.html#UniqDSMT"><span class="hs-identifier hs-type">UniqDSMT</span></a></span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.CmmToAsm.html#NativeGenAcc"><span class="hs-identifier hs-type">NativeGenAcc</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682882152"><span class="hs-identifier hs-type">statics</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682882154"><span class="hs-identifier hs-type">instr</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="#local-6989586621682882155"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-299"></span><span>    </span><span id="local-6989586621682882779"><span class="annot"><span class="annottext">loop :: StreamS (UniqDSMT IO) RawCmmGroup a
-&gt; NativeGenAcc statics instr
-&gt; UniqDSMT IO (NativeGenAcc statics instr, a)
</span><a href="#local-6989586621682882779"><span class="hs-identifier hs-var hs-var">loop</span></a></span></span><span> </span><span id="local-6989586621682882785"><span class="annot"><span class="annottext">StreamS (UniqDSMT IO) RawCmmGroup a
</span><a href="#local-6989586621682882785"><span class="hs-identifier hs-var">s</span></a></span></span><span> </span><span id="local-6989586621682882786"><span class="annot"><span class="annottext">NativeGenAcc statics instr
</span><a href="#local-6989586621682882786"><span class="hs-identifier hs-var">ngs</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-300"></span><span>      </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">StreamS (UniqDSMT IO) RawCmmGroup a
</span><a href="#local-6989586621682882785"><span class="hs-identifier hs-var">s</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-301"></span><span>        </span><span class="annot"><a href="GHC.Data.Stream.html#Done"><span class="hs-identifier hs-type">Stream.Done</span></a></span><span> </span><span id="local-6989586621682882788"><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621682882788"><span class="hs-identifier hs-var">a</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-302"></span><span>          </span><span class="annot"><span class="annottext">(NativeGenAcc statics instr, a)
-&gt; UniqDSMT IO (NativeGenAcc statics instr, a)
forall a. a -&gt; UniqDSMT IO a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">NativeGenAcc statics instr
</span><a href="#local-6989586621682882786"><span class="hs-identifier hs-var">ngs</span></a></span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><a href="GHC.CmmToAsm.html#ngs_imports"><span class="hs-identifier hs-var">ngs_imports</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="hs-identifier hs-type">reverse</span></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="annot"><a href="GHC.CmmToAsm.html#ngs_imports"><span class="hs-identifier hs-var">ngs_imports</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682882786"><span class="hs-identifier hs-type">ngs</span></a></span><span>
</span><span id="line-303"></span><span>                      </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.CmmToAsm.html#ngs_natives"><span class="hs-identifier hs-var">ngs_natives</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="hs-identifier hs-type">reverse</span></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="annot"><a href="GHC.CmmToAsm.html#ngs_natives"><span class="hs-identifier hs-var">ngs_natives</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682882786"><span class="hs-identifier hs-type">ngs</span></a></span><span>
</span><span id="line-304"></span><span>                      </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.CmmToAsm.html#ngs_colorStats"><span class="hs-identifier hs-var">ngs_colorStats</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="hs-identifier hs-type">reverse</span></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="annot"><a href="GHC.CmmToAsm.html#ngs_colorStats"><span class="hs-identifier hs-var">ngs_colorStats</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682882786"><span class="hs-identifier hs-type">ngs</span></a></span><span>
</span><span id="line-305"></span><span>                      </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.CmmToAsm.html#ngs_linearStats"><span class="hs-identifier hs-var">ngs_linearStats</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="hs-identifier hs-type">reverse</span></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="annot"><a href="GHC.CmmToAsm.html#ngs_linearStats"><span class="hs-identifier hs-var">ngs_linearStats</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682882786"><span class="hs-identifier hs-type">ngs</span></a></span><span>
</span><span id="line-306"></span><span>                      </span><span class="hs-special">}</span><span class="hs-special">,</span><span>
</span><span id="line-307"></span><span>                  </span><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621682882788"><span class="hs-identifier hs-var">a</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-308"></span><span>        </span><span class="annot"><a href="GHC.Data.Stream.html#Effect"><span class="hs-identifier hs-type">Stream.Effect</span></a></span><span> </span><span id="local-6989586621682882791"><span class="annot"><span class="annottext">UniqDSMT IO (StreamS (UniqDSMT IO) RawCmmGroup a)
</span><a href="#local-6989586621682882791"><span class="hs-identifier hs-var">m</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">UniqDSMT IO (StreamS (UniqDSMT IO) RawCmmGroup a)
</span><a href="#local-6989586621682882791"><span class="hs-identifier hs-var">m</span></a></span><span> </span><span class="annot"><span class="annottext">UniqDSMT IO (StreamS (UniqDSMT IO) RawCmmGroup a)
-&gt; (StreamS (UniqDSMT IO) RawCmmGroup a
    -&gt; UniqDSMT IO (NativeGenAcc statics instr, a))
-&gt; UniqDSMT IO (NativeGenAcc statics instr, a)
forall a b. UniqDSMT IO a -&gt; (a -&gt; UniqDSMT IO b) -&gt; UniqDSMT IO b
forall (m :: * -&gt; *) a b. Monad m =&gt; m a -&gt; (a -&gt; m b) -&gt; m b
</span><span class="hs-operator hs-var">&gt;&gt;=</span></span><span> </span><span class="hs-glyph">\</span><span id="local-6989586621682882792"><span class="annot"><span class="annottext">StreamS (UniqDSMT IO) RawCmmGroup a
</span><a href="#local-6989586621682882792"><span class="hs-identifier hs-var">cmm_stream'</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">StreamS (UniqDSMT IO) RawCmmGroup a
-&gt; NativeGenAcc statics instr
-&gt; UniqDSMT IO (NativeGenAcc statics instr, a)
</span><a href="#local-6989586621682882779"><span class="hs-identifier hs-var">loop</span></a></span><span> </span><span class="annot"><span class="annottext">StreamS (UniqDSMT IO) RawCmmGroup a
</span><a href="#local-6989586621682882792"><span class="hs-identifier hs-var">cmm_stream'</span></a></span><span> </span><span class="annot"><span class="annottext">NativeGenAcc statics instr
</span><a href="#local-6989586621682882786"><span class="hs-identifier hs-var">ngs</span></a></span><span>
</span><span id="line-309"></span><span>        </span><span class="annot"><a href="GHC.Data.Stream.html#Yield"><span class="hs-identifier hs-type">Stream.Yield</span></a></span><span> </span><span id="local-6989586621682882794"><span class="annot"><span class="annottext">RawCmmGroup
</span><a href="#local-6989586621682882794"><span class="hs-identifier hs-var">cmms</span></a></span></span><span> </span><span id="local-6989586621682882795"><span class="annot"><span class="annottext">StreamS (UniqDSMT IO) RawCmmGroup a
</span><a href="#local-6989586621682882795"><span class="hs-identifier hs-var">cmm_stream'</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-310"></span><span>          </span><span id="local-6989586621682882796"><span class="annot"><a href="#local-6989586621682882796"><span class="hs-identifier hs-var">ngs''</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span>
</span><span id="line-311"></span><span>            </span><span class="annot"><span class="annottext">Logger
-&gt; SDoc
-&gt; (NativeGenAcc statics instr -&gt; ())
-&gt; UniqDSMT IO (NativeGenAcc statics instr)
-&gt; UniqDSMT IO (NativeGenAcc statics instr)
forall (m :: * -&gt; *) a.
MonadIO m =&gt;
Logger -&gt; SDoc -&gt; (a -&gt; ()) -&gt; m a -&gt; m a
</span><a href="GHC.Utils.Error.html#withTimingSilent"><span class="hs-identifier hs-var">withTimingSilent</span></a></span><span> </span><span class="annot"><span class="annottext">Logger
</span><a href="#local-6989586621682882772"><span class="hs-identifier hs-var">logger</span></a></span><span> </span><span class="annot"><span class="annottext">SDoc
</span><a href="#local-6989586621682882784"><span class="hs-identifier hs-var">ncglabel</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">NativeGenAcc statics instr -&gt; () -&gt; ()
forall a b. a -&gt; b -&gt; b
</span><span class="hs-operator hs-var">`seq`</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(UniqDSMT IO (NativeGenAcc statics instr)
 -&gt; UniqDSMT IO (NativeGenAcc statics instr))
-&gt; UniqDSMT IO (NativeGenAcc statics instr)
-&gt; UniqDSMT IO (NativeGenAcc statics instr)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-312"></span><span>              </span><span class="hs-comment">-- Generate debug information</span><span>
</span><span id="line-313"></span><span>              </span><span class="hs-keyword">let</span><span> </span><span class="hs-glyph">!</span><span id="local-6989586621682882797"><span class="annot"><span class="annottext">ndbgs :: [DebugBlock]
</span><a href="#local-6989586621682882797"><span class="hs-identifier hs-var hs-var hs-var">ndbgs</span></a></span></span><span> </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">NCGConfig -&gt; Bool
</span><a href="GHC.CmmToAsm.Config.html#ncgDwarfEnabled"><span class="hs-identifier hs-var">ncgDwarfEnabled</span></a></span><span> </span><span class="annot"><span class="annottext">NCGConfig
</span><a href="#local-6989586621682882773"><span class="hs-identifier hs-var">config</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ModLocation -&gt; RawCmmGroup -&gt; [DebugBlock]
</span><a href="GHC.Cmm.DebugBlock.html#cmmDebugGen"><span class="hs-identifier hs-var">cmmDebugGen</span></a></span><span> </span><span class="annot"><span class="annottext">ModLocation
</span><a href="#local-6989586621682882774"><span class="hs-identifier hs-var">modLoc</span></a></span><span> </span><span class="annot"><span class="annottext">RawCmmGroup
</span><a href="#local-6989586621682882794"><span class="hs-identifier hs-var">cmms</span></a></span><span>
</span><span id="line-314"></span><span>                         </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">otherwise</span></span><span>              </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span>
</span><span id="line-315"></span><span>                  </span><span id="local-6989586621682882799"><span class="annot"><span class="annottext">dbgMap :: LabelMap DebugBlock
</span><a href="#local-6989586621682882799"><span class="hs-identifier hs-var hs-var hs-var">dbgMap</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[DebugBlock] -&gt; LabelMap DebugBlock
</span><a href="GHC.Cmm.DebugBlock.html#debugToMap"><span class="hs-identifier hs-var">debugToMap</span></a></span><span> </span><span class="annot"><span class="annottext">[DebugBlock]
</span><a href="#local-6989586621682882797"><span class="hs-identifier hs-var">ndbgs</span></a></span><span>
</span><span id="line-316"></span><span>
</span><span id="line-317"></span><span>              </span><span class="hs-comment">-- Generate native code</span><span>
</span><span id="line-318"></span><span>              </span><span id="local-6989586621682882801"><span class="annot"><a href="#local-6989586621682882801"><span class="hs-identifier hs-var">ngs'</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">(DUniqSupply -&gt; IO (NativeGenAcc statics instr, DUniqSupply))
-&gt; UniqDSMT IO (NativeGenAcc statics instr)
forall a. (DUniqSupply -&gt; IO (a, DUniqSupply)) -&gt; UniqDSMT IO a
</span><a href="GHC.Types.Unique.DSM.html#withDUS"><span class="hs-identifier hs-var">withDUS</span></a></span><span> </span><span class="annot"><span class="annottext">((DUniqSupply -&gt; IO (NativeGenAcc statics instr, DUniqSupply))
 -&gt; UniqDSMT IO (NativeGenAcc statics instr))
-&gt; (DUniqSupply -&gt; IO (NativeGenAcc statics instr, DUniqSupply))
-&gt; UniqDSMT IO (NativeGenAcc statics instr)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Logger
-&gt; NCGConfig
-&gt; NcgImpl statics instr jumpDest
-&gt; BufHandle
-&gt; LabelMap DebugBlock
-&gt; RawCmmGroup
-&gt; NativeGenAcc statics instr
-&gt; Int
-&gt; DUniqSupply
-&gt; IO (NativeGenAcc statics instr, DUniqSupply)
forall statics instr jumpDest.
(OutputableP Platform statics, Outputable jumpDest,
 Instruction instr) =&gt;
Logger
-&gt; NCGConfig
-&gt; NcgImpl statics instr jumpDest
-&gt; BufHandle
-&gt; LabelMap DebugBlock
-&gt; RawCmmGroup
-&gt; NativeGenAcc statics instr
-&gt; Int
-&gt; DUniqSupply
-&gt; IO (NativeGenAcc statics instr, DUniqSupply)
</span><a href="GHC.CmmToAsm.html#cmmNativeGens"><span class="hs-identifier hs-var">cmmNativeGens</span></a></span><span> </span><span class="annot"><span class="annottext">Logger
</span><a href="#local-6989586621682882772"><span class="hs-identifier hs-var">logger</span></a></span><span> </span><span class="annot"><span class="annottext">NCGConfig
</span><a href="#local-6989586621682882773"><span class="hs-identifier hs-var">config</span></a></span><span> </span><span class="annot"><span class="annottext">NcgImpl statics instr jumpDest
</span><a href="#local-6989586621682882775"><span class="hs-identifier hs-var">ncgImpl</span></a></span><span> </span><span class="annot"><span class="annottext">BufHandle
</span><a href="#local-6989586621682882776"><span class="hs-identifier hs-var">h</span></a></span><span>
</span><span id="line-319"></span><span>                                  </span><span class="annot"><span class="annottext">LabelMap DebugBlock
</span><a href="#local-6989586621682882799"><span class="hs-identifier hs-var">dbgMap</span></a></span><span> </span><span class="annot"><span class="annottext">RawCmmGroup
</span><a href="#local-6989586621682882794"><span class="hs-identifier hs-var">cmms</span></a></span><span> </span><span class="annot"><span class="annottext">NativeGenAcc statics instr
</span><a href="#local-6989586621682882786"><span class="hs-identifier hs-var">ngs</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">0</span></span><span>
</span><span id="line-320"></span><span>
</span><span id="line-321"></span><span>              </span><span class="hs-comment">-- Link native code information into debug blocks</span><span>
</span><span id="line-322"></span><span>              </span><span class="hs-comment">-- See Note [What is this unwinding business?] in &quot;GHC.Cmm.DebugBlock&quot;.</span><span>
</span><span id="line-323"></span><span>              </span><span class="hs-keyword">let</span><span> </span><span class="hs-glyph">!</span><span id="local-6989586621682882803"><span class="annot"><a href="#local-6989586621682882803"><span class="hs-identifier hs-var hs-var">ldbgs</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[Label] -&gt; LabelMap [UnwindPoint] -&gt; [DebugBlock] -&gt; [DebugBlock]
</span><a href="GHC.Cmm.DebugBlock.html#cmmDebugLink"><span class="hs-identifier hs-var">cmmDebugLink</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">NativeGenAcc statics instr -&gt; [Label]
forall statics instr. NativeGenAcc statics instr -&gt; [Label]
</span><a href="GHC.CmmToAsm.html#ngs_labels"><span class="hs-identifier hs-var">ngs_labels</span></a></span><span> </span><span class="annot"><span class="annottext">NativeGenAcc statics instr
</span><a href="#local-6989586621682882801"><span class="hs-identifier hs-var">ngs'</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">NativeGenAcc statics instr -&gt; LabelMap [UnwindPoint]
forall statics instr.
NativeGenAcc statics instr -&gt; LabelMap [UnwindPoint]
</span><a href="GHC.CmmToAsm.html#ngs_unwinds"><span class="hs-identifier hs-var">ngs_unwinds</span></a></span><span> </span><span class="annot"><span class="annottext">NativeGenAcc statics instr
</span><a href="#local-6989586621682882801"><span class="hs-identifier hs-var">ngs'</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[DebugBlock]
</span><a href="#local-6989586621682882797"><span class="hs-identifier hs-var">ndbgs</span></a></span><span>
</span><span id="line-324"></span><span>                  </span><span id="local-6989586621682882805"><span class="annot"><a href="#local-6989586621682882805"><span class="hs-identifier hs-var hs-var">platform</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">NCGConfig -&gt; Platform
</span><a href="GHC.CmmToAsm.Config.html#ncgPlatform"><span class="hs-identifier hs-var">ncgPlatform</span></a></span><span> </span><span class="annot"><span class="annottext">NCGConfig
</span><a href="#local-6989586621682882773"><span class="hs-identifier hs-var">config</span></a></span><span>
</span><span id="line-325"></span><span>              </span><span class="annot"><span class="hs-identifier hs-type">unless</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">null</span></span><span> </span><span class="annot"><a href="#local-6989586621682882803"><span class="hs-identifier hs-type">ldbgs</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">liftIO</span></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span>
</span><span id="line-326"></span><span>                </span><span class="annot"><a href="GHC.Utils.Logger.html#putDumpFileMaybe"><span class="hs-identifier hs-type">putDumpFileMaybe</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682882772"><span class="hs-identifier hs-type">logger</span></a></span><span> </span><span class="annot"><a href="GHC.Driver.Flags.html#Opt_D_dump_debug"><span class="hs-identifier hs-type">Opt_D_dump_debug</span></a></span><span> </span><span class="annot"><span class="hs-string">&quot;Debug Infos&quot;</span></span><span> </span><span class="annot"><a href="GHC.Utils.Logger.html#FormatText"><span class="hs-identifier hs-type">FormatText</span></a></span><span>
</span><span id="line-327"></span><span>                  </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Utils.Outputable.html#vcat"><span class="hs-identifier hs-type">vcat</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">map</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Utils.Outputable.html#pdoc"><span class="hs-identifier hs-type">pdoc</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682882805"><span class="hs-identifier hs-type">platform</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><a href="#local-6989586621682882803"><span class="hs-identifier hs-type">ldbgs</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-328"></span><span>
</span><span id="line-329"></span><span>              </span><span class="hs-comment">-- Accumulate debug information for emission in finishNativeGen.</span><span>
</span><span id="line-330"></span><span>              </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621682882809"><span class="annot"><a href="#local-6989586621682882809"><span class="hs-identifier hs-var hs-var">ngs''</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">NativeGenAcc statics instr
</span><a href="#local-6989586621682882801"><span class="hs-identifier hs-var">ngs'</span></a></span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><a href="GHC.CmmToAsm.html#ngs_debug"><span class="hs-identifier hs-var">ngs_debug</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="GHC.CmmToAsm.html#ngs_debug"><span class="hs-identifier hs-var">ngs_debug</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682882801"><span class="hs-identifier hs-type">ngs'</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">++</span></span><span> </span><span class="annot"><a href="#local-6989586621682882803"><span class="hs-identifier hs-type">ldbgs</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.CmmToAsm.html#ngs_labels"><span class="hs-identifier hs-var">ngs_labels</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-331"></span><span>              </span><span class="annot"><span class="hs-identifier hs-type">return</span></span><span> </span><span class="annot"><a href="#local-6989586621682882809"><span class="hs-identifier hs-type">ngs''</span></a></span><span>
</span><span id="line-332"></span><span>
</span><span id="line-333"></span><span>          </span><span class="annot"><a href="#local-6989586621682882779"><span class="hs-identifier hs-type">loop</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682882795"><span class="hs-identifier hs-type">cmm_stream'</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682882796"><span class="hs-identifier hs-type">ngs''</span></a></span><span>
</span><span id="line-334"></span><span>
</span><span id="line-335"></span><span>
</span><span id="line-336"></span><span class="hs-comment">-- | Do native code generation on all these cmms.</span><span>
</span><span id="line-337"></span><span class="hs-comment">--</span><span>
</span><span id="line-338"></span><span class="annot"><a href="GHC.CmmToAsm.html#cmmNativeGens"><span class="hs-identifier hs-type">cmmNativeGens</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-keyword">forall</span><span> </span><span id="local-6989586621682882216"><span class="annot"><a href="#local-6989586621682882216"><span class="hs-identifier hs-type">statics</span></a></span></span><span> </span><span id="local-6989586621682882218"><span class="annot"><a href="#local-6989586621682882218"><span class="hs-identifier hs-type">instr</span></a></span></span><span> </span><span id="local-6989586621682882217"><span class="annot"><a href="#local-6989586621682882217"><span class="hs-identifier hs-type">jumpDest</span></a></span></span><span class="hs-operator">.</span><span>
</span><span id="line-339"></span><span>                 </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Utils.Outputable.html#OutputableP"><span class="hs-identifier hs-type">OutputableP</span></a></span><span> </span><span class="annot"><a href="GHC.Platform.html#Platform"><span class="hs-identifier hs-type">Platform</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682882216"><span class="hs-identifier hs-type">statics</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Utils.Outputable.html#Outputable"><span class="hs-identifier hs-type">Outputable</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682882217"><span class="hs-identifier hs-type">jumpDest</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.CmmToAsm.Instr.html#Instruction"><span class="hs-identifier hs-type">Instruction</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682882218"><span class="hs-identifier hs-type">instr</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-340"></span><span>              </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="GHC.Utils.Logger.html#Logger"><span class="hs-identifier hs-type">Logger</span></a></span><span>
</span><span id="line-341"></span><span>              </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.CmmToAsm.Config.html#NCGConfig"><span class="hs-identifier hs-type">NCGConfig</span></a></span><span>
</span><span id="line-342"></span><span>              </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.CmmToAsm.Monad.html#NcgImpl"><span class="hs-identifier hs-type">NcgImpl</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682882216"><span class="hs-identifier hs-type">statics</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682882218"><span class="hs-identifier hs-type">instr</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682882217"><span class="hs-identifier hs-type">jumpDest</span></a></span><span>
</span><span id="line-343"></span><span>              </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Utils.BufHandle.html#BufHandle"><span class="hs-identifier hs-type">BufHandle</span></a></span><span>
</span><span id="line-344"></span><span>              </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Cmm.Dataflow.Label.html#LabelMap"><span class="hs-identifier hs-type">LabelMap</span></a></span><span> </span><span class="annot"><a href="GHC.Cmm.DebugBlock.html#DebugBlock"><span class="hs-identifier hs-type">DebugBlock</span></a></span><span>
</span><span id="line-345"></span><span>              </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="GHC.Cmm.html#RawCmmDecl"><span class="hs-identifier hs-type">RawCmmDecl</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-346"></span><span>              </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.CmmToAsm.html#NativeGenAcc"><span class="hs-identifier hs-type">NativeGenAcc</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682882216"><span class="hs-identifier hs-type">statics</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682882218"><span class="hs-identifier hs-type">instr</span></a></span><span>
</span><span id="line-347"></span><span>              </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Int</span></span><span>
</span><span id="line-348"></span><span>              </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Types.Unique.DSM.html#DUniqSupply"><span class="hs-identifier hs-type">DUniqSupply</span></a></span><span>
</span><span id="line-349"></span><span>              </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.CmmToAsm.html#NativeGenAcc"><span class="hs-identifier hs-type">NativeGenAcc</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682882216"><span class="hs-identifier hs-type">statics</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682882218"><span class="hs-identifier hs-type">instr</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Types.Unique.DSM.html#DUniqSupply"><span class="hs-identifier hs-type">DUniqSupply</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-350"></span><span>
</span><span id="line-351"></span><span id="cmmNativeGens"><span class="annot"><span class="annottext">cmmNativeGens :: forall statics instr jumpDest.
(OutputableP Platform statics, Outputable jumpDest,
 Instruction instr) =&gt;
Logger
-&gt; NCGConfig
-&gt; NcgImpl statics instr jumpDest
-&gt; BufHandle
-&gt; LabelMap DebugBlock
-&gt; RawCmmGroup
-&gt; NativeGenAcc statics instr
-&gt; Int
-&gt; DUniqSupply
-&gt; IO (NativeGenAcc statics instr, DUniqSupply)
</span><a href="GHC.CmmToAsm.html#cmmNativeGens"><span class="hs-identifier hs-var hs-var">cmmNativeGens</span></a></span></span><span> </span><span id="local-6989586621682882832"><span class="annot"><span class="annottext">Logger
</span><a href="#local-6989586621682882832"><span class="hs-identifier hs-var">logger</span></a></span></span><span> </span><span id="local-6989586621682882833"><span class="annot"><span class="annottext">NCGConfig
</span><a href="#local-6989586621682882833"><span class="hs-identifier hs-var">config</span></a></span></span><span> </span><span id="local-6989586621682882834"><span class="annot"><span class="annottext">NcgImpl statics instr jumpDest
</span><a href="#local-6989586621682882834"><span class="hs-identifier hs-var">ncgImpl</span></a></span></span><span> </span><span id="local-6989586621682882835"><span class="annot"><span class="annottext">BufHandle
</span><a href="#local-6989586621682882835"><span class="hs-identifier hs-var">h</span></a></span></span><span> </span><span id="local-6989586621682882836"><span class="annot"><span class="annottext">LabelMap DebugBlock
</span><a href="#local-6989586621682882836"><span class="hs-identifier hs-var">dbgMap</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">RawCmmGroup
-&gt; NativeGenAcc statics instr
-&gt; Int
-&gt; DUniqSupply
-&gt; IO (NativeGenAcc statics instr, DUniqSupply)
</span><a href="#local-6989586621682882837"><span class="hs-identifier hs-var">go</span></a></span><span>
</span><span id="line-352"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-353"></span><span>    </span><span class="annot"><a href="#local-6989586621682882837"><span class="hs-identifier hs-type">go</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="GHC.Cmm.html#RawCmmDecl"><span class="hs-identifier hs-type">RawCmmDecl</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-354"></span><span>       </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.CmmToAsm.html#NativeGenAcc"><span class="hs-identifier hs-type">NativeGenAcc</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682882216"><span class="hs-identifier hs-type">statics</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682882218"><span class="hs-identifier hs-type">instr</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Int</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Types.Unique.DSM.html#DUniqSupply"><span class="hs-identifier hs-type">DUniqSupply</span></a></span><span>
</span><span id="line-355"></span><span>       </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.CmmToAsm.html#NativeGenAcc"><span class="hs-identifier hs-type">NativeGenAcc</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682882216"><span class="hs-identifier hs-type">statics</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682882218"><span class="hs-identifier hs-type">instr</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Types.Unique.DSM.html#DUniqSupply"><span class="hs-identifier hs-type">DUniqSupply</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-356"></span><span>
</span><span id="line-357"></span><span>    </span><span id="local-6989586621682882837"><span class="annot"><span class="annottext">go :: RawCmmGroup
-&gt; NativeGenAcc statics instr
-&gt; Int
-&gt; DUniqSupply
-&gt; IO (NativeGenAcc statics instr, DUniqSupply)
</span><a href="#local-6989586621682882837"><span class="hs-identifier hs-var hs-var">go</span></a></span></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><span id="local-6989586621682882838"><span class="annot"><span class="annottext">NativeGenAcc statics instr
</span><a href="#local-6989586621682882838"><span class="hs-identifier hs-var">ngs</span></a></span></span><span> </span><span class="hs-glyph">!</span><span class="annot"><span class="annottext">Int
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">!</span><span id="local-6989586621682882839"><span class="annot"><span class="annottext">DUniqSupply
</span><a href="#local-6989586621682882839"><span class="hs-identifier hs-var">us</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-358"></span><span>        </span><span class="annot"><span class="annottext">(NativeGenAcc statics instr, DUniqSupply)
-&gt; IO (NativeGenAcc statics instr, DUniqSupply)
forall a. a -&gt; IO a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">NativeGenAcc statics instr
</span><a href="#local-6989586621682882838"><span class="hs-identifier hs-var">ngs</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">DUniqSupply
</span><a href="#local-6989586621682882839"><span class="hs-identifier hs-var">us</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-359"></span><span>
</span><span id="line-360"></span><span>    </span><span class="annot"><a href="#local-6989586621682882837"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="hs-special">(</span><span id="local-6989586621682882840"><span class="annot"><span class="annottext">RawCmmDecl
</span><a href="#local-6989586621682882840"><span class="hs-identifier hs-var">cmm</span></a></span></span><span> </span><span class="annot"><span class="hs-glyph hs-type">:</span></span><span> </span><span id="local-6989586621682882841"><span class="annot"><span class="annottext">RawCmmGroup
</span><a href="#local-6989586621682882841"><span class="hs-identifier hs-var">cmms</span></a></span></span><span class="hs-special">)</span><span> </span><span id="local-6989586621682882842"><span class="annot"><span class="annottext">NativeGenAcc statics instr
</span><a href="#local-6989586621682882842"><span class="hs-identifier hs-var">ngs</span></a></span></span><span> </span><span id="local-6989586621682882843"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621682882843"><span class="hs-identifier hs-var">count</span></a></span></span><span> </span><span id="local-6989586621682882844"><span class="annot"><span class="annottext">DUniqSupply
</span><a href="#local-6989586621682882844"><span class="hs-identifier hs-var">us</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-361"></span><span>        </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621682882845"><span class="annot"><span class="annottext">fileIds :: DwarfFiles
</span><a href="#local-6989586621682882845"><span class="hs-identifier hs-var hs-var hs-var">fileIds</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">NativeGenAcc statics instr -&gt; DwarfFiles
forall statics instr. NativeGenAcc statics instr -&gt; DwarfFiles
</span><a href="GHC.CmmToAsm.html#ngs_dwarfFiles"><span class="hs-identifier hs-var">ngs_dwarfFiles</span></a></span><span> </span><span class="annot"><span class="annottext">NativeGenAcc statics instr
</span><a href="#local-6989586621682882842"><span class="hs-identifier hs-var">ngs</span></a></span><span>
</span><span id="line-362"></span><span>        </span><span class="hs-special">(</span><span id="local-6989586621682882846"><span class="annot"><a href="#local-6989586621682882846"><span class="hs-identifier hs-var">us'</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682882847"><span class="annot"><a href="#local-6989586621682882847"><span class="hs-identifier hs-var">fileIds'</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682882848"><span class="annot"><a href="#local-6989586621682882848"><span class="hs-identifier hs-var">native</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682882849"><span class="annot"><a href="#local-6989586621682882849"><span class="hs-identifier hs-var">imports</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682882850"><span class="annot"><a href="#local-6989586621682882850"><span class="hs-identifier hs-var">colorStats</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682882851"><span class="annot"><a href="#local-6989586621682882851"><span class="hs-identifier hs-var">linearStats</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682882852"><span class="annot"><a href="#local-6989586621682882852"><span class="hs-identifier hs-var">unwinds</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682882853"><span class="annot"><a href="#local-6989586621682882853"><span class="hs-identifier hs-var">mcfg</span></a></span></span><span class="hs-special">)</span><span>
</span><span id="line-363"></span><span>          </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-pragma">{-# SCC</span><span> </span><span class="hs-pragma">&quot;cmmNativeGen&quot;</span><span> </span><span class="hs-pragma">#-}</span><span>
</span><span id="line-364"></span><span>             </span><span class="annot"><span class="annottext">Logger
-&gt; NcgImpl statics instr jumpDest
-&gt; DUniqSupply
-&gt; DwarfFiles
-&gt; LabelMap DebugBlock
-&gt; RawCmmDecl
-&gt; Int
-&gt; IO
     (DUniqSupply, DwarfFiles, [NatCmmDecl statics instr], [CLabel],
      Maybe [RegAllocStats statics instr], Maybe [RegAllocStats],
      LabelMap [UnwindPoint], Maybe CFG)
forall statics instr jumpDest.
(Instruction instr, OutputableP Platform statics,
 Outputable jumpDest) =&gt;
Logger
-&gt; NcgImpl statics instr jumpDest
-&gt; DUniqSupply
-&gt; DwarfFiles
-&gt; LabelMap DebugBlock
-&gt; RawCmmDecl
-&gt; Int
-&gt; IO
     (DUniqSupply, DwarfFiles, [NatCmmDecl statics instr], [CLabel],
      Maybe [RegAllocStats statics instr], Maybe [RegAllocStats],
      LabelMap [UnwindPoint], Maybe CFG)
</span><a href="GHC.CmmToAsm.html#cmmNativeGen"><span class="hs-identifier hs-var">cmmNativeGen</span></a></span><span> </span><span class="annot"><span class="annottext">Logger
</span><a href="#local-6989586621682882832"><span class="hs-identifier hs-var">logger</span></a></span><span> </span><span class="annot"><span class="annottext">NcgImpl statics instr jumpDest
</span><a href="#local-6989586621682882834"><span class="hs-identifier hs-var">ncgImpl</span></a></span><span> </span><span class="annot"><span class="annottext">DUniqSupply
</span><a href="#local-6989586621682882844"><span class="hs-identifier hs-var">us</span></a></span><span> </span><span class="annot"><span class="annottext">DwarfFiles
</span><a href="#local-6989586621682882845"><span class="hs-identifier hs-var">fileIds</span></a></span><span> </span><span class="annot"><span class="annottext">LabelMap DebugBlock
</span><a href="#local-6989586621682882836"><span class="hs-identifier hs-var">dbgMap</span></a></span><span>
</span><span id="line-365"></span><span>                          </span><span class="annot"><span class="annottext">RawCmmDecl
</span><a href="#local-6989586621682882840"><span class="hs-identifier hs-var">cmm</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621682882843"><span class="hs-identifier hs-var">count</span></a></span><span>
</span><span id="line-366"></span><span>
</span><span id="line-367"></span><span>        </span><span class="hs-comment">-- Generate .file directives for every new file that has been</span><span>
</span><span id="line-368"></span><span>        </span><span class="hs-comment">-- used. Note that it is important that we generate these in</span><span>
</span><span id="line-369"></span><span>        </span><span class="hs-comment">-- ascending order, as Clang's 3.6 assembler complains.</span><span>
</span><span id="line-370"></span><span>        </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621682882854"><span class="annot"><a href="#local-6989586621682882854"><span class="hs-identifier hs-var hs-var">newFileIds</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">((FastString, Int) -&gt; (FastString, Int) -&gt; Ordering)
-&gt; [(FastString, Int)] -&gt; [(FastString, Int)]
forall a. (a -&gt; a -&gt; Ordering) -&gt; [a] -&gt; [a]
</span><span class="hs-identifier hs-var">sortBy</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">((FastString, Int) -&gt; Int)
-&gt; (FastString, Int) -&gt; (FastString, Int) -&gt; Ordering
forall a b. Ord a =&gt; (b -&gt; a) -&gt; b -&gt; b -&gt; Ordering
</span><span class="hs-identifier hs-var">comparing</span></span><span> </span><span class="annot"><span class="annottext">(FastString, Int) -&gt; Int
forall a b. (a, b) -&gt; b
</span><span class="hs-identifier hs-var">snd</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">([(FastString, Int)] -&gt; [(FastString, Int)])
-&gt; [(FastString, Int)] -&gt; [(FastString, Int)]
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-371"></span><span>                         </span><span class="annot"><span class="annottext">DwarfFiles -&gt; [(FastString, Int)]
forall {k} (key :: k) elt. UniqFM key elt -&gt; [elt]
</span><a href="GHC.Types.Unique.FM.html#nonDetEltsUFM"><span class="hs-identifier hs-var">nonDetEltsUFM</span></a></span><span> </span><span class="annot"><span class="annottext">(DwarfFiles -&gt; [(FastString, Int)])
-&gt; DwarfFiles -&gt; [(FastString, Int)]
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">DwarfFiles
</span><a href="#local-6989586621682882847"><span class="hs-identifier hs-var">fileIds'</span></a></span><span> </span><span class="annot"><span class="annottext">DwarfFiles -&gt; DwarfFiles -&gt; DwarfFiles
forall {k} (key :: k) elt1 elt2.
UniqFM key elt1 -&gt; UniqFM key elt2 -&gt; UniqFM key elt1
</span><a href="GHC.Types.Unique.FM.html#minusUFM"><span class="hs-operator hs-var">`minusUFM`</span></a></span><span> </span><span class="annot"><span class="annottext">DwarfFiles
</span><a href="#local-6989586621682882845"><span class="hs-identifier hs-var">fileIds</span></a></span><span>
</span><span id="line-372"></span><span>            </span><span class="hs-comment">-- See Note [Unique Determinism and code generation]</span><span>
</span><span id="line-373"></span><span>            </span><span id="local-6989586621682882875"><span class="annot"><a href="#local-6989586621682882875"><span class="hs-identifier hs-var hs-var">pprDecl</span></a></span></span><span> </span><span class="hs-special">(</span><span id="local-6989586621682882876"><span class="annot"><span class="annottext">FastString
</span><a href="#local-6989586621682882876"><span class="hs-identifier hs-var">f</span></a></span></span><span class="hs-special">,</span><span id="local-6989586621682882877"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621682882877"><span class="hs-identifier hs-var">n</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Line b -&gt; b
forall doc. IsDoc doc =&gt; Line doc -&gt; doc
</span><a href="GHC.Utils.Outputable.html#line"><span class="hs-identifier hs-var">line</span></a></span><span> </span><span class="annot"><span class="annottext">(Line b -&gt; b) -&gt; Line b -&gt; b
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">String -&gt; Line b
forall doc. IsLine doc =&gt; String -&gt; doc
</span><a href="GHC.Utils.Outputable.html#text"><span class="hs-identifier hs-var">text</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;\t.file &quot;</span></span><span> </span><span class="annot"><span class="annottext">Line b -&gt; Line b -&gt; Line b
forall doc. IsLine doc =&gt; doc -&gt; doc -&gt; doc
</span><a href="GHC.Utils.Outputable.html#%3C%3E"><span class="hs-operator hs-var">&lt;&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Line b
forall doc. IsLine doc =&gt; Int -&gt; doc
</span><a href="GHC.Utils.Outputable.html#int"><span class="hs-identifier hs-var">int</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621682882877"><span class="hs-identifier hs-var">n</span></a></span><span> </span><span class="annot"><span class="annottext">Line b -&gt; Line b -&gt; Line b
forall doc. IsLine doc =&gt; doc -&gt; doc -&gt; doc
</span><a href="GHC.Utils.Outputable.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a></span><span>
</span><span id="line-374"></span><span>                                   </span><span class="annot"><span class="annottext">String -&gt; Line b
forall doc. IsLine doc =&gt; String -&gt; doc
</span><a href="GHC.Utils.Outputable.html#pprFilePathString"><span class="hs-identifier hs-var">pprFilePathString</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">FastString -&gt; String
</span><a href="GHC.Data.FastString.html#unpackFS"><span class="hs-identifier hs-var">unpackFS</span></a></span><span> </span><span class="annot"><span class="annottext">FastString
</span><a href="#local-6989586621682882876"><span class="hs-identifier hs-var">f</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-375"></span><span>
</span><span id="line-376"></span><span>        </span><span class="hs-comment">-- see Note [pprNatCmmDeclS and pprNatCmmDeclH] in GHC.CmmToAsm.Monad</span><span>
</span><span id="line-377"></span><span>        </span><span class="annot"><a href="GHC.CmmToAsm.html#emitNativeCode"><span class="hs-identifier hs-type">emitNativeCode</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682882832"><span class="hs-identifier hs-type">logger</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682882833"><span class="hs-identifier hs-type">config</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682882835"><span class="hs-identifier hs-type">h</span></a></span><span>
</span><span id="line-378"></span><span>          </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Utils.Outputable.html#vcat"><span class="hs-identifier hs-type">vcat</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span>
</span><span id="line-379"></span><span>           </span><span class="annot"><span class="hs-identifier hs-type">map</span></span><span> </span><span class="annot"><a href="#local-6989586621682882875"><span class="hs-identifier hs-type">pprDecl</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682882854"><span class="hs-identifier hs-type">newFileIds</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">++</span></span><span>
</span><span id="line-380"></span><span>           </span><span class="annot"><span class="hs-identifier hs-type">map</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.CmmToAsm.Monad.html#pprNatCmmDeclH"><span class="hs-identifier hs-var">pprNatCmmDeclH</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682882834"><span class="hs-identifier hs-type">ncgImpl</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><a href="#local-6989586621682882848"><span class="hs-identifier hs-type">native</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-381"></span><span>          </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Utils.Outputable.html#vcat"><span class="hs-identifier hs-type">vcat</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span>
</span><span id="line-382"></span><span>           </span><span class="annot"><span class="hs-identifier hs-type">map</span></span><span> </span><span class="annot"><a href="#local-6989586621682882875"><span class="hs-identifier hs-type">pprDecl</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682882854"><span class="hs-identifier hs-type">newFileIds</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">++</span></span><span>
</span><span id="line-383"></span><span>           </span><span class="annot"><span class="hs-identifier hs-type">map</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.CmmToAsm.Monad.html#pprNatCmmDeclS"><span class="hs-identifier hs-var">pprNatCmmDeclS</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682882834"><span class="hs-identifier hs-type">ncgImpl</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><a href="#local-6989586621682882848"><span class="hs-identifier hs-type">native</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-384"></span><span>
</span><span id="line-385"></span><span>        </span><span class="hs-comment">-- force evaluation all this stuff to avoid space leaks</span><span>
</span><span id="line-386"></span><span>        </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621682882886"><span class="annot"><a href="#local-6989586621682882886"><span class="hs-identifier hs-var hs-var">platform</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">NCGConfig -&gt; Platform
</span><a href="GHC.CmmToAsm.Config.html#ncgPlatform"><span class="hs-identifier hs-var">ncgPlatform</span></a></span><span> </span><span class="annot"><span class="annottext">NCGConfig
</span><a href="#local-6989586621682882833"><span class="hs-identifier hs-var">config</span></a></span><span>
</span><span id="line-387"></span><span>        </span><span class="hs-pragma">{-# SCC</span><span> </span><span class="hs-pragma">&quot;seqString&quot;</span><span> </span><span class="hs-pragma">#-}</span><span> </span><span class="annot"><span class="hs-identifier hs-type">evaluate</span></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="annot"><a href="GHC.Utils.Misc.html#seqList"><span class="hs-identifier hs-type">seqList</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Utils.Outputable.html#showSDocUnsafe"><span class="hs-identifier hs-type">showSDocUnsafe</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="annot"><a href="GHC.Utils.Outputable.html#vcat"><span class="hs-identifier hs-type">vcat</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">map</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Cmm.CLabel.html#pprAsmLabel"><span class="hs-identifier hs-type">pprAsmLabel</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682882886"><span class="hs-identifier hs-type">platform</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><a href="#local-6989586621682882849"><span class="hs-identifier hs-type">imports</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-388"></span><span>
</span><span id="line-389"></span><span>        </span><span class="hs-keyword">let</span><span> </span><span class="hs-glyph">!</span><span id="local-6989586621682882890"><span class="annot"><a href="#local-6989586621682882890"><span class="hs-identifier hs-var hs-var">labels'</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">if</span><span> </span><span class="annot"><span class="annottext">NCGConfig -&gt; Bool
</span><a href="GHC.CmmToAsm.Config.html#ncgDwarfEnabled"><span class="hs-identifier hs-var">ncgDwarfEnabled</span></a></span><span> </span><span class="annot"><span class="annottext">NCGConfig
</span><a href="#local-6989586621682882833"><span class="hs-identifier hs-var">config</span></a></span><span>
</span><span id="line-390"></span><span>                       </span><span class="hs-keyword">then</span><span> </span><span class="annot"><span class="annottext">(Label -&gt; Bool)
-&gt; (instr -&gt; Bool) -&gt; [NatCmmDecl statics instr] -&gt; [Label]
forall i d g.
(Label -&gt; Bool)
-&gt; (i -&gt; Bool) -&gt; GenCmmGroup d g (ListGraph i) -&gt; [Label]
</span><a href="GHC.Cmm.DebugBlock.html#cmmDebugLabels"><span class="hs-identifier hs-var">cmmDebugLabels</span></a></span><span> </span><span class="annot"><span class="annottext">Label -&gt; Bool
</span><a href="#local-6989586621682882892"><span class="hs-identifier hs-var">is_valid_label</span></a></span><span> </span><span class="annot"><span class="annottext">instr -&gt; Bool
forall instr. Instruction instr =&gt; instr -&gt; Bool
</span><a href="GHC.CmmToAsm.Instr.html#isMetaInstr"><span class="hs-identifier hs-var">isMetaInstr</span></a></span><span> </span><span class="annot"><span class="annottext">[NatCmmDecl statics instr]
</span><a href="#local-6989586621682882848"><span class="hs-identifier hs-var">native</span></a></span><span> </span><span class="hs-keyword">else</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span>
</span><span id="line-391"></span><span>            </span><span id="local-6989586621682882892"><span class="annot"><a href="#local-6989586621682882892"><span class="hs-identifier hs-var hs-var">is_valid_label</span></a></span></span><span>
</span><span id="line-392"></span><span>              </span><span class="hs-comment">-- filter dead labels: asm-shortcutting may remove some blocks</span><span>
</span><span id="line-393"></span><span>              </span><span class="hs-comment">-- (#22792)</span><span>
</span><span id="line-394"></span><span>              </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span id="local-6989586621682882894"><span class="annot"><span class="annottext">CFG
</span><a href="#local-6989586621682882894"><span class="hs-identifier hs-var">cfg</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Maybe CFG
</span><a href="#local-6989586621682882853"><span class="hs-identifier hs-var">mcfg</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">CFG -&gt; Label -&gt; Bool
</span><a href="GHC.CmmToAsm.CFG.html#hasNode"><span class="hs-identifier hs-var">hasNode</span></a></span><span> </span><span class="annot"><span class="annottext">CFG
</span><a href="#local-6989586621682882894"><span class="hs-identifier hs-var">cfg</span></a></span><span>
</span><span id="line-395"></span><span>              </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">otherwise</span></span><span>        </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Label -&gt; Bool
forall a b. a -&gt; b -&gt; a
</span><span class="hs-identifier hs-var">const</span></span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">True</span></span><span>
</span><span id="line-396"></span><span>
</span><span id="line-397"></span><span>            </span><span class="hs-glyph">!</span><span id="local-6989586621682882897"><span class="annot"><a href="#local-6989586621682882897"><span class="hs-identifier hs-var hs-var">natives'</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">if</span><span> </span><span class="annot"><span class="annottext">Logger -&gt; DumpFlag -&gt; Bool
</span><a href="GHC.Utils.Logger.html#logHasDumpFlag"><span class="hs-identifier hs-var">logHasDumpFlag</span></a></span><span> </span><span class="annot"><span class="annottext">Logger
</span><a href="#local-6989586621682882832"><span class="hs-identifier hs-var">logger</span></a></span><span> </span><span class="annot"><span class="annottext">DumpFlag
</span><a href="GHC.Driver.Flags.html#Opt_D_dump_asm_stats"><span class="hs-identifier hs-var">Opt_D_dump_asm_stats</span></a></span><span>
</span><span id="line-398"></span><span>                        </span><span class="hs-keyword">then</span><span> </span><span class="annot"><span class="annottext">[NatCmmDecl statics instr]
</span><a href="#local-6989586621682882848"><span class="hs-identifier hs-var">native</span></a></span><span> </span><span class="annot"><span class="annottext">[NatCmmDecl statics instr]
-&gt; [[NatCmmDecl statics instr]] -&gt; [[NatCmmDecl statics instr]]
forall a. a -&gt; [a] -&gt; [a]
</span><span class="hs-glyph hs-var">:</span></span><span> </span><span class="annot"><span class="annottext">NativeGenAcc statics instr -&gt; [[NatCmmDecl statics instr]]
forall statics instr.
NativeGenAcc statics instr -&gt; [[NatCmmDecl statics instr]]
</span><a href="GHC.CmmToAsm.html#ngs_natives"><span class="hs-identifier hs-var">ngs_natives</span></a></span><span> </span><span class="annot"><span class="annottext">NativeGenAcc statics instr
</span><a href="#local-6989586621682882842"><span class="hs-identifier hs-var">ngs</span></a></span><span> </span><span class="hs-keyword">else</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span>
</span><span id="line-399"></span><span>
</span><span id="line-400"></span><span>            </span><span id="local-6989586621682882899"><span class="annot"><a href="#local-6989586621682882899"><span class="hs-identifier hs-var hs-var">mCon</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">([a] -&gt; [a]) -&gt; (a -&gt; [a] -&gt; [a]) -&gt; Maybe a -&gt; [a] -&gt; [a]
forall b a. b -&gt; (a -&gt; b) -&gt; Maybe a -&gt; b
</span><span class="hs-identifier hs-var">maybe</span></span><span> </span><span class="annot"><span class="annottext">[a] -&gt; [a]
forall a. a -&gt; a
</span><span class="hs-identifier hs-var">id</span></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">:</span><span class="hs-special">)</span><span>
</span><span id="line-401"></span><span>            </span><span id="local-6989586621682882902"><span class="annot"><a href="#local-6989586621682882902"><span class="hs-identifier hs-var hs-var">ngs'</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">NativeGenAcc statics instr
</span><a href="#local-6989586621682882842"><span class="hs-identifier hs-var">ngs</span></a></span><span class="hs-special">{</span><span> </span><span class="annot"><a href="GHC.CmmToAsm.html#ngs_imports"><span class="hs-identifier hs-var">ngs_imports</span></a></span><span>     </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="#local-6989586621682882849"><span class="hs-identifier hs-type">imports</span></a></span><span> </span><span class="annot"><span class="hs-glyph hs-type">:</span></span><span> </span><span class="annot"><a href="GHC.CmmToAsm.html#ngs_imports"><span class="hs-identifier hs-var">ngs_imports</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682882842"><span class="hs-identifier hs-type">ngs</span></a></span><span>
</span><span id="line-402"></span><span>                      </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.CmmToAsm.html#ngs_natives"><span class="hs-identifier hs-var">ngs_natives</span></a></span><span>     </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="#local-6989586621682882897"><span class="hs-identifier hs-type">natives'</span></a></span><span>
</span><span id="line-403"></span><span>                      </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.CmmToAsm.html#ngs_colorStats"><span class="hs-identifier hs-var">ngs_colorStats</span></a></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="#local-6989586621682882850"><span class="hs-identifier hs-type">colorStats</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682882899"><span class="hs-operator hs-type">`mCon`</span></a></span><span> </span><span class="annot"><a href="GHC.CmmToAsm.html#ngs_colorStats"><span class="hs-identifier hs-var">ngs_colorStats</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682882842"><span class="hs-identifier hs-type">ngs</span></a></span><span>
</span><span id="line-404"></span><span>                      </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.CmmToAsm.html#ngs_linearStats"><span class="hs-identifier hs-var">ngs_linearStats</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="#local-6989586621682882851"><span class="hs-identifier hs-type">linearStats</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682882899"><span class="hs-operator hs-type">`mCon`</span></a></span><span> </span><span class="annot"><a href="GHC.CmmToAsm.html#ngs_linearStats"><span class="hs-identifier hs-var">ngs_linearStats</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682882842"><span class="hs-identifier hs-type">ngs</span></a></span><span>
</span><span id="line-405"></span><span>                      </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.CmmToAsm.html#ngs_labels"><span class="hs-identifier hs-var">ngs_labels</span></a></span><span>      </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="GHC.CmmToAsm.html#ngs_labels"><span class="hs-identifier hs-var">ngs_labels</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682882842"><span class="hs-identifier hs-type">ngs</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">++</span></span><span> </span><span class="annot"><a href="#local-6989586621682882890"><span class="hs-identifier hs-type">labels'</span></a></span><span>
</span><span id="line-406"></span><span>                      </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.CmmToAsm.html#ngs_dwarfFiles"><span class="hs-identifier hs-var">ngs_dwarfFiles</span></a></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="#local-6989586621682882847"><span class="hs-identifier hs-type">fileIds'</span></a></span><span>
</span><span id="line-407"></span><span>                      </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.CmmToAsm.html#ngs_unwinds"><span class="hs-identifier hs-var">ngs_unwinds</span></a></span><span>     </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="GHC.CmmToAsm.html#ngs_unwinds"><span class="hs-identifier hs-var">ngs_unwinds</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682882842"><span class="hs-identifier hs-type">ngs</span></a></span><span> </span><span class="annot"><a href="GHC.Cmm.Dataflow.Label.html#mapUnion"><span class="hs-operator hs-type">`mapUnion`</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682882852"><span class="hs-identifier hs-type">unwinds</span></a></span><span>
</span><span id="line-408"></span><span>                      </span><span class="hs-special">}</span><span>
</span><span id="line-409"></span><span>        </span><span class="annot"><a href="#local-6989586621682882837"><span class="hs-identifier hs-type">go</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682882841"><span class="hs-identifier hs-type">cmms</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682882902"><span class="hs-identifier hs-type">ngs'</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621682882843"><span class="hs-identifier hs-type">count</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">+</span></span><span> </span><span class="annot"><span class="hs-number">1</span></span><span class="hs-special">)</span><span> </span><span class="annot"><a href="#local-6989586621682882846"><span class="hs-identifier hs-type">us'</span></a></span><span>
</span><span id="line-410"></span><span>
</span><span id="line-411"></span><span>
</span><span id="line-412"></span><span class="hs-comment">-- see Note [pprNatCmmDeclS and pprNatCmmDeclH] in GHC.CmmToAsm.Monad</span><span>
</span><span id="line-413"></span><span class="annot"><a href="GHC.CmmToAsm.html#emitNativeCode"><span class="hs-identifier hs-type">emitNativeCode</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Utils.Logger.html#Logger"><span class="hs-identifier hs-type">Logger</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.CmmToAsm.Config.html#NCGConfig"><span class="hs-identifier hs-type">NCGConfig</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Utils.BufHandle.html#BufHandle"><span class="hs-identifier hs-type">BufHandle</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Utils.Outputable.html#HDoc"><span class="hs-identifier hs-type">HDoc</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Utils.Outputable.html#SDoc"><span class="hs-identifier hs-type">SDoc</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-414"></span><span id="emitNativeCode"><span class="annot"><span class="annottext">emitNativeCode :: Logger -&gt; NCGConfig -&gt; BufHandle -&gt; HDoc -&gt; SDoc -&gt; IO ()
</span><a href="GHC.CmmToAsm.html#emitNativeCode"><span class="hs-identifier hs-var hs-var">emitNativeCode</span></a></span></span><span> </span><span id="local-6989586621682882905"><span class="annot"><span class="annottext">Logger
</span><a href="#local-6989586621682882905"><span class="hs-identifier hs-var">logger</span></a></span></span><span> </span><span id="local-6989586621682882906"><span class="annot"><span class="annottext">NCGConfig
</span><a href="#local-6989586621682882906"><span class="hs-identifier hs-var">config</span></a></span></span><span> </span><span id="local-6989586621682882907"><span class="annot"><span class="annottext">BufHandle
</span><a href="#local-6989586621682882907"><span class="hs-identifier hs-var">h</span></a></span></span><span> </span><span id="local-6989586621682882908"><span class="annot"><span class="annottext">HDoc
</span><a href="#local-6989586621682882908"><span class="hs-identifier hs-var">hdoc</span></a></span></span><span> </span><span id="local-6989586621682882909"><span class="annot"><span class="annottext">SDoc
</span><a href="#local-6989586621682882909"><span class="hs-identifier hs-var">sdoc</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-415"></span><span>        </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621682882910"><span class="annot"><span class="annottext">ctx :: SDocContext
</span><a href="#local-6989586621682882910"><span class="hs-identifier hs-var hs-var hs-var">ctx</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">NCGConfig -&gt; SDocContext
</span><a href="GHC.CmmToAsm.Config.html#ncgAsmContext"><span class="hs-identifier hs-var">ncgAsmContext</span></a></span><span> </span><span class="annot"><span class="annottext">NCGConfig
</span><a href="#local-6989586621682882906"><span class="hs-identifier hs-var">config</span></a></span><span>
</span><span id="line-416"></span><span>        </span><span class="hs-pragma">{-# SCC</span><span> </span><span class="hs-pragma">&quot;pprNativeCode&quot;</span><span> </span><span class="hs-pragma">#-}</span><span> </span><span class="annot"><span class="annottext">BufHandle -&gt; SDocContext -&gt; HDoc -&gt; IO ()
</span><a href="GHC.Utils.Outputable.html#bPutHDoc"><span class="hs-identifier hs-var">bPutHDoc</span></a></span><span> </span><span class="annot"><span class="annottext">BufHandle
</span><a href="#local-6989586621682882907"><span class="hs-identifier hs-var">h</span></a></span><span> </span><span class="annot"><span class="annottext">SDocContext
</span><a href="#local-6989586621682882910"><span class="hs-identifier hs-var">ctx</span></a></span><span> </span><span class="annot"><span class="annottext">HDoc
</span><a href="#local-6989586621682882908"><span class="hs-identifier hs-var">hdoc</span></a></span><span>
</span><span id="line-417"></span><span>
</span><span id="line-418"></span><span>        </span><span class="hs-comment">-- dump native code</span><span>
</span><span id="line-419"></span><span>        </span><span class="annot"><span class="annottext">Logger -&gt; DumpFlag -&gt; String -&gt; DumpFormat -&gt; SDoc -&gt; IO ()
</span><a href="GHC.Utils.Logger.html#putDumpFileMaybe"><span class="hs-identifier hs-var">putDumpFileMaybe</span></a></span><span> </span><span class="annot"><span class="annottext">Logger
</span><a href="#local-6989586621682882905"><span class="hs-identifier hs-var">logger</span></a></span><span>
</span><span id="line-420"></span><span>                </span><span class="annot"><span class="annottext">DumpFlag
</span><a href="GHC.Driver.Flags.html#Opt_D_dump_asm"><span class="hs-identifier hs-var">Opt_D_dump_asm</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;Asm code&quot;</span></span><span> </span><span class="annot"><span class="annottext">DumpFormat
</span><a href="GHC.Utils.Logger.html#FormatASM"><span class="hs-identifier hs-var">FormatASM</span></a></span><span>
</span><span id="line-421"></span><span>                </span><span class="annot"><span class="annottext">SDoc
</span><a href="#local-6989586621682882909"><span class="hs-identifier hs-var">sdoc</span></a></span><span>
</span><span id="line-422"></span><span>
</span><span id="line-423"></span><span class="hs-comment">-- | Complete native code generation phase for a single top-level chunk of Cmm.</span><span>
</span><span id="line-424"></span><span class="hs-comment">--      Dumping the output of each stage along the way.</span><span>
</span><span id="line-425"></span><span class="hs-comment">--      Global conflict graph and NGC stats</span><span>
</span><span id="line-426"></span><span class="annot"><a href="GHC.CmmToAsm.html#cmmNativeGen"><span class="hs-identifier hs-type">cmmNativeGen</span></a></span><span>
</span><span id="line-427"></span><span>    </span><span class="hs-glyph">::</span><span> </span><span class="hs-keyword">forall</span><span> </span><span id="local-6989586621682882231"><span class="annot"><a href="#local-6989586621682882231"><span class="hs-identifier hs-type">statics</span></a></span></span><span> </span><span id="local-6989586621682882230"><span class="annot"><a href="#local-6989586621682882230"><span class="hs-identifier hs-type">instr</span></a></span></span><span> </span><span id="local-6989586621682882232"><span class="annot"><a href="#local-6989586621682882232"><span class="hs-identifier hs-type">jumpDest</span></a></span></span><span class="hs-operator">.</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.CmmToAsm.Instr.html#Instruction"><span class="hs-identifier hs-type">Instruction</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682882230"><span class="hs-identifier hs-type">instr</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Utils.Outputable.html#OutputableP"><span class="hs-identifier hs-type">OutputableP</span></a></span><span> </span><span class="annot"><a href="GHC.Platform.html#Platform"><span class="hs-identifier hs-type">Platform</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682882231"><span class="hs-identifier hs-type">statics</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Utils.Outputable.html#Outputable"><span class="hs-identifier hs-type">Outputable</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682882232"><span class="hs-identifier hs-type">jumpDest</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-428"></span><span>    </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="GHC.Utils.Logger.html#Logger"><span class="hs-identifier hs-type">Logger</span></a></span><span>
</span><span id="line-429"></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.CmmToAsm.Monad.html#NcgImpl"><span class="hs-identifier hs-type">NcgImpl</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682882231"><span class="hs-identifier hs-type">statics</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682882230"><span class="hs-identifier hs-type">instr</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682882232"><span class="hs-identifier hs-type">jumpDest</span></a></span><span>
</span><span id="line-430"></span><span>        </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Types.Unique.DSM.html#DUniqSupply"><span class="hs-identifier hs-type">DUniqSupply</span></a></span><span>
</span><span id="line-431"></span><span>        </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.CmmToAsm.Monad.html#DwarfFiles"><span class="hs-identifier hs-type">DwarfFiles</span></a></span><span>
</span><span id="line-432"></span><span>        </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Cmm.Dataflow.Label.html#LabelMap"><span class="hs-identifier hs-type">LabelMap</span></a></span><span> </span><span class="annot"><a href="GHC.Cmm.DebugBlock.html#DebugBlock"><span class="hs-identifier hs-type">DebugBlock</span></a></span><span>
</span><span id="line-433"></span><span>        </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Cmm.html#RawCmmDecl"><span class="hs-identifier hs-type">RawCmmDecl</span></a></span><span>                                   </span><span class="annot"><span class="hs-comment">-- ^ the cmm to generate code for</span></span><span>
</span><span id="line-434"></span><span>        </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Int</span></span><span>                                          </span><span class="annot"><span class="hs-comment">-- ^ sequence number of this top thing</span></span><span>
</span><span id="line-435"></span><span>        </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span>   </span><span class="hs-special">(</span><span> </span><span class="annot"><a href="GHC.Types.Unique.DSM.html#DUniqSupply"><span class="hs-identifier hs-type">DUniqSupply</span></a></span><span>
</span><span id="line-436"></span><span>                </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.CmmToAsm.Monad.html#DwarfFiles"><span class="hs-identifier hs-type">DwarfFiles</span></a></span><span>
</span><span id="line-437"></span><span>                </span><span class="hs-special">,</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="GHC.CmmToAsm.Types.html#NatCmmDecl"><span class="hs-identifier hs-type">NatCmmDecl</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682882231"><span class="hs-identifier hs-type">statics</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682882230"><span class="hs-identifier hs-type">instr</span></a></span><span class="hs-special">]</span><span>                </span><span class="hs-comment">-- native code</span><span>
</span><span id="line-438"></span><span>                </span><span class="hs-special">,</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="GHC.Cmm.CLabel.html#CLabel"><span class="hs-identifier hs-type">CLabel</span></a></span><span class="hs-special">]</span><span>                                  </span><span class="hs-comment">-- things imported by this cmm</span><span>
</span><span id="line-439"></span><span>                </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Maybe</span></span><span> </span><span class="hs-special">[</span><span class="annot"><a href="GHC.CmmToAsm.Reg.Graph.Stats.html#RegAllocStats"><span class="hs-identifier hs-type">Color.RegAllocStats</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682882231"><span class="hs-identifier hs-type">statics</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682882230"><span class="hs-identifier hs-type">instr</span></a></span><span class="hs-special">]</span><span> </span><span class="hs-comment">-- stats for the coloring register allocator</span><span>
</span><span id="line-440"></span><span>                </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Maybe</span></span><span> </span><span class="hs-special">[</span><span class="annot"><a href="GHC.CmmToAsm.Reg.Linear.Base.html#RegAllocStats"><span class="hs-identifier hs-type">Linear.RegAllocStats</span></a></span><span class="hs-special">]</span><span>              </span><span class="hs-comment">-- stats for the linear register allocators</span><span>
</span><span id="line-441"></span><span>                </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Cmm.Dataflow.Label.html#LabelMap"><span class="hs-identifier hs-type">LabelMap</span></a></span><span> </span><span class="hs-special">[</span><span class="annot"><a href="GHC.Cmm.DebugBlock.html#UnwindPoint"><span class="hs-identifier hs-type">UnwindPoint</span></a></span><span class="hs-special">]</span><span>                    </span><span class="hs-comment">-- unwinding information for blocks</span><span>
</span><span id="line-442"></span><span>                </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Maybe</span></span><span> </span><span class="annot"><a href="GHC.CmmToAsm.CFG.html#CFG"><span class="hs-identifier hs-type">CFG</span></a></span><span>                                 </span><span class="hs-comment">-- final CFG</span><span>
</span><span id="line-443"></span><span>                </span><span class="hs-special">)</span><span>
</span><span id="line-444"></span><span>
</span><span id="line-445"></span><span id="cmmNativeGen"><span class="annot"><span class="annottext">cmmNativeGen :: forall statics instr jumpDest.
(Instruction instr, OutputableP Platform statics,
 Outputable jumpDest) =&gt;
Logger
-&gt; NcgImpl statics instr jumpDest
-&gt; DUniqSupply
-&gt; DwarfFiles
-&gt; LabelMap DebugBlock
-&gt; RawCmmDecl
-&gt; Int
-&gt; IO
     (DUniqSupply, DwarfFiles, [NatCmmDecl statics instr], [CLabel],
      Maybe [RegAllocStats statics instr], Maybe [RegAllocStats],
      LabelMap [UnwindPoint], Maybe CFG)
</span><a href="GHC.CmmToAsm.html#cmmNativeGen"><span class="hs-identifier hs-var hs-var">cmmNativeGen</span></a></span></span><span> </span><span id="local-6989586621682883043"><span class="annot"><span class="annottext">Logger
</span><a href="#local-6989586621682883043"><span class="hs-identifier hs-var">logger</span></a></span></span><span> </span><span id="local-6989586621682883044"><span class="annot"><span class="annottext">NcgImpl statics instr jumpDest
</span><a href="#local-6989586621682883044"><span class="hs-identifier hs-var">ncgImpl</span></a></span></span><span> </span><span id="local-6989586621682883045"><span class="annot"><span class="annottext">DUniqSupply
</span><a href="#local-6989586621682883045"><span class="hs-identifier hs-var">us</span></a></span></span><span> </span><span id="local-6989586621682883046"><span class="annot"><span class="annottext">DwarfFiles
</span><a href="#local-6989586621682883046"><span class="hs-identifier hs-var">fileIds</span></a></span></span><span> </span><span id="local-6989586621682883047"><span class="annot"><span class="annottext">LabelMap DebugBlock
</span><a href="#local-6989586621682883047"><span class="hs-identifier hs-var">dbgMap</span></a></span></span><span> </span><span id="local-6989586621682883048"><span class="annot"><span class="annottext">RawCmmDecl
</span><a href="#local-6989586621682883048"><span class="hs-identifier hs-var">cmm</span></a></span></span><span> </span><span id="local-6989586621682883049"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621682883049"><span class="hs-identifier hs-var">count</span></a></span></span><span>
</span><span id="line-446"></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-447"></span><span>        </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621682883050"><span class="annot"><span class="annottext">config :: NCGConfig
</span><a href="#local-6989586621682883050"><span class="hs-identifier hs-var hs-var hs-var">config</span></a></span></span><span>   </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">NcgImpl statics instr jumpDest -&gt; NCGConfig
forall statics instr jumpDest.
NcgImpl statics instr jumpDest -&gt; NCGConfig
</span><a href="GHC.CmmToAsm.Monad.html#ncgConfig"><span class="hs-identifier hs-var">ncgConfig</span></a></span><span> </span><span class="annot"><span class="annottext">NcgImpl statics instr jumpDest
</span><a href="#local-6989586621682883044"><span class="hs-identifier hs-var">ncgImpl</span></a></span><span>
</span><span id="line-448"></span><span>        </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621682883052"><span class="annot"><span class="annottext">platform :: Platform
</span><a href="#local-6989586621682883052"><span class="hs-identifier hs-var hs-var hs-var">platform</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">NCGConfig -&gt; Platform
</span><a href="GHC.CmmToAsm.Config.html#ncgPlatform"><span class="hs-identifier hs-var">ncgPlatform</span></a></span><span> </span><span class="annot"><span class="annottext">NCGConfig
</span><a href="#local-6989586621682883050"><span class="hs-identifier hs-var">config</span></a></span><span>
</span><span id="line-449"></span><span>        </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621682883053"><span class="annot"><span class="annottext">weights :: Weights
</span><a href="#local-6989586621682883053"><span class="hs-identifier hs-var hs-var hs-var">weights</span></a></span></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">NCGConfig -&gt; Weights
</span><a href="GHC.CmmToAsm.Config.html#ncgCfgWeights"><span class="hs-identifier hs-var">ncgCfgWeights</span></a></span><span> </span><span class="annot"><span class="annottext">NCGConfig
</span><a href="#local-6989586621682883050"><span class="hs-identifier hs-var">config</span></a></span><span>
</span><span id="line-450"></span><span>
</span><span id="line-451"></span><span>        </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621682883055"><span class="annot"><span class="annottext">proc_name :: SDoc
</span><a href="#local-6989586621682883055"><span class="hs-identifier hs-var hs-var hs-var">proc_name</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">RawCmmDecl
</span><a href="#local-6989586621682883048"><span class="hs-identifier hs-var">cmm</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-452"></span><span>                </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Cmm.html#CmmProc"><span class="hs-identifier hs-type">CmmProc</span></a></span><span> </span><span class="annot"><span class="annottext">LabelMap RawCmmStatics
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621682883057"><span class="annot"><span class="annottext">CLabel
</span><a href="#local-6989586621682883057"><span class="hs-identifier hs-var">entry_label</span></a></span></span><span> </span><span class="annot"><span class="annottext">[GlobalRegUse]
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">CmmGraph
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Platform -&gt; CLabel -&gt; SDoc
forall doc. IsLine doc =&gt; Platform -&gt; CLabel -&gt; doc
</span><a href="GHC.Cmm.CLabel.html#pprAsmLabel"><span class="hs-identifier hs-var">pprAsmLabel</span></a></span><span> </span><span class="annot"><span class="annottext">Platform
</span><a href="#local-6989586621682883052"><span class="hs-identifier hs-var">platform</span></a></span><span> </span><span class="annot"><span class="annottext">CLabel
</span><a href="#local-6989586621682883057"><span class="hs-identifier hs-var">entry_label</span></a></span><span>
</span><span id="line-453"></span><span>                </span><span class="annot"><span class="annottext">RawCmmDecl
</span><span class="hs-identifier">_</span></span><span>                           </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">String -&gt; SDoc
forall doc. IsLine doc =&gt; String -&gt; doc
</span><a href="GHC.Utils.Outputable.html#text"><span class="hs-identifier hs-var">text</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;DataChunk&quot;</span></span><span>
</span><span id="line-454"></span><span>
</span><span id="line-455"></span><span>        </span><span class="hs-comment">-- rewrite assignments to global regs</span><span>
</span><span id="line-456"></span><span>        </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621682883058"><span class="annot"><span class="annottext">fixed_cmm :: RawCmmDecl
</span><a href="#local-6989586621682883058"><span class="hs-identifier hs-var hs-var hs-var">fixed_cmm</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-457"></span><span>                </span><span class="hs-pragma">{-# SCC</span><span> </span><span class="hs-pragma">&quot;fixStgRegisters&quot;</span><span> </span><span class="hs-pragma">#-}</span><span>
</span><span id="line-458"></span><span>                </span><span class="annot"><span class="annottext">Platform -&gt; RawCmmDecl -&gt; RawCmmDecl
</span><a href="GHC.StgToCmm.CgUtils.html#fixStgRegisters"><span class="hs-identifier hs-var">fixStgRegisters</span></a></span><span> </span><span class="annot"><span class="annottext">Platform
</span><a href="#local-6989586621682883052"><span class="hs-identifier hs-var">platform</span></a></span><span> </span><span class="annot"><span class="annottext">RawCmmDecl
</span><a href="#local-6989586621682883048"><span class="hs-identifier hs-var">cmm</span></a></span><span>
</span><span id="line-459"></span><span>
</span><span id="line-460"></span><span>        </span><span class="hs-comment">-- cmm to cmm optimisations</span><span>
</span><span id="line-461"></span><span>        </span><span class="hs-keyword">let</span><span> </span><span class="hs-special">(</span><span id="local-6989586621682883059"><span class="annot"><span class="annottext">RawCmmDecl
</span><a href="#local-6989586621682883059"><span class="hs-identifier hs-var hs-var">opt_cmm</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682883060"><span class="annot"><span class="annottext">[CLabel]
</span><a href="#local-6989586621682883060"><span class="hs-identifier hs-var hs-var">imports</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-462"></span><span>                </span><span class="hs-pragma">{-# SCC</span><span> </span><span class="hs-pragma">&quot;cmmToCmm&quot;</span><span> </span><span class="hs-pragma">#-}</span><span>
</span><span id="line-463"></span><span>                </span><span class="annot"><span class="annottext">NCGConfig -&gt; RawCmmDecl -&gt; (RawCmmDecl, [CLabel])
</span><a href="GHC.Cmm.GenericOpt.html#cmmToCmm"><span class="hs-identifier hs-var">cmmToCmm</span></a></span><span> </span><span class="annot"><span class="annottext">NCGConfig
</span><a href="#local-6989586621682883050"><span class="hs-identifier hs-var">config</span></a></span><span> </span><span class="annot"><span class="annottext">RawCmmDecl
</span><a href="#local-6989586621682883058"><span class="hs-identifier hs-var">fixed_cmm</span></a></span><span>
</span><span id="line-464"></span><span>
</span><span id="line-465"></span><span>        </span><span class="annot"><span class="annottext">Logger -&gt; DumpFlag -&gt; String -&gt; DumpFormat -&gt; SDoc -&gt; IO ()
</span><a href="GHC.Utils.Logger.html#putDumpFileMaybe"><span class="hs-identifier hs-var">putDumpFileMaybe</span></a></span><span> </span><span class="annot"><span class="annottext">Logger
</span><a href="#local-6989586621682883043"><span class="hs-identifier hs-var">logger</span></a></span><span>
</span><span id="line-466"></span><span>                </span><span class="annot"><span class="annottext">DumpFlag
</span><a href="GHC.Driver.Flags.html#Opt_D_dump_opt_cmm"><span class="hs-identifier hs-var">Opt_D_dump_opt_cmm</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;Optimised Cmm&quot;</span></span><span> </span><span class="annot"><span class="annottext">DumpFormat
</span><a href="GHC.Utils.Logger.html#FormatCMM"><span class="hs-identifier hs-var">FormatCMM</span></a></span><span>
</span><span id="line-467"></span><span>                </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Platform -&gt; RawCmmGroup -&gt; SDoc
forall d info g.
(OutputableP Platform d, OutputableP Platform info,
 OutputableP Platform g) =&gt;
Platform -&gt; GenCmmGroup d info g -&gt; SDoc
</span><a href="GHC.Cmm.html#pprCmmGroup"><span class="hs-identifier hs-var">pprCmmGroup</span></a></span><span> </span><span class="annot"><span class="annottext">Platform
</span><a href="#local-6989586621682883052"><span class="hs-identifier hs-var">platform</span></a></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">RawCmmDecl
</span><a href="#local-6989586621682883059"><span class="hs-identifier hs-var">opt_cmm</span></a></span><span class="hs-special">]</span><span class="hs-special">)</span><span>
</span><span id="line-468"></span><span>
</span><span id="line-469"></span><span>        </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621682883065"><span class="annot"><span class="annottext">cmmCfg :: CFG
</span><a href="#local-6989586621682883065"><span class="hs-identifier hs-var hs-var hs-var">cmmCfg</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-pragma">{-# SCC</span><span> </span><span class="hs-pragma">&quot;getCFG&quot;</span><span> </span><span class="hs-pragma">#-}</span><span>
</span><span id="line-470"></span><span>                     </span><span class="annot"><span class="annottext">Platform -&gt; Weights -&gt; RawCmmDecl -&gt; CFG
</span><a href="GHC.CmmToAsm.CFG.html#getCfgProc"><span class="hs-identifier hs-var">getCfgProc</span></a></span><span> </span><span class="annot"><span class="annottext">Platform
</span><a href="#local-6989586621682883052"><span class="hs-identifier hs-var">platform</span></a></span><span> </span><span class="annot"><span class="annottext">Weights
</span><a href="#local-6989586621682883053"><span class="hs-identifier hs-var">weights</span></a></span><span> </span><span class="annot"><span class="annottext">RawCmmDecl
</span><a href="#local-6989586621682883059"><span class="hs-identifier hs-var">opt_cmm</span></a></span><span>
</span><span id="line-471"></span><span>
</span><span id="line-472"></span><span>        </span><span class="hs-comment">-- generate native code from cmm</span><span>
</span><span id="line-473"></span><span>        </span><span class="hs-keyword">let</span><span> </span><span class="hs-special">(</span><span class="hs-special">(</span><span id="local-6989586621682883067"><span class="annot"><span class="annottext">[NatCmmDecl statics instr]
</span><a href="#local-6989586621682883067"><span class="hs-identifier hs-var hs-var">native</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682883068"><span class="annot"><span class="annottext">[CLabel]
</span><a href="#local-6989586621682883068"><span class="hs-identifier hs-var hs-var">lastMinuteImports</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682883069"><span class="annot"><span class="annottext">DwarfFiles
</span><a href="#local-6989586621682883069"><span class="hs-identifier hs-var hs-var">fileIds'</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682883070"><span class="annot"><span class="annottext">CFG
</span><a href="#local-6989586621682883070"><span class="hs-identifier hs-var hs-var">nativeCfgWeights</span></a></span></span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span id="local-6989586621682883071"><span class="annot"><span class="annottext">DUniqSupply
</span><a href="#local-6989586621682883071"><span class="hs-identifier hs-var hs-var">usGen</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-474"></span><span>                </span><span class="hs-pragma">{-# SCC</span><span> </span><span class="hs-pragma">&quot;genMachCode&quot;</span><span> </span><span class="hs-pragma">#-}</span><span>
</span><span id="line-475"></span><span>                </span><span class="annot"><span class="annottext">DUniqSupply
-&gt; UniqDSM ([NatCmmDecl statics instr], [CLabel], DwarfFiles, CFG)
-&gt; (([NatCmmDecl statics instr], [CLabel], DwarfFiles, CFG),
    DUniqSupply)
forall a. DUniqSupply -&gt; UniqDSM a -&gt; (a, DUniqSupply)
</span><a href="GHC.Types.Unique.DSM.html#runUniqueDSM"><span class="hs-identifier hs-var">runUniqueDSM</span></a></span><span> </span><span class="annot"><span class="annottext">DUniqSupply
</span><a href="#local-6989586621682883045"><span class="hs-identifier hs-var">us</span></a></span><span> </span><span class="annot"><span class="annottext">(UniqDSM ([NatCmmDecl statics instr], [CLabel], DwarfFiles, CFG)
 -&gt; (([NatCmmDecl statics instr], [CLabel], DwarfFiles, CFG),
     DUniqSupply))
-&gt; UniqDSM ([NatCmmDecl statics instr], [CLabel], DwarfFiles, CFG)
-&gt; (([NatCmmDecl statics instr], [CLabel], DwarfFiles, CFG),
    DUniqSupply)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">NCGConfig
-&gt; (RawCmmDecl -&gt; NatM [NatCmmDecl statics instr])
-&gt; DwarfFiles
-&gt; LabelMap DebugBlock
-&gt; RawCmmDecl
-&gt; CFG
-&gt; UniqDSM ([NatCmmDecl statics instr], [CLabel], DwarfFiles, CFG)
forall statics instr.
NCGConfig
-&gt; (RawCmmDecl -&gt; NatM [NatCmmDecl statics instr])
-&gt; DwarfFiles
-&gt; LabelMap DebugBlock
-&gt; RawCmmDecl
-&gt; CFG
-&gt; UniqDSM ([NatCmmDecl statics instr], [CLabel], DwarfFiles, CFG)
</span><a href="GHC.CmmToAsm.html#genMachCode"><span class="hs-identifier hs-var">genMachCode</span></a></span><span> </span><span class="annot"><span class="annottext">NCGConfig
</span><a href="#local-6989586621682883050"><span class="hs-identifier hs-var">config</span></a></span><span>
</span><span id="line-476"></span><span>                                        </span><span class="hs-special">(</span><span class="annot"><span class="annottext">NcgImpl statics instr jumpDest
-&gt; RawCmmDecl -&gt; NatM [NatCmmDecl statics instr]
forall statics instr jumpDest.
NcgImpl statics instr jumpDest
-&gt; RawCmmDecl -&gt; NatM [NatCmmDecl statics instr]
</span><a href="GHC.CmmToAsm.Monad.html#cmmTopCodeGen"><span class="hs-identifier hs-var">cmmTopCodeGen</span></a></span><span> </span><span class="annot"><span class="annottext">NcgImpl statics instr jumpDest
</span><a href="#local-6989586621682883044"><span class="hs-identifier hs-var">ncgImpl</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-477"></span><span>                                        </span><span class="annot"><span class="annottext">DwarfFiles
</span><a href="#local-6989586621682883046"><span class="hs-identifier hs-var">fileIds</span></a></span><span> </span><span class="annot"><span class="annottext">LabelMap DebugBlock
</span><a href="#local-6989586621682883047"><span class="hs-identifier hs-var">dbgMap</span></a></span><span> </span><span class="annot"><span class="annottext">RawCmmDecl
</span><a href="#local-6989586621682883059"><span class="hs-identifier hs-var">opt_cmm</span></a></span><span> </span><span class="annot"><span class="annottext">CFG
</span><a href="#local-6989586621682883065"><span class="hs-identifier hs-var">cmmCfg</span></a></span><span>
</span><span id="line-478"></span><span>
</span><span id="line-479"></span><span>        </span><span class="annot"><span class="annottext">Logger -&gt; DumpFlag -&gt; String -&gt; DumpFormat -&gt; SDoc -&gt; IO ()
</span><a href="GHC.Utils.Logger.html#putDumpFileMaybe"><span class="hs-identifier hs-var">putDumpFileMaybe</span></a></span><span> </span><span class="annot"><span class="annottext">Logger
</span><a href="#local-6989586621682883043"><span class="hs-identifier hs-var">logger</span></a></span><span>
</span><span id="line-480"></span><span>                </span><span class="annot"><span class="annottext">DumpFlag
</span><a href="GHC.Driver.Flags.html#Opt_D_dump_asm_native"><span class="hs-identifier hs-var">Opt_D_dump_asm_native</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;Native code&quot;</span></span><span> </span><span class="annot"><span class="annottext">DumpFormat
</span><a href="GHC.Utils.Logger.html#FormatASM"><span class="hs-identifier hs-var">FormatASM</span></a></span><span>
</span><span id="line-481"></span><span>                </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[SDoc] -&gt; SDoc
forall doc. IsDoc doc =&gt; [doc] -&gt; doc
</span><a href="GHC.Utils.Outputable.html#vcat"><span class="hs-identifier hs-var">vcat</span></a></span><span> </span><span class="annot"><span class="annottext">([SDoc] -&gt; SDoc) -&gt; [SDoc] -&gt; SDoc
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">(NatCmmDecl statics instr -&gt; SDoc)
-&gt; [NatCmmDecl statics instr] -&gt; [SDoc]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><span class="hs-identifier hs-var">map</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">NcgImpl statics instr jumpDest -&gt; NatCmmDecl statics instr -&gt; SDoc
forall statics instr jumpDest.
NcgImpl statics instr jumpDest -&gt; NatCmmDecl statics instr -&gt; SDoc
</span><a href="GHC.CmmToAsm.Monad.html#pprNatCmmDeclS"><span class="hs-identifier hs-var">pprNatCmmDeclS</span></a></span><span> </span><span class="annot"><span class="annottext">NcgImpl statics instr jumpDest
</span><a href="#local-6989586621682883044"><span class="hs-identifier hs-var">ncgImpl</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[NatCmmDecl statics instr]
</span><a href="#local-6989586621682883067"><span class="hs-identifier hs-var">native</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-482"></span><span>
</span><span id="line-483"></span><span>        </span><span class="annot"><span class="annottext">Logger -&gt; Maybe CFG -&gt; String -&gt; SDoc -&gt; IO ()
</span><a href="GHC.CmmToAsm.html#maybeDumpCfg"><span class="hs-identifier hs-var">maybeDumpCfg</span></a></span><span> </span><span class="annot"><span class="annottext">Logger
</span><a href="#local-6989586621682883043"><span class="hs-identifier hs-var">logger</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">CFG -&gt; Maybe CFG
forall a. a -&gt; Maybe a
</span><span class="hs-identifier hs-var">Just</span></span><span> </span><span class="annot"><span class="annottext">CFG
</span><a href="#local-6989586621682883070"><span class="hs-identifier hs-var">nativeCfgWeights</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;CFG Weights - Native&quot;</span></span><span> </span><span class="annot"><span class="annottext">SDoc
</span><a href="#local-6989586621682883055"><span class="hs-identifier hs-var">proc_name</span></a></span><span>
</span><span id="line-484"></span><span>
</span><span id="line-485"></span><span>        </span><span class="hs-comment">-- tag instructions with register liveness information</span><span>
</span><span id="line-486"></span><span>        </span><span class="hs-comment">-- also drops dead code. We don't keep the cfg in sync on</span><span>
</span><span id="line-487"></span><span>        </span><span class="hs-comment">-- some backends, so don't use it there.</span><span>
</span><span id="line-488"></span><span>        </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621682883077"><span class="annot"><span class="annottext">livenessCfg :: Maybe CFG
</span><a href="#local-6989586621682883077"><span class="hs-identifier hs-var hs-var hs-var">livenessCfg</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">if</span><span> </span><span class="annot"><span class="annottext">NCGConfig -&gt; Bool
</span><a href="GHC.CmmToAsm.Config.html#ncgEnableDeadCodeElimination"><span class="hs-identifier hs-var">ncgEnableDeadCodeElimination</span></a></span><span> </span><span class="annot"><span class="annottext">NCGConfig
</span><a href="#local-6989586621682883050"><span class="hs-identifier hs-var">config</span></a></span><span>
</span><span id="line-489"></span><span>                                </span><span class="hs-keyword">then</span><span> </span><span class="annot"><span class="annottext">CFG -&gt; Maybe CFG
forall a. a -&gt; Maybe a
</span><span class="hs-identifier hs-var">Just</span></span><span> </span><span class="annot"><span class="annottext">CFG
</span><a href="#local-6989586621682883070"><span class="hs-identifier hs-var">nativeCfgWeights</span></a></span><span>
</span><span id="line-490"></span><span>                                </span><span class="hs-keyword">else</span><span> </span><span class="annot"><span class="annottext">Maybe CFG
forall a. Maybe a
</span><span class="hs-identifier hs-var">Nothing</span></span><span>
</span><span id="line-491"></span><span>        </span><span class="hs-keyword">let</span><span> </span><span class="hs-special">(</span><span id="local-6989586621682883079"><span class="annot"><span class="annottext">[LiveCmmDecl statics instr]
</span><a href="#local-6989586621682883079"><span class="hs-identifier hs-var hs-var">withLiveness</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682883080"><span class="annot"><span class="annottext">DUniqSupply
</span><a href="#local-6989586621682883080"><span class="hs-identifier hs-var hs-var">usLive</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-492"></span><span>                </span><span class="hs-pragma">{-# SCC</span><span> </span><span class="hs-pragma">&quot;regLiveness&quot;</span><span> </span><span class="hs-pragma">#-}</span><span>
</span><span id="line-493"></span><span>                </span><span class="annot"><span class="annottext">DUniqSupply
-&gt; UniqDSM [LiveCmmDecl statics instr]
-&gt; ([LiveCmmDecl statics instr], DUniqSupply)
forall a. DUniqSupply -&gt; UniqDSM a -&gt; (a, DUniqSupply)
</span><a href="GHC.Types.Unique.DSM.html#runUniqueDSM"><span class="hs-identifier hs-var">runUniqueDSM</span></a></span><span> </span><span class="annot"><span class="annottext">DUniqSupply
</span><a href="#local-6989586621682883071"><span class="hs-identifier hs-var">usGen</span></a></span><span>
</span><span id="line-494"></span><span>                        </span><span class="annot"><span class="annottext">(UniqDSM [LiveCmmDecl statics instr]
 -&gt; ([LiveCmmDecl statics instr], DUniqSupply))
-&gt; UniqDSM [LiveCmmDecl statics instr]
-&gt; ([LiveCmmDecl statics instr], DUniqSupply)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">(NatCmmDecl statics instr -&gt; UniqDSM (LiveCmmDecl statics instr))
-&gt; [NatCmmDecl statics instr]
-&gt; UniqDSM [LiveCmmDecl statics instr]
forall (t :: * -&gt; *) (m :: * -&gt; *) a b.
(Traversable t, Monad m) =&gt;
(a -&gt; m b) -&gt; t a -&gt; m (t b)
forall (m :: * -&gt; *) a b. Monad m =&gt; (a -&gt; m b) -&gt; [a] -&gt; m [b]
</span><span class="hs-identifier hs-var">mapM</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Maybe CFG
-&gt; Platform
-&gt; NatCmmDecl statics instr
-&gt; UniqDSM (LiveCmmDecl statics instr)
forall instr statics.
Instruction instr =&gt;
Maybe CFG
-&gt; Platform
-&gt; NatCmmDecl statics instr
-&gt; UniqDSM (LiveCmmDecl statics instr)
</span><a href="GHC.CmmToAsm.Reg.Liveness.html#cmmTopLiveness"><span class="hs-identifier hs-var">cmmTopLiveness</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe CFG
</span><a href="#local-6989586621682883077"><span class="hs-identifier hs-var">livenessCfg</span></a></span><span> </span><span class="annot"><span class="annottext">Platform
</span><a href="#local-6989586621682883052"><span class="hs-identifier hs-var">platform</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[NatCmmDecl statics instr]
</span><a href="#local-6989586621682883067"><span class="hs-identifier hs-var">native</span></a></span><span>
</span><span id="line-495"></span><span>
</span><span id="line-496"></span><span>        </span><span class="annot"><span class="annottext">Logger -&gt; DumpFlag -&gt; String -&gt; DumpFormat -&gt; SDoc -&gt; IO ()
</span><a href="GHC.Utils.Logger.html#putDumpFileMaybe"><span class="hs-identifier hs-var">putDumpFileMaybe</span></a></span><span> </span><span class="annot"><span class="annottext">Logger
</span><a href="#local-6989586621682883043"><span class="hs-identifier hs-var">logger</span></a></span><span>
</span><span id="line-497"></span><span>                </span><span class="annot"><span class="annottext">DumpFlag
</span><a href="GHC.Driver.Flags.html#Opt_D_dump_asm_liveness"><span class="hs-identifier hs-var">Opt_D_dump_asm_liveness</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;Liveness annotations added&quot;</span></span><span>
</span><span id="line-498"></span><span>                </span><span class="annot"><span class="annottext">DumpFormat
</span><a href="GHC.Utils.Logger.html#FormatCMM"><span class="hs-identifier hs-var">FormatCMM</span></a></span><span>
</span><span id="line-499"></span><span>                </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[SDoc] -&gt; SDoc
forall doc. IsDoc doc =&gt; [doc] -&gt; doc
</span><a href="GHC.Utils.Outputable.html#vcat"><span class="hs-identifier hs-var">vcat</span></a></span><span> </span><span class="annot"><span class="annottext">([SDoc] -&gt; SDoc) -&gt; [SDoc] -&gt; SDoc
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">(LiveCmmDecl statics instr -&gt; SDoc)
-&gt; [LiveCmmDecl statics instr] -&gt; [SDoc]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><span class="hs-identifier hs-var">map</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Platform -&gt; LiveCmmDecl statics instr -&gt; SDoc
forall statics instr.
(OutputableP Platform statics, Instruction instr) =&gt;
Platform -&gt; LiveCmmDecl statics instr -&gt; SDoc
</span><a href="GHC.CmmToAsm.Reg.Liveness.html#pprLiveCmmDecl"><span class="hs-identifier hs-var">pprLiveCmmDecl</span></a></span><span> </span><span class="annot"><span class="annottext">Platform
</span><a href="#local-6989586621682883052"><span class="hs-identifier hs-var">platform</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[LiveCmmDecl statics instr]
</span><a href="#local-6989586621682883079"><span class="hs-identifier hs-var">withLiveness</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-500"></span><span>
</span><span id="line-501"></span><span>        </span><span class="hs-comment">-- allocate registers</span><span>
</span><span id="line-502"></span><span>        </span><span class="hs-special">(</span><span id="local-6989586621682883085"><span class="annot"><a href="#local-6989586621682883085"><span class="hs-identifier hs-var">alloced</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682883086"><span class="annot"><a href="#local-6989586621682883086"><span class="hs-identifier hs-var">usAlloc</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682883087"><span class="annot"><a href="#local-6989586621682883087"><span class="hs-identifier hs-var">ppr_raStatsColor</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682883088"><span class="annot"><a href="#local-6989586621682883088"><span class="hs-identifier hs-var">ppr_raStatsLinear</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682883089"><span class="annot"><a href="#local-6989586621682883089"><span class="hs-identifier hs-var">raStats</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682883090"><span class="annot"><a href="#local-6989586621682883090"><span class="hs-identifier hs-var">stack_updt_blks</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span>
</span><span id="line-503"></span><span>         </span><span class="hs-keyword">if</span><span> </span><span class="hs-special">(</span><span> </span><span class="annot"><span class="annottext">NCGConfig -&gt; Bool
</span><a href="GHC.CmmToAsm.Config.html#ncgRegsGraph"><span class="hs-identifier hs-var">ncgRegsGraph</span></a></span><span> </span><span class="annot"><span class="annottext">NCGConfig
</span><a href="#local-6989586621682883050"><span class="hs-identifier hs-var">config</span></a></span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Bool -&gt; Bool
</span><span class="hs-operator hs-var">||</span></span><span> </span><span class="annot"><span class="annottext">NCGConfig -&gt; Bool
</span><a href="GHC.CmmToAsm.Config.html#ncgRegsIterative"><span class="hs-identifier hs-var">ncgRegsIterative</span></a></span><span> </span><span class="annot"><span class="annottext">NCGConfig
</span><a href="#local-6989586621682883050"><span class="hs-identifier hs-var">config</span></a></span><span> </span><span class="hs-special">)</span><span>
</span><span id="line-504"></span><span>          </span><span class="hs-keyword">then</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-505"></span><span>                </span><span class="hs-comment">-- the regs usable for allocation</span><span>
</span><span id="line-506"></span><span>                </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621682883094"><span class="annot"><span class="annottext">UniqFM RegClass (UniqSet RealReg)
</span><a href="#local-6989586621682883094"><span class="hs-identifier hs-var hs-var">alloc_regs</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Types.Unique.FM.html#UniqFM"><span class="hs-identifier hs-type">UniqFM</span></a></span><span> </span><span class="annot"><a href="GHC.Platform.Reg.Class.html#RegClass"><span class="hs-identifier hs-type">RegClass</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Types.Unique.Set.html#UniqSet"><span class="hs-identifier hs-type">UniqSet</span></a></span><span> </span><span class="annot"><a href="GHC.Platform.Reg.html#RealReg"><span class="hs-identifier hs-type">RealReg</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-507"></span><span>                        </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(RealReg
 -&gt; UniqFM RegClass (UniqSet RealReg)
 -&gt; UniqFM RegClass (UniqSet RealReg))
-&gt; UniqFM RegClass (UniqSet RealReg)
-&gt; [RealReg]
-&gt; UniqFM RegClass (UniqSet RealReg)
forall a b. (a -&gt; b -&gt; b) -&gt; b -&gt; [a] -&gt; b
forall (t :: * -&gt; *) a b.
Foldable t =&gt;
(a -&gt; b -&gt; b) -&gt; b -&gt; t a -&gt; b
</span><span class="hs-identifier hs-var">foldr</span></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span id="local-6989586621682883096"><span class="annot"><span class="annottext">RealReg
</span><a href="#local-6989586621682883096"><span class="hs-identifier hs-var">r</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">(UniqSet RealReg -&gt; UniqSet RealReg -&gt; UniqSet RealReg)
-&gt; UniqFM RegClass (UniqSet RealReg)
-&gt; UniqFM RegClass (UniqSet RealReg)
-&gt; UniqFM RegClass (UniqSet RealReg)
forall {k} elt (key :: k).
(elt -&gt; elt -&gt; elt)
-&gt; UniqFM key elt -&gt; UniqFM key elt -&gt; UniqFM key elt
</span><a href="GHC.Types.Unique.FM.html#plusUFM_C"><span class="hs-identifier hs-var">plusUFM_C</span></a></span><span> </span><span class="annot"><span class="annottext">UniqSet RealReg -&gt; UniqSet RealReg -&gt; UniqSet RealReg
forall a. UniqSet a -&gt; UniqSet a -&gt; UniqSet a
</span><a href="GHC.Types.Unique.Set.html#unionUniqSets"><span class="hs-identifier hs-var">unionUniqSets</span></a></span><span>
</span><span id="line-508"></span><span>                                        </span><span class="annot"><span class="annottext">(UniqFM RegClass (UniqSet RealReg)
 -&gt; UniqFM RegClass (UniqSet RealReg)
 -&gt; UniqFM RegClass (UniqSet RealReg))
-&gt; UniqFM RegClass (UniqSet RealReg)
-&gt; UniqFM RegClass (UniqSet RealReg)
-&gt; UniqFM RegClass (UniqSet RealReg)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">RegClass -&gt; UniqSet RealReg -&gt; UniqFM RegClass (UniqSet RealReg)
forall key elt. Uniquable key =&gt; key -&gt; elt -&gt; UniqFM key elt
</span><a href="GHC.Types.Unique.FM.html#unitUFM"><span class="hs-identifier hs-var">unitUFM</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Platform -&gt; RealReg -&gt; RegClass
</span><a href="GHC.CmmToAsm.Reg.Target.html#targetClassOfRealReg"><span class="hs-identifier hs-var">targetClassOfRealReg</span></a></span><span> </span><span class="annot"><span class="annottext">Platform
</span><a href="#local-6989586621682883052"><span class="hs-identifier hs-var">platform</span></a></span><span> </span><span class="annot"><span class="annottext">RealReg
</span><a href="#local-6989586621682883096"><span class="hs-identifier hs-var">r</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">RealReg -&gt; UniqSet RealReg
forall a. Uniquable a =&gt; a -&gt; UniqSet a
</span><a href="GHC.Types.Unique.Set.html#unitUniqSet"><span class="hs-identifier hs-var">unitUniqSet</span></a></span><span> </span><span class="annot"><span class="annottext">RealReg
</span><a href="#local-6989586621682883096"><span class="hs-identifier hs-var">r</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-509"></span><span>                                </span><span class="annot"><span class="annottext">UniqFM RegClass (UniqSet RealReg)
forall {k} (key :: k) elt. UniqFM key elt
</span><a href="GHC.Types.Unique.FM.html#emptyUFM"><span class="hs-identifier hs-var">emptyUFM</span></a></span><span>
</span><span id="line-510"></span><span>                        </span><span class="annot"><span class="annottext">([RealReg] -&gt; UniqFM RegClass (UniqSet RealReg))
-&gt; [RealReg] -&gt; UniqFM RegClass (UniqSet RealReg)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">NcgImpl statics instr jumpDest -&gt; [RealReg]
forall statics instr jumpDest.
NcgImpl statics instr jumpDest -&gt; [RealReg]
</span><a href="GHC.CmmToAsm.Monad.html#allocatableRegs"><span class="hs-identifier hs-var">allocatableRegs</span></a></span><span> </span><span class="annot"><span class="annottext">NcgImpl statics instr jumpDest
</span><a href="#local-6989586621682883044"><span class="hs-identifier hs-var">ncgImpl</span></a></span><span>
</span><span id="line-511"></span><span>
</span><span id="line-512"></span><span>                </span><span class="hs-comment">-- do the graph coloring register allocation</span><span>
</span><span id="line-513"></span><span>                </span><span class="hs-keyword">let</span><span> </span><span class="hs-special">(</span><span class="hs-special">(</span><span id="local-6989586621682883103"><span class="annot"><span class="annottext">[NatCmmDecl statics instr]
</span><a href="#local-6989586621682883103"><span class="hs-identifier hs-var hs-var">alloced</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682883104"><span class="annot"><span class="annottext">Maybe Int
</span><a href="#local-6989586621682883104"><span class="hs-identifier hs-var hs-var">maybe_more_stack</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682883105"><span class="annot"><span class="annottext">[RegAllocStats statics instr]
</span><a href="#local-6989586621682883105"><span class="hs-identifier hs-var hs-var">regAllocStats</span></a></span></span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span id="local-6989586621682883106"><span class="annot"><span class="annottext">DUniqSupply
</span><a href="#local-6989586621682883106"><span class="hs-identifier hs-var hs-var">usAlloc</span></a></span></span><span class="hs-special">)</span><span>
</span><span id="line-514"></span><span>                        </span><span class="hs-glyph">=</span><span> </span><span class="hs-pragma">{-# SCC</span><span> </span><span class="hs-pragma">&quot;RegAlloc-color&quot;</span><span> </span><span class="hs-pragma">#-}</span><span>
</span><span id="line-515"></span><span>                          </span><span class="annot"><span class="annottext">DUniqSupply
-&gt; UniqDSM
     ([NatCmmDecl statics instr], Maybe Int,
      [RegAllocStats statics instr])
-&gt; (([NatCmmDecl statics instr], Maybe Int,
     [RegAllocStats statics instr]),
    DUniqSupply)
forall a. DUniqSupply -&gt; UniqDSM a -&gt; (a, DUniqSupply)
</span><a href="GHC.Types.Unique.DSM.html#runUniqueDSM"><span class="hs-identifier hs-var">runUniqueDSM</span></a></span><span> </span><span class="annot"><span class="annottext">DUniqSupply
</span><a href="#local-6989586621682883080"><span class="hs-identifier hs-var">usLive</span></a></span><span>
</span><span id="line-516"></span><span>                          </span><span class="annot"><span class="annottext">(UniqDSM
   ([NatCmmDecl statics instr], Maybe Int,
    [RegAllocStats statics instr])
 -&gt; (([NatCmmDecl statics instr], Maybe Int,
      [RegAllocStats statics instr]),
     DUniqSupply))
-&gt; UniqDSM
     ([NatCmmDecl statics instr], Maybe Int,
      [RegAllocStats statics instr])
-&gt; (([NatCmmDecl statics instr], Maybe Int,
     [RegAllocStats statics instr]),
    DUniqSupply)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">NCGConfig
-&gt; UniqFM RegClass (UniqSet RealReg)
-&gt; UniqSet Int
-&gt; Int
-&gt; [LiveCmmDecl statics instr]
-&gt; Maybe CFG
-&gt; UniqDSM
     ([NatCmmDecl statics instr], Maybe Int,
      [RegAllocStats statics instr])
forall statics instr.
(OutputableP Platform statics, Instruction instr) =&gt;
NCGConfig
-&gt; UniqFM RegClass (UniqSet RealReg)
-&gt; UniqSet Int
-&gt; Int
-&gt; [LiveCmmDecl statics instr]
-&gt; Maybe CFG
-&gt; UniqDSM
     ([NatCmmDecl statics instr], Maybe Int,
      [RegAllocStats statics instr])
</span><a href="GHC.CmmToAsm.Reg.Graph.html#regAlloc"><span class="hs-identifier hs-var">Color.regAlloc</span></a></span><span>
</span><span id="line-517"></span><span>                                </span><span class="annot"><span class="annottext">NCGConfig
</span><a href="#local-6989586621682883050"><span class="hs-identifier hs-var">config</span></a></span><span>
</span><span id="line-518"></span><span>                                </span><span class="annot"><span class="annottext">UniqFM RegClass (UniqSet RealReg)
</span><a href="#local-6989586621682883094"><span class="hs-identifier hs-var">alloc_regs</span></a></span><span>
</span><span id="line-519"></span><span>                                </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[Int] -&gt; UniqSet Int
forall a. Uniquable a =&gt; [a] -&gt; UniqSet a
</span><a href="GHC.Types.Unique.Set.html#mkUniqSet"><span class="hs-identifier hs-var">mkUniqSet</span></a></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">0</span></span><span> </span><span class="hs-glyph">..</span><span> </span><span class="annot"><span class="annottext">NcgImpl statics instr jumpDest -&gt; Int
forall statics instr jumpDest.
NcgImpl statics instr jumpDest -&gt; Int
</span><a href="GHC.CmmToAsm.Monad.html#maxSpillSlots"><span class="hs-identifier hs-var">maxSpillSlots</span></a></span><span> </span><span class="annot"><span class="annottext">NcgImpl statics instr jumpDest
</span><a href="#local-6989586621682883044"><span class="hs-identifier hs-var">ncgImpl</span></a></span><span class="hs-special">]</span><span class="hs-special">)</span><span>
</span><span id="line-520"></span><span>                                </span><span class="hs-special">(</span><span class="annot"><span class="annottext">NcgImpl statics instr jumpDest -&gt; Int
forall statics instr jumpDest.
NcgImpl statics instr jumpDest -&gt; Int
</span><a href="GHC.CmmToAsm.Monad.html#maxSpillSlots"><span class="hs-identifier hs-var">maxSpillSlots</span></a></span><span> </span><span class="annot"><span class="annottext">NcgImpl statics instr jumpDest
</span><a href="#local-6989586621682883044"><span class="hs-identifier hs-var">ncgImpl</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-521"></span><span>                                </span><span class="annot"><span class="annottext">[LiveCmmDecl statics instr]
</span><a href="#local-6989586621682883079"><span class="hs-identifier hs-var">withLiveness</span></a></span><span>
</span><span id="line-522"></span><span>                                </span><span class="annot"><span class="annottext">Maybe CFG
</span><a href="#local-6989586621682883077"><span class="hs-identifier hs-var">livenessCfg</span></a></span><span>
</span><span id="line-523"></span><span>
</span><span id="line-524"></span><span>                </span><span class="hs-keyword">let</span><span> </span><span class="hs-special">(</span><span class="hs-special">(</span><span id="local-6989586621682883110"><span class="annot"><span class="annottext">[NatCmmDecl statics instr]
</span><a href="#local-6989586621682883110"><span class="hs-identifier hs-var hs-var">alloced'</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682883111"><span class="annot"><span class="annottext">[(Label, Label)]
</span><a href="#local-6989586621682883111"><span class="hs-identifier hs-var hs-var">stack_updt_blks</span></a></span></span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span id="local-6989586621682883112"><span class="annot"><span class="annottext">DUniqSupply
</span><a href="#local-6989586621682883112"><span class="hs-identifier hs-var hs-var">usAlloc'</span></a></span></span><span class="hs-special">)</span><span>
</span><span id="line-525"></span><span>                        </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">DUniqSupply
-&gt; UniqDSM ([NatCmmDecl statics instr], [(Label, Label)])
-&gt; (([NatCmmDecl statics instr], [(Label, Label)]), DUniqSupply)
forall a. DUniqSupply -&gt; UniqDSM a -&gt; (a, DUniqSupply)
</span><a href="GHC.Types.Unique.DSM.html#runUniqueDSM"><span class="hs-identifier hs-var">runUniqueDSM</span></a></span><span> </span><span class="annot"><span class="annottext">DUniqSupply
</span><a href="#local-6989586621682883106"><span class="hs-identifier hs-var">usAlloc</span></a></span><span> </span><span class="annot"><span class="annottext">(UniqDSM ([NatCmmDecl statics instr], [(Label, Label)])
 -&gt; (([NatCmmDecl statics instr], [(Label, Label)]), DUniqSupply))
-&gt; UniqDSM ([NatCmmDecl statics instr], [(Label, Label)])
-&gt; (([NatCmmDecl statics instr], [(Label, Label)]), DUniqSupply)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-526"></span><span>                            </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">Maybe Int
</span><a href="#local-6989586621682883104"><span class="hs-identifier hs-var">maybe_more_stack</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-527"></span><span>                            </span><span class="annot"><span class="annottext">Maybe Int
</span><span class="hs-identifier hs-var">Nothing</span></span><span>     </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">([NatCmmDecl statics instr], [(Label, Label)])
-&gt; UniqDSM ([NatCmmDecl statics instr], [(Label, Label)])
forall a. a -&gt; UniqDSM a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[NatCmmDecl statics instr]
</span><a href="#local-6989586621682883103"><span class="hs-identifier hs-var">alloced</span></a></span><span class="hs-special">,</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span class="hs-special">)</span><span>
</span><span id="line-528"></span><span>                            </span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span id="local-6989586621682883113"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621682883113"><span class="hs-identifier hs-var">amount</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-529"></span><span>                                </span><span class="hs-special">(</span><span id="local-6989586621682883114"><span class="annot"><a href="#local-6989586621682883114"><span class="hs-identifier hs-var">alloced'</span></a></span></span><span class="hs-special">,</span><span id="local-6989586621682883115"><span class="annot"><a href="#local-6989586621682883115"><span class="hs-identifier hs-var">stack_updt_blks</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">[(NatCmmDecl statics instr, [(Label, Label)])]
-&gt; ([NatCmmDecl statics instr], [[(Label, Label)]])
forall a b. [(a, b)] -&gt; ([a], [b])
</span><span class="hs-identifier hs-var">unzip</span></span><span> </span><span class="annot"><span class="annottext">([(NatCmmDecl statics instr, [(Label, Label)])]
 -&gt; ([NatCmmDecl statics instr], [[(Label, Label)]]))
-&gt; UniqDSM [(NatCmmDecl statics instr, [(Label, Label)])]
-&gt; UniqDSM ([NatCmmDecl statics instr], [[(Label, Label)]])
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span>
</span><span id="line-530"></span><span>                                            </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(NatCmmDecl statics instr
 -&gt; UniqDSM (NatCmmDecl statics instr, [(Label, Label)]))
-&gt; [NatCmmDecl statics instr]
-&gt; UniqDSM [(NatCmmDecl statics instr, [(Label, Label)])]
forall (t :: * -&gt; *) (m :: * -&gt; *) a b.
(Traversable t, Monad m) =&gt;
(a -&gt; m b) -&gt; t a -&gt; m (t b)
forall (m :: * -&gt; *) a b. Monad m =&gt; (a -&gt; m b) -&gt; [a] -&gt; m [b]
</span><span class="hs-identifier hs-var">mapM</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">(</span><span class="annot"><span class="annottext">NcgImpl statics instr jumpDest
-&gt; Int
-&gt; NatCmmDecl statics instr
-&gt; UniqDSM (NatCmmDecl statics instr, [(Label, Label)])
forall statics instr jumpDest.
NcgImpl statics instr jumpDest
-&gt; Int
-&gt; NatCmmDecl statics instr
-&gt; UniqDSM (NatCmmDecl statics instr, [(Label, Label)])
</span><a href="GHC.CmmToAsm.Monad.html#ncgAllocMoreStack"><span class="hs-identifier hs-var">ncgAllocMoreStack</span></a></span><span> </span><span class="annot"><span class="annottext">NcgImpl statics instr jumpDest
</span><a href="#local-6989586621682883044"><span class="hs-identifier hs-var">ncgImpl</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621682883113"><span class="hs-identifier hs-var">amount</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[NatCmmDecl statics instr]
</span><a href="#local-6989586621682883103"><span class="hs-identifier hs-var">alloced</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-531"></span><span>                                </span><span class="annot"><span class="hs-identifier hs-type">return</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621682883114"><span class="hs-identifier hs-type">alloced'</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">concat</span></span><span> </span><span class="annot"><a href="#local-6989586621682883115"><span class="hs-identifier hs-type">stack_updt_blks</span></a></span><span> </span><span class="hs-special">)</span><span>
</span><span id="line-532"></span><span>
</span><span id="line-533"></span><span>
</span><span id="line-534"></span><span>                </span><span class="hs-comment">-- dump out what happened during register allocation</span><span>
</span><span id="line-535"></span><span>                </span><span class="annot"><span class="annottext">Logger -&gt; DumpFlag -&gt; String -&gt; DumpFormat -&gt; SDoc -&gt; IO ()
</span><a href="GHC.Utils.Logger.html#putDumpFileMaybe"><span class="hs-identifier hs-var">putDumpFileMaybe</span></a></span><span> </span><span class="annot"><span class="annottext">Logger
</span><a href="#local-6989586621682883043"><span class="hs-identifier hs-var">logger</span></a></span><span>
</span><span id="line-536"></span><span>                        </span><span class="annot"><span class="annottext">DumpFlag
</span><a href="GHC.Driver.Flags.html#Opt_D_dump_asm_regalloc"><span class="hs-identifier hs-var">Opt_D_dump_asm_regalloc</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;Registers allocated&quot;</span></span><span>
</span><span id="line-537"></span><span>                        </span><span class="annot"><span class="annottext">DumpFormat
</span><a href="GHC.Utils.Logger.html#FormatCMM"><span class="hs-identifier hs-var">FormatCMM</span></a></span><span>
</span><span id="line-538"></span><span>                        </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[SDoc] -&gt; SDoc
forall doc. IsDoc doc =&gt; [doc] -&gt; doc
</span><a href="GHC.Utils.Outputable.html#vcat"><span class="hs-identifier hs-var">vcat</span></a></span><span> </span><span class="annot"><span class="annottext">([SDoc] -&gt; SDoc) -&gt; [SDoc] -&gt; SDoc
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">(NatCmmDecl statics instr -&gt; SDoc)
-&gt; [NatCmmDecl statics instr] -&gt; [SDoc]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><span class="hs-identifier hs-var">map</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">NcgImpl statics instr jumpDest -&gt; NatCmmDecl statics instr -&gt; SDoc
forall statics instr jumpDest.
NcgImpl statics instr jumpDest -&gt; NatCmmDecl statics instr -&gt; SDoc
</span><a href="GHC.CmmToAsm.Monad.html#pprNatCmmDeclS"><span class="hs-identifier hs-var">pprNatCmmDeclS</span></a></span><span> </span><span class="annot"><span class="annottext">NcgImpl statics instr jumpDest
</span><a href="#local-6989586621682883044"><span class="hs-identifier hs-var">ncgImpl</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[NatCmmDecl statics instr]
</span><a href="#local-6989586621682883103"><span class="hs-identifier hs-var">alloced</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-539"></span><span>
</span><span id="line-540"></span><span>                </span><span class="annot"><span class="annottext">Logger -&gt; DumpFlag -&gt; String -&gt; DumpFormat -&gt; SDoc -&gt; IO ()
</span><a href="GHC.Utils.Logger.html#putDumpFileMaybe"><span class="hs-identifier hs-var">putDumpFileMaybe</span></a></span><span> </span><span class="annot"><span class="annottext">Logger
</span><a href="#local-6989586621682883043"><span class="hs-identifier hs-var">logger</span></a></span><span>
</span><span id="line-541"></span><span>                        </span><span class="annot"><span class="annottext">DumpFlag
</span><a href="GHC.Driver.Flags.html#Opt_D_dump_asm_regalloc_stages"><span class="hs-identifier hs-var">Opt_D_dump_asm_regalloc_stages</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;Build/spill stages&quot;</span></span><span>
</span><span id="line-542"></span><span>                        </span><span class="annot"><span class="annottext">DumpFormat
</span><a href="GHC.Utils.Logger.html#FormatText"><span class="hs-identifier hs-var">FormatText</span></a></span><span>
</span><span id="line-543"></span><span>                        </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[SDoc] -&gt; SDoc
forall doc. IsDoc doc =&gt; [doc] -&gt; doc
</span><a href="GHC.Utils.Outputable.html#vcat"><span class="hs-identifier hs-var">vcat</span></a></span><span>   </span><span class="annot"><span class="annottext">([SDoc] -&gt; SDoc) -&gt; [SDoc] -&gt; SDoc
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">((Int, RegAllocStats statics instr) -&gt; SDoc)
-&gt; [(Int, RegAllocStats statics instr)] -&gt; [SDoc]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><span class="hs-identifier hs-var">map</span></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span class="hs-special">(</span><span id="local-6989586621682883121"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621682883121"><span class="hs-identifier hs-var">stage</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682883122"><span class="annot"><span class="annottext">RegAllocStats statics instr
</span><a href="#local-6989586621682883122"><span class="hs-identifier hs-var">stats</span></a></span></span><span class="hs-special">)</span><span>
</span><span id="line-544"></span><span>                                        </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">String -&gt; SDoc
forall doc. IsLine doc =&gt; String -&gt; doc
</span><a href="GHC.Utils.Outputable.html#text"><span class="hs-identifier hs-var">text</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;# --------------------------&quot;</span></span><span>
</span><span id="line-545"></span><span>                                        </span><span class="annot"><span class="annottext">SDoc -&gt; SDoc -&gt; SDoc
forall doc. IsDoc doc =&gt; doc -&gt; doc -&gt; doc
</span><a href="GHC.Utils.Outputable.html#%24%24"><span class="hs-operator hs-var">$$</span></a></span><span> </span><span class="annot"><span class="annottext">String -&gt; SDoc
forall doc. IsLine doc =&gt; String -&gt; doc
</span><a href="GHC.Utils.Outputable.html#text"><span class="hs-identifier hs-var">text</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;#  cmm &quot;</span></span><span> </span><span class="annot"><span class="annottext">SDoc -&gt; SDoc -&gt; SDoc
forall doc. IsLine doc =&gt; doc -&gt; doc -&gt; doc
</span><a href="GHC.Utils.Outputable.html#%3C%3E"><span class="hs-operator hs-var">&lt;&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">Int -&gt; SDoc
forall doc. IsLine doc =&gt; Int -&gt; doc
</span><a href="GHC.Utils.Outputable.html#int"><span class="hs-identifier hs-var">int</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621682883049"><span class="hs-identifier hs-var">count</span></a></span><span> </span><span class="annot"><span class="annottext">SDoc -&gt; SDoc -&gt; SDoc
forall doc. IsLine doc =&gt; doc -&gt; doc -&gt; doc
</span><a href="GHC.Utils.Outputable.html#%3C%3E"><span class="hs-operator hs-var">&lt;&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">String -&gt; SDoc
forall doc. IsLine doc =&gt; String -&gt; doc
</span><a href="GHC.Utils.Outputable.html#text"><span class="hs-identifier hs-var">text</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot; Stage &quot;</span></span><span> </span><span class="annot"><span class="annottext">SDoc -&gt; SDoc -&gt; SDoc
forall doc. IsLine doc =&gt; doc -&gt; doc -&gt; doc
</span><a href="GHC.Utils.Outputable.html#%3C%3E"><span class="hs-operator hs-var">&lt;&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">Int -&gt; SDoc
forall doc. IsLine doc =&gt; Int -&gt; doc
</span><a href="GHC.Utils.Outputable.html#int"><span class="hs-identifier hs-var">int</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621682883121"><span class="hs-identifier hs-var">stage</span></a></span><span>
</span><span id="line-546"></span><span>                                        </span><span class="annot"><span class="annottext">SDoc -&gt; SDoc -&gt; SDoc
forall doc. IsDoc doc =&gt; doc -&gt; doc -&gt; doc
</span><a href="GHC.Utils.Outputable.html#%24%24"><span class="hs-operator hs-var">$$</span></a></span><span> </span><span class="annot"><span class="annottext">RegAllocStats statics SDoc -&gt; SDoc
forall a. Outputable a =&gt; a -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(instr -&gt; SDoc)
-&gt; RegAllocStats statics instr -&gt; RegAllocStats statics SDoc
forall a b.
(a -&gt; b) -&gt; RegAllocStats statics a -&gt; RegAllocStats statics b
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-identifier hs-var">fmap</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Platform -&gt; instr -&gt; SDoc
forall instr. Instruction instr =&gt; Platform -&gt; instr -&gt; SDoc
</span><a href="GHC.CmmToAsm.Instr.html#pprInstr"><span class="hs-identifier hs-var">pprInstr</span></a></span><span> </span><span class="annot"><span class="annottext">Platform
</span><a href="#local-6989586621682883052"><span class="hs-identifier hs-var">platform</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">RegAllocStats statics instr
</span><a href="#local-6989586621682883122"><span class="hs-identifier hs-var">stats</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-547"></span><span>                                </span><span class="annot"><span class="annottext">([(Int, RegAllocStats statics instr)] -&gt; [SDoc])
-&gt; [(Int, RegAllocStats statics instr)] -&gt; [SDoc]
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">[Int]
-&gt; [RegAllocStats statics instr]
-&gt; [(Int, RegAllocStats statics instr)]
forall a b. [a] -&gt; [b] -&gt; [(a, b)]
</span><span class="hs-identifier hs-var">zip</span></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">0</span></span><span class="hs-glyph">..</span><span class="hs-special">]</span><span> </span><span class="annot"><span class="annottext">[RegAllocStats statics instr]
</span><a href="#local-6989586621682883105"><span class="hs-identifier hs-var">regAllocStats</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-548"></span><span>
</span><span id="line-549"></span><span>                </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621682883125"><span class="annot"><span class="annottext">mPprStats :: Maybe [RegAllocStats statics instr]
</span><a href="#local-6989586621682883125"><span class="hs-identifier hs-var hs-var hs-var">mPprStats</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-550"></span><span>                        </span><span class="hs-keyword">if</span><span> </span><span class="annot"><span class="annottext">Logger -&gt; DumpFlag -&gt; Bool
</span><a href="GHC.Utils.Logger.html#logHasDumpFlag"><span class="hs-identifier hs-var">logHasDumpFlag</span></a></span><span> </span><span class="annot"><span class="annottext">Logger
</span><a href="#local-6989586621682883043"><span class="hs-identifier hs-var">logger</span></a></span><span> </span><span class="annot"><span class="annottext">DumpFlag
</span><a href="GHC.Driver.Flags.html#Opt_D_dump_asm_stats"><span class="hs-identifier hs-var">Opt_D_dump_asm_stats</span></a></span><span>
</span><span id="line-551"></span><span>                         </span><span class="hs-keyword">then</span><span> </span><span class="annot"><span class="annottext">[RegAllocStats statics instr]
-&gt; Maybe [RegAllocStats statics instr]
forall a. a -&gt; Maybe a
</span><span class="hs-identifier hs-var">Just</span></span><span> </span><span class="annot"><span class="annottext">[RegAllocStats statics instr]
</span><a href="#local-6989586621682883105"><span class="hs-identifier hs-var">regAllocStats</span></a></span><span> </span><span class="hs-keyword">else</span><span> </span><span class="annot"><span class="annottext">Maybe [RegAllocStats statics instr]
forall a. Maybe a
</span><span class="hs-identifier hs-var">Nothing</span></span><span>
</span><span id="line-552"></span><span>
</span><span id="line-553"></span><span>                </span><span class="hs-comment">-- force evaluation of the Maybe to avoid space leak</span><span>
</span><span id="line-554"></span><span>                </span><span class="annot"><span class="annottext">Maybe [RegAllocStats statics instr]
</span><a href="#local-6989586621682883125"><span class="hs-identifier hs-var">mPprStats</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe [RegAllocStats statics instr] -&gt; IO () -&gt; IO ()
forall a b. a -&gt; b -&gt; b
</span><span class="hs-operator hs-var">`seq`</span></span><span> </span><span class="annot"><span class="annottext">() -&gt; IO ()
forall a. a -&gt; IO a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-555"></span><span>
</span><span id="line-556"></span><span>                </span><span class="annot"><span class="annottext">([NatCmmDecl statics instr], DUniqSupply,
 Maybe [RegAllocStats statics instr], Maybe [RegAllocStats],
 [RegAllocStats], [(Label, Label)])
-&gt; IO
     ([NatCmmDecl statics instr], DUniqSupply,
      Maybe [RegAllocStats statics instr], Maybe [RegAllocStats],
      [RegAllocStats], [(Label, Label)])
forall a. a -&gt; IO a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span>  </span><span class="hs-special">(</span><span> </span><span class="annot"><span class="annottext">[NatCmmDecl statics instr]
</span><a href="#local-6989586621682883110"><span class="hs-identifier hs-var">alloced'</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">DUniqSupply
</span><a href="#local-6989586621682883112"><span class="hs-identifier hs-var">usAlloc'</span></a></span><span>
</span><span id="line-557"></span><span>                        </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Maybe [RegAllocStats statics instr]
</span><a href="#local-6989586621682883125"><span class="hs-identifier hs-var">mPprStats</span></a></span><span>
</span><span id="line-558"></span><span>                        </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Maybe [RegAllocStats]
forall a. Maybe a
</span><span class="hs-identifier hs-var">Nothing</span></span><span>
</span><span id="line-559"></span><span>                        </span><span class="hs-special">,</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">[(Label, Label)]
</span><a href="#local-6989586621682883111"><span class="hs-identifier hs-var">stack_updt_blks</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-560"></span><span>
</span><span id="line-561"></span><span>          </span><span class="hs-keyword">else</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-562"></span><span>                </span><span class="hs-comment">-- do linear register allocation</span><span>
</span><span id="line-563"></span><span>                </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621682883126"><span class="annot"><span class="annottext">reg_alloc :: LiveCmmDecl statics instr
-&gt; UniqDSM
     (NatCmmDecl statics instr, Maybe RegAllocStats, [(Label, Label)])
</span><a href="#local-6989586621682883126"><span class="hs-identifier hs-var hs-var hs-var">reg_alloc</span></a></span></span><span> </span><span id="local-6989586621682883127"><span class="annot"><span class="annottext">LiveCmmDecl statics instr
</span><a href="#local-6989586621682883127"><span class="hs-identifier hs-var">proc</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-564"></span><span>                       </span><span class="hs-special">(</span><span id="local-6989586621682883128"><span class="annot"><a href="#local-6989586621682883128"><span class="hs-identifier hs-var">alloced</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682883129"><span class="annot"><a href="#local-6989586621682883129"><span class="hs-identifier hs-var">maybe_more_stack</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682883130"><span class="annot"><a href="#local-6989586621682883130"><span class="hs-identifier hs-var">ra_stats</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span>
</span><span id="line-565"></span><span>                               </span><span class="annot"><span class="annottext">NCGConfig
-&gt; LiveCmmDecl statics instr
-&gt; UniqDSM
     (NatCmmDecl statics instr, Maybe Int, Maybe RegAllocStats)
forall instr statics.
Instruction instr =&gt;
NCGConfig
-&gt; LiveCmmDecl statics instr
-&gt; UniqDSM
     (NatCmmDecl statics instr, Maybe Int, Maybe RegAllocStats)
</span><a href="GHC.CmmToAsm.Reg.Linear.html#regAlloc"><span class="hs-identifier hs-var">Linear.regAlloc</span></a></span><span> </span><span class="annot"><span class="annottext">NCGConfig
</span><a href="#local-6989586621682883050"><span class="hs-identifier hs-var">config</span></a></span><span> </span><span class="annot"><span class="annottext">LiveCmmDecl statics instr
</span><a href="#local-6989586621682883127"><span class="hs-identifier hs-var">proc</span></a></span><span>
</span><span id="line-566"></span><span>                       </span><span class="hs-keyword">case</span><span> </span><span class="annot"><a href="#local-6989586621682883129"><span class="hs-identifier hs-type">maybe_more_stack</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-567"></span><span>                         </span><span class="annot"><span class="annottext">Maybe Int
</span><span class="hs-identifier hs-var">Nothing</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">(NatCmmDecl statics instr, Maybe RegAllocStats, [(Label, Label)])
-&gt; UniqDSM
     (NatCmmDecl statics instr, Maybe RegAllocStats, [(Label, Label)])
forall a. a -&gt; UniqDSM a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="hs-special">(</span><span> </span><span class="annot"><span class="annottext">NatCmmDecl statics instr
</span><a href="#local-6989586621682883128"><span class="hs-identifier hs-var">alloced</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Maybe RegAllocStats
</span><a href="#local-6989586621682883130"><span class="hs-identifier hs-var">ra_stats</span></a></span><span class="hs-special">,</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><span class="hs-special">)</span><span>
</span><span id="line-568"></span><span>                         </span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span id="local-6989586621682883132"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621682883132"><span class="hs-identifier hs-var">amount</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-569"></span><span>                           </span><span class="hs-special">(</span><span id="local-6989586621682883133"><span class="annot"><a href="#local-6989586621682883133"><span class="hs-identifier hs-var">alloced'</span></a></span></span><span class="hs-special">,</span><span id="local-6989586621682883134"><span class="annot"><a href="#local-6989586621682883134"><span class="hs-identifier hs-var">stack_updt_blks</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span>
</span><span id="line-570"></span><span>                               </span><span class="annot"><span class="annottext">NcgImpl statics instr jumpDest
-&gt; Int
-&gt; NatCmmDecl statics instr
-&gt; UniqDSM (NatCmmDecl statics instr, [(Label, Label)])
forall statics instr jumpDest.
NcgImpl statics instr jumpDest
-&gt; Int
-&gt; NatCmmDecl statics instr
-&gt; UniqDSM (NatCmmDecl statics instr, [(Label, Label)])
</span><a href="GHC.CmmToAsm.Monad.html#ncgAllocMoreStack"><span class="hs-identifier hs-var">ncgAllocMoreStack</span></a></span><span> </span><span class="annot"><span class="annottext">NcgImpl statics instr jumpDest
</span><a href="#local-6989586621682883044"><span class="hs-identifier hs-var">ncgImpl</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621682883132"><span class="hs-identifier hs-var">amount</span></a></span><span> </span><span class="annot"><span class="annottext">NatCmmDecl statics instr
</span><a href="#local-6989586621682883128"><span class="hs-identifier hs-var">alloced</span></a></span><span>
</span><span id="line-571"></span><span>                           </span><span class="annot"><span class="hs-identifier hs-type">return</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621682883133"><span class="hs-identifier hs-type">alloced'</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="#local-6989586621682883130"><span class="hs-identifier hs-type">ra_stats</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="#local-6989586621682883134"><span class="hs-identifier hs-type">stack_updt_blks</span></a></span><span> </span><span class="hs-special">)</span><span>
</span><span id="line-572"></span><span>
</span><span id="line-573"></span><span>                </span><span class="hs-keyword">let</span><span> </span><span class="hs-special">(</span><span class="hs-special">(</span><span id="local-6989586621682883135"><span class="annot"><span class="annottext">[NatCmmDecl statics instr]
</span><a href="#local-6989586621682883135"><span class="hs-identifier hs-var hs-var">alloced</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682883136"><span class="annot"><span class="annottext">[Maybe RegAllocStats]
</span><a href="#local-6989586621682883136"><span class="hs-identifier hs-var hs-var">regAllocStats</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682883137"><span class="annot"><span class="annottext">[[(Label, Label)]]
</span><a href="#local-6989586621682883137"><span class="hs-identifier hs-var hs-var">stack_updt_blks</span></a></span></span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span id="local-6989586621682883138"><span class="annot"><span class="annottext">DUniqSupply
</span><a href="#local-6989586621682883138"><span class="hs-identifier hs-var hs-var">usAlloc</span></a></span></span><span class="hs-special">)</span><span>
</span><span id="line-574"></span><span>                        </span><span class="hs-glyph">=</span><span> </span><span class="hs-pragma">{-# SCC</span><span> </span><span class="hs-pragma">&quot;RegAlloc-linear&quot;</span><span> </span><span class="hs-pragma">#-}</span><span>
</span><span id="line-575"></span><span>                          </span><span class="annot"><span class="annottext">DUniqSupply
-&gt; UniqDSM
     ([NatCmmDecl statics instr], [Maybe RegAllocStats],
      [[(Label, Label)]])
-&gt; (([NatCmmDecl statics instr], [Maybe RegAllocStats],
     [[(Label, Label)]]),
    DUniqSupply)
forall a. DUniqSupply -&gt; UniqDSM a -&gt; (a, DUniqSupply)
</span><a href="GHC.Types.Unique.DSM.html#runUniqueDSM"><span class="hs-identifier hs-var">runUniqueDSM</span></a></span><span> </span><span class="annot"><span class="annottext">DUniqSupply
</span><a href="#local-6989586621682883080"><span class="hs-identifier hs-var">usLive</span></a></span><span>
</span><span id="line-576"></span><span>                          </span><span class="annot"><span class="annottext">(UniqDSM
   ([NatCmmDecl statics instr], [Maybe RegAllocStats],
    [[(Label, Label)]])
 -&gt; (([NatCmmDecl statics instr], [Maybe RegAllocStats],
      [[(Label, Label)]]),
     DUniqSupply))
-&gt; UniqDSM
     ([NatCmmDecl statics instr], [Maybe RegAllocStats],
      [[(Label, Label)]])
-&gt; (([NatCmmDecl statics instr], [Maybe RegAllocStats],
     [[(Label, Label)]]),
    DUniqSupply)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">([(NatCmmDecl statics instr, Maybe RegAllocStats,
   [(Label, Label)])]
 -&gt; ([NatCmmDecl statics instr], [Maybe RegAllocStats],
     [[(Label, Label)]]))
-&gt; UniqDSM
     [(NatCmmDecl statics instr, Maybe RegAllocStats, [(Label, Label)])]
-&gt; UniqDSM
     ([NatCmmDecl statics instr], [Maybe RegAllocStats],
      [[(Label, Label)]])
forall (m :: * -&gt; *) a1 r. Monad m =&gt; (a1 -&gt; r) -&gt; m a1 -&gt; m r
</span><span class="hs-identifier hs-var">liftM</span></span><span> </span><span class="annot"><span class="annottext">[(NatCmmDecl statics instr, Maybe RegAllocStats, [(Label, Label)])]
-&gt; ([NatCmmDecl statics instr], [Maybe RegAllocStats],
    [[(Label, Label)]])
forall a b c. [(a, b, c)] -&gt; ([a], [b], [c])
</span><span class="hs-identifier hs-var">unzip3</span></span><span>
</span><span id="line-577"></span><span>                          </span><span class="annot"><span class="annottext">(UniqDSM
   [(NatCmmDecl statics instr, Maybe RegAllocStats, [(Label, Label)])]
 -&gt; UniqDSM
      ([NatCmmDecl statics instr], [Maybe RegAllocStats],
       [[(Label, Label)]]))
-&gt; UniqDSM
     [(NatCmmDecl statics instr, Maybe RegAllocStats, [(Label, Label)])]
-&gt; UniqDSM
     ([NatCmmDecl statics instr], [Maybe RegAllocStats],
      [[(Label, Label)]])
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">(LiveCmmDecl statics instr
 -&gt; UniqDSM
      (NatCmmDecl statics instr, Maybe RegAllocStats, [(Label, Label)]))
-&gt; [LiveCmmDecl statics instr]
-&gt; UniqDSM
     [(NatCmmDecl statics instr, Maybe RegAllocStats, [(Label, Label)])]
forall (t :: * -&gt; *) (m :: * -&gt; *) a b.
(Traversable t, Monad m) =&gt;
(a -&gt; m b) -&gt; t a -&gt; m (t b)
forall (m :: * -&gt; *) a b. Monad m =&gt; (a -&gt; m b) -&gt; [a] -&gt; m [b]
</span><span class="hs-identifier hs-var">mapM</span></span><span> </span><span class="annot"><span class="annottext">LiveCmmDecl statics instr
-&gt; UniqDSM
     (NatCmmDecl statics instr, Maybe RegAllocStats, [(Label, Label)])
</span><a href="#local-6989586621682883126"><span class="hs-identifier hs-var">reg_alloc</span></a></span><span> </span><span class="annot"><span class="annottext">[LiveCmmDecl statics instr]
</span><a href="#local-6989586621682883079"><span class="hs-identifier hs-var">withLiveness</span></a></span><span>
</span><span id="line-578"></span><span>
</span><span id="line-579"></span><span>                </span><span class="annot"><span class="annottext">Logger -&gt; DumpFlag -&gt; String -&gt; DumpFormat -&gt; SDoc -&gt; IO ()
</span><a href="GHC.Utils.Logger.html#putDumpFileMaybe"><span class="hs-identifier hs-var">putDumpFileMaybe</span></a></span><span> </span><span class="annot"><span class="annottext">Logger
</span><a href="#local-6989586621682883043"><span class="hs-identifier hs-var">logger</span></a></span><span>
</span><span id="line-580"></span><span>                        </span><span class="annot"><span class="annottext">DumpFlag
</span><a href="GHC.Driver.Flags.html#Opt_D_dump_asm_regalloc"><span class="hs-identifier hs-var">Opt_D_dump_asm_regalloc</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;Registers allocated&quot;</span></span><span>
</span><span id="line-581"></span><span>                        </span><span class="annot"><span class="annottext">DumpFormat
</span><a href="GHC.Utils.Logger.html#FormatCMM"><span class="hs-identifier hs-var">FormatCMM</span></a></span><span>
</span><span id="line-582"></span><span>                        </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[SDoc] -&gt; SDoc
forall doc. IsDoc doc =&gt; [doc] -&gt; doc
</span><a href="GHC.Utils.Outputable.html#vcat"><span class="hs-identifier hs-var">vcat</span></a></span><span> </span><span class="annot"><span class="annottext">([SDoc] -&gt; SDoc) -&gt; [SDoc] -&gt; SDoc
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">(NatCmmDecl statics instr -&gt; SDoc)
-&gt; [NatCmmDecl statics instr] -&gt; [SDoc]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><span class="hs-identifier hs-var">map</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">NcgImpl statics instr jumpDest -&gt; NatCmmDecl statics instr -&gt; SDoc
forall statics instr jumpDest.
NcgImpl statics instr jumpDest -&gt; NatCmmDecl statics instr -&gt; SDoc
</span><a href="GHC.CmmToAsm.Monad.html#pprNatCmmDeclS"><span class="hs-identifier hs-var">pprNatCmmDeclS</span></a></span><span> </span><span class="annot"><span class="annottext">NcgImpl statics instr jumpDest
</span><a href="#local-6989586621682883044"><span class="hs-identifier hs-var">ncgImpl</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[NatCmmDecl statics instr]
</span><a href="#local-6989586621682883135"><span class="hs-identifier hs-var">alloced</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-583"></span><span>
</span><span id="line-584"></span><span>                </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621682883141"><span class="annot"><span class="annottext">mPprStats :: Maybe [RegAllocStats]
</span><a href="#local-6989586621682883141"><span class="hs-identifier hs-var hs-var hs-var">mPprStats</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-585"></span><span>                        </span><span class="hs-keyword">if</span><span> </span><span class="annot"><span class="annottext">Logger -&gt; DumpFlag -&gt; Bool
</span><a href="GHC.Utils.Logger.html#logHasDumpFlag"><span class="hs-identifier hs-var">logHasDumpFlag</span></a></span><span> </span><span class="annot"><span class="annottext">Logger
</span><a href="#local-6989586621682883043"><span class="hs-identifier hs-var">logger</span></a></span><span> </span><span class="annot"><span class="annottext">DumpFlag
</span><a href="GHC.Driver.Flags.html#Opt_D_dump_asm_stats"><span class="hs-identifier hs-var">Opt_D_dump_asm_stats</span></a></span><span>
</span><span id="line-586"></span><span>                         </span><span class="hs-keyword">then</span><span> </span><span class="annot"><span class="annottext">[RegAllocStats] -&gt; Maybe [RegAllocStats]
forall a. a -&gt; Maybe a
</span><span class="hs-identifier hs-var">Just</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[Maybe RegAllocStats] -&gt; [RegAllocStats]
forall a. [Maybe a] -&gt; [a]
</span><span class="hs-identifier hs-var">catMaybes</span></span><span> </span><span class="annot"><span class="annottext">[Maybe RegAllocStats]
</span><a href="#local-6989586621682883136"><span class="hs-identifier hs-var">regAllocStats</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-keyword">else</span><span> </span><span class="annot"><span class="annottext">Maybe [RegAllocStats]
forall a. Maybe a
</span><span class="hs-identifier hs-var">Nothing</span></span><span>
</span><span id="line-587"></span><span>
</span><span id="line-588"></span><span>                </span><span class="hs-comment">-- force evaluation of the Maybe to avoid space leak</span><span>
</span><span id="line-589"></span><span>                </span><span class="annot"><span class="annottext">Maybe [RegAllocStats]
</span><a href="#local-6989586621682883141"><span class="hs-identifier hs-var">mPprStats</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe [RegAllocStats] -&gt; IO () -&gt; IO ()
forall a b. a -&gt; b -&gt; b
</span><span class="hs-operator hs-var">`seq`</span></span><span> </span><span class="annot"><span class="annottext">() -&gt; IO ()
forall a. a -&gt; IO a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-590"></span><span>
</span><span id="line-591"></span><span>                </span><span class="annot"><span class="annottext">([NatCmmDecl statics instr], DUniqSupply,
 Maybe [RegAllocStats statics instr], Maybe [RegAllocStats],
 [RegAllocStats], [(Label, Label)])
-&gt; IO
     ([NatCmmDecl statics instr], DUniqSupply,
      Maybe [RegAllocStats statics instr], Maybe [RegAllocStats],
      [RegAllocStats], [(Label, Label)])
forall a. a -&gt; IO a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span>  </span><span class="hs-special">(</span><span> </span><span class="annot"><span class="annottext">[NatCmmDecl statics instr]
</span><a href="#local-6989586621682883135"><span class="hs-identifier hs-var">alloced</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">DUniqSupply
</span><a href="#local-6989586621682883138"><span class="hs-identifier hs-var">usAlloc</span></a></span><span>
</span><span id="line-592"></span><span>                        </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Maybe [RegAllocStats statics instr]
forall a. Maybe a
</span><span class="hs-identifier hs-var">Nothing</span></span><span>
</span><span id="line-593"></span><span>                        </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Maybe [RegAllocStats]
</span><a href="#local-6989586621682883141"><span class="hs-identifier hs-var">mPprStats</span></a></span><span class="hs-special">,</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[Maybe RegAllocStats] -&gt; [RegAllocStats]
forall a. [Maybe a] -&gt; [a]
</span><span class="hs-identifier hs-var">catMaybes</span></span><span> </span><span class="annot"><span class="annottext">[Maybe RegAllocStats]
</span><a href="#local-6989586621682883136"><span class="hs-identifier hs-var">regAllocStats</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-594"></span><span>                        </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">[[(Label, Label)]] -&gt; [(Label, Label)]
forall (t :: * -&gt; *) a. Foldable t =&gt; t [a] -&gt; [a]
</span><span class="hs-identifier hs-var">concat</span></span><span> </span><span class="annot"><span class="annottext">[[(Label, Label)]]
</span><a href="#local-6989586621682883137"><span class="hs-identifier hs-var">stack_updt_blks</span></a></span><span> </span><span class="hs-special">)</span><span>
</span><span id="line-595"></span><span>
</span><span id="line-596"></span><span>        </span><span class="hs-comment">-- Fixupblocks the register allocator inserted (from, regMoves, to)</span><span>
</span><span id="line-597"></span><span>        </span><span class="hs-keyword">let</span><span> </span><span class="annot"><a href="#local-6989586621682883143"><span class="hs-identifier hs-type">cfgRegAllocUpdates</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><span class="hs-special">(</span><span class="annot"><a href="GHC.Cmm.BlockId.html#BlockId"><span class="hs-identifier hs-type">BlockId</span></a></span><span class="hs-special">,</span><span class="annot"><a href="GHC.Cmm.BlockId.html#BlockId"><span class="hs-identifier hs-type">BlockId</span></a></span><span class="hs-special">,</span><span class="annot"><a href="GHC.Cmm.BlockId.html#BlockId"><span class="hs-identifier hs-type">BlockId</span></a></span><span class="hs-special">)</span><span class="hs-special">]</span><span>
</span><span id="line-598"></span><span>            </span><span id="local-6989586621682883143"><span class="annot"><a href="#local-6989586621682883143"><span class="hs-identifier hs-var hs-var">cfgRegAllocUpdates</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(RegAllocStats -&gt; [(Label, Label, Label)])
-&gt; [RegAllocStats] -&gt; [(Label, Label, Label)]
forall (t :: * -&gt; *) a b. Foldable t =&gt; (a -&gt; [b]) -&gt; t a -&gt; [b]
</span><span class="hs-identifier hs-var">concatMap</span></span><span> </span><span class="annot"><span class="annottext">RegAllocStats -&gt; [(Label, Label, Label)]
</span><a href="GHC.CmmToAsm.Reg.Linear.Base.html#ra_fixupList"><span class="hs-identifier hs-var">Linear.ra_fixupList</span></a></span><span> </span><span class="annot"><span class="annottext">[RegAllocStats]
</span><a href="#local-6989586621682883089"><span class="hs-identifier hs-var">raStats</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-599"></span><span>
</span><span id="line-600"></span><span>        </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621682883147"><span class="annot"><a href="#local-6989586621682883147"><span class="hs-identifier hs-var hs-var">cfgWithFixupBlks</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-601"></span><span>                </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span id="local-6989586621682883148"><span class="annot"><span class="annottext">CFG
</span><a href="#local-6989586621682883148"><span class="hs-identifier hs-var">cfg</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Weights -&gt; CFG -&gt; [(Label, Label, Label)] -&gt; CFG
</span><a href="GHC.CmmToAsm.CFG.html#addNodesBetween"><span class="hs-identifier hs-var">addNodesBetween</span></a></span><span> </span><span class="annot"><span class="annottext">Weights
</span><a href="#local-6989586621682883053"><span class="hs-identifier hs-var">weights</span></a></span><span> </span><span class="annot"><span class="annottext">CFG
</span><a href="#local-6989586621682883148"><span class="hs-identifier hs-var">cfg</span></a></span><span> </span><span class="annot"><span class="annottext">[(Label, Label, Label)]
</span><a href="#local-6989586621682883143"><span class="hs-identifier hs-var">cfgRegAllocUpdates</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(CFG -&gt; CFG) -&gt; Maybe CFG -&gt; Maybe CFG
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="annot"><span class="annottext">Maybe CFG
</span><a href="#local-6989586621682883077"><span class="hs-identifier hs-var">livenessCfg</span></a></span><span>
</span><span id="line-602"></span><span>
</span><span id="line-603"></span><span>        </span><span class="hs-comment">-- Insert stack update blocks</span><span>
</span><span id="line-604"></span><span>        </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621682883150"><span class="annot"><a href="#local-6989586621682883150"><span class="hs-identifier hs-var hs-var">postRegCFG</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-605"></span><span>                </span><span class="annot"><span class="annottext">(CFG -&gt; [(Label, Label)] -&gt; CFG)
-&gt; Maybe (CFG -&gt; [(Label, Label)] -&gt; CFG)
forall a. a -&gt; Maybe a
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">pure</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(CFG -&gt; (Label, Label) -&gt; CFG) -&gt; CFG -&gt; [(Label, Label)] -&gt; CFG
forall b a. (b -&gt; a -&gt; b) -&gt; b -&gt; [a] -&gt; b
forall (t :: * -&gt; *) b a.
Foldable t =&gt;
(b -&gt; a -&gt; b) -&gt; b -&gt; t a -&gt; b
</span><span class="hs-identifier hs-var">foldl'</span></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span id="local-6989586621682883151"><span class="annot"><span class="annottext">CFG
</span><a href="#local-6989586621682883151"><span class="hs-identifier hs-var">m</span></a></span></span><span> </span><span class="hs-special">(</span><span id="local-6989586621682883152"><span class="annot"><span class="annottext">Label
</span><a href="#local-6989586621682883152"><span class="hs-identifier hs-var">from</span></a></span></span><span class="hs-special">,</span><span id="local-6989586621682883153"><span class="annot"><span class="annottext">Label
</span><a href="#local-6989586621682883153"><span class="hs-identifier hs-var">to</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Weights -&gt; Label -&gt; Label -&gt; CFG -&gt; CFG
</span><a href="GHC.CmmToAsm.CFG.html#addImmediateSuccessor"><span class="hs-identifier hs-var">addImmediateSuccessor</span></a></span><span> </span><span class="annot"><span class="annottext">Weights
</span><a href="#local-6989586621682883053"><span class="hs-identifier hs-var">weights</span></a></span><span> </span><span class="annot"><span class="annottext">Label
</span><a href="#local-6989586621682883152"><span class="hs-identifier hs-var">from</span></a></span><span> </span><span class="annot"><span class="annottext">Label
</span><a href="#local-6989586621682883153"><span class="hs-identifier hs-var">to</span></a></span><span> </span><span class="annot"><span class="annottext">CFG
</span><a href="#local-6989586621682883151"><span class="hs-identifier hs-var">m</span></a></span><span> </span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-606"></span><span>                     </span><span class="annot"><span class="annottext">Maybe (CFG -&gt; [(Label, Label)] -&gt; CFG)
-&gt; Maybe CFG -&gt; Maybe ([(Label, Label)] -&gt; CFG)
forall a b. Maybe (a -&gt; b) -&gt; Maybe a -&gt; Maybe b
forall (f :: * -&gt; *) a b. Applicative f =&gt; f (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;*&gt;</span></span><span> </span><span class="annot"><span class="annottext">Maybe CFG
</span><a href="#local-6989586621682883147"><span class="hs-identifier hs-var">cfgWithFixupBlks</span></a></span><span>
</span><span id="line-607"></span><span>                     </span><span class="annot"><span class="annottext">Maybe ([(Label, Label)] -&gt; CFG)
-&gt; Maybe [(Label, Label)] -&gt; Maybe CFG
forall a b. Maybe (a -&gt; b) -&gt; Maybe a -&gt; Maybe b
forall (f :: * -&gt; *) a b. Applicative f =&gt; f (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;*&gt;</span></span><span> </span><span class="annot"><span class="annottext">[(Label, Label)] -&gt; Maybe [(Label, Label)]
forall a. a -&gt; Maybe a
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">pure</span></span><span> </span><span class="annot"><span class="annottext">[(Label, Label)]
</span><a href="#local-6989586621682883090"><span class="hs-identifier hs-var">stack_updt_blks</span></a></span><span>
</span><span id="line-608"></span><span>
</span><span id="line-609"></span><span>        </span><span class="hs-comment">---- generate jump tables</span><span>
</span><span id="line-610"></span><span>        </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621682883155"><span class="annot"><a href="#local-6989586621682883155"><span class="hs-identifier hs-var hs-var">tabled</span></a></span></span><span>      </span><span class="hs-glyph">=</span><span>
</span><span id="line-611"></span><span>                </span><span class="hs-pragma">{-# SCC</span><span> </span><span class="hs-pragma">&quot;generateJumpTables&quot;</span><span> </span><span class="hs-pragma">#-}</span><span>
</span><span id="line-612"></span><span>                </span><span class="annot"><span class="annottext">NcgImpl statics instr jumpDest
-&gt; [NatCmmDecl statics instr] -&gt; [NatCmmDecl statics instr]
forall statics instr jumpDest.
NcgImpl statics instr jumpDest
-&gt; [NatCmmDecl statics instr] -&gt; [NatCmmDecl statics instr]
</span><a href="GHC.CmmToAsm.html#generateJumpTables"><span class="hs-identifier hs-var">generateJumpTables</span></a></span><span> </span><span class="annot"><span class="annottext">NcgImpl statics instr jumpDest
</span><a href="#local-6989586621682883044"><span class="hs-identifier hs-var">ncgImpl</span></a></span><span> </span><span class="annot"><span class="annottext">[NatCmmDecl statics instr]
</span><a href="#local-6989586621682883085"><span class="hs-identifier hs-var">alloced</span></a></span><span>
</span><span id="line-613"></span><span>
</span><span id="line-614"></span><span>        </span><span class="annot"><span class="hs-identifier hs-type">when</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">not</span></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">null</span></span><span> </span><span class="annot"><a href="#local-6989586621682883070"><span class="hs-identifier hs-type">nativeCfgWeights</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="annot"><a href="GHC.Utils.Logger.html#putDumpFileMaybe"><span class="hs-identifier hs-type">putDumpFileMaybe</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682883043"><span class="hs-identifier hs-type">logger</span></a></span><span>
</span><span id="line-615"></span><span>                </span><span class="annot"><a href="GHC.Driver.Flags.html#Opt_D_dump_cfg_weights"><span class="hs-identifier hs-type">Opt_D_dump_cfg_weights</span></a></span><span> </span><span class="annot"><span class="hs-string">&quot;CFG Update information&quot;</span></span><span>
</span><span id="line-616"></span><span>                </span><span class="annot"><a href="GHC.Utils.Logger.html#FormatText"><span class="hs-identifier hs-type">FormatText</span></a></span><span>
</span><span id="line-617"></span><span>                </span><span class="hs-special">(</span><span> </span><span class="annot"><a href="GHC.Utils.Outputable.html#text"><span class="hs-identifier hs-type">text</span></a></span><span> </span><span class="annot"><span class="hs-string">&quot;stack:&quot;</span></span><span> </span><span class="annot"><a href="GHC.Utils.Outputable.html#%3C%2B%3E"><span class="hs-operator hs-type">&lt;+&gt;</span></a></span><span> </span><span class="annot"><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-type">ppr</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682883090"><span class="hs-identifier hs-type">stack_updt_blks</span></a></span><span> </span><span class="annot"><a href="GHC.Utils.Outputable.html#%24%24"><span class="hs-operator hs-type">$$</span></a></span><span>
</span><span id="line-618"></span><span>                  </span><span class="annot"><a href="GHC.Utils.Outputable.html#text"><span class="hs-identifier hs-type">text</span></a></span><span> </span><span class="annot"><span class="hs-string">&quot;linearAlloc:&quot;</span></span><span> </span><span class="annot"><a href="GHC.Utils.Outputable.html#%3C%2B%3E"><span class="hs-operator hs-type">&lt;+&gt;</span></a></span><span> </span><span class="annot"><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-type">ppr</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682883143"><span class="hs-identifier hs-type">cfgRegAllocUpdates</span></a></span><span> </span><span class="hs-special">)</span><span>
</span><span id="line-619"></span><span>
</span><span id="line-620"></span><span>        </span><span class="hs-comment">---- shortcut branches</span><span>
</span><span id="line-621"></span><span>        </span><span class="hs-keyword">let</span><span> </span><span class="hs-special">(</span><span id="local-6989586621682883159"><span class="annot"><a href="#local-6989586621682883159"><span class="hs-identifier hs-var">shorted</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682883160"><span class="annot"><a href="#local-6989586621682883160"><span class="hs-identifier hs-var">postShortCFG</span></a></span></span><span class="hs-special">)</span><span>     </span><span class="hs-glyph">=</span><span>
</span><span id="line-622"></span><span>                </span><span class="hs-pragma">{-# SCC</span><span> </span><span class="hs-pragma">&quot;shortcutBranches&quot;</span><span> </span><span class="hs-pragma">#-}</span><span>
</span><span id="line-623"></span><span>                </span><span class="annot"><a href="GHC.CmmToAsm.html#shortcutBranches"><span class="hs-identifier hs-type">shortcutBranches</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682883050"><span class="hs-identifier hs-type">config</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682883044"><span class="hs-identifier hs-type">ncgImpl</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682883155"><span class="hs-identifier hs-type">tabled</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682883150"><span class="hs-identifier hs-type">postRegCFG</span></a></span><span>
</span><span id="line-624"></span><span>
</span><span id="line-625"></span><span>        </span><span class="hs-keyword">let</span><span> </span><span class="annot"><a href="#local-6989586621682883162"><span class="hs-identifier hs-type">optimizedCFG</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Maybe</span></span><span> </span><span class="annot"><a href="GHC.CmmToAsm.CFG.html#CFG"><span class="hs-identifier hs-type">CFG</span></a></span><span>
</span><span id="line-626"></span><span>            </span><span id="local-6989586621682883162"><span class="annot"><a href="#local-6989586621682883162"><span class="hs-identifier hs-var hs-var">optimizedCFG</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-627"></span><span>                </span><span class="annot"><span class="annottext">Bool -&gt; Weights -&gt; RawCmmDecl -&gt; CFG -&gt; CFG
</span><a href="GHC.CmmToAsm.CFG.html#optimizeCFG"><span class="hs-identifier hs-var">optimizeCFG</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">NCGConfig -&gt; Bool
</span><a href="GHC.CmmToAsm.Config.html#ncgCmmStaticPred"><span class="hs-identifier hs-var">ncgCmmStaticPred</span></a></span><span> </span><span class="annot"><span class="annottext">NCGConfig
</span><a href="#local-6989586621682883050"><span class="hs-identifier hs-var">config</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Weights
</span><a href="#local-6989586621682883053"><span class="hs-identifier hs-var">weights</span></a></span><span> </span><span class="annot"><span class="annottext">RawCmmDecl
</span><a href="#local-6989586621682883048"><span class="hs-identifier hs-var">cmm</span></a></span><span> </span><span class="annot"><span class="annottext">(CFG -&gt; CFG) -&gt; Maybe CFG -&gt; Maybe CFG
forall (m :: * -&gt; *) a1 r. Monad m =&gt; (a1 -&gt; r) -&gt; m a1 -&gt; m r
</span><span class="hs-operator hs-var">&lt;$!&gt;</span></span><span> </span><span class="annot"><span class="annottext">Maybe CFG
</span><a href="#local-6989586621682883160"><span class="hs-identifier hs-var">postShortCFG</span></a></span><span>
</span><span id="line-628"></span><span>
</span><span id="line-629"></span><span>        </span><span class="annot"><a href="GHC.CmmToAsm.html#maybeDumpCfg"><span class="hs-identifier hs-type">maybeDumpCfg</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682883043"><span class="hs-identifier hs-type">logger</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682883162"><span class="hs-identifier hs-type">optimizedCFG</span></a></span><span> </span><span class="annot"><span class="hs-string">&quot;CFG Weights - Final&quot;</span></span><span> </span><span class="annot"><a href="#local-6989586621682883055"><span class="hs-identifier hs-type">proc_name</span></a></span><span>
</span><span id="line-630"></span><span>
</span><span id="line-631"></span><span>        </span><span class="hs-comment">--TODO: Partially check validity of the cfg.</span><span>
</span><span id="line-632"></span><span>        </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621682883166"><span class="annot"><a href="#local-6989586621682883166"><span class="hs-identifier hs-var hs-var">getBlks</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Cmm.html#CmmProc"><span class="hs-identifier hs-type">CmmProc</span></a></span><span> </span><span id="local-6989586621682883167"><span class="annot"><span class="annottext">h
</span><a href="#local-6989586621682883167"><span class="hs-identifier hs-var">_info</span></a></span></span><span> </span><span id="local-6989586621682883168"><span class="annot"><span class="annottext">CLabel
</span><a href="#local-6989586621682883168"><span class="hs-identifier hs-var">_lbl</span></a></span></span><span> </span><span id="local-6989586621682883169"><span class="annot"><span class="annottext">[GlobalRegUse]
</span><a href="#local-6989586621682883169"><span class="hs-identifier hs-var">_live</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Cmm.html#ListGraph"><span class="hs-identifier hs-type">ListGraph</span></a></span><span> </span><span id="local-6989586621682883171"><span class="annot"><span class="annottext">[GenBasicBlock i]
</span><a href="#local-6989586621682883171"><span class="hs-identifier hs-var">blocks</span></a></span></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[GenBasicBlock i]
</span><a href="#local-6989586621682883171"><span class="hs-identifier hs-var">blocks</span></a></span><span>
</span><span id="line-633"></span><span>            </span><span class="annot"><a href="#local-6989586621682883166"><span class="hs-identifier hs-var">getBlks</span></a></span><span> </span><span class="annot"><span class="annottext">GenCmmDecl d h (ListGraph i)
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span>
</span><span id="line-634"></span><span>
</span><span id="line-635"></span><span>        </span><span class="annot"><span class="hs-identifier hs-type">when</span></span><span> </span><span class="hs-special">(</span><span> </span><span class="annot"><a href="GHC.CmmToAsm.Config.html#ncgEnableDeadCodeElimination"><span class="hs-identifier hs-var">ncgEnableDeadCodeElimination</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682883050"><span class="hs-identifier hs-type">config</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">&amp;&amp;</span></span><span>
</span><span id="line-636"></span><span>                </span><span class="hs-special">(</span><span class="annot"><a href="GHC.CmmToAsm.Config.html#ncgAsmLinting"><span class="hs-identifier hs-var">ncgAsmLinting</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682883050"><span class="hs-identifier hs-type">config</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">||</span></span><span> </span><span class="annot"><a href="GHC.Utils.Constants.html#debugIsOn"><span class="hs-identifier hs-type">debugIsOn</span></a></span><span> </span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-637"></span><span>                </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621682883174"><span class="annot"><a href="#local-6989586621682883174"><span class="hs-identifier hs-var hs-var">blocks</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(NatCmmDecl statics instr -&gt; [GenBasicBlock instr])
-&gt; [NatCmmDecl statics instr] -&gt; [GenBasicBlock instr]
forall (t :: * -&gt; *) a b. Foldable t =&gt; (a -&gt; [b]) -&gt; t a -&gt; [b]
</span><span class="hs-identifier hs-var">concatMap</span></span><span> </span><span class="annot"><span class="annottext">NatCmmDecl statics instr -&gt; [GenBasicBlock instr]
forall {d} {h} {i}.
GenCmmDecl d h (ListGraph i) -&gt; [GenBasicBlock i]
</span><a href="#local-6989586621682883166"><span class="hs-identifier hs-var">getBlks</span></a></span><span> </span><span class="annot"><span class="annottext">[NatCmmDecl statics instr]
</span><a href="#local-6989586621682883159"><span class="hs-identifier hs-var">shorted</span></a></span><span>
</span><span id="line-638"></span><span>                </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621682883175"><span class="annot"><a href="#local-6989586621682883175"><span class="hs-identifier hs-var hs-var">labels</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[Label] -&gt; LabelSet
</span><a href="GHC.Cmm.Dataflow.Label.html#setFromList"><span class="hs-identifier hs-var">setFromList</span></a></span><span> </span><span class="annot"><span class="annottext">([Label] -&gt; LabelSet) -&gt; [Label] -&gt; LabelSet
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">(GenBasicBlock instr -&gt; Label) -&gt; [GenBasicBlock instr] -&gt; [Label]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-identifier hs-var">fmap</span></span><span> </span><span class="annot"><span class="annottext">GenBasicBlock instr -&gt; Label
forall i. GenBasicBlock i -&gt; Label
</span><a href="GHC.Cmm.html#blockId"><span class="hs-identifier hs-var">blockId</span></a></span><span> </span><span class="annot"><span class="annottext">[GenBasicBlock instr]
</span><a href="#local-6989586621682883174"><span class="hs-identifier hs-var">blocks</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Cmm.Dataflow.Label.html#LabelSet"><span class="hs-identifier hs-type">LabelSet</span></a></span><span>
</span><span id="line-639"></span><span>                </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621682883180"><span class="annot"><a href="#local-6989586621682883180"><span class="hs-identifier hs-var hs-var">cfg</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Maybe CFG -&gt; CFG
forall a. HasCallStack =&gt; Maybe a -&gt; a
</span><span class="hs-identifier hs-var">fromJust</span></span><span> </span><span class="annot"><span class="annottext">Maybe CFG
</span><a href="#local-6989586621682883162"><span class="hs-identifier hs-var">optimizedCFG</span></a></span><span>
</span><span id="line-640"></span><span>                </span><span class="annot"><span class="hs-identifier hs-type">return</span></span><span> </span><span class="annot"><span class="hs-operator hs-type">$!</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">seq</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.CmmToAsm.CFG.html#sanityCheckCfg"><span class="hs-identifier hs-type">sanityCheckCfg</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682883180"><span class="hs-identifier hs-type">cfg</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682883175"><span class="hs-identifier hs-type">labels</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span>
</span><span id="line-641"></span><span>                                </span><span class="annot"><a href="GHC.Utils.Outputable.html#text"><span class="hs-identifier hs-type">text</span></a></span><span> </span><span class="annot"><span class="hs-string">&quot;cfg not in lockstep&quot;</span></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-642"></span><span>
</span><span id="line-643"></span><span>        </span><span class="hs-comment">---- sequence blocks</span><span>
</span><span id="line-644"></span><span>        </span><span class="hs-comment">-- sequenced :: [NatCmmDecl statics instr]</span><span>
</span><span id="line-645"></span><span>        </span><span class="hs-keyword">let</span><span> </span><span class="hs-special">(</span><span id="local-6989586621682883184"><span class="annot"><a href="#local-6989586621682883184"><span class="hs-identifier hs-var">sequenced</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682883185"><span class="annot"><a href="#local-6989586621682883185"><span class="hs-identifier hs-var">us_seq</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-646"></span><span>                        </span><span class="hs-pragma">{-# SCC</span><span> </span><span class="hs-pragma">&quot;sequenceBlocks&quot;</span><span> </span><span class="hs-pragma">#-}</span><span>
</span><span id="line-647"></span><span>                        </span><span class="annot"><a href="GHC.Types.Unique.DSM.html#runUniqueDSM"><span class="hs-identifier hs-type">runUniqueDSM</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682883086"><span class="hs-identifier hs-type">usAlloc</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">mapM</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.CmmToAsm.BlockLayout.html#sequenceTop"><span class="hs-identifier hs-type">BlockLayout.sequenceTop</span></a></span><span>
</span><span id="line-648"></span><span>                                </span><span class="annot"><a href="#local-6989586621682883044"><span class="hs-identifier hs-type">ncgImpl</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682883162"><span class="hs-identifier hs-type">optimizedCFG</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-649"></span><span>                            </span><span class="annot"><a href="#local-6989586621682883159"><span class="hs-identifier hs-type">shorted</span></a></span><span>
</span><span id="line-650"></span><span>
</span><span id="line-651"></span><span>        </span><span class="annot"><a href="GHC.Utils.Panic.Plain.html#massert"><span class="hs-identifier hs-type">massert</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.CmmToAsm.html#checkLayout"><span class="hs-identifier hs-type">checkLayout</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682883159"><span class="hs-identifier hs-type">shorted</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682883184"><span class="hs-identifier hs-type">sequenced</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-652"></span><span>
</span><span id="line-653"></span><span>        </span><span class="hs-keyword">let</span><span> </span><span class="annot"><a href="#local-6989586621682883189"><span class="hs-identifier hs-type">branchOpt</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="GHC.CmmToAsm.Types.html#NatCmmDecl"><span class="hs-identifier hs-type">NatCmmDecl</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682882231"><span class="hs-identifier hs-type">statics</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682882230"><span class="hs-identifier hs-type">instr</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-654"></span><span>            </span><span id="local-6989586621682883189"><span class="annot"><a href="#local-6989586621682883189"><span class="hs-identifier hs-var hs-var">branchOpt</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-655"></span><span>                </span><span class="hs-pragma">{-# SCC</span><span> </span><span class="hs-pragma">&quot;invertCondBranches&quot;</span><span> </span><span class="hs-pragma">#-}</span><span>
</span><span id="line-656"></span><span>                </span><span class="annot"><span class="annottext">(NatCmmDecl statics instr -&gt; NatCmmDecl statics instr)
-&gt; [NatCmmDecl statics instr] -&gt; [NatCmmDecl statics instr]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><span class="hs-identifier hs-var">map</span></span><span> </span><span class="annot"><span class="annottext">NatCmmDecl statics instr -&gt; NatCmmDecl statics instr
</span><a href="#local-6989586621682883190"><span class="hs-identifier hs-var">invert</span></a></span><span> </span><span class="annot"><span class="annottext">[NatCmmDecl statics instr]
</span><a href="#local-6989586621682883184"><span class="hs-identifier hs-var">sequenced</span></a></span><span>
</span><span id="line-657"></span><span>              </span><span class="hs-keyword">where</span><span>
</span><span id="line-658"></span><span>                </span><span class="annot"><a href="#local-6989586621682883191"><span class="hs-identifier hs-type">invertConds</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Cmm.Dataflow.Label.html#LabelMap"><span class="hs-identifier hs-type">LabelMap</span></a></span><span> </span><span class="annot"><a href="GHC.Cmm.html#RawCmmStatics"><span class="hs-identifier hs-type">RawCmmStatics</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="GHC.CmmToAsm.Types.html#NatBasicBlock"><span class="hs-identifier hs-type">NatBasicBlock</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682882230"><span class="hs-identifier hs-type">instr</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-659"></span><span>                            </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="GHC.CmmToAsm.Types.html#NatBasicBlock"><span class="hs-identifier hs-type">NatBasicBlock</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682882230"><span class="hs-identifier hs-type">instr</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-660"></span><span>                </span><span id="local-6989586621682883191"><span class="annot"><span class="annottext">invertConds :: LabelMap RawCmmStatics
-&gt; [GenBasicBlock instr] -&gt; [GenBasicBlock instr]
</span><a href="#local-6989586621682883191"><span class="hs-identifier hs-var hs-var">invertConds</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">NcgImpl statics instr jumpDest
-&gt; Maybe CFG
-&gt; LabelMap RawCmmStatics
-&gt; [GenBasicBlock instr]
-&gt; [GenBasicBlock instr]
forall statics instr jumpDest.
NcgImpl statics instr jumpDest
-&gt; Maybe CFG
-&gt; LabelMap RawCmmStatics
-&gt; [NatBasicBlock instr]
-&gt; [NatBasicBlock instr]
</span><a href="GHC.CmmToAsm.Monad.html#invertCondBranches"><span class="hs-identifier hs-var">invertCondBranches</span></a></span><span> </span><span class="annot"><span class="annottext">NcgImpl statics instr jumpDest
</span><a href="#local-6989586621682883044"><span class="hs-identifier hs-var">ncgImpl</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe CFG
</span><a href="#local-6989586621682883162"><span class="hs-identifier hs-var">optimizedCFG</span></a></span><span>
</span><span id="line-661"></span><span>                </span><span id="local-6989586621682883190"><span class="annot"><span class="annottext">invert :: NatCmmDecl statics instr -&gt; NatCmmDecl statics instr
</span><a href="#local-6989586621682883190"><span class="hs-identifier hs-var hs-var">invert</span></a></span></span><span> </span><span id="local-6989586621682883193"><span class="annot"><span class="annottext">top :: NatCmmDecl statics instr
</span><a href="#local-6989586621682883193"><span class="hs-identifier hs-var">top</span></a></span></span><span class="hs-glyph">@</span><span class="annot"><a href="GHC.Cmm.html#CmmData"><span class="hs-identifier hs-type">CmmData</span></a></span><span> </span><span class="hs-special">{</span><span class="hs-special">}</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">NatCmmDecl statics instr
</span><a href="#local-6989586621682883193"><span class="hs-identifier hs-var">top</span></a></span><span>
</span><span id="line-662"></span><span>                </span><span class="annot"><a href="#local-6989586621682883190"><span class="hs-identifier hs-var">invert</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Cmm.html#CmmProc"><span class="hs-identifier hs-type">CmmProc</span></a></span><span> </span><span id="local-6989586621682883195"><span class="annot"><span class="annottext">LabelMap RawCmmStatics
</span><a href="#local-6989586621682883195"><span class="hs-identifier hs-var">info</span></a></span></span><span> </span><span id="local-6989586621682883196"><span class="annot"><span class="annottext">CLabel
</span><a href="#local-6989586621682883196"><span class="hs-identifier hs-var">lbl</span></a></span></span><span> </span><span id="local-6989586621682883197"><span class="annot"><span class="annottext">[GlobalRegUse]
</span><a href="#local-6989586621682883197"><span class="hs-identifier hs-var">live</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Cmm.html#ListGraph"><span class="hs-identifier hs-type">ListGraph</span></a></span><span> </span><span id="local-6989586621682883198"><span class="annot"><span class="annottext">[GenBasicBlock instr]
</span><a href="#local-6989586621682883198"><span class="hs-identifier hs-var">blocks</span></a></span></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-663"></span><span>                    </span><span class="annot"><span class="annottext">LabelMap RawCmmStatics
-&gt; CLabel
-&gt; [GlobalRegUse]
-&gt; ListGraph instr
-&gt; NatCmmDecl statics instr
forall d h g.
h -&gt; CLabel -&gt; [GlobalRegUse] -&gt; g -&gt; GenCmmDecl d h g
</span><a href="GHC.Cmm.html#CmmProc"><span class="hs-identifier hs-var">CmmProc</span></a></span><span> </span><span class="annot"><span class="annottext">LabelMap RawCmmStatics
</span><a href="#local-6989586621682883195"><span class="hs-identifier hs-var">info</span></a></span><span> </span><span class="annot"><span class="annottext">CLabel
</span><a href="#local-6989586621682883196"><span class="hs-identifier hs-var">lbl</span></a></span><span> </span><span class="annot"><span class="annottext">[GlobalRegUse]
</span><a href="#local-6989586621682883197"><span class="hs-identifier hs-var">live</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[GenBasicBlock instr] -&gt; ListGraph instr
forall i. [GenBasicBlock i] -&gt; ListGraph i
</span><a href="GHC.Cmm.html#ListGraph"><span class="hs-identifier hs-var">ListGraph</span></a></span><span> </span><span class="annot"><span class="annottext">([GenBasicBlock instr] -&gt; ListGraph instr)
-&gt; [GenBasicBlock instr] -&gt; ListGraph instr
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">LabelMap RawCmmStatics
-&gt; [GenBasicBlock instr] -&gt; [GenBasicBlock instr]
</span><a href="#local-6989586621682883191"><span class="hs-identifier hs-var">invertConds</span></a></span><span> </span><span class="annot"><span class="annottext">LabelMap RawCmmStatics
</span><a href="#local-6989586621682883195"><span class="hs-identifier hs-var">info</span></a></span><span> </span><span class="annot"><span class="annottext">[GenBasicBlock instr]
</span><a href="#local-6989586621682883198"><span class="hs-identifier hs-var">blocks</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-664"></span><span>
</span><span id="line-665"></span><span>        </span><span class="hs-comment">-- generate unwinding information from cmm</span><span>
</span><span id="line-666"></span><span>        </span><span class="hs-keyword">let</span><span> </span><span class="annot"><a href="#local-6989586621682883199"><span class="hs-identifier hs-type">unwinds</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.CmmToAsm.Reg.Liveness.html#BlockMap"><span class="hs-identifier hs-type">BlockMap</span></a></span><span> </span><span class="hs-special">[</span><span class="annot"><a href="GHC.Cmm.DebugBlock.html#UnwindPoint"><span class="hs-identifier hs-type">UnwindPoint</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-667"></span><span>            </span><span id="local-6989586621682883199"><span class="annot"><a href="#local-6989586621682883199"><span class="hs-identifier hs-var hs-var">unwinds</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-668"></span><span>                </span><span class="hs-pragma">{-# SCC</span><span> </span><span class="hs-pragma">&quot;unwindingInfo&quot;</span><span> </span><span class="hs-pragma">#-}</span><span>
</span><span id="line-669"></span><span>                </span><span class="annot"><span class="annottext">(LabelMap [UnwindPoint]
 -&gt; NatCmmDecl statics instr -&gt; LabelMap [UnwindPoint])
-&gt; LabelMap [UnwindPoint]
-&gt; [NatCmmDecl statics instr]
-&gt; LabelMap [UnwindPoint]
forall b a. (b -&gt; a -&gt; b) -&gt; b -&gt; [a] -&gt; b
forall (t :: * -&gt; *) b a.
Foldable t =&gt;
(b -&gt; a -&gt; b) -&gt; b -&gt; t a -&gt; b
</span><span class="hs-identifier hs-var">foldl'</span></span><span> </span><span class="annot"><span class="annottext">LabelMap [UnwindPoint]
-&gt; NatCmmDecl statics instr -&gt; LabelMap [UnwindPoint]
</span><a href="#local-6989586621682883201"><span class="hs-identifier hs-var">addUnwind</span></a></span><span> </span><span class="annot"><span class="annottext">LabelMap [UnwindPoint]
forall v. LabelMap v
</span><a href="GHC.Cmm.Dataflow.Label.html#mapEmpty"><span class="hs-identifier hs-var">mapEmpty</span></a></span><span> </span><span class="annot"><span class="annottext">[NatCmmDecl statics instr]
</span><a href="#local-6989586621682883189"><span class="hs-identifier hs-var">branchOpt</span></a></span><span>
</span><span id="line-670"></span><span>              </span><span class="hs-keyword">where</span><span>
</span><span id="line-671"></span><span>                </span><span id="local-6989586621682883201"><span class="annot"><span class="annottext">addUnwind :: LabelMap [UnwindPoint]
-&gt; NatCmmDecl statics instr -&gt; LabelMap [UnwindPoint]
</span><a href="#local-6989586621682883201"><span class="hs-identifier hs-var hs-var">addUnwind</span></a></span></span><span> </span><span id="local-6989586621682883202"><span class="annot"><span class="annottext">LabelMap [UnwindPoint]
</span><a href="#local-6989586621682883202"><span class="hs-identifier hs-var">acc</span></a></span></span><span> </span><span id="local-6989586621682883203"><span class="annot"><span class="annottext">NatCmmDecl statics instr
</span><a href="#local-6989586621682883203"><span class="hs-identifier hs-var">proc</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-672"></span><span>                    </span><span class="annot"><span class="annottext">LabelMap [UnwindPoint]
</span><a href="#local-6989586621682883202"><span class="hs-identifier hs-var">acc</span></a></span><span> </span><span class="annot"><span class="annottext">LabelMap [UnwindPoint]
-&gt; LabelMap [UnwindPoint] -&gt; LabelMap [UnwindPoint]
forall v. LabelMap v -&gt; LabelMap v -&gt; LabelMap v
</span><a href="GHC.Cmm.Dataflow.Label.html#mapUnion"><span class="hs-operator hs-var">`mapUnion`</span></a></span><span> </span><span class="annot"><span class="annottext">NCGConfig
-&gt; NcgImpl statics instr jumpDest
-&gt; NatCmmDecl statics instr
-&gt; LabelMap [UnwindPoint]
forall instr statics jumpDest.
Instruction instr =&gt;
NCGConfig
-&gt; NcgImpl statics instr jumpDest
-&gt; NatCmmDecl statics instr
-&gt; LabelMap [UnwindPoint]
</span><a href="GHC.CmmToAsm.html#computeUnwinding"><span class="hs-identifier hs-var">computeUnwinding</span></a></span><span> </span><span class="annot"><span class="annottext">NCGConfig
</span><a href="#local-6989586621682883050"><span class="hs-identifier hs-var">config</span></a></span><span> </span><span class="annot"><span class="annottext">NcgImpl statics instr jumpDest
</span><a href="#local-6989586621682883044"><span class="hs-identifier hs-var">ncgImpl</span></a></span><span> </span><span class="annot"><span class="annottext">NatCmmDecl statics instr
</span><a href="#local-6989586621682883203"><span class="hs-identifier hs-var">proc</span></a></span><span>
</span><span id="line-673"></span><span>
</span><span id="line-674"></span><span>        </span><span class="annot"><span class="hs-identifier hs-type">return</span></span><span>  </span><span class="hs-special">(</span><span> </span><span class="annot"><a href="#local-6989586621682883185"><span class="hs-identifier hs-type">us_seq</span></a></span><span>
</span><span id="line-675"></span><span>                </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="#local-6989586621682883069"><span class="hs-identifier hs-type">fileIds'</span></a></span><span>
</span><span id="line-676"></span><span>                </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="#local-6989586621682883189"><span class="hs-identifier hs-type">branchOpt</span></a></span><span>
</span><span id="line-677"></span><span>                </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="#local-6989586621682883068"><span class="hs-identifier hs-type">lastMinuteImports</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">++</span></span><span> </span><span class="annot"><a href="#local-6989586621682883060"><span class="hs-identifier hs-type">imports</span></a></span><span>
</span><span id="line-678"></span><span>                </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="#local-6989586621682883087"><span class="hs-identifier hs-type">ppr_raStatsColor</span></a></span><span>
</span><span id="line-679"></span><span>                </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="#local-6989586621682883088"><span class="hs-identifier hs-type">ppr_raStatsLinear</span></a></span><span>
</span><span id="line-680"></span><span>                </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="#local-6989586621682883199"><span class="hs-identifier hs-type">unwinds</span></a></span><span>
</span><span id="line-681"></span><span>                </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="#local-6989586621682883162"><span class="hs-identifier hs-type">optimizedCFG</span></a></span><span>
</span><span id="line-682"></span><span>                </span><span class="hs-special">)</span><span>
</span><span id="line-683"></span><span>
</span><span id="line-684"></span><span class="annot"><a href="GHC.CmmToAsm.html#maybeDumpCfg"><span class="hs-identifier hs-type">maybeDumpCfg</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Utils.Logger.html#Logger"><span class="hs-identifier hs-type">Logger</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Maybe</span></span><span> </span><span class="annot"><a href="GHC.CmmToAsm.CFG.html#CFG"><span class="hs-identifier hs-type">CFG</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">String</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Utils.Outputable.html#SDoc"><span class="hs-identifier hs-type">SDoc</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-685"></span><span id="maybeDumpCfg"><span class="annot"><span class="annottext">maybeDumpCfg :: Logger -&gt; Maybe CFG -&gt; String -&gt; SDoc -&gt; IO ()
</span><a href="GHC.CmmToAsm.html#maybeDumpCfg"><span class="hs-identifier hs-var hs-var">maybeDumpCfg</span></a></span></span><span> </span><span id="local-6989586621682883205"><span class="annot"><span class="annottext">Logger
</span><a href="#local-6989586621682883205"><span class="hs-identifier hs-var">_logger</span></a></span></span><span> </span><span class="annot"><span class="annottext">Maybe CFG
</span><span class="hs-identifier hs-var">Nothing</span></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">SDoc
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">() -&gt; IO ()
forall a. a -&gt; IO a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-686"></span><span class="annot"><a href="GHC.CmmToAsm.html#maybeDumpCfg"><span class="hs-identifier hs-var">maybeDumpCfg</span></a></span><span> </span><span id="local-6989586621682883206"><span class="annot"><span class="annottext">Logger
</span><a href="#local-6989586621682883206"><span class="hs-identifier hs-var">logger</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span id="local-6989586621682883207"><span class="annot"><span class="annottext">CFG
</span><a href="#local-6989586621682883207"><span class="hs-identifier hs-var">cfg</span></a></span></span><span class="hs-special">)</span><span> </span><span id="local-6989586621682883208"><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621682883208"><span class="hs-identifier hs-var">msg</span></a></span></span><span> </span><span id="local-6989586621682883209"><span class="annot"><span class="annottext">SDoc
</span><a href="#local-6989586621682883209"><span class="hs-identifier hs-var">proc_name</span></a></span></span><span>
</span><span id="line-687"></span><span>        </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">CFG -&gt; Bool
forall a. LabelMap a -&gt; Bool
forall (t :: * -&gt; *) a. Foldable t =&gt; t a -&gt; Bool
</span><span class="hs-identifier hs-var">null</span></span><span> </span><span class="annot"><span class="annottext">CFG
</span><a href="#local-6989586621682883207"><span class="hs-identifier hs-var">cfg</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">() -&gt; IO ()
forall a. a -&gt; IO a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-688"></span><span>        </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">otherwise</span></span><span>
</span><span id="line-689"></span><span>        </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Logger -&gt; DumpFlag -&gt; String -&gt; DumpFormat -&gt; SDoc -&gt; IO ()
</span><a href="GHC.Utils.Logger.html#putDumpFileMaybe"><span class="hs-identifier hs-var">putDumpFileMaybe</span></a></span><span> </span><span class="annot"><span class="annottext">Logger
</span><a href="#local-6989586621682883206"><span class="hs-identifier hs-var">logger</span></a></span><span>
</span><span id="line-690"></span><span>                </span><span class="annot"><span class="annottext">DumpFlag
</span><a href="GHC.Driver.Flags.html#Opt_D_dump_cfg_weights"><span class="hs-identifier hs-var">Opt_D_dump_cfg_weights</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621682883208"><span class="hs-identifier hs-var">msg</span></a></span><span>
</span><span id="line-691"></span><span>                </span><span class="annot"><span class="annottext">DumpFormat
</span><a href="GHC.Utils.Logger.html#FormatText"><span class="hs-identifier hs-var">FormatText</span></a></span><span>
</span><span id="line-692"></span><span>                </span><span class="hs-special">(</span><span class="annot"><span class="annottext">SDoc
</span><a href="#local-6989586621682883209"><span class="hs-identifier hs-var">proc_name</span></a></span><span> </span><span class="annot"><span class="annottext">SDoc -&gt; SDoc -&gt; SDoc
forall doc. IsLine doc =&gt; doc -&gt; doc -&gt; doc
</span><a href="GHC.Utils.Outputable.html#%3C%3E"><span class="hs-operator hs-var">&lt;&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">Char -&gt; SDoc
forall doc. IsLine doc =&gt; Char -&gt; doc
</span><a href="GHC.Utils.Outputable.html#char"><span class="hs-identifier hs-var">char</span></a></span><span> </span><span class="annot"><span class="annottext">Char
</span><span class="hs-char">':'</span></span><span> </span><span class="annot"><span class="annottext">SDoc -&gt; SDoc -&gt; SDoc
forall doc. IsDoc doc =&gt; doc -&gt; doc -&gt; doc
</span><a href="GHC.Utils.Outputable.html#%24%24"><span class="hs-operator hs-var">$$</span></a></span><span> </span><span class="annot"><span class="annottext">CFG -&gt; SDoc
</span><a href="GHC.CmmToAsm.CFG.html#pprEdgeWeights"><span class="hs-identifier hs-var">pprEdgeWeights</span></a></span><span> </span><span class="annot"><span class="annottext">CFG
</span><a href="#local-6989586621682883207"><span class="hs-identifier hs-var">cfg</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-693"></span><span>
</span><span id="line-694"></span><span class="annot"><span class="hs-comment">-- | Make sure all blocks we want the layout algorithm to place have been placed.</span></span><span>
</span><span id="line-695"></span><span id="local-6989586621682882383"><span id="local-6989586621682882384"><span class="annot"><a href="GHC.CmmToAsm.html#checkLayout"><span class="hs-identifier hs-type">checkLayout</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="GHC.CmmToAsm.Types.html#NatCmmDecl"><span class="hs-identifier hs-type">NatCmmDecl</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682882383"><span class="hs-identifier hs-type">statics</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682882384"><span class="hs-identifier hs-type">instr</span></a></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="GHC.CmmToAsm.Types.html#NatCmmDecl"><span class="hs-identifier hs-type">NatCmmDecl</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682882383"><span class="hs-identifier hs-type">statics</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682882384"><span class="hs-identifier hs-type">instr</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-696"></span><span>            </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Bool</span></span></span></span><span>
</span><span id="line-697"></span><span id="checkLayout"><span class="annot"><span class="annottext">checkLayout :: forall statics instr.
[NatCmmDecl statics instr] -&gt; [NatCmmDecl statics instr] -&gt; Bool
</span><a href="GHC.CmmToAsm.html#checkLayout"><span class="hs-identifier hs-var hs-var">checkLayout</span></a></span></span><span> </span><span id="local-6989586621682883220"><span class="annot"><span class="annottext">[NatCmmDecl statics instr]
</span><a href="#local-6989586621682883220"><span class="hs-identifier hs-var">procsUnsequenced</span></a></span></span><span> </span><span id="local-6989586621682883221"><span class="annot"><span class="annottext">[NatCmmDecl statics instr]
</span><a href="#local-6989586621682883221"><span class="hs-identifier hs-var">procsSequenced</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-698"></span><span>        </span><span class="annot"><span class="annottext">Bool -&gt; SDoc -&gt; Bool -&gt; Bool
forall a. HasCallStack =&gt; Bool -&gt; SDoc -&gt; a -&gt; a
</span><a href="GHC.Utils.Panic.html#assertPpr"><span class="hs-identifier hs-var">assertPpr</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">LabelSet -&gt; Bool
</span><a href="GHC.Cmm.Dataflow.Label.html#setNull"><span class="hs-identifier hs-var">setNull</span></a></span><span> </span><span class="annot"><span class="annottext">LabelSet
</span><a href="#local-6989586621682883224"><span class="hs-identifier hs-var">diff</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">String -&gt; SDoc
forall doc. IsLine doc =&gt; String -&gt; doc
</span><a href="GHC.Utils.Outputable.html#text"><span class="hs-identifier hs-var">text</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;Block sequencing dropped blocks:&quot;</span></span><span> </span><span class="annot"><span class="annottext">SDoc -&gt; SDoc -&gt; SDoc
forall doc. IsLine doc =&gt; doc -&gt; doc -&gt; doc
</span><a href="GHC.Utils.Outputable.html#%3C%3E"><span class="hs-operator hs-var">&lt;&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">LabelSet -&gt; SDoc
forall a. Outputable a =&gt; a -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="annot"><span class="annottext">LabelSet
</span><a href="#local-6989586621682883224"><span class="hs-identifier hs-var">diff</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-699"></span><span>        </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">True</span></span><span>
</span><span id="line-700"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-701"></span><span>        </span><span id="local-6989586621682883225"><span class="annot"><span class="annottext">blocks1 :: LabelSet
</span><a href="#local-6989586621682883225"><span class="hs-identifier hs-var hs-var">blocks1</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(LabelSet -&gt; LabelSet -&gt; LabelSet)
-&gt; LabelSet -&gt; [LabelSet] -&gt; LabelSet
forall b a. (b -&gt; a -&gt; b) -&gt; b -&gt; [a] -&gt; b
forall (t :: * -&gt; *) b a.
Foldable t =&gt;
(b -&gt; a -&gt; b) -&gt; b -&gt; t a -&gt; b
</span><span class="hs-identifier hs-var">foldl'</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">LabelSet -&gt; LabelSet -&gt; LabelSet
</span><a href="GHC.Cmm.Dataflow.Label.html#setUnion"><span class="hs-identifier hs-var">setUnion</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">LabelSet
</span><a href="GHC.Cmm.Dataflow.Label.html#setEmpty"><span class="hs-identifier hs-var">setEmpty</span></a></span><span> </span><span class="annot"><span class="annottext">([LabelSet] -&gt; LabelSet) -&gt; [LabelSet] -&gt; LabelSet
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-702"></span><span>                        </span><span class="annot"><span class="annottext">(NatCmmDecl statics instr -&gt; LabelSet)
-&gt; [NatCmmDecl statics instr] -&gt; [LabelSet]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><span class="hs-identifier hs-var">map</span></span><span> </span><span class="annot"><span class="annottext">NatCmmDecl statics instr -&gt; LabelSet
forall {d} {h} {i}. GenCmmDecl d h (ListGraph i) -&gt; LabelSet
</span><a href="#local-6989586621682883228"><span class="hs-identifier hs-var">getBlockIds</span></a></span><span> </span><span class="annot"><span class="annottext">[NatCmmDecl statics instr]
</span><a href="#local-6989586621682883220"><span class="hs-identifier hs-var">procsUnsequenced</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Cmm.Dataflow.Label.html#LabelSet"><span class="hs-identifier hs-type">LabelSet</span></a></span><span>
</span><span id="line-703"></span><span>        </span><span id="local-6989586621682883229"><span class="annot"><span class="annottext">blocks2 :: LabelSet
</span><a href="#local-6989586621682883229"><span class="hs-identifier hs-var hs-var">blocks2</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(LabelSet -&gt; LabelSet -&gt; LabelSet)
-&gt; LabelSet -&gt; [LabelSet] -&gt; LabelSet
forall b a. (b -&gt; a -&gt; b) -&gt; b -&gt; [a] -&gt; b
forall (t :: * -&gt; *) b a.
Foldable t =&gt;
(b -&gt; a -&gt; b) -&gt; b -&gt; t a -&gt; b
</span><span class="hs-identifier hs-var">foldl'</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">LabelSet -&gt; LabelSet -&gt; LabelSet
</span><a href="GHC.Cmm.Dataflow.Label.html#setUnion"><span class="hs-identifier hs-var">setUnion</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">LabelSet
</span><a href="GHC.Cmm.Dataflow.Label.html#setEmpty"><span class="hs-identifier hs-var">setEmpty</span></a></span><span> </span><span class="annot"><span class="annottext">([LabelSet] -&gt; LabelSet) -&gt; [LabelSet] -&gt; LabelSet
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-704"></span><span>                        </span><span class="annot"><span class="annottext">(NatCmmDecl statics instr -&gt; LabelSet)
-&gt; [NatCmmDecl statics instr] -&gt; [LabelSet]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><span class="hs-identifier hs-var">map</span></span><span> </span><span class="annot"><span class="annottext">NatCmmDecl statics instr -&gt; LabelSet
forall {d} {h} {i}. GenCmmDecl d h (ListGraph i) -&gt; LabelSet
</span><a href="#local-6989586621682883228"><span class="hs-identifier hs-var">getBlockIds</span></a></span><span> </span><span class="annot"><span class="annottext">[NatCmmDecl statics instr]
</span><a href="#local-6989586621682883221"><span class="hs-identifier hs-var">procsSequenced</span></a></span><span>
</span><span id="line-705"></span><span>        </span><span id="local-6989586621682883224"><span class="annot"><span class="annottext">diff :: LabelSet
</span><a href="#local-6989586621682883224"><span class="hs-identifier hs-var hs-var">diff</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">LabelSet -&gt; LabelSet -&gt; LabelSet
</span><a href="GHC.Cmm.Dataflow.Label.html#setDifference"><span class="hs-identifier hs-var">setDifference</span></a></span><span> </span><span class="annot"><span class="annottext">LabelSet
</span><a href="#local-6989586621682883225"><span class="hs-identifier hs-var">blocks1</span></a></span><span> </span><span class="annot"><span class="annottext">LabelSet
</span><a href="#local-6989586621682883229"><span class="hs-identifier hs-var">blocks2</span></a></span><span>
</span><span id="line-706"></span><span>
</span><span id="line-707"></span><span>        </span><span id="local-6989586621682883228"><span class="annot"><span class="annottext">getBlockIds :: GenCmmDecl d h (ListGraph i) -&gt; LabelSet
</span><a href="#local-6989586621682883228"><span class="hs-identifier hs-var hs-var">getBlockIds</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Cmm.html#CmmData"><span class="hs-identifier hs-type">CmmData</span></a></span><span> </span><span class="annot"><span class="annottext">Section
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">d
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">LabelSet
</span><a href="GHC.Cmm.Dataflow.Label.html#setEmpty"><span class="hs-identifier hs-var">setEmpty</span></a></span><span>
</span><span id="line-708"></span><span>        </span><span class="annot"><a href="#local-6989586621682883228"><span class="hs-identifier hs-var">getBlockIds</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Cmm.html#CmmProc"><span class="hs-identifier hs-type">CmmProc</span></a></span><span> </span><span class="annot"><span class="annottext">h
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">CLabel
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">[GlobalRegUse]
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Cmm.html#ListGraph"><span class="hs-identifier hs-type">ListGraph</span></a></span><span> </span><span id="local-6989586621682883231"><span class="annot"><span class="annottext">[GenBasicBlock i]
</span><a href="#local-6989586621682883231"><span class="hs-identifier hs-var">blocks</span></a></span></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-709"></span><span>                </span><span class="annot"><span class="annottext">[Label] -&gt; LabelSet
</span><a href="GHC.Cmm.Dataflow.Label.html#setFromList"><span class="hs-identifier hs-var">setFromList</span></a></span><span> </span><span class="annot"><span class="annottext">([Label] -&gt; LabelSet) -&gt; [Label] -&gt; LabelSet
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">(GenBasicBlock i -&gt; Label) -&gt; [GenBasicBlock i] -&gt; [Label]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><span class="hs-identifier hs-var">map</span></span><span> </span><span class="annot"><span class="annottext">GenBasicBlock i -&gt; Label
forall i. GenBasicBlock i -&gt; Label
</span><a href="GHC.Cmm.html#blockId"><span class="hs-identifier hs-var">blockId</span></a></span><span> </span><span class="annot"><span class="annottext">[GenBasicBlock i]
</span><a href="#local-6989586621682883231"><span class="hs-identifier hs-var">blocks</span></a></span><span>
</span><span id="line-710"></span><span>
</span><span id="line-711"></span><span class="annot"><span class="hs-comment">-- | Compute unwinding tables for the blocks of a procedure</span></span><span>
</span><span id="line-712"></span><span id="local-6989586621682882393"><span id="local-6989586621682882394"><span id="local-6989586621682882395"><span class="annot"><a href="GHC.CmmToAsm.html#computeUnwinding"><span class="hs-identifier hs-type">computeUnwinding</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.CmmToAsm.Instr.html#Instruction"><span class="hs-identifier hs-type">Instruction</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682882393"><span class="hs-identifier hs-type">instr</span></a></span><span>
</span><span id="line-713"></span><span>                 </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="GHC.CmmToAsm.Config.html#NCGConfig"><span class="hs-identifier hs-type">NCGConfig</span></a></span><span>
</span><span id="line-714"></span><span>                 </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.CmmToAsm.Monad.html#NcgImpl"><span class="hs-identifier hs-type">NcgImpl</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682882394"><span class="hs-identifier hs-type">statics</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682882393"><span class="hs-identifier hs-type">instr</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682882395"><span class="hs-identifier hs-type">jumpDest</span></a></span><span>
</span><span id="line-715"></span><span>                 </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.CmmToAsm.Types.html#NatCmmDecl"><span class="hs-identifier hs-type">NatCmmDecl</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682882394"><span class="hs-identifier hs-type">statics</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682882393"><span class="hs-identifier hs-type">instr</span></a></span><span>
</span><span id="line-716"></span><span>                    </span><span class="annot"><span class="hs-comment">-- ^ the native code generated for the procedure</span></span><span>
</span><span id="line-717"></span><span>                 </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Cmm.Dataflow.Label.html#LabelMap"><span class="hs-identifier hs-type">LabelMap</span></a></span><span> </span><span class="hs-special">[</span><span class="annot"><a href="GHC.Cmm.DebugBlock.html#UnwindPoint"><span class="hs-identifier hs-type">UnwindPoint</span></a></span><span class="hs-special">]</span></span></span></span><span>
</span><span id="line-718"></span><span>                    </span><span class="hs-comment">-- ^ unwinding tables for all points of all blocks of the</span><span>
</span><span id="line-719"></span><span>                    </span><span class="hs-comment">-- procedure</span><span>
</span><span id="line-720"></span><span id="computeUnwinding"><span class="annot"><span class="annottext">computeUnwinding :: forall instr statics jumpDest.
Instruction instr =&gt;
NCGConfig
-&gt; NcgImpl statics instr jumpDest
-&gt; NatCmmDecl statics instr
-&gt; LabelMap [UnwindPoint]
</span><a href="GHC.CmmToAsm.html#computeUnwinding"><span class="hs-identifier hs-var hs-var">computeUnwinding</span></a></span></span><span> </span><span id="local-6989586621682883233"><span class="annot"><span class="annottext">NCGConfig
</span><a href="#local-6989586621682883233"><span class="hs-identifier hs-var">config</span></a></span></span><span> </span><span class="annot"><span class="annottext">NcgImpl statics instr jumpDest
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">NatCmmDecl statics instr
</span><span class="hs-identifier">_</span></span><span>
</span><span id="line-721"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Bool
</span><span class="hs-identifier hs-var">not</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">NCGConfig -&gt; Bool
</span><a href="GHC.CmmToAsm.Config.html#ncgComputeUnwinding"><span class="hs-identifier hs-var">ncgComputeUnwinding</span></a></span><span> </span><span class="annot"><span class="annottext">NCGConfig
</span><a href="#local-6989586621682883233"><span class="hs-identifier hs-var">config</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">LabelMap [UnwindPoint]
forall v. LabelMap v
</span><a href="GHC.Cmm.Dataflow.Label.html#mapEmpty"><span class="hs-identifier hs-var">mapEmpty</span></a></span><span>
</span><span id="line-722"></span><span class="annot"><a href="GHC.CmmToAsm.html#computeUnwinding"><span class="hs-identifier hs-var">computeUnwinding</span></a></span><span> </span><span class="annot"><span class="annottext">NCGConfig
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">NcgImpl statics instr jumpDest
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Cmm.html#CmmData"><span class="hs-identifier hs-type">CmmData</span></a></span><span> </span><span class="annot"><span class="annottext">Section
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">statics
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span>   </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">LabelMap [UnwindPoint]
forall v. LabelMap v
</span><a href="GHC.Cmm.Dataflow.Label.html#mapEmpty"><span class="hs-identifier hs-var">mapEmpty</span></a></span><span>
</span><span id="line-723"></span><span class="annot"><a href="GHC.CmmToAsm.html#computeUnwinding"><span class="hs-identifier hs-var">computeUnwinding</span></a></span><span> </span><span class="annot"><span class="annottext">NCGConfig
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621682883235"><span class="annot"><span class="annottext">NcgImpl statics instr jumpDest
</span><a href="#local-6989586621682883235"><span class="hs-identifier hs-var">ncgImpl</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Cmm.html#CmmProc"><span class="hs-identifier hs-type">CmmProc</span></a></span><span> </span><span class="annot"><span class="annottext">LabelMap RawCmmStatics
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">CLabel
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">[GlobalRegUse]
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Cmm.html#ListGraph"><span class="hs-identifier hs-type">ListGraph</span></a></span><span> </span><span id="local-6989586621682883236"><span class="annot"><span class="annottext">[GenBasicBlock instr]
</span><a href="#local-6989586621682883236"><span class="hs-identifier hs-var">blks</span></a></span></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-724"></span><span>    </span><span class="hs-comment">-- In general we would need to push unwinding information down the</span><span>
</span><span id="line-725"></span><span>    </span><span class="hs-comment">-- block-level call-graph to ensure that we fully account for all</span><span>
</span><span id="line-726"></span><span>    </span><span class="hs-comment">-- relevant register writes within a procedure.</span><span>
</span><span id="line-727"></span><span>    </span><span class="hs-comment">--</span><span>
</span><span id="line-728"></span><span>    </span><span class="hs-comment">-- However, the only unwinding information that we care about in GHC is for</span><span>
</span><span id="line-729"></span><span>    </span><span class="hs-comment">-- Sp. The fact that GHC.Cmm.LayoutStack already ensures that we have unwind</span><span>
</span><span id="line-730"></span><span>    </span><span class="hs-comment">-- information at the beginning of every block means that there is no need</span><span>
</span><span id="line-731"></span><span>    </span><span class="hs-comment">-- to perform this sort of push-down.</span><span>
</span><span id="line-732"></span><span>    </span><span class="annot"><span class="annottext">[(Label, [UnwindPoint])] -&gt; LabelMap [UnwindPoint]
forall v. [(Label, v)] -&gt; LabelMap v
</span><a href="GHC.Cmm.Dataflow.Label.html#mapFromList"><span class="hs-identifier hs-var">mapFromList</span></a></span><span> </span><span class="hs-special">[</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Label
</span><a href="#local-6989586621682883238"><span class="hs-identifier hs-var">blk_lbl</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">NcgImpl statics instr jumpDest -&gt; [instr] -&gt; [UnwindPoint]
forall statics instr jumpDest.
NcgImpl statics instr jumpDest -&gt; [instr] -&gt; [UnwindPoint]
</span><a href="GHC.CmmToAsm.Monad.html#extractUnwindPoints"><span class="hs-identifier hs-var">extractUnwindPoints</span></a></span><span> </span><span class="annot"><span class="annottext">NcgImpl statics instr jumpDest
</span><a href="#local-6989586621682883235"><span class="hs-identifier hs-var">ncgImpl</span></a></span><span> </span><span class="annot"><span class="annottext">[instr]
</span><a href="#local-6989586621682883240"><span class="hs-identifier hs-var">instrs</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-733"></span><span>                </span><span class="hs-glyph">|</span><span> </span><span class="annot"><a href="GHC.Cmm.html#BasicBlock"><span class="hs-identifier hs-type">BasicBlock</span></a></span><span> </span><span id="local-6989586621682883238"><span class="annot"><span class="annottext">Label
</span><a href="#local-6989586621682883238"><span class="hs-identifier hs-var">blk_lbl</span></a></span></span><span> </span><span id="local-6989586621682883240"><span class="annot"><span class="annottext">[instr]
</span><a href="#local-6989586621682883240"><span class="hs-identifier hs-var">instrs</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">[GenBasicBlock instr]
</span><a href="#local-6989586621682883236"><span class="hs-identifier hs-var">blks</span></a></span><span> </span><span class="hs-special">]</span><span>
</span><span id="line-734"></span><span>
</span><span id="line-735"></span><span class="hs-comment">-- | Build a doc for all the imports.</span><span>
</span><span id="line-736"></span><span class="hs-comment">--</span><span>
</span><span id="line-737"></span><span class="annot"><a href="GHC.CmmToAsm.html#makeImportsDoc"><span class="hs-identifier hs-type">makeImportsDoc</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.CmmToAsm.Config.html#NCGConfig"><span class="hs-identifier hs-type">NCGConfig</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="GHC.Cmm.CLabel.html#CLabel"><span class="hs-identifier hs-type">CLabel</span></a></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Utils.Outputable.html#HDoc"><span class="hs-identifier hs-type">HDoc</span></a></span><span>
</span><span id="line-738"></span><span id="makeImportsDoc"><span class="annot"><span class="annottext">makeImportsDoc :: NCGConfig -&gt; [CLabel] -&gt; HDoc
</span><a href="GHC.CmmToAsm.html#makeImportsDoc"><span class="hs-identifier hs-var hs-var">makeImportsDoc</span></a></span></span><span> </span><span id="local-6989586621682883242"><span class="annot"><span class="annottext">NCGConfig
</span><a href="#local-6989586621682883242"><span class="hs-identifier hs-var">config</span></a></span></span><span> </span><span id="local-6989586621682883243"><span class="annot"><span class="annottext">[CLabel]
</span><a href="#local-6989586621682883243"><span class="hs-identifier hs-var">imports</span></a></span></span><span>
</span><span id="line-739"></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[CLabel] -&gt; HDoc
</span><a href="#local-6989586621682883244"><span class="hs-identifier hs-var">dyld_stubs</span></a></span><span> </span><span class="annot"><span class="annottext">[CLabel]
</span><a href="#local-6989586621682883243"><span class="hs-identifier hs-var">imports</span></a></span><span>
</span><span id="line-740"></span><span>            </span><span class="annot"><span class="annottext">HDoc -&gt; HDoc -&gt; HDoc
forall doc. IsDoc doc =&gt; doc -&gt; doc -&gt; doc
</span><a href="GHC.Utils.Outputable.html#%24%24"><span class="hs-operator hs-var">$$</span></a></span><span>
</span><span id="line-741"></span><span>            </span><span class="hs-comment">-- On recent versions of Darwin, the linker supports</span><span>
</span><span id="line-742"></span><span>            </span><span class="hs-comment">-- dead-stripping of code and data on a per-symbol basis.</span><span>
</span><span id="line-743"></span><span>            </span><span class="hs-comment">-- There's a hack to make this work in PprMach.pprNatCmmDecl.</span><span>
</span><span id="line-744"></span><span>            </span><span class="hs-special">(</span><span class="hs-keyword">if</span><span> </span><span class="annot"><span class="annottext">Platform -&gt; Bool
</span><a href="GHC.Platform.html#platformHasSubsectionsViaSymbols"><span class="hs-identifier hs-var">platformHasSubsectionsViaSymbols</span></a></span><span> </span><span class="annot"><span class="annottext">Platform
</span><a href="#local-6989586621682883246"><span class="hs-identifier hs-var">platform</span></a></span><span>
</span><span id="line-745"></span><span>             </span><span class="hs-keyword">then</span><span> </span><span class="annot"><span class="annottext">Line HDoc -&gt; HDoc
forall doc. IsDoc doc =&gt; Line doc -&gt; doc
</span><a href="GHC.Utils.Outputable.html#line"><span class="hs-identifier hs-var">line</span></a></span><span> </span><span class="annot"><span class="annottext">(Line HDoc -&gt; HDoc) -&gt; Line HDoc -&gt; HDoc
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">String -&gt; Line HDoc
forall doc. IsLine doc =&gt; String -&gt; doc
</span><a href="GHC.Utils.Outputable.html#text"><span class="hs-identifier hs-var">text</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;.subsections_via_symbols&quot;</span></span><span>
</span><span id="line-746"></span><span>             </span><span class="hs-keyword">else</span><span> </span><span class="annot"><span class="annottext">HDoc
forall doc. IsOutput doc =&gt; doc
</span><a href="GHC.Utils.Outputable.html#empty"><span class="hs-identifier hs-var">Outputable.empty</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-747"></span><span>            </span><span class="annot"><span class="annottext">HDoc -&gt; HDoc -&gt; HDoc
forall doc. IsDoc doc =&gt; doc -&gt; doc -&gt; doc
</span><a href="GHC.Utils.Outputable.html#%24%24"><span class="hs-operator hs-var">$$</span></a></span><span>
</span><span id="line-748"></span><span>                </span><span class="hs-comment">-- On recent GNU ELF systems one can mark an object file</span><span>
</span><span id="line-749"></span><span>                </span><span class="hs-comment">-- as not requiring an executable stack. If all objects</span><span>
</span><span id="line-750"></span><span>                </span><span class="hs-comment">-- linked into a program have this note then the program</span><span>
</span><span id="line-751"></span><span>                </span><span class="hs-comment">-- will not use an executable stack, which is good for</span><span>
</span><span id="line-752"></span><span>                </span><span class="hs-comment">-- security. GHC generated code does not need an executable</span><span>
</span><span id="line-753"></span><span>                </span><span class="hs-comment">-- stack so add the note in:</span><span>
</span><span id="line-754"></span><span>            </span><span class="hs-special">(</span><span class="hs-keyword">if</span><span> </span><span class="annot"><span class="annottext">Platform -&gt; Bool
</span><a href="GHC.Platform.html#platformHasGnuNonexecStack"><span class="hs-identifier hs-var">platformHasGnuNonexecStack</span></a></span><span> </span><span class="annot"><span class="annottext">Platform
</span><a href="#local-6989586621682883246"><span class="hs-identifier hs-var">platform</span></a></span><span>
</span><span id="line-755"></span><span>             </span><span class="hs-keyword">then</span><span> </span><span class="annot"><span class="annottext">Line HDoc -&gt; HDoc
forall doc. IsDoc doc =&gt; Line doc -&gt; doc
</span><a href="GHC.Utils.Outputable.html#line"><span class="hs-identifier hs-var">line</span></a></span><span> </span><span class="annot"><span class="annottext">(Line HDoc -&gt; HDoc) -&gt; Line HDoc -&gt; HDoc
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">String -&gt; HLine
forall doc. IsLine doc =&gt; String -&gt; doc
</span><a href="GHC.Utils.Outputable.html#text"><span class="hs-identifier hs-var">text</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;.section .note.GNU-stack,\&quot;\&quot;,&quot;</span></span><span> </span><span class="annot"><span class="annottext">Line HDoc -&gt; Line HDoc -&gt; Line HDoc
forall doc. IsLine doc =&gt; doc -&gt; doc -&gt; doc
</span><a href="GHC.Utils.Outputable.html#%3C%3E"><span class="hs-operator hs-var">&lt;&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">Platform -&gt; String -&gt; HLine
forall doc. IsLine doc =&gt; Platform -&gt; String -&gt; doc
</span><a href="GHC.Utils.Asm.html#sectionType"><span class="hs-identifier hs-var">sectionType</span></a></span><span> </span><span class="annot"><span class="annottext">Platform
</span><a href="#local-6989586621682883246"><span class="hs-identifier hs-var">platform</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;progbits&quot;</span></span><span>
</span><span id="line-756"></span><span>             </span><span class="hs-keyword">else</span><span> </span><span class="annot"><span class="annottext">HDoc
forall doc. IsOutput doc =&gt; doc
</span><a href="GHC.Utils.Outputable.html#empty"><span class="hs-identifier hs-var">Outputable.empty</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-757"></span><span>            </span><span class="annot"><span class="annottext">HDoc -&gt; HDoc -&gt; HDoc
forall doc. IsDoc doc =&gt; doc -&gt; doc -&gt; doc
</span><a href="GHC.Utils.Outputable.html#%24%24"><span class="hs-operator hs-var">$$</span></a></span><span>
</span><span id="line-758"></span><span>                </span><span class="hs-comment">-- And just because every other compiler does, let's stick in</span><span>
</span><span id="line-759"></span><span>                </span><span class="hs-comment">-- an identifier directive: .ident &quot;GHC x.y.z&quot;</span><span>
</span><span id="line-760"></span><span>            </span><span class="hs-special">(</span><span class="hs-keyword">if</span><span> </span><span class="annot"><span class="annottext">Platform -&gt; Bool
</span><a href="GHC.Platform.html#platformHasIdentDirective"><span class="hs-identifier hs-var">platformHasIdentDirective</span></a></span><span> </span><span class="annot"><span class="annottext">Platform
</span><a href="#local-6989586621682883246"><span class="hs-identifier hs-var">platform</span></a></span><span>
</span><span id="line-761"></span><span>             </span><span class="hs-keyword">then</span><span> </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621682883256"><span class="annot"><span class="annottext">compilerIdent :: HLine
</span><a href="#local-6989586621682883256"><span class="hs-identifier hs-var hs-var">compilerIdent</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">String -&gt; HLine
forall doc. IsLine doc =&gt; String -&gt; doc
</span><a href="GHC.Utils.Outputable.html#text"><span class="hs-identifier hs-var">text</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;GHC&quot;</span></span><span> </span><span class="annot"><span class="annottext">HLine -&gt; HLine -&gt; HLine
forall doc. IsLine doc =&gt; doc -&gt; doc -&gt; doc
</span><a href="GHC.Utils.Outputable.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">String -&gt; HLine
forall doc. IsLine doc =&gt; String -&gt; doc
</span><a href="GHC.Utils.Outputable.html#text"><span class="hs-identifier hs-var">text</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><a href="../../ghc-boot-9.12.2-1a37/src/GHC.Version.html#cProjectVersion"><span class="hs-identifier hs-var">cProjectVersion</span></a></span><span>
</span><span id="line-762"></span><span>                   </span><span class="hs-keyword">in</span><span> </span><span class="annot"><span class="annottext">Line HDoc -&gt; HDoc
forall doc. IsDoc doc =&gt; Line doc -&gt; doc
</span><a href="GHC.Utils.Outputable.html#line"><span class="hs-identifier hs-var">line</span></a></span><span> </span><span class="annot"><span class="annottext">(Line HDoc -&gt; HDoc) -&gt; Line HDoc -&gt; HDoc
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">String -&gt; HLine
forall doc. IsLine doc =&gt; String -&gt; doc
</span><a href="GHC.Utils.Outputable.html#text"><span class="hs-identifier hs-var">text</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;.ident&quot;</span></span><span> </span><span class="annot"><span class="annottext">Line HDoc -&gt; Line HDoc -&gt; Line HDoc
forall doc. IsLine doc =&gt; doc -&gt; doc -&gt; doc
</span><a href="GHC.Utils.Outputable.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">HLine -&gt; HLine
forall doc. IsLine doc =&gt; doc -&gt; doc
</span><a href="GHC.Utils.Outputable.html#doubleQuotes"><span class="hs-identifier hs-var">doubleQuotes</span></a></span><span> </span><span class="annot"><span class="annottext">HLine
</span><a href="#local-6989586621682883256"><span class="hs-identifier hs-var">compilerIdent</span></a></span><span>
</span><span id="line-763"></span><span>             </span><span class="hs-keyword">else</span><span> </span><span class="annot"><span class="annottext">HDoc
forall doc. IsOutput doc =&gt; doc
</span><a href="GHC.Utils.Outputable.html#empty"><span class="hs-identifier hs-var">Outputable.empty</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-764"></span><span>
</span><span id="line-765"></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-766"></span><span>        </span><span id="local-6989586621682883246"><span class="annot"><span class="annottext">platform :: Platform
</span><a href="#local-6989586621682883246"><span class="hs-identifier hs-var hs-var">platform</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">NCGConfig -&gt; Platform
</span><a href="GHC.CmmToAsm.Config.html#ncgPlatform"><span class="hs-identifier hs-var">ncgPlatform</span></a></span><span> </span><span class="annot"><span class="annottext">NCGConfig
</span><a href="#local-6989586621682883242"><span class="hs-identifier hs-var">config</span></a></span><span>
</span><span id="line-767"></span><span>
</span><span id="line-768"></span><span>        </span><span class="hs-comment">-- Generate &quot;symbol stubs&quot; for all external symbols that might</span><span>
</span><span id="line-769"></span><span>        </span><span class="hs-comment">-- come from a dynamic library.</span><span>
</span><span id="line-770"></span><span>        </span><span class="annot"><a href="#local-6989586621682883244"><span class="hs-identifier hs-type">dyld_stubs</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="GHC.Cmm.CLabel.html#CLabel"><span class="hs-identifier hs-type">CLabel</span></a></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Utils.Outputable.html#HDoc"><span class="hs-identifier hs-type">HDoc</span></a></span><span>
</span><span id="line-771"></span><span>        </span><span class="hs-comment">-- (Hack) sometimes two Labels pretty-print the same, but have</span><span>
</span><span id="line-772"></span><span>        </span><span class="hs-comment">-- different uniques; so we compare their text versions...</span><span>
</span><span id="line-773"></span><span>        </span><span id="local-6989586621682883244"><span class="annot"><span class="annottext">dyld_stubs :: [CLabel] -&gt; HDoc
</span><a href="#local-6989586621682883244"><span class="hs-identifier hs-var hs-var">dyld_stubs</span></a></span></span><span> </span><span id="local-6989586621682883259"><span class="annot"><span class="annottext">[CLabel]
</span><a href="#local-6989586621682883259"><span class="hs-identifier hs-var">imps</span></a></span></span><span>
</span><span id="line-774"></span><span>                </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">NCGConfig -&gt; Bool
</span><a href="GHC.CmmToAsm.PIC.html#needImportedSymbols"><span class="hs-identifier hs-var">needImportedSymbols</span></a></span><span> </span><span class="annot"><span class="annottext">NCGConfig
</span><a href="#local-6989586621682883242"><span class="hs-identifier hs-var">config</span></a></span><span>
</span><span id="line-775"></span><span>                </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[HDoc] -&gt; HDoc
forall doc. IsDoc doc =&gt; [doc] -&gt; doc
</span><a href="GHC.Utils.Outputable.html#vcat"><span class="hs-identifier hs-var">vcat</span></a></span><span> </span><span class="annot"><span class="annottext">([HDoc] -&gt; HDoc) -&gt; [HDoc] -&gt; HDoc
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-776"></span><span>                        </span><span class="hs-special">(</span><span class="annot"><span class="annottext">NCGConfig -&gt; HDoc
</span><a href="GHC.CmmToAsm.PIC.html#pprGotDeclaration"><span class="hs-identifier hs-var">pprGotDeclaration</span></a></span><span> </span><span class="annot"><span class="annottext">NCGConfig
</span><a href="#local-6989586621682883242"><span class="hs-identifier hs-var">config</span></a></span><span> </span><span class="annot"><span class="annottext">HDoc -&gt; [HDoc] -&gt; [HDoc]
forall a. a -&gt; [a] -&gt; [a]
</span><span class="hs-glyph hs-var">:</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">([HDoc] -&gt; [HDoc]) -&gt; [HDoc] -&gt; [HDoc]
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-777"></span><span>                        </span><span class="annot"><span class="annottext">(NonEmpty (CLabel, String) -&gt; HDoc)
-&gt; [NonEmpty (CLabel, String)] -&gt; [HDoc]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-identifier hs-var">fmap</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">NCGConfig -&gt; CLabel -&gt; HDoc
</span><a href="GHC.CmmToAsm.PIC.html#pprImportedSymbol"><span class="hs-identifier hs-var">pprImportedSymbol</span></a></span><span> </span><span class="annot"><span class="annottext">NCGConfig
</span><a href="#local-6989586621682883242"><span class="hs-identifier hs-var">config</span></a></span><span> </span><span class="annot"><span class="annottext">(CLabel -&gt; HDoc)
-&gt; (NonEmpty (CLabel, String) -&gt; CLabel)
-&gt; NonEmpty (CLabel, String)
-&gt; HDoc
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">(CLabel, String) -&gt; CLabel
forall a b. (a, b) -&gt; a
</span><span class="hs-identifier hs-var">fst</span></span><span> </span><span class="annot"><span class="annottext">((CLabel, String) -&gt; CLabel)
-&gt; (NonEmpty (CLabel, String) -&gt; (CLabel, String))
-&gt; NonEmpty (CLabel, String)
-&gt; CLabel
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">NonEmpty (CLabel, String) -&gt; (CLabel, String)
forall a. NonEmpty a -&gt; a
</span><a href="../../base-4.21.0.0-ae91/src/Data.List.NonEmpty.html#head"><span class="hs-identifier hs-var">head</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">([NonEmpty (CLabel, String)] -&gt; [HDoc])
-&gt; [NonEmpty (CLabel, String)] -&gt; [HDoc]
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-778"></span><span>                        </span><span class="annot"><span class="annottext">((CLabel, String) -&gt; String)
-&gt; [(CLabel, String)] -&gt; [NonEmpty (CLabel, String)]
forall b a. Ord b =&gt; (a -&gt; b) -&gt; [a] -&gt; [NonEmpty a]
</span><a href="../../base-4.21.0.0-ae91/src/Data.List.NonEmpty.html#groupAllWith"><span class="hs-identifier hs-var">groupAllWith</span></a></span><span> </span><span class="annot"><span class="annottext">(CLabel, String) -&gt; String
forall a b. (a, b) -&gt; b
</span><span class="hs-identifier hs-var">snd</span></span><span> </span><span class="annot"><span class="annottext">([(CLabel, String)] -&gt; [NonEmpty (CLabel, String)])
-&gt; [(CLabel, String)] -&gt; [NonEmpty (CLabel, String)]
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-779"></span><span>                        </span><span class="annot"><span class="annottext">(CLabel -&gt; (CLabel, String)) -&gt; [CLabel] -&gt; [(CLabel, String)]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><span class="hs-identifier hs-var">map</span></span><span> </span><span class="annot"><span class="annottext">CLabel -&gt; (CLabel, String)
</span><a href="#local-6989586621682883265"><span class="hs-identifier hs-var">doPpr</span></a></span><span> </span><span class="annot"><span class="annottext">([CLabel] -&gt; [(CLabel, String)]) -&gt; [CLabel] -&gt; [(CLabel, String)]
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-780"></span><span>                        </span><span class="annot"><span class="annottext">[CLabel]
</span><a href="#local-6989586621682883259"><span class="hs-identifier hs-var">imps</span></a></span><span>
</span><span id="line-781"></span><span>                </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">otherwise</span></span><span>
</span><span id="line-782"></span><span>                </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">HDoc
forall doc. IsOutput doc =&gt; doc
</span><a href="GHC.Utils.Outputable.html#empty"><span class="hs-identifier hs-var">Outputable.empty</span></a></span><span>
</span><span id="line-783"></span><span>
</span><span id="line-784"></span><span>        </span><span id="local-6989586621682883265"><span class="annot"><span class="annottext">doPpr :: CLabel -&gt; (CLabel, String)
</span><a href="#local-6989586621682883265"><span class="hs-identifier hs-var hs-var">doPpr</span></a></span></span><span> </span><span id="local-6989586621682883266"><span class="annot"><span class="annottext">CLabel
</span><a href="#local-6989586621682883266"><span class="hs-identifier hs-var">lbl</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">CLabel
</span><a href="#local-6989586621682883266"><span class="hs-identifier hs-var">lbl</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">SDocContext -&gt; SDoc -&gt; String
</span><a href="GHC.Utils.Outputable.html#showSDocOneLine"><span class="hs-identifier hs-var">showSDocOneLine</span></a></span><span>
</span><span id="line-785"></span><span>                              </span><span class="hs-special">(</span><span class="annot"><span class="annottext">NCGConfig -&gt; SDocContext
</span><a href="GHC.CmmToAsm.Config.html#ncgAsmContext"><span class="hs-identifier hs-var">ncgAsmContext</span></a></span><span> </span><span class="annot"><span class="annottext">NCGConfig
</span><a href="#local-6989586621682883242"><span class="hs-identifier hs-var">config</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-786"></span><span>                              </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Platform -&gt; CLabel -&gt; SDoc
forall doc. IsLine doc =&gt; Platform -&gt; CLabel -&gt; doc
</span><a href="GHC.Cmm.CLabel.html#pprAsmLabel"><span class="hs-identifier hs-var">pprAsmLabel</span></a></span><span> </span><span class="annot"><span class="annottext">Platform
</span><a href="#local-6989586621682883246"><span class="hs-identifier hs-var">platform</span></a></span><span> </span><span class="annot"><span class="annottext">CLabel
</span><a href="#local-6989586621682883266"><span class="hs-identifier hs-var">lbl</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-787"></span><span>
</span><span id="line-788"></span><span class="hs-comment">-- -----------------------------------------------------------------------------</span><span>
</span><span id="line-789"></span><span class="hs-comment">-- Generate jump tables</span><span>
</span><span id="line-790"></span><span>
</span><span id="line-791"></span><span class="hs-comment">-- Analyzes all native code and generates data sections for all jump</span><span>
</span><span id="line-792"></span><span class="hs-comment">-- table instructions.</span><span>
</span><span id="line-793"></span><span id="local-6989586621682882362"><span id="local-6989586621682882363"><span id="local-6989586621682882364"><span class="annot"><a href="GHC.CmmToAsm.html#generateJumpTables"><span class="hs-identifier hs-type">generateJumpTables</span></a></span><span>
</span><span id="line-794"></span><span>        </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.CmmToAsm.Monad.html#NcgImpl"><span class="hs-identifier hs-type">NcgImpl</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682882362"><span class="hs-identifier hs-type">statics</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682882363"><span class="hs-identifier hs-type">instr</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682882364"><span class="hs-identifier hs-type">jumpDest</span></a></span><span>
</span><span id="line-795"></span><span>        </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="GHC.CmmToAsm.Types.html#NatCmmDecl"><span class="hs-identifier hs-type">NatCmmDecl</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682882362"><span class="hs-identifier hs-type">statics</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682882363"><span class="hs-identifier hs-type">instr</span></a></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="GHC.CmmToAsm.Types.html#NatCmmDecl"><span class="hs-identifier hs-type">NatCmmDecl</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682882362"><span class="hs-identifier hs-type">statics</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682882363"><span class="hs-identifier hs-type">instr</span></a></span><span class="hs-special">]</span></span></span></span><span>
</span><span id="line-796"></span><span id="generateJumpTables"><span class="annot"><span class="annottext">generateJumpTables :: forall statics instr jumpDest.
NcgImpl statics instr jumpDest
-&gt; [NatCmmDecl statics instr] -&gt; [NatCmmDecl statics instr]
</span><a href="GHC.CmmToAsm.html#generateJumpTables"><span class="hs-identifier hs-var hs-var">generateJumpTables</span></a></span></span><span> </span><span id="local-6989586621682883270"><span class="annot"><span class="annottext">NcgImpl statics instr jumpDest
</span><a href="#local-6989586621682883270"><span class="hs-identifier hs-var">ncgImpl</span></a></span></span><span> </span><span id="local-6989586621682883271"><span class="annot"><span class="annottext">[NatCmmDecl statics instr]
</span><a href="#local-6989586621682883271"><span class="hs-identifier hs-var">xs</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(NatCmmDecl statics instr -&gt; [NatCmmDecl statics instr])
-&gt; [NatCmmDecl statics instr] -&gt; [NatCmmDecl statics instr]
forall (t :: * -&gt; *) a b. Foldable t =&gt; (a -&gt; [b]) -&gt; t a -&gt; [b]
</span><span class="hs-identifier hs-var">concatMap</span></span><span> </span><span class="annot"><span class="annottext">NatCmmDecl statics instr -&gt; [NatCmmDecl statics instr]
</span><a href="#local-6989586621682883272"><span class="hs-identifier hs-var">f</span></a></span><span> </span><span class="annot"><span class="annottext">[NatCmmDecl statics instr]
</span><a href="#local-6989586621682883271"><span class="hs-identifier hs-var">xs</span></a></span><span>
</span><span id="line-797"></span><span>    </span><span class="hs-keyword">where</span><span> </span><span id="local-6989586621682883272"><span class="annot"><span class="annottext">f :: NatCmmDecl statics instr -&gt; [NatCmmDecl statics instr]
</span><a href="#local-6989586621682883272"><span class="hs-identifier hs-var hs-var">f</span></a></span></span><span> </span><span id="local-6989586621682883273"><span class="annot"><span class="annottext">p :: NatCmmDecl statics instr
</span><a href="#local-6989586621682883273"><span class="hs-identifier hs-var">p</span></a></span></span><span class="hs-glyph">@</span><span class="hs-special">(</span><span class="annot"><a href="GHC.Cmm.html#CmmProc"><span class="hs-identifier hs-type">CmmProc</span></a></span><span> </span><span class="annot"><span class="annottext">LabelMap RawCmmStatics
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">CLabel
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">[GlobalRegUse]
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Cmm.html#ListGraph"><span class="hs-identifier hs-type">ListGraph</span></a></span><span> </span><span id="local-6989586621682883274"><span class="annot"><span class="annottext">[GenBasicBlock instr]
</span><a href="#local-6989586621682883274"><span class="hs-identifier hs-var">xs</span></a></span></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">NatCmmDecl statics instr
</span><a href="#local-6989586621682883273"><span class="hs-identifier hs-var">p</span></a></span><span> </span><span class="annot"><span class="annottext">NatCmmDecl statics instr
-&gt; [NatCmmDecl statics instr] -&gt; [NatCmmDecl statics instr]
forall a. a -&gt; [a] -&gt; [a]
</span><span class="hs-glyph hs-var">:</span></span><span> </span><span class="annot"><span class="annottext">(GenBasicBlock instr -&gt; [NatCmmDecl statics instr])
-&gt; [GenBasicBlock instr] -&gt; [NatCmmDecl statics instr]
forall (t :: * -&gt; *) a b. Foldable t =&gt; (a -&gt; [b]) -&gt; t a -&gt; [b]
</span><span class="hs-identifier hs-var">concatMap</span></span><span> </span><span class="annot"><span class="annottext">GenBasicBlock instr -&gt; [NatCmmDecl statics instr]
</span><a href="#local-6989586621682883275"><span class="hs-identifier hs-var">g</span></a></span><span> </span><span class="annot"><span class="annottext">[GenBasicBlock instr]
</span><a href="#local-6989586621682883274"><span class="hs-identifier hs-var">xs</span></a></span><span>
</span><span id="line-798"></span><span>          </span><span class="annot"><a href="#local-6989586621682883272"><span class="hs-identifier hs-var">f</span></a></span><span> </span><span id="local-6989586621682883276"><span class="annot"><span class="annottext">NatCmmDecl statics instr
</span><a href="#local-6989586621682883276"><span class="hs-identifier hs-var">p</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">NatCmmDecl statics instr
</span><a href="#local-6989586621682883276"><span class="hs-identifier hs-var">p</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-799"></span><span>          </span><span id="local-6989586621682883275"><span class="annot"><span class="annottext">g :: GenBasicBlock instr -&gt; [NatCmmDecl statics instr]
</span><a href="#local-6989586621682883275"><span class="hs-identifier hs-var hs-var">g</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Cmm.html#BasicBlock"><span class="hs-identifier hs-type">BasicBlock</span></a></span><span> </span><span class="annot"><span class="annottext">Label
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621682883277"><span class="annot"><span class="annottext">[instr]
</span><a href="#local-6989586621682883277"><span class="hs-identifier hs-var">xs</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(instr -&gt; Maybe (NatCmmDecl statics instr))
-&gt; [instr] -&gt; [NatCmmDecl statics instr]
forall a b. (a -&gt; Maybe b) -&gt; [a] -&gt; [b]
</span><span class="hs-identifier hs-var">mapMaybe</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">NcgImpl statics instr jumpDest
-&gt; instr -&gt; Maybe (NatCmmDecl statics instr)
forall statics instr jumpDest.
NcgImpl statics instr jumpDest
-&gt; instr -&gt; Maybe (NatCmmDecl statics instr)
</span><a href="GHC.CmmToAsm.Monad.html#generateJumpTableForInstr"><span class="hs-identifier hs-var">generateJumpTableForInstr</span></a></span><span> </span><span class="annot"><span class="annottext">NcgImpl statics instr jumpDest
</span><a href="#local-6989586621682883270"><span class="hs-identifier hs-var">ncgImpl</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[instr]
</span><a href="#local-6989586621682883277"><span class="hs-identifier hs-var">xs</span></a></span><span>
</span><span id="line-800"></span><span>
</span><span id="line-801"></span><span class="hs-comment">-- -----------------------------------------------------------------------------</span><span>
</span><span id="line-802"></span><span class="hs-comment">-- Shortcut branches</span><span>
</span><span id="line-803"></span><span>
</span><span id="line-804"></span><span class="hs-comment">-- Note [No asm-shortcutting on Darwin]</span><span>
</span><span id="line-805"></span><span class="hs-comment">-- ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~</span><span>
</span><span id="line-806"></span><span class="hs-comment">-- Asm-shortcutting may produce relative references to symbols defined in</span><span>
</span><span id="line-807"></span><span class="hs-comment">-- other compilation units. This is not something that MachO relocations</span><span>
</span><span id="line-808"></span><span class="hs-comment">-- support (see #21972). For this reason we disable the optimisation on Darwin.</span><span>
</span><span id="line-809"></span><span class="hs-comment">-- We do so in the backend without a warning since this flag is enabled by</span><span>
</span><span id="line-810"></span><span class="hs-comment">-- `-O2`.</span><span>
</span><span id="line-811"></span><span class="hs-comment">--</span><span>
</span><span id="line-812"></span><span class="hs-comment">-- Another way to address this issue would be to rather implement a</span><span>
</span><span id="line-813"></span><span class="hs-comment">-- PLT-relocatable jump-table strategy. However, this would only benefit Darwin</span><span>
</span><span id="line-814"></span><span class="hs-comment">-- and does not seem worth the effort as this optimisation generally doesn't</span><span>
</span><span id="line-815"></span><span class="hs-comment">-- offer terribly great benefits.</span><span>
</span><span id="line-816"></span><span>
</span><span id="line-817"></span><span class="annot"><a href="GHC.CmmToAsm.html#shortcutBranches"><span class="hs-identifier hs-type">shortcutBranches</span></a></span><span>
</span><span id="line-818"></span><span>        </span><span class="hs-glyph">::</span><span> </span><span class="hs-keyword">forall</span><span> </span><span id="local-6989586621682882366"><span class="annot"><a href="#local-6989586621682882366"><span class="hs-identifier hs-type">statics</span></a></span></span><span> </span><span id="local-6989586621682882367"><span class="annot"><a href="#local-6989586621682882367"><span class="hs-identifier hs-type">instr</span></a></span></span><span> </span><span id="local-6989586621682882365"><span class="annot"><a href="#local-6989586621682882365"><span class="hs-identifier hs-type">jumpDest</span></a></span></span><span class="hs-operator">.</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Utils.Outputable.html#Outputable"><span class="hs-identifier hs-type">Outputable</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682882365"><span class="hs-identifier hs-type">jumpDest</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-819"></span><span>        </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="GHC.CmmToAsm.Config.html#NCGConfig"><span class="hs-identifier hs-type">NCGConfig</span></a></span><span>
</span><span id="line-820"></span><span>        </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.CmmToAsm.Monad.html#NcgImpl"><span class="hs-identifier hs-type">NcgImpl</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682882366"><span class="hs-identifier hs-type">statics</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682882367"><span class="hs-identifier hs-type">instr</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682882365"><span class="hs-identifier hs-type">jumpDest</span></a></span><span>
</span><span id="line-821"></span><span>        </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="GHC.CmmToAsm.Types.html#NatCmmDecl"><span class="hs-identifier hs-type">NatCmmDecl</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682882366"><span class="hs-identifier hs-type">statics</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682882367"><span class="hs-identifier hs-type">instr</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-822"></span><span>        </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Maybe</span></span><span> </span><span class="annot"><a href="GHC.CmmToAsm.CFG.html#CFG"><span class="hs-identifier hs-type">CFG</span></a></span><span>
</span><span id="line-823"></span><span>        </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="hs-special">[</span><span class="annot"><a href="GHC.CmmToAsm.Types.html#NatCmmDecl"><span class="hs-identifier hs-type">NatCmmDecl</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682882366"><span class="hs-identifier hs-type">statics</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682882367"><span class="hs-identifier hs-type">instr</span></a></span><span class="hs-special">]</span><span class="hs-special">,</span><span class="annot"><span class="hs-identifier hs-type">Maybe</span></span><span> </span><span class="annot"><a href="GHC.CmmToAsm.CFG.html#CFG"><span class="hs-identifier hs-type">CFG</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-824"></span><span>
</span><span id="line-825"></span><span id="shortcutBranches"><span class="annot"><span class="annottext">shortcutBranches :: forall statics instr jumpDest.
Outputable jumpDest =&gt;
NCGConfig
-&gt; NcgImpl statics instr jumpDest
-&gt; [NatCmmDecl statics instr]
-&gt; Maybe CFG
-&gt; ([NatCmmDecl statics instr], Maybe CFG)
</span><a href="GHC.CmmToAsm.html#shortcutBranches"><span class="hs-identifier hs-var hs-var">shortcutBranches</span></a></span></span><span> </span><span id="local-6989586621682883284"><span class="annot"><span class="annottext">NCGConfig
</span><a href="#local-6989586621682883284"><span class="hs-identifier hs-var">config</span></a></span></span><span> </span><span id="local-6989586621682883285"><span class="annot"><span class="annottext">NcgImpl statics instr jumpDest
</span><a href="#local-6989586621682883285"><span class="hs-identifier hs-var">ncgImpl</span></a></span></span><span> </span><span id="local-6989586621682883286"><span class="annot"><span class="annottext">[NatCmmDecl statics instr]
</span><a href="#local-6989586621682883286"><span class="hs-identifier hs-var">tops</span></a></span></span><span> </span><span id="local-6989586621682883287"><span class="annot"><span class="annottext">Maybe CFG
</span><a href="#local-6989586621682883287"><span class="hs-identifier hs-var">weights</span></a></span></span><span>
</span><span id="line-826"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">NCGConfig -&gt; Bool
</span><a href="GHC.CmmToAsm.Config.html#ncgEnableShortcutting"><span class="hs-identifier hs-var">ncgEnableShortcutting</span></a></span><span> </span><span class="annot"><span class="annottext">NCGConfig
</span><a href="#local-6989586621682883284"><span class="hs-identifier hs-var">config</span></a></span><span>
</span><span id="line-827"></span><span>    </span><span class="hs-comment">-- See Note [No asm-shortcutting on Darwin]</span><span>
</span><span id="line-828"></span><span>  </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Bool
</span><span class="hs-identifier hs-var">not</span></span><span> </span><span class="annot"><span class="annottext">(Bool -&gt; Bool) -&gt; Bool -&gt; Bool
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">OS -&gt; Bool
</span><span class="hs-identifier hs-var">osMachOTarget</span></span><span> </span><span class="annot"><span class="annottext">(OS -&gt; Bool) -&gt; OS -&gt; Bool
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Platform -&gt; OS
</span><a href="GHC.Platform.html#platformOS"><span class="hs-identifier hs-var">platformOS</span></a></span><span> </span><span class="annot"><span class="annottext">(Platform -&gt; OS) -&gt; Platform -&gt; OS
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">NCGConfig -&gt; Platform
</span><a href="GHC.CmmToAsm.Config.html#ncgPlatform"><span class="hs-identifier hs-var">ncgPlatform</span></a></span><span> </span><span class="annot"><span class="annottext">NCGConfig
</span><a href="#local-6989586621682883284"><span class="hs-identifier hs-var">config</span></a></span><span>
</span><span id="line-829"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><span> </span><span class="annot"><span class="annottext">(NatCmmDecl statics instr -&gt; NatCmmDecl statics instr)
-&gt; [NatCmmDecl statics instr] -&gt; [NatCmmDecl statics instr]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><span class="hs-identifier hs-var">map</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">NcgImpl statics instr jumpDest
-&gt; LabelMap jumpDest
-&gt; NatCmmDecl statics instr
-&gt; NatCmmDecl statics instr
forall statics instr jumpDest h.
NcgImpl statics instr jumpDest
-&gt; LabelMap jumpDest
-&gt; GenCmmDecl statics h (ListGraph instr)
-&gt; GenCmmDecl statics h (ListGraph instr)
</span><a href="GHC.CmmToAsm.html#apply_mapping"><span class="hs-identifier hs-var">apply_mapping</span></a></span><span> </span><span class="annot"><span class="annottext">NcgImpl statics instr jumpDest
</span><a href="#local-6989586621682883285"><span class="hs-identifier hs-var">ncgImpl</span></a></span><span> </span><span class="annot"><span class="annottext">LabelMap jumpDest
</span><a href="#local-6989586621682883292"><span class="hs-identifier hs-var">mapping</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[NatCmmDecl statics instr]
</span><a href="#local-6989586621682883293"><span class="hs-identifier hs-var">tops'</span></a></span><span>
</span><span id="line-830"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">LabelMap (Maybe Label) -&gt; CFG -&gt; CFG
</span><a href="GHC.CmmToAsm.CFG.html#shortcutWeightMap"><span class="hs-identifier hs-var">shortcutWeightMap</span></a></span><span> </span><span class="annot"><span class="annottext">LabelMap (Maybe Label)
</span><a href="#local-6989586621682883295"><span class="hs-identifier hs-var">mappingBid</span></a></span><span> </span><span class="annot"><span class="annottext">(CFG -&gt; CFG) -&gt; Maybe CFG -&gt; Maybe CFG
forall (m :: * -&gt; *) a1 r. Monad m =&gt; (a1 -&gt; r) -&gt; m a1 -&gt; m r
</span><span class="hs-operator hs-var">&lt;$!&gt;</span></span><span> </span><span class="annot"><span class="annottext">Maybe CFG
</span><a href="#local-6989586621682883287"><span class="hs-identifier hs-var">weights</span></a></span><span> </span><span class="hs-special">)</span><span>
</span><span id="line-831"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">otherwise</span></span><span>
</span><span id="line-832"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[NatCmmDecl statics instr]
</span><a href="#local-6989586621682883286"><span class="hs-identifier hs-var">tops</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Maybe CFG
</span><a href="#local-6989586621682883287"><span class="hs-identifier hs-var">weights</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-833"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-834"></span><span>    </span><span class="hs-special">(</span><span id="local-6989586621682883293"><span class="annot"><span class="annottext">[NatCmmDecl statics instr]
</span><a href="#local-6989586621682883293"><span class="hs-identifier hs-var">tops'</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682883296"><span class="annot"><span class="annottext">[LabelMap jumpDest]
</span><a href="#local-6989586621682883296"><span class="hs-identifier hs-var">mappings</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(NatCmmDecl statics instr
 -&gt; (NatCmmDecl statics instr, LabelMap jumpDest))
-&gt; [NatCmmDecl statics instr]
-&gt; ([NatCmmDecl statics instr], [LabelMap jumpDest])
forall a b c. (a -&gt; (b, c)) -&gt; [a] -&gt; ([b], [c])
</span><a href="GHC.Utils.Misc.html#mapAndUnzip"><span class="hs-identifier hs-var">mapAndUnzip</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">NcgImpl statics instr jumpDest
-&gt; NatCmmDecl statics instr
-&gt; (NatCmmDecl statics instr, LabelMap jumpDest)
forall instr t d statics jumpDest.
NcgImpl statics instr jumpDest
-&gt; GenCmmDecl d (LabelMap t) (ListGraph instr)
-&gt; (GenCmmDecl d (LabelMap t) (ListGraph instr), LabelMap jumpDest)
</span><a href="GHC.CmmToAsm.html#build_mapping"><span class="hs-identifier hs-var">build_mapping</span></a></span><span> </span><span class="annot"><span class="annottext">NcgImpl statics instr jumpDest
</span><a href="#local-6989586621682883285"><span class="hs-identifier hs-var">ncgImpl</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[NatCmmDecl statics instr]
</span><a href="#local-6989586621682883286"><span class="hs-identifier hs-var">tops</span></a></span><span>
</span><span id="line-835"></span><span>    </span><span id="local-6989586621682883292"><span class="annot"><span class="annottext">mapping :: LabelMap jumpDest
</span><a href="#local-6989586621682883292"><span class="hs-identifier hs-var hs-var">mapping</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[LabelMap jumpDest] -&gt; LabelMap jumpDest
forall a. [LabelMap a] -&gt; LabelMap a
</span><a href="GHC.Cmm.Dataflow.Label.html#mapUnions"><span class="hs-identifier hs-var">mapUnions</span></a></span><span> </span><span class="annot"><span class="annottext">[LabelMap jumpDest]
</span><a href="#local-6989586621682883296"><span class="hs-identifier hs-var">mappings</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Cmm.Dataflow.Label.html#LabelMap"><span class="hs-identifier hs-type">LabelMap</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682882365"><span class="hs-identifier hs-type">jumpDest</span></a></span><span>
</span><span id="line-836"></span><span>    </span><span id="local-6989586621682883295"><span class="annot"><span class="annottext">mappingBid :: LabelMap (Maybe Label)
</span><a href="#local-6989586621682883295"><span class="hs-identifier hs-var hs-var">mappingBid</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(jumpDest -&gt; Maybe Label)
-&gt; LabelMap jumpDest -&gt; LabelMap (Maybe Label)
forall a b. (a -&gt; b) -&gt; LabelMap a -&gt; LabelMap b
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-identifier hs-var">fmap</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">NcgImpl statics instr jumpDest -&gt; jumpDest -&gt; Maybe Label
forall statics instr jumpDest.
NcgImpl statics instr jumpDest -&gt; jumpDest -&gt; Maybe Label
</span><a href="GHC.CmmToAsm.Monad.html#getJumpDestBlockId"><span class="hs-identifier hs-var">getJumpDestBlockId</span></a></span><span> </span><span class="annot"><span class="annottext">NcgImpl statics instr jumpDest
</span><a href="#local-6989586621682883285"><span class="hs-identifier hs-var">ncgImpl</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">LabelMap jumpDest
</span><a href="#local-6989586621682883292"><span class="hs-identifier hs-var">mapping</span></a></span><span>
</span><span id="line-837"></span><span>
</span><span id="line-838"></span><span class="annot"><a href="GHC.CmmToAsm.html#build_mapping"><span class="hs-identifier hs-type">build_mapping</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-keyword">forall</span><span> </span><span id="local-6989586621682882441"><span class="annot"><a href="#local-6989586621682882441"><span class="hs-identifier hs-type">instr</span></a></span></span><span> </span><span id="local-6989586621682882444"><span class="annot"><a href="#local-6989586621682882444"><span class="hs-identifier hs-type">t</span></a></span></span><span> </span><span id="local-6989586621682882443"><span class="annot"><a href="#local-6989586621682882443"><span class="hs-identifier hs-type">d</span></a></span></span><span> </span><span id="local-6989586621682882440"><span class="annot"><a href="#local-6989586621682882440"><span class="hs-identifier hs-type">statics</span></a></span></span><span> </span><span id="local-6989586621682882442"><span class="annot"><a href="#local-6989586621682882442"><span class="hs-identifier hs-type">jumpDest</span></a></span></span><span class="hs-operator">.</span><span>
</span><span id="line-839"></span><span>                 </span><span class="annot"><a href="GHC.CmmToAsm.Monad.html#NcgImpl"><span class="hs-identifier hs-type">NcgImpl</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682882440"><span class="hs-identifier hs-type">statics</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682882441"><span class="hs-identifier hs-type">instr</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682882442"><span class="hs-identifier hs-type">jumpDest</span></a></span><span>
</span><span id="line-840"></span><span>              </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Cmm.html#GenCmmDecl"><span class="hs-identifier hs-type">GenCmmDecl</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682882443"><span class="hs-identifier hs-type">d</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Cmm.Dataflow.Label.html#LabelMap"><span class="hs-identifier hs-type">LabelMap</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682882444"><span class="hs-identifier hs-type">t</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Cmm.html#ListGraph"><span class="hs-identifier hs-type">ListGraph</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682882441"><span class="hs-identifier hs-type">instr</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-841"></span><span>              </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Cmm.html#GenCmmDecl"><span class="hs-identifier hs-type">GenCmmDecl</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682882443"><span class="hs-identifier hs-type">d</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Cmm.Dataflow.Label.html#LabelMap"><span class="hs-identifier hs-type">LabelMap</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682882444"><span class="hs-identifier hs-type">t</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Cmm.html#ListGraph"><span class="hs-identifier hs-type">ListGraph</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682882441"><span class="hs-identifier hs-type">instr</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-842"></span><span>                 </span><span class="hs-special">,</span><span class="annot"><a href="GHC.Cmm.Dataflow.Label.html#LabelMap"><span class="hs-identifier hs-type">LabelMap</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682882442"><span class="hs-identifier hs-type">jumpDest</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-843"></span><span id="build_mapping"><span class="annot"><span class="annottext">build_mapping :: forall instr t d statics jumpDest.
NcgImpl statics instr jumpDest
-&gt; GenCmmDecl d (LabelMap t) (ListGraph instr)
-&gt; (GenCmmDecl d (LabelMap t) (ListGraph instr), LabelMap jumpDest)
</span><a href="GHC.CmmToAsm.html#build_mapping"><span class="hs-identifier hs-var hs-var">build_mapping</span></a></span></span><span> </span><span class="annot"><span class="annottext">NcgImpl statics instr jumpDest
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621682883304"><span class="annot"><span class="annottext">top :: GenCmmDecl d (LabelMap t) (ListGraph instr)
</span><a href="#local-6989586621682883304"><span class="hs-identifier hs-var">top</span></a></span></span><span class="hs-glyph">@</span><span class="hs-special">(</span><span class="annot"><a href="GHC.Cmm.html#CmmData"><span class="hs-identifier hs-type">CmmData</span></a></span><span> </span><span class="annot"><span class="annottext">Section
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">d
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">GenCmmDecl d (LabelMap t) (ListGraph instr)
</span><a href="#local-6989586621682883304"><span class="hs-identifier hs-var">top</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">LabelMap jumpDest
forall v. LabelMap v
</span><a href="GHC.Cmm.Dataflow.Label.html#mapEmpty"><span class="hs-identifier hs-var">mapEmpty</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-844"></span><span class="annot"><a href="GHC.CmmToAsm.html#build_mapping"><span class="hs-identifier hs-var">build_mapping</span></a></span><span> </span><span class="annot"><span class="annottext">NcgImpl statics instr jumpDest
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Cmm.html#CmmProc"><span class="hs-identifier hs-type">CmmProc</span></a></span><span> </span><span id="local-6989586621682883305"><span class="annot"><span class="annottext">LabelMap t
</span><a href="#local-6989586621682883305"><span class="hs-identifier hs-var">info</span></a></span></span><span> </span><span id="local-6989586621682883306"><span class="annot"><span class="annottext">CLabel
</span><a href="#local-6989586621682883306"><span class="hs-identifier hs-var">lbl</span></a></span></span><span> </span><span id="local-6989586621682883307"><span class="annot"><span class="annottext">[GlobalRegUse]
</span><a href="#local-6989586621682883307"><span class="hs-identifier hs-var">live</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Cmm.html#ListGraph"><span class="hs-identifier hs-type">ListGraph</span></a></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-845"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">LabelMap t
-&gt; CLabel
-&gt; [GlobalRegUse]
-&gt; ListGraph instr
-&gt; GenCmmDecl d (LabelMap t) (ListGraph instr)
forall d h g.
h -&gt; CLabel -&gt; [GlobalRegUse] -&gt; g -&gt; GenCmmDecl d h g
</span><a href="GHC.Cmm.html#CmmProc"><span class="hs-identifier hs-var">CmmProc</span></a></span><span> </span><span class="annot"><span class="annottext">LabelMap t
</span><a href="#local-6989586621682883305"><span class="hs-identifier hs-var">info</span></a></span><span> </span><span class="annot"><span class="annottext">CLabel
</span><a href="#local-6989586621682883306"><span class="hs-identifier hs-var">lbl</span></a></span><span> </span><span class="annot"><span class="annottext">[GlobalRegUse]
</span><a href="#local-6989586621682883307"><span class="hs-identifier hs-var">live</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[GenBasicBlock instr] -&gt; ListGraph instr
forall i. [GenBasicBlock i] -&gt; ListGraph i
</span><a href="GHC.Cmm.html#ListGraph"><span class="hs-identifier hs-var">ListGraph</span></a></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">LabelMap jumpDest
forall v. LabelMap v
</span><a href="GHC.Cmm.Dataflow.Label.html#mapEmpty"><span class="hs-identifier hs-var">mapEmpty</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-846"></span><span class="annot"><a href="GHC.CmmToAsm.html#build_mapping"><span class="hs-identifier hs-var">build_mapping</span></a></span><span> </span><span id="local-6989586621682883308"><span class="annot"><span class="annottext">NcgImpl statics instr jumpDest
</span><a href="#local-6989586621682883308"><span class="hs-identifier hs-var">ncgImpl</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Cmm.html#CmmProc"><span class="hs-identifier hs-type">CmmProc</span></a></span><span> </span><span id="local-6989586621682883309"><span class="annot"><span class="annottext">LabelMap t
</span><a href="#local-6989586621682883309"><span class="hs-identifier hs-var">info</span></a></span></span><span> </span><span id="local-6989586621682883310"><span class="annot"><span class="annottext">CLabel
</span><a href="#local-6989586621682883310"><span class="hs-identifier hs-var">lbl</span></a></span></span><span> </span><span id="local-6989586621682883311"><span class="annot"><span class="annottext">[GlobalRegUse]
</span><a href="#local-6989586621682883311"><span class="hs-identifier hs-var">live</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Cmm.html#ListGraph"><span class="hs-identifier hs-type">ListGraph</span></a></span><span> </span><span class="hs-special">(</span><span id="local-6989586621682883312"><span class="annot"><span class="annottext">GenBasicBlock instr
</span><a href="#local-6989586621682883312"><span class="hs-identifier hs-var">head</span></a></span></span><span class="annot"><span class="hs-glyph hs-type">:</span></span><span id="local-6989586621682883313"><span class="annot"><span class="annottext">[GenBasicBlock instr]
</span><a href="#local-6989586621682883313"><span class="hs-identifier hs-var">blocks</span></a></span></span><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-847"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">LabelMap t
-&gt; CLabel
-&gt; [GlobalRegUse]
-&gt; ListGraph instr
-&gt; GenCmmDecl d (LabelMap t) (ListGraph instr)
forall d h g.
h -&gt; CLabel -&gt; [GlobalRegUse] -&gt; g -&gt; GenCmmDecl d h g
</span><a href="GHC.Cmm.html#CmmProc"><span class="hs-identifier hs-var">CmmProc</span></a></span><span> </span><span class="annot"><span class="annottext">LabelMap t
</span><a href="#local-6989586621682883309"><span class="hs-identifier hs-var">info</span></a></span><span> </span><span class="annot"><span class="annottext">CLabel
</span><a href="#local-6989586621682883310"><span class="hs-identifier hs-var">lbl</span></a></span><span> </span><span class="annot"><span class="annottext">[GlobalRegUse]
</span><a href="#local-6989586621682883311"><span class="hs-identifier hs-var">live</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[GenBasicBlock instr] -&gt; ListGraph instr
forall i. [GenBasicBlock i] -&gt; ListGraph i
</span><a href="GHC.Cmm.html#ListGraph"><span class="hs-identifier hs-var">ListGraph</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">GenBasicBlock instr
</span><a href="#local-6989586621682883312"><span class="hs-identifier hs-var">head</span></a></span><span class="annot"><span class="annottext">GenBasicBlock instr
-&gt; [GenBasicBlock instr] -&gt; [GenBasicBlock instr]
forall a. a -&gt; [a] -&gt; [a]
</span><span class="hs-glyph hs-var">:</span></span><span class="annot"><span class="annottext">[GenBasicBlock instr]
</span><a href="#local-6989586621682883314"><span class="hs-identifier hs-var">others</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">LabelMap jumpDest
</span><a href="#local-6989586621682883315"><span class="hs-identifier hs-var">mapping</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-848"></span><span>        </span><span class="hs-comment">-- drop the shorted blocks, but don't ever drop the first one,</span><span>
</span><span id="line-849"></span><span>        </span><span class="hs-comment">-- because it is pointed to by a global label.</span><span>
</span><span id="line-850"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-851"></span><span>    </span><span class="hs-comment">-- find all the blocks that just consist of a jump that can be</span><span>
</span><span id="line-852"></span><span>    </span><span class="hs-comment">-- shorted.</span><span>
</span><span id="line-853"></span><span>    </span><span class="hs-comment">-- Don't completely eliminate loops here -- that can leave a dangling jump!</span><span>
</span><span id="line-854"></span><span>    </span><span class="annot"><a href="#local-6989586621682883316"><span class="hs-identifier hs-type">shortcut_blocks</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><span class="hs-special">(</span><span class="annot"><a href="GHC.Cmm.BlockId.html#BlockId"><span class="hs-identifier hs-type">BlockId</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="#local-6989586621682882442"><span class="hs-identifier hs-type">jumpDest</span></a></span><span class="hs-special">)</span><span class="hs-special">]</span><span>
</span><span id="line-855"></span><span>    </span><span class="hs-special">(</span><span class="annot"><span class="annottext">LabelSet
</span><span class="hs-identifier">_</span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682883316"><span class="annot"><span class="annottext">[(Label, jumpDest)]
</span><a href="#local-6989586621682883316"><span class="hs-identifier hs-var">shortcut_blocks</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682883314"><span class="annot"><span class="annottext">[GenBasicBlock instr]
</span><a href="#local-6989586621682883314"><span class="hs-identifier hs-var">others</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-856"></span><span>        </span><span class="annot"><span class="annottext">((LabelSet, [(Label, jumpDest)], [GenBasicBlock instr])
 -&gt; GenBasicBlock instr
 -&gt; (LabelSet, [(Label, jumpDest)], [GenBasicBlock instr]))
-&gt; (LabelSet, [(Label, jumpDest)], [GenBasicBlock instr])
-&gt; [GenBasicBlock instr]
-&gt; (LabelSet, [(Label, jumpDest)], [GenBasicBlock instr])
forall b a. (b -&gt; a -&gt; b) -&gt; b -&gt; [a] -&gt; b
forall (t :: * -&gt; *) b a.
Foldable t =&gt;
(b -&gt; a -&gt; b) -&gt; b -&gt; t a -&gt; b
</span><span class="hs-identifier hs-var">foldl'</span></span><span> </span><span class="annot"><span class="annottext">(LabelSet, [(Label, jumpDest)], [GenBasicBlock instr])
-&gt; GenBasicBlock instr
-&gt; (LabelSet, [(Label, jumpDest)], [GenBasicBlock instr])
</span><a href="#local-6989586621682883317"><span class="hs-identifier hs-var">split</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">LabelSet
</span><a href="GHC.Cmm.Dataflow.Label.html#setEmpty"><span class="hs-identifier hs-var">setEmpty</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Cmm.Dataflow.Label.html#LabelSet"><span class="hs-identifier hs-type">LabelSet</span></a></span><span class="hs-special">,</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span class="hs-special">,</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[GenBasicBlock instr]
</span><a href="#local-6989586621682883313"><span class="hs-identifier hs-var">blocks</span></a></span><span>
</span><span id="line-857"></span><span>    </span><span id="local-6989586621682883317"><span class="annot"><span class="annottext">split :: (LabelSet, [(Label, jumpDest)], [GenBasicBlock instr])
-&gt; GenBasicBlock instr
-&gt; (LabelSet, [(Label, jumpDest)], [GenBasicBlock instr])
</span><a href="#local-6989586621682883317"><span class="hs-identifier hs-var hs-var">split</span></a></span></span><span> </span><span class="hs-special">(</span><span id="local-6989586621682883318"><span class="annot"><span class="annottext">LabelSet
</span><a href="#local-6989586621682883318"><span class="hs-identifier hs-var">s</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682883319"><span class="annot"><span class="annottext">[(Label, jumpDest)]
</span><a href="#local-6989586621682883319"><span class="hs-identifier hs-var">shortcut_blocks</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682883320"><span class="annot"><span class="annottext">[GenBasicBlock instr]
</span><a href="#local-6989586621682883320"><span class="hs-identifier hs-var">others</span></a></span></span><span class="hs-special">)</span><span> </span><span id="local-6989586621682883321"><span class="annot"><span class="annottext">b :: GenBasicBlock instr
</span><a href="#local-6989586621682883321"><span class="hs-identifier hs-var">b</span></a></span></span><span class="hs-glyph">@</span><span class="hs-special">(</span><span class="annot"><a href="GHC.Cmm.html#BasicBlock"><span class="hs-identifier hs-type">BasicBlock</span></a></span><span> </span><span id="local-6989586621682883322"><span class="annot"><span class="annottext">Label
</span><a href="#local-6989586621682883322"><span class="hs-identifier hs-var">id</span></a></span></span><span> </span><span class="hs-special">[</span><span id="local-6989586621682883323"><span class="annot"><span class="annottext">instr
</span><a href="#local-6989586621682883323"><span class="hs-identifier hs-var">insn</span></a></span></span><span class="hs-special">]</span><span class="hs-special">)</span><span>
</span><span id="line-858"></span><span>        </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span id="local-6989586621682883324"><span class="annot"><span class="annottext">jumpDest
</span><a href="#local-6989586621682883324"><span class="hs-identifier hs-var">jd</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">NcgImpl statics instr jumpDest -&gt; instr -&gt; Maybe jumpDest
forall statics instr jumpDest.
NcgImpl statics instr jumpDest -&gt; instr -&gt; Maybe jumpDest
</span><a href="GHC.CmmToAsm.Monad.html#canShortcut"><span class="hs-identifier hs-var">canShortcut</span></a></span><span> </span><span class="annot"><span class="annottext">NcgImpl statics instr jumpDest
</span><a href="#local-6989586621682883308"><span class="hs-identifier hs-var">ncgImpl</span></a></span><span> </span><span class="annot"><span class="annottext">instr
</span><a href="#local-6989586621682883323"><span class="hs-identifier hs-var">insn</span></a></span><span>
</span><span id="line-859"></span><span>        </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span id="local-6989586621682883326"><span class="annot"><span class="annottext">Label
</span><a href="#local-6989586621682883326"><span class="hs-identifier hs-var">dest</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">NcgImpl statics instr jumpDest -&gt; jumpDest -&gt; Maybe Label
forall statics instr jumpDest.
NcgImpl statics instr jumpDest -&gt; jumpDest -&gt; Maybe Label
</span><a href="GHC.CmmToAsm.Monad.html#getJumpDestBlockId"><span class="hs-identifier hs-var">getJumpDestBlockId</span></a></span><span> </span><span class="annot"><span class="annottext">NcgImpl statics instr jumpDest
</span><a href="#local-6989586621682883308"><span class="hs-identifier hs-var">ncgImpl</span></a></span><span> </span><span class="annot"><span class="annottext">jumpDest
</span><a href="#local-6989586621682883324"><span class="hs-identifier hs-var">jd</span></a></span><span>
</span><span id="line-860"></span><span>        </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Bool
</span><span class="hs-identifier hs-var">not</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Label -&gt; Bool
</span><a href="#local-6989586621682883327"><span class="hs-identifier hs-var">has_info</span></a></span><span> </span><span class="annot"><span class="annottext">Label
</span><a href="#local-6989586621682883322"><span class="hs-identifier hs-var">id</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-861"></span><span>        </span><span class="hs-special">,</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Label -&gt; LabelSet -&gt; Bool
</span><a href="GHC.Cmm.Dataflow.Label.html#setMember"><span class="hs-identifier hs-var">setMember</span></a></span><span> </span><span class="annot"><span class="annottext">Label
</span><a href="#local-6989586621682883326"><span class="hs-identifier hs-var">dest</span></a></span><span> </span><span class="annot"><span class="annottext">LabelSet
</span><a href="#local-6989586621682883318"><span class="hs-identifier hs-var">s</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Bool -&gt; Bool
</span><span class="hs-operator hs-var">||</span></span><span> </span><span class="annot"><span class="annottext">Label
</span><a href="#local-6989586621682883326"><span class="hs-identifier hs-var">dest</span></a></span><span> </span><span class="annot"><span class="annottext">Label -&gt; Label -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">==</span></span><span> </span><span class="annot"><span class="annottext">Label
</span><a href="#local-6989586621682883322"><span class="hs-identifier hs-var">id</span></a></span><span> </span><span class="hs-comment">-- loop checks</span><span>
</span><span id="line-862"></span><span>        </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">LabelSet
</span><a href="#local-6989586621682883318"><span class="hs-identifier hs-var">s</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">[(Label, jumpDest)]
</span><a href="#local-6989586621682883319"><span class="hs-identifier hs-var">shortcut_blocks</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">GenBasicBlock instr
</span><a href="#local-6989586621682883321"><span class="hs-identifier hs-var">b</span></a></span><span> </span><span class="annot"><span class="annottext">GenBasicBlock instr
-&gt; [GenBasicBlock instr] -&gt; [GenBasicBlock instr]
forall a. a -&gt; [a] -&gt; [a]
</span><span class="hs-glyph hs-var">:</span></span><span> </span><span class="annot"><span class="annottext">[GenBasicBlock instr]
</span><a href="#local-6989586621682883320"><span class="hs-identifier hs-var">others</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-863"></span><span>    </span><span class="annot"><a href="#local-6989586621682883317"><span class="hs-identifier hs-var">split</span></a></span><span> </span><span class="hs-special">(</span><span id="local-6989586621682883329"><span class="annot"><span class="annottext">LabelSet
</span><a href="#local-6989586621682883329"><span class="hs-identifier hs-var">s</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682883330"><span class="annot"><span class="annottext">[(Label, jumpDest)]
</span><a href="#local-6989586621682883330"><span class="hs-identifier hs-var">shortcut_blocks</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682883331"><span class="annot"><span class="annottext">[GenBasicBlock instr]
</span><a href="#local-6989586621682883331"><span class="hs-identifier hs-var">others</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Cmm.html#BasicBlock"><span class="hs-identifier hs-type">BasicBlock</span></a></span><span> </span><span id="local-6989586621682883332"><span class="annot"><span class="annottext">Label
</span><a href="#local-6989586621682883332"><span class="hs-identifier hs-var">id</span></a></span></span><span> </span><span class="hs-special">[</span><span id="local-6989586621682883333"><span class="annot"><span class="annottext">instr
</span><a href="#local-6989586621682883333"><span class="hs-identifier hs-var">insn</span></a></span></span><span class="hs-special">]</span><span class="hs-special">)</span><span>
</span><span id="line-864"></span><span>        </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span id="local-6989586621682883334"><span class="annot"><span class="annottext">jumpDest
</span><a href="#local-6989586621682883334"><span class="hs-identifier hs-var">dest</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">NcgImpl statics instr jumpDest -&gt; instr -&gt; Maybe jumpDest
forall statics instr jumpDest.
NcgImpl statics instr jumpDest -&gt; instr -&gt; Maybe jumpDest
</span><a href="GHC.CmmToAsm.Monad.html#canShortcut"><span class="hs-identifier hs-var">canShortcut</span></a></span><span> </span><span class="annot"><span class="annottext">NcgImpl statics instr jumpDest
</span><a href="#local-6989586621682883308"><span class="hs-identifier hs-var">ncgImpl</span></a></span><span> </span><span class="annot"><span class="annottext">instr
</span><a href="#local-6989586621682883333"><span class="hs-identifier hs-var">insn</span></a></span><span>
</span><span id="line-865"></span><span>        </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Bool
</span><span class="hs-identifier hs-var">not</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Label -&gt; Bool
</span><a href="#local-6989586621682883327"><span class="hs-identifier hs-var">has_info</span></a></span><span> </span><span class="annot"><span class="annottext">Label
</span><a href="#local-6989586621682883332"><span class="hs-identifier hs-var">id</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-866"></span><span>        </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Label -&gt; LabelSet -&gt; LabelSet
</span><a href="GHC.Cmm.Dataflow.Label.html#setInsert"><span class="hs-identifier hs-var">setInsert</span></a></span><span> </span><span class="annot"><span class="annottext">Label
</span><a href="#local-6989586621682883332"><span class="hs-identifier hs-var">id</span></a></span><span> </span><span class="annot"><span class="annottext">LabelSet
</span><a href="#local-6989586621682883329"><span class="hs-identifier hs-var">s</span></a></span><span class="hs-special">,</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Label
</span><a href="#local-6989586621682883332"><span class="hs-identifier hs-var">id</span></a></span><span class="hs-special">,</span><span class="annot"><span class="annottext">jumpDest
</span><a href="#local-6989586621682883334"><span class="hs-identifier hs-var">dest</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(Label, jumpDest) -&gt; [(Label, jumpDest)] -&gt; [(Label, jumpDest)]
forall a. a -&gt; [a] -&gt; [a]
</span><span class="hs-glyph hs-var">:</span></span><span> </span><span class="annot"><span class="annottext">[(Label, jumpDest)]
</span><a href="#local-6989586621682883330"><span class="hs-identifier hs-var">shortcut_blocks</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">[GenBasicBlock instr]
</span><a href="#local-6989586621682883331"><span class="hs-identifier hs-var">others</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-867"></span><span>    </span><span class="annot"><a href="#local-6989586621682883317"><span class="hs-identifier hs-var">split</span></a></span><span> </span><span class="hs-special">(</span><span id="local-6989586621682883336"><span class="annot"><span class="annottext">LabelSet
</span><a href="#local-6989586621682883336"><span class="hs-identifier hs-var">s</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682883337"><span class="annot"><span class="annottext">[(Label, jumpDest)]
</span><a href="#local-6989586621682883337"><span class="hs-identifier hs-var">shortcut_blocks</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682883338"><span class="annot"><span class="annottext">[GenBasicBlock instr]
</span><a href="#local-6989586621682883338"><span class="hs-identifier hs-var">others</span></a></span></span><span class="hs-special">)</span><span> </span><span id="local-6989586621682883339"><span class="annot"><span class="annottext">GenBasicBlock instr
</span><a href="#local-6989586621682883339"><span class="hs-identifier hs-var">other</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">LabelSet
</span><a href="#local-6989586621682883336"><span class="hs-identifier hs-var">s</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">[(Label, jumpDest)]
</span><a href="#local-6989586621682883337"><span class="hs-identifier hs-var">shortcut_blocks</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">GenBasicBlock instr
</span><a href="#local-6989586621682883339"><span class="hs-identifier hs-var">other</span></a></span><span> </span><span class="annot"><span class="annottext">GenBasicBlock instr
-&gt; [GenBasicBlock instr] -&gt; [GenBasicBlock instr]
forall a. a -&gt; [a] -&gt; [a]
</span><span class="hs-glyph hs-var">:</span></span><span> </span><span class="annot"><span class="annottext">[GenBasicBlock instr]
</span><a href="#local-6989586621682883338"><span class="hs-identifier hs-var">others</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-868"></span><span>
</span><span id="line-869"></span><span>    </span><span class="hs-comment">-- do not eliminate blocks that have an info table</span><span>
</span><span id="line-870"></span><span>    </span><span id="local-6989586621682883327"><span class="annot"><span class="annottext">has_info :: Label -&gt; Bool
</span><a href="#local-6989586621682883327"><span class="hs-identifier hs-var hs-var">has_info</span></a></span></span><span> </span><span id="local-6989586621682883340"><span class="annot"><span class="annottext">Label
</span><a href="#local-6989586621682883340"><span class="hs-identifier hs-var">l</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Label -&gt; LabelMap t -&gt; Bool
forall a. Label -&gt; LabelMap a -&gt; Bool
</span><a href="GHC.Cmm.Dataflow.Label.html#mapMember"><span class="hs-identifier hs-var">mapMember</span></a></span><span> </span><span class="annot"><span class="annottext">Label
</span><a href="#local-6989586621682883340"><span class="hs-identifier hs-var">l</span></a></span><span> </span><span class="annot"><span class="annottext">LabelMap t
</span><a href="#local-6989586621682883309"><span class="hs-identifier hs-var">info</span></a></span><span>
</span><span id="line-871"></span><span>
</span><span id="line-872"></span><span>    </span><span class="hs-comment">-- build a mapping from BlockId to JumpDest for shorting branches</span><span>
</span><span id="line-873"></span><span>    </span><span id="local-6989586621682883315"><span class="annot"><span class="annottext">mapping :: LabelMap jumpDest
</span><a href="#local-6989586621682883315"><span class="hs-identifier hs-var hs-var">mapping</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[(Label, jumpDest)] -&gt; LabelMap jumpDest
forall v. [(Label, v)] -&gt; LabelMap v
</span><a href="GHC.Cmm.Dataflow.Label.html#mapFromList"><span class="hs-identifier hs-var">mapFromList</span></a></span><span> </span><span class="annot"><span class="annottext">[(Label, jumpDest)]
</span><a href="#local-6989586621682883316"><span class="hs-identifier hs-var">shortcut_blocks</span></a></span><span>
</span><span id="line-874"></span><span>
</span><span id="line-875"></span><span id="local-6989586621682882433"><span id="local-6989586621682882434"><span id="local-6989586621682882435"><span id="local-6989586621682882436"><span class="annot"><a href="GHC.CmmToAsm.html#apply_mapping"><span class="hs-identifier hs-type">apply_mapping</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.CmmToAsm.Monad.html#NcgImpl"><span class="hs-identifier hs-type">NcgImpl</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682882433"><span class="hs-identifier hs-type">statics</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682882434"><span class="hs-identifier hs-type">instr</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682882435"><span class="hs-identifier hs-type">jumpDest</span></a></span><span>
</span><span id="line-876"></span><span>              </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Cmm.Dataflow.Label.html#LabelMap"><span class="hs-identifier hs-type">LabelMap</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682882435"><span class="hs-identifier hs-type">jumpDest</span></a></span><span>
</span><span id="line-877"></span><span>              </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Cmm.html#GenCmmDecl"><span class="hs-identifier hs-type">GenCmmDecl</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682882433"><span class="hs-identifier hs-type">statics</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682882436"><span class="hs-identifier hs-type">h</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Cmm.html#ListGraph"><span class="hs-identifier hs-type">ListGraph</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682882434"><span class="hs-identifier hs-type">instr</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-878"></span><span>              </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Cmm.html#GenCmmDecl"><span class="hs-identifier hs-type">GenCmmDecl</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682882433"><span class="hs-identifier hs-type">statics</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682882436"><span class="hs-identifier hs-type">h</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Cmm.html#ListGraph"><span class="hs-identifier hs-type">ListGraph</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682882434"><span class="hs-identifier hs-type">instr</span></a></span><span class="hs-special">)</span></span></span></span></span><span>
</span><span id="line-879"></span><span id="apply_mapping"><span class="annot"><span class="annottext">apply_mapping :: forall statics instr jumpDest h.
NcgImpl statics instr jumpDest
-&gt; LabelMap jumpDest
-&gt; GenCmmDecl statics h (ListGraph instr)
-&gt; GenCmmDecl statics h (ListGraph instr)
</span><a href="GHC.CmmToAsm.html#apply_mapping"><span class="hs-identifier hs-var hs-var">apply_mapping</span></a></span></span><span> </span><span id="local-6989586621682883342"><span class="annot"><span class="annottext">NcgImpl statics instr jumpDest
</span><a href="#local-6989586621682883342"><span class="hs-identifier hs-var">ncgImpl</span></a></span></span><span> </span><span id="local-6989586621682883343"><span class="annot"><span class="annottext">LabelMap jumpDest
</span><a href="#local-6989586621682883343"><span class="hs-identifier hs-var">ufm</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Cmm.html#CmmData"><span class="hs-identifier hs-type">CmmData</span></a></span><span> </span><span id="local-6989586621682883344"><span class="annot"><span class="annottext">Section
</span><a href="#local-6989586621682883344"><span class="hs-identifier hs-var">sec</span></a></span></span><span> </span><span id="local-6989586621682883345"><span class="annot"><span class="annottext">statics
</span><a href="#local-6989586621682883345"><span class="hs-identifier hs-var">statics</span></a></span></span><span class="hs-special">)</span><span>
</span><span id="line-880"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Section -&gt; statics -&gt; GenCmmDecl statics h (ListGraph instr)
forall d h g. Section -&gt; d -&gt; GenCmmDecl d h g
</span><a href="GHC.Cmm.html#CmmData"><span class="hs-identifier hs-var">CmmData</span></a></span><span> </span><span class="annot"><span class="annottext">Section
</span><a href="#local-6989586621682883344"><span class="hs-identifier hs-var">sec</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">NcgImpl statics instr jumpDest
-&gt; (Label -&gt; Maybe jumpDest) -&gt; statics -&gt; statics
forall statics instr jumpDest.
NcgImpl statics instr jumpDest
-&gt; (Label -&gt; Maybe jumpDest) -&gt; statics -&gt; statics
</span><a href="GHC.CmmToAsm.Monad.html#shortcutStatics"><span class="hs-identifier hs-var">shortcutStatics</span></a></span><span> </span><span class="annot"><span class="annottext">NcgImpl statics instr jumpDest
</span><a href="#local-6989586621682883342"><span class="hs-identifier hs-var">ncgImpl</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span id="local-6989586621682883347"><span class="annot"><span class="annottext">Label
</span><a href="#local-6989586621682883347"><span class="hs-identifier hs-var">bid</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Label -&gt; LabelMap jumpDest -&gt; Maybe jumpDest
forall a. Label -&gt; LabelMap a -&gt; Maybe a
</span><a href="GHC.Cmm.Dataflow.Label.html#mapLookup"><span class="hs-identifier hs-var">mapLookup</span></a></span><span> </span><span class="annot"><span class="annottext">Label
</span><a href="#local-6989586621682883347"><span class="hs-identifier hs-var">bid</span></a></span><span> </span><span class="annot"><span class="annottext">LabelMap jumpDest
</span><a href="#local-6989586621682883343"><span class="hs-identifier hs-var">ufm</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">statics
</span><a href="#local-6989586621682883345"><span class="hs-identifier hs-var">statics</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-881"></span><span class="annot"><a href="GHC.CmmToAsm.html#apply_mapping"><span class="hs-identifier hs-var">apply_mapping</span></a></span><span> </span><span id="local-6989586621682883349"><span class="annot"><span class="annottext">NcgImpl statics instr jumpDest
</span><a href="#local-6989586621682883349"><span class="hs-identifier hs-var">ncgImpl</span></a></span></span><span> </span><span id="local-6989586621682883350"><span class="annot"><span class="annottext">LabelMap jumpDest
</span><a href="#local-6989586621682883350"><span class="hs-identifier hs-var">ufm</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Cmm.html#CmmProc"><span class="hs-identifier hs-type">CmmProc</span></a></span><span> </span><span id="local-6989586621682883351"><span class="annot"><span class="annottext">h
</span><a href="#local-6989586621682883351"><span class="hs-identifier hs-var">info</span></a></span></span><span> </span><span id="local-6989586621682883352"><span class="annot"><span class="annottext">CLabel
</span><a href="#local-6989586621682883352"><span class="hs-identifier hs-var">lbl</span></a></span></span><span> </span><span id="local-6989586621682883353"><span class="annot"><span class="annottext">[GlobalRegUse]
</span><a href="#local-6989586621682883353"><span class="hs-identifier hs-var">live</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Cmm.html#ListGraph"><span class="hs-identifier hs-type">ListGraph</span></a></span><span> </span><span id="local-6989586621682883354"><span class="annot"><span class="annottext">[GenBasicBlock instr]
</span><a href="#local-6989586621682883354"><span class="hs-identifier hs-var">blocks</span></a></span></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-882"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">h
-&gt; CLabel
-&gt; [GlobalRegUse]
-&gt; ListGraph instr
-&gt; GenCmmDecl statics h (ListGraph instr)
forall d h g.
h -&gt; CLabel -&gt; [GlobalRegUse] -&gt; g -&gt; GenCmmDecl d h g
</span><a href="GHC.Cmm.html#CmmProc"><span class="hs-identifier hs-var">CmmProc</span></a></span><span> </span><span class="annot"><span class="annottext">h
</span><a href="#local-6989586621682883351"><span class="hs-identifier hs-var">info</span></a></span><span> </span><span class="annot"><span class="annottext">CLabel
</span><a href="#local-6989586621682883352"><span class="hs-identifier hs-var">lbl</span></a></span><span> </span><span class="annot"><span class="annottext">[GlobalRegUse]
</span><a href="#local-6989586621682883353"><span class="hs-identifier hs-var">live</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[GenBasicBlock instr] -&gt; ListGraph instr
forall i. [GenBasicBlock i] -&gt; ListGraph i
</span><a href="GHC.Cmm.html#ListGraph"><span class="hs-identifier hs-var">ListGraph</span></a></span><span> </span><span class="annot"><span class="annottext">([GenBasicBlock instr] -&gt; ListGraph instr)
-&gt; [GenBasicBlock instr] -&gt; ListGraph instr
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">(GenBasicBlock instr -&gt; GenBasicBlock instr)
-&gt; [GenBasicBlock instr] -&gt; [GenBasicBlock instr]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><span class="hs-identifier hs-var">map</span></span><span> </span><span class="annot"><span class="annottext">GenBasicBlock instr -&gt; GenBasicBlock instr
</span><a href="#local-6989586621682883355"><span class="hs-identifier hs-var">short_bb</span></a></span><span> </span><span class="annot"><span class="annottext">[GenBasicBlock instr]
</span><a href="#local-6989586621682883354"><span class="hs-identifier hs-var">blocks</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-883"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-884"></span><span>    </span><span id="local-6989586621682883355"><span class="annot"><span class="annottext">short_bb :: GenBasicBlock instr -&gt; GenBasicBlock instr
</span><a href="#local-6989586621682883355"><span class="hs-identifier hs-var hs-var">short_bb</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Cmm.html#BasicBlock"><span class="hs-identifier hs-type">BasicBlock</span></a></span><span> </span><span id="local-6989586621682883356"><span class="annot"><span class="annottext">Label
</span><a href="#local-6989586621682883356"><span class="hs-identifier hs-var">id</span></a></span></span><span> </span><span id="local-6989586621682883357"><span class="annot"><span class="annottext">[instr]
</span><a href="#local-6989586621682883357"><span class="hs-identifier hs-var">insns</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Label -&gt; [instr] -&gt; GenBasicBlock instr
forall i. Label -&gt; [i] -&gt; GenBasicBlock i
</span><a href="GHC.Cmm.html#BasicBlock"><span class="hs-identifier hs-var">BasicBlock</span></a></span><span> </span><span class="annot"><span class="annottext">Label
</span><a href="#local-6989586621682883356"><span class="hs-identifier hs-var">id</span></a></span><span> </span><span class="annot"><span class="annottext">([instr] -&gt; GenBasicBlock instr) -&gt; [instr] -&gt; GenBasicBlock instr
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$!</span></span><span> </span><span class="annot"><span class="annottext">(instr -&gt; instr) -&gt; [instr] -&gt; [instr]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><span class="hs-identifier hs-var">map</span></span><span> </span><span class="annot"><span class="annottext">instr -&gt; instr
</span><a href="#local-6989586621682883358"><span class="hs-identifier hs-var">short_insn</span></a></span><span> </span><span class="annot"><span class="annottext">[instr]
</span><a href="#local-6989586621682883357"><span class="hs-identifier hs-var">insns</span></a></span><span>
</span><span id="line-885"></span><span>    </span><span id="local-6989586621682883358"><span class="annot"><span class="annottext">short_insn :: instr -&gt; instr
</span><a href="#local-6989586621682883358"><span class="hs-identifier hs-var hs-var">short_insn</span></a></span></span><span> </span><span id="local-6989586621682883359"><span class="annot"><span class="annottext">instr
</span><a href="#local-6989586621682883359"><span class="hs-identifier hs-var">i</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">NcgImpl statics instr jumpDest
-&gt; (Label -&gt; Maybe jumpDest) -&gt; instr -&gt; instr
forall statics instr jumpDest.
NcgImpl statics instr jumpDest
-&gt; (Label -&gt; Maybe jumpDest) -&gt; instr -&gt; instr
</span><a href="GHC.CmmToAsm.Monad.html#shortcutJump"><span class="hs-identifier hs-var">shortcutJump</span></a></span><span> </span><span class="annot"><span class="annottext">NcgImpl statics instr jumpDest
</span><a href="#local-6989586621682883349"><span class="hs-identifier hs-var">ncgImpl</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span id="local-6989586621682883361"><span class="annot"><span class="annottext">Label
</span><a href="#local-6989586621682883361"><span class="hs-identifier hs-var">bid</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Label -&gt; LabelMap jumpDest -&gt; Maybe jumpDest
forall a. Label -&gt; LabelMap a -&gt; Maybe a
</span><a href="GHC.Cmm.Dataflow.Label.html#mapLookup"><span class="hs-identifier hs-var">mapLookup</span></a></span><span> </span><span class="annot"><span class="annottext">Label
</span><a href="#local-6989586621682883361"><span class="hs-identifier hs-var">bid</span></a></span><span> </span><span class="annot"><span class="annottext">LabelMap jumpDest
</span><a href="#local-6989586621682883350"><span class="hs-identifier hs-var">ufm</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">instr
</span><a href="#local-6989586621682883359"><span class="hs-identifier hs-var">i</span></a></span><span>
</span><span id="line-886"></span><span>                 </span><span class="hs-comment">-- shortcutJump should apply the mapping repeatedly,</span><span>
</span><span id="line-887"></span><span>                 </span><span class="hs-comment">-- just in case we can short multiple branches.</span><span>
</span><span id="line-888"></span><span>
</span><span id="line-889"></span><span class="hs-comment">-- -----------------------------------------------------------------------------</span><span>
</span><span id="line-890"></span><span class="hs-comment">-- Instruction selection</span><span>
</span><span id="line-891"></span><span>
</span><span id="line-892"></span><span class="hs-comment">-- Native code instruction selection for a chunk of stix code.  For</span><span>
</span><span id="line-893"></span><span class="hs-comment">-- this part of the computation, we switch from the UniqSM monad to</span><span>
</span><span id="line-894"></span><span class="hs-comment">-- the NatM monad.  The latter carries not only a Unique, but also an</span><span>
</span><span id="line-895"></span><span class="hs-comment">-- Int denoting the current C stack pointer offset in the generated</span><span>
</span><span id="line-896"></span><span class="hs-comment">-- code; this is needed for creating correct spill offsets on</span><span>
</span><span id="line-897"></span><span class="hs-comment">-- architectures which don't offer, or for which it would be</span><span>
</span><span id="line-898"></span><span class="hs-comment">-- prohibitively expensive to employ, a frame pointer register.  Viz,</span><span>
</span><span id="line-899"></span><span class="hs-comment">-- x86.</span><span>
</span><span id="line-900"></span><span>
</span><span id="line-901"></span><span class="hs-comment">-- The offset is measured in bytes, and indicates the difference</span><span>
</span><span id="line-902"></span><span class="hs-comment">-- between the current (simulated) C stack-ptr and the value it was at</span><span>
</span><span id="line-903"></span><span class="hs-comment">-- the beginning of the block.  For stacks which grow down, this value</span><span>
</span><span id="line-904"></span><span class="hs-comment">-- should be either zero or negative.</span><span>
</span><span id="line-905"></span><span>
</span><span id="line-906"></span><span class="hs-comment">-- Along with the stack pointer offset, we also carry along a LabelMap of</span><span>
</span><span id="line-907"></span><span class="hs-comment">-- DebugBlocks, which we read to generate .location directives.</span><span>
</span><span id="line-908"></span><span class="hs-comment">--</span><span>
</span><span id="line-909"></span><span class="hs-comment">-- Switching between the two monads whilst carrying along the same</span><span>
</span><span id="line-910"></span><span class="hs-comment">-- Unique supply breaks abstraction.  Is that bad?</span><span>
</span><span id="line-911"></span><span>
</span><span id="line-912"></span><span id="local-6989586621682882298"><span id="local-6989586621682882299"><span class="annot"><a href="GHC.CmmToAsm.html#genMachCode"><span class="hs-identifier hs-type">genMachCode</span></a></span><span>
</span><span id="line-913"></span><span>        </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.CmmToAsm.Config.html#NCGConfig"><span class="hs-identifier hs-type">NCGConfig</span></a></span><span>
</span><span id="line-914"></span><span>        </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Cmm.html#RawCmmDecl"><span class="hs-identifier hs-type">RawCmmDecl</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.CmmToAsm.Monad.html#NatM"><span class="hs-identifier hs-type">NatM</span></a></span><span> </span><span class="hs-special">[</span><span class="annot"><a href="GHC.CmmToAsm.Types.html#NatCmmDecl"><span class="hs-identifier hs-type">NatCmmDecl</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682882298"><span class="hs-identifier hs-type">statics</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682882299"><span class="hs-identifier hs-type">instr</span></a></span><span class="hs-special">]</span><span class="hs-special">)</span><span>
</span><span id="line-915"></span><span>        </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.CmmToAsm.Monad.html#DwarfFiles"><span class="hs-identifier hs-type">DwarfFiles</span></a></span><span>
</span><span id="line-916"></span><span>        </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Cmm.Dataflow.Label.html#LabelMap"><span class="hs-identifier hs-type">LabelMap</span></a></span><span> </span><span class="annot"><a href="GHC.Cmm.DebugBlock.html#DebugBlock"><span class="hs-identifier hs-type">DebugBlock</span></a></span><span>
</span><span id="line-917"></span><span>        </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Cmm.html#RawCmmDecl"><span class="hs-identifier hs-type">RawCmmDecl</span></a></span><span>
</span><span id="line-918"></span><span>        </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.CmmToAsm.CFG.html#CFG"><span class="hs-identifier hs-type">CFG</span></a></span><span>
</span><span id="line-919"></span><span>        </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Types.Unique.DSM.html#UniqDSM"><span class="hs-identifier hs-type">UniqDSM</span></a></span><span>
</span><span id="line-920"></span><span>                </span><span class="hs-special">(</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="GHC.CmmToAsm.Types.html#NatCmmDecl"><span class="hs-identifier hs-type">NatCmmDecl</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682882298"><span class="hs-identifier hs-type">statics</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682882299"><span class="hs-identifier hs-type">instr</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-921"></span><span>                </span><span class="hs-special">,</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="GHC.Cmm.CLabel.html#CLabel"><span class="hs-identifier hs-type">CLabel</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-922"></span><span>                </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.CmmToAsm.Monad.html#DwarfFiles"><span class="hs-identifier hs-type">DwarfFiles</span></a></span><span>
</span><span id="line-923"></span><span>                </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.CmmToAsm.CFG.html#CFG"><span class="hs-identifier hs-type">CFG</span></a></span><span>
</span><span id="line-924"></span><span>                </span><span class="hs-special">)</span></span></span><span>
</span><span id="line-925"></span><span>
</span><span id="line-926"></span><span id="genMachCode"><span class="annot"><span class="annottext">genMachCode :: forall statics instr.
NCGConfig
-&gt; (RawCmmDecl -&gt; NatM [NatCmmDecl statics instr])
-&gt; DwarfFiles
-&gt; LabelMap DebugBlock
-&gt; RawCmmDecl
-&gt; CFG
-&gt; UniqDSM ([NatCmmDecl statics instr], [CLabel], DwarfFiles, CFG)
</span><a href="GHC.CmmToAsm.html#genMachCode"><span class="hs-identifier hs-var hs-var">genMachCode</span></a></span></span><span> </span><span id="local-6989586621682883370"><span class="annot"><span class="annottext">NCGConfig
</span><a href="#local-6989586621682883370"><span class="hs-identifier hs-var">config</span></a></span></span><span> </span><span id="local-6989586621682883371"><span class="annot"><span class="annottext">RawCmmDecl -&gt; NatM [NatCmmDecl statics instr]
</span><a href="#local-6989586621682883371"><span class="hs-identifier hs-var">cmmTopCodeGen</span></a></span></span><span> </span><span id="local-6989586621682883372"><span class="annot"><span class="annottext">DwarfFiles
</span><a href="#local-6989586621682883372"><span class="hs-identifier hs-var">fileIds</span></a></span></span><span> </span><span id="local-6989586621682883373"><span class="annot"><span class="annottext">LabelMap DebugBlock
</span><a href="#local-6989586621682883373"><span class="hs-identifier hs-var">dbgMap</span></a></span></span><span> </span><span id="local-6989586621682883374"><span class="annot"><span class="annottext">RawCmmDecl
</span><a href="#local-6989586621682883374"><span class="hs-identifier hs-var">cmm_top</span></a></span></span><span> </span><span id="local-6989586621682883375"><span class="annot"><span class="annottext">CFG
</span><a href="#local-6989586621682883375"><span class="hs-identifier hs-var">cmm_cfg</span></a></span></span><span>
</span><span id="line-927"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(DUniqSupply
 -&gt; DUniqResult
      ([NatCmmDecl statics instr], [CLabel], DwarfFiles, CFG))
-&gt; UniqDSM ([NatCmmDecl statics instr], [CLabel], DwarfFiles, CFG)
forall a. (DUniqSupply -&gt; DUniqResult a) -&gt; UniqDSM a
</span><a href="GHC.Types.Unique.DSM.html#UDSM"><span class="hs-identifier hs-var">UDSM</span></a></span><span> </span><span class="annot"><span class="annottext">((DUniqSupply
  -&gt; DUniqResult
       ([NatCmmDecl statics instr], [CLabel], DwarfFiles, CFG))
 -&gt; UniqDSM ([NatCmmDecl statics instr], [CLabel], DwarfFiles, CFG))
-&gt; (DUniqSupply
    -&gt; DUniqResult
         ([NatCmmDecl statics instr], [CLabel], DwarfFiles, CFG))
-&gt; UniqDSM ([NatCmmDecl statics instr], [CLabel], DwarfFiles, CFG)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-glyph">\</span><span id="local-6989586621682883377"><span class="annot"><span class="annottext">DUniqSupply
</span><a href="#local-6989586621682883377"><span class="hs-identifier hs-var">initial_us</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-928"></span><span>      </span><span class="hs-special">{</span><span> </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621682883378"><span class="annot"><span class="annottext">initial_st :: NatM_State
</span><a href="#local-6989586621682883378"><span class="hs-identifier hs-var hs-var">initial_st</span></a></span></span><span>           </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">DUniqSupply
-&gt; Int
-&gt; NCGConfig
-&gt; DwarfFiles
-&gt; LabelMap DebugBlock
-&gt; CFG
-&gt; NatM_State
</span><a href="GHC.CmmToAsm.Monad.html#mkNatM_State"><span class="hs-identifier hs-var">mkNatM_State</span></a></span><span> </span><span class="annot"><span class="annottext">DUniqSupply
</span><a href="#local-6989586621682883377"><span class="hs-identifier hs-var">initial_us</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">0</span></span><span> </span><span class="annot"><span class="annottext">NCGConfig
</span><a href="#local-6989586621682883370"><span class="hs-identifier hs-var">config</span></a></span><span>
</span><span id="line-929"></span><span>                                                </span><span class="annot"><span class="annottext">DwarfFiles
</span><a href="#local-6989586621682883372"><span class="hs-identifier hs-var">fileIds</span></a></span><span> </span><span class="annot"><span class="annottext">LabelMap DebugBlock
</span><a href="#local-6989586621682883373"><span class="hs-identifier hs-var">dbgMap</span></a></span><span> </span><span class="annot"><span class="annottext">CFG
</span><a href="#local-6989586621682883375"><span class="hs-identifier hs-var">cmm_cfg</span></a></span><span>
</span><span id="line-930"></span><span>            </span><span class="hs-special">(</span><span id="local-6989586621682883380"><span class="annot"><span class="annottext">[NatCmmDecl statics instr]
</span><a href="#local-6989586621682883380"><span class="hs-identifier hs-var">new_tops</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682883381"><span class="annot"><span class="annottext">NatM_State
</span><a href="#local-6989586621682883381"><span class="hs-identifier hs-var">final_st</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">NatM_State
-&gt; NatM [NatCmmDecl statics instr]
-&gt; ([NatCmmDecl statics instr], NatM_State)
forall a. NatM_State -&gt; NatM a -&gt; (a, NatM_State)
</span><a href="GHC.CmmToAsm.Monad.html#initNat"><span class="hs-identifier hs-var">initNat</span></a></span><span> </span><span class="annot"><span class="annottext">NatM_State
</span><a href="#local-6989586621682883378"><span class="hs-identifier hs-var">initial_st</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">RawCmmDecl -&gt; NatM [NatCmmDecl statics instr]
</span><a href="#local-6989586621682883371"><span class="hs-identifier hs-var">cmmTopCodeGen</span></a></span><span> </span><span class="annot"><span class="annottext">RawCmmDecl
</span><a href="#local-6989586621682883374"><span class="hs-identifier hs-var">cmm_top</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-931"></span><span>            </span><span id="local-6989586621682883383"><span class="annot"><span class="annottext">final_delta :: Int
</span><a href="#local-6989586621682883383"><span class="hs-identifier hs-var hs-var">final_delta</span></a></span></span><span>          </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">NatM_State -&gt; Int
</span><a href="GHC.CmmToAsm.Monad.html#natm_delta"><span class="hs-identifier hs-var">natm_delta</span></a></span><span> </span><span class="annot"><span class="annottext">NatM_State
</span><a href="#local-6989586621682883381"><span class="hs-identifier hs-var">final_st</span></a></span><span>
</span><span id="line-932"></span><span>            </span><span id="local-6989586621682883385"><span class="annot"><span class="annottext">final_imports :: [CLabel]
</span><a href="#local-6989586621682883385"><span class="hs-identifier hs-var hs-var">final_imports</span></a></span></span><span>        </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">NatM_State -&gt; [CLabel]
</span><a href="GHC.CmmToAsm.Monad.html#natm_imports"><span class="hs-identifier hs-var">natm_imports</span></a></span><span> </span><span class="annot"><span class="annottext">NatM_State
</span><a href="#local-6989586621682883381"><span class="hs-identifier hs-var">final_st</span></a></span><span>
</span><span id="line-933"></span><span>            </span><span id="local-6989586621682883387"><span class="annot"><span class="annottext">final_cfg :: CFG
</span><a href="#local-6989586621682883387"><span class="hs-identifier hs-var hs-var">final_cfg</span></a></span></span><span>            </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">NatM_State -&gt; CFG
</span><a href="GHC.CmmToAsm.Monad.html#natm_cfg"><span class="hs-identifier hs-var">natm_cfg</span></a></span><span> </span><span class="annot"><span class="annottext">NatM_State
</span><a href="#local-6989586621682883381"><span class="hs-identifier hs-var">final_st</span></a></span><span>
</span><span id="line-934"></span><span>      </span><span class="hs-special">;</span><span> </span><span class="hs-keyword">if</span><span>   </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621682883383"><span class="hs-identifier hs-var">final_delta</span></a></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">==</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">0</span></span><span>
</span><span id="line-935"></span><span>        </span><span class="hs-keyword">then</span><span> </span><span class="annot"><span class="annottext">([NatCmmDecl statics instr], [CLabel], DwarfFiles, CFG)
-&gt; DUniqSupply
-&gt; DUniqResult
     ([NatCmmDecl statics instr], [CLabel], DwarfFiles, CFG)
forall a. a -&gt; DUniqSupply -&gt; (# a, DUniqSupply #)
</span><a href="GHC.Types.Unique.DSM.html#DUniqResult"><span class="hs-identifier hs-var">DUniqResult</span></a></span><span>
</span><span id="line-936"></span><span>              </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[NatCmmDecl statics instr]
</span><a href="#local-6989586621682883380"><span class="hs-identifier hs-var">new_tops</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">[CLabel]
</span><a href="#local-6989586621682883385"><span class="hs-identifier hs-var">final_imports</span></a></span><span>
</span><span id="line-937"></span><span>                </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">NatM_State -&gt; DwarfFiles
</span><a href="GHC.CmmToAsm.Monad.html#natm_fileid"><span class="hs-identifier hs-var">natm_fileid</span></a></span><span> </span><span class="annot"><span class="annottext">NatM_State
</span><a href="#local-6989586621682883381"><span class="hs-identifier hs-var">final_st</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">CFG
</span><a href="#local-6989586621682883387"><span class="hs-identifier hs-var">final_cfg</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">NatM_State -&gt; DUniqSupply
</span><a href="GHC.CmmToAsm.Monad.html#natm_us"><span class="hs-identifier hs-var">natm_us</span></a></span><span> </span><span class="annot"><span class="annottext">NatM_State
</span><a href="#local-6989586621682883381"><span class="hs-identifier hs-var">final_st</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-938"></span><span>        </span><span class="hs-keyword">else</span><span> </span><span class="annot"><span class="annottext">([NatCmmDecl statics instr], [CLabel], DwarfFiles, CFG)
-&gt; DUniqSupply
-&gt; DUniqResult
     ([NatCmmDecl statics instr], [CLabel], DwarfFiles, CFG)
forall a. a -&gt; DUniqSupply -&gt; (# a, DUniqSupply #)
</span><a href="GHC.Types.Unique.DSM.html#DUniqResult"><span class="hs-identifier hs-var">DUniqResult</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">String
-&gt; SDoc -&gt; ([NatCmmDecl statics instr], [CLabel], DwarfFiles, CFG)
forall a. HasCallStack =&gt; String -&gt; SDoc -&gt; a
</span><a href="GHC.Utils.Panic.html#pprPanic"><span class="hs-identifier hs-var">pprPanic</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;genMachCode: nonzero final delta&quot;</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int -&gt; SDoc
forall doc. IsLine doc =&gt; Int -&gt; doc
</span><a href="GHC.Utils.Outputable.html#int"><span class="hs-identifier hs-var">int</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621682883383"><span class="hs-identifier hs-var">final_delta</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">DUniqSupply
forall a. HasCallStack =&gt; a
</span><span class="hs-identifier hs-var">undefined</span></span><span>
</span><span id="line-939"></span><span>      </span><span class="hs-special">}</span><span>
</span><span id="line-940"></span></pre></body></html>