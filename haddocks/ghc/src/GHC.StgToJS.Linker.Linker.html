<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><link rel="stylesheet" type="text/css" href="style.css" /><script type="text/javascript" src="highlight.js"></script></head><body><pre><span class="hs-pragma">{-# LANGUAGE OverloadedStrings #-}</span><span>
</span><span id="line-2"></span><span class="hs-pragma">{-# LANGUAGE TupleSections     #-}</span><span>
</span><span id="line-3"></span><span class="hs-pragma">{-# LANGUAGE LambdaCase        #-}</span><span>
</span><span id="line-4"></span><span class="hs-pragma">{-# LANGUAGE BlockArguments    #-}</span><span>
</span><span id="line-5"></span><span>
</span><span id="line-6"></span><span class="hs-comment">-----------------------------------------------------------------------------</span><span>
</span><span id="line-7"></span><span class="hs-comment">-- |</span><span>
</span><span id="line-8"></span><span class="hs-comment">-- Module      :  GHC.StgToJS.Linker.Linker</span><span>
</span><span id="line-9"></span><span class="hs-comment">-- Copyright   :  (c) The University of Glasgow 2001</span><span>
</span><span id="line-10"></span><span class="hs-comment">-- License     :  BSD-style (see the file LICENSE)</span><span>
</span><span id="line-11"></span><span class="hs-comment">--</span><span>
</span><span id="line-12"></span><span class="hs-comment">-- Maintainer  :  Jeffrey Young  &lt;jeffrey.young@iohk.io&gt;</span><span>
</span><span id="line-13"></span><span class="hs-comment">--                Luite Stegeman &lt;luite.stegeman@iohk.io&gt;</span><span>
</span><span id="line-14"></span><span class="hs-comment">--                Sylvain Henry  &lt;sylvain.henry@iohk.io&gt;</span><span>
</span><span id="line-15"></span><span class="hs-comment">--                Josh Meredith  &lt;josh.meredith@iohk.io&gt;</span><span>
</span><span id="line-16"></span><span class="hs-comment">-- Stability   :  experimental</span><span>
</span><span id="line-17"></span><span class="hs-comment">--</span><span>
</span><span id="line-18"></span><span class="hs-comment">-- GHCJS linker, collects dependencies from the object files</span><span>
</span><span id="line-19"></span><span class="hs-comment">-- which contain linkable units with dependency information</span><span>
</span><span id="line-20"></span><span class="hs-comment">--</span><span>
</span><span id="line-21"></span><span class="hs-comment">-----------------------------------------------------------------------------</span><span>
</span><span id="line-22"></span><span>
</span><span id="line-23"></span><span class="hs-keyword">module</span><span> </span><span class="annot"><a href="GHC.StgToJS.Linker.Linker.html"><span class="hs-identifier">GHC.StgToJS.Linker.Linker</span></a></span><span>
</span><span id="line-24"></span><span>  </span><span class="hs-special">(</span><span> </span><span class="annot"><a href="GHC.StgToJS.Linker.Linker.html#jsLinkBinary"><span class="hs-identifier">jsLinkBinary</span></a></span><span>
</span><span id="line-25"></span><span>  </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.StgToJS.Linker.Linker.html#jsLink"><span class="hs-identifier">jsLink</span></a></span><span>
</span><span id="line-26"></span><span>  </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.StgToJS.Linker.Linker.html#embedJsFile"><span class="hs-identifier">embedJsFile</span></a></span><span>
</span><span id="line-27"></span><span>  </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.StgToJS.Linker.Linker.html#staticInitStat"><span class="hs-identifier">staticInitStat</span></a></span><span>
</span><span id="line-28"></span><span>  </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.StgToJS.Linker.Linker.html#staticDeclStat"><span class="hs-identifier">staticDeclStat</span></a></span><span>
</span><span id="line-29"></span><span>  </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.StgToJS.Linker.Linker.html#mkExportedFuns"><span class="hs-identifier">mkExportedFuns</span></a></span><span>
</span><span id="line-30"></span><span>  </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.StgToJS.Linker.Linker.html#mkExportedModFuns"><span class="hs-identifier">mkExportedModFuns</span></a></span><span>
</span><span id="line-31"></span><span>  </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.StgToJS.Linker.Linker.html#computeLinkDependencies"><span class="hs-identifier">computeLinkDependencies</span></a></span><span>
</span><span id="line-32"></span><span>  </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.StgToJS.Linker.Linker.html#LinkSpec"><span class="hs-identifier">LinkSpec</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span>
</span><span id="line-33"></span><span>  </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.StgToJS.Linker.Types.html#LinkPlan"><span class="hs-identifier">LinkPlan</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span>
</span><span id="line-34"></span><span>  </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.StgToJS.Linker.Linker.html#emptyLinkPlan"><span class="hs-identifier">emptyLinkPlan</span></a></span><span>
</span><span id="line-35"></span><span>  </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.StgToJS.Linker.Linker.html#incrementLinkPlan"><span class="hs-identifier">incrementLinkPlan</span></a></span><span>
</span><span id="line-36"></span><span>  </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.StgToJS.Linker.Linker.html#ArchiveCache"><span class="hs-identifier">ArchiveCache</span></a></span><span>
</span><span id="line-37"></span><span>  </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.StgToJS.Linker.Linker.html#newArchiveCache"><span class="hs-identifier">newArchiveCache</span></a></span><span>
</span><span id="line-38"></span><span>  </span><span class="hs-special">)</span><span>
</span><span id="line-39"></span><span class="hs-keyword">where</span><span>
</span><span id="line-40"></span><span>
</span><span id="line-41"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Prelude.html"><span class="hs-identifier">GHC.Prelude</span></a></span><span>
</span><span id="line-42"></span><span>
</span><span id="line-43"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="../../ghc-boot-9.12.2-1a37/src/GHC.Platform.Host.html"><span class="hs-identifier">GHC.Platform.Host</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../../ghc-boot-9.12.2-1a37/src/GHC.Platform.Host.html#hostPlatformArchOS"><span class="hs-identifier">hostPlatformArchOS</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-44"></span><span>
</span><span id="line-45"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.JS.Make.html"><span class="hs-identifier">GHC.JS.Make</span></a></span><span>
</span><span id="line-46"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.JS.Optimizer.html"><span class="hs-identifier">GHC.JS.Optimizer</span></a></span><span>
</span><span id="line-47"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.JS.Ident.html"><span class="hs-identifier">GHC.JS.Ident</span></a></span><span>
</span><span id="line-48"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.JS.JStg.Syntax.html"><span class="hs-identifier">GHC.JS.JStg.Syntax</span></a></span><span>
</span><span id="line-49"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.JS.JStg.Monad.html"><span class="hs-identifier">GHC.JS.JStg.Monad</span></a></span><span>
</span><span id="line-50"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><a href="GHC.JS.Syntax.html"><span class="hs-identifier">GHC.JS.Syntax</span></a></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">JS</span></span><span>
</span><span id="line-51"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.JS.Transform.html"><span class="hs-identifier">GHC.JS.Transform</span></a></span><span>
</span><span id="line-52"></span><span>
</span><span id="line-53"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Driver.DynFlags.html"><span class="hs-identifier">GHC.Driver.DynFlags</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Driver.DynFlags.html#DynFlags"><span class="hs-identifier">DynFlags</span></a></span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-54"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Language.Haskell.Syntax.Module.Name.html"><span class="hs-identifier">Language.Haskell.Syntax.Module.Name</span></a></span><span>
</span><span id="line-55"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.SysTools.Cpp.html"><span class="hs-identifier">GHC.SysTools.Cpp</span></a></span><span>
</span><span id="line-56"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.SysTools.html"><span class="hs-identifier">GHC.SysTools</span></a></span><span>
</span><span id="line-57"></span><span>
</span><span id="line-58"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Linker.Static.Utils.html"><span class="hs-identifier">GHC.Linker.Static.Utils</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Linker.Static.Utils.html#exeFileName"><span class="hs-identifier">exeFileName</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-59"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Linker.Types.html"><span class="hs-identifier">GHC.Linker.Types</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Linker.Types.html#linkableObjs"><span class="hs-identifier">linkableObjs</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-60"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Linker.External.html"><span class="hs-identifier">GHC.Linker.External</span></a></span><span>
</span><span id="line-61"></span><span>
</span><span id="line-62"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.StgToJS.Linker.Types.html"><span class="hs-identifier">GHC.StgToJS.Linker.Types</span></a></span><span>
</span><span id="line-63"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.StgToJS.Linker.Utils.html"><span class="hs-identifier">GHC.StgToJS.Linker.Utils</span></a></span><span>
</span><span id="line-64"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.StgToJS.Linker.Opt.html"><span class="hs-identifier">GHC.StgToJS.Linker.Opt</span></a></span><span>
</span><span id="line-65"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.StgToJS.Rts.Rts.html"><span class="hs-identifier">GHC.StgToJS.Rts.Rts</span></a></span><span>
</span><span id="line-66"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.StgToJS.Object.html"><span class="hs-identifier">GHC.StgToJS.Object</span></a></span><span>
</span><span id="line-67"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.StgToJS.Types.html"><span class="hs-identifier">GHC.StgToJS.Types</span></a></span><span> </span><span class="hs-keyword">hiding</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.StgToJS.Types.html#LinkableUnit"><span class="hs-identifier">LinkableUnit</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-68"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.StgToJS.Symbols.html"><span class="hs-identifier">GHC.StgToJS.Symbols</span></a></span><span>
</span><span id="line-69"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.StgToJS.Arg.html"><span class="hs-identifier">GHC.StgToJS.Arg</span></a></span><span>
</span><span id="line-70"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.StgToJS.Closure.html"><span class="hs-identifier">GHC.StgToJS.Closure</span></a></span><span>
</span><span id="line-71"></span><span>
</span><span id="line-72"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Unit.State.html"><span class="hs-identifier">GHC.Unit.State</span></a></span><span>
</span><span id="line-73"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Unit.Env.html"><span class="hs-identifier">GHC.Unit.Env</span></a></span><span>
</span><span id="line-74"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Unit.Home.ModInfo.html"><span class="hs-identifier">GHC.Unit.Home.ModInfo</span></a></span><span>
</span><span id="line-75"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Unit.Types.html"><span class="hs-identifier">GHC.Unit.Types</span></a></span><span>
</span><span id="line-76"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Unit.Module.html"><span class="hs-identifier">GHC.Unit.Module</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Unit.Module.html#moduleStableString"><span class="hs-identifier">moduleStableString</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-77"></span><span>
</span><span id="line-78"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Utils.Outputable.html"><span class="hs-identifier">GHC.Utils.Outputable</span></a></span><span> </span><span class="hs-keyword">hiding</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Utils.Outputable.html#%3C%3E"><span class="hs-operator">(&lt;&gt;)</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-79"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Utils.BufHandle.html"><span class="hs-identifier">GHC.Utils.BufHandle</span></a></span><span>
</span><span id="line-80"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Utils.Panic.html"><span class="hs-identifier">GHC.Utils.Panic</span></a></span><span>
</span><span id="line-81"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Utils.Error.html"><span class="hs-identifier">GHC.Utils.Error</span></a></span><span>
</span><span id="line-82"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Utils.Logger.html"><span class="hs-identifier">GHC.Utils.Logger</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Utils.Logger.html#Logger"><span class="hs-identifier">Logger</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Utils.Logger.html#logVerbAtLeast"><span class="hs-identifier">logVerbAtLeast</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-83"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Utils.Binary.html"><span class="hs-identifier">GHC.Utils.Binary</span></a></span><span>
</span><span id="line-84"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><a href="GHC.Utils.Ppr.html"><span class="hs-identifier">GHC.Utils.Ppr</span></a></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">Ppr</span></span><span>
</span><span id="line-85"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Utils.TmpFs.html"><span class="hs-identifier">GHC.Utils.TmpFs</span></a></span><span>
</span><span id="line-86"></span><span>
</span><span id="line-87"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Types.Unique.Set.html"><span class="hs-identifier">GHC.Types.Unique.Set</span></a></span><span>
</span><span id="line-88"></span><span>
</span><span id="line-89"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><a href="GHC.SysTools.Ar.html"><span class="hs-identifier">GHC.SysTools.Ar</span></a></span><span>          </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">Ar</span></span><span>
</span><span id="line-90"></span><span>
</span><span id="line-91"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><a href="../../ghc-boot-9.12.2-1a37/src/GHC.Data.ShortText.html"><span class="hs-identifier">GHC.Data.ShortText</span></a></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">ST</span></span><span>
</span><span id="line-92"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Data.FastString.html"><span class="hs-identifier">GHC.Data.FastString</span></a></span><span>
</span><span id="line-93"></span><span>
</span><span id="line-94"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="../../base-4.21.0.0-ae91/src/Control.Monad.html"><span class="hs-identifier">Control.Monad</span></a></span><span>
</span><span id="line-95"></span><span>
</span><span id="line-96"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="../../array-0.5.8.0-9044/src/Data.Array.html"><span class="hs-identifier">Data.Array</span></a></span><span>
</span><span id="line-97"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><a href="../../bytestring-0.12.2.0-7dd0/src/Data.ByteString.html"><span class="hs-identifier">Data.ByteString</span></a></span><span>          </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">B</span></span><span>
</span><span id="line-98"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><a href="../../bytestring-0.12.2.0-7dd0/src/Data.ByteString.Char8.html"><span class="hs-identifier">Data.ByteString.Char8</span></a></span><span>    </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">BC</span></span><span>
</span><span id="line-99"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><a href="../../bytestring-0.12.2.0-7dd0/src/Data.ByteString.Lazy.html"><span class="hs-identifier">Data.ByteString.Lazy</span></a></span><span>     </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">BL</span></span><span>
</span><span id="line-100"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><a href="../../bytestring-0.12.2.0-7dd0/src/Data.ByteString.html"><span class="hs-identifier">Data.ByteString</span></a></span><span>          </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">BS</span></span><span>
</span><span id="line-101"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="../../base-4.21.0.0-ae91/src/Data.Function.html"><span class="hs-identifier">Data.Function</span></a></span><span>            </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">on</span></span><span class="hs-special">)</span><span>
</span><span id="line-102"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><a href="../../containers-0.7-5a8f/src/Data.IntSet.html"><span class="hs-identifier">Data.IntSet</span></a></span><span>              </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">IS</span></span><span>
</span><span id="line-103"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="../../base-4.21.0.0-ae91/src/Data.IORef.html"><span class="hs-identifier">Data.IORef</span></a></span><span>
</span><span id="line-104"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="../../base-4.21.0.0-ae91/src/Data.List.html"><span class="hs-identifier">Data.List</span></a></span><span>  </span><span class="hs-special">(</span><span> </span><span class="annot"><span class="hs-identifier">nub</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">intercalate</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">groupBy</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">intersperse</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">sortBy</span></span><span class="hs-special">)</span><span>
</span><span id="line-105"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="../../containers-0.7-5a8f/src/Data.Map.Strict.html"><span class="hs-identifier">Data.Map.Strict</span></a></span><span>          </span><span class="hs-special">(</span><span class="annot"><a href="../../containers-0.7-5a8f/src/Data.Map.Internal.html#Map"><span class="hs-identifier">Map</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-106"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><a href="../../containers-0.7-5a8f/src/Data.Map.Strict.html"><span class="hs-identifier">Data.Map.Strict</span></a></span><span>          </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">M</span></span><span>
</span><span id="line-107"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="../../base-4.21.0.0-ae91/src/Data.Maybe.html"><span class="hs-identifier">Data.Maybe</span></a></span><span>
</span><span id="line-108"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="../../containers-0.7-5a8f/src/Data.Set.html"><span class="hs-identifier">Data.Set</span></a></span><span>                 </span><span class="hs-special">(</span><span class="annot"><a href="../../containers-0.7-5a8f/src/Data.Set.Internal.html#Set"><span class="hs-identifier">Set</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-109"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><a href="../../containers-0.7-5a8f/src/Data.Set.html"><span class="hs-identifier">Data.Set</span></a></span><span>                 </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">S</span></span><span>
</span><span id="line-110"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="../../base-4.21.0.0-ae91/src/Data.Word.html"><span class="hs-identifier">Data.Word</span></a></span><span>
</span><span id="line-111"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="../../base-4.21.0.0-ae91/src/Data.Monoid.html"><span class="hs-identifier">Data.Monoid</span></a></span><span>
</span><span id="line-112"></span><span>
</span><span id="line-113"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="../../base-4.21.0.0-ae91/src/System.IO.html"><span class="hs-identifier">System.IO</span></a></span><span>
</span><span id="line-114"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="../../filepath-1.5.4.0-e69b/src/System.FilePath.html"><span class="hs-identifier">System.FilePath</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../../filepath-1.5.4.0-e69b/src/System.FilePath.Posix.html#%3C.%3E"><span class="hs-operator">(&lt;.&gt;)</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="../../filepath-1.5.4.0-e69b/src/System.FilePath.Posix.html#%3C%2F%3E"><span class="hs-operator">(&lt;/&gt;)</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="../../filepath-1.5.4.0-e69b/src/System.FilePath.Posix.html#dropExtension"><span class="hs-identifier">dropExtension</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="../../filepath-1.5.4.0-e69b/src/System.FilePath.Posix.html#takeDirectory"><span class="hs-identifier">takeDirectory</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-115"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="../../directory-1.3.9.0-af18/src/System.Directory.html"><span class="hs-identifier">System.Directory</span></a></span><span> </span><span class="hs-special">(</span><span> </span><span class="annot"><a href="../../directory-1.3.9.0-af18/src/System.Directory.html#createDirectoryIfMissing"><span class="hs-identifier">createDirectoryIfMissing</span></a></span><span>
</span><span id="line-116"></span><span>                        </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="../../directory-1.3.9.0-af18/src/System.Directory.html#doesFileExist"><span class="hs-identifier">doesFileExist</span></a></span><span>
</span><span id="line-117"></span><span>                        </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="../../directory-1.3.9.0-af18/src/System.Directory.html#getCurrentDirectory"><span class="hs-identifier">getCurrentDirectory</span></a></span><span>
</span><span id="line-118"></span><span>                        </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="../../directory-1.3.9.0-af18/src/System.Directory.Internal.Common.html#Permissions"><span class="hs-identifier">Permissions</span></a></span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span>
</span><span id="line-119"></span><span>                        </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="../../directory-1.3.9.0-af18/src/System.Directory.html#setPermissions"><span class="hs-identifier">setPermissions</span></a></span><span>
</span><span id="line-120"></span><span>                        </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="../../directory-1.3.9.0-af18/src/System.Directory.html#getPermissions"><span class="hs-identifier">getPermissions</span></a></span><span>
</span><span id="line-121"></span><span>                        </span><span class="hs-special">)</span><span>
</span><span id="line-122"></span><span>
</span><span id="line-123"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Unit.Finder.Types.html"><span class="hs-identifier">GHC.Unit.Finder.Types</span></a></span><span>
</span><span id="line-124"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Unit.Finder.html"><span class="hs-identifier">GHC.Unit.Finder</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Unit.Finder.html#findObjectLinkableMaybe"><span class="hs-identifier">findObjectLinkableMaybe</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Unit.Finder.html#findHomeModule"><span class="hs-identifier">findHomeModule</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-125"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Driver.Config.Finder.html"><span class="hs-identifier">GHC.Driver.Config.Finder</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Driver.Config.Finder.html#initFinderOpts"><span class="hs-identifier">initFinderOpts</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-126"></span><span>
</span><span id="line-127"></span><span class="hs-keyword">data</span><span> </span><span id="LinkerStats"><span class="annot"><a href="GHC.StgToJS.Linker.Linker.html#LinkerStats"><span class="hs-identifier hs-var">LinkerStats</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="LinkerStats"><span class="annot"><a href="GHC.StgToJS.Linker.Linker.html#LinkerStats"><span class="hs-identifier hs-var">LinkerStats</span></a></span></span><span>
</span><span id="line-128"></span><span>  </span><span class="hs-special">{</span><span> </span><span id="bytesPerModule"><span class="annot"><span class="annottext">LinkerStats -&gt; Map Module Word64
</span><a href="GHC.StgToJS.Linker.Linker.html#bytesPerModule"><span class="hs-identifier hs-var hs-var">bytesPerModule</span></a></span></span><span>     </span><span class="hs-glyph">::</span><span> </span><span class="hs-glyph">!</span><span class="hs-special">(</span><span class="annot"><a href="../../containers-0.7-5a8f/src/Data.Map.Internal.html#Map"><span class="hs-identifier hs-type">Map</span></a></span><span> </span><span class="annot"><a href="GHC.Unit.Types.html#Module"><span class="hs-identifier hs-type">Module</span></a></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Word64</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="hs-comment">-- ^ number of bytes linked per module</span></span><span>
</span><span id="line-129"></span><span>  </span><span class="hs-special">,</span><span> </span><span id="packedMetaDataSize"><span class="annot"><span class="annottext">LinkerStats -&gt; Word64
</span><a href="GHC.StgToJS.Linker.Linker.html#packedMetaDataSize"><span class="hs-identifier hs-var hs-var">packedMetaDataSize</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-glyph">!</span><span class="annot"><span class="hs-identifier hs-type">Word64</span></span><span>              </span><span class="annot"><span class="hs-comment">-- ^ number of bytes for metadata</span></span><span>
</span><span id="line-130"></span><span>  </span><span class="hs-special">}</span><span>
</span><span id="line-131"></span><span>
</span><span id="line-132"></span><span class="hs-keyword">newtype</span><span> </span><span id="ArchiveCache"><span class="annot"><a href="GHC.StgToJS.Linker.Linker.html#ArchiveCache"><span class="hs-identifier hs-var">ArchiveCache</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="ArchiveCache"><span class="annot"><a href="GHC.StgToJS.Linker.Linker.html#ArchiveCache"><span class="hs-identifier hs-var">ArchiveCache</span></a></span></span><span> </span><span class="hs-special">{</span><span> </span><span id="loadedArchives"><span class="annot"><span class="annottext">ArchiveCache -&gt; IORef (Map FilePath Archive)
</span><a href="GHC.StgToJS.Linker.Linker.html#loadedArchives"><span class="hs-identifier hs-var hs-var">loadedArchives</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">IORef</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../../containers-0.7-5a8f/src/Data.Map.Internal.html#Map"><span class="hs-identifier hs-type">Map</span></a></span><span> </span><span class="annot"><span class="hs-identifier hs-type">FilePath</span></span><span> </span><span class="annot"><a href="GHC.SysTools.Ar.html#Archive"><span class="hs-identifier hs-type">Ar.Archive</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-133"></span><span>
</span><span id="line-134"></span><span class="annot"><a href="GHC.StgToJS.Linker.Linker.html#newArchiveCache"><span class="hs-identifier hs-type">newArchiveCache</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="annot"><a href="GHC.StgToJS.Linker.Linker.html#ArchiveCache"><span class="hs-identifier hs-type">ArchiveCache</span></a></span><span>
</span><span id="line-135"></span><span id="newArchiveCache"><span class="annot"><span class="annottext">newArchiveCache :: IO ArchiveCache
</span><a href="GHC.StgToJS.Linker.Linker.html#newArchiveCache"><span class="hs-identifier hs-var hs-var">newArchiveCache</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">IORef (Map FilePath Archive) -&gt; ArchiveCache
</span><a href="GHC.StgToJS.Linker.Linker.html#ArchiveCache"><span class="hs-identifier hs-var">ArchiveCache</span></a></span><span> </span><span class="annot"><span class="annottext">(IORef (Map FilePath Archive) -&gt; ArchiveCache)
-&gt; IO (IORef (Map FilePath Archive)) -&gt; IO ArchiveCache
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="annot"><span class="annottext">Map FilePath Archive -&gt; IO (IORef (Map FilePath Archive))
forall a. a -&gt; IO (IORef a)
</span><span class="hs-identifier hs-var">newIORef</span></span><span> </span><span class="annot"><span class="annottext">Map FilePath Archive
forall k a. Map k a
</span><a href="../../containers-0.7-5a8f/src/Data.Map.Internal.html#empty"><span class="hs-identifier hs-var">M.empty</span></a></span><span>
</span><span id="line-136"></span><span>
</span><span id="line-137"></span><span class="annot"><a href="GHC.StgToJS.Linker.Linker.html#defaultJsContext"><span class="hs-identifier hs-type">defaultJsContext</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Utils.Outputable.html#SDocContext"><span class="hs-identifier hs-type">SDocContext</span></a></span><span>
</span><span id="line-138"></span><span id="defaultJsContext"><span class="annot"><span class="annottext">defaultJsContext :: SDocContext
</span><a href="GHC.StgToJS.Linker.Linker.html#defaultJsContext"><span class="hs-identifier hs-var hs-var">defaultJsContext</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">SDocContext
</span><a href="GHC.Utils.Outputable.html#defaultSDocContext"><span class="hs-identifier hs-var">defaultSDocContext</span></a></span><span class="hs-special">{</span><span class="annot"><a href="GHC.Utils.Outputable.html#sdocStyle"><span class="hs-identifier hs-var">sdocStyle</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="GHC.Utils.Outputable.html#PprCode"><span class="hs-identifier hs-type">PprCode</span></a></span><span class="hs-special">}</span><span>
</span><span id="line-139"></span><span>
</span><span id="line-140"></span><span class="annot"><a href="GHC.StgToJS.Linker.Linker.html#jsLinkBinary"><span class="hs-identifier hs-type">jsLinkBinary</span></a></span><span>
</span><span id="line-141"></span><span>  </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Unit.Finder.Types.html#FinderCache"><span class="hs-identifier hs-type">FinderCache</span></a></span><span>
</span><span id="line-142"></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.StgToJS.Linker.Types.html#JSLinkConfig"><span class="hs-identifier hs-type">JSLinkConfig</span></a></span><span>
</span><span id="line-143"></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.StgToJS.Types.html#StgToJSConfig"><span class="hs-identifier hs-type">StgToJSConfig</span></a></span><span>
</span><span id="line-144"></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Utils.Logger.html#Logger"><span class="hs-identifier hs-type">Logger</span></a></span><span>
</span><span id="line-145"></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Utils.TmpFs.html#TmpFs"><span class="hs-identifier hs-type">TmpFs</span></a></span><span>
</span><span id="line-146"></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Driver.DynFlags.html#DynFlags"><span class="hs-identifier hs-type">DynFlags</span></a></span><span>
</span><span id="line-147"></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Unit.Env.html#UnitEnv"><span class="hs-identifier hs-type">UnitEnv</span></a></span><span>
</span><span id="line-148"></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><span class="hs-identifier hs-type">FilePath</span></span><span class="hs-special">]</span><span>
</span><span id="line-149"></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="GHC.Unit.Types.html#UnitId"><span class="hs-identifier hs-type">UnitId</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-150"></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-151"></span><span id="jsLinkBinary"><span class="annot"><span class="annottext">jsLinkBinary :: FinderCache
-&gt; JSLinkConfig
-&gt; StgToJSConfig
-&gt; Logger
-&gt; TmpFs
-&gt; DynFlags
-&gt; UnitEnv
-&gt; [FilePath]
-&gt; [UnitId]
-&gt; IO ()
</span><a href="GHC.StgToJS.Linker.Linker.html#jsLinkBinary"><span class="hs-identifier hs-var hs-var">jsLinkBinary</span></a></span></span><span> </span><span id="local-6989586621682959801"><span class="annot"><span class="annottext">FinderCache
</span><a href="#local-6989586621682959801"><span class="hs-identifier hs-var">finder_cache</span></a></span></span><span> </span><span id="local-6989586621682959802"><span class="annot"><span class="annottext">JSLinkConfig
</span><a href="#local-6989586621682959802"><span class="hs-identifier hs-var">lc_cfg</span></a></span></span><span> </span><span id="local-6989586621682959803"><span class="annot"><span class="annottext">StgToJSConfig
</span><a href="#local-6989586621682959803"><span class="hs-identifier hs-var">cfg</span></a></span></span><span> </span><span id="local-6989586621682959804"><span class="annot"><span class="annottext">Logger
</span><a href="#local-6989586621682959804"><span class="hs-identifier hs-var">logger</span></a></span></span><span> </span><span id="local-6989586621682959805"><span class="annot"><span class="annottext">TmpFs
</span><a href="#local-6989586621682959805"><span class="hs-identifier hs-var">tmpfs</span></a></span></span><span> </span><span id="local-6989586621682959806"><span class="annot"><span class="annottext">DynFlags
</span><a href="#local-6989586621682959806"><span class="hs-identifier hs-var">dflags</span></a></span></span><span> </span><span id="local-6989586621682959807"><span class="annot"><span class="annottext">UnitEnv
</span><a href="#local-6989586621682959807"><span class="hs-identifier hs-var">unit_env</span></a></span></span><span> </span><span id="local-6989586621682959808"><span class="annot"><span class="annottext">[FilePath]
</span><a href="#local-6989586621682959808"><span class="hs-identifier hs-var">hs_objs</span></a></span></span><span> </span><span id="local-6989586621682959809"><span class="annot"><span class="annottext">[UnitId]
</span><a href="#local-6989586621682959809"><span class="hs-identifier hs-var">dep_units</span></a></span></span><span>
</span><span id="line-152"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">JSLinkConfig -&gt; Bool
</span><a href="GHC.StgToJS.Linker.Types.html#lcNoJSExecutables"><span class="hs-identifier hs-var">lcNoJSExecutables</span></a></span><span> </span><span class="annot"><span class="annottext">JSLinkConfig
</span><a href="#local-6989586621682959802"><span class="hs-identifier hs-var">lc_cfg</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">() -&gt; IO ()
forall a. a -&gt; IO a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-153"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">otherwise</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-154"></span><span>
</span><span id="line-155"></span><span>    </span><span class="hs-comment">-- additional objects to link are passed as FileOption ldInputs...</span><span>
</span><span id="line-156"></span><span>    </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621682959811"><span class="annot"><span class="annottext">cmdline_objs :: [FilePath]
</span><a href="#local-6989586621682959811"><span class="hs-identifier hs-var hs-var hs-var">cmdline_objs</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">FilePath
</span><a href="#local-6989586621682959812"><span class="hs-identifier hs-var">f</span></a></span><span> </span><span class="hs-glyph">|</span><span> </span><span class="annot"><a href="GHC.Utils.CliOption.html#FileOption"><span class="hs-identifier hs-type">FileOption</span></a></span><span> </span><span class="annot"><span class="annottext">FilePath
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621682959812"><span class="annot"><span class="annottext">FilePath
</span><a href="#local-6989586621682959812"><span class="hs-identifier hs-var">f</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">DynFlags -&gt; [Option]
</span><a href="GHC.Driver.DynFlags.html#ldInputs"><span class="hs-identifier hs-var">ldInputs</span></a></span><span> </span><span class="annot"><span class="annottext">DynFlags
</span><a href="#local-6989586621682959806"><span class="hs-identifier hs-var">dflags</span></a></span><span> </span><span class="hs-special">]</span><span>
</span><span id="line-157"></span><span>
</span><span id="line-158"></span><span>    </span><span class="hs-comment">-- cmdline objects: discriminate between the 3 kinds of objects we have</span><span>
</span><span id="line-159"></span><span>    </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621682959815"><span class="annot"><span class="annottext">disc :: [FilePath]
-&gt; [FilePath]
-&gt; [FilePath]
-&gt; [FilePath]
-&gt; IO ([FilePath], [FilePath], [FilePath])
</span><a href="#local-6989586621682959815"><span class="hs-identifier hs-var hs-var hs-var">disc</span></a></span></span><span> </span><span id="local-6989586621682959816"><span class="annot"><span class="annottext">[FilePath]
</span><a href="#local-6989586621682959816"><span class="hs-identifier hs-var">hss</span></a></span></span><span> </span><span id="local-6989586621682959817"><span class="annot"><span class="annottext">[FilePath]
</span><a href="#local-6989586621682959817"><span class="hs-identifier hs-var">jss</span></a></span></span><span> </span><span id="local-6989586621682959818"><span class="annot"><span class="annottext">[FilePath]
</span><a href="#local-6989586621682959818"><span class="hs-identifier hs-var">ccs</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-glyph">\</span><span class="hs-glyph">case</span><span>
</span><span id="line-160"></span><span>          </span><span class="hs-special">[</span><span class="hs-special">]</span><span>     </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">([FilePath], [FilePath], [FilePath])
-&gt; IO ([FilePath], [FilePath], [FilePath])
forall a. a -&gt; IO a
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">pure</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[FilePath]
</span><a href="#local-6989586621682959816"><span class="hs-identifier hs-var">hss</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">[FilePath]
</span><a href="#local-6989586621682959817"><span class="hs-identifier hs-var">jss</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">[FilePath]
</span><a href="#local-6989586621682959818"><span class="hs-identifier hs-var">ccs</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-161"></span><span>          </span><span class="hs-special">(</span><span id="local-6989586621682959819"><span class="annot"><span class="annottext">FilePath
</span><a href="#local-6989586621682959819"><span class="hs-identifier hs-var">o</span></a></span></span><span class="annot"><span class="hs-glyph hs-type">:</span></span><span id="local-6989586621682959820"><span class="annot"><span class="annottext">[FilePath]
</span><a href="#local-6989586621682959820"><span class="hs-identifier hs-var">os</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">FilePath -&gt; IO (Maybe ObjectKind)
</span><a href="GHC.StgToJS.Object.html#getObjectKind"><span class="hs-identifier hs-var">getObjectKind</span></a></span><span> </span><span class="annot"><span class="annottext">FilePath
</span><a href="#local-6989586621682959819"><span class="hs-identifier hs-var">o</span></a></span><span> </span><span class="annot"><span class="annottext">IO (Maybe ObjectKind)
-&gt; (Maybe ObjectKind -&gt; IO ([FilePath], [FilePath], [FilePath]))
-&gt; IO ([FilePath], [FilePath], [FilePath])
forall a b. IO a -&gt; (a -&gt; IO b) -&gt; IO b
forall (m :: * -&gt; *) a b. Monad m =&gt; m a -&gt; (a -&gt; m b) -&gt; m b
</span><span class="hs-operator hs-var">&gt;&gt;=</span></span><span> </span><span class="hs-glyph">\</span><span class="hs-glyph">case</span><span>
</span><span id="line-162"></span><span>            </span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span class="annot"><span class="annottext">ObjectKind
</span><a href="GHC.StgToJS.Object.html#ObjHs"><span class="hs-identifier hs-var">ObjHs</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">[FilePath]
-&gt; [FilePath]
-&gt; [FilePath]
-&gt; [FilePath]
-&gt; IO ([FilePath], [FilePath], [FilePath])
</span><a href="#local-6989586621682959815"><span class="hs-identifier hs-var">disc</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">FilePath
</span><a href="#local-6989586621682959819"><span class="hs-identifier hs-var">o</span></a></span><span class="annot"><span class="annottext">FilePath -&gt; [FilePath] -&gt; [FilePath]
forall a. a -&gt; [a] -&gt; [a]
</span><span class="hs-glyph hs-var">:</span></span><span class="annot"><span class="annottext">[FilePath]
</span><a href="#local-6989586621682959816"><span class="hs-identifier hs-var">hss</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[FilePath]
</span><a href="#local-6989586621682959817"><span class="hs-identifier hs-var">jss</span></a></span><span> </span><span class="annot"><span class="annottext">[FilePath]
</span><a href="#local-6989586621682959818"><span class="hs-identifier hs-var">ccs</span></a></span><span> </span><span class="annot"><span class="annottext">[FilePath]
</span><a href="#local-6989586621682959820"><span class="hs-identifier hs-var">os</span></a></span><span>
</span><span id="line-163"></span><span>            </span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span class="annot"><span class="annottext">ObjectKind
</span><a href="GHC.StgToJS.Object.html#ObjJs"><span class="hs-identifier hs-var">ObjJs</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">[FilePath]
-&gt; [FilePath]
-&gt; [FilePath]
-&gt; [FilePath]
-&gt; IO ([FilePath], [FilePath], [FilePath])
</span><a href="#local-6989586621682959815"><span class="hs-identifier hs-var">disc</span></a></span><span> </span><span class="annot"><span class="annottext">[FilePath]
</span><a href="#local-6989586621682959816"><span class="hs-identifier hs-var">hss</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">FilePath
</span><a href="#local-6989586621682959819"><span class="hs-identifier hs-var">o</span></a></span><span class="annot"><span class="annottext">FilePath -&gt; [FilePath] -&gt; [FilePath]
forall a. a -&gt; [a] -&gt; [a]
</span><span class="hs-glyph hs-var">:</span></span><span class="annot"><span class="annottext">[FilePath]
</span><a href="#local-6989586621682959817"><span class="hs-identifier hs-var">jss</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[FilePath]
</span><a href="#local-6989586621682959818"><span class="hs-identifier hs-var">ccs</span></a></span><span> </span><span class="annot"><span class="annottext">[FilePath]
</span><a href="#local-6989586621682959820"><span class="hs-identifier hs-var">os</span></a></span><span>
</span><span id="line-164"></span><span>            </span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span class="annot"><span class="annottext">ObjectKind
</span><a href="GHC.StgToJS.Object.html#ObjCc"><span class="hs-identifier hs-var">ObjCc</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">[FilePath]
-&gt; [FilePath]
-&gt; [FilePath]
-&gt; [FilePath]
-&gt; IO ([FilePath], [FilePath], [FilePath])
</span><a href="#local-6989586621682959815"><span class="hs-identifier hs-var">disc</span></a></span><span> </span><span class="annot"><span class="annottext">[FilePath]
</span><a href="#local-6989586621682959816"><span class="hs-identifier hs-var">hss</span></a></span><span> </span><span class="annot"><span class="annottext">[FilePath]
</span><a href="#local-6989586621682959817"><span class="hs-identifier hs-var">jss</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">FilePath
</span><a href="#local-6989586621682959819"><span class="hs-identifier hs-var">o</span></a></span><span class="annot"><span class="annottext">FilePath -&gt; [FilePath] -&gt; [FilePath]
forall a. a -&gt; [a] -&gt; [a]
</span><span class="hs-glyph hs-var">:</span></span><span class="annot"><span class="annottext">[FilePath]
</span><a href="#local-6989586621682959818"><span class="hs-identifier hs-var">ccs</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[FilePath]
</span><a href="#local-6989586621682959820"><span class="hs-identifier hs-var">os</span></a></span><span>
</span><span id="line-165"></span><span>            </span><span class="annot"><span class="annottext">Maybe ObjectKind
</span><span class="hs-identifier hs-var">Nothing</span></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-166"></span><span>              </span><span class="annot"><span class="annottext">Logger -&gt; SDoc -&gt; IO ()
</span><a href="GHC.Utils.Error.html#logInfo"><span class="hs-identifier hs-var">logInfo</span></a></span><span> </span><span class="annot"><span class="annottext">Logger
</span><a href="#local-6989586621682959804"><span class="hs-identifier hs-var">logger</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[SDoc] -&gt; SDoc
forall doc. IsDoc doc =&gt; [doc] -&gt; doc
</span><a href="GHC.Utils.Outputable.html#vcat"><span class="hs-identifier hs-var">vcat</span></a></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">FilePath -&gt; SDoc
forall doc. IsLine doc =&gt; FilePath -&gt; doc
</span><a href="GHC.Utils.Outputable.html#text"><span class="hs-identifier hs-var">text</span></a></span><span> </span><span class="annot"><span class="annottext">FilePath
</span><span class="hs-string">&quot;Ignoring unexpected command-line object: &quot;</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">FilePath -&gt; SDoc
forall doc. IsLine doc =&gt; FilePath -&gt; doc
</span><a href="GHC.Utils.Outputable.html#text"><span class="hs-identifier hs-var">text</span></a></span><span> </span><span class="annot"><span class="annottext">FilePath
</span><a href="#local-6989586621682959819"><span class="hs-identifier hs-var">o</span></a></span><span class="hs-special">]</span><span class="hs-special">)</span><span>
</span><span id="line-167"></span><span>              </span><span class="annot"><span class="annottext">[FilePath]
-&gt; [FilePath]
-&gt; [FilePath]
-&gt; [FilePath]
-&gt; IO ([FilePath], [FilePath], [FilePath])
</span><a href="#local-6989586621682959815"><span class="hs-identifier hs-var">disc</span></a></span><span> </span><span class="annot"><span class="annottext">[FilePath]
</span><a href="#local-6989586621682959816"><span class="hs-identifier hs-var">hss</span></a></span><span> </span><span class="annot"><span class="annottext">[FilePath]
</span><a href="#local-6989586621682959817"><span class="hs-identifier hs-var">jss</span></a></span><span> </span><span class="annot"><span class="annottext">[FilePath]
</span><a href="#local-6989586621682959818"><span class="hs-identifier hs-var">ccs</span></a></span><span> </span><span class="annot"><span class="annottext">[FilePath]
</span><a href="#local-6989586621682959820"><span class="hs-identifier hs-var">os</span></a></span><span>
</span><span id="line-168"></span><span>    </span><span class="hs-special">(</span><span id="local-6989586621682959828"><span class="annot"><a href="#local-6989586621682959828"><span class="hs-identifier hs-var">cmdline_hs_objs</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682959829"><span class="annot"><a href="#local-6989586621682959829"><span class="hs-identifier hs-var">cmdline_js_objs</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682959830"><span class="annot"><a href="#local-6989586621682959830"><span class="hs-identifier hs-var">cmdline_cc_objs</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">[FilePath]
-&gt; [FilePath]
-&gt; [FilePath]
-&gt; [FilePath]
-&gt; IO ([FilePath], [FilePath], [FilePath])
</span><a href="#local-6989586621682959815"><span class="hs-identifier hs-var">disc</span></a></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><span class="annot"><span class="annottext">[FilePath]
</span><a href="#local-6989586621682959811"><span class="hs-identifier hs-var">cmdline_objs</span></a></span><span>
</span><span id="line-169"></span><span>
</span><span id="line-170"></span><span>    </span><span class="hs-keyword">let</span><span>
</span><span id="line-171"></span><span>        </span><span id="local-6989586621682959831"><span class="annot"><a href="#local-6989586621682959831"><span class="hs-identifier hs-var hs-var">exe</span></a></span></span><span>         </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">DynFlags -&gt; FilePath
</span><a href="GHC.StgToJS.Linker.Utils.html#jsExeFileName"><span class="hs-identifier hs-var">jsExeFileName</span></a></span><span> </span><span class="annot"><span class="annottext">DynFlags
</span><a href="#local-6989586621682959806"><span class="hs-identifier hs-var">dflags</span></a></span><span>
</span><span id="line-172"></span><span>        </span><span id="local-6989586621682959833"><span class="annot"><a href="#local-6989586621682959833"><span class="hs-identifier hs-var hs-var">all_hs_objs</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[FilePath]
</span><a href="#local-6989586621682959808"><span class="hs-identifier hs-var">hs_objs</span></a></span><span> </span><span class="annot"><span class="annottext">[FilePath] -&gt; [FilePath] -&gt; [FilePath]
forall a. [a] -&gt; [a] -&gt; [a]
</span><span class="hs-operator hs-var">++</span></span><span> </span><span class="annot"><span class="annottext">[FilePath]
</span><a href="#local-6989586621682959828"><span class="hs-identifier hs-var">cmdline_hs_objs</span></a></span><span>
</span><span id="line-173"></span><span>        </span><span id="local-6989586621682959834"><span class="annot"><a href="#local-6989586621682959834"><span class="hs-identifier hs-var hs-var">all_js_objs</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[FilePath]
</span><a href="#local-6989586621682959829"><span class="hs-identifier hs-var">cmdline_js_objs</span></a></span><span>
</span><span id="line-174"></span><span>        </span><span id="local-6989586621682959835"><span class="annot"><a href="#local-6989586621682959835"><span class="hs-identifier hs-var hs-var">all_cc_objs</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[FilePath]
</span><a href="#local-6989586621682959830"><span class="hs-identifier hs-var">cmdline_cc_objs</span></a></span><span>
</span><span id="line-175"></span><span>        </span><span id="local-6989586621682959836"><span class="annot"><a href="#local-6989586621682959836"><span class="hs-identifier hs-var hs-var">is_root</span></a></span></span><span> </span><span class="annot"><span class="annottext">p
</span><span class="hs-identifier">_</span></span><span>   </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">True</span></span><span>
</span><span id="line-176"></span><span>                      </span><span class="hs-comment">-- FIXME: we shouldn't consider every function as a root,</span><span>
</span><span id="line-177"></span><span>                      </span><span class="hs-comment">-- but only the program entry point (main), either the</span><span>
</span><span id="line-178"></span><span>                      </span><span class="hs-comment">-- generated one or coming from an object</span><span>
</span><span id="line-179"></span><span>
</span><span id="line-180"></span><span>    </span><span class="hs-comment">-- compute dependencies</span><span>
</span><span id="line-181"></span><span>    </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621682959837"><span class="annot"><a href="#local-6989586621682959837"><span class="hs-identifier hs-var hs-var">link_spec</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="GHC.StgToJS.Linker.Linker.html#LinkSpec"><span class="hs-identifier hs-type">LinkSpec</span></a></span><span>
</span><span id="line-182"></span><span>          </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">lks_unit_ids :: [UnitId]
</span><a href="GHC.StgToJS.Linker.Linker.html#lks_unit_ids"><span class="hs-identifier hs-var">lks_unit_ids</span></a></span><span>        </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[UnitId]
</span><a href="#local-6989586621682959809"><span class="hs-identifier hs-var">dep_units</span></a></span><span>
</span><span id="line-183"></span><span>          </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">lks_obj_root_filter :: ExportedFun -&gt; Bool
</span><a href="GHC.StgToJS.Linker.Linker.html#lks_obj_root_filter"><span class="hs-identifier hs-var">lks_obj_root_filter</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ExportedFun -&gt; Bool
forall {p}. p -&gt; Bool
</span><a href="#local-6989586621682959836"><span class="hs-identifier hs-var">is_root</span></a></span><span>
</span><span id="line-184"></span><span>          </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">lks_extra_roots :: Set ExportedFun
</span><a href="GHC.StgToJS.Linker.Linker.html#lks_extra_roots"><span class="hs-identifier hs-var">lks_extra_roots</span></a></span><span>     </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Set ExportedFun
forall a. Monoid a =&gt; a
</span><span class="hs-identifier hs-var">mempty</span></span><span>
</span><span id="line-185"></span><span>          </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">lks_objs_hs :: [FilePath]
</span><a href="GHC.StgToJS.Linker.Linker.html#lks_objs_hs"><span class="hs-identifier hs-var">lks_objs_hs</span></a></span><span>         </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[FilePath]
</span><a href="#local-6989586621682959833"><span class="hs-identifier hs-var">all_hs_objs</span></a></span><span>
</span><span id="line-186"></span><span>          </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">lks_objs_js :: [FilePath]
</span><a href="GHC.StgToJS.Linker.Linker.html#lks_objs_js"><span class="hs-identifier hs-var">lks_objs_js</span></a></span><span>         </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[FilePath]
</span><a href="#local-6989586621682959834"><span class="hs-identifier hs-var">all_js_objs</span></a></span><span>
</span><span id="line-187"></span><span>          </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">lks_objs_cc :: [FilePath]
</span><a href="GHC.StgToJS.Linker.Linker.html#lks_objs_cc"><span class="hs-identifier hs-var">lks_objs_cc</span></a></span><span>         </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[FilePath]
</span><a href="#local-6989586621682959835"><span class="hs-identifier hs-var">all_cc_objs</span></a></span><span>
</span><span id="line-188"></span><span>          </span><span class="hs-special">}</span><span>
</span><span id="line-189"></span><span>
</span><span id="line-190"></span><span>    </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621682959845"><span class="annot"><a href="#local-6989586621682959845"><span class="hs-identifier hs-var hs-var">finder_opts</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">DynFlags -&gt; FinderOpts
</span><a href="GHC.Driver.Config.Finder.html#initFinderOpts"><span class="hs-identifier hs-var">initFinderOpts</span></a></span><span> </span><span class="annot"><span class="annottext">DynFlags
</span><a href="#local-6989586621682959806"><span class="hs-identifier hs-var">dflags</span></a></span><span>
</span><span id="line-191"></span><span>    </span><span id="local-6989586621682959846"><span class="annot"><a href="#local-6989586621682959846"><span class="hs-identifier hs-var">ar_cache</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><a href="GHC.StgToJS.Linker.Linker.html#newArchiveCache"><span class="hs-identifier hs-type">newArchiveCache</span></a></span><span>
</span><span id="line-192"></span><span>
</span><span id="line-193"></span><span>    </span><span id="local-6989586621682959847"><span class="annot"><a href="#local-6989586621682959847"><span class="hs-identifier hs-var">link_plan</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><a href="GHC.StgToJS.Linker.Linker.html#computeLinkDependencies"><span class="hs-identifier hs-type">computeLinkDependencies</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682959803"><span class="hs-identifier hs-type">cfg</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682959807"><span class="hs-identifier hs-type">unit_env</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682959837"><span class="hs-identifier hs-type">link_spec</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682959845"><span class="hs-identifier hs-type">finder_opts</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682959801"><span class="hs-identifier hs-type">finder_cache</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682959846"><span class="hs-identifier hs-type">ar_cache</span></a></span><span>
</span><span id="line-194"></span><span>
</span><span id="line-195"></span><span>    </span><span class="annot"><span class="hs-identifier hs-type">void</span></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="annot"><a href="GHC.StgToJS.Linker.Linker.html#jsLink"><span class="hs-identifier hs-type">jsLink</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682959802"><span class="hs-identifier hs-type">lc_cfg</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682959803"><span class="hs-identifier hs-type">cfg</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682959804"><span class="hs-identifier hs-type">logger</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682959805"><span class="hs-identifier hs-type">tmpfs</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682959846"><span class="hs-identifier hs-type">ar_cache</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682959831"><span class="hs-identifier hs-type">exe</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682959847"><span class="hs-identifier hs-type">link_plan</span></a></span><span>
</span><span id="line-196"></span><span>
</span><span id="line-197"></span><span class="annot"><span class="hs-comment">-- | link and write result to disk (jsexe directory)</span></span><span>
</span><span id="line-198"></span><span class="annot"><a href="GHC.StgToJS.Linker.Linker.html#jsLink"><span class="hs-identifier hs-type">jsLink</span></a></span><span>
</span><span id="line-199"></span><span>     </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.StgToJS.Linker.Types.html#JSLinkConfig"><span class="hs-identifier hs-type">JSLinkConfig</span></a></span><span>
</span><span id="line-200"></span><span>     </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.StgToJS.Types.html#StgToJSConfig"><span class="hs-identifier hs-type">StgToJSConfig</span></a></span><span>
</span><span id="line-201"></span><span>     </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Utils.Logger.html#Logger"><span class="hs-identifier hs-type">Logger</span></a></span><span>
</span><span id="line-202"></span><span>     </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Utils.TmpFs.html#TmpFs"><span class="hs-identifier hs-type">TmpFs</span></a></span><span>
</span><span id="line-203"></span><span>     </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.StgToJS.Linker.Linker.html#ArchiveCache"><span class="hs-identifier hs-type">ArchiveCache</span></a></span><span>
</span><span id="line-204"></span><span>     </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">FilePath</span></span><span>               </span><span class="annot"><span class="hs-comment">-- ^ output file/directory</span></span><span>
</span><span id="line-205"></span><span>     </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.StgToJS.Linker.Types.html#LinkPlan"><span class="hs-identifier hs-type">LinkPlan</span></a></span><span>
</span><span id="line-206"></span><span>     </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-207"></span><span id="jsLink"><span class="annot"><span class="annottext">jsLink :: JSLinkConfig
-&gt; StgToJSConfig
-&gt; Logger
-&gt; TmpFs
-&gt; ArchiveCache
-&gt; FilePath
-&gt; LinkPlan
-&gt; IO ()
</span><a href="GHC.StgToJS.Linker.Linker.html#jsLink"><span class="hs-identifier hs-var hs-var">jsLink</span></a></span></span><span> </span><span id="local-6989586621682959849"><span class="annot"><span class="annottext">JSLinkConfig
</span><a href="#local-6989586621682959849"><span class="hs-identifier hs-var">lc_cfg</span></a></span></span><span> </span><span id="local-6989586621682959850"><span class="annot"><span class="annottext">StgToJSConfig
</span><a href="#local-6989586621682959850"><span class="hs-identifier hs-var">cfg</span></a></span></span><span> </span><span id="local-6989586621682959851"><span class="annot"><span class="annottext">Logger
</span><a href="#local-6989586621682959851"><span class="hs-identifier hs-var">logger</span></a></span></span><span> </span><span id="local-6989586621682959852"><span class="annot"><span class="annottext">TmpFs
</span><a href="#local-6989586621682959852"><span class="hs-identifier hs-var">tmpfs</span></a></span></span><span> </span><span id="local-6989586621682959853"><span class="annot"><span class="annottext">ArchiveCache
</span><a href="#local-6989586621682959853"><span class="hs-identifier hs-var">ar_cache</span></a></span></span><span> </span><span id="local-6989586621682959854"><span class="annot"><span class="annottext">FilePath
</span><a href="#local-6989586621682959854"><span class="hs-identifier hs-var">out</span></a></span></span><span> </span><span id="local-6989586621682959855"><span class="annot"><span class="annottext">LinkPlan
</span><a href="#local-6989586621682959855"><span class="hs-identifier hs-var">link_plan</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-208"></span><span>
</span><span id="line-209"></span><span>      </span><span class="hs-comment">-- create output directory</span><span>
</span><span id="line-210"></span><span>      </span><span class="annot"><span class="annottext">Bool -&gt; FilePath -&gt; IO ()
</span><a href="../../directory-1.3.9.0-af18/src/System.Directory.html#createDirectoryIfMissing"><span class="hs-identifier hs-var">createDirectoryIfMissing</span></a></span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">False</span></span><span> </span><span class="annot"><span class="annottext">FilePath
</span><a href="#local-6989586621682959854"><span class="hs-identifier hs-var">out</span></a></span><span>
</span><span id="line-211"></span><span>
</span><span id="line-212"></span><span>      </span><span class="annot"><span class="annottext">Bool -&gt; IO () -&gt; IO ()
forall (f :: * -&gt; *). Applicative f =&gt; Bool -&gt; f () -&gt; f ()
</span><span class="hs-identifier hs-var">when</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Logger -&gt; BlockId -&gt; Bool
</span><a href="GHC.Utils.Logger.html#logVerbAtLeast"><span class="hs-identifier hs-var">logVerbAtLeast</span></a></span><span> </span><span class="annot"><span class="annottext">Logger
</span><a href="#local-6989586621682959851"><span class="hs-identifier hs-var">logger</span></a></span><span> </span><span class="annot"><span class="annottext">BlockId
</span><span class="hs-number">2</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(IO () -&gt; IO ()) -&gt; IO () -&gt; IO ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-213"></span><span>        </span><span class="annot"><span class="annottext">Logger -&gt; SDoc -&gt; IO ()
</span><a href="GHC.Utils.Error.html#logInfo"><span class="hs-identifier hs-var">logInfo</span></a></span><span> </span><span class="annot"><span class="annottext">Logger
</span><a href="#local-6989586621682959851"><span class="hs-identifier hs-var">logger</span></a></span><span> </span><span class="annot"><span class="annottext">(SDoc -&gt; IO ()) -&gt; SDoc -&gt; IO ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">SDoc -&gt; BlockId -&gt; SDoc -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#hang"><span class="hs-identifier hs-var">hang</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">FilePath -&gt; SDoc
forall doc. IsLine doc =&gt; FilePath -&gt; doc
</span><a href="GHC.Utils.Outputable.html#text"><span class="hs-identifier hs-var">text</span></a></span><span> </span><span class="annot"><span class="annottext">FilePath
</span><span class="hs-string">&quot;jsLink:&quot;</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">BlockId
</span><span class="hs-number">2</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">LinkPlan -&gt; SDoc
forall a. Outputable a =&gt; a -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="annot"><span class="annottext">LinkPlan
</span><a href="#local-6989586621682959855"><span class="hs-identifier hs-var">link_plan</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-214"></span><span>
</span><span id="line-215"></span><span>      </span><span class="hs-comment">-------------------------------------------------------------</span><span>
</span><span id="line-216"></span><span>      </span><span class="hs-comment">-- link all Haskell code (program + dependencies) into out.js</span><span>
</span><span id="line-217"></span><span>
</span><span id="line-218"></span><span>      </span><span class="hs-comment">-- retrieve code for Haskell dependencies</span><span>
</span><span id="line-219"></span><span>      </span><span id="local-6989586621682959859"><span class="annot"><a href="#local-6989586621682959859"><span class="hs-identifier hs-var">mods</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">ArchiveCache -&gt; LinkPlan -&gt; IO [ModuleCode]
</span><a href="GHC.StgToJS.Linker.Linker.html#collectModuleCodes"><span class="hs-identifier hs-var">collectModuleCodes</span></a></span><span> </span><span class="annot"><span class="annottext">ArchiveCache
</span><a href="#local-6989586621682959853"><span class="hs-identifier hs-var">ar_cache</span></a></span><span> </span><span class="annot"><span class="annottext">LinkPlan
</span><a href="#local-6989586621682959855"><span class="hs-identifier hs-var">link_plan</span></a></span><span>
</span><span id="line-220"></span><span>
</span><span id="line-221"></span><span>      </span><span class="hs-comment">-- LTO + rendering of JS code</span><span>
</span><span id="line-222"></span><span>      </span><span id="local-6989586621682959861"><span class="annot"><a href="#local-6989586621682959861"><span class="hs-identifier hs-var">link_stats</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="hs-identifier hs-type">withBinaryFile</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621682959854"><span class="hs-identifier hs-type">out</span></a></span><span> </span><span class="annot"><a href="../../filepath-1.5.4.0-e69b/src/System.FilePath.Posix.html#%3C%2F%3E"><span class="hs-operator hs-type">&lt;/&gt;</span></a></span><span> </span><span class="annot"><span class="hs-string">&quot;out.js&quot;</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="hs-identifier hs-type">WriteMode</span></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="hs-glyph">\</span><span id="local-6989586621682959864"><span class="annot"><span class="annottext">Handle
</span><a href="#local-6989586621682959864"><span class="hs-identifier hs-var">h</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-223"></span><span>        </span><span class="annot"><span class="annottext">Handle -&gt; Bool -&gt; [ModuleCode] -&gt; IO LinkerStats
</span><a href="GHC.StgToJS.Linker.Linker.html#renderModules"><span class="hs-identifier hs-var">renderModules</span></a></span><span> </span><span class="annot"><span class="annottext">Handle
</span><a href="#local-6989586621682959864"><span class="hs-identifier hs-var">h</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">StgToJSConfig -&gt; Bool
</span><a href="GHC.StgToJS.Types.html#csPrettyRender"><span class="hs-identifier hs-var">csPrettyRender</span></a></span><span> </span><span class="annot"><span class="annottext">StgToJSConfig
</span><a href="#local-6989586621682959850"><span class="hs-identifier hs-var">cfg</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[ModuleCode]
</span><a href="#local-6989586621682959859"><span class="hs-identifier hs-var">mods</span></a></span><span>
</span><span id="line-224"></span><span>
</span><span id="line-225"></span><span>      </span><span class="hs-comment">-------------------------------------------------------------</span><span>
</span><span id="line-226"></span><span>
</span><span id="line-227"></span><span>      </span><span class="hs-comment">-- dump foreign references file (.frefs)</span><span>
</span><span id="line-228"></span><span>      </span><span class="annot"><span class="hs-identifier hs-type">when</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.StgToJS.Linker.Types.html#lcForeignRefs"><span class="hs-identifier hs-var">lcForeignRefs</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682959849"><span class="hs-identifier hs-type">lc_cfg</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-229"></span><span>        </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621682959869"><span class="annot"><a href="#local-6989586621682959869"><span class="hs-identifier hs-var hs-var">frefsFile</span></a></span></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">FilePath
</span><span class="hs-string">&quot;out.frefs&quot;</span></span><span>
</span><span id="line-230"></span><span>            </span><span class="hs-comment">-- frefs      = concatMap mc_frefs mods</span><span>
</span><span id="line-231"></span><span>            </span><span id="local-6989586621682959873"><span class="annot"><a href="#local-6989586621682959873"><span class="hs-identifier hs-var hs-var">jsonFrefs</span></a></span></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ByteString
forall a. Monoid a =&gt; a
</span><span class="hs-identifier hs-var">mempty</span></span><span> </span><span class="hs-comment">-- FIXME: toJson frefs</span><span>
</span><span id="line-232"></span><span>
</span><span id="line-233"></span><span>        </span><span class="annot"><a href="../../bytestring-0.12.2.0-7dd0/src/Data.ByteString.Lazy.html#writeFile"><span class="hs-identifier hs-type">BL.writeFile</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621682959854"><span class="hs-identifier hs-type">out</span></a></span><span> </span><span class="annot"><a href="../../filepath-1.5.4.0-e69b/src/System.FilePath.Posix.html#%3C%2F%3E"><span class="hs-operator hs-type">&lt;/&gt;</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682959869"><span class="hs-identifier hs-type">frefsFile</span></a></span><span> </span><span class="annot"><a href="../../filepath-1.5.4.0-e69b/src/System.FilePath.Posix.html#%3C.%3E"><span class="hs-operator hs-type">&lt;.&gt;</span></a></span><span> </span><span class="annot"><span class="hs-string">&quot;json&quot;</span></span><span class="hs-special">)</span><span> </span><span class="annot"><a href="#local-6989586621682959873"><span class="hs-identifier hs-type">jsonFrefs</span></a></span><span>
</span><span id="line-234"></span><span>        </span><span class="annot"><a href="../../bytestring-0.12.2.0-7dd0/src/Data.ByteString.Lazy.html#writeFile"><span class="hs-identifier hs-type">BL.writeFile</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621682959854"><span class="hs-identifier hs-type">out</span></a></span><span> </span><span class="annot"><a href="../../filepath-1.5.4.0-e69b/src/System.FilePath.Posix.html#%3C%2F%3E"><span class="hs-operator hs-type">&lt;/&gt;</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682959869"><span class="hs-identifier hs-type">frefsFile</span></a></span><span> </span><span class="annot"><a href="../../filepath-1.5.4.0-e69b/src/System.FilePath.Posix.html#%3C.%3E"><span class="hs-operator hs-type">&lt;.&gt;</span></a></span><span> </span><span class="annot"><span class="hs-string">&quot;js&quot;</span></span><span class="hs-special">)</span><span>
</span><span id="line-235"></span><span>                     </span><span class="hs-special">(</span><span class="annot"><span class="hs-string">&quot;h$checkForeignRefs(&quot;</span></span><span> </span><span class="annot"><span class="hs-operator hs-type">&lt;&gt;</span></span><span> </span><span class="annot"><a href="#local-6989586621682959873"><span class="hs-identifier hs-type">jsonFrefs</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">&lt;&gt;</span></span><span> </span><span class="annot"><span class="hs-string">&quot;);&quot;</span></span><span class="hs-special">)</span><span>
</span><span id="line-236"></span><span>
</span><span id="line-237"></span><span>      </span><span class="hs-comment">-- dump stats</span><span>
</span><span id="line-238"></span><span>      </span><span class="annot"><span class="hs-identifier hs-type">unless</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.StgToJS.Linker.Types.html#lcNoStats"><span class="hs-identifier hs-var">lcNoStats</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682959849"><span class="hs-identifier hs-type">lc_cfg</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-239"></span><span>        </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621682959878"><span class="annot"><a href="#local-6989586621682959878"><span class="hs-identifier hs-var hs-var">statsFile</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">FilePath
</span><span class="hs-string">&quot;out.stats&quot;</span></span><span>
</span><span id="line-240"></span><span>        </span><span class="annot"><span class="hs-identifier hs-type">writeFile</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621682959854"><span class="hs-identifier hs-type">out</span></a></span><span> </span><span class="annot"><a href="../../filepath-1.5.4.0-e69b/src/System.FilePath.Posix.html#%3C%2F%3E"><span class="hs-operator hs-type">&lt;/&gt;</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682959878"><span class="hs-identifier hs-type">statsFile</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.StgToJS.Linker.Linker.html#renderLinkerStats"><span class="hs-identifier hs-type">renderLinkerStats</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682959861"><span class="hs-identifier hs-type">link_stats</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-241"></span><span>
</span><span id="line-242"></span><span>      </span><span class="hs-comment">-- link generated RTS parts into rts.js</span><span>
</span><span id="line-243"></span><span>      </span><span class="annot"><span class="hs-identifier hs-type">unless</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.StgToJS.Linker.Types.html#lcNoRts"><span class="hs-identifier hs-var">lcNoRts</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682959849"><span class="hs-identifier hs-type">lc_cfg</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-244"></span><span>        </span><span id="local-6989586621682959882"><span class="annot"><a href="#local-6989586621682959882"><span class="hs-identifier hs-var">jsm</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><a href="GHC.JS.JStg.Monad.html#initJSM"><span class="hs-identifier hs-type">initJSM</span></a></span><span>
</span><span id="line-245"></span><span>        </span><span class="annot"><span class="hs-identifier hs-type">withFile</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621682959854"><span class="hs-identifier hs-type">out</span></a></span><span> </span><span class="annot"><a href="../../filepath-1.5.4.0-e69b/src/System.FilePath.Posix.html#%3C%2F%3E"><span class="hs-operator hs-type">&lt;/&gt;</span></a></span><span> </span><span class="annot"><span class="hs-string">&quot;rts.js&quot;</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="hs-identifier hs-type">WriteMode</span></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="hs-glyph">\</span><span id="local-6989586621682959885"><span class="annot"><span class="annottext">Handle
</span><a href="#local-6989586621682959885"><span class="hs-identifier hs-var">h</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-246"></span><span>          </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621682959886"><span class="annot"><span class="annottext">opt :: JStat
</span><a href="#local-6989586621682959886"><span class="hs-identifier hs-var hs-var">opt</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">JStat -&gt; JStat
</span><a href="GHC.JS.Optimizer.html#jsOptimize"><span class="hs-identifier hs-var">jsOptimize</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">JEnv -&gt; JSM JStat -&gt; JStat
forall a. JEnv -&gt; JSM a -&gt; a
</span><a href="GHC.JS.JStg.Monad.html#runJSM"><span class="hs-identifier hs-var">runJSM</span></a></span><span> </span><span class="annot"><span class="annottext">JEnv
</span><a href="#local-6989586621682959882"><span class="hs-identifier hs-var">jsm</span></a></span><span> </span><span class="annot"><span class="annottext">(JSM JStat -&gt; JStat) -&gt; JSM JStat -&gt; JStat
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">JStgStat -&gt; JStat
</span><a href="GHC.JS.Transform.html#jStgStatToJS"><span class="hs-identifier hs-var">jStgStatToJS</span></a></span><span> </span><span class="annot"><span class="annottext">(JStgStat -&gt; JStat) -&gt; StateT JEnv Identity JStgStat -&gt; JSM JStat
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="annot"><span class="annottext">StgToJSConfig -&gt; StateT JEnv Identity JStgStat
</span><a href="GHC.StgToJS.Rts.Rts.html#rts"><span class="hs-identifier hs-var">rts</span></a></span><span> </span><span class="annot"><span class="annottext">StgToJSConfig
</span><a href="#local-6989586621682959850"><span class="hs-identifier hs-var">cfg</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-247"></span><span>          </span><span class="annot"><span class="annottext">IO Integer -&gt; IO ()
forall (f :: * -&gt; *) a. Functor f =&gt; f a -&gt; f ()
</span><span class="hs-identifier hs-var">void</span></span><span> </span><span class="annot"><span class="annottext">(IO Integer -&gt; IO ()) -&gt; IO Integer -&gt; IO ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-248"></span><span>            </span><span class="annot"><span class="annottext">Bool -&gt; Handle -&gt; JStat -&gt; IO Integer
</span><a href="GHC.StgToJS.Linker.Linker.html#hPutJS"><span class="hs-identifier hs-var">hPutJS</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">StgToJSConfig -&gt; Bool
</span><a href="GHC.StgToJS.Types.html#csPrettyRender"><span class="hs-identifier hs-var">csPrettyRender</span></a></span><span> </span><span class="annot"><span class="annottext">StgToJSConfig
</span><a href="#local-6989586621682959850"><span class="hs-identifier hs-var">cfg</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Handle
</span><a href="#local-6989586621682959885"><span class="hs-identifier hs-var">h</span></a></span><span> </span><span class="annot"><span class="annottext">JStat
</span><a href="#local-6989586621682959886"><span class="hs-identifier hs-var">opt</span></a></span><span>
</span><span id="line-249"></span><span>
</span><span id="line-250"></span><span>
</span><span id="line-251"></span><span>      </span><span class="hs-comment">-- link user-provided JS files into lib.js</span><span>
</span><span id="line-252"></span><span>      </span><span class="hs-special">(</span><span id="local-6989586621682959892"><span class="annot"><a href="#local-6989586621682959892"><span class="hs-identifier hs-var">emcc_opts</span></a></span></span><span class="hs-special">,</span><span id="local-6989586621682959893"><span class="annot"><a href="#local-6989586621682959893"><span class="hs-identifier hs-var">lib_cc_objs</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="hs-identifier hs-type">withBinaryFile</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621682959854"><span class="hs-identifier hs-type">out</span></a></span><span> </span><span class="annot"><a href="../../filepath-1.5.4.0-e69b/src/System.FilePath.Posix.html#%3C%2F%3E"><span class="hs-operator hs-type">&lt;/&gt;</span></a></span><span> </span><span class="annot"><span class="hs-string">&quot;lib.js&quot;</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="hs-identifier hs-type">WriteMode</span></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="hs-glyph">\</span><span id="local-6989586621682959894"><span class="annot"><span class="annottext">Handle
</span><a href="#local-6989586621682959894"><span class="hs-identifier hs-var">h</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-253"></span><span>
</span><span id="line-254"></span><span>        </span><span class="hs-keyword">let</span><span>
</span><span id="line-255"></span><span>            </span><span id="local-6989586621682959895"><span class="annot"><span class="annottext">tmp_dir :: TempDir
</span><a href="#local-6989586621682959895"><span class="hs-identifier hs-var hs-var hs-var">tmp_dir</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">LinkerConfig -&gt; TempDir
</span><a href="GHC.Linker.Config.html#linkerTempDir"><span class="hs-identifier hs-var">linkerTempDir</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">StgToJSConfig -&gt; LinkerConfig
</span><a href="GHC.StgToJS.Types.html#csLinkerConfig"><span class="hs-identifier hs-var">csLinkerConfig</span></a></span><span> </span><span class="annot"><span class="annottext">StgToJSConfig
</span><a href="#local-6989586621682959850"><span class="hs-identifier hs-var">cfg</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-256"></span><span>
</span><span id="line-257"></span><span>            </span><span class="hs-comment">-- JS objects from dependencies' archives (.a)</span><span>
</span><span id="line-258"></span><span>            </span><span id="local-6989586621682959898"><span class="annot"><span class="annottext">go_archives :: JSOptions -&gt; [FilePath] -&gt; [FilePath] -&gt; IO (JSOptions, [FilePath])
</span><a href="#local-6989586621682959898"><span class="hs-identifier hs-var hs-var hs-var">go_archives</span></a></span></span><span> </span><span id="local-6989586621682959899"><span class="annot"><span class="annottext">JSOptions
</span><a href="#local-6989586621682959899"><span class="hs-identifier hs-var">emcc_opts</span></a></span></span><span> </span><span id="local-6989586621682959900"><span class="annot"><span class="annottext">[FilePath]
</span><a href="#local-6989586621682959900"><span class="hs-identifier hs-var">cc_objs</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-glyph">\</span><span class="hs-glyph">case</span><span>
</span><span id="line-259"></span><span>              </span><span class="hs-special">[</span><span class="hs-special">]</span><span>     </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">(JSOptions, [FilePath]) -&gt; IO (JSOptions, [FilePath])
forall a. a -&gt; IO a
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">pure</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">JSOptions
</span><a href="#local-6989586621682959899"><span class="hs-identifier hs-var">emcc_opts</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">[FilePath]
</span><a href="#local-6989586621682959900"><span class="hs-identifier hs-var">cc_objs</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-260"></span><span>              </span><span class="hs-special">(</span><span id="local-6989586621682959901"><span class="annot"><span class="annottext">FilePath
</span><a href="#local-6989586621682959901"><span class="hs-identifier hs-var">a</span></a></span></span><span class="annot"><span class="hs-glyph hs-type">:</span></span><span id="local-6989586621682959902"><span class="annot"><span class="annottext">[FilePath]
</span><a href="#local-6989586621682959902"><span class="hs-keyword hs-var">as</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-261"></span><span>                </span><span class="annot"><a href="GHC.SysTools.Ar.html#Archive"><span class="hs-identifier hs-type">Ar.Archive</span></a></span><span> </span><span id="local-6989586621682959904"><span class="annot"><a href="#local-6989586621682959904"><span class="hs-identifier hs-var">entries</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">ArchiveCache -&gt; FilePath -&gt; IO Archive
</span><a href="GHC.StgToJS.Linker.Linker.html#loadArchive"><span class="hs-identifier hs-var">loadArchive</span></a></span><span> </span><span class="annot"><span class="annottext">ArchiveCache
</span><a href="#local-6989586621682959853"><span class="hs-identifier hs-var">ar_cache</span></a></span><span> </span><span class="annot"><span class="annottext">FilePath
</span><a href="#local-6989586621682959901"><span class="hs-identifier hs-var">a</span></a></span><span>
</span><span id="line-262"></span><span>                </span><span class="hs-special">(</span><span id="local-6989586621682959906"><span class="annot"><a href="#local-6989586621682959906"><span class="hs-identifier hs-var">emcc_opts'</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682959907"><span class="annot"><a href="#local-6989586621682959907"><span class="hs-identifier hs-var">cc_objs'</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><a href="#local-6989586621682959908"><span class="hs-identifier hs-type">go_entries</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682959899"><span class="hs-identifier hs-type">emcc_opts</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682959900"><span class="hs-identifier hs-type">cc_objs</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682959904"><span class="hs-identifier hs-type">entries</span></a></span><span>
</span><span id="line-263"></span><span>                </span><span class="annot"><a href="#local-6989586621682959898"><span class="hs-identifier hs-type">go_archives</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682959906"><span class="hs-identifier hs-type">emcc_opts'</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682959907"><span class="hs-identifier hs-type">cc_objs'</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682959902"><span class="hs-keyword hs-type">as</span></a></span><span>
</span><span id="line-264"></span><span>
</span><span id="line-265"></span><span>            </span><span class="hs-comment">-- archive's entries</span><span>
</span><span id="line-266"></span><span>            </span><span id="local-6989586621682959908"><span class="annot"><span class="annottext">go_entries :: JSOptions
-&gt; [FilePath] -&gt; [ArchiveEntry] -&gt; IO (JSOptions, [FilePath])
</span><a href="#local-6989586621682959908"><span class="hs-identifier hs-var hs-var hs-var">go_entries</span></a></span></span><span> </span><span id="local-6989586621682959909"><span class="annot"><span class="annottext">JSOptions
</span><a href="#local-6989586621682959909"><span class="hs-identifier hs-var">emcc_opts</span></a></span></span><span> </span><span id="local-6989586621682959910"><span class="annot"><span class="annottext">[FilePath]
</span><a href="#local-6989586621682959910"><span class="hs-identifier hs-var">cc_objs</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-glyph">\</span><span class="hs-glyph">case</span><span>
</span><span id="line-267"></span><span>              </span><span class="hs-special">[</span><span class="hs-special">]</span><span>     </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">(JSOptions, [FilePath]) -&gt; IO (JSOptions, [FilePath])
forall a. a -&gt; IO a
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">pure</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">JSOptions
</span><a href="#local-6989586621682959909"><span class="hs-identifier hs-var">emcc_opts</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">[FilePath]
</span><a href="#local-6989586621682959910"><span class="hs-identifier hs-var">cc_objs</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-268"></span><span>              </span><span class="hs-special">(</span><span id="local-6989586621682959911"><span class="annot"><span class="annottext">ArchiveEntry
</span><a href="#local-6989586621682959911"><span class="hs-identifier hs-var">e</span></a></span></span><span class="annot"><span class="hs-glyph hs-type">:</span></span><span id="local-6989586621682959912"><span class="annot"><span class="annottext">[ArchiveEntry]
</span><a href="#local-6989586621682959912"><span class="hs-identifier hs-var">es</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">ByteString -&gt; Maybe ObjectKind
</span><a href="GHC.StgToJS.Object.html#getObjectKindBS"><span class="hs-identifier hs-var">getObjectKindBS</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ArchiveEntry -&gt; ByteString
</span><a href="GHC.SysTools.Ar.html#filedata"><span class="hs-identifier hs-var">Ar.filedata</span></a></span><span> </span><span class="annot"><span class="annottext">ArchiveEntry
</span><a href="#local-6989586621682959911"><span class="hs-identifier hs-var">e</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-269"></span><span>                </span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span class="annot"><span class="annottext">ObjectKind
</span><a href="GHC.StgToJS.Object.html#ObjHs"><span class="hs-identifier hs-var">ObjHs</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-270"></span><span>                  </span><span class="hs-comment">-- Nothing to do. HS objects are collected in</span><span>
</span><span id="line-271"></span><span>                  </span><span class="hs-comment">-- collectModuleCodes</span><span>
</span><span id="line-272"></span><span>                  </span><span class="annot"><span class="annottext">JSOptions
-&gt; [FilePath] -&gt; [ArchiveEntry] -&gt; IO (JSOptions, [FilePath])
</span><a href="#local-6989586621682959908"><span class="hs-identifier hs-var">go_entries</span></a></span><span> </span><span class="annot"><span class="annottext">JSOptions
</span><a href="#local-6989586621682959909"><span class="hs-identifier hs-var">emcc_opts</span></a></span><span> </span><span class="annot"><span class="annottext">[FilePath]
</span><a href="#local-6989586621682959910"><span class="hs-identifier hs-var">cc_objs</span></a></span><span> </span><span class="annot"><span class="annottext">[ArchiveEntry]
</span><a href="#local-6989586621682959912"><span class="hs-identifier hs-var">es</span></a></span><span>
</span><span id="line-273"></span><span>                </span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span class="annot"><span class="annottext">ObjectKind
</span><a href="GHC.StgToJS.Object.html#ObjCc"><span class="hs-identifier hs-var">ObjCc</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-274"></span><span>                  </span><span class="hs-comment">-- extract the object file from the archive in a temporary</span><span>
</span><span id="line-275"></span><span>                  </span><span class="hs-comment">-- file and return its path</span><span>
</span><span id="line-276"></span><span>                  </span><span id="local-6989586621682959915"><span class="annot"><a href="#local-6989586621682959915"><span class="hs-identifier hs-var">cc_obj_fn</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Logger
-&gt; TmpFs -&gt; TempDir -&gt; TempFileLifetime -&gt; FilePath -&gt; IO FilePath
</span><a href="GHC.Utils.TmpFs.html#newTempName"><span class="hs-identifier hs-var">newTempName</span></a></span><span> </span><span class="annot"><span class="annottext">Logger
</span><a href="#local-6989586621682959851"><span class="hs-identifier hs-var">logger</span></a></span><span> </span><span class="annot"><span class="annottext">TmpFs
</span><a href="#local-6989586621682959852"><span class="hs-identifier hs-var">tmpfs</span></a></span><span> </span><span class="annot"><span class="annottext">TempDir
</span><a href="#local-6989586621682959895"><span class="hs-identifier hs-var">tmp_dir</span></a></span><span> </span><span class="annot"><span class="annottext">TempFileLifetime
</span><a href="GHC.Utils.TmpFs.html#TFL_CurrentModule"><span class="hs-identifier hs-var">TFL_CurrentModule</span></a></span><span> </span><span class="annot"><span class="annottext">FilePath
</span><span class="hs-string">&quot;o&quot;</span></span><span>
</span><span id="line-277"></span><span>                  </span><span class="annot"><a href="../../bytestring-0.12.2.0-7dd0/src/Data.ByteString.html#writeFile"><span class="hs-identifier hs-type">B.writeFile</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682959915"><span class="hs-identifier hs-type">cc_obj_fn</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.SysTools.Ar.html#filedata"><span class="hs-identifier hs-var">Ar.filedata</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682959911"><span class="hs-identifier hs-type">e</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-278"></span><span>                  </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621682959919"><span class="annot"><a href="#local-6989586621682959919"><span class="hs-identifier hs-var hs-var">cc_objs'</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">FilePath
</span><a href="#local-6989586621682959915"><span class="hs-identifier hs-var">cc_obj_fn</span></a></span><span class="annot"><span class="annottext">FilePath -&gt; [FilePath] -&gt; [FilePath]
forall a. a -&gt; [a] -&gt; [a]
</span><span class="hs-glyph hs-var">:</span></span><span class="annot"><span class="annottext">[FilePath]
</span><a href="#local-6989586621682959910"><span class="hs-identifier hs-var">cc_objs</span></a></span><span>
</span><span id="line-279"></span><span>                  </span><span class="annot"><a href="#local-6989586621682959908"><span class="hs-identifier hs-type">go_entries</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682959909"><span class="hs-identifier hs-type">emcc_opts</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682959919"><span class="hs-identifier hs-type">cc_objs'</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682959912"><span class="hs-identifier hs-type">es</span></a></span><span>
</span><span id="line-280"></span><span>                </span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span class="annot"><span class="annottext">ObjectKind
</span><a href="GHC.StgToJS.Object.html#ObjJs"><span class="hs-identifier hs-var">ObjJs</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-281"></span><span>                  </span><span class="hs-comment">-- extract the JS code and append it to the `lib.js` file</span><span>
</span><span id="line-282"></span><span>                  </span><span class="hs-special">(</span><span id="local-6989586621682959920"><span class="annot"><a href="#local-6989586621682959920"><span class="hs-identifier hs-var">opts</span></a></span></span><span class="hs-special">,</span><span id="local-6989586621682959921"><span class="annot"><a href="#local-6989586621682959921"><span class="hs-identifier hs-var">bs</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">ByteString -&gt; IO (JSOptions, ByteString)
</span><a href="GHC.StgToJS.Object.html#parseJSObjectBS"><span class="hs-identifier hs-var">parseJSObjectBS</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ArchiveEntry -&gt; ByteString
</span><a href="GHC.SysTools.Ar.html#filedata"><span class="hs-identifier hs-var">Ar.filedata</span></a></span><span> </span><span class="annot"><span class="annottext">ArchiveEntry
</span><a href="#local-6989586621682959911"><span class="hs-identifier hs-var">e</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-283"></span><span>                  </span><span class="annot"><a href="../../bytestring-0.12.2.0-7dd0/src/Data.ByteString.html#hPut"><span class="hs-identifier hs-type">B.hPut</span></a></span><span>   </span><span class="annot"><a href="#local-6989586621682959894"><span class="hs-identifier hs-type">h</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682959921"><span class="hs-identifier hs-type">bs</span></a></span><span>
</span><span id="line-284"></span><span>                  </span><span class="annot"><span class="hs-identifier hs-type">hPutChar</span></span><span> </span><span class="annot"><a href="#local-6989586621682959894"><span class="hs-identifier hs-type">h</span></a></span><span> </span><span class="annot"><span class="hs-char">'\n'</span></span><span>
</span><span id="line-285"></span><span>                  </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621682959925"><span class="annot"><a href="#local-6989586621682959925"><span class="hs-identifier hs-var hs-var">emcc_opts'</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">JSOptions
</span><a href="#local-6989586621682959909"><span class="hs-identifier hs-var">emcc_opts</span></a></span><span> </span><span class="annot"><span class="annottext">JSOptions -&gt; JSOptions -&gt; JSOptions
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">JSOptions
</span><a href="#local-6989586621682959920"><span class="hs-identifier hs-var">opts</span></a></span><span>
</span><span id="line-286"></span><span>                  </span><span class="annot"><a href="#local-6989586621682959908"><span class="hs-identifier hs-type">go_entries</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682959925"><span class="hs-identifier hs-type">emcc_opts'</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682959910"><span class="hs-identifier hs-type">cc_objs</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682959912"><span class="hs-identifier hs-type">es</span></a></span><span>
</span><span id="line-287"></span><span>                </span><span class="annot"><span class="annottext">Maybe ObjectKind
</span><span class="hs-identifier hs-var">Nothing</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">ArchiveEntry -&gt; FilePath
</span><a href="GHC.SysTools.Ar.html#filename"><span class="hs-identifier hs-var">Ar.filename</span></a></span><span> </span><span class="annot"><span class="annottext">ArchiveEntry
</span><a href="#local-6989586621682959911"><span class="hs-identifier hs-var">e</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-288"></span><span>                  </span><span class="hs-comment">-- JavaScript code linker does not support symbol table processing.</span><span>
</span><span id="line-289"></span><span>                  </span><span class="hs-comment">-- Currently the linker does nothing when the symbol table is met.</span><span>
</span><span id="line-290"></span><span>                  </span><span class="hs-comment">-- Ar/Ranlib usually do not create a record for the symbol table</span><span>
</span><span id="line-291"></span><span>                  </span><span class="hs-comment">-- in the object archive when the table has no entries.</span><span>
</span><span id="line-292"></span><span>                  </span><span class="hs-comment">-- For JavaScript code it should not be created by default.</span><span>
</span><span id="line-293"></span><span>
</span><span id="line-294"></span><span>                  </span><span class="annot"><span class="annottext">FilePath
</span><span class="hs-string">&quot;__.SYMDEF&quot;</span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-295"></span><span>                    </span><span class="hs-comment">-- GNU Ar added the symbol table.</span><span>
</span><span id="line-296"></span><span>
</span><span id="line-297"></span><span>                    </span><span class="hs-comment">-- Emscripten Ar (at least 3.1.24 version)</span><span>
</span><span id="line-298"></span><span>                    </span><span class="hs-comment">-- adds it even when the symbol table is empty.</span><span>
</span><span id="line-299"></span><span>                    </span><span class="annot"><span class="annottext">JSOptions
-&gt; [FilePath] -&gt; [ArchiveEntry] -&gt; IO (JSOptions, [FilePath])
</span><a href="#local-6989586621682959908"><span class="hs-identifier hs-var">go_entries</span></a></span><span> </span><span class="annot"><span class="annottext">JSOptions
</span><a href="#local-6989586621682959909"><span class="hs-identifier hs-var">emcc_opts</span></a></span><span> </span><span class="annot"><span class="annottext">[FilePath]
</span><a href="#local-6989586621682959910"><span class="hs-identifier hs-var">cc_objs</span></a></span><span> </span><span class="annot"><span class="annottext">[ArchiveEntry]
</span><a href="#local-6989586621682959912"><span class="hs-identifier hs-var">es</span></a></span><span>
</span><span id="line-300"></span><span>                  </span><span class="annot"><span class="annottext">FilePath
</span><span class="hs-string">&quot;__.SYMDEF SORTED&quot;</span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-301"></span><span>                    </span><span class="hs-comment">-- BSD-like Ar added the symbol table.</span><span>
</span><span id="line-302"></span><span>
</span><span id="line-303"></span><span>                    </span><span class="hs-comment">-- By default, Clang Ar does not add it when the</span><span>
</span><span id="line-304"></span><span>                    </span><span class="hs-comment">-- symbol table is empty (and it should be empty) but we left</span><span>
</span><span id="line-305"></span><span>                    </span><span class="hs-comment">-- it here to handle the case with symbol table completely</span><span>
</span><span id="line-306"></span><span>                    </span><span class="hs-comment">-- for GNU and BSD tools.</span><span>
</span><span id="line-307"></span><span>                    </span><span class="annot"><span class="annottext">JSOptions
-&gt; [FilePath] -&gt; [ArchiveEntry] -&gt; IO (JSOptions, [FilePath])
</span><a href="#local-6989586621682959908"><span class="hs-identifier hs-var">go_entries</span></a></span><span> </span><span class="annot"><span class="annottext">JSOptions
</span><a href="#local-6989586621682959909"><span class="hs-identifier hs-var">emcc_opts</span></a></span><span> </span><span class="annot"><span class="annottext">[FilePath]
</span><a href="#local-6989586621682959910"><span class="hs-identifier hs-var">cc_objs</span></a></span><span> </span><span class="annot"><span class="annottext">[ArchiveEntry]
</span><a href="#local-6989586621682959912"><span class="hs-identifier hs-var">es</span></a></span><span>
</span><span id="line-308"></span><span>                  </span><span id="local-6989586621682959927"><span class="annot"><span class="annottext">FilePath
</span><a href="#local-6989586621682959927"><span class="hs-identifier hs-var">unknown_name</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-309"></span><span>                    </span><span class="annot"><span class="annottext">Logger -&gt; SDoc -&gt; IO ()
</span><a href="GHC.Utils.Error.html#logInfo"><span class="hs-identifier hs-var">logInfo</span></a></span><span> </span><span class="annot"><span class="annottext">Logger
</span><a href="#local-6989586621682959851"><span class="hs-identifier hs-var">logger</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[SDoc] -&gt; SDoc
forall doc. IsDoc doc =&gt; [doc] -&gt; doc
</span><a href="GHC.Utils.Outputable.html#vcat"><span class="hs-identifier hs-var">vcat</span></a></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">FilePath -&gt; SDoc
forall doc. IsLine doc =&gt; FilePath -&gt; doc
</span><a href="GHC.Utils.Outputable.html#text"><span class="hs-identifier hs-var">text</span></a></span><span> </span><span class="annot"><span class="annottext">FilePath
</span><span class="hs-string">&quot;Ignoring unexpected archive entry: &quot;</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">FilePath -&gt; SDoc
forall doc. IsLine doc =&gt; FilePath -&gt; doc
</span><a href="GHC.Utils.Outputable.html#text"><span class="hs-identifier hs-var">text</span></a></span><span> </span><span class="annot"><span class="annottext">FilePath
</span><a href="#local-6989586621682959927"><span class="hs-identifier hs-var">unknown_name</span></a></span><span class="hs-special">]</span><span class="hs-special">)</span><span>
</span><span id="line-310"></span><span>                    </span><span class="annot"><span class="annottext">JSOptions
-&gt; [FilePath] -&gt; [ArchiveEntry] -&gt; IO (JSOptions, [FilePath])
</span><a href="#local-6989586621682959908"><span class="hs-identifier hs-var">go_entries</span></a></span><span> </span><span class="annot"><span class="annottext">JSOptions
</span><a href="#local-6989586621682959909"><span class="hs-identifier hs-var">emcc_opts</span></a></span><span> </span><span class="annot"><span class="annottext">[FilePath]
</span><a href="#local-6989586621682959910"><span class="hs-identifier hs-var">cc_objs</span></a></span><span> </span><span class="annot"><span class="annottext">[ArchiveEntry]
</span><a href="#local-6989586621682959912"><span class="hs-identifier hs-var">es</span></a></span><span>
</span><span id="line-311"></span><span>
</span><span id="line-312"></span><span>            </span><span class="hs-comment">-- additional JS objects (e.g. from the command-line)</span><span>
</span><span id="line-313"></span><span>            </span><span id="local-6989586621682959928"><span class="annot"><span class="annottext">go_extra :: JSOptions -&gt; [FilePath] -&gt; IO JSOptions
</span><a href="#local-6989586621682959928"><span class="hs-identifier hs-var hs-var hs-var">go_extra</span></a></span></span><span> </span><span id="local-6989586621682959929"><span class="annot"><span class="annottext">JSOptions
</span><a href="#local-6989586621682959929"><span class="hs-identifier hs-var">emcc_opts</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-glyph">\</span><span class="hs-glyph">case</span><span>
</span><span id="line-314"></span><span>              </span><span class="hs-special">[</span><span class="hs-special">]</span><span>     </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">JSOptions -&gt; IO JSOptions
forall a. a -&gt; IO a
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">pure</span></span><span> </span><span class="annot"><span class="annottext">JSOptions
</span><a href="#local-6989586621682959929"><span class="hs-identifier hs-var">emcc_opts</span></a></span><span>
</span><span id="line-315"></span><span>              </span><span class="hs-special">(</span><span id="local-6989586621682959930"><span class="annot"><span class="annottext">FilePath
</span><a href="#local-6989586621682959930"><span class="hs-identifier hs-var">e</span></a></span></span><span class="annot"><span class="hs-glyph hs-type">:</span></span><span id="local-6989586621682959931"><span class="annot"><span class="annottext">[FilePath]
</span><a href="#local-6989586621682959931"><span class="hs-identifier hs-var">es</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-316"></span><span>                </span><span class="hs-special">(</span><span id="local-6989586621682959932"><span class="annot"><a href="#local-6989586621682959932"><span class="hs-identifier hs-var">opts</span></a></span></span><span class="hs-special">,</span><span id="local-6989586621682959933"><span class="annot"><a href="#local-6989586621682959933"><span class="hs-identifier hs-var">bs</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">FilePath -&gt; IO (JSOptions, ByteString)
</span><a href="GHC.StgToJS.Object.html#readJSObject"><span class="hs-identifier hs-var">readJSObject</span></a></span><span> </span><span class="annot"><span class="annottext">FilePath
</span><a href="#local-6989586621682959930"><span class="hs-identifier hs-var">e</span></a></span><span>
</span><span id="line-317"></span><span>                </span><span class="annot"><a href="../../bytestring-0.12.2.0-7dd0/src/Data.ByteString.html#hPut"><span class="hs-identifier hs-type">B.hPut</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682959894"><span class="hs-identifier hs-type">h</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682959933"><span class="hs-identifier hs-type">bs</span></a></span><span>
</span><span id="line-318"></span><span>                </span><span class="annot"><span class="hs-identifier hs-type">hPutChar</span></span><span> </span><span class="annot"><a href="#local-6989586621682959894"><span class="hs-identifier hs-type">h</span></a></span><span> </span><span class="annot"><span class="hs-char">'\n'</span></span><span>
</span><span id="line-319"></span><span>                </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621682959935"><span class="annot"><a href="#local-6989586621682959935"><span class="hs-identifier hs-var hs-var">emcc_opts'</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">JSOptions
</span><a href="#local-6989586621682959929"><span class="hs-identifier hs-var">emcc_opts</span></a></span><span> </span><span class="annot"><span class="annottext">JSOptions -&gt; JSOptions -&gt; JSOptions
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">JSOptions
</span><a href="#local-6989586621682959932"><span class="hs-identifier hs-var">opts</span></a></span><span>
</span><span id="line-320"></span><span>                </span><span class="annot"><a href="#local-6989586621682959928"><span class="hs-identifier hs-type">go_extra</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682959935"><span class="hs-identifier hs-type">emcc_opts'</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682959931"><span class="hs-identifier hs-type">es</span></a></span><span>
</span><span id="line-321"></span><span>
</span><span id="line-322"></span><span>        </span><span class="hs-comment">-- archives</span><span>
</span><span id="line-323"></span><span>        </span><span class="hs-special">(</span><span id="local-6989586621682959936"><span class="annot"><a href="#local-6989586621682959936"><span class="hs-identifier hs-var">emcc_opts0</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682959937"><span class="annot"><a href="#local-6989586621682959937"><span class="hs-identifier hs-var">cc_objs</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">JSOptions -&gt; [FilePath] -&gt; [FilePath] -&gt; IO (JSOptions, [FilePath])
</span><a href="#local-6989586621682959898"><span class="hs-identifier hs-var">go_archives</span></a></span><span> </span><span class="annot"><span class="annottext">JSOptions
</span><a href="GHC.StgToJS.Object.html#defaultJSOptions"><span class="hs-identifier hs-var">defaultJSOptions</span></a></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Set FilePath -&gt; [FilePath]
forall a. Set a -&gt; [a]
</span><a href="../../containers-0.7-5a8f/src/Data.Set.Internal.html#toList"><span class="hs-identifier hs-var">S.toList</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">LinkPlan -&gt; Set FilePath
</span><a href="GHC.StgToJS.Linker.Types.html#lkp_archives"><span class="hs-identifier hs-var">lkp_archives</span></a></span><span> </span><span class="annot"><span class="annottext">LinkPlan
</span><a href="#local-6989586621682959855"><span class="hs-identifier hs-var">link_plan</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-324"></span><span>        </span><span class="hs-comment">-- extra object files</span><span>
</span><span id="line-325"></span><span>        </span><span id="local-6989586621682959941"><span class="annot"><a href="#local-6989586621682959941"><span class="hs-identifier hs-var">emcc_opts1</span></a></span></span><span>            </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><a href="#local-6989586621682959928"><span class="hs-identifier hs-type">go_extra</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682959936"><span class="hs-identifier hs-type">emcc_opts0</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../../containers-0.7-5a8f/src/Data.Set.Internal.html#toList"><span class="hs-identifier hs-type">S.toList</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.StgToJS.Linker.Types.html#lkp_objs_js"><span class="hs-identifier hs-var">lkp_objs_js</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682959855"><span class="hs-identifier hs-type">link_plan</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-326"></span><span>        </span><span class="annot"><span class="hs-identifier hs-type">pure</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621682959941"><span class="hs-identifier hs-type">emcc_opts1</span></a></span><span class="hs-special">,</span><span class="annot"><a href="#local-6989586621682959937"><span class="hs-identifier hs-type">cc_objs</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-327"></span><span>
</span><span id="line-328"></span><span>
</span><span id="line-329"></span><span>      </span><span class="hs-comment">-- Link Cc objects using emcc's linker</span><span>
</span><span id="line-330"></span><span>      </span><span class="hs-comment">--</span><span>
</span><span id="line-331"></span><span>      </span><span class="hs-comment">-- Cc objects have been extracted from archives (see above) and are listed</span><span>
</span><span id="line-332"></span><span>      </span><span class="hs-comment">-- in lib_cc_objs.</span><span>
</span><span id="line-333"></span><span>      </span><span class="hs-comment">--</span><span>
</span><span id="line-334"></span><span>      </span><span class="hs-comment">-- We don't link C sources if there are none (obviously) or if asked</span><span>
</span><span id="line-335"></span><span>      </span><span class="hs-comment">-- explicitly by the user with -ddisable-js-c-sources (mostly used for</span><span>
</span><span id="line-336"></span><span>      </span><span class="hs-comment">-- debugging purpose).</span><span>
</span><span id="line-337"></span><span>      </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621682959943"><span class="annot"><a href="#local-6989586621682959943"><span class="hs-identifier hs-var hs-var">emcc_objs</span></a></span></span><span>     </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[FilePath]
</span><a href="#local-6989586621682959893"><span class="hs-identifier hs-var">lib_cc_objs</span></a></span><span> </span><span class="annot"><span class="annottext">[FilePath] -&gt; [FilePath] -&gt; [FilePath]
forall a. [a] -&gt; [a] -&gt; [a]
</span><span class="hs-operator hs-var">++</span></span><span> </span><span class="annot"><span class="annottext">Set FilePath -&gt; [FilePath]
forall a. Set a -&gt; [a]
</span><a href="../../containers-0.7-5a8f/src/Data.Set.Internal.html#toList"><span class="hs-identifier hs-var">S.toList</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">LinkPlan -&gt; Set FilePath
</span><a href="GHC.StgToJS.Linker.Types.html#lkp_objs_cc"><span class="hs-identifier hs-var">lkp_objs_cc</span></a></span><span> </span><span class="annot"><span class="annottext">LinkPlan
</span><a href="#local-6989586621682959855"><span class="hs-identifier hs-var">link_plan</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-338"></span><span>      </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621682959945"><span class="annot"><a href="#local-6989586621682959945"><span class="hs-identifier hs-var hs-var">has_emcc_objs</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Bool
</span><span class="hs-identifier hs-var">not</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[FilePath] -&gt; Bool
forall a. [a] -&gt; Bool
forall (t :: * -&gt; *) a. Foldable t =&gt; t a -&gt; Bool
</span><span class="hs-identifier hs-var">null</span></span><span> </span><span class="annot"><span class="annottext">[FilePath]
</span><a href="#local-6989586621682959943"><span class="hs-identifier hs-var">emcc_objs</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-339"></span><span>      </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621682959948"><span class="annot"><a href="#local-6989586621682959948"><span class="hs-identifier hs-var hs-var">link_c_sources</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">JSLinkConfig -&gt; Bool
</span><a href="GHC.StgToJS.Linker.Types.html#lcLinkCsources"><span class="hs-identifier hs-var">lcLinkCsources</span></a></span><span> </span><span class="annot"><span class="annottext">JSLinkConfig
</span><a href="#local-6989586621682959849"><span class="hs-identifier hs-var">lc_cfg</span></a></span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Bool -&gt; Bool
</span><span class="hs-operator hs-var">&amp;&amp;</span></span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621682959945"><span class="hs-identifier hs-var">has_emcc_objs</span></a></span><span>
</span><span id="line-340"></span><span>
</span><span id="line-341"></span><span>      </span><span class="annot"><span class="hs-identifier hs-type">when</span></span><span> </span><span class="annot"><a href="#local-6989586621682959948"><span class="hs-identifier hs-type">link_c_sources</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-342"></span><span>
</span><span id="line-343"></span><span>        </span><span class="annot"><a href="GHC.Linker.External.html#runLink"><span class="hs-identifier hs-type">runLink</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682959851"><span class="hs-identifier hs-type">logger</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682959852"><span class="hs-identifier hs-type">tmpfs</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.StgToJS.Types.html#csLinkerConfig"><span class="hs-identifier hs-var">csLinkerConfig</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682959850"><span class="hs-identifier hs-type">cfg</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span>
</span><span id="line-344"></span><span>          </span><span class="hs-special">[</span><span> </span><span class="annot"><a href="GHC.Utils.CliOption.html#Option"><span class="hs-identifier hs-type">Option</span></a></span><span> </span><span class="annot"><span class="hs-string">&quot;-o&quot;</span></span><span>
</span><span id="line-345"></span><span>          </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Utils.CliOption.html#FileOption"><span class="hs-identifier hs-type">FileOption</span></a></span><span> </span><span class="annot"><span class="hs-string">&quot;&quot;</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621682959854"><span class="hs-identifier hs-type">out</span></a></span><span> </span><span class="annot"><a href="../../filepath-1.5.4.0-e69b/src/System.FilePath.Posix.html#%3C%2F%3E"><span class="hs-operator hs-type">&lt;/&gt;</span></a></span><span> </span><span class="annot"><span class="hs-string">&quot;clibs.js&quot;</span></span><span class="hs-special">)</span><span>
</span><span id="line-346"></span><span>          </span><span class="hs-comment">-- Embed wasm files into a single .js file</span><span>
</span><span id="line-347"></span><span>          </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Utils.CliOption.html#Option"><span class="hs-identifier hs-type">Option</span></a></span><span> </span><span class="annot"><span class="hs-string">&quot;-sSINGLE_FILE=1&quot;</span></span><span>
</span><span id="line-348"></span><span>          </span><span class="hs-comment">-- Enable support for addFunction (callbacks)</span><span>
</span><span id="line-349"></span><span>          </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Utils.CliOption.html#Option"><span class="hs-identifier hs-type">Option</span></a></span><span> </span><span class="annot"><span class="hs-string">&quot;-sALLOW_TABLE_GROWTH&quot;</span></span><span>
</span><span id="line-350"></span><span>          </span><span class="hs-comment">-- keep some RTS methods and functions (otherwise removed as dead</span><span>
</span><span id="line-351"></span><span>          </span><span class="hs-comment">-- code)</span><span>
</span><span id="line-352"></span><span>          </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Utils.CliOption.html#Option"><span class="hs-identifier hs-type">Option</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-string">&quot;-sEXPORTED_RUNTIME_METHODS=&quot;</span></span><span> </span><span class="annot"><span class="hs-operator hs-type">++</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">concat</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">intersperse</span></span><span> </span><span class="annot"><span class="hs-string">&quot;,&quot;</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.StgToJS.Object.html#emccExportedRuntimeMethods"><span class="hs-identifier hs-var">emccExportedRuntimeMethods</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682959892"><span class="hs-identifier hs-type">emcc_opts</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-353"></span><span>          </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Utils.CliOption.html#Option"><span class="hs-identifier hs-type">Option</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-string">&quot;-sEXPORTED_FUNCTIONS=&quot;</span></span><span> </span><span class="annot"><span class="hs-operator hs-type">++</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">concat</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">intersperse</span></span><span> </span><span class="annot"><span class="hs-string">&quot;,&quot;</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.StgToJS.Object.html#emccExportedFunctions"><span class="hs-identifier hs-var">emccExportedFunctions</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682959892"><span class="hs-identifier hs-type">emcc_opts</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-354"></span><span>          </span><span class="hs-special">]</span><span>
</span><span id="line-355"></span><span>          </span><span class="hs-comment">-- pass extra options from JS files' pragmas</span><span>
</span><span id="line-356"></span><span>          </span><span class="annot"><span class="hs-operator hs-type">++</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">map</span></span><span> </span><span class="annot"><a href="GHC.Utils.CliOption.html#Option"><span class="hs-identifier hs-type">Option</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.StgToJS.Object.html#emccExtraOptions"><span class="hs-identifier hs-var">emccExtraOptions</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682959892"><span class="hs-identifier hs-type">emcc_opts</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-357"></span><span>          </span><span class="hs-comment">-- link objects</span><span>
</span><span id="line-358"></span><span>          </span><span class="annot"><span class="hs-operator hs-type">++</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">map</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Utils.CliOption.html#FileOption"><span class="hs-identifier hs-type">FileOption</span></a></span><span> </span><span class="annot"><span class="hs-string">&quot;&quot;</span></span><span class="hs-special">)</span><span> </span><span class="annot"><a href="#local-6989586621682959943"><span class="hs-identifier hs-type">emcc_objs</span></a></span><span>
</span><span id="line-359"></span><span>
</span><span id="line-360"></span><span>      </span><span class="hs-comment">-- Don't enable the Emcc rts when not needed (i.e. no Wasm module to link</span><span>
</span><span id="line-361"></span><span>      </span><span class="hs-comment">-- with) and not forced by the caller (e.g. in the future iserv may require</span><span>
</span><span id="line-362"></span><span>      </span><span class="hs-comment">-- incremental linking of Wasm modules, hence the emcc rts even building</span><span>
</span><span id="line-363"></span><span>      </span><span class="hs-comment">-- iserv itself doesn't require the emcc rts)</span><span>
</span><span id="line-364"></span><span>      </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621682959957"><span class="annot"><a href="#local-6989586621682959957"><span class="hs-identifier hs-var hs-var">use_emcc_rts</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Bool -&gt; UseEmccRts
</span><a href="GHC.StgToJS.Linker.Linker.html#UseEmccRts"><span class="hs-identifier hs-var">UseEmccRts</span></a></span><span> </span><span class="annot"><span class="annottext">(Bool -&gt; UseEmccRts) -&gt; Bool -&gt; UseEmccRts
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621682959948"><span class="hs-identifier hs-var">link_c_sources</span></a></span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Bool -&gt; Bool
</span><span class="hs-operator hs-var">||</span></span><span> </span><span class="annot"><span class="annottext">JSLinkConfig -&gt; Bool
</span><a href="GHC.StgToJS.Linker.Types.html#lcForceEmccRts"><span class="hs-identifier hs-var">lcForceEmccRts</span></a></span><span> </span><span class="annot"><span class="annottext">JSLinkConfig
</span><a href="#local-6989586621682959849"><span class="hs-identifier hs-var">lc_cfg</span></a></span><span>
</span><span id="line-365"></span><span>
</span><span id="line-366"></span><span>
</span><span id="line-367"></span><span>      </span><span class="hs-comment">-- link everything together into a runnable all.js</span><span>
</span><span id="line-368"></span><span>      </span><span class="hs-comment">-- only if we link a complete application,</span><span>
</span><span id="line-369"></span><span>      </span><span class="hs-comment">--   no incremental linking and no skipped parts</span><span>
</span><span id="line-370"></span><span>      </span><span class="annot"><span class="hs-identifier hs-type">when</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.StgToJS.Linker.Types.html#lcCombineAll"><span class="hs-identifier hs-var">lcCombineAll</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682959849"><span class="hs-identifier hs-type">lc_cfg</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">&amp;&amp;</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">not</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.StgToJS.Linker.Types.html#lcNoRts"><span class="hs-identifier hs-var">lcNoRts</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682959849"><span class="hs-identifier hs-type">lc_cfg</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-371"></span><span>        </span><span class="annot"><a href="GHC.StgToJS.Linker.Linker.html#writeRunMain"><span class="hs-identifier hs-type">writeRunMain</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682959854"><span class="hs-identifier hs-type">out</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682959957"><span class="hs-identifier hs-type">use_emcc_rts</span></a></span><span>
</span><span id="line-372"></span><span>        </span><span class="annot"><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><a href="GHC.StgToJS.Linker.Linker.html#combineFiles"><span class="hs-identifier hs-type">combineFiles</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682959849"><span class="hs-identifier hs-type">lc_cfg</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682959948"><span class="hs-identifier hs-type">link_c_sources</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682959854"><span class="hs-identifier hs-type">out</span></a></span><span>
</span><span id="line-373"></span><span>        </span><span class="annot"><a href="GHC.StgToJS.Linker.Linker.html#writeHtml"><span class="hs-identifier hs-type">writeHtml</span></a></span><span>    </span><span class="annot"><a href="#local-6989586621682959854"><span class="hs-identifier hs-type">out</span></a></span><span>
</span><span id="line-374"></span><span>        </span><span class="annot"><a href="GHC.StgToJS.Linker.Linker.html#writeRunner"><span class="hs-identifier hs-type">writeRunner</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682959849"><span class="hs-identifier hs-type">lc_cfg</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682959854"><span class="hs-identifier hs-type">out</span></a></span><span>
</span><span id="line-375"></span><span>        </span><span class="annot"><a href="GHC.StgToJS.Linker.Linker.html#writeExterns"><span class="hs-identifier hs-type">writeExterns</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682959854"><span class="hs-identifier hs-type">out</span></a></span><span>
</span><span id="line-376"></span><span>
</span><span id="line-377"></span><span class="hs-keyword">data</span><span> </span><span id="LinkSpec"><span class="annot"><a href="GHC.StgToJS.Linker.Linker.html#LinkSpec"><span class="hs-identifier hs-var">LinkSpec</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="LinkSpec"><span class="annot"><a href="GHC.StgToJS.Linker.Linker.html#LinkSpec"><span class="hs-identifier hs-var">LinkSpec</span></a></span></span><span>
</span><span id="line-378"></span><span>  </span><span class="hs-special">{</span><span> </span><span id="lks_unit_ids"><span class="annot"><span class="annottext">LinkSpec -&gt; [UnitId]
</span><a href="GHC.StgToJS.Linker.Linker.html#lks_unit_ids"><span class="hs-identifier hs-var hs-var">lks_unit_ids</span></a></span></span><span>        </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="GHC.Unit.Types.html#UnitId"><span class="hs-identifier hs-type">UnitId</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-379"></span><span>  </span><span class="hs-special">,</span><span> </span><span id="lks_obj_root_filter"><span class="annot"><span class="annottext">LinkSpec -&gt; ExportedFun -&gt; Bool
</span><a href="GHC.StgToJS.Linker.Linker.html#lks_obj_root_filter"><span class="hs-identifier hs-var hs-var">lks_obj_root_filter</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.StgToJS.Object.html#ExportedFun"><span class="hs-identifier hs-type">ExportedFun</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Bool</span></span><span> </span><span class="annot"><span class="hs-comment">-- ^ Predicate for exported functions in objects to declare as root</span></span><span>
</span><span id="line-380"></span><span>  </span><span class="hs-special">,</span><span> </span><span id="lks_extra_roots"><span class="annot"><span class="annottext">LinkSpec -&gt; Set ExportedFun
</span><a href="GHC.StgToJS.Linker.Linker.html#lks_extra_roots"><span class="hs-identifier hs-var hs-var">lks_extra_roots</span></a></span></span><span>     </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="../../containers-0.7-5a8f/src/Data.Set.Internal.html#Set"><span class="hs-identifier hs-type">Set</span></a></span><span> </span><span class="annot"><a href="GHC.StgToJS.Object.html#ExportedFun"><span class="hs-identifier hs-type">ExportedFun</span></a></span><span> </span><span class="annot"><span class="hs-comment">-- ^ Extra root functions from loaded units</span></span><span>
</span><span id="line-381"></span><span>  </span><span class="hs-special">,</span><span> </span><span id="lks_objs_hs"><span class="annot"><span class="annottext">LinkSpec -&gt; [FilePath]
</span><a href="GHC.StgToJS.Linker.Linker.html#lks_objs_hs"><span class="hs-identifier hs-var hs-var">lks_objs_hs</span></a></span></span><span>         </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><span class="annot"><span class="hs-identifier hs-type">FilePath</span></span><span class="hs-special">]</span><span>      </span><span class="annot"><span class="hs-comment">-- ^ HS objects to link</span></span><span>
</span><span id="line-382"></span><span>  </span><span class="hs-special">,</span><span> </span><span id="lks_objs_js"><span class="annot"><span class="annottext">LinkSpec -&gt; [FilePath]
</span><a href="GHC.StgToJS.Linker.Linker.html#lks_objs_js"><span class="hs-identifier hs-var hs-var">lks_objs_js</span></a></span></span><span>         </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><span class="annot"><span class="hs-identifier hs-type">FilePath</span></span><span class="hs-special">]</span><span>      </span><span class="annot"><span class="hs-comment">-- ^ JS objects to link</span></span><span>
</span><span id="line-383"></span><span>  </span><span class="hs-special">,</span><span> </span><span id="lks_objs_cc"><span class="annot"><span class="annottext">LinkSpec -&gt; [FilePath]
</span><a href="GHC.StgToJS.Linker.Linker.html#lks_objs_cc"><span class="hs-identifier hs-var hs-var">lks_objs_cc</span></a></span></span><span>         </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><span class="annot"><span class="hs-identifier hs-type">FilePath</span></span><span class="hs-special">]</span><span>      </span><span class="annot"><span class="hs-comment">-- ^ Cc objects to link</span></span><span>
</span><span id="line-384"></span><span>  </span><span class="hs-special">}</span><span>
</span><span id="line-385"></span><span>
</span><span id="line-386"></span><span class="hs-keyword">instance</span><span> </span><span class="annot"><a href="GHC.Utils.Outputable.html#Outputable"><span class="hs-identifier hs-type">Outputable</span></a></span><span> </span><span class="annot"><a href="GHC.StgToJS.Linker.Linker.html#LinkSpec"><span class="hs-identifier hs-type">LinkSpec</span></a></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-387"></span><span>  </span><span id="local-6989586621682959996"><span class="annot"><span class="annottext">ppr :: LinkSpec -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var hs-var hs-var">ppr</span></a></span></span><span> </span><span id="local-6989586621682959997"><span class="annot"><span class="annottext">LinkSpec
</span><a href="#local-6989586621682959997"><span class="hs-identifier hs-var">s</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">SDoc -&gt; BlockId -&gt; SDoc -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#hang"><span class="hs-identifier hs-var">hang</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">FilePath -&gt; SDoc
forall doc. IsLine doc =&gt; FilePath -&gt; doc
</span><a href="GHC.Utils.Outputable.html#text"><span class="hs-identifier hs-var">text</span></a></span><span> </span><span class="annot"><span class="annottext">FilePath
</span><span class="hs-string">&quot;LinkSpec&quot;</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">BlockId
</span><span class="hs-number">2</span></span><span> </span><span class="annot"><span class="annottext">(SDoc -&gt; SDoc) -&gt; SDoc -&gt; SDoc
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">[SDoc] -&gt; SDoc
forall doc. IsDoc doc =&gt; [doc] -&gt; doc
</span><a href="GHC.Utils.Outputable.html#vcat"><span class="hs-identifier hs-var">vcat</span></a></span><span>
</span><span id="line-388"></span><span>            </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">[SDoc] -&gt; SDoc
forall doc. IsLine doc =&gt; [doc] -&gt; doc
</span><a href="GHC.Utils.Outputable.html#hcat"><span class="hs-identifier hs-var">hcat</span></a></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">FilePath -&gt; SDoc
forall doc. IsLine doc =&gt; FilePath -&gt; doc
</span><a href="GHC.Utils.Outputable.html#text"><span class="hs-identifier hs-var">text</span></a></span><span> </span><span class="annot"><span class="annottext">FilePath
</span><span class="hs-string">&quot;Unit ids: &quot;</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">[UnitId] -&gt; SDoc
forall a. Outputable a =&gt; a -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">LinkSpec -&gt; [UnitId]
</span><a href="GHC.StgToJS.Linker.Linker.html#lks_unit_ids"><span class="hs-identifier hs-var">lks_unit_ids</span></a></span><span> </span><span class="annot"><span class="annottext">LinkSpec
</span><a href="#local-6989586621682959997"><span class="hs-identifier hs-var">s</span></a></span><span class="hs-special">)</span><span class="hs-special">]</span><span>
</span><span id="line-389"></span><span>            </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">[SDoc] -&gt; SDoc
forall doc. IsLine doc =&gt; [doc] -&gt; doc
</span><a href="GHC.Utils.Outputable.html#hcat"><span class="hs-identifier hs-var">hcat</span></a></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">FilePath -&gt; SDoc
forall doc. IsLine doc =&gt; FilePath -&gt; doc
</span><a href="GHC.Utils.Outputable.html#text"><span class="hs-identifier hs-var">text</span></a></span><span> </span><span class="annot"><span class="annottext">FilePath
</span><span class="hs-string">&quot;HS objects:&quot;</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">[SDoc] -&gt; SDoc
forall doc. IsDoc doc =&gt; [doc] -&gt; doc
</span><a href="GHC.Utils.Outputable.html#vcat"><span class="hs-identifier hs-var">vcat</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(FilePath -&gt; SDoc) -&gt; [FilePath] -&gt; [SDoc]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-identifier hs-var">fmap</span></span><span> </span><span class="annot"><span class="annottext">FilePath -&gt; SDoc
forall doc. IsLine doc =&gt; FilePath -&gt; doc
</span><a href="GHC.Utils.Outputable.html#text"><span class="hs-identifier hs-var">text</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">LinkSpec -&gt; [FilePath]
</span><a href="GHC.StgToJS.Linker.Linker.html#lks_objs_hs"><span class="hs-identifier hs-var">lks_objs_hs</span></a></span><span> </span><span class="annot"><span class="annottext">LinkSpec
</span><a href="#local-6989586621682959997"><span class="hs-identifier hs-var">s</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">]</span><span>
</span><span id="line-390"></span><span>            </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">SDoc -&gt; BlockId -&gt; SDoc -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#hang"><span class="hs-identifier hs-var">hang</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">FilePath -&gt; SDoc
forall doc. IsLine doc =&gt; FilePath -&gt; doc
</span><a href="GHC.Utils.Outputable.html#text"><span class="hs-identifier hs-var">text</span></a></span><span> </span><span class="annot"><span class="annottext">FilePath
</span><span class="hs-string">&quot;JS objects::&quot;</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">BlockId
</span><span class="hs-number">2</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[SDoc] -&gt; SDoc
forall doc. IsDoc doc =&gt; [doc] -&gt; doc
</span><a href="GHC.Utils.Outputable.html#vcat"><span class="hs-identifier hs-var">vcat</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(FilePath -&gt; SDoc) -&gt; [FilePath] -&gt; [SDoc]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-identifier hs-var">fmap</span></span><span> </span><span class="annot"><span class="annottext">FilePath -&gt; SDoc
forall doc. IsLine doc =&gt; FilePath -&gt; doc
</span><a href="GHC.Utils.Outputable.html#text"><span class="hs-identifier hs-var">text</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">LinkSpec -&gt; [FilePath]
</span><a href="GHC.StgToJS.Linker.Linker.html#lks_objs_js"><span class="hs-identifier hs-var">lks_objs_js</span></a></span><span> </span><span class="annot"><span class="annottext">LinkSpec
</span><a href="#local-6989586621682959997"><span class="hs-identifier hs-var">s</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-391"></span><span>            </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">SDoc -&gt; BlockId -&gt; SDoc -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#hang"><span class="hs-identifier hs-var">hang</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">FilePath -&gt; SDoc
forall doc. IsLine doc =&gt; FilePath -&gt; doc
</span><a href="GHC.Utils.Outputable.html#text"><span class="hs-identifier hs-var">text</span></a></span><span> </span><span class="annot"><span class="annottext">FilePath
</span><span class="hs-string">&quot;Cc objects::&quot;</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">BlockId
</span><span class="hs-number">2</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[SDoc] -&gt; SDoc
forall doc. IsDoc doc =&gt; [doc] -&gt; doc
</span><a href="GHC.Utils.Outputable.html#vcat"><span class="hs-identifier hs-var">vcat</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(FilePath -&gt; SDoc) -&gt; [FilePath] -&gt; [SDoc]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-identifier hs-var">fmap</span></span><span> </span><span class="annot"><span class="annottext">FilePath -&gt; SDoc
forall doc. IsLine doc =&gt; FilePath -&gt; doc
</span><a href="GHC.Utils.Outputable.html#text"><span class="hs-identifier hs-var">text</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">LinkSpec -&gt; [FilePath]
</span><a href="GHC.StgToJS.Linker.Linker.html#lks_objs_cc"><span class="hs-identifier hs-var">lks_objs_cc</span></a></span><span> </span><span class="annot"><span class="annottext">LinkSpec
</span><a href="#local-6989586621682959997"><span class="hs-identifier hs-var">s</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-392"></span><span>            </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">FilePath -&gt; SDoc
forall doc. IsLine doc =&gt; FilePath -&gt; doc
</span><a href="GHC.Utils.Outputable.html#text"><span class="hs-identifier hs-var">text</span></a></span><span> </span><span class="annot"><span class="annottext">FilePath
</span><span class="hs-string">&quot;Object root filter: &lt;function&gt;&quot;</span></span><span>
</span><span id="line-393"></span><span>            </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">[SDoc] -&gt; SDoc
forall doc. IsLine doc =&gt; [doc] -&gt; doc
</span><a href="GHC.Utils.Outputable.html#hcat"><span class="hs-identifier hs-var">hcat</span></a></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">FilePath -&gt; SDoc
forall doc. IsLine doc =&gt; FilePath -&gt; doc
</span><a href="GHC.Utils.Outputable.html#text"><span class="hs-identifier hs-var">text</span></a></span><span> </span><span class="annot"><span class="annottext">FilePath
</span><span class="hs-string">&quot;Extra roots: &quot;</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Set ExportedFun -&gt; SDoc
forall a. Outputable a =&gt; a -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">LinkSpec -&gt; Set ExportedFun
</span><a href="GHC.StgToJS.Linker.Linker.html#lks_extra_roots"><span class="hs-identifier hs-var">lks_extra_roots</span></a></span><span> </span><span class="annot"><span class="annottext">LinkSpec
</span><a href="#local-6989586621682959997"><span class="hs-identifier hs-var">s</span></a></span><span class="hs-special">)</span><span class="hs-special">]</span><span>
</span><span id="line-394"></span><span>            </span><span class="hs-special">]</span><span>
</span><span id="line-395"></span><span>
</span><span id="line-396"></span><span class="annot"><a href="GHC.StgToJS.Linker.Linker.html#emptyLinkPlan"><span class="hs-identifier hs-type">emptyLinkPlan</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.StgToJS.Linker.Types.html#LinkPlan"><span class="hs-identifier hs-type">LinkPlan</span></a></span><span>
</span><span id="line-397"></span><span id="emptyLinkPlan"><span class="annot"><span class="annottext">emptyLinkPlan :: LinkPlan
</span><a href="GHC.StgToJS.Linker.Linker.html#emptyLinkPlan"><span class="hs-identifier hs-var hs-var">emptyLinkPlan</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="GHC.StgToJS.Linker.Types.html#LinkPlan"><span class="hs-identifier hs-type">LinkPlan</span></a></span><span>
</span><span id="line-398"></span><span>  </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">lkp_block_info :: Map Module LocatedBlockInfo
</span><a href="GHC.StgToJS.Linker.Types.html#lkp_block_info"><span class="hs-identifier hs-var">lkp_block_info</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Map Module LocatedBlockInfo
forall a. Monoid a =&gt; a
</span><span class="hs-identifier hs-var">mempty</span></span><span>
</span><span id="line-399"></span><span>  </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">lkp_dep_blocks :: Set BlockRef
</span><a href="GHC.StgToJS.Linker.Types.html#lkp_dep_blocks"><span class="hs-identifier hs-var">lkp_dep_blocks</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Set BlockRef
forall a. Monoid a =&gt; a
</span><span class="hs-identifier hs-var">mempty</span></span><span>
</span><span id="line-400"></span><span>  </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">lkp_archives :: Set FilePath
</span><a href="GHC.StgToJS.Linker.Types.html#lkp_archives"><span class="hs-identifier hs-var">lkp_archives</span></a></span><span>   </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Set FilePath
forall a. Monoid a =&gt; a
</span><span class="hs-identifier hs-var">mempty</span></span><span>
</span><span id="line-401"></span><span>  </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">lkp_objs_js :: Set FilePath
</span><a href="GHC.StgToJS.Linker.Types.html#lkp_objs_js"><span class="hs-identifier hs-var">lkp_objs_js</span></a></span><span>    </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Set FilePath
forall a. Monoid a =&gt; a
</span><span class="hs-identifier hs-var">mempty</span></span><span>
</span><span id="line-402"></span><span>  </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">lkp_objs_cc :: Set FilePath
</span><a href="GHC.StgToJS.Linker.Types.html#lkp_objs_cc"><span class="hs-identifier hs-var">lkp_objs_cc</span></a></span><span>    </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Set FilePath
forall a. Monoid a =&gt; a
</span><span class="hs-identifier hs-var">mempty</span></span><span>
</span><span id="line-403"></span><span>  </span><span class="hs-special">}</span><span>
</span><span id="line-404"></span><span>
</span><span id="line-405"></span><span class="hs-comment">-- | Given a `base` link plan (assumed to be already linked) and a `new` link</span><span>
</span><span id="line-406"></span><span class="hs-comment">-- plan, compute `(diff, total)` link plans.</span><span>
</span><span id="line-407"></span><span class="hs-comment">--</span><span>
</span><span id="line-408"></span><span class="hs-comment">-- - `diff` is the incremental link plan to get from `base` to `total`</span><span>
</span><span id="line-409"></span><span class="hs-comment">-- - `total` is the total link plan as if `base` and `new` were linked at once</span><span>
</span><span id="line-410"></span><span class="annot"><a href="GHC.StgToJS.Linker.Linker.html#incrementLinkPlan"><span class="hs-identifier hs-type">incrementLinkPlan</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.StgToJS.Linker.Types.html#LinkPlan"><span class="hs-identifier hs-type">LinkPlan</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.StgToJS.Linker.Types.html#LinkPlan"><span class="hs-identifier hs-type">LinkPlan</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.StgToJS.Linker.Types.html#LinkPlan"><span class="hs-identifier hs-type">LinkPlan</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.StgToJS.Linker.Types.html#LinkPlan"><span class="hs-identifier hs-type">LinkPlan</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-411"></span><span id="incrementLinkPlan"><span class="annot"><span class="annottext">incrementLinkPlan :: LinkPlan -&gt; LinkPlan -&gt; (LinkPlan, LinkPlan)
</span><a href="GHC.StgToJS.Linker.Linker.html#incrementLinkPlan"><span class="hs-identifier hs-var hs-var">incrementLinkPlan</span></a></span></span><span> </span><span id="local-6989586621682960002"><span class="annot"><span class="annottext">LinkPlan
</span><a href="#local-6989586621682960002"><span class="hs-identifier hs-var">base</span></a></span></span><span> </span><span id="local-6989586621682960003"><span class="annot"><span class="annottext">LinkPlan
</span><a href="#local-6989586621682960003"><span class="hs-identifier hs-var">new</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">LinkPlan
</span><a href="#local-6989586621682960004"><span class="hs-identifier hs-var">diff</span></a></span><span class="hs-special">,</span><span class="annot"><span class="annottext">LinkPlan
</span><a href="#local-6989586621682960005"><span class="hs-identifier hs-var">total</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-412"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-413"></span><span>    </span><span id="local-6989586621682960005"><span class="annot"><span class="annottext">total :: LinkPlan
</span><a href="#local-6989586621682960005"><span class="hs-identifier hs-var hs-var">total</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="GHC.StgToJS.Linker.Types.html#LinkPlan"><span class="hs-identifier hs-type">LinkPlan</span></a></span><span>
</span><span id="line-414"></span><span>      </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">lkp_block_info :: Map Module LocatedBlockInfo
</span><a href="GHC.StgToJS.Linker.Types.html#lkp_block_info"><span class="hs-identifier hs-var">lkp_block_info</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Map Module LocatedBlockInfo
-&gt; Map Module LocatedBlockInfo -&gt; Map Module LocatedBlockInfo
forall k a. Ord k =&gt; Map k a -&gt; Map k a -&gt; Map k a
</span><a href="../../containers-0.7-5a8f/src/Data.Map.Internal.html#union"><span class="hs-identifier hs-var">M.union</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">LinkPlan -&gt; Map Module LocatedBlockInfo
</span><a href="GHC.StgToJS.Linker.Types.html#lkp_block_info"><span class="hs-identifier hs-var">lkp_block_info</span></a></span><span> </span><span class="annot"><span class="annottext">LinkPlan
</span><a href="#local-6989586621682960002"><span class="hs-identifier hs-var">base</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">LinkPlan -&gt; Map Module LocatedBlockInfo
</span><a href="GHC.StgToJS.Linker.Types.html#lkp_block_info"><span class="hs-identifier hs-var">lkp_block_info</span></a></span><span> </span><span class="annot"><span class="annottext">LinkPlan
</span><a href="#local-6989586621682960003"><span class="hs-identifier hs-var">new</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-415"></span><span>      </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">lkp_dep_blocks :: Set BlockRef
</span><a href="GHC.StgToJS.Linker.Types.html#lkp_dep_blocks"><span class="hs-identifier hs-var">lkp_dep_blocks</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Set BlockRef -&gt; Set BlockRef -&gt; Set BlockRef
forall a. Ord a =&gt; Set a -&gt; Set a -&gt; Set a
</span><a href="../../containers-0.7-5a8f/src/Data.Set.Internal.html#union"><span class="hs-identifier hs-var">S.union</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">LinkPlan -&gt; Set BlockRef
</span><a href="GHC.StgToJS.Linker.Types.html#lkp_dep_blocks"><span class="hs-identifier hs-var">lkp_dep_blocks</span></a></span><span> </span><span class="annot"><span class="annottext">LinkPlan
</span><a href="#local-6989586621682960002"><span class="hs-identifier hs-var">base</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">LinkPlan -&gt; Set BlockRef
</span><a href="GHC.StgToJS.Linker.Types.html#lkp_dep_blocks"><span class="hs-identifier hs-var">lkp_dep_blocks</span></a></span><span> </span><span class="annot"><span class="annottext">LinkPlan
</span><a href="#local-6989586621682960003"><span class="hs-identifier hs-var">new</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-416"></span><span>      </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">lkp_archives :: Set FilePath
</span><a href="GHC.StgToJS.Linker.Types.html#lkp_archives"><span class="hs-identifier hs-var">lkp_archives</span></a></span><span>   </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Set FilePath -&gt; Set FilePath -&gt; Set FilePath
forall a. Ord a =&gt; Set a -&gt; Set a -&gt; Set a
</span><a href="../../containers-0.7-5a8f/src/Data.Set.Internal.html#union"><span class="hs-identifier hs-var">S.union</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">LinkPlan -&gt; Set FilePath
</span><a href="GHC.StgToJS.Linker.Types.html#lkp_archives"><span class="hs-identifier hs-var">lkp_archives</span></a></span><span> </span><span class="annot"><span class="annottext">LinkPlan
</span><a href="#local-6989586621682960002"><span class="hs-identifier hs-var">base</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">LinkPlan -&gt; Set FilePath
</span><a href="GHC.StgToJS.Linker.Types.html#lkp_archives"><span class="hs-identifier hs-var">lkp_archives</span></a></span><span> </span><span class="annot"><span class="annottext">LinkPlan
</span><a href="#local-6989586621682960003"><span class="hs-identifier hs-var">new</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-417"></span><span>      </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">lkp_objs_js :: Set FilePath
</span><a href="GHC.StgToJS.Linker.Types.html#lkp_objs_js"><span class="hs-identifier hs-var">lkp_objs_js</span></a></span><span>    </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Set FilePath -&gt; Set FilePath -&gt; Set FilePath
forall a. Ord a =&gt; Set a -&gt; Set a -&gt; Set a
</span><a href="../../containers-0.7-5a8f/src/Data.Set.Internal.html#union"><span class="hs-identifier hs-var">S.union</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">LinkPlan -&gt; Set FilePath
</span><a href="GHC.StgToJS.Linker.Types.html#lkp_objs_js"><span class="hs-identifier hs-var">lkp_objs_js</span></a></span><span> </span><span class="annot"><span class="annottext">LinkPlan
</span><a href="#local-6989586621682960002"><span class="hs-identifier hs-var">base</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">LinkPlan -&gt; Set FilePath
</span><a href="GHC.StgToJS.Linker.Types.html#lkp_objs_js"><span class="hs-identifier hs-var">lkp_objs_js</span></a></span><span> </span><span class="annot"><span class="annottext">LinkPlan
</span><a href="#local-6989586621682960003"><span class="hs-identifier hs-var">new</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-418"></span><span>      </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">lkp_objs_cc :: Set FilePath
</span><a href="GHC.StgToJS.Linker.Types.html#lkp_objs_cc"><span class="hs-identifier hs-var">lkp_objs_cc</span></a></span><span>    </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Set FilePath -&gt; Set FilePath -&gt; Set FilePath
forall a. Ord a =&gt; Set a -&gt; Set a -&gt; Set a
</span><a href="../../containers-0.7-5a8f/src/Data.Set.Internal.html#union"><span class="hs-identifier hs-var">S.union</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">LinkPlan -&gt; Set FilePath
</span><a href="GHC.StgToJS.Linker.Types.html#lkp_objs_cc"><span class="hs-identifier hs-var">lkp_objs_cc</span></a></span><span> </span><span class="annot"><span class="annottext">LinkPlan
</span><a href="#local-6989586621682960002"><span class="hs-identifier hs-var">base</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">LinkPlan -&gt; Set FilePath
</span><a href="GHC.StgToJS.Linker.Types.html#lkp_objs_cc"><span class="hs-identifier hs-var">lkp_objs_cc</span></a></span><span> </span><span class="annot"><span class="annottext">LinkPlan
</span><a href="#local-6989586621682960003"><span class="hs-identifier hs-var">new</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-419"></span><span>      </span><span class="hs-special">}</span><span>
</span><span id="line-420"></span><span>    </span><span id="local-6989586621682960004"><span class="annot"><span class="annottext">diff :: LinkPlan
</span><a href="#local-6989586621682960004"><span class="hs-identifier hs-var hs-var">diff</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="GHC.StgToJS.Linker.Types.html#LinkPlan"><span class="hs-identifier hs-type">LinkPlan</span></a></span><span>
</span><span id="line-421"></span><span>      </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">lkp_block_info :: Map Module LocatedBlockInfo
</span><a href="GHC.StgToJS.Linker.Types.html#lkp_block_info"><span class="hs-identifier hs-var">lkp_block_info</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">LinkPlan -&gt; Map Module LocatedBlockInfo
</span><a href="GHC.StgToJS.Linker.Types.html#lkp_block_info"><span class="hs-identifier hs-var">lkp_block_info</span></a></span><span> </span><span class="annot"><span class="annottext">LinkPlan
</span><a href="#local-6989586621682960003"><span class="hs-identifier hs-var">new</span></a></span><span> </span><span class="hs-comment">-- block info from &quot;new&quot; contains all we need to load new blocks</span><span>
</span><span id="line-422"></span><span>      </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">lkp_dep_blocks :: Set BlockRef
</span><a href="GHC.StgToJS.Linker.Types.html#lkp_dep_blocks"><span class="hs-identifier hs-var">lkp_dep_blocks</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Set BlockRef -&gt; Set BlockRef -&gt; Set BlockRef
forall a. Ord a =&gt; Set a -&gt; Set a -&gt; Set a
</span><a href="../../containers-0.7-5a8f/src/Data.Set.Internal.html#difference"><span class="hs-identifier hs-var">S.difference</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">LinkPlan -&gt; Set BlockRef
</span><a href="GHC.StgToJS.Linker.Types.html#lkp_dep_blocks"><span class="hs-identifier hs-var">lkp_dep_blocks</span></a></span><span> </span><span class="annot"><span class="annottext">LinkPlan
</span><a href="#local-6989586621682960003"><span class="hs-identifier hs-var">new</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">LinkPlan -&gt; Set BlockRef
</span><a href="GHC.StgToJS.Linker.Types.html#lkp_dep_blocks"><span class="hs-identifier hs-var">lkp_dep_blocks</span></a></span><span> </span><span class="annot"><span class="annottext">LinkPlan
</span><a href="#local-6989586621682960002"><span class="hs-identifier hs-var">base</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-423"></span><span>      </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">lkp_archives :: Set FilePath
</span><a href="GHC.StgToJS.Linker.Types.html#lkp_archives"><span class="hs-identifier hs-var">lkp_archives</span></a></span><span>   </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Set FilePath -&gt; Set FilePath -&gt; Set FilePath
forall a. Ord a =&gt; Set a -&gt; Set a -&gt; Set a
</span><a href="../../containers-0.7-5a8f/src/Data.Set.Internal.html#difference"><span class="hs-identifier hs-var">S.difference</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">LinkPlan -&gt; Set FilePath
</span><a href="GHC.StgToJS.Linker.Types.html#lkp_archives"><span class="hs-identifier hs-var">lkp_archives</span></a></span><span> </span><span class="annot"><span class="annottext">LinkPlan
</span><a href="#local-6989586621682960003"><span class="hs-identifier hs-var">new</span></a></span><span class="hs-special">)</span><span>   </span><span class="hs-special">(</span><span class="annot"><span class="annottext">LinkPlan -&gt; Set FilePath
</span><a href="GHC.StgToJS.Linker.Types.html#lkp_archives"><span class="hs-identifier hs-var">lkp_archives</span></a></span><span> </span><span class="annot"><span class="annottext">LinkPlan
</span><a href="#local-6989586621682960002"><span class="hs-identifier hs-var">base</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-424"></span><span>      </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">lkp_objs_js :: Set FilePath
</span><a href="GHC.StgToJS.Linker.Types.html#lkp_objs_js"><span class="hs-identifier hs-var">lkp_objs_js</span></a></span><span>    </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Set FilePath -&gt; Set FilePath -&gt; Set FilePath
forall a. Ord a =&gt; Set a -&gt; Set a -&gt; Set a
</span><a href="../../containers-0.7-5a8f/src/Data.Set.Internal.html#difference"><span class="hs-identifier hs-var">S.difference</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">LinkPlan -&gt; Set FilePath
</span><a href="GHC.StgToJS.Linker.Types.html#lkp_objs_js"><span class="hs-identifier hs-var">lkp_objs_js</span></a></span><span> </span><span class="annot"><span class="annottext">LinkPlan
</span><a href="#local-6989586621682960003"><span class="hs-identifier hs-var">new</span></a></span><span class="hs-special">)</span><span>    </span><span class="hs-special">(</span><span class="annot"><span class="annottext">LinkPlan -&gt; Set FilePath
</span><a href="GHC.StgToJS.Linker.Types.html#lkp_objs_js"><span class="hs-identifier hs-var">lkp_objs_js</span></a></span><span> </span><span class="annot"><span class="annottext">LinkPlan
</span><a href="#local-6989586621682960002"><span class="hs-identifier hs-var">base</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-425"></span><span>      </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">lkp_objs_cc :: Set FilePath
</span><a href="GHC.StgToJS.Linker.Types.html#lkp_objs_cc"><span class="hs-identifier hs-var">lkp_objs_cc</span></a></span><span>    </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Set FilePath -&gt; Set FilePath -&gt; Set FilePath
forall a. Ord a =&gt; Set a -&gt; Set a -&gt; Set a
</span><a href="../../containers-0.7-5a8f/src/Data.Set.Internal.html#difference"><span class="hs-identifier hs-var">S.difference</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">LinkPlan -&gt; Set FilePath
</span><a href="GHC.StgToJS.Linker.Types.html#lkp_objs_cc"><span class="hs-identifier hs-var">lkp_objs_cc</span></a></span><span> </span><span class="annot"><span class="annottext">LinkPlan
</span><a href="#local-6989586621682960003"><span class="hs-identifier hs-var">new</span></a></span><span class="hs-special">)</span><span>    </span><span class="hs-special">(</span><span class="annot"><span class="annottext">LinkPlan -&gt; Set FilePath
</span><a href="GHC.StgToJS.Linker.Types.html#lkp_objs_cc"><span class="hs-identifier hs-var">lkp_objs_cc</span></a></span><span> </span><span class="annot"><span class="annottext">LinkPlan
</span><a href="#local-6989586621682960002"><span class="hs-identifier hs-var">base</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-426"></span><span>      </span><span class="hs-special">}</span><span>
</span><span id="line-427"></span><span>
</span><span id="line-428"></span><span>
</span><span id="line-429"></span><span class="annot"><a href="GHC.StgToJS.Linker.Linker.html#computeLinkDependencies"><span class="hs-identifier hs-type">computeLinkDependencies</span></a></span><span>
</span><span id="line-430"></span><span>  </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.StgToJS.Types.html#StgToJSConfig"><span class="hs-identifier hs-type">StgToJSConfig</span></a></span><span>
</span><span id="line-431"></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Unit.Env.html#UnitEnv"><span class="hs-identifier hs-type">UnitEnv</span></a></span><span>
</span><span id="line-432"></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.StgToJS.Linker.Linker.html#LinkSpec"><span class="hs-identifier hs-type">LinkSpec</span></a></span><span>
</span><span id="line-433"></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Unit.Finder.Types.html#FinderOpts"><span class="hs-identifier hs-type">FinderOpts</span></a></span><span>
</span><span id="line-434"></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Unit.Finder.Types.html#FinderCache"><span class="hs-identifier hs-type">FinderCache</span></a></span><span>
</span><span id="line-435"></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.StgToJS.Linker.Linker.html#ArchiveCache"><span class="hs-identifier hs-type">ArchiveCache</span></a></span><span>
</span><span id="line-436"></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="annot"><a href="GHC.StgToJS.Linker.Types.html#LinkPlan"><span class="hs-identifier hs-type">LinkPlan</span></a></span><span>
</span><span id="line-437"></span><span id="computeLinkDependencies"><span class="annot"><span class="annottext">computeLinkDependencies :: StgToJSConfig
-&gt; UnitEnv
-&gt; LinkSpec
-&gt; FinderOpts
-&gt; FinderCache
-&gt; ArchiveCache
-&gt; IO LinkPlan
</span><a href="GHC.StgToJS.Linker.Linker.html#computeLinkDependencies"><span class="hs-identifier hs-var hs-var">computeLinkDependencies</span></a></span></span><span> </span><span id="local-6989586621682960009"><span class="annot"><span class="annottext">StgToJSConfig
</span><a href="#local-6989586621682960009"><span class="hs-identifier hs-var">cfg</span></a></span></span><span> </span><span id="local-6989586621682960010"><span class="annot"><span class="annottext">UnitEnv
</span><a href="#local-6989586621682960010"><span class="hs-identifier hs-var">unit_env</span></a></span></span><span> </span><span id="local-6989586621682960011"><span class="annot"><span class="annottext">LinkSpec
</span><a href="#local-6989586621682960011"><span class="hs-identifier hs-var">link_spec</span></a></span></span><span> </span><span id="local-6989586621682960012"><span class="annot"><span class="annottext">FinderOpts
</span><a href="#local-6989586621682960012"><span class="hs-identifier hs-var">finder_opts</span></a></span></span><span> </span><span id="local-6989586621682960013"><span class="annot"><span class="annottext">FinderCache
</span><a href="#local-6989586621682960013"><span class="hs-identifier hs-var">finder_cache</span></a></span></span><span> </span><span id="local-6989586621682960014"><span class="annot"><span class="annottext">ArchiveCache
</span><a href="#local-6989586621682960014"><span class="hs-identifier hs-var">ar_cache</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-438"></span><span>
</span><span id="line-439"></span><span>  </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621682960015"><span class="annot"><span class="annottext">units :: [UnitId]
</span><a href="#local-6989586621682960015"><span class="hs-identifier hs-var hs-var hs-var">units</span></a></span></span><span>       </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">LinkSpec -&gt; [UnitId]
</span><a href="GHC.StgToJS.Linker.Linker.html#lks_unit_ids"><span class="hs-identifier hs-var">lks_unit_ids</span></a></span><span>        </span><span class="annot"><span class="annottext">LinkSpec
</span><a href="#local-6989586621682960011"><span class="hs-identifier hs-var">link_spec</span></a></span><span>
</span><span id="line-440"></span><span>  </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621682960016"><span class="annot"><span class="annottext">hs_objs :: [FilePath]
</span><a href="#local-6989586621682960016"><span class="hs-identifier hs-var hs-var hs-var">hs_objs</span></a></span></span><span>     </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">LinkSpec -&gt; [FilePath]
</span><a href="GHC.StgToJS.Linker.Linker.html#lks_objs_hs"><span class="hs-identifier hs-var">lks_objs_hs</span></a></span><span>         </span><span class="annot"><span class="annottext">LinkSpec
</span><a href="#local-6989586621682960011"><span class="hs-identifier hs-var">link_spec</span></a></span><span>
</span><span id="line-441"></span><span>  </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621682960017"><span class="annot"><span class="annottext">js_objs :: [FilePath]
</span><a href="#local-6989586621682960017"><span class="hs-identifier hs-var hs-var hs-var">js_objs</span></a></span></span><span>     </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">LinkSpec -&gt; [FilePath]
</span><a href="GHC.StgToJS.Linker.Linker.html#lks_objs_js"><span class="hs-identifier hs-var">lks_objs_js</span></a></span><span>         </span><span class="annot"><span class="annottext">LinkSpec
</span><a href="#local-6989586621682960011"><span class="hs-identifier hs-var">link_spec</span></a></span><span>
</span><span id="line-442"></span><span>  </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621682960018"><span class="annot"><span class="annottext">cc_objs :: [FilePath]
</span><a href="#local-6989586621682960018"><span class="hs-identifier hs-var hs-var hs-var">cc_objs</span></a></span></span><span>     </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">LinkSpec -&gt; [FilePath]
</span><a href="GHC.StgToJS.Linker.Linker.html#lks_objs_cc"><span class="hs-identifier hs-var">lks_objs_cc</span></a></span><span>         </span><span class="annot"><span class="annottext">LinkSpec
</span><a href="#local-6989586621682960011"><span class="hs-identifier hs-var">link_spec</span></a></span><span>
</span><span id="line-443"></span><span>  </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621682960019"><span class="annot"><span class="annottext">extra_roots :: Set ExportedFun
</span><a href="#local-6989586621682960019"><span class="hs-identifier hs-var hs-var hs-var">extra_roots</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">LinkSpec -&gt; Set ExportedFun
</span><a href="GHC.StgToJS.Linker.Linker.html#lks_extra_roots"><span class="hs-identifier hs-var">lks_extra_roots</span></a></span><span>     </span><span class="annot"><span class="annottext">LinkSpec
</span><a href="#local-6989586621682960011"><span class="hs-identifier hs-var">link_spec</span></a></span><span>
</span><span id="line-444"></span><span>  </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621682960020"><span class="annot"><span class="annottext">obj_is_root :: ExportedFun -&gt; Bool
</span><a href="#local-6989586621682960020"><span class="hs-identifier hs-var hs-var hs-var">obj_is_root</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">LinkSpec -&gt; ExportedFun -&gt; Bool
</span><a href="GHC.StgToJS.Linker.Linker.html#lks_obj_root_filter"><span class="hs-identifier hs-var">lks_obj_root_filter</span></a></span><span> </span><span class="annot"><span class="annottext">LinkSpec
</span><a href="#local-6989586621682960011"><span class="hs-identifier hs-var">link_spec</span></a></span><span>
</span><span id="line-445"></span><span>
</span><span id="line-446"></span><span>  </span><span class="hs-comment">-- Process:</span><span>
</span><span id="line-447"></span><span>  </span><span class="hs-comment">-- 1) Find new required linkables (object files, libraries, etc.) for all</span><span>
</span><span id="line-448"></span><span>  </span><span class="hs-comment">-- transitive dependencies</span><span>
</span><span id="line-449"></span><span>  </span><span class="hs-comment">-- 2) Load ObjBlockInfo from them and cache them</span><span>
</span><span id="line-450"></span><span>  </span><span class="hs-comment">-- 3) Compute ObjBlock dependencies and return the link plan</span><span>
</span><span id="line-451"></span><span>
</span><span id="line-452"></span><span>  </span><span class="hs-comment">-- TODO (#23013): currently we directly compute the ObjBlock dependencies and</span><span>
</span><span id="line-453"></span><span>  </span><span class="hs-comment">-- find/load linkable on-demand when a module is missing.</span><span>
</span><span id="line-454"></span><span>
</span><span id="line-455"></span><span>
</span><span id="line-456"></span><span>  </span><span class="hs-special">(</span><span id="local-6989586621682960021"><span class="annot"><a href="#local-6989586621682960021"><span class="hs-identifier hs-var">objs_block_info</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682960022"><span class="annot"><a href="#local-6989586621682960022"><span class="hs-identifier hs-var">objs_required_blocks</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">[FilePath] -&gt; IO (Map Module LocatedBlockInfo, [BlockRef])
</span><a href="GHC.StgToJS.Linker.Linker.html#loadObjBlockInfo"><span class="hs-identifier hs-var">loadObjBlockInfo</span></a></span><span> </span><span class="annot"><span class="annottext">[FilePath]
</span><a href="#local-6989586621682960016"><span class="hs-identifier hs-var">hs_objs</span></a></span><span>
</span><span id="line-457"></span><span>
</span><span id="line-458"></span><span>  </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621682960024"><span class="annot"><a href="#local-6989586621682960024"><span class="hs-identifier hs-var hs-var">obj_roots</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[ExportedFun] -&gt; Set ExportedFun
forall a. Ord a =&gt; [a] -&gt; Set a
</span><a href="../../containers-0.7-5a8f/src/Data.Set.Internal.html#fromList"><span class="hs-identifier hs-var">S.fromList</span></a></span><span> </span><span class="annot"><span class="annottext">([ExportedFun] -&gt; Set ExportedFun)
-&gt; ([ExportedFun] -&gt; [ExportedFun])
-&gt; [ExportedFun]
-&gt; Set ExportedFun
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">(ExportedFun -&gt; Bool) -&gt; [ExportedFun] -&gt; [ExportedFun]
forall a. (a -&gt; Bool) -&gt; [a] -&gt; [a]
</span><span class="hs-identifier hs-var">filter</span></span><span> </span><span class="annot"><span class="annottext">ExportedFun -&gt; Bool
</span><a href="#local-6989586621682960020"><span class="hs-identifier hs-var">obj_is_root</span></a></span><span> </span><span class="annot"><span class="annottext">([ExportedFun] -&gt; Set ExportedFun)
-&gt; [ExportedFun] -&gt; Set ExportedFun
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">(LocatedBlockInfo -&gt; [ExportedFun])
-&gt; [LocatedBlockInfo] -&gt; [ExportedFun]
forall (t :: * -&gt; *) a b. Foldable t =&gt; (a -&gt; [b]) -&gt; t a -&gt; [b]
</span><span class="hs-identifier hs-var">concatMap</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Map ExportedFun BlockId -&gt; [ExportedFun]
forall k a. Map k a -&gt; [k]
</span><a href="../../containers-0.7-5a8f/src/Data.Map.Internal.html#keys"><span class="hs-identifier hs-var">M.keys</span></a></span><span> </span><span class="annot"><span class="annottext">(Map ExportedFun BlockId -&gt; [ExportedFun])
-&gt; (LocatedBlockInfo -&gt; Map ExportedFun BlockId)
-&gt; LocatedBlockInfo
-&gt; [ExportedFun]
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">BlockInfo -&gt; Map ExportedFun BlockId
</span><a href="GHC.StgToJS.Object.html#bi_exports"><span class="hs-identifier hs-var">bi_exports</span></a></span><span> </span><span class="annot"><span class="annottext">(BlockInfo -&gt; Map ExportedFun BlockId)
-&gt; (LocatedBlockInfo -&gt; BlockInfo)
-&gt; LocatedBlockInfo
-&gt; Map ExportedFun BlockId
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">LocatedBlockInfo -&gt; BlockInfo
</span><a href="GHC.StgToJS.Object.html#lbi_info"><span class="hs-identifier hs-var">lbi_info</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Map Module LocatedBlockInfo -&gt; [LocatedBlockInfo]
forall k a. Map k a -&gt; [a]
</span><a href="../../containers-0.7-5a8f/src/Data.Map.Internal.html#elems"><span class="hs-identifier hs-var">M.elems</span></a></span><span> </span><span class="annot"><span class="annottext">Map Module LocatedBlockInfo
</span><a href="#local-6989586621682960021"><span class="hs-identifier hs-var">objs_block_info</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-459"></span><span>      </span><span id="local-6989586621682960032"><span class="annot"><a href="#local-6989586621682960032"><span class="hs-identifier hs-var hs-var">obj_units</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(Module -&gt; UnitId) -&gt; [Module] -&gt; [UnitId]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><span class="hs-identifier hs-var">map</span></span><span> </span><span class="annot"><span class="annottext">Module -&gt; UnitId
</span><a href="GHC.Unit.Types.html#moduleUnitId"><span class="hs-identifier hs-var">moduleUnitId</span></a></span><span> </span><span class="annot"><span class="annottext">([Module] -&gt; [UnitId]) -&gt; [Module] -&gt; [UnitId]
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">[Module] -&gt; [Module]
forall a. Eq a =&gt; [a] -&gt; [a]
</span><span class="hs-identifier hs-var">nub</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Map Module LocatedBlockInfo -&gt; [Module]
forall k a. Map k a -&gt; [k]
</span><a href="../../containers-0.7-5a8f/src/Data.Map.Internal.html#keys"><span class="hs-identifier hs-var">M.keys</span></a></span><span> </span><span class="annot"><span class="annottext">Map Module LocatedBlockInfo
</span><a href="#local-6989586621682960021"><span class="hs-identifier hs-var">objs_block_info</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-460"></span><span>
</span><span id="line-461"></span><span>  </span><span class="hs-keyword">let</span><span> </span><span class="hs-special">(</span><span id="local-6989586621682960034"><span class="annot"><a href="#local-6989586621682960034"><span class="hs-identifier hs-var">rts_wired_units</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682960035"><span class="annot"><a href="#local-6989586621682960035"><span class="hs-identifier hs-var">rts_wired_functions</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="GHC.StgToJS.Linker.Linker.html#rtsDeps"><span class="hs-identifier hs-type">rtsDeps</span></a></span><span>
</span><span id="line-462"></span><span>
</span><span id="line-463"></span><span>  </span><span class="hs-comment">-- all the units we want to link together, without their dependencies</span><span>
</span><span id="line-464"></span><span>  </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621682960037"><span class="annot"><a href="#local-6989586621682960037"><span class="hs-identifier hs-var hs-var">root_units</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(UnitId -&gt; Bool) -&gt; [UnitId] -&gt; [UnitId]
forall a. (a -&gt; Bool) -&gt; [a] -&gt; [a]
</span><span class="hs-identifier hs-var">filter</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">UnitId -&gt; UnitId -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">/=</span></span><span> </span><span class="annot"><span class="annottext">UnitEnv -&gt; UnitId
</span><a href="GHC.Unit.Env.html#ue_currentUnit"><span class="hs-identifier hs-var">ue_currentUnit</span></a></span><span> </span><span class="annot"><span class="annottext">UnitEnv
</span><a href="#local-6989586621682960010"><span class="hs-identifier hs-var">unit_env</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-465"></span><span>                   </span><span class="annot"><span class="annottext">([UnitId] -&gt; [UnitId]) -&gt; [UnitId] -&gt; [UnitId]
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">(UnitId -&gt; Bool) -&gt; [UnitId] -&gt; [UnitId]
forall a. (a -&gt; Bool) -&gt; [a] -&gt; [a]
</span><span class="hs-identifier hs-var">filter</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">UnitId -&gt; UnitId -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">/=</span></span><span> </span><span class="annot"><span class="annottext">UnitId
</span><a href="GHC.Unit.Types.html#interactiveUnitId"><span class="hs-identifier hs-var">interactiveUnitId</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-466"></span><span>                   </span><span class="annot"><span class="annottext">([UnitId] -&gt; [UnitId]) -&gt; [UnitId] -&gt; [UnitId]
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">[UnitId] -&gt; [UnitId]
forall a. Eq a =&gt; [a] -&gt; [a]
</span><span class="hs-identifier hs-var">nub</span></span><span>
</span><span id="line-467"></span><span>                   </span><span class="annot"><span class="annottext">([UnitId] -&gt; [UnitId]) -&gt; [UnitId] -&gt; [UnitId]
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">[UnitId]
</span><a href="#local-6989586621682960034"><span class="hs-identifier hs-var">rts_wired_units</span></a></span><span> </span><span class="annot"><span class="annottext">[UnitId] -&gt; [UnitId] -&gt; [UnitId]
forall a. [a] -&gt; [a] -&gt; [a]
</span><span class="hs-operator hs-var">++</span></span><span> </span><span class="annot"><span class="annottext">[UnitId] -&gt; [UnitId]
forall a. [a] -&gt; [a]
</span><span class="hs-identifier hs-var">reverse</span></span><span> </span><span class="annot"><span class="annottext">[UnitId]
</span><a href="#local-6989586621682960032"><span class="hs-identifier hs-var">obj_units</span></a></span><span> </span><span class="annot"><span class="annottext">[UnitId] -&gt; [UnitId] -&gt; [UnitId]
forall a. [a] -&gt; [a] -&gt; [a]
</span><span class="hs-operator hs-var">++</span></span><span> </span><span class="annot"><span class="annottext">[UnitId] -&gt; [UnitId]
forall a. [a] -&gt; [a]
</span><span class="hs-identifier hs-var">reverse</span></span><span> </span><span class="annot"><span class="annottext">[UnitId]
</span><a href="#local-6989586621682960015"><span class="hs-identifier hs-var">units</span></a></span><span>
</span><span id="line-468"></span><span>
</span><span id="line-469"></span><span>  </span><span class="hs-comment">-- all the units we want to link together, including their dependencies,</span><span>
</span><span id="line-470"></span><span>  </span><span class="hs-comment">-- preload units, and backpack instantiations</span><span>
</span><span id="line-471"></span><span>  </span><span id="local-6989586621682960042"><span class="annot"><a href="#local-6989586621682960042"><span class="hs-identifier hs-var">all_units_infos</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><a href="GHC.Unit.State.html#mayThrowUnitErr"><span class="hs-identifier hs-type">mayThrowUnitErr</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Unit.Env.html#preloadUnitsInfo%27"><span class="hs-identifier hs-type">preloadUnitsInfo'</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682960010"><span class="hs-identifier hs-type">unit_env</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682960037"><span class="hs-identifier hs-type">root_units</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-472"></span><span>
</span><span id="line-473"></span><span>  </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621682960045"><span class="annot"><a href="#local-6989586621682960045"><span class="hs-identifier hs-var hs-var">all_units</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(UnitInfo -&gt; UnitId) -&gt; [UnitInfo] -&gt; [UnitId]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-identifier hs-var">fmap</span></span><span> </span><span class="annot"><span class="annottext">UnitInfo -&gt; UnitId
forall srcpkgid srcpkgname uid modulename mod.
GenericUnitInfo srcpkgid srcpkgname uid modulename mod -&gt; uid
</span><a href="../../ghc-boot-9.12.2-1a37/src/GHC.Unit.Database.html#unitId"><span class="hs-identifier hs-var">unitId</span></a></span><span> </span><span class="annot"><span class="annottext">[UnitInfo]
</span><a href="#local-6989586621682960042"><span class="hs-identifier hs-var">all_units_infos</span></a></span><span>
</span><span id="line-474"></span><span>
</span><span id="line-475"></span><span>  </span><span id="local-6989586621682960047"><span class="annot"><a href="#local-6989586621682960047"><span class="hs-identifier hs-var">dep_archives</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><a href="GHC.StgToJS.Linker.Linker.html#getPackageArchives"><span class="hs-identifier hs-type">getPackageArchives</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682960009"><span class="hs-identifier hs-type">cfg</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682960010"><span class="hs-identifier hs-type">unit_env</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682960045"><span class="hs-identifier hs-type">all_units</span></a></span><span>
</span><span id="line-476"></span><span>  </span><span class="hs-special">(</span><span id="local-6989586621682960049"><span class="annot"><a href="#local-6989586621682960049"><span class="hs-identifier hs-var">archives_block_info</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682960050"><span class="annot"><a href="#local-6989586621682960050"><span class="hs-identifier hs-var">archives_required_blocks</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><a href="GHC.StgToJS.Linker.Linker.html#loadArchiveBlockInfo"><span class="hs-identifier hs-type">loadArchiveBlockInfo</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682960014"><span class="hs-identifier hs-type">ar_cache</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682960047"><span class="hs-identifier hs-type">dep_archives</span></a></span><span>
</span><span id="line-477"></span><span>
</span><span id="line-478"></span><span>  </span><span class="hs-comment">-- compute dependencies</span><span>
</span><span id="line-479"></span><span>  </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621682960052"><span class="annot"><a href="#local-6989586621682960052"><span class="hs-identifier hs-var hs-var">block_info</span></a></span></span><span>      </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Map Module LocatedBlockInfo
</span><a href="#local-6989586621682960021"><span class="hs-identifier hs-var">objs_block_info</span></a></span><span> </span><span class="annot"><span class="annottext">Map Module LocatedBlockInfo
-&gt; Map Module LocatedBlockInfo -&gt; Map Module LocatedBlockInfo
forall k a. Ord k =&gt; Map k a -&gt; Map k a -&gt; Map k a
</span><a href="../../containers-0.7-5a8f/src/Data.Map.Internal.html#union"><span class="hs-operator hs-var">`M.union`</span></a></span><span> </span><span class="annot"><span class="annottext">Map Module LocatedBlockInfo
</span><a href="#local-6989586621682960049"><span class="hs-identifier hs-var">archives_block_info</span></a></span><span>
</span><span id="line-480"></span><span>      </span><span id="local-6989586621682960053"><span class="annot"><a href="#local-6989586621682960053"><span class="hs-identifier hs-var hs-var">dep_fun_roots</span></a></span></span><span>   </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Set ExportedFun
</span><a href="#local-6989586621682960024"><span class="hs-identifier hs-var">obj_roots</span></a></span><span> </span><span class="annot"><span class="annottext">Set ExportedFun -&gt; Set ExportedFun -&gt; Set ExportedFun
forall a. Ord a =&gt; Set a -&gt; Set a -&gt; Set a
</span><a href="../../containers-0.7-5a8f/src/Data.Set.Internal.html#union"><span class="hs-operator hs-var">`S.union`</span></a></span><span> </span><span class="annot"><span class="annottext">Set ExportedFun
</span><a href="#local-6989586621682960035"><span class="hs-identifier hs-var">rts_wired_functions</span></a></span><span> </span><span class="annot"><span class="annottext">Set ExportedFun -&gt; Set ExportedFun -&gt; Set ExportedFun
forall a. Ord a =&gt; Set a -&gt; Set a -&gt; Set a
</span><a href="../../containers-0.7-5a8f/src/Data.Set.Internal.html#union"><span class="hs-operator hs-var">`S.union`</span></a></span><span> </span><span class="annot"><span class="annottext">Set ExportedFun
</span><a href="#local-6989586621682960019"><span class="hs-identifier hs-var">extra_roots</span></a></span><span>
</span><span id="line-481"></span><span>
</span><span id="line-482"></span><span>  </span><span class="hs-comment">-- read transitive dependencies</span><span>
</span><span id="line-483"></span><span>  </span><span id="local-6989586621682960054"><span class="annot"><a href="#local-6989586621682960054"><span class="hs-identifier hs-var">new_required_blocks_var</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="hs-identifier hs-type">newIORef</span></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span>
</span><span id="line-484"></span><span>  </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621682960055"><span class="annot"><a href="#local-6989586621682960055"><span class="hs-identifier hs-var hs-var">load_info</span></a></span></span><span> </span><span id="local-6989586621682960056"><span class="annot"><span class="annottext">Module
</span><a href="#local-6989586621682960056"><span class="hs-identifier hs-var">mod</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-485"></span><span>        </span><span class="hs-comment">-- Adapted from the tangled code in GHC.Linker.Loader.getLinkDeps.</span><span>
</span><span id="line-486"></span><span>        </span><span id="local-6989586621682960057"><span class="annot"><a href="#local-6989586621682960057"><span class="hs-identifier hs-var">linkable</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">Module -&gt; HomeUnitGraph -&gt; Maybe HomeModInfo
</span><a href="GHC.Unit.Env.html#lookupHugByModule"><span class="hs-identifier hs-var">lookupHugByModule</span></a></span><span> </span><span class="annot"><span class="annottext">Module
</span><a href="#local-6989586621682960056"><span class="hs-identifier hs-var">mod</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">UnitEnv -&gt; HomeUnitGraph
</span><a href="GHC.Unit.Env.html#ue_home_unit_graph"><span class="hs-identifier hs-var">ue_home_unit_graph</span></a></span><span> </span><span class="annot"><span class="annottext">UnitEnv
</span><a href="#local-6989586621682960010"><span class="hs-identifier hs-var">unit_env</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-487"></span><span>          </span><span class="annot"><span class="annottext">Maybe HomeModInfo
</span><span class="hs-identifier hs-var">Nothing</span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-488"></span><span>                </span><span class="hs-comment">-- It's not in the HPT because we are in one shot mode,</span><span>
</span><span id="line-489"></span><span>                </span><span class="hs-comment">-- so use the Finder to get a ModLocation...</span><span>
</span><span id="line-490"></span><span>              </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">UnitEnv -&gt; Maybe HomeUnit
</span><a href="GHC.Unit.Env.html#ue_homeUnit"><span class="hs-identifier hs-var">ue_homeUnit</span></a></span><span> </span><span class="annot"><span class="annottext">UnitEnv
</span><a href="#local-6989586621682960010"><span class="hs-identifier hs-var">unit_env</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-491"></span><span>                </span><span class="annot"><span class="annottext">Maybe HomeUnit
</span><span class="hs-identifier hs-var">Nothing</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">FilePath -&gt; SDoc -&gt; IO Linkable
forall a. HasCallStack =&gt; FilePath -&gt; SDoc -&gt; a
</span><a href="GHC.Utils.Panic.html#pprPanic"><span class="hs-identifier hs-var">pprPanic</span></a></span><span> </span><span class="annot"><span class="annottext">FilePath
</span><span class="hs-string">&quot;getDeps: No home-unit: &quot;</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Module -&gt; SDoc
forall doc. IsLine doc =&gt; Module -&gt; doc
</span><a href="GHC.Unit.Types.html#pprModule"><span class="hs-identifier hs-var">pprModule</span></a></span><span> </span><span class="annot"><span class="annottext">Module
</span><a href="#local-6989586621682960056"><span class="hs-identifier hs-var">mod</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-492"></span><span>                </span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span id="local-6989586621682960063"><span class="annot"><span class="annottext">HomeUnit
</span><a href="#local-6989586621682960063"><span class="hs-identifier hs-var">home_unit</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-493"></span><span>                    </span><span id="local-6989586621682960064"><span class="annot"><a href="#local-6989586621682960064"><span class="hs-identifier hs-var">mb_stuff</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">FinderCache
-&gt; FinderOpts -&gt; HomeUnit -&gt; ModuleName -&gt; IO FindResult
</span><a href="GHC.Unit.Finder.html#findHomeModule"><span class="hs-identifier hs-var">findHomeModule</span></a></span><span> </span><span class="annot"><span class="annottext">FinderCache
</span><a href="#local-6989586621682960013"><span class="hs-identifier hs-var">finder_cache</span></a></span><span> </span><span class="annot"><span class="annottext">FinderOpts
</span><a href="#local-6989586621682960012"><span class="hs-identifier hs-var">finder_opts</span></a></span><span> </span><span class="annot"><span class="annottext">HomeUnit
</span><a href="#local-6989586621682960063"><span class="hs-identifier hs-var">home_unit</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Module -&gt; ModuleName
forall unit. GenModule unit -&gt; ModuleName
</span><a href="GHC.Unit.Types.html#moduleName"><span class="hs-identifier hs-var">moduleName</span></a></span><span> </span><span class="annot"><span class="annottext">Module
</span><a href="#local-6989586621682960056"><span class="hs-identifier hs-var">mod</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-494"></span><span>                    </span><span class="hs-keyword">case</span><span> </span><span class="annot"><a href="#local-6989586621682960064"><span class="hs-identifier hs-type">mb_stuff</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-495"></span><span>                      </span><span class="annot"><a href="GHC.Unit.Finder.Types.html#Found"><span class="hs-identifier hs-type">Found</span></a></span><span> </span><span id="local-6989586621682960067"><span class="annot"><span class="annottext">ModLocation
</span><a href="#local-6989586621682960067"><span class="hs-identifier hs-var">loc</span></a></span></span><span> </span><span id="local-6989586621682960068"><span class="annot"><span class="annottext">Module
</span><a href="#local-6989586621682960068"><span class="hs-identifier hs-var">mod</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">ModLocation -&gt; Module -&gt; IO Linkable
</span><a href="#local-6989586621682960069"><span class="hs-identifier hs-var">found</span></a></span><span> </span><span class="annot"><span class="annottext">ModLocation
</span><a href="#local-6989586621682960067"><span class="hs-identifier hs-var">loc</span></a></span><span> </span><span class="annot"><span class="annottext">Module
</span><a href="#local-6989586621682960068"><span class="hs-identifier hs-var">mod</span></a></span><span>
</span><span id="line-496"></span><span>                      </span><span class="annot"><span class="annottext">FindResult
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">FilePath -&gt; SDoc -&gt; IO Linkable
forall a. HasCallStack =&gt; FilePath -&gt; SDoc -&gt; a
</span><a href="GHC.Utils.Panic.html#pprPanic"><span class="hs-identifier hs-var">pprPanic</span></a></span><span> </span><span class="annot"><span class="annottext">FilePath
</span><span class="hs-string">&quot;getDeps: Couldn't find home-module: &quot;</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Module -&gt; SDoc
forall doc. IsLine doc =&gt; Module -&gt; doc
</span><a href="GHC.Unit.Types.html#pprModule"><span class="hs-identifier hs-var">pprModule</span></a></span><span> </span><span class="annot"><span class="annottext">Module
</span><a href="#local-6989586621682960056"><span class="hs-identifier hs-var">mod</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-497"></span><span>                </span><span class="hs-keyword">where</span><span>
</span><span id="line-498"></span><span>                    </span><span id="local-6989586621682960069"><span class="annot"><span class="annottext">found :: ModLocation -&gt; Module -&gt; IO Linkable
</span><a href="#local-6989586621682960069"><span class="hs-identifier hs-var hs-var">found</span></a></span></span><span> </span><span id="local-6989586621682960075"><span class="annot"><span class="annottext">ModLocation
</span><a href="#local-6989586621682960075"><span class="hs-identifier hs-var">loc</span></a></span></span><span> </span><span id="local-6989586621682960076"><span class="annot"><span class="annottext">Module
</span><a href="#local-6989586621682960076"><span class="hs-identifier hs-var">mod</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span>
</span><span id="line-499"></span><span>                      </span><span id="local-6989586621682960077"><span class="annot"><a href="#local-6989586621682960077"><span class="hs-identifier hs-var">mb_lnk</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Module -&gt; ModLocation -&gt; IO (Maybe Linkable)
</span><a href="GHC.Unit.Finder.html#findObjectLinkableMaybe"><span class="hs-identifier hs-var">findObjectLinkableMaybe</span></a></span><span> </span><span class="annot"><span class="annottext">Module
</span><a href="#local-6989586621682960076"><span class="hs-identifier hs-var">mod</span></a></span><span> </span><span class="annot"><span class="annottext">ModLocation
</span><a href="#local-6989586621682960075"><span class="hs-identifier hs-var">loc</span></a></span><span> </span><span class="hs-special">;</span><span>
</span><span id="line-500"></span><span>                      </span><span class="hs-keyword">case</span><span> </span><span class="annot"><a href="#local-6989586621682960077"><span class="hs-identifier hs-type">mb_lnk</span></a></span><span> </span><span class="hs-keyword">of</span><span> </span><span class="hs-special">{</span><span>
</span><span id="line-501"></span><span>                          </span><span class="annot"><span class="annottext">Maybe Linkable
</span><span class="hs-identifier hs-var">Nothing</span></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">FilePath -&gt; SDoc -&gt; IO Linkable
forall a. HasCallStack =&gt; FilePath -&gt; SDoc -&gt; a
</span><a href="GHC.Utils.Panic.html#pprPanic"><span class="hs-identifier hs-var">pprPanic</span></a></span><span> </span><span class="annot"><span class="annottext">FilePath
</span><span class="hs-string">&quot;getDeps: Couldn't find linkable for module: &quot;</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Module -&gt; SDoc
forall doc. IsLine doc =&gt; Module -&gt; doc
</span><a href="GHC.Unit.Types.html#pprModule"><span class="hs-identifier hs-var">pprModule</span></a></span><span> </span><span class="annot"><span class="annottext">Module
</span><a href="#local-6989586621682960076"><span class="hs-identifier hs-var">mod</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">;</span><span>
</span><span id="line-502"></span><span>                          </span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span id="local-6989586621682960078"><span class="annot"><span class="annottext">Linkable
</span><a href="#local-6989586621682960078"><span class="hs-identifier hs-var">lnk</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Linkable -&gt; IO Linkable
forall a. a -&gt; IO a
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">pure</span></span><span> </span><span class="annot"><span class="annottext">Linkable
</span><a href="#local-6989586621682960078"><span class="hs-identifier hs-var">lnk</span></a></span><span>
</span><span id="line-503"></span><span>                      </span><span class="hs-special">}</span><span class="hs-special">}</span><span>
</span><span id="line-504"></span><span>
</span><span id="line-505"></span><span>          </span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span id="local-6989586621682960079"><span class="annot"><span class="annottext">HomeModInfo
</span><a href="#local-6989586621682960079"><span class="hs-identifier hs-var">mod_info</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">HomeModInfo -&gt; Maybe Linkable
</span><a href="GHC.Unit.Home.ModInfo.html#homeModInfoObject"><span class="hs-identifier hs-var">homeModInfoObject</span></a></span><span> </span><span class="annot"><span class="annottext">HomeModInfo
</span><a href="#local-6989586621682960079"><span class="hs-identifier hs-var">mod_info</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-506"></span><span>            </span><span class="annot"><span class="annottext">Maybe Linkable
</span><span class="hs-identifier hs-var">Nothing</span></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">FilePath -&gt; SDoc -&gt; IO Linkable
forall a. HasCallStack =&gt; FilePath -&gt; SDoc -&gt; a
</span><a href="GHC.Utils.Panic.html#pprPanic"><span class="hs-identifier hs-var">pprPanic</span></a></span><span> </span><span class="annot"><span class="annottext">FilePath
</span><span class="hs-string">&quot;getDeps: Couldn't find object file for home-module: &quot;</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Module -&gt; SDoc
forall doc. IsLine doc =&gt; Module -&gt; doc
</span><a href="GHC.Unit.Types.html#pprModule"><span class="hs-identifier hs-var">pprModule</span></a></span><span> </span><span class="annot"><span class="annottext">Module
</span><a href="#local-6989586621682960056"><span class="hs-identifier hs-var">mod</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-507"></span><span>            </span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span id="local-6989586621682960081"><span class="annot"><span class="annottext">Linkable
</span><a href="#local-6989586621682960081"><span class="hs-identifier hs-var">lnk</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Linkable -&gt; IO Linkable
forall a. a -&gt; IO a
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">pure</span></span><span> </span><span class="annot"><span class="annottext">Linkable
</span><a href="#local-6989586621682960081"><span class="hs-identifier hs-var">lnk</span></a></span><span>
</span><span id="line-508"></span><span>
</span><span id="line-509"></span><span>        </span><span class="hs-comment">-- load block infos from the object files</span><span>
</span><span id="line-510"></span><span>        </span><span class="hs-special">(</span><span id="local-6989586621682960082"><span class="annot"><a href="#local-6989586621682960082"><span class="hs-identifier hs-var">bis</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682960083"><span class="annot"><a href="#local-6989586621682960083"><span class="hs-identifier hs-var">req_b</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><a href="GHC.StgToJS.Linker.Linker.html#loadObjBlockInfo"><span class="hs-identifier hs-type">loadObjBlockInfo</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Linker.Types.html#linkableObjs"><span class="hs-identifier hs-type">linkableObjs</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682960057"><span class="hs-identifier hs-type">linkable</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-511"></span><span>        </span><span class="hs-comment">-- Store new required blocks in IORef</span><span>
</span><span id="line-512"></span><span>        </span><span class="annot"><span class="hs-identifier hs-type">modifyIORef</span></span><span> </span><span class="annot"><a href="#local-6989586621682960054"><span class="hs-identifier hs-type">new_required_blocks_var</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-operator hs-type">(++)</span></span><span> </span><span class="annot"><a href="#local-6989586621682960083"><span class="hs-identifier hs-type">req_b</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-513"></span><span>        </span><span class="hs-keyword">case</span><span> </span><span class="annot"><a href="../../containers-0.7-5a8f/src/Data.Map.Internal.html#lookup"><span class="hs-identifier hs-type">M.lookup</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682960056"><span class="hs-identifier hs-type">mod</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682960082"><span class="hs-identifier hs-type">bis</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-514"></span><span>          </span><span class="annot"><span class="annottext">Maybe LocatedBlockInfo
</span><span class="hs-identifier hs-var">Nothing</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">FilePath -&gt; SDoc -&gt; IO LocatedBlockInfo
forall a. HasCallStack =&gt; FilePath -&gt; SDoc -&gt; a
</span><a href="GHC.Utils.Panic.html#pprPanic"><span class="hs-identifier hs-var">pprPanic</span></a></span><span> </span><span class="annot"><span class="annottext">FilePath
</span><span class="hs-string">&quot;getDeps: Didn't load any block info for home-module: &quot;</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Module -&gt; SDoc
forall doc. IsLine doc =&gt; Module -&gt; doc
</span><a href="GHC.Unit.Types.html#pprModule"><span class="hs-identifier hs-var">pprModule</span></a></span><span> </span><span class="annot"><span class="annottext">Module
</span><a href="#local-6989586621682960056"><span class="hs-identifier hs-var">mod</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-515"></span><span>          </span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span id="local-6989586621682960086"><span class="annot"><span class="annottext">LocatedBlockInfo
</span><a href="#local-6989586621682960086"><span class="hs-identifier hs-var">bi</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">LocatedBlockInfo -&gt; IO LocatedBlockInfo
forall a. a -&gt; IO a
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">pure</span></span><span> </span><span class="annot"><span class="annottext">LocatedBlockInfo
</span><a href="#local-6989586621682960086"><span class="hs-identifier hs-var">bi</span></a></span><span>
</span><span id="line-516"></span><span>
</span><span id="line-517"></span><span>  </span><span class="hs-comment">-- required blocks have no dependencies, so don't have to use them as roots in</span><span>
</span><span id="line-518"></span><span>  </span><span class="hs-comment">-- the traversal</span><span>
</span><span id="line-519"></span><span>  </span><span class="hs-special">(</span><span id="local-6989586621682960087"><span class="annot"><a href="#local-6989586621682960087"><span class="hs-identifier hs-var">updated_block_info</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682960088"><span class="annot"><a href="#local-6989586621682960088"><span class="hs-identifier hs-var">transitive_deps</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><a href="GHC.StgToJS.Linker.Linker.html#getDeps"><span class="hs-identifier hs-type">getDeps</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682960052"><span class="hs-identifier hs-type">block_info</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682960055"><span class="hs-identifier hs-type">load_info</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682960053"><span class="hs-identifier hs-type">dep_fun_roots</span></a></span><span> </span><span class="annot"><span class="hs-identifier hs-type">mempty</span></span><span>
</span><span id="line-520"></span><span>
</span><span id="line-521"></span><span>  </span><span id="local-6989586621682960090"><span class="annot"><a href="#local-6989586621682960090"><span class="hs-identifier hs-var">new_required_blocks</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="hs-identifier hs-type">readIORef</span></span><span> </span><span class="annot"><a href="#local-6989586621682960054"><span class="hs-identifier hs-type">new_required_blocks_var</span></a></span><span>
</span><span id="line-522"></span><span>  </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621682960092"><span class="annot"><a href="#local-6989586621682960092"><span class="hs-identifier hs-var hs-var">required_blocks</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[BlockRef] -&gt; Set BlockRef
forall a. Ord a =&gt; [a] -&gt; Set a
</span><a href="../../containers-0.7-5a8f/src/Data.Set.Internal.html#fromList"><span class="hs-identifier hs-var">S.fromList</span></a></span><span> </span><span class="annot"><span class="annottext">([BlockRef] -&gt; Set BlockRef) -&gt; [BlockRef] -&gt; Set BlockRef
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">[[BlockRef]] -&gt; [BlockRef]
forall a. Monoid a =&gt; [a] -&gt; a
</span><span class="hs-identifier hs-var">mconcat</span></span><span>
</span><span id="line-523"></span><span>        </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">[BlockRef]
</span><a href="#local-6989586621682960050"><span class="hs-identifier hs-var">archives_required_blocks</span></a></span><span>
</span><span id="line-524"></span><span>        </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">[BlockRef]
</span><a href="#local-6989586621682960022"><span class="hs-identifier hs-var">objs_required_blocks</span></a></span><span>
</span><span id="line-525"></span><span>        </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">[BlockRef]
</span><a href="#local-6989586621682960090"><span class="hs-identifier hs-var">new_required_blocks</span></a></span><span>
</span><span id="line-526"></span><span>        </span><span class="hs-special">]</span><span>
</span><span id="line-527"></span><span>
</span><span id="line-528"></span><span>  </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621682960093"><span class="annot"><a href="#local-6989586621682960093"><span class="hs-identifier hs-var hs-var">all_deps</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Set BlockRef -&gt; Set BlockRef -&gt; Set BlockRef
forall a. Ord a =&gt; Set a -&gt; Set a -&gt; Set a
</span><a href="../../containers-0.7-5a8f/src/Data.Set.Internal.html#union"><span class="hs-identifier hs-var">S.union</span></a></span><span> </span><span class="annot"><span class="annottext">Set BlockRef
</span><a href="#local-6989586621682960088"><span class="hs-identifier hs-var">transitive_deps</span></a></span><span> </span><span class="annot"><span class="annottext">Set BlockRef
</span><a href="#local-6989586621682960092"><span class="hs-identifier hs-var">required_blocks</span></a></span><span>
</span><span id="line-529"></span><span>
</span><span id="line-530"></span><span>  </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621682960094"><span class="annot"><a href="#local-6989586621682960094"><span class="hs-identifier hs-var hs-var">plan</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="GHC.StgToJS.Linker.Types.html#LinkPlan"><span class="hs-identifier hs-type">LinkPlan</span></a></span><span>
</span><span id="line-531"></span><span>        </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">lkp_block_info :: Map Module LocatedBlockInfo
</span><a href="GHC.StgToJS.Linker.Types.html#lkp_block_info"><span class="hs-identifier hs-var">lkp_block_info</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Map Module LocatedBlockInfo
</span><a href="#local-6989586621682960087"><span class="hs-identifier hs-var">updated_block_info</span></a></span><span>
</span><span id="line-532"></span><span>        </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">lkp_dep_blocks :: Set BlockRef
</span><a href="GHC.StgToJS.Linker.Types.html#lkp_dep_blocks"><span class="hs-identifier hs-var">lkp_dep_blocks</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Set BlockRef
</span><a href="#local-6989586621682960093"><span class="hs-identifier hs-var">all_deps</span></a></span><span>
</span><span id="line-533"></span><span>        </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">lkp_archives :: Set FilePath
</span><a href="GHC.StgToJS.Linker.Types.html#lkp_archives"><span class="hs-identifier hs-var">lkp_archives</span></a></span><span>   </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[FilePath] -&gt; Set FilePath
forall a. Ord a =&gt; [a] -&gt; Set a
</span><a href="../../containers-0.7-5a8f/src/Data.Set.Internal.html#fromList"><span class="hs-identifier hs-var">S.fromList</span></a></span><span> </span><span class="annot"><span class="annottext">[FilePath]
</span><a href="#local-6989586621682960047"><span class="hs-identifier hs-var">dep_archives</span></a></span><span>
</span><span id="line-534"></span><span>        </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">lkp_objs_js :: Set FilePath
</span><a href="GHC.StgToJS.Linker.Types.html#lkp_objs_js"><span class="hs-identifier hs-var">lkp_objs_js</span></a></span><span>    </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[FilePath] -&gt; Set FilePath
forall a. Ord a =&gt; [a] -&gt; Set a
</span><a href="../../containers-0.7-5a8f/src/Data.Set.Internal.html#fromList"><span class="hs-identifier hs-var">S.fromList</span></a></span><span> </span><span class="annot"><span class="annottext">[FilePath]
</span><a href="#local-6989586621682960017"><span class="hs-identifier hs-var">js_objs</span></a></span><span>
</span><span id="line-535"></span><span>        </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">lkp_objs_cc :: Set FilePath
</span><a href="GHC.StgToJS.Linker.Types.html#lkp_objs_cc"><span class="hs-identifier hs-var">lkp_objs_cc</span></a></span><span>    </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[FilePath] -&gt; Set FilePath
forall a. Ord a =&gt; [a] -&gt; Set a
</span><a href="../../containers-0.7-5a8f/src/Data.Set.Internal.html#fromList"><span class="hs-identifier hs-var">S.fromList</span></a></span><span> </span><span class="annot"><span class="annottext">[FilePath]
</span><a href="#local-6989586621682960018"><span class="hs-identifier hs-var">cc_objs</span></a></span><span>
</span><span id="line-536"></span><span>        </span><span class="hs-special">}</span><span>
</span><span id="line-537"></span><span>
</span><span id="line-538"></span><span>  </span><span class="annot"><span class="hs-identifier hs-type">return</span></span><span> </span><span class="annot"><a href="#local-6989586621682960094"><span class="hs-identifier hs-type">plan</span></a></span><span>
</span><span id="line-539"></span><span>
</span><span id="line-540"></span><span>
</span><span id="line-541"></span><span class="annot"><span class="hs-comment">-- | Compiled module</span></span><span>
</span><span id="line-542"></span><span class="hs-keyword">data</span><span> </span><span id="ModuleCode"><span class="annot"><a href="GHC.StgToJS.Linker.Linker.html#ModuleCode"><span class="hs-identifier hs-var">ModuleCode</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="ModuleCode"><span class="annot"><a href="GHC.StgToJS.Linker.Linker.html#ModuleCode"><span class="hs-identifier hs-var">ModuleCode</span></a></span></span><span>
</span><span id="line-543"></span><span>  </span><span class="hs-special">{</span><span> </span><span id="mc_module"><span class="annot"><span class="annottext">ModuleCode -&gt; Module
</span><a href="GHC.StgToJS.Linker.Linker.html#mc_module"><span class="hs-identifier hs-var hs-var">mc_module</span></a></span></span><span>   </span><span class="hs-glyph">::</span><span> </span><span class="hs-glyph">!</span><span class="annot"><a href="GHC.Unit.Types.html#Module"><span class="hs-identifier hs-type">Module</span></a></span><span>
</span><span id="line-544"></span><span>  </span><span class="hs-special">,</span><span> </span><span id="mc_js_code"><span class="annot"><span class="annottext">ModuleCode -&gt; JStat
</span><a href="GHC.StgToJS.Linker.Linker.html#mc_js_code"><span class="hs-identifier hs-var hs-var">mc_js_code</span></a></span></span><span>  </span><span class="hs-glyph">::</span><span> </span><span class="hs-glyph">!</span><span class="annot"><a href="GHC.JS.Syntax.html#JStat"><span class="hs-identifier hs-type">JS.JStat</span></a></span><span>
</span><span id="line-545"></span><span>  </span><span class="hs-special">,</span><span> </span><span id="mc_exports"><span class="annot"><span class="annottext">ModuleCode -&gt; ByteString
</span><a href="GHC.StgToJS.Linker.Linker.html#mc_exports"><span class="hs-identifier hs-var hs-var">mc_exports</span></a></span></span><span>  </span><span class="hs-glyph">::</span><span> </span><span class="hs-glyph">!</span><span class="annot"><a href="../../bytestring-0.12.2.0-7dd0/src/Data.ByteString.Internal.Type.html#ByteString"><span class="hs-identifier hs-type">B.ByteString</span></a></span><span>        </span><span class="annot"><span class="hs-comment">-- ^ rendered exports</span></span><span>
</span><span id="line-546"></span><span>  </span><span class="hs-special">,</span><span> </span><span id="mc_closures"><span class="annot"><span class="annottext">ModuleCode -&gt; [ClosureInfo]
</span><a href="GHC.StgToJS.Linker.Linker.html#mc_closures"><span class="hs-identifier hs-var hs-var">mc_closures</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-glyph">!</span><span class="hs-special">[</span><span class="annot"><a href="GHC.StgToJS.Types.html#ClosureInfo"><span class="hs-identifier hs-type">ClosureInfo</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-547"></span><span>  </span><span class="hs-special">,</span><span> </span><span id="mc_statics"><span class="annot"><span class="annottext">ModuleCode -&gt; [StaticInfo]
</span><a href="GHC.StgToJS.Linker.Linker.html#mc_statics"><span class="hs-identifier hs-var hs-var">mc_statics</span></a></span></span><span>  </span><span class="hs-glyph">::</span><span> </span><span class="hs-glyph">!</span><span class="hs-special">[</span><span class="annot"><a href="GHC.StgToJS.Types.html#StaticInfo"><span class="hs-identifier hs-type">StaticInfo</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-548"></span><span>  </span><span class="hs-special">,</span><span> </span><span id="mc_frefs"><span class="annot"><span class="annottext">ModuleCode -&gt; [ForeignJSRef]
</span><a href="GHC.StgToJS.Linker.Linker.html#mc_frefs"><span class="hs-identifier hs-var hs-var">mc_frefs</span></a></span></span><span>    </span><span class="hs-glyph">::</span><span> </span><span class="hs-glyph">!</span><span class="hs-special">[</span><span class="annot"><a href="GHC.StgToJS.Types.html#ForeignJSRef"><span class="hs-identifier hs-type">ForeignJSRef</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-549"></span><span>  </span><span class="hs-special">}</span><span>
</span><span id="line-550"></span><span>
</span><span id="line-551"></span><span class="hs-comment">-- | ModuleCode after link with other modules.</span><span>
</span><span id="line-552"></span><span class="hs-comment">--</span><span>
</span><span id="line-553"></span><span class="hs-comment">-- It contains less information than ModuleCode because they have been commoned</span><span>
</span><span id="line-554"></span><span class="hs-comment">-- up into global &quot;metadata&quot; for the whole link.</span><span>
</span><span id="line-555"></span><span class="hs-keyword">data</span><span> </span><span id="CompactedModuleCode"><span class="annot"><a href="GHC.StgToJS.Linker.Linker.html#CompactedModuleCode"><span class="hs-identifier hs-var">CompactedModuleCode</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="CompactedModuleCode"><span class="annot"><a href="GHC.StgToJS.Linker.Linker.html#CompactedModuleCode"><span class="hs-identifier hs-var">CompactedModuleCode</span></a></span></span><span>
</span><span id="line-556"></span><span>  </span><span class="hs-special">{</span><span> </span><span id="cmc_module"><span class="annot"><span class="annottext">CompactedModuleCode -&gt; Module
</span><a href="GHC.StgToJS.Linker.Linker.html#cmc_module"><span class="hs-identifier hs-var hs-var">cmc_module</span></a></span></span><span>  </span><span class="hs-glyph">::</span><span> </span><span class="hs-glyph">!</span><span class="annot"><a href="GHC.Unit.Types.html#Module"><span class="hs-identifier hs-type">Module</span></a></span><span>
</span><span id="line-557"></span><span>  </span><span class="hs-special">,</span><span> </span><span id="cmc_js_code"><span class="annot"><span class="annottext">CompactedModuleCode -&gt; JStat
</span><a href="GHC.StgToJS.Linker.Linker.html#cmc_js_code"><span class="hs-identifier hs-var hs-var">cmc_js_code</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-glyph">!</span><span class="annot"><a href="GHC.JS.Syntax.html#JStat"><span class="hs-identifier hs-type">JS.JStat</span></a></span><span>
</span><span id="line-558"></span><span>  </span><span class="hs-special">,</span><span> </span><span id="cmc_exports"><span class="annot"><span class="annottext">CompactedModuleCode -&gt; ByteString
</span><a href="GHC.StgToJS.Linker.Linker.html#cmc_exports"><span class="hs-identifier hs-var hs-var">cmc_exports</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-glyph">!</span><span class="annot"><a href="../../bytestring-0.12.2.0-7dd0/src/Data.ByteString.Internal.Type.html#ByteString"><span class="hs-identifier hs-type">B.ByteString</span></a></span><span>        </span><span class="annot"><span class="hs-comment">-- ^ rendered exports</span></span><span>
</span><span id="line-559"></span><span>  </span><span class="hs-special">}</span><span>
</span><span id="line-560"></span><span>
</span><span id="line-561"></span><span class="annot"><span class="hs-comment">-- | Output JS statements and return the output size in bytes.</span></span><span>
</span><span id="line-562"></span><span class="annot"><a href="GHC.StgToJS.Linker.Linker.html#hPutJS"><span class="hs-identifier hs-type">hPutJS</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Bool</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Handle</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.JS.Syntax.html#JStat"><span class="hs-identifier hs-type">JS.JStat</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Integer</span></span><span>
</span><span id="line-563"></span><span id="hPutJS"><span class="annot"><span class="annottext">hPutJS :: Bool -&gt; Handle -&gt; JStat -&gt; IO Integer
</span><a href="GHC.StgToJS.Linker.Linker.html#hPutJS"><span class="hs-identifier hs-var hs-var">hPutJS</span></a></span></span><span> </span><span id="local-6989586621682960106"><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621682960106"><span class="hs-identifier hs-var">render_pretty</span></a></span></span><span> </span><span id="local-6989586621682960107"><span class="annot"><span class="annottext">Handle
</span><a href="#local-6989586621682960107"><span class="hs-identifier hs-var">h</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-glyph">\</span><span class="hs-glyph">case</span><span>
</span><span id="line-564"></span><span>  </span><span class="annot"><a href="GHC.JS.Syntax.html#BlockStat"><span class="hs-identifier hs-type">JS.BlockStat</span></a></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Integer -&gt; IO Integer
forall a. a -&gt; IO a
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">pure</span></span><span> </span><span class="annot"><span class="annottext">Integer
</span><span class="hs-number">0</span></span><span>
</span><span id="line-565"></span><span>  </span><span id="local-6989586621682960109"><span class="annot"><span class="annottext">JStat
</span><a href="#local-6989586621682960109"><span class="hs-identifier hs-var">x</span></a></span></span><span>                </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-566"></span><span>    </span><span id="local-6989586621682960110"><span class="annot"><a href="#local-6989586621682960110"><span class="hs-identifier hs-var">before</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Handle -&gt; IO Integer
</span><span class="hs-identifier hs-var">hTell</span></span><span> </span><span class="annot"><span class="annottext">Handle
</span><a href="#local-6989586621682960107"><span class="hs-identifier hs-var">h</span></a></span><span>
</span><span id="line-567"></span><span>    </span><span class="hs-keyword">if</span><span> </span><span class="annot"><a href="#local-6989586621682960106"><span class="hs-identifier hs-type">render_pretty</span></a></span><span>
</span><span id="line-568"></span><span>      </span><span class="hs-keyword">then</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-569"></span><span>        </span><span class="annot"><a href="GHC.Utils.Outputable.html#printSDoc"><span class="hs-identifier hs-type">printSDoc</span></a></span><span> </span><span class="annot"><a href="GHC.StgToJS.Linker.Linker.html#defaultJsContext"><span class="hs-identifier hs-type">defaultJsContext</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Utils.Ppr.html#PageMode"><span class="hs-identifier hs-type">Ppr.PageMode</span></a></span><span> </span><span class="annot"><span class="hs-identifier hs-type">True</span></span><span class="hs-special">)</span><span> </span><span class="annot"><a href="#local-6989586621682960107"><span class="hs-identifier hs-type">h</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.StgToJS.Linker.Opt.html#pretty"><span class="hs-identifier hs-type">pretty</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682960106"><span class="hs-identifier hs-type">render_pretty</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682960109"><span class="hs-identifier hs-type">x</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-570"></span><span>      </span><span class="hs-keyword">else</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-571"></span><span>        </span><span id="local-6989586621682960115"><span class="annot"><a href="#local-6989586621682960115"><span class="hs-identifier hs-var">bh</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><a href="GHC.Utils.BufHandle.html#newBufHandle"><span class="hs-identifier hs-type">newBufHandle</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682960107"><span class="hs-identifier hs-type">h</span></a></span><span>
</span><span id="line-572"></span><span>        </span><span class="annot"><a href="GHC.Utils.Outputable.html#bPutHDoc"><span class="hs-identifier hs-type">bPutHDoc</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682960115"><span class="hs-identifier hs-type">bh</span></a></span><span> </span><span class="annot"><a href="GHC.StgToJS.Linker.Linker.html#defaultJsContext"><span class="hs-identifier hs-type">defaultJsContext</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Utils.Outputable.html#line"><span class="hs-identifier hs-type">line</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="annot"><a href="GHC.StgToJS.Linker.Opt.html#pretty"><span class="hs-identifier hs-type">pretty</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682960106"><span class="hs-identifier hs-type">render_pretty</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682960109"><span class="hs-identifier hs-type">x</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-573"></span><span>        </span><span class="annot"><a href="GHC.Utils.BufHandle.html#bFlush"><span class="hs-identifier hs-type">bFlush</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682960115"><span class="hs-identifier hs-type">bh</span></a></span><span>
</span><span id="line-574"></span><span>    </span><span class="hs-comment">-- Append an empty line to correctly end the file in a newline</span><span>
</span><span id="line-575"></span><span>    </span><span class="annot"><span class="hs-identifier hs-type">hPutChar</span></span><span> </span><span class="annot"><a href="#local-6989586621682960107"><span class="hs-identifier hs-type">h</span></a></span><span> </span><span class="annot"><span class="hs-char">'\n'</span></span><span>
</span><span id="line-576"></span><span>    </span><span id="local-6989586621682960120"><span class="annot"><a href="#local-6989586621682960120"><span class="hs-identifier hs-var">after</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="hs-identifier hs-type">hTell</span></span><span> </span><span class="annot"><a href="#local-6989586621682960107"><span class="hs-identifier hs-type">h</span></a></span><span>
</span><span id="line-577"></span><span>    </span><span class="annot"><span class="hs-identifier hs-type">pure</span></span><span> </span><span class="annot"><span class="hs-operator hs-type">$!</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621682960120"><span class="hs-identifier hs-type">after</span></a></span><span> </span><span class="annot"><span class="hs-glyph hs-type">-</span></span><span> </span><span class="annot"><a href="#local-6989586621682960110"><span class="hs-identifier hs-type">before</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-578"></span><span>
</span><span id="line-579"></span><span class="annot"><span class="hs-comment">-- | Link modules and pretty-print them into the given Handle</span></span><span>
</span><span id="line-580"></span><span class="annot"><a href="GHC.StgToJS.Linker.Linker.html#renderModules"><span class="hs-identifier hs-type">renderModules</span></a></span><span>
</span><span id="line-581"></span><span>  </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Handle</span></span><span>
</span><span id="line-582"></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Bool</span></span><span>         </span><span class="annot"><span class="hs-comment">-- ^ should we render readable JS for debugging?</span></span><span>
</span><span id="line-583"></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="GHC.StgToJS.Linker.Linker.html#ModuleCode"><span class="hs-identifier hs-type">ModuleCode</span></a></span><span class="hs-special">]</span><span> </span><span class="annot"><span class="hs-comment">-- ^ linked code per module</span></span><span>
</span><span id="line-584"></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="annot"><a href="GHC.StgToJS.Linker.Linker.html#LinkerStats"><span class="hs-identifier hs-type">LinkerStats</span></a></span><span>
</span><span id="line-585"></span><span id="renderModules"><span class="annot"><span class="annottext">renderModules :: Handle -&gt; Bool -&gt; [ModuleCode] -&gt; IO LinkerStats
</span><a href="GHC.StgToJS.Linker.Linker.html#renderModules"><span class="hs-identifier hs-var hs-var">renderModules</span></a></span></span><span> </span><span id="local-6989586621682960122"><span class="annot"><span class="annottext">Handle
</span><a href="#local-6989586621682960122"><span class="hs-identifier hs-var">h</span></a></span></span><span> </span><span id="local-6989586621682960123"><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621682960123"><span class="hs-identifier hs-var">render_pretty</span></a></span></span><span> </span><span id="local-6989586621682960124"><span class="annot"><span class="annottext">[ModuleCode]
</span><a href="#local-6989586621682960124"><span class="hs-identifier hs-var">mods</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-586"></span><span>
</span><span id="line-587"></span><span>  </span><span class="hs-comment">-- link modules</span><span>
</span><span id="line-588"></span><span>  </span><span class="hs-keyword">let</span><span> </span><span class="hs-special">(</span><span id="local-6989586621682960125"><span class="annot"><span class="annottext">[CompactedModuleCode]
</span><a href="#local-6989586621682960125"><span class="hs-identifier hs-var hs-var">compacted_mods</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682960126"><span class="annot"><span class="annottext">JStat
</span><a href="#local-6989586621682960126"><span class="hs-identifier hs-var hs-var">meta</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[ModuleCode] -&gt; ([CompactedModuleCode], JStat)
</span><a href="GHC.StgToJS.Linker.Linker.html#linkModules"><span class="hs-identifier hs-var">linkModules</span></a></span><span> </span><span class="annot"><span class="annottext">[ModuleCode]
</span><a href="#local-6989586621682960124"><span class="hs-identifier hs-var">mods</span></a></span><span>
</span><span id="line-589"></span><span>
</span><span id="line-590"></span><span>  </span><span class="hs-keyword">let</span><span>
</span><span id="line-591"></span><span>    </span><span id="local-6989586621682960128"><span class="annot"><span class="annottext">putJS :: JStat -&gt; IO Integer
</span><a href="#local-6989586621682960128"><span class="hs-identifier hs-var hs-var hs-var">putJS</span></a></span></span><span>   </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Handle -&gt; JStat -&gt; IO Integer
</span><a href="GHC.StgToJS.Linker.Linker.html#hPutJS"><span class="hs-identifier hs-var">hPutJS</span></a></span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621682960123"><span class="hs-identifier hs-var">render_pretty</span></a></span><span> </span><span class="annot"><span class="annottext">Handle
</span><a href="#local-6989586621682960122"><span class="hs-identifier hs-var">h</span></a></span><span>
</span><span id="line-592"></span><span>
</span><span id="line-593"></span><span>  </span><span class="hs-comment">---------------------------------------------------------</span><span>
</span><span id="line-594"></span><span>  </span><span class="hs-comment">-- Pretty-print JavaScript code for all the dependencies.</span><span>
</span><span id="line-595"></span><span>  </span><span class="hs-comment">--</span><span>
</span><span id="line-596"></span><span>  </span><span class="hs-comment">-- We have to pretty-print at link time because we want to be able to perform</span><span>
</span><span id="line-597"></span><span>  </span><span class="hs-comment">-- global link-time optimisations (e.g. renamings) on the whole generated JS</span><span>
</span><span id="line-598"></span><span>  </span><span class="hs-comment">-- file.</span><span>
</span><span id="line-599"></span><span>
</span><span id="line-600"></span><span>  </span><span class="hs-comment">-- modules themselves</span><span>
</span><span id="line-601"></span><span>  </span><span id="local-6989586621682960129"><span class="annot"><a href="#local-6989586621682960129"><span class="hs-identifier hs-var">mod_sizes</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">[CompactedModuleCode]
-&gt; (CompactedModuleCode -&gt; IO (Module, Word64))
-&gt; IO [(Module, Word64)]
forall (t :: * -&gt; *) (m :: * -&gt; *) a b.
(Traversable t, Monad m) =&gt;
t a -&gt; (a -&gt; m b) -&gt; m (t b)
</span><span class="hs-identifier hs-var">forM</span></span><span> </span><span class="annot"><span class="annottext">[CompactedModuleCode]
</span><a href="#local-6989586621682960125"><span class="hs-identifier hs-var">compacted_mods</span></a></span><span> </span><span class="annot"><span class="annottext">((CompactedModuleCode -&gt; IO (Module, Word64))
 -&gt; IO [(Module, Word64)])
-&gt; (CompactedModuleCode -&gt; IO (Module, Word64))
-&gt; IO [(Module, Word64)]
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-glyph">\</span><span id="local-6989586621682960131"><span class="annot"><span class="annottext">CompactedModuleCode
</span><a href="#local-6989586621682960131"><span class="hs-identifier hs-var">m</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-602"></span><span>
</span><span id="line-603"></span><span>    </span><span class="hs-glyph">!</span><span id="local-6989586621682960132"><span class="annot"><a href="#local-6989586621682960132"><span class="hs-identifier hs-var">mod_size</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Integer -&gt; Word64
forall a b. (Integral a, Num b) =&gt; a -&gt; b
</span><span class="hs-identifier hs-var">fromIntegral</span></span><span> </span><span class="annot"><span class="annottext">(Integer -&gt; Word64) -&gt; IO Integer -&gt; IO Word64
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">JStat -&gt; IO Integer
</span><a href="#local-6989586621682960128"><span class="hs-identifier hs-var">putJS</span></a></span><span> </span><span class="annot"><span class="annottext">(JStat -&gt; IO Integer) -&gt; JStat -&gt; IO Integer
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">CompactedModuleCode -&gt; JStat
</span><a href="GHC.StgToJS.Linker.Linker.html#cmc_js_code"><span class="hs-identifier hs-var">cmc_js_code</span></a></span><span> </span><span class="annot"><span class="annottext">CompactedModuleCode
</span><a href="#local-6989586621682960131"><span class="hs-identifier hs-var">m</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-604"></span><span>    </span><span class="hs-keyword">let</span><span> </span><span class="hs-glyph">!</span><span id="local-6989586621682960133"><span class="annot"><a href="#local-6989586621682960133"><span class="hs-identifier hs-var hs-var">mod_mod</span></a></span></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">CompactedModuleCode -&gt; Module
</span><a href="GHC.StgToJS.Linker.Linker.html#cmc_module"><span class="hs-identifier hs-var">cmc_module</span></a></span><span> </span><span class="annot"><span class="annottext">CompactedModuleCode
</span><a href="#local-6989586621682960131"><span class="hs-identifier hs-var">m</span></a></span><span>
</span><span id="line-605"></span><span>    </span><span class="annot"><span class="hs-identifier hs-type">pure</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621682960133"><span class="hs-identifier hs-type">mod_mod</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="#local-6989586621682960132"><span class="hs-identifier hs-type">mod_size</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-606"></span><span>
</span><span id="line-607"></span><span>  </span><span class="hs-comment">-- commoned up metadata</span><span>
</span><span id="line-608"></span><span>  </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621682960134"><span class="annot"><a href="#local-6989586621682960134"><span class="hs-identifier hs-var hs-var">meta_opt</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">JStat -&gt; JStat
</span><a href="GHC.JS.Optimizer.html#jsOptimize"><span class="hs-identifier hs-var">jsOptimize</span></a></span><span> </span><span class="annot"><span class="annottext">JStat
</span><a href="#local-6989586621682960126"><span class="hs-identifier hs-var">meta</span></a></span><span>
</span><span id="line-609"></span><span>  </span><span class="hs-glyph">!</span><span id="local-6989586621682960135"><span class="annot"><a href="#local-6989586621682960135"><span class="hs-identifier hs-var">meta_length</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="hs-identifier hs-type">fromIntegral</span></span><span> </span><span class="annot"><span class="hs-operator hs-type">&lt;$&gt;</span></span><span> </span><span class="annot"><a href="#local-6989586621682960128"><span class="hs-identifier hs-type">putJS</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682960134"><span class="hs-identifier hs-type">meta_opt</span></a></span><span>
</span><span id="line-610"></span><span>
</span><span id="line-611"></span><span>  </span><span class="hs-comment">-- module exports</span><span>
</span><span id="line-612"></span><span>  </span><span class="annot"><span class="hs-identifier hs-type">mapM_</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../../bytestring-0.12.2.0-7dd0/src/Data.ByteString.html#hPut"><span class="hs-identifier hs-type">B.hPut</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682960122"><span class="hs-identifier hs-type">h</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">.</span></span><span> </span><span class="annot"><a href="GHC.StgToJS.Linker.Linker.html#cmc_exports"><span class="hs-identifier hs-var">cmc_exports</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><a href="#local-6989586621682960125"><span class="hs-identifier hs-type">compacted_mods</span></a></span><span>
</span><span id="line-613"></span><span>
</span><span id="line-614"></span><span>  </span><span class="hs-comment">-- stats</span><span>
</span><span id="line-615"></span><span>  </span><span class="hs-keyword">let</span><span> </span><span class="hs-glyph">!</span><span id="local-6989586621682960137"><span class="annot"><a href="#local-6989586621682960137"><span class="hs-identifier hs-var hs-var">link_stats</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="GHC.StgToJS.Linker.Linker.html#LinkerStats"><span class="hs-identifier hs-type">LinkerStats</span></a></span><span>
</span><span id="line-616"></span><span>        </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">bytesPerModule :: Map Module Word64
</span><a href="GHC.StgToJS.Linker.Linker.html#bytesPerModule"><span class="hs-identifier hs-var">bytesPerModule</span></a></span><span>     </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[(Module, Word64)] -&gt; Map Module Word64
forall k a. Ord k =&gt; [(k, a)] -&gt; Map k a
</span><a href="../../containers-0.7-5a8f/src/Data.Map.Strict.Internal.html#fromList"><span class="hs-identifier hs-var">M.fromList</span></a></span><span> </span><span class="annot"><span class="annottext">[(Module, Word64)]
</span><a href="#local-6989586621682960129"><span class="hs-identifier hs-var">mod_sizes</span></a></span><span>
</span><span id="line-617"></span><span>        </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">packedMetaDataSize :: Word64
</span><a href="GHC.StgToJS.Linker.Linker.html#packedMetaDataSize"><span class="hs-identifier hs-var">packedMetaDataSize</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Word64
</span><a href="#local-6989586621682960135"><span class="hs-identifier hs-var">meta_length</span></a></span><span>
</span><span id="line-618"></span><span>        </span><span class="hs-special">}</span><span>
</span><span id="line-619"></span><span>
</span><span id="line-620"></span><span>  </span><span class="annot"><span class="hs-identifier hs-type">pure</span></span><span> </span><span class="annot"><a href="#local-6989586621682960137"><span class="hs-identifier hs-type">link_stats</span></a></span><span>
</span><span id="line-621"></span><span>
</span><span id="line-622"></span><span class="annot"><span class="hs-comment">-- | Render linker stats</span></span><span>
</span><span id="line-623"></span><span class="annot"><a href="GHC.StgToJS.Linker.Linker.html#renderLinkerStats"><span class="hs-identifier hs-type">renderLinkerStats</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.StgToJS.Linker.Linker.html#LinkerStats"><span class="hs-identifier hs-type">LinkerStats</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">String</span></span><span>
</span><span id="line-624"></span><span id="renderLinkerStats"><span class="annot"><span class="annottext">renderLinkerStats :: LinkerStats -&gt; FilePath
</span><a href="GHC.StgToJS.Linker.Linker.html#renderLinkerStats"><span class="hs-identifier hs-var hs-var">renderLinkerStats</span></a></span></span><span> </span><span id="local-6989586621682960139"><span class="annot"><span class="annottext">LinkerStats
</span><a href="#local-6989586621682960139"><span class="hs-identifier hs-var">s</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-625"></span><span>  </span><span class="annot"><span class="annottext">FilePath -&gt; [FilePath] -&gt; FilePath
forall a. [a] -&gt; [[a]] -&gt; [a]
</span><span class="hs-identifier hs-var">intercalate</span></span><span> </span><span class="annot"><span class="annottext">FilePath
</span><span class="hs-string">&quot;\n\n&quot;</span></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">FilePath
</span><a href="#local-6989586621682960140"><span class="hs-identifier hs-var">meta_stats</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">FilePath
</span><a href="#local-6989586621682960141"><span class="hs-identifier hs-var">package_stats</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">FilePath
</span><a href="#local-6989586621682960142"><span class="hs-identifier hs-var">module_stats</span></a></span><span class="hs-special">]</span><span> </span><span class="annot"><span class="annottext">FilePath -&gt; FilePath -&gt; FilePath
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">FilePath
</span><span class="hs-string">&quot;\n\n&quot;</span></span><span>
</span><span id="line-626"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-627"></span><span>    </span><span id="local-6989586621682960143"><span class="annot"><span class="annottext">meta :: Word64
</span><a href="#local-6989586621682960143"><span class="hs-identifier hs-var hs-var">meta</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">LinkerStats -&gt; Word64
</span><a href="GHC.StgToJS.Linker.Linker.html#packedMetaDataSize"><span class="hs-identifier hs-var">packedMetaDataSize</span></a></span><span> </span><span class="annot"><span class="annottext">LinkerStats
</span><a href="#local-6989586621682960139"><span class="hs-identifier hs-var">s</span></a></span><span>
</span><span id="line-628"></span><span>    </span><span id="local-6989586621682960140"><span class="annot"><span class="annottext">meta_stats :: FilePath
</span><a href="#local-6989586621682960140"><span class="hs-identifier hs-var hs-var">meta_stats</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">FilePath
</span><span class="hs-string">&quot;number of modules: &quot;</span></span><span> </span><span class="annot"><span class="annottext">FilePath -&gt; FilePath -&gt; FilePath
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">BlockId -&gt; FilePath
forall a. Show a =&gt; a -&gt; FilePath
</span><span class="hs-identifier hs-var">show</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[(Module, Word64)] -&gt; BlockId
forall a. [a] -&gt; BlockId
forall (t :: * -&gt; *) a. Foldable t =&gt; t a -&gt; BlockId
</span><span class="hs-identifier hs-var">length</span></span><span> </span><span class="annot"><span class="annottext">[(Module, Word64)]
</span><a href="#local-6989586621682960146"><span class="hs-identifier hs-var">bytes_per_mod</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-629"></span><span>                 </span><span class="annot"><span class="annottext">FilePath -&gt; FilePath -&gt; FilePath
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">FilePath
</span><span class="hs-string">&quot;\npacked metadata:   &quot;</span></span><span> </span><span class="annot"><span class="annottext">FilePath -&gt; FilePath -&gt; FilePath
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">Word64 -&gt; FilePath
forall a. Show a =&gt; a -&gt; FilePath
</span><span class="hs-identifier hs-var">show</span></span><span> </span><span class="annot"><span class="annottext">Word64
</span><a href="#local-6989586621682960143"><span class="hs-identifier hs-var">meta</span></a></span><span>
</span><span id="line-630"></span><span>
</span><span id="line-631"></span><span>    </span><span id="local-6989586621682960146"><span class="annot"><span class="annottext">bytes_per_mod :: [(Module, Word64)]
</span><a href="#local-6989586621682960146"><span class="hs-identifier hs-var hs-var">bytes_per_mod</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Map Module Word64 -&gt; [(Module, Word64)]
forall k a. Map k a -&gt; [(k, a)]
</span><a href="../../containers-0.7-5a8f/src/Data.Map.Internal.html#toList"><span class="hs-identifier hs-var">M.toList</span></a></span><span> </span><span class="annot"><span class="annottext">(Map Module Word64 -&gt; [(Module, Word64)])
-&gt; Map Module Word64 -&gt; [(Module, Word64)]
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">LinkerStats -&gt; Map Module Word64
</span><a href="GHC.StgToJS.Linker.Linker.html#bytesPerModule"><span class="hs-identifier hs-var">bytesPerModule</span></a></span><span> </span><span class="annot"><span class="annottext">LinkerStats
</span><a href="#local-6989586621682960139"><span class="hs-identifier hs-var">s</span></a></span><span>
</span><span id="line-632"></span><span>
</span><span id="line-633"></span><span>    </span><span id="local-6989586621682960148"><span class="annot"><span class="annottext">show_unit :: UnitId -&gt; FilePath
</span><a href="#local-6989586621682960148"><span class="hs-identifier hs-var hs-var">show_unit</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Unit.Types.html#UnitId"><span class="hs-identifier hs-type">UnitId</span></a></span><span> </span><span id="local-6989586621682960150"><span class="annot"><span class="annottext">FastString
</span><a href="#local-6989586621682960150"><span class="hs-identifier hs-var">fs</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">FastString -&gt; FilePath
</span><a href="GHC.Data.FastString.html#unpackFS"><span class="hs-identifier hs-var">unpackFS</span></a></span><span> </span><span class="annot"><span class="annottext">FastString
</span><a href="#local-6989586621682960150"><span class="hs-identifier hs-var">fs</span></a></span><span>
</span><span id="line-634"></span><span>
</span><span id="line-635"></span><span>    </span><span class="annot"><a href="#local-6989586621682960152"><span class="hs-identifier hs-type">ps</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="../../containers-0.7-5a8f/src/Data.Map.Internal.html#Map"><span class="hs-identifier hs-type">Map</span></a></span><span> </span><span class="annot"><a href="GHC.Unit.Types.html#UnitId"><span class="hs-identifier hs-type">UnitId</span></a></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Word64</span></span><span>
</span><span id="line-636"></span><span>    </span><span id="local-6989586621682960152"><span class="annot"><span class="annottext">ps :: Map UnitId Word64
</span><a href="#local-6989586621682960152"><span class="hs-identifier hs-var hs-var">ps</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(Word64 -&gt; Word64 -&gt; Word64)
-&gt; [(UnitId, Word64)] -&gt; Map UnitId Word64
forall k a. Ord k =&gt; (a -&gt; a -&gt; a) -&gt; [(k, a)] -&gt; Map k a
</span><a href="../../containers-0.7-5a8f/src/Data.Map.Strict.Internal.html#fromListWith"><span class="hs-identifier hs-var">M.fromListWith</span></a></span><span> </span><span class="annot"><span class="annottext">Word64 -&gt; Word64 -&gt; Word64
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">(+)</span></span><span> </span><span class="annot"><span class="annottext">([(UnitId, Word64)] -&gt; Map UnitId Word64)
-&gt; ([(Module, Word64)] -&gt; [(UnitId, Word64)])
-&gt; [(Module, Word64)]
-&gt; Map UnitId Word64
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">((Module, Word64) -&gt; (UnitId, Word64))
-&gt; [(Module, Word64)] -&gt; [(UnitId, Word64)]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><span class="hs-identifier hs-var">map</span></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span class="hs-special">(</span><span id="local-6989586621682960155"><span class="annot"><span class="annottext">Module
</span><a href="#local-6989586621682960155"><span class="hs-identifier hs-var">m</span></a></span></span><span class="hs-special">,</span><span id="local-6989586621682960156"><span class="annot"><span class="annottext">Word64
</span><a href="#local-6989586621682960156"><span class="hs-identifier hs-var">s</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Module -&gt; UnitId
</span><a href="GHC.Unit.Types.html#moduleUnitId"><span class="hs-identifier hs-var">moduleUnitId</span></a></span><span> </span><span class="annot"><span class="annottext">Module
</span><a href="#local-6989586621682960155"><span class="hs-identifier hs-var">m</span></a></span><span class="hs-special">,</span><span class="annot"><span class="annottext">Word64
</span><a href="#local-6989586621682960156"><span class="hs-identifier hs-var">s</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">([(Module, Word64)] -&gt; Map UnitId Word64)
-&gt; [(Module, Word64)] -&gt; Map UnitId Word64
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">[(Module, Word64)]
</span><a href="#local-6989586621682960146"><span class="hs-identifier hs-var">bytes_per_mod</span></a></span><span>
</span><span id="line-637"></span><span>
</span><span id="line-638"></span><span>    </span><span class="annot"><a href="#local-6989586621682960157"><span class="hs-identifier hs-type">pad</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Int</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">String</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">String</span></span><span>
</span><span id="line-639"></span><span>    </span><span id="local-6989586621682960157"><span class="annot"><span class="annottext">pad :: BlockId -&gt; FilePath -&gt; FilePath
</span><a href="#local-6989586621682960157"><span class="hs-identifier hs-var hs-var">pad</span></a></span></span><span> </span><span id="local-6989586621682960158"><span class="annot"><span class="annottext">BlockId
</span><a href="#local-6989586621682960158"><span class="hs-identifier hs-var">n</span></a></span></span><span> </span><span id="local-6989586621682960159"><span class="annot"><span class="annottext">FilePath
</span><a href="#local-6989586621682960159"><span class="hs-identifier hs-var">t</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621682960160"><span class="annot"><span class="annottext">l :: BlockId
</span><a href="#local-6989586621682960160"><span class="hs-identifier hs-var hs-var">l</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">FilePath -&gt; BlockId
forall a. [a] -&gt; BlockId
forall (t :: * -&gt; *) a. Foldable t =&gt; t a -&gt; BlockId
</span><span class="hs-identifier hs-var">length</span></span><span> </span><span class="annot"><span class="annottext">FilePath
</span><a href="#local-6989586621682960159"><span class="hs-identifier hs-var">t</span></a></span><span>
</span><span id="line-640"></span><span>              </span><span class="hs-keyword">in</span><span>  </span><span class="hs-keyword">if</span><span> </span><span class="annot"><span class="annottext">BlockId
</span><a href="#local-6989586621682960160"><span class="hs-identifier hs-var">l</span></a></span><span> </span><span class="annot"><span class="annottext">BlockId -&gt; BlockId -&gt; Bool
forall a. Ord a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">&lt;</span></span><span> </span><span class="annot"><span class="annottext">BlockId
</span><a href="#local-6989586621682960158"><span class="hs-identifier hs-var">n</span></a></span><span> </span><span class="hs-keyword">then</span><span> </span><span class="annot"><span class="annottext">FilePath
</span><a href="#local-6989586621682960159"><span class="hs-identifier hs-var">t</span></a></span><span> </span><span class="annot"><span class="annottext">FilePath -&gt; FilePath -&gt; FilePath
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">BlockId -&gt; Char -&gt; FilePath
forall a. BlockId -&gt; a -&gt; [a]
</span><span class="hs-identifier hs-var">replicate</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">BlockId
</span><a href="#local-6989586621682960158"><span class="hs-identifier hs-var">n</span></a></span><span class="annot"><span class="annottext">BlockId -&gt; BlockId -&gt; BlockId
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-glyph hs-var">-</span></span><span class="annot"><span class="annottext">BlockId
</span><a href="#local-6989586621682960160"><span class="hs-identifier hs-var">l</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Char
</span><span class="hs-char">' '</span></span><span> </span><span class="hs-keyword">else</span><span> </span><span class="annot"><span class="annottext">FilePath
</span><a href="#local-6989586621682960159"><span class="hs-identifier hs-var">t</span></a></span><span>
</span><span id="line-641"></span><span>
</span><span id="line-642"></span><span>    </span><span class="annot"><a href="#local-6989586621682960163"><span class="hs-identifier hs-type">pkgMods</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><span class="hs-special">[</span><span class="hs-special">(</span><span class="annot"><a href="GHC.Unit.Types.html#Module"><span class="hs-identifier hs-type">Module</span></a></span><span class="hs-special">,</span><span class="annot"><span class="hs-identifier hs-type">Word64</span></span><span class="hs-special">)</span><span class="hs-special">]</span><span class="hs-special">]</span><span>
</span><span id="line-643"></span><span>    </span><span id="local-6989586621682960163"><span class="annot"><span class="annottext">pkgMods :: [[(Module, Word64)]]
</span><a href="#local-6989586621682960163"><span class="hs-identifier hs-var hs-var">pkgMods</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">((Module, Word64) -&gt; (Module, Word64) -&gt; Bool)
-&gt; [(Module, Word64)] -&gt; [[(Module, Word64)]]
forall a. (a -&gt; a -&gt; Bool) -&gt; [a] -&gt; [[a]]
</span><span class="hs-identifier hs-var">groupBy</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">UnitId -&gt; UnitId -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">(==)</span></span><span> </span><span class="annot"><span class="annottext">(UnitId -&gt; UnitId -&gt; Bool)
-&gt; ((Module, Word64) -&gt; UnitId)
-&gt; (Module, Word64)
-&gt; (Module, Word64)
-&gt; Bool
forall b c a. (b -&gt; b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; a -&gt; c
</span><span class="hs-operator hs-var">`on`</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Module -&gt; UnitId
</span><a href="GHC.Unit.Types.html#moduleUnitId"><span class="hs-identifier hs-var">moduleUnitId</span></a></span><span> </span><span class="annot"><span class="annottext">(Module -&gt; UnitId)
-&gt; ((Module, Word64) -&gt; Module) -&gt; (Module, Word64) -&gt; UnitId
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">(Module, Word64) -&gt; Module
forall a b. (a, b) -&gt; a
</span><span class="hs-identifier hs-var">fst</span></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[(Module, Word64)]
</span><a href="#local-6989586621682960146"><span class="hs-identifier hs-var">bytes_per_mod</span></a></span><span>
</span><span id="line-644"></span><span>
</span><span id="line-645"></span><span>    </span><span class="annot"><a href="#local-6989586621682960165"><span class="hs-identifier hs-type">showMod</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Unit.Types.html#Module"><span class="hs-identifier hs-type">Module</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Word64</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">String</span></span><span>
</span><span id="line-646"></span><span>    </span><span id="local-6989586621682960165"><span class="annot"><span class="annottext">showMod :: (Module, Word64) -&gt; FilePath
</span><a href="#local-6989586621682960165"><span class="hs-identifier hs-var hs-var">showMod</span></a></span></span><span> </span><span class="hs-special">(</span><span id="local-6989586621682960166"><span class="annot"><span class="annottext">Module
</span><a href="#local-6989586621682960166"><span class="hs-identifier hs-var">m</span></a></span></span><span class="hs-special">,</span><span id="local-6989586621682960167"><span class="annot"><span class="annottext">Word64
</span><a href="#local-6989586621682960167"><span class="hs-identifier hs-var">s</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">BlockId -&gt; FilePath -&gt; FilePath
</span><a href="#local-6989586621682960157"><span class="hs-identifier hs-var">pad</span></a></span><span> </span><span class="annot"><span class="annottext">BlockId
</span><span class="hs-number">40</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">FilePath
</span><span class="hs-string">&quot;    &quot;</span></span><span> </span><span class="annot"><span class="annottext">FilePath -&gt; FilePath -&gt; FilePath
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">Module -&gt; FilePath
</span><a href="GHC.Unit.Module.html#moduleStableString"><span class="hs-identifier hs-var">moduleStableString</span></a></span><span> </span><span class="annot"><span class="annottext">Module
</span><a href="#local-6989586621682960166"><span class="hs-identifier hs-var">m</span></a></span><span> </span><span class="annot"><span class="annottext">FilePath -&gt; FilePath -&gt; FilePath
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">FilePath
</span><span class="hs-string">&quot;:&quot;</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">FilePath -&gt; FilePath -&gt; FilePath
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">Word64 -&gt; FilePath
forall a. Show a =&gt; a -&gt; FilePath
</span><span class="hs-identifier hs-var">show</span></span><span> </span><span class="annot"><span class="annottext">Word64
</span><a href="#local-6989586621682960167"><span class="hs-identifier hs-var">s</span></a></span><span> </span><span class="annot"><span class="annottext">FilePath -&gt; FilePath -&gt; FilePath
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">FilePath
</span><span class="hs-string">&quot;\n&quot;</span></span><span>
</span><span id="line-647"></span><span>
</span><span id="line-648"></span><span>    </span><span class="annot"><a href="#local-6989586621682960141"><span class="hs-identifier hs-type">package_stats</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">String</span></span><span>
</span><span id="line-649"></span><span>    </span><span id="local-6989586621682960141"><span class="annot"><span class="annottext">package_stats :: FilePath
</span><a href="#local-6989586621682960141"><span class="hs-identifier hs-var hs-var">package_stats</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">FilePath
</span><span class="hs-string">&quot;code size summary per package (in bytes):\n\n&quot;</span></span><span>
</span><span id="line-650"></span><span>                     </span><span class="annot"><span class="annottext">FilePath -&gt; FilePath -&gt; FilePath
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">((UnitId, Word64) -&gt; FilePath) -&gt; [(UnitId, Word64)] -&gt; FilePath
forall (t :: * -&gt; *) a b. Foldable t =&gt; (a -&gt; [b]) -&gt; t a -&gt; [b]
</span><span class="hs-identifier hs-var">concatMap</span></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span class="hs-special">(</span><span id="local-6989586621682960168"><span class="annot"><span class="annottext">UnitId
</span><a href="#local-6989586621682960168"><span class="hs-identifier hs-var">p</span></a></span></span><span class="hs-special">,</span><span id="local-6989586621682960169"><span class="annot"><span class="annottext">Word64
</span><a href="#local-6989586621682960169"><span class="hs-identifier hs-var">s</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">BlockId -&gt; FilePath -&gt; FilePath
</span><a href="#local-6989586621682960157"><span class="hs-identifier hs-var">pad</span></a></span><span> </span><span class="annot"><span class="annottext">BlockId
</span><span class="hs-number">25</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">UnitId -&gt; FilePath
</span><a href="#local-6989586621682960148"><span class="hs-identifier hs-var">show_unit</span></a></span><span> </span><span class="annot"><span class="annottext">UnitId
</span><a href="#local-6989586621682960168"><span class="hs-identifier hs-var">p</span></a></span><span> </span><span class="annot"><span class="annottext">FilePath -&gt; FilePath -&gt; FilePath
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">FilePath
</span><span class="hs-string">&quot;:&quot;</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">FilePath -&gt; FilePath -&gt; FilePath
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">Word64 -&gt; FilePath
forall a. Show a =&gt; a -&gt; FilePath
</span><span class="hs-identifier hs-var">show</span></span><span> </span><span class="annot"><span class="annottext">Word64
</span><a href="#local-6989586621682960169"><span class="hs-identifier hs-var">s</span></a></span><span> </span><span class="annot"><span class="annottext">FilePath -&gt; FilePath -&gt; FilePath
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">FilePath
</span><span class="hs-string">&quot;\n&quot;</span></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Map UnitId Word64 -&gt; [(UnitId, Word64)]
forall k a. Map k a -&gt; [(k, a)]
</span><a href="../../containers-0.7-5a8f/src/Data.Map.Internal.html#toList"><span class="hs-identifier hs-var">M.toList</span></a></span><span> </span><span class="annot"><span class="annottext">Map UnitId Word64
</span><a href="#local-6989586621682960152"><span class="hs-identifier hs-var">ps</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-651"></span><span>
</span><span id="line-652"></span><span>    </span><span class="annot"><a href="#local-6989586621682960142"><span class="hs-identifier hs-type">module_stats</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">String</span></span><span>
</span><span id="line-653"></span><span>    </span><span id="local-6989586621682960142"><span class="annot"><span class="annottext">module_stats :: FilePath
</span><a href="#local-6989586621682960142"><span class="hs-identifier hs-var hs-var">module_stats</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">FilePath
</span><span class="hs-string">&quot;code size per module (in bytes):\n\n&quot;</span></span><span> </span><span class="annot"><span class="annottext">FilePath -&gt; FilePath -&gt; FilePath
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">[FilePath] -&gt; FilePath
</span><span class="hs-identifier hs-var">unlines</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">([(Module, Word64)] -&gt; FilePath)
-&gt; [[(Module, Word64)]] -&gt; [FilePath]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><span class="hs-identifier hs-var">map</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">((Module, Word64) -&gt; FilePath) -&gt; [(Module, Word64)] -&gt; FilePath
forall (t :: * -&gt; *) a b. Foldable t =&gt; (a -&gt; [b]) -&gt; t a -&gt; [b]
</span><span class="hs-identifier hs-var">concatMap</span></span><span> </span><span class="annot"><span class="annottext">(Module, Word64) -&gt; FilePath
</span><a href="#local-6989586621682960165"><span class="hs-identifier hs-var">showMod</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[[(Module, Word64)]]
</span><a href="#local-6989586621682960163"><span class="hs-identifier hs-var">pkgMods</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-654"></span><span>
</span><span id="line-655"></span><span>
</span><span id="line-656"></span><span class="annot"><a href="GHC.StgToJS.Linker.Linker.html#getPackageArchives"><span class="hs-identifier hs-type">getPackageArchives</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.StgToJS.Types.html#StgToJSConfig"><span class="hs-identifier hs-type">StgToJSConfig</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Unit.Env.html#UnitEnv"><span class="hs-identifier hs-type">UnitEnv</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="GHC.Unit.Types.html#UnitId"><span class="hs-identifier hs-type">UnitId</span></a></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="hs-identifier hs-type">FilePath</span></span><span class="hs-special">]</span><span>
</span><span id="line-657"></span><span id="getPackageArchives"><span class="annot"><span class="annottext">getPackageArchives :: StgToJSConfig -&gt; UnitEnv -&gt; [UnitId] -&gt; IO [FilePath]
</span><a href="GHC.StgToJS.Linker.Linker.html#getPackageArchives"><span class="hs-identifier hs-var hs-var">getPackageArchives</span></a></span></span><span> </span><span id="local-6989586621682960171"><span class="annot"><span class="annottext">StgToJSConfig
</span><a href="#local-6989586621682960171"><span class="hs-identifier hs-var">cfg</span></a></span></span><span> </span><span id="local-6989586621682960172"><span class="annot"><span class="annottext">UnitEnv
</span><a href="#local-6989586621682960172"><span class="hs-identifier hs-var">unit_env</span></a></span></span><span> </span><span id="local-6989586621682960173"><span class="annot"><span class="annottext">[UnitId]
</span><a href="#local-6989586621682960173"><span class="hs-identifier hs-var">units</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-658"></span><span>  </span><span class="annot"><span class="annottext">(FilePath -&gt; IO Bool) -&gt; [FilePath] -&gt; IO [FilePath]
forall (m :: * -&gt; *) a.
Applicative m =&gt;
(a -&gt; m Bool) -&gt; [a] -&gt; m [a]
</span><span class="hs-identifier hs-var">filterM</span></span><span> </span><span class="annot"><span class="annottext">FilePath -&gt; IO Bool
</span><a href="../../directory-1.3.9.0-af18/src/System.Directory.html#doesFileExist"><span class="hs-identifier hs-var">doesFileExist</span></a></span><span> </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">ShortText -&gt; FilePath
</span><a href="../../ghc-boot-9.12.2-1a37/src/GHC.Data.ShortText.html#unpack"><span class="hs-identifier hs-var">ST.unpack</span></a></span><span> </span><span class="annot"><span class="annottext">ShortText
</span><a href="#local-6989586621682960176"><span class="hs-identifier hs-var">p</span></a></span><span> </span><span class="annot"><span class="annottext">FilePath -&gt; FilePath -&gt; FilePath
</span><a href="../../filepath-1.5.4.0-e69b/src/System.FilePath.Posix.html#%3C%2F%3E"><span class="hs-operator hs-var">&lt;/&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">FilePath
</span><span class="hs-string">&quot;lib&quot;</span></span><span> </span><span class="annot"><span class="annottext">FilePath -&gt; FilePath -&gt; FilePath
forall a. [a] -&gt; [a] -&gt; [a]
</span><span class="hs-operator hs-var">++</span></span><span> </span><span class="annot"><span class="annottext">ShortText -&gt; FilePath
</span><a href="../../ghc-boot-9.12.2-1a37/src/GHC.Data.ShortText.html#unpack"><span class="hs-identifier hs-var">ST.unpack</span></a></span><span> </span><span class="annot"><span class="annottext">ShortText
</span><a href="#local-6989586621682960177"><span class="hs-identifier hs-var">l</span></a></span><span> </span><span class="annot"><span class="annottext">FilePath -&gt; FilePath -&gt; FilePath
forall a. [a] -&gt; [a] -&gt; [a]
</span><span class="hs-operator hs-var">++</span></span><span> </span><span class="annot"><span class="annottext">FilePath
</span><a href="#local-6989586621682960178"><span class="hs-identifier hs-var">profSuff</span></a></span><span> </span><span class="annot"><span class="annottext">FilePath -&gt; FilePath -&gt; FilePath
</span><a href="../../filepath-1.5.4.0-e69b/src/System.FilePath.Posix.html#%3C.%3E"><span class="hs-operator hs-var">&lt;.&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">FilePath
</span><span class="hs-string">&quot;a&quot;</span></span><span>
</span><span id="line-659"></span><span>                        </span><span class="hs-glyph">|</span><span> </span><span id="local-6989586621682960179"><span class="annot"><span class="annottext">UnitId
</span><a href="#local-6989586621682960179"><span class="hs-identifier hs-var">u</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">[UnitId]
</span><a href="#local-6989586621682960173"><span class="hs-identifier hs-var">units</span></a></span><span>
</span><span id="line-660"></span><span>                        </span><span class="hs-special">,</span><span> </span><span id="local-6989586621682960176"><span class="annot"><span class="annottext">ShortText
</span><a href="#local-6989586621682960176"><span class="hs-identifier hs-var">p</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">UnitState -&gt; UnitId -&gt; [ShortText]
</span><a href="GHC.StgToJS.Linker.Utils.html#getInstalledPackageLibDirs"><span class="hs-identifier hs-var">getInstalledPackageLibDirs</span></a></span><span> </span><span class="annot"><span class="annottext">UnitState
</span><a href="#local-6989586621682960181"><span class="hs-identifier hs-var">ue_state</span></a></span><span> </span><span class="annot"><span class="annottext">UnitId
</span><a href="#local-6989586621682960179"><span class="hs-identifier hs-var">u</span></a></span><span>
</span><span id="line-661"></span><span>                        </span><span class="hs-special">,</span><span> </span><span id="local-6989586621682960177"><span class="annot"><span class="annottext">ShortText
</span><a href="#local-6989586621682960177"><span class="hs-identifier hs-var">l</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">UnitState -&gt; UnitId -&gt; [ShortText]
</span><a href="GHC.StgToJS.Linker.Utils.html#getInstalledPackageHsLibs"><span class="hs-identifier hs-var">getInstalledPackageHsLibs</span></a></span><span>  </span><span class="annot"><span class="annottext">UnitState
</span><a href="#local-6989586621682960181"><span class="hs-identifier hs-var">ue_state</span></a></span><span> </span><span class="annot"><span class="annottext">UnitId
</span><a href="#local-6989586621682960179"><span class="hs-identifier hs-var">u</span></a></span><span>
</span><span id="line-662"></span><span>                        </span><span class="hs-special">]</span><span>
</span><span id="line-663"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-664"></span><span>    </span><span id="local-6989586621682960181"><span class="annot"><span class="annottext">ue_state :: UnitState
</span><a href="#local-6989586621682960181"><span class="hs-identifier hs-var hs-var">ue_state</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">HasDebugCallStack =&gt; UnitEnv -&gt; UnitState
UnitEnv -&gt; UnitState
</span><a href="GHC.Unit.Env.html#ue_units"><span class="hs-identifier hs-var">ue_units</span></a></span><span> </span><span class="annot"><span class="annottext">UnitEnv
</span><a href="#local-6989586621682960172"><span class="hs-identifier hs-var">unit_env</span></a></span><span>
</span><span id="line-665"></span><span>
</span><span id="line-666"></span><span>    </span><span class="hs-comment">-- XXX the profiling library name is probably wrong now</span><span>
</span><span id="line-667"></span><span>    </span><span id="local-6989586621682960178"><span class="annot"><span class="annottext">profSuff :: FilePath
</span><a href="#local-6989586621682960178"><span class="hs-identifier hs-var hs-var">profSuff</span></a></span></span><span> </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">StgToJSConfig -&gt; Bool
</span><a href="GHC.StgToJS.Types.html#csProf"><span class="hs-identifier hs-var">csProf</span></a></span><span> </span><span class="annot"><span class="annottext">StgToJSConfig
</span><a href="#local-6989586621682960171"><span class="hs-identifier hs-var">cfg</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">FilePath
</span><span class="hs-string">&quot;_p&quot;</span></span><span>
</span><span id="line-668"></span><span>             </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">otherwise</span></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">FilePath
</span><span class="hs-string">&quot;&quot;</span></span><span>
</span><span id="line-669"></span><span>
</span><span id="line-670"></span><span>
</span><span id="line-671"></span><span class="hs-comment">-- | Combine rts.js, lib.js, out.js to all.js that can be run</span><span>
</span><span id="line-672"></span><span class="hs-comment">-- directly with node.js or SpiderMonkey jsshell</span><span>
</span><span id="line-673"></span><span class="annot"><a href="GHC.StgToJS.Linker.Linker.html#combineFiles"><span class="hs-identifier hs-type">combineFiles</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.StgToJS.Linker.Types.html#JSLinkConfig"><span class="hs-identifier hs-type">JSLinkConfig</span></a></span><span>
</span><span id="line-674"></span><span>             </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Bool</span></span><span> </span><span class="hs-comment">-- has clibs.js</span><span>
</span><span id="line-675"></span><span>             </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">FilePath</span></span><span>
</span><span id="line-676"></span><span>             </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-677"></span><span id="combineFiles"><span class="annot"><span class="annottext">combineFiles :: JSLinkConfig -&gt; Bool -&gt; FilePath -&gt; IO ()
</span><a href="GHC.StgToJS.Linker.Linker.html#combineFiles"><span class="hs-identifier hs-var hs-var">combineFiles</span></a></span></span><span> </span><span id="local-6989586621682960185"><span class="annot"><span class="annottext">JSLinkConfig
</span><a href="#local-6989586621682960185"><span class="hs-identifier hs-var">cfg</span></a></span></span><span> </span><span id="local-6989586621682960186"><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621682960186"><span class="hs-identifier hs-var">has_clibs</span></a></span></span><span> </span><span id="local-6989586621682960187"><span class="annot"><span class="annottext">FilePath
</span><a href="#local-6989586621682960187"><span class="hs-identifier hs-var">fp</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-678"></span><span>  </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621682960188"><span class="annot"><span class="annottext">files :: [FilePath]
</span><a href="#local-6989586621682960188"><span class="hs-identifier hs-var hs-var">files</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(FilePath -&gt; FilePath) -&gt; [FilePath] -&gt; [FilePath]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><span class="hs-identifier hs-var">map</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">FilePath
</span><a href="#local-6989586621682960187"><span class="hs-identifier hs-var">fp</span></a></span><span> </span><span class="annot"><span class="annottext">FilePath -&gt; FilePath -&gt; FilePath
</span><a href="../../filepath-1.5.4.0-e69b/src/System.FilePath.Posix.html#%3C%2F%3E"><span class="hs-operator hs-var">&lt;/&gt;</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">([FilePath] -&gt; [FilePath]) -&gt; [FilePath] -&gt; [FilePath]
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">[Maybe FilePath] -&gt; [FilePath]
forall a. [Maybe a] -&gt; [a]
</span><span class="hs-identifier hs-var">catMaybes</span></span><span>
</span><span id="line-679"></span><span>        </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">FilePath -&gt; Maybe FilePath
forall a. a -&gt; Maybe a
</span><span class="hs-identifier hs-var">Just</span></span><span> </span><span class="annot"><span class="annottext">FilePath
</span><span class="hs-string">&quot;rts.js&quot;</span></span><span>
</span><span id="line-680"></span><span>        </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">FilePath -&gt; Maybe FilePath
forall a. a -&gt; Maybe a
</span><span class="hs-identifier hs-var">Just</span></span><span> </span><span class="annot"><span class="annottext">FilePath
</span><span class="hs-string">&quot;lib.js&quot;</span></span><span>
</span><span id="line-681"></span><span>        </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">FilePath -&gt; Maybe FilePath
forall a. a -&gt; Maybe a
</span><span class="hs-identifier hs-var">Just</span></span><span> </span><span class="annot"><span class="annottext">FilePath
</span><span class="hs-string">&quot;out.js&quot;</span></span><span>
</span><span id="line-682"></span><span>        </span><span class="hs-special">,</span><span> </span><span class="hs-keyword">if</span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621682960186"><span class="hs-identifier hs-var">has_clibs</span></a></span><span>      </span><span class="hs-keyword">then</span><span> </span><span class="annot"><span class="annottext">FilePath -&gt; Maybe FilePath
forall a. a -&gt; Maybe a
</span><span class="hs-identifier hs-var">Just</span></span><span> </span><span class="annot"><span class="annottext">FilePath
</span><span class="hs-string">&quot;clibs.js&quot;</span></span><span> </span><span class="hs-keyword">else</span><span> </span><span class="annot"><span class="annottext">Maybe FilePath
forall a. Maybe a
</span><span class="hs-identifier hs-var">Nothing</span></span><span>
</span><span id="line-683"></span><span>        </span><span class="hs-special">,</span><span> </span><span class="hs-keyword">if</span><span> </span><span class="annot"><span class="annottext">JSLinkConfig -&gt; Bool
</span><a href="GHC.StgToJS.Linker.Types.html#lcNoHsMain"><span class="hs-identifier hs-var">lcNoHsMain</span></a></span><span> </span><span class="annot"><span class="annottext">JSLinkConfig
</span><a href="#local-6989586621682960185"><span class="hs-identifier hs-var">cfg</span></a></span><span> </span><span class="hs-keyword">then</span><span> </span><span class="annot"><span class="annottext">Maybe FilePath
forall a. Maybe a
</span><span class="hs-identifier hs-var">Nothing</span></span><span> </span><span class="hs-keyword">else</span><span> </span><span class="annot"><span class="annottext">FilePath -&gt; Maybe FilePath
forall a. a -&gt; Maybe a
</span><span class="hs-identifier hs-var">Just</span></span><span> </span><span class="annot"><span class="annottext">FilePath
</span><span class="hs-string">&quot;runmain.js&quot;</span></span><span>
</span><span id="line-684"></span><span>        </span><span class="hs-special">]</span><span>
</span><span id="line-685"></span><span>  </span><span class="annot"><span class="annottext">FilePath -&gt; IOMode -&gt; (Handle -&gt; IO ()) -&gt; IO ()
forall r. FilePath -&gt; IOMode -&gt; (Handle -&gt; IO r) -&gt; IO r
</span><span class="hs-identifier hs-var">withBinaryFile</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">FilePath
</span><a href="#local-6989586621682960187"><span class="hs-identifier hs-var">fp</span></a></span><span> </span><span class="annot"><span class="annottext">FilePath -&gt; FilePath -&gt; FilePath
</span><a href="../../filepath-1.5.4.0-e69b/src/System.FilePath.Posix.html#%3C%2F%3E"><span class="hs-operator hs-var">&lt;/&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">FilePath
</span><span class="hs-string">&quot;all.js&quot;</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">IOMode
</span><span class="hs-identifier hs-var">WriteMode</span></span><span> </span><span class="annot"><span class="annottext">((Handle -&gt; IO ()) -&gt; IO ()) -&gt; (Handle -&gt; IO ()) -&gt; IO ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-glyph">\</span><span id="local-6989586621682960191"><span class="annot"><span class="annottext">Handle
</span><a href="#local-6989586621682960191"><span class="hs-identifier hs-var">h</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-686"></span><span>    </span><span class="annot"><span class="annottext">[FilePath] -&gt; (FilePath -&gt; IO ()) -&gt; IO ()
forall (t :: * -&gt; *) (m :: * -&gt; *) a b.
(Foldable t, Monad m) =&gt;
t a -&gt; (a -&gt; m b) -&gt; m ()
</span><span class="hs-identifier hs-var">forM_</span></span><span> </span><span class="annot"><span class="annottext">[FilePath]
</span><a href="#local-6989586621682960188"><span class="hs-identifier hs-var">files</span></a></span><span> </span><span class="annot"><span class="annottext">((FilePath -&gt; IO ()) -&gt; IO ()) -&gt; (FilePath -&gt; IO ()) -&gt; IO ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-glyph">\</span><span id="local-6989586621682960193"><span class="annot"><span class="annottext">FilePath
</span><a href="#local-6989586621682960193"><span class="hs-identifier hs-var">i</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-687"></span><span>      </span><span class="annot"><span class="annottext">FilePath -&gt; IO ByteString
</span><a href="../../bytestring-0.12.2.0-7dd0/src/Data.ByteString.html#readFile"><span class="hs-identifier hs-var">B.readFile</span></a></span><span> </span><span class="annot"><span class="annottext">FilePath
</span><a href="#local-6989586621682960193"><span class="hs-identifier hs-var">i</span></a></span><span> </span><span class="annot"><span class="annottext">IO ByteString -&gt; (ByteString -&gt; IO ()) -&gt; IO ()
forall a b. IO a -&gt; (a -&gt; IO b) -&gt; IO b
forall (m :: * -&gt; *) a b. Monad m =&gt; m a -&gt; (a -&gt; m b) -&gt; m b
</span><span class="hs-operator hs-var">&gt;&gt;=</span></span><span> </span><span class="annot"><span class="annottext">Handle -&gt; ByteString -&gt; IO ()
</span><a href="../../bytestring-0.12.2.0-7dd0/src/Data.ByteString.html#hPut"><span class="hs-identifier hs-var">B.hPut</span></a></span><span> </span><span class="annot"><span class="annottext">Handle
</span><a href="#local-6989586621682960191"><span class="hs-identifier hs-var">h</span></a></span><span>
</span><span id="line-688"></span><span>
</span><span id="line-689"></span><span class="annot"><span class="hs-comment">-- | write the index.html file that loads the program if it does not exit</span></span><span>
</span><span id="line-690"></span><span class="annot"><a href="GHC.StgToJS.Linker.Linker.html#writeHtml"><span class="hs-identifier hs-type">writeHtml</span></a></span><span>
</span><span id="line-691"></span><span>  </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">FilePath</span></span><span> </span><span class="annot"><span class="hs-comment">-- ^ output directory</span></span><span>
</span><span id="line-692"></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-693"></span><span id="writeHtml"><span class="annot"><span class="annottext">writeHtml :: FilePath -&gt; IO ()
</span><a href="GHC.StgToJS.Linker.Linker.html#writeHtml"><span class="hs-identifier hs-var hs-var">writeHtml</span></a></span></span><span> </span><span id="local-6989586621682960195"><span class="annot"><span class="annottext">FilePath
</span><a href="#local-6989586621682960195"><span class="hs-identifier hs-var">out</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-694"></span><span>  </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621682960196"><span class="annot"><span class="annottext">htmlFile :: FilePath
</span><a href="#local-6989586621682960196"><span class="hs-identifier hs-var hs-var hs-var">htmlFile</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">FilePath
</span><a href="#local-6989586621682960195"><span class="hs-identifier hs-var">out</span></a></span><span> </span><span class="annot"><span class="annottext">FilePath -&gt; FilePath -&gt; FilePath
</span><a href="../../filepath-1.5.4.0-e69b/src/System.FilePath.Posix.html#%3C%2F%3E"><span class="hs-operator hs-var">&lt;/&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">FilePath
</span><span class="hs-string">&quot;index.html&quot;</span></span><span>
</span><span id="line-695"></span><span>  </span><span id="local-6989586621682960197"><span class="annot"><a href="#local-6989586621682960197"><span class="hs-identifier hs-var">e</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">FilePath -&gt; IO Bool
</span><a href="../../directory-1.3.9.0-af18/src/System.Directory.html#doesFileExist"><span class="hs-identifier hs-var">doesFileExist</span></a></span><span> </span><span class="annot"><span class="annottext">FilePath
</span><a href="#local-6989586621682960196"><span class="hs-identifier hs-var">htmlFile</span></a></span><span>
</span><span id="line-696"></span><span>  </span><span class="annot"><span class="hs-identifier hs-type">unless</span></span><span> </span><span class="annot"><a href="#local-6989586621682960197"><span class="hs-identifier hs-type">e</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span>
</span><span id="line-697"></span><span>    </span><span class="annot"><a href="../../bytestring-0.12.2.0-7dd0/src/Data.ByteString.html#writeFile"><span class="hs-identifier hs-type">B.writeFile</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682960196"><span class="hs-identifier hs-type">htmlFile</span></a></span><span> </span><span class="annot"><a href="GHC.StgToJS.Linker.Linker.html#templateHtml"><span class="hs-identifier hs-type">templateHtml</span></a></span><span>
</span><span id="line-698"></span><span>
</span><span id="line-699"></span><span>
</span><span id="line-700"></span><span class="annot"><a href="GHC.StgToJS.Linker.Linker.html#templateHtml"><span class="hs-identifier hs-type">templateHtml</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="../../bytestring-0.12.2.0-7dd0/src/Data.ByteString.Internal.Type.html#ByteString"><span class="hs-identifier hs-type">B.ByteString</span></a></span><span>
</span><span id="line-701"></span><span id="templateHtml"><span class="annot"><span class="annottext">templateHtml :: ByteString
</span><a href="GHC.StgToJS.Linker.Linker.html#templateHtml"><span class="hs-identifier hs-var hs-var">templateHtml</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-702"></span><span>  </span><span class="annot"><span class="annottext">ByteString
</span><span class="hs-string">&quot;&lt;!DOCTYPE html&gt;\n\
  \&lt;html&gt;\n\
  \  &lt;head&gt;\n\
  \  &lt;/head&gt;\n\
  \  &lt;body&gt;\n\
  \  &lt;/body&gt;\n\
  \  &lt;script language=\&quot;javascript\&quot; src=\&quot;all.js\&quot; defer&gt;&lt;/script&gt;\n\
  \&lt;/html&gt;&quot;</span></span><span>
</span><span id="line-710"></span><span>
</span><span id="line-711"></span><span class="hs-comment">-- | write the runmain.js file that will be run with defer so that it runs after</span><span>
</span><span id="line-712"></span><span class="hs-comment">-- index.html is loaded</span><span>
</span><span id="line-713"></span><span class="annot"><a href="GHC.StgToJS.Linker.Linker.html#writeRunMain"><span class="hs-identifier hs-type">writeRunMain</span></a></span><span>
</span><span id="line-714"></span><span>  </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">FilePath</span></span><span> </span><span class="annot"><span class="hs-comment">-- ^ output directory</span></span><span>
</span><span id="line-715"></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.StgToJS.Linker.Linker.html#UseEmccRts"><span class="hs-identifier hs-type">UseEmccRts</span></a></span><span>
</span><span id="line-716"></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-717"></span><span id="writeRunMain"><span class="annot"><span class="annottext">writeRunMain :: FilePath -&gt; UseEmccRts -&gt; IO ()
</span><a href="GHC.StgToJS.Linker.Linker.html#writeRunMain"><span class="hs-identifier hs-var hs-var">writeRunMain</span></a></span></span><span> </span><span id="local-6989586621682960199"><span class="annot"><span class="annottext">FilePath
</span><a href="#local-6989586621682960199"><span class="hs-identifier hs-var">out</span></a></span></span><span> </span><span id="local-6989586621682960200"><span class="annot"><span class="annottext">UseEmccRts
</span><a href="#local-6989586621682960200"><span class="hs-identifier hs-var">use_emcc_rts</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-718"></span><span>  </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621682960201"><span class="annot"><span class="annottext">runMainFile :: FilePath
</span><a href="#local-6989586621682960201"><span class="hs-identifier hs-var hs-var">runMainFile</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">FilePath
</span><a href="#local-6989586621682960199"><span class="hs-identifier hs-var">out</span></a></span><span> </span><span class="annot"><span class="annottext">FilePath -&gt; FilePath -&gt; FilePath
</span><a href="../../filepath-1.5.4.0-e69b/src/System.FilePath.Posix.html#%3C%2F%3E"><span class="hs-operator hs-var">&lt;/&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">FilePath
</span><span class="hs-string">&quot;runmain.js&quot;</span></span><span>
</span><span id="line-719"></span><span>  </span><span class="annot"><span class="annottext">FilePath -&gt; ByteString -&gt; IO ()
</span><a href="../../bytestring-0.12.2.0-7dd0/src/Data.ByteString.html#writeFile"><span class="hs-identifier hs-var">B.writeFile</span></a></span><span> </span><span class="annot"><span class="annottext">FilePath
</span><a href="#local-6989586621682960201"><span class="hs-identifier hs-var">runMainFile</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">UseEmccRts -&gt; ByteString
</span><a href="GHC.StgToJS.Linker.Linker.html#runMainJS"><span class="hs-identifier hs-var">runMainJS</span></a></span><span> </span><span class="annot"><span class="annottext">UseEmccRts
</span><a href="#local-6989586621682960200"><span class="hs-identifier hs-var">use_emcc_rts</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-720"></span><span>
</span><span id="line-721"></span><span class="hs-keyword">newtype</span><span> </span><span id="UseEmccRts"><span class="annot"><a href="GHC.StgToJS.Linker.Linker.html#UseEmccRts"><span class="hs-identifier hs-var">UseEmccRts</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="UseEmccRts"><span class="annot"><a href="GHC.StgToJS.Linker.Linker.html#UseEmccRts"><span class="hs-identifier hs-var">UseEmccRts</span></a></span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Bool</span></span><span>
</span><span id="line-722"></span><span>
</span><span id="line-723"></span><span class="annot"><a href="GHC.StgToJS.Linker.Linker.html#runMainJS"><span class="hs-identifier hs-type">runMainJS</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.StgToJS.Linker.Linker.html#UseEmccRts"><span class="hs-identifier hs-type">UseEmccRts</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="../../bytestring-0.12.2.0-7dd0/src/Data.ByteString.Internal.Type.html#ByteString"><span class="hs-identifier hs-type">B.ByteString</span></a></span><span>
</span><span id="line-724"></span><span id="runMainJS"><span class="annot"><span class="annottext">runMainJS :: UseEmccRts -&gt; ByteString
</span><a href="GHC.StgToJS.Linker.Linker.html#runMainJS"><span class="hs-identifier hs-var hs-var">runMainJS</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.StgToJS.Linker.Linker.html#UseEmccRts"><span class="hs-identifier hs-type">UseEmccRts</span></a></span><span> </span><span id="local-6989586621682960203"><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621682960203"><span class="hs-identifier hs-var">use_emcc_rts</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">if</span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621682960203"><span class="hs-identifier hs-var">use_emcc_rts</span></a></span><span>
</span><span id="line-725"></span><span>  </span><span class="hs-keyword">then</span><span> </span><span class="annot"><span class="annottext">ByteString
</span><span class="hs-string">&quot;Module['onRuntimeInitialized'] = function() {\n\
       \h$initEmscriptenHeap();\n\
       \h$main(h$mainZCZCMainzimain);\n\
       \}\n&quot;</span></span><span>
</span><span id="line-729"></span><span>  </span><span class="hs-keyword">else</span><span> </span><span class="annot"><span class="annottext">ByteString
</span><span class="hs-string">&quot;h$main(h$mainZCZCMainzimain);\n&quot;</span></span><span>
</span><span id="line-730"></span><span>
</span><span id="line-731"></span><span class="annot"><a href="GHC.StgToJS.Linker.Linker.html#writeRunner"><span class="hs-identifier hs-type">writeRunner</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.StgToJS.Linker.Types.html#JSLinkConfig"><span class="hs-identifier hs-type">JSLinkConfig</span></a></span><span> </span><span class="annot"><span class="hs-comment">-- ^ Settings</span></span><span>
</span><span id="line-732"></span><span>            </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">FilePath</span></span><span>     </span><span class="annot"><span class="hs-comment">-- ^ Output directory</span></span><span>
</span><span id="line-733"></span><span>            </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-734"></span><span id="writeRunner"><span class="annot"><span class="annottext">writeRunner :: JSLinkConfig -&gt; FilePath -&gt; IO ()
</span><a href="GHC.StgToJS.Linker.Linker.html#writeRunner"><span class="hs-identifier hs-var hs-var">writeRunner</span></a></span></span><span> </span><span id="local-6989586621682960204"><span class="annot"><span class="annottext">JSLinkConfig
</span><a href="#local-6989586621682960204"><span class="hs-identifier hs-var">_settings</span></a></span></span><span> </span><span id="local-6989586621682960205"><span class="annot"><span class="annottext">FilePath
</span><a href="#local-6989586621682960205"><span class="hs-identifier hs-var">out</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-735"></span><span>  </span><span id="local-6989586621682960206"><span class="annot"><a href="#local-6989586621682960206"><span class="hs-identifier hs-var">cd</span></a></span></span><span>    </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">IO FilePath
</span><a href="../../directory-1.3.9.0-af18/src/System.Directory.html#getCurrentDirectory"><span class="hs-identifier hs-var">getCurrentDirectory</span></a></span><span>
</span><span id="line-736"></span><span>  </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621682960207"><span class="annot"><a href="#local-6989586621682960207"><span class="hs-identifier hs-var hs-var">arch_os</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ArchOS
</span><a href="../../ghc-boot-9.12.2-1a37/src/GHC.Platform.Host.html#hostPlatformArchOS"><span class="hs-identifier hs-var">hostPlatformArchOS</span></a></span><span>
</span><span id="line-737"></span><span>  </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621682960208"><span class="annot"><a href="#local-6989586621682960208"><span class="hs-identifier hs-var hs-var">runner</span></a></span></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">FilePath
</span><a href="#local-6989586621682960206"><span class="hs-identifier hs-var">cd</span></a></span><span> </span><span class="annot"><span class="annottext">FilePath -&gt; FilePath -&gt; FilePath
</span><a href="../../filepath-1.5.4.0-e69b/src/System.FilePath.Posix.html#%3C%2F%3E"><span class="hs-operator hs-var">&lt;/&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">ArchOS -&gt; Bool -&gt; Maybe FilePath -&gt; FilePath
</span><a href="GHC.Linker.Static.Utils.html#exeFileName"><span class="hs-identifier hs-var">exeFileName</span></a></span><span> </span><span class="annot"><span class="annottext">ArchOS
</span><a href="#local-6989586621682960207"><span class="hs-identifier hs-var">arch_os</span></a></span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">False</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">FilePath -&gt; Maybe FilePath
forall a. a -&gt; Maybe a
</span><span class="hs-identifier hs-var">Just</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">FilePath -&gt; FilePath
</span><a href="../../filepath-1.5.4.0-e69b/src/System.FilePath.Posix.html#dropExtension"><span class="hs-identifier hs-var">dropExtension</span></a></span><span> </span><span class="annot"><span class="annottext">FilePath
</span><a href="#local-6989586621682960205"><span class="hs-identifier hs-var">out</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-738"></span><span>      </span><span id="local-6989586621682960209"><span class="annot"><a href="#local-6989586621682960209"><span class="hs-identifier hs-var hs-var">srcFile</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">FilePath
</span><a href="#local-6989586621682960205"><span class="hs-identifier hs-var">out</span></a></span><span> </span><span class="annot"><span class="annottext">FilePath -&gt; FilePath -&gt; FilePath
</span><a href="../../filepath-1.5.4.0-e69b/src/System.FilePath.Posix.html#%3C%2F%3E"><span class="hs-operator hs-var">&lt;/&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">FilePath
</span><span class="hs-string">&quot;all&quot;</span></span><span> </span><span class="annot"><span class="annottext">FilePath -&gt; FilePath -&gt; FilePath
</span><a href="../../filepath-1.5.4.0-e69b/src/System.FilePath.Posix.html#%3C.%3E"><span class="hs-operator hs-var">&lt;.&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">FilePath
</span><span class="hs-string">&quot;js&quot;</span></span><span>
</span><span id="line-739"></span><span>      </span><span class="annot"><a href="#local-6989586621682960210"><span class="hs-identifier hs-type">nodePgm</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="../../bytestring-0.12.2.0-7dd0/src/Data.ByteString.Internal.Type.html#ByteString"><span class="hs-identifier hs-type">B.ByteString</span></a></span><span>
</span><span id="line-740"></span><span>      </span><span id="local-6989586621682960210"><span class="annot"><a href="#local-6989586621682960210"><span class="hs-identifier hs-var hs-var">nodePgm</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ByteString
</span><span class="hs-string">&quot;node&quot;</span></span><span>
</span><span id="line-741"></span><span>  </span><span id="local-6989586621682960211"><span class="annot"><a href="#local-6989586621682960211"><span class="hs-identifier hs-var">src</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><a href="../../bytestring-0.12.2.0-7dd0/src/Data.ByteString.html#readFile"><span class="hs-identifier hs-type">B.readFile</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621682960206"><span class="hs-identifier hs-type">cd</span></a></span><span> </span><span class="annot"><a href="../../filepath-1.5.4.0-e69b/src/System.FilePath.Posix.html#%3C%2F%3E"><span class="hs-operator hs-type">&lt;/&gt;</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682960209"><span class="hs-identifier hs-type">srcFile</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-742"></span><span>  </span><span class="annot"><a href="../../bytestring-0.12.2.0-7dd0/src/Data.ByteString.html#writeFile"><span class="hs-identifier hs-type">B.writeFile</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682960208"><span class="hs-identifier hs-type">runner</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-string">&quot;#!/usr/bin/env &quot;</span></span><span> </span><span class="annot"><span class="hs-operator hs-type">&lt;&gt;</span></span><span> </span><span class="annot"><a href="#local-6989586621682960210"><span class="hs-identifier hs-type">nodePgm</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">&lt;&gt;</span></span><span> </span><span class="annot"><span class="hs-string">&quot;\n&quot;</span></span><span> </span><span class="annot"><span class="hs-operator hs-type">&lt;&gt;</span></span><span> </span><span class="annot"><a href="#local-6989586621682960211"><span class="hs-identifier hs-type">src</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-743"></span><span>  </span><span id="local-6989586621682960212"><span class="annot"><a href="#local-6989586621682960212"><span class="hs-identifier hs-var">perms</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><a href="../../directory-1.3.9.0-af18/src/System.Directory.html#getPermissions"><span class="hs-identifier hs-type">getPermissions</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682960208"><span class="hs-identifier hs-type">runner</span></a></span><span>
</span><span id="line-744"></span><span>  </span><span class="annot"><a href="../../directory-1.3.9.0-af18/src/System.Directory.html#setPermissions"><span class="hs-identifier hs-type">setPermissions</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682960208"><span class="hs-identifier hs-type">runner</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621682960212"><span class="hs-identifier hs-type">perms</span></a></span><span> </span><span class="hs-special">{</span><span class="annot"><a href="../../directory-1.3.9.0-af18/src/System.Directory.Internal.Common.html#executable"><span class="hs-identifier hs-var">executable</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="hs-identifier hs-type">True</span></span><span class="hs-special">}</span><span class="hs-special">)</span><span>
</span><span id="line-745"></span><span>
</span><span id="line-746"></span><span class="annot"><a href="GHC.StgToJS.Linker.Linker.html#rtsExterns"><span class="hs-identifier hs-type">rtsExterns</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Data.FastString.html#FastString"><span class="hs-identifier hs-type">FastString</span></a></span><span>
</span><span id="line-747"></span><span id="rtsExterns"><span class="annot"><span class="annottext">rtsExterns :: FastString
</span><a href="GHC.StgToJS.Linker.Linker.html#rtsExterns"><span class="hs-identifier hs-var hs-var">rtsExterns</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-748"></span><span>  </span><span class="hs-comment">-- Google Closure Compiler --externs option is deprecated.</span><span>
</span><span id="line-749"></span><span>  </span><span class="hs-comment">-- Need pass them as a js file with @externs module-level jsdoc.</span><span>
</span><span id="line-750"></span><span>  </span><span class="annot"><span class="annottext">FastString
</span><span class="hs-string">&quot;/** @externs @suppress {duplicate} */\n&quot;</span></span><span> </span><span class="annot"><span class="annottext">FastString -&gt; FastString -&gt; FastString
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span>
</span><span id="line-751"></span><span>  </span><span class="annot"><span class="annottext">FastString
</span><span class="hs-string">&quot;// GHCJS RTS externs for closure compiler ADVANCED_OPTIMIZATIONS\n\n&quot;</span></span><span> </span><span class="annot"><span class="annottext">FastString -&gt; FastString -&gt; FastString
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span>
</span><span id="line-752"></span><span>  </span><span class="annot"><span class="annottext">[FastString] -&gt; FastString
forall a. Monoid a =&gt; [a] -&gt; a
</span><span class="hs-identifier hs-var">mconcat</span></span><span>
</span><span id="line-753"></span><span>    </span><span class="hs-comment">-- See GHC.StgToJS</span><span>
</span><span id="line-754"></span><span>    </span><span class="hs-comment">-- We connect all payload fields &quot;dXX&quot; on JavaScript Object.</span><span>
</span><span id="line-755"></span><span>    </span><span class="hs-comment">-- That's most simple way to make Google Closure Compiler prevent</span><span>
</span><span id="line-756"></span><span>    </span><span class="hs-comment">-- property names mangling.</span><span>
</span><span id="line-757"></span><span>    </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(BlockId -&gt; FastString) -&gt; [BlockId] -&gt; [FastString]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><span class="hs-identifier hs-var">map</span></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span id="local-6989586621682960215"><span class="annot"><span class="annottext">BlockId
</span><a href="#local-6989586621682960215"><span class="hs-identifier hs-var">x</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">FastString
</span><span class="hs-string">&quot;/** @type {*} */\nObject.d&quot;</span></span><span> </span><span class="annot"><span class="annottext">FastString -&gt; FastString -&gt; FastString
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">FilePath -&gt; FastString
</span><a href="GHC.Data.FastString.html#mkFastString"><span class="hs-identifier hs-var">mkFastString</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">BlockId -&gt; FilePath
forall a. Show a =&gt; a -&gt; FilePath
</span><span class="hs-identifier hs-var">show</span></span><span> </span><span class="annot"><span class="annottext">BlockId
</span><a href="#local-6989586621682960215"><span class="hs-identifier hs-var">x</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">FastString -&gt; FastString -&gt; FastString
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">FastString
</span><span class="hs-string">&quot;;\n&quot;</span></span><span class="hs-special">)</span><span>
</span><span id="line-758"></span><span>    </span><span class="hs-special">[</span><span class="hs-special">(</span><span class="annot"><span class="annottext">BlockId
</span><span class="hs-number">1</span></span><span class="hs-glyph">::</span><span class="annot"><span class="hs-identifier hs-type">Int</span></span><span class="hs-special">)</span><span class="hs-glyph">..</span><span class="annot"><span class="annottext">BlockId
</span><span class="hs-number">16384</span></span><span class="hs-special">]</span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">FastString -&gt; FastString -&gt; FastString
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span>
</span><span id="line-759"></span><span>  </span><span class="annot"><span class="annottext">[FastString] -&gt; FastString
forall a. Monoid a =&gt; [a] -&gt; a
</span><span class="hs-identifier hs-var">mconcat</span></span><span>
</span><span id="line-760"></span><span>    </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(FastString -&gt; FastString) -&gt; [FastString] -&gt; [FastString]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><span class="hs-identifier hs-var">map</span></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span id="local-6989586621682960217"><span class="annot"><span class="annottext">FastString
</span><a href="#local-6989586621682960217"><span class="hs-identifier hs-var">x</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">FastString
</span><span class="hs-string">&quot;/** @type {*} */\nObject.&quot;</span></span><span> </span><span class="annot"><span class="annottext">FastString -&gt; FastString -&gt; FastString
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">FastString
</span><a href="#local-6989586621682960217"><span class="hs-identifier hs-var">x</span></a></span><span> </span><span class="annot"><span class="annottext">FastString -&gt; FastString -&gt; FastString
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">FastString
</span><span class="hs-string">&quot;;\n&quot;</span></span><span class="hs-special">)</span><span>
</span><span id="line-761"></span><span>    </span><span class="hs-comment">-- We do same for special STG properties as well.</span><span>
</span><span id="line-762"></span><span>    </span><span class="hs-special">[</span><span class="annot"><span class="annottext">FastString
</span><span class="hs-string">&quot;m&quot;</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">FastString
</span><span class="hs-string">&quot;f&quot;</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">FastString
</span><span class="hs-string">&quot;cc&quot;</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">FastString
</span><span class="hs-string">&quot;t&quot;</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">FastString
</span><span class="hs-string">&quot;size&quot;</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">FastString
</span><span class="hs-string">&quot;i&quot;</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">FastString
</span><span class="hs-string">&quot;n&quot;</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">FastString
</span><span class="hs-string">&quot;a&quot;</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">FastString
</span><span class="hs-string">&quot;r&quot;</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">FastString
</span><span class="hs-string">&quot;s&quot;</span></span><span class="hs-special">]</span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">FastString -&gt; FastString -&gt; FastString
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span>
</span><span id="line-763"></span><span>  </span><span class="annot"><span class="annottext">[FastString] -&gt; FastString
forall a. Monoid a =&gt; [a] -&gt; a
</span><span class="hs-identifier hs-var">mconcat</span></span><span>
</span><span id="line-764"></span><span>    </span><span class="hs-special">[</span><span> </span><span class="hs-comment">-- Used at h$mkForeignCallback</span><span>
</span><span id="line-765"></span><span>      </span><span class="annot"><span class="annottext">FastString
</span><span class="hs-string">&quot;/** @type {*} */\nObject.mv;\n&quot;</span></span><span>
</span><span id="line-766"></span><span>    </span><span class="hs-special">]</span><span> </span><span class="annot"><span class="annottext">FastString -&gt; FastString -&gt; FastString
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span>
</span><span id="line-767"></span><span>  </span><span class="annot"><span class="annottext">[FastString] -&gt; FastString
forall a. Monoid a =&gt; [a] -&gt; a
</span><span class="hs-identifier hs-var">mconcat</span></span><span>
</span><span id="line-768"></span><span>    </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(FastString -&gt; FastString) -&gt; [FastString] -&gt; [FastString]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><span class="hs-identifier hs-var">map</span></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span id="local-6989586621682960218"><span class="annot"><span class="annottext">FastString
</span><a href="#local-6989586621682960218"><span class="hs-identifier hs-var">x</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">FastString
</span><a href="#local-6989586621682960218"><span class="hs-identifier hs-var">x</span></a></span><span> </span><span class="annot"><span class="annottext">FastString -&gt; FastString -&gt; FastString
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">FastString
</span><span class="hs-string">&quot;;\n&quot;</span></span><span class="hs-special">)</span><span>
</span><span id="line-769"></span><span>    </span><span class="hs-special">[</span><span> </span><span class="hs-comment">-- Externs needed by node environment</span><span>
</span><span id="line-770"></span><span>      </span><span class="annot"><span class="annottext">FastString
</span><span class="hs-string">&quot;/** @type {string} */ var __dirname&quot;</span></span><span>
</span><span id="line-771"></span><span>      </span><span class="hs-comment">-- Copied minimally from https://github.com/externs/nodejs/blob/6c6882c73efcdceecf42e7ba11f1e3e5c9c041f0/v8/nodejs.js#L8</span><span>
</span><span id="line-772"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">FastString
</span><span class="hs-string">&quot;/** @const */ var NodeJS = {}&quot;</span></span><span>
</span><span id="line-773"></span><span>      </span><span class="hs-comment">-- NodeJS Stream interface</span><span>
</span><span id="line-774"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">FastString
</span><span class="hs-string">&quot;/** @interface */ NodeJS.Stream = function () {}&quot;</span></span><span>
</span><span id="line-775"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">FastString
</span><span class="hs-string">&quot;/** @template THIS @this {THIS} @return {THIS} */ NodeJS.Stream.prototype.on = function() {}&quot;</span></span><span>
</span><span id="line-776"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">FastString
</span><span class="hs-string">&quot;/** @return {boolean} */ NodeJS.Stream.prototype.write = function() {}&quot;</span></span><span>
</span><span id="line-777"></span><span>      </span><span class="hs-comment">-- NodeJS versions property contains actual versions of the environment</span><span>
</span><span id="line-778"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">FastString
</span><span class="hs-string">&quot;/** @interface */ NodeJS.ProcessVersions = function() {}&quot;</span></span><span>
</span><span id="line-779"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">FastString
</span><span class="hs-string">&quot;/** @type {string} */ NodeJS.ProcessVersions.prototype.node&quot;</span></span><span>
</span><span id="line-780"></span><span>      </span><span class="hs-comment">-- NodeJS Process interface</span><span>
</span><span id="line-781"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">FastString
</span><span class="hs-string">&quot;/** @interface */ NodeJS.Process = function() {}&quot;</span></span><span>
</span><span id="line-782"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">FastString
</span><span class="hs-string">&quot;/** @type {!NodeJS.Stream} */ NodeJS.Process.prototype.stderr&quot;</span></span><span>
</span><span id="line-783"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">FastString
</span><span class="hs-string">&quot;/** @type {!NodeJS.Stream} */ NodeJS.Process.prototype.stdin&quot;</span></span><span>
</span><span id="line-784"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">FastString
</span><span class="hs-string">&quot;/** @type {!NodeJS.Stream} */ NodeJS.Process.prototype.stdout&quot;</span></span><span>
</span><span id="line-785"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">FastString
</span><span class="hs-string">&quot;/** @type {!NodeJS.ProcessVersions} */ NodeJS.Process.prototype.versions&quot;</span></span><span>
</span><span id="line-786"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">FastString
</span><span class="hs-string">&quot;/** @return {?} */ NodeJS.Process.prototype.exit = function() {}&quot;</span></span><span>
</span><span id="line-787"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">FastString
</span><span class="hs-string">&quot;/** @type {!Array&lt;string&gt;} */ NodeJS.Process.prototype.argv&quot;</span></span><span>
</span><span id="line-788"></span><span>      </span><span class="hs-comment">-- NodeJS Process definition</span><span>
</span><span id="line-789"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">FastString
</span><span class="hs-string">&quot;/** @type {!NodeJS.Process} */ var process&quot;</span></span><span>
</span><span id="line-790"></span><span>      </span><span class="hs-comment">-- NodeJS Buffer class</span><span>
</span><span id="line-791"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">FastString
</span><span class="hs-string">&quot;/** @extends {Uint8Array} @constructor */ function Buffer(arg1, encoding) {}&quot;</span></span><span>
</span><span id="line-792"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">FastString
</span><span class="hs-string">&quot;/** @return {!Buffer} */ Buffer.alloc = function() {}&quot;</span></span><span>
</span><span id="line-793"></span><span>      </span><span class="hs-comment">-- Emscripten Module</span><span>
</span><span id="line-794"></span><span>      </span><span class="hs-comment">-- Emscripten RTS's definitions we use in mem.js to support C sources.</span><span>
</span><span id="line-795"></span><span>      </span><span class="hs-comment">-- When we link with emcc the actual definitions are linked, but when we</span><span>
</span><span id="line-796"></span><span>      </span><span class="hs-comment">-- don't use C sources we don't use emcc and these variables are detected</span><span>
</span><span id="line-797"></span><span>      </span><span class="hs-comment">-- as undefined.</span><span>
</span><span id="line-798"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">FastString
</span><span class="hs-string">&quot;/** @type {*} */ var Module&quot;</span></span><span>
</span><span id="line-799"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">FastString
</span><span class="hs-string">&quot;/** @type {!Int8Array} */ Module.HEAP8&quot;</span></span><span>
</span><span id="line-800"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">FastString
</span><span class="hs-string">&quot;/** @type {!Uint8Array} */ Module.HEAPU8&quot;</span></span><span>
</span><span id="line-801"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">FastString
</span><span class="hs-string">&quot;/** @return {number} */ Module.getEmptyTableSlot = function() {}&quot;</span></span><span>
</span><span id="line-802"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">FastString
</span><span class="hs-string">&quot;/** @return {*} */ Module._free = function() {}&quot;</span></span><span>
</span><span id="line-803"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">FastString
</span><span class="hs-string">&quot;/** @return {*} */ Module._malloc = function() {}&quot;</span></span><span>
</span><span id="line-804"></span><span>      </span><span class="hs-comment">-- Mozilla's Narcissus (JS in JS interpreter implemented on top of SpiderMonkey) environment</span><span>
</span><span id="line-805"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">FastString
</span><span class="hs-string">&quot;/** @type {*} */ var putstr&quot;</span></span><span>
</span><span id="line-806"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">FastString
</span><span class="hs-string">&quot;/** @type {*} */ var printErr&quot;</span></span><span>
</span><span id="line-807"></span><span>      </span><span class="hs-comment">-- Apples's JavaScriptCore environment</span><span>
</span><span id="line-808"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">FastString
</span><span class="hs-string">&quot;/** @type {*} */ var debug&quot;</span></span><span>
</span><span id="line-809"></span><span>    </span><span class="hs-special">]</span><span class="hs-special">)</span><span>
</span><span id="line-810"></span><span>
</span><span id="line-811"></span><span class="annot"><a href="GHC.StgToJS.Linker.Linker.html#writeExterns"><span class="hs-identifier hs-type">writeExterns</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">FilePath</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-812"></span><span id="writeExterns"><span class="annot"><span class="annottext">writeExterns :: FilePath -&gt; IO ()
</span><a href="GHC.StgToJS.Linker.Linker.html#writeExterns"><span class="hs-identifier hs-var hs-var">writeExterns</span></a></span></span><span> </span><span id="local-6989586621682960219"><span class="annot"><span class="annottext">FilePath
</span><a href="#local-6989586621682960219"><span class="hs-identifier hs-var">out</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">FilePath -&gt; FilePath -&gt; IO ()
</span><span class="hs-identifier hs-var">writeFile</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">FilePath
</span><a href="#local-6989586621682960219"><span class="hs-identifier hs-var">out</span></a></span><span> </span><span class="annot"><span class="annottext">FilePath -&gt; FilePath -&gt; FilePath
</span><a href="../../filepath-1.5.4.0-e69b/src/System.FilePath.Posix.html#%3C%2F%3E"><span class="hs-operator hs-var">&lt;/&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">FilePath
</span><span class="hs-string">&quot;all.externs.js&quot;</span></span><span class="hs-special">)</span><span>
</span><span id="line-813"></span><span>  </span><span class="annot"><span class="annottext">(FilePath -&gt; IO ()) -&gt; FilePath -&gt; IO ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">FastString -&gt; FilePath
</span><a href="GHC.Data.FastString.html#unpackFS"><span class="hs-identifier hs-var">unpackFS</span></a></span><span> </span><span class="annot"><span class="annottext">FastString
</span><a href="GHC.StgToJS.Linker.Linker.html#rtsExterns"><span class="hs-identifier hs-var">rtsExterns</span></a></span><span>
</span><span id="line-814"></span><span>
</span><span id="line-815"></span><span class="hs-comment">-- | Get all block dependencies for a given set of roots</span><span>
</span><span id="line-816"></span><span class="hs-comment">--</span><span>
</span><span id="line-817"></span><span class="hs-comment">-- Returns the updated block info map and the blocks.</span><span>
</span><span id="line-818"></span><span class="annot"><a href="GHC.StgToJS.Linker.Linker.html#getDeps"><span class="hs-identifier hs-type">getDeps</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="../../containers-0.7-5a8f/src/Data.Map.Internal.html#Map"><span class="hs-identifier hs-type">Map</span></a></span><span> </span><span class="annot"><a href="GHC.Unit.Types.html#Module"><span class="hs-identifier hs-type">Module</span></a></span><span> </span><span class="annot"><a href="GHC.StgToJS.Object.html#LocatedBlockInfo"><span class="hs-identifier hs-type">LocatedBlockInfo</span></a></span><span>     </span><span class="annot"><span class="hs-comment">-- ^ Block info per module</span></span><span>
</span><span id="line-819"></span><span>        </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Unit.Types.html#Module"><span class="hs-identifier hs-type">Module</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="annot"><a href="GHC.StgToJS.Object.html#LocatedBlockInfo"><span class="hs-identifier hs-type">LocatedBlockInfo</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="hs-comment">-- ^ Used to load block info if missing</span></span><span>
</span><span id="line-820"></span><span>        </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="../../containers-0.7-5a8f/src/Data.Set.Internal.html#Set"><span class="hs-identifier hs-type">Set</span></a></span><span> </span><span class="annot"><a href="GHC.StgToJS.Object.html#ExportedFun"><span class="hs-identifier hs-type">ExportedFun</span></a></span><span>                 </span><span class="annot"><span class="hs-comment">-- ^ start here</span></span><span>
</span><span id="line-821"></span><span>        </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="../../containers-0.7-5a8f/src/Data.Set.Internal.html#Set"><span class="hs-identifier hs-type">Set</span></a></span><span> </span><span class="annot"><a href="GHC.StgToJS.Object.html#BlockRef"><span class="hs-identifier hs-type">BlockRef</span></a></span><span>                    </span><span class="annot"><span class="hs-comment">-- ^ and also link these</span></span><span>
</span><span id="line-822"></span><span>        </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../../containers-0.7-5a8f/src/Data.Map.Internal.html#Map"><span class="hs-identifier hs-type">Map</span></a></span><span> </span><span class="annot"><a href="GHC.Unit.Types.html#Module"><span class="hs-identifier hs-type">Module</span></a></span><span> </span><span class="annot"><a href="GHC.StgToJS.Object.html#LocatedBlockInfo"><span class="hs-identifier hs-type">LocatedBlockInfo</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="../../containers-0.7-5a8f/src/Data.Set.Internal.html#Set"><span class="hs-identifier hs-type">Set</span></a></span><span> </span><span class="annot"><a href="GHC.StgToJS.Object.html#BlockRef"><span class="hs-identifier hs-type">BlockRef</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-823"></span><span id="getDeps"><span class="annot"><span class="annottext">getDeps :: Map Module LocatedBlockInfo
-&gt; (Module -&gt; IO LocatedBlockInfo)
-&gt; Set ExportedFun
-&gt; Set BlockRef
-&gt; IO (Map Module LocatedBlockInfo, Set BlockRef)
</span><a href="GHC.StgToJS.Linker.Linker.html#getDeps"><span class="hs-identifier hs-var hs-var">getDeps</span></a></span></span><span> </span><span id="local-6989586621682960220"><span class="annot"><span class="annottext">Map Module LocatedBlockInfo
</span><a href="#local-6989586621682960220"><span class="hs-identifier hs-var">init_infos</span></a></span></span><span> </span><span id="local-6989586621682960221"><span class="annot"><span class="annottext">Module -&gt; IO LocatedBlockInfo
</span><a href="#local-6989586621682960221"><span class="hs-identifier hs-var">load_info</span></a></span></span><span> </span><span id="local-6989586621682960222"><span class="annot"><span class="annottext">Set ExportedFun
</span><a href="#local-6989586621682960222"><span class="hs-identifier hs-var">root_funs</span></a></span></span><span> </span><span id="local-6989586621682960223"><span class="annot"><span class="annottext">Set BlockRef
</span><a href="#local-6989586621682960223"><span class="hs-identifier hs-var">root_blocks</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Map Module LocatedBlockInfo
-&gt; Set BlockRef
-&gt; Set BlockRef
-&gt; [ExportedFun]
-&gt; IO (Map Module LocatedBlockInfo, Set BlockRef)
</span><a href="#local-6989586621682960224"><span class="hs-identifier hs-var">traverse_funs</span></a></span><span> </span><span class="annot"><span class="annottext">Map Module LocatedBlockInfo
</span><a href="#local-6989586621682960220"><span class="hs-identifier hs-var">init_infos</span></a></span><span> </span><span class="annot"><span class="annottext">Set BlockRef
forall a. Set a
</span><a href="../../containers-0.7-5a8f/src/Data.Set.Internal.html#empty"><span class="hs-identifier hs-var">S.empty</span></a></span><span> </span><span class="annot"><span class="annottext">Set BlockRef
</span><a href="#local-6989586621682960223"><span class="hs-identifier hs-var">root_blocks</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Set ExportedFun -&gt; [ExportedFun]
forall a. Set a -&gt; [a]
</span><a href="../../containers-0.7-5a8f/src/Data.Set.Internal.html#toList"><span class="hs-identifier hs-var">S.toList</span></a></span><span> </span><span class="annot"><span class="annottext">Set ExportedFun
</span><a href="#local-6989586621682960222"><span class="hs-identifier hs-var">root_funs</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-824"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-825"></span><span>    </span><span class="hs-comment">-- A block may depend on:</span><span>
</span><span id="line-826"></span><span>    </span><span class="hs-comment">--  1. other blocks from the same module</span><span>
</span><span id="line-827"></span><span>    </span><span class="hs-comment">--  2. exported functions from another module</span><span>
</span><span id="line-828"></span><span>    </span><span class="hs-comment">--</span><span>
</span><span id="line-829"></span><span>    </span><span class="hs-comment">-- Process:</span><span>
</span><span id="line-830"></span><span>    </span><span class="hs-comment">--  1. We use the BlockInfos to find the block corresponding to every</span><span>
</span><span id="line-831"></span><span>    </span><span class="hs-comment">--  exported root functions.</span><span>
</span><span id="line-832"></span><span>    </span><span class="hs-comment">--</span><span>
</span><span id="line-833"></span><span>    </span><span class="hs-comment">--  2. We add these blocks to the set of root_blocks if they aren't already</span><span>
</span><span id="line-834"></span><span>    </span><span class="hs-comment">--  added to the result.</span><span>
</span><span id="line-835"></span><span>    </span><span class="hs-comment">--</span><span>
</span><span id="line-836"></span><span>    </span><span class="hs-comment">--  3. Then we traverse the root_blocks to find their dependencies and we</span><span>
</span><span id="line-837"></span><span>    </span><span class="hs-comment">--  add them to root_blocks (if they aren't already added to the result) and</span><span>
</span><span id="line-838"></span><span>    </span><span class="hs-comment">--  to root_funs.</span><span>
</span><span id="line-839"></span><span>    </span><span class="hs-comment">--</span><span>
</span><span id="line-840"></span><span>    </span><span class="hs-comment">--  4. back to 1</span><span>
</span><span id="line-841"></span><span>
</span><span id="line-842"></span><span>    </span><span id="local-6989586621682960226"><span class="annot"><span class="annottext">lookup_info :: Map Module LocatedBlockInfo
-&gt; Module -&gt; IO (Map Module LocatedBlockInfo, BlockInfo)
</span><a href="#local-6989586621682960226"><span class="hs-identifier hs-var hs-var">lookup_info</span></a></span></span><span> </span><span id="local-6989586621682960227"><span class="annot"><span class="annottext">Map Module LocatedBlockInfo
</span><a href="#local-6989586621682960227"><span class="hs-identifier hs-var">infos</span></a></span></span><span> </span><span id="local-6989586621682960228"><span class="annot"><span class="annottext">Module
</span><a href="#local-6989586621682960228"><span class="hs-identifier hs-var">mod</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">Module -&gt; Map Module LocatedBlockInfo -&gt; Maybe LocatedBlockInfo
forall k a. Ord k =&gt; k -&gt; Map k a -&gt; Maybe a
</span><a href="../../containers-0.7-5a8f/src/Data.Map.Internal.html#lookup"><span class="hs-identifier hs-var">M.lookup</span></a></span><span> </span><span class="annot"><span class="annottext">Module
</span><a href="#local-6989586621682960228"><span class="hs-identifier hs-var">mod</span></a></span><span> </span><span class="annot"><span class="annottext">Map Module LocatedBlockInfo
</span><a href="#local-6989586621682960227"><span class="hs-identifier hs-var">infos</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-843"></span><span>      </span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span id="local-6989586621682960229"><span class="annot"><span class="annottext">LocatedBlockInfo
</span><a href="#local-6989586621682960229"><span class="hs-identifier hs-var">info</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">(Map Module LocatedBlockInfo, BlockInfo)
-&gt; IO (Map Module LocatedBlockInfo, BlockInfo)
forall a. a -&gt; IO a
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">pure</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Map Module LocatedBlockInfo
</span><a href="#local-6989586621682960227"><span class="hs-identifier hs-var">infos</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">LocatedBlockInfo -&gt; BlockInfo
</span><a href="GHC.StgToJS.Object.html#lbi_info"><span class="hs-identifier hs-var">lbi_info</span></a></span><span> </span><span class="annot"><span class="annottext">LocatedBlockInfo
</span><a href="#local-6989586621682960229"><span class="hs-identifier hs-var">info</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-844"></span><span>      </span><span class="annot"><span class="annottext">Maybe LocatedBlockInfo
</span><span class="hs-identifier hs-var">Nothing</span></span><span>   </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-845"></span><span>        </span><span class="hs-comment">-- load info and update cache with it</span><span>
</span><span id="line-846"></span><span>        </span><span id="local-6989586621682960230"><span class="annot"><a href="#local-6989586621682960230"><span class="hs-identifier hs-var">info</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Module -&gt; IO LocatedBlockInfo
</span><a href="#local-6989586621682960221"><span class="hs-identifier hs-var">load_info</span></a></span><span> </span><span class="annot"><span class="annottext">Module
</span><a href="#local-6989586621682960228"><span class="hs-identifier hs-var">mod</span></a></span><span>
</span><span id="line-847"></span><span>        </span><span class="annot"><span class="hs-identifier hs-type">pure</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../../containers-0.7-5a8f/src/Data.Map.Strict.Internal.html#insert"><span class="hs-identifier hs-type">M.insert</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682960228"><span class="hs-identifier hs-type">mod</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682960230"><span class="hs-identifier hs-type">info</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682960227"><span class="hs-identifier hs-type">infos</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.StgToJS.Object.html#lbi_info"><span class="hs-identifier hs-var">lbi_info</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682960230"><span class="hs-identifier hs-type">info</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-848"></span><span>
</span><span id="line-849"></span><span>    </span><span class="annot"><a href="#local-6989586621682960232"><span class="hs-identifier hs-type">traverse_blocks</span></a></span><span>
</span><span id="line-850"></span><span>      </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="../../containers-0.7-5a8f/src/Data.Map.Internal.html#Map"><span class="hs-identifier hs-type">Map</span></a></span><span> </span><span class="annot"><a href="GHC.Unit.Types.html#Module"><span class="hs-identifier hs-type">Module</span></a></span><span> </span><span class="annot"><a href="GHC.StgToJS.Object.html#LocatedBlockInfo"><span class="hs-identifier hs-type">LocatedBlockInfo</span></a></span><span>
</span><span id="line-851"></span><span>      </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="../../containers-0.7-5a8f/src/Data.Set.Internal.html#Set"><span class="hs-identifier hs-type">Set</span></a></span><span> </span><span class="annot"><a href="GHC.StgToJS.Object.html#BlockRef"><span class="hs-identifier hs-type">BlockRef</span></a></span><span>
</span><span id="line-852"></span><span>      </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="../../containers-0.7-5a8f/src/Data.Set.Internal.html#Set"><span class="hs-identifier hs-type">Set</span></a></span><span> </span><span class="annot"><a href="GHC.StgToJS.Object.html#BlockRef"><span class="hs-identifier hs-type">BlockRef</span></a></span><span>
</span><span id="line-853"></span><span>      </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../../containers-0.7-5a8f/src/Data.Map.Internal.html#Map"><span class="hs-identifier hs-type">Map</span></a></span><span> </span><span class="annot"><a href="GHC.Unit.Types.html#Module"><span class="hs-identifier hs-type">Module</span></a></span><span> </span><span class="annot"><a href="GHC.StgToJS.Object.html#LocatedBlockInfo"><span class="hs-identifier hs-type">LocatedBlockInfo</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="../../containers-0.7-5a8f/src/Data.Set.Internal.html#Set"><span class="hs-identifier hs-type">Set</span></a></span><span> </span><span class="annot"><a href="GHC.StgToJS.Object.html#BlockRef"><span class="hs-identifier hs-type">BlockRef</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-854"></span><span>    </span><span id="local-6989586621682960232"><span class="annot"><span class="annottext">traverse_blocks :: Map Module LocatedBlockInfo
-&gt; Set BlockRef
-&gt; Set BlockRef
-&gt; IO (Map Module LocatedBlockInfo, Set BlockRef)
</span><a href="#local-6989586621682960232"><span class="hs-identifier hs-var hs-var">traverse_blocks</span></a></span></span><span> </span><span id="local-6989586621682960233"><span class="annot"><span class="annottext">Map Module LocatedBlockInfo
</span><a href="#local-6989586621682960233"><span class="hs-identifier hs-var">infos</span></a></span></span><span> </span><span id="local-6989586621682960234"><span class="annot"><span class="annottext">Set BlockRef
</span><a href="#local-6989586621682960234"><span class="hs-identifier hs-var">result</span></a></span></span><span> </span><span id="local-6989586621682960235"><span class="annot"><span class="annottext">Set BlockRef
</span><a href="#local-6989586621682960235"><span class="hs-identifier hs-var">open</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">Set BlockRef -&gt; Maybe (BlockRef, Set BlockRef)
forall a. Set a -&gt; Maybe (a, Set a)
</span><a href="../../containers-0.7-5a8f/src/Data.Set.Internal.html#minView"><span class="hs-identifier hs-var">S.minView</span></a></span><span> </span><span class="annot"><span class="annottext">Set BlockRef
</span><a href="#local-6989586621682960235"><span class="hs-identifier hs-var">open</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-855"></span><span>      </span><span class="annot"><span class="annottext">Maybe (BlockRef, Set BlockRef)
</span><span class="hs-identifier hs-var">Nothing</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">(Map Module LocatedBlockInfo, Set BlockRef)
-&gt; IO (Map Module LocatedBlockInfo, Set BlockRef)
forall a. a -&gt; IO a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Map Module LocatedBlockInfo
</span><a href="#local-6989586621682960233"><span class="hs-identifier hs-var">infos</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Set BlockRef
</span><a href="#local-6989586621682960234"><span class="hs-identifier hs-var">result</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-856"></span><span>      </span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span class="hs-special">(</span><span id="local-6989586621682960237"><span class="annot"><span class="annottext">BlockRef
</span><a href="#local-6989586621682960237"><span class="hs-identifier hs-var">ref</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682960238"><span class="annot"><span class="annottext">Set BlockRef
</span><a href="#local-6989586621682960238"><span class="hs-identifier hs-var">open'</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-857"></span><span>          </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621682960239"><span class="annot"><span class="annottext">mod :: Module
</span><a href="#local-6989586621682960239"><span class="hs-identifier hs-var hs-var hs-var">mod</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">BlockRef -&gt; Module
</span><a href="GHC.StgToJS.Object.html#block_ref_mod"><span class="hs-identifier hs-var">block_ref_mod</span></a></span><span> </span><span class="annot"><span class="annottext">BlockRef
</span><a href="#local-6989586621682960237"><span class="hs-identifier hs-var">ref</span></a></span><span>
</span><span id="line-858"></span><span>          </span><span class="hs-glyph">!</span><span class="hs-special">(</span><span id="local-6989586621682960241"><span class="annot"><a href="#local-6989586621682960241"><span class="hs-identifier hs-var">infos'</span></a></span></span><span class="hs-special">,</span><span id="local-6989586621682960242"><span class="annot"><a href="#local-6989586621682960242"><span class="hs-identifier hs-var">info</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Map Module LocatedBlockInfo
-&gt; Module -&gt; IO (Map Module LocatedBlockInfo, BlockInfo)
</span><a href="#local-6989586621682960226"><span class="hs-identifier hs-var">lookup_info</span></a></span><span> </span><span class="annot"><span class="annottext">Map Module LocatedBlockInfo
</span><a href="#local-6989586621682960233"><span class="hs-identifier hs-var">infos</span></a></span><span> </span><span class="annot"><span class="annottext">Module
</span><a href="#local-6989586621682960239"><span class="hs-identifier hs-var">mod</span></a></span><span>
</span><span id="line-859"></span><span>          </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621682960243"><span class="annot"><a href="#local-6989586621682960243"><span class="hs-identifier hs-var hs-var">block</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>  </span><span class="annot"><span class="annottext">BlockInfo -&gt; Array BlockId BlockDeps
</span><a href="GHC.StgToJS.Object.html#bi_block_deps"><span class="hs-identifier hs-var">bi_block_deps</span></a></span><span> </span><span class="annot"><span class="annottext">BlockInfo
</span><a href="#local-6989586621682960242"><span class="hs-identifier hs-var">info</span></a></span><span> </span><span class="annot"><span class="annottext">Array BlockId BlockDeps -&gt; BlockId -&gt; BlockDeps
forall i e. Ix i =&gt; Array i e -&gt; i -&gt; e
</span><span class="hs-operator hs-var">!</span></span><span> </span><span class="annot"><span class="annottext">BlockRef -&gt; BlockId
</span><a href="GHC.StgToJS.Object.html#block_ref_idx"><span class="hs-identifier hs-var">block_ref_idx</span></a></span><span> </span><span class="annot"><span class="annottext">BlockRef
</span><a href="#local-6989586621682960237"><span class="hs-identifier hs-var">ref</span></a></span><span>
</span><span id="line-860"></span><span>              </span><span id="local-6989586621682960247"><span class="annot"><a href="#local-6989586621682960247"><span class="hs-identifier hs-var hs-var">result'</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">BlockRef -&gt; Set BlockRef -&gt; Set BlockRef
forall a. Ord a =&gt; a -&gt; Set a -&gt; Set a
</span><a href="../../containers-0.7-5a8f/src/Data.Set.Internal.html#insert"><span class="hs-identifier hs-var">S.insert</span></a></span><span> </span><span class="annot"><span class="annottext">BlockRef
</span><a href="#local-6989586621682960237"><span class="hs-identifier hs-var">ref</span></a></span><span> </span><span class="annot"><span class="annottext">Set BlockRef
</span><a href="#local-6989586621682960234"><span class="hs-identifier hs-var">result</span></a></span><span>
</span><span id="line-861"></span><span>              </span><span id="local-6989586621682960249"><span class="annot"><a href="#local-6989586621682960249"><span class="hs-identifier hs-var hs-var">to_block_ref</span></a></span></span><span> </span><span id="local-6989586621682960250"><span class="annot"><span class="annottext">BlockId
</span><a href="#local-6989586621682960250"><span class="hs-identifier hs-var">i</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="GHC.StgToJS.Object.html#BlockRef"><span class="hs-identifier hs-type">BlockRef</span></a></span><span>
</span><span id="line-862"></span><span>                                </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">block_ref_mod :: Module
</span><a href="GHC.StgToJS.Object.html#block_ref_mod"><span class="hs-identifier hs-var">block_ref_mod</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Module
</span><a href="#local-6989586621682960239"><span class="hs-identifier hs-var">mod</span></a></span><span>
</span><span id="line-863"></span><span>                                </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">block_ref_idx :: BlockId
</span><a href="GHC.StgToJS.Object.html#block_ref_idx"><span class="hs-identifier hs-var">block_ref_idx</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">BlockId
</span><a href="#local-6989586621682960250"><span class="hs-identifier hs-var">i</span></a></span><span>
</span><span id="line-864"></span><span>                                </span><span class="hs-special">}</span><span>
</span><span id="line-865"></span><span>          </span><span class="annot"><a href="#local-6989586621682960224"><span class="hs-identifier hs-type">traverse_funs</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682960241"><span class="hs-identifier hs-type">infos'</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682960247"><span class="hs-identifier hs-type">result'</span></a></span><span>
</span><span id="line-866"></span><span>             </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621682960252"><span class="hs-identifier hs-type">addOpen</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682960247"><span class="hs-identifier hs-type">result'</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682960238"><span class="hs-identifier hs-type">open'</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span>
</span><span id="line-867"></span><span>               </span><span class="annot"><span class="hs-identifier hs-type">map</span></span><span> </span><span class="annot"><a href="#local-6989586621682960249"><span class="hs-identifier hs-type">to_block_ref</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.StgToJS.Object.html#blockBlockDeps"><span class="hs-identifier hs-var">blockBlockDeps</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682960243"><span class="hs-identifier hs-type">block</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.StgToJS.Object.html#blockFunDeps"><span class="hs-identifier hs-var">blockFunDeps</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682960243"><span class="hs-identifier hs-type">block</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-868"></span><span>
</span><span id="line-869"></span><span>    </span><span class="annot"><a href="#local-6989586621682960224"><span class="hs-identifier hs-type">traverse_funs</span></a></span><span>
</span><span id="line-870"></span><span>      </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="../../containers-0.7-5a8f/src/Data.Map.Internal.html#Map"><span class="hs-identifier hs-type">Map</span></a></span><span> </span><span class="annot"><a href="GHC.Unit.Types.html#Module"><span class="hs-identifier hs-type">Module</span></a></span><span> </span><span class="annot"><a href="GHC.StgToJS.Object.html#LocatedBlockInfo"><span class="hs-identifier hs-type">LocatedBlockInfo</span></a></span><span>
</span><span id="line-871"></span><span>      </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="../../containers-0.7-5a8f/src/Data.Set.Internal.html#Set"><span class="hs-identifier hs-type">Set</span></a></span><span> </span><span class="annot"><a href="GHC.StgToJS.Object.html#BlockRef"><span class="hs-identifier hs-type">BlockRef</span></a></span><span>
</span><span id="line-872"></span><span>      </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="../../containers-0.7-5a8f/src/Data.Set.Internal.html#Set"><span class="hs-identifier hs-type">Set</span></a></span><span> </span><span class="annot"><a href="GHC.StgToJS.Object.html#BlockRef"><span class="hs-identifier hs-type">BlockRef</span></a></span><span>
</span><span id="line-873"></span><span>      </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="GHC.StgToJS.Object.html#ExportedFun"><span class="hs-identifier hs-type">ExportedFun</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-874"></span><span>      </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../../containers-0.7-5a8f/src/Data.Map.Internal.html#Map"><span class="hs-identifier hs-type">Map</span></a></span><span> </span><span class="annot"><a href="GHC.Unit.Types.html#Module"><span class="hs-identifier hs-type">Module</span></a></span><span> </span><span class="annot"><a href="GHC.StgToJS.Object.html#LocatedBlockInfo"><span class="hs-identifier hs-type">LocatedBlockInfo</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="../../containers-0.7-5a8f/src/Data.Set.Internal.html#Set"><span class="hs-identifier hs-type">Set</span></a></span><span> </span><span class="annot"><a href="GHC.StgToJS.Object.html#BlockRef"><span class="hs-identifier hs-type">BlockRef</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-875"></span><span>    </span><span id="local-6989586621682960224"><span class="annot"><span class="annottext">traverse_funs :: Map Module LocatedBlockInfo
-&gt; Set BlockRef
-&gt; Set BlockRef
-&gt; [ExportedFun]
-&gt; IO (Map Module LocatedBlockInfo, Set BlockRef)
</span><a href="#local-6989586621682960224"><span class="hs-identifier hs-var hs-var">traverse_funs</span></a></span></span><span> </span><span id="local-6989586621682960255"><span class="annot"><span class="annottext">Map Module LocatedBlockInfo
</span><a href="#local-6989586621682960255"><span class="hs-identifier hs-var">infos</span></a></span></span><span> </span><span id="local-6989586621682960256"><span class="annot"><span class="annottext">Set BlockRef
</span><a href="#local-6989586621682960256"><span class="hs-identifier hs-var">result</span></a></span></span><span> </span><span id="local-6989586621682960257"><span class="annot"><span class="annottext">Set BlockRef
</span><a href="#local-6989586621682960257"><span class="hs-identifier hs-var">open</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-glyph">\</span><span class="hs-glyph">case</span><span>
</span><span id="line-876"></span><span>      </span><span class="hs-special">[</span><span class="hs-special">]</span><span>     </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Map Module LocatedBlockInfo
-&gt; Set BlockRef
-&gt; Set BlockRef
-&gt; IO (Map Module LocatedBlockInfo, Set BlockRef)
</span><a href="#local-6989586621682960232"><span class="hs-identifier hs-var">traverse_blocks</span></a></span><span> </span><span class="annot"><span class="annottext">Map Module LocatedBlockInfo
</span><a href="#local-6989586621682960255"><span class="hs-identifier hs-var">infos</span></a></span><span> </span><span class="annot"><span class="annottext">Set BlockRef
</span><a href="#local-6989586621682960256"><span class="hs-identifier hs-var">result</span></a></span><span> </span><span class="annot"><span class="annottext">Set BlockRef
</span><a href="#local-6989586621682960257"><span class="hs-identifier hs-var">open</span></a></span><span>
</span><span id="line-877"></span><span>      </span><span class="hs-special">(</span><span id="local-6989586621682960258"><span class="annot"><span class="annottext">ExportedFun
</span><a href="#local-6989586621682960258"><span class="hs-identifier hs-var">f</span></a></span></span><span class="annot"><span class="hs-glyph hs-type">:</span></span><span id="local-6989586621682960259"><span class="annot"><span class="annottext">[ExportedFun]
</span><a href="#local-6989586621682960259"><span class="hs-identifier hs-var">fs</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-878"></span><span>        </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621682960260"><span class="annot"><span class="annottext">mod :: Module
</span><a href="#local-6989586621682960260"><span class="hs-identifier hs-var hs-var hs-var">mod</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ExportedFun -&gt; Module
</span><a href="GHC.StgToJS.Object.html#funModule"><span class="hs-identifier hs-var">funModule</span></a></span><span> </span><span class="annot"><span class="annottext">ExportedFun
</span><a href="#local-6989586621682960258"><span class="hs-identifier hs-var">f</span></a></span><span>
</span><span id="line-879"></span><span>        </span><span class="hs-comment">-- lookup module block info for the module that exports the function</span><span>
</span><span id="line-880"></span><span>        </span><span class="hs-glyph">!</span><span class="hs-special">(</span><span id="local-6989586621682960262"><span class="annot"><a href="#local-6989586621682960262"><span class="hs-identifier hs-var">infos'</span></a></span></span><span class="hs-special">,</span><span id="local-6989586621682960263"><span class="annot"><a href="#local-6989586621682960263"><span class="hs-identifier hs-var">info</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Map Module LocatedBlockInfo
-&gt; Module -&gt; IO (Map Module LocatedBlockInfo, BlockInfo)
</span><a href="#local-6989586621682960226"><span class="hs-identifier hs-var">lookup_info</span></a></span><span> </span><span class="annot"><span class="annottext">Map Module LocatedBlockInfo
</span><a href="#local-6989586621682960255"><span class="hs-identifier hs-var">infos</span></a></span><span> </span><span class="annot"><span class="annottext">Module
</span><a href="#local-6989586621682960260"><span class="hs-identifier hs-var">mod</span></a></span><span>
</span><span id="line-881"></span><span>        </span><span class="hs-comment">-- lookup block index associated to the function in the block info</span><span>
</span><span id="line-882"></span><span>        </span><span class="hs-keyword">case</span><span> </span><span class="annot"><a href="../../containers-0.7-5a8f/src/Data.Map.Internal.html#lookup"><span class="hs-identifier hs-type">M.lookup</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682960258"><span class="hs-identifier hs-type">f</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.StgToJS.Object.html#bi_exports"><span class="hs-identifier hs-var">bi_exports</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682960263"><span class="hs-identifier hs-type">info</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-883"></span><span>          </span><span class="annot"><span class="annottext">Maybe BlockId
</span><span class="hs-identifier hs-var">Nothing</span></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">FilePath -&gt; SDoc -&gt; IO (Map Module LocatedBlockInfo, Set BlockRef)
forall a. HasCallStack =&gt; FilePath -&gt; SDoc -&gt; a
</span><a href="GHC.Utils.Panic.html#pprPanic"><span class="hs-identifier hs-var">pprPanic</span></a></span><span> </span><span class="annot"><span class="annottext">FilePath
</span><span class="hs-string">&quot;exported function not found: &quot;</span></span><span> </span><span class="annot"><span class="annottext">(SDoc -&gt; IO (Map Module LocatedBlockInfo, Set BlockRef))
-&gt; SDoc -&gt; IO (Map Module LocatedBlockInfo, Set BlockRef)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">ExportedFun -&gt; SDoc
forall a. Outputable a =&gt; a -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="annot"><span class="annottext">ExportedFun
</span><a href="#local-6989586621682960258"><span class="hs-identifier hs-var">f</span></a></span><span>
</span><span id="line-884"></span><span>          </span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span id="local-6989586621682960264"><span class="annot"><span class="annottext">BlockId
</span><a href="#local-6989586621682960264"><span class="hs-identifier hs-var">idx</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-885"></span><span>            </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621682960265"><span class="annot"><span class="annottext">fun_block_ref :: BlockRef
</span><a href="#local-6989586621682960265"><span class="hs-identifier hs-var hs-var hs-var">fun_block_ref</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="GHC.StgToJS.Object.html#BlockRef"><span class="hs-identifier hs-type">BlockRef</span></a></span><span>
</span><span id="line-886"></span><span>                   </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">block_ref_mod :: Module
</span><a href="GHC.StgToJS.Object.html#block_ref_mod"><span class="hs-identifier hs-var">block_ref_mod</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Module
</span><a href="#local-6989586621682960260"><span class="hs-identifier hs-var">mod</span></a></span><span>
</span><span id="line-887"></span><span>                   </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">block_ref_idx :: BlockId
</span><a href="GHC.StgToJS.Object.html#block_ref_idx"><span class="hs-identifier hs-var">block_ref_idx</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">BlockId
</span><a href="#local-6989586621682960264"><span class="hs-identifier hs-var">idx</span></a></span><span>
</span><span id="line-888"></span><span>                   </span><span class="hs-special">}</span><span>
</span><span id="line-889"></span><span>            </span><span class="hs-comment">-- always add the module &quot;global block&quot; when we link a module</span><span>
</span><span id="line-890"></span><span>            </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621682960266"><span class="annot"><span class="annottext">global_block_ref :: BlockRef
</span><a href="#local-6989586621682960266"><span class="hs-identifier hs-var hs-var">global_block_ref</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="GHC.StgToJS.Object.html#BlockRef"><span class="hs-identifier hs-type">BlockRef</span></a></span><span>
</span><span id="line-891"></span><span>                   </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">block_ref_mod :: Module
</span><a href="GHC.StgToJS.Object.html#block_ref_mod"><span class="hs-identifier hs-var">block_ref_mod</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Module
</span><a href="#local-6989586621682960260"><span class="hs-identifier hs-var">mod</span></a></span><span>
</span><span id="line-892"></span><span>                   </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">block_ref_idx :: BlockId
</span><a href="GHC.StgToJS.Object.html#block_ref_idx"><span class="hs-identifier hs-var">block_ref_idx</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">BlockId
</span><span class="hs-number">0</span></span><span>
</span><span id="line-893"></span><span>                   </span><span class="hs-special">}</span><span>
</span><span id="line-894"></span><span>            </span><span class="annot"><span class="annottext">Map Module LocatedBlockInfo
-&gt; Set BlockRef
-&gt; Set BlockRef
-&gt; [ExportedFun]
-&gt; IO (Map Module LocatedBlockInfo, Set BlockRef)
</span><a href="#local-6989586621682960224"><span class="hs-identifier hs-var">traverse_funs</span></a></span><span> </span><span class="annot"><span class="annottext">Map Module LocatedBlockInfo
</span><a href="#local-6989586621682960262"><span class="hs-identifier hs-var">infos'</span></a></span><span> </span><span class="annot"><span class="annottext">Set BlockRef
</span><a href="#local-6989586621682960256"><span class="hs-identifier hs-var">result</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Set BlockRef -&gt; Set BlockRef -&gt; [BlockRef] -&gt; Set BlockRef
</span><a href="#local-6989586621682960252"><span class="hs-identifier hs-var">addOpen</span></a></span><span> </span><span class="annot"><span class="annottext">Set BlockRef
</span><a href="#local-6989586621682960256"><span class="hs-identifier hs-var">result</span></a></span><span> </span><span class="annot"><span class="annottext">Set BlockRef
</span><a href="#local-6989586621682960257"><span class="hs-identifier hs-var">open</span></a></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">BlockRef
</span><a href="#local-6989586621682960265"><span class="hs-identifier hs-var">fun_block_ref</span></a></span><span class="hs-special">,</span><span class="annot"><span class="annottext">BlockRef
</span><a href="#local-6989586621682960266"><span class="hs-identifier hs-var">global_block_ref</span></a></span><span class="hs-special">]</span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[ExportedFun]
</span><a href="#local-6989586621682960259"><span class="hs-identifier hs-var">fs</span></a></span><span>
</span><span id="line-895"></span><span>
</span><span id="line-896"></span><span>    </span><span class="hs-comment">-- extend the open block set with new blocks that are not already in the</span><span>
</span><span id="line-897"></span><span>    </span><span class="hs-comment">-- result block set nor in the open block set.</span><span>
</span><span id="line-898"></span><span>    </span><span class="annot"><a href="#local-6989586621682960252"><span class="hs-identifier hs-type">addOpen</span></a></span><span>
</span><span id="line-899"></span><span>      </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="../../containers-0.7-5a8f/src/Data.Set.Internal.html#Set"><span class="hs-identifier hs-type">Set</span></a></span><span> </span><span class="annot"><a href="GHC.StgToJS.Object.html#BlockRef"><span class="hs-identifier hs-type">BlockRef</span></a></span><span>
</span><span id="line-900"></span><span>      </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="../../containers-0.7-5a8f/src/Data.Set.Internal.html#Set"><span class="hs-identifier hs-type">Set</span></a></span><span> </span><span class="annot"><a href="GHC.StgToJS.Object.html#BlockRef"><span class="hs-identifier hs-type">BlockRef</span></a></span><span>
</span><span id="line-901"></span><span>      </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="GHC.StgToJS.Object.html#BlockRef"><span class="hs-identifier hs-type">BlockRef</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-902"></span><span>      </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="../../containers-0.7-5a8f/src/Data.Set.Internal.html#Set"><span class="hs-identifier hs-type">Set</span></a></span><span> </span><span class="annot"><a href="GHC.StgToJS.Object.html#BlockRef"><span class="hs-identifier hs-type">BlockRef</span></a></span><span>
</span><span id="line-903"></span><span>    </span><span id="local-6989586621682960252"><span class="annot"><span class="annottext">addOpen :: Set BlockRef -&gt; Set BlockRef -&gt; [BlockRef] -&gt; Set BlockRef
</span><a href="#local-6989586621682960252"><span class="hs-identifier hs-var hs-var">addOpen</span></a></span></span><span> </span><span id="local-6989586621682960267"><span class="annot"><span class="annottext">Set BlockRef
</span><a href="#local-6989586621682960267"><span class="hs-identifier hs-var">result</span></a></span></span><span> </span><span id="local-6989586621682960268"><span class="annot"><span class="annottext">Set BlockRef
</span><a href="#local-6989586621682960268"><span class="hs-identifier hs-var">open</span></a></span></span><span> </span><span id="local-6989586621682960269"><span class="annot"><span class="annottext">[BlockRef]
</span><a href="#local-6989586621682960269"><span class="hs-identifier hs-var">new_blocks</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-904"></span><span>      </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621682960270"><span class="annot"><span class="annottext">alreadyLinked :: BlockRef -&gt; Bool
</span><a href="#local-6989586621682960270"><span class="hs-identifier hs-var hs-var">alreadyLinked</span></a></span></span><span> </span><span id="local-6989586621682960271"><span class="annot"><span class="annottext">BlockRef
</span><a href="#local-6989586621682960271"><span class="hs-identifier hs-var">s</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">BlockRef -&gt; Set BlockRef -&gt; Bool
forall a. Ord a =&gt; a -&gt; Set a -&gt; Bool
</span><a href="../../containers-0.7-5a8f/src/Data.Set.Internal.html#member"><span class="hs-identifier hs-var">S.member</span></a></span><span> </span><span class="annot"><span class="annottext">BlockRef
</span><a href="#local-6989586621682960271"><span class="hs-identifier hs-var">s</span></a></span><span> </span><span class="annot"><span class="annottext">Set BlockRef
</span><a href="#local-6989586621682960267"><span class="hs-identifier hs-var">result</span></a></span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Bool -&gt; Bool
</span><span class="hs-operator hs-var">||</span></span><span> </span><span class="annot"><span class="annottext">BlockRef -&gt; Set BlockRef -&gt; Bool
forall a. Ord a =&gt; a -&gt; Set a -&gt; Bool
</span><a href="../../containers-0.7-5a8f/src/Data.Set.Internal.html#member"><span class="hs-identifier hs-var">S.member</span></a></span><span> </span><span class="annot"><span class="annottext">BlockRef
</span><a href="#local-6989586621682960271"><span class="hs-identifier hs-var">s</span></a></span><span> </span><span class="annot"><span class="annottext">Set BlockRef
</span><a href="#local-6989586621682960268"><span class="hs-identifier hs-var">open</span></a></span><span>
</span><span id="line-905"></span><span>      </span><span class="hs-keyword">in</span><span>  </span><span class="annot"><span class="annottext">Set BlockRef
</span><a href="#local-6989586621682960268"><span class="hs-identifier hs-var">open</span></a></span><span> </span><span class="annot"><span class="annottext">Set BlockRef -&gt; Set BlockRef -&gt; Set BlockRef
forall a. Ord a =&gt; Set a -&gt; Set a -&gt; Set a
</span><a href="../../containers-0.7-5a8f/src/Data.Set.Internal.html#union"><span class="hs-operator hs-var">`S.union`</span></a></span><span> </span><span class="annot"><span class="annottext">[BlockRef] -&gt; Set BlockRef
forall a. Ord a =&gt; [a] -&gt; Set a
</span><a href="../../containers-0.7-5a8f/src/Data.Set.Internal.html#fromList"><span class="hs-identifier hs-var">S.fromList</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(BlockRef -&gt; Bool) -&gt; [BlockRef] -&gt; [BlockRef]
forall a. (a -&gt; Bool) -&gt; [a] -&gt; [a]
</span><span class="hs-identifier hs-var">filter</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Bool -&gt; Bool
</span><span class="hs-identifier hs-var">not</span></span><span> </span><span class="annot"><span class="annottext">(Bool -&gt; Bool) -&gt; (BlockRef -&gt; Bool) -&gt; BlockRef -&gt; Bool
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">BlockRef -&gt; Bool
</span><a href="#local-6989586621682960270"><span class="hs-identifier hs-var">alreadyLinked</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[BlockRef]
</span><a href="#local-6989586621682960269"><span class="hs-identifier hs-var">new_blocks</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-906"></span><span>
</span><span id="line-907"></span><span class="annot"><span class="hs-comment">-- | collect dependencies for a set of roots</span></span><span>
</span><span id="line-908"></span><span class="annot"><a href="GHC.StgToJS.Linker.Linker.html#collectModuleCodes"><span class="hs-identifier hs-type">collectModuleCodes</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.StgToJS.Linker.Linker.html#ArchiveCache"><span class="hs-identifier hs-type">ArchiveCache</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.StgToJS.Linker.Types.html#LinkPlan"><span class="hs-identifier hs-type">LinkPlan</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="hs-special">[</span><span class="annot"><a href="GHC.StgToJS.Linker.Linker.html#ModuleCode"><span class="hs-identifier hs-type">ModuleCode</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-909"></span><span id="collectModuleCodes"><span class="annot"><span class="annottext">collectModuleCodes :: ArchiveCache -&gt; LinkPlan -&gt; IO [ModuleCode]
</span><a href="GHC.StgToJS.Linker.Linker.html#collectModuleCodes"><span class="hs-identifier hs-var hs-var">collectModuleCodes</span></a></span></span><span> </span><span id="local-6989586621682960273"><span class="annot"><span class="annottext">ArchiveCache
</span><a href="#local-6989586621682960273"><span class="hs-identifier hs-var">ar_cache</span></a></span></span><span> </span><span id="local-6989586621682960274"><span class="annot"><span class="annottext">LinkPlan
</span><a href="#local-6989586621682960274"><span class="hs-identifier hs-var">link_plan</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-910"></span><span>
</span><span id="line-911"></span><span>  </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621682960275"><span class="annot"><span class="annottext">block_info :: Map Module LocatedBlockInfo
</span><a href="#local-6989586621682960275"><span class="hs-identifier hs-var hs-var hs-var">block_info</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">LinkPlan -&gt; Map Module LocatedBlockInfo
</span><a href="GHC.StgToJS.Linker.Types.html#lkp_block_info"><span class="hs-identifier hs-var">lkp_block_info</span></a></span><span> </span><span class="annot"><span class="annottext">LinkPlan
</span><a href="#local-6989586621682960274"><span class="hs-identifier hs-var">link_plan</span></a></span><span>
</span><span id="line-912"></span><span>  </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621682960276"><span class="annot"><span class="annottext">blocks :: Set BlockRef
</span><a href="#local-6989586621682960276"><span class="hs-identifier hs-var hs-var hs-var">blocks</span></a></span></span><span>     </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">LinkPlan -&gt; Set BlockRef
</span><a href="GHC.StgToJS.Linker.Types.html#lkp_dep_blocks"><span class="hs-identifier hs-var">lkp_dep_blocks</span></a></span><span> </span><span class="annot"><span class="annottext">LinkPlan
</span><a href="#local-6989586621682960274"><span class="hs-identifier hs-var">link_plan</span></a></span><span>
</span><span id="line-913"></span><span>
</span><span id="line-914"></span><span>  </span><span class="hs-comment">-- we're going to load all the blocks. Instead of doing this randomly, we</span><span>
</span><span id="line-915"></span><span>  </span><span class="hs-comment">-- group them by module first.</span><span>
</span><span id="line-916"></span><span>  </span><span class="hs-keyword">let</span><span> </span><span class="annot"><a href="#local-6989586621682960277"><span class="hs-identifier hs-type">module_blocks</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="../../containers-0.7-5a8f/src/Data.Map.Internal.html#Map"><span class="hs-identifier hs-type">Map</span></a></span><span> </span><span class="annot"><a href="GHC.Unit.Types.html#Module"><span class="hs-identifier hs-type">Module</span></a></span><span> </span><span class="annot"><a href="GHC.StgToJS.Object.html#BlockIds"><span class="hs-identifier hs-type">BlockIds</span></a></span><span>
</span><span id="line-917"></span><span>      </span><span id="local-6989586621682960277"><span class="annot"><span class="annottext">module_blocks :: Map Module BlockIds
</span><a href="#local-6989586621682960277"><span class="hs-identifier hs-var hs-var hs-var">module_blocks</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(BlockIds -&gt; BlockIds -&gt; BlockIds)
-&gt; [(Module, BlockIds)] -&gt; Map Module BlockIds
forall k a. Ord k =&gt; (a -&gt; a -&gt; a) -&gt; [(k, a)] -&gt; Map k a
</span><a href="../../containers-0.7-5a8f/src/Data.Map.Strict.Internal.html#fromListWith"><span class="hs-identifier hs-var">M.fromListWith</span></a></span><span> </span><span class="annot"><span class="annottext">BlockIds -&gt; BlockIds -&gt; BlockIds
</span><a href="../../containers-0.7-5a8f/src/Data.IntSet.Internal.html#union"><span class="hs-identifier hs-var">IS.union</span></a></span><span> </span><span class="annot"><span class="annottext">([(Module, BlockIds)] -&gt; Map Module BlockIds)
-&gt; [(Module, BlockIds)] -&gt; Map Module BlockIds
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-918"></span><span>                      </span><span class="annot"><span class="annottext">(BlockRef -&gt; (Module, BlockIds))
-&gt; [BlockRef] -&gt; [(Module, BlockIds)]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><span class="hs-identifier hs-var">map</span></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span id="local-6989586621682960279"><span class="annot"><span class="annottext">BlockRef
</span><a href="#local-6989586621682960279"><span class="hs-identifier hs-var">ref</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">BlockRef -&gt; Module
</span><a href="GHC.StgToJS.Object.html#block_ref_mod"><span class="hs-identifier hs-var">block_ref_mod</span></a></span><span> </span><span class="annot"><span class="annottext">BlockRef
</span><a href="#local-6989586621682960279"><span class="hs-identifier hs-var">ref</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">BlockId -&gt; BlockIds
</span><a href="../../containers-0.7-5a8f/src/Data.IntSet.Internal.html#singleton"><span class="hs-identifier hs-var">IS.singleton</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">BlockRef -&gt; BlockId
</span><a href="GHC.StgToJS.Object.html#block_ref_idx"><span class="hs-identifier hs-var">block_ref_idx</span></a></span><span> </span><span class="annot"><span class="annottext">BlockRef
</span><a href="#local-6989586621682960279"><span class="hs-identifier hs-var">ref</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Set BlockRef -&gt; [BlockRef]
forall a. Set a -&gt; [a]
</span><a href="../../containers-0.7-5a8f/src/Data.Set.Internal.html#toList"><span class="hs-identifier hs-var">S.toList</span></a></span><span> </span><span class="annot"><span class="annottext">Set BlockRef
</span><a href="#local-6989586621682960276"><span class="hs-identifier hs-var">blocks</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-919"></span><span>
</span><span id="line-920"></span><span>  </span><span class="hs-comment">-- GHCJS had this comment: &quot;read ghc-prim first, since we depend on that for</span><span>
</span><span id="line-921"></span><span>  </span><span class="hs-comment">-- static initialization&quot;. Not sure if it's still true as we haven't ported</span><span>
</span><span id="line-922"></span><span>  </span><span class="hs-comment">-- the compactor yet. Still we sort to read ghc-prim blocks first just in</span><span>
</span><span id="line-923"></span><span>  </span><span class="hs-comment">-- case.</span><span>
</span><span id="line-924"></span><span>  </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621682960282"><span class="annot"><span class="annottext">pred :: (Module, b) -&gt; Bool
</span><a href="#local-6989586621682960282"><span class="hs-identifier hs-var hs-var">pred</span></a></span></span><span> </span><span id="local-6989586621682960283"><span class="annot"><span class="annottext">(Module, b)
</span><a href="#local-6989586621682960283"><span class="hs-identifier hs-var">x</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Module -&gt; UnitId
</span><a href="GHC.Unit.Types.html#moduleUnitId"><span class="hs-identifier hs-var">moduleUnitId</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(Module, b) -&gt; Module
forall a b. (a, b) -&gt; a
</span><span class="hs-identifier hs-var">fst</span></span><span> </span><span class="annot"><span class="annottext">(Module, b)
</span><a href="#local-6989586621682960283"><span class="hs-identifier hs-var">x</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">UnitId -&gt; UnitId -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">==</span></span><span> </span><span class="annot"><span class="annottext">UnitId
</span><a href="GHC.Unit.Types.html#primUnitId"><span class="hs-identifier hs-var">primUnitId</span></a></span><span>
</span><span id="line-925"></span><span>      </span><span id="local-6989586621682960285"><span class="annot"><span class="annottext">cmp :: (Module, b) -&gt; (Module, b) -&gt; Ordering
</span><a href="#local-6989586621682960285"><span class="hs-identifier hs-var hs-var">cmp</span></a></span></span><span> </span><span id="local-6989586621682960286"><span class="annot"><span class="annottext">(Module, b)
</span><a href="#local-6989586621682960286"><span class="hs-identifier hs-var">x</span></a></span></span><span> </span><span id="local-6989586621682960287"><span class="annot"><span class="annottext">(Module, b)
</span><a href="#local-6989586621682960287"><span class="hs-identifier hs-var">y</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(Module, b) -&gt; Bool
forall {b}. (Module, b) -&gt; Bool
</span><a href="#local-6989586621682960282"><span class="hs-identifier hs-var">pred</span></a></span><span> </span><span class="annot"><span class="annottext">(Module, b)
</span><a href="#local-6989586621682960286"><span class="hs-identifier hs-var">x</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">(Module, b) -&gt; Bool
forall {b}. (Module, b) -&gt; Bool
</span><a href="#local-6989586621682960282"><span class="hs-identifier hs-var">pred</span></a></span><span> </span><span class="annot"><span class="annottext">(Module, b)
</span><a href="#local-6989586621682960287"><span class="hs-identifier hs-var">y</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-926"></span><span>        </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">True</span></span><span class="hs-special">,</span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">False</span></span><span class="hs-special">)</span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Ordering
</span><span class="hs-identifier hs-var">LT</span></span><span>
</span><span id="line-927"></span><span>        </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">False</span></span><span class="hs-special">,</span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">True</span></span><span class="hs-special">)</span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Ordering
</span><span class="hs-identifier hs-var">GT</span></span><span>
</span><span id="line-928"></span><span>        </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">True</span></span><span class="hs-special">,</span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">True</span></span><span class="hs-special">)</span><span>   </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Ordering
</span><span class="hs-identifier hs-var">EQ</span></span><span>
</span><span id="line-929"></span><span>        </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">False</span></span><span class="hs-special">,</span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">False</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Ordering
</span><span class="hs-identifier hs-var">EQ</span></span><span>
</span><span id="line-930"></span><span>
</span><span id="line-931"></span><span>      </span><span class="annot"><a href="#local-6989586621682960288"><span class="hs-identifier hs-type">sorted_module_blocks</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><span class="hs-special">(</span><span class="annot"><a href="GHC.Unit.Types.html#Module"><span class="hs-identifier hs-type">Module</span></a></span><span class="hs-special">,</span><span class="annot"><a href="GHC.StgToJS.Object.html#BlockIds"><span class="hs-identifier hs-type">BlockIds</span></a></span><span class="hs-special">)</span><span class="hs-special">]</span><span>
</span><span id="line-932"></span><span>      </span><span id="local-6989586621682960288"><span class="annot"><span class="annottext">sorted_module_blocks :: [(Module, BlockIds)]
</span><a href="#local-6989586621682960288"><span class="hs-identifier hs-var hs-var">sorted_module_blocks</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">((Module, BlockIds) -&gt; (Module, BlockIds) -&gt; Ordering)
-&gt; [(Module, BlockIds)] -&gt; [(Module, BlockIds)]
forall a. (a -&gt; a -&gt; Ordering) -&gt; [a] -&gt; [a]
</span><span class="hs-identifier hs-var">sortBy</span></span><span> </span><span class="annot"><span class="annottext">(Module, BlockIds) -&gt; (Module, BlockIds) -&gt; Ordering
forall {b} {b}. (Module, b) -&gt; (Module, b) -&gt; Ordering
</span><a href="#local-6989586621682960285"><span class="hs-identifier hs-var">cmp</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Map Module BlockIds -&gt; [(Module, BlockIds)]
forall k a. Map k a -&gt; [(k, a)]
</span><a href="../../containers-0.7-5a8f/src/Data.Map.Internal.html#toList"><span class="hs-identifier hs-var">M.toList</span></a></span><span> </span><span class="annot"><span class="annottext">Map Module BlockIds
</span><a href="#local-6989586621682960277"><span class="hs-identifier hs-var">module_blocks</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-933"></span><span>
</span><span id="line-934"></span><span>  </span><span class="hs-comment">-- load blocks</span><span>
</span><span id="line-935"></span><span>  </span><span class="annot"><span class="annottext">[(Module, BlockIds)]
-&gt; ((Module, BlockIds) -&gt; IO ModuleCode) -&gt; IO [ModuleCode]
forall (t :: * -&gt; *) (m :: * -&gt; *) a b.
(Traversable t, Monad m) =&gt;
t a -&gt; (a -&gt; m b) -&gt; m (t b)
</span><span class="hs-identifier hs-var">forM</span></span><span> </span><span class="annot"><span class="annottext">[(Module, BlockIds)]
</span><a href="#local-6989586621682960288"><span class="hs-identifier hs-var">sorted_module_blocks</span></a></span><span> </span><span class="annot"><span class="annottext">(((Module, BlockIds) -&gt; IO ModuleCode) -&gt; IO [ModuleCode])
-&gt; ((Module, BlockIds) -&gt; IO ModuleCode) -&gt; IO [ModuleCode]
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-glyph">\</span><span class="hs-special">(</span><span id="local-6989586621682960289"><span class="annot"><span class="annottext">Module
</span><a href="#local-6989586621682960289"><span class="hs-identifier hs-var">mod</span></a></span></span><span class="hs-special">,</span><span id="local-6989586621682960290"><span class="annot"><span class="annottext">BlockIds
</span><a href="#local-6989586621682960290"><span class="hs-identifier hs-var">bids</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-936"></span><span>    </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">Module -&gt; Map Module LocatedBlockInfo -&gt; Maybe LocatedBlockInfo
forall k a. Ord k =&gt; k -&gt; Map k a -&gt; Maybe a
</span><a href="../../containers-0.7-5a8f/src/Data.Map.Internal.html#lookup"><span class="hs-identifier hs-var">M.lookup</span></a></span><span> </span><span class="annot"><span class="annottext">Module
</span><a href="#local-6989586621682960289"><span class="hs-identifier hs-var">mod</span></a></span><span> </span><span class="annot"><span class="annottext">Map Module LocatedBlockInfo
</span><a href="#local-6989586621682960275"><span class="hs-identifier hs-var">block_info</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-937"></span><span>      </span><span class="annot"><span class="annottext">Maybe LocatedBlockInfo
</span><span class="hs-identifier hs-var">Nothing</span></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">FilePath -&gt; SDoc -&gt; IO ModuleCode
forall a. HasCallStack =&gt; FilePath -&gt; SDoc -&gt; a
</span><a href="GHC.Utils.Panic.html#pprPanic"><span class="hs-identifier hs-var">pprPanic</span></a></span><span> </span><span class="annot"><span class="annottext">FilePath
</span><span class="hs-string">&quot;collectModuleCodes: couldn't find block info for module&quot;</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Module -&gt; SDoc
forall a. Outputable a =&gt; a -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="annot"><span class="annottext">Module
</span><a href="#local-6989586621682960289"><span class="hs-identifier hs-var">mod</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-938"></span><span>      </span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span id="local-6989586621682960291"><span class="annot"><span class="annottext">LocatedBlockInfo
</span><a href="#local-6989586621682960291"><span class="hs-identifier hs-var">lbi</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">ArchiveCache -&gt; LocatedBlockInfo -&gt; BlockIds -&gt; IO ModuleCode
</span><a href="GHC.StgToJS.Linker.Linker.html#extractBlocks"><span class="hs-identifier hs-var">extractBlocks</span></a></span><span> </span><span class="annot"><span class="annottext">ArchiveCache
</span><a href="#local-6989586621682960273"><span class="hs-identifier hs-var">ar_cache</span></a></span><span> </span><span class="annot"><span class="annottext">LocatedBlockInfo
</span><a href="#local-6989586621682960291"><span class="hs-identifier hs-var">lbi</span></a></span><span> </span><span class="annot"><span class="annottext">BlockIds
</span><a href="#local-6989586621682960290"><span class="hs-identifier hs-var">bids</span></a></span><span>
</span><span id="line-939"></span><span>
</span><span id="line-940"></span><span class="annot"><a href="GHC.StgToJS.Linker.Linker.html#extractBlocks"><span class="hs-identifier hs-type">extractBlocks</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.StgToJS.Linker.Linker.html#ArchiveCache"><span class="hs-identifier hs-type">ArchiveCache</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.StgToJS.Object.html#LocatedBlockInfo"><span class="hs-identifier hs-type">LocatedBlockInfo</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.StgToJS.Object.html#BlockIds"><span class="hs-identifier hs-type">BlockIds</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="annot"><a href="GHC.StgToJS.Linker.Linker.html#ModuleCode"><span class="hs-identifier hs-type">ModuleCode</span></a></span><span>
</span><span id="line-941"></span><span id="extractBlocks"><span class="annot"><span class="annottext">extractBlocks :: ArchiveCache -&gt; LocatedBlockInfo -&gt; BlockIds -&gt; IO ModuleCode
</span><a href="GHC.StgToJS.Linker.Linker.html#extractBlocks"><span class="hs-identifier hs-var hs-var">extractBlocks</span></a></span></span><span> </span><span id="local-6989586621682960293"><span class="annot"><span class="annottext">ArchiveCache
</span><a href="#local-6989586621682960293"><span class="hs-identifier hs-var">ar_state</span></a></span></span><span> </span><span id="local-6989586621682960294"><span class="annot"><span class="annottext">LocatedBlockInfo
</span><a href="#local-6989586621682960294"><span class="hs-identifier hs-var">lbi</span></a></span></span><span> </span><span id="local-6989586621682960295"><span class="annot"><span class="annottext">BlockIds
</span><a href="#local-6989586621682960295"><span class="hs-identifier hs-var">blocks</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-942"></span><span>  </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">LocatedBlockInfo -&gt; BlockLocation
</span><a href="GHC.StgToJS.Object.html#lbi_loc"><span class="hs-identifier hs-var">lbi_loc</span></a></span><span> </span><span class="annot"><span class="annottext">LocatedBlockInfo
</span><a href="#local-6989586621682960294"><span class="hs-identifier hs-var">lbi</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-943"></span><span>    </span><span class="annot"><a href="GHC.StgToJS.Object.html#ObjectFile"><span class="hs-identifier hs-type">ObjectFile</span></a></span><span> </span><span id="local-6989586621682960298"><span class="annot"><span class="annottext">FilePath
</span><a href="#local-6989586621682960298"><span class="hs-identifier hs-var">fp</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-944"></span><span>      </span><span id="local-6989586621682960299"><span class="annot"><a href="#local-6989586621682960299"><span class="hs-identifier hs-var">us</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">FilePath -&gt; BlockIds -&gt; IO [ObjBlock]
</span><a href="GHC.StgToJS.Object.html#readObjectBlocks"><span class="hs-identifier hs-var">readObjectBlocks</span></a></span><span> </span><span class="annot"><span class="annottext">FilePath
</span><a href="#local-6989586621682960298"><span class="hs-identifier hs-var">fp</span></a></span><span> </span><span class="annot"><span class="annottext">BlockIds
</span><a href="#local-6989586621682960295"><span class="hs-identifier hs-var">blocks</span></a></span><span>
</span><span id="line-945"></span><span>      </span><span class="annot"><span class="hs-identifier hs-type">pure</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621682960301"><span class="hs-identifier hs-type">collectCode</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682960299"><span class="hs-identifier hs-type">us</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-946"></span><span>    </span><span class="annot"><a href="GHC.StgToJS.Object.html#ArchiveFile"><span class="hs-identifier hs-type">ArchiveFile</span></a></span><span> </span><span id="local-6989586621682960303"><span class="annot"><span class="annottext">FilePath
</span><a href="#local-6989586621682960303"><span class="hs-identifier hs-var">a</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-947"></span><span>      </span><span id="local-6989586621682960304"><span class="annot"><a href="#local-6989586621682960304"><span class="hs-identifier hs-var">obj</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">ArchiveCache -&gt; Module -&gt; FilePath -&gt; IO Object
</span><a href="GHC.StgToJS.Linker.Linker.html#readArObject"><span class="hs-identifier hs-var">readArObject</span></a></span><span> </span><span class="annot"><span class="annottext">ArchiveCache
</span><a href="#local-6989586621682960293"><span class="hs-identifier hs-var">ar_state</span></a></span><span> </span><span class="annot"><span class="annottext">Module
</span><a href="#local-6989586621682960306"><span class="hs-identifier hs-var">mod</span></a></span><span> </span><span class="annot"><span class="annottext">FilePath
</span><a href="#local-6989586621682960303"><span class="hs-identifier hs-var">a</span></a></span><span>
</span><span id="line-948"></span><span>      </span><span id="local-6989586621682960307"><span class="annot"><a href="#local-6989586621682960307"><span class="hs-identifier hs-var">us</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><a href="GHC.StgToJS.Object.html#getObjectBlocks"><span class="hs-identifier hs-type">getObjectBlocks</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682960304"><span class="hs-identifier hs-type">obj</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682960295"><span class="hs-identifier hs-type">blocks</span></a></span><span>
</span><span id="line-949"></span><span>      </span><span class="annot"><span class="hs-identifier hs-type">pure</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621682960301"><span class="hs-identifier hs-type">collectCode</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682960307"><span class="hs-identifier hs-type">us</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-950"></span><span>    </span><span class="annot"><a href="GHC.StgToJS.Object.html#InMemory"><span class="hs-identifier hs-type">InMemory</span></a></span><span> </span><span id="local-6989586621682960310"><span class="annot"><span class="annottext">FilePath
</span><a href="#local-6989586621682960310"><span class="hs-identifier hs-var">_n</span></a></span></span><span> </span><span id="local-6989586621682960311"><span class="annot"><span class="annottext">Object
</span><a href="#local-6989586621682960311"><span class="hs-identifier hs-var">obj</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-951"></span><span>      </span><span id="local-6989586621682960312"><span class="annot"><a href="#local-6989586621682960312"><span class="hs-identifier hs-var">us</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Object -&gt; BlockIds -&gt; IO [ObjBlock]
</span><a href="GHC.StgToJS.Object.html#getObjectBlocks"><span class="hs-identifier hs-var">getObjectBlocks</span></a></span><span> </span><span class="annot"><span class="annottext">Object
</span><a href="#local-6989586621682960311"><span class="hs-identifier hs-var">obj</span></a></span><span> </span><span class="annot"><span class="annottext">BlockIds
</span><a href="#local-6989586621682960295"><span class="hs-identifier hs-var">blocks</span></a></span><span>
</span><span id="line-952"></span><span>      </span><span class="annot"><span class="hs-identifier hs-type">pure</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621682960301"><span class="hs-identifier hs-type">collectCode</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682960312"><span class="hs-identifier hs-type">us</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-953"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-954"></span><span>    </span><span id="local-6989586621682960306"><span class="annot"><span class="annottext">mod :: Module
</span><a href="#local-6989586621682960306"><span class="hs-identifier hs-var hs-var">mod</span></a></span></span><span>           </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">BlockInfo -&gt; Module
</span><a href="GHC.StgToJS.Object.html#bi_module"><span class="hs-identifier hs-var">bi_module</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">LocatedBlockInfo -&gt; BlockInfo
</span><a href="GHC.StgToJS.Object.html#lbi_info"><span class="hs-identifier hs-var">lbi_info</span></a></span><span> </span><span class="annot"><span class="annottext">LocatedBlockInfo
</span><a href="#local-6989586621682960294"><span class="hs-identifier hs-var">lbi</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-955"></span><span>    </span><span id="local-6989586621682960314"><span class="annot"><span class="annottext">newline :: ByteString
</span><a href="#local-6989586621682960314"><span class="hs-identifier hs-var hs-var">newline</span></a></span></span><span>       </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">FilePath -&gt; ByteString
</span><a href="../../bytestring-0.12.2.0-7dd0/src/Data.ByteString.Char8.html#pack"><span class="hs-identifier hs-var">BC.pack</span></a></span><span> </span><span class="annot"><span class="annottext">FilePath
</span><span class="hs-string">&quot;\n&quot;</span></span><span>
</span><span id="line-956"></span><span>    </span><span id="local-6989586621682960318"><span class="annot"><span class="annottext">mk_exports :: [ObjBlock] -&gt; ByteString
</span><a href="#local-6989586621682960318"><span class="hs-identifier hs-var hs-var">mk_exports</span></a></span></span><span>    </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[ByteString] -&gt; ByteString
forall a. Monoid a =&gt; [a] -&gt; a
</span><span class="hs-identifier hs-var">mconcat</span></span><span> </span><span class="annot"><span class="annottext">([ByteString] -&gt; ByteString)
-&gt; ([ObjBlock] -&gt; [ByteString]) -&gt; [ObjBlock] -&gt; ByteString
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">ByteString -&gt; [ByteString] -&gt; [ByteString]
forall a. a -&gt; [a] -&gt; [a]
</span><span class="hs-identifier hs-var">intersperse</span></span><span> </span><span class="annot"><span class="annottext">ByteString
</span><a href="#local-6989586621682960314"><span class="hs-identifier hs-var">newline</span></a></span><span> </span><span class="annot"><span class="annottext">([ByteString] -&gt; [ByteString])
-&gt; ([ObjBlock] -&gt; [ByteString]) -&gt; [ObjBlock] -&gt; [ByteString]
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">(ByteString -&gt; Bool) -&gt; [ByteString] -&gt; [ByteString]
forall a. (a -&gt; Bool) -&gt; [a] -&gt; [a]
</span><span class="hs-identifier hs-var">filter</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Bool -&gt; Bool
</span><span class="hs-identifier hs-var">not</span></span><span> </span><span class="annot"><span class="annottext">(Bool -&gt; Bool) -&gt; (ByteString -&gt; Bool) -&gt; ByteString -&gt; Bool
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">ByteString -&gt; Bool
</span><a href="../../bytestring-0.12.2.0-7dd0/src/Data.ByteString.html#null"><span class="hs-identifier hs-var">BS.null</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">([ByteString] -&gt; [ByteString])
-&gt; ([ObjBlock] -&gt; [ByteString]) -&gt; [ObjBlock] -&gt; [ByteString]
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">(ObjBlock -&gt; ByteString) -&gt; [ObjBlock] -&gt; [ByteString]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><span class="hs-identifier hs-var">map</span></span><span> </span><span class="annot"><span class="annottext">ObjBlock -&gt; ByteString
</span><a href="GHC.StgToJS.Types.html#oiRaw"><span class="hs-identifier hs-var">oiRaw</span></a></span><span>
</span><span id="line-957"></span><span>    </span><span id="local-6989586621682960322"><span class="annot"><span class="annottext">mk_js_code :: [ObjBlock] -&gt; JStat
</span><a href="#local-6989586621682960322"><span class="hs-identifier hs-var hs-var">mk_js_code</span></a></span></span><span>    </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[JStat] -&gt; JStat
forall a. Monoid a =&gt; [a] -&gt; a
</span><span class="hs-identifier hs-var">mconcat</span></span><span> </span><span class="annot"><span class="annottext">([JStat] -&gt; JStat)
-&gt; ([ObjBlock] -&gt; [JStat]) -&gt; [ObjBlock] -&gt; JStat
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">(ObjBlock -&gt; JStat) -&gt; [ObjBlock] -&gt; [JStat]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><span class="hs-identifier hs-var">map</span></span><span> </span><span class="annot"><span class="annottext">ObjBlock -&gt; JStat
</span><a href="GHC.StgToJS.Types.html#oiStat"><span class="hs-identifier hs-var">oiStat</span></a></span><span>
</span><span id="line-958"></span><span>    </span><span id="local-6989586621682960301"><span class="annot"><span class="annottext">collectCode :: [ObjBlock] -&gt; ModuleCode
</span><a href="#local-6989586621682960301"><span class="hs-identifier hs-var hs-var">collectCode</span></a></span></span><span> </span><span id="local-6989586621682960324"><span class="annot"><span class="annottext">[ObjBlock]
</span><a href="#local-6989586621682960324"><span class="hs-identifier hs-var">l</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="GHC.StgToJS.Linker.Linker.html#ModuleCode"><span class="hs-identifier hs-type">ModuleCode</span></a></span><span>
</span><span id="line-959"></span><span>                      </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">mc_module :: Module
</span><a href="GHC.StgToJS.Linker.Linker.html#mc_module"><span class="hs-identifier hs-var">mc_module</span></a></span><span>   </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Module
</span><a href="#local-6989586621682960306"><span class="hs-identifier hs-var">mod</span></a></span><span>
</span><span id="line-960"></span><span>                      </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">mc_js_code :: JStat
</span><a href="GHC.StgToJS.Linker.Linker.html#mc_js_code"><span class="hs-identifier hs-var">mc_js_code</span></a></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[ObjBlock] -&gt; JStat
</span><a href="#local-6989586621682960322"><span class="hs-identifier hs-var">mk_js_code</span></a></span><span> </span><span class="annot"><span class="annottext">[ObjBlock]
</span><a href="#local-6989586621682960324"><span class="hs-identifier hs-var">l</span></a></span><span>
</span><span id="line-961"></span><span>                      </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">mc_exports :: ByteString
</span><a href="GHC.StgToJS.Linker.Linker.html#mc_exports"><span class="hs-identifier hs-var">mc_exports</span></a></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[ObjBlock] -&gt; ByteString
</span><a href="#local-6989586621682960318"><span class="hs-identifier hs-var">mk_exports</span></a></span><span> </span><span class="annot"><span class="annottext">[ObjBlock]
</span><a href="#local-6989586621682960324"><span class="hs-identifier hs-var">l</span></a></span><span>
</span><span id="line-962"></span><span>                      </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">mc_closures :: [ClosureInfo]
</span><a href="GHC.StgToJS.Linker.Linker.html#mc_closures"><span class="hs-identifier hs-var">mc_closures</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(ObjBlock -&gt; [ClosureInfo]) -&gt; [ObjBlock] -&gt; [ClosureInfo]
forall (t :: * -&gt; *) a b. Foldable t =&gt; (a -&gt; [b]) -&gt; t a -&gt; [b]
</span><span class="hs-identifier hs-var">concatMap</span></span><span> </span><span class="annot"><span class="annottext">ObjBlock -&gt; [ClosureInfo]
</span><a href="GHC.StgToJS.Types.html#oiClInfo"><span class="hs-identifier hs-var">oiClInfo</span></a></span><span> </span><span class="annot"><span class="annottext">[ObjBlock]
</span><a href="#local-6989586621682960324"><span class="hs-identifier hs-var">l</span></a></span><span>
</span><span id="line-963"></span><span>                      </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">mc_statics :: [StaticInfo]
</span><a href="GHC.StgToJS.Linker.Linker.html#mc_statics"><span class="hs-identifier hs-var">mc_statics</span></a></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(ObjBlock -&gt; [StaticInfo]) -&gt; [ObjBlock] -&gt; [StaticInfo]
forall (t :: * -&gt; *) a b. Foldable t =&gt; (a -&gt; [b]) -&gt; t a -&gt; [b]
</span><span class="hs-identifier hs-var">concatMap</span></span><span> </span><span class="annot"><span class="annottext">ObjBlock -&gt; [StaticInfo]
</span><a href="GHC.StgToJS.Types.html#oiStatic"><span class="hs-identifier hs-var">oiStatic</span></a></span><span> </span><span class="annot"><span class="annottext">[ObjBlock]
</span><a href="#local-6989586621682960324"><span class="hs-identifier hs-var">l</span></a></span><span>
</span><span id="line-964"></span><span>                      </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">mc_frefs :: [ForeignJSRef]
</span><a href="GHC.StgToJS.Linker.Linker.html#mc_frefs"><span class="hs-identifier hs-var">mc_frefs</span></a></span><span>    </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(ObjBlock -&gt; [ForeignJSRef]) -&gt; [ObjBlock] -&gt; [ForeignJSRef]
forall (t :: * -&gt; *) a b. Foldable t =&gt; (a -&gt; [b]) -&gt; t a -&gt; [b]
</span><span class="hs-identifier hs-var">concatMap</span></span><span> </span><span class="annot"><span class="annottext">ObjBlock -&gt; [ForeignJSRef]
</span><a href="GHC.StgToJS.Types.html#oiFImports"><span class="hs-identifier hs-var">oiFImports</span></a></span><span> </span><span class="annot"><span class="annottext">[ObjBlock]
</span><a href="#local-6989586621682960324"><span class="hs-identifier hs-var">l</span></a></span><span>
</span><span id="line-965"></span><span>                      </span><span class="hs-special">}</span><span>
</span><span id="line-966"></span><span>
</span><span id="line-967"></span><span class="annot"><span class="hs-comment">-- | Load an archive in memory and store it in the cache for future loads.</span></span><span>
</span><span id="line-968"></span><span class="annot"><a href="GHC.StgToJS.Linker.Linker.html#loadArchive"><span class="hs-identifier hs-type">loadArchive</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.StgToJS.Linker.Linker.html#ArchiveCache"><span class="hs-identifier hs-type">ArchiveCache</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">FilePath</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="annot"><a href="GHC.SysTools.Ar.html#Archive"><span class="hs-identifier hs-type">Ar.Archive</span></a></span><span>
</span><span id="line-969"></span><span id="loadArchive"><span class="annot"><span class="annottext">loadArchive :: ArchiveCache -&gt; FilePath -&gt; IO Archive
</span><a href="GHC.StgToJS.Linker.Linker.html#loadArchive"><span class="hs-identifier hs-var hs-var">loadArchive</span></a></span></span><span> </span><span id="local-6989586621682960328"><span class="annot"><span class="annottext">ArchiveCache
</span><a href="#local-6989586621682960328"><span class="hs-identifier hs-var">ar_cache</span></a></span></span><span> </span><span id="local-6989586621682960329"><span class="annot"><span class="annottext">FilePath
</span><a href="#local-6989586621682960329"><span class="hs-identifier hs-var">ar_file</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-970"></span><span>  </span><span id="local-6989586621682960330"><span class="annot"><a href="#local-6989586621682960330"><span class="hs-identifier hs-var">loaded_ars</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">IORef (Map FilePath Archive) -&gt; IO (Map FilePath Archive)
forall a. IORef a -&gt; IO a
</span><span class="hs-identifier hs-var">readIORef</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ArchiveCache -&gt; IORef (Map FilePath Archive)
</span><a href="GHC.StgToJS.Linker.Linker.html#loadedArchives"><span class="hs-identifier hs-var">loadedArchives</span></a></span><span> </span><span class="annot"><span class="annottext">ArchiveCache
</span><a href="#local-6989586621682960328"><span class="hs-identifier hs-var">ar_cache</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-971"></span><span>  </span><span class="hs-keyword">case</span><span> </span><span class="annot"><a href="../../containers-0.7-5a8f/src/Data.Map.Internal.html#lookup"><span class="hs-identifier hs-type">M.lookup</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682960329"><span class="hs-identifier hs-type">ar_file</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682960330"><span class="hs-identifier hs-type">loaded_ars</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-972"></span><span>    </span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span id="local-6989586621682960331"><span class="annot"><span class="annottext">Archive
</span><a href="#local-6989586621682960331"><span class="hs-identifier hs-var">a</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Archive -&gt; IO Archive
forall a. a -&gt; IO a
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">pure</span></span><span> </span><span class="annot"><span class="annottext">Archive
</span><a href="#local-6989586621682960331"><span class="hs-identifier hs-var">a</span></a></span><span>
</span><span id="line-973"></span><span>    </span><span class="annot"><span class="annottext">Maybe Archive
</span><span class="hs-identifier hs-var">Nothing</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-974"></span><span>      </span><span id="local-6989586621682960332"><span class="annot"><a href="#local-6989586621682960332"><span class="hs-identifier hs-var">a</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">FilePath -&gt; IO Archive
</span><a href="GHC.SysTools.Ar.html#loadAr"><span class="hs-identifier hs-var">Ar.loadAr</span></a></span><span> </span><span class="annot"><span class="annottext">FilePath
</span><a href="#local-6989586621682960329"><span class="hs-identifier hs-var">ar_file</span></a></span><span>
</span><span id="line-975"></span><span>      </span><span class="annot"><span class="hs-identifier hs-type">modifyIORef</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.StgToJS.Linker.Linker.html#loadedArchives"><span class="hs-identifier hs-var">loadedArchives</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682960328"><span class="hs-identifier hs-type">ar_cache</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../../containers-0.7-5a8f/src/Data.Map.Strict.Internal.html#insert"><span class="hs-identifier hs-type">M.insert</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682960329"><span class="hs-identifier hs-type">ar_file</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682960332"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-976"></span><span>      </span><span class="annot"><span class="hs-identifier hs-type">pure</span></span><span> </span><span class="annot"><a href="#local-6989586621682960332"><span class="hs-identifier hs-type">a</span></a></span><span>
</span><span id="line-977"></span><span>
</span><span id="line-978"></span><span>
</span><span id="line-979"></span><span class="annot"><a href="GHC.StgToJS.Linker.Linker.html#readArObject"><span class="hs-identifier hs-type">readArObject</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.StgToJS.Linker.Linker.html#ArchiveCache"><span class="hs-identifier hs-type">ArchiveCache</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Unit.Types.html#Module"><span class="hs-identifier hs-type">Module</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">FilePath</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="annot"><a href="GHC.StgToJS.Object.html#Object"><span class="hs-identifier hs-type">Object</span></a></span><span>
</span><span id="line-980"></span><span id="readArObject"><span class="annot"><span class="annottext">readArObject :: ArchiveCache -&gt; Module -&gt; FilePath -&gt; IO Object
</span><a href="GHC.StgToJS.Linker.Linker.html#readArObject"><span class="hs-identifier hs-var hs-var">readArObject</span></a></span></span><span> </span><span id="local-6989586621682960334"><span class="annot"><span class="annottext">ArchiveCache
</span><a href="#local-6989586621682960334"><span class="hs-identifier hs-var">ar_cache</span></a></span></span><span> </span><span id="local-6989586621682960335"><span class="annot"><span class="annottext">Module
</span><a href="#local-6989586621682960335"><span class="hs-identifier hs-var">mod</span></a></span></span><span> </span><span id="local-6989586621682960336"><span class="annot"><span class="annottext">FilePath
</span><a href="#local-6989586621682960336"><span class="hs-identifier hs-var">ar_file</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-981"></span><span>  </span><span class="annot"><a href="GHC.SysTools.Ar.html#Archive"><span class="hs-identifier hs-type">Ar.Archive</span></a></span><span> </span><span id="local-6989586621682960337"><span class="annot"><a href="#local-6989586621682960337"><span class="hs-identifier hs-var">entries</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">ArchiveCache -&gt; FilePath -&gt; IO Archive
</span><a href="GHC.StgToJS.Linker.Linker.html#loadArchive"><span class="hs-identifier hs-var">loadArchive</span></a></span><span> </span><span class="annot"><span class="annottext">ArchiveCache
</span><a href="#local-6989586621682960334"><span class="hs-identifier hs-var">ar_cache</span></a></span><span> </span><span class="annot"><span class="annottext">FilePath
</span><a href="#local-6989586621682960336"><span class="hs-identifier hs-var">ar_file</span></a></span><span>
</span><span id="line-982"></span><span>
</span><span id="line-983"></span><span>  </span><span class="hs-comment">-- look for the right object in archive</span><span>
</span><span id="line-984"></span><span>  </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621682960338"><span class="annot"><a href="#local-6989586621682960338"><span class="hs-identifier hs-var hs-var">go_entries</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-glyph">\</span><span class="hs-glyph">case</span><span>
</span><span id="line-985"></span><span>        </span><span class="hs-comment">-- XXX this shouldn't be an exception probably</span><span>
</span><span id="line-986"></span><span>        </span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">FilePath -&gt; IO Object
forall a. HasCallStack =&gt; FilePath -&gt; a
</span><a href="GHC.Utils.Panic.Plain.html#panic"><span class="hs-identifier hs-var">panic</span></a></span><span> </span><span class="annot"><span class="annottext">(FilePath -&gt; IO Object) -&gt; FilePath -&gt; IO Object
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">FilePath
</span><span class="hs-string">&quot;could not find object for module &quot;</span></span><span>
</span><span id="line-987"></span><span>                      </span><span class="annot"><span class="annottext">FilePath -&gt; FilePath -&gt; FilePath
forall a. [a] -&gt; [a] -&gt; [a]
</span><span class="hs-operator hs-var">++</span></span><span> </span><span class="annot"><span class="annottext">ModuleName -&gt; FilePath
</span><a href="Language.Haskell.Syntax.Module.Name.html#moduleNameString"><span class="hs-identifier hs-var">moduleNameString</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Module -&gt; ModuleName
forall unit. GenModule unit -&gt; ModuleName
</span><a href="GHC.Unit.Types.html#moduleName"><span class="hs-identifier hs-var">moduleName</span></a></span><span> </span><span class="annot"><span class="annottext">Module
</span><a href="#local-6989586621682960335"><span class="hs-identifier hs-var">mod</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-988"></span><span>                      </span><span class="annot"><span class="annottext">FilePath -&gt; FilePath -&gt; FilePath
forall a. [a] -&gt; [a] -&gt; [a]
</span><span class="hs-operator hs-var">++</span></span><span> </span><span class="annot"><span class="annottext">FilePath
</span><span class="hs-string">&quot; in &quot;</span></span><span>
</span><span id="line-989"></span><span>                      </span><span class="annot"><span class="annottext">FilePath -&gt; FilePath -&gt; FilePath
forall a. [a] -&gt; [a] -&gt; [a]
</span><span class="hs-operator hs-var">++</span></span><span> </span><span class="annot"><span class="annottext">FilePath
</span><a href="#local-6989586621682960336"><span class="hs-identifier hs-var">ar_file</span></a></span><span>
</span><span id="line-990"></span><span>
</span><span id="line-991"></span><span>        </span><span class="hs-special">(</span><span id="local-6989586621682960341"><span class="annot"><span class="annottext">ArchiveEntry
</span><a href="#local-6989586621682960341"><span class="hs-identifier hs-var">e</span></a></span></span><span class="annot"><span class="hs-glyph hs-type">:</span></span><span id="local-6989586621682960342"><span class="annot"><span class="annottext">[ArchiveEntry]
</span><a href="#local-6989586621682960342"><span class="hs-identifier hs-var">es</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-992"></span><span>          </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621682960343"><span class="annot"><span class="annottext">bs :: ByteString
</span><a href="#local-6989586621682960343"><span class="hs-identifier hs-var hs-var hs-var">bs</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ArchiveEntry -&gt; ByteString
</span><a href="GHC.SysTools.Ar.html#filedata"><span class="hs-identifier hs-var">Ar.filedata</span></a></span><span> </span><span class="annot"><span class="annottext">ArchiveEntry
</span><a href="#local-6989586621682960341"><span class="hs-identifier hs-var">e</span></a></span><span>
</span><span id="line-993"></span><span>          </span><span id="local-6989586621682960344"><span class="annot"><a href="#local-6989586621682960344"><span class="hs-identifier hs-var">bh</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">ByteString -&gt; IO ReadBinHandle
</span><a href="GHC.Utils.Binary.html#unsafeUnpackBinBuffer"><span class="hs-identifier hs-var">unsafeUnpackBinBuffer</span></a></span><span> </span><span class="annot"><span class="annottext">ByteString
</span><a href="#local-6989586621682960343"><span class="hs-identifier hs-var">bs</span></a></span><span>
</span><span id="line-994"></span><span>          </span><span class="annot"><a href="GHC.StgToJS.Object.html#getObjectHeader"><span class="hs-identifier hs-type">getObjectHeader</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682960344"><span class="hs-identifier hs-type">bh</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">&gt;&gt;=</span></span><span> </span><span class="hs-glyph">\</span><span class="hs-glyph">case</span><span>
</span><span id="line-995"></span><span>            </span><span class="annot"><span class="hs-identifier hs-type">Left</span></span><span> </span><span class="annot"><span class="annottext">FilePath
</span><span class="hs-identifier">_</span></span><span>         </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">[ArchiveEntry] -&gt; IO Object
</span><a href="#local-6989586621682960338"><span class="hs-identifier hs-var">go_entries</span></a></span><span> </span><span class="annot"><span class="annottext">[ArchiveEntry]
</span><a href="#local-6989586621682960342"><span class="hs-identifier hs-var">es</span></a></span><span> </span><span class="hs-comment">-- not a valid object entry</span><span>
</span><span id="line-996"></span><span>            </span><span class="annot"><span class="hs-identifier hs-type">Right</span></span><span> </span><span id="local-6989586621682960347"><span class="annot"><span class="annottext">ModuleName
</span><a href="#local-6989586621682960347"><span class="hs-identifier hs-var">mod_name</span></a></span></span><span>
</span><span id="line-997"></span><span>              </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">ModuleName
</span><a href="#local-6989586621682960347"><span class="hs-identifier hs-var">mod_name</span></a></span><span> </span><span class="annot"><span class="annottext">ModuleName -&gt; ModuleName -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">/=</span></span><span> </span><span class="annot"><span class="annottext">Module -&gt; ModuleName
forall unit. GenModule unit -&gt; ModuleName
</span><a href="GHC.Unit.Types.html#moduleName"><span class="hs-identifier hs-var">moduleName</span></a></span><span> </span><span class="annot"><span class="annottext">Module
</span><a href="#local-6989586621682960335"><span class="hs-identifier hs-var">mod</span></a></span><span>
</span><span id="line-998"></span><span>              </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">[ArchiveEntry] -&gt; IO Object
</span><a href="#local-6989586621682960338"><span class="hs-identifier hs-var">go_entries</span></a></span><span> </span><span class="annot"><span class="annottext">[ArchiveEntry]
</span><a href="#local-6989586621682960342"><span class="hs-identifier hs-var">es</span></a></span><span> </span><span class="hs-comment">-- not the module we're looking for</span><span>
</span><span id="line-999"></span><span>              </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">otherwise</span></span><span>
</span><span id="line-1000"></span><span>              </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">ReadBinHandle -&gt; ModuleName -&gt; IO Object
</span><a href="GHC.StgToJS.Object.html#getObjectBody"><span class="hs-identifier hs-var">getObjectBody</span></a></span><span> </span><span class="annot"><span class="annottext">ReadBinHandle
</span><a href="#local-6989586621682960344"><span class="hs-identifier hs-var">bh</span></a></span><span> </span><span class="annot"><span class="annottext">ModuleName
</span><a href="#local-6989586621682960347"><span class="hs-identifier hs-var">mod_name</span></a></span><span> </span><span class="hs-comment">-- found it</span><span>
</span><span id="line-1001"></span><span>
</span><span id="line-1002"></span><span>  </span><span class="annot"><a href="#local-6989586621682960338"><span class="hs-identifier hs-type">go_entries</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682960337"><span class="hs-identifier hs-type">entries</span></a></span><span>
</span><span id="line-1003"></span><span>
</span><span id="line-1004"></span><span class="annot"><span class="hs-comment">-- | dependencies for the RTS, these need to be always linked</span></span><span>
</span><span id="line-1005"></span><span class="annot"><a href="GHC.StgToJS.Linker.Linker.html#rtsDeps"><span class="hs-identifier hs-type">rtsDeps</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="hs-special">[</span><span class="annot"><a href="GHC.Unit.Types.html#UnitId"><span class="hs-identifier hs-type">UnitId</span></a></span><span class="hs-special">]</span><span class="hs-special">,</span><span> </span><span class="annot"><a href="../../containers-0.7-5a8f/src/Data.Set.Internal.html#Set"><span class="hs-identifier hs-type">Set</span></a></span><span> </span><span class="annot"><a href="GHC.StgToJS.Object.html#ExportedFun"><span class="hs-identifier hs-type">ExportedFun</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1006"></span><span id="rtsDeps"><span class="annot"><span class="annottext">rtsDeps :: ([UnitId], Set ExportedFun)
</span><a href="GHC.StgToJS.Linker.Linker.html#rtsDeps"><span class="hs-identifier hs-var hs-var">rtsDeps</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-1007"></span><span>  </span><span class="hs-special">(</span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">UnitId
</span><a href="GHC.Unit.Types.html#ghcInternalUnitId"><span class="hs-identifier hs-var">ghcInternalUnitId</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">UnitId
</span><a href="GHC.Unit.Types.html#primUnitId"><span class="hs-identifier hs-var">primUnitId</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-1008"></span><span>  </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">[ExportedFun] -&gt; Set ExportedFun
forall a. Ord a =&gt; [a] -&gt; Set a
</span><a href="../../containers-0.7-5a8f/src/Data.Set.Internal.html#fromList"><span class="hs-identifier hs-var">S.fromList</span></a></span><span> </span><span class="annot"><span class="annottext">([ExportedFun] -&gt; Set ExportedFun)
-&gt; [ExportedFun] -&gt; Set ExportedFun
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">[[ExportedFun]] -&gt; [ExportedFun]
forall (t :: * -&gt; *) a. Foldable t =&gt; t [a] -&gt; [a]
</span><span class="hs-identifier hs-var">concat</span></span><span>
</span><span id="line-1009"></span><span>      </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">FastString -&gt; [FastString] -&gt; [ExportedFun]
</span><a href="GHC.StgToJS.Linker.Linker.html#mkInternalFuns"><span class="hs-identifier hs-var">mkInternalFuns</span></a></span><span> </span><span class="annot"><span class="annottext">FastString
</span><span class="hs-string">&quot;GHC.Internal.Conc.Sync&quot;</span></span><span>
</span><span id="line-1010"></span><span>          </span><span class="hs-special">[</span><span class="annot"><span class="annottext">FastString
</span><span class="hs-string">&quot;reportError&quot;</span></span><span class="hs-special">]</span><span>
</span><span id="line-1011"></span><span>      </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">FastString -&gt; [FastString] -&gt; [ExportedFun]
</span><a href="GHC.StgToJS.Linker.Linker.html#mkInternalFuns"><span class="hs-identifier hs-var">mkInternalFuns</span></a></span><span> </span><span class="annot"><span class="annottext">FastString
</span><span class="hs-string">&quot;GHC.Internal.Control.Exception.Base&quot;</span></span><span>
</span><span id="line-1012"></span><span>          </span><span class="hs-special">[</span><span class="annot"><span class="annottext">FastString
</span><span class="hs-string">&quot;nonTermination&quot;</span></span><span class="hs-special">]</span><span>
</span><span id="line-1013"></span><span>      </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">FastString -&gt; [FastString] -&gt; [ExportedFun]
</span><a href="GHC.StgToJS.Linker.Linker.html#mkInternalFuns"><span class="hs-identifier hs-var">mkInternalFuns</span></a></span><span> </span><span class="annot"><span class="annottext">FastString
</span><span class="hs-string">&quot;GHC.Internal.Exception.Type&quot;</span></span><span>
</span><span id="line-1014"></span><span>          </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">FastString
</span><span class="hs-string">&quot;SomeException&quot;</span></span><span>
</span><span id="line-1015"></span><span>          </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">FastString
</span><span class="hs-string">&quot;underflowException&quot;</span></span><span>
</span><span id="line-1016"></span><span>          </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">FastString
</span><span class="hs-string">&quot;overflowException&quot;</span></span><span>
</span><span id="line-1017"></span><span>          </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">FastString
</span><span class="hs-string">&quot;divZeroException&quot;</span></span><span>
</span><span id="line-1018"></span><span>          </span><span class="hs-special">]</span><span>
</span><span id="line-1019"></span><span>      </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">FastString -&gt; [FastString] -&gt; [ExportedFun]
</span><a href="GHC.StgToJS.Linker.Linker.html#mkInternalFuns"><span class="hs-identifier hs-var">mkInternalFuns</span></a></span><span> </span><span class="annot"><span class="annottext">FastString
</span><span class="hs-string">&quot;GHC.Internal.TopHandler&quot;</span></span><span>
</span><span id="line-1020"></span><span>          </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">FastString
</span><span class="hs-string">&quot;runMainIO&quot;</span></span><span>
</span><span id="line-1021"></span><span>          </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">FastString
</span><span class="hs-string">&quot;topHandler&quot;</span></span><span>
</span><span id="line-1022"></span><span>          </span><span class="hs-special">]</span><span>
</span><span id="line-1023"></span><span>      </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">FastString -&gt; [FastString] -&gt; [ExportedFun]
</span><a href="GHC.StgToJS.Linker.Linker.html#mkInternalFuns"><span class="hs-identifier hs-var">mkInternalFuns</span></a></span><span> </span><span class="annot"><span class="annottext">FastString
</span><span class="hs-string">&quot;GHC.Internal.Base&quot;</span></span><span>
</span><span id="line-1024"></span><span>          </span><span class="hs-special">[</span><span class="annot"><span class="annottext">FastString
</span><span class="hs-string">&quot;$fMonadIO&quot;</span></span><span class="hs-special">]</span><span>
</span><span id="line-1025"></span><span>      </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">FastString -&gt; [FastString] -&gt; [ExportedFun]
</span><a href="GHC.StgToJS.Linker.Linker.html#mkInternalFuns"><span class="hs-identifier hs-var">mkInternalFuns</span></a></span><span> </span><span class="annot"><span class="annottext">FastString
</span><span class="hs-string">&quot;GHC.Internal.Maybe&quot;</span></span><span>
</span><span id="line-1026"></span><span>          </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">FastString
</span><span class="hs-string">&quot;Nothing&quot;</span></span><span>
</span><span id="line-1027"></span><span>          </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">FastString
</span><span class="hs-string">&quot;Just&quot;</span></span><span>
</span><span id="line-1028"></span><span>          </span><span class="hs-special">]</span><span>
</span><span id="line-1029"></span><span>      </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">FastString -&gt; [FastString] -&gt; [ExportedFun]
</span><a href="GHC.StgToJS.Linker.Linker.html#mkInternalFuns"><span class="hs-identifier hs-var">mkInternalFuns</span></a></span><span> </span><span class="annot"><span class="annottext">FastString
</span><span class="hs-string">&quot;GHC.Internal.Ptr&quot;</span></span><span>
</span><span id="line-1030"></span><span>          </span><span class="hs-special">[</span><span class="annot"><span class="annottext">FastString
</span><span class="hs-string">&quot;Ptr&quot;</span></span><span class="hs-special">]</span><span>
</span><span id="line-1031"></span><span>      </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">FastString -&gt; [FastString] -&gt; [ExportedFun]
</span><a href="GHC.StgToJS.Linker.Linker.html#mkInternalFuns"><span class="hs-identifier hs-var">mkInternalFuns</span></a></span><span> </span><span class="annot"><span class="annottext">FastString
</span><span class="hs-string">&quot;GHC.Internal.JS.Prim&quot;</span></span><span>
</span><span id="line-1032"></span><span>          </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">FastString
</span><span class="hs-string">&quot;JSVal&quot;</span></span><span>
</span><span id="line-1033"></span><span>          </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">FastString
</span><span class="hs-string">&quot;JSException&quot;</span></span><span>
</span><span id="line-1034"></span><span>          </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">FastString
</span><span class="hs-string">&quot;$fShowJSException&quot;</span></span><span>
</span><span id="line-1035"></span><span>          </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">FastString
</span><span class="hs-string">&quot;$fExceptionJSException&quot;</span></span><span>
</span><span id="line-1036"></span><span>          </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">FastString
</span><span class="hs-string">&quot;resolve&quot;</span></span><span>
</span><span id="line-1037"></span><span>          </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">FastString
</span><span class="hs-string">&quot;resolveIO&quot;</span></span><span>
</span><span id="line-1038"></span><span>          </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">FastString
</span><span class="hs-string">&quot;toIO&quot;</span></span><span>
</span><span id="line-1039"></span><span>          </span><span class="hs-special">]</span><span>
</span><span id="line-1040"></span><span>      </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">FastString -&gt; [FastString] -&gt; [ExportedFun]
</span><a href="GHC.StgToJS.Linker.Linker.html#mkInternalFuns"><span class="hs-identifier hs-var">mkInternalFuns</span></a></span><span> </span><span class="annot"><span class="annottext">FastString
</span><span class="hs-string">&quot;GHC.Internal.JS.Prim.Internal&quot;</span></span><span>
</span><span id="line-1041"></span><span>          </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">FastString
</span><span class="hs-string">&quot;wouldBlock&quot;</span></span><span>
</span><span id="line-1042"></span><span>          </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">FastString
</span><span class="hs-string">&quot;blockedIndefinitelyOnMVar&quot;</span></span><span>
</span><span id="line-1043"></span><span>          </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">FastString
</span><span class="hs-string">&quot;blockedIndefinitelyOnSTM&quot;</span></span><span>
</span><span id="line-1044"></span><span>          </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">FastString
</span><span class="hs-string">&quot;ignoreException&quot;</span></span><span>
</span><span id="line-1045"></span><span>          </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">FastString
</span><span class="hs-string">&quot;setCurrentThreadResultException&quot;</span></span><span>
</span><span id="line-1046"></span><span>          </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">FastString
</span><span class="hs-string">&quot;setCurrentThreadResultValue&quot;</span></span><span>
</span><span id="line-1047"></span><span>          </span><span class="hs-special">]</span><span>
</span><span id="line-1048"></span><span>      </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">FastString -&gt; [FastString] -&gt; [ExportedFun]
</span><a href="GHC.StgToJS.Linker.Linker.html#mkPrimFuns"><span class="hs-identifier hs-var">mkPrimFuns</span></a></span><span> </span><span class="annot"><span class="annottext">FastString
</span><span class="hs-string">&quot;GHC.Types&quot;</span></span><span>
</span><span id="line-1049"></span><span>          </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">FastString
</span><span class="hs-string">&quot;:&quot;</span></span><span>
</span><span id="line-1050"></span><span>          </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">FastString
</span><span class="hs-string">&quot;[]&quot;</span></span><span>
</span><span id="line-1051"></span><span>          </span><span class="hs-special">]</span><span>
</span><span id="line-1052"></span><span>      </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">FastString -&gt; [FastString] -&gt; [ExportedFun]
</span><a href="GHC.StgToJS.Linker.Linker.html#mkPrimFuns"><span class="hs-identifier hs-var">mkPrimFuns</span></a></span><span> </span><span class="annot"><span class="annottext">FastString
</span><span class="hs-string">&quot;GHC.Tuple&quot;</span></span><span>
</span><span id="line-1053"></span><span>          </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">FastString
</span><span class="hs-string">&quot;(,)&quot;</span></span><span>
</span><span id="line-1054"></span><span>          </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">FastString
</span><span class="hs-string">&quot;(,,)&quot;</span></span><span>
</span><span id="line-1055"></span><span>          </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">FastString
</span><span class="hs-string">&quot;(,,,)&quot;</span></span><span>
</span><span id="line-1056"></span><span>          </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">FastString
</span><span class="hs-string">&quot;(,,,,)&quot;</span></span><span>
</span><span id="line-1057"></span><span>          </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">FastString
</span><span class="hs-string">&quot;(,,,,,)&quot;</span></span><span>
</span><span id="line-1058"></span><span>          </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">FastString
</span><span class="hs-string">&quot;(,,,,,,)&quot;</span></span><span>
</span><span id="line-1059"></span><span>          </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">FastString
</span><span class="hs-string">&quot;(,,,,,,,)&quot;</span></span><span>
</span><span id="line-1060"></span><span>          </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">FastString
</span><span class="hs-string">&quot;(,,,,,,,,)&quot;</span></span><span>
</span><span id="line-1061"></span><span>          </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">FastString
</span><span class="hs-string">&quot;(,,,,,,,,,)&quot;</span></span><span>
</span><span id="line-1062"></span><span>          </span><span class="hs-special">]</span><span>
</span><span id="line-1063"></span><span>      </span><span class="hs-special">]</span><span>
</span><span id="line-1064"></span><span>  </span><span class="hs-special">)</span><span>
</span><span id="line-1065"></span><span>
</span><span id="line-1066"></span><span class="annot"><span class="hs-comment">-- | Export the functions in @ghc-internal@</span></span><span>
</span><span id="line-1067"></span><span class="annot"><a href="GHC.StgToJS.Linker.Linker.html#mkInternalFuns"><span class="hs-identifier hs-type">mkInternalFuns</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Data.FastString.html#FastString"><span class="hs-identifier hs-type">FastString</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="GHC.Data.FastString.html#FastString"><span class="hs-identifier hs-type">FastString</span></a></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="GHC.StgToJS.Object.html#ExportedFun"><span class="hs-identifier hs-type">ExportedFun</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-1068"></span><span id="mkInternalFuns"><span class="annot"><span class="annottext">mkInternalFuns :: FastString -&gt; [FastString] -&gt; [ExportedFun]
</span><a href="GHC.StgToJS.Linker.Linker.html#mkInternalFuns"><span class="hs-identifier hs-var hs-var">mkInternalFuns</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">UnitId -&gt; FastString -&gt; [FastString] -&gt; [ExportedFun]
</span><a href="GHC.StgToJS.Linker.Linker.html#mkExportedFuns"><span class="hs-identifier hs-var">mkExportedFuns</span></a></span><span> </span><span class="annot"><span class="annottext">UnitId
</span><a href="GHC.Unit.Types.html#ghcInternalUnitId"><span class="hs-identifier hs-var">ghcInternalUnitId</span></a></span><span>
</span><span id="line-1069"></span><span>
</span><span id="line-1070"></span><span class="annot"><span class="hs-comment">-- | Export the Prim functions</span></span><span>
</span><span id="line-1071"></span><span class="annot"><a href="GHC.StgToJS.Linker.Linker.html#mkPrimFuns"><span class="hs-identifier hs-type">mkPrimFuns</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Data.FastString.html#FastString"><span class="hs-identifier hs-type">FastString</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="GHC.Data.FastString.html#FastString"><span class="hs-identifier hs-type">FastString</span></a></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="GHC.StgToJS.Object.html#ExportedFun"><span class="hs-identifier hs-type">ExportedFun</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-1072"></span><span id="mkPrimFuns"><span class="annot"><span class="annottext">mkPrimFuns :: FastString -&gt; [FastString] -&gt; [ExportedFun]
</span><a href="GHC.StgToJS.Linker.Linker.html#mkPrimFuns"><span class="hs-identifier hs-var hs-var">mkPrimFuns</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">UnitId -&gt; FastString -&gt; [FastString] -&gt; [ExportedFun]
</span><a href="GHC.StgToJS.Linker.Linker.html#mkExportedFuns"><span class="hs-identifier hs-var">mkExportedFuns</span></a></span><span> </span><span class="annot"><span class="annottext">UnitId
</span><a href="GHC.Unit.Types.html#primUnitId"><span class="hs-identifier hs-var">primUnitId</span></a></span><span>
</span><span id="line-1073"></span><span>
</span><span id="line-1074"></span><span class="hs-comment">-- | Given a @UnitId@, a module name, and a set of symbols in the module,</span><span>
</span><span id="line-1075"></span><span class="hs-comment">-- package these into an @ExportedFun@.</span><span>
</span><span id="line-1076"></span><span class="annot"><a href="GHC.StgToJS.Linker.Linker.html#mkExportedFuns"><span class="hs-identifier hs-type">mkExportedFuns</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Unit.Types.html#UnitId"><span class="hs-identifier hs-type">UnitId</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Data.FastString.html#FastString"><span class="hs-identifier hs-type">FastString</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="GHC.Data.FastString.html#FastString"><span class="hs-identifier hs-type">FastString</span></a></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="GHC.StgToJS.Object.html#ExportedFun"><span class="hs-identifier hs-type">ExportedFun</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-1077"></span><span id="mkExportedFuns"><span class="annot"><span class="annottext">mkExportedFuns :: UnitId -&gt; FastString -&gt; [FastString] -&gt; [ExportedFun]
</span><a href="GHC.StgToJS.Linker.Linker.html#mkExportedFuns"><span class="hs-identifier hs-var hs-var">mkExportedFuns</span></a></span></span><span> </span><span id="local-6989586621682960352"><span class="annot"><span class="annottext">UnitId
</span><a href="#local-6989586621682960352"><span class="hs-identifier hs-var">uid</span></a></span></span><span> </span><span id="local-6989586621682960353"><span class="annot"><span class="annottext">FastString
</span><a href="#local-6989586621682960353"><span class="hs-identifier hs-var">mod_name</span></a></span></span><span> </span><span id="local-6989586621682960354"><span class="annot"><span class="annottext">[FastString]
</span><a href="#local-6989586621682960354"><span class="hs-identifier hs-var">symbols</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Module -&gt; [FastString] -&gt; [ExportedFun]
</span><a href="GHC.StgToJS.Linker.Linker.html#mkExportedModFuns"><span class="hs-identifier hs-var">mkExportedModFuns</span></a></span><span> </span><span class="annot"><span class="annottext">Module
</span><a href="#local-6989586621682960355"><span class="hs-identifier hs-var">mod</span></a></span><span> </span><span class="annot"><span class="annottext">[FastString]
</span><a href="#local-6989586621682960356"><span class="hs-identifier hs-var">names</span></a></span><span>
</span><span id="line-1078"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-1079"></span><span>    </span><span id="local-6989586621682960355"><span class="annot"><span class="annottext">mod :: Module
</span><a href="#local-6989586621682960355"><span class="hs-identifier hs-var hs-var">mod</span></a></span></span><span>        </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">GenUnit UnitId -&gt; ModuleName -&gt; Module
forall u. u -&gt; ModuleName -&gt; GenModule u
</span><a href="GHC.Unit.Types.html#mkModule"><span class="hs-identifier hs-var">mkModule</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Definite UnitId -&gt; GenUnit UnitId
forall uid. Definite uid -&gt; GenUnit uid
</span><a href="GHC.Unit.Types.html#RealUnit"><span class="hs-identifier hs-var">RealUnit</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">UnitId -&gt; Definite UnitId
forall unit. unit -&gt; Definite unit
</span><a href="GHC.Unit.Types.html#Definite"><span class="hs-identifier hs-var">Definite</span></a></span><span> </span><span class="annot"><span class="annottext">UnitId
</span><a href="#local-6989586621682960352"><span class="hs-identifier hs-var">uid</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">FastString -&gt; ModuleName
</span><a href="Language.Haskell.Syntax.Module.Name.html#mkModuleNameFS"><span class="hs-identifier hs-var">mkModuleNameFS</span></a></span><span> </span><span class="annot"><span class="annottext">FastString
</span><a href="#local-6989586621682960353"><span class="hs-identifier hs-var">mod_name</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1080"></span><span>    </span><span id="local-6989586621682960356"><span class="annot"><span class="annottext">names :: [FastString]
</span><a href="#local-6989586621682960356"><span class="hs-identifier hs-var hs-var">names</span></a></span></span><span>      </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(FastString -&gt; FastString) -&gt; [FastString] -&gt; [FastString]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><span class="hs-identifier hs-var">map</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Bool -&gt; Module -&gt; FastString -&gt; FastString
</span><a href="GHC.StgToJS.Symbols.html#mkJsSymbol"><span class="hs-identifier hs-var">mkJsSymbol</span></a></span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">True</span></span><span> </span><span class="annot"><span class="annottext">Module
</span><a href="#local-6989586621682960355"><span class="hs-identifier hs-var">mod</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[FastString]
</span><a href="#local-6989586621682960354"><span class="hs-identifier hs-var">symbols</span></a></span><span>
</span><span id="line-1081"></span><span>
</span><span id="line-1082"></span><span class="hs-comment">-- | Given a @Module@ and a set of symbols in the module, package these into an</span><span>
</span><span id="line-1083"></span><span class="hs-comment">-- @ExportedFun@.</span><span>
</span><span id="line-1084"></span><span class="annot"><a href="GHC.StgToJS.Linker.Linker.html#mkExportedModFuns"><span class="hs-identifier hs-type">mkExportedModFuns</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Unit.Types.html#Module"><span class="hs-identifier hs-type">Module</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="GHC.Data.FastString.html#FastString"><span class="hs-identifier hs-type">FastString</span></a></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="GHC.StgToJS.Object.html#ExportedFun"><span class="hs-identifier hs-type">ExportedFun</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-1085"></span><span id="mkExportedModFuns"><span class="annot"><span class="annottext">mkExportedModFuns :: Module -&gt; [FastString] -&gt; [ExportedFun]
</span><a href="GHC.StgToJS.Linker.Linker.html#mkExportedModFuns"><span class="hs-identifier hs-var hs-var">mkExportedModFuns</span></a></span></span><span> </span><span id="local-6989586621682960362"><span class="annot"><span class="annottext">Module
</span><a href="#local-6989586621682960362"><span class="hs-identifier hs-var">mod</span></a></span></span><span> </span><span id="local-6989586621682960363"><span class="annot"><span class="annottext">[FastString]
</span><a href="#local-6989586621682960363"><span class="hs-identifier hs-var">symbols</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(FastString -&gt; ExportedFun) -&gt; [FastString] -&gt; [ExportedFun]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><span class="hs-identifier hs-var">map</span></span><span> </span><span class="annot"><span class="annottext">FastString -&gt; ExportedFun
</span><a href="#local-6989586621682960364"><span class="hs-identifier hs-var">mk_fun</span></a></span><span> </span><span class="annot"><span class="annottext">[FastString]
</span><a href="#local-6989586621682960363"><span class="hs-identifier hs-var">symbols</span></a></span><span>
</span><span id="line-1086"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-1087"></span><span>    </span><span id="local-6989586621682960364"><span class="annot"><span class="annottext">mk_fun :: FastString -&gt; ExportedFun
</span><a href="#local-6989586621682960364"><span class="hs-identifier hs-var hs-var">mk_fun</span></a></span></span><span> </span><span id="local-6989586621682960365"><span class="annot"><span class="annottext">FastString
</span><a href="#local-6989586621682960365"><span class="hs-identifier hs-var">sym</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Module -&gt; LexicalFastString -&gt; ExportedFun
</span><a href="GHC.StgToJS.Object.html#ExportedFun"><span class="hs-identifier hs-var">ExportedFun</span></a></span><span> </span><span class="annot"><span class="annottext">Module
</span><a href="#local-6989586621682960362"><span class="hs-identifier hs-var">mod</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">FastString -&gt; LexicalFastString
</span><a href="GHC.Data.FastString.html#LexicalFastString"><span class="hs-identifier hs-var">LexicalFastString</span></a></span><span> </span><span class="annot"><span class="annottext">FastString
</span><a href="#local-6989586621682960365"><span class="hs-identifier hs-var">sym</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1088"></span><span>
</span><span id="line-1089"></span><span class="annot"><span class="hs-comment">-- | read all dependency data from the to-be-linked files</span></span><span>
</span><span id="line-1090"></span><span class="annot"><a href="GHC.StgToJS.Linker.Linker.html#loadObjBlockInfo"><span class="hs-identifier hs-type">loadObjBlockInfo</span></a></span><span>
</span><span id="line-1091"></span><span>  </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><span class="annot"><span class="hs-identifier hs-type">FilePath</span></span><span class="hs-special">]</span><span> </span><span class="annot"><span class="hs-comment">-- ^ object files to link</span></span><span>
</span><span id="line-1092"></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../../containers-0.7-5a8f/src/Data.Map.Internal.html#Map"><span class="hs-identifier hs-type">Map</span></a></span><span> </span><span class="annot"><a href="GHC.Unit.Types.html#Module"><span class="hs-identifier hs-type">Module</span></a></span><span> </span><span class="annot"><a href="GHC.StgToJS.Object.html#LocatedBlockInfo"><span class="hs-identifier hs-type">LocatedBlockInfo</span></a></span><span class="hs-special">,</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="GHC.StgToJS.Object.html#BlockRef"><span class="hs-identifier hs-type">BlockRef</span></a></span><span class="hs-special">]</span><span class="hs-special">)</span><span>
</span><span id="line-1093"></span><span id="loadObjBlockInfo"><span class="annot"><span class="annottext">loadObjBlockInfo :: [FilePath] -&gt; IO (Map Module LocatedBlockInfo, [BlockRef])
</span><a href="GHC.StgToJS.Linker.Linker.html#loadObjBlockInfo"><span class="hs-identifier hs-var hs-var">loadObjBlockInfo</span></a></span></span><span> </span><span id="local-6989586621682960368"><span class="annot"><span class="annottext">[FilePath]
</span><a href="#local-6989586621682960368"><span class="hs-identifier hs-var">objs</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[LocatedBlockInfo] -&gt; (Map Module LocatedBlockInfo, [BlockRef])
</span><a href="GHC.StgToJS.Linker.Linker.html#prepareLoadedDeps"><span class="hs-identifier hs-var">prepareLoadedDeps</span></a></span><span> </span><span class="annot"><span class="annottext">([LocatedBlockInfo] -&gt; (Map Module LocatedBlockInfo, [BlockRef]))
-&gt; ([Maybe LocatedBlockInfo] -&gt; [LocatedBlockInfo])
-&gt; [Maybe LocatedBlockInfo]
-&gt; (Map Module LocatedBlockInfo, [BlockRef])
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">[Maybe LocatedBlockInfo] -&gt; [LocatedBlockInfo]
forall a. [Maybe a] -&gt; [a]
</span><span class="hs-identifier hs-var">catMaybes</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">([Maybe LocatedBlockInfo]
 -&gt; (Map Module LocatedBlockInfo, [BlockRef]))
-&gt; IO [Maybe LocatedBlockInfo]
-&gt; IO (Map Module LocatedBlockInfo, [BlockRef])
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="annot"><span class="annottext">(FilePath -&gt; IO (Maybe LocatedBlockInfo))
-&gt; [FilePath] -&gt; IO [Maybe LocatedBlockInfo]
forall (t :: * -&gt; *) (m :: * -&gt; *) a b.
(Traversable t, Monad m) =&gt;
(a -&gt; m b) -&gt; t a -&gt; m (t b)
forall (m :: * -&gt; *) a b. Monad m =&gt; (a -&gt; m b) -&gt; [a] -&gt; m [b]
</span><span class="hs-identifier hs-var">mapM</span></span><span> </span><span class="annot"><span class="annottext">FilePath -&gt; IO (Maybe LocatedBlockInfo)
</span><a href="GHC.StgToJS.Linker.Linker.html#readBlockInfoFromObj"><span class="hs-identifier hs-var">readBlockInfoFromObj</span></a></span><span> </span><span class="annot"><span class="annottext">[FilePath]
</span><a href="#local-6989586621682960368"><span class="hs-identifier hs-var">objs</span></a></span><span>
</span><span id="line-1094"></span><span>
</span><span id="line-1095"></span><span class="annot"><span class="hs-comment">-- | Load dependencies for the Linker from Ar</span></span><span>
</span><span id="line-1096"></span><span class="annot"><a href="GHC.StgToJS.Linker.Linker.html#loadArchiveBlockInfo"><span class="hs-identifier hs-type">loadArchiveBlockInfo</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.StgToJS.Linker.Linker.html#ArchiveCache"><span class="hs-identifier hs-type">ArchiveCache</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><span class="hs-identifier hs-type">FilePath</span></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../../containers-0.7-5a8f/src/Data.Map.Internal.html#Map"><span class="hs-identifier hs-type">Map</span></a></span><span> </span><span class="annot"><a href="GHC.Unit.Types.html#Module"><span class="hs-identifier hs-type">Module</span></a></span><span> </span><span class="annot"><a href="GHC.StgToJS.Object.html#LocatedBlockInfo"><span class="hs-identifier hs-type">LocatedBlockInfo</span></a></span><span class="hs-special">,</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="GHC.StgToJS.Object.html#BlockRef"><span class="hs-identifier hs-type">BlockRef</span></a></span><span class="hs-special">]</span><span class="hs-special">)</span><span>
</span><span id="line-1097"></span><span id="loadArchiveBlockInfo"><span class="annot"><span class="annottext">loadArchiveBlockInfo :: ArchiveCache
-&gt; [FilePath] -&gt; IO (Map Module LocatedBlockInfo, [BlockRef])
</span><a href="GHC.StgToJS.Linker.Linker.html#loadArchiveBlockInfo"><span class="hs-identifier hs-var hs-var">loadArchiveBlockInfo</span></a></span></span><span> </span><span id="local-6989586621682960372"><span class="annot"><span class="annottext">ArchiveCache
</span><a href="#local-6989586621682960372"><span class="hs-identifier hs-var">ar_cache</span></a></span></span><span> </span><span id="local-6989586621682960373"><span class="annot"><span class="annottext">[FilePath]
</span><a href="#local-6989586621682960373"><span class="hs-identifier hs-var">archives</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-1098"></span><span>  </span><span id="local-6989586621682960374"><span class="annot"><a href="#local-6989586621682960374"><span class="hs-identifier hs-var">archDeps</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">[FilePath]
-&gt; (FilePath -&gt; IO [LocatedBlockInfo]) -&gt; IO [[LocatedBlockInfo]]
forall (t :: * -&gt; *) (m :: * -&gt; *) a b.
(Traversable t, Monad m) =&gt;
t a -&gt; (a -&gt; m b) -&gt; m (t b)
</span><span class="hs-identifier hs-var">forM</span></span><span> </span><span class="annot"><span class="annottext">[FilePath]
</span><a href="#local-6989586621682960373"><span class="hs-identifier hs-var">archives</span></a></span><span> </span><span class="annot"><span class="annottext">((FilePath -&gt; IO [LocatedBlockInfo]) -&gt; IO [[LocatedBlockInfo]])
-&gt; (FilePath -&gt; IO [LocatedBlockInfo]) -&gt; IO [[LocatedBlockInfo]]
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-glyph">\</span><span id="local-6989586621682960375"><span class="annot"><span class="annottext">FilePath
</span><a href="#local-6989586621682960375"><span class="hs-identifier hs-var">file</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-1099"></span><span>    </span><span class="hs-special">(</span><span class="annot"><a href="GHC.SysTools.Ar.html#Archive"><span class="hs-identifier hs-type">Ar.Archive</span></a></span><span> </span><span id="local-6989586621682960376"><span class="annot"><a href="#local-6989586621682960376"><span class="hs-identifier hs-var">entries</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">ArchiveCache -&gt; FilePath -&gt; IO Archive
</span><a href="GHC.StgToJS.Linker.Linker.html#loadArchive"><span class="hs-identifier hs-var">loadArchive</span></a></span><span> </span><span class="annot"><span class="annottext">ArchiveCache
</span><a href="#local-6989586621682960372"><span class="hs-identifier hs-var">ar_cache</span></a></span><span> </span><span class="annot"><span class="annottext">FilePath
</span><a href="#local-6989586621682960375"><span class="hs-identifier hs-var">file</span></a></span><span>
</span><span id="line-1100"></span><span>    </span><span class="annot"><span class="hs-identifier hs-type">catMaybes</span></span><span> </span><span class="annot"><span class="hs-operator hs-type">&lt;$&gt;</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">mapM</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621682960377"><span class="hs-identifier hs-type">readEntry</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682960375"><span class="hs-identifier hs-type">file</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><a href="#local-6989586621682960376"><span class="hs-identifier hs-type">entries</span></a></span><span>
</span><span id="line-1101"></span><span>  </span><span class="annot"><span class="hs-identifier hs-type">return</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.StgToJS.Linker.Linker.html#prepareLoadedDeps"><span class="hs-identifier hs-type">prepareLoadedDeps</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">concat</span></span><span> </span><span class="annot"><a href="#local-6989586621682960374"><span class="hs-identifier hs-type">archDeps</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1102"></span><span>    </span><span class="hs-keyword">where</span><span>
</span><span id="line-1103"></span><span>      </span><span class="annot"><a href="#local-6989586621682960377"><span class="hs-identifier hs-type">readEntry</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">FilePath</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.SysTools.Ar.html#ArchiveEntry"><span class="hs-identifier hs-type">Ar.ArchiveEntry</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Maybe</span></span><span> </span><span class="annot"><a href="GHC.StgToJS.Object.html#LocatedBlockInfo"><span class="hs-identifier hs-type">LocatedBlockInfo</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1104"></span><span>      </span><span id="local-6989586621682960377"><span class="annot"><span class="annottext">readEntry :: FilePath -&gt; ArchiveEntry -&gt; IO (Maybe LocatedBlockInfo)
</span><a href="#local-6989586621682960377"><span class="hs-identifier hs-var hs-var">readEntry</span></a></span></span><span> </span><span id="local-6989586621682960378"><span class="annot"><span class="annottext">FilePath
</span><a href="#local-6989586621682960378"><span class="hs-identifier hs-var">ar_file</span></a></span></span><span> </span><span id="local-6989586621682960379"><span class="annot"><span class="annottext">ArchiveEntry
</span><a href="#local-6989586621682960379"><span class="hs-identifier hs-var">ar_entry</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-1105"></span><span>          </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621682960380"><span class="annot"><span class="annottext">bs :: ByteString
</span><a href="#local-6989586621682960380"><span class="hs-identifier hs-var hs-var hs-var">bs</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ArchiveEntry -&gt; ByteString
</span><a href="GHC.SysTools.Ar.html#filedata"><span class="hs-identifier hs-var">Ar.filedata</span></a></span><span> </span><span class="annot"><span class="annottext">ArchiveEntry
</span><a href="#local-6989586621682960379"><span class="hs-identifier hs-var">ar_entry</span></a></span><span>
</span><span id="line-1106"></span><span>          </span><span id="local-6989586621682960381"><span class="annot"><a href="#local-6989586621682960381"><span class="hs-identifier hs-var">bh</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">ByteString -&gt; IO ReadBinHandle
</span><a href="GHC.Utils.Binary.html#unsafeUnpackBinBuffer"><span class="hs-identifier hs-var">unsafeUnpackBinBuffer</span></a></span><span> </span><span class="annot"><span class="annottext">ByteString
</span><a href="#local-6989586621682960380"><span class="hs-identifier hs-var">bs</span></a></span><span>
</span><span id="line-1107"></span><span>          </span><span class="annot"><a href="GHC.StgToJS.Object.html#getObjectHeader"><span class="hs-identifier hs-type">getObjectHeader</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682960381"><span class="hs-identifier hs-type">bh</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">&gt;&gt;=</span></span><span> </span><span class="hs-glyph">\</span><span class="hs-glyph">case</span><span>
</span><span id="line-1108"></span><span>            </span><span class="annot"><span class="hs-identifier hs-type">Left</span></span><span> </span><span class="annot"><span class="annottext">FilePath
</span><span class="hs-identifier">_</span></span><span>         </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Maybe LocatedBlockInfo -&gt; IO (Maybe LocatedBlockInfo)
forall a. a -&gt; IO a
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">pure</span></span><span> </span><span class="annot"><span class="annottext">Maybe LocatedBlockInfo
forall a. Maybe a
</span><span class="hs-identifier hs-var">Nothing</span></span><span> </span><span class="hs-comment">-- not a valid object entry</span><span>
</span><span id="line-1109"></span><span>            </span><span class="annot"><span class="hs-identifier hs-type">Right</span></span><span> </span><span id="local-6989586621682960382"><span class="annot"><span class="annottext">ModuleName
</span><a href="#local-6989586621682960382"><span class="hs-identifier hs-var">mod_name</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-1110"></span><span>              </span><span id="local-6989586621682960383"><span class="annot"><a href="#local-6989586621682960383"><span class="hs-identifier hs-var">obj</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">ReadBinHandle -&gt; ModuleName -&gt; IO Object
</span><a href="GHC.StgToJS.Object.html#getObjectBody"><span class="hs-identifier hs-var">getObjectBody</span></a></span><span> </span><span class="annot"><span class="annottext">ReadBinHandle
</span><a href="#local-6989586621682960381"><span class="hs-identifier hs-var">bh</span></a></span><span> </span><span class="annot"><span class="annottext">ModuleName
</span><a href="#local-6989586621682960382"><span class="hs-identifier hs-var">mod_name</span></a></span><span>
</span><span id="line-1111"></span><span>              </span><span class="hs-keyword">let</span><span> </span><span class="hs-glyph">!</span><span id="local-6989586621682960384"><span class="annot"><a href="#local-6989586621682960384"><span class="hs-identifier hs-var hs-var">info</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Object -&gt; BlockInfo
</span><a href="GHC.StgToJS.Object.html#objBlockInfo"><span class="hs-identifier hs-var">objBlockInfo</span></a></span><span> </span><span class="annot"><span class="annottext">Object
</span><a href="#local-6989586621682960383"><span class="hs-identifier hs-var">obj</span></a></span><span>
</span><span id="line-1112"></span><span>              </span><span class="annot"><span class="hs-identifier hs-type">pure</span></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.StgToJS.Object.html#LocatedBlockInfo"><span class="hs-identifier hs-type">LocatedBlockInfo</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.StgToJS.Object.html#ArchiveFile"><span class="hs-identifier hs-type">ArchiveFile</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682960378"><span class="hs-identifier hs-type">ar_file</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><a href="#local-6989586621682960384"><span class="hs-identifier hs-type">info</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1113"></span><span>
</span><span id="line-1114"></span><span class="annot"><a href="GHC.StgToJS.Linker.Linker.html#prepareLoadedDeps"><span class="hs-identifier hs-type">prepareLoadedDeps</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="GHC.StgToJS.Object.html#LocatedBlockInfo"><span class="hs-identifier hs-type">LocatedBlockInfo</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-1115"></span><span>                  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../../containers-0.7-5a8f/src/Data.Map.Internal.html#Map"><span class="hs-identifier hs-type">Map</span></a></span><span> </span><span class="annot"><a href="GHC.Unit.Types.html#Module"><span class="hs-identifier hs-type">Module</span></a></span><span> </span><span class="annot"><a href="GHC.StgToJS.Object.html#LocatedBlockInfo"><span class="hs-identifier hs-type">LocatedBlockInfo</span></a></span><span class="hs-special">,</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="GHC.StgToJS.Object.html#BlockRef"><span class="hs-identifier hs-type">BlockRef</span></a></span><span class="hs-special">]</span><span class="hs-special">)</span><span>
</span><span id="line-1116"></span><span id="prepareLoadedDeps"><span class="annot"><span class="annottext">prepareLoadedDeps :: [LocatedBlockInfo] -&gt; (Map Module LocatedBlockInfo, [BlockRef])
</span><a href="GHC.StgToJS.Linker.Linker.html#prepareLoadedDeps"><span class="hs-identifier hs-var hs-var">prepareLoadedDeps</span></a></span></span><span> </span><span id="local-6989586621682960387"><span class="annot"><span class="annottext">[LocatedBlockInfo]
</span><a href="#local-6989586621682960387"><span class="hs-identifier hs-var">lbis</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Map Module LocatedBlockInfo
</span><a href="#local-6989586621682960388"><span class="hs-identifier hs-var">module_blocks</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">[BlockRef]
</span><a href="#local-6989586621682960389"><span class="hs-identifier hs-var">must_link</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1117"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-1118"></span><span>    </span><span id="local-6989586621682960389"><span class="annot"><span class="annottext">must_link :: [BlockRef]
</span><a href="#local-6989586621682960389"><span class="hs-identifier hs-var hs-var">must_link</span></a></span></span><span>     </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(LocatedBlockInfo -&gt; [BlockRef])
-&gt; [LocatedBlockInfo] -&gt; [BlockRef]
forall (t :: * -&gt; *) a b. Foldable t =&gt; (a -&gt; [b]) -&gt; t a -&gt; [b]
</span><span class="hs-identifier hs-var">concatMap</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">BlockInfo -&gt; [BlockRef]
</span><a href="GHC.StgToJS.Linker.Linker.html#requiredBlocks"><span class="hs-identifier hs-var">requiredBlocks</span></a></span><span> </span><span class="annot"><span class="annottext">(BlockInfo -&gt; [BlockRef])
-&gt; (LocatedBlockInfo -&gt; BlockInfo)
-&gt; LocatedBlockInfo
-&gt; [BlockRef]
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">LocatedBlockInfo -&gt; BlockInfo
</span><a href="GHC.StgToJS.Object.html#lbi_info"><span class="hs-identifier hs-var">lbi_info</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[LocatedBlockInfo]
</span><a href="#local-6989586621682960387"><span class="hs-identifier hs-var">lbis</span></a></span><span>
</span><span id="line-1119"></span><span>    </span><span id="local-6989586621682960388"><span class="annot"><span class="annottext">module_blocks :: Map Module LocatedBlockInfo
</span><a href="#local-6989586621682960388"><span class="hs-identifier hs-var hs-var">module_blocks</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[(Module, LocatedBlockInfo)] -&gt; Map Module LocatedBlockInfo
forall k a. Ord k =&gt; [(k, a)] -&gt; Map k a
</span><a href="../../containers-0.7-5a8f/src/Data.Map.Strict.Internal.html#fromList"><span class="hs-identifier hs-var">M.fromList</span></a></span><span> </span><span class="annot"><span class="annottext">([(Module, LocatedBlockInfo)] -&gt; Map Module LocatedBlockInfo)
-&gt; [(Module, LocatedBlockInfo)] -&gt; Map Module LocatedBlockInfo
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">(LocatedBlockInfo -&gt; (Module, LocatedBlockInfo))
-&gt; [LocatedBlockInfo] -&gt; [(Module, LocatedBlockInfo)]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><span class="hs-identifier hs-var">map</span></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span id="local-6989586621682960391"><span class="annot"><span class="annottext">LocatedBlockInfo
</span><a href="#local-6989586621682960391"><span class="hs-identifier hs-var">d</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">BlockInfo -&gt; Module
</span><a href="GHC.StgToJS.Object.html#bi_module"><span class="hs-identifier hs-var">bi_module</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">LocatedBlockInfo -&gt; BlockInfo
</span><a href="GHC.StgToJS.Object.html#lbi_info"><span class="hs-identifier hs-var">lbi_info</span></a></span><span> </span><span class="annot"><span class="annottext">LocatedBlockInfo
</span><a href="#local-6989586621682960391"><span class="hs-identifier hs-var">d</span></a></span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">LocatedBlockInfo
</span><a href="#local-6989586621682960391"><span class="hs-identifier hs-var">d</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[LocatedBlockInfo]
</span><a href="#local-6989586621682960387"><span class="hs-identifier hs-var">lbis</span></a></span><span>
</span><span id="line-1120"></span><span>
</span><span id="line-1121"></span><span class="annot"><a href="GHC.StgToJS.Linker.Linker.html#requiredBlocks"><span class="hs-identifier hs-type">requiredBlocks</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.StgToJS.Object.html#BlockInfo"><span class="hs-identifier hs-type">BlockInfo</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="GHC.StgToJS.Object.html#BlockRef"><span class="hs-identifier hs-type">BlockRef</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-1122"></span><span id="requiredBlocks"><span class="annot"><span class="annottext">requiredBlocks :: BlockInfo -&gt; [BlockRef]
</span><a href="GHC.StgToJS.Linker.Linker.html#requiredBlocks"><span class="hs-identifier hs-var hs-var">requiredBlocks</span></a></span></span><span> </span><span id="local-6989586621682960392"><span class="annot"><span class="annottext">BlockInfo
</span><a href="#local-6989586621682960392"><span class="hs-identifier hs-var">d</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(BlockId -&gt; BlockRef) -&gt; [BlockId] -&gt; [BlockRef]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><span class="hs-identifier hs-var">map</span></span><span> </span><span class="annot"><span class="annottext">BlockId -&gt; BlockRef
</span><a href="#local-6989586621682960393"><span class="hs-identifier hs-var">mk_block_ref</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">BlockIds -&gt; [BlockId]
</span><a href="../../containers-0.7-5a8f/src/Data.IntSet.Internal.html#toList"><span class="hs-identifier hs-var">IS.toList</span></a></span><span> </span><span class="annot"><span class="annottext">(BlockIds -&gt; [BlockId]) -&gt; BlockIds -&gt; [BlockId]
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">BlockInfo -&gt; BlockIds
</span><a href="GHC.StgToJS.Object.html#bi_must_link"><span class="hs-identifier hs-var">bi_must_link</span></a></span><span> </span><span class="annot"><span class="annottext">BlockInfo
</span><a href="#local-6989586621682960392"><span class="hs-identifier hs-var">d</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1123"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-1124"></span><span>    </span><span id="local-6989586621682960393"><span class="annot"><span class="annottext">mk_block_ref :: BlockId -&gt; BlockRef
</span><a href="#local-6989586621682960393"><span class="hs-identifier hs-var hs-var">mk_block_ref</span></a></span></span><span> </span><span id="local-6989586621682960396"><span class="annot"><span class="annottext">BlockId
</span><a href="#local-6989586621682960396"><span class="hs-identifier hs-var">i</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="GHC.StgToJS.Object.html#BlockRef"><span class="hs-identifier hs-type">BlockRef</span></a></span><span>
</span><span id="line-1125"></span><span>                      </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">block_ref_mod :: Module
</span><a href="GHC.StgToJS.Object.html#block_ref_mod"><span class="hs-identifier hs-var">block_ref_mod</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">BlockInfo -&gt; Module
</span><a href="GHC.StgToJS.Object.html#bi_module"><span class="hs-identifier hs-var">bi_module</span></a></span><span> </span><span class="annot"><span class="annottext">BlockInfo
</span><a href="#local-6989586621682960392"><span class="hs-identifier hs-var">d</span></a></span><span>
</span><span id="line-1126"></span><span>                      </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">block_ref_idx :: BlockId
</span><a href="GHC.StgToJS.Object.html#block_ref_idx"><span class="hs-identifier hs-var">block_ref_idx</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">BlockId
</span><a href="#local-6989586621682960396"><span class="hs-identifier hs-var">i</span></a></span><span>
</span><span id="line-1127"></span><span>                      </span><span class="hs-special">}</span><span>
</span><span id="line-1128"></span><span>
</span><span id="line-1129"></span><span class="hs-comment">-- | read block info from an object that might have already been into memory</span><span>
</span><span id="line-1130"></span><span class="hs-comment">-- pulls in all Deps from an archive</span><span>
</span><span id="line-1131"></span><span class="annot"><a href="GHC.StgToJS.Linker.Linker.html#readBlockInfoFromObj"><span class="hs-identifier hs-type">readBlockInfoFromObj</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">FilePath</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Maybe</span></span><span> </span><span class="annot"><a href="GHC.StgToJS.Object.html#LocatedBlockInfo"><span class="hs-identifier hs-type">LocatedBlockInfo</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1132"></span><span id="readBlockInfoFromObj"><span class="annot"><span class="annottext">readBlockInfoFromObj :: FilePath -&gt; IO (Maybe LocatedBlockInfo)
</span><a href="GHC.StgToJS.Linker.Linker.html#readBlockInfoFromObj"><span class="hs-identifier hs-var hs-var">readBlockInfoFromObj</span></a></span></span><span> </span><span id="local-6989586621682960397"><span class="annot"><span class="annottext">FilePath
</span><a href="#local-6989586621682960397"><span class="hs-identifier hs-var">file</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-1133"></span><span>  </span><span class="annot"><span class="annottext">FilePath -&gt; IO (Maybe BlockInfo)
</span><a href="GHC.StgToJS.Object.html#readObjectBlockInfo"><span class="hs-identifier hs-var">readObjectBlockInfo</span></a></span><span> </span><span class="annot"><span class="annottext">FilePath
</span><a href="#local-6989586621682960397"><span class="hs-identifier hs-var">file</span></a></span><span> </span><span class="annot"><span class="annottext">IO (Maybe BlockInfo)
-&gt; (Maybe BlockInfo -&gt; IO (Maybe LocatedBlockInfo))
-&gt; IO (Maybe LocatedBlockInfo)
forall a b. IO a -&gt; (a -&gt; IO b) -&gt; IO b
forall (m :: * -&gt; *) a b. Monad m =&gt; m a -&gt; (a -&gt; m b) -&gt; m b
</span><span class="hs-operator hs-var">&gt;&gt;=</span></span><span> </span><span class="hs-glyph">\</span><span class="hs-glyph">case</span><span>
</span><span id="line-1134"></span><span>    </span><span class="annot"><span class="annottext">Maybe BlockInfo
</span><span class="hs-identifier hs-var">Nothing</span></span><span>   </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Maybe LocatedBlockInfo -&gt; IO (Maybe LocatedBlockInfo)
forall a. a -&gt; IO a
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">pure</span></span><span> </span><span class="annot"><span class="annottext">Maybe LocatedBlockInfo
forall a. Maybe a
</span><span class="hs-identifier hs-var">Nothing</span></span><span>
</span><span id="line-1135"></span><span>    </span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span id="local-6989586621682960399"><span class="annot"><span class="annottext">BlockInfo
</span><a href="#local-6989586621682960399"><span class="hs-identifier hs-var">info</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Maybe LocatedBlockInfo -&gt; IO (Maybe LocatedBlockInfo)
forall a. a -&gt; IO a
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">pure</span></span><span> </span><span class="annot"><span class="annottext">(Maybe LocatedBlockInfo -&gt; IO (Maybe LocatedBlockInfo))
-&gt; Maybe LocatedBlockInfo -&gt; IO (Maybe LocatedBlockInfo)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">LocatedBlockInfo -&gt; Maybe LocatedBlockInfo
forall a. a -&gt; Maybe a
</span><span class="hs-identifier hs-var">Just</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">BlockLocation -&gt; BlockInfo -&gt; LocatedBlockInfo
</span><a href="GHC.StgToJS.Object.html#LocatedBlockInfo"><span class="hs-identifier hs-var">LocatedBlockInfo</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">FilePath -&gt; BlockLocation
</span><a href="GHC.StgToJS.Object.html#ObjectFile"><span class="hs-identifier hs-var">ObjectFile</span></a></span><span> </span><span class="annot"><span class="annottext">FilePath
</span><a href="#local-6989586621682960397"><span class="hs-identifier hs-var">file</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">BlockInfo
</span><a href="#local-6989586621682960399"><span class="hs-identifier hs-var">info</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1136"></span><span>
</span><span id="line-1137"></span><span>
</span><span id="line-1138"></span><span class="hs-comment">-- | Embed a JS file into a JS object .o file</span><span>
</span><span id="line-1139"></span><span class="hs-comment">--</span><span>
</span><span id="line-1140"></span><span class="hs-comment">-- JS files may contain option pragmas of the form: //#OPTIONS:</span><span>
</span><span id="line-1141"></span><span class="hs-comment">-- One of those is //#OPTIONS:CPP. When it is set, we append some common CPP</span><span>
</span><span id="line-1142"></span><span class="hs-comment">-- definitions to the file and call cpp on it.</span><span>
</span><span id="line-1143"></span><span class="hs-comment">--</span><span>
</span><span id="line-1144"></span><span class="hs-comment">-- Other options (e.g. EMCC additional flags for link time) are stored in the</span><span>
</span><span id="line-1145"></span><span class="hs-comment">-- JS object header. See JSOptions.</span><span>
</span><span id="line-1146"></span><span class="annot"><a href="GHC.StgToJS.Linker.Linker.html#embedJsFile"><span class="hs-identifier hs-type">embedJsFile</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Utils.Logger.html#Logger"><span class="hs-identifier hs-type">Logger</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Driver.DynFlags.html#DynFlags"><span class="hs-identifier hs-type">DynFlags</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Utils.TmpFs.html#TmpFs"><span class="hs-identifier hs-type">TmpFs</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Unit.Env.html#UnitEnv"><span class="hs-identifier hs-type">UnitEnv</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">FilePath</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">FilePath</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-1147"></span><span id="embedJsFile"><span class="annot"><span class="annottext">embedJsFile :: Logger
-&gt; DynFlags -&gt; TmpFs -&gt; UnitEnv -&gt; FilePath -&gt; FilePath -&gt; IO ()
</span><a href="GHC.StgToJS.Linker.Linker.html#embedJsFile"><span class="hs-identifier hs-var hs-var">embedJsFile</span></a></span></span><span> </span><span id="local-6989586621682960400"><span class="annot"><span class="annottext">Logger
</span><a href="#local-6989586621682960400"><span class="hs-identifier hs-var">logger</span></a></span></span><span> </span><span id="local-6989586621682960401"><span class="annot"><span class="annottext">DynFlags
</span><a href="#local-6989586621682960401"><span class="hs-identifier hs-var">dflags</span></a></span></span><span> </span><span id="local-6989586621682960402"><span class="annot"><span class="annottext">TmpFs
</span><a href="#local-6989586621682960402"><span class="hs-identifier hs-var">tmpfs</span></a></span></span><span> </span><span id="local-6989586621682960403"><span class="annot"><span class="annottext">UnitEnv
</span><a href="#local-6989586621682960403"><span class="hs-identifier hs-var">unit_env</span></a></span></span><span> </span><span id="local-6989586621682960404"><span class="annot"><span class="annottext">FilePath
</span><a href="#local-6989586621682960404"><span class="hs-identifier hs-var">input_fn</span></a></span></span><span> </span><span id="local-6989586621682960405"><span class="annot"><span class="annottext">FilePath
</span><a href="#local-6989586621682960405"><span class="hs-identifier hs-var">output_fn</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-1148"></span><span>  </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621682960406"><span class="annot"><span class="annottext">profiling :: Bool
</span><a href="#local-6989586621682960406"><span class="hs-identifier hs-var hs-var hs-var">profiling</span></a></span></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">False</span></span><span> </span><span class="hs-comment">-- FIXME: add support for profiling way</span><span>
</span><span id="line-1149"></span><span>
</span><span id="line-1150"></span><span>  </span><span class="annot"><span class="annottext">Bool -&gt; FilePath -&gt; IO ()
</span><a href="../../directory-1.3.9.0-af18/src/System.Directory.html#createDirectoryIfMissing"><span class="hs-identifier hs-var">createDirectoryIfMissing</span></a></span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">True</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">FilePath -&gt; FilePath
</span><a href="../../filepath-1.5.4.0-e69b/src/System.FilePath.Posix.html#takeDirectory"><span class="hs-identifier hs-var">takeDirectory</span></a></span><span> </span><span class="annot"><span class="annottext">FilePath
</span><a href="#local-6989586621682960405"><span class="hs-identifier hs-var">output_fn</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1151"></span><span>
</span><span id="line-1152"></span><span>  </span><span class="hs-comment">-- the header lets the linker recognize processed JavaScript files</span><span>
</span><span id="line-1153"></span><span>  </span><span class="hs-comment">-- But don't add JavaScript header to object files!</span><span>
</span><span id="line-1154"></span><span>
</span><span id="line-1155"></span><span>  </span><span class="hs-comment">-- read pragmas from JS file</span><span>
</span><span id="line-1156"></span><span>  </span><span class="hs-comment">-- we need to store them explicitly as they can be removed by CPP.</span><span>
</span><span id="line-1157"></span><span>  </span><span id="local-6989586621682960407"><span class="annot"><a href="#local-6989586621682960407"><span class="hs-identifier hs-var">opts</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">FilePath -&gt; IO JSOptions
</span><a href="GHC.StgToJS.Object.html#getOptionsFromJsFile"><span class="hs-identifier hs-var">getOptionsFromJsFile</span></a></span><span> </span><span class="annot"><span class="annottext">FilePath
</span><a href="#local-6989586621682960404"><span class="hs-identifier hs-var">input_fn</span></a></span><span>
</span><span id="line-1158"></span><span>
</span><span id="line-1159"></span><span>  </span><span class="hs-comment">-- run CPP if needed</span><span>
</span><span id="line-1160"></span><span>  </span><span id="local-6989586621682960409"><span class="annot"><a href="#local-6989586621682960409"><span class="hs-identifier hs-var">cpp_fn</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><a href="GHC.StgToJS.Object.html#enableCPP"><span class="hs-identifier hs-var">enableCPP</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682960407"><span class="hs-identifier hs-type">opts</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-1161"></span><span>    </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">False</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">FilePath -&gt; IO FilePath
forall a. a -&gt; IO a
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">pure</span></span><span> </span><span class="annot"><span class="annottext">FilePath
</span><a href="#local-6989586621682960404"><span class="hs-identifier hs-var">input_fn</span></a></span><span>
</span><span id="line-1162"></span><span>    </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">True</span></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-1163"></span><span>      </span><span class="hs-comment">-- append common CPP definitions to the .js file.</span><span>
</span><span id="line-1164"></span><span>      </span><span class="hs-comment">-- They define macros that avoid directly wiring zencoded names</span><span>
</span><span id="line-1165"></span><span>      </span><span class="hs-comment">-- in RTS JS files</span><span>
</span><span id="line-1166"></span><span>      </span><span id="local-6989586621682960411"><span class="annot"><a href="#local-6989586621682960411"><span class="hs-identifier hs-var">pp_fn</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Logger
-&gt; TmpFs -&gt; TempDir -&gt; TempFileLifetime -&gt; FilePath -&gt; IO FilePath
</span><a href="GHC.Utils.TmpFs.html#newTempName"><span class="hs-identifier hs-var">newTempName</span></a></span><span> </span><span class="annot"><span class="annottext">Logger
</span><a href="#local-6989586621682960400"><span class="hs-identifier hs-var">logger</span></a></span><span> </span><span class="annot"><span class="annottext">TmpFs
</span><a href="#local-6989586621682960402"><span class="hs-identifier hs-var">tmpfs</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">DynFlags -&gt; TempDir
</span><a href="GHC.Driver.DynFlags.html#tmpDir"><span class="hs-identifier hs-var">tmpDir</span></a></span><span> </span><span class="annot"><span class="annottext">DynFlags
</span><a href="#local-6989586621682960401"><span class="hs-identifier hs-var">dflags</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">TempFileLifetime
</span><a href="GHC.Utils.TmpFs.html#TFL_CurrentModule"><span class="hs-identifier hs-var">TFL_CurrentModule</span></a></span><span> </span><span class="annot"><span class="annottext">FilePath
</span><span class="hs-string">&quot;js&quot;</span></span><span>
</span><span id="line-1167"></span><span>      </span><span id="local-6989586621682960413"><span class="annot"><a href="#local-6989586621682960413"><span class="hs-identifier hs-var">payload</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><a href="../../bytestring-0.12.2.0-7dd0/src/Data.ByteString.html#readFile"><span class="hs-identifier hs-type">B.readFile</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682960404"><span class="hs-identifier hs-type">input_fn</span></a></span><span>
</span><span id="line-1168"></span><span>      </span><span class="annot"><a href="../../bytestring-0.12.2.0-7dd0/src/Data.ByteString.html#writeFile"><span class="hs-identifier hs-type">B.writeFile</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682960411"><span class="hs-identifier hs-type">pp_fn</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.StgToJS.Linker.Utils.html#commonCppDefs"><span class="hs-identifier hs-type">commonCppDefs</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682960406"><span class="hs-identifier hs-type">profiling</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">&lt;&gt;</span></span><span> </span><span class="annot"><a href="#local-6989586621682960413"><span class="hs-identifier hs-type">payload</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1169"></span><span>
</span><span id="line-1170"></span><span>      </span><span class="hs-comment">-- run CPP on the input JS file</span><span>
</span><span id="line-1171"></span><span>      </span><span id="local-6989586621682960415"><span class="annot"><a href="#local-6989586621682960415"><span class="hs-identifier hs-var">js_fn</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><a href="GHC.Utils.TmpFs.html#newTempName"><span class="hs-identifier hs-type">newTempName</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682960400"><span class="hs-identifier hs-type">logger</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682960402"><span class="hs-identifier hs-type">tmpfs</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Driver.DynFlags.html#tmpDir"><span class="hs-identifier hs-var">tmpDir</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682960401"><span class="hs-identifier hs-type">dflags</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><a href="GHC.Utils.TmpFs.html#TFL_CurrentModule"><span class="hs-identifier hs-type">TFL_CurrentModule</span></a></span><span> </span><span class="annot"><span class="hs-string">&quot;js&quot;</span></span><span>
</span><span id="line-1172"></span><span>      </span><span class="hs-keyword">let</span><span>
</span><span id="line-1173"></span><span>        </span><span id="local-6989586621682960416"><span class="annot"><a href="#local-6989586621682960416"><span class="hs-identifier hs-var hs-var">cpp_opts</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="GHC.SysTools.Cpp.html#CppOpts"><span class="hs-identifier hs-type">CppOpts</span></a></span><span>
</span><span id="line-1174"></span><span>          </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">sourceCodePreprocessor :: SourceCodePreprocessor
</span><a href="GHC.SysTools.Cpp.html#sourceCodePreprocessor"><span class="hs-identifier hs-var">sourceCodePreprocessor</span></a></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">SourceCodePreprocessor
</span><a href="GHC.SysTools.Tasks.html#SCPJsCpp"><span class="hs-identifier hs-var">SCPJsCpp</span></a></span><span>
</span><span id="line-1175"></span><span>          </span><span class="hs-comment">-- JS code requires keeping JSDoc comments for third party minification tooling</span><span>
</span><span id="line-1176"></span><span>          </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">cppLinePragmas :: Bool
</span><a href="GHC.SysTools.Cpp.html#cppLinePragmas"><span class="hs-identifier hs-var">cppLinePragmas</span></a></span><span>          </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">False</span></span><span> </span><span class="hs-comment">-- LINE pragmas aren't JS compatible</span><span>
</span><span id="line-1177"></span><span>          </span><span class="hs-special">}</span><span>
</span><span id="line-1178"></span><span>      </span><span class="annot"><a href="GHC.SysTools.Cpp.html#doCpp"><span class="hs-identifier hs-type">doCpp</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682960400"><span class="hs-identifier hs-type">logger</span></a></span><span>
</span><span id="line-1179"></span><span>              </span><span class="annot"><a href="#local-6989586621682960402"><span class="hs-identifier hs-type">tmpfs</span></a></span><span>
</span><span id="line-1180"></span><span>              </span><span class="annot"><a href="#local-6989586621682960401"><span class="hs-identifier hs-type">dflags</span></a></span><span>
</span><span id="line-1181"></span><span>              </span><span class="annot"><a href="#local-6989586621682960403"><span class="hs-identifier hs-type">unit_env</span></a></span><span>
</span><span id="line-1182"></span><span>              </span><span class="annot"><a href="#local-6989586621682960416"><span class="hs-identifier hs-type">cpp_opts</span></a></span><span>
</span><span id="line-1183"></span><span>              </span><span class="annot"><a href="#local-6989586621682960411"><span class="hs-identifier hs-type">pp_fn</span></a></span><span>
</span><span id="line-1184"></span><span>              </span><span class="annot"><a href="#local-6989586621682960415"><span class="hs-identifier hs-type">js_fn</span></a></span><span>
</span><span id="line-1185"></span><span>      </span><span class="annot"><span class="hs-identifier hs-type">pure</span></span><span> </span><span class="annot"><a href="#local-6989586621682960415"><span class="hs-identifier hs-type">js_fn</span></a></span><span>
</span><span id="line-1186"></span><span>
</span><span id="line-1187"></span><span>  </span><span class="hs-comment">-- write JS object</span><span>
</span><span id="line-1188"></span><span>  </span><span id="local-6989586621682960422"><span class="annot"><a href="#local-6989586621682960422"><span class="hs-identifier hs-var">cpp_bs</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><a href="../../bytestring-0.12.2.0-7dd0/src/Data.ByteString.html#readFile"><span class="hs-identifier hs-type">B.readFile</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682960409"><span class="hs-identifier hs-type">cpp_fn</span></a></span><span>
</span><span id="line-1189"></span><span>  </span><span class="annot"><a href="GHC.StgToJS.Object.html#writeJSObject"><span class="hs-identifier hs-type">writeJSObject</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682960407"><span class="hs-identifier hs-type">opts</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682960422"><span class="hs-identifier hs-type">cpp_bs</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682960405"><span class="hs-identifier hs-type">output_fn</span></a></span><span>
</span><span id="line-1190"></span><span>
</span><span id="line-1191"></span><span class="hs-comment">-- | Link module codes.</span><span>
</span><span id="line-1192"></span><span class="hs-comment">--</span><span>
</span><span id="line-1193"></span><span class="hs-comment">-- Performs link time optimizations and produces one JStat per module plus some</span><span>
</span><span id="line-1194"></span><span class="hs-comment">-- commoned up initialization code.</span><span>
</span><span id="line-1195"></span><span class="annot"><a href="GHC.StgToJS.Linker.Linker.html#linkModules"><span class="hs-identifier hs-type">linkModules</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="GHC.StgToJS.Linker.Linker.html#ModuleCode"><span class="hs-identifier hs-type">ModuleCode</span></a></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="hs-special">[</span><span class="annot"><a href="GHC.StgToJS.Linker.Linker.html#CompactedModuleCode"><span class="hs-identifier hs-type">CompactedModuleCode</span></a></span><span class="hs-special">]</span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.JS.Syntax.html#JStat"><span class="hs-identifier hs-type">JS.JStat</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1196"></span><span id="linkModules"><span class="annot"><span class="annottext">linkModules :: [ModuleCode] -&gt; ([CompactedModuleCode], JStat)
</span><a href="GHC.StgToJS.Linker.Linker.html#linkModules"><span class="hs-identifier hs-var hs-var">linkModules</span></a></span></span><span> </span><span id="local-6989586621682960424"><span class="annot"><span class="annottext">[ModuleCode]
</span><a href="#local-6989586621682960424"><span class="hs-identifier hs-var">mods</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[CompactedModuleCode]
</span><a href="#local-6989586621682960425"><span class="hs-identifier hs-var">compact_mods</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">JStat
</span><a href="#local-6989586621682960426"><span class="hs-identifier hs-var">meta</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1197"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-1198"></span><span>    </span><span id="local-6989586621682960425"><span class="annot"><span class="annottext">compact_mods :: [CompactedModuleCode]
</span><a href="#local-6989586621682960425"><span class="hs-identifier hs-var hs-var">compact_mods</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(ModuleCode -&gt; CompactedModuleCode)
-&gt; [ModuleCode] -&gt; [CompactedModuleCode]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><span class="hs-identifier hs-var">map</span></span><span> </span><span class="annot"><span class="annottext">ModuleCode -&gt; CompactedModuleCode
</span><a href="#local-6989586621682960427"><span class="hs-identifier hs-var">compact</span></a></span><span> </span><span class="annot"><span class="annottext">[ModuleCode]
</span><a href="#local-6989586621682960424"><span class="hs-identifier hs-var">mods</span></a></span><span>
</span><span id="line-1199"></span><span>
</span><span id="line-1200"></span><span>    </span><span class="hs-comment">-- here GHCJS used to:</span><span>
</span><span id="line-1201"></span><span>    </span><span class="hs-comment">--  - deduplicate declarations</span><span>
</span><span id="line-1202"></span><span>    </span><span class="hs-comment">--  - rename local variables into shorter ones</span><span>
</span><span id="line-1203"></span><span>    </span><span class="hs-comment">--  - compress initialization data</span><span>
</span><span id="line-1204"></span><span>    </span><span class="hs-comment">-- but we haven't ported it (yet).</span><span>
</span><span id="line-1205"></span><span>    </span><span id="local-6989586621682960427"><span class="annot"><span class="annottext">compact :: ModuleCode -&gt; CompactedModuleCode
</span><a href="#local-6989586621682960427"><span class="hs-identifier hs-var hs-var">compact</span></a></span></span><span> </span><span id="local-6989586621682960428"><span class="annot"><span class="annottext">ModuleCode
</span><a href="#local-6989586621682960428"><span class="hs-identifier hs-var">m</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="GHC.StgToJS.Linker.Linker.html#CompactedModuleCode"><span class="hs-identifier hs-type">CompactedModuleCode</span></a></span><span>
</span><span id="line-1206"></span><span>      </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">cmc_js_code :: JStat
</span><a href="GHC.StgToJS.Linker.Linker.html#cmc_js_code"><span class="hs-identifier hs-var">cmc_js_code</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ModuleCode -&gt; JStat
</span><a href="GHC.StgToJS.Linker.Linker.html#mc_js_code"><span class="hs-identifier hs-var">mc_js_code</span></a></span><span> </span><span class="annot"><span class="annottext">ModuleCode
</span><a href="#local-6989586621682960428"><span class="hs-identifier hs-var">m</span></a></span><span>
</span><span id="line-1207"></span><span>      </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">cmc_module :: Module
</span><a href="GHC.StgToJS.Linker.Linker.html#cmc_module"><span class="hs-identifier hs-var">cmc_module</span></a></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ModuleCode -&gt; Module
</span><a href="GHC.StgToJS.Linker.Linker.html#mc_module"><span class="hs-identifier hs-var">mc_module</span></a></span><span> </span><span class="annot"><span class="annottext">ModuleCode
</span><a href="#local-6989586621682960428"><span class="hs-identifier hs-var">m</span></a></span><span>
</span><span id="line-1208"></span><span>      </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">cmc_exports :: ByteString
</span><a href="GHC.StgToJS.Linker.Linker.html#cmc_exports"><span class="hs-identifier hs-var">cmc_exports</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ModuleCode -&gt; ByteString
</span><a href="GHC.StgToJS.Linker.Linker.html#mc_exports"><span class="hs-identifier hs-var">mc_exports</span></a></span><span> </span><span class="annot"><span class="annottext">ModuleCode
</span><a href="#local-6989586621682960428"><span class="hs-identifier hs-var">m</span></a></span><span>
</span><span id="line-1209"></span><span>      </span><span class="hs-special">}</span><span>
</span><span id="line-1210"></span><span>
</span><span id="line-1211"></span><span>    </span><span class="hs-comment">-- common up statics: different bindings may reference the same statics, we</span><span>
</span><span id="line-1212"></span><span>    </span><span class="hs-comment">-- filter them here to initialize them once</span><span>
</span><span id="line-1213"></span><span>    </span><span id="local-6989586621682960429"><span class="annot"><span class="annottext">statics :: [StaticInfo]
</span><a href="#local-6989586621682960429"><span class="hs-identifier hs-var hs-var">statics</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[StaticInfo] -&gt; [StaticInfo]
</span><a href="GHC.StgToJS.Linker.Linker.html#nubStaticInfo"><span class="hs-identifier hs-var">nubStaticInfo</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(ModuleCode -&gt; [StaticInfo]) -&gt; [ModuleCode] -&gt; [StaticInfo]
forall (t :: * -&gt; *) a b. Foldable t =&gt; (a -&gt; [b]) -&gt; t a -&gt; [b]
</span><span class="hs-identifier hs-var">concatMap</span></span><span> </span><span class="annot"><span class="annottext">ModuleCode -&gt; [StaticInfo]
</span><a href="GHC.StgToJS.Linker.Linker.html#mc_statics"><span class="hs-identifier hs-var">mc_statics</span></a></span><span> </span><span class="annot"><span class="annottext">[ModuleCode]
</span><a href="#local-6989586621682960424"><span class="hs-identifier hs-var">mods</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1214"></span><span>
</span><span id="line-1215"></span><span>    </span><span id="local-6989586621682960431"><span class="annot"><span class="annottext">infos :: [ClosureInfo]
</span><a href="#local-6989586621682960431"><span class="hs-identifier hs-var hs-var">infos</span></a></span></span><span>   </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(ModuleCode -&gt; [ClosureInfo]) -&gt; [ModuleCode] -&gt; [ClosureInfo]
forall (t :: * -&gt; *) a b. Foldable t =&gt; (a -&gt; [b]) -&gt; t a -&gt; [b]
</span><span class="hs-identifier hs-var">concatMap</span></span><span> </span><span class="annot"><span class="annottext">ModuleCode -&gt; [ClosureInfo]
</span><a href="GHC.StgToJS.Linker.Linker.html#mc_closures"><span class="hs-identifier hs-var">mc_closures</span></a></span><span> </span><span class="annot"><span class="annottext">[ModuleCode]
</span><a href="#local-6989586621682960424"><span class="hs-identifier hs-var">mods</span></a></span><span>
</span><span id="line-1216"></span><span>    </span><span id="local-6989586621682960432"><span class="annot"><span class="annottext">debug :: Bool
</span><a href="#local-6989586621682960432"><span class="hs-identifier hs-var hs-var">debug</span></a></span></span><span>   </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">False</span></span><span> </span><span class="hs-comment">-- TODO: this could be enabled in a debug build.</span><span>
</span><span id="line-1217"></span><span>                    </span><span class="hs-comment">-- It adds debug info to heap objects</span><span>
</span><span id="line-1218"></span><span>    </span><span id="local-6989586621682960426"><span class="annot"><span class="annottext">meta :: JStat
</span><a href="#local-6989586621682960426"><span class="hs-identifier hs-var hs-var">meta</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[JStat] -&gt; JStat
forall a. Monoid a =&gt; [a] -&gt; a
</span><span class="hs-identifier hs-var">mconcat</span></span><span>
</span><span id="line-1219"></span><span>            </span><span class="hs-comment">-- render metadata as individual statements</span><span>
</span><span id="line-1220"></span><span>            </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">[JStat] -&gt; JStat
forall a. Monoid a =&gt; [a] -&gt; a
</span><span class="hs-identifier hs-var">mconcat</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(StaticInfo -&gt; JStat) -&gt; [StaticInfo] -&gt; [JStat]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><span class="hs-identifier hs-var">map</span></span><span> </span><span class="annot"><span class="annottext">StaticInfo -&gt; JStat
</span><a href="GHC.StgToJS.Linker.Linker.html#staticDeclStat"><span class="hs-identifier hs-var">staticDeclStat</span></a></span><span> </span><span class="annot"><span class="annottext">[StaticInfo]
</span><a href="#local-6989586621682960429"><span class="hs-identifier hs-var">statics</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1221"></span><span>            </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">[JStat] -&gt; JStat
forall a. Monoid a =&gt; [a] -&gt; a
</span><span class="hs-identifier hs-var">mconcat</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(StaticInfo -&gt; JStat) -&gt; [StaticInfo] -&gt; [JStat]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><span class="hs-identifier hs-var">map</span></span><span> </span><span class="annot"><span class="annottext">StaticInfo -&gt; JStat
</span><a href="GHC.StgToJS.Linker.Linker.html#staticInitStat"><span class="hs-identifier hs-var">staticInitStat</span></a></span><span> </span><span class="annot"><span class="annottext">[StaticInfo]
</span><a href="#local-6989586621682960429"><span class="hs-identifier hs-var">statics</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1222"></span><span>            </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">JStgStat -&gt; JStat
</span><a href="GHC.JS.Transform.html#jStgStatToJS"><span class="hs-identifier hs-var">jStgStatToJS</span></a></span><span> </span><span class="annot"><span class="annottext">(JStgStat -&gt; JStat) -&gt; JStgStat -&gt; JStat
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">[JStgStat] -&gt; JStgStat
forall a. Monoid a =&gt; [a] -&gt; a
</span><span class="hs-identifier hs-var">mconcat</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(ClosureInfo -&gt; JStgStat) -&gt; [ClosureInfo] -&gt; [JStgStat]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><span class="hs-identifier hs-var">map</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Bool -&gt; ClosureInfo -&gt; JStgStat
</span><a href="GHC.StgToJS.Closure.html#closureInfoStat"><span class="hs-identifier hs-var">closureInfoStat</span></a></span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621682960432"><span class="hs-identifier hs-var">debug</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[ClosureInfo]
</span><a href="#local-6989586621682960431"><span class="hs-identifier hs-var">infos</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1223"></span><span>            </span><span class="hs-special">]</span><span>
</span><span id="line-1224"></span><span>
</span><span id="line-1225"></span><span class="annot"><span class="hs-comment">-- | Only keep a single StaticInfo with a given name</span></span><span>
</span><span id="line-1226"></span><span class="annot"><a href="GHC.StgToJS.Linker.Linker.html#nubStaticInfo"><span class="hs-identifier hs-type">nubStaticInfo</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="GHC.StgToJS.Types.html#StaticInfo"><span class="hs-identifier hs-type">StaticInfo</span></a></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="GHC.StgToJS.Types.html#StaticInfo"><span class="hs-identifier hs-type">StaticInfo</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-1227"></span><span id="nubStaticInfo"><span class="annot"><span class="annottext">nubStaticInfo :: [StaticInfo] -&gt; [StaticInfo]
</span><a href="GHC.StgToJS.Linker.Linker.html#nubStaticInfo"><span class="hs-identifier hs-var hs-var">nubStaticInfo</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">UniqSet FastString -&gt; [StaticInfo] -&gt; [StaticInfo]
</span><a href="#local-6989586621682960434"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="annot"><span class="annottext">UniqSet FastString
forall a. UniqSet a
</span><a href="GHC.Types.Unique.Set.html#emptyUniqSet"><span class="hs-identifier hs-var">emptyUniqSet</span></a></span><span>
</span><span id="line-1228"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-1229"></span><span>    </span><span id="local-6989586621682960434"><span class="annot"><span class="annottext">go :: UniqSet FastString -&gt; [StaticInfo] -&gt; [StaticInfo]
</span><a href="#local-6989586621682960434"><span class="hs-identifier hs-var hs-var">go</span></a></span></span><span> </span><span id="local-6989586621682960439"><span class="annot"><span class="annottext">UniqSet FastString
</span><a href="#local-6989586621682960439"><span class="hs-identifier hs-var">us</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-glyph">\</span><span class="hs-glyph">case</span><span>
</span><span id="line-1230"></span><span>      </span><span class="hs-special">[</span><span class="hs-special">]</span><span>     </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span>
</span><span id="line-1231"></span><span>      </span><span class="hs-special">(</span><span id="local-6989586621682960440"><span class="annot"><span class="annottext">StaticInfo
</span><a href="#local-6989586621682960440"><span class="hs-identifier hs-var">x</span></a></span></span><span class="annot"><span class="hs-glyph hs-type">:</span></span><span id="local-6989586621682960441"><span class="annot"><span class="annottext">[StaticInfo]
</span><a href="#local-6989586621682960441"><span class="hs-identifier hs-var">xs</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-1232"></span><span>        </span><span class="hs-comment">-- only match on siVar. There is no reason for the initializing value to</span><span>
</span><span id="line-1233"></span><span>        </span><span class="hs-comment">-- be different for the same global name.</span><span>
</span><span id="line-1234"></span><span>        </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621682960442"><span class="annot"><span class="annottext">name :: FastString
</span><a href="#local-6989586621682960442"><span class="hs-identifier hs-var hs-var">name</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">StaticInfo -&gt; FastString
</span><a href="GHC.StgToJS.Types.html#siVar"><span class="hs-identifier hs-var">siVar</span></a></span><span> </span><span class="annot"><span class="annottext">StaticInfo
</span><a href="#local-6989586621682960440"><span class="hs-identifier hs-var">x</span></a></span><span>
</span><span id="line-1235"></span><span>        </span><span class="hs-keyword">in</span><span> </span><span class="hs-keyword">if</span><span> </span><span class="annot"><span class="annottext">FastString -&gt; UniqSet FastString -&gt; Bool
forall a. Uniquable a =&gt; a -&gt; UniqSet a -&gt; Bool
</span><a href="GHC.Types.Unique.Set.html#elementOfUniqSet"><span class="hs-identifier hs-var">elementOfUniqSet</span></a></span><span> </span><span class="annot"><span class="annottext">FastString
</span><a href="#local-6989586621682960442"><span class="hs-identifier hs-var">name</span></a></span><span> </span><span class="annot"><span class="annottext">UniqSet FastString
</span><a href="#local-6989586621682960439"><span class="hs-identifier hs-var">us</span></a></span><span>
</span><span id="line-1236"></span><span>          </span><span class="hs-keyword">then</span><span> </span><span class="annot"><span class="annottext">UniqSet FastString -&gt; [StaticInfo] -&gt; [StaticInfo]
</span><a href="#local-6989586621682960434"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="annot"><span class="annottext">UniqSet FastString
</span><a href="#local-6989586621682960439"><span class="hs-identifier hs-var">us</span></a></span><span> </span><span class="annot"><span class="annottext">[StaticInfo]
</span><a href="#local-6989586621682960441"><span class="hs-identifier hs-var">xs</span></a></span><span>
</span><span id="line-1237"></span><span>          </span><span class="hs-keyword">else</span><span> </span><span class="annot"><span class="annottext">StaticInfo
</span><a href="#local-6989586621682960440"><span class="hs-identifier hs-var">x</span></a></span><span> </span><span class="annot"><span class="annottext">StaticInfo -&gt; [StaticInfo] -&gt; [StaticInfo]
forall a. a -&gt; [a] -&gt; [a]
</span><span class="hs-glyph hs-var">:</span></span><span> </span><span class="annot"><span class="annottext">UniqSet FastString -&gt; [StaticInfo] -&gt; [StaticInfo]
</span><a href="#local-6989586621682960434"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">UniqSet FastString -&gt; FastString -&gt; UniqSet FastString
forall a. Uniquable a =&gt; UniqSet a -&gt; a -&gt; UniqSet a
</span><a href="GHC.Types.Unique.Set.html#addOneToUniqSet"><span class="hs-identifier hs-var">addOneToUniqSet</span></a></span><span> </span><span class="annot"><span class="annottext">UniqSet FastString
</span><a href="#local-6989586621682960439"><span class="hs-identifier hs-var">us</span></a></span><span> </span><span class="annot"><span class="annottext">FastString
</span><a href="#local-6989586621682960442"><span class="hs-identifier hs-var">name</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[StaticInfo]
</span><a href="#local-6989586621682960441"><span class="hs-identifier hs-var">xs</span></a></span><span>
</span><span id="line-1238"></span><span>
</span><span id="line-1239"></span><span class="hs-comment">-- | Initialize a global object.</span><span>
</span><span id="line-1240"></span><span class="hs-comment">--</span><span>
</span><span id="line-1241"></span><span class="hs-comment">-- All global objects have to be declared (staticInfoDecl) first.</span><span>
</span><span id="line-1242"></span><span class="annot"><a href="GHC.StgToJS.Linker.Linker.html#staticInitStat"><span class="hs-identifier hs-type">staticInitStat</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.StgToJS.Types.html#StaticInfo"><span class="hs-identifier hs-type">StaticInfo</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.JS.Syntax.html#JStat"><span class="hs-identifier hs-type">JS.JStat</span></a></span><span>
</span><span id="line-1243"></span><span id="staticInitStat"><span class="annot"><span class="annottext">staticInitStat :: StaticInfo -&gt; JStat
</span><a href="GHC.StgToJS.Linker.Linker.html#staticInitStat"><span class="hs-identifier hs-var hs-var">staticInitStat</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.StgToJS.Types.html#StaticInfo"><span class="hs-identifier hs-type">StaticInfo</span></a></span><span> </span><span id="local-6989586621682960447"><span class="annot"><span class="annottext">FastString
</span><a href="#local-6989586621682960447"><span class="hs-identifier hs-var">i</span></a></span></span><span> </span><span id="local-6989586621682960448"><span class="annot"><span class="annottext">StaticVal
</span><a href="#local-6989586621682960448"><span class="hs-identifier hs-var">sv</span></a></span></span><span> </span><span id="local-6989586621682960449"><span class="annot"><span class="annottext">Maybe Ident
</span><a href="#local-6989586621682960449"><span class="hs-identifier hs-var">mcc</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-1244"></span><span>  </span><span class="annot"><span class="annottext">JStgStat -&gt; JStat
</span><a href="GHC.JS.Transform.html#jStgStatToJS"><span class="hs-identifier hs-var">jStgStatToJS</span></a></span><span> </span><span class="annot"><span class="annottext">(JStgStat -&gt; JStat) -&gt; JStgStat -&gt; JStat
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-1245"></span><span>  </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">StaticVal
</span><a href="#local-6989586621682960448"><span class="hs-identifier hs-var">sv</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-1246"></span><span>    </span><span class="annot"><a href="GHC.StgToJS.Types.html#StaticData"><span class="hs-identifier hs-type">StaticData</span></a></span><span> </span><span id="local-6989586621682960451"><span class="annot"><span class="annottext">FastString
</span><a href="#local-6989586621682960451"><span class="hs-identifier hs-var">con</span></a></span></span><span> </span><span id="local-6989586621682960452"><span class="annot"><span class="annottext">[StaticArg]
</span><a href="#local-6989586621682960452"><span class="hs-identifier hs-var">args</span></a></span></span><span>         </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">FastString -&gt; [JStgExpr] -&gt; JStgStat
</span><a href="GHC.JS.Make.html#appS"><span class="hs-identifier hs-var">appS</span></a></span><span> </span><span class="annot"><span class="annottext">FastString
</span><a href="GHC.StgToJS.Symbols.html#hdStiStr"><span class="hs-identifier hs-var">hdStiStr</span></a></span><span> </span><span class="annot"><span class="annottext">([JStgExpr] -&gt; JStgStat) -&gt; [JStgExpr] -&gt; JStgStat
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">[JStgExpr] -&gt; [JStgExpr]
</span><a href="#local-6989586621682960455"><span class="hs-identifier hs-var">add_cc_arg</span></a></span><span>
</span><span id="line-1247"></span><span>                                    </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">FastString -&gt; JStgExpr
</span><a href="GHC.JS.JStg.Syntax.html#global"><span class="hs-identifier hs-var">global</span></a></span><span> </span><span class="annot"><span class="annottext">FastString
</span><a href="#local-6989586621682960447"><span class="hs-identifier hs-var">i</span></a></span><span>
</span><span id="line-1248"></span><span>                                    </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">FastString -&gt; JStgExpr
</span><a href="GHC.JS.JStg.Syntax.html#global"><span class="hs-identifier hs-var">global</span></a></span><span> </span><span class="annot"><span class="annottext">FastString
</span><a href="#local-6989586621682960451"><span class="hs-identifier hs-var">con</span></a></span><span>
</span><span id="line-1249"></span><span>                                    </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">[StaticArg] -&gt; JStgExpr
</span><a href="GHC.StgToJS.Arg.html#jsStaticArgs"><span class="hs-identifier hs-var">jsStaticArgs</span></a></span><span> </span><span class="annot"><span class="annottext">[StaticArg]
</span><a href="#local-6989586621682960452"><span class="hs-identifier hs-var">args</span></a></span><span>
</span><span id="line-1250"></span><span>                                    </span><span class="hs-special">]</span><span>
</span><span id="line-1251"></span><span>    </span><span class="annot"><a href="GHC.StgToJS.Types.html#StaticFun"><span class="hs-identifier hs-type">StaticFun</span></a></span><span>  </span><span id="local-6989586621682960459"><span class="annot"><span class="annottext">FastString
</span><a href="#local-6989586621682960459"><span class="hs-identifier hs-var">f</span></a></span></span><span>   </span><span id="local-6989586621682960460"><span class="annot"><span class="annottext">[StaticArg]
</span><a href="#local-6989586621682960460"><span class="hs-identifier hs-var">args</span></a></span></span><span>         </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">FastString -&gt; [JStgExpr] -&gt; JStgStat
</span><a href="GHC.JS.Make.html#appS"><span class="hs-identifier hs-var">appS</span></a></span><span> </span><span class="annot"><span class="annottext">FastString
</span><a href="GHC.StgToJS.Symbols.html#hdStiStr"><span class="hs-identifier hs-var">hdStiStr</span></a></span><span> </span><span class="annot"><span class="annottext">([JStgExpr] -&gt; JStgStat) -&gt; [JStgExpr] -&gt; JStgStat
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">[JStgExpr] -&gt; [JStgExpr]
</span><a href="#local-6989586621682960455"><span class="hs-identifier hs-var">add_cc_arg</span></a></span><span>
</span><span id="line-1252"></span><span>                                    </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">FastString -&gt; JStgExpr
</span><a href="GHC.JS.JStg.Syntax.html#global"><span class="hs-identifier hs-var">global</span></a></span><span> </span><span class="annot"><span class="annottext">FastString
</span><a href="#local-6989586621682960447"><span class="hs-identifier hs-var">i</span></a></span><span>
</span><span id="line-1253"></span><span>                                    </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">FastString -&gt; JStgExpr
</span><a href="GHC.JS.JStg.Syntax.html#global"><span class="hs-identifier hs-var">global</span></a></span><span> </span><span class="annot"><span class="annottext">FastString
</span><a href="#local-6989586621682960459"><span class="hs-identifier hs-var">f</span></a></span><span>
</span><span id="line-1254"></span><span>                                    </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">[StaticArg] -&gt; JStgExpr
</span><a href="GHC.StgToJS.Arg.html#jsStaticArgs"><span class="hs-identifier hs-var">jsStaticArgs</span></a></span><span> </span><span class="annot"><span class="annottext">[StaticArg]
</span><a href="#local-6989586621682960460"><span class="hs-identifier hs-var">args</span></a></span><span>
</span><span id="line-1255"></span><span>                                    </span><span class="hs-special">]</span><span>
</span><span id="line-1256"></span><span>    </span><span class="annot"><a href="GHC.StgToJS.Types.html#StaticList"><span class="hs-identifier hs-type">StaticList</span></a></span><span> </span><span id="local-6989586621682960462"><span class="annot"><span class="annottext">[StaticArg]
</span><a href="#local-6989586621682960462"><span class="hs-identifier hs-var">args</span></a></span></span><span> </span><span id="local-6989586621682960463"><span class="annot"><span class="annottext">Maybe FastString
</span><a href="#local-6989586621682960463"><span class="hs-identifier hs-var">mt</span></a></span></span><span>          </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">FastString -&gt; [JStgExpr] -&gt; JStgStat
</span><a href="GHC.JS.Make.html#appS"><span class="hs-identifier hs-var">appS</span></a></span><span> </span><span class="annot"><span class="annottext">FastString
</span><a href="GHC.StgToJS.Symbols.html#hdStlStr"><span class="hs-identifier hs-var">hdStlStr</span></a></span><span> </span><span class="annot"><span class="annottext">([JStgExpr] -&gt; JStgStat) -&gt; [JStgExpr] -&gt; JStgStat
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">[JStgExpr] -&gt; [JStgExpr]
</span><a href="#local-6989586621682960455"><span class="hs-identifier hs-var">add_cc_arg</span></a></span><span>
</span><span id="line-1257"></span><span>                                    </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">FastString -&gt; JStgExpr
</span><a href="GHC.JS.JStg.Syntax.html#global"><span class="hs-identifier hs-var">global</span></a></span><span> </span><span class="annot"><span class="annottext">FastString
</span><a href="#local-6989586621682960447"><span class="hs-identifier hs-var">i</span></a></span><span>
</span><span id="line-1258"></span><span>                                    </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">[StaticArg] -&gt; JStgExpr
</span><a href="GHC.StgToJS.Arg.html#jsStaticArgs"><span class="hs-identifier hs-var">jsStaticArgs</span></a></span><span> </span><span class="annot"><span class="annottext">[StaticArg]
</span><a href="#local-6989586621682960462"><span class="hs-identifier hs-var">args</span></a></span><span>
</span><span id="line-1259"></span><span>                                    </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">JStgExpr -&gt; JStgExpr
forall a. ToJExpr a =&gt; a -&gt; JStgExpr
</span><a href="GHC.JS.Make.html#toJExpr"><span class="hs-identifier hs-var">toJExpr</span></a></span><span> </span><span class="annot"><span class="annottext">(JStgExpr -&gt; JStgExpr) -&gt; JStgExpr -&gt; JStgExpr
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">JStgExpr
-&gt; (FastString -&gt; JStgExpr) -&gt; Maybe FastString -&gt; JStgExpr
forall b a. b -&gt; (a -&gt; b) -&gt; Maybe a -&gt; b
</span><span class="hs-identifier hs-var">maybe</span></span><span> </span><span class="annot"><span class="annottext">JStgExpr
</span><a href="GHC.JS.Make.html#null_"><span class="hs-identifier hs-var">null_</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Ident -&gt; JStgExpr
forall a. ToJExpr a =&gt; a -&gt; JStgExpr
</span><a href="GHC.JS.Make.html#toJExpr"><span class="hs-identifier hs-var">toJExpr</span></a></span><span> </span><span class="annot"><span class="annottext">(Ident -&gt; JStgExpr)
-&gt; (FastString -&gt; Ident) -&gt; FastString -&gt; JStgExpr
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">FastString -&gt; Ident
</span><a href="GHC.JS.Ident.html#TxtI"><span class="hs-identifier hs-var">TxtI</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Maybe FastString
</span><a href="#local-6989586621682960463"><span class="hs-identifier hs-var">mt</span></a></span><span>
</span><span id="line-1260"></span><span>                                    </span><span class="hs-special">]</span><span>
</span><span id="line-1261"></span><span>    </span><span class="annot"><a href="GHC.StgToJS.Types.html#StaticThunk"><span class="hs-identifier hs-type">StaticThunk</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span class="hs-special">(</span><span id="local-6989586621682960470"><span class="annot"><span class="annottext">FastString
</span><a href="#local-6989586621682960470"><span class="hs-identifier hs-var">f</span></a></span></span><span class="hs-special">,</span><span id="local-6989586621682960471"><span class="annot"><span class="annottext">[StaticArg]
</span><a href="#local-6989586621682960471"><span class="hs-identifier hs-var">args</span></a></span></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">FastString -&gt; [JStgExpr] -&gt; JStgStat
</span><a href="GHC.JS.Make.html#appS"><span class="hs-identifier hs-var">appS</span></a></span><span> </span><span class="annot"><span class="annottext">FastString
</span><a href="GHC.StgToJS.Symbols.html#hdStcStr"><span class="hs-identifier hs-var">hdStcStr</span></a></span><span> </span><span class="annot"><span class="annottext">([JStgExpr] -&gt; JStgStat) -&gt; [JStgExpr] -&gt; JStgStat
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">[JStgExpr] -&gt; [JStgExpr]
</span><a href="#local-6989586621682960455"><span class="hs-identifier hs-var">add_cc_arg</span></a></span><span>
</span><span id="line-1262"></span><span>                                    </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">FastString -&gt; JStgExpr
</span><a href="GHC.JS.JStg.Syntax.html#global"><span class="hs-identifier hs-var">global</span></a></span><span> </span><span class="annot"><span class="annottext">FastString
</span><a href="#local-6989586621682960447"><span class="hs-identifier hs-var">i</span></a></span><span>
</span><span id="line-1263"></span><span>                                    </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">FastString -&gt; JStgExpr
</span><a href="GHC.JS.JStg.Syntax.html#global"><span class="hs-identifier hs-var">global</span></a></span><span> </span><span class="annot"><span class="annottext">FastString
</span><a href="#local-6989586621682960470"><span class="hs-identifier hs-var">f</span></a></span><span>
</span><span id="line-1264"></span><span>                                    </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">[StaticArg] -&gt; JStgExpr
</span><a href="GHC.StgToJS.Arg.html#jsStaticArgs"><span class="hs-identifier hs-var">jsStaticArgs</span></a></span><span> </span><span class="annot"><span class="annottext">[StaticArg]
</span><a href="#local-6989586621682960471"><span class="hs-identifier hs-var">args</span></a></span><span>
</span><span id="line-1265"></span><span>                                    </span><span class="hs-special">]</span><span>
</span><span id="line-1266"></span><span>    </span><span class="annot"><span class="annottext">StaticVal
</span><span class="hs-identifier">_</span></span><span>                           </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">JStgStat
forall a. Monoid a =&gt; a
</span><span class="hs-identifier hs-var">mempty</span></span><span>
</span><span id="line-1267"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-1268"></span><span>    </span><span class="hs-comment">-- add optional cost-center argument</span><span>
</span><span id="line-1269"></span><span>    </span><span id="local-6989586621682960455"><span class="annot"><span class="annottext">add_cc_arg :: [JStgExpr] -&gt; [JStgExpr]
</span><a href="#local-6989586621682960455"><span class="hs-identifier hs-var hs-var">add_cc_arg</span></a></span></span><span> </span><span id="local-6989586621682960473"><span class="annot"><span class="annottext">[JStgExpr]
</span><a href="#local-6989586621682960473"><span class="hs-keyword hs-var">as</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">Maybe Ident
</span><a href="#local-6989586621682960449"><span class="hs-identifier hs-var">mcc</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-1270"></span><span>      </span><span class="annot"><span class="annottext">Maybe Ident
</span><span class="hs-identifier hs-var">Nothing</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">[JStgExpr]
</span><a href="#local-6989586621682960473"><span class="hs-keyword hs-var">as</span></a></span><span>
</span><span id="line-1271"></span><span>      </span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span id="local-6989586621682960474"><span class="annot"><span class="annottext">Ident
</span><a href="#local-6989586621682960474"><span class="hs-identifier hs-var">cc</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">[JStgExpr]
</span><a href="#local-6989586621682960473"><span class="hs-keyword hs-var">as</span></a></span><span> </span><span class="annot"><span class="annottext">[JStgExpr] -&gt; [JStgExpr] -&gt; [JStgExpr]
forall a. [a] -&gt; [a] -&gt; [a]
</span><span class="hs-operator hs-var">++</span></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">Ident -&gt; JStgExpr
forall a. ToJExpr a =&gt; a -&gt; JStgExpr
</span><a href="GHC.JS.Make.html#toJExpr"><span class="hs-identifier hs-var">toJExpr</span></a></span><span> </span><span class="annot"><span class="annottext">Ident
</span><a href="#local-6989586621682960474"><span class="hs-identifier hs-var">cc</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-1272"></span><span>
</span><span id="line-1273"></span><span class="annot"><span class="hs-comment">-- | declare and do first-pass init of a global object (create JS object for heap objects)</span></span><span>
</span><span id="line-1274"></span><span class="annot"><a href="GHC.StgToJS.Linker.Linker.html#staticDeclStat"><span class="hs-identifier hs-type">staticDeclStat</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.StgToJS.Types.html#StaticInfo"><span class="hs-identifier hs-type">StaticInfo</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.JS.Syntax.html#JStat"><span class="hs-identifier hs-type">JS.JStat</span></a></span><span>
</span><span id="line-1275"></span><span id="staticDeclStat"><span class="annot"><span class="annottext">staticDeclStat :: StaticInfo -&gt; JStat
</span><a href="GHC.StgToJS.Linker.Linker.html#staticDeclStat"><span class="hs-identifier hs-var hs-var">staticDeclStat</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.StgToJS.Types.html#StaticInfo"><span class="hs-identifier hs-type">StaticInfo</span></a></span><span> </span><span id="local-6989586621682960475"><span class="annot"><span class="annottext">FastString
</span><a href="#local-6989586621682960475"><span class="hs-identifier hs-var">global_name</span></a></span></span><span> </span><span id="local-6989586621682960476"><span class="annot"><span class="annottext">StaticVal
</span><a href="#local-6989586621682960476"><span class="hs-identifier hs-var">static_value</span></a></span></span><span> </span><span class="annot"><span class="annottext">Maybe Ident
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">JStgStat -&gt; JStat
</span><a href="GHC.JS.Transform.html#jStgStatToJS"><span class="hs-identifier hs-var">jStgStatToJS</span></a></span><span> </span><span class="annot"><span class="annottext">JStgStat
</span><a href="#local-6989586621682960477"><span class="hs-identifier hs-var">decl</span></a></span><span>
</span><span id="line-1276"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-1277"></span><span>    </span><span id="local-6989586621682960478"><span class="annot"><span class="annottext">global_ident :: Ident
</span><a href="#local-6989586621682960478"><span class="hs-identifier hs-var hs-var">global_ident</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">FastString -&gt; Ident
</span><a href="GHC.JS.Ident.html#name"><span class="hs-identifier hs-var">name</span></a></span><span> </span><span class="annot"><span class="annottext">FastString
</span><a href="#local-6989586621682960475"><span class="hs-identifier hs-var">global_name</span></a></span><span>
</span><span id="line-1278"></span><span>    </span><span id="local-6989586621682960480"><span class="annot"><span class="annottext">decl_init :: JStgExpr -&gt; JStgStat
</span><a href="#local-6989586621682960480"><span class="hs-identifier hs-var hs-var">decl_init</span></a></span></span><span> </span><span id="local-6989586621682960481"><span class="annot"><span class="annottext">JStgExpr
</span><a href="#local-6989586621682960481"><span class="hs-identifier hs-var">v</span></a></span></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Ident
</span><a href="#local-6989586621682960478"><span class="hs-identifier hs-var">global_ident</span></a></span><span> </span><span class="annot"><span class="annottext">Ident -&gt; JStgExpr -&gt; JStgStat
</span><a href="GHC.JS.Make.html#%7C%7C%3D"><span class="hs-operator hs-var">||=</span></a></span><span> </span><span class="annot"><span class="annottext">JStgExpr
</span><a href="#local-6989586621682960481"><span class="hs-identifier hs-var">v</span></a></span><span>
</span><span id="line-1279"></span><span>    </span><span id="local-6989586621682960483"><span class="annot"><span class="annottext">decl_no_init :: JStgStat
</span><a href="#local-6989586621682960483"><span class="hs-identifier hs-var hs-var">decl_no_init</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">FastString -&gt; [JStgExpr] -&gt; JStgStat
</span><a href="GHC.JS.Make.html#appS"><span class="hs-identifier hs-var">appS</span></a></span><span> </span><span class="annot"><span class="annottext">FastString
</span><a href="GHC.StgToJS.Symbols.html#hdDiStr"><span class="hs-identifier hs-var">hdDiStr</span></a></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">Ident -&gt; JStgExpr
forall a. ToJExpr a =&gt; a -&gt; JStgExpr
</span><a href="GHC.JS.Make.html#toJExpr"><span class="hs-identifier hs-var">toJExpr</span></a></span><span> </span><span class="annot"><span class="annottext">Ident
</span><a href="#local-6989586621682960478"><span class="hs-identifier hs-var">global_ident</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-1280"></span><span>
</span><span id="line-1281"></span><span>    </span><span id="local-6989586621682960477"><span class="annot"><span class="annottext">decl :: JStgStat
</span><a href="#local-6989586621682960477"><span class="hs-identifier hs-var hs-var">decl</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">StaticVal
</span><a href="#local-6989586621682960476"><span class="hs-identifier hs-var">static_value</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-1282"></span><span>      </span><span class="annot"><a href="GHC.StgToJS.Types.html#StaticUnboxed"><span class="hs-identifier hs-type">StaticUnboxed</span></a></span><span> </span><span id="local-6989586621682960486"><span class="annot"><span class="annottext">StaticUnboxed
</span><a href="#local-6989586621682960486"><span class="hs-identifier hs-var">u</span></a></span></span><span>     </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">JStgExpr -&gt; JStgStat
</span><a href="#local-6989586621682960480"><span class="hs-identifier hs-var">decl_init</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">StaticUnboxed -&gt; JStgExpr
</span><a href="#local-6989586621682960487"><span class="hs-identifier hs-var">unboxed_expr</span></a></span><span> </span><span class="annot"><span class="annottext">StaticUnboxed
</span><a href="#local-6989586621682960486"><span class="hs-identifier hs-var">u</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1283"></span><span>      </span><span class="annot"><a href="GHC.StgToJS.Types.html#StaticThunk"><span class="hs-identifier hs-type">StaticThunk</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe (FastString, [StaticArg])
</span><span class="hs-identifier hs-var">Nothing</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">JStgStat
</span><a href="#local-6989586621682960483"><span class="hs-identifier hs-var">decl_no_init</span></a></span><span> </span><span class="hs-comment">-- CAF initialized in an alternative way</span><span>
</span><span id="line-1284"></span><span>      </span><span class="annot"><span class="annottext">StaticVal
</span><span class="hs-identifier">_</span></span><span>                   </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">JStgExpr -&gt; JStgStat
</span><a href="#local-6989586621682960480"><span class="hs-identifier hs-var">decl_init</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">FastString -&gt; [JStgExpr] -&gt; JStgExpr
</span><a href="GHC.JS.Make.html#app"><span class="hs-identifier hs-var">app</span></a></span><span> </span><span class="annot"><span class="annottext">FastString
</span><a href="GHC.StgToJS.Symbols.html#hdDStr"><span class="hs-identifier hs-var">hdDStr</span></a></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span class="hs-special">)</span><span>
</span><span id="line-1285"></span><span>
</span><span id="line-1286"></span><span>    </span><span id="local-6989586621682960487"><span class="annot"><span class="annottext">unboxed_expr :: StaticUnboxed -&gt; JStgExpr
</span><a href="#local-6989586621682960487"><span class="hs-identifier hs-var hs-var">unboxed_expr</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-glyph">\</span><span class="hs-glyph">case</span><span>
</span><span id="line-1287"></span><span>      </span><span class="annot"><a href="GHC.StgToJS.Types.html#StaticUnboxedBool"><span class="hs-identifier hs-type">StaticUnboxedBool</span></a></span><span> </span><span id="local-6989586621682960499"><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621682960499"><span class="hs-identifier hs-var">b</span></a></span></span><span>          </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">FastString -&gt; [JStgExpr] -&gt; JStgExpr
</span><a href="GHC.JS.Make.html#app"><span class="hs-identifier hs-var">app</span></a></span><span> </span><span class="annot"><span class="annottext">FastString
</span><a href="GHC.StgToJS.Symbols.html#hdPStr"><span class="hs-identifier hs-var">hdPStr</span></a></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">Bool -&gt; JStgExpr
forall a. ToJExpr a =&gt; a -&gt; JStgExpr
</span><a href="GHC.JS.Make.html#toJExpr"><span class="hs-identifier hs-var">toJExpr</span></a></span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621682960499"><span class="hs-identifier hs-var">b</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-1288"></span><span>      </span><span class="annot"><a href="GHC.StgToJS.Types.html#StaticUnboxedInt"><span class="hs-identifier hs-type">StaticUnboxedInt</span></a></span><span> </span><span id="local-6989586621682960502"><span class="annot"><span class="annottext">Integer
</span><a href="#local-6989586621682960502"><span class="hs-identifier hs-var">i</span></a></span></span><span>           </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">FastString -&gt; [JStgExpr] -&gt; JStgExpr
</span><a href="GHC.JS.Make.html#app"><span class="hs-identifier hs-var">app</span></a></span><span> </span><span class="annot"><span class="annottext">FastString
</span><a href="GHC.StgToJS.Symbols.html#hdPStr"><span class="hs-identifier hs-var">hdPStr</span></a></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">Integer -&gt; JStgExpr
forall a. ToJExpr a =&gt; a -&gt; JStgExpr
</span><a href="GHC.JS.Make.html#toJExpr"><span class="hs-identifier hs-var">toJExpr</span></a></span><span> </span><span class="annot"><span class="annottext">Integer
</span><a href="#local-6989586621682960502"><span class="hs-identifier hs-var">i</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-1289"></span><span>      </span><span class="annot"><a href="GHC.StgToJS.Types.html#StaticUnboxedDouble"><span class="hs-identifier hs-type">StaticUnboxedDouble</span></a></span><span> </span><span id="local-6989586621682960504"><span class="annot"><span class="annottext">SaneDouble
</span><a href="#local-6989586621682960504"><span class="hs-identifier hs-var">d</span></a></span></span><span>        </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">FastString -&gt; [JStgExpr] -&gt; JStgExpr
</span><a href="GHC.JS.Make.html#app"><span class="hs-identifier hs-var">app</span></a></span><span> </span><span class="annot"><span class="annottext">FastString
</span><a href="GHC.StgToJS.Symbols.html#hdPStr"><span class="hs-identifier hs-var">hdPStr</span></a></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">Double -&gt; JStgExpr
forall a. ToJExpr a =&gt; a -&gt; JStgExpr
</span><a href="GHC.JS.Make.html#toJExpr"><span class="hs-identifier hs-var">toJExpr</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">SaneDouble -&gt; Double
</span><a href="GHC.Types.SaneDouble.html#unSaneDouble"><span class="hs-identifier hs-var">unSaneDouble</span></a></span><span> </span><span class="annot"><span class="annottext">SaneDouble
</span><a href="#local-6989586621682960504"><span class="hs-identifier hs-var">d</span></a></span><span class="hs-special">)</span><span class="hs-special">]</span><span>
</span><span id="line-1290"></span><span>      </span><span class="hs-comment">-- GHCJS used a function wrapper for this:</span><span>
</span><span id="line-1291"></span><span>      </span><span class="hs-comment">-- StaticUnboxedString str      -&gt; ApplExpr (initStr str) []</span><span>
</span><span id="line-1292"></span><span>      </span><span class="hs-comment">-- But we are defining it statically for now.</span><span>
</span><span id="line-1293"></span><span>      </span><span class="annot"><a href="GHC.StgToJS.Types.html#StaticUnboxedString"><span class="hs-identifier hs-type">StaticUnboxedString</span></a></span><span> </span><span id="local-6989586621682960507"><span class="annot"><span class="annottext">ByteString
</span><a href="#local-6989586621682960507"><span class="hs-identifier hs-var">str</span></a></span></span><span>      </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">ByteString -&gt; JStgExpr
</span><a href="#local-6989586621682960508"><span class="hs-identifier hs-var">initStr</span></a></span><span> </span><span class="annot"><span class="annottext">ByteString
</span><a href="#local-6989586621682960507"><span class="hs-identifier hs-var">str</span></a></span><span>
</span><span id="line-1294"></span><span>      </span><span class="annot"><a href="GHC.StgToJS.Types.html#StaticUnboxedStringOffset"><span class="hs-identifier hs-type">StaticUnboxedStringOffset</span></a></span><span> </span><span class="hs-special">{</span><span class="hs-special">}</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">JStgExpr
</span><span class="hs-number">0</span></span><span>
</span><span id="line-1295"></span><span>
</span><span id="line-1296"></span><span>    </span><span id="local-6989586621682960513"><span class="annot"><span class="annottext">to_byte_list :: ByteString -&gt; JVal
</span><a href="#local-6989586621682960513"><span class="hs-identifier hs-var hs-var">to_byte_list</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[JStgExpr] -&gt; JVal
</span><a href="GHC.JS.JStg.Syntax.html#JList"><span class="hs-identifier hs-var">JList</span></a></span><span> </span><span class="annot"><span class="annottext">([JStgExpr] -&gt; JVal)
-&gt; (ByteString -&gt; [JStgExpr]) -&gt; ByteString -&gt; JVal
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">(Word8 -&gt; JStgExpr) -&gt; [Word8] -&gt; [JStgExpr]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><span class="hs-identifier hs-var">map</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Integer -&gt; JStgExpr
</span><a href="GHC.JS.JStg.Syntax.html#Int"><span class="hs-identifier hs-var">Int</span></a></span><span> </span><span class="annot"><span class="annottext">(Integer -&gt; JStgExpr) -&gt; (Word8 -&gt; Integer) -&gt; Word8 -&gt; JStgExpr
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">Word8 -&gt; Integer
forall a b. (Integral a, Num b) =&gt; a -&gt; b
</span><span class="hs-identifier hs-var">fromIntegral</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">([Word8] -&gt; [JStgExpr])
-&gt; (ByteString -&gt; [Word8]) -&gt; ByteString -&gt; [JStgExpr]
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">ByteString -&gt; [Word8]
</span><a href="../../bytestring-0.12.2.0-7dd0/src/Data.ByteString.html#unpack"><span class="hs-identifier hs-var">BS.unpack</span></a></span><span>
</span><span id="line-1297"></span><span>
</span><span id="line-1298"></span><span>    </span><span class="annot"><a href="#local-6989586621682960508"><span class="hs-identifier hs-type">initStr</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="../../bytestring-0.12.2.0-7dd0/src/Data.ByteString.Internal.Type.html#ByteString"><span class="hs-identifier hs-type">BS.ByteString</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.JS.JStg.Syntax.html#JStgExpr"><span class="hs-identifier hs-type">JStgExpr</span></a></span><span>
</span><span id="line-1299"></span><span>    </span><span id="local-6989586621682960508"><span class="annot"><span class="annottext">initStr :: ByteString -&gt; JStgExpr
</span><a href="#local-6989586621682960508"><span class="hs-identifier hs-var hs-var">initStr</span></a></span></span><span> </span><span id="local-6989586621682960517"><span class="annot"><span class="annottext">ByteString
</span><a href="#local-6989586621682960517"><span class="hs-identifier hs-var">str</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-1300"></span><span>      </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">ByteString -&gt; Maybe FastString
</span><a href="GHC.StgToJS.Linker.Utils.html#decodeModifiedUTF8"><span class="hs-identifier hs-var">decodeModifiedUTF8</span></a></span><span> </span><span class="annot"><span class="annottext">ByteString
</span><a href="#local-6989586621682960517"><span class="hs-identifier hs-var">str</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-1301"></span><span>        </span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span id="local-6989586621682960519"><span class="annot"><span class="annottext">FastString
</span><a href="#local-6989586621682960519"><span class="hs-identifier hs-var">t</span></a></span></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">FastString -&gt; [JStgExpr] -&gt; JStgExpr
</span><a href="GHC.JS.Make.html#app"><span class="hs-identifier hs-var">app</span></a></span><span> </span><span class="annot"><span class="annottext">FastString
</span><a href="GHC.StgToJS.Symbols.html#hdEncodeModifiedUtf8Str"><span class="hs-identifier hs-var">hdEncodeModifiedUtf8Str</span></a></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">JVal -&gt; JStgExpr
</span><a href="GHC.JS.JStg.Syntax.html#ValExpr"><span class="hs-identifier hs-var">ValExpr</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">FastString -&gt; JVal
</span><a href="GHC.JS.JStg.Syntax.html#JStr"><span class="hs-identifier hs-var">JStr</span></a></span><span> </span><span class="annot"><span class="annottext">FastString
</span><a href="#local-6989586621682960519"><span class="hs-identifier hs-var">t</span></a></span><span class="hs-special">)</span><span class="hs-special">]</span><span>
</span><span id="line-1302"></span><span>        </span><span class="annot"><span class="annottext">Maybe FastString
</span><span class="hs-identifier hs-var">Nothing</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">FastString -&gt; [JStgExpr] -&gt; JStgExpr
</span><a href="GHC.JS.Make.html#app"><span class="hs-identifier hs-var">app</span></a></span><span> </span><span class="annot"><span class="annottext">FastString
</span><a href="GHC.StgToJS.Symbols.html#hdRawStringDataStr"><span class="hs-identifier hs-var">hdRawStringDataStr</span></a></span><span>      </span><span class="hs-special">[</span><span class="annot"><span class="annottext">JVal -&gt; JStgExpr
</span><a href="GHC.JS.JStg.Syntax.html#ValExpr"><span class="hs-identifier hs-var">ValExpr</span></a></span><span> </span><span class="annot"><span class="annottext">(JVal -&gt; JStgExpr) -&gt; JVal -&gt; JStgExpr
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">ByteString -&gt; JVal
</span><a href="#local-6989586621682960513"><span class="hs-identifier hs-var">to_byte_list</span></a></span><span> </span><span class="annot"><span class="annottext">ByteString
</span><a href="#local-6989586621682960517"><span class="hs-identifier hs-var">str</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-1303"></span></pre></body></html>