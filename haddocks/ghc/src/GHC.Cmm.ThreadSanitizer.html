<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><link rel="stylesheet" type="text/css" href="style.css" /><script type="text/javascript" src="highlight.js"></script></head><body><pre><span class="hs-pragma">{-# LANGUAGE GADTs #-}</span><span>
</span><span id="line-2"></span><span class="hs-pragma">{-# LANGUAGE RankNTypes #-}</span><span>
</span><span id="line-3"></span><span>
</span><span id="line-4"></span><span class="annot"><span class="hs-comment">-- | Annotate a CmmGraph with ThreadSanitizer instrumentation calls.</span></span><span>
</span><span id="line-5"></span><span class="hs-keyword">module</span><span> </span><span class="annot"><a href="GHC.Cmm.ThreadSanitizer.html"><span class="hs-identifier">GHC.Cmm.ThreadSanitizer</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Cmm.ThreadSanitizer.html#annotateTSAN"><span class="hs-identifier">annotateTSAN</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-6"></span><span>
</span><span id="line-7"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Prelude.html"><span class="hs-identifier">GHC.Prelude</span></a></span><span>
</span><span id="line-8"></span><span>
</span><span id="line-9"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Platform.html"><span class="hs-identifier">GHC.Platform</span></a></span><span>
</span><span id="line-10"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Platform.Regs.html"><span class="hs-identifier">GHC.Platform.Regs</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Platform.Regs.html#activeStgRegs"><span class="hs-identifier">activeStgRegs</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Platform.Regs.html#callerSaves"><span class="hs-identifier">callerSaves</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-11"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Cmm.html"><span class="hs-identifier">GHC.Cmm</span></a></span><span>
</span><span id="line-12"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Cmm.Utils.html"><span class="hs-identifier">GHC.Cmm.Utils</span></a></span><span>
</span><span id="line-13"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Cmm.CLabel.html"><span class="hs-identifier">GHC.Cmm.CLabel</span></a></span><span>
</span><span id="line-14"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Cmm.Dataflow.html"><span class="hs-identifier">GHC.Cmm.Dataflow</span></a></span><span>
</span><span id="line-15"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Cmm.Dataflow.Block.html"><span class="hs-identifier">GHC.Cmm.Dataflow.Block</span></a></span><span>
</span><span id="line-16"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Cmm.Dataflow.Graph.html"><span class="hs-identifier">GHC.Cmm.Dataflow.Graph</span></a></span><span>
</span><span id="line-17"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Data.FastString.html"><span class="hs-identifier">GHC.Data.FastString</span></a></span><span>
</span><span id="line-18"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Types.Basic.html"><span class="hs-identifier">GHC.Types.Basic</span></a></span><span>
</span><span id="line-19"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Types.ForeignCall.html"><span class="hs-identifier">GHC.Types.ForeignCall</span></a></span><span>
</span><span id="line-20"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Types.Unique.html"><span class="hs-identifier">GHC.Types.Unique</span></a></span><span>
</span><span id="line-21"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Types.Unique.Supply.html"><span class="hs-identifier">GHC.Types.Unique.Supply</span></a></span><span>
</span><span id="line-22"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Cmm.Dataflow.Label.html"><span class="hs-identifier">GHC.Cmm.Dataflow.Label</span></a></span><span>
</span><span id="line-23"></span><span>
</span><span id="line-24"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="../../base-4.21.0.0-ae91/src/Data.Maybe.html"><span class="hs-identifier">Data.Maybe</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">fromMaybe</span></span><span class="hs-special">)</span><span>
</span><span id="line-25"></span><span>
</span><span id="line-26"></span><span class="hs-keyword">data</span><span> </span><span id="Env"><span class="annot"><a href="GHC.Cmm.ThreadSanitizer.html#Env"><span class="hs-identifier hs-var">Env</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="Env"><span class="annot"><a href="GHC.Cmm.ThreadSanitizer.html#Env"><span class="hs-identifier hs-var">Env</span></a></span></span><span> </span><span class="hs-special">{</span><span> </span><span id="platform"><span class="annot"><span class="annottext">Env -&gt; Platform
</span><a href="GHC.Cmm.ThreadSanitizer.html#platform"><span class="hs-identifier hs-var hs-var">platform</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Platform.html#Platform"><span class="hs-identifier hs-type">Platform</span></a></span><span>
</span><span id="line-27"></span><span>               </span><span class="hs-special">,</span><span> </span><span id="uniques"><span class="annot"><span class="annottext">Env -&gt; UniqSupply
</span><a href="GHC.Cmm.ThreadSanitizer.html#uniques"><span class="hs-identifier hs-var hs-var">uniques</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Types.Unique.Supply.html#UniqSupply"><span class="hs-identifier hs-type">UniqSupply</span></a></span><span>
</span><span id="line-28"></span><span>               </span><span class="hs-special">}</span><span>
</span><span id="line-29"></span><span>
</span><span id="line-30"></span><span class="annot"><a href="GHC.Cmm.ThreadSanitizer.html#annotateTSAN"><span class="hs-identifier hs-type">annotateTSAN</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Platform.html#Platform"><span class="hs-identifier hs-type">Platform</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Cmm.html#CmmGraph"><span class="hs-identifier hs-type">CmmGraph</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Types.Unique.Supply.html#UniqSM"><span class="hs-identifier hs-type">UniqSM</span></a></span><span> </span><span class="annot"><a href="GHC.Cmm.html#CmmGraph"><span class="hs-identifier hs-type">CmmGraph</span></a></span><span>
</span><span id="line-31"></span><span id="annotateTSAN"><span class="annot"><span class="annottext">annotateTSAN :: Platform -&gt; CmmGraph -&gt; UniqSM CmmGraph
</span><a href="GHC.Cmm.ThreadSanitizer.html#annotateTSAN"><span class="hs-identifier hs-var hs-var">annotateTSAN</span></a></span></span><span> </span><span id="local-6989586621682873214"><span class="annot"><span class="annottext">Platform
</span><a href="#local-6989586621682873214"><span class="hs-identifier hs-var">platform</span></a></span></span><span> </span><span id="local-6989586621682873215"><span class="annot"><span class="annottext">CmmGraph
</span><a href="#local-6989586621682873215"><span class="hs-identifier hs-var">graph</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-32"></span><span>    </span><span id="local-6989586621682873216"><span class="annot"><a href="#local-6989586621682873216"><span class="hs-identifier hs-var">env</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Platform -&gt; UniqSupply -&gt; Env
</span><a href="GHC.Cmm.ThreadSanitizer.html#Env"><span class="hs-identifier hs-var">Env</span></a></span><span> </span><span class="annot"><span class="annottext">Platform
</span><a href="#local-6989586621682873214"><span class="hs-identifier hs-var">platform</span></a></span><span> </span><span class="annot"><span class="annottext">(UniqSupply -&gt; Env) -&gt; UniqSM UniqSupply -&gt; UniqSM Env
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="annot"><span class="annottext">UniqSM UniqSupply
forall (m :: * -&gt; *). MonadUnique m =&gt; m UniqSupply
</span><a href="GHC.Types.Unique.Supply.html#getUniqueSupplyM"><span class="hs-identifier hs-var">getUniqueSupplyM</span></a></span><span>
</span><span id="line-33"></span><span>    </span><span class="annot"><span class="hs-identifier hs-type">return</span></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="annot"><a href="GHC.Cmm.Utils.html#modifyGraph"><span class="hs-identifier hs-type">modifyGraph</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Cmm.Dataflow.Graph.html#mapGraphBlocks"><span class="hs-identifier hs-type">mapGraphBlocks</span></a></span><span> </span><span class="annot"><a href="GHC.Cmm.Dataflow.Label.html#mapMap"><span class="hs-identifier hs-type">mapMap</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Cmm.ThreadSanitizer.html#annotateBlock"><span class="hs-identifier hs-type">annotateBlock</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682873216"><span class="hs-identifier hs-type">env</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="annot"><a href="#local-6989586621682873215"><span class="hs-identifier hs-type">graph</span></a></span><span>
</span><span id="line-34"></span><span>
</span><span id="line-35"></span><span id="local-6989586621682873088"><span id="local-6989586621682873091"><span id="local-6989586621682873092"><span class="annot"><a href="GHC.Cmm.ThreadSanitizer.html#mapBlockList"><span class="hs-identifier hs-type">mapBlockList</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="hs-keyword">forall</span><span> </span><span id="local-6989586621682873089"><span class="annot"><a href="#local-6989586621682873089"><span class="hs-identifier hs-type">e'</span></a></span></span><span> </span><span id="local-6989586621682873090"><span class="annot"><a href="#local-6989586621682873090"><span class="hs-identifier hs-type">x'</span></a></span></span><span class="hs-operator">.</span><span> </span><span class="annot"><a href="#local-6989586621682873088"><span class="hs-identifier hs-type">n</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682873089"><span class="hs-identifier hs-type">e'</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682873090"><span class="hs-identifier hs-type">x'</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Cmm.Dataflow.Block.html#Block"><span class="hs-identifier hs-type">Block</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682873088"><span class="hs-identifier hs-type">n</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682873089"><span class="hs-identifier hs-type">e'</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682873090"><span class="hs-identifier hs-type">x'</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-36"></span><span>             </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Cmm.Dataflow.Block.html#Block"><span class="hs-identifier hs-type">Block</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682873088"><span class="hs-identifier hs-type">n</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682873091"><span class="hs-identifier hs-type">e</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682873092"><span class="hs-identifier hs-type">x</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Cmm.Dataflow.Block.html#Block"><span class="hs-identifier hs-type">Block</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682873088"><span class="hs-identifier hs-type">n</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682873091"><span class="hs-identifier hs-type">e</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682873092"><span class="hs-identifier hs-type">x</span></a></span></span></span></span><span>
</span><span id="line-37"></span><span id="mapBlockList"><span class="annot"><span class="annottext">mapBlockList :: forall (n :: Extensibility -&gt; Extensibility -&gt; *)
       (e :: Extensibility) (x :: Extensibility).
(forall (e' :: Extensibility) (x' :: Extensibility).
 n e' x' -&gt; Block n e' x')
-&gt; Block n e x -&gt; Block n e x
</span><a href="GHC.Cmm.ThreadSanitizer.html#mapBlockList"><span class="hs-identifier hs-var hs-var">mapBlockList</span></a></span></span><span> </span><span id="local-6989586621682873224"><span class="annot"><span class="annottext">forall (e' :: Extensibility) (x' :: Extensibility).
n e' x' -&gt; Block n e' x'
</span><a href="#local-6989586621682873224"><span class="hs-identifier hs-var">f</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Cmm.Dataflow.Block.html#BlockCO"><span class="hs-identifier hs-type">BlockCO</span></a></span><span> </span><span id="local-6989586621682873228"><span class="annot"><span class="annottext">n C 'Open
</span><a href="#local-6989586621682873228"><span class="hs-identifier hs-var">n</span></a></span></span><span> </span><span id="local-6989586621682873229"><span class="annot"><span class="annottext">Block n 'Open 'Open
</span><a href="#local-6989586621682873229"><span class="hs-identifier hs-var">rest</span></a></span></span><span>  </span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">n e 'Open -&gt; Block n e 'Open
forall (e' :: Extensibility) (x' :: Extensibility).
n e' x' -&gt; Block n e' x'
</span><a href="#local-6989586621682873224"><span class="hs-identifier hs-var">f</span></a></span><span> </span><span class="annot"><span class="annottext">n e 'Open
n C 'Open
</span><a href="#local-6989586621682873228"><span class="hs-identifier hs-var">n</span></a></span><span> </span><span class="annot"><span class="annottext">Block n e 'Open -&gt; Block n 'Open x -&gt; Block n e x
forall (n :: Extensibility -&gt; Extensibility -&gt; *)
       (e :: Extensibility) (x :: Extensibility).
Block n e 'Open -&gt; Block n 'Open x -&gt; Block n e x
</span><a href="GHC.Cmm.Dataflow.Block.html#blockAppend"><span class="hs-operator hs-var">`blockAppend`</span></a></span><span> </span><span class="annot"><span class="annottext">(forall (e' :: Extensibility) (x' :: Extensibility).
 n e' x' -&gt; Block n e' x')
-&gt; Block n 'Open x -&gt; Block n 'Open x
forall (n :: Extensibility -&gt; Extensibility -&gt; *)
       (e :: Extensibility) (x :: Extensibility).
(forall (e' :: Extensibility) (x' :: Extensibility).
 n e' x' -&gt; Block n e' x')
-&gt; Block n e x -&gt; Block n e x
</span><a href="GHC.Cmm.ThreadSanitizer.html#mapBlockList"><span class="hs-identifier hs-var">mapBlockList</span></a></span><span> </span><span class="annot"><span class="annottext">n e' x' -&gt; Block n e' x'
forall (e' :: Extensibility) (x' :: Extensibility).
n e' x' -&gt; Block n e' x'
</span><a href="#local-6989586621682873224"><span class="hs-identifier hs-var">f</span></a></span><span> </span><span class="annot"><span class="annottext">Block n 'Open x
Block n 'Open 'Open
</span><a href="#local-6989586621682873229"><span class="hs-identifier hs-var">rest</span></a></span><span>
</span><span id="line-38"></span><span class="annot"><a href="GHC.Cmm.ThreadSanitizer.html#mapBlockList"><span class="hs-identifier hs-var">mapBlockList</span></a></span><span> </span><span id="local-6989586621682873231"><span class="annot"><span class="annottext">forall (e' :: Extensibility) (x' :: Extensibility).
n e' x' -&gt; Block n e' x'
</span><a href="#local-6989586621682873231"><span class="hs-identifier hs-var">f</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Cmm.Dataflow.Block.html#BlockCC"><span class="hs-identifier hs-type">BlockCC</span></a></span><span> </span><span id="local-6989586621682873235"><span class="annot"><span class="annottext">n C 'Open
</span><a href="#local-6989586621682873235"><span class="hs-identifier hs-var">n</span></a></span></span><span> </span><span id="local-6989586621682873236"><span class="annot"><span class="annottext">Block n 'Open 'Open
</span><a href="#local-6989586621682873236"><span class="hs-identifier hs-var">rest</span></a></span></span><span> </span><span id="local-6989586621682873237"><span class="annot"><span class="annottext">n 'Open C
</span><a href="#local-6989586621682873237"><span class="hs-identifier hs-var">m</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">n e 'Open -&gt; Block n e 'Open
forall (e' :: Extensibility) (x' :: Extensibility).
n e' x' -&gt; Block n e' x'
</span><a href="#local-6989586621682873231"><span class="hs-identifier hs-var">f</span></a></span><span> </span><span class="annot"><span class="annottext">n e 'Open
n C 'Open
</span><a href="#local-6989586621682873235"><span class="hs-identifier hs-var">n</span></a></span><span> </span><span class="annot"><span class="annottext">Block n e 'Open -&gt; Block n 'Open 'Open -&gt; Block n e 'Open
forall (n :: Extensibility -&gt; Extensibility -&gt; *)
       (e :: Extensibility) (x :: Extensibility).
Block n e 'Open -&gt; Block n 'Open x -&gt; Block n e x
</span><a href="GHC.Cmm.Dataflow.Block.html#blockAppend"><span class="hs-operator hs-var">`blockAppend`</span></a></span><span> </span><span class="annot"><span class="annottext">(forall (e' :: Extensibility) (x' :: Extensibility).
 n e' x' -&gt; Block n e' x')
-&gt; Block n 'Open 'Open -&gt; Block n 'Open 'Open
forall (n :: Extensibility -&gt; Extensibility -&gt; *)
       (e :: Extensibility) (x :: Extensibility).
(forall (e' :: Extensibility) (x' :: Extensibility).
 n e' x' -&gt; Block n e' x')
-&gt; Block n e x -&gt; Block n e x
</span><a href="GHC.Cmm.ThreadSanitizer.html#mapBlockList"><span class="hs-identifier hs-var">mapBlockList</span></a></span><span> </span><span class="annot"><span class="annottext">n e' x' -&gt; Block n e' x'
forall (e' :: Extensibility) (x' :: Extensibility).
n e' x' -&gt; Block n e' x'
</span><a href="#local-6989586621682873231"><span class="hs-identifier hs-var">f</span></a></span><span> </span><span class="annot"><span class="annottext">Block n 'Open 'Open
</span><a href="#local-6989586621682873236"><span class="hs-identifier hs-var">rest</span></a></span><span> </span><span class="annot"><span class="annottext">Block n e 'Open -&gt; Block n 'Open x -&gt; Block n e x
forall (n :: Extensibility -&gt; Extensibility -&gt; *)
       (e :: Extensibility) (x :: Extensibility).
Block n e 'Open -&gt; Block n 'Open x -&gt; Block n e x
</span><a href="GHC.Cmm.Dataflow.Block.html#blockAppend"><span class="hs-operator hs-var">`blockAppend`</span></a></span><span> </span><span class="annot"><span class="annottext">n 'Open x -&gt; Block n 'Open x
forall (e' :: Extensibility) (x' :: Extensibility).
n e' x' -&gt; Block n e' x'
</span><a href="#local-6989586621682873231"><span class="hs-identifier hs-var">f</span></a></span><span> </span><span class="annot"><span class="annottext">n 'Open x
n 'Open C
</span><a href="#local-6989586621682873237"><span class="hs-identifier hs-var">m</span></a></span><span>
</span><span id="line-39"></span><span class="annot"><a href="GHC.Cmm.ThreadSanitizer.html#mapBlockList"><span class="hs-identifier hs-var">mapBlockList</span></a></span><span> </span><span id="local-6989586621682873238"><span class="annot"><span class="annottext">forall (e' :: Extensibility) (x' :: Extensibility).
n e' x' -&gt; Block n e' x'
</span><a href="#local-6989586621682873238"><span class="hs-identifier hs-var">f</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Cmm.Dataflow.Block.html#BlockOC"><span class="hs-identifier hs-type">BlockOC</span></a></span><span>   </span><span id="local-6989586621682873242"><span class="annot"><span class="annottext">Block n 'Open 'Open
</span><a href="#local-6989586621682873242"><span class="hs-identifier hs-var">rest</span></a></span></span><span> </span><span id="local-6989586621682873243"><span class="annot"><span class="annottext">n 'Open C
</span><a href="#local-6989586621682873243"><span class="hs-identifier hs-var">m</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(forall (e' :: Extensibility) (x' :: Extensibility).
 n e' x' -&gt; Block n e' x')
-&gt; Block n e 'Open -&gt; Block n e 'Open
forall (n :: Extensibility -&gt; Extensibility -&gt; *)
       (e :: Extensibility) (x :: Extensibility).
(forall (e' :: Extensibility) (x' :: Extensibility).
 n e' x' -&gt; Block n e' x')
-&gt; Block n e x -&gt; Block n e x
</span><a href="GHC.Cmm.ThreadSanitizer.html#mapBlockList"><span class="hs-identifier hs-var">mapBlockList</span></a></span><span> </span><span class="annot"><span class="annottext">n e' x' -&gt; Block n e' x'
forall (e' :: Extensibility) (x' :: Extensibility).
n e' x' -&gt; Block n e' x'
</span><a href="#local-6989586621682873238"><span class="hs-identifier hs-var">f</span></a></span><span> </span><span class="annot"><span class="annottext">Block n e 'Open
Block n 'Open 'Open
</span><a href="#local-6989586621682873242"><span class="hs-identifier hs-var">rest</span></a></span><span> </span><span class="annot"><span class="annottext">Block n e 'Open -&gt; Block n 'Open x -&gt; Block n e x
forall (n :: Extensibility -&gt; Extensibility -&gt; *)
       (e :: Extensibility) (x :: Extensibility).
Block n e 'Open -&gt; Block n 'Open x -&gt; Block n e x
</span><a href="GHC.Cmm.Dataflow.Block.html#blockAppend"><span class="hs-operator hs-var">`blockAppend`</span></a></span><span> </span><span class="annot"><span class="annottext">n 'Open x -&gt; Block n 'Open x
forall (e' :: Extensibility) (x' :: Extensibility).
n e' x' -&gt; Block n e' x'
</span><a href="#local-6989586621682873238"><span class="hs-identifier hs-var">f</span></a></span><span> </span><span class="annot"><span class="annottext">n 'Open x
n 'Open C
</span><a href="#local-6989586621682873243"><span class="hs-identifier hs-var">m</span></a></span><span>
</span><span id="line-40"></span><span class="annot"><a href="GHC.Cmm.ThreadSanitizer.html#mapBlockList"><span class="hs-identifier hs-var">mapBlockList</span></a></span><span> </span><span class="annot"><span class="annottext">forall (e' :: Extensibility) (x' :: Extensibility).
n e' x' -&gt; Block n e' x'
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">Block n e x
</span><a href="GHC.Cmm.Dataflow.Block.html#BNil"><span class="hs-identifier hs-var">BNil</span></a></span><span>               </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Block n e x
Block n 'Open 'Open
forall (n :: Extensibility -&gt; Extensibility -&gt; *).
Block n 'Open 'Open
</span><a href="GHC.Cmm.Dataflow.Block.html#BNil"><span class="hs-identifier hs-var">BNil</span></a></span><span>
</span><span id="line-41"></span><span class="annot"><a href="GHC.Cmm.ThreadSanitizer.html#mapBlockList"><span class="hs-identifier hs-var">mapBlockList</span></a></span><span> </span><span id="local-6989586621682873247"><span class="annot"><span class="annottext">forall (e' :: Extensibility) (x' :: Extensibility).
n e' x' -&gt; Block n e' x'
</span><a href="#local-6989586621682873247"><span class="hs-identifier hs-var">f</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Cmm.Dataflow.Block.html#BMiddle"><span class="hs-identifier hs-type">BMiddle</span></a></span><span> </span><span id="local-6989586621682873251"><span class="annot"><span class="annottext">n 'Open 'Open
</span><a href="#local-6989586621682873251"><span class="hs-identifier hs-var">blk</span></a></span></span><span class="hs-special">)</span><span>      </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">n e x -&gt; Block n e x
forall (e' :: Extensibility) (x' :: Extensibility).
n e' x' -&gt; Block n e' x'
</span><a href="#local-6989586621682873247"><span class="hs-identifier hs-var">f</span></a></span><span> </span><span class="annot"><span class="annottext">n e x
n 'Open 'Open
</span><a href="#local-6989586621682873251"><span class="hs-identifier hs-var">blk</span></a></span><span>
</span><span id="line-42"></span><span class="annot"><a href="GHC.Cmm.ThreadSanitizer.html#mapBlockList"><span class="hs-identifier hs-var">mapBlockList</span></a></span><span> </span><span id="local-6989586621682873252"><span class="annot"><span class="annottext">forall (e' :: Extensibility) (x' :: Extensibility).
n e' x' -&gt; Block n e' x'
</span><a href="#local-6989586621682873252"><span class="hs-identifier hs-var">f</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Cmm.Dataflow.Block.html#BCat"><span class="hs-identifier hs-type">BCat</span></a></span><span> </span><span id="local-6989586621682873256"><span class="annot"><span class="annottext">Block n 'Open 'Open
</span><a href="#local-6989586621682873256"><span class="hs-identifier hs-var">a</span></a></span></span><span> </span><span id="local-6989586621682873257"><span class="annot"><span class="annottext">Block n 'Open 'Open
</span><a href="#local-6989586621682873257"><span class="hs-identifier hs-var">b</span></a></span></span><span class="hs-special">)</span><span>         </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(forall (e' :: Extensibility) (x' :: Extensibility).
 n e' x' -&gt; Block n e' x')
-&gt; Block n e 'Open -&gt; Block n e 'Open
forall (n :: Extensibility -&gt; Extensibility -&gt; *)
       (e :: Extensibility) (x :: Extensibility).
(forall (e' :: Extensibility) (x' :: Extensibility).
 n e' x' -&gt; Block n e' x')
-&gt; Block n e x -&gt; Block n e x
</span><a href="GHC.Cmm.ThreadSanitizer.html#mapBlockList"><span class="hs-identifier hs-var">mapBlockList</span></a></span><span> </span><span class="annot"><span class="annottext">n e' x' -&gt; Block n e' x'
forall (e' :: Extensibility) (x' :: Extensibility).
n e' x' -&gt; Block n e' x'
</span><a href="#local-6989586621682873252"><span class="hs-identifier hs-var">f</span></a></span><span> </span><span class="annot"><span class="annottext">Block n e 'Open
Block n 'Open 'Open
</span><a href="#local-6989586621682873256"><span class="hs-identifier hs-var">a</span></a></span><span> </span><span class="annot"><span class="annottext">Block n e 'Open -&gt; Block n 'Open x -&gt; Block n e x
forall (n :: Extensibility -&gt; Extensibility -&gt; *)
       (e :: Extensibility) (x :: Extensibility).
Block n e 'Open -&gt; Block n 'Open x -&gt; Block n e x
</span><a href="GHC.Cmm.Dataflow.Block.html#blockAppend"><span class="hs-operator hs-var">`blockAppend`</span></a></span><span> </span><span class="annot"><span class="annottext">(forall (e' :: Extensibility) (x' :: Extensibility).
 n e' x' -&gt; Block n e' x')
-&gt; Block n 'Open x -&gt; Block n 'Open x
forall (n :: Extensibility -&gt; Extensibility -&gt; *)
       (e :: Extensibility) (x :: Extensibility).
(forall (e' :: Extensibility) (x' :: Extensibility).
 n e' x' -&gt; Block n e' x')
-&gt; Block n e x -&gt; Block n e x
</span><a href="GHC.Cmm.ThreadSanitizer.html#mapBlockList"><span class="hs-identifier hs-var">mapBlockList</span></a></span><span> </span><span class="annot"><span class="annottext">n e' x' -&gt; Block n e' x'
forall (e' :: Extensibility) (x' :: Extensibility).
n e' x' -&gt; Block n e' x'
</span><a href="#local-6989586621682873252"><span class="hs-identifier hs-var">f</span></a></span><span> </span><span class="annot"><span class="annottext">Block n 'Open x
Block n 'Open 'Open
</span><a href="#local-6989586621682873257"><span class="hs-identifier hs-var">b</span></a></span><span>
</span><span id="line-43"></span><span class="annot"><a href="GHC.Cmm.ThreadSanitizer.html#mapBlockList"><span class="hs-identifier hs-var">mapBlockList</span></a></span><span> </span><span id="local-6989586621682873258"><span class="annot"><span class="annottext">forall (e' :: Extensibility) (x' :: Extensibility).
n e' x' -&gt; Block n e' x'
</span><a href="#local-6989586621682873258"><span class="hs-identifier hs-var">f</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Cmm.Dataflow.Block.html#BSnoc"><span class="hs-identifier hs-type">BSnoc</span></a></span><span> </span><span id="local-6989586621682873262"><span class="annot"><span class="annottext">Block n 'Open 'Open
</span><a href="#local-6989586621682873262"><span class="hs-identifier hs-var">a</span></a></span></span><span> </span><span id="local-6989586621682873263"><span class="annot"><span class="annottext">n 'Open 'Open
</span><a href="#local-6989586621682873263"><span class="hs-identifier hs-var">n</span></a></span></span><span class="hs-special">)</span><span>        </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(forall (e' :: Extensibility) (x' :: Extensibility).
 n e' x' -&gt; Block n e' x')
-&gt; Block n e 'Open -&gt; Block n e 'Open
forall (n :: Extensibility -&gt; Extensibility -&gt; *)
       (e :: Extensibility) (x :: Extensibility).
(forall (e' :: Extensibility) (x' :: Extensibility).
 n e' x' -&gt; Block n e' x')
-&gt; Block n e x -&gt; Block n e x
</span><a href="GHC.Cmm.ThreadSanitizer.html#mapBlockList"><span class="hs-identifier hs-var">mapBlockList</span></a></span><span> </span><span class="annot"><span class="annottext">n e' x' -&gt; Block n e' x'
forall (e' :: Extensibility) (x' :: Extensibility).
n e' x' -&gt; Block n e' x'
</span><a href="#local-6989586621682873258"><span class="hs-identifier hs-var">f</span></a></span><span> </span><span class="annot"><span class="annottext">Block n e 'Open
Block n 'Open 'Open
</span><a href="#local-6989586621682873262"><span class="hs-identifier hs-var">a</span></a></span><span> </span><span class="annot"><span class="annottext">Block n e 'Open -&gt; Block n 'Open x -&gt; Block n e x
forall (n :: Extensibility -&gt; Extensibility -&gt; *)
       (e :: Extensibility) (x :: Extensibility).
Block n e 'Open -&gt; Block n 'Open x -&gt; Block n e x
</span><a href="GHC.Cmm.Dataflow.Block.html#blockAppend"><span class="hs-operator hs-var">`blockAppend`</span></a></span><span> </span><span class="annot"><span class="annottext">n 'Open x -&gt; Block n 'Open x
forall (e' :: Extensibility) (x' :: Extensibility).
n e' x' -&gt; Block n e' x'
</span><a href="#local-6989586621682873258"><span class="hs-identifier hs-var">f</span></a></span><span> </span><span class="annot"><span class="annottext">n 'Open x
n 'Open 'Open
</span><a href="#local-6989586621682873263"><span class="hs-identifier hs-var">n</span></a></span><span>
</span><span id="line-44"></span><span class="annot"><a href="GHC.Cmm.ThreadSanitizer.html#mapBlockList"><span class="hs-identifier hs-var">mapBlockList</span></a></span><span> </span><span id="local-6989586621682873264"><span class="annot"><span class="annottext">forall (e' :: Extensibility) (x' :: Extensibility).
n e' x' -&gt; Block n e' x'
</span><a href="#local-6989586621682873264"><span class="hs-identifier hs-var">f</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Cmm.Dataflow.Block.html#BCons"><span class="hs-identifier hs-type">BCons</span></a></span><span> </span><span id="local-6989586621682873268"><span class="annot"><span class="annottext">n 'Open 'Open
</span><a href="#local-6989586621682873268"><span class="hs-identifier hs-var">n</span></a></span></span><span> </span><span id="local-6989586621682873269"><span class="annot"><span class="annottext">Block n 'Open 'Open
</span><a href="#local-6989586621682873269"><span class="hs-identifier hs-var">a</span></a></span></span><span class="hs-special">)</span><span>        </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">n e 'Open -&gt; Block n e 'Open
forall (e' :: Extensibility) (x' :: Extensibility).
n e' x' -&gt; Block n e' x'
</span><a href="#local-6989586621682873264"><span class="hs-identifier hs-var">f</span></a></span><span> </span><span class="annot"><span class="annottext">n e 'Open
n 'Open 'Open
</span><a href="#local-6989586621682873268"><span class="hs-identifier hs-var">n</span></a></span><span> </span><span class="annot"><span class="annottext">Block n e 'Open -&gt; Block n 'Open x -&gt; Block n e x
forall (n :: Extensibility -&gt; Extensibility -&gt; *)
       (e :: Extensibility) (x :: Extensibility).
Block n e 'Open -&gt; Block n 'Open x -&gt; Block n e x
</span><a href="GHC.Cmm.Dataflow.Block.html#blockAppend"><span class="hs-operator hs-var">`blockAppend`</span></a></span><span> </span><span class="annot"><span class="annottext">(forall (e' :: Extensibility) (x' :: Extensibility).
 n e' x' -&gt; Block n e' x')
-&gt; Block n 'Open x -&gt; Block n 'Open x
forall (n :: Extensibility -&gt; Extensibility -&gt; *)
       (e :: Extensibility) (x :: Extensibility).
(forall (e' :: Extensibility) (x' :: Extensibility).
 n e' x' -&gt; Block n e' x')
-&gt; Block n e x -&gt; Block n e x
</span><a href="GHC.Cmm.ThreadSanitizer.html#mapBlockList"><span class="hs-identifier hs-var">mapBlockList</span></a></span><span> </span><span class="annot"><span class="annottext">n e' x' -&gt; Block n e' x'
forall (e' :: Extensibility) (x' :: Extensibility).
n e' x' -&gt; Block n e' x'
</span><a href="#local-6989586621682873264"><span class="hs-identifier hs-var">f</span></a></span><span> </span><span class="annot"><span class="annottext">Block n 'Open x
Block n 'Open 'Open
</span><a href="#local-6989586621682873269"><span class="hs-identifier hs-var">a</span></a></span><span>
</span><span id="line-45"></span><span>
</span><span id="line-46"></span><span id="local-6989586621682873086"><span id="local-6989586621682873087"><span class="annot"><a href="GHC.Cmm.ThreadSanitizer.html#annotateBlock"><span class="hs-identifier hs-type">annotateBlock</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Cmm.ThreadSanitizer.html#Env"><span class="hs-identifier hs-type">Env</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Cmm.Dataflow.Block.html#Block"><span class="hs-identifier hs-type">Block</span></a></span><span> </span><span class="annot"><a href="GHC.Cmm.Node.html#CmmNode"><span class="hs-identifier hs-type">CmmNode</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682873086"><span class="hs-identifier hs-type">e</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682873087"><span class="hs-identifier hs-type">x</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Cmm.Dataflow.Block.html#Block"><span class="hs-identifier hs-type">Block</span></a></span><span> </span><span class="annot"><a href="GHC.Cmm.Node.html#CmmNode"><span class="hs-identifier hs-type">CmmNode</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682873086"><span class="hs-identifier hs-type">e</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682873087"><span class="hs-identifier hs-type">x</span></a></span></span></span><span>
</span><span id="line-47"></span><span id="annotateBlock"><span class="annot"><span class="annottext">annotateBlock :: forall (e :: Extensibility) (x :: Extensibility).
Env -&gt; Block CmmNode e x -&gt; Block CmmNode e x
</span><a href="GHC.Cmm.ThreadSanitizer.html#annotateBlock"><span class="hs-identifier hs-var hs-var">annotateBlock</span></a></span></span><span> </span><span id="local-6989586621682873270"><span class="annot"><span class="annottext">Env
</span><a href="#local-6989586621682873270"><span class="hs-identifier hs-var">env</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(forall (e' :: Extensibility) (x' :: Extensibility).
 CmmNode e' x' -&gt; Block CmmNode e' x')
-&gt; Block CmmNode e x -&gt; Block CmmNode e x
forall (n :: Extensibility -&gt; Extensibility -&gt; *)
       (e :: Extensibility) (x :: Extensibility).
(forall (e' :: Extensibility) (x' :: Extensibility).
 n e' x' -&gt; Block n e' x')
-&gt; Block n e x -&gt; Block n e x
</span><a href="GHC.Cmm.ThreadSanitizer.html#mapBlockList"><span class="hs-identifier hs-var">mapBlockList</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Env -&gt; CmmNode e' x' -&gt; Block CmmNode e' x'
forall (e :: Extensibility) (x :: Extensibility).
Env -&gt; CmmNode e x -&gt; Block CmmNode e x
</span><a href="GHC.Cmm.ThreadSanitizer.html#annotateNode"><span class="hs-identifier hs-var">annotateNode</span></a></span><span> </span><span class="annot"><span class="annottext">Env
</span><a href="#local-6989586621682873270"><span class="hs-identifier hs-var">env</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-48"></span><span>
</span><span id="line-49"></span><span id="local-6989586621682873119"><span id="local-6989586621682873120"><span class="annot"><a href="GHC.Cmm.ThreadSanitizer.html#annotateNode"><span class="hs-identifier hs-type">annotateNode</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Cmm.ThreadSanitizer.html#Env"><span class="hs-identifier hs-type">Env</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Cmm.Node.html#CmmNode"><span class="hs-identifier hs-type">CmmNode</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682873119"><span class="hs-identifier hs-type">e</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682873120"><span class="hs-identifier hs-type">x</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Cmm.Dataflow.Block.html#Block"><span class="hs-identifier hs-type">Block</span></a></span><span> </span><span class="annot"><a href="GHC.Cmm.Node.html#CmmNode"><span class="hs-identifier hs-type">CmmNode</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682873119"><span class="hs-identifier hs-type">e</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682873120"><span class="hs-identifier hs-type">x</span></a></span></span></span><span>
</span><span id="line-50"></span><span id="annotateNode"><span class="annot"><span class="annottext">annotateNode :: forall (e :: Extensibility) (x :: Extensibility).
Env -&gt; CmmNode e x -&gt; Block CmmNode e x
</span><a href="GHC.Cmm.ThreadSanitizer.html#annotateNode"><span class="hs-identifier hs-var hs-var">annotateNode</span></a></span></span><span> </span><span id="local-6989586621682873272"><span class="annot"><span class="annottext">Env
</span><a href="#local-6989586621682873272"><span class="hs-identifier hs-var">env</span></a></span></span><span> </span><span id="local-6989586621682873273"><span class="annot"><span class="annottext">CmmNode e x
</span><a href="#local-6989586621682873273"><span class="hs-identifier hs-var">node</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-51"></span><span>    </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">CmmNode e x
</span><a href="#local-6989586621682873273"><span class="hs-identifier hs-var">node</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-52"></span><span>      </span><span class="annot"><a href="GHC.Cmm.Node.html#CmmEntry"><span class="hs-identifier hs-type">CmmEntry</span></a></span><span class="hs-special">{</span><span class="hs-special">}</span><span>              </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">CmmNode C 'Open
-&gt; Block CmmNode 'Open 'Open -&gt; Block CmmNode C 'Open
forall (n :: Extensibility -&gt; Extensibility -&gt; *).
n C 'Open -&gt; Block n 'Open 'Open -&gt; Block n C 'Open
</span><a href="GHC.Cmm.Dataflow.Block.html#BlockCO"><span class="hs-identifier hs-var">BlockCO</span></a></span><span> </span><span class="annot"><span class="annottext">CmmNode e x
CmmNode C 'Open
</span><a href="#local-6989586621682873273"><span class="hs-identifier hs-var">node</span></a></span><span> </span><span class="annot"><span class="annottext">Block CmmNode 'Open 'Open
forall (n :: Extensibility -&gt; Extensibility -&gt; *).
Block n 'Open 'Open
</span><a href="GHC.Cmm.Dataflow.Block.html#BNil"><span class="hs-identifier hs-var">BNil</span></a></span><span>
</span><span id="line-53"></span><span>      </span><span class="annot"><a href="GHC.Cmm.Node.html#CmmComment"><span class="hs-identifier hs-type">CmmComment</span></a></span><span class="hs-special">{</span><span class="hs-special">}</span><span>            </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">CmmNode 'Open 'Open -&gt; Block CmmNode 'Open 'Open
forall (n :: Extensibility -&gt; Extensibility -&gt; *).
n 'Open 'Open -&gt; Block n 'Open 'Open
</span><a href="GHC.Cmm.Dataflow.Block.html#BMiddle"><span class="hs-identifier hs-var">BMiddle</span></a></span><span> </span><span class="annot"><span class="annottext">CmmNode e x
CmmNode 'Open 'Open
</span><a href="#local-6989586621682873273"><span class="hs-identifier hs-var">node</span></a></span><span>
</span><span id="line-54"></span><span>      </span><span class="annot"><a href="GHC.Cmm.Node.html#CmmTick"><span class="hs-identifier hs-type">CmmTick</span></a></span><span class="hs-special">{</span><span class="hs-special">}</span><span>               </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">CmmNode 'Open 'Open -&gt; Block CmmNode 'Open 'Open
forall (n :: Extensibility -&gt; Extensibility -&gt; *).
n 'Open 'Open -&gt; Block n 'Open 'Open
</span><a href="GHC.Cmm.Dataflow.Block.html#BMiddle"><span class="hs-identifier hs-var">BMiddle</span></a></span><span> </span><span class="annot"><span class="annottext">CmmNode e x
CmmNode 'Open 'Open
</span><a href="#local-6989586621682873273"><span class="hs-identifier hs-var">node</span></a></span><span>
</span><span id="line-55"></span><span>      </span><span class="annot"><a href="GHC.Cmm.Node.html#CmmUnwind"><span class="hs-identifier hs-type">CmmUnwind</span></a></span><span class="hs-special">{</span><span class="hs-special">}</span><span>             </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">CmmNode 'Open 'Open -&gt; Block CmmNode 'Open 'Open
forall (n :: Extensibility -&gt; Extensibility -&gt; *).
n 'Open 'Open -&gt; Block n 'Open 'Open
</span><a href="GHC.Cmm.Dataflow.Block.html#BMiddle"><span class="hs-identifier hs-var">BMiddle</span></a></span><span> </span><span class="annot"><span class="annottext">CmmNode e x
CmmNode 'Open 'Open
</span><a href="#local-6989586621682873273"><span class="hs-identifier hs-var">node</span></a></span><span>
</span><span id="line-56"></span><span>      </span><span class="annot"><a href="GHC.Cmm.Node.html#CmmAssign"><span class="hs-identifier hs-type">CmmAssign</span></a></span><span class="hs-special">{</span><span class="hs-special">}</span><span>             </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Env -&gt; CmmNode 'Open 'Open -&gt; Block CmmNode 'Open 'Open
</span><a href="GHC.Cmm.ThreadSanitizer.html#annotateNodeOO"><span class="hs-identifier hs-var">annotateNodeOO</span></a></span><span> </span><span class="annot"><span class="annottext">Env
</span><a href="#local-6989586621682873272"><span class="hs-identifier hs-var">env</span></a></span><span> </span><span class="annot"><span class="annottext">CmmNode e x
CmmNode 'Open 'Open
</span><a href="#local-6989586621682873273"><span class="hs-identifier hs-var">node</span></a></span><span>
</span><span id="line-57"></span><span>      </span><span class="hs-comment">-- TODO: Track unaligned stores</span><span>
</span><span id="line-58"></span><span>      </span><span class="annot"><a href="GHC.Cmm.Node.html#CmmStore"><span class="hs-identifier hs-type">CmmStore</span></a></span><span> </span><span class="annot"><span class="annottext">CmmExpr
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">CmmExpr
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">AlignmentSpec
</span><a href="GHC.Cmm.Expr.html#Unaligned"><span class="hs-identifier hs-var">Unaligned</span></a></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Env -&gt; CmmNode 'Open 'Open -&gt; Block CmmNode 'Open 'Open
</span><a href="GHC.Cmm.ThreadSanitizer.html#annotateNodeOO"><span class="hs-identifier hs-var">annotateNodeOO</span></a></span><span> </span><span class="annot"><span class="annottext">Env
</span><a href="#local-6989586621682873272"><span class="hs-identifier hs-var">env</span></a></span><span> </span><span class="annot"><span class="annottext">CmmNode e x
CmmNode 'Open 'Open
</span><a href="#local-6989586621682873273"><span class="hs-identifier hs-var">node</span></a></span><span>
</span><span id="line-59"></span><span>      </span><span class="annot"><a href="GHC.Cmm.Node.html#CmmStore"><span class="hs-identifier hs-type">CmmStore</span></a></span><span> </span><span id="local-6989586621682873296"><span class="annot"><span class="annottext">CmmExpr
</span><a href="#local-6989586621682873296"><span class="hs-identifier hs-var">lhs</span></a></span></span><span> </span><span id="local-6989586621682873297"><span class="annot"><span class="annottext">CmmExpr
</span><a href="#local-6989586621682873297"><span class="hs-identifier hs-var">rhs</span></a></span></span><span> </span><span class="annot"><span class="annottext">AlignmentSpec
</span><a href="GHC.Cmm.Expr.html#NaturallyAligned"><span class="hs-identifier hs-var">NaturallyAligned</span></a></span><span>  </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-60"></span><span>          </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621682873299"><span class="annot"><span class="annottext">ty :: CmmType
</span><a href="#local-6989586621682873299"><span class="hs-identifier hs-var hs-var">ty</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Platform -&gt; CmmExpr -&gt; CmmType
</span><a href="GHC.Cmm.Expr.html#cmmExprType"><span class="hs-identifier hs-var">cmmExprType</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Env -&gt; Platform
</span><a href="GHC.Cmm.ThreadSanitizer.html#platform"><span class="hs-identifier hs-var">platform</span></a></span><span> </span><span class="annot"><span class="annottext">Env
</span><a href="#local-6989586621682873272"><span class="hs-identifier hs-var">env</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">CmmExpr
</span><a href="#local-6989586621682873297"><span class="hs-identifier hs-var">rhs</span></a></span><span>
</span><span id="line-61"></span><span>              </span><span id="local-6989586621682873301"><span class="annot"><span class="annottext">rhs_nodes :: Block CmmNode 'Open 'Open
</span><a href="#local-6989586621682873301"><span class="hs-identifier hs-var hs-var">rhs_nodes</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Env -&gt; [Load] -&gt; Block CmmNode 'Open 'Open
</span><a href="GHC.Cmm.ThreadSanitizer.html#annotateLoads"><span class="hs-identifier hs-var">annotateLoads</span></a></span><span> </span><span class="annot"><span class="annottext">Env
</span><a href="#local-6989586621682873272"><span class="hs-identifier hs-var">env</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">CmmExpr -&gt; [Load]
</span><a href="GHC.Cmm.ThreadSanitizer.html#collectExprLoads"><span class="hs-identifier hs-var">collectExprLoads</span></a></span><span> </span><span class="annot"><span class="annottext">CmmExpr
</span><a href="#local-6989586621682873297"><span class="hs-identifier hs-var">rhs</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-62"></span><span>              </span><span id="local-6989586621682873304"><span class="annot"><span class="annottext">lhs_nodes :: Block CmmNode 'Open 'Open
</span><a href="#local-6989586621682873304"><span class="hs-identifier hs-var hs-var">lhs_nodes</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Env -&gt; [Load] -&gt; Block CmmNode 'Open 'Open
</span><a href="GHC.Cmm.ThreadSanitizer.html#annotateLoads"><span class="hs-identifier hs-var">annotateLoads</span></a></span><span> </span><span class="annot"><span class="annottext">Env
</span><a href="#local-6989586621682873272"><span class="hs-identifier hs-var">env</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">CmmExpr -&gt; [Load]
</span><a href="GHC.Cmm.ThreadSanitizer.html#collectExprLoads"><span class="hs-identifier hs-var">collectExprLoads</span></a></span><span> </span><span class="annot"><span class="annottext">CmmExpr
</span><a href="#local-6989586621682873296"><span class="hs-identifier hs-var">lhs</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-63"></span><span>              </span><span id="local-6989586621682873305"><span class="annot"><span class="annottext">st :: Block CmmNode 'Open 'Open
</span><a href="#local-6989586621682873305"><span class="hs-identifier hs-var hs-var">st</span></a></span></span><span>        </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Env -&gt; CmmType -&gt; CmmExpr -&gt; Block CmmNode 'Open 'Open
</span><a href="GHC.Cmm.ThreadSanitizer.html#tsanStore"><span class="hs-identifier hs-var">tsanStore</span></a></span><span> </span><span class="annot"><span class="annottext">Env
</span><a href="#local-6989586621682873272"><span class="hs-identifier hs-var">env</span></a></span><span> </span><span class="annot"><span class="annottext">CmmType
</span><a href="#local-6989586621682873299"><span class="hs-identifier hs-var">ty</span></a></span><span> </span><span class="annot"><span class="annottext">CmmExpr
</span><a href="#local-6989586621682873296"><span class="hs-identifier hs-var">lhs</span></a></span><span>
</span><span id="line-64"></span><span>          </span><span class="hs-keyword">in</span><span> </span><span class="annot"><span class="annottext">Block CmmNode e 'Open
Block CmmNode 'Open 'Open
</span><a href="#local-6989586621682873301"><span class="hs-identifier hs-var">rhs_nodes</span></a></span><span> </span><span class="annot"><span class="annottext">Block CmmNode e 'Open
-&gt; Block CmmNode 'Open 'Open -&gt; Block CmmNode e 'Open
forall (n :: Extensibility -&gt; Extensibility -&gt; *)
       (e :: Extensibility) (x :: Extensibility).
Block n e 'Open -&gt; Block n 'Open x -&gt; Block n e x
</span><a href="GHC.Cmm.Dataflow.Block.html#blockAppend"><span class="hs-operator hs-var">`blockAppend`</span></a></span><span> </span><span class="annot"><span class="annottext">Block CmmNode 'Open 'Open
</span><a href="#local-6989586621682873304"><span class="hs-identifier hs-var">lhs_nodes</span></a></span><span> </span><span class="annot"><span class="annottext">Block CmmNode e 'Open
-&gt; Block CmmNode 'Open 'Open -&gt; Block CmmNode e 'Open
forall (n :: Extensibility -&gt; Extensibility -&gt; *)
       (e :: Extensibility) (x :: Extensibility).
Block n e 'Open -&gt; Block n 'Open x -&gt; Block n e x
</span><a href="GHC.Cmm.Dataflow.Block.html#blockAppend"><span class="hs-operator hs-var">`blockAppend`</span></a></span><span> </span><span class="annot"><span class="annottext">Block CmmNode 'Open 'Open
</span><a href="#local-6989586621682873305"><span class="hs-identifier hs-var">st</span></a></span><span> </span><span class="annot"><span class="annottext">Block CmmNode e 'Open
-&gt; CmmNode 'Open 'Open -&gt; Block CmmNode e 'Open
forall (n :: Extensibility -&gt; Extensibility -&gt; *)
       (e :: Extensibility).
Block n e 'Open -&gt; n 'Open 'Open -&gt; Block n e 'Open
</span><a href="GHC.Cmm.Dataflow.Block.html#blockSnoc"><span class="hs-operator hs-var">`blockSnoc`</span></a></span><span> </span><span class="annot"><span class="annottext">CmmNode e x
CmmNode 'Open 'Open
</span><a href="#local-6989586621682873273"><span class="hs-identifier hs-var">node</span></a></span><span>
</span><span id="line-65"></span><span>      </span><span class="annot"><a href="GHC.Cmm.Node.html#CmmUnsafeForeignCall"><span class="hs-identifier hs-type">CmmUnsafeForeignCall</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Cmm.Node.html#PrimTarget"><span class="hs-identifier hs-type">PrimTarget</span></a></span><span> </span><span id="local-6989586621682873312"><span class="annot"><span class="annottext">CallishMachOp
</span><a href="#local-6989586621682873312"><span class="hs-identifier hs-var">op</span></a></span></span><span class="hs-special">)</span><span> </span><span id="local-6989586621682873313"><span class="annot"><span class="annottext">[CmmFormal]
</span><a href="#local-6989586621682873313"><span class="hs-identifier hs-var">formals</span></a></span></span><span> </span><span id="local-6989586621682873314"><span class="annot"><span class="annottext">[CmmExpr]
</span><a href="#local-6989586621682873314"><span class="hs-identifier hs-var">args</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-66"></span><span>          </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621682873315"><span class="annot"><span class="annottext">node' :: Block CmmNode 'Open 'Open
</span><a href="#local-6989586621682873315"><span class="hs-identifier hs-var hs-var">node'</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Block CmmNode 'Open 'Open
-&gt; Maybe (Block CmmNode 'Open 'Open) -&gt; Block CmmNode 'Open 'Open
forall a. a -&gt; Maybe a -&gt; a
</span><span class="hs-identifier hs-var">fromMaybe</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">CmmNode 'Open 'Open -&gt; Block CmmNode 'Open 'Open
forall (n :: Extensibility -&gt; Extensibility -&gt; *).
n 'Open 'Open -&gt; Block n 'Open 'Open
</span><a href="GHC.Cmm.Dataflow.Block.html#BMiddle"><span class="hs-identifier hs-var">BMiddle</span></a></span><span> </span><span class="annot"><span class="annottext">CmmNode e x
CmmNode 'Open 'Open
</span><a href="#local-6989586621682873273"><span class="hs-identifier hs-var">node</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Env
-&gt; CallishMachOp
-&gt; [CmmFormal]
-&gt; [CmmExpr]
-&gt; Maybe (Block CmmNode 'Open 'Open)
</span><a href="GHC.Cmm.ThreadSanitizer.html#annotatePrim"><span class="hs-identifier hs-var">annotatePrim</span></a></span><span> </span><span class="annot"><span class="annottext">Env
</span><a href="#local-6989586621682873272"><span class="hs-identifier hs-var">env</span></a></span><span> </span><span class="annot"><span class="annottext">CallishMachOp
</span><a href="#local-6989586621682873312"><span class="hs-identifier hs-var">op</span></a></span><span> </span><span class="annot"><span class="annottext">[CmmFormal]
</span><a href="#local-6989586621682873313"><span class="hs-identifier hs-var">formals</span></a></span><span> </span><span class="annot"><span class="annottext">[CmmExpr]
</span><a href="#local-6989586621682873314"><span class="hs-identifier hs-var">args</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-67"></span><span>              </span><span id="local-6989586621682873317"><span class="annot"><span class="annottext">arg_nodes :: Block CmmNode 'Open 'Open
</span><a href="#local-6989586621682873317"><span class="hs-identifier hs-var hs-var">arg_nodes</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[Block CmmNode 'Open 'Open] -&gt; Block CmmNode 'Open 'Open
forall (n :: Extensibility -&gt; Extensibility -&gt; *).
[Block n 'Open 'Open] -&gt; Block n 'Open 'Open
</span><a href="GHC.Cmm.Dataflow.Block.html#blockConcat"><span class="hs-identifier hs-var">blockConcat</span></a></span><span> </span><span class="annot"><span class="annottext">([Block CmmNode 'Open 'Open] -&gt; Block CmmNode 'Open 'Open)
-&gt; [Block CmmNode 'Open 'Open] -&gt; Block CmmNode 'Open 'Open
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">(CmmExpr -&gt; Block CmmNode 'Open 'Open)
-&gt; [CmmExpr] -&gt; [Block CmmNode 'Open 'Open]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><span class="hs-identifier hs-var">map</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Env -&gt; CmmExpr -&gt; Block CmmNode 'Open 'Open
</span><a href="GHC.Cmm.ThreadSanitizer.html#annotateExpr"><span class="hs-identifier hs-var">annotateExpr</span></a></span><span> </span><span class="annot"><span class="annottext">Env
</span><a href="#local-6989586621682873272"><span class="hs-identifier hs-var">env</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[CmmExpr]
</span><a href="#local-6989586621682873314"><span class="hs-identifier hs-var">args</span></a></span><span>
</span><span id="line-68"></span><span>          </span><span class="hs-keyword">in</span><span> </span><span class="annot"><span class="annottext">Block CmmNode e 'Open
Block CmmNode 'Open 'Open
</span><a href="#local-6989586621682873317"><span class="hs-identifier hs-var">arg_nodes</span></a></span><span> </span><span class="annot"><span class="annottext">Block CmmNode e 'Open -&gt; Block CmmNode 'Open x -&gt; Block CmmNode e x
forall (n :: Extensibility -&gt; Extensibility -&gt; *)
       (e :: Extensibility) (x :: Extensibility).
Block n e 'Open -&gt; Block n 'Open x -&gt; Block n e x
</span><a href="GHC.Cmm.Dataflow.Block.html#blockAppend"><span class="hs-operator hs-var">`blockAppend`</span></a></span><span> </span><span class="annot"><span class="annottext">Block CmmNode 'Open x
Block CmmNode 'Open 'Open
</span><a href="#local-6989586621682873315"><span class="hs-identifier hs-var">node'</span></a></span><span>
</span><span id="line-69"></span><span>      </span><span class="annot"><a href="GHC.Cmm.Node.html#CmmUnsafeForeignCall"><span class="hs-identifier hs-type">CmmUnsafeForeignCall</span></a></span><span class="hs-special">{</span><span class="hs-special">}</span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Env -&gt; CmmNode 'Open 'Open -&gt; Block CmmNode 'Open 'Open
</span><a href="GHC.Cmm.ThreadSanitizer.html#annotateNodeOO"><span class="hs-identifier hs-var">annotateNodeOO</span></a></span><span> </span><span class="annot"><span class="annottext">Env
</span><a href="#local-6989586621682873272"><span class="hs-identifier hs-var">env</span></a></span><span> </span><span class="annot"><span class="annottext">CmmNode e x
CmmNode 'Open 'Open
</span><a href="#local-6989586621682873273"><span class="hs-identifier hs-var">node</span></a></span><span>
</span><span id="line-70"></span><span>      </span><span class="annot"><a href="GHC.Cmm.Node.html#CmmBranch"><span class="hs-identifier hs-type">CmmBranch</span></a></span><span class="hs-special">{</span><span class="hs-special">}</span><span>             </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Env -&gt; CmmNode 'Open C -&gt; Block CmmNode 'Open C
</span><a href="GHC.Cmm.ThreadSanitizer.html#annotateNodeOC"><span class="hs-identifier hs-var">annotateNodeOC</span></a></span><span> </span><span class="annot"><span class="annottext">Env
</span><a href="#local-6989586621682873272"><span class="hs-identifier hs-var">env</span></a></span><span> </span><span class="annot"><span class="annottext">CmmNode e x
CmmNode 'Open C
</span><a href="#local-6989586621682873273"><span class="hs-identifier hs-var">node</span></a></span><span>
</span><span id="line-71"></span><span>      </span><span class="annot"><a href="GHC.Cmm.Node.html#CmmCondBranch"><span class="hs-identifier hs-type">CmmCondBranch</span></a></span><span class="hs-special">{</span><span class="hs-special">}</span><span>         </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Env -&gt; CmmNode 'Open C -&gt; Block CmmNode 'Open C
</span><a href="GHC.Cmm.ThreadSanitizer.html#annotateNodeOC"><span class="hs-identifier hs-var">annotateNodeOC</span></a></span><span> </span><span class="annot"><span class="annottext">Env
</span><a href="#local-6989586621682873272"><span class="hs-identifier hs-var">env</span></a></span><span> </span><span class="annot"><span class="annottext">CmmNode e x
CmmNode 'Open C
</span><a href="#local-6989586621682873273"><span class="hs-identifier hs-var">node</span></a></span><span>
</span><span id="line-72"></span><span>      </span><span class="annot"><a href="GHC.Cmm.Node.html#CmmSwitch"><span class="hs-identifier hs-type">CmmSwitch</span></a></span><span class="hs-special">{</span><span class="hs-special">}</span><span>             </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Env -&gt; CmmNode 'Open C -&gt; Block CmmNode 'Open C
</span><a href="GHC.Cmm.ThreadSanitizer.html#annotateNodeOC"><span class="hs-identifier hs-var">annotateNodeOC</span></a></span><span> </span><span class="annot"><span class="annottext">Env
</span><a href="#local-6989586621682873272"><span class="hs-identifier hs-var">env</span></a></span><span> </span><span class="annot"><span class="annottext">CmmNode e x
CmmNode 'Open C
</span><a href="#local-6989586621682873273"><span class="hs-identifier hs-var">node</span></a></span><span>
</span><span id="line-73"></span><span>      </span><span class="annot"><a href="GHC.Cmm.Node.html#CmmCall"><span class="hs-identifier hs-type">CmmCall</span></a></span><span class="hs-special">{</span><span class="hs-special">}</span><span>               </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Env -&gt; CmmNode 'Open C -&gt; Block CmmNode 'Open C
</span><a href="GHC.Cmm.ThreadSanitizer.html#annotateNodeOC"><span class="hs-identifier hs-var">annotateNodeOC</span></a></span><span> </span><span class="annot"><span class="annottext">Env
</span><a href="#local-6989586621682873272"><span class="hs-identifier hs-var">env</span></a></span><span> </span><span class="annot"><span class="annottext">CmmNode e x
CmmNode 'Open C
</span><a href="#local-6989586621682873273"><span class="hs-identifier hs-var">node</span></a></span><span>
</span><span id="line-74"></span><span>      </span><span class="annot"><a href="GHC.Cmm.Node.html#CmmForeignCall"><span class="hs-identifier hs-type">CmmForeignCall</span></a></span><span class="hs-special">{</span><span class="hs-special">}</span><span>        </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Env -&gt; CmmNode 'Open C -&gt; Block CmmNode 'Open C
</span><a href="GHC.Cmm.ThreadSanitizer.html#annotateNodeOC"><span class="hs-identifier hs-var">annotateNodeOC</span></a></span><span> </span><span class="annot"><span class="annottext">Env
</span><a href="#local-6989586621682873272"><span class="hs-identifier hs-var">env</span></a></span><span> </span><span class="annot"><span class="annottext">CmmNode e x
CmmNode 'Open C
</span><a href="#local-6989586621682873273"><span class="hs-identifier hs-var">node</span></a></span><span>
</span><span id="line-75"></span><span>
</span><span id="line-76"></span><span class="annot"><a href="GHC.Cmm.ThreadSanitizer.html#annotateNodeOO"><span class="hs-identifier hs-type">annotateNodeOO</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Cmm.ThreadSanitizer.html#Env"><span class="hs-identifier hs-type">Env</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Cmm.Node.html#CmmNode"><span class="hs-identifier hs-type">CmmNode</span></a></span><span> </span><span class="annot"><a href="GHC.Cmm.Dataflow.Block.html#O"><span class="hs-identifier hs-type">O</span></a></span><span> </span><span class="annot"><a href="GHC.Cmm.Dataflow.Block.html#O"><span class="hs-identifier hs-type">O</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Cmm.Dataflow.Block.html#Block"><span class="hs-identifier hs-type">Block</span></a></span><span> </span><span class="annot"><a href="GHC.Cmm.Node.html#CmmNode"><span class="hs-identifier hs-type">CmmNode</span></a></span><span> </span><span class="annot"><a href="GHC.Cmm.Dataflow.Block.html#O"><span class="hs-identifier hs-type">O</span></a></span><span> </span><span class="annot"><a href="GHC.Cmm.Dataflow.Block.html#O"><span class="hs-identifier hs-type">O</span></a></span><span>
</span><span id="line-77"></span><span id="annotateNodeOO"><span class="annot"><span class="annottext">annotateNodeOO :: Env -&gt; CmmNode 'Open 'Open -&gt; Block CmmNode 'Open 'Open
</span><a href="GHC.Cmm.ThreadSanitizer.html#annotateNodeOO"><span class="hs-identifier hs-var hs-var">annotateNodeOO</span></a></span></span><span> </span><span id="local-6989586621682873339"><span class="annot"><span class="annottext">Env
</span><a href="#local-6989586621682873339"><span class="hs-identifier hs-var">env</span></a></span></span><span> </span><span id="local-6989586621682873340"><span class="annot"><span class="annottext">CmmNode 'Open 'Open
</span><a href="#local-6989586621682873340"><span class="hs-identifier hs-var">node</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-78"></span><span>    </span><span class="annot"><span class="annottext">Env -&gt; [Load] -&gt; Block CmmNode 'Open 'Open
</span><a href="GHC.Cmm.ThreadSanitizer.html#annotateLoads"><span class="hs-identifier hs-var">annotateLoads</span></a></span><span> </span><span class="annot"><span class="annottext">Env
</span><a href="#local-6989586621682873339"><span class="hs-identifier hs-var">env</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">CmmNode 'Open 'Open -&gt; [Load]
forall (e :: Extensibility) (x :: Extensibility).
CmmNode e x -&gt; [Load]
</span><a href="GHC.Cmm.ThreadSanitizer.html#collectLoadsNode"><span class="hs-identifier hs-var">collectLoadsNode</span></a></span><span> </span><span class="annot"><span class="annottext">CmmNode 'Open 'Open
</span><a href="#local-6989586621682873340"><span class="hs-identifier hs-var">node</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Block CmmNode 'Open 'Open
-&gt; CmmNode 'Open 'Open -&gt; Block CmmNode 'Open 'Open
forall (n :: Extensibility -&gt; Extensibility -&gt; *)
       (e :: Extensibility).
Block n e 'Open -&gt; n 'Open 'Open -&gt; Block n e 'Open
</span><a href="GHC.Cmm.Dataflow.Block.html#blockSnoc"><span class="hs-operator hs-var">`blockSnoc`</span></a></span><span> </span><span class="annot"><span class="annottext">CmmNode 'Open 'Open
</span><a href="#local-6989586621682873340"><span class="hs-identifier hs-var">node</span></a></span><span>
</span><span id="line-79"></span><span>
</span><span id="line-80"></span><span class="annot"><a href="GHC.Cmm.ThreadSanitizer.html#annotateNodeOC"><span class="hs-identifier hs-type">annotateNodeOC</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Cmm.ThreadSanitizer.html#Env"><span class="hs-identifier hs-type">Env</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Cmm.Node.html#CmmNode"><span class="hs-identifier hs-type">CmmNode</span></a></span><span> </span><span class="annot"><a href="GHC.Cmm.Dataflow.Block.html#O"><span class="hs-identifier hs-type">O</span></a></span><span> </span><span class="annot"><a href="GHC.Cmm.Dataflow.Block.html#C"><span class="hs-identifier hs-type">C</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Cmm.Dataflow.Block.html#Block"><span class="hs-identifier hs-type">Block</span></a></span><span> </span><span class="annot"><a href="GHC.Cmm.Node.html#CmmNode"><span class="hs-identifier hs-type">CmmNode</span></a></span><span> </span><span class="annot"><a href="GHC.Cmm.Dataflow.Block.html#O"><span class="hs-identifier hs-type">O</span></a></span><span> </span><span class="annot"><a href="GHC.Cmm.Dataflow.Block.html#C"><span class="hs-identifier hs-type">C</span></a></span><span>
</span><span id="line-81"></span><span id="annotateNodeOC"><span class="annot"><span class="annottext">annotateNodeOC :: Env -&gt; CmmNode 'Open C -&gt; Block CmmNode 'Open C
</span><a href="GHC.Cmm.ThreadSanitizer.html#annotateNodeOC"><span class="hs-identifier hs-var hs-var">annotateNodeOC</span></a></span></span><span> </span><span id="local-6989586621682873342"><span class="annot"><span class="annottext">Env
</span><a href="#local-6989586621682873342"><span class="hs-identifier hs-var">env</span></a></span></span><span> </span><span id="local-6989586621682873343"><span class="annot"><span class="annottext">CmmNode 'Open C
</span><a href="#local-6989586621682873343"><span class="hs-identifier hs-var">node</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-82"></span><span>    </span><span class="annot"><span class="annottext">Env -&gt; [Load] -&gt; Block CmmNode 'Open 'Open
</span><a href="GHC.Cmm.ThreadSanitizer.html#annotateLoads"><span class="hs-identifier hs-var">annotateLoads</span></a></span><span> </span><span class="annot"><span class="annottext">Env
</span><a href="#local-6989586621682873342"><span class="hs-identifier hs-var">env</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">CmmNode 'Open C -&gt; [Load]
forall (e :: Extensibility) (x :: Extensibility).
CmmNode e x -&gt; [Load]
</span><a href="GHC.Cmm.ThreadSanitizer.html#collectLoadsNode"><span class="hs-identifier hs-var">collectLoadsNode</span></a></span><span> </span><span class="annot"><span class="annottext">CmmNode 'Open C
</span><a href="#local-6989586621682873343"><span class="hs-identifier hs-var">node</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Block CmmNode 'Open 'Open
-&gt; CmmNode 'Open C -&gt; Block CmmNode 'Open C
forall (n :: Extensibility -&gt; Extensibility -&gt; *)
       (e :: Extensibility).
Block n e 'Open -&gt; n 'Open C -&gt; Block n e C
</span><a href="GHC.Cmm.Dataflow.Block.html#blockJoinTail"><span class="hs-operator hs-var">`blockJoinTail`</span></a></span><span> </span><span class="annot"><span class="annottext">CmmNode 'Open C
</span><a href="#local-6989586621682873343"><span class="hs-identifier hs-var">node</span></a></span><span>
</span><span id="line-83"></span><span>
</span><span id="line-84"></span><span class="annot"><a href="GHC.Cmm.ThreadSanitizer.html#annotateExpr"><span class="hs-identifier hs-type">annotateExpr</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Cmm.ThreadSanitizer.html#Env"><span class="hs-identifier hs-type">Env</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Cmm.Expr.html#CmmExpr"><span class="hs-identifier hs-type">CmmExpr</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Cmm.Dataflow.Block.html#Block"><span class="hs-identifier hs-type">Block</span></a></span><span> </span><span class="annot"><a href="GHC.Cmm.Node.html#CmmNode"><span class="hs-identifier hs-type">CmmNode</span></a></span><span> </span><span class="annot"><a href="GHC.Cmm.Dataflow.Block.html#O"><span class="hs-identifier hs-type">O</span></a></span><span> </span><span class="annot"><a href="GHC.Cmm.Dataflow.Block.html#O"><span class="hs-identifier hs-type">O</span></a></span><span>
</span><span id="line-85"></span><span id="annotateExpr"><span class="annot"><span class="annottext">annotateExpr :: Env -&gt; CmmExpr -&gt; Block CmmNode 'Open 'Open
</span><a href="GHC.Cmm.ThreadSanitizer.html#annotateExpr"><span class="hs-identifier hs-var hs-var">annotateExpr</span></a></span></span><span> </span><span id="local-6989586621682873345"><span class="annot"><span class="annottext">Env
</span><a href="#local-6989586621682873345"><span class="hs-identifier hs-var">env</span></a></span></span><span> </span><span id="local-6989586621682873346"><span class="annot"><span class="annottext">CmmExpr
</span><a href="#local-6989586621682873346"><span class="hs-identifier hs-var">expr</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-86"></span><span>    </span><span class="annot"><span class="annottext">Env -&gt; [Load] -&gt; Block CmmNode 'Open 'Open
</span><a href="GHC.Cmm.ThreadSanitizer.html#annotateLoads"><span class="hs-identifier hs-var">annotateLoads</span></a></span><span> </span><span class="annot"><span class="annottext">Env
</span><a href="#local-6989586621682873345"><span class="hs-identifier hs-var">env</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">CmmExpr -&gt; [Load]
</span><a href="GHC.Cmm.ThreadSanitizer.html#collectExprLoads"><span class="hs-identifier hs-var">collectExprLoads</span></a></span><span> </span><span class="annot"><span class="annottext">CmmExpr
</span><a href="#local-6989586621682873346"><span class="hs-identifier hs-var">expr</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-87"></span><span>
</span><span id="line-88"></span><span class="annot"><span class="hs-comment">-- | A load mentioned in a 'CmmExpr'.</span></span><span>
</span><span id="line-89"></span><span class="hs-keyword">data</span><span> </span><span id="Load"><span class="annot"><a href="GHC.Cmm.ThreadSanitizer.html#Load"><span class="hs-identifier hs-var">Load</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="Load"><span class="annot"><a href="GHC.Cmm.ThreadSanitizer.html#Load"><span class="hs-identifier hs-var">Load</span></a></span></span><span> </span><span class="annot"><a href="GHC.Cmm.Type.html#CmmType"><span class="hs-identifier hs-type">CmmType</span></a></span><span> </span><span class="annot"><a href="GHC.Cmm.Expr.html#AlignmentSpec"><span class="hs-identifier hs-type">AlignmentSpec</span></a></span><span> </span><span class="annot"><a href="GHC.Cmm.Expr.html#CmmExpr"><span class="hs-identifier hs-type">CmmExpr</span></a></span><span>
</span><span id="line-90"></span><span>
</span><span id="line-91"></span><span class="annot"><a href="GHC.Cmm.ThreadSanitizer.html#annotateLoads"><span class="hs-identifier hs-type">annotateLoads</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Cmm.ThreadSanitizer.html#Env"><span class="hs-identifier hs-type">Env</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="GHC.Cmm.ThreadSanitizer.html#Load"><span class="hs-identifier hs-type">Load</span></a></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Cmm.Dataflow.Block.html#Block"><span class="hs-identifier hs-type">Block</span></a></span><span> </span><span class="annot"><a href="GHC.Cmm.Node.html#CmmNode"><span class="hs-identifier hs-type">CmmNode</span></a></span><span> </span><span class="annot"><a href="GHC.Cmm.Dataflow.Block.html#O"><span class="hs-identifier hs-type">O</span></a></span><span> </span><span class="annot"><a href="GHC.Cmm.Dataflow.Block.html#O"><span class="hs-identifier hs-type">O</span></a></span><span>
</span><span id="line-92"></span><span id="annotateLoads"><span class="annot"><span class="annottext">annotateLoads :: Env -&gt; [Load] -&gt; Block CmmNode 'Open 'Open
</span><a href="GHC.Cmm.ThreadSanitizer.html#annotateLoads"><span class="hs-identifier hs-var hs-var">annotateLoads</span></a></span></span><span> </span><span id="local-6989586621682873348"><span class="annot"><span class="annottext">Env
</span><a href="#local-6989586621682873348"><span class="hs-identifier hs-var">env</span></a></span></span><span> </span><span id="local-6989586621682873349"><span class="annot"><span class="annottext">[Load]
</span><a href="#local-6989586621682873349"><span class="hs-identifier hs-var">loads</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-93"></span><span>    </span><span class="annot"><span class="annottext">[Block CmmNode 'Open 'Open] -&gt; Block CmmNode 'Open 'Open
forall (n :: Extensibility -&gt; Extensibility -&gt; *).
[Block n 'Open 'Open] -&gt; Block n 'Open 'Open
</span><a href="GHC.Cmm.Dataflow.Block.html#blockConcat"><span class="hs-identifier hs-var">blockConcat</span></a></span><span>
</span><span id="line-94"></span><span>    </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">Env
-&gt; AlignmentSpec -&gt; CmmType -&gt; CmmExpr -&gt; Block CmmNode 'Open 'Open
</span><a href="GHC.Cmm.ThreadSanitizer.html#tsanLoad"><span class="hs-identifier hs-var">tsanLoad</span></a></span><span> </span><span class="annot"><span class="annottext">Env
</span><a href="#local-6989586621682873348"><span class="hs-identifier hs-var">env</span></a></span><span> </span><span class="annot"><span class="annottext">AlignmentSpec
</span><a href="#local-6989586621682873351"><span class="hs-identifier hs-var">align</span></a></span><span> </span><span class="annot"><span class="annottext">CmmType
</span><a href="#local-6989586621682873352"><span class="hs-identifier hs-var">ty</span></a></span><span> </span><span class="annot"><span class="annottext">CmmExpr
</span><a href="#local-6989586621682873353"><span class="hs-identifier hs-var">addr</span></a></span><span>
</span><span id="line-95"></span><span>    </span><span class="hs-glyph">|</span><span> </span><span class="annot"><a href="GHC.Cmm.ThreadSanitizer.html#Load"><span class="hs-identifier hs-type">Load</span></a></span><span> </span><span id="local-6989586621682873352"><span class="annot"><span class="annottext">CmmType
</span><a href="#local-6989586621682873352"><span class="hs-identifier hs-var">ty</span></a></span></span><span> </span><span id="local-6989586621682873351"><span class="annot"><span class="annottext">AlignmentSpec
</span><a href="#local-6989586621682873351"><span class="hs-identifier hs-var">align</span></a></span></span><span> </span><span id="local-6989586621682873353"><span class="annot"><span class="annottext">CmmExpr
</span><a href="#local-6989586621682873353"><span class="hs-identifier hs-var">addr</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">[Load]
</span><a href="#local-6989586621682873349"><span class="hs-identifier hs-var">loads</span></a></span><span>
</span><span id="line-96"></span><span>    </span><span class="hs-special">]</span><span>
</span><span id="line-97"></span><span>
</span><span id="line-98"></span><span id="local-6989586621682873135"><span id="local-6989586621682873136"><span class="annot"><a href="GHC.Cmm.ThreadSanitizer.html#collectLoadsNode"><span class="hs-identifier hs-type">collectLoadsNode</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Cmm.Node.html#CmmNode"><span class="hs-identifier hs-type">CmmNode</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682873135"><span class="hs-identifier hs-type">e</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682873136"><span class="hs-identifier hs-type">x</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="GHC.Cmm.ThreadSanitizer.html#Load"><span class="hs-identifier hs-type">Load</span></a></span><span class="hs-special">]</span></span></span><span>
</span><span id="line-99"></span><span id="collectLoadsNode"><span class="annot"><span class="annottext">collectLoadsNode :: forall (e :: Extensibility) (x :: Extensibility).
CmmNode e x -&gt; [Load]
</span><a href="GHC.Cmm.ThreadSanitizer.html#collectLoadsNode"><span class="hs-identifier hs-var hs-var">collectLoadsNode</span></a></span></span><span> </span><span id="local-6989586621682873354"><span class="annot"><span class="annottext">CmmNode e x
</span><a href="#local-6989586621682873354"><span class="hs-identifier hs-var">node</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-100"></span><span>    </span><span class="annot"><span class="annottext">(CmmExpr -&gt; [Load] -&gt; [Load]) -&gt; CmmNode e x -&gt; [Load] -&gt; [Load]
forall z (e :: Extensibility) (x :: Extensibility).
(CmmExpr -&gt; z -&gt; z) -&gt; CmmNode e x -&gt; z -&gt; z
</span><a href="GHC.Cmm.Node.html#foldExp"><span class="hs-identifier hs-var">foldExp</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span id="local-6989586621682873356"><span class="annot"><span class="annottext">CmmExpr
</span><a href="#local-6989586621682873356"><span class="hs-identifier hs-var">exp</span></a></span></span><span> </span><span id="local-6989586621682873357"><span class="annot"><span class="annottext">[Load]
</span><a href="#local-6989586621682873357"><span class="hs-identifier hs-var">rest</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">CmmExpr -&gt; [Load]
</span><a href="GHC.Cmm.ThreadSanitizer.html#collectExprLoads"><span class="hs-identifier hs-var">collectExprLoads</span></a></span><span> </span><span class="annot"><span class="annottext">CmmExpr
</span><a href="#local-6989586621682873356"><span class="hs-identifier hs-var">exp</span></a></span><span> </span><span class="annot"><span class="annottext">[Load] -&gt; [Load] -&gt; [Load]
forall a. [a] -&gt; [a] -&gt; [a]
</span><span class="hs-operator hs-var">++</span></span><span> </span><span class="annot"><span class="annottext">[Load]
</span><a href="#local-6989586621682873357"><span class="hs-identifier hs-var">rest</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">CmmNode e x
</span><a href="#local-6989586621682873354"><span class="hs-identifier hs-var">node</span></a></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span>
</span><span id="line-101"></span><span>
</span><span id="line-102"></span><span class="annot"><span class="hs-comment">-- | Collect all of the memory locations loaded from by a 'CmmExpr'.</span></span><span>
</span><span id="line-103"></span><span class="annot"><a href="GHC.Cmm.ThreadSanitizer.html#collectExprLoads"><span class="hs-identifier hs-type">collectExprLoads</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Cmm.Expr.html#CmmExpr"><span class="hs-identifier hs-type">CmmExpr</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="GHC.Cmm.ThreadSanitizer.html#Load"><span class="hs-identifier hs-type">Load</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-104"></span><span id="collectExprLoads"><span class="annot"><span class="annottext">collectExprLoads :: CmmExpr -&gt; [Load]
</span><a href="GHC.Cmm.ThreadSanitizer.html#collectExprLoads"><span class="hs-identifier hs-var hs-var">collectExprLoads</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Cmm.Expr.html#CmmLit"><span class="hs-identifier hs-type">CmmLit</span></a></span><span> </span><span class="annot"><span class="annottext">CmmLit
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span>           </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span>
</span><span id="line-105"></span><span class="annot"><a href="GHC.Cmm.ThreadSanitizer.html#collectExprLoads"><span class="hs-identifier hs-var">collectExprLoads</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Cmm.Expr.html#CmmLoad"><span class="hs-identifier hs-type">CmmLoad</span></a></span><span> </span><span id="local-6989586621682873360"><span class="annot"><span class="annottext">CmmExpr
</span><a href="#local-6989586621682873360"><span class="hs-identifier hs-var">e</span></a></span></span><span> </span><span id="local-6989586621682873361"><span class="annot"><span class="annottext">CmmType
</span><a href="#local-6989586621682873361"><span class="hs-identifier hs-var">ty</span></a></span></span><span> </span><span id="local-6989586621682873362"><span class="annot"><span class="annottext">AlignmentSpec
</span><a href="#local-6989586621682873362"><span class="hs-identifier hs-var">align</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">CmmType -&gt; AlignmentSpec -&gt; CmmExpr -&gt; Load
</span><a href="GHC.Cmm.ThreadSanitizer.html#Load"><span class="hs-identifier hs-var">Load</span></a></span><span> </span><span class="annot"><span class="annottext">CmmType
</span><a href="#local-6989586621682873361"><span class="hs-identifier hs-var">ty</span></a></span><span> </span><span class="annot"><span class="annottext">AlignmentSpec
</span><a href="#local-6989586621682873362"><span class="hs-identifier hs-var">align</span></a></span><span> </span><span class="annot"><span class="annottext">CmmExpr
</span><a href="#local-6989586621682873360"><span class="hs-identifier hs-var">e</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-106"></span><span class="annot"><a href="GHC.Cmm.ThreadSanitizer.html#collectExprLoads"><span class="hs-identifier hs-var">collectExprLoads</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Cmm.Expr.html#CmmReg"><span class="hs-identifier hs-type">CmmReg</span></a></span><span> </span><span class="annot"><span class="annottext">CmmReg
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span>           </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span>
</span><span id="line-107"></span><span class="hs-comment">-- N.B. we don't bother telling TSAN about MO_RelaxedReads</span><span>
</span><span id="line-108"></span><span class="hs-comment">-- since doing so would be inconvenient and they by</span><span>
</span><span id="line-109"></span><span class="hs-comment">-- definition can neither race nor introduce ordering.</span><span>
</span><span id="line-110"></span><span class="annot"><a href="GHC.Cmm.ThreadSanitizer.html#collectExprLoads"><span class="hs-identifier hs-var">collectExprLoads</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Cmm.Expr.html#CmmMachOp"><span class="hs-identifier hs-type">CmmMachOp</span></a></span><span> </span><span id="local-6989586621682873365"><span class="annot"><span class="annottext">MachOp
</span><a href="#local-6989586621682873365"><span class="hs-identifier hs-var">_op</span></a></span></span><span> </span><span id="local-6989586621682873366"><span class="annot"><span class="annottext">[CmmExpr]
</span><a href="#local-6989586621682873366"><span class="hs-identifier hs-var">args</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(CmmExpr -&gt; [Load]) -&gt; [CmmExpr] -&gt; [Load]
forall m a. Monoid m =&gt; (a -&gt; m) -&gt; [a] -&gt; m
forall (t :: * -&gt; *) m a.
(Foldable t, Monoid m) =&gt;
(a -&gt; m) -&gt; t a -&gt; m
</span><span class="hs-identifier hs-var">foldMap</span></span><span> </span><span class="annot"><span class="annottext">CmmExpr -&gt; [Load]
</span><a href="GHC.Cmm.ThreadSanitizer.html#collectExprLoads"><span class="hs-identifier hs-var">collectExprLoads</span></a></span><span> </span><span class="annot"><span class="annottext">[CmmExpr]
</span><a href="#local-6989586621682873366"><span class="hs-identifier hs-var">args</span></a></span><span>
</span><span id="line-111"></span><span class="annot"><a href="GHC.Cmm.ThreadSanitizer.html#collectExprLoads"><span class="hs-identifier hs-var">collectExprLoads</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Cmm.Expr.html#CmmStackSlot"><span class="hs-identifier hs-type">CmmStackSlot</span></a></span><span> </span><span class="annot"><span class="annottext">Area
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span>   </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span>
</span><span id="line-112"></span><span class="annot"><a href="GHC.Cmm.ThreadSanitizer.html#collectExprLoads"><span class="hs-identifier hs-var">collectExprLoads</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Cmm.Expr.html#CmmRegOff"><span class="hs-identifier hs-type">CmmRegOff</span></a></span><span> </span><span class="annot"><span class="annottext">CmmReg
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span>      </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span>
</span><span id="line-113"></span><span>
</span><span id="line-114"></span><span class="annot"><span class="hs-comment">-- | Generate TSAN instrumentation for a 'CallishMachOp' occurrence.</span></span><span>
</span><span id="line-115"></span><span class="annot"><a href="GHC.Cmm.ThreadSanitizer.html#annotatePrim"><span class="hs-identifier hs-type">annotatePrim</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Cmm.ThreadSanitizer.html#Env"><span class="hs-identifier hs-type">Env</span></a></span><span>
</span><span id="line-116"></span><span>             </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Cmm.MachOp.html#CallishMachOp"><span class="hs-identifier hs-type">CallishMachOp</span></a></span><span>   </span><span class="annot"><span class="hs-comment">-- ^ the applied operation</span></span><span>
</span><span id="line-117"></span><span>             </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="GHC.Cmm.Node.html#CmmFormal"><span class="hs-identifier hs-type">CmmFormal</span></a></span><span class="hs-special">]</span><span>     </span><span class="annot"><span class="hs-comment">-- ^ results</span></span><span>
</span><span id="line-118"></span><span>             </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="GHC.Cmm.Node.html#CmmActual"><span class="hs-identifier hs-type">CmmActual</span></a></span><span class="hs-special">]</span><span>     </span><span class="annot"><span class="hs-comment">-- ^ arguments</span></span><span>
</span><span id="line-119"></span><span>             </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Maybe</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Cmm.Dataflow.Block.html#Block"><span class="hs-identifier hs-type">Block</span></a></span><span> </span><span class="annot"><a href="GHC.Cmm.Node.html#CmmNode"><span class="hs-identifier hs-type">CmmNode</span></a></span><span> </span><span class="annot"><a href="GHC.Cmm.Dataflow.Block.html#O"><span class="hs-identifier hs-type">O</span></a></span><span> </span><span class="annot"><a href="GHC.Cmm.Dataflow.Block.html#O"><span class="hs-identifier hs-type">O</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-120"></span><span>                                </span><span class="annot"><span class="hs-comment">-- ^ 'Just' a block of instrumentation, if applicable</span></span><span>
</span><span id="line-121"></span><span id="annotatePrim"><span class="annot"><span class="annottext">annotatePrim :: Env
-&gt; CallishMachOp
-&gt; [CmmFormal]
-&gt; [CmmExpr]
-&gt; Maybe (Block CmmNode 'Open 'Open)
</span><a href="GHC.Cmm.ThreadSanitizer.html#annotatePrim"><span class="hs-identifier hs-var hs-var">annotatePrim</span></a></span></span><span> </span><span id="local-6989586621682873371"><span class="annot"><span class="annottext">Env
</span><a href="#local-6989586621682873371"><span class="hs-identifier hs-var">env</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Cmm.MachOp.html#MO_AtomicRMW"><span class="hs-identifier hs-type">MO_AtomicRMW</span></a></span><span> </span><span id="local-6989586621682873373"><span class="annot"><span class="annottext">Width
</span><a href="#local-6989586621682873373"><span class="hs-identifier hs-var">w</span></a></span></span><span> </span><span id="local-6989586621682873374"><span class="annot"><span class="annottext">AtomicMachOp
</span><a href="#local-6989586621682873374"><span class="hs-identifier hs-var">aop</span></a></span></span><span class="hs-special">)</span><span>    </span><span class="hs-special">[</span><span id="local-6989586621682873375"><span class="annot"><span class="annottext">CmmFormal
</span><a href="#local-6989586621682873375"><span class="hs-identifier hs-var">dest</span></a></span></span><span class="hs-special">]</span><span>   </span><span class="hs-special">[</span><span id="local-6989586621682873376"><span class="annot"><span class="annottext">CmmExpr
</span><a href="#local-6989586621682873376"><span class="hs-identifier hs-var">addr</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682873377"><span class="annot"><span class="annottext">CmmExpr
</span><a href="#local-6989586621682873377"><span class="hs-identifier hs-var">val</span></a></span></span><span class="hs-special">]</span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Block CmmNode 'Open 'Open -&gt; Maybe (Block CmmNode 'Open 'Open)
forall a. a -&gt; Maybe a
</span><span class="hs-identifier hs-var">Just</span></span><span> </span><span class="annot"><span class="annottext">(Block CmmNode 'Open 'Open -&gt; Maybe (Block CmmNode 'Open 'Open))
-&gt; Block CmmNode 'Open 'Open -&gt; Maybe (Block CmmNode 'Open 'Open)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Env
-&gt; MemoryOrdering
-&gt; AtomicMachOp
-&gt; Width
-&gt; CmmExpr
-&gt; CmmExpr
-&gt; CmmFormal
-&gt; Block CmmNode 'Open 'Open
</span><a href="GHC.Cmm.ThreadSanitizer.html#tsanAtomicRMW"><span class="hs-identifier hs-var">tsanAtomicRMW</span></a></span><span> </span><span class="annot"><span class="annottext">Env
</span><a href="#local-6989586621682873371"><span class="hs-identifier hs-var">env</span></a></span><span> </span><span class="annot"><span class="annottext">MemoryOrdering
</span><a href="GHC.Cmm.MachOp.html#MemOrderSeqCst"><span class="hs-identifier hs-var">MemOrderSeqCst</span></a></span><span> </span><span class="annot"><span class="annottext">AtomicMachOp
</span><a href="#local-6989586621682873374"><span class="hs-identifier hs-var">aop</span></a></span><span> </span><span class="annot"><span class="annottext">Width
</span><a href="#local-6989586621682873373"><span class="hs-identifier hs-var">w</span></a></span><span> </span><span class="annot"><span class="annottext">CmmExpr
</span><a href="#local-6989586621682873376"><span class="hs-identifier hs-var">addr</span></a></span><span> </span><span class="annot"><span class="annottext">CmmExpr
</span><a href="#local-6989586621682873377"><span class="hs-identifier hs-var">val</span></a></span><span> </span><span class="annot"><span class="annottext">CmmFormal
</span><a href="#local-6989586621682873375"><span class="hs-identifier hs-var">dest</span></a></span><span>
</span><span id="line-122"></span><span class="annot"><a href="GHC.Cmm.ThreadSanitizer.html#annotatePrim"><span class="hs-identifier hs-var">annotatePrim</span></a></span><span> </span><span id="local-6989586621682873380"><span class="annot"><span class="annottext">Env
</span><a href="#local-6989586621682873380"><span class="hs-identifier hs-var">env</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Cmm.MachOp.html#MO_AtomicRead"><span class="hs-identifier hs-type">MO_AtomicRead</span></a></span><span> </span><span id="local-6989586621682873382"><span class="annot"><span class="annottext">Width
</span><a href="#local-6989586621682873382"><span class="hs-identifier hs-var">w</span></a></span></span><span> </span><span id="local-6989586621682873383"><span class="annot"><span class="annottext">MemoryOrdering
</span><a href="#local-6989586621682873383"><span class="hs-identifier hs-var">mord</span></a></span></span><span class="hs-special">)</span><span>  </span><span class="hs-special">[</span><span id="local-6989586621682873384"><span class="annot"><span class="annottext">CmmFormal
</span><a href="#local-6989586621682873384"><span class="hs-identifier hs-var">dest</span></a></span></span><span class="hs-special">]</span><span>   </span><span class="hs-special">[</span><span id="local-6989586621682873385"><span class="annot"><span class="annottext">CmmExpr
</span><a href="#local-6989586621682873385"><span class="hs-identifier hs-var">addr</span></a></span></span><span class="hs-special">]</span><span>       </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Block CmmNode 'Open 'Open -&gt; Maybe (Block CmmNode 'Open 'Open)
forall a. a -&gt; Maybe a
</span><span class="hs-identifier hs-var">Just</span></span><span> </span><span class="annot"><span class="annottext">(Block CmmNode 'Open 'Open -&gt; Maybe (Block CmmNode 'Open 'Open))
-&gt; Block CmmNode 'Open 'Open -&gt; Maybe (Block CmmNode 'Open 'Open)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Env
-&gt; MemoryOrdering
-&gt; Width
-&gt; CmmExpr
-&gt; CmmFormal
-&gt; Block CmmNode 'Open 'Open
</span><a href="GHC.Cmm.ThreadSanitizer.html#tsanAtomicLoad"><span class="hs-identifier hs-var">tsanAtomicLoad</span></a></span><span> </span><span class="annot"><span class="annottext">Env
</span><a href="#local-6989586621682873380"><span class="hs-identifier hs-var">env</span></a></span><span> </span><span class="annot"><span class="annottext">MemoryOrdering
</span><a href="#local-6989586621682873383"><span class="hs-identifier hs-var">mord</span></a></span><span> </span><span class="annot"><span class="annottext">Width
</span><a href="#local-6989586621682873382"><span class="hs-identifier hs-var">w</span></a></span><span> </span><span class="annot"><span class="annottext">CmmExpr
</span><a href="#local-6989586621682873385"><span class="hs-identifier hs-var">addr</span></a></span><span> </span><span class="annot"><span class="annottext">CmmFormal
</span><a href="#local-6989586621682873384"><span class="hs-identifier hs-var">dest</span></a></span><span>
</span><span id="line-123"></span><span class="annot"><a href="GHC.Cmm.ThreadSanitizer.html#annotatePrim"><span class="hs-identifier hs-var">annotatePrim</span></a></span><span> </span><span id="local-6989586621682873387"><span class="annot"><span class="annottext">Env
</span><a href="#local-6989586621682873387"><span class="hs-identifier hs-var">env</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Cmm.MachOp.html#MO_AtomicWrite"><span class="hs-identifier hs-type">MO_AtomicWrite</span></a></span><span> </span><span id="local-6989586621682873389"><span class="annot"><span class="annottext">Width
</span><a href="#local-6989586621682873389"><span class="hs-identifier hs-var">w</span></a></span></span><span> </span><span id="local-6989586621682873390"><span class="annot"><span class="annottext">MemoryOrdering
</span><a href="#local-6989586621682873390"><span class="hs-identifier hs-var">mord</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span>       </span><span class="hs-special">[</span><span id="local-6989586621682873391"><span class="annot"><span class="annottext">CmmExpr
</span><a href="#local-6989586621682873391"><span class="hs-identifier hs-var">addr</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682873392"><span class="annot"><span class="annottext">CmmExpr
</span><a href="#local-6989586621682873392"><span class="hs-identifier hs-var">val</span></a></span></span><span class="hs-special">]</span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Block CmmNode 'Open 'Open -&gt; Maybe (Block CmmNode 'Open 'Open)
forall a. a -&gt; Maybe a
</span><span class="hs-identifier hs-var">Just</span></span><span> </span><span class="annot"><span class="annottext">(Block CmmNode 'Open 'Open -&gt; Maybe (Block CmmNode 'Open 'Open))
-&gt; Block CmmNode 'Open 'Open -&gt; Maybe (Block CmmNode 'Open 'Open)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Env
-&gt; MemoryOrdering
-&gt; Width
-&gt; CmmExpr
-&gt; CmmExpr
-&gt; Block CmmNode 'Open 'Open
</span><a href="GHC.Cmm.ThreadSanitizer.html#tsanAtomicStore"><span class="hs-identifier hs-var">tsanAtomicStore</span></a></span><span> </span><span class="annot"><span class="annottext">Env
</span><a href="#local-6989586621682873387"><span class="hs-identifier hs-var">env</span></a></span><span> </span><span class="annot"><span class="annottext">MemoryOrdering
</span><a href="#local-6989586621682873390"><span class="hs-identifier hs-var">mord</span></a></span><span> </span><span class="annot"><span class="annottext">Width
</span><a href="#local-6989586621682873389"><span class="hs-identifier hs-var">w</span></a></span><span> </span><span class="annot"><span class="annottext">CmmExpr
</span><a href="#local-6989586621682873392"><span class="hs-identifier hs-var">val</span></a></span><span> </span><span class="annot"><span class="annottext">CmmExpr
</span><a href="#local-6989586621682873391"><span class="hs-identifier hs-var">addr</span></a></span><span>
</span><span id="line-124"></span><span class="annot"><a href="GHC.Cmm.ThreadSanitizer.html#annotatePrim"><span class="hs-identifier hs-var">annotatePrim</span></a></span><span> </span><span id="local-6989586621682873394"><span class="annot"><span class="annottext">Env
</span><a href="#local-6989586621682873394"><span class="hs-identifier hs-var">env</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Cmm.MachOp.html#MO_Xchg"><span class="hs-identifier hs-type">MO_Xchg</span></a></span><span> </span><span id="local-6989586621682873396"><span class="annot"><span class="annottext">Width
</span><a href="#local-6989586621682873396"><span class="hs-identifier hs-var">w</span></a></span></span><span class="hs-special">)</span><span>             </span><span class="hs-special">[</span><span id="local-6989586621682873397"><span class="annot"><span class="annottext">CmmFormal
</span><a href="#local-6989586621682873397"><span class="hs-identifier hs-var">dest</span></a></span></span><span class="hs-special">]</span><span>   </span><span class="hs-special">[</span><span id="local-6989586621682873398"><span class="annot"><span class="annottext">CmmExpr
</span><a href="#local-6989586621682873398"><span class="hs-identifier hs-var">addr</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682873399"><span class="annot"><span class="annottext">CmmExpr
</span><a href="#local-6989586621682873399"><span class="hs-identifier hs-var">val</span></a></span></span><span class="hs-special">]</span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Block CmmNode 'Open 'Open -&gt; Maybe (Block CmmNode 'Open 'Open)
forall a. a -&gt; Maybe a
</span><span class="hs-identifier hs-var">Just</span></span><span> </span><span class="annot"><span class="annottext">(Block CmmNode 'Open 'Open -&gt; Maybe (Block CmmNode 'Open 'Open))
-&gt; Block CmmNode 'Open 'Open -&gt; Maybe (Block CmmNode 'Open 'Open)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Env
-&gt; MemoryOrdering
-&gt; Width
-&gt; CmmExpr
-&gt; CmmExpr
-&gt; CmmFormal
-&gt; Block CmmNode 'Open 'Open
</span><a href="GHC.Cmm.ThreadSanitizer.html#tsanAtomicExchange"><span class="hs-identifier hs-var">tsanAtomicExchange</span></a></span><span> </span><span class="annot"><span class="annottext">Env
</span><a href="#local-6989586621682873394"><span class="hs-identifier hs-var">env</span></a></span><span> </span><span class="annot"><span class="annottext">MemoryOrdering
</span><a href="GHC.Cmm.MachOp.html#MemOrderSeqCst"><span class="hs-identifier hs-var">MemOrderSeqCst</span></a></span><span> </span><span class="annot"><span class="annottext">Width
</span><a href="#local-6989586621682873396"><span class="hs-identifier hs-var">w</span></a></span><span> </span><span class="annot"><span class="annottext">CmmExpr
</span><a href="#local-6989586621682873399"><span class="hs-identifier hs-var">val</span></a></span><span> </span><span class="annot"><span class="annottext">CmmExpr
</span><a href="#local-6989586621682873398"><span class="hs-identifier hs-var">addr</span></a></span><span> </span><span class="annot"><span class="annottext">CmmFormal
</span><a href="#local-6989586621682873397"><span class="hs-identifier hs-var">dest</span></a></span><span>
</span><span id="line-125"></span><span class="annot"><a href="GHC.Cmm.ThreadSanitizer.html#annotatePrim"><span class="hs-identifier hs-var">annotatePrim</span></a></span><span> </span><span id="local-6989586621682873401"><span class="annot"><span class="annottext">Env
</span><a href="#local-6989586621682873401"><span class="hs-identifier hs-var">env</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Cmm.MachOp.html#MO_Cmpxchg"><span class="hs-identifier hs-type">MO_Cmpxchg</span></a></span><span> </span><span id="local-6989586621682873403"><span class="annot"><span class="annottext">Width
</span><a href="#local-6989586621682873403"><span class="hs-identifier hs-var">w</span></a></span></span><span class="hs-special">)</span><span>          </span><span class="hs-special">[</span><span id="local-6989586621682873404"><span class="annot"><span class="annottext">CmmFormal
</span><a href="#local-6989586621682873404"><span class="hs-identifier hs-var">dest</span></a></span></span><span class="hs-special">]</span><span>   </span><span class="hs-special">[</span><span id="local-6989586621682873405"><span class="annot"><span class="annottext">CmmExpr
</span><a href="#local-6989586621682873405"><span class="hs-identifier hs-var">addr</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682873406"><span class="annot"><span class="annottext">CmmExpr
</span><a href="#local-6989586621682873406"><span class="hs-identifier hs-var">expected</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682873407"><span class="annot"><span class="annottext">CmmExpr
</span><a href="#local-6989586621682873407"><span class="hs-identifier hs-var">new</span></a></span></span><span class="hs-special">]</span><span>
</span><span id="line-126"></span><span>                                                               </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Block CmmNode 'Open 'Open -&gt; Maybe (Block CmmNode 'Open 'Open)
forall a. a -&gt; Maybe a
</span><span class="hs-identifier hs-var">Just</span></span><span> </span><span class="annot"><span class="annottext">(Block CmmNode 'Open 'Open -&gt; Maybe (Block CmmNode 'Open 'Open))
-&gt; Block CmmNode 'Open 'Open -&gt; Maybe (Block CmmNode 'Open 'Open)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Env
-&gt; MemoryOrdering
-&gt; MemoryOrdering
-&gt; Width
-&gt; CmmExpr
-&gt; CmmExpr
-&gt; CmmExpr
-&gt; CmmFormal
-&gt; Block CmmNode 'Open 'Open
</span><a href="GHC.Cmm.ThreadSanitizer.html#tsanAtomicCas"><span class="hs-identifier hs-var">tsanAtomicCas</span></a></span><span> </span><span class="annot"><span class="annottext">Env
</span><a href="#local-6989586621682873401"><span class="hs-identifier hs-var">env</span></a></span><span> </span><span class="annot"><span class="annottext">MemoryOrdering
</span><a href="GHC.Cmm.MachOp.html#MemOrderSeqCst"><span class="hs-identifier hs-var">MemOrderSeqCst</span></a></span><span> </span><span class="annot"><span class="annottext">MemoryOrdering
</span><a href="GHC.Cmm.MachOp.html#MemOrderSeqCst"><span class="hs-identifier hs-var">MemOrderSeqCst</span></a></span><span> </span><span class="annot"><span class="annottext">Width
</span><a href="#local-6989586621682873403"><span class="hs-identifier hs-var">w</span></a></span><span> </span><span class="annot"><span class="annottext">CmmExpr
</span><a href="#local-6989586621682873405"><span class="hs-identifier hs-var">addr</span></a></span><span> </span><span class="annot"><span class="annottext">CmmExpr
</span><a href="#local-6989586621682873406"><span class="hs-identifier hs-var">expected</span></a></span><span> </span><span class="annot"><span class="annottext">CmmExpr
</span><a href="#local-6989586621682873407"><span class="hs-identifier hs-var">new</span></a></span><span> </span><span class="annot"><span class="annottext">CmmFormal
</span><a href="#local-6989586621682873404"><span class="hs-identifier hs-var">dest</span></a></span><span>
</span><span id="line-127"></span><span class="annot"><a href="GHC.Cmm.ThreadSanitizer.html#annotatePrim"><span class="hs-identifier hs-var">annotatePrim</span></a></span><span> </span><span class="annot"><span class="annottext">Env
</span><span class="hs-identifier">_</span></span><span>    </span><span class="annot"><span class="annottext">CallishMachOp
</span><span class="hs-identifier">_</span></span><span>                       </span><span class="annot"><span class="annottext">[CmmFormal]
</span><span class="hs-identifier">_</span></span><span>        </span><span class="annot"><span class="annottext">[CmmExpr]
</span><span class="hs-identifier">_</span></span><span>           </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Maybe (Block CmmNode 'Open 'Open)
forall a. Maybe a
</span><span class="hs-identifier hs-var">Nothing</span></span><span>
</span><span id="line-128"></span><span>
</span><span id="line-129"></span><span class="annot"><a href="GHC.Cmm.ThreadSanitizer.html#mkUnsafeCall"><span class="hs-identifier hs-type">mkUnsafeCall</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Cmm.ThreadSanitizer.html#Env"><span class="hs-identifier hs-type">Env</span></a></span><span>
</span><span id="line-130"></span><span>             </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Cmm.Node.html#ForeignTarget"><span class="hs-identifier hs-type">ForeignTarget</span></a></span><span>  </span><span class="annot"><span class="hs-comment">-- ^ function</span></span><span>
</span><span id="line-131"></span><span>             </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="GHC.Cmm.Node.html#CmmFormal"><span class="hs-identifier hs-type">CmmFormal</span></a></span><span class="hs-special">]</span><span>    </span><span class="annot"><span class="hs-comment">-- ^ results</span></span><span>
</span><span id="line-132"></span><span>             </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="GHC.Cmm.Node.html#CmmActual"><span class="hs-identifier hs-type">CmmActual</span></a></span><span class="hs-special">]</span><span>    </span><span class="annot"><span class="hs-comment">-- ^ arguments</span></span><span>
</span><span id="line-133"></span><span>             </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Cmm.Dataflow.Block.html#Block"><span class="hs-identifier hs-type">Block</span></a></span><span> </span><span class="annot"><a href="GHC.Cmm.Node.html#CmmNode"><span class="hs-identifier hs-type">CmmNode</span></a></span><span> </span><span class="annot"><a href="GHC.Cmm.Dataflow.Block.html#O"><span class="hs-identifier hs-type">O</span></a></span><span> </span><span class="annot"><a href="GHC.Cmm.Dataflow.Block.html#O"><span class="hs-identifier hs-type">O</span></a></span><span>
</span><span id="line-134"></span><span id="mkUnsafeCall"><span class="annot"><span class="annottext">mkUnsafeCall :: Env
-&gt; ForeignTarget
-&gt; [CmmFormal]
-&gt; [CmmExpr]
-&gt; Block CmmNode 'Open 'Open
</span><a href="GHC.Cmm.ThreadSanitizer.html#mkUnsafeCall"><span class="hs-identifier hs-var hs-var">mkUnsafeCall</span></a></span></span><span> </span><span id="local-6989586621682873410"><span class="annot"><span class="annottext">Env
</span><a href="#local-6989586621682873410"><span class="hs-identifier hs-var">env</span></a></span></span><span> </span><span id="local-6989586621682873411"><span class="annot"><span class="annottext">ForeignTarget
</span><a href="#local-6989586621682873411"><span class="hs-identifier hs-var">ftgt</span></a></span></span><span> </span><span id="local-6989586621682873412"><span class="annot"><span class="annottext">[CmmFormal]
</span><a href="#local-6989586621682873412"><span class="hs-identifier hs-var">formals</span></a></span></span><span> </span><span id="local-6989586621682873413"><span class="annot"><span class="annottext">[CmmExpr]
</span><a href="#local-6989586621682873413"><span class="hs-identifier hs-var">args</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-135"></span><span>    </span><span class="annot"><span class="annottext">Block CmmNode 'Open 'Open
</span><a href="#local-6989586621682873414"><span class="hs-identifier hs-var">save</span></a></span><span> </span><span class="annot"><span class="annottext">Block CmmNode 'Open 'Open
-&gt; Block CmmNode 'Open 'Open -&gt; Block CmmNode 'Open 'Open
forall (n :: Extensibility -&gt; Extensibility -&gt; *)
       (e :: Extensibility) (x :: Extensibility).
Block n e 'Open -&gt; Block n 'Open x -&gt; Block n e x
</span><a href="GHC.Cmm.Dataflow.Block.html#blockAppend"><span class="hs-operator hs-var">`blockAppend`</span></a></span><span>     </span><span class="hs-comment">-- save global registers</span><span>
</span><span id="line-136"></span><span>    </span><span class="annot"><span class="annottext">Block CmmNode 'Open 'Open
</span><a href="#local-6989586621682873415"><span class="hs-identifier hs-var">bind_args</span></a></span><span> </span><span class="annot"><span class="annottext">Block CmmNode 'Open 'Open
-&gt; CmmNode 'Open 'Open -&gt; Block CmmNode 'Open 'Open
forall (n :: Extensibility -&gt; Extensibility -&gt; *)
       (e :: Extensibility).
Block n e 'Open -&gt; n 'Open 'Open -&gt; Block n e 'Open
</span><a href="GHC.Cmm.Dataflow.Block.html#blockSnoc"><span class="hs-operator hs-var">`blockSnoc`</span></a></span><span>  </span><span class="hs-comment">-- bind arguments to local registers</span><span>
</span><span id="line-137"></span><span>    </span><span class="annot"><span class="annottext">CmmNode 'Open 'Open
</span><a href="#local-6989586621682873416"><span class="hs-identifier hs-var">call</span></a></span><span> </span><span class="annot"><span class="annottext">Block CmmNode 'Open 'Open
-&gt; Block CmmNode 'Open 'Open -&gt; Block CmmNode 'Open 'Open
forall (n :: Extensibility -&gt; Extensibility -&gt; *)
       (e :: Extensibility) (x :: Extensibility).
Block n e 'Open -&gt; Block n 'Open x -&gt; Block n e x
</span><a href="GHC.Cmm.Dataflow.Block.html#blockAppend"><span class="hs-operator hs-var">`blockAppend`</span></a></span><span>     </span><span class="hs-comment">-- perform call</span><span>
</span><span id="line-138"></span><span>    </span><span class="annot"><span class="annottext">Block CmmNode 'Open 'Open
</span><a href="#local-6989586621682873417"><span class="hs-identifier hs-var">restore</span></a></span><span>                </span><span class="hs-comment">-- restore global registers</span><span>
</span><span id="line-139"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-140"></span><span>    </span><span class="hs-special">(</span><span id="local-6989586621682873414"><span class="annot"><span class="annottext">Block CmmNode 'Open 'Open
</span><a href="#local-6989586621682873414"><span class="hs-identifier hs-var">save</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682873417"><span class="annot"><span class="annottext">Block CmmNode 'Open 'Open
</span><a href="#local-6989586621682873417"><span class="hs-identifier hs-var">restore</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">UniqSupply
-&gt; Platform
-&gt; (Block CmmNode 'Open 'Open, Block CmmNode 'Open 'Open)
</span><a href="GHC.Cmm.ThreadSanitizer.html#saveRestoreCallerRegs"><span class="hs-identifier hs-var">saveRestoreCallerRegs</span></a></span><span> </span><span class="annot"><span class="annottext">UniqSupply
</span><a href="#local-6989586621682873419"><span class="hs-identifier hs-var">gregs_us</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Env -&gt; Platform
</span><a href="GHC.Cmm.ThreadSanitizer.html#platform"><span class="hs-identifier hs-var">platform</span></a></span><span> </span><span class="annot"><span class="annottext">Env
</span><a href="#local-6989586621682873410"><span class="hs-identifier hs-var">env</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-141"></span><span>
</span><span id="line-142"></span><span>    </span><span class="hs-special">(</span><span id="local-6989586621682873420"><span class="annot"><span class="annottext">UniqSupply
</span><a href="#local-6989586621682873420"><span class="hs-identifier hs-var">arg_us</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682873419"><span class="annot"><span class="annottext">UniqSupply
</span><a href="#local-6989586621682873419"><span class="hs-identifier hs-var">gregs_us</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">UniqSupply -&gt; (UniqSupply, UniqSupply)
</span><a href="GHC.Types.Unique.Supply.html#splitUniqSupply"><span class="hs-identifier hs-var">splitUniqSupply</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Env -&gt; UniqSupply
</span><a href="GHC.Cmm.ThreadSanitizer.html#uniques"><span class="hs-identifier hs-var">uniques</span></a></span><span> </span><span class="annot"><span class="annottext">Env
</span><a href="#local-6989586621682873410"><span class="hs-identifier hs-var">env</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-143"></span><span>
</span><span id="line-144"></span><span>    </span><span class="hs-comment">-- We also must be careful not to mention caller-saved registers in</span><span>
</span><span id="line-145"></span><span>    </span><span class="hs-comment">-- arguments as Cmm-Lint checks this. To accomplish this we instead bind</span><span>
</span><span id="line-146"></span><span>    </span><span class="hs-comment">-- the arguments to local registers.</span><span>
</span><span id="line-147"></span><span>    </span><span class="annot"><a href="#local-6989586621682873422"><span class="hs-identifier hs-type">arg_regs</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="GHC.Cmm.Reg.html#CmmReg"><span class="hs-identifier hs-type">CmmReg</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-148"></span><span>    </span><span id="local-6989586621682873422"><span class="annot"><span class="annottext">arg_regs :: [CmmReg]
</span><a href="#local-6989586621682873422"><span class="hs-identifier hs-var hs-var">arg_regs</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(Unique -&gt; CmmExpr -&gt; CmmReg) -&gt; [Unique] -&gt; [CmmExpr] -&gt; [CmmReg]
forall a b c. (a -&gt; b -&gt; c) -&gt; [a] -&gt; [b] -&gt; [c]
</span><span class="hs-identifier hs-var">zipWith</span></span><span> </span><span class="annot"><span class="annottext">Unique -&gt; CmmExpr -&gt; CmmReg
</span><a href="#local-6989586621682873424"><span class="hs-identifier hs-var">arg_reg</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">UniqSupply -&gt; [Unique]
</span><a href="GHC.Types.Unique.Supply.html#uniqsFromSupply"><span class="hs-identifier hs-var">uniqsFromSupply</span></a></span><span> </span><span class="annot"><span class="annottext">UniqSupply
</span><a href="#local-6989586621682873420"><span class="hs-identifier hs-var">arg_us</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[CmmExpr]
</span><a href="#local-6989586621682873413"><span class="hs-identifier hs-var">args</span></a></span><span>
</span><span id="line-149"></span><span>      </span><span class="hs-keyword">where</span><span>
</span><span id="line-150"></span><span>        </span><span class="annot"><a href="#local-6989586621682873424"><span class="hs-identifier hs-type">arg_reg</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Types.Unique.html#Unique"><span class="hs-identifier hs-type">Unique</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Cmm.Expr.html#CmmExpr"><span class="hs-identifier hs-type">CmmExpr</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Cmm.Reg.html#CmmReg"><span class="hs-identifier hs-type">CmmReg</span></a></span><span>
</span><span id="line-151"></span><span>        </span><span id="local-6989586621682873424"><span class="annot"><span class="annottext">arg_reg :: Unique -&gt; CmmExpr -&gt; CmmReg
</span><a href="#local-6989586621682873424"><span class="hs-identifier hs-var hs-var">arg_reg</span></a></span></span><span> </span><span id="local-6989586621682873426"><span class="annot"><span class="annottext">Unique
</span><a href="#local-6989586621682873426"><span class="hs-identifier hs-var">u</span></a></span></span><span> </span><span id="local-6989586621682873427"><span class="annot"><span class="annottext">CmmExpr
</span><a href="#local-6989586621682873427"><span class="hs-identifier hs-var">expr</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">CmmFormal -&gt; CmmReg
</span><a href="GHC.Cmm.Reg.html#CmmLocal"><span class="hs-identifier hs-var">CmmLocal</span></a></span><span> </span><span class="annot"><span class="annottext">(CmmFormal -&gt; CmmReg) -&gt; CmmFormal -&gt; CmmReg
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Unique -&gt; CmmType -&gt; CmmFormal
</span><a href="GHC.Cmm.Reg.html#LocalReg"><span class="hs-identifier hs-var">LocalReg</span></a></span><span> </span><span class="annot"><span class="annottext">Unique
</span><a href="#local-6989586621682873426"><span class="hs-identifier hs-var">u</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Platform -&gt; CmmExpr -&gt; CmmType
</span><a href="GHC.Cmm.Expr.html#cmmExprType"><span class="hs-identifier hs-var">cmmExprType</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Env -&gt; Platform
</span><a href="GHC.Cmm.ThreadSanitizer.html#platform"><span class="hs-identifier hs-var">platform</span></a></span><span> </span><span class="annot"><span class="annottext">Env
</span><a href="#local-6989586621682873410"><span class="hs-identifier hs-var">env</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">CmmExpr
</span><a href="#local-6989586621682873427"><span class="hs-identifier hs-var">expr</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-152"></span><span>
</span><span id="line-153"></span><span>    </span><span class="annot"><a href="#local-6989586621682873415"><span class="hs-identifier hs-type">bind_args</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Cmm.Dataflow.Block.html#Block"><span class="hs-identifier hs-type">Block</span></a></span><span> </span><span class="annot"><a href="GHC.Cmm.Node.html#CmmNode"><span class="hs-identifier hs-type">CmmNode</span></a></span><span> </span><span class="annot"><a href="GHC.Cmm.Dataflow.Block.html#O"><span class="hs-identifier hs-type">O</span></a></span><span> </span><span class="annot"><a href="GHC.Cmm.Dataflow.Block.html#O"><span class="hs-identifier hs-type">O</span></a></span><span>
</span><span id="line-154"></span><span>    </span><span id="local-6989586621682873415"><span class="annot"><span class="annottext">bind_args :: Block CmmNode 'Open 'Open
</span><a href="#local-6989586621682873415"><span class="hs-identifier hs-var hs-var">bind_args</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[Block CmmNode 'Open 'Open] -&gt; Block CmmNode 'Open 'Open
forall (n :: Extensibility -&gt; Extensibility -&gt; *).
[Block n 'Open 'Open] -&gt; Block n 'Open 'Open
</span><a href="GHC.Cmm.Dataflow.Block.html#blockConcat"><span class="hs-identifier hs-var">blockConcat</span></a></span><span> </span><span class="annot"><span class="annottext">([Block CmmNode 'Open 'Open] -&gt; Block CmmNode 'Open 'Open)
-&gt; [Block CmmNode 'Open 'Open] -&gt; Block CmmNode 'Open 'Open
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">(CmmReg -&gt; CmmExpr -&gt; Block CmmNode 'Open 'Open)
-&gt; [CmmReg] -&gt; [CmmExpr] -&gt; [Block CmmNode 'Open 'Open]
forall a b c. (a -&gt; b -&gt; c) -&gt; [a] -&gt; [b] -&gt; [c]
</span><span class="hs-identifier hs-var">zipWith</span></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span id="local-6989586621682873430"><span class="annot"><span class="annottext">CmmReg
</span><a href="#local-6989586621682873430"><span class="hs-identifier hs-var">r</span></a></span></span><span> </span><span id="local-6989586621682873431"><span class="annot"><span class="annottext">CmmExpr
</span><a href="#local-6989586621682873431"><span class="hs-identifier hs-var">e</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">CmmNode 'Open 'Open -&gt; Block CmmNode 'Open 'Open
forall (n :: Extensibility -&gt; Extensibility -&gt; *).
n 'Open 'Open -&gt; Block n 'Open 'Open
</span><a href="GHC.Cmm.Dataflow.Block.html#BMiddle"><span class="hs-identifier hs-var">BMiddle</span></a></span><span> </span><span class="annot"><span class="annottext">(CmmNode 'Open 'Open -&gt; Block CmmNode 'Open 'Open)
-&gt; CmmNode 'Open 'Open -&gt; Block CmmNode 'Open 'Open
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">CmmReg -&gt; CmmExpr -&gt; CmmNode 'Open 'Open
</span><a href="GHC.Cmm.Node.html#CmmAssign"><span class="hs-identifier hs-var">CmmAssign</span></a></span><span> </span><span class="annot"><span class="annottext">CmmReg
</span><a href="#local-6989586621682873430"><span class="hs-identifier hs-var">r</span></a></span><span> </span><span class="annot"><span class="annottext">CmmExpr
</span><a href="#local-6989586621682873431"><span class="hs-identifier hs-var">e</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[CmmReg]
</span><a href="#local-6989586621682873422"><span class="hs-identifier hs-var">arg_regs</span></a></span><span> </span><span class="annot"><span class="annottext">[CmmExpr]
</span><a href="#local-6989586621682873413"><span class="hs-identifier hs-var">args</span></a></span><span>
</span><span id="line-155"></span><span>
</span><span id="line-156"></span><span>    </span><span id="local-6989586621682873416"><span class="annot"><span class="annottext">call :: CmmNode 'Open 'Open
</span><a href="#local-6989586621682873416"><span class="hs-identifier hs-var hs-var">call</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ForeignTarget -&gt; [CmmFormal] -&gt; [CmmExpr] -&gt; CmmNode 'Open 'Open
</span><a href="GHC.Cmm.Node.html#CmmUnsafeForeignCall"><span class="hs-identifier hs-var">CmmUnsafeForeignCall</span></a></span><span> </span><span class="annot"><span class="annottext">ForeignTarget
</span><a href="#local-6989586621682873411"><span class="hs-identifier hs-var">ftgt</span></a></span><span> </span><span class="annot"><span class="annottext">[CmmFormal]
</span><a href="#local-6989586621682873412"><span class="hs-identifier hs-var">formals</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(CmmReg -&gt; CmmExpr) -&gt; [CmmReg] -&gt; [CmmExpr]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><span class="hs-identifier hs-var">map</span></span><span> </span><span class="annot"><span class="annottext">CmmReg -&gt; CmmExpr
</span><a href="GHC.Cmm.Expr.html#CmmReg"><span class="hs-identifier hs-var">CmmReg</span></a></span><span> </span><span class="annot"><span class="annottext">[CmmReg]
</span><a href="#local-6989586621682873422"><span class="hs-identifier hs-var">arg_regs</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-157"></span><span>
</span><span id="line-158"></span><span class="hs-comment">-- | We save the contents of global registers in locals and allow the</span><span>
</span><span id="line-159"></span><span class="hs-comment">-- register allocator to spill them to the stack around the call.</span><span>
</span><span id="line-160"></span><span class="hs-comment">-- We cannot use the register table for this since we would interface</span><span>
</span><span id="line-161"></span><span class="hs-comment">-- with {SAVE,RESTORE}_THREAD_STATE.</span><span>
</span><span id="line-162"></span><span class="annot"><a href="GHC.Cmm.ThreadSanitizer.html#saveRestoreCallerRegs"><span class="hs-identifier hs-type">saveRestoreCallerRegs</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Types.Unique.Supply.html#UniqSupply"><span class="hs-identifier hs-type">UniqSupply</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Platform.html#Platform"><span class="hs-identifier hs-type">Platform</span></a></span><span>
</span><span id="line-163"></span><span>                      </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Cmm.Dataflow.Block.html#Block"><span class="hs-identifier hs-type">Block</span></a></span><span> </span><span class="annot"><a href="GHC.Cmm.Node.html#CmmNode"><span class="hs-identifier hs-type">CmmNode</span></a></span><span> </span><span class="annot"><a href="GHC.Cmm.Dataflow.Block.html#O"><span class="hs-identifier hs-type">O</span></a></span><span> </span><span class="annot"><a href="GHC.Cmm.Dataflow.Block.html#O"><span class="hs-identifier hs-type">O</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Cmm.Dataflow.Block.html#Block"><span class="hs-identifier hs-type">Block</span></a></span><span> </span><span class="annot"><a href="GHC.Cmm.Node.html#CmmNode"><span class="hs-identifier hs-type">CmmNode</span></a></span><span> </span><span class="annot"><a href="GHC.Cmm.Dataflow.Block.html#O"><span class="hs-identifier hs-type">O</span></a></span><span> </span><span class="annot"><a href="GHC.Cmm.Dataflow.Block.html#O"><span class="hs-identifier hs-type">O</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-164"></span><span id="saveRestoreCallerRegs"><span class="annot"><span class="annottext">saveRestoreCallerRegs :: UniqSupply
-&gt; Platform
-&gt; (Block CmmNode 'Open 'Open, Block CmmNode 'Open 'Open)
</span><a href="GHC.Cmm.ThreadSanitizer.html#saveRestoreCallerRegs"><span class="hs-identifier hs-var hs-var">saveRestoreCallerRegs</span></a></span></span><span> </span><span id="local-6989586621682873432"><span class="annot"><span class="annottext">UniqSupply
</span><a href="#local-6989586621682873432"><span class="hs-identifier hs-var">us</span></a></span></span><span> </span><span id="local-6989586621682873433"><span class="annot"><span class="annottext">Platform
</span><a href="#local-6989586621682873433"><span class="hs-identifier hs-var">platform</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-165"></span><span>    </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Block CmmNode 'Open 'Open
</span><a href="#local-6989586621682873434"><span class="hs-identifier hs-var">save</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Block CmmNode 'Open 'Open
</span><a href="#local-6989586621682873435"><span class="hs-identifier hs-var">restore</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-166"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-167"></span><span>    </span><span class="annot"><a href="#local-6989586621682873436"><span class="hs-identifier hs-type">regs_to_save</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="GHC.Cmm.Reg.html#GlobalReg"><span class="hs-identifier hs-type">GlobalReg</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-168"></span><span>    </span><span id="local-6989586621682873436"><span class="annot"><span class="annottext">regs_to_save :: [GlobalReg]
</span><a href="#local-6989586621682873436"><span class="hs-identifier hs-var hs-var">regs_to_save</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(GlobalReg -&gt; Bool) -&gt; [GlobalReg] -&gt; [GlobalReg]
forall a. (a -&gt; Bool) -&gt; [a] -&gt; [a]
</span><span class="hs-identifier hs-var">filter</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Platform -&gt; GlobalReg -&gt; Bool
</span><a href="GHC.Platform.Regs.html#callerSaves"><span class="hs-identifier hs-var">callerSaves</span></a></span><span> </span><span class="annot"><span class="annottext">Platform
</span><a href="#local-6989586621682873433"><span class="hs-identifier hs-var">platform</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Platform -&gt; [GlobalReg]
</span><a href="GHC.Platform.Regs.html#activeStgRegs"><span class="hs-identifier hs-var">activeStgRegs</span></a></span><span> </span><span class="annot"><span class="annottext">Platform
</span><a href="#local-6989586621682873433"><span class="hs-identifier hs-var">platform</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-169"></span><span>
</span><span id="line-170"></span><span>    </span><span class="annot"><a href="#local-6989586621682873437"><span class="hs-identifier hs-type">nodes</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><span class="hs-special">(</span><span class="annot"><a href="GHC.Cmm.Node.html#CmmNode"><span class="hs-identifier hs-type">CmmNode</span></a></span><span> </span><span class="annot"><a href="GHC.Cmm.Dataflow.Block.html#O"><span class="hs-identifier hs-type">O</span></a></span><span> </span><span class="annot"><a href="GHC.Cmm.Dataflow.Block.html#O"><span class="hs-identifier hs-type">O</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Cmm.Node.html#CmmNode"><span class="hs-identifier hs-type">CmmNode</span></a></span><span> </span><span class="annot"><a href="GHC.Cmm.Dataflow.Block.html#O"><span class="hs-identifier hs-type">O</span></a></span><span> </span><span class="annot"><a href="GHC.Cmm.Dataflow.Block.html#O"><span class="hs-identifier hs-type">O</span></a></span><span class="hs-special">)</span><span class="hs-special">]</span><span>
</span><span id="line-171"></span><span>    </span><span id="local-6989586621682873437"><span class="annot"><span class="annottext">nodes :: [(CmmNode 'Open 'Open, CmmNode 'Open 'Open)]
</span><a href="#local-6989586621682873437"><span class="hs-identifier hs-var hs-var">nodes</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-172"></span><span>        </span><span class="annot"><span class="annottext">(GlobalReg -&gt; Unique -&gt; (CmmNode 'Open 'Open, CmmNode 'Open 'Open))
-&gt; [GlobalReg]
-&gt; [Unique]
-&gt; [(CmmNode 'Open 'Open, CmmNode 'Open 'Open)]
forall a b c. (a -&gt; b -&gt; c) -&gt; [a] -&gt; [b] -&gt; [c]
</span><span class="hs-identifier hs-var">zipWith</span></span><span> </span><span class="annot"><span class="annottext">GlobalReg -&gt; Unique -&gt; (CmmNode 'Open 'Open, CmmNode 'Open 'Open)
</span><a href="#local-6989586621682873438"><span class="hs-identifier hs-var">mk_reg</span></a></span><span> </span><span class="annot"><span class="annottext">[GlobalReg]
</span><a href="#local-6989586621682873436"><span class="hs-identifier hs-var">regs_to_save</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">UniqSupply -&gt; [Unique]
</span><a href="GHC.Types.Unique.Supply.html#uniqsFromSupply"><span class="hs-identifier hs-var">uniqsFromSupply</span></a></span><span> </span><span class="annot"><span class="annottext">UniqSupply
</span><a href="#local-6989586621682873432"><span class="hs-identifier hs-var">us</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-173"></span><span>      </span><span class="hs-keyword">where</span><span>
</span><span id="line-174"></span><span>        </span><span class="annot"><a href="#local-6989586621682873438"><span class="hs-identifier hs-type">mk_reg</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Cmm.Reg.html#GlobalReg"><span class="hs-identifier hs-type">GlobalReg</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Types.Unique.html#Unique"><span class="hs-identifier hs-type">Unique</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Cmm.Node.html#CmmNode"><span class="hs-identifier hs-type">CmmNode</span></a></span><span> </span><span class="annot"><a href="GHC.Cmm.Dataflow.Block.html#O"><span class="hs-identifier hs-type">O</span></a></span><span> </span><span class="annot"><a href="GHC.Cmm.Dataflow.Block.html#O"><span class="hs-identifier hs-type">O</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Cmm.Node.html#CmmNode"><span class="hs-identifier hs-type">CmmNode</span></a></span><span> </span><span class="annot"><a href="GHC.Cmm.Dataflow.Block.html#O"><span class="hs-identifier hs-type">O</span></a></span><span> </span><span class="annot"><a href="GHC.Cmm.Dataflow.Block.html#O"><span class="hs-identifier hs-type">O</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-175"></span><span>        </span><span id="local-6989586621682873438"><span class="annot"><span class="annottext">mk_reg :: GlobalReg -&gt; Unique -&gt; (CmmNode 'Open 'Open, CmmNode 'Open 'Open)
</span><a href="#local-6989586621682873438"><span class="hs-identifier hs-var hs-var">mk_reg</span></a></span></span><span> </span><span id="local-6989586621682873439"><span class="annot"><span class="annottext">GlobalReg
</span><a href="#local-6989586621682873439"><span class="hs-identifier hs-var">reg</span></a></span></span><span> </span><span id="local-6989586621682873440"><span class="annot"><span class="annottext">Unique
</span><a href="#local-6989586621682873440"><span class="hs-identifier hs-var">u</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-176"></span><span>            </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621682873441"><span class="annot"><span class="annottext">ty :: CmmType
</span><a href="#local-6989586621682873441"><span class="hs-identifier hs-var hs-var">ty</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Platform -&gt; GlobalReg -&gt; CmmType
</span><a href="GHC.Cmm.Reg.html#globalRegSpillType"><span class="hs-identifier hs-var">globalRegSpillType</span></a></span><span> </span><span class="annot"><span class="annottext">Platform
</span><a href="#local-6989586621682873433"><span class="hs-identifier hs-var">platform</span></a></span><span> </span><span class="annot"><span class="annottext">GlobalReg
</span><a href="#local-6989586621682873439"><span class="hs-identifier hs-var">reg</span></a></span><span>
</span><span id="line-177"></span><span>                </span><span id="local-6989586621682873443"><span class="annot"><span class="annottext">greg :: CmmReg
</span><a href="#local-6989586621682873443"><span class="hs-identifier hs-var hs-var">greg</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">GlobalRegUse -&gt; CmmReg
</span><a href="GHC.Cmm.Reg.html#CmmGlobal"><span class="hs-identifier hs-var">CmmGlobal</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">GlobalReg -&gt; CmmType -&gt; GlobalRegUse
</span><a href="GHC.Cmm.Reg.html#GlobalRegUse"><span class="hs-identifier hs-var">GlobalRegUse</span></a></span><span> </span><span class="annot"><span class="annottext">GlobalReg
</span><a href="#local-6989586621682873439"><span class="hs-identifier hs-var">reg</span></a></span><span> </span><span class="annot"><span class="annottext">CmmType
</span><a href="#local-6989586621682873441"><span class="hs-identifier hs-var">ty</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-178"></span><span>                </span><span id="local-6989586621682873446"><span class="annot"><span class="annottext">lreg :: CmmReg
</span><a href="#local-6989586621682873446"><span class="hs-identifier hs-var hs-var">lreg</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">CmmFormal -&gt; CmmReg
</span><a href="GHC.Cmm.Reg.html#CmmLocal"><span class="hs-identifier hs-var">CmmLocal</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Unique -&gt; CmmType -&gt; CmmFormal
</span><a href="GHC.Cmm.Reg.html#LocalReg"><span class="hs-identifier hs-var">LocalReg</span></a></span><span> </span><span class="annot"><span class="annottext">Unique
</span><a href="#local-6989586621682873440"><span class="hs-identifier hs-var">u</span></a></span><span> </span><span class="annot"><span class="annottext">CmmType
</span><a href="#local-6989586621682873441"><span class="hs-identifier hs-var">ty</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-179"></span><span>                </span><span id="local-6989586621682873447"><span class="annot"><span class="annottext">save :: CmmNode 'Open 'Open
</span><a href="#local-6989586621682873447"><span class="hs-identifier hs-var hs-var">save</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">CmmReg -&gt; CmmExpr -&gt; CmmNode 'Open 'Open
</span><a href="GHC.Cmm.Node.html#CmmAssign"><span class="hs-identifier hs-var">CmmAssign</span></a></span><span> </span><span class="annot"><span class="annottext">CmmReg
</span><a href="#local-6989586621682873446"><span class="hs-identifier hs-var">lreg</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">CmmReg -&gt; CmmExpr
</span><a href="GHC.Cmm.Expr.html#CmmReg"><span class="hs-identifier hs-var">CmmReg</span></a></span><span> </span><span class="annot"><span class="annottext">CmmReg
</span><a href="#local-6989586621682873443"><span class="hs-identifier hs-var">greg</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-180"></span><span>                </span><span id="local-6989586621682873448"><span class="annot"><span class="annottext">restore :: CmmNode 'Open 'Open
</span><a href="#local-6989586621682873448"><span class="hs-identifier hs-var hs-var">restore</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">CmmReg -&gt; CmmExpr -&gt; CmmNode 'Open 'Open
</span><a href="GHC.Cmm.Node.html#CmmAssign"><span class="hs-identifier hs-var">CmmAssign</span></a></span><span> </span><span class="annot"><span class="annottext">CmmReg
</span><a href="#local-6989586621682873443"><span class="hs-identifier hs-var">greg</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">CmmReg -&gt; CmmExpr
</span><a href="GHC.Cmm.Expr.html#CmmReg"><span class="hs-identifier hs-var">CmmReg</span></a></span><span> </span><span class="annot"><span class="annottext">CmmReg
</span><a href="#local-6989586621682873446"><span class="hs-identifier hs-var">lreg</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-181"></span><span>            </span><span class="hs-keyword">in</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">CmmNode 'Open 'Open
</span><a href="#local-6989586621682873447"><span class="hs-identifier hs-var">save</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">CmmNode 'Open 'Open
</span><a href="#local-6989586621682873448"><span class="hs-identifier hs-var">restore</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-182"></span><span>
</span><span id="line-183"></span><span>    </span><span class="hs-special">(</span><span id="local-6989586621682873449"><span class="annot"><span class="annottext">[CmmNode 'Open 'Open]
</span><a href="#local-6989586621682873449"><span class="hs-identifier hs-var">save_nodes</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682873450"><span class="annot"><span class="annottext">[CmmNode 'Open 'Open]
</span><a href="#local-6989586621682873450"><span class="hs-identifier hs-var">restore_nodes</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[(CmmNode 'Open 'Open, CmmNode 'Open 'Open)]
-&gt; ([CmmNode 'Open 'Open], [CmmNode 'Open 'Open])
forall a b. [(a, b)] -&gt; ([a], [b])
</span><span class="hs-identifier hs-var">unzip</span></span><span> </span><span class="annot"><span class="annottext">[(CmmNode 'Open 'Open, CmmNode 'Open 'Open)]
</span><a href="#local-6989586621682873437"><span class="hs-identifier hs-var">nodes</span></a></span><span>
</span><span id="line-184"></span><span>    </span><span id="local-6989586621682873434"><span class="annot"><span class="annottext">save :: Block CmmNode 'Open 'Open
</span><a href="#local-6989586621682873434"><span class="hs-identifier hs-var hs-var">save</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[CmmNode 'Open 'Open] -&gt; Block CmmNode 'Open 'Open
forall (n :: Extensibility -&gt; Extensibility -&gt; *).
[n 'Open 'Open] -&gt; Block n 'Open 'Open
</span><a href="GHC.Cmm.Dataflow.Block.html#blockFromList"><span class="hs-identifier hs-var">blockFromList</span></a></span><span> </span><span class="annot"><span class="annottext">[CmmNode 'Open 'Open]
</span><a href="#local-6989586621682873449"><span class="hs-identifier hs-var">save_nodes</span></a></span><span>
</span><span id="line-185"></span><span>    </span><span id="local-6989586621682873435"><span class="annot"><span class="annottext">restore :: Block CmmNode 'Open 'Open
</span><a href="#local-6989586621682873435"><span class="hs-identifier hs-var hs-var">restore</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[CmmNode 'Open 'Open] -&gt; Block CmmNode 'Open 'Open
forall (n :: Extensibility -&gt; Extensibility -&gt; *).
[n 'Open 'Open] -&gt; Block n 'Open 'Open
</span><a href="GHC.Cmm.Dataflow.Block.html#blockFromList"><span class="hs-identifier hs-var">blockFromList</span></a></span><span> </span><span class="annot"><span class="annottext">[CmmNode 'Open 'Open]
</span><a href="#local-6989586621682873450"><span class="hs-identifier hs-var">restore_nodes</span></a></span><span>
</span><span id="line-186"></span><span>
</span><span id="line-187"></span><span class="hs-comment">-- | Mirrors __tsan_memory_order</span><span>
</span><span id="line-188"></span><span class="hs-comment">-- &lt;https://github.com/llvm/llvm-project/blob/main/compiler-rt/include/sanitizer/tsan_interface_atomic.h#L34&gt;</span><span>
</span><span id="line-189"></span><span class="annot"><a href="GHC.Cmm.ThreadSanitizer.html#memoryOrderToTsanMemoryOrder"><span class="hs-identifier hs-type">memoryOrderToTsanMemoryOrder</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Cmm.ThreadSanitizer.html#Env"><span class="hs-identifier hs-type">Env</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Cmm.MachOp.html#MemoryOrdering"><span class="hs-identifier hs-type">MemoryOrdering</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Cmm.Expr.html#CmmExpr"><span class="hs-identifier hs-type">CmmExpr</span></a></span><span>
</span><span id="line-190"></span><span id="memoryOrderToTsanMemoryOrder"><span class="annot"><span class="annottext">memoryOrderToTsanMemoryOrder :: Env -&gt; MemoryOrdering -&gt; CmmExpr
</span><a href="GHC.Cmm.ThreadSanitizer.html#memoryOrderToTsanMemoryOrder"><span class="hs-identifier hs-var hs-var">memoryOrderToTsanMemoryOrder</span></a></span></span><span> </span><span id="local-6989586621682873454"><span class="annot"><span class="annottext">Env
</span><a href="#local-6989586621682873454"><span class="hs-identifier hs-var">env</span></a></span></span><span> </span><span id="local-6989586621682873455"><span class="annot"><span class="annottext">MemoryOrdering
</span><a href="#local-6989586621682873455"><span class="hs-identifier hs-var">mord</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-191"></span><span>    </span><span class="annot"><span class="annottext">Platform -&gt; Int -&gt; CmmExpr
</span><a href="GHC.Cmm.Utils.html#mkIntExpr"><span class="hs-identifier hs-var">mkIntExpr</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Env -&gt; Platform
</span><a href="GHC.Cmm.ThreadSanitizer.html#platform"><span class="hs-identifier hs-var">platform</span></a></span><span> </span><span class="annot"><span class="annottext">Env
</span><a href="#local-6989586621682873454"><span class="hs-identifier hs-var">env</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621682873457"><span class="hs-identifier hs-var">n</span></a></span><span>
</span><span id="line-192"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-193"></span><span>    </span><span id="local-6989586621682873457"><span class="annot"><span class="annottext">n :: Int
</span><a href="#local-6989586621682873457"><span class="hs-identifier hs-var hs-var">n</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">MemoryOrdering
</span><a href="#local-6989586621682873455"><span class="hs-identifier hs-var">mord</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-194"></span><span>      </span><span class="annot"><span class="annottext">MemoryOrdering
</span><a href="GHC.Cmm.MachOp.html#MemOrderRelaxed"><span class="hs-identifier hs-var">MemOrderRelaxed</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">0</span></span><span>
</span><span id="line-195"></span><span>      </span><span class="annot"><span class="annottext">MemoryOrdering
</span><a href="GHC.Cmm.MachOp.html#MemOrderAcquire"><span class="hs-identifier hs-var">MemOrderAcquire</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">2</span></span><span>
</span><span id="line-196"></span><span>      </span><span class="annot"><span class="annottext">MemoryOrdering
</span><a href="GHC.Cmm.MachOp.html#MemOrderRelease"><span class="hs-identifier hs-var">MemOrderRelease</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">3</span></span><span>
</span><span id="line-197"></span><span>      </span><span class="annot"><span class="annottext">MemoryOrdering
</span><a href="GHC.Cmm.MachOp.html#MemOrderSeqCst"><span class="hs-identifier hs-var">MemOrderSeqCst</span></a></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">5</span></span><span>
</span><span id="line-198"></span><span>
</span><span id="line-199"></span><span class="annot"><a href="GHC.Cmm.ThreadSanitizer.html#tsanTarget"><span class="hs-identifier hs-type">tsanTarget</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Data.FastString.html#FastString"><span class="hs-identifier hs-type">FastString</span></a></span><span>     </span><span class="annot"><span class="hs-comment">-- ^ function name</span></span><span>
</span><span id="line-200"></span><span>           </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="GHC.Cmm.Type.html#ForeignHint"><span class="hs-identifier hs-type">ForeignHint</span></a></span><span class="hs-special">]</span><span>  </span><span class="annot"><span class="hs-comment">-- ^ formals</span></span><span>
</span><span id="line-201"></span><span>           </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="GHC.Cmm.Type.html#ForeignHint"><span class="hs-identifier hs-type">ForeignHint</span></a></span><span class="hs-special">]</span><span>  </span><span class="annot"><span class="hs-comment">-- ^ arguments</span></span><span>
</span><span id="line-202"></span><span>           </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Cmm.Node.html#ForeignTarget"><span class="hs-identifier hs-type">ForeignTarget</span></a></span><span>
</span><span id="line-203"></span><span id="tsanTarget"><span class="annot"><span class="annottext">tsanTarget :: FastString -&gt; [ForeignHint] -&gt; [ForeignHint] -&gt; ForeignTarget
</span><a href="GHC.Cmm.ThreadSanitizer.html#tsanTarget"><span class="hs-identifier hs-var hs-var">tsanTarget</span></a></span></span><span> </span><span id="local-6989586621682873462"><span class="annot"><span class="annottext">FastString
</span><a href="#local-6989586621682873462"><span class="hs-identifier hs-var">fn</span></a></span></span><span> </span><span id="local-6989586621682873463"><span class="annot"><span class="annottext">[ForeignHint]
</span><a href="#local-6989586621682873463"><span class="hs-identifier hs-var">formals</span></a></span></span><span> </span><span id="local-6989586621682873464"><span class="annot"><span class="annottext">[ForeignHint]
</span><a href="#local-6989586621682873464"><span class="hs-identifier hs-var">args</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-204"></span><span>    </span><span class="annot"><span class="annottext">CmmExpr -&gt; ForeignConvention -&gt; ForeignTarget
</span><a href="GHC.Cmm.Node.html#ForeignTarget"><span class="hs-identifier hs-var">ForeignTarget</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">CmmLit -&gt; CmmExpr
</span><a href="GHC.Cmm.Expr.html#CmmLit"><span class="hs-identifier hs-var">CmmLit</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">CLabel -&gt; CmmLit
</span><a href="GHC.Cmm.Expr.html#CmmLabel"><span class="hs-identifier hs-var">CmmLabel</span></a></span><span> </span><span class="annot"><span class="annottext">CLabel
</span><a href="#local-6989586621682873467"><span class="hs-identifier hs-var">lbl</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">ForeignConvention
</span><a href="#local-6989586621682873468"><span class="hs-identifier hs-var">conv</span></a></span><span>
</span><span id="line-205"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-206"></span><span>    </span><span id="local-6989586621682873468"><span class="annot"><span class="annottext">conv :: ForeignConvention
</span><a href="#local-6989586621682873468"><span class="hs-identifier hs-var hs-var">conv</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">CCallConv
-&gt; [ForeignHint]
-&gt; [ForeignHint]
-&gt; CmmReturnInfo
-&gt; ForeignConvention
</span><a href="GHC.Cmm.Node.html#ForeignConvention"><span class="hs-identifier hs-var">ForeignConvention</span></a></span><span> </span><span class="annot"><span class="annottext">CCallConv
</span><a href="GHC.Types.ForeignCall.html#CCallConv"><span class="hs-identifier hs-var">CCallConv</span></a></span><span> </span><span class="annot"><span class="annottext">[ForeignHint]
</span><a href="#local-6989586621682873464"><span class="hs-identifier hs-var">args</span></a></span><span> </span><span class="annot"><span class="annottext">[ForeignHint]
</span><a href="#local-6989586621682873463"><span class="hs-identifier hs-var">formals</span></a></span><span> </span><span class="annot"><span class="annottext">CmmReturnInfo
</span><a href="GHC.Cmm.Node.html#CmmMayReturn"><span class="hs-identifier hs-var">CmmMayReturn</span></a></span><span>
</span><span id="line-207"></span><span>    </span><span id="local-6989586621682873467"><span class="annot"><span class="annottext">lbl :: CLabel
</span><a href="#local-6989586621682873467"><span class="hs-identifier hs-var hs-var">lbl</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">FastString -&gt; ForeignLabelSource -&gt; FunctionOrData -&gt; CLabel
</span><a href="GHC.Cmm.CLabel.html#mkForeignLabel"><span class="hs-identifier hs-var">mkForeignLabel</span></a></span><span> </span><span class="annot"><span class="annottext">FastString
</span><a href="#local-6989586621682873462"><span class="hs-identifier hs-var">fn</span></a></span><span> </span><span class="annot"><span class="annottext">ForeignLabelSource
</span><a href="GHC.Cmm.CLabel.html#ForeignLabelInExternalPackage"><span class="hs-identifier hs-var">ForeignLabelInExternalPackage</span></a></span><span> </span><span class="annot"><span class="annottext">FunctionOrData
</span><a href="GHC.Types.Basic.html#IsFunction"><span class="hs-identifier hs-var">IsFunction</span></a></span><span>
</span><span id="line-208"></span><span>
</span><span id="line-209"></span><span class="annot"><a href="GHC.Cmm.ThreadSanitizer.html#tsanStore"><span class="hs-identifier hs-type">tsanStore</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Cmm.ThreadSanitizer.html#Env"><span class="hs-identifier hs-type">Env</span></a></span><span>
</span><span id="line-210"></span><span>          </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Cmm.Type.html#CmmType"><span class="hs-identifier hs-type">CmmType</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Cmm.Expr.html#CmmExpr"><span class="hs-identifier hs-type">CmmExpr</span></a></span><span>
</span><span id="line-211"></span><span>          </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Cmm.Dataflow.Block.html#Block"><span class="hs-identifier hs-type">Block</span></a></span><span> </span><span class="annot"><a href="GHC.Cmm.Node.html#CmmNode"><span class="hs-identifier hs-type">CmmNode</span></a></span><span> </span><span class="annot"><a href="GHC.Cmm.Dataflow.Block.html#O"><span class="hs-identifier hs-type">O</span></a></span><span> </span><span class="annot"><a href="GHC.Cmm.Dataflow.Block.html#O"><span class="hs-identifier hs-type">O</span></a></span><span>
</span><span id="line-212"></span><span id="tsanStore"><span class="annot"><span class="annottext">tsanStore :: Env -&gt; CmmType -&gt; CmmExpr -&gt; Block CmmNode 'Open 'Open
</span><a href="GHC.Cmm.ThreadSanitizer.html#tsanStore"><span class="hs-identifier hs-var hs-var">tsanStore</span></a></span></span><span> </span><span id="local-6989586621682873475"><span class="annot"><span class="annottext">Env
</span><a href="#local-6989586621682873475"><span class="hs-identifier hs-var">env</span></a></span></span><span> </span><span id="local-6989586621682873476"><span class="annot"><span class="annottext">CmmType
</span><a href="#local-6989586621682873476"><span class="hs-identifier hs-var">ty</span></a></span></span><span> </span><span id="local-6989586621682873477"><span class="annot"><span class="annottext">CmmExpr
</span><a href="#local-6989586621682873477"><span class="hs-identifier hs-var">addr</span></a></span></span><span>
</span><span id="line-213"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">CmmType -&gt; Width
</span><a href="GHC.Cmm.Type.html#typeWidth"><span class="hs-identifier hs-var">typeWidth</span></a></span><span> </span><span class="annot"><span class="annottext">CmmType
</span><a href="#local-6989586621682873476"><span class="hs-identifier hs-var">ty</span></a></span><span> </span><span class="annot"><span class="annottext">Width -&gt; Width -&gt; Bool
forall a. Ord a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">&lt;</span></span><span> </span><span class="annot"><span class="annottext">Width
</span><a href="GHC.Cmm.Type.html#W128"><span class="hs-identifier hs-var">W128</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Env
-&gt; ForeignTarget
-&gt; [CmmFormal]
-&gt; [CmmExpr]
-&gt; Block CmmNode 'Open 'Open
</span><a href="GHC.Cmm.ThreadSanitizer.html#mkUnsafeCall"><span class="hs-identifier hs-var">mkUnsafeCall</span></a></span><span> </span><span class="annot"><span class="annottext">Env
</span><a href="#local-6989586621682873475"><span class="hs-identifier hs-var">env</span></a></span><span> </span><span class="annot"><span class="annottext">ForeignTarget
</span><a href="#local-6989586621682873481"><span class="hs-identifier hs-var">ftarget</span></a></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">CmmExpr
</span><a href="#local-6989586621682873477"><span class="hs-identifier hs-var">addr</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-214"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">otherwise</span></span><span>           </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Block CmmNode 'Open 'Open
forall (n :: Extensibility -&gt; Extensibility -&gt; *).
Block n 'Open 'Open
</span><a href="GHC.Cmm.Dataflow.Block.html#emptyBlock"><span class="hs-identifier hs-var">emptyBlock</span></a></span><span>
</span><span id="line-215"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-216"></span><span>    </span><span id="local-6989586621682873481"><span class="annot"><span class="annottext">ftarget :: ForeignTarget
</span><a href="#local-6989586621682873481"><span class="hs-identifier hs-var hs-var">ftarget</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">FastString -&gt; [ForeignHint] -&gt; [ForeignHint] -&gt; ForeignTarget
</span><a href="GHC.Cmm.ThreadSanitizer.html#tsanTarget"><span class="hs-identifier hs-var">tsanTarget</span></a></span><span> </span><span class="annot"><span class="annottext">FastString
</span><a href="#local-6989586621682873483"><span class="hs-identifier hs-var">fn</span></a></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">ForeignHint
</span><a href="GHC.Cmm.Type.html#AddrHint"><span class="hs-identifier hs-var">AddrHint</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-217"></span><span>    </span><span id="local-6989586621682873485"><span class="annot"><span class="annottext">w :: Int
</span><a href="#local-6989586621682873485"><span class="hs-identifier hs-var hs-var">w</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Width -&gt; Int
</span><a href="GHC.Cmm.Type.html#widthInBytes"><span class="hs-identifier hs-var">widthInBytes</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">CmmType -&gt; Width
</span><a href="GHC.Cmm.Type.html#typeWidth"><span class="hs-identifier hs-var">typeWidth</span></a></span><span> </span><span class="annot"><span class="annottext">CmmType
</span><a href="#local-6989586621682873476"><span class="hs-identifier hs-var">ty</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-218"></span><span>    </span><span id="local-6989586621682873483"><span class="annot"><span class="annottext">fn :: FastString
</span><a href="#local-6989586621682873483"><span class="hs-identifier hs-var hs-var">fn</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">String -&gt; FastString
</span><a href="GHC.Data.FastString.html#fsLit"><span class="hs-identifier hs-var">fsLit</span></a></span><span> </span><span class="annot"><span class="annottext">(String -&gt; FastString) -&gt; String -&gt; FastString
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;__tsan_write&quot;</span></span><span> </span><span class="annot"><span class="annottext">String -&gt; String -&gt; String
forall a. [a] -&gt; [a] -&gt; [a]
</span><span class="hs-operator hs-var">++</span></span><span> </span><span class="annot"><span class="annottext">Int -&gt; String
forall a. Show a =&gt; a -&gt; String
</span><span class="hs-identifier hs-var">show</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621682873485"><span class="hs-identifier hs-var">w</span></a></span><span>
</span><span id="line-219"></span><span>
</span><span id="line-220"></span><span class="annot"><a href="GHC.Cmm.ThreadSanitizer.html#tsanLoad"><span class="hs-identifier hs-type">tsanLoad</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Cmm.ThreadSanitizer.html#Env"><span class="hs-identifier hs-type">Env</span></a></span><span>
</span><span id="line-221"></span><span>         </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Cmm.Expr.html#AlignmentSpec"><span class="hs-identifier hs-type">AlignmentSpec</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Cmm.Type.html#CmmType"><span class="hs-identifier hs-type">CmmType</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Cmm.Expr.html#CmmExpr"><span class="hs-identifier hs-type">CmmExpr</span></a></span><span>
</span><span id="line-222"></span><span>         </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Cmm.Dataflow.Block.html#Block"><span class="hs-identifier hs-type">Block</span></a></span><span> </span><span class="annot"><a href="GHC.Cmm.Node.html#CmmNode"><span class="hs-identifier hs-type">CmmNode</span></a></span><span> </span><span class="annot"><a href="GHC.Cmm.Dataflow.Block.html#O"><span class="hs-identifier hs-type">O</span></a></span><span> </span><span class="annot"><a href="GHC.Cmm.Dataflow.Block.html#O"><span class="hs-identifier hs-type">O</span></a></span><span>
</span><span id="line-223"></span><span id="tsanLoad"><span class="annot"><span class="annottext">tsanLoad :: Env
-&gt; AlignmentSpec -&gt; CmmType -&gt; CmmExpr -&gt; Block CmmNode 'Open 'Open
</span><a href="GHC.Cmm.ThreadSanitizer.html#tsanLoad"><span class="hs-identifier hs-var hs-var">tsanLoad</span></a></span></span><span> </span><span id="local-6989586621682873489"><span class="annot"><span class="annottext">Env
</span><a href="#local-6989586621682873489"><span class="hs-identifier hs-var">env</span></a></span></span><span> </span><span id="local-6989586621682873490"><span class="annot"><span class="annottext">AlignmentSpec
</span><a href="#local-6989586621682873490"><span class="hs-identifier hs-var">align</span></a></span></span><span> </span><span id="local-6989586621682873491"><span class="annot"><span class="annottext">CmmType
</span><a href="#local-6989586621682873491"><span class="hs-identifier hs-var">ty</span></a></span></span><span> </span><span id="local-6989586621682873492"><span class="annot"><span class="annottext">CmmExpr
</span><a href="#local-6989586621682873492"><span class="hs-identifier hs-var">addr</span></a></span></span><span>
</span><span id="line-224"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">CmmType -&gt; Width
</span><a href="GHC.Cmm.Type.html#typeWidth"><span class="hs-identifier hs-var">typeWidth</span></a></span><span> </span><span class="annot"><span class="annottext">CmmType
</span><a href="#local-6989586621682873491"><span class="hs-identifier hs-var">ty</span></a></span><span> </span><span class="annot"><span class="annottext">Width -&gt; Width -&gt; Bool
forall a. Ord a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">&lt;</span></span><span> </span><span class="annot"><span class="annottext">Width
</span><a href="GHC.Cmm.Type.html#W128"><span class="hs-identifier hs-var">W128</span></a></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Env
-&gt; ForeignTarget
-&gt; [CmmFormal]
-&gt; [CmmExpr]
-&gt; Block CmmNode 'Open 'Open
</span><a href="GHC.Cmm.ThreadSanitizer.html#mkUnsafeCall"><span class="hs-identifier hs-var">mkUnsafeCall</span></a></span><span> </span><span class="annot"><span class="annottext">Env
</span><a href="#local-6989586621682873489"><span class="hs-identifier hs-var">env</span></a></span><span> </span><span class="annot"><span class="annottext">ForeignTarget
</span><a href="#local-6989586621682873493"><span class="hs-identifier hs-var">ftarget</span></a></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">CmmExpr
</span><a href="#local-6989586621682873492"><span class="hs-identifier hs-var">addr</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-225"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">otherwise</span></span><span>            </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Block CmmNode 'Open 'Open
forall (n :: Extensibility -&gt; Extensibility -&gt; *).
Block n 'Open 'Open
</span><a href="GHC.Cmm.Dataflow.Block.html#emptyBlock"><span class="hs-identifier hs-var">emptyBlock</span></a></span><span>
</span><span id="line-226"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-227"></span><span>    </span><span id="local-6989586621682873493"><span class="annot"><span class="annottext">ftarget :: ForeignTarget
</span><a href="#local-6989586621682873493"><span class="hs-identifier hs-var hs-var">ftarget</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">FastString -&gt; [ForeignHint] -&gt; [ForeignHint] -&gt; ForeignTarget
</span><a href="GHC.Cmm.ThreadSanitizer.html#tsanTarget"><span class="hs-identifier hs-var">tsanTarget</span></a></span><span> </span><span class="annot"><span class="annottext">FastString
</span><a href="#local-6989586621682873494"><span class="hs-identifier hs-var">fn</span></a></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">ForeignHint
</span><a href="GHC.Cmm.Type.html#AddrHint"><span class="hs-identifier hs-var">AddrHint</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-228"></span><span>    </span><span id="local-6989586621682873495"><span class="annot"><span class="annottext">w :: Int
</span><a href="#local-6989586621682873495"><span class="hs-identifier hs-var hs-var">w</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Width -&gt; Int
</span><a href="GHC.Cmm.Type.html#widthInBytes"><span class="hs-identifier hs-var">widthInBytes</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">CmmType -&gt; Width
</span><a href="GHC.Cmm.Type.html#typeWidth"><span class="hs-identifier hs-var">typeWidth</span></a></span><span> </span><span class="annot"><span class="annottext">CmmType
</span><a href="#local-6989586621682873491"><span class="hs-identifier hs-var">ty</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-229"></span><span>    </span><span id="local-6989586621682873494"><span class="annot"><span class="annottext">fn :: FastString
</span><a href="#local-6989586621682873494"><span class="hs-identifier hs-var hs-var">fn</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">AlignmentSpec
</span><a href="#local-6989586621682873490"><span class="hs-identifier hs-var">align</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-230"></span><span>           </span><span class="annot"><span class="annottext">AlignmentSpec
</span><a href="GHC.Cmm.Expr.html#Unaligned"><span class="hs-identifier hs-var">Unaligned</span></a></span><span>
</span><span id="line-231"></span><span>             </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621682873495"><span class="hs-identifier hs-var">w</span></a></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Bool
forall a. Ord a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">&gt;</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">1</span></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">String -&gt; FastString
</span><a href="GHC.Data.FastString.html#fsLit"><span class="hs-identifier hs-var">fsLit</span></a></span><span> </span><span class="annot"><span class="annottext">(String -&gt; FastString) -&gt; String -&gt; FastString
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;__tsan_unaligned_read&quot;</span></span><span> </span><span class="annot"><span class="annottext">String -&gt; String -&gt; String
forall a. [a] -&gt; [a] -&gt; [a]
</span><span class="hs-operator hs-var">++</span></span><span> </span><span class="annot"><span class="annottext">Int -&gt; String
forall a. Show a =&gt; a -&gt; String
</span><span class="hs-identifier hs-var">show</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621682873495"><span class="hs-identifier hs-var">w</span></a></span><span>
</span><span id="line-232"></span><span>           </span><span class="annot"><span class="annottext">AlignmentSpec
</span><span class="hs-identifier">_</span></span><span>            </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">String -&gt; FastString
</span><a href="GHC.Data.FastString.html#fsLit"><span class="hs-identifier hs-var">fsLit</span></a></span><span> </span><span class="annot"><span class="annottext">(String -&gt; FastString) -&gt; String -&gt; FastString
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;__tsan_read&quot;</span></span><span> </span><span class="annot"><span class="annottext">String -&gt; String -&gt; String
forall a. [a] -&gt; [a] -&gt; [a]
</span><span class="hs-operator hs-var">++</span></span><span> </span><span class="annot"><span class="annottext">Int -&gt; String
forall a. Show a =&gt; a -&gt; String
</span><span class="hs-identifier hs-var">show</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621682873495"><span class="hs-identifier hs-var">w</span></a></span><span>
</span><span id="line-233"></span><span>
</span><span id="line-234"></span><span class="annot"><a href="GHC.Cmm.ThreadSanitizer.html#tsanAtomicStore"><span class="hs-identifier hs-type">tsanAtomicStore</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Cmm.ThreadSanitizer.html#Env"><span class="hs-identifier hs-type">Env</span></a></span><span>
</span><span id="line-235"></span><span>                </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Cmm.MachOp.html#MemoryOrdering"><span class="hs-identifier hs-type">MemoryOrdering</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Cmm.Type.html#Width"><span class="hs-identifier hs-type">Width</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Cmm.Expr.html#CmmExpr"><span class="hs-identifier hs-type">CmmExpr</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Cmm.Expr.html#CmmExpr"><span class="hs-identifier hs-type">CmmExpr</span></a></span><span>
</span><span id="line-236"></span><span>                </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Cmm.Dataflow.Block.html#Block"><span class="hs-identifier hs-type">Block</span></a></span><span> </span><span class="annot"><a href="GHC.Cmm.Node.html#CmmNode"><span class="hs-identifier hs-type">CmmNode</span></a></span><span> </span><span class="annot"><a href="GHC.Cmm.Dataflow.Block.html#O"><span class="hs-identifier hs-type">O</span></a></span><span> </span><span class="annot"><a href="GHC.Cmm.Dataflow.Block.html#O"><span class="hs-identifier hs-type">O</span></a></span><span>
</span><span id="line-237"></span><span id="tsanAtomicStore"><span class="annot"><span class="annottext">tsanAtomicStore :: Env
-&gt; MemoryOrdering
-&gt; Width
-&gt; CmmExpr
-&gt; CmmExpr
-&gt; Block CmmNode 'Open 'Open
</span><a href="GHC.Cmm.ThreadSanitizer.html#tsanAtomicStore"><span class="hs-identifier hs-var hs-var">tsanAtomicStore</span></a></span></span><span> </span><span id="local-6989586621682873497"><span class="annot"><span class="annottext">Env
</span><a href="#local-6989586621682873497"><span class="hs-identifier hs-var">env</span></a></span></span><span> </span><span id="local-6989586621682873498"><span class="annot"><span class="annottext">MemoryOrdering
</span><a href="#local-6989586621682873498"><span class="hs-identifier hs-var">mord</span></a></span></span><span> </span><span id="local-6989586621682873499"><span class="annot"><span class="annottext">Width
</span><a href="#local-6989586621682873499"><span class="hs-identifier hs-var">w</span></a></span></span><span> </span><span id="local-6989586621682873500"><span class="annot"><span class="annottext">CmmExpr
</span><a href="#local-6989586621682873500"><span class="hs-identifier hs-var">val</span></a></span></span><span> </span><span id="local-6989586621682873501"><span class="annot"><span class="annottext">CmmExpr
</span><a href="#local-6989586621682873501"><span class="hs-identifier hs-var">addr</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-238"></span><span>    </span><span class="annot"><span class="annottext">Env
-&gt; ForeignTarget
-&gt; [CmmFormal]
-&gt; [CmmExpr]
-&gt; Block CmmNode 'Open 'Open
</span><a href="GHC.Cmm.ThreadSanitizer.html#mkUnsafeCall"><span class="hs-identifier hs-var">mkUnsafeCall</span></a></span><span> </span><span class="annot"><span class="annottext">Env
</span><a href="#local-6989586621682873497"><span class="hs-identifier hs-var">env</span></a></span><span> </span><span class="annot"><span class="annottext">ForeignTarget
</span><a href="#local-6989586621682873502"><span class="hs-identifier hs-var">ftarget</span></a></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">CmmExpr
</span><a href="#local-6989586621682873501"><span class="hs-identifier hs-var">addr</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">CmmExpr
</span><a href="#local-6989586621682873500"><span class="hs-identifier hs-var">val</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">CmmExpr
</span><a href="#local-6989586621682873503"><span class="hs-identifier hs-var">mord'</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-239"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-240"></span><span>    </span><span id="local-6989586621682873503"><span class="annot"><span class="annottext">mord' :: CmmExpr
</span><a href="#local-6989586621682873503"><span class="hs-identifier hs-var hs-var">mord'</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Env -&gt; MemoryOrdering -&gt; CmmExpr
</span><a href="GHC.Cmm.ThreadSanitizer.html#memoryOrderToTsanMemoryOrder"><span class="hs-identifier hs-var">memoryOrderToTsanMemoryOrder</span></a></span><span> </span><span class="annot"><span class="annottext">Env
</span><a href="#local-6989586621682873497"><span class="hs-identifier hs-var">env</span></a></span><span> </span><span class="annot"><span class="annottext">MemoryOrdering
</span><a href="#local-6989586621682873498"><span class="hs-identifier hs-var">mord</span></a></span><span>
</span><span id="line-241"></span><span>    </span><span id="local-6989586621682873502"><span class="annot"><span class="annottext">ftarget :: ForeignTarget
</span><a href="#local-6989586621682873502"><span class="hs-identifier hs-var hs-var">ftarget</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">FastString -&gt; [ForeignHint] -&gt; [ForeignHint] -&gt; ForeignTarget
</span><a href="GHC.Cmm.ThreadSanitizer.html#tsanTarget"><span class="hs-identifier hs-var">tsanTarget</span></a></span><span> </span><span class="annot"><span class="annottext">FastString
</span><a href="#local-6989586621682873504"><span class="hs-identifier hs-var">fn</span></a></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">ForeignHint
</span><a href="GHC.Cmm.Type.html#AddrHint"><span class="hs-identifier hs-var">AddrHint</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">ForeignHint
</span><a href="GHC.Cmm.Type.html#NoHint"><span class="hs-identifier hs-var">NoHint</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">ForeignHint
</span><a href="GHC.Cmm.Type.html#NoHint"><span class="hs-identifier hs-var">NoHint</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-242"></span><span>    </span><span id="local-6989586621682873504"><span class="annot"><span class="annottext">fn :: FastString
</span><a href="#local-6989586621682873504"><span class="hs-identifier hs-var hs-var">fn</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">String -&gt; FastString
</span><a href="GHC.Data.FastString.html#fsLit"><span class="hs-identifier hs-var">fsLit</span></a></span><span> </span><span class="annot"><span class="annottext">(String -&gt; FastString) -&gt; String -&gt; FastString
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;__tsan_atomic&quot;</span></span><span> </span><span class="annot"><span class="annottext">String -&gt; String -&gt; String
forall a. [a] -&gt; [a] -&gt; [a]
</span><span class="hs-operator hs-var">++</span></span><span> </span><span class="annot"><span class="annottext">Int -&gt; String
forall a. Show a =&gt; a -&gt; String
</span><span class="hs-identifier hs-var">show</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Width -&gt; Int
</span><a href="GHC.Cmm.Type.html#widthInBits"><span class="hs-identifier hs-var">widthInBits</span></a></span><span> </span><span class="annot"><span class="annottext">Width
</span><a href="#local-6989586621682873499"><span class="hs-identifier hs-var">w</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">String -&gt; String -&gt; String
forall a. [a] -&gt; [a] -&gt; [a]
</span><span class="hs-operator hs-var">++</span></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;_store&quot;</span></span><span>
</span><span id="line-243"></span><span>
</span><span id="line-244"></span><span class="annot"><a href="GHC.Cmm.ThreadSanitizer.html#tsanAtomicLoad"><span class="hs-identifier hs-type">tsanAtomicLoad</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Cmm.ThreadSanitizer.html#Env"><span class="hs-identifier hs-type">Env</span></a></span><span>
</span><span id="line-245"></span><span>               </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Cmm.MachOp.html#MemoryOrdering"><span class="hs-identifier hs-type">MemoryOrdering</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Cmm.Type.html#Width"><span class="hs-identifier hs-type">Width</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Cmm.Expr.html#CmmExpr"><span class="hs-identifier hs-type">CmmExpr</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Cmm.Reg.html#LocalReg"><span class="hs-identifier hs-type">LocalReg</span></a></span><span>
</span><span id="line-246"></span><span>               </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Cmm.Dataflow.Block.html#Block"><span class="hs-identifier hs-type">Block</span></a></span><span> </span><span class="annot"><a href="GHC.Cmm.Node.html#CmmNode"><span class="hs-identifier hs-type">CmmNode</span></a></span><span> </span><span class="annot"><a href="GHC.Cmm.Dataflow.Block.html#O"><span class="hs-identifier hs-type">O</span></a></span><span> </span><span class="annot"><a href="GHC.Cmm.Dataflow.Block.html#O"><span class="hs-identifier hs-type">O</span></a></span><span>
</span><span id="line-247"></span><span id="tsanAtomicLoad"><span class="annot"><span class="annottext">tsanAtomicLoad :: Env
-&gt; MemoryOrdering
-&gt; Width
-&gt; CmmExpr
-&gt; CmmFormal
-&gt; Block CmmNode 'Open 'Open
</span><a href="GHC.Cmm.ThreadSanitizer.html#tsanAtomicLoad"><span class="hs-identifier hs-var hs-var">tsanAtomicLoad</span></a></span></span><span> </span><span id="local-6989586621682873508"><span class="annot"><span class="annottext">Env
</span><a href="#local-6989586621682873508"><span class="hs-identifier hs-var">env</span></a></span></span><span> </span><span id="local-6989586621682873509"><span class="annot"><span class="annottext">MemoryOrdering
</span><a href="#local-6989586621682873509"><span class="hs-identifier hs-var">mord</span></a></span></span><span> </span><span id="local-6989586621682873510"><span class="annot"><span class="annottext">Width
</span><a href="#local-6989586621682873510"><span class="hs-identifier hs-var">w</span></a></span></span><span> </span><span id="local-6989586621682873511"><span class="annot"><span class="annottext">CmmExpr
</span><a href="#local-6989586621682873511"><span class="hs-identifier hs-var">addr</span></a></span></span><span> </span><span id="local-6989586621682873512"><span class="annot"><span class="annottext">CmmFormal
</span><a href="#local-6989586621682873512"><span class="hs-identifier hs-var">dest</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-248"></span><span>    </span><span class="annot"><span class="annottext">Env
-&gt; ForeignTarget
-&gt; [CmmFormal]
-&gt; [CmmExpr]
-&gt; Block CmmNode 'Open 'Open
</span><a href="GHC.Cmm.ThreadSanitizer.html#mkUnsafeCall"><span class="hs-identifier hs-var">mkUnsafeCall</span></a></span><span> </span><span class="annot"><span class="annottext">Env
</span><a href="#local-6989586621682873508"><span class="hs-identifier hs-var">env</span></a></span><span> </span><span class="annot"><span class="annottext">ForeignTarget
</span><a href="#local-6989586621682873513"><span class="hs-identifier hs-var">ftarget</span></a></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">CmmFormal
</span><a href="#local-6989586621682873512"><span class="hs-identifier hs-var">dest</span></a></span><span class="hs-special">]</span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">CmmExpr
</span><a href="#local-6989586621682873511"><span class="hs-identifier hs-var">addr</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">CmmExpr
</span><a href="#local-6989586621682873514"><span class="hs-identifier hs-var">mord'</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-249"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-250"></span><span>    </span><span id="local-6989586621682873514"><span class="annot"><span class="annottext">mord' :: CmmExpr
</span><a href="#local-6989586621682873514"><span class="hs-identifier hs-var hs-var">mord'</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Env -&gt; MemoryOrdering -&gt; CmmExpr
</span><a href="GHC.Cmm.ThreadSanitizer.html#memoryOrderToTsanMemoryOrder"><span class="hs-identifier hs-var">memoryOrderToTsanMemoryOrder</span></a></span><span> </span><span class="annot"><span class="annottext">Env
</span><a href="#local-6989586621682873508"><span class="hs-identifier hs-var">env</span></a></span><span> </span><span class="annot"><span class="annottext">MemoryOrdering
</span><a href="#local-6989586621682873509"><span class="hs-identifier hs-var">mord</span></a></span><span>
</span><span id="line-251"></span><span>    </span><span id="local-6989586621682873513"><span class="annot"><span class="annottext">ftarget :: ForeignTarget
</span><a href="#local-6989586621682873513"><span class="hs-identifier hs-var hs-var">ftarget</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">FastString -&gt; [ForeignHint] -&gt; [ForeignHint] -&gt; ForeignTarget
</span><a href="GHC.Cmm.ThreadSanitizer.html#tsanTarget"><span class="hs-identifier hs-var">tsanTarget</span></a></span><span> </span><span class="annot"><span class="annottext">FastString
</span><a href="#local-6989586621682873515"><span class="hs-identifier hs-var">fn</span></a></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">ForeignHint
</span><a href="GHC.Cmm.Type.html#NoHint"><span class="hs-identifier hs-var">NoHint</span></a></span><span class="hs-special">]</span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">ForeignHint
</span><a href="GHC.Cmm.Type.html#AddrHint"><span class="hs-identifier hs-var">AddrHint</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">ForeignHint
</span><a href="GHC.Cmm.Type.html#NoHint"><span class="hs-identifier hs-var">NoHint</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-252"></span><span>    </span><span id="local-6989586621682873515"><span class="annot"><span class="annottext">fn :: FastString
</span><a href="#local-6989586621682873515"><span class="hs-identifier hs-var hs-var">fn</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">String -&gt; FastString
</span><a href="GHC.Data.FastString.html#fsLit"><span class="hs-identifier hs-var">fsLit</span></a></span><span> </span><span class="annot"><span class="annottext">(String -&gt; FastString) -&gt; String -&gt; FastString
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;__tsan_atomic&quot;</span></span><span> </span><span class="annot"><span class="annottext">String -&gt; String -&gt; String
forall a. [a] -&gt; [a] -&gt; [a]
</span><span class="hs-operator hs-var">++</span></span><span> </span><span class="annot"><span class="annottext">Int -&gt; String
forall a. Show a =&gt; a -&gt; String
</span><span class="hs-identifier hs-var">show</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Width -&gt; Int
</span><a href="GHC.Cmm.Type.html#widthInBits"><span class="hs-identifier hs-var">widthInBits</span></a></span><span> </span><span class="annot"><span class="annottext">Width
</span><a href="#local-6989586621682873510"><span class="hs-identifier hs-var">w</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">String -&gt; String -&gt; String
forall a. [a] -&gt; [a] -&gt; [a]
</span><span class="hs-operator hs-var">++</span></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;_load&quot;</span></span><span>
</span><span id="line-253"></span><span>
</span><span id="line-254"></span><span class="annot"><a href="GHC.Cmm.ThreadSanitizer.html#tsanAtomicExchange"><span class="hs-identifier hs-type">tsanAtomicExchange</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Cmm.ThreadSanitizer.html#Env"><span class="hs-identifier hs-type">Env</span></a></span><span>
</span><span id="line-255"></span><span>                   </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Cmm.MachOp.html#MemoryOrdering"><span class="hs-identifier hs-type">MemoryOrdering</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Cmm.Type.html#Width"><span class="hs-identifier hs-type">Width</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Cmm.Expr.html#CmmExpr"><span class="hs-identifier hs-type">CmmExpr</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Cmm.Expr.html#CmmExpr"><span class="hs-identifier hs-type">CmmExpr</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Cmm.Reg.html#LocalReg"><span class="hs-identifier hs-type">LocalReg</span></a></span><span>
</span><span id="line-256"></span><span>                   </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Cmm.Dataflow.Block.html#Block"><span class="hs-identifier hs-type">Block</span></a></span><span> </span><span class="annot"><a href="GHC.Cmm.Node.html#CmmNode"><span class="hs-identifier hs-type">CmmNode</span></a></span><span> </span><span class="annot"><a href="GHC.Cmm.Dataflow.Block.html#O"><span class="hs-identifier hs-type">O</span></a></span><span> </span><span class="annot"><a href="GHC.Cmm.Dataflow.Block.html#O"><span class="hs-identifier hs-type">O</span></a></span><span>
</span><span id="line-257"></span><span id="tsanAtomicExchange"><span class="annot"><span class="annottext">tsanAtomicExchange :: Env
-&gt; MemoryOrdering
-&gt; Width
-&gt; CmmExpr
-&gt; CmmExpr
-&gt; CmmFormal
-&gt; Block CmmNode 'Open 'Open
</span><a href="GHC.Cmm.ThreadSanitizer.html#tsanAtomicExchange"><span class="hs-identifier hs-var hs-var">tsanAtomicExchange</span></a></span></span><span> </span><span id="local-6989586621682873516"><span class="annot"><span class="annottext">Env
</span><a href="#local-6989586621682873516"><span class="hs-identifier hs-var">env</span></a></span></span><span> </span><span id="local-6989586621682873517"><span class="annot"><span class="annottext">MemoryOrdering
</span><a href="#local-6989586621682873517"><span class="hs-identifier hs-var">mord</span></a></span></span><span> </span><span id="local-6989586621682873518"><span class="annot"><span class="annottext">Width
</span><a href="#local-6989586621682873518"><span class="hs-identifier hs-var">w</span></a></span></span><span> </span><span id="local-6989586621682873519"><span class="annot"><span class="annottext">CmmExpr
</span><a href="#local-6989586621682873519"><span class="hs-identifier hs-var">val</span></a></span></span><span> </span><span id="local-6989586621682873520"><span class="annot"><span class="annottext">CmmExpr
</span><a href="#local-6989586621682873520"><span class="hs-identifier hs-var">addr</span></a></span></span><span> </span><span id="local-6989586621682873521"><span class="annot"><span class="annottext">CmmFormal
</span><a href="#local-6989586621682873521"><span class="hs-identifier hs-var">dest</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-258"></span><span>    </span><span class="annot"><span class="annottext">Env
-&gt; ForeignTarget
-&gt; [CmmFormal]
-&gt; [CmmExpr]
-&gt; Block CmmNode 'Open 'Open
</span><a href="GHC.Cmm.ThreadSanitizer.html#mkUnsafeCall"><span class="hs-identifier hs-var">mkUnsafeCall</span></a></span><span> </span><span class="annot"><span class="annottext">Env
</span><a href="#local-6989586621682873516"><span class="hs-identifier hs-var">env</span></a></span><span> </span><span class="annot"><span class="annottext">ForeignTarget
</span><a href="#local-6989586621682873522"><span class="hs-identifier hs-var">ftarget</span></a></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">CmmFormal
</span><a href="#local-6989586621682873521"><span class="hs-identifier hs-var">dest</span></a></span><span class="hs-special">]</span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">CmmExpr
</span><a href="#local-6989586621682873520"><span class="hs-identifier hs-var">addr</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">CmmExpr
</span><a href="#local-6989586621682873519"><span class="hs-identifier hs-var">val</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">CmmExpr
</span><a href="#local-6989586621682873523"><span class="hs-identifier hs-var">mord'</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-259"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-260"></span><span>    </span><span id="local-6989586621682873523"><span class="annot"><span class="annottext">mord' :: CmmExpr
</span><a href="#local-6989586621682873523"><span class="hs-identifier hs-var hs-var">mord'</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Env -&gt; MemoryOrdering -&gt; CmmExpr
</span><a href="GHC.Cmm.ThreadSanitizer.html#memoryOrderToTsanMemoryOrder"><span class="hs-identifier hs-var">memoryOrderToTsanMemoryOrder</span></a></span><span> </span><span class="annot"><span class="annottext">Env
</span><a href="#local-6989586621682873516"><span class="hs-identifier hs-var">env</span></a></span><span> </span><span class="annot"><span class="annottext">MemoryOrdering
</span><a href="#local-6989586621682873517"><span class="hs-identifier hs-var">mord</span></a></span><span>
</span><span id="line-261"></span><span>    </span><span id="local-6989586621682873522"><span class="annot"><span class="annottext">ftarget :: ForeignTarget
</span><a href="#local-6989586621682873522"><span class="hs-identifier hs-var hs-var">ftarget</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">FastString -&gt; [ForeignHint] -&gt; [ForeignHint] -&gt; ForeignTarget
</span><a href="GHC.Cmm.ThreadSanitizer.html#tsanTarget"><span class="hs-identifier hs-var">tsanTarget</span></a></span><span> </span><span class="annot"><span class="annottext">FastString
</span><a href="#local-6989586621682873524"><span class="hs-identifier hs-var">fn</span></a></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">ForeignHint
</span><a href="GHC.Cmm.Type.html#NoHint"><span class="hs-identifier hs-var">NoHint</span></a></span><span class="hs-special">]</span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">ForeignHint
</span><a href="GHC.Cmm.Type.html#AddrHint"><span class="hs-identifier hs-var">AddrHint</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">ForeignHint
</span><a href="GHC.Cmm.Type.html#NoHint"><span class="hs-identifier hs-var">NoHint</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">ForeignHint
</span><a href="GHC.Cmm.Type.html#NoHint"><span class="hs-identifier hs-var">NoHint</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-262"></span><span>    </span><span id="local-6989586621682873524"><span class="annot"><span class="annottext">fn :: FastString
</span><a href="#local-6989586621682873524"><span class="hs-identifier hs-var hs-var">fn</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">String -&gt; FastString
</span><a href="GHC.Data.FastString.html#fsLit"><span class="hs-identifier hs-var">fsLit</span></a></span><span> </span><span class="annot"><span class="annottext">(String -&gt; FastString) -&gt; String -&gt; FastString
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;__tsan_atomic&quot;</span></span><span> </span><span class="annot"><span class="annottext">String -&gt; String -&gt; String
forall a. [a] -&gt; [a] -&gt; [a]
</span><span class="hs-operator hs-var">++</span></span><span> </span><span class="annot"><span class="annottext">Int -&gt; String
forall a. Show a =&gt; a -&gt; String
</span><span class="hs-identifier hs-var">show</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Width -&gt; Int
</span><a href="GHC.Cmm.Type.html#widthInBits"><span class="hs-identifier hs-var">widthInBits</span></a></span><span> </span><span class="annot"><span class="annottext">Width
</span><a href="#local-6989586621682873518"><span class="hs-identifier hs-var">w</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">String -&gt; String -&gt; String
forall a. [a] -&gt; [a] -&gt; [a]
</span><span class="hs-operator hs-var">++</span></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;_exchange&quot;</span></span><span>
</span><span id="line-263"></span><span>
</span><span id="line-264"></span><span class="hs-comment">-- N.B. C11 CAS returns a boolean (to avoid the ABA problem) whereas Cmm's CAS</span><span>
</span><span id="line-265"></span><span class="hs-comment">-- returns the expected value. We use define a shim in the RTS to provide</span><span>
</span><span id="line-266"></span><span class="hs-comment">-- Cmm's semantics using the TSAN C11 primitive.</span><span>
</span><span id="line-267"></span><span class="annot"><a href="GHC.Cmm.ThreadSanitizer.html#tsanAtomicCas"><span class="hs-identifier hs-type">tsanAtomicCas</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Cmm.ThreadSanitizer.html#Env"><span class="hs-identifier hs-type">Env</span></a></span><span>
</span><span id="line-268"></span><span>              </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Cmm.MachOp.html#MemoryOrdering"><span class="hs-identifier hs-type">MemoryOrdering</span></a></span><span>  </span><span class="annot"><span class="hs-comment">-- ^ success ordering</span></span><span>
</span><span id="line-269"></span><span>              </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Cmm.MachOp.html#MemoryOrdering"><span class="hs-identifier hs-type">MemoryOrdering</span></a></span><span>  </span><span class="annot"><span class="hs-comment">-- ^ failure ordering</span></span><span>
</span><span id="line-270"></span><span>              </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Cmm.Type.html#Width"><span class="hs-identifier hs-type">Width</span></a></span><span>
</span><span id="line-271"></span><span>              </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Cmm.Expr.html#CmmExpr"><span class="hs-identifier hs-type">CmmExpr</span></a></span><span>         </span><span class="annot"><span class="hs-comment">-- ^ address</span></span><span>
</span><span id="line-272"></span><span>              </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Cmm.Expr.html#CmmExpr"><span class="hs-identifier hs-type">CmmExpr</span></a></span><span>         </span><span class="annot"><span class="hs-comment">-- ^ expected value</span></span><span>
</span><span id="line-273"></span><span>              </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Cmm.Expr.html#CmmExpr"><span class="hs-identifier hs-type">CmmExpr</span></a></span><span>         </span><span class="annot"><span class="hs-comment">-- ^ new value</span></span><span>
</span><span id="line-274"></span><span>              </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Cmm.Reg.html#LocalReg"><span class="hs-identifier hs-type">LocalReg</span></a></span><span>        </span><span class="annot"><span class="hs-comment">-- ^ result destination</span></span><span>
</span><span id="line-275"></span><span>              </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Cmm.Dataflow.Block.html#Block"><span class="hs-identifier hs-type">Block</span></a></span><span> </span><span class="annot"><a href="GHC.Cmm.Node.html#CmmNode"><span class="hs-identifier hs-type">CmmNode</span></a></span><span> </span><span class="annot"><a href="GHC.Cmm.Dataflow.Block.html#O"><span class="hs-identifier hs-type">O</span></a></span><span> </span><span class="annot"><a href="GHC.Cmm.Dataflow.Block.html#O"><span class="hs-identifier hs-type">O</span></a></span><span>
</span><span id="line-276"></span><span id="tsanAtomicCas"><span class="annot"><span class="annottext">tsanAtomicCas :: Env
-&gt; MemoryOrdering
-&gt; MemoryOrdering
-&gt; Width
-&gt; CmmExpr
-&gt; CmmExpr
-&gt; CmmExpr
-&gt; CmmFormal
-&gt; Block CmmNode 'Open 'Open
</span><a href="GHC.Cmm.ThreadSanitizer.html#tsanAtomicCas"><span class="hs-identifier hs-var hs-var">tsanAtomicCas</span></a></span></span><span> </span><span id="local-6989586621682873525"><span class="annot"><span class="annottext">Env
</span><a href="#local-6989586621682873525"><span class="hs-identifier hs-var">env</span></a></span></span><span> </span><span id="local-6989586621682873526"><span class="annot"><span class="annottext">MemoryOrdering
</span><a href="#local-6989586621682873526"><span class="hs-identifier hs-var">mord_success</span></a></span></span><span> </span><span id="local-6989586621682873527"><span class="annot"><span class="annottext">MemoryOrdering
</span><a href="#local-6989586621682873527"><span class="hs-identifier hs-var">mord_failure</span></a></span></span><span> </span><span id="local-6989586621682873528"><span class="annot"><span class="annottext">Width
</span><a href="#local-6989586621682873528"><span class="hs-identifier hs-var">w</span></a></span></span><span> </span><span id="local-6989586621682873529"><span class="annot"><span class="annottext">CmmExpr
</span><a href="#local-6989586621682873529"><span class="hs-identifier hs-var">addr</span></a></span></span><span> </span><span id="local-6989586621682873530"><span class="annot"><span class="annottext">CmmExpr
</span><a href="#local-6989586621682873530"><span class="hs-identifier hs-var">expected</span></a></span></span><span> </span><span id="local-6989586621682873531"><span class="annot"><span class="annottext">CmmExpr
</span><a href="#local-6989586621682873531"><span class="hs-identifier hs-var">new</span></a></span></span><span> </span><span id="local-6989586621682873532"><span class="annot"><span class="annottext">CmmFormal
</span><a href="#local-6989586621682873532"><span class="hs-identifier hs-var">dest</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-277"></span><span>    </span><span class="annot"><span class="annottext">Env
-&gt; ForeignTarget
-&gt; [CmmFormal]
-&gt; [CmmExpr]
-&gt; Block CmmNode 'Open 'Open
</span><a href="GHC.Cmm.ThreadSanitizer.html#mkUnsafeCall"><span class="hs-identifier hs-var">mkUnsafeCall</span></a></span><span> </span><span class="annot"><span class="annottext">Env
</span><a href="#local-6989586621682873525"><span class="hs-identifier hs-var">env</span></a></span><span> </span><span class="annot"><span class="annottext">ForeignTarget
</span><a href="#local-6989586621682873533"><span class="hs-identifier hs-var">ftarget</span></a></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">CmmFormal
</span><a href="#local-6989586621682873532"><span class="hs-identifier hs-var">dest</span></a></span><span class="hs-special">]</span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">CmmExpr
</span><a href="#local-6989586621682873529"><span class="hs-identifier hs-var">addr</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">CmmExpr
</span><a href="#local-6989586621682873530"><span class="hs-identifier hs-var">expected</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">CmmExpr
</span><a href="#local-6989586621682873531"><span class="hs-identifier hs-var">new</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">CmmExpr
</span><a href="#local-6989586621682873534"><span class="hs-identifier hs-var">mord_success'</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">CmmExpr
</span><a href="#local-6989586621682873535"><span class="hs-identifier hs-var">mord_failure'</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-278"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-279"></span><span>    </span><span id="local-6989586621682873534"><span class="annot"><span class="annottext">mord_success' :: CmmExpr
</span><a href="#local-6989586621682873534"><span class="hs-identifier hs-var hs-var">mord_success'</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Env -&gt; MemoryOrdering -&gt; CmmExpr
</span><a href="GHC.Cmm.ThreadSanitizer.html#memoryOrderToTsanMemoryOrder"><span class="hs-identifier hs-var">memoryOrderToTsanMemoryOrder</span></a></span><span> </span><span class="annot"><span class="annottext">Env
</span><a href="#local-6989586621682873525"><span class="hs-identifier hs-var">env</span></a></span><span> </span><span class="annot"><span class="annottext">MemoryOrdering
</span><a href="#local-6989586621682873526"><span class="hs-identifier hs-var">mord_success</span></a></span><span>
</span><span id="line-280"></span><span>    </span><span id="local-6989586621682873535"><span class="annot"><span class="annottext">mord_failure' :: CmmExpr
</span><a href="#local-6989586621682873535"><span class="hs-identifier hs-var hs-var">mord_failure'</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Env -&gt; MemoryOrdering -&gt; CmmExpr
</span><a href="GHC.Cmm.ThreadSanitizer.html#memoryOrderToTsanMemoryOrder"><span class="hs-identifier hs-var">memoryOrderToTsanMemoryOrder</span></a></span><span> </span><span class="annot"><span class="annottext">Env
</span><a href="#local-6989586621682873525"><span class="hs-identifier hs-var">env</span></a></span><span> </span><span class="annot"><span class="annottext">MemoryOrdering
</span><a href="#local-6989586621682873527"><span class="hs-identifier hs-var">mord_failure</span></a></span><span>
</span><span id="line-281"></span><span>    </span><span id="local-6989586621682873533"><span class="annot"><span class="annottext">ftarget :: ForeignTarget
</span><a href="#local-6989586621682873533"><span class="hs-identifier hs-var hs-var">ftarget</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">FastString -&gt; [ForeignHint] -&gt; [ForeignHint] -&gt; ForeignTarget
</span><a href="GHC.Cmm.ThreadSanitizer.html#tsanTarget"><span class="hs-identifier hs-var">tsanTarget</span></a></span><span> </span><span class="annot"><span class="annottext">FastString
</span><a href="#local-6989586621682873536"><span class="hs-identifier hs-var">fn</span></a></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">ForeignHint
</span><a href="GHC.Cmm.Type.html#NoHint"><span class="hs-identifier hs-var">NoHint</span></a></span><span class="hs-special">]</span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">ForeignHint
</span><a href="GHC.Cmm.Type.html#AddrHint"><span class="hs-identifier hs-var">AddrHint</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">ForeignHint
</span><a href="GHC.Cmm.Type.html#NoHint"><span class="hs-identifier hs-var">NoHint</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">ForeignHint
</span><a href="GHC.Cmm.Type.html#NoHint"><span class="hs-identifier hs-var">NoHint</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">ForeignHint
</span><a href="GHC.Cmm.Type.html#NoHint"><span class="hs-identifier hs-var">NoHint</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">ForeignHint
</span><a href="GHC.Cmm.Type.html#NoHint"><span class="hs-identifier hs-var">NoHint</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-282"></span><span>    </span><span id="local-6989586621682873536"><span class="annot"><span class="annottext">fn :: FastString
</span><a href="#local-6989586621682873536"><span class="hs-identifier hs-var hs-var">fn</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">String -&gt; FastString
</span><a href="GHC.Data.FastString.html#fsLit"><span class="hs-identifier hs-var">fsLit</span></a></span><span> </span><span class="annot"><span class="annottext">(String -&gt; FastString) -&gt; String -&gt; FastString
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;ghc_tsan_atomic&quot;</span></span><span> </span><span class="annot"><span class="annottext">String -&gt; String -&gt; String
forall a. [a] -&gt; [a] -&gt; [a]
</span><span class="hs-operator hs-var">++</span></span><span> </span><span class="annot"><span class="annottext">Int -&gt; String
forall a. Show a =&gt; a -&gt; String
</span><span class="hs-identifier hs-var">show</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Width -&gt; Int
</span><a href="GHC.Cmm.Type.html#widthInBits"><span class="hs-identifier hs-var">widthInBits</span></a></span><span> </span><span class="annot"><span class="annottext">Width
</span><a href="#local-6989586621682873528"><span class="hs-identifier hs-var">w</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">String -&gt; String -&gt; String
forall a. [a] -&gt; [a] -&gt; [a]
</span><span class="hs-operator hs-var">++</span></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;_compare_exchange&quot;</span></span><span>
</span><span id="line-283"></span><span>
</span><span id="line-284"></span><span class="annot"><a href="GHC.Cmm.ThreadSanitizer.html#tsanAtomicRMW"><span class="hs-identifier hs-type">tsanAtomicRMW</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Cmm.ThreadSanitizer.html#Env"><span class="hs-identifier hs-type">Env</span></a></span><span>
</span><span id="line-285"></span><span>              </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Cmm.MachOp.html#MemoryOrdering"><span class="hs-identifier hs-type">MemoryOrdering</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Cmm.MachOp.html#AtomicMachOp"><span class="hs-identifier hs-type">AtomicMachOp</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Cmm.Type.html#Width"><span class="hs-identifier hs-type">Width</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Cmm.Expr.html#CmmExpr"><span class="hs-identifier hs-type">CmmExpr</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Cmm.Expr.html#CmmExpr"><span class="hs-identifier hs-type">CmmExpr</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Cmm.Reg.html#LocalReg"><span class="hs-identifier hs-type">LocalReg</span></a></span><span>
</span><span id="line-286"></span><span>              </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Cmm.Dataflow.Block.html#Block"><span class="hs-identifier hs-type">Block</span></a></span><span> </span><span class="annot"><a href="GHC.Cmm.Node.html#CmmNode"><span class="hs-identifier hs-type">CmmNode</span></a></span><span> </span><span class="annot"><a href="GHC.Cmm.Dataflow.Block.html#O"><span class="hs-identifier hs-type">O</span></a></span><span> </span><span class="annot"><a href="GHC.Cmm.Dataflow.Block.html#O"><span class="hs-identifier hs-type">O</span></a></span><span>
</span><span id="line-287"></span><span id="tsanAtomicRMW"><span class="annot"><span class="annottext">tsanAtomicRMW :: Env
-&gt; MemoryOrdering
-&gt; AtomicMachOp
-&gt; Width
-&gt; CmmExpr
-&gt; CmmExpr
-&gt; CmmFormal
-&gt; Block CmmNode 'Open 'Open
</span><a href="GHC.Cmm.ThreadSanitizer.html#tsanAtomicRMW"><span class="hs-identifier hs-var hs-var">tsanAtomicRMW</span></a></span></span><span> </span><span id="local-6989586621682873537"><span class="annot"><span class="annottext">Env
</span><a href="#local-6989586621682873537"><span class="hs-identifier hs-var">env</span></a></span></span><span> </span><span id="local-6989586621682873538"><span class="annot"><span class="annottext">MemoryOrdering
</span><a href="#local-6989586621682873538"><span class="hs-identifier hs-var">mord</span></a></span></span><span> </span><span id="local-6989586621682873539"><span class="annot"><span class="annottext">AtomicMachOp
</span><a href="#local-6989586621682873539"><span class="hs-identifier hs-var">op</span></a></span></span><span> </span><span id="local-6989586621682873540"><span class="annot"><span class="annottext">Width
</span><a href="#local-6989586621682873540"><span class="hs-identifier hs-var">w</span></a></span></span><span> </span><span id="local-6989586621682873541"><span class="annot"><span class="annottext">CmmExpr
</span><a href="#local-6989586621682873541"><span class="hs-identifier hs-var">addr</span></a></span></span><span> </span><span id="local-6989586621682873542"><span class="annot"><span class="annottext">CmmExpr
</span><a href="#local-6989586621682873542"><span class="hs-identifier hs-var">val</span></a></span></span><span> </span><span id="local-6989586621682873543"><span class="annot"><span class="annottext">CmmFormal
</span><a href="#local-6989586621682873543"><span class="hs-identifier hs-var">dest</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-288"></span><span>    </span><span class="annot"><span class="annottext">Env
-&gt; ForeignTarget
-&gt; [CmmFormal]
-&gt; [CmmExpr]
-&gt; Block CmmNode 'Open 'Open
</span><a href="GHC.Cmm.ThreadSanitizer.html#mkUnsafeCall"><span class="hs-identifier hs-var">mkUnsafeCall</span></a></span><span> </span><span class="annot"><span class="annottext">Env
</span><a href="#local-6989586621682873537"><span class="hs-identifier hs-var">env</span></a></span><span> </span><span class="annot"><span class="annottext">ForeignTarget
</span><a href="#local-6989586621682873544"><span class="hs-identifier hs-var">ftarget</span></a></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">CmmFormal
</span><a href="#local-6989586621682873543"><span class="hs-identifier hs-var">dest</span></a></span><span class="hs-special">]</span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">CmmExpr
</span><a href="#local-6989586621682873541"><span class="hs-identifier hs-var">addr</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">CmmExpr
</span><a href="#local-6989586621682873542"><span class="hs-identifier hs-var">val</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">CmmExpr
</span><a href="#local-6989586621682873545"><span class="hs-identifier hs-var">mord'</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-289"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-290"></span><span>    </span><span id="local-6989586621682873545"><span class="annot"><span class="annottext">mord' :: CmmExpr
</span><a href="#local-6989586621682873545"><span class="hs-identifier hs-var hs-var">mord'</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Env -&gt; MemoryOrdering -&gt; CmmExpr
</span><a href="GHC.Cmm.ThreadSanitizer.html#memoryOrderToTsanMemoryOrder"><span class="hs-identifier hs-var">memoryOrderToTsanMemoryOrder</span></a></span><span> </span><span class="annot"><span class="annottext">Env
</span><a href="#local-6989586621682873537"><span class="hs-identifier hs-var">env</span></a></span><span> </span><span class="annot"><span class="annottext">MemoryOrdering
</span><a href="#local-6989586621682873538"><span class="hs-identifier hs-var">mord</span></a></span><span>
</span><span id="line-291"></span><span>    </span><span id="local-6989586621682873544"><span class="annot"><span class="annottext">ftarget :: ForeignTarget
</span><a href="#local-6989586621682873544"><span class="hs-identifier hs-var hs-var">ftarget</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">FastString -&gt; [ForeignHint] -&gt; [ForeignHint] -&gt; ForeignTarget
</span><a href="GHC.Cmm.ThreadSanitizer.html#tsanTarget"><span class="hs-identifier hs-var">tsanTarget</span></a></span><span> </span><span class="annot"><span class="annottext">FastString
</span><a href="#local-6989586621682873546"><span class="hs-identifier hs-var">fn</span></a></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">ForeignHint
</span><a href="GHC.Cmm.Type.html#NoHint"><span class="hs-identifier hs-var">NoHint</span></a></span><span class="hs-special">]</span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">ForeignHint
</span><a href="GHC.Cmm.Type.html#AddrHint"><span class="hs-identifier hs-var">AddrHint</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">ForeignHint
</span><a href="GHC.Cmm.Type.html#NoHint"><span class="hs-identifier hs-var">NoHint</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">ForeignHint
</span><a href="GHC.Cmm.Type.html#NoHint"><span class="hs-identifier hs-var">NoHint</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-292"></span><span>    </span><span id="local-6989586621682873547"><span class="annot"><span class="annottext">op' :: String
</span><a href="#local-6989586621682873547"><span class="hs-identifier hs-var hs-var">op'</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">AtomicMachOp
</span><a href="#local-6989586621682873539"><span class="hs-identifier hs-var">op</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-293"></span><span>           </span><span class="annot"><span class="annottext">AtomicMachOp
</span><a href="GHC.Cmm.MachOp.html#AMO_Add"><span class="hs-identifier hs-var">AMO_Add</span></a></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;fetch_add&quot;</span></span><span>
</span><span id="line-294"></span><span>           </span><span class="annot"><span class="annottext">AtomicMachOp
</span><a href="GHC.Cmm.MachOp.html#AMO_Sub"><span class="hs-identifier hs-var">AMO_Sub</span></a></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;fetch_sub&quot;</span></span><span>
</span><span id="line-295"></span><span>           </span><span class="annot"><span class="annottext">AtomicMachOp
</span><a href="GHC.Cmm.MachOp.html#AMO_And"><span class="hs-identifier hs-var">AMO_And</span></a></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;fetch_and&quot;</span></span><span>
</span><span id="line-296"></span><span>           </span><span class="annot"><span class="annottext">AtomicMachOp
</span><a href="GHC.Cmm.MachOp.html#AMO_Nand"><span class="hs-identifier hs-var">AMO_Nand</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;fetch_nand&quot;</span></span><span>
</span><span id="line-297"></span><span>           </span><span class="annot"><span class="annottext">AtomicMachOp
</span><a href="GHC.Cmm.MachOp.html#AMO_Or"><span class="hs-identifier hs-var">AMO_Or</span></a></span><span>   </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;fetch_or&quot;</span></span><span>
</span><span id="line-298"></span><span>           </span><span class="annot"><span class="annottext">AtomicMachOp
</span><a href="GHC.Cmm.MachOp.html#AMO_Xor"><span class="hs-identifier hs-var">AMO_Xor</span></a></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;fetch_xor&quot;</span></span><span>
</span><span id="line-299"></span><span>    </span><span id="local-6989586621682873546"><span class="annot"><span class="annottext">fn :: FastString
</span><a href="#local-6989586621682873546"><span class="hs-identifier hs-var hs-var">fn</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">String -&gt; FastString
</span><a href="GHC.Data.FastString.html#fsLit"><span class="hs-identifier hs-var">fsLit</span></a></span><span> </span><span class="annot"><span class="annottext">(String -&gt; FastString) -&gt; String -&gt; FastString
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;__tsan_atomic&quot;</span></span><span> </span><span class="annot"><span class="annottext">String -&gt; String -&gt; String
forall a. [a] -&gt; [a] -&gt; [a]
</span><span class="hs-operator hs-var">++</span></span><span> </span><span class="annot"><span class="annottext">Int -&gt; String
forall a. Show a =&gt; a -&gt; String
</span><span class="hs-identifier hs-var">show</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Width -&gt; Int
</span><a href="GHC.Cmm.Type.html#widthInBits"><span class="hs-identifier hs-var">widthInBits</span></a></span><span> </span><span class="annot"><span class="annottext">Width
</span><a href="#local-6989586621682873540"><span class="hs-identifier hs-var">w</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">String -&gt; String -&gt; String
forall a. [a] -&gt; [a] -&gt; [a]
</span><span class="hs-operator hs-var">++</span></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;_&quot;</span></span><span> </span><span class="annot"><span class="annottext">String -&gt; String -&gt; String
forall a. [a] -&gt; [a] -&gt; [a]
</span><span class="hs-operator hs-var">++</span></span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621682873547"><span class="hs-identifier hs-var">op'</span></a></span><span>
</span><span id="line-300"></span></pre></body></html>