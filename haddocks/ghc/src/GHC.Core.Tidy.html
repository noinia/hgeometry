<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><link rel="stylesheet" type="text/css" href="style.css" /><script type="text/javascript" src="highlight.js"></script></head><body><pre><span class="hs-comment">{-
(c) The University of Glasgow 2006
(c) The AQUA Project, Glasgow University, 1996-1998


This module contains &quot;tidying&quot; code for *nested* expressions, bindings, rules.
The code for *top-level* bindings is in GHC.Iface.Tidy.
-}</span><span>
</span><span id="line-9"></span><span>
</span><span id="line-10"></span><span>
</span><span id="line-11"></span><span class="hs-keyword">module</span><span> </span><span class="annot"><a href="GHC.Core.Tidy.html"><span class="hs-identifier">GHC.Core.Tidy</span></a></span><span> </span><span class="hs-special">(</span><span>
</span><span id="line-12"></span><span>        </span><span class="annot"><a href="GHC.Core.Tidy.html#tidyExpr"><span class="hs-identifier">tidyExpr</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Core.Tidy.html#tidyRules"><span class="hs-identifier">tidyRules</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Core.Tidy.html#tidyCbvInfoTop"><span class="hs-identifier">tidyCbvInfoTop</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Core.Tidy.html#tidyBndrs"><span class="hs-identifier">tidyBndrs</span></a></span><span>
</span><span id="line-13"></span><span>    </span><span class="hs-special">)</span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-14"></span><span>
</span><span id="line-15"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Prelude.html"><span class="hs-identifier">GHC.Prelude</span></a></span><span>
</span><span id="line-16"></span><span>
</span><span id="line-17"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Core.html"><span class="hs-identifier">GHC.Core</span></a></span><span>
</span><span id="line-18"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Core.Type.html"><span class="hs-identifier">GHC.Core.Type</span></a></span><span>
</span><span id="line-19"></span><span>
</span><span id="line-20"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Core.Seq.html"><span class="hs-identifier">GHC.Core.Seq</span></a></span><span> </span><span class="hs-special">(</span><span> </span><span class="annot"><a href="GHC.Core.Seq.html#seqUnfolding"><span class="hs-identifier">seqUnfolding</span></a></span><span> </span><span class="hs-special">)</span><span>
</span><span id="line-21"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Types.Id.html"><span class="hs-identifier">GHC.Types.Id</span></a></span><span>
</span><span id="line-22"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Types.Id.Info.html"><span class="hs-identifier">GHC.Types.Id.Info</span></a></span><span>
</span><span id="line-23"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Types.Demand.html"><span class="hs-identifier">GHC.Types.Demand</span></a></span><span> </span><span class="hs-special">(</span><span> </span><span class="annot"><a href="GHC.Types.Demand.html#zapDmdEnvSig"><span class="hs-identifier">zapDmdEnvSig</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Types.Demand.html#isStrUsedDmd"><span class="hs-identifier">isStrUsedDmd</span></a></span><span> </span><span class="hs-special">)</span><span>
</span><span id="line-24"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Core.Coercion.html"><span class="hs-identifier">GHC.Core.Coercion</span></a></span><span> </span><span class="hs-special">(</span><span> </span><span class="annot"><a href="GHC.Core.TyCo.Tidy.html#tidyCo"><span class="hs-identifier">tidyCo</span></a></span><span> </span><span class="hs-special">)</span><span>
</span><span id="line-25"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Types.Var.html"><span class="hs-identifier">GHC.Types.Var</span></a></span><span>
</span><span id="line-26"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Types.Var.Env.html"><span class="hs-identifier">GHC.Types.Var.Env</span></a></span><span>
</span><span id="line-27"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Types.Unique.html"><span class="hs-identifier">GHC.Types.Unique</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Types.Unique.html#getUnique"><span class="hs-identifier">getUnique</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-28"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Types.Unique.FM.html"><span class="hs-identifier">GHC.Types.Unique.FM</span></a></span><span>
</span><span id="line-29"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Types.Name.html"><span class="hs-identifier">GHC.Types.Name</span></a></span><span> </span><span class="hs-keyword">hiding</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Types.Name.html#tidyNameOcc"><span class="hs-identifier">tidyNameOcc</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-30"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Types.Name.Set.html"><span class="hs-identifier">GHC.Types.Name.Set</span></a></span><span>
</span><span id="line-31"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Types.SrcLoc.html"><span class="hs-identifier">GHC.Types.SrcLoc</span></a></span><span>
</span><span id="line-32"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Types.Tickish.html"><span class="hs-identifier">GHC.Types.Tickish</span></a></span><span>
</span><span id="line-33"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Data.Maybe.html"><span class="hs-identifier">GHC.Data.Maybe</span></a></span><span>
</span><span id="line-34"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Utils.Misc.html"><span class="hs-identifier">GHC.Utils.Misc</span></a></span><span>
</span><span id="line-35"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="../../base-4.21.0.0-ae91/src/Data.List.html"><span class="hs-identifier">Data.List</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">mapAccumL</span></span><span class="hs-special">)</span><span>
</span><span id="line-36"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Utils.Outputable.html"><span class="hs-identifier">GHC.Utils.Outputable</span></a></span><span>
</span><span id="line-37"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Types.RepType.html"><span class="hs-identifier">GHC.Types.RepType</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Types.RepType.html#typePrimRep"><span class="hs-identifier">typePrimRep</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-38"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Utils.Panic.html"><span class="hs-identifier">GHC.Utils.Panic</span></a></span><span>
</span><span id="line-39"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Types.Basic.html"><span class="hs-identifier">GHC.Types.Basic</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Types.Basic.html#isMarkedCbv"><span class="hs-identifier">isMarkedCbv</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Types.Basic.html#CbvMark"><span class="hs-identifier">CbvMark</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-40"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Core.Utils.html"><span class="hs-identifier">GHC.Core.Utils</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Core.Utils.html#shouldUseCbvForId"><span class="hs-identifier">shouldUseCbvForId</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-41"></span><span>
</span><span id="line-42"></span><span class="hs-comment">{-
************************************************************************
*                                                                      *
\subsection{Tidying expressions, rules}
*                                                                      *
************************************************************************
-}</span><span>
</span><span id="line-49"></span><span>
</span><span id="line-50"></span><span class="annot"><a href="GHC.Core.Tidy.html#tidyBind"><span class="hs-identifier hs-type">tidyBind</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Types.Var.Env.html#TidyEnv"><span class="hs-identifier hs-type">TidyEnv</span></a></span><span>
</span><span id="line-51"></span><span>         </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Core.html#CoreBind"><span class="hs-identifier hs-type">CoreBind</span></a></span><span>
</span><span id="line-52"></span><span>         </span><span class="hs-glyph">-&gt;</span><span>  </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Types.Var.Env.html#TidyEnv"><span class="hs-identifier hs-type">TidyEnv</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Core.html#CoreBind"><span class="hs-identifier hs-type">CoreBind</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-53"></span><span>
</span><span id="line-54"></span><span id="tidyBind"><span class="annot"><span class="annottext">tidyBind :: TidyEnv -&gt; CoreBind -&gt; (TidyEnv, CoreBind)
</span><a href="GHC.Core.Tidy.html#tidyBind"><span class="hs-identifier hs-var hs-var">tidyBind</span></a></span></span><span> </span><span id="local-6989586621682704526"><span class="annot"><span class="annottext">TidyEnv
</span><a href="#local-6989586621682704526"><span class="hs-identifier hs-var">env</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Core.html#NonRec"><span class="hs-identifier hs-type">NonRec</span></a></span><span> </span><span id="local-6989586621682704528"><span class="annot"><span class="annottext">Id
</span><a href="#local-6989586621682704528"><span class="hs-identifier hs-var">bndr</span></a></span></span><span> </span><span id="local-6989586621682704529"><span class="annot"><span class="annottext">Expr Id
</span><a href="#local-6989586621682704529"><span class="hs-identifier hs-var">rhs</span></a></span></span><span class="hs-special">)</span><span>
</span><span id="line-55"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-comment">-- pprTrace &quot;tidyBindNonRec&quot; (ppr bndr) $</span><span>
</span><span id="line-56"></span><span>    </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621682704530"><span class="annot"><span class="annottext">cbv_bndr :: Id
</span><a href="#local-6989586621682704530"><span class="hs-identifier hs-var hs-var">cbv_bndr</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">HasDebugCallStack =&gt; Id -&gt; Expr Id -&gt; Id
Id -&gt; Expr Id -&gt; Id
</span><a href="GHC.Core.Tidy.html#tidyCbvInfoLocal"><span class="hs-identifier hs-var">tidyCbvInfoLocal</span></a></span><span> </span><span class="annot"><span class="annottext">Id
</span><a href="#local-6989586621682704528"><span class="hs-identifier hs-var">bndr</span></a></span><span> </span><span class="annot"><span class="annottext">Expr Id
</span><a href="#local-6989586621682704529"><span class="hs-identifier hs-var">rhs</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-57"></span><span>        </span><span class="hs-special">(</span><span id="local-6989586621682704532"><span class="annot"><span class="annottext">TidyEnv
</span><a href="#local-6989586621682704532"><span class="hs-identifier hs-var">env'</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682704533"><span class="annot"><span class="annottext">Id
</span><a href="#local-6989586621682704533"><span class="hs-identifier hs-var">bndr'</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">TidyEnv -&gt; TidyEnv -&gt; Id -&gt; (TidyEnv, Id)
</span><a href="GHC.Core.Tidy.html#tidyLetBndr"><span class="hs-identifier hs-var">tidyLetBndr</span></a></span><span> </span><span class="annot"><span class="annottext">TidyEnv
</span><a href="#local-6989586621682704526"><span class="hs-identifier hs-var">env</span></a></span><span> </span><span class="annot"><span class="annottext">TidyEnv
</span><a href="#local-6989586621682704526"><span class="hs-identifier hs-var">env</span></a></span><span> </span><span class="annot"><span class="annottext">Id
</span><a href="#local-6989586621682704530"><span class="hs-identifier hs-var">cbv_bndr</span></a></span><span>
</span><span id="line-58"></span><span>        </span><span id="local-6989586621682704535"><span class="annot"><span class="annottext">tidy_rhs :: Expr Id
</span><a href="#local-6989586621682704535"><span class="hs-identifier hs-var hs-var">tidy_rhs</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TidyEnv -&gt; Expr Id -&gt; Expr Id
</span><a href="GHC.Core.Tidy.html#tidyExpr"><span class="hs-identifier hs-var">tidyExpr</span></a></span><span> </span><span class="annot"><span class="annottext">TidyEnv
</span><a href="#local-6989586621682704532"><span class="hs-identifier hs-var">env'</span></a></span><span> </span><span class="annot"><span class="annottext">Expr Id
</span><a href="#local-6989586621682704529"><span class="hs-identifier hs-var">rhs</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-59"></span><span>    </span><span class="hs-keyword">in</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TidyEnv
</span><a href="#local-6989586621682704532"><span class="hs-identifier hs-var">env'</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Id -&gt; Expr Id -&gt; CoreBind
forall b. b -&gt; Expr b -&gt; Bind b
</span><a href="GHC.Core.html#NonRec"><span class="hs-identifier hs-var">NonRec</span></a></span><span> </span><span class="annot"><span class="annottext">Id
</span><a href="#local-6989586621682704533"><span class="hs-identifier hs-var">bndr'</span></a></span><span> </span><span class="annot"><span class="annottext">Expr Id
</span><a href="#local-6989586621682704535"><span class="hs-identifier hs-var">tidy_rhs</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-60"></span><span>
</span><span id="line-61"></span><span class="annot"><a href="GHC.Core.Tidy.html#tidyBind"><span class="hs-identifier hs-var">tidyBind</span></a></span><span> </span><span id="local-6989586621682704536"><span class="annot"><span class="annottext">TidyEnv
</span><a href="#local-6989586621682704536"><span class="hs-identifier hs-var">env</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Core.html#Rec"><span class="hs-identifier hs-type">Rec</span></a></span><span> </span><span id="local-6989586621682704538"><span class="annot"><span class="annottext">[(Id, Expr Id)]
</span><a href="#local-6989586621682704538"><span class="hs-identifier hs-var">prs</span></a></span></span><span class="hs-special">)</span><span>
</span><span id="line-62"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-comment">-- pprTrace &quot;tidyBindRec&quot; (ppr $ map fst prs) $</span><span>
</span><span id="line-63"></span><span>    </span><span class="hs-keyword">let</span><span>
</span><span id="line-64"></span><span>       </span><span id="local-6989586621682704539"><span class="annot"><span class="annottext">cbv_bndrs :: [Id]
</span><a href="#local-6989586621682704539"><span class="hs-identifier hs-var hs-var">cbv_bndrs</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">((Id, Expr Id) -&gt; Id) -&gt; [(Id, Expr Id)] -&gt; [Id]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><span class="hs-identifier hs-var">map</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">(</span><span class="hs-glyph">\</span><span class="hs-special">(</span><span id="local-6989586621682704540"><span class="annot"><span class="annottext">Id
</span><a href="#local-6989586621682704540"><span class="hs-identifier hs-var">bnd</span></a></span></span><span class="hs-special">,</span><span id="local-6989586621682704541"><span class="annot"><span class="annottext">Expr Id
</span><a href="#local-6989586621682704541"><span class="hs-identifier hs-var">rhs</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">HasDebugCallStack =&gt; Id -&gt; Expr Id -&gt; Id
Id -&gt; Expr Id -&gt; Id
</span><a href="GHC.Core.Tidy.html#tidyCbvInfoLocal"><span class="hs-identifier hs-var">tidyCbvInfoLocal</span></a></span><span> </span><span class="annot"><span class="annottext">Id
</span><a href="#local-6989586621682704540"><span class="hs-identifier hs-var">bnd</span></a></span><span> </span><span class="annot"><span class="annottext">Expr Id
</span><a href="#local-6989586621682704541"><span class="hs-identifier hs-var">rhs</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[(Id, Expr Id)]
</span><a href="#local-6989586621682704538"><span class="hs-identifier hs-var">prs</span></a></span><span>
</span><span id="line-65"></span><span>       </span><span class="hs-special">(</span><span id="local-6989586621682704542"><span class="annot"><span class="annottext">[Id]
</span><a href="#local-6989586621682704542"><span class="hs-identifier hs-var">_bndrs</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682704543"><span class="annot"><span class="annottext">[Expr Id]
</span><a href="#local-6989586621682704543"><span class="hs-identifier hs-var">rhss</span></a></span></span><span class="hs-special">)</span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[(Id, Expr Id)] -&gt; ([Id], [Expr Id])
forall a b. [(a, b)] -&gt; ([a], [b])
</span><span class="hs-identifier hs-var">unzip</span></span><span> </span><span class="annot"><span class="annottext">[(Id, Expr Id)]
</span><a href="#local-6989586621682704538"><span class="hs-identifier hs-var">prs</span></a></span><span>
</span><span id="line-66"></span><span>       </span><span class="hs-special">(</span><span id="local-6989586621682704545"><span class="annot"><span class="annottext">TidyEnv
</span><a href="#local-6989586621682704545"><span class="hs-identifier hs-var">env'</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682704546"><span class="annot"><span class="annottext">[Id]
</span><a href="#local-6989586621682704546"><span class="hs-identifier hs-var">bndrs'</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(TidyEnv -&gt; Id -&gt; (TidyEnv, Id))
-&gt; TidyEnv -&gt; [Id] -&gt; (TidyEnv, [Id])
forall (t :: * -&gt; *) s a b.
Traversable t =&gt;
(s -&gt; a -&gt; (s, b)) -&gt; s -&gt; t a -&gt; (s, t b)
</span><span class="hs-identifier hs-var">mapAccumL</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TidyEnv -&gt; TidyEnv -&gt; Id -&gt; (TidyEnv, Id)
</span><a href="GHC.Core.Tidy.html#tidyLetBndr"><span class="hs-identifier hs-var">tidyLetBndr</span></a></span><span> </span><span class="annot"><span class="annottext">TidyEnv
</span><a href="#local-6989586621682704545"><span class="hs-identifier hs-var">env'</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">TidyEnv
</span><a href="#local-6989586621682704536"><span class="hs-identifier hs-var">env</span></a></span><span> </span><span class="annot"><span class="annottext">[Id]
</span><a href="#local-6989586621682704539"><span class="hs-identifier hs-var">cbv_bndrs</span></a></span><span>
</span><span id="line-67"></span><span>    </span><span class="hs-keyword">in</span><span>
</span><span id="line-68"></span><span>    </span><span class="annot"><span class="annottext">(Expr Id -&gt; Expr Id) -&gt; [Expr Id] -&gt; [Expr Id]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><span class="hs-identifier hs-var">map</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TidyEnv -&gt; Expr Id -&gt; Expr Id
</span><a href="GHC.Core.Tidy.html#tidyExpr"><span class="hs-identifier hs-var">tidyExpr</span></a></span><span> </span><span class="annot"><span class="annottext">TidyEnv
</span><a href="#local-6989586621682704545"><span class="hs-identifier hs-var">env'</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[Expr Id]
</span><a href="#local-6989586621682704543"><span class="hs-identifier hs-var">rhss</span></a></span><span> </span><span class="annot"><span class="annottext">[Expr Id]
-&gt; ([Expr Id] -&gt; (TidyEnv, CoreBind)) -&gt; (TidyEnv, CoreBind)
forall a b. a -&gt; (a -&gt; b) -&gt; b
</span><a href="GHC.Core.Tidy.html#%3D%3A"><span class="hs-operator hs-var">=:</span></a></span><span> </span><span class="hs-glyph">\</span><span> </span><span id="local-6989586621682704548"><span class="annot"><span class="annottext">[Expr Id]
</span><a href="#local-6989586621682704548"><span class="hs-identifier hs-var">rhss'</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-69"></span><span>    </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TidyEnv
</span><a href="#local-6989586621682704545"><span class="hs-identifier hs-var">env'</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">[(Id, Expr Id)] -&gt; CoreBind
forall b. [(b, Expr b)] -&gt; Bind b
</span><a href="GHC.Core.html#Rec"><span class="hs-identifier hs-var">Rec</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[Id] -&gt; [Expr Id] -&gt; [(Id, Expr Id)]
forall a b. [a] -&gt; [b] -&gt; [(a, b)]
</span><span class="hs-identifier hs-var">zip</span></span><span> </span><span class="annot"><span class="annottext">[Id]
</span><a href="#local-6989586621682704546"><span class="hs-identifier hs-var">bndrs'</span></a></span><span> </span><span class="annot"><span class="annottext">[Expr Id]
</span><a href="#local-6989586621682704548"><span class="hs-identifier hs-var">rhss'</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-70"></span><span>
</span><span id="line-71"></span><span>
</span><span id="line-72"></span><span class="hs-comment">-- Note [Attaching CBV Marks to ids]</span><span>
</span><span id="line-73"></span><span class="hs-comment">-- ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~</span><span>
</span><span id="line-74"></span><span class="hs-comment">-- See Note [CBV Function Ids] for the *why*.</span><span>
</span><span id="line-75"></span><span class="hs-comment">-- Before tidy, we turn all worker functions into worker like ids.</span><span>
</span><span id="line-76"></span><span class="hs-comment">-- This way we can later tell if we can assume the existence of a wrapper. This also applies to</span><span>
</span><span id="line-77"></span><span class="hs-comment">-- specialized versions of functions generated by SpecConstr for which we, in a sense,</span><span>
</span><span id="line-78"></span><span class="hs-comment">-- consider the unspecialized version to be the wrapper.</span><span>
</span><span id="line-79"></span><span class="hs-comment">-- During tidy we take the demands on the arguments for these ids and compute</span><span>
</span><span id="line-80"></span><span class="hs-comment">-- CBV (call-by-value) semantics for each individual argument.</span><span>
</span><span id="line-81"></span><span class="hs-comment">-- The marks themselves then are put onto the function id itself.</span><span>
</span><span id="line-82"></span><span class="hs-comment">-- This means the code generator can get the full calling convention by only looking at the function</span><span>
</span><span id="line-83"></span><span class="hs-comment">-- itself without having to inspect the RHS.</span><span>
</span><span id="line-84"></span><span class="hs-comment">--</span><span>
</span><span id="line-85"></span><span class="hs-comment">-- The actual logic is in computeCbvInfo and takes:</span><span>
</span><span id="line-86"></span><span class="annot"><span class="hs-comment">-- * The function id</span></span><span>
</span><span id="line-87"></span><span class="annot"><span class="hs-comment">-- * The functions rhs</span></span><span>
</span><span id="line-88"></span><span class="hs-comment">-- And gives us back the function annotated with the marks.</span><span>
</span><span id="line-89"></span><span class="hs-comment">-- We call it in:</span><span>
</span><span id="line-90"></span><span class="annot"><span class="hs-comment">-- * tidyTopPair for top level bindings</span></span><span>
</span><span id="line-91"></span><span class="annot"><span class="hs-comment">-- * tidyBind for local bindings.</span></span><span>
</span><span id="line-92"></span><span class="hs-comment">--</span><span>
</span><span id="line-93"></span><span class="hs-comment">-- Not that we *have* to look at the untidied rhs.</span><span>
</span><span id="line-94"></span><span class="hs-comment">-- During tidying some knot-tying occurs which can blow up</span><span>
</span><span id="line-95"></span><span class="hs-comment">-- if we look at the post-tidy types of the arguments here.</span><span>
</span><span id="line-96"></span><span class="hs-comment">-- However we only care if the types are unlifted and that doesn't change during tidy.</span><span>
</span><span id="line-97"></span><span class="hs-comment">-- so we can just look at the untidied types.</span><span>
</span><span id="line-98"></span><span class="hs-comment">--</span><span>
</span><span id="line-99"></span><span class="hs-comment">-- If the id is boot-exported we don't use a cbv calling convention via marks,</span><span>
</span><span id="line-100"></span><span class="hs-comment">-- as the boot file won't contain them. Which means code calling boot-exported</span><span>
</span><span id="line-101"></span><span class="hs-comment">-- ids might expect these ids to have a vanilla calling convention even if we</span><span>
</span><span id="line-102"></span><span class="hs-comment">-- determine a different one here.</span><span>
</span><span id="line-103"></span><span class="hs-comment">-- To be able to avoid this we pass a set of boot exported ids for this module around.</span><span>
</span><span id="line-104"></span><span class="hs-comment">-- For non top level ids we can skip this. Local ids are never boot-exported</span><span>
</span><span id="line-105"></span><span class="hs-comment">-- as boot files don't have unfoldings. So there this isn't a concern.</span><span>
</span><span id="line-106"></span><span class="hs-comment">-- See also Note [CBV Function Ids]</span><span>
</span><span id="line-107"></span><span>
</span><span id="line-108"></span><span>
</span><span id="line-109"></span><span class="hs-comment">-- See Note [CBV Function Ids]</span><span>
</span><span id="line-110"></span><span class="annot"><a href="GHC.Core.Tidy.html#tidyCbvInfoTop"><span class="hs-identifier hs-type">tidyCbvInfoTop</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Utils.Misc.html#HasDebugCallStack"><span class="hs-identifier hs-type">HasDebugCallStack</span></a></span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="GHC.Types.Name.Set.html#NameSet"><span class="hs-identifier hs-type">NameSet</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Types.Var.html#Id"><span class="hs-identifier hs-type">Id</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Core.html#CoreExpr"><span class="hs-identifier hs-type">CoreExpr</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Types.Var.html#Id"><span class="hs-identifier hs-type">Id</span></a></span><span>
</span><span id="line-111"></span><span id="tidyCbvInfoTop"><span class="annot"><span class="annottext">tidyCbvInfoTop :: HasDebugCallStack =&gt; NameSet -&gt; Id -&gt; Expr Id -&gt; Id
</span><a href="GHC.Core.Tidy.html#tidyCbvInfoTop"><span class="hs-identifier hs-var hs-var">tidyCbvInfoTop</span></a></span></span><span> </span><span id="local-6989586621682704553"><span class="annot"><span class="annottext">NameSet
</span><a href="#local-6989586621682704553"><span class="hs-identifier hs-var">boot_exports</span></a></span></span><span> </span><span id="local-6989586621682704554"><span class="annot"><span class="annottext">Id
</span><a href="#local-6989586621682704554"><span class="hs-identifier hs-var">id</span></a></span></span><span> </span><span id="local-6989586621682704555"><span class="annot"><span class="annottext">Expr Id
</span><a href="#local-6989586621682704555"><span class="hs-identifier hs-var">rhs</span></a></span></span><span>
</span><span id="line-112"></span><span>  </span><span class="hs-comment">-- Can't change calling convention for boot exported things</span><span>
</span><span id="line-113"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Name -&gt; NameSet -&gt; Bool
</span><a href="GHC.Types.Name.Set.html#elemNameSet"><span class="hs-identifier hs-var">elemNameSet</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Id -&gt; Name
</span><a href="GHC.Types.Id.html#idName"><span class="hs-identifier hs-var">idName</span></a></span><span> </span><span class="annot"><span class="annottext">Id
</span><a href="#local-6989586621682704554"><span class="hs-identifier hs-var">id</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">NameSet
</span><a href="#local-6989586621682704553"><span class="hs-identifier hs-var">boot_exports</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Id
</span><a href="#local-6989586621682704554"><span class="hs-identifier hs-var">id</span></a></span><span>
</span><span id="line-114"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">otherwise</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">HasCallStack =&gt; Id -&gt; Expr Id -&gt; Id
Id -&gt; Expr Id -&gt; Id
</span><a href="GHC.Core.Tidy.html#computeCbvInfo"><span class="hs-identifier hs-var">computeCbvInfo</span></a></span><span> </span><span class="annot"><span class="annottext">Id
</span><a href="#local-6989586621682704554"><span class="hs-identifier hs-var">id</span></a></span><span> </span><span class="annot"><span class="annottext">Expr Id
</span><a href="#local-6989586621682704555"><span class="hs-identifier hs-var">rhs</span></a></span><span>
</span><span id="line-115"></span><span>
</span><span id="line-116"></span><span class="hs-comment">-- See Note [CBV Function Ids]</span><span>
</span><span id="line-117"></span><span class="annot"><a href="GHC.Core.Tidy.html#tidyCbvInfoLocal"><span class="hs-identifier hs-type">tidyCbvInfoLocal</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Utils.Misc.html#HasDebugCallStack"><span class="hs-identifier hs-type">HasDebugCallStack</span></a></span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="GHC.Types.Var.html#Id"><span class="hs-identifier hs-type">Id</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Core.html#CoreExpr"><span class="hs-identifier hs-type">CoreExpr</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Types.Var.html#Id"><span class="hs-identifier hs-type">Id</span></a></span><span>
</span><span id="line-118"></span><span id="tidyCbvInfoLocal"><span class="annot"><span class="annottext">tidyCbvInfoLocal :: HasDebugCallStack =&gt; Id -&gt; Expr Id -&gt; Id
</span><a href="GHC.Core.Tidy.html#tidyCbvInfoLocal"><span class="hs-identifier hs-var hs-var">tidyCbvInfoLocal</span></a></span></span><span> </span><span id="local-6989586621682704562"><span class="annot"><span class="annottext">Id
</span><a href="#local-6989586621682704562"><span class="hs-identifier hs-var">id</span></a></span></span><span> </span><span id="local-6989586621682704563"><span class="annot"><span class="annottext">Expr Id
</span><a href="#local-6989586621682704563"><span class="hs-identifier hs-var">rhs</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">HasCallStack =&gt; Id -&gt; Expr Id -&gt; Id
Id -&gt; Expr Id -&gt; Id
</span><a href="GHC.Core.Tidy.html#computeCbvInfo"><span class="hs-identifier hs-var">computeCbvInfo</span></a></span><span> </span><span class="annot"><span class="annottext">Id
</span><a href="#local-6989586621682704562"><span class="hs-identifier hs-var">id</span></a></span><span> </span><span class="annot"><span class="annottext">Expr Id
</span><a href="#local-6989586621682704563"><span class="hs-identifier hs-var">rhs</span></a></span><span>
</span><span id="line-119"></span><span>
</span><span id="line-120"></span><span class="hs-comment">-- | For a binding we:</span><span>
</span><span id="line-121"></span><span class="hs-comment">-- * Look at the args</span><span>
</span><span id="line-122"></span><span class="hs-comment">-- * Mark any argument as call-by-value if:</span><span>
</span><span id="line-123"></span><span class="hs-comment">--   - It's argument to a worker and demanded strictly</span><span>
</span><span id="line-124"></span><span class="hs-comment">--   - Unless it's an unlifted type already</span><span>
</span><span id="line-125"></span><span class="hs-comment">-- * Update the id</span><span>
</span><span id="line-126"></span><span class="hs-comment">-- See Note [CBV Function Ids]</span><span>
</span><span id="line-127"></span><span class="hs-comment">-- See Note [Attaching CBV Marks to ids]</span><span>
</span><span id="line-128"></span><span>
</span><span id="line-129"></span><span class="annot"><a href="GHC.Core.Tidy.html#computeCbvInfo"><span class="hs-identifier hs-type">computeCbvInfo</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">HasCallStack</span></span><span>
</span><span id="line-130"></span><span>               </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="GHC.Types.Var.html#Id"><span class="hs-identifier hs-type">Id</span></a></span><span>            </span><span class="hs-comment">-- The function</span><span>
</span><span id="line-131"></span><span>               </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Core.html#CoreExpr"><span class="hs-identifier hs-type">CoreExpr</span></a></span><span>      </span><span class="hs-comment">-- It's RHS</span><span>
</span><span id="line-132"></span><span>               </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Types.Var.html#Id"><span class="hs-identifier hs-type">Id</span></a></span><span>
</span><span id="line-133"></span><span class="hs-comment">-- computeCbvInfo fun_id rhs = fun_id</span><span>
</span><span id="line-134"></span><span id="computeCbvInfo"><span class="annot"><span class="annottext">computeCbvInfo :: HasCallStack =&gt; Id -&gt; Expr Id -&gt; Id
</span><a href="GHC.Core.Tidy.html#computeCbvInfo"><span class="hs-identifier hs-var hs-var">computeCbvInfo</span></a></span></span><span> </span><span id="local-6989586621682704587"><span class="annot"><span class="annottext">Id
</span><a href="#local-6989586621682704587"><span class="hs-identifier hs-var">fun_id</span></a></span></span><span> </span><span id="local-6989586621682704588"><span class="annot"><span class="annottext">Expr Id
</span><a href="#local-6989586621682704588"><span class="hs-identifier hs-var">rhs</span></a></span></span><span>
</span><span id="line-135"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621682704589"><span class="hs-identifier hs-var">is_wkr_like</span></a></span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Bool -&gt; Bool
</span><span class="hs-operator hs-var">||</span></span><span> </span><span class="annot"><span class="annottext">JoinPointHood -&gt; Bool
</span><a href="GHC.Utils.Outputable.html#isJoinPoint"><span class="hs-identifier hs-var">isJoinPoint</span></a></span><span> </span><span class="annot"><span class="annottext">JoinPointHood
</span><a href="#local-6989586621682704592"><span class="hs-identifier hs-var">mb_join_id</span></a></span><span>
</span><span id="line-136"></span><span>  </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">[Id] -&gt; Bool
forall {t :: * -&gt; *}. Foldable t =&gt; t Id -&gt; Bool
</span><a href="#local-6989586621682704593"><span class="hs-identifier hs-var">valid_unlifted_worker</span></a></span><span> </span><span class="annot"><span class="annottext">[Id]
</span><a href="#local-6989586621682704594"><span class="hs-identifier hs-var">val_args</span></a></span><span>
</span><span id="line-137"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-comment">-- pprTrace &quot;computeCbvInfo&quot;</span><span>
</span><span id="line-138"></span><span>    </span><span class="hs-comment">--   (text &quot;fun&quot; &lt;+&gt; ppr fun_id $$</span><span>
</span><span id="line-139"></span><span>    </span><span class="hs-comment">--     text &quot;arg_tys&quot; &lt;+&gt; ppr (map idType val_args) $$</span><span>
</span><span id="line-140"></span><span>
</span><span id="line-141"></span><span>    </span><span class="hs-comment">--     text &quot;prim_rep&quot; &lt;+&gt; ppr (map typePrimRep_maybe $ map idType val_args) $$</span><span>
</span><span id="line-142"></span><span>    </span><span class="hs-comment">--     text &quot;rrarg&quot; &lt;+&gt; ppr (map isRuntimeVar val_args) $$</span><span>
</span><span id="line-143"></span><span>    </span><span class="hs-comment">--     text &quot;cbv_marks&quot; &lt;+&gt; ppr cbv_marks $$</span><span>
</span><span id="line-144"></span><span>    </span><span class="hs-comment">--     text &quot;out_id&quot; &lt;+&gt; ppr cbv_bndr $$</span><span>
</span><span id="line-145"></span><span>    </span><span class="hs-comment">--     ppr rhs)</span><span>
</span><span id="line-146"></span><span>    </span><span class="annot"><span class="annottext">Id
</span><a href="#local-6989586621682704595"><span class="hs-identifier hs-var">cbv_bndr</span></a></span><span>
</span><span id="line-147"></span><span>
</span><span id="line-148"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">otherwise</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Id
</span><a href="#local-6989586621682704587"><span class="hs-identifier hs-var">fun_id</span></a></span><span>
</span><span id="line-149"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-150"></span><span>    </span><span id="local-6989586621682704592"><span class="annot"><span class="annottext">mb_join_id :: JoinPointHood
</span><a href="#local-6989586621682704592"><span class="hs-identifier hs-var hs-var">mb_join_id</span></a></span></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Id -&gt; JoinPointHood
</span><a href="GHC.Types.Id.html#idJoinPointHood"><span class="hs-identifier hs-var">idJoinPointHood</span></a></span><span> </span><span class="annot"><span class="annottext">Id
</span><a href="#local-6989586621682704587"><span class="hs-identifier hs-var">fun_id</span></a></span><span>
</span><span id="line-151"></span><span>    </span><span id="local-6989586621682704589"><span class="annot"><span class="annottext">is_wkr_like :: Bool
</span><a href="#local-6989586621682704589"><span class="hs-identifier hs-var hs-var">is_wkr_like</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Id -&gt; Bool
</span><a href="GHC.Types.Id.html#isWorkerLikeId"><span class="hs-identifier hs-var">isWorkerLikeId</span></a></span><span> </span><span class="annot"><span class="annottext">Id
</span><a href="#local-6989586621682704587"><span class="hs-identifier hs-var">fun_id</span></a></span><span>
</span><span id="line-152"></span><span>
</span><span id="line-153"></span><span>    </span><span id="local-6989586621682704594"><span class="annot"><span class="annottext">val_args :: [Id]
</span><a href="#local-6989586621682704594"><span class="hs-identifier hs-var hs-var">val_args</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(Id -&gt; Bool) -&gt; [Id] -&gt; [Id]
forall a. (a -&gt; Bool) -&gt; [a] -&gt; [a]
</span><span class="hs-identifier hs-var">filter</span></span><span> </span><span class="annot"><span class="annottext">Id -&gt; Bool
</span><a href="GHC.Types.Var.html#isId"><span class="hs-identifier hs-var">isId</span></a></span><span> </span><span class="annot"><span class="annottext">[Id]
</span><a href="#local-6989586621682704599"><span class="hs-identifier hs-var">lam_bndrs</span></a></span><span>
</span><span id="line-154"></span><span>    </span><span class="hs-comment">-- When computing CbvMarks, we limit the arity of join points to</span><span>
</span><span id="line-155"></span><span>    </span><span class="hs-comment">-- the JoinArity, because that's the arity we are going to use</span><span>
</span><span id="line-156"></span><span>    </span><span class="hs-comment">-- when calling it. There may be more lambdas than that on the RHS.</span><span>
</span><span id="line-157"></span><span>    </span><span id="local-6989586621682704599"><span class="annot"><span class="annottext">lam_bndrs :: [Id]
</span><a href="#local-6989586621682704599"><span class="hs-identifier hs-var hs-var">lam_bndrs</span></a></span></span><span> </span><span class="hs-glyph">|</span><span> </span><span class="annot"><a href="GHC.Utils.Outputable.html#JoinPoint"><span class="hs-identifier hs-type">JoinPoint</span></a></span><span> </span><span id="local-6989586621682704601"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621682704601"><span class="hs-identifier hs-var">join_arity</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">JoinPointHood
</span><a href="#local-6989586621682704592"><span class="hs-identifier hs-var">mb_join_id</span></a></span><span>
</span><span id="line-158"></span><span>              </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">([Id], Expr Id) -&gt; [Id]
forall a b. (a, b) -&gt; a
</span><span class="hs-identifier hs-var">fst</span></span><span> </span><span class="annot"><span class="annottext">(([Id], Expr Id) -&gt; [Id]) -&gt; ([Id], Expr Id) -&gt; [Id]
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Expr Id -&gt; ([Id], Expr Id)
forall b. Int -&gt; Expr b -&gt; ([b], Expr b)
</span><a href="GHC.Core.html#collectNBinders"><span class="hs-identifier hs-var">collectNBinders</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621682704601"><span class="hs-identifier hs-var">join_arity</span></a></span><span> </span><span class="annot"><span class="annottext">Expr Id
</span><a href="#local-6989586621682704588"><span class="hs-identifier hs-var">rhs</span></a></span><span>
</span><span id="line-159"></span><span>              </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">otherwise</span></span><span>
</span><span id="line-160"></span><span>              </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">([Id], Expr Id) -&gt; [Id]
forall a b. (a, b) -&gt; a
</span><span class="hs-identifier hs-var">fst</span></span><span> </span><span class="annot"><span class="annottext">(([Id], Expr Id) -&gt; [Id]) -&gt; ([Id], Expr Id) -&gt; [Id]
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Expr Id -&gt; ([Id], Expr Id)
forall b. Expr b -&gt; ([b], Expr b)
</span><a href="GHC.Core.html#collectBinders"><span class="hs-identifier hs-var">collectBinders</span></a></span><span> </span><span class="annot"><span class="annottext">Expr Id
</span><a href="#local-6989586621682704588"><span class="hs-identifier hs-var">rhs</span></a></span><span>
</span><span id="line-161"></span><span>
</span><span id="line-162"></span><span>    </span><span id="local-6989586621682704605"><span class="annot"><span class="annottext">cbv_marks :: [CbvMark]
</span><a href="#local-6989586621682704605"><span class="hs-identifier hs-var hs-var">cbv_marks</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-comment">-- assert: CBV marks are only set during tidy so none should be present already.</span><span>
</span><span id="line-163"></span><span>                </span><span class="annot"><span class="annottext">Bool -&gt; SDoc -&gt; [CbvMark] -&gt; [CbvMark]
forall a. HasCallStack =&gt; Bool -&gt; SDoc -&gt; a -&gt; a
</span><a href="GHC.Utils.Panic.html#assertPpr"><span class="hs-identifier hs-var">assertPpr</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Bool -&gt; ([CbvMark] -&gt; Bool) -&gt; Maybe [CbvMark] -&gt; Bool
forall b a. b -&gt; (a -&gt; b) -&gt; Maybe a -&gt; b
</span><span class="hs-identifier hs-var">maybe</span></span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">True</span></span><span> </span><span class="annot"><span class="annottext">[CbvMark] -&gt; Bool
forall a. [a] -&gt; Bool
forall (t :: * -&gt; *) a. Foldable t =&gt; t a -&gt; Bool
</span><span class="hs-identifier hs-var">null</span></span><span> </span><span class="annot"><span class="annottext">(Maybe [CbvMark] -&gt; Bool) -&gt; Maybe [CbvMark] -&gt; Bool
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Id -&gt; Maybe [CbvMark]
</span><a href="GHC.Types.Id.html#idCbvMarks_maybe"><span class="hs-identifier hs-var">idCbvMarks_maybe</span></a></span><span> </span><span class="annot"><span class="annottext">Id
</span><a href="#local-6989586621682704587"><span class="hs-identifier hs-var">fun_id</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-164"></span><span>                          </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Id -&gt; SDoc
forall a. Outputable a =&gt; a -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="annot"><span class="annottext">Id
</span><a href="#local-6989586621682704587"><span class="hs-identifier hs-var">fun_id</span></a></span><span> </span><span class="annot"><span class="annottext">SDoc -&gt; SDoc -&gt; SDoc
forall doc. IsLine doc =&gt; doc -&gt; doc -&gt; doc
</span><a href="GHC.Utils.Outputable.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Maybe [CbvMark] -&gt; SDoc
forall a. Outputable a =&gt; a -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="annot"><span class="annottext">(Maybe [CbvMark] -&gt; SDoc) -&gt; Maybe [CbvMark] -&gt; SDoc
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Id -&gt; Maybe [CbvMark]
</span><a href="GHC.Types.Id.html#idCbvMarks_maybe"><span class="hs-identifier hs-var">idCbvMarks_maybe</span></a></span><span> </span><span class="annot"><span class="annottext">Id
</span><a href="#local-6989586621682704587"><span class="hs-identifier hs-var">fun_id</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">SDoc -&gt; SDoc -&gt; SDoc
forall doc. IsDoc doc =&gt; doc -&gt; doc -&gt; doc
</span><a href="GHC.Utils.Outputable.html#%24%24"><span class="hs-operator hs-var">$$</span></a></span><span> </span><span class="annot"><span class="annottext">Expr Id -&gt; SDoc
forall a. Outputable a =&gt; a -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="annot"><span class="annottext">Expr Id
</span><a href="#local-6989586621682704588"><span class="hs-identifier hs-var">rhs</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">([CbvMark] -&gt; [CbvMark]) -&gt; [CbvMark] -&gt; [CbvMark]
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-165"></span><span>                </span><span class="annot"><span class="annottext">(Id -&gt; CbvMark) -&gt; [Id] -&gt; [CbvMark]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><span class="hs-identifier hs-var">map</span></span><span> </span><span class="annot"><span class="annottext">Id -&gt; CbvMark
</span><a href="#local-6989586621682704613"><span class="hs-identifier hs-var">mkMark</span></a></span><span> </span><span class="annot"><span class="annottext">[Id]
</span><a href="#local-6989586621682704594"><span class="hs-identifier hs-var">val_args</span></a></span><span>
</span><span id="line-166"></span><span>
</span><span id="line-167"></span><span>    </span><span id="local-6989586621682704595"><span class="annot"><span class="annottext">cbv_bndr :: Id
</span><a href="#local-6989586621682704595"><span class="hs-identifier hs-var hs-var">cbv_bndr</span></a></span></span><span> </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">(CbvMark -&gt; Bool) -&gt; [CbvMark] -&gt; Bool
forall (t :: * -&gt; *) a. Foldable t =&gt; (a -&gt; Bool) -&gt; t a -&gt; Bool
</span><span class="hs-identifier hs-var">any</span></span><span> </span><span class="annot"><span class="annottext">CbvMark -&gt; Bool
</span><a href="GHC.Types.Basic.html#isMarkedCbv"><span class="hs-identifier hs-var">isMarkedCbv</span></a></span><span> </span><span class="annot"><span class="annottext">[CbvMark]
</span><a href="#local-6989586621682704605"><span class="hs-identifier hs-var">cbv_marks</span></a></span><span>
</span><span id="line-168"></span><span>             </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[CbvMark]
</span><a href="#local-6989586621682704605"><span class="hs-identifier hs-var">cbv_marks</span></a></span><span> </span><span class="annot"><span class="annottext">[CbvMark] -&gt; Id -&gt; Id
forall a b. [a] -&gt; b -&gt; b
</span><a href="GHC.Utils.Misc.html#seqList"><span class="hs-operator hs-var">`seqList`</span></a></span><span> </span><span class="annot"><span class="annottext">Id -&gt; [CbvMark] -&gt; Id
</span><a href="GHC.Types.Id.html#setIdCbvMarks"><span class="hs-identifier hs-var">setIdCbvMarks</span></a></span><span> </span><span class="annot"><span class="annottext">Id
</span><a href="#local-6989586621682704587"><span class="hs-identifier hs-var">fun_id</span></a></span><span> </span><span class="annot"><span class="annottext">[CbvMark]
</span><a href="#local-6989586621682704605"><span class="hs-identifier hs-var">cbv_marks</span></a></span><span>
</span><span id="line-169"></span><span>               </span><span class="hs-comment">-- seqList: avoid retaining the original rhs</span><span>
</span><span id="line-170"></span><span>
</span><span id="line-171"></span><span>             </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">otherwise</span></span><span>
</span><span id="line-172"></span><span>             </span><span class="hs-glyph">=</span><span> </span><span class="hs-comment">-- pprTraceDebug &quot;computeCbvInfo: Worker seems to take unboxed tuple/sum types!&quot;</span><span>
</span><span id="line-173"></span><span>               </span><span class="hs-comment">--    (ppr fun_id &lt;+&gt; ppr rhs)</span><span>
</span><span id="line-174"></span><span>               </span><span class="annot"><span class="annottext">Id -&gt; Id
</span><a href="GHC.Types.Id.html#asNonWorkerLikeId"><span class="hs-identifier hs-var">asNonWorkerLikeId</span></a></span><span> </span><span class="annot"><span class="annottext">Id
</span><a href="#local-6989586621682704587"><span class="hs-identifier hs-var">fun_id</span></a></span><span>
</span><span id="line-175"></span><span>
</span><span id="line-176"></span><span>    </span><span class="hs-comment">-- We don't set CBV marks on functions which take unboxed tuples or sums as</span><span>
</span><span id="line-177"></span><span>    </span><span class="hs-comment">-- arguments.  Doing so would require us to compute the result of unarise</span><span>
</span><span id="line-178"></span><span>    </span><span class="hs-comment">-- here in order to properly determine argument positions at runtime.</span><span>
</span><span id="line-179"></span><span>    </span><span class="hs-comment">--</span><span>
</span><span id="line-180"></span><span>    </span><span class="hs-comment">-- In practice this doesn't matter much. Most &quot;interesting&quot; functions will</span><span>
</span><span id="line-181"></span><span>    </span><span class="hs-comment">-- get a W/W split which will eliminate unboxed tuple arguments, and unboxed</span><span>
</span><span id="line-182"></span><span>    </span><span class="hs-comment">-- sums are rarely used. But we could change this in the future and support</span><span>
</span><span id="line-183"></span><span>    </span><span class="hs-comment">-- unboxed sums/tuples as well.</span><span>
</span><span id="line-184"></span><span>    </span><span id="local-6989586621682704593"><span class="annot"><span class="annottext">valid_unlifted_worker :: t Id -&gt; Bool
</span><a href="#local-6989586621682704593"><span class="hs-identifier hs-var hs-var">valid_unlifted_worker</span></a></span></span><span> </span><span id="local-6989586621682704620"><span class="annot"><span class="annottext">t Id
</span><a href="#local-6989586621682704620"><span class="hs-identifier hs-var">args</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-185"></span><span>      </span><span class="hs-comment">-- pprTrace &quot;valid_unlifted&quot; (ppr fun_id $$ ppr args) $</span><span>
</span><span id="line-186"></span><span>      </span><span class="annot"><span class="annottext">(Id -&gt; Bool) -&gt; t Id -&gt; Bool
forall (t :: * -&gt; *) a. Foldable t =&gt; (a -&gt; Bool) -&gt; t a -&gt; Bool
</span><span class="hs-identifier hs-var">all</span></span><span> </span><span class="annot"><span class="annottext">Id -&gt; Bool
</span><a href="#local-6989586621682704622"><span class="hs-identifier hs-var">isSingleUnarisedArg</span></a></span><span> </span><span class="annot"><span class="annottext">t Id
</span><a href="#local-6989586621682704620"><span class="hs-identifier hs-var">args</span></a></span><span>
</span><span id="line-187"></span><span>
</span><span id="line-188"></span><span>    </span><span id="local-6989586621682704622"><span class="annot"><span class="annottext">isSingleUnarisedArg :: Id -&gt; Bool
</span><a href="#local-6989586621682704622"><span class="hs-identifier hs-var hs-var">isSingleUnarisedArg</span></a></span></span><span> </span><span id="local-6989586621682704625"><span class="annot"><span class="annottext">Id
</span><a href="#local-6989586621682704625"><span class="hs-identifier hs-var">v</span></a></span></span><span>
</span><span id="line-189"></span><span>      </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Type -&gt; Bool
</span><a href="GHC.Core.Type.html#isUnboxedSumType"><span class="hs-identifier hs-var">isUnboxedSumType</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682704627"><span class="hs-identifier hs-var">ty</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">False</span></span><span>
</span><span id="line-190"></span><span>      </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Type -&gt; Bool
</span><a href="GHC.Core.Type.html#isUnboxedTupleType"><span class="hs-identifier hs-var">isUnboxedTupleType</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682704627"><span class="hs-identifier hs-var">ty</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[PrimRep] -&gt; Bool
forall a. [a] -&gt; Bool
</span><a href="#local-6989586621682704629"><span class="hs-identifier hs-var">isSimplePrimRep</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">HasDebugCallStack =&gt; Type -&gt; [PrimRep]
Type -&gt; [PrimRep]
</span><a href="GHC.Types.RepType.html#typePrimRep"><span class="hs-identifier hs-var">typePrimRep</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682704627"><span class="hs-identifier hs-var">ty</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-191"></span><span>      </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">otherwise</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[PrimRep] -&gt; Bool
forall a. [a] -&gt; Bool
</span><a href="#local-6989586621682704629"><span class="hs-identifier hs-var">isSimplePrimRep</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">HasDebugCallStack =&gt; Type -&gt; [PrimRep]
Type -&gt; [PrimRep]
</span><a href="GHC.Types.RepType.html#typePrimRep"><span class="hs-identifier hs-var">typePrimRep</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682704627"><span class="hs-identifier hs-var">ty</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-192"></span><span>      </span><span class="hs-keyword">where</span><span>
</span><span id="line-193"></span><span>        </span><span id="local-6989586621682704627"><span class="annot"><span class="annottext">ty :: Type
</span><a href="#local-6989586621682704627"><span class="hs-identifier hs-var hs-var">ty</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Id -&gt; Type
</span><a href="GHC.Types.Id.html#idType"><span class="hs-identifier hs-var">idType</span></a></span><span> </span><span class="annot"><span class="annottext">Id
</span><a href="#local-6989586621682704625"><span class="hs-identifier hs-var">v</span></a></span><span>
</span><span id="line-194"></span><span>        </span><span id="local-6989586621682704629"><span class="annot"><span class="annottext">isSimplePrimRep :: [a] -&gt; Bool
</span><a href="#local-6989586621682704629"><span class="hs-identifier hs-var hs-var">isSimplePrimRep</span></a></span></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">True</span></span><span>
</span><span id="line-195"></span><span>        </span><span class="annot"><a href="#local-6989586621682704629"><span class="hs-identifier hs-var">isSimplePrimRep</span></a></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">a
</span><span class="hs-identifier">_</span></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">True</span></span><span>
</span><span id="line-196"></span><span>        </span><span class="annot"><a href="#local-6989586621682704629"><span class="hs-identifier hs-var">isSimplePrimRep</span></a></span><span> </span><span class="annot"><span class="annottext">[a]
</span><span class="hs-identifier">_</span></span><span>   </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">False</span></span><span>
</span><span id="line-197"></span><span>
</span><span id="line-198"></span><span>    </span><span id="local-6989586621682704613"><span class="annot"><span class="annottext">mkMark :: Id -&gt; CbvMark
</span><a href="#local-6989586621682704613"><span class="hs-identifier hs-var hs-var">mkMark</span></a></span></span><span> </span><span id="local-6989586621682704631"><span class="annot"><span class="annottext">Id
</span><a href="#local-6989586621682704631"><span class="hs-identifier hs-var">arg</span></a></span></span><span>
</span><span id="line-199"></span><span>      </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Bool
</span><span class="hs-identifier hs-var">not</span></span><span> </span><span class="annot"><span class="annottext">(Bool -&gt; Bool) -&gt; Bool -&gt; Bool
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Id -&gt; Bool
</span><a href="GHC.Core.Utils.html#shouldUseCbvForId"><span class="hs-identifier hs-var">shouldUseCbvForId</span></a></span><span> </span><span class="annot"><span class="annottext">Id
</span><a href="#local-6989586621682704631"><span class="hs-identifier hs-var">arg</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">CbvMark
</span><a href="GHC.Types.Basic.html#NotMarkedCbv"><span class="hs-identifier hs-var">NotMarkedCbv</span></a></span><span>
</span><span id="line-200"></span><span>      </span><span class="hs-comment">-- We can only safely use cbv for strict arguments</span><span>
</span><span id="line-201"></span><span>      </span><span class="hs-glyph">|</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Demand -&gt; Bool
</span><a href="GHC.Types.Demand.html#isStrUsedDmd"><span class="hs-identifier hs-var">isStrUsedDmd</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Id -&gt; Demand
</span><a href="GHC.Types.Id.html#idDemandInfo"><span class="hs-identifier hs-var">idDemandInfo</span></a></span><span> </span><span class="annot"><span class="annottext">Id
</span><a href="#local-6989586621682704631"><span class="hs-identifier hs-var">arg</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-202"></span><span>      </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Bool
</span><span class="hs-identifier hs-var">not</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Id -&gt; Bool
</span><a href="GHC.Types.Id.html#isDeadEndId"><span class="hs-identifier hs-var">isDeadEndId</span></a></span><span> </span><span class="annot"><span class="annottext">Id
</span><a href="#local-6989586621682704587"><span class="hs-identifier hs-var">fun_id</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">CbvMark
</span><a href="GHC.Types.Basic.html#MarkedCbv"><span class="hs-identifier hs-var">MarkedCbv</span></a></span><span>
</span><span id="line-203"></span><span>      </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">otherwise</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">CbvMark
</span><a href="GHC.Types.Basic.html#NotMarkedCbv"><span class="hs-identifier hs-var">NotMarkedCbv</span></a></span><span>
</span><span id="line-204"></span><span>
</span><span id="line-205"></span><span>
</span><span id="line-206"></span><span class="hs-comment">------------  Expressions  --------------</span><span>
</span><span id="line-207"></span><span class="annot"><a href="GHC.Core.Tidy.html#tidyExpr"><span class="hs-identifier hs-type">tidyExpr</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Types.Var.Env.html#TidyEnv"><span class="hs-identifier hs-type">TidyEnv</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Core.html#CoreExpr"><span class="hs-identifier hs-type">CoreExpr</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Core.html#CoreExpr"><span class="hs-identifier hs-type">CoreExpr</span></a></span><span>
</span><span id="line-208"></span><span id="tidyExpr"><span class="annot"><span class="annottext">tidyExpr :: TidyEnv -&gt; Expr Id -&gt; Expr Id
</span><a href="GHC.Core.Tidy.html#tidyExpr"><span class="hs-identifier hs-var hs-var">tidyExpr</span></a></span></span><span> </span><span id="local-6989586621682704637"><span class="annot"><span class="annottext">TidyEnv
</span><a href="#local-6989586621682704637"><span class="hs-identifier hs-var">env</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Core.html#Var"><span class="hs-identifier hs-type">Var</span></a></span><span> </span><span id="local-6989586621682704639"><span class="annot"><span class="annottext">Id
</span><a href="#local-6989586621682704639"><span class="hs-identifier hs-var">v</span></a></span></span><span class="hs-special">)</span><span>       </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Id -&gt; Expr Id
forall b. Id -&gt; Expr b
</span><a href="GHC.Core.html#Var"><span class="hs-identifier hs-var">Var</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TidyEnv -&gt; Id -&gt; Id
</span><a href="GHC.Core.Tidy.html#tidyVarOcc"><span class="hs-identifier hs-var">tidyVarOcc</span></a></span><span> </span><span class="annot"><span class="annottext">TidyEnv
</span><a href="#local-6989586621682704637"><span class="hs-identifier hs-var">env</span></a></span><span> </span><span class="annot"><span class="annottext">Id
</span><a href="#local-6989586621682704639"><span class="hs-identifier hs-var">v</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-209"></span><span class="annot"><a href="GHC.Core.Tidy.html#tidyExpr"><span class="hs-identifier hs-var">tidyExpr</span></a></span><span> </span><span id="local-6989586621682704641"><span class="annot"><span class="annottext">TidyEnv
</span><a href="#local-6989586621682704641"><span class="hs-identifier hs-var">env</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Core.html#Type"><span class="hs-identifier hs-type">Type</span></a></span><span> </span><span id="local-6989586621682704643"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682704643"><span class="hs-identifier hs-var">ty</span></a></span></span><span class="hs-special">)</span><span>     </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Type -&gt; Expr Id
forall b. Type -&gt; Expr b
</span><a href="GHC.Core.html#Type"><span class="hs-identifier hs-var">Type</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TidyEnv -&gt; Type -&gt; Type
</span><a href="GHC.Core.TyCo.Tidy.html#tidyType"><span class="hs-identifier hs-var">tidyType</span></a></span><span> </span><span class="annot"><span class="annottext">TidyEnv
</span><a href="#local-6989586621682704641"><span class="hs-identifier hs-var">env</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682704643"><span class="hs-identifier hs-var">ty</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-210"></span><span class="annot"><a href="GHC.Core.Tidy.html#tidyExpr"><span class="hs-identifier hs-var">tidyExpr</span></a></span><span> </span><span id="local-6989586621682704645"><span class="annot"><span class="annottext">TidyEnv
</span><a href="#local-6989586621682704645"><span class="hs-identifier hs-var">env</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Core.html#Coercion"><span class="hs-identifier hs-type">Coercion</span></a></span><span> </span><span id="local-6989586621682704647"><span class="annot"><span class="annottext">Coercion
</span><a href="#local-6989586621682704647"><span class="hs-identifier hs-var">co</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Coercion -&gt; Expr Id
forall b. Coercion -&gt; Expr b
</span><a href="GHC.Core.html#Coercion"><span class="hs-identifier hs-var">Coercion</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TidyEnv -&gt; Coercion -&gt; Coercion
</span><a href="GHC.Core.TyCo.Tidy.html#tidyCo"><span class="hs-identifier hs-var">tidyCo</span></a></span><span> </span><span class="annot"><span class="annottext">TidyEnv
</span><a href="#local-6989586621682704645"><span class="hs-identifier hs-var">env</span></a></span><span> </span><span class="annot"><span class="annottext">Coercion
</span><a href="#local-6989586621682704647"><span class="hs-identifier hs-var">co</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-211"></span><span class="annot"><a href="GHC.Core.Tidy.html#tidyExpr"><span class="hs-identifier hs-var">tidyExpr</span></a></span><span> </span><span class="annot"><span class="annottext">TidyEnv
</span><span class="hs-identifier">_</span></span><span>   </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Core.html#Lit"><span class="hs-identifier hs-type">Lit</span></a></span><span> </span><span id="local-6989586621682704649"><span class="annot"><span class="annottext">Literal
</span><a href="#local-6989586621682704649"><span class="hs-identifier hs-var">lit</span></a></span></span><span class="hs-special">)</span><span>     </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Literal -&gt; Expr Id
forall b. Literal -&gt; Expr b
</span><a href="GHC.Core.html#Lit"><span class="hs-identifier hs-var">Lit</span></a></span><span> </span><span class="annot"><span class="annottext">Literal
</span><a href="#local-6989586621682704649"><span class="hs-identifier hs-var">lit</span></a></span><span>
</span><span id="line-212"></span><span class="annot"><a href="GHC.Core.Tidy.html#tidyExpr"><span class="hs-identifier hs-var">tidyExpr</span></a></span><span> </span><span id="local-6989586621682704650"><span class="annot"><span class="annottext">TidyEnv
</span><a href="#local-6989586621682704650"><span class="hs-identifier hs-var">env</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Core.html#App"><span class="hs-identifier hs-type">App</span></a></span><span> </span><span id="local-6989586621682704652"><span class="annot"><span class="annottext">Expr Id
</span><a href="#local-6989586621682704652"><span class="hs-identifier hs-var">f</span></a></span></span><span> </span><span id="local-6989586621682704653"><span class="annot"><span class="annottext">Expr Id
</span><a href="#local-6989586621682704653"><span class="hs-identifier hs-var">a</span></a></span></span><span class="hs-special">)</span><span>     </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Expr Id -&gt; Expr Id -&gt; Expr Id
forall b. Expr b -&gt; Expr b -&gt; Expr b
</span><a href="GHC.Core.html#App"><span class="hs-identifier hs-var">App</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TidyEnv -&gt; Expr Id -&gt; Expr Id
</span><a href="GHC.Core.Tidy.html#tidyExpr"><span class="hs-identifier hs-var">tidyExpr</span></a></span><span> </span><span class="annot"><span class="annottext">TidyEnv
</span><a href="#local-6989586621682704650"><span class="hs-identifier hs-var">env</span></a></span><span> </span><span class="annot"><span class="annottext">Expr Id
</span><a href="#local-6989586621682704652"><span class="hs-identifier hs-var">f</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TidyEnv -&gt; Expr Id -&gt; Expr Id
</span><a href="GHC.Core.Tidy.html#tidyExpr"><span class="hs-identifier hs-var">tidyExpr</span></a></span><span> </span><span class="annot"><span class="annottext">TidyEnv
</span><a href="#local-6989586621682704650"><span class="hs-identifier hs-var">env</span></a></span><span> </span><span class="annot"><span class="annottext">Expr Id
</span><a href="#local-6989586621682704653"><span class="hs-identifier hs-var">a</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-213"></span><span class="annot"><a href="GHC.Core.Tidy.html#tidyExpr"><span class="hs-identifier hs-var">tidyExpr</span></a></span><span> </span><span id="local-6989586621682704654"><span class="annot"><span class="annottext">TidyEnv
</span><a href="#local-6989586621682704654"><span class="hs-identifier hs-var">env</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Core.html#Tick"><span class="hs-identifier hs-type">Tick</span></a></span><span> </span><span id="local-6989586621682704656"><span class="annot"><span class="annottext">CoreTickish
</span><a href="#local-6989586621682704656"><span class="hs-identifier hs-var">t</span></a></span></span><span> </span><span id="local-6989586621682704657"><span class="annot"><span class="annottext">Expr Id
</span><a href="#local-6989586621682704657"><span class="hs-identifier hs-var">e</span></a></span></span><span class="hs-special">)</span><span>    </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">CoreTickish -&gt; Expr Id -&gt; Expr Id
forall b. CoreTickish -&gt; Expr b -&gt; Expr b
</span><a href="GHC.Core.html#Tick"><span class="hs-identifier hs-var">Tick</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TidyEnv -&gt; CoreTickish -&gt; CoreTickish
</span><a href="GHC.Core.Tidy.html#tidyTickish"><span class="hs-identifier hs-var">tidyTickish</span></a></span><span> </span><span class="annot"><span class="annottext">TidyEnv
</span><a href="#local-6989586621682704654"><span class="hs-identifier hs-var">env</span></a></span><span> </span><span class="annot"><span class="annottext">CoreTickish
</span><a href="#local-6989586621682704656"><span class="hs-identifier hs-var">t</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TidyEnv -&gt; Expr Id -&gt; Expr Id
</span><a href="GHC.Core.Tidy.html#tidyExpr"><span class="hs-identifier hs-var">tidyExpr</span></a></span><span> </span><span class="annot"><span class="annottext">TidyEnv
</span><a href="#local-6989586621682704654"><span class="hs-identifier hs-var">env</span></a></span><span> </span><span class="annot"><span class="annottext">Expr Id
</span><a href="#local-6989586621682704657"><span class="hs-identifier hs-var">e</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-214"></span><span class="annot"><a href="GHC.Core.Tidy.html#tidyExpr"><span class="hs-identifier hs-var">tidyExpr</span></a></span><span> </span><span id="local-6989586621682704659"><span class="annot"><span class="annottext">TidyEnv
</span><a href="#local-6989586621682704659"><span class="hs-identifier hs-var">env</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Core.html#Cast"><span class="hs-identifier hs-type">Cast</span></a></span><span> </span><span id="local-6989586621682704661"><span class="annot"><span class="annottext">Expr Id
</span><a href="#local-6989586621682704661"><span class="hs-identifier hs-var">e</span></a></span></span><span> </span><span id="local-6989586621682704662"><span class="annot"><span class="annottext">Coercion
</span><a href="#local-6989586621682704662"><span class="hs-identifier hs-var">co</span></a></span></span><span class="hs-special">)</span><span>   </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Expr Id -&gt; Coercion -&gt; Expr Id
forall b. Expr b -&gt; Coercion -&gt; Expr b
</span><a href="GHC.Core.html#Cast"><span class="hs-identifier hs-var">Cast</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TidyEnv -&gt; Expr Id -&gt; Expr Id
</span><a href="GHC.Core.Tidy.html#tidyExpr"><span class="hs-identifier hs-var">tidyExpr</span></a></span><span> </span><span class="annot"><span class="annottext">TidyEnv
</span><a href="#local-6989586621682704659"><span class="hs-identifier hs-var">env</span></a></span><span> </span><span class="annot"><span class="annottext">Expr Id
</span><a href="#local-6989586621682704661"><span class="hs-identifier hs-var">e</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TidyEnv -&gt; Coercion -&gt; Coercion
</span><a href="GHC.Core.TyCo.Tidy.html#tidyCo"><span class="hs-identifier hs-var">tidyCo</span></a></span><span> </span><span class="annot"><span class="annottext">TidyEnv
</span><a href="#local-6989586621682704659"><span class="hs-identifier hs-var">env</span></a></span><span> </span><span class="annot"><span class="annottext">Coercion
</span><a href="#local-6989586621682704662"><span class="hs-identifier hs-var">co</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-215"></span><span>
</span><span id="line-216"></span><span class="annot"><a href="GHC.Core.Tidy.html#tidyExpr"><span class="hs-identifier hs-var">tidyExpr</span></a></span><span> </span><span id="local-6989586621682704663"><span class="annot"><span class="annottext">TidyEnv
</span><a href="#local-6989586621682704663"><span class="hs-identifier hs-var">env</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Core.html#Let"><span class="hs-identifier hs-type">Let</span></a></span><span> </span><span id="local-6989586621682704665"><span class="annot"><span class="annottext">CoreBind
</span><a href="#local-6989586621682704665"><span class="hs-identifier hs-var">b</span></a></span></span><span> </span><span id="local-6989586621682704666"><span class="annot"><span class="annottext">Expr Id
</span><a href="#local-6989586621682704666"><span class="hs-identifier hs-var">e</span></a></span></span><span class="hs-special">)</span><span>
</span><span id="line-217"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">TidyEnv -&gt; CoreBind -&gt; (TidyEnv, CoreBind)
</span><a href="GHC.Core.Tidy.html#tidyBind"><span class="hs-identifier hs-var">tidyBind</span></a></span><span> </span><span class="annot"><span class="annottext">TidyEnv
</span><a href="#local-6989586621682704663"><span class="hs-identifier hs-var">env</span></a></span><span> </span><span class="annot"><span class="annottext">CoreBind
</span><a href="#local-6989586621682704665"><span class="hs-identifier hs-var">b</span></a></span><span>      </span><span class="annot"><span class="annottext">(TidyEnv, CoreBind) -&gt; ((TidyEnv, CoreBind) -&gt; Expr Id) -&gt; Expr Id
forall a b. a -&gt; (a -&gt; b) -&gt; b
</span><a href="GHC.Core.Tidy.html#%3D%3A"><span class="hs-operator hs-var">=:</span></a></span><span> </span><span class="hs-glyph">\</span><span> </span><span class="hs-special">(</span><span id="local-6989586621682704667"><span class="annot"><span class="annottext">TidyEnv
</span><a href="#local-6989586621682704667"><span class="hs-identifier hs-var">env'</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682704668"><span class="annot"><span class="annottext">CoreBind
</span><a href="#local-6989586621682704668"><span class="hs-identifier hs-var">b'</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-218"></span><span>    </span><span class="annot"><span class="annottext">CoreBind -&gt; Expr Id -&gt; Expr Id
forall b. Bind b -&gt; Expr b -&gt; Expr b
</span><a href="GHC.Core.html#Let"><span class="hs-identifier hs-var">Let</span></a></span><span> </span><span class="annot"><span class="annottext">CoreBind
</span><a href="#local-6989586621682704668"><span class="hs-identifier hs-var">b'</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TidyEnv -&gt; Expr Id -&gt; Expr Id
</span><a href="GHC.Core.Tidy.html#tidyExpr"><span class="hs-identifier hs-var">tidyExpr</span></a></span><span> </span><span class="annot"><span class="annottext">TidyEnv
</span><a href="#local-6989586621682704667"><span class="hs-identifier hs-var">env'</span></a></span><span> </span><span class="annot"><span class="annottext">Expr Id
</span><a href="#local-6989586621682704666"><span class="hs-identifier hs-var">e</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-219"></span><span>
</span><span id="line-220"></span><span class="annot"><a href="GHC.Core.Tidy.html#tidyExpr"><span class="hs-identifier hs-var">tidyExpr</span></a></span><span> </span><span id="local-6989586621682704669"><span class="annot"><span class="annottext">TidyEnv
</span><a href="#local-6989586621682704669"><span class="hs-identifier hs-var">env</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Core.html#Case"><span class="hs-identifier hs-type">Case</span></a></span><span> </span><span id="local-6989586621682704671"><span class="annot"><span class="annottext">Expr Id
</span><a href="#local-6989586621682704671"><span class="hs-identifier hs-var">e</span></a></span></span><span> </span><span id="local-6989586621682704672"><span class="annot"><span class="annottext">Id
</span><a href="#local-6989586621682704672"><span class="hs-identifier hs-var">b</span></a></span></span><span> </span><span id="local-6989586621682704673"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682704673"><span class="hs-identifier hs-var">ty</span></a></span></span><span> </span><span id="local-6989586621682704674"><span class="annot"><span class="annottext">[Alt Id]
</span><a href="#local-6989586621682704674"><span class="hs-identifier hs-var">alts</span></a></span></span><span class="hs-special">)</span><span>
</span><span id="line-221"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">TidyEnv -&gt; Id -&gt; (TidyEnv, Id)
</span><a href="GHC.Core.Tidy.html#tidyBndr"><span class="hs-identifier hs-var">tidyBndr</span></a></span><span> </span><span class="annot"><span class="annottext">TidyEnv
</span><a href="#local-6989586621682704669"><span class="hs-identifier hs-var">env</span></a></span><span> </span><span class="annot"><span class="annottext">Id
</span><a href="#local-6989586621682704672"><span class="hs-identifier hs-var">b</span></a></span><span>  </span><span class="annot"><span class="annottext">(TidyEnv, Id) -&gt; ((TidyEnv, Id) -&gt; Expr Id) -&gt; Expr Id
forall a b. a -&gt; (a -&gt; b) -&gt; b
</span><a href="GHC.Core.Tidy.html#%3D%3A"><span class="hs-operator hs-var">=:</span></a></span><span> </span><span class="hs-glyph">\</span><span> </span><span class="hs-special">(</span><span id="local-6989586621682704676"><span class="annot"><span class="annottext">TidyEnv
</span><a href="#local-6989586621682704676"><span class="hs-identifier hs-var">env'</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682704677"><span class="annot"><span class="annottext">Id
</span><a href="#local-6989586621682704677"><span class="hs-identifier hs-var">b</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-222"></span><span>    </span><span class="annot"><span class="annottext">Expr Id -&gt; Id -&gt; Type -&gt; [Alt Id] -&gt; Expr Id
forall b. Expr b -&gt; b -&gt; Type -&gt; [Alt b] -&gt; Expr b
</span><a href="GHC.Core.html#Case"><span class="hs-identifier hs-var">Case</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TidyEnv -&gt; Expr Id -&gt; Expr Id
</span><a href="GHC.Core.Tidy.html#tidyExpr"><span class="hs-identifier hs-var">tidyExpr</span></a></span><span> </span><span class="annot"><span class="annottext">TidyEnv
</span><a href="#local-6989586621682704669"><span class="hs-identifier hs-var">env</span></a></span><span> </span><span class="annot"><span class="annottext">Expr Id
</span><a href="#local-6989586621682704671"><span class="hs-identifier hs-var">e</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Id
</span><a href="#local-6989586621682704677"><span class="hs-identifier hs-var">b</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TidyEnv -&gt; Type -&gt; Type
</span><a href="GHC.Core.TyCo.Tidy.html#tidyType"><span class="hs-identifier hs-var">tidyType</span></a></span><span> </span><span class="annot"><span class="annottext">TidyEnv
</span><a href="#local-6989586621682704669"><span class="hs-identifier hs-var">env</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682704673"><span class="hs-identifier hs-var">ty</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-223"></span><span>         </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(Alt Id -&gt; Alt Id) -&gt; [Alt Id] -&gt; [Alt Id]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><span class="hs-identifier hs-var">map</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TidyEnv -&gt; Alt Id -&gt; Alt Id
</span><a href="GHC.Core.Tidy.html#tidyAlt"><span class="hs-identifier hs-var">tidyAlt</span></a></span><span> </span><span class="annot"><span class="annottext">TidyEnv
</span><a href="#local-6989586621682704676"><span class="hs-identifier hs-var">env'</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[Alt Id]
</span><a href="#local-6989586621682704674"><span class="hs-identifier hs-var">alts</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-224"></span><span>
</span><span id="line-225"></span><span class="annot"><a href="GHC.Core.Tidy.html#tidyExpr"><span class="hs-identifier hs-var">tidyExpr</span></a></span><span> </span><span id="local-6989586621682704679"><span class="annot"><span class="annottext">TidyEnv
</span><a href="#local-6989586621682704679"><span class="hs-identifier hs-var">env</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Core.html#Lam"><span class="hs-identifier hs-type">Lam</span></a></span><span> </span><span id="local-6989586621682704681"><span class="annot"><span class="annottext">Id
</span><a href="#local-6989586621682704681"><span class="hs-identifier hs-var">b</span></a></span></span><span> </span><span id="local-6989586621682704682"><span class="annot"><span class="annottext">Expr Id
</span><a href="#local-6989586621682704682"><span class="hs-identifier hs-var">e</span></a></span></span><span class="hs-special">)</span><span>
</span><span id="line-226"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">TidyEnv -&gt; Id -&gt; (TidyEnv, Id)
</span><a href="GHC.Core.Tidy.html#tidyBndr"><span class="hs-identifier hs-var">tidyBndr</span></a></span><span> </span><span class="annot"><span class="annottext">TidyEnv
</span><a href="#local-6989586621682704679"><span class="hs-identifier hs-var">env</span></a></span><span> </span><span class="annot"><span class="annottext">Id
</span><a href="#local-6989586621682704681"><span class="hs-identifier hs-var">b</span></a></span><span>      </span><span class="annot"><span class="annottext">(TidyEnv, Id) -&gt; ((TidyEnv, Id) -&gt; Expr Id) -&gt; Expr Id
forall a b. a -&gt; (a -&gt; b) -&gt; b
</span><a href="GHC.Core.Tidy.html#%3D%3A"><span class="hs-operator hs-var">=:</span></a></span><span> </span><span class="hs-glyph">\</span><span> </span><span class="hs-special">(</span><span id="local-6989586621682704683"><span class="annot"><span class="annottext">TidyEnv
</span><a href="#local-6989586621682704683"><span class="hs-identifier hs-var">env'</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682704684"><span class="annot"><span class="annottext">Id
</span><a href="#local-6989586621682704684"><span class="hs-identifier hs-var">b</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-227"></span><span>    </span><span class="annot"><span class="annottext">Id -&gt; Expr Id -&gt; Expr Id
forall b. b -&gt; Expr b -&gt; Expr b
</span><a href="GHC.Core.html#Lam"><span class="hs-identifier hs-var">Lam</span></a></span><span> </span><span class="annot"><span class="annottext">Id
</span><a href="#local-6989586621682704684"><span class="hs-identifier hs-var">b</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TidyEnv -&gt; Expr Id -&gt; Expr Id
</span><a href="GHC.Core.Tidy.html#tidyExpr"><span class="hs-identifier hs-var">tidyExpr</span></a></span><span> </span><span class="annot"><span class="annottext">TidyEnv
</span><a href="#local-6989586621682704683"><span class="hs-identifier hs-var">env'</span></a></span><span> </span><span class="annot"><span class="annottext">Expr Id
</span><a href="#local-6989586621682704682"><span class="hs-identifier hs-var">e</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-228"></span><span>
</span><span id="line-229"></span><span class="hs-comment">------------  Case alternatives  --------------</span><span>
</span><span id="line-230"></span><span class="annot"><a href="GHC.Core.Tidy.html#tidyAlt"><span class="hs-identifier hs-type">tidyAlt</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Types.Var.Env.html#TidyEnv"><span class="hs-identifier hs-type">TidyEnv</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Core.html#CoreAlt"><span class="hs-identifier hs-type">CoreAlt</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Core.html#CoreAlt"><span class="hs-identifier hs-type">CoreAlt</span></a></span><span>
</span><span id="line-231"></span><span id="tidyAlt"><span class="annot"><span class="annottext">tidyAlt :: TidyEnv -&gt; Alt Id -&gt; Alt Id
</span><a href="GHC.Core.Tidy.html#tidyAlt"><span class="hs-identifier hs-var hs-var">tidyAlt</span></a></span></span><span> </span><span id="local-6989586621682704686"><span class="annot"><span class="annottext">TidyEnv
</span><a href="#local-6989586621682704686"><span class="hs-identifier hs-var">env</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Core.html#Alt"><span class="hs-identifier hs-type">Alt</span></a></span><span> </span><span id="local-6989586621682704688"><span class="annot"><span class="annottext">AltCon
</span><a href="#local-6989586621682704688"><span class="hs-identifier hs-var">con</span></a></span></span><span> </span><span id="local-6989586621682704689"><span class="annot"><span class="annottext">[Id]
</span><a href="#local-6989586621682704689"><span class="hs-identifier hs-var">vs</span></a></span></span><span> </span><span id="local-6989586621682704690"><span class="annot"><span class="annottext">Expr Id
</span><a href="#local-6989586621682704690"><span class="hs-identifier hs-var">rhs</span></a></span></span><span class="hs-special">)</span><span>
</span><span id="line-232"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">TidyEnv -&gt; [Id] -&gt; (TidyEnv, [Id])
</span><a href="GHC.Core.Tidy.html#tidyBndrs"><span class="hs-identifier hs-var">tidyBndrs</span></a></span><span> </span><span class="annot"><span class="annottext">TidyEnv
</span><a href="#local-6989586621682704686"><span class="hs-identifier hs-var">env</span></a></span><span> </span><span class="annot"><span class="annottext">[Id]
</span><a href="#local-6989586621682704689"><span class="hs-identifier hs-var">vs</span></a></span><span>    </span><span class="annot"><span class="annottext">(TidyEnv, [Id]) -&gt; ((TidyEnv, [Id]) -&gt; Alt Id) -&gt; Alt Id
forall a b. a -&gt; (a -&gt; b) -&gt; b
</span><a href="GHC.Core.Tidy.html#%3D%3A"><span class="hs-operator hs-var">=:</span></a></span><span> </span><span class="hs-glyph">\</span><span> </span><span class="hs-special">(</span><span id="local-6989586621682704691"><span class="annot"><span class="annottext">TidyEnv
</span><a href="#local-6989586621682704691"><span class="hs-identifier hs-var">env'</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682704692"><span class="annot"><span class="annottext">[Id]
</span><a href="#local-6989586621682704692"><span class="hs-identifier hs-var">vs</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-233"></span><span>    </span><span class="hs-special">(</span><span class="annot"><span class="annottext">AltCon -&gt; [Id] -&gt; Expr Id -&gt; Alt Id
forall b. AltCon -&gt; [b] -&gt; Expr b -&gt; Alt b
</span><a href="GHC.Core.html#Alt"><span class="hs-identifier hs-var">Alt</span></a></span><span> </span><span class="annot"><span class="annottext">AltCon
</span><a href="#local-6989586621682704688"><span class="hs-identifier hs-var">con</span></a></span><span> </span><span class="annot"><span class="annottext">[Id]
</span><a href="#local-6989586621682704692"><span class="hs-identifier hs-var">vs</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TidyEnv -&gt; Expr Id -&gt; Expr Id
</span><a href="GHC.Core.Tidy.html#tidyExpr"><span class="hs-identifier hs-var">tidyExpr</span></a></span><span> </span><span class="annot"><span class="annottext">TidyEnv
</span><a href="#local-6989586621682704691"><span class="hs-identifier hs-var">env'</span></a></span><span> </span><span class="annot"><span class="annottext">Expr Id
</span><a href="#local-6989586621682704690"><span class="hs-identifier hs-var">rhs</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-234"></span><span>
</span><span id="line-235"></span><span class="hs-comment">------------  Tickish  --------------</span><span>
</span><span id="line-236"></span><span class="annot"><a href="GHC.Core.Tidy.html#tidyTickish"><span class="hs-identifier hs-type">tidyTickish</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Types.Var.Env.html#TidyEnv"><span class="hs-identifier hs-type">TidyEnv</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Types.Tickish.html#CoreTickish"><span class="hs-identifier hs-type">CoreTickish</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Types.Tickish.html#CoreTickish"><span class="hs-identifier hs-type">CoreTickish</span></a></span><span>
</span><span id="line-237"></span><span id="tidyTickish"><span class="annot"><span class="annottext">tidyTickish :: TidyEnv -&gt; CoreTickish -&gt; CoreTickish
</span><a href="GHC.Core.Tidy.html#tidyTickish"><span class="hs-identifier hs-var hs-var">tidyTickish</span></a></span></span><span> </span><span id="local-6989586621682704693"><span class="annot"><span class="annottext">TidyEnv
</span><a href="#local-6989586621682704693"><span class="hs-identifier hs-var">env</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Types.Tickish.html#Breakpoint"><span class="hs-identifier hs-type">Breakpoint</span></a></span><span> </span><span id="local-6989586621682704695"><span class="annot"><span class="annottext">XBreakpoint 'TickishPassCore
</span><a href="#local-6989586621682704695"><span class="hs-identifier hs-var">ext</span></a></span></span><span> </span><span id="local-6989586621682704696"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621682704696"><span class="hs-identifier hs-var">ix</span></a></span></span><span> </span><span id="local-6989586621682704697"><span class="annot"><span class="annottext">[XTickishId 'TickishPassCore]
</span><a href="#local-6989586621682704697"><span class="hs-identifier hs-var">ids</span></a></span></span><span> </span><span id="local-6989586621682704698"><span class="annot"><span class="annottext">Module
</span><a href="#local-6989586621682704698"><span class="hs-identifier hs-var">modl</span></a></span></span><span class="hs-special">)</span><span>
</span><span id="line-238"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">XBreakpoint 'TickishPassCore
-&gt; Int -&gt; [XTickishId 'TickishPassCore] -&gt; Module -&gt; CoreTickish
forall (pass :: TickishPass).
XBreakpoint pass
-&gt; Int -&gt; [XTickishId pass] -&gt; Module -&gt; GenTickish pass
</span><a href="GHC.Types.Tickish.html#Breakpoint"><span class="hs-identifier hs-var">Breakpoint</span></a></span><span> </span><span class="annot"><span class="annottext">XBreakpoint 'TickishPassCore
</span><a href="#local-6989586621682704695"><span class="hs-identifier hs-var">ext</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621682704696"><span class="hs-identifier hs-var">ix</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(Id -&gt; Id) -&gt; [Id] -&gt; [Id]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><span class="hs-identifier hs-var">map</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TidyEnv -&gt; Id -&gt; Id
</span><a href="GHC.Core.Tidy.html#tidyVarOcc"><span class="hs-identifier hs-var">tidyVarOcc</span></a></span><span> </span><span class="annot"><span class="annottext">TidyEnv
</span><a href="#local-6989586621682704693"><span class="hs-identifier hs-var">env</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[Id]
[XTickishId 'TickishPassCore]
</span><a href="#local-6989586621682704697"><span class="hs-identifier hs-var">ids</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Module
</span><a href="#local-6989586621682704698"><span class="hs-identifier hs-var">modl</span></a></span><span>
</span><span id="line-239"></span><span class="annot"><a href="GHC.Core.Tidy.html#tidyTickish"><span class="hs-identifier hs-var">tidyTickish</span></a></span><span> </span><span class="annot"><span class="annottext">TidyEnv
</span><span class="hs-identifier">_</span></span><span>   </span><span id="local-6989586621682704699"><span class="annot"><span class="annottext">CoreTickish
</span><a href="#local-6989586621682704699"><span class="hs-identifier hs-var">other_tickish</span></a></span></span><span>       </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">CoreTickish
</span><a href="#local-6989586621682704699"><span class="hs-identifier hs-var">other_tickish</span></a></span><span>
</span><span id="line-240"></span><span>
</span><span id="line-241"></span><span class="hs-comment">------------  Rules  --------------</span><span>
</span><span id="line-242"></span><span class="annot"><a href="GHC.Core.Tidy.html#tidyRules"><span class="hs-identifier hs-type">tidyRules</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Types.Var.Env.html#TidyEnv"><span class="hs-identifier hs-type">TidyEnv</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="GHC.Core.html#CoreRule"><span class="hs-identifier hs-type">CoreRule</span></a></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="GHC.Core.html#CoreRule"><span class="hs-identifier hs-type">CoreRule</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-243"></span><span id="tidyRules"><span class="annot"><span class="annottext">tidyRules :: TidyEnv -&gt; [CoreRule] -&gt; [CoreRule]
</span><a href="GHC.Core.Tidy.html#tidyRules"><span class="hs-identifier hs-var hs-var">tidyRules</span></a></span></span><span> </span><span class="annot"><span class="annottext">TidyEnv
</span><span class="hs-identifier">_</span></span><span>   </span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span>
</span><span id="line-244"></span><span class="annot"><a href="GHC.Core.Tidy.html#tidyRules"><span class="hs-identifier hs-var">tidyRules</span></a></span><span> </span><span id="local-6989586621682704700"><span class="annot"><span class="annottext">TidyEnv
</span><a href="#local-6989586621682704700"><span class="hs-identifier hs-var">env</span></a></span></span><span> </span><span class="hs-special">(</span><span id="local-6989586621682704701"><span class="annot"><span class="annottext">CoreRule
</span><a href="#local-6989586621682704701"><span class="hs-identifier hs-var">rule</span></a></span></span><span> </span><span class="annot"><span class="hs-glyph hs-type">:</span></span><span> </span><span id="local-6989586621682704702"><span class="annot"><span class="annottext">[CoreRule]
</span><a href="#local-6989586621682704702"><span class="hs-identifier hs-var">rules</span></a></span></span><span class="hs-special">)</span><span>
</span><span id="line-245"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">TidyEnv -&gt; CoreRule -&gt; CoreRule
</span><a href="GHC.Core.Tidy.html#tidyRule"><span class="hs-identifier hs-var">tidyRule</span></a></span><span> </span><span class="annot"><span class="annottext">TidyEnv
</span><a href="#local-6989586621682704700"><span class="hs-identifier hs-var">env</span></a></span><span> </span><span class="annot"><span class="annottext">CoreRule
</span><a href="#local-6989586621682704701"><span class="hs-identifier hs-var">rule</span></a></span><span>           </span><span class="annot"><span class="annottext">CoreRule -&gt; (CoreRule -&gt; [CoreRule]) -&gt; [CoreRule]
forall a b. a -&gt; (a -&gt; b) -&gt; b
</span><a href="GHC.Core.Tidy.html#%3D%3A"><span class="hs-operator hs-var">=:</span></a></span><span> </span><span class="hs-glyph">\</span><span> </span><span id="local-6989586621682704704"><span class="annot"><span class="annottext">CoreRule
</span><a href="#local-6989586621682704704"><span class="hs-identifier hs-var">rule</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-246"></span><span>    </span><span class="annot"><span class="annottext">TidyEnv -&gt; [CoreRule] -&gt; [CoreRule]
</span><a href="GHC.Core.Tidy.html#tidyRules"><span class="hs-identifier hs-var">tidyRules</span></a></span><span> </span><span class="annot"><span class="annottext">TidyEnv
</span><a href="#local-6989586621682704700"><span class="hs-identifier hs-var">env</span></a></span><span> </span><span class="annot"><span class="annottext">[CoreRule]
</span><a href="#local-6989586621682704702"><span class="hs-identifier hs-var">rules</span></a></span><span>         </span><span class="annot"><span class="annottext">[CoreRule] -&gt; ([CoreRule] -&gt; [CoreRule]) -&gt; [CoreRule]
forall a b. a -&gt; (a -&gt; b) -&gt; b
</span><a href="GHC.Core.Tidy.html#%3D%3A"><span class="hs-operator hs-var">=:</span></a></span><span> </span><span class="hs-glyph">\</span><span> </span><span id="local-6989586621682704705"><span class="annot"><span class="annottext">[CoreRule]
</span><a href="#local-6989586621682704705"><span class="hs-identifier hs-var">rules</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-247"></span><span>    </span><span class="hs-special">(</span><span class="annot"><span class="annottext">CoreRule
</span><a href="#local-6989586621682704704"><span class="hs-identifier hs-var">rule</span></a></span><span> </span><span class="annot"><span class="annottext">CoreRule -&gt; [CoreRule] -&gt; [CoreRule]
forall a. a -&gt; [a] -&gt; [a]
</span><span class="hs-glyph hs-var">:</span></span><span> </span><span class="annot"><span class="annottext">[CoreRule]
</span><a href="#local-6989586621682704705"><span class="hs-identifier hs-var">rules</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-248"></span><span>
</span><span id="line-249"></span><span class="annot"><a href="GHC.Core.Tidy.html#tidyRule"><span class="hs-identifier hs-type">tidyRule</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Types.Var.Env.html#TidyEnv"><span class="hs-identifier hs-type">TidyEnv</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Core.html#CoreRule"><span class="hs-identifier hs-type">CoreRule</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Core.html#CoreRule"><span class="hs-identifier hs-type">CoreRule</span></a></span><span>
</span><span id="line-250"></span><span id="tidyRule"><span class="annot"><span class="annottext">tidyRule :: TidyEnv -&gt; CoreRule -&gt; CoreRule
</span><a href="GHC.Core.Tidy.html#tidyRule"><span class="hs-identifier hs-var hs-var">tidyRule</span></a></span></span><span> </span><span class="annot"><span class="annottext">TidyEnv
</span><span class="hs-identifier">_</span></span><span>   </span><span id="local-6989586621682704706"><span class="annot"><span class="annottext">rule :: CoreRule
</span><a href="#local-6989586621682704706"><span class="hs-identifier hs-var">rule</span></a></span></span><span class="hs-glyph">@</span><span class="hs-special">(</span><span class="annot"><a href="GHC.Core.html#BuiltinRule"><span class="hs-identifier hs-type">BuiltinRule</span></a></span><span> </span><span class="hs-special">{</span><span class="hs-special">}</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">CoreRule
</span><a href="#local-6989586621682704706"><span class="hs-identifier hs-var">rule</span></a></span><span>
</span><span id="line-251"></span><span class="annot"><a href="GHC.Core.Tidy.html#tidyRule"><span class="hs-identifier hs-var">tidyRule</span></a></span><span> </span><span id="local-6989586621682704708"><span class="annot"><span class="annottext">TidyEnv
</span><a href="#local-6989586621682704708"><span class="hs-identifier hs-var">env</span></a></span></span><span> </span><span id="local-6989586621682704709"><span class="annot"><span class="annottext">rule :: CoreRule
</span><a href="#local-6989586621682704709"><span class="hs-identifier hs-var">rule</span></a></span></span><span class="hs-glyph">@</span><span class="hs-special">(</span><span class="annot"><a href="GHC.Core.html#Rule"><span class="hs-identifier hs-type">Rule</span></a></span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">ru_bndrs :: CoreRule -&gt; [Id]
</span><a href="GHC.Core.html#ru_bndrs"><span class="hs-identifier hs-var">ru_bndrs</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="local-6989586621682704712"><span class="annot"><span class="annottext">[Id]
</span><a href="#local-6989586621682704712"><span class="hs-identifier hs-var">bndrs</span></a></span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">ru_args :: CoreRule -&gt; [Expr Id]
</span><a href="GHC.Core.html#ru_args"><span class="hs-identifier hs-var">ru_args</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="local-6989586621682704714"><span class="annot"><span class="annottext">[Expr Id]
</span><a href="#local-6989586621682704714"><span class="hs-identifier hs-var">args</span></a></span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">ru_rhs :: CoreRule -&gt; Expr Id
</span><a href="GHC.Core.html#ru_rhs"><span class="hs-identifier hs-var">ru_rhs</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="local-6989586621682704716"><span class="annot"><span class="annottext">Expr Id
</span><a href="#local-6989586621682704716"><span class="hs-identifier hs-var">rhs</span></a></span></span><span class="hs-special">,</span><span>
</span><span id="line-252"></span><span>                          </span><span class="annot"><span class="annottext">ru_fn :: CoreRule -&gt; Name
</span><a href="GHC.Core.html#ru_fn"><span class="hs-identifier hs-var">ru_fn</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="local-6989586621682704718"><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621682704718"><span class="hs-identifier hs-var">fn</span></a></span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">ru_rough :: CoreRule -&gt; [Maybe Name]
</span><a href="GHC.Core.html#ru_rough"><span class="hs-identifier hs-var">ru_rough</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="local-6989586621682704720"><span class="annot"><span class="annottext">[Maybe Name]
</span><a href="#local-6989586621682704720"><span class="hs-identifier hs-var">mb_ns</span></a></span></span><span> </span><span class="hs-special">}</span><span class="hs-special">)</span><span>
</span><span id="line-253"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">TidyEnv -&gt; [Id] -&gt; (TidyEnv, [Id])
</span><a href="GHC.Core.Tidy.html#tidyBndrs"><span class="hs-identifier hs-var">tidyBndrs</span></a></span><span> </span><span class="annot"><span class="annottext">TidyEnv
</span><a href="#local-6989586621682704708"><span class="hs-identifier hs-var">env</span></a></span><span> </span><span class="annot"><span class="annottext">[Id]
</span><a href="#local-6989586621682704712"><span class="hs-identifier hs-var">bndrs</span></a></span><span>         </span><span class="annot"><span class="annottext">(TidyEnv, [Id]) -&gt; ((TidyEnv, [Id]) -&gt; CoreRule) -&gt; CoreRule
forall a b. a -&gt; (a -&gt; b) -&gt; b
</span><a href="GHC.Core.Tidy.html#%3D%3A"><span class="hs-operator hs-var">=:</span></a></span><span> </span><span class="hs-glyph">\</span><span> </span><span class="hs-special">(</span><span id="local-6989586621682704721"><span class="annot"><span class="annottext">TidyEnv
</span><a href="#local-6989586621682704721"><span class="hs-identifier hs-var">env'</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682704722"><span class="annot"><span class="annottext">[Id]
</span><a href="#local-6989586621682704722"><span class="hs-identifier hs-var">bndrs</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-254"></span><span>    </span><span class="annot"><span class="annottext">(Expr Id -&gt; Expr Id) -&gt; [Expr Id] -&gt; [Expr Id]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><span class="hs-identifier hs-var">map</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TidyEnv -&gt; Expr Id -&gt; Expr Id
</span><a href="GHC.Core.Tidy.html#tidyExpr"><span class="hs-identifier hs-var">tidyExpr</span></a></span><span> </span><span class="annot"><span class="annottext">TidyEnv
</span><a href="#local-6989586621682704721"><span class="hs-identifier hs-var">env'</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[Expr Id]
</span><a href="#local-6989586621682704714"><span class="hs-identifier hs-var">args</span></a></span><span>    </span><span class="annot"><span class="annottext">[Expr Id] -&gt; ([Expr Id] -&gt; CoreRule) -&gt; CoreRule
forall a b. a -&gt; (a -&gt; b) -&gt; b
</span><a href="GHC.Core.Tidy.html#%3D%3A"><span class="hs-operator hs-var">=:</span></a></span><span> </span><span class="hs-glyph">\</span><span> </span><span id="local-6989586621682704723"><span class="annot"><span class="annottext">[Expr Id]
</span><a href="#local-6989586621682704723"><span class="hs-identifier hs-var">args</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-255"></span><span>    </span><span class="annot"><span class="annottext">CoreRule
</span><a href="#local-6989586621682704709"><span class="hs-identifier hs-var">rule</span></a></span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><a href="GHC.Core.html#ru_bndrs"><span class="hs-identifier hs-var">ru_bndrs</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="#local-6989586621682704722"><span class="hs-identifier hs-type">bndrs</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Core.html#ru_args"><span class="hs-identifier hs-var">ru_args</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="#local-6989586621682704723"><span class="hs-identifier hs-type">args</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-256"></span><span>           </span><span class="annot"><a href="GHC.Core.html#ru_rhs"><span class="hs-identifier hs-var">ru_rhs</span></a></span><span>   </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="GHC.Core.Tidy.html#tidyExpr"><span class="hs-identifier hs-type">tidyExpr</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682704721"><span class="hs-identifier hs-type">env'</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682704716"><span class="hs-identifier hs-type">rhs</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-257"></span><span>           </span><span class="annot"><a href="GHC.Core.html#ru_fn"><span class="hs-identifier hs-var">ru_fn</span></a></span><span>    </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="GHC.Core.Tidy.html#tidyNameOcc"><span class="hs-identifier hs-type">tidyNameOcc</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682704708"><span class="hs-identifier hs-type">env</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682704718"><span class="hs-identifier hs-type">fn</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-258"></span><span>           </span><span class="annot"><a href="GHC.Core.html#ru_rough"><span class="hs-identifier hs-var">ru_rough</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="hs-identifier hs-type">map</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">fmap</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Core.Tidy.html#tidyNameOcc"><span class="hs-identifier hs-type">tidyNameOcc</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682704721"><span class="hs-identifier hs-type">env'</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="annot"><a href="#local-6989586621682704720"><span class="hs-identifier hs-type">mb_ns</span></a></span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-259"></span><span>
</span><span id="line-260"></span><span class="hs-comment">{-
************************************************************************
*                                                                      *
\subsection{Tidying non-top-level binders}
*                                                                      *
************************************************************************
-}</span><span>
</span><span id="line-267"></span><span>
</span><span id="line-268"></span><span class="annot"><a href="GHC.Core.Tidy.html#tidyNameOcc"><span class="hs-identifier hs-type">tidyNameOcc</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Types.Var.Env.html#TidyEnv"><span class="hs-identifier hs-type">TidyEnv</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Types.Name.html#Name"><span class="hs-identifier hs-type">Name</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Types.Name.html#Name"><span class="hs-identifier hs-type">Name</span></a></span><span>
</span><span id="line-269"></span><span class="hs-comment">-- In rules and instances, we have Names, and we must tidy them too</span><span>
</span><span id="line-270"></span><span class="hs-comment">-- Fortunately, we can lookup in the VarEnv with a name</span><span>
</span><span id="line-271"></span><span id="tidyNameOcc"><span class="annot"><span class="annottext">tidyNameOcc :: TidyEnv -&gt; Name -&gt; Name
</span><a href="GHC.Core.Tidy.html#tidyNameOcc"><span class="hs-identifier hs-var hs-var">tidyNameOcc</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TidyOccEnv
</span><span class="hs-identifier">_</span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682704725"><span class="annot"><span class="annottext">VarEnv Id
</span><a href="#local-6989586621682704725"><span class="hs-identifier hs-var">var_env</span></a></span></span><span class="hs-special">)</span><span> </span><span id="local-6989586621682704726"><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621682704726"><span class="hs-identifier hs-var">n</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">VarEnv Id -&gt; Unique -&gt; Maybe Id
forall {k} (key :: k) elt. UniqFM key elt -&gt; Unique -&gt; Maybe elt
</span><a href="GHC.Types.Unique.FM.html#lookupUFM_Directly"><span class="hs-identifier hs-var">lookupUFM_Directly</span></a></span><span> </span><span class="annot"><span class="annottext">VarEnv Id
</span><a href="#local-6989586621682704725"><span class="hs-identifier hs-var">var_env</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Name -&gt; Unique
forall a. Uniquable a =&gt; a -&gt; Unique
</span><a href="GHC.Types.Unique.html#getUnique"><span class="hs-identifier hs-var">getUnique</span></a></span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621682704726"><span class="hs-identifier hs-var">n</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-272"></span><span>                                </span><span class="annot"><span class="annottext">Maybe Id
</span><span class="hs-identifier hs-var">Nothing</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621682704726"><span class="hs-identifier hs-var">n</span></a></span><span>
</span><span id="line-273"></span><span>                                </span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span id="local-6989586621682704728"><span class="annot"><span class="annottext">Id
</span><a href="#local-6989586621682704728"><span class="hs-identifier hs-var">v</span></a></span></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Id -&gt; Name
</span><a href="GHC.Types.Id.html#idName"><span class="hs-identifier hs-var">idName</span></a></span><span> </span><span class="annot"><span class="annottext">Id
</span><a href="#local-6989586621682704728"><span class="hs-identifier hs-var">v</span></a></span><span>
</span><span id="line-274"></span><span>
</span><span id="line-275"></span><span class="annot"><a href="GHC.Core.Tidy.html#tidyVarOcc"><span class="hs-identifier hs-type">tidyVarOcc</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Types.Var.Env.html#TidyEnv"><span class="hs-identifier hs-type">TidyEnv</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Types.Var.html#Var"><span class="hs-identifier hs-type">Var</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Types.Var.html#Var"><span class="hs-identifier hs-type">Var</span></a></span><span>
</span><span id="line-276"></span><span id="tidyVarOcc"><span class="annot"><span class="annottext">tidyVarOcc :: TidyEnv -&gt; Id -&gt; Id
</span><a href="GHC.Core.Tidy.html#tidyVarOcc"><span class="hs-identifier hs-var hs-var">tidyVarOcc</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TidyOccEnv
</span><span class="hs-identifier">_</span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682704730"><span class="annot"><span class="annottext">VarEnv Id
</span><a href="#local-6989586621682704730"><span class="hs-identifier hs-var">var_env</span></a></span></span><span class="hs-special">)</span><span> </span><span id="local-6989586621682704731"><span class="annot"><span class="annottext">Id
</span><a href="#local-6989586621682704731"><span class="hs-identifier hs-var">v</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">VarEnv Id -&gt; Id -&gt; Maybe Id
forall a. VarEnv a -&gt; Id -&gt; Maybe a
</span><a href="GHC.Types.Var.Env.html#lookupVarEnv"><span class="hs-identifier hs-var">lookupVarEnv</span></a></span><span> </span><span class="annot"><span class="annottext">VarEnv Id
</span><a href="#local-6989586621682704730"><span class="hs-identifier hs-var">var_env</span></a></span><span> </span><span class="annot"><span class="annottext">Id
</span><a href="#local-6989586621682704731"><span class="hs-identifier hs-var">v</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe Id -&gt; Id -&gt; Id
forall a. Maybe a -&gt; a -&gt; a
</span><a href="GHC.Data.Maybe.html#orElse"><span class="hs-operator hs-var">`orElse`</span></a></span><span> </span><span class="annot"><span class="annottext">Id
</span><a href="#local-6989586621682704731"><span class="hs-identifier hs-var">v</span></a></span><span>
</span><span id="line-277"></span><span>
</span><span id="line-278"></span><span class="hs-comment">-- tidyBndr is used for lambda and case binders</span><span>
</span><span id="line-279"></span><span class="annot"><a href="GHC.Core.Tidy.html#tidyBndr"><span class="hs-identifier hs-type">tidyBndr</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Types.Var.Env.html#TidyEnv"><span class="hs-identifier hs-type">TidyEnv</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Types.Var.html#Var"><span class="hs-identifier hs-type">Var</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Types.Var.Env.html#TidyEnv"><span class="hs-identifier hs-type">TidyEnv</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Types.Var.html#Var"><span class="hs-identifier hs-type">Var</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-280"></span><span id="tidyBndr"><span class="annot"><span class="annottext">tidyBndr :: TidyEnv -&gt; Id -&gt; (TidyEnv, Id)
</span><a href="GHC.Core.Tidy.html#tidyBndr"><span class="hs-identifier hs-var hs-var">tidyBndr</span></a></span></span><span> </span><span id="local-6989586621682704734"><span class="annot"><span class="annottext">TidyEnv
</span><a href="#local-6989586621682704734"><span class="hs-identifier hs-var">env</span></a></span></span><span> </span><span id="local-6989586621682704735"><span class="annot"><span class="annottext">Id
</span><a href="#local-6989586621682704735"><span class="hs-identifier hs-var">var</span></a></span></span><span>
</span><span id="line-281"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Id -&gt; Bool
</span><a href="GHC.Types.Var.html#isTyCoVar"><span class="hs-identifier hs-var">isTyCoVar</span></a></span><span> </span><span class="annot"><span class="annottext">Id
</span><a href="#local-6989586621682704735"><span class="hs-identifier hs-var">var</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">TidyEnv -&gt; Id -&gt; (TidyEnv, Id)
</span><a href="GHC.Core.TyCo.Tidy.html#tidyVarBndr"><span class="hs-identifier hs-var">tidyVarBndr</span></a></span><span> </span><span class="annot"><span class="annottext">TidyEnv
</span><a href="#local-6989586621682704734"><span class="hs-identifier hs-var">env</span></a></span><span> </span><span class="annot"><span class="annottext">Id
</span><a href="#local-6989586621682704735"><span class="hs-identifier hs-var">var</span></a></span><span>
</span><span id="line-282"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">otherwise</span></span><span>     </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">TidyEnv -&gt; Id -&gt; (TidyEnv, Id)
</span><a href="GHC.Core.Tidy.html#tidyIdBndr"><span class="hs-identifier hs-var">tidyIdBndr</span></a></span><span> </span><span class="annot"><span class="annottext">TidyEnv
</span><a href="#local-6989586621682704734"><span class="hs-identifier hs-var">env</span></a></span><span> </span><span class="annot"><span class="annottext">Id
</span><a href="#local-6989586621682704735"><span class="hs-identifier hs-var">var</span></a></span><span>
</span><span id="line-283"></span><span>
</span><span id="line-284"></span><span class="annot"><a href="GHC.Core.Tidy.html#tidyBndrs"><span class="hs-identifier hs-type">tidyBndrs</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Types.Var.Env.html#TidyEnv"><span class="hs-identifier hs-type">TidyEnv</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="GHC.Types.Var.html#Var"><span class="hs-identifier hs-type">Var</span></a></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Types.Var.Env.html#TidyEnv"><span class="hs-identifier hs-type">TidyEnv</span></a></span><span class="hs-special">,</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="GHC.Types.Var.html#Var"><span class="hs-identifier hs-type">Var</span></a></span><span class="hs-special">]</span><span class="hs-special">)</span><span>
</span><span id="line-285"></span><span id="tidyBndrs"><span class="annot"><span class="annottext">tidyBndrs :: TidyEnv -&gt; [Id] -&gt; (TidyEnv, [Id])
</span><a href="GHC.Core.Tidy.html#tidyBndrs"><span class="hs-identifier hs-var hs-var">tidyBndrs</span></a></span></span><span> </span><span id="local-6989586621682704739"><span class="annot"><span class="annottext">TidyEnv
</span><a href="#local-6989586621682704739"><span class="hs-identifier hs-var">env</span></a></span></span><span> </span><span id="local-6989586621682704740"><span class="annot"><span class="annottext">[Id]
</span><a href="#local-6989586621682704740"><span class="hs-identifier hs-var">vars</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(TidyEnv -&gt; Id -&gt; (TidyEnv, Id))
-&gt; TidyEnv -&gt; [Id] -&gt; (TidyEnv, [Id])
forall (t :: * -&gt; *) s a b.
Traversable t =&gt;
(s -&gt; a -&gt; (s, b)) -&gt; s -&gt; t a -&gt; (s, t b)
</span><span class="hs-identifier hs-var">mapAccumL</span></span><span> </span><span class="annot"><span class="annottext">TidyEnv -&gt; Id -&gt; (TidyEnv, Id)
</span><a href="GHC.Core.Tidy.html#tidyBndr"><span class="hs-identifier hs-var">tidyBndr</span></a></span><span> </span><span class="annot"><span class="annottext">TidyEnv
</span><a href="#local-6989586621682704739"><span class="hs-identifier hs-var">env</span></a></span><span> </span><span class="annot"><span class="annottext">[Id]
</span><a href="#local-6989586621682704740"><span class="hs-identifier hs-var">vars</span></a></span><span>
</span><span id="line-286"></span><span>
</span><span id="line-287"></span><span class="hs-comment">-- Non-top-level variables, not covars</span><span>
</span><span id="line-288"></span><span class="annot"><a href="GHC.Core.Tidy.html#tidyIdBndr"><span class="hs-identifier hs-type">tidyIdBndr</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Types.Var.Env.html#TidyEnv"><span class="hs-identifier hs-type">TidyEnv</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Types.Var.html#Id"><span class="hs-identifier hs-type">Id</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Types.Var.Env.html#TidyEnv"><span class="hs-identifier hs-type">TidyEnv</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Types.Var.html#Id"><span class="hs-identifier hs-type">Id</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-289"></span><span id="tidyIdBndr"><span class="annot"><span class="annottext">tidyIdBndr :: TidyEnv -&gt; Id -&gt; (TidyEnv, Id)
</span><a href="GHC.Core.Tidy.html#tidyIdBndr"><span class="hs-identifier hs-var hs-var">tidyIdBndr</span></a></span></span><span> </span><span id="local-6989586621682704741"><span class="annot"><span class="annottext">env :: TidyEnv
</span><a href="#local-6989586621682704741"><span class="hs-identifier hs-var">env</span></a></span></span><span class="hs-glyph">@</span><span class="hs-special">(</span><span id="local-6989586621682704742"><span class="annot"><span class="annottext">TidyOccEnv
</span><a href="#local-6989586621682704742"><span class="hs-identifier hs-var">tidy_env</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682704743"><span class="annot"><span class="annottext">VarEnv Id
</span><a href="#local-6989586621682704743"><span class="hs-identifier hs-var">var_env</span></a></span></span><span class="hs-special">)</span><span> </span><span id="local-6989586621682704744"><span class="annot"><span class="annottext">Id
</span><a href="#local-6989586621682704744"><span class="hs-identifier hs-var">id</span></a></span></span><span>
</span><span id="line-290"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-comment">-- Do this pattern match strictly, otherwise we end up holding on to</span><span>
</span><span id="line-291"></span><span>    </span><span class="hs-comment">-- stuff in the OccName.</span><span>
</span><span id="line-292"></span><span>    </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">TidyOccEnv -&gt; OccName -&gt; (TidyOccEnv, OccName)
</span><a href="GHC.Types.Name.Occurrence.html#tidyOccName"><span class="hs-identifier hs-var">tidyOccName</span></a></span><span> </span><span class="annot"><span class="annottext">TidyOccEnv
</span><a href="#local-6989586621682704742"><span class="hs-identifier hs-var">tidy_env</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Id -&gt; OccName
forall a. NamedThing a =&gt; a -&gt; OccName
</span><a href="GHC.Types.Name.html#getOccName"><span class="hs-identifier hs-var">getOccName</span></a></span><span> </span><span class="annot"><span class="annottext">Id
</span><a href="#local-6989586621682704744"><span class="hs-identifier hs-var">id</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-keyword">of</span><span> </span><span class="hs-special">{</span><span> </span><span class="hs-special">(</span><span id="local-6989586621682704747"><span class="annot"><span class="annottext">TidyOccEnv
</span><a href="#local-6989586621682704747"><span class="hs-identifier hs-var">tidy_env'</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682704748"><span class="annot"><span class="annottext">OccName
</span><a href="#local-6989586621682704748"><span class="hs-identifier hs-var">occ'</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-293"></span><span>    </span><span class="hs-keyword">let</span><span>
</span><span id="line-294"></span><span>        </span><span class="hs-comment">-- Give the Id a fresh print-name, *and* rename its type</span><span>
</span><span id="line-295"></span><span>        </span><span class="hs-comment">-- The SrcLoc isn't important now,</span><span>
</span><span id="line-296"></span><span>        </span><span class="hs-comment">-- though we could extract it from the Id</span><span>
</span><span id="line-297"></span><span>        </span><span class="hs-comment">--</span><span>
</span><span id="line-298"></span><span>        </span><span id="local-6989586621682704749"><span class="annot"><span class="annottext">ty' :: Type
</span><a href="#local-6989586621682704749"><span class="hs-identifier hs-var hs-var">ty'</span></a></span></span><span>      </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">TidyEnv -&gt; Type -&gt; Type
</span><a href="GHC.Core.TyCo.Tidy.html#tidyType"><span class="hs-identifier hs-var">tidyType</span></a></span><span> </span><span class="annot"><span class="annottext">TidyEnv
</span><a href="#local-6989586621682704741"><span class="hs-identifier hs-var">env</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Id -&gt; Type
</span><a href="GHC.Types.Id.html#idType"><span class="hs-identifier hs-var">idType</span></a></span><span> </span><span class="annot"><span class="annottext">Id
</span><a href="#local-6989586621682704744"><span class="hs-identifier hs-var">id</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-299"></span><span>        </span><span id="local-6989586621682704750"><span class="annot"><span class="annottext">mult' :: Type
</span><a href="#local-6989586621682704750"><span class="hs-identifier hs-var hs-var">mult'</span></a></span></span><span>    </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">TidyEnv -&gt; Type -&gt; Type
</span><a href="GHC.Core.TyCo.Tidy.html#tidyType"><span class="hs-identifier hs-var">tidyType</span></a></span><span> </span><span class="annot"><span class="annottext">TidyEnv
</span><a href="#local-6989586621682704741"><span class="hs-identifier hs-var">env</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Id -&gt; Type
</span><a href="GHC.Types.Id.html#idMult"><span class="hs-identifier hs-var">idMult</span></a></span><span> </span><span class="annot"><span class="annottext">Id
</span><a href="#local-6989586621682704744"><span class="hs-identifier hs-var">id</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-300"></span><span>        </span><span id="local-6989586621682704752"><span class="annot"><span class="annottext">name' :: Name
</span><a href="#local-6989586621682704752"><span class="hs-identifier hs-var hs-var">name'</span></a></span></span><span>    </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Unique -&gt; OccName -&gt; SrcSpan -&gt; Name
</span><a href="GHC.Types.Name.html#mkInternalName"><span class="hs-identifier hs-var">mkInternalName</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Id -&gt; Unique
</span><a href="GHC.Types.Id.html#idUnique"><span class="hs-identifier hs-var">idUnique</span></a></span><span> </span><span class="annot"><span class="annottext">Id
</span><a href="#local-6989586621682704744"><span class="hs-identifier hs-var">id</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">OccName
</span><a href="#local-6989586621682704748"><span class="hs-identifier hs-var">occ'</span></a></span><span> </span><span class="annot"><span class="annottext">SrcSpan
</span><a href="GHC.Types.SrcLoc.html#noSrcSpan"><span class="hs-identifier hs-var">noSrcSpan</span></a></span><span>
</span><span id="line-301"></span><span>        </span><span id="local-6989586621682704756"><span class="annot"><span class="annottext">id' :: Id
</span><a href="#local-6989586621682704756"><span class="hs-identifier hs-var hs-var">id'</span></a></span></span><span>      </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">HasDebugCallStack =&gt; Name -&gt; Type -&gt; Type -&gt; IdInfo -&gt; Id
Name -&gt; Type -&gt; Type -&gt; IdInfo -&gt; Id
</span><a href="GHC.Types.Id.html#mkLocalIdWithInfo"><span class="hs-identifier hs-var">mkLocalIdWithInfo</span></a></span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621682704752"><span class="hs-identifier hs-var">name'</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682704750"><span class="hs-identifier hs-var">mult'</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682704749"><span class="hs-identifier hs-var">ty'</span></a></span><span> </span><span class="annot"><span class="annottext">IdInfo
</span><a href="#local-6989586621682704758"><span class="hs-identifier hs-var">new_info</span></a></span><span>
</span><span id="line-302"></span><span>        </span><span id="local-6989586621682704759"><span class="annot"><span class="annottext">var_env' :: VarEnv Id
</span><a href="#local-6989586621682704759"><span class="hs-identifier hs-var hs-var">var_env'</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">VarEnv Id -&gt; Id -&gt; Id -&gt; VarEnv Id
forall a. VarEnv a -&gt; Id -&gt; a -&gt; VarEnv a
</span><a href="GHC.Types.Var.Env.html#extendVarEnv"><span class="hs-identifier hs-var">extendVarEnv</span></a></span><span> </span><span class="annot"><span class="annottext">VarEnv Id
</span><a href="#local-6989586621682704743"><span class="hs-identifier hs-var">var_env</span></a></span><span> </span><span class="annot"><span class="annottext">Id
</span><a href="#local-6989586621682704744"><span class="hs-identifier hs-var">id</span></a></span><span> </span><span class="annot"><span class="annottext">Id
</span><a href="#local-6989586621682704756"><span class="hs-identifier hs-var">id'</span></a></span><span>
</span><span id="line-303"></span><span>
</span><span id="line-304"></span><span>        </span><span class="hs-comment">-- Note [Tidy IdInfo]</span><span>
</span><span id="line-305"></span><span>        </span><span id="local-6989586621682704758"><span class="annot"><span class="annottext">new_info :: IdInfo
</span><a href="#local-6989586621682704758"><span class="hs-identifier hs-var hs-var">new_info</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">IdInfo
</span><a href="GHC.Types.Id.Info.html#vanillaIdInfo"><span class="hs-identifier hs-var">vanillaIdInfo</span></a></span><span> </span><span class="annot"><span class="annottext">IdInfo -&gt; OccInfo -&gt; IdInfo
</span><a href="GHC.Types.Id.Info.html#setOccInfo"><span class="hs-operator hs-var">`setOccInfo`</span></a></span><span> </span><span class="annot"><span class="annottext">IdInfo -&gt; OccInfo
</span><a href="GHC.Types.Id.Info.html#occInfo"><span class="hs-identifier hs-var">occInfo</span></a></span><span> </span><span class="annot"><span class="annottext">IdInfo
</span><a href="#local-6989586621682704764"><span class="hs-identifier hs-var">old_info</span></a></span><span>
</span><span id="line-306"></span><span>                                 </span><span class="annot"><span class="annottext">IdInfo -&gt; Unfolding -&gt; IdInfo
</span><a href="GHC.Types.Id.Info.html#setUnfoldingInfo"><span class="hs-operator hs-var">`setUnfoldingInfo`</span></a></span><span> </span><span class="annot"><span class="annottext">Unfolding
</span><a href="#local-6989586621682704766"><span class="hs-identifier hs-var">new_unf</span></a></span><span>
</span><span id="line-307"></span><span>                                  </span><span class="hs-comment">-- see Note [Preserve OneShotInfo]</span><span>
</span><span id="line-308"></span><span>                                 </span><span class="annot"><span class="annottext">IdInfo -&gt; OneShotInfo -&gt; IdInfo
</span><a href="GHC.Types.Id.Info.html#setOneShotInfo"><span class="hs-operator hs-var">`setOneShotInfo`</span></a></span><span> </span><span class="annot"><span class="annottext">IdInfo -&gt; OneShotInfo
</span><a href="GHC.Types.Id.Info.html#oneShotInfo"><span class="hs-identifier hs-var">oneShotInfo</span></a></span><span> </span><span class="annot"><span class="annottext">IdInfo
</span><a href="#local-6989586621682704764"><span class="hs-identifier hs-var">old_info</span></a></span><span>
</span><span id="line-309"></span><span>        </span><span id="local-6989586621682704764"><span class="annot"><span class="annottext">old_info :: IdInfo
</span><a href="#local-6989586621682704764"><span class="hs-identifier hs-var hs-var">old_info</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">HasDebugCallStack =&gt; Id -&gt; IdInfo
Id -&gt; IdInfo
</span><a href="GHC.Types.Var.html#idInfo"><span class="hs-identifier hs-var">idInfo</span></a></span><span> </span><span class="annot"><span class="annottext">Id
</span><a href="#local-6989586621682704744"><span class="hs-identifier hs-var">id</span></a></span><span>
</span><span id="line-310"></span><span>        </span><span id="local-6989586621682704770"><span class="annot"><span class="annottext">old_unf :: Unfolding
</span><a href="#local-6989586621682704770"><span class="hs-identifier hs-var hs-var">old_unf</span></a></span></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">IdInfo -&gt; Unfolding
</span><a href="GHC.Types.Id.Info.html#realUnfoldingInfo"><span class="hs-identifier hs-var">realUnfoldingInfo</span></a></span><span> </span><span class="annot"><span class="annottext">IdInfo
</span><a href="#local-6989586621682704764"><span class="hs-identifier hs-var">old_info</span></a></span><span>
</span><span id="line-311"></span><span>        </span><span id="local-6989586621682704766"><span class="annot"><span class="annottext">new_unf :: Unfolding
</span><a href="#local-6989586621682704766"><span class="hs-identifier hs-var hs-var">new_unf</span></a></span></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Unfolding -&gt; Unfolding
</span><a href="GHC.Types.Id.Info.html#trimUnfolding"><span class="hs-identifier hs-var">trimUnfolding</span></a></span><span> </span><span class="annot"><span class="annottext">Unfolding
</span><a href="#local-6989586621682704770"><span class="hs-identifier hs-var">old_unf</span></a></span><span>  </span><span class="hs-comment">-- See Note [Preserve evaluatedness]</span><span>
</span><span id="line-312"></span><span>    </span><span class="hs-keyword">in</span><span>
</span><span id="line-313"></span><span>    </span><span class="hs-special">(</span><span class="hs-special">(</span><span class="annot"><span class="annottext">TidyOccEnv
</span><a href="#local-6989586621682704747"><span class="hs-identifier hs-var">tidy_env'</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">VarEnv Id
</span><a href="#local-6989586621682704759"><span class="hs-identifier hs-var">var_env'</span></a></span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Id
</span><a href="#local-6989586621682704756"><span class="hs-identifier hs-var">id'</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-314"></span><span>   </span><span class="hs-special">}</span><span>
</span><span id="line-315"></span><span>
</span><span id="line-316"></span><span class="annot"><a href="GHC.Core.Tidy.html#tidyLetBndr"><span class="hs-identifier hs-type">tidyLetBndr</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Types.Var.Env.html#TidyEnv"><span class="hs-identifier hs-type">TidyEnv</span></a></span><span>         </span><span class="hs-comment">-- Knot-tied version for unfoldings</span><span>
</span><span id="line-317"></span><span>            </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Types.Var.Env.html#TidyEnv"><span class="hs-identifier hs-type">TidyEnv</span></a></span><span>         </span><span class="hs-comment">-- The one to extend</span><span>
</span><span id="line-318"></span><span>            </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Types.Var.html#Id"><span class="hs-identifier hs-type">Id</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Types.Var.Env.html#TidyEnv"><span class="hs-identifier hs-type">TidyEnv</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Types.Var.html#Id"><span class="hs-identifier hs-type">Id</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-319"></span><span class="hs-comment">-- Used for local (non-top-level) let(rec)s</span><span>
</span><span id="line-320"></span><span class="hs-comment">-- Just like tidyIdBndr above, but with more IdInfo</span><span>
</span><span id="line-321"></span><span id="tidyLetBndr"><span class="annot"><span class="annottext">tidyLetBndr :: TidyEnv -&gt; TidyEnv -&gt; Id -&gt; (TidyEnv, Id)
</span><a href="GHC.Core.Tidy.html#tidyLetBndr"><span class="hs-identifier hs-var hs-var">tidyLetBndr</span></a></span></span><span> </span><span id="local-6989586621682704773"><span class="annot"><span class="annottext">TidyEnv
</span><a href="#local-6989586621682704773"><span class="hs-identifier hs-var">rec_tidy_env</span></a></span></span><span> </span><span id="local-6989586621682704774"><span class="annot"><span class="annottext">env :: TidyEnv
</span><a href="#local-6989586621682704774"><span class="hs-identifier hs-var">env</span></a></span></span><span class="hs-glyph">@</span><span class="hs-special">(</span><span id="local-6989586621682704775"><span class="annot"><span class="annottext">TidyOccEnv
</span><a href="#local-6989586621682704775"><span class="hs-identifier hs-var">tidy_env</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682704776"><span class="annot"><span class="annottext">VarEnv Id
</span><a href="#local-6989586621682704776"><span class="hs-identifier hs-var">var_env</span></a></span></span><span class="hs-special">)</span><span> </span><span id="local-6989586621682704777"><span class="annot"><span class="annottext">Id
</span><a href="#local-6989586621682704777"><span class="hs-identifier hs-var">id</span></a></span></span><span>
</span><span id="line-322"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">TidyOccEnv -&gt; OccName -&gt; (TidyOccEnv, OccName)
</span><a href="GHC.Types.Name.Occurrence.html#tidyOccName"><span class="hs-identifier hs-var">tidyOccName</span></a></span><span> </span><span class="annot"><span class="annottext">TidyOccEnv
</span><a href="#local-6989586621682704775"><span class="hs-identifier hs-var">tidy_env</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Id -&gt; OccName
forall a. NamedThing a =&gt; a -&gt; OccName
</span><a href="GHC.Types.Name.html#getOccName"><span class="hs-identifier hs-var">getOccName</span></a></span><span> </span><span class="annot"><span class="annottext">Id
</span><a href="#local-6989586621682704777"><span class="hs-identifier hs-var">id</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-keyword">of</span><span> </span><span class="hs-special">{</span><span> </span><span class="hs-special">(</span><span id="local-6989586621682704778"><span class="annot"><span class="annottext">TidyOccEnv
</span><a href="#local-6989586621682704778"><span class="hs-identifier hs-var">tidy_env'</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682704779"><span class="annot"><span class="annottext">OccName
</span><a href="#local-6989586621682704779"><span class="hs-identifier hs-var">occ'</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-323"></span><span>    </span><span class="hs-keyword">let</span><span>
</span><span id="line-324"></span><span>        </span><span id="local-6989586621682704780"><span class="annot"><span class="annottext">ty' :: Type
</span><a href="#local-6989586621682704780"><span class="hs-identifier hs-var hs-var">ty'</span></a></span></span><span>      </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">TidyEnv -&gt; Type -&gt; Type
</span><a href="GHC.Core.TyCo.Tidy.html#tidyType"><span class="hs-identifier hs-var">tidyType</span></a></span><span> </span><span class="annot"><span class="annottext">TidyEnv
</span><a href="#local-6989586621682704774"><span class="hs-identifier hs-var">env</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Id -&gt; Type
</span><a href="GHC.Types.Id.html#idType"><span class="hs-identifier hs-var">idType</span></a></span><span> </span><span class="annot"><span class="annottext">Id
</span><a href="#local-6989586621682704777"><span class="hs-identifier hs-var">id</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-325"></span><span>        </span><span id="local-6989586621682704781"><span class="annot"><span class="annottext">mult' :: Type
</span><a href="#local-6989586621682704781"><span class="hs-identifier hs-var hs-var">mult'</span></a></span></span><span>    </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">TidyEnv -&gt; Type -&gt; Type
</span><a href="GHC.Core.TyCo.Tidy.html#tidyType"><span class="hs-identifier hs-var">tidyType</span></a></span><span> </span><span class="annot"><span class="annottext">TidyEnv
</span><a href="#local-6989586621682704774"><span class="hs-identifier hs-var">env</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Id -&gt; Type
</span><a href="GHC.Types.Id.html#idMult"><span class="hs-identifier hs-var">idMult</span></a></span><span> </span><span class="annot"><span class="annottext">Id
</span><a href="#local-6989586621682704777"><span class="hs-identifier hs-var">id</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-326"></span><span>        </span><span id="local-6989586621682704782"><span class="annot"><span class="annottext">name' :: Name
</span><a href="#local-6989586621682704782"><span class="hs-identifier hs-var hs-var">name'</span></a></span></span><span>    </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Unique -&gt; OccName -&gt; SrcSpan -&gt; Name
</span><a href="GHC.Types.Name.html#mkInternalName"><span class="hs-identifier hs-var">mkInternalName</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Id -&gt; Unique
</span><a href="GHC.Types.Id.html#idUnique"><span class="hs-identifier hs-var">idUnique</span></a></span><span> </span><span class="annot"><span class="annottext">Id
</span><a href="#local-6989586621682704777"><span class="hs-identifier hs-var">id</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">OccName
</span><a href="#local-6989586621682704779"><span class="hs-identifier hs-var">occ'</span></a></span><span> </span><span class="annot"><span class="annottext">SrcSpan
</span><a href="GHC.Types.SrcLoc.html#noSrcSpan"><span class="hs-identifier hs-var">noSrcSpan</span></a></span><span>
</span><span id="line-327"></span><span>        </span><span id="local-6989586621682704783"><span class="annot"><span class="annottext">details :: IdDetails
</span><a href="#local-6989586621682704783"><span class="hs-identifier hs-var hs-var">details</span></a></span></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Id -&gt; IdDetails
</span><a href="GHC.Types.Var.html#idDetails"><span class="hs-identifier hs-var">idDetails</span></a></span><span> </span><span class="annot"><span class="annottext">Id
</span><a href="#local-6989586621682704777"><span class="hs-identifier hs-var">id</span></a></span><span>
</span><span id="line-328"></span><span>        </span><span id="local-6989586621682704785"><span class="annot"><span class="annottext">id' :: Id
</span><a href="#local-6989586621682704785"><span class="hs-identifier hs-var hs-var">id'</span></a></span></span><span>      </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">IdDetails -&gt; Name -&gt; Type -&gt; Type -&gt; IdInfo -&gt; Id
</span><a href="GHC.Types.Var.html#mkLocalVar"><span class="hs-identifier hs-var">mkLocalVar</span></a></span><span> </span><span class="annot"><span class="annottext">IdDetails
</span><a href="#local-6989586621682704783"><span class="hs-identifier hs-var">details</span></a></span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621682704782"><span class="hs-identifier hs-var">name'</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682704781"><span class="hs-identifier hs-var">mult'</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682704780"><span class="hs-identifier hs-var">ty'</span></a></span><span> </span><span class="annot"><span class="annottext">IdInfo
</span><a href="#local-6989586621682704787"><span class="hs-identifier hs-var">new_info</span></a></span><span>
</span><span id="line-329"></span><span>        </span><span id="local-6989586621682704788"><span class="annot"><span class="annottext">var_env' :: VarEnv Id
</span><a href="#local-6989586621682704788"><span class="hs-identifier hs-var hs-var">var_env'</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">VarEnv Id -&gt; Id -&gt; Id -&gt; VarEnv Id
forall a. VarEnv a -&gt; Id -&gt; a -&gt; VarEnv a
</span><a href="GHC.Types.Var.Env.html#extendVarEnv"><span class="hs-identifier hs-var">extendVarEnv</span></a></span><span> </span><span class="annot"><span class="annottext">VarEnv Id
</span><a href="#local-6989586621682704776"><span class="hs-identifier hs-var">var_env</span></a></span><span> </span><span class="annot"><span class="annottext">Id
</span><a href="#local-6989586621682704777"><span class="hs-identifier hs-var">id</span></a></span><span> </span><span class="annot"><span class="annottext">Id
</span><a href="#local-6989586621682704785"><span class="hs-identifier hs-var">id'</span></a></span><span>
</span><span id="line-330"></span><span>
</span><span id="line-331"></span><span>        </span><span class="hs-comment">-- Note [Tidy IdInfo]</span><span>
</span><span id="line-332"></span><span>        </span><span class="hs-comment">-- We need to keep around any interesting strictness and</span><span>
</span><span id="line-333"></span><span>        </span><span class="hs-comment">-- demand info because later on we may need to use it when</span><span>
</span><span id="line-334"></span><span>        </span><span class="hs-comment">-- converting to A-normal form.</span><span>
</span><span id="line-335"></span><span>        </span><span class="hs-comment">-- eg.</span><span>
</span><span id="line-336"></span><span>        </span><span class="hs-comment">--      f (g x),  where f is strict in its argument, will be converted</span><span>
</span><span id="line-337"></span><span>        </span><span class="hs-comment">--      into  case (g x) of z -&gt; f z  by CorePrep, but only if f still</span><span>
</span><span id="line-338"></span><span>        </span><span class="hs-comment">--      has its strictness info.</span><span>
</span><span id="line-339"></span><span>        </span><span class="hs-comment">--</span><span>
</span><span id="line-340"></span><span>        </span><span class="hs-comment">-- Similarly for the demand info - on a let binder, this tells</span><span>
</span><span id="line-341"></span><span>        </span><span class="hs-comment">-- CorePrep to turn the let into a case.</span><span>
</span><span id="line-342"></span><span>        </span><span class="hs-comment">-- But: Remove the usage demand here</span><span>
</span><span id="line-343"></span><span>        </span><span class="hs-comment">--      (See Note [Zapping DmdEnv after Demand Analyzer] in GHC.Core.Opt.WorkWrap)</span><span>
</span><span id="line-344"></span><span>        </span><span class="hs-comment">--</span><span>
</span><span id="line-345"></span><span>        </span><span class="hs-comment">-- Similarly arity info for eta expansion in CorePrep</span><span>
</span><span id="line-346"></span><span>        </span><span class="hs-comment">-- Don't attempt to recompute arity here; this is just tidying!</span><span>
</span><span id="line-347"></span><span>        </span><span class="hs-comment">-- Trying to do so led to #17294</span><span>
</span><span id="line-348"></span><span>        </span><span class="hs-comment">--</span><span>
</span><span id="line-349"></span><span>        </span><span class="hs-comment">-- Set inline-prag info so that we preserve it across</span><span>
</span><span id="line-350"></span><span>        </span><span class="hs-comment">-- separate compilation boundaries</span><span>
</span><span id="line-351"></span><span>        </span><span id="local-6989586621682704789"><span class="annot"><span class="annottext">old_info :: IdInfo
</span><a href="#local-6989586621682704789"><span class="hs-identifier hs-var hs-var">old_info</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">HasDebugCallStack =&gt; Id -&gt; IdInfo
Id -&gt; IdInfo
</span><a href="GHC.Types.Var.html#idInfo"><span class="hs-identifier hs-var">idInfo</span></a></span><span> </span><span class="annot"><span class="annottext">Id
</span><a href="#local-6989586621682704777"><span class="hs-identifier hs-var">id</span></a></span><span>
</span><span id="line-352"></span><span>        </span><span id="local-6989586621682704787"><span class="annot"><span class="annottext">new_info :: IdInfo
</span><a href="#local-6989586621682704787"><span class="hs-identifier hs-var hs-var">new_info</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">IdInfo
</span><a href="GHC.Types.Id.Info.html#vanillaIdInfo"><span class="hs-identifier hs-var">vanillaIdInfo</span></a></span><span>
</span><span id="line-353"></span><span>                    </span><span class="annot"><span class="annottext">IdInfo -&gt; OccInfo -&gt; IdInfo
</span><a href="GHC.Types.Id.Info.html#setOccInfo"><span class="hs-operator hs-var">`setOccInfo`</span></a></span><span>        </span><span class="annot"><span class="annottext">IdInfo -&gt; OccInfo
</span><a href="GHC.Types.Id.Info.html#occInfo"><span class="hs-identifier hs-var">occInfo</span></a></span><span> </span><span class="annot"><span class="annottext">IdInfo
</span><a href="#local-6989586621682704789"><span class="hs-identifier hs-var">old_info</span></a></span><span>
</span><span id="line-354"></span><span>                    </span><span class="annot"><span class="annottext">IdInfo -&gt; Int -&gt; IdInfo
</span><a href="GHC.Types.Id.Info.html#setArityInfo"><span class="hs-operator hs-var">`setArityInfo`</span></a></span><span>      </span><span class="annot"><span class="annottext">IdInfo -&gt; Int
</span><a href="GHC.Types.Id.Info.html#arityInfo"><span class="hs-identifier hs-var">arityInfo</span></a></span><span> </span><span class="annot"><span class="annottext">IdInfo
</span><a href="#local-6989586621682704789"><span class="hs-identifier hs-var">old_info</span></a></span><span>
</span><span id="line-355"></span><span>                    </span><span class="annot"><span class="annottext">IdInfo -&gt; DmdSig -&gt; IdInfo
</span><a href="GHC.Types.Id.Info.html#setDmdSigInfo"><span class="hs-operator hs-var">`setDmdSigInfo`</span></a></span><span>     </span><span class="annot"><span class="annottext">DmdSig -&gt; DmdSig
</span><a href="GHC.Types.Demand.html#zapDmdEnvSig"><span class="hs-identifier hs-var">zapDmdEnvSig</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">IdInfo -&gt; DmdSig
</span><a href="GHC.Types.Id.Info.html#dmdSigInfo"><span class="hs-identifier hs-var">dmdSigInfo</span></a></span><span> </span><span class="annot"><span class="annottext">IdInfo
</span><a href="#local-6989586621682704789"><span class="hs-identifier hs-var">old_info</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-356"></span><span>                    </span><span class="annot"><span class="annottext">IdInfo -&gt; Demand -&gt; IdInfo
</span><a href="GHC.Types.Id.Info.html#setDemandInfo"><span class="hs-operator hs-var">`setDemandInfo`</span></a></span><span>     </span><span class="annot"><span class="annottext">IdInfo -&gt; Demand
</span><a href="GHC.Types.Id.Info.html#demandInfo"><span class="hs-identifier hs-var">demandInfo</span></a></span><span> </span><span class="annot"><span class="annottext">IdInfo
</span><a href="#local-6989586621682704789"><span class="hs-identifier hs-var">old_info</span></a></span><span>
</span><span id="line-357"></span><span>                    </span><span class="annot"><span class="annottext">IdInfo -&gt; InlinePragma -&gt; IdInfo
</span><a href="GHC.Types.Id.Info.html#setInlinePragInfo"><span class="hs-operator hs-var">`setInlinePragInfo`</span></a></span><span> </span><span class="annot"><span class="annottext">IdInfo -&gt; InlinePragma
</span><a href="GHC.Types.Id.Info.html#inlinePragInfo"><span class="hs-identifier hs-var">inlinePragInfo</span></a></span><span> </span><span class="annot"><span class="annottext">IdInfo
</span><a href="#local-6989586621682704789"><span class="hs-identifier hs-var">old_info</span></a></span><span>
</span><span id="line-358"></span><span>                    </span><span class="annot"><span class="annottext">IdInfo -&gt; Unfolding -&gt; IdInfo
</span><a href="GHC.Types.Id.Info.html#setUnfoldingInfo"><span class="hs-operator hs-var">`setUnfoldingInfo`</span></a></span><span>  </span><span class="annot"><span class="annottext">Unfolding
</span><a href="#local-6989586621682704798"><span class="hs-identifier hs-var">new_unf</span></a></span><span>
</span><span id="line-359"></span><span>
</span><span id="line-360"></span><span>        </span><span id="local-6989586621682704799"><span class="annot"><span class="annottext">old_unf :: Unfolding
</span><a href="#local-6989586621682704799"><span class="hs-identifier hs-var hs-var">old_unf</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">IdInfo -&gt; Unfolding
</span><a href="GHC.Types.Id.Info.html#realUnfoldingInfo"><span class="hs-identifier hs-var">realUnfoldingInfo</span></a></span><span> </span><span class="annot"><span class="annottext">IdInfo
</span><a href="#local-6989586621682704789"><span class="hs-identifier hs-var">old_info</span></a></span><span>
</span><span id="line-361"></span><span>        </span><span id="local-6989586621682704798"><span class="annot"><span class="annottext">new_unf :: Unfolding
</span><a href="#local-6989586621682704798"><span class="hs-identifier hs-var hs-var">new_unf</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">TidyEnv -&gt; Unfolding -&gt; Unfolding
</span><a href="GHC.Core.Tidy.html#tidyNestedUnfolding"><span class="hs-identifier hs-var">tidyNestedUnfolding</span></a></span><span> </span><span class="annot"><span class="annottext">TidyEnv
</span><a href="#local-6989586621682704773"><span class="hs-identifier hs-var">rec_tidy_env</span></a></span><span> </span><span class="annot"><span class="annottext">Unfolding
</span><a href="#local-6989586621682704799"><span class="hs-identifier hs-var">old_unf</span></a></span><span>
</span><span id="line-362"></span><span>
</span><span id="line-363"></span><span>    </span><span class="hs-keyword">in</span><span>
</span><span id="line-364"></span><span>    </span><span class="hs-special">(</span><span class="hs-special">(</span><span class="annot"><span class="annottext">TidyOccEnv
</span><a href="#local-6989586621682704778"><span class="hs-identifier hs-var">tidy_env'</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">VarEnv Id
</span><a href="#local-6989586621682704788"><span class="hs-identifier hs-var">var_env'</span></a></span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Id
</span><a href="#local-6989586621682704785"><span class="hs-identifier hs-var">id'</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-365"></span><span>
</span><span id="line-366"></span><span class="hs-comment">------------ Unfolding  --------------</span><span>
</span><span id="line-367"></span><span class="annot"><a href="GHC.Core.Tidy.html#tidyNestedUnfolding"><span class="hs-identifier hs-type">tidyNestedUnfolding</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Types.Var.Env.html#TidyEnv"><span class="hs-identifier hs-type">TidyEnv</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Core.html#Unfolding"><span class="hs-identifier hs-type">Unfolding</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Core.html#Unfolding"><span class="hs-identifier hs-type">Unfolding</span></a></span><span>
</span><span id="line-368"></span><span id="tidyNestedUnfolding"><span class="annot"><span class="annottext">tidyNestedUnfolding :: TidyEnv -&gt; Unfolding -&gt; Unfolding
</span><a href="GHC.Core.Tidy.html#tidyNestedUnfolding"><span class="hs-identifier hs-var hs-var">tidyNestedUnfolding</span></a></span></span><span> </span><span class="annot"><span class="annottext">TidyEnv
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">Unfolding
</span><a href="GHC.Core.html#NoUnfolding"><span class="hs-identifier hs-var">NoUnfolding</span></a></span><span>   </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Unfolding
</span><a href="GHC.Core.html#NoUnfolding"><span class="hs-identifier hs-var">NoUnfolding</span></a></span><span>
</span><span id="line-369"></span><span class="annot"><a href="GHC.Core.Tidy.html#tidyNestedUnfolding"><span class="hs-identifier hs-var">tidyNestedUnfolding</span></a></span><span> </span><span class="annot"><span class="annottext">TidyEnv
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">Unfolding
</span><a href="GHC.Core.html#BootUnfolding"><span class="hs-identifier hs-var">BootUnfolding</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Unfolding
</span><a href="GHC.Core.html#BootUnfolding"><span class="hs-identifier hs-var">BootUnfolding</span></a></span><span>
</span><span id="line-370"></span><span class="annot"><a href="GHC.Core.Tidy.html#tidyNestedUnfolding"><span class="hs-identifier hs-var">tidyNestedUnfolding</span></a></span><span> </span><span class="annot"><span class="annottext">TidyEnv
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Core.html#OtherCon"><span class="hs-identifier hs-type">OtherCon</span></a></span><span> </span><span class="hs-special">{</span><span class="hs-special">}</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Unfolding
</span><a href="GHC.Core.html#evaldUnfolding"><span class="hs-identifier hs-var">evaldUnfolding</span></a></span><span>
</span><span id="line-371"></span><span>
</span><span id="line-372"></span><span class="annot"><a href="GHC.Core.Tidy.html#tidyNestedUnfolding"><span class="hs-identifier hs-var">tidyNestedUnfolding</span></a></span><span> </span><span id="local-6989586621682704805"><span class="annot"><span class="annottext">TidyEnv
</span><a href="#local-6989586621682704805"><span class="hs-identifier hs-var">tidy_env</span></a></span></span><span> </span><span id="local-6989586621682704806"><span class="annot"><span class="annottext">df :: Unfolding
</span><a href="#local-6989586621682704806"><span class="hs-identifier hs-var">df</span></a></span></span><span class="hs-glyph">@</span><span class="hs-special">(</span><span class="annot"><a href="GHC.Core.html#DFunUnfolding"><span class="hs-identifier hs-type">DFunUnfolding</span></a></span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">df_bndrs :: Unfolding -&gt; [Id]
</span><a href="GHC.Core.html#df_bndrs"><span class="hs-identifier hs-var">df_bndrs</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="local-6989586621682704809"><span class="annot"><span class="annottext">[Id]
</span><a href="#local-6989586621682704809"><span class="hs-identifier hs-var">bndrs</span></a></span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">df_args :: Unfolding -&gt; [Expr Id]
</span><a href="GHC.Core.html#df_args"><span class="hs-identifier hs-var">df_args</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="local-6989586621682704811"><span class="annot"><span class="annottext">[Expr Id]
</span><a href="#local-6989586621682704811"><span class="hs-identifier hs-var">args</span></a></span></span><span> </span><span class="hs-special">}</span><span class="hs-special">)</span><span>
</span><span id="line-373"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Unfolding
</span><a href="#local-6989586621682704806"><span class="hs-identifier hs-var">df</span></a></span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><a href="GHC.Core.html#df_bndrs"><span class="hs-identifier hs-var">df_bndrs</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="#local-6989586621682704812"><span class="hs-identifier hs-type">bndrs'</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Core.html#df_args"><span class="hs-identifier hs-var">df_args</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="hs-identifier hs-type">map</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Core.Tidy.html#tidyExpr"><span class="hs-identifier hs-type">tidyExpr</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682704813"><span class="hs-identifier hs-type">tidy_env'</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><a href="#local-6989586621682704811"><span class="hs-identifier hs-type">args</span></a></span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-374"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-375"></span><span>    </span><span class="hs-special">(</span><span id="local-6989586621682704813"><span class="annot"><span class="annottext">TidyEnv
</span><a href="#local-6989586621682704813"><span class="hs-identifier hs-var">tidy_env'</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682704812"><span class="annot"><span class="annottext">[Id]
</span><a href="#local-6989586621682704812"><span class="hs-identifier hs-var">bndrs'</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">TidyEnv -&gt; [Id] -&gt; (TidyEnv, [Id])
</span><a href="GHC.Core.Tidy.html#tidyBndrs"><span class="hs-identifier hs-var">tidyBndrs</span></a></span><span> </span><span class="annot"><span class="annottext">TidyEnv
</span><a href="#local-6989586621682704805"><span class="hs-identifier hs-var">tidy_env</span></a></span><span> </span><span class="annot"><span class="annottext">[Id]
</span><a href="#local-6989586621682704809"><span class="hs-identifier hs-var">bndrs</span></a></span><span>
</span><span id="line-376"></span><span>
</span><span id="line-377"></span><span class="annot"><a href="GHC.Core.Tidy.html#tidyNestedUnfolding"><span class="hs-identifier hs-var">tidyNestedUnfolding</span></a></span><span> </span><span id="local-6989586621682704814"><span class="annot"><span class="annottext">TidyEnv
</span><a href="#local-6989586621682704814"><span class="hs-identifier hs-var">tidy_env</span></a></span></span><span>
</span><span id="line-378"></span><span>    </span><span id="local-6989586621682704815"><span class="annot"><span class="annottext">unf :: Unfolding
</span><a href="#local-6989586621682704815"><span class="hs-identifier hs-var">unf</span></a></span></span><span class="hs-glyph">@</span><span class="hs-special">(</span><span class="annot"><a href="GHC.Core.html#CoreUnfolding"><span class="hs-identifier hs-type">CoreUnfolding</span></a></span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">uf_tmpl :: Unfolding -&gt; Expr Id
</span><a href="GHC.Core.html#uf_tmpl"><span class="hs-identifier hs-var">uf_tmpl</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="local-6989586621682704818"><span class="annot"><span class="annottext">Expr Id
</span><a href="#local-6989586621682704818"><span class="hs-identifier hs-var">unf_rhs</span></a></span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">uf_src :: Unfolding -&gt; UnfoldingSource
</span><a href="GHC.Core.html#uf_src"><span class="hs-identifier hs-var">uf_src</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="local-6989586621682704820"><span class="annot"><span class="annottext">UnfoldingSource
</span><a href="#local-6989586621682704820"><span class="hs-identifier hs-var">src</span></a></span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">uf_cache :: Unfolding -&gt; UnfoldingCache
</span><a href="GHC.Core.html#uf_cache"><span class="hs-identifier hs-var">uf_cache</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="local-6989586621682704822"><span class="annot"><span class="annottext">UnfoldingCache
</span><a href="#local-6989586621682704822"><span class="hs-identifier hs-var">cache</span></a></span></span><span> </span><span class="hs-special">}</span><span class="hs-special">)</span><span>
</span><span id="line-379"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">UnfoldingSource -&gt; Bool
</span><a href="GHC.Types.Basic.html#isStableSource"><span class="hs-identifier hs-var">isStableSource</span></a></span><span> </span><span class="annot"><span class="annottext">UnfoldingSource
</span><a href="#local-6989586621682704820"><span class="hs-identifier hs-var">src</span></a></span><span>
</span><span id="line-380"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Unfolding -&gt; Unfolding
</span><a href="#local-6989586621682704824"><span class="hs-identifier hs-var">seqIt</span></a></span><span> </span><span class="annot"><span class="annottext">(Unfolding -&gt; Unfolding) -&gt; Unfolding -&gt; Unfolding
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Unfolding
</span><a href="#local-6989586621682704815"><span class="hs-identifier hs-var">unf</span></a></span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><a href="GHC.Core.html#uf_tmpl"><span class="hs-identifier hs-var">uf_tmpl</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="GHC.Core.Tidy.html#tidyExpr"><span class="hs-identifier hs-type">tidyExpr</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682704814"><span class="hs-identifier hs-type">tidy_env</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682704818"><span class="hs-identifier hs-type">unf_rhs</span></a></span><span> </span><span class="hs-special">}</span><span>    </span><span class="hs-comment">-- Preserves OccInfo</span><span>
</span><span id="line-381"></span><span>            </span><span class="hs-comment">-- This seqIt avoids a space leak: otherwise the uf_cache</span><span>
</span><span id="line-382"></span><span>            </span><span class="hs-comment">-- field may retain a reference to the pre-tidied</span><span>
</span><span id="line-383"></span><span>            </span><span class="hs-comment">-- expression forever (GHC.CoreToIface doesn't look at</span><span>
</span><span id="line-384"></span><span>            </span><span class="hs-comment">-- them)</span><span>
</span><span id="line-385"></span><span>
</span><span id="line-386"></span><span>  </span><span class="hs-comment">-- Discard unstable unfoldings, but see Note [Preserve evaluatedness]</span><span>
</span><span id="line-387"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">UnfoldingCache -&gt; Bool
</span><a href="GHC.Core.html#uf_is_value"><span class="hs-identifier hs-var">uf_is_value</span></a></span><span> </span><span class="annot"><span class="annottext">UnfoldingCache
</span><a href="#local-6989586621682704822"><span class="hs-identifier hs-var">cache</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Unfolding
</span><a href="GHC.Core.html#evaldUnfolding"><span class="hs-identifier hs-var">evaldUnfolding</span></a></span><span>
</span><span id="line-388"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">otherwise</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Unfolding
</span><a href="GHC.Core.html#noUnfolding"><span class="hs-identifier hs-var">noUnfolding</span></a></span><span>
</span><span id="line-389"></span><span>
</span><span id="line-390"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-391"></span><span>    </span><span id="local-6989586621682704824"><span class="annot"><span class="annottext">seqIt :: Unfolding -&gt; Unfolding
</span><a href="#local-6989586621682704824"><span class="hs-identifier hs-var hs-var">seqIt</span></a></span></span><span> </span><span id="local-6989586621682704827"><span class="annot"><span class="annottext">Unfolding
</span><a href="#local-6989586621682704827"><span class="hs-identifier hs-var">unf</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Unfolding -&gt; ()
</span><a href="GHC.Core.Seq.html#seqUnfolding"><span class="hs-identifier hs-var">seqUnfolding</span></a></span><span> </span><span class="annot"><span class="annottext">Unfolding
</span><a href="#local-6989586621682704827"><span class="hs-identifier hs-var">unf</span></a></span><span> </span><span class="annot"><span class="annottext">() -&gt; Unfolding -&gt; Unfolding
forall a b. a -&gt; b -&gt; b
</span><span class="hs-operator hs-var">`seq`</span></span><span> </span><span class="annot"><span class="annottext">Unfolding
</span><a href="#local-6989586621682704827"><span class="hs-identifier hs-var">unf</span></a></span><span>
</span><span id="line-392"></span><span>
</span><span id="line-393"></span><span class="hs-comment">{-
Note [Tidy IdInfo]
~~~~~~~~~~~~~~~~~~
All nested Ids now have the same IdInfo, namely vanillaIdInfo, which
should save some space; except that we preserve occurrence info for
two reasons:

  (a) To make printing tidy core nicer

  (b) Because we tidy RULES and unfoldings, which may then propagate
      via --make into the compilation of the next module, and we want
      the benefit of that occurrence analysis when we use the rule or
      or inline the function.  In particular, it's vital not to lose
      loop-breaker info, else we get an infinite inlining loop

Note that tidyLetBndr puts more IdInfo back.

Note [Preserve evaluatedness]
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
Consider
  data T = MkT !Bool
  ....(case v of MkT y -&gt;
       let z# = case y of
                  True -&gt; 1#
                  False -&gt; 2#
       in ...)

The z# binding is ok because the RHS is ok-for-speculation,
but Lint will complain unless it can *see* that.  So we
preserve the evaluated-ness on 'y' in tidyBndr.

(Another alternative would be to tidy unboxed lets into cases,
but that seems more indirect and surprising.)

Note [Preserve OneShotInfo]
~~~~~~~~~~~~~~~~~~~~~~~~~~~
We keep the OneShotInfo because we want it to propagate into the interface.
Not all OneShotInfo is determined by a compiler analysis; some is added by a
call of GHC.Exts.oneShot, which is then discarded before the end of the
optimisation pipeline, leaving only the OneShotInfo on the lambda. Hence we
must preserve this info in inlinings. See Note [oneShot magic] in GHC.Types.Id.Make.

This applies to lambda binders only, hence it is stored in IfaceLamBndr.
-}</span><span>
</span><span id="line-437"></span><span>
</span><span id="line-438"></span><span id="local-6989586621682704408"><span id="local-6989586621682704409"><span class="annot"><a href="GHC.Core.Tidy.html#%3D%3A"><span class="hs-operator hs-type">(=:)</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="#local-6989586621682704408"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621682704408"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621682704409"><span class="hs-identifier hs-type">b</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621682704409"><span class="hs-identifier hs-type">b</span></a></span></span></span><span>
</span><span id="line-439"></span><span id="local-6989586621682704828"><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621682704828"><span class="hs-identifier hs-var">m</span></a></span></span><span> </span><span id="%3D%3A"><span class="annot"><span class="annottext">=: :: forall a b. a -&gt; (a -&gt; b) -&gt; b
</span><a href="GHC.Core.Tidy.html#%3D%3A"><span class="hs-operator hs-var hs-var">=:</span></a></span></span><span> </span><span id="local-6989586621682704829"><span class="annot"><span class="annottext">a -&gt; b
</span><a href="#local-6989586621682704829"><span class="hs-identifier hs-var">k</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621682704828"><span class="hs-identifier hs-var">m</span></a></span><span> </span><span class="annot"><span class="annottext">a -&gt; b -&gt; b
forall a b. a -&gt; b -&gt; b
</span><span class="hs-operator hs-var">`seq`</span></span><span> </span><span class="annot"><span class="annottext">a -&gt; b
</span><a href="#local-6989586621682704829"><span class="hs-identifier hs-var">k</span></a></span><span> </span><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621682704828"><span class="hs-identifier hs-var">m</span></a></span><span>
</span><span id="line-440"></span></pre></body></html>