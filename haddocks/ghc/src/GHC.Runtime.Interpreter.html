<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><link rel="stylesheet" type="text/css" href="style.css" /><script type="text/javascript" src="highlight.js"></script></head><body><pre><span class="hs-pragma">{-# LANGUAGE CPP #-}</span><span>
</span><span id="line-2"></span><span class="hs-pragma">{-# LANGUAGE LambdaCase #-}</span><span>
</span><span id="line-3"></span><span>
</span><span id="line-4"></span><span class="hs-comment">-- | Interacting with the iserv interpreter, whether it is running on an</span><span>
</span><span id="line-5"></span><span class="hs-comment">-- external process or in the current process.</span><span>
</span><span id="line-6"></span><span class="hs-comment">--</span><span>
</span><span id="line-7"></span><span class="hs-keyword">module</span><span> </span><span class="annot"><a href="GHC.Runtime.Interpreter.html"><span class="hs-identifier">GHC.Runtime.Interpreter</span></a></span><span>
</span><span id="line-8"></span><span>  </span><span class="hs-special">(</span><span> </span><span class="hs-keyword">module</span><span> </span><span class="annot"><a href="GHC.Runtime.Interpreter.Types.html"><span class="hs-identifier">GHC.Runtime.Interpreter.Types</span></a></span><span>
</span><span id="line-9"></span><span>
</span><span id="line-10"></span><span>  </span><span class="annot"><span class="hs-comment">-- * High-level interface to the interpreter</span></span><span>
</span><span id="line-11"></span><span>  </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Runtime.Interpreter.html#evalStmt"><span class="hs-identifier">evalStmt</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="../../ghci-9.12.2-bd10/src/GHCi.Message.html#EvalStatus_"><span class="hs-identifier">EvalStatus_</span></a></span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="annot"><a href="../../ghci-9.12.2-bd10/src/GHCi.Message.html#EvalStatus"><span class="hs-identifier">EvalStatus</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="../../ghci-9.12.2-bd10/src/GHCi.Message.html#EvalResult"><span class="hs-identifier">EvalResult</span></a></span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="annot"><a href="../../ghci-9.12.2-bd10/src/GHCi.Message.html#EvalExpr"><span class="hs-identifier">EvalExpr</span></a></span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span>
</span><span id="line-12"></span><span>  </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Runtime.Interpreter.html#resumeStmt"><span class="hs-identifier">resumeStmt</span></a></span><span>
</span><span id="line-13"></span><span>  </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Runtime.Interpreter.html#abandonStmt"><span class="hs-identifier">abandonStmt</span></a></span><span>
</span><span id="line-14"></span><span>  </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Runtime.Interpreter.html#evalIO"><span class="hs-identifier">evalIO</span></a></span><span>
</span><span id="line-15"></span><span>  </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Runtime.Interpreter.html#evalString"><span class="hs-identifier">evalString</span></a></span><span>
</span><span id="line-16"></span><span>  </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Runtime.Interpreter.html#evalStringToIOString"><span class="hs-identifier">evalStringToIOString</span></a></span><span>
</span><span id="line-17"></span><span>  </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Runtime.Interpreter.html#mallocData"><span class="hs-identifier">mallocData</span></a></span><span>
</span><span id="line-18"></span><span>  </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Runtime.Interpreter.html#createBCOs"><span class="hs-identifier">createBCOs</span></a></span><span>
</span><span id="line-19"></span><span>  </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Runtime.Interpreter.html#addSptEntry"><span class="hs-identifier">addSptEntry</span></a></span><span>
</span><span id="line-20"></span><span>  </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Runtime.Interpreter.html#mkCostCentres"><span class="hs-identifier">mkCostCentres</span></a></span><span>
</span><span id="line-21"></span><span>  </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Runtime.Interpreter.html#costCentreStackInfo"><span class="hs-identifier">costCentreStackInfo</span></a></span><span>
</span><span id="line-22"></span><span>  </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Runtime.Interpreter.html#newBreakArray"><span class="hs-identifier">newBreakArray</span></a></span><span>
</span><span id="line-23"></span><span>  </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Runtime.Interpreter.html#newModuleName"><span class="hs-identifier">newModuleName</span></a></span><span>
</span><span id="line-24"></span><span>  </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Runtime.Interpreter.html#storeBreakpoint"><span class="hs-identifier">storeBreakpoint</span></a></span><span>
</span><span id="line-25"></span><span>  </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Runtime.Interpreter.html#breakpointStatus"><span class="hs-identifier">breakpointStatus</span></a></span><span>
</span><span id="line-26"></span><span>  </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Runtime.Interpreter.html#getBreakpointVar"><span class="hs-identifier">getBreakpointVar</span></a></span><span>
</span><span id="line-27"></span><span>  </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Runtime.Interpreter.html#getClosure"><span class="hs-identifier">getClosure</span></a></span><span>
</span><span id="line-28"></span><span>  </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Runtime.Interpreter.html#getModBreaks"><span class="hs-identifier">getModBreaks</span></a></span><span>
</span><span id="line-29"></span><span>  </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Runtime.Interpreter.html#seqHValue"><span class="hs-identifier">seqHValue</span></a></span><span>
</span><span id="line-30"></span><span>  </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Runtime.Interpreter.html#evalBreakpointToId"><span class="hs-identifier">evalBreakpointToId</span></a></span><span>
</span><span id="line-31"></span><span>  </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Runtime.Interpreter.html#interpreterDynamic"><span class="hs-identifier">interpreterDynamic</span></a></span><span>
</span><span id="line-32"></span><span>  </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Runtime.Interpreter.html#interpreterProfiled"><span class="hs-identifier">interpreterProfiled</span></a></span><span>
</span><span id="line-33"></span><span>
</span><span id="line-34"></span><span>  </span><span class="annot"><span class="hs-comment">-- * The object-code linker</span></span><span>
</span><span id="line-35"></span><span>  </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Runtime.Interpreter.html#initObjLinker"><span class="hs-identifier">initObjLinker</span></a></span><span>
</span><span id="line-36"></span><span>  </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Runtime.Interpreter.html#lookupSymbol"><span class="hs-identifier">lookupSymbol</span></a></span><span>
</span><span id="line-37"></span><span>  </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Runtime.Interpreter.html#lookupSymbolInDLL"><span class="hs-identifier">lookupSymbolInDLL</span></a></span><span>
</span><span id="line-38"></span><span>  </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Runtime.Interpreter.html#lookupClosure"><span class="hs-identifier">lookupClosure</span></a></span><span>
</span><span id="line-39"></span><span>  </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Runtime.Interpreter.html#loadDLL"><span class="hs-identifier">loadDLL</span></a></span><span>
</span><span id="line-40"></span><span>  </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Runtime.Interpreter.html#loadArchive"><span class="hs-identifier">loadArchive</span></a></span><span>
</span><span id="line-41"></span><span>  </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Runtime.Interpreter.html#loadObj"><span class="hs-identifier">loadObj</span></a></span><span>
</span><span id="line-42"></span><span>  </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Runtime.Interpreter.html#unloadObj"><span class="hs-identifier">unloadObj</span></a></span><span>
</span><span id="line-43"></span><span>  </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Runtime.Interpreter.html#addLibrarySearchPath"><span class="hs-identifier">addLibrarySearchPath</span></a></span><span>
</span><span id="line-44"></span><span>  </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Runtime.Interpreter.html#removeLibrarySearchPath"><span class="hs-identifier">removeLibrarySearchPath</span></a></span><span>
</span><span id="line-45"></span><span>  </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Runtime.Interpreter.html#resolveObjs"><span class="hs-identifier">resolveObjs</span></a></span><span>
</span><span id="line-46"></span><span>  </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Runtime.Interpreter.html#findSystemLibrary"><span class="hs-identifier">findSystemLibrary</span></a></span><span>
</span><span id="line-47"></span><span>
</span><span id="line-48"></span><span>  </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Runtime.Interpreter.html#interpCmd"><span class="hs-identifier">interpCmd</span></a></span><span>
</span><span id="line-49"></span><span>  </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Runtime.Interpreter.html#withExtInterp"><span class="hs-identifier">withExtInterp</span></a></span><span>
</span><span id="line-50"></span><span>  </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Runtime.Interpreter.html#withExtInterpStatus"><span class="hs-identifier">withExtInterpStatus</span></a></span><span>
</span><span id="line-51"></span><span>  </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Runtime.Interpreter.html#withIServ"><span class="hs-identifier">withIServ</span></a></span><span>
</span><span id="line-52"></span><span>  </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Runtime.Interpreter.html#withJSInterp"><span class="hs-identifier">withJSInterp</span></a></span><span>
</span><span id="line-53"></span><span>  </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Runtime.Interpreter.html#stopInterp"><span class="hs-identifier">stopInterp</span></a></span><span>
</span><span id="line-54"></span><span>  </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Runtime.Interpreter.html#purgeLookupSymbolCache"><span class="hs-identifier">purgeLookupSymbolCache</span></a></span><span>
</span><span id="line-55"></span><span>  </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Runtime.Interpreter.html#freeReallyRemoteRef"><span class="hs-identifier">freeReallyRemoteRef</span></a></span><span>
</span><span id="line-56"></span><span>  </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Runtime.Interpreter.html#freeHValueRefs"><span class="hs-identifier">freeHValueRefs</span></a></span><span>
</span><span id="line-57"></span><span>  </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Runtime.Interpreter.html#mkFinalizedHValue"><span class="hs-identifier">mkFinalizedHValue</span></a></span><span>
</span><span id="line-58"></span><span>  </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Runtime.Interpreter.html#wormhole"><span class="hs-identifier">wormhole</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Runtime.Interpreter.html#wormholeRef"><span class="hs-identifier">wormholeRef</span></a></span><span>
</span><span id="line-59"></span><span>  </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Runtime.Interpreter.html#fromEvalResult"><span class="hs-identifier">fromEvalResult</span></a></span><span>
</span><span id="line-60"></span><span>
</span><span id="line-61"></span><span>  </span><span class="annot"><span class="hs-comment">-- * Reexport for convenience</span></span><span>
</span><span id="line-62"></span><span>  </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="../../ghci-9.12.2-bd10/src/GHCi.Message.html#Message"><span class="hs-identifier">Message</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span>
</span><span id="line-63"></span><span>  </span><span class="hs-special">,</span><span> </span><span class="hs-keyword">module</span><span> </span><span class="annot"><a href="GHC.Runtime.Interpreter.Process.html"><span class="hs-identifier">GHC.Runtime.Interpreter.Process</span></a></span><span>
</span><span id="line-64"></span><span>  </span><span class="hs-special">)</span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-65"></span><span>
</span><span id="line-66"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Prelude.html"><span class="hs-identifier">GHC.Prelude</span></a></span><span>
</span><span id="line-67"></span><span>
</span><span id="line-68"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Runtime.Interpreter.Types.html"><span class="hs-identifier">GHC.Runtime.Interpreter.Types</span></a></span><span>
</span><span id="line-69"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Runtime.Interpreter.JS.html"><span class="hs-identifier">GHC.Runtime.Interpreter.JS</span></a></span><span>
</span><span id="line-70"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Runtime.Interpreter.Wasm.html"><span class="hs-identifier">GHC.Runtime.Interpreter.Wasm</span></a></span><span>
</span><span id="line-71"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Runtime.Interpreter.Process.html"><span class="hs-identifier">GHC.Runtime.Interpreter.Process</span></a></span><span>
</span><span id="line-72"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Runtime.Utils.html"><span class="hs-identifier">GHC.Runtime.Utils</span></a></span><span>
</span><span id="line-73"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="../../ghci-9.12.2-bd10/src/GHCi.Message.html"><span class="hs-identifier">GHCi.Message</span></a></span><span>
</span><span id="line-74"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="../../ghci-9.12.2-bd10/src/GHCi.RemoteTypes.html"><span class="hs-identifier">GHCi.RemoteTypes</span></a></span><span>
</span><span id="line-75"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="../../ghci-9.12.2-bd10/src/GHCi.ResolvedBCO.html"><span class="hs-identifier">GHCi.ResolvedBCO</span></a></span><span>
</span><span id="line-76"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="../../ghci-9.12.2-bd10/src/GHCi.BreakArray.html"><span class="hs-identifier">GHCi.BreakArray</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../../ghci-9.12.2-bd10/src/GHCi.BreakArray.html#BreakArray"><span class="hs-identifier">BreakArray</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-77"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Types.Breakpoint.html"><span class="hs-identifier">GHC.Types.Breakpoint</span></a></span><span>
</span><span id="line-78"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.ByteCode.Types.html"><span class="hs-identifier">GHC.ByteCode.Types</span></a></span><span>
</span><span id="line-79"></span><span>
</span><span id="line-80"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Linker.Types.html"><span class="hs-identifier">GHC.Linker.Types</span></a></span><span>
</span><span id="line-81"></span><span>
</span><span id="line-82"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Data.Maybe.html"><span class="hs-identifier">GHC.Data.Maybe</span></a></span><span>
</span><span id="line-83"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Data.FastString.html"><span class="hs-identifier">GHC.Data.FastString</span></a></span><span>
</span><span id="line-84"></span><span>
</span><span id="line-85"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Types.SrcLoc.html"><span class="hs-identifier">GHC.Types.SrcLoc</span></a></span><span>
</span><span id="line-86"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Types.Unique.FM.html"><span class="hs-identifier">GHC.Types.Unique.FM</span></a></span><span>
</span><span id="line-87"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Types.Basic.html"><span class="hs-identifier">GHC.Types.Basic</span></a></span><span>
</span><span id="line-88"></span><span>
</span><span id="line-89"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Utils.Panic.html"><span class="hs-identifier">GHC.Utils.Panic</span></a></span><span>
</span><span id="line-90"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Utils.Exception.html"><span class="hs-identifier">GHC.Utils.Exception</span></a></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">Ex</span></span><span>
</span><span id="line-91"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Utils.Outputable.html"><span class="hs-identifier">GHC.Utils.Outputable</span></a></span><span class="hs-special">(</span><span class="annot"><a href="GHC.Utils.Outputable.html#brackets"><span class="hs-identifier">brackets</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier">ppr</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Utils.Outputable.html#showSDocUnsafe"><span class="hs-identifier">showSDocUnsafe</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-92"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Utils.Fingerprint.html"><span class="hs-identifier">GHC.Utils.Fingerprint</span></a></span><span>
</span><span id="line-93"></span><span>
</span><span id="line-94"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Unit.Module.html"><span class="hs-identifier">GHC.Unit.Module</span></a></span><span>
</span><span id="line-95"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Unit.Module.ModIface.html"><span class="hs-identifier">GHC.Unit.Module.ModIface</span></a></span><span>
</span><span id="line-96"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Unit.Home.ModInfo.html"><span class="hs-identifier">GHC.Unit.Home.ModInfo</span></a></span><span>
</span><span id="line-97"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Unit.Env.html"><span class="hs-identifier">GHC.Unit.Env</span></a></span><span class="hs-cpp">

#if defined(HAVE_INTERNAL_INTERPRETER)
</span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="../../ghci-9.12.2-bd10/src/GHCi.Run.html"><span class="hs-identifier">GHCi.Run</span></a></span><span>
</span><span id="line-101"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Platform.Ways.html"><span class="hs-identifier">GHC.Platform.Ways</span></a></span><span class="hs-cpp">
#endif
</span><span>
</span><span id="line-104"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="../../base-4.21.0.0-ae91/src/Control.Concurrent.html"><span class="hs-identifier">Control.Concurrent</span></a></span><span>
</span><span id="line-105"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="../../base-4.21.0.0-ae91/src/Control.Monad.html"><span class="hs-identifier">Control.Monad</span></a></span><span>
</span><span id="line-106"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="../../base-4.21.0.0-ae91/src/Control.Monad.IO.Class.html"><span class="hs-identifier">Control.Monad.IO.Class</span></a></span><span>
</span><span id="line-107"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="../../exceptions-0.10.9-4d2e/src/Control.Monad.Catch.html"><span class="hs-identifier">Control.Monad.Catch</span></a></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">MC</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../../exceptions-0.10.9-4d2e/src/Control.Monad.Catch.html#mask"><span class="hs-identifier">mask</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-108"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="../../binary-0.8.9.3-25e5/src/Data.Binary.html"><span class="hs-identifier">Data.Binary</span></a></span><span>
</span><span id="line-109"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="../../bytestring-0.12.2.0-7dd0/src/Data.ByteString.html"><span class="hs-identifier">Data.ByteString</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../../bytestring-0.12.2.0-7dd0/src/Data.ByteString.Internal.Type.html#ByteString"><span class="hs-identifier">ByteString</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-110"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="../../array-0.5.8.0-9044/src/Data.Array.html"><span class="hs-identifier">Data.Array</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-operator">(!)</span></span><span class="hs-special">)</span><span>
</span><span id="line-111"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="../../base-4.21.0.0-ae91/src/Data.IORef.html"><span class="hs-identifier">Data.IORef</span></a></span><span>
</span><span id="line-112"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="../../base-4.21.0.0-ae91/src/Foreign.html"><span class="hs-identifier">Foreign</span></a></span><span> </span><span class="hs-keyword">hiding</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">void</span></span><span class="hs-special">)</span><span>
</span><span id="line-113"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><a href="../../ghc-heap-9.12.2-4363/src/GHC.Exts.Heap.html"><span class="hs-identifier">GHC.Exts.Heap</span></a></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">Heap</span></span><span>
</span><span id="line-114"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="../../base-4.21.0.0-ae91/src/GHC.Stack.CCS.html"><span class="hs-identifier">GHC.Stack.CCS</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">CostCentre</span></span><span class="hs-special">,</span><span class="annot"><span class="hs-identifier">CostCentreStack</span></span><span class="hs-special">)</span><span>
</span><span id="line-115"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="../../directory-1.3.9.0-af18/src/System.Directory.html"><span class="hs-identifier">System.Directory</span></a></span><span>
</span><span id="line-116"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="../../process-1.6.25.0-5f54/src/System.Process.html"><span class="hs-identifier">System.Process</span></a></span><span>
</span><span id="line-117"></span><span>
</span><span id="line-118"></span><span class="hs-comment">{- Note [Remote GHCi]
   ~~~~~~~~~~~~~~~~~~
When the flag -fexternal-interpreter is given to GHC, interpreted code
is run in a separate process called iserv, and we communicate with the
external process over a pipe using Binary-encoded messages.

Motivation
~~~~~~~~~~

When the interpreted code is running in a separate process, it can
use a different &quot;way&quot;, e.g. profiled or dynamic.  This means

- compiling Template Haskell code with -prof does not require
  building the code without -prof first

- when GHC itself is profiled, it can interpret unprofiled code,
  and the same applies to dynamic linking.

- An unprofiled GHCi can load and run profiled code, which means it
  can use the stack-trace functionality provided by profiling without
  taking the performance hit on the compiler that profiling would
  entail.

For other reasons see remote-GHCi on the wiki.

Implementation Overview
~~~~~~~~~~~~~~~~~~~~~~~

The main pieces are:

- libraries/ghci, containing:
  - types for talking about remote values (GHCi.RemoteTypes)
  - the message protocol (GHCi.Message),
  - implementation of the messages (GHCi.Run)
  - implementation of Template Haskell (GHCi.TH)
  - a few other things needed to run interpreted code

- top-level iserv directory, containing the code for the external
  server. This is a fairly simple wrapper, most of the functionality
  is provided by modules in libraries/ghci.

- This module which provides the interface to the server used
  by the rest of GHC.

GHC works with and without -fexternal-interpreter. With the flag, all
interpreted code is run by the iserv binary. Without the flag,
interpreted code is run in the same process as GHC.

Things that do not work with -fexternal-interpreter
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~

dynCompileExpr cannot work, because we have no way to run code of an
unknown type in the remote process. This API fails with an error
message if it is used with -fexternal-interpreter.

Other Notes on Remote GHCi
~~~~~~~~~~~~~~~~~~~~~~~~~~
  * This wiki page has an implementation overview:
    https://gitlab.haskell.org/ghc/ghc/wikis/commentary/compiler/external-interpreter
  * Note [External GHCi pointers] in &quot;GHC.Runtime.Interpreter&quot;
  * Note [Remote Template Haskell] in libraries/ghci/GHCi/TH.hs
-}</span><span>
</span><span id="line-180"></span><span>
</span><span id="line-181"></span><span>
</span><span id="line-182"></span><span class="hs-comment">-- | Run a command in the interpreter's context.  With</span><span>
</span><span id="line-183"></span><span class="hs-comment">-- @-fexternal-interpreter@, the command is serialized and sent to an</span><span>
</span><span id="line-184"></span><span class="hs-comment">-- external iserv process, and the response is deserialized (hence the</span><span>
</span><span id="line-185"></span><span class="hs-comment">-- @Binary@ constraint).  With @-fno-external-interpreter@ we execute</span><span>
</span><span id="line-186"></span><span class="hs-comment">-- the command directly here.</span><span>
</span><span id="line-187"></span><span id="local-6989586621682961083"><span class="annot"><a href="GHC.Runtime.Interpreter.html#interpCmd"><span class="hs-identifier hs-type">interpCmd</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="../../binary-0.8.9.3-25e5/src/Data.Binary.Class.html#Binary"><span class="hs-identifier hs-type">Binary</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682961083"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="GHC.Runtime.Interpreter.Types.html#Interp"><span class="hs-identifier hs-type">Interp</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="../../ghci-9.12.2-bd10/src/GHCi.Message.html#Message"><span class="hs-identifier hs-type">Message</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682961083"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="annot"><a href="#local-6989586621682961083"><span class="hs-identifier hs-type">a</span></a></span></span><span>
</span><span id="line-188"></span><span id="interpCmd"><span class="annot"><span class="annottext">interpCmd :: forall a. Binary a =&gt; Interp -&gt; Message a -&gt; IO a
</span><a href="GHC.Runtime.Interpreter.html#interpCmd"><span class="hs-identifier hs-var hs-var">interpCmd</span></a></span></span><span> </span><span id="local-6989586621682961484"><span class="annot"><span class="annottext">Interp
</span><a href="#local-6989586621682961484"><span class="hs-identifier hs-var">interp</span></a></span></span><span> </span><span id="local-6989586621682961485"><span class="annot"><span class="annottext">Message a
</span><a href="#local-6989586621682961485"><span class="hs-identifier hs-var">msg</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">Interp -&gt; InterpInstance
</span><a href="GHC.Runtime.Interpreter.Types.html#interpInstance"><span class="hs-identifier hs-var">interpInstance</span></a></span><span> </span><span class="annot"><span class="annottext">Interp
</span><a href="#local-6989586621682961484"><span class="hs-identifier hs-var">interp</span></a></span><span> </span><span class="hs-keyword">of</span><span class="hs-cpp">
#if defined(HAVE_INTERNAL_INTERPRETER)
</span><span>  </span><span class="annot"><span class="annottext">InterpInstance
</span><a href="GHC.Runtime.Interpreter.Types.html#InternalInterp"><span class="hs-identifier hs-var">InternalInterp</span></a></span><span>     </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Message a -&gt; IO a
forall a. Message a -&gt; IO a
</span><a href="../../ghci-9.12.2-bd10/src/GHCi.Run.html#run"><span class="hs-identifier hs-var">run</span></a></span><span> </span><span class="annot"><span class="annottext">Message a
</span><a href="#local-6989586621682961485"><span class="hs-identifier hs-var">msg</span></a></span><span> </span><span class="hs-comment">-- Just run it directly</span><span class="hs-cpp">
#endif
</span><span>  </span><span class="annot"><a href="GHC.Runtime.Interpreter.Types.html#ExternalInterp"><span class="hs-identifier hs-type">ExternalInterp</span></a></span><span> </span><span id="local-6989586621682961490"><span class="annot"><span class="annottext">ExtInterp
</span><a href="#local-6989586621682961490"><span class="hs-identifier hs-var">ext</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">ExtInterp -&gt; (forall d. ExtInterpInstance d -&gt; IO a) -&gt; IO a
forall (m :: * -&gt; *) a.
ExceptionMonad m =&gt;
ExtInterp -&gt; (forall d. ExtInterpInstance d -&gt; m a) -&gt; m a
</span><a href="GHC.Runtime.Interpreter.html#withExtInterp"><span class="hs-identifier hs-var">withExtInterp</span></a></span><span> </span><span class="annot"><span class="annottext">ExtInterp
</span><a href="#local-6989586621682961490"><span class="hs-identifier hs-var">ext</span></a></span><span> </span><span class="annot"><span class="annottext">((forall d. ExtInterpInstance d -&gt; IO a) -&gt; IO a)
-&gt; (forall d. ExtInterpInstance d -&gt; IO a) -&gt; IO a
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-glyph">\</span><span id="local-6989586621682961492"><span class="annot"><span class="annottext">ExtInterpInstance d
</span><a href="#local-6989586621682961492"><span class="hs-identifier hs-var">inst</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-193"></span><span>    </span><span class="annot"><span class="annottext">IO a -&gt; IO a
forall a. IO a -&gt; IO a
</span><span class="hs-identifier hs-var">uninterruptibleMask_</span></span><span> </span><span class="annot"><span class="annottext">(IO a -&gt; IO a) -&gt; IO a -&gt; IO a
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-comment">-- Note [uninterruptibleMask_ and interpCmd]</span><span>
</span><span id="line-194"></span><span>      </span><span class="annot"><span class="annottext">ExtInterpInstance d -&gt; Message a -&gt; IO a
forall a d. Binary a =&gt; ExtInterpInstance d -&gt; Message a -&gt; IO a
</span><a href="GHC.Runtime.Interpreter.Process.html#sendMessage"><span class="hs-identifier hs-var">sendMessage</span></a></span><span> </span><span class="annot"><span class="annottext">ExtInterpInstance d
</span><a href="#local-6989586621682961492"><span class="hs-identifier hs-var">inst</span></a></span><span> </span><span class="annot"><span class="annottext">Message a
</span><a href="#local-6989586621682961485"><span class="hs-identifier hs-var">msg</span></a></span><span>
</span><span id="line-195"></span><span>
</span><span id="line-196"></span><span>
</span><span id="line-197"></span><span id="local-6989586621682961092"><span id="local-6989586621682961093"><span class="annot"><a href="GHC.Runtime.Interpreter.html#withExtInterp"><span class="hs-identifier hs-type">withExtInterp</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Utils.Exception.html#ExceptionMonad"><span class="hs-identifier hs-type">ExceptionMonad</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682961092"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="GHC.Runtime.Interpreter.Types.html#ExtInterp"><span class="hs-identifier hs-type">ExtInterp</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="hs-keyword">forall</span><span> </span><span id="local-6989586621682961090"><span class="annot"><a href="#local-6989586621682961090"><span class="hs-identifier hs-type">d</span></a></span></span><span class="hs-operator">.</span><span> </span><span class="annot"><a href="GHC.Runtime.Interpreter.Types.html#ExtInterpInstance"><span class="hs-identifier hs-type">ExtInterpInstance</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682961090"><span class="hs-identifier hs-type">d</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621682961092"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682961093"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621682961092"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682961093"><span class="hs-identifier hs-type">a</span></a></span></span></span><span>
</span><span id="line-198"></span><span id="withExtInterp"><span class="annot"><span class="annottext">withExtInterp :: forall (m :: * -&gt; *) a.
ExceptionMonad m =&gt;
ExtInterp -&gt; (forall d. ExtInterpInstance d -&gt; m a) -&gt; m a
</span><a href="GHC.Runtime.Interpreter.html#withExtInterp"><span class="hs-identifier hs-var hs-var">withExtInterp</span></a></span></span><span> </span><span id="local-6989586621682961499"><span class="annot"><span class="annottext">ExtInterp
</span><a href="#local-6989586621682961499"><span class="hs-identifier hs-var">ext</span></a></span></span><span> </span><span id="local-6989586621682961500"><span class="annot"><span class="annottext">forall d. ExtInterpInstance d -&gt; m a
</span><a href="#local-6989586621682961500"><span class="hs-identifier hs-var">action</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">ExtInterp
</span><a href="#local-6989586621682961499"><span class="hs-identifier hs-var">ext</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-199"></span><span>  </span><span class="annot"><a href="GHC.Runtime.Interpreter.Types.html#ExtJS"><span class="hs-identifier hs-type">ExtJS</span></a></span><span>    </span><span id="local-6989586621682961502"><span class="annot"><span class="annottext">JSInterp
</span><a href="#local-6989586621682961502"><span class="hs-identifier hs-var">i</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">JSInterp -&gt; (ExtInterpInstance JSInterpExtra -&gt; m a) -&gt; m a
forall (m :: * -&gt; *) a.
ExceptionMonad m =&gt;
JSInterp -&gt; (ExtInterpInstance JSInterpExtra -&gt; m a) -&gt; m a
</span><a href="GHC.Runtime.Interpreter.html#withJSInterp"><span class="hs-identifier hs-var">withJSInterp</span></a></span><span> </span><span class="annot"><span class="annottext">JSInterp
</span><a href="#local-6989586621682961502"><span class="hs-identifier hs-var">i</span></a></span><span> </span><span class="annot"><span class="annottext">ExtInterpInstance JSInterpExtra -&gt; m a
forall d. ExtInterpInstance d -&gt; m a
</span><a href="#local-6989586621682961500"><span class="hs-identifier hs-var">action</span></a></span><span>
</span><span id="line-200"></span><span>  </span><span class="annot"><a href="GHC.Runtime.Interpreter.Types.html#ExtWasm"><span class="hs-identifier hs-type">ExtWasm</span></a></span><span>  </span><span id="local-6989586621682961504"><span class="annot"><span class="annottext">WasmInterp
</span><a href="#local-6989586621682961504"><span class="hs-identifier hs-var">i</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">WasmInterp -&gt; (ExtInterpInstance () -&gt; m a) -&gt; m a
forall (m :: * -&gt; *) a.
ExceptionMonad m =&gt;
WasmInterp -&gt; (ExtInterpInstance () -&gt; m a) -&gt; m a
</span><a href="GHC.Runtime.Interpreter.html#withWasmInterp"><span class="hs-identifier hs-var">withWasmInterp</span></a></span><span> </span><span class="annot"><span class="annottext">WasmInterp
</span><a href="#local-6989586621682961504"><span class="hs-identifier hs-var">i</span></a></span><span> </span><span class="annot"><span class="annottext">ExtInterpInstance () -&gt; m a
forall d. ExtInterpInstance d -&gt; m a
</span><a href="#local-6989586621682961500"><span class="hs-identifier hs-var">action</span></a></span><span>
</span><span id="line-201"></span><span>  </span><span class="annot"><a href="GHC.Runtime.Interpreter.Types.html#ExtIServ"><span class="hs-identifier hs-type">ExtIServ</span></a></span><span> </span><span id="local-6989586621682961507"><span class="annot"><span class="annottext">IServ
</span><a href="#local-6989586621682961507"><span class="hs-identifier hs-var">i</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">IServ -&gt; (ExtInterpInstance () -&gt; m a) -&gt; m a
forall (m :: * -&gt; *) a.
ExceptionMonad m =&gt;
IServ -&gt; (ExtInterpInstance () -&gt; m a) -&gt; m a
</span><a href="GHC.Runtime.Interpreter.html#withIServ"><span class="hs-identifier hs-var">withIServ</span></a></span><span>    </span><span class="annot"><span class="annottext">IServ
</span><a href="#local-6989586621682961507"><span class="hs-identifier hs-var">i</span></a></span><span> </span><span class="annot"><span class="annottext">ExtInterpInstance () -&gt; m a
forall d. ExtInterpInstance d -&gt; m a
</span><a href="#local-6989586621682961500"><span class="hs-identifier hs-var">action</span></a></span><span>
</span><span id="line-202"></span><span>
</span><span id="line-203"></span><span id="local-6989586621682961117"><span id="local-6989586621682961118"><span class="annot"><a href="GHC.Runtime.Interpreter.html#withExtInterpStatus"><span class="hs-identifier hs-type">withExtInterpStatus</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Runtime.Interpreter.Types.html#ExtInterp"><span class="hs-identifier hs-type">ExtInterp</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="hs-keyword">forall</span><span> </span><span id="local-6989586621682961115"><span class="annot"><a href="#local-6989586621682961115"><span class="hs-identifier hs-type">d</span></a></span></span><span class="hs-operator">.</span><span> </span><span class="annot"><a href="GHC.Runtime.Interpreter.Types.html#ExtInterpStatusVar"><span class="hs-identifier hs-type">ExtInterpStatusVar</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682961115"><span class="hs-identifier hs-type">d</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621682961117"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682961118"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621682961117"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682961118"><span class="hs-identifier hs-type">a</span></a></span></span></span><span>
</span><span id="line-204"></span><span id="withExtInterpStatus"><span class="annot"><span class="annottext">withExtInterpStatus :: forall {k} (m :: k -&gt; *) (a :: k).
ExtInterp -&gt; (forall d. ExtInterpStatusVar d -&gt; m a) -&gt; m a
</span><a href="GHC.Runtime.Interpreter.html#withExtInterpStatus"><span class="hs-identifier hs-var hs-var">withExtInterpStatus</span></a></span></span><span> </span><span id="local-6989586621682961508"><span class="annot"><span class="annottext">ExtInterp
</span><a href="#local-6989586621682961508"><span class="hs-identifier hs-var">ext</span></a></span></span><span> </span><span id="local-6989586621682961509"><span class="annot"><span class="annottext">forall d. ExtInterpStatusVar d -&gt; m a
</span><a href="#local-6989586621682961509"><span class="hs-identifier hs-var">action</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">ExtInterp
</span><a href="#local-6989586621682961508"><span class="hs-identifier hs-var">ext</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-205"></span><span>  </span><span class="annot"><a href="GHC.Runtime.Interpreter.Types.html#ExtJS"><span class="hs-identifier hs-type">ExtJS</span></a></span><span>    </span><span id="local-6989586621682961510"><span class="annot"><span class="annottext">JSInterp
</span><a href="#local-6989586621682961510"><span class="hs-identifier hs-var">i</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">ExtInterpStatusVar JSInterpExtra -&gt; m a
forall d. ExtInterpStatusVar d -&gt; m a
</span><a href="#local-6989586621682961509"><span class="hs-identifier hs-var">action</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">JSInterp -&gt; ExtInterpStatusVar JSInterpExtra
forall cfg details.
ExtInterpState cfg details -&gt; ExtInterpStatusVar details
</span><a href="GHC.Runtime.Interpreter.Types.html#interpStatus"><span class="hs-identifier hs-var">interpStatus</span></a></span><span> </span><span class="annot"><span class="annottext">JSInterp
</span><a href="#local-6989586621682961510"><span class="hs-identifier hs-var">i</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-206"></span><span>  </span><span class="annot"><a href="GHC.Runtime.Interpreter.Types.html#ExtWasm"><span class="hs-identifier hs-type">ExtWasm</span></a></span><span>  </span><span id="local-6989586621682961512"><span class="annot"><span class="annottext">WasmInterp
</span><a href="#local-6989586621682961512"><span class="hs-identifier hs-var">i</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">ExtInterpStatusVar () -&gt; m a
forall d. ExtInterpStatusVar d -&gt; m a
</span><a href="#local-6989586621682961509"><span class="hs-identifier hs-var">action</span></a></span><span> </span><span class="annot"><span class="annottext">(ExtInterpStatusVar () -&gt; m a) -&gt; ExtInterpStatusVar () -&gt; m a
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">WasmInterp -&gt; ExtInterpStatusVar ()
forall cfg details.
ExtInterpState cfg details -&gt; ExtInterpStatusVar details
</span><a href="GHC.Runtime.Interpreter.Types.html#interpStatus"><span class="hs-identifier hs-var">interpStatus</span></a></span><span> </span><span class="annot"><span class="annottext">WasmInterp
</span><a href="#local-6989586621682961512"><span class="hs-identifier hs-var">i</span></a></span><span>
</span><span id="line-207"></span><span>  </span><span class="annot"><a href="GHC.Runtime.Interpreter.Types.html#ExtIServ"><span class="hs-identifier hs-type">ExtIServ</span></a></span><span> </span><span id="local-6989586621682961513"><span class="annot"><span class="annottext">IServ
</span><a href="#local-6989586621682961513"><span class="hs-identifier hs-var">i</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">ExtInterpStatusVar () -&gt; m a
forall d. ExtInterpStatusVar d -&gt; m a
</span><a href="#local-6989586621682961509"><span class="hs-identifier hs-var">action</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">IServ -&gt; ExtInterpStatusVar ()
forall cfg details.
ExtInterpState cfg details -&gt; ExtInterpStatusVar details
</span><a href="GHC.Runtime.Interpreter.Types.html#interpStatus"><span class="hs-identifier hs-var">interpStatus</span></a></span><span> </span><span class="annot"><span class="annottext">IServ
</span><a href="#local-6989586621682961513"><span class="hs-identifier hs-var">i</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-208"></span><span>
</span><span id="line-209"></span><span class="hs-comment">-- Note [uninterruptibleMask_ and interpCmd]</span><span>
</span><span id="line-210"></span><span class="hs-comment">-- ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~</span><span>
</span><span id="line-211"></span><span class="hs-comment">-- If we receive an async exception, such as ^C, while communicating</span><span>
</span><span id="line-212"></span><span class="hs-comment">-- with the iserv process then we will be out-of-sync and not be able</span><span>
</span><span id="line-213"></span><span class="hs-comment">-- to recover.  Thus we use uninterruptibleMask_ during</span><span>
</span><span id="line-214"></span><span class="hs-comment">-- communication.  A ^C will be delivered to the iserv process (because</span><span>
</span><span id="line-215"></span><span class="hs-comment">-- signals get sent to the whole process group) which will interrupt</span><span>
</span><span id="line-216"></span><span class="hs-comment">-- the running computation and return an EvalException result.</span><span>
</span><span id="line-217"></span><span>
</span><span id="line-218"></span><span class="hs-comment">-- | Grab a lock on the 'IServ' and do something with it.</span><span>
</span><span id="line-219"></span><span class="hs-comment">-- Overloaded because this is used from TcM as well as IO.</span><span>
</span><span id="line-220"></span><span id="local-6989586621682961112"><span id="local-6989586621682961113"><span class="annot"><a href="GHC.Runtime.Interpreter.html#withIServ"><span class="hs-identifier hs-type">withIServ</span></a></span><span>
</span><span id="line-221"></span><span>  </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Utils.Exception.html#ExceptionMonad"><span class="hs-identifier hs-type">ExceptionMonad</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682961112"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-222"></span><span>  </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="GHC.Runtime.Interpreter.Types.html#IServ"><span class="hs-identifier hs-type">IServ</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Runtime.Interpreter.Types.html#ExtInterpInstance"><span class="hs-identifier hs-type">ExtInterpInstance</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621682961112"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682961113"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621682961112"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682961113"><span class="hs-identifier hs-type">a</span></a></span></span></span><span>
</span><span id="line-223"></span><span id="withIServ"><span class="annot"><span class="annottext">withIServ :: forall (m :: * -&gt; *) a.
ExceptionMonad m =&gt;
IServ -&gt; (ExtInterpInstance () -&gt; m a) -&gt; m a
</span><a href="GHC.Runtime.Interpreter.html#withIServ"><span class="hs-identifier hs-var hs-var">withIServ</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Runtime.Interpreter.Types.html#ExtInterpState"><span class="hs-identifier hs-type">ExtInterpState</span></a></span><span> </span><span id="local-6989586621682961521"><span class="annot"><span class="annottext">IServConfig
</span><a href="#local-6989586621682961521"><span class="hs-identifier hs-var">cfg</span></a></span></span><span> </span><span id="local-6989586621682961522"><span class="annot"><span class="annottext">ExtInterpStatusVar ()
</span><a href="#local-6989586621682961522"><span class="hs-identifier hs-var">mstate</span></a></span></span><span class="hs-special">)</span><span> </span><span id="local-6989586621682961523"><span class="annot"><span class="annottext">ExtInterpInstance () -&gt; m a
</span><a href="#local-6989586621682961523"><span class="hs-identifier hs-var">action</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-224"></span><span>  </span><span id="local-6989586621682961524"><span class="annot"><a href="#local-6989586621682961524"><span class="hs-identifier hs-var">inst</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">IServConfig
-&gt; (IServConfig -&gt; IO (ExtInterpInstance ()))
-&gt; ExtInterpStatusVar ()
-&gt; m (ExtInterpInstance ())
forall (m :: * -&gt; *) cfg d.
ExceptionMonad m =&gt;
cfg
-&gt; (cfg -&gt; IO (ExtInterpInstance d))
-&gt; ExtInterpStatusVar d
-&gt; m (ExtInterpInstance d)
</span><a href="GHC.Runtime.Interpreter.html#spawnInterpMaybe"><span class="hs-identifier hs-var">spawnInterpMaybe</span></a></span><span> </span><span class="annot"><span class="annottext">IServConfig
</span><a href="#local-6989586621682961521"><span class="hs-identifier hs-var">cfg</span></a></span><span> </span><span class="annot"><span class="annottext">IServConfig -&gt; IO (ExtInterpInstance ())
</span><a href="GHC.Runtime.Interpreter.html#spawnIServ"><span class="hs-identifier hs-var">spawnIServ</span></a></span><span> </span><span class="annot"><span class="annottext">ExtInterpStatusVar ()
</span><a href="#local-6989586621682961522"><span class="hs-identifier hs-var">mstate</span></a></span><span>
</span><span id="line-225"></span><span>  </span><span class="annot"><a href="#local-6989586621682961523"><span class="hs-identifier hs-type">action</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682961524"><span class="hs-identifier hs-type">inst</span></a></span><span>
</span><span id="line-226"></span><span>
</span><span id="line-227"></span><span class="hs-comment">-- | Spawn JS interpreter if it isn't already running and execute the given action</span><span>
</span><span id="line-228"></span><span class="hs-comment">--</span><span>
</span><span id="line-229"></span><span class="hs-comment">-- Update the interpreter state.</span><span>
</span><span id="line-230"></span><span id="local-6989586621682961106"><span id="local-6989586621682961107"><span class="annot"><a href="GHC.Runtime.Interpreter.html#withJSInterp"><span class="hs-identifier hs-type">withJSInterp</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Utils.Exception.html#ExceptionMonad"><span class="hs-identifier hs-type">ExceptionMonad</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682961106"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="GHC.Runtime.Interpreter.Types.html#JSInterp"><span class="hs-identifier hs-type">JSInterp</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Runtime.Interpreter.Types.html#ExtInterpInstance"><span class="hs-identifier hs-type">ExtInterpInstance</span></a></span><span> </span><span class="annot"><a href="GHC.Runtime.Interpreter.Types.html#JSInterpExtra"><span class="hs-identifier hs-type">JSInterpExtra</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621682961106"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682961107"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621682961106"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682961107"><span class="hs-identifier hs-type">a</span></a></span></span></span><span>
</span><span id="line-231"></span><span id="withJSInterp"><span class="annot"><span class="annottext">withJSInterp :: forall (m :: * -&gt; *) a.
ExceptionMonad m =&gt;
JSInterp -&gt; (ExtInterpInstance JSInterpExtra -&gt; m a) -&gt; m a
</span><a href="GHC.Runtime.Interpreter.html#withJSInterp"><span class="hs-identifier hs-var hs-var">withJSInterp</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Runtime.Interpreter.Types.html#ExtInterpState"><span class="hs-identifier hs-type">ExtInterpState</span></a></span><span> </span><span id="local-6989586621682961532"><span class="annot"><span class="annottext">JSInterpConfig
</span><a href="#local-6989586621682961532"><span class="hs-identifier hs-var">cfg</span></a></span></span><span> </span><span id="local-6989586621682961533"><span class="annot"><span class="annottext">ExtInterpStatusVar JSInterpExtra
</span><a href="#local-6989586621682961533"><span class="hs-identifier hs-var">mstate</span></a></span></span><span class="hs-special">)</span><span> </span><span id="local-6989586621682961534"><span class="annot"><span class="annottext">ExtInterpInstance JSInterpExtra -&gt; m a
</span><a href="#local-6989586621682961534"><span class="hs-identifier hs-var">action</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-232"></span><span>  </span><span id="local-6989586621682961535"><span class="annot"><a href="#local-6989586621682961535"><span class="hs-identifier hs-var">inst</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">JSInterpConfig
-&gt; (JSInterpConfig -&gt; IO (ExtInterpInstance JSInterpExtra))
-&gt; ExtInterpStatusVar JSInterpExtra
-&gt; m (ExtInterpInstance JSInterpExtra)
forall (m :: * -&gt; *) cfg d.
ExceptionMonad m =&gt;
cfg
-&gt; (cfg -&gt; IO (ExtInterpInstance d))
-&gt; ExtInterpStatusVar d
-&gt; m (ExtInterpInstance d)
</span><a href="GHC.Runtime.Interpreter.html#spawnInterpMaybe"><span class="hs-identifier hs-var">spawnInterpMaybe</span></a></span><span> </span><span class="annot"><span class="annottext">JSInterpConfig
</span><a href="#local-6989586621682961532"><span class="hs-identifier hs-var">cfg</span></a></span><span> </span><span class="annot"><span class="annottext">JSInterpConfig -&gt; IO (ExtInterpInstance JSInterpExtra)
</span><a href="GHC.Runtime.Interpreter.JS.html#spawnJSInterp"><span class="hs-identifier hs-var">spawnJSInterp</span></a></span><span> </span><span class="annot"><span class="annottext">ExtInterpStatusVar JSInterpExtra
</span><a href="#local-6989586621682961533"><span class="hs-identifier hs-var">mstate</span></a></span><span>
</span><span id="line-233"></span><span>  </span><span class="annot"><a href="#local-6989586621682961534"><span class="hs-identifier hs-type">action</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682961535"><span class="hs-identifier hs-type">inst</span></a></span><span>
</span><span id="line-234"></span><span>
</span><span id="line-235"></span><span id="local-6989586621682961109"><span id="local-6989586621682961110"><span class="annot"><a href="GHC.Runtime.Interpreter.html#withWasmInterp"><span class="hs-identifier hs-type">withWasmInterp</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Utils.Exception.html#ExceptionMonad"><span class="hs-identifier hs-type">ExceptionMonad</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682961109"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="GHC.Runtime.Interpreter.Types.html#WasmInterp"><span class="hs-identifier hs-type">WasmInterp</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Runtime.Interpreter.Types.html#ExtInterpInstance"><span class="hs-identifier hs-type">ExtInterpInstance</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621682961109"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682961110"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621682961109"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682961110"><span class="hs-identifier hs-type">a</span></a></span></span></span><span>
</span><span id="line-236"></span><span id="withWasmInterp"><span class="annot"><span class="annottext">withWasmInterp :: forall (m :: * -&gt; *) a.
ExceptionMonad m =&gt;
WasmInterp -&gt; (ExtInterpInstance () -&gt; m a) -&gt; m a
</span><a href="GHC.Runtime.Interpreter.html#withWasmInterp"><span class="hs-identifier hs-var hs-var">withWasmInterp</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Runtime.Interpreter.Types.html#ExtInterpState"><span class="hs-identifier hs-type">ExtInterpState</span></a></span><span> </span><span id="local-6989586621682961542"><span class="annot"><span class="annottext">WasmInterpConfig
</span><a href="#local-6989586621682961542"><span class="hs-identifier hs-var">cfg</span></a></span></span><span> </span><span id="local-6989586621682961543"><span class="annot"><span class="annottext">ExtInterpStatusVar ()
</span><a href="#local-6989586621682961543"><span class="hs-identifier hs-var">mstate</span></a></span></span><span class="hs-special">)</span><span> </span><span id="local-6989586621682961544"><span class="annot"><span class="annottext">ExtInterpInstance () -&gt; m a
</span><a href="#local-6989586621682961544"><span class="hs-identifier hs-var">action</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-237"></span><span>  </span><span id="local-6989586621682961545"><span class="annot"><a href="#local-6989586621682961545"><span class="hs-identifier hs-var">inst</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">WasmInterpConfig
-&gt; (WasmInterpConfig -&gt; IO (ExtInterpInstance ()))
-&gt; ExtInterpStatusVar ()
-&gt; m (ExtInterpInstance ())
forall (m :: * -&gt; *) cfg d.
ExceptionMonad m =&gt;
cfg
-&gt; (cfg -&gt; IO (ExtInterpInstance d))
-&gt; ExtInterpStatusVar d
-&gt; m (ExtInterpInstance d)
</span><a href="GHC.Runtime.Interpreter.html#spawnInterpMaybe"><span class="hs-identifier hs-var">spawnInterpMaybe</span></a></span><span> </span><span class="annot"><span class="annottext">WasmInterpConfig
</span><a href="#local-6989586621682961542"><span class="hs-identifier hs-var">cfg</span></a></span><span> </span><span class="annot"><span class="annottext">WasmInterpConfig -&gt; IO (ExtInterpInstance ())
</span><a href="GHC.Runtime.Interpreter.Wasm.html#spawnWasmInterp"><span class="hs-identifier hs-var">spawnWasmInterp</span></a></span><span> </span><span class="annot"><span class="annottext">ExtInterpStatusVar ()
</span><a href="#local-6989586621682961543"><span class="hs-identifier hs-var">mstate</span></a></span><span>
</span><span id="line-238"></span><span>  </span><span class="annot"><a href="#local-6989586621682961544"><span class="hs-identifier hs-type">action</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682961545"><span class="hs-identifier hs-type">inst</span></a></span><span>
</span><span id="line-239"></span><span>
</span><span id="line-240"></span><span class="hs-comment">-- | Spawn an interpreter if not already running according to the status in the</span><span>
</span><span id="line-241"></span><span class="hs-comment">-- MVar. Update the status, free pending heap references, and return the</span><span>
</span><span id="line-242"></span><span class="hs-comment">-- interpreter instance.</span><span>
</span><span id="line-243"></span><span class="hs-comment">--</span><span>
</span><span id="line-244"></span><span class="hs-comment">-- This function is generic to support both the native external interpreter and</span><span>
</span><span id="line-245"></span><span class="hs-comment">-- the JS one.</span><span>
</span><span id="line-246"></span><span id="local-6989586621682961128"><span id="local-6989586621682961129"><span id="local-6989586621682961130"><span class="annot"><a href="GHC.Runtime.Interpreter.html#spawnInterpMaybe"><span class="hs-identifier hs-type">spawnInterpMaybe</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Utils.Exception.html#ExceptionMonad"><span class="hs-identifier hs-type">ExceptionMonad</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682961128"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="#local-6989586621682961129"><span class="hs-identifier hs-type">cfg</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621682961129"><span class="hs-identifier hs-type">cfg</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Runtime.Interpreter.Types.html#ExtInterpInstance"><span class="hs-identifier hs-type">ExtInterpInstance</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682961130"><span class="hs-identifier hs-type">d</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Runtime.Interpreter.Types.html#ExtInterpStatusVar"><span class="hs-identifier hs-type">ExtInterpStatusVar</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682961130"><span class="hs-identifier hs-type">d</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621682961128"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Runtime.Interpreter.Types.html#ExtInterpInstance"><span class="hs-identifier hs-type">ExtInterpInstance</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682961130"><span class="hs-identifier hs-type">d</span></a></span><span class="hs-special">)</span></span></span></span><span>
</span><span id="line-247"></span><span id="spawnInterpMaybe"><span class="annot"><span class="annottext">spawnInterpMaybe :: forall (m :: * -&gt; *) cfg d.
ExceptionMonad m =&gt;
cfg
-&gt; (cfg -&gt; IO (ExtInterpInstance d))
-&gt; ExtInterpStatusVar d
-&gt; m (ExtInterpInstance d)
</span><a href="GHC.Runtime.Interpreter.html#spawnInterpMaybe"><span class="hs-identifier hs-var hs-var">spawnInterpMaybe</span></a></span></span><span> </span><span id="local-6989586621682961567"><span class="annot"><span class="annottext">cfg
</span><a href="#local-6989586621682961567"><span class="hs-identifier hs-var">cfg</span></a></span></span><span> </span><span id="local-6989586621682961568"><span class="annot"><span class="annottext">cfg -&gt; IO (ExtInterpInstance d)
</span><a href="#local-6989586621682961568"><span class="hs-identifier hs-var">spawn</span></a></span></span><span> </span><span id="local-6989586621682961569"><span class="annot"><span class="annottext">ExtInterpStatusVar d
</span><a href="#local-6989586621682961569"><span class="hs-identifier hs-var">mstatus</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-248"></span><span>  </span><span id="local-6989586621682961570"><span class="annot"><a href="#local-6989586621682961570"><span class="hs-identifier hs-var">inst</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">IO (ExtInterpInstance d) -&gt; m (ExtInterpInstance d)
forall a. IO a -&gt; m a
forall (m :: * -&gt; *) a. MonadIO m =&gt; IO a -&gt; m a
</span><span class="hs-identifier hs-var">liftIO</span></span><span> </span><span class="annot"><span class="annottext">(IO (ExtInterpInstance d) -&gt; m (ExtInterpInstance d))
-&gt; IO (ExtInterpInstance d) -&gt; m (ExtInterpInstance d)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">ExtInterpStatusVar d
-&gt; (InterpStatus (ExtInterpInstance d)
    -&gt; IO (InterpStatus (ExtInterpInstance d), ExtInterpInstance d))
-&gt; IO (ExtInterpInstance d)
forall a b. MVar a -&gt; (a -&gt; IO (a, b)) -&gt; IO b
</span><span class="hs-identifier hs-var">modifyMVarMasked</span></span><span> </span><span class="annot"><span class="annottext">ExtInterpStatusVar d
</span><a href="#local-6989586621682961569"><span class="hs-identifier hs-var">mstatus</span></a></span><span> </span><span class="annot"><span class="annottext">((InterpStatus (ExtInterpInstance d)
  -&gt; IO (InterpStatus (ExtInterpInstance d), ExtInterpInstance d))
 -&gt; IO (ExtInterpInstance d))
-&gt; (InterpStatus (ExtInterpInstance d)
    -&gt; IO (InterpStatus (ExtInterpInstance d), ExtInterpInstance d))
-&gt; IO (ExtInterpInstance d)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-glyph">\</span><span class="hs-glyph">case</span><span>
</span><span id="line-249"></span><span>    </span><span class="hs-comment">-- start the external iserv process if we haven't done so yet</span><span>
</span><span id="line-250"></span><span>    </span><span class="annot"><span class="annottext">InterpStatus (ExtInterpInstance d)
</span><a href="GHC.Runtime.Interpreter.Types.html#InterpPending"><span class="hs-identifier hs-var">InterpPending</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-251"></span><span>      </span><span id="local-6989586621682961574"><span class="annot"><a href="#local-6989586621682961574"><span class="hs-identifier hs-var">inst</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">cfg -&gt; IO (ExtInterpInstance d)
</span><a href="#local-6989586621682961568"><span class="hs-identifier hs-var">spawn</span></a></span><span> </span><span class="annot"><span class="annottext">cfg
</span><a href="#local-6989586621682961567"><span class="hs-identifier hs-var">cfg</span></a></span><span>
</span><span id="line-252"></span><span>      </span><span class="annot"><span class="hs-identifier hs-type">pure</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Runtime.Interpreter.Types.html#InterpRunning"><span class="hs-identifier hs-type">InterpRunning</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682961574"><span class="hs-identifier hs-type">inst</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="#local-6989586621682961574"><span class="hs-identifier hs-type">inst</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-253"></span><span>
</span><span id="line-254"></span><span>    </span><span class="annot"><a href="GHC.Runtime.Interpreter.Types.html#InterpRunning"><span class="hs-identifier hs-type">InterpRunning</span></a></span><span> </span><span id="local-6989586621682961576"><span class="annot"><span class="annottext">ExtInterpInstance d
</span><a href="#local-6989586621682961576"><span class="hs-identifier hs-var">inst</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-255"></span><span>      </span><span class="annot"><span class="annottext">(InterpStatus (ExtInterpInstance d), ExtInterpInstance d)
-&gt; IO (InterpStatus (ExtInterpInstance d), ExtInterpInstance d)
forall a. a -&gt; IO a
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">pure</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ExtInterpInstance d -&gt; InterpStatus (ExtInterpInstance d)
forall inst. inst -&gt; InterpStatus inst
</span><a href="GHC.Runtime.Interpreter.Types.html#InterpRunning"><span class="hs-identifier hs-var">InterpRunning</span></a></span><span> </span><span class="annot"><span class="annottext">ExtInterpInstance d
</span><a href="#local-6989586621682961576"><span class="hs-identifier hs-var">inst</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">ExtInterpInstance d
</span><a href="#local-6989586621682961576"><span class="hs-identifier hs-var">inst</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-256"></span><span>
</span><span id="line-257"></span><span>  </span><span class="hs-comment">-- free any ForeignRef that have been garbage collected.</span><span>
</span><span id="line-258"></span><span>  </span><span id="local-6989586621682961577"><span class="annot"><a href="#local-6989586621682961577"><span class="hs-identifier hs-var">pending_frees</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="hs-identifier hs-type">liftIO</span></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">swapMVar</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Runtime.Interpreter.Types.html#instPendingFrees"><span class="hs-identifier hs-var">instPendingFrees</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682961570"><span class="hs-identifier hs-type">inst</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span>
</span><span id="line-259"></span><span>  </span><span class="annot"><span class="hs-identifier hs-type">liftIO</span></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">when</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">not</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">null</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621682961577"><span class="hs-identifier hs-type">pending_frees</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span>
</span><span id="line-260"></span><span>    </span><span class="annot"><a href="GHC.Runtime.Interpreter.Process.html#sendMessage"><span class="hs-identifier hs-type">sendMessage</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682961570"><span class="hs-identifier hs-type">inst</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../../ghci-9.12.2-bd10/src/GHCi.Message.html#FreeHValueRefs"><span class="hs-identifier hs-type">FreeHValueRefs</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682961577"><span class="hs-identifier hs-type">pending_frees</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-261"></span><span>
</span><span id="line-262"></span><span>  </span><span class="hs-comment">-- run the inner action</span><span>
</span><span id="line-263"></span><span>  </span><span class="annot"><span class="hs-identifier hs-type">pure</span></span><span> </span><span class="annot"><a href="#local-6989586621682961570"><span class="hs-identifier hs-type">inst</span></a></span><span>
</span><span id="line-264"></span><span>
</span><span id="line-265"></span><span id="local-6989586621682961155"><span id="local-6989586621682961157"><span class="annot"><a href="GHC.Runtime.Interpreter.html#withExtInterpMaybe"><span class="hs-identifier hs-type">withExtInterpMaybe</span></a></span><span>
</span><span id="line-266"></span><span>  </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Utils.Exception.html#ExceptionMonad"><span class="hs-identifier hs-type">ExceptionMonad</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682961155"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-267"></span><span>  </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="GHC.Runtime.Interpreter.Types.html#ExtInterp"><span class="hs-identifier hs-type">ExtInterp</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="hs-keyword">forall</span><span> </span><span id="local-6989586621682961156"><span class="annot"><a href="#local-6989586621682961156"><span class="hs-identifier hs-type">d</span></a></span></span><span class="hs-operator">.</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Maybe</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Runtime.Interpreter.Types.html#ExtInterpInstance"><span class="hs-identifier hs-type">ExtInterpInstance</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682961156"><span class="hs-identifier hs-type">d</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621682961155"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682961157"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621682961155"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682961157"><span class="hs-identifier hs-type">a</span></a></span></span></span><span>
</span><span id="line-268"></span><span id="withExtInterpMaybe"><span class="annot"><span class="annottext">withExtInterpMaybe :: forall (m :: * -&gt; *) a.
ExceptionMonad m =&gt;
ExtInterp -&gt; (forall d. Maybe (ExtInterpInstance d) -&gt; m a) -&gt; m a
</span><a href="GHC.Runtime.Interpreter.html#withExtInterpMaybe"><span class="hs-identifier hs-var hs-var">withExtInterpMaybe</span></a></span></span><span> </span><span id="local-6989586621682961589"><span class="annot"><span class="annottext">ExtInterp
</span><a href="#local-6989586621682961589"><span class="hs-identifier hs-var">ext</span></a></span></span><span> </span><span id="local-6989586621682961590"><span class="annot"><span class="annottext">forall d. Maybe (ExtInterpInstance d) -&gt; m a
</span><a href="#local-6989586621682961590"><span class="hs-identifier hs-var">action</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ExtInterp -&gt; (forall d. ExtInterpStatusVar d -&gt; m a) -&gt; m a
forall {k} (m :: k -&gt; *) (a :: k).
ExtInterp -&gt; (forall d. ExtInterpStatusVar d -&gt; m a) -&gt; m a
</span><a href="GHC.Runtime.Interpreter.html#withExtInterpStatus"><span class="hs-identifier hs-var">withExtInterpStatus</span></a></span><span> </span><span class="annot"><span class="annottext">ExtInterp
</span><a href="#local-6989586621682961589"><span class="hs-identifier hs-var">ext</span></a></span><span> </span><span class="annot"><span class="annottext">((forall d. ExtInterpStatusVar d -&gt; m a) -&gt; m a)
-&gt; (forall d. ExtInterpStatusVar d -&gt; m a) -&gt; m a
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-glyph">\</span><span id="local-6989586621682961593"><span class="annot"><span class="annottext">ExtInterpStatusVar d
</span><a href="#local-6989586621682961593"><span class="hs-identifier hs-var">mstate</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-269"></span><span>  </span><span class="annot"><span class="annottext">IO (InterpStatus (ExtInterpInstance d))
-&gt; m (InterpStatus (ExtInterpInstance d))
forall a. IO a -&gt; m a
forall (m :: * -&gt; *) a. MonadIO m =&gt; IO a -&gt; m a
</span><span class="hs-identifier hs-var">liftIO</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ExtInterpStatusVar d -&gt; IO (InterpStatus (ExtInterpInstance d))
forall a. MVar a -&gt; IO a
</span><span class="hs-identifier hs-var">readMVar</span></span><span> </span><span class="annot"><span class="annottext">ExtInterpStatusVar d
</span><a href="#local-6989586621682961593"><span class="hs-identifier hs-var">mstate</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">m (InterpStatus (ExtInterpInstance d))
-&gt; (InterpStatus (ExtInterpInstance d) -&gt; m a) -&gt; m a
forall a b. m a -&gt; (a -&gt; m b) -&gt; m b
forall (m :: * -&gt; *) a b. Monad m =&gt; m a -&gt; (a -&gt; m b) -&gt; m b
</span><span class="hs-operator hs-var">&gt;&gt;=</span></span><span> </span><span class="hs-glyph">\</span><span class="hs-glyph">case</span><span>
</span><span id="line-270"></span><span>    </span><span class="annot"><a href="GHC.Runtime.Interpreter.Types.html#InterpPending"><span class="hs-identifier hs-type">InterpPending</span></a></span><span> </span><span class="hs-special">{</span><span class="hs-special">}</span><span>   </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Maybe (ExtInterpInstance (ZonkAny 0)) -&gt; m a
forall d. Maybe (ExtInterpInstance d) -&gt; m a
</span><a href="#local-6989586621682961590"><span class="hs-identifier hs-var">action</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe (ExtInterpInstance (ZonkAny 0))
forall a. Maybe a
</span><span class="hs-identifier hs-var">Nothing</span></span><span> </span><span class="hs-comment">-- already shut down or never launched</span><span>
</span><span id="line-271"></span><span>    </span><span class="annot"><a href="GHC.Runtime.Interpreter.Types.html#InterpRunning"><span class="hs-identifier hs-type">InterpRunning</span></a></span><span> </span><span id="local-6989586621682961595"><span class="annot"><span class="annottext">ExtInterpInstance d
</span><a href="#local-6989586621682961595"><span class="hs-identifier hs-var">inst</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Maybe (ExtInterpInstance d) -&gt; m a
forall d. Maybe (ExtInterpInstance d) -&gt; m a
</span><a href="#local-6989586621682961590"><span class="hs-identifier hs-var">action</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ExtInterpInstance d -&gt; Maybe (ExtInterpInstance d)
forall a. a -&gt; Maybe a
</span><span class="hs-identifier hs-var">Just</span></span><span> </span><span class="annot"><span class="annottext">ExtInterpInstance d
</span><a href="#local-6989586621682961595"><span class="hs-identifier hs-var">inst</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-272"></span><span>
</span><span id="line-273"></span><span class="hs-comment">-- -----------------------------------------------------------------------------</span><span>
</span><span id="line-274"></span><span class="hs-comment">-- Wrappers around messages</span><span>
</span><span id="line-275"></span><span>
</span><span id="line-276"></span><span class="hs-comment">-- | Execute an action of type @IO [a]@, returning 'ForeignHValue's for</span><span>
</span><span id="line-277"></span><span class="hs-comment">-- each of the results.</span><span>
</span><span id="line-278"></span><span class="annot"><a href="GHC.Runtime.Interpreter.html#evalStmt"><span class="hs-identifier hs-type">evalStmt</span></a></span><span>
</span><span id="line-279"></span><span>  </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Runtime.Interpreter.Types.html#Interp"><span class="hs-identifier hs-type">Interp</span></a></span><span>
</span><span id="line-280"></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="../../ghci-9.12.2-bd10/src/GHCi.Message.html#EvalOpts"><span class="hs-identifier hs-type">EvalOpts</span></a></span><span>
</span><span id="line-281"></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="../../ghci-9.12.2-bd10/src/GHCi.Message.html#EvalExpr"><span class="hs-identifier hs-type">EvalExpr</span></a></span><span> </span><span class="annot"><a href="../../ghci-9.12.2-bd10/src/GHCi.RemoteTypes.html#ForeignHValue"><span class="hs-identifier hs-type">ForeignHValue</span></a></span><span>
</span><span id="line-282"></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../../ghci-9.12.2-bd10/src/GHCi.Message.html#EvalStatus_"><span class="hs-identifier hs-type">EvalStatus_</span></a></span><span> </span><span class="hs-special">[</span><span class="annot"><a href="../../ghci-9.12.2-bd10/src/GHCi.RemoteTypes.html#ForeignHValue"><span class="hs-identifier hs-type">ForeignHValue</span></a></span><span class="hs-special">]</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="../../ghci-9.12.2-bd10/src/GHCi.RemoteTypes.html#HValueRef"><span class="hs-identifier hs-type">HValueRef</span></a></span><span class="hs-special">]</span><span class="hs-special">)</span><span>
</span><span id="line-283"></span><span id="evalStmt"><span class="annot"><span class="annottext">evalStmt :: Interp
-&gt; EvalOpts
-&gt; EvalExpr ForeignHValue
-&gt; IO (EvalStatus_ [ForeignHValue] [HValueRef])
</span><a href="GHC.Runtime.Interpreter.html#evalStmt"><span class="hs-identifier hs-var hs-var">evalStmt</span></a></span></span><span> </span><span id="local-6989586621682961596"><span class="annot"><span class="annottext">Interp
</span><a href="#local-6989586621682961596"><span class="hs-identifier hs-var">interp</span></a></span></span><span> </span><span id="local-6989586621682961597"><span class="annot"><span class="annottext">EvalOpts
</span><a href="#local-6989586621682961597"><span class="hs-identifier hs-var">opts</span></a></span></span><span> </span><span id="local-6989586621682961598"><span class="annot"><span class="annottext">EvalExpr ForeignHValue
</span><a href="#local-6989586621682961598"><span class="hs-identifier hs-var">foreign_expr</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-284"></span><span>  </span><span id="local-6989586621682961599"><span class="annot"><a href="#local-6989586621682961599"><span class="hs-identifier hs-var">status</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">EvalExpr ForeignHValue
-&gt; (EvalExpr HValueRef -&gt; IO (EvalStatus_ [HValueRef] [HValueRef]))
-&gt; IO (EvalStatus_ [HValueRef] [HValueRef])
forall a.
EvalExpr ForeignHValue -&gt; (EvalExpr HValueRef -&gt; IO a) -&gt; IO a
</span><a href="#local-6989586621682961600"><span class="hs-identifier hs-var">withExpr</span></a></span><span> </span><span class="annot"><span class="annottext">EvalExpr ForeignHValue
</span><a href="#local-6989586621682961598"><span class="hs-identifier hs-var">foreign_expr</span></a></span><span> </span><span class="annot"><span class="annottext">((EvalExpr HValueRef -&gt; IO (EvalStatus_ [HValueRef] [HValueRef]))
 -&gt; IO (EvalStatus_ [HValueRef] [HValueRef]))
-&gt; (EvalExpr HValueRef -&gt; IO (EvalStatus_ [HValueRef] [HValueRef]))
-&gt; IO (EvalStatus_ [HValueRef] [HValueRef])
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-glyph">\</span><span id="local-6989586621682961601"><span class="annot"><span class="annottext">EvalExpr HValueRef
</span><a href="#local-6989586621682961601"><span class="hs-identifier hs-var">expr</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-285"></span><span>    </span><span class="annot"><span class="annottext">Interp
-&gt; Message (EvalStatus_ [HValueRef] [HValueRef])
-&gt; IO (EvalStatus_ [HValueRef] [HValueRef])
forall a. Binary a =&gt; Interp -&gt; Message a -&gt; IO a
</span><a href="GHC.Runtime.Interpreter.html#interpCmd"><span class="hs-identifier hs-var">interpCmd</span></a></span><span> </span><span class="annot"><span class="annottext">Interp
</span><a href="#local-6989586621682961596"><span class="hs-identifier hs-var">interp</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">EvalOpts
-&gt; EvalExpr HValueRef
-&gt; Message (EvalStatus_ [HValueRef] [HValueRef])
</span><a href="../../ghci-9.12.2-bd10/src/GHCi.Message.html#EvalStmt"><span class="hs-identifier hs-var">EvalStmt</span></a></span><span> </span><span class="annot"><span class="annottext">EvalOpts
</span><a href="#local-6989586621682961597"><span class="hs-identifier hs-var">opts</span></a></span><span> </span><span class="annot"><span class="annottext">EvalExpr HValueRef
</span><a href="#local-6989586621682961601"><span class="hs-identifier hs-var">expr</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-286"></span><span>  </span><span class="annot"><a href="GHC.Runtime.Interpreter.html#handleEvalStatus"><span class="hs-identifier hs-type">handleEvalStatus</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682961596"><span class="hs-identifier hs-type">interp</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682961599"><span class="hs-identifier hs-type">status</span></a></span><span>
</span><span id="line-287"></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-288"></span><span>  </span><span id="local-6989586621682961167"><span class="annot"><a href="#local-6989586621682961600"><span class="hs-identifier hs-type">withExpr</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="../../ghci-9.12.2-bd10/src/GHCi.Message.html#EvalExpr"><span class="hs-identifier hs-type">EvalExpr</span></a></span><span> </span><span class="annot"><a href="../../ghci-9.12.2-bd10/src/GHCi.RemoteTypes.html#ForeignHValue"><span class="hs-identifier hs-type">ForeignHValue</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../../ghci-9.12.2-bd10/src/GHCi.Message.html#EvalExpr"><span class="hs-identifier hs-type">EvalExpr</span></a></span><span> </span><span class="annot"><a href="../../ghci-9.12.2-bd10/src/GHCi.RemoteTypes.html#HValueRef"><span class="hs-identifier hs-type">HValueRef</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="annot"><a href="#local-6989586621682961167"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="annot"><a href="#local-6989586621682961167"><span class="hs-identifier hs-type">a</span></a></span></span><span>
</span><span id="line-289"></span><span>  </span><span id="local-6989586621682961600"><span class="annot"><span class="annottext">withExpr :: forall a.
EvalExpr ForeignHValue -&gt; (EvalExpr HValueRef -&gt; IO a) -&gt; IO a
</span><a href="#local-6989586621682961600"><span class="hs-identifier hs-var hs-var">withExpr</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../../ghci-9.12.2-bd10/src/GHCi.Message.html#EvalThis"><span class="hs-identifier hs-type">EvalThis</span></a></span><span> </span><span id="local-6989586621682961605"><span class="annot"><span class="annottext">ForeignHValue
</span><a href="#local-6989586621682961605"><span class="hs-identifier hs-var">fhv</span></a></span></span><span class="hs-special">)</span><span> </span><span id="local-6989586621682961606"><span class="annot"><span class="annottext">EvalExpr HValueRef -&gt; IO a
</span><a href="#local-6989586621682961606"><span class="hs-identifier hs-var">cont</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-290"></span><span>    </span><span class="annot"><span class="annottext">ForeignHValue -&gt; (HValueRef -&gt; IO a) -&gt; IO a
forall a b. ForeignRef a -&gt; (RemoteRef a -&gt; IO b) -&gt; IO b
</span><a href="../../ghci-9.12.2-bd10/src/GHCi.RemoteTypes.html#withForeignRef"><span class="hs-identifier hs-var">withForeignRef</span></a></span><span> </span><span class="annot"><span class="annottext">ForeignHValue
</span><a href="#local-6989586621682961605"><span class="hs-identifier hs-var">fhv</span></a></span><span> </span><span class="annot"><span class="annottext">((HValueRef -&gt; IO a) -&gt; IO a) -&gt; (HValueRef -&gt; IO a) -&gt; IO a
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-glyph">\</span><span id="local-6989586621682961608"><span class="annot"><span class="annottext">HValueRef
</span><a href="#local-6989586621682961608"><span class="hs-identifier hs-var">hvref</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">EvalExpr HValueRef -&gt; IO a
</span><a href="#local-6989586621682961606"><span class="hs-identifier hs-var">cont</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">HValueRef -&gt; EvalExpr HValueRef
forall a. a -&gt; EvalExpr a
</span><a href="../../ghci-9.12.2-bd10/src/GHCi.Message.html#EvalThis"><span class="hs-identifier hs-var">EvalThis</span></a></span><span> </span><span class="annot"><span class="annottext">HValueRef
</span><a href="#local-6989586621682961608"><span class="hs-identifier hs-var">hvref</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-291"></span><span>  </span><span class="annot"><a href="#local-6989586621682961600"><span class="hs-identifier hs-var">withExpr</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../../ghci-9.12.2-bd10/src/GHCi.Message.html#EvalApp"><span class="hs-identifier hs-type">EvalApp</span></a></span><span> </span><span id="local-6989586621682961610"><span class="annot"><span class="annottext">EvalExpr ForeignHValue
</span><a href="#local-6989586621682961610"><span class="hs-identifier hs-var">fl</span></a></span></span><span> </span><span id="local-6989586621682961611"><span class="annot"><span class="annottext">EvalExpr ForeignHValue
</span><a href="#local-6989586621682961611"><span class="hs-identifier hs-var">fr</span></a></span></span><span class="hs-special">)</span><span> </span><span id="local-6989586621682961612"><span class="annot"><span class="annottext">EvalExpr HValueRef -&gt; IO a
</span><a href="#local-6989586621682961612"><span class="hs-identifier hs-var">cont</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-292"></span><span>    </span><span class="annot"><span class="annottext">EvalExpr ForeignHValue -&gt; (EvalExpr HValueRef -&gt; IO a) -&gt; IO a
forall a.
EvalExpr ForeignHValue -&gt; (EvalExpr HValueRef -&gt; IO a) -&gt; IO a
</span><a href="#local-6989586621682961600"><span class="hs-identifier hs-var">withExpr</span></a></span><span> </span><span class="annot"><span class="annottext">EvalExpr ForeignHValue
</span><a href="#local-6989586621682961610"><span class="hs-identifier hs-var">fl</span></a></span><span> </span><span class="annot"><span class="annottext">((EvalExpr HValueRef -&gt; IO a) -&gt; IO a)
-&gt; (EvalExpr HValueRef -&gt; IO a) -&gt; IO a
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-glyph">\</span><span id="local-6989586621682961613"><span class="annot"><span class="annottext">EvalExpr HValueRef
</span><a href="#local-6989586621682961613"><span class="hs-identifier hs-var">fl'</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-293"></span><span>    </span><span class="annot"><span class="annottext">EvalExpr ForeignHValue -&gt; (EvalExpr HValueRef -&gt; IO a) -&gt; IO a
forall a.
EvalExpr ForeignHValue -&gt; (EvalExpr HValueRef -&gt; IO a) -&gt; IO a
</span><a href="#local-6989586621682961600"><span class="hs-identifier hs-var">withExpr</span></a></span><span> </span><span class="annot"><span class="annottext">EvalExpr ForeignHValue
</span><a href="#local-6989586621682961611"><span class="hs-identifier hs-var">fr</span></a></span><span> </span><span class="annot"><span class="annottext">((EvalExpr HValueRef -&gt; IO a) -&gt; IO a)
-&gt; (EvalExpr HValueRef -&gt; IO a) -&gt; IO a
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-glyph">\</span><span id="local-6989586621682961614"><span class="annot"><span class="annottext">EvalExpr HValueRef
</span><a href="#local-6989586621682961614"><span class="hs-identifier hs-var">fr'</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-294"></span><span>    </span><span class="annot"><span class="annottext">EvalExpr HValueRef -&gt; IO a
</span><a href="#local-6989586621682961612"><span class="hs-identifier hs-var">cont</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">EvalExpr HValueRef -&gt; EvalExpr HValueRef -&gt; EvalExpr HValueRef
forall a. EvalExpr a -&gt; EvalExpr a -&gt; EvalExpr a
</span><a href="../../ghci-9.12.2-bd10/src/GHCi.Message.html#EvalApp"><span class="hs-identifier hs-var">EvalApp</span></a></span><span> </span><span class="annot"><span class="annottext">EvalExpr HValueRef
</span><a href="#local-6989586621682961613"><span class="hs-identifier hs-var">fl'</span></a></span><span> </span><span class="annot"><span class="annottext">EvalExpr HValueRef
</span><a href="#local-6989586621682961614"><span class="hs-identifier hs-var">fr'</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-295"></span><span>
</span><span id="line-296"></span><span class="annot"><a href="GHC.Runtime.Interpreter.html#resumeStmt"><span class="hs-identifier hs-type">resumeStmt</span></a></span><span>
</span><span id="line-297"></span><span>  </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Runtime.Interpreter.Types.html#Interp"><span class="hs-identifier hs-type">Interp</span></a></span><span>
</span><span id="line-298"></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="../../ghci-9.12.2-bd10/src/GHCi.Message.html#EvalOpts"><span class="hs-identifier hs-type">EvalOpts</span></a></span><span>
</span><span id="line-299"></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="../../ghci-9.12.2-bd10/src/GHCi.RemoteTypes.html#ForeignRef"><span class="hs-identifier hs-type">ForeignRef</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../../ghci-9.12.2-bd10/src/GHCi.Message.html#ResumeContext"><span class="hs-identifier hs-type">ResumeContext</span></a></span><span> </span><span class="hs-special">[</span><span class="annot"><a href="../../ghci-9.12.2-bd10/src/GHCi.RemoteTypes.html#HValueRef"><span class="hs-identifier hs-type">HValueRef</span></a></span><span class="hs-special">]</span><span class="hs-special">)</span><span>
</span><span id="line-300"></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../../ghci-9.12.2-bd10/src/GHCi.Message.html#EvalStatus_"><span class="hs-identifier hs-type">EvalStatus_</span></a></span><span> </span><span class="hs-special">[</span><span class="annot"><a href="../../ghci-9.12.2-bd10/src/GHCi.RemoteTypes.html#ForeignHValue"><span class="hs-identifier hs-type">ForeignHValue</span></a></span><span class="hs-special">]</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="../../ghci-9.12.2-bd10/src/GHCi.RemoteTypes.html#HValueRef"><span class="hs-identifier hs-type">HValueRef</span></a></span><span class="hs-special">]</span><span class="hs-special">)</span><span>
</span><span id="line-301"></span><span id="resumeStmt"><span class="annot"><span class="annottext">resumeStmt :: Interp
-&gt; EvalOpts
-&gt; ForeignRef (ResumeContext [HValueRef])
-&gt; IO (EvalStatus_ [ForeignHValue] [HValueRef])
</span><a href="GHC.Runtime.Interpreter.html#resumeStmt"><span class="hs-identifier hs-var hs-var">resumeStmt</span></a></span></span><span> </span><span id="local-6989586621682961615"><span class="annot"><span class="annottext">Interp
</span><a href="#local-6989586621682961615"><span class="hs-identifier hs-var">interp</span></a></span></span><span> </span><span id="local-6989586621682961616"><span class="annot"><span class="annottext">EvalOpts
</span><a href="#local-6989586621682961616"><span class="hs-identifier hs-var">opts</span></a></span></span><span> </span><span id="local-6989586621682961617"><span class="annot"><span class="annottext">ForeignRef (ResumeContext [HValueRef])
</span><a href="#local-6989586621682961617"><span class="hs-identifier hs-var">resume_ctxt</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-302"></span><span>  </span><span id="local-6989586621682961618"><span class="annot"><a href="#local-6989586621682961618"><span class="hs-identifier hs-var">status</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">ForeignRef (ResumeContext [HValueRef])
-&gt; (RemoteRef (ResumeContext [HValueRef])
    -&gt; IO (EvalStatus_ [HValueRef] [HValueRef]))
-&gt; IO (EvalStatus_ [HValueRef] [HValueRef])
forall a b. ForeignRef a -&gt; (RemoteRef a -&gt; IO b) -&gt; IO b
</span><a href="../../ghci-9.12.2-bd10/src/GHCi.RemoteTypes.html#withForeignRef"><span class="hs-identifier hs-var">withForeignRef</span></a></span><span> </span><span class="annot"><span class="annottext">ForeignRef (ResumeContext [HValueRef])
</span><a href="#local-6989586621682961617"><span class="hs-identifier hs-var">resume_ctxt</span></a></span><span> </span><span class="annot"><span class="annottext">((RemoteRef (ResumeContext [HValueRef])
  -&gt; IO (EvalStatus_ [HValueRef] [HValueRef]))
 -&gt; IO (EvalStatus_ [HValueRef] [HValueRef]))
-&gt; (RemoteRef (ResumeContext [HValueRef])
    -&gt; IO (EvalStatus_ [HValueRef] [HValueRef]))
-&gt; IO (EvalStatus_ [HValueRef] [HValueRef])
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-glyph">\</span><span id="local-6989586621682961619"><span class="annot"><span class="annottext">RemoteRef (ResumeContext [HValueRef])
</span><a href="#local-6989586621682961619"><span class="hs-identifier hs-var">rhv</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-303"></span><span>    </span><span class="annot"><span class="annottext">Interp
-&gt; Message (EvalStatus_ [HValueRef] [HValueRef])
-&gt; IO (EvalStatus_ [HValueRef] [HValueRef])
forall a. Binary a =&gt; Interp -&gt; Message a -&gt; IO a
</span><a href="GHC.Runtime.Interpreter.html#interpCmd"><span class="hs-identifier hs-var">interpCmd</span></a></span><span> </span><span class="annot"><span class="annottext">Interp
</span><a href="#local-6989586621682961615"><span class="hs-identifier hs-var">interp</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">EvalOpts
-&gt; RemoteRef (ResumeContext [HValueRef])
-&gt; Message (EvalStatus_ [HValueRef] [HValueRef])
</span><a href="../../ghci-9.12.2-bd10/src/GHCi.Message.html#ResumeStmt"><span class="hs-identifier hs-var">ResumeStmt</span></a></span><span> </span><span class="annot"><span class="annottext">EvalOpts
</span><a href="#local-6989586621682961616"><span class="hs-identifier hs-var">opts</span></a></span><span> </span><span class="annot"><span class="annottext">RemoteRef (ResumeContext [HValueRef])
</span><a href="#local-6989586621682961619"><span class="hs-identifier hs-var">rhv</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-304"></span><span>  </span><span class="annot"><a href="GHC.Runtime.Interpreter.html#handleEvalStatus"><span class="hs-identifier hs-type">handleEvalStatus</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682961615"><span class="hs-identifier hs-type">interp</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682961618"><span class="hs-identifier hs-type">status</span></a></span><span>
</span><span id="line-305"></span><span>
</span><span id="line-306"></span><span class="annot"><a href="GHC.Runtime.Interpreter.html#abandonStmt"><span class="hs-identifier hs-type">abandonStmt</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Runtime.Interpreter.Types.html#Interp"><span class="hs-identifier hs-type">Interp</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="../../ghci-9.12.2-bd10/src/GHCi.RemoteTypes.html#ForeignRef"><span class="hs-identifier hs-type">ForeignRef</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../../ghci-9.12.2-bd10/src/GHCi.Message.html#ResumeContext"><span class="hs-identifier hs-type">ResumeContext</span></a></span><span> </span><span class="hs-special">[</span><span class="annot"><a href="../../ghci-9.12.2-bd10/src/GHCi.RemoteTypes.html#HValueRef"><span class="hs-identifier hs-type">HValueRef</span></a></span><span class="hs-special">]</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-307"></span><span id="abandonStmt"><span class="annot"><span class="annottext">abandonStmt :: Interp -&gt; ForeignRef (ResumeContext [HValueRef]) -&gt; IO ()
</span><a href="GHC.Runtime.Interpreter.html#abandonStmt"><span class="hs-identifier hs-var hs-var">abandonStmt</span></a></span></span><span> </span><span id="local-6989586621682961621"><span class="annot"><span class="annottext">Interp
</span><a href="#local-6989586621682961621"><span class="hs-identifier hs-var">interp</span></a></span></span><span> </span><span id="local-6989586621682961622"><span class="annot"><span class="annottext">ForeignRef (ResumeContext [HValueRef])
</span><a href="#local-6989586621682961622"><span class="hs-identifier hs-var">resume_ctxt</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-308"></span><span>  </span><span class="annot"><span class="annottext">ForeignRef (ResumeContext [HValueRef])
-&gt; (RemoteRef (ResumeContext [HValueRef]) -&gt; IO ()) -&gt; IO ()
forall a b. ForeignRef a -&gt; (RemoteRef a -&gt; IO b) -&gt; IO b
</span><a href="../../ghci-9.12.2-bd10/src/GHCi.RemoteTypes.html#withForeignRef"><span class="hs-identifier hs-var">withForeignRef</span></a></span><span> </span><span class="annot"><span class="annottext">ForeignRef (ResumeContext [HValueRef])
</span><a href="#local-6989586621682961622"><span class="hs-identifier hs-var">resume_ctxt</span></a></span><span> </span><span class="annot"><span class="annottext">((RemoteRef (ResumeContext [HValueRef]) -&gt; IO ()) -&gt; IO ())
-&gt; (RemoteRef (ResumeContext [HValueRef]) -&gt; IO ()) -&gt; IO ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-glyph">\</span><span id="local-6989586621682961623"><span class="annot"><span class="annottext">RemoteRef (ResumeContext [HValueRef])
</span><a href="#local-6989586621682961623"><span class="hs-identifier hs-var">rhv</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-309"></span><span>    </span><span class="annot"><span class="annottext">Interp -&gt; Message () -&gt; IO ()
forall a. Binary a =&gt; Interp -&gt; Message a -&gt; IO a
</span><a href="GHC.Runtime.Interpreter.html#interpCmd"><span class="hs-identifier hs-var">interpCmd</span></a></span><span> </span><span class="annot"><span class="annottext">Interp
</span><a href="#local-6989586621682961621"><span class="hs-identifier hs-var">interp</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">RemoteRef (ResumeContext [HValueRef]) -&gt; Message ()
</span><a href="../../ghci-9.12.2-bd10/src/GHCi.Message.html#AbandonStmt"><span class="hs-identifier hs-var">AbandonStmt</span></a></span><span> </span><span class="annot"><span class="annottext">RemoteRef (ResumeContext [HValueRef])
</span><a href="#local-6989586621682961623"><span class="hs-identifier hs-var">rhv</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-310"></span><span>
</span><span id="line-311"></span><span class="annot"><a href="GHC.Runtime.Interpreter.html#handleEvalStatus"><span class="hs-identifier hs-type">handleEvalStatus</span></a></span><span>
</span><span id="line-312"></span><span>  </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Runtime.Interpreter.Types.html#Interp"><span class="hs-identifier hs-type">Interp</span></a></span><span>
</span><span id="line-313"></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="../../ghci-9.12.2-bd10/src/GHCi.Message.html#EvalStatus"><span class="hs-identifier hs-type">EvalStatus</span></a></span><span> </span><span class="hs-special">[</span><span class="annot"><a href="../../ghci-9.12.2-bd10/src/GHCi.RemoteTypes.html#HValueRef"><span class="hs-identifier hs-type">HValueRef</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-314"></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../../ghci-9.12.2-bd10/src/GHCi.Message.html#EvalStatus_"><span class="hs-identifier hs-type">EvalStatus_</span></a></span><span> </span><span class="hs-special">[</span><span class="annot"><a href="../../ghci-9.12.2-bd10/src/GHCi.RemoteTypes.html#ForeignHValue"><span class="hs-identifier hs-type">ForeignHValue</span></a></span><span class="hs-special">]</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="../../ghci-9.12.2-bd10/src/GHCi.RemoteTypes.html#HValueRef"><span class="hs-identifier hs-type">HValueRef</span></a></span><span class="hs-special">]</span><span class="hs-special">)</span><span>
</span><span id="line-315"></span><span id="handleEvalStatus"><span class="annot"><span class="annottext">handleEvalStatus :: Interp
-&gt; EvalStatus_ [HValueRef] [HValueRef]
-&gt; IO (EvalStatus_ [ForeignHValue] [HValueRef])
</span><a href="GHC.Runtime.Interpreter.html#handleEvalStatus"><span class="hs-identifier hs-var hs-var">handleEvalStatus</span></a></span></span><span> </span><span id="local-6989586621682961625"><span class="annot"><span class="annottext">Interp
</span><a href="#local-6989586621682961625"><span class="hs-identifier hs-var">interp</span></a></span></span><span> </span><span id="local-6989586621682961626"><span class="annot"><span class="annottext">EvalStatus_ [HValueRef] [HValueRef]
</span><a href="#local-6989586621682961626"><span class="hs-identifier hs-var">status</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-316"></span><span>  </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">EvalStatus_ [HValueRef] [HValueRef]
</span><a href="#local-6989586621682961626"><span class="hs-identifier hs-var">status</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-317"></span><span>    </span><span class="annot"><a href="../../ghci-9.12.2-bd10/src/GHCi.Message.html#EvalBreak"><span class="hs-identifier hs-type">EvalBreak</span></a></span><span> </span><span id="local-6989586621682961628"><span class="annot"><span class="annottext">HValueRef
</span><a href="#local-6989586621682961628"><span class="hs-identifier hs-var">a</span></a></span></span><span> </span><span id="local-6989586621682961629"><span class="annot"><span class="annottext">Maybe EvalBreakpoint
</span><a href="#local-6989586621682961629"><span class="hs-identifier hs-var">b</span></a></span></span><span> </span><span id="local-6989586621682961630"><span class="annot"><span class="annottext">RemoteRef (ResumeContext [HValueRef])
</span><a href="#local-6989586621682961630"><span class="hs-identifier hs-var">c</span></a></span></span><span> </span><span id="local-6989586621682961631"><span class="annot"><span class="annottext">RemotePtr CostCentreStack
</span><a href="#local-6989586621682961631"><span class="hs-identifier hs-var">d</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">EvalStatus_ [ForeignHValue] [HValueRef]
-&gt; IO (EvalStatus_ [ForeignHValue] [HValueRef])
forall a. a -&gt; IO a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">HValueRef
-&gt; Maybe EvalBreakpoint
-&gt; RemoteRef (ResumeContext [HValueRef])
-&gt; RemotePtr CostCentreStack
-&gt; EvalStatus_ [ForeignHValue] [HValueRef]
forall a b.
HValueRef
-&gt; Maybe EvalBreakpoint
-&gt; RemoteRef (ResumeContext b)
-&gt; RemotePtr CostCentreStack
-&gt; EvalStatus_ a b
</span><a href="../../ghci-9.12.2-bd10/src/GHCi.Message.html#EvalBreak"><span class="hs-identifier hs-var">EvalBreak</span></a></span><span> </span><span class="annot"><span class="annottext">HValueRef
</span><a href="#local-6989586621682961628"><span class="hs-identifier hs-var">a</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe EvalBreakpoint
</span><a href="#local-6989586621682961629"><span class="hs-identifier hs-var">b</span></a></span><span> </span><span class="annot"><span class="annottext">RemoteRef (ResumeContext [HValueRef])
</span><a href="#local-6989586621682961630"><span class="hs-identifier hs-var">c</span></a></span><span> </span><span class="annot"><span class="annottext">RemotePtr CostCentreStack
</span><a href="#local-6989586621682961631"><span class="hs-identifier hs-var">d</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-318"></span><span>    </span><span class="annot"><a href="../../ghci-9.12.2-bd10/src/GHCi.Message.html#EvalComplete"><span class="hs-identifier hs-type">EvalComplete</span></a></span><span> </span><span id="local-6989586621682961633"><span class="annot"><span class="annottext">Word64
</span><a href="#local-6989586621682961633"><span class="hs-identifier hs-var">alloc</span></a></span></span><span> </span><span id="local-6989586621682961634"><span class="annot"><span class="annottext">EvalResult [HValueRef]
</span><a href="#local-6989586621682961634"><span class="hs-identifier hs-var">res</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-319"></span><span>      </span><span class="annot"><span class="annottext">Word64
-&gt; EvalResult [ForeignHValue]
-&gt; EvalStatus_ [ForeignHValue] [HValueRef]
forall a b. Word64 -&gt; EvalResult a -&gt; EvalStatus_ a b
</span><a href="../../ghci-9.12.2-bd10/src/GHCi.Message.html#EvalComplete"><span class="hs-identifier hs-var">EvalComplete</span></a></span><span> </span><span class="annot"><span class="annottext">Word64
</span><a href="#local-6989586621682961633"><span class="hs-identifier hs-var">alloc</span></a></span><span> </span><span class="annot"><span class="annottext">(EvalResult [ForeignHValue]
 -&gt; EvalStatus_ [ForeignHValue] [HValueRef])
-&gt; IO (EvalResult [ForeignHValue])
-&gt; IO (EvalStatus_ [ForeignHValue] [HValueRef])
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="annot"><span class="annottext">EvalResult [HValueRef] -&gt; IO (EvalResult [ForeignHValue])
</span><a href="#local-6989586621682961636"><span class="hs-identifier hs-var">addFinalizer</span></a></span><span> </span><span class="annot"><span class="annottext">EvalResult [HValueRef]
</span><a href="#local-6989586621682961634"><span class="hs-identifier hs-var">res</span></a></span><span>
</span><span id="line-320"></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-321"></span><span>  </span><span id="local-6989586621682961636"><span class="annot"><span class="annottext">addFinalizer :: EvalResult [HValueRef] -&gt; IO (EvalResult [ForeignHValue])
</span><a href="#local-6989586621682961636"><span class="hs-identifier hs-var hs-var">addFinalizer</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../../ghci-9.12.2-bd10/src/GHCi.Message.html#EvalException"><span class="hs-identifier hs-type">EvalException</span></a></span><span> </span><span id="local-6989586621682961638"><span class="annot"><span class="annottext">SerializableException
</span><a href="#local-6989586621682961638"><span class="hs-identifier hs-var">e</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">EvalResult [ForeignHValue] -&gt; IO (EvalResult [ForeignHValue])
forall a. a -&gt; IO a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">SerializableException -&gt; EvalResult [ForeignHValue]
forall a. SerializableException -&gt; EvalResult a
</span><a href="../../ghci-9.12.2-bd10/src/GHCi.Message.html#EvalException"><span class="hs-identifier hs-var">EvalException</span></a></span><span> </span><span class="annot"><span class="annottext">SerializableException
</span><a href="#local-6989586621682961638"><span class="hs-identifier hs-var">e</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-322"></span><span>  </span><span class="annot"><a href="#local-6989586621682961636"><span class="hs-identifier hs-var">addFinalizer</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../../ghci-9.12.2-bd10/src/GHCi.Message.html#EvalSuccess"><span class="hs-identifier hs-type">EvalSuccess</span></a></span><span> </span><span id="local-6989586621682961640"><span class="annot"><span class="annottext">[HValueRef]
</span><a href="#local-6989586621682961640"><span class="hs-identifier hs-var">rs</span></a></span></span><span class="hs-special">)</span><span>  </span><span class="hs-glyph">=</span><span>
</span><span id="line-323"></span><span>    </span><span class="annot"><span class="annottext">[ForeignHValue] -&gt; EvalResult [ForeignHValue]
forall a. a -&gt; EvalResult a
</span><a href="../../ghci-9.12.2-bd10/src/GHCi.Message.html#EvalSuccess"><span class="hs-identifier hs-var">EvalSuccess</span></a></span><span> </span><span class="annot"><span class="annottext">([ForeignHValue] -&gt; EvalResult [ForeignHValue])
-&gt; IO [ForeignHValue] -&gt; IO (EvalResult [ForeignHValue])
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="annot"><span class="annottext">(HValueRef -&gt; IO ForeignHValue)
-&gt; [HValueRef] -&gt; IO [ForeignHValue]
forall (t :: * -&gt; *) (m :: * -&gt; *) a b.
(Traversable t, Monad m) =&gt;
(a -&gt; m b) -&gt; t a -&gt; m (t b)
forall (m :: * -&gt; *) a b. Monad m =&gt; (a -&gt; m b) -&gt; [a] -&gt; m [b]
</span><span class="hs-identifier hs-var">mapM</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Interp -&gt; HValueRef -&gt; IO ForeignHValue
forall a. Interp -&gt; RemoteRef a -&gt; IO (ForeignRef a)
</span><a href="GHC.Runtime.Interpreter.html#mkFinalizedHValue"><span class="hs-identifier hs-var">mkFinalizedHValue</span></a></span><span> </span><span class="annot"><span class="annottext">Interp
</span><a href="#local-6989586621682961625"><span class="hs-identifier hs-var">interp</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[HValueRef]
</span><a href="#local-6989586621682961640"><span class="hs-identifier hs-var">rs</span></a></span><span>
</span><span id="line-324"></span><span>
</span><span id="line-325"></span><span class="annot"><span class="hs-comment">-- | Execute an action of type @IO ()@</span></span><span>
</span><span id="line-326"></span><span class="annot"><a href="GHC.Runtime.Interpreter.html#evalIO"><span class="hs-identifier hs-type">evalIO</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Runtime.Interpreter.Types.html#Interp"><span class="hs-identifier hs-type">Interp</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="../../ghci-9.12.2-bd10/src/GHCi.RemoteTypes.html#ForeignHValue"><span class="hs-identifier hs-type">ForeignHValue</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-327"></span><span id="evalIO"><span class="annot"><span class="annottext">evalIO :: Interp -&gt; ForeignHValue -&gt; IO ()
</span><a href="GHC.Runtime.Interpreter.html#evalIO"><span class="hs-identifier hs-var hs-var">evalIO</span></a></span></span><span> </span><span id="local-6989586621682961642"><span class="annot"><span class="annottext">Interp
</span><a href="#local-6989586621682961642"><span class="hs-identifier hs-var">interp</span></a></span></span><span> </span><span id="local-6989586621682961643"><span class="annot"><span class="annottext">ForeignHValue
</span><a href="#local-6989586621682961643"><span class="hs-identifier hs-var">fhv</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-328"></span><span>  </span><span class="annot"><span class="annottext">IO () -&gt; IO ()
forall a. IO a -&gt; IO a
forall (m :: * -&gt; *) a. MonadIO m =&gt; IO a -&gt; m a
</span><span class="hs-identifier hs-var">liftIO</span></span><span> </span><span class="annot"><span class="annottext">(IO () -&gt; IO ()) -&gt; IO () -&gt; IO ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">ForeignHValue -&gt; (HValueRef -&gt; IO ()) -&gt; IO ()
forall a b. ForeignRef a -&gt; (RemoteRef a -&gt; IO b) -&gt; IO b
</span><a href="../../ghci-9.12.2-bd10/src/GHCi.RemoteTypes.html#withForeignRef"><span class="hs-identifier hs-var">withForeignRef</span></a></span><span> </span><span class="annot"><span class="annottext">ForeignHValue
</span><a href="#local-6989586621682961643"><span class="hs-identifier hs-var">fhv</span></a></span><span> </span><span class="annot"><span class="annottext">((HValueRef -&gt; IO ()) -&gt; IO ()) -&gt; (HValueRef -&gt; IO ()) -&gt; IO ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-glyph">\</span><span id="local-6989586621682961644"><span class="annot"><span class="annottext">HValueRef
</span><a href="#local-6989586621682961644"><span class="hs-identifier hs-var">fhv</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-329"></span><span>    </span><span class="annot"><span class="annottext">Interp -&gt; Message (EvalResult ()) -&gt; IO (EvalResult ())
forall a. Binary a =&gt; Interp -&gt; Message a -&gt; IO a
</span><a href="GHC.Runtime.Interpreter.html#interpCmd"><span class="hs-identifier hs-var">interpCmd</span></a></span><span> </span><span class="annot"><span class="annottext">Interp
</span><a href="#local-6989586621682961642"><span class="hs-identifier hs-var">interp</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">HValueRef -&gt; Message (EvalResult ())
</span><a href="../../ghci-9.12.2-bd10/src/GHCi.Message.html#EvalIO"><span class="hs-identifier hs-var">EvalIO</span></a></span><span> </span><span class="annot"><span class="annottext">HValueRef
</span><a href="#local-6989586621682961644"><span class="hs-identifier hs-var">fhv</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">IO (EvalResult ()) -&gt; (EvalResult () -&gt; IO ()) -&gt; IO ()
forall a b. IO a -&gt; (a -&gt; IO b) -&gt; IO b
forall (m :: * -&gt; *) a b. Monad m =&gt; m a -&gt; (a -&gt; m b) -&gt; m b
</span><span class="hs-operator hs-var">&gt;&gt;=</span></span><span> </span><span class="annot"><span class="annottext">EvalResult () -&gt; IO ()
forall a. EvalResult a -&gt; IO a
</span><a href="GHC.Runtime.Interpreter.html#fromEvalResult"><span class="hs-identifier hs-var">fromEvalResult</span></a></span><span>
</span><span id="line-330"></span><span>
</span><span id="line-331"></span><span class="annot"><span class="hs-comment">-- | Execute an action of type @IO String@</span></span><span>
</span><span id="line-332"></span><span class="annot"><a href="GHC.Runtime.Interpreter.html#evalString"><span class="hs-identifier hs-type">evalString</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Runtime.Interpreter.Types.html#Interp"><span class="hs-identifier hs-type">Interp</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="../../ghci-9.12.2-bd10/src/GHCi.RemoteTypes.html#ForeignHValue"><span class="hs-identifier hs-type">ForeignHValue</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">String</span></span><span>
</span><span id="line-333"></span><span id="evalString"><span class="annot"><span class="annottext">evalString :: Interp -&gt; ForeignHValue -&gt; IO String
</span><a href="GHC.Runtime.Interpreter.html#evalString"><span class="hs-identifier hs-var hs-var">evalString</span></a></span></span><span> </span><span id="local-6989586621682961646"><span class="annot"><span class="annottext">Interp
</span><a href="#local-6989586621682961646"><span class="hs-identifier hs-var">interp</span></a></span></span><span> </span><span id="local-6989586621682961647"><span class="annot"><span class="annottext">ForeignHValue
</span><a href="#local-6989586621682961647"><span class="hs-identifier hs-var">fhv</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-334"></span><span>  </span><span class="annot"><span class="annottext">IO String -&gt; IO String
forall a. IO a -&gt; IO a
forall (m :: * -&gt; *) a. MonadIO m =&gt; IO a -&gt; m a
</span><span class="hs-identifier hs-var">liftIO</span></span><span> </span><span class="annot"><span class="annottext">(IO String -&gt; IO String) -&gt; IO String -&gt; IO String
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">ForeignHValue -&gt; (HValueRef -&gt; IO String) -&gt; IO String
forall a b. ForeignRef a -&gt; (RemoteRef a -&gt; IO b) -&gt; IO b
</span><a href="../../ghci-9.12.2-bd10/src/GHCi.RemoteTypes.html#withForeignRef"><span class="hs-identifier hs-var">withForeignRef</span></a></span><span> </span><span class="annot"><span class="annottext">ForeignHValue
</span><a href="#local-6989586621682961647"><span class="hs-identifier hs-var">fhv</span></a></span><span> </span><span class="annot"><span class="annottext">((HValueRef -&gt; IO String) -&gt; IO String)
-&gt; (HValueRef -&gt; IO String) -&gt; IO String
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-glyph">\</span><span id="local-6989586621682961648"><span class="annot"><span class="annottext">HValueRef
</span><a href="#local-6989586621682961648"><span class="hs-identifier hs-var">fhv</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-335"></span><span>    </span><span class="annot"><span class="annottext">Interp -&gt; Message (EvalResult String) -&gt; IO (EvalResult String)
forall a. Binary a =&gt; Interp -&gt; Message a -&gt; IO a
</span><a href="GHC.Runtime.Interpreter.html#interpCmd"><span class="hs-identifier hs-var">interpCmd</span></a></span><span> </span><span class="annot"><span class="annottext">Interp
</span><a href="#local-6989586621682961646"><span class="hs-identifier hs-var">interp</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">HValueRef -&gt; Message (EvalResult String)
</span><a href="../../ghci-9.12.2-bd10/src/GHCi.Message.html#EvalString"><span class="hs-identifier hs-var">EvalString</span></a></span><span> </span><span class="annot"><span class="annottext">HValueRef
</span><a href="#local-6989586621682961648"><span class="hs-identifier hs-var">fhv</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">IO (EvalResult String)
-&gt; (EvalResult String -&gt; IO String) -&gt; IO String
forall a b. IO a -&gt; (a -&gt; IO b) -&gt; IO b
forall (m :: * -&gt; *) a b. Monad m =&gt; m a -&gt; (a -&gt; m b) -&gt; m b
</span><span class="hs-operator hs-var">&gt;&gt;=</span></span><span> </span><span class="annot"><span class="annottext">EvalResult String -&gt; IO String
forall a. EvalResult a -&gt; IO a
</span><a href="GHC.Runtime.Interpreter.html#fromEvalResult"><span class="hs-identifier hs-var">fromEvalResult</span></a></span><span>
</span><span id="line-336"></span><span>
</span><span id="line-337"></span><span class="annot"><span class="hs-comment">-- | Execute an action of type @String -&gt; IO String@</span></span><span>
</span><span id="line-338"></span><span class="annot"><a href="GHC.Runtime.Interpreter.html#evalStringToIOString"><span class="hs-identifier hs-type">evalStringToIOString</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Runtime.Interpreter.Types.html#Interp"><span class="hs-identifier hs-type">Interp</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="../../ghci-9.12.2-bd10/src/GHCi.RemoteTypes.html#ForeignHValue"><span class="hs-identifier hs-type">ForeignHValue</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">String</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">String</span></span><span>
</span><span id="line-339"></span><span id="evalStringToIOString"><span class="annot"><span class="annottext">evalStringToIOString :: Interp -&gt; ForeignHValue -&gt; String -&gt; IO String
</span><a href="GHC.Runtime.Interpreter.html#evalStringToIOString"><span class="hs-identifier hs-var hs-var">evalStringToIOString</span></a></span></span><span> </span><span id="local-6989586621682961650"><span class="annot"><span class="annottext">Interp
</span><a href="#local-6989586621682961650"><span class="hs-identifier hs-var">interp</span></a></span></span><span> </span><span id="local-6989586621682961651"><span class="annot"><span class="annottext">ForeignHValue
</span><a href="#local-6989586621682961651"><span class="hs-identifier hs-var">fhv</span></a></span></span><span> </span><span id="local-6989586621682961652"><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621682961652"><span class="hs-identifier hs-var">str</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-340"></span><span>  </span><span class="annot"><span class="annottext">IO String -&gt; IO String
forall a. IO a -&gt; IO a
forall (m :: * -&gt; *) a. MonadIO m =&gt; IO a -&gt; m a
</span><span class="hs-identifier hs-var">liftIO</span></span><span> </span><span class="annot"><span class="annottext">(IO String -&gt; IO String) -&gt; IO String -&gt; IO String
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">ForeignHValue -&gt; (HValueRef -&gt; IO String) -&gt; IO String
forall a b. ForeignRef a -&gt; (RemoteRef a -&gt; IO b) -&gt; IO b
</span><a href="../../ghci-9.12.2-bd10/src/GHCi.RemoteTypes.html#withForeignRef"><span class="hs-identifier hs-var">withForeignRef</span></a></span><span> </span><span class="annot"><span class="annottext">ForeignHValue
</span><a href="#local-6989586621682961651"><span class="hs-identifier hs-var">fhv</span></a></span><span> </span><span class="annot"><span class="annottext">((HValueRef -&gt; IO String) -&gt; IO String)
-&gt; (HValueRef -&gt; IO String) -&gt; IO String
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-glyph">\</span><span id="local-6989586621682961653"><span class="annot"><span class="annottext">HValueRef
</span><a href="#local-6989586621682961653"><span class="hs-identifier hs-var">fhv</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-341"></span><span>    </span><span class="annot"><span class="annottext">Interp -&gt; Message (EvalResult String) -&gt; IO (EvalResult String)
forall a. Binary a =&gt; Interp -&gt; Message a -&gt; IO a
</span><a href="GHC.Runtime.Interpreter.html#interpCmd"><span class="hs-identifier hs-var">interpCmd</span></a></span><span> </span><span class="annot"><span class="annottext">Interp
</span><a href="#local-6989586621682961650"><span class="hs-identifier hs-var">interp</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">HValueRef -&gt; String -&gt; Message (EvalResult String)
</span><a href="../../ghci-9.12.2-bd10/src/GHCi.Message.html#EvalStringToString"><span class="hs-identifier hs-var">EvalStringToString</span></a></span><span> </span><span class="annot"><span class="annottext">HValueRef
</span><a href="#local-6989586621682961653"><span class="hs-identifier hs-var">fhv</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621682961652"><span class="hs-identifier hs-var">str</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">IO (EvalResult String)
-&gt; (EvalResult String -&gt; IO String) -&gt; IO String
forall a b. IO a -&gt; (a -&gt; IO b) -&gt; IO b
forall (m :: * -&gt; *) a b. Monad m =&gt; m a -&gt; (a -&gt; m b) -&gt; m b
</span><span class="hs-operator hs-var">&gt;&gt;=</span></span><span> </span><span class="annot"><span class="annottext">EvalResult String -&gt; IO String
forall a. EvalResult a -&gt; IO a
</span><a href="GHC.Runtime.Interpreter.html#fromEvalResult"><span class="hs-identifier hs-var">fromEvalResult</span></a></span><span>
</span><span id="line-342"></span><span>
</span><span id="line-343"></span><span>
</span><span id="line-344"></span><span class="hs-comment">-- | Allocate and store the given bytes in memory, returning a pointer</span><span>
</span><span id="line-345"></span><span class="hs-comment">-- to the memory in the remote process.</span><span>
</span><span id="line-346"></span><span class="annot"><a href="GHC.Runtime.Interpreter.html#mallocData"><span class="hs-identifier hs-type">mallocData</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Runtime.Interpreter.Types.html#Interp"><span class="hs-identifier hs-type">Interp</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="../../bytestring-0.12.2.0-7dd0/src/Data.ByteString.Internal.Type.html#ByteString"><span class="hs-identifier hs-type">ByteString</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../../ghci-9.12.2-bd10/src/GHCi.RemoteTypes.html#RemotePtr"><span class="hs-identifier hs-type">RemotePtr</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-347"></span><span id="mallocData"><span class="annot"><span class="annottext">mallocData :: Interp -&gt; ByteString -&gt; IO (RemotePtr ())
</span><a href="GHC.Runtime.Interpreter.html#mallocData"><span class="hs-identifier hs-var hs-var">mallocData</span></a></span></span><span> </span><span id="local-6989586621682961655"><span class="annot"><span class="annottext">Interp
</span><a href="#local-6989586621682961655"><span class="hs-identifier hs-var">interp</span></a></span></span><span> </span><span id="local-6989586621682961656"><span class="annot"><span class="annottext">ByteString
</span><a href="#local-6989586621682961656"><span class="hs-identifier hs-var">bs</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Interp -&gt; Message (RemotePtr ()) -&gt; IO (RemotePtr ())
forall a. Binary a =&gt; Interp -&gt; Message a -&gt; IO a
</span><a href="GHC.Runtime.Interpreter.html#interpCmd"><span class="hs-identifier hs-var">interpCmd</span></a></span><span> </span><span class="annot"><span class="annottext">Interp
</span><a href="#local-6989586621682961655"><span class="hs-identifier hs-var">interp</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ByteString -&gt; Message (RemotePtr ())
</span><a href="../../ghci-9.12.2-bd10/src/GHCi.Message.html#MallocData"><span class="hs-identifier hs-var">MallocData</span></a></span><span> </span><span class="annot"><span class="annottext">ByteString
</span><a href="#local-6989586621682961656"><span class="hs-identifier hs-var">bs</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-348"></span><span>
</span><span id="line-349"></span><span class="annot"><a href="GHC.Runtime.Interpreter.html#mkCostCentres"><span class="hs-identifier hs-type">mkCostCentres</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Runtime.Interpreter.Types.html#Interp"><span class="hs-identifier hs-type">Interp</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">String</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">String</span></span><span class="hs-special">,</span><span class="annot"><span class="hs-identifier hs-type">String</span></span><span class="hs-special">)</span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="hs-special">[</span><span class="annot"><a href="../../ghci-9.12.2-bd10/src/GHCi.RemoteTypes.html#RemotePtr"><span class="hs-identifier hs-type">RemotePtr</span></a></span><span> </span><span class="annot"><span class="hs-identifier hs-type">CostCentre</span></span><span class="hs-special">]</span><span>
</span><span id="line-350"></span><span id="mkCostCentres"><span class="annot"><span class="annottext">mkCostCentres :: Interp -&gt; String -&gt; [(String, String)] -&gt; IO [RemotePtr CostCentre]
</span><a href="GHC.Runtime.Interpreter.html#mkCostCentres"><span class="hs-identifier hs-var hs-var">mkCostCentres</span></a></span></span><span> </span><span id="local-6989586621682961658"><span class="annot"><span class="annottext">Interp
</span><a href="#local-6989586621682961658"><span class="hs-identifier hs-var">interp</span></a></span></span><span> </span><span id="local-6989586621682961659"><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621682961659"><span class="hs-identifier hs-var">mod</span></a></span></span><span> </span><span id="local-6989586621682961660"><span class="annot"><span class="annottext">[(String, String)]
</span><a href="#local-6989586621682961660"><span class="hs-identifier hs-var">ccs</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-351"></span><span>  </span><span class="annot"><span class="annottext">Interp
-&gt; Message [RemotePtr CostCentre] -&gt; IO [RemotePtr CostCentre]
forall a. Binary a =&gt; Interp -&gt; Message a -&gt; IO a
</span><a href="GHC.Runtime.Interpreter.html#interpCmd"><span class="hs-identifier hs-var">interpCmd</span></a></span><span> </span><span class="annot"><span class="annottext">Interp
</span><a href="#local-6989586621682961658"><span class="hs-identifier hs-var">interp</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">String -&gt; [(String, String)] -&gt; Message [RemotePtr CostCentre]
</span><a href="../../ghci-9.12.2-bd10/src/GHCi.Message.html#MkCostCentres"><span class="hs-identifier hs-var">MkCostCentres</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621682961659"><span class="hs-identifier hs-var">mod</span></a></span><span> </span><span class="annot"><span class="annottext">[(String, String)]
</span><a href="#local-6989586621682961660"><span class="hs-identifier hs-var">ccs</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-352"></span><span>
</span><span id="line-353"></span><span class="annot"><span class="hs-comment">-- | Create a set of BCOs that may be mutually recursive.</span></span><span>
</span><span id="line-354"></span><span class="annot"><a href="GHC.Runtime.Interpreter.html#createBCOs"><span class="hs-identifier hs-type">createBCOs</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Runtime.Interpreter.Types.html#Interp"><span class="hs-identifier hs-type">Interp</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="../../ghci-9.12.2-bd10/src/GHCi.ResolvedBCO.html#ResolvedBCO"><span class="hs-identifier hs-type">ResolvedBCO</span></a></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="hs-special">[</span><span class="annot"><a href="../../ghci-9.12.2-bd10/src/GHCi.RemoteTypes.html#HValueRef"><span class="hs-identifier hs-type">HValueRef</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-355"></span><span id="createBCOs"><span class="annot"><span class="annottext">createBCOs :: Interp -&gt; [ResolvedBCO] -&gt; IO [HValueRef]
</span><a href="GHC.Runtime.Interpreter.html#createBCOs"><span class="hs-identifier hs-var hs-var">createBCOs</span></a></span></span><span> </span><span id="local-6989586621682961662"><span class="annot"><span class="annottext">Interp
</span><a href="#local-6989586621682961662"><span class="hs-identifier hs-var">interp</span></a></span></span><span> </span><span id="local-6989586621682961663"><span class="annot"><span class="annottext">[ResolvedBCO]
</span><a href="#local-6989586621682961663"><span class="hs-identifier hs-var">rbcos</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-356"></span><span>  </span><span class="annot"><span class="annottext">Interp -&gt; Message [HValueRef] -&gt; IO [HValueRef]
forall a. Binary a =&gt; Interp -&gt; Message a -&gt; IO a
</span><a href="GHC.Runtime.Interpreter.html#interpCmd"><span class="hs-identifier hs-var">interpCmd</span></a></span><span> </span><span class="annot"><span class="annottext">Interp
</span><a href="#local-6989586621682961662"><span class="hs-identifier hs-var">interp</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[ResolvedBCO] -&gt; Message [HValueRef]
</span><a href="../../ghci-9.12.2-bd10/src/GHCi.Message.html#CreateBCOs"><span class="hs-identifier hs-var">CreateBCOs</span></a></span><span> </span><span class="annot"><span class="annottext">[ResolvedBCO]
</span><a href="#local-6989586621682961663"><span class="hs-identifier hs-var">rbcos</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-357"></span><span>
</span><span id="line-358"></span><span class="annot"><a href="GHC.Runtime.Interpreter.html#addSptEntry"><span class="hs-identifier hs-type">addSptEntry</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Runtime.Interpreter.Types.html#Interp"><span class="hs-identifier hs-type">Interp</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Fingerprint</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="../../ghci-9.12.2-bd10/src/GHCi.RemoteTypes.html#ForeignHValue"><span class="hs-identifier hs-type">ForeignHValue</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-359"></span><span id="addSptEntry"><span class="annot"><span class="annottext">addSptEntry :: Interp -&gt; Fingerprint -&gt; ForeignHValue -&gt; IO ()
</span><a href="GHC.Runtime.Interpreter.html#addSptEntry"><span class="hs-identifier hs-var hs-var">addSptEntry</span></a></span></span><span> </span><span id="local-6989586621682961665"><span class="annot"><span class="annottext">Interp
</span><a href="#local-6989586621682961665"><span class="hs-identifier hs-var">interp</span></a></span></span><span> </span><span id="local-6989586621682961666"><span class="annot"><span class="annottext">Fingerprint
</span><a href="#local-6989586621682961666"><span class="hs-identifier hs-var">fpr</span></a></span></span><span> </span><span id="local-6989586621682961667"><span class="annot"><span class="annottext">ForeignHValue
</span><a href="#local-6989586621682961667"><span class="hs-identifier hs-var">ref</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-360"></span><span>  </span><span class="annot"><span class="annottext">ForeignHValue -&gt; (HValueRef -&gt; IO ()) -&gt; IO ()
forall a b. ForeignRef a -&gt; (RemoteRef a -&gt; IO b) -&gt; IO b
</span><a href="../../ghci-9.12.2-bd10/src/GHCi.RemoteTypes.html#withForeignRef"><span class="hs-identifier hs-var">withForeignRef</span></a></span><span> </span><span class="annot"><span class="annottext">ForeignHValue
</span><a href="#local-6989586621682961667"><span class="hs-identifier hs-var">ref</span></a></span><span> </span><span class="annot"><span class="annottext">((HValueRef -&gt; IO ()) -&gt; IO ()) -&gt; (HValueRef -&gt; IO ()) -&gt; IO ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-glyph">\</span><span id="local-6989586621682961668"><span class="annot"><span class="annottext">HValueRef
</span><a href="#local-6989586621682961668"><span class="hs-identifier hs-var">val</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-361"></span><span>    </span><span class="annot"><span class="annottext">Interp -&gt; Message () -&gt; IO ()
forall a. Binary a =&gt; Interp -&gt; Message a -&gt; IO a
</span><a href="GHC.Runtime.Interpreter.html#interpCmd"><span class="hs-identifier hs-var">interpCmd</span></a></span><span> </span><span class="annot"><span class="annottext">Interp
</span><a href="#local-6989586621682961665"><span class="hs-identifier hs-var">interp</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Fingerprint -&gt; HValueRef -&gt; Message ()
</span><a href="../../ghci-9.12.2-bd10/src/GHCi.Message.html#AddSptEntry"><span class="hs-identifier hs-var">AddSptEntry</span></a></span><span> </span><span class="annot"><span class="annottext">Fingerprint
</span><a href="#local-6989586621682961666"><span class="hs-identifier hs-var">fpr</span></a></span><span> </span><span class="annot"><span class="annottext">HValueRef
</span><a href="#local-6989586621682961668"><span class="hs-identifier hs-var">val</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-362"></span><span>
</span><span id="line-363"></span><span class="annot"><a href="GHC.Runtime.Interpreter.html#costCentreStackInfo"><span class="hs-identifier hs-type">costCentreStackInfo</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Runtime.Interpreter.Types.html#Interp"><span class="hs-identifier hs-type">Interp</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="../../ghci-9.12.2-bd10/src/GHCi.RemoteTypes.html#RemotePtr"><span class="hs-identifier hs-type">RemotePtr</span></a></span><span> </span><span class="annot"><span class="hs-identifier hs-type">CostCentreStack</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="hs-identifier hs-type">String</span></span><span class="hs-special">]</span><span>
</span><span id="line-364"></span><span id="costCentreStackInfo"><span class="annot"><span class="annottext">costCentreStackInfo :: Interp -&gt; RemotePtr CostCentreStack -&gt; IO [String]
</span><a href="GHC.Runtime.Interpreter.html#costCentreStackInfo"><span class="hs-identifier hs-var hs-var">costCentreStackInfo</span></a></span></span><span> </span><span id="local-6989586621682961670"><span class="annot"><span class="annottext">Interp
</span><a href="#local-6989586621682961670"><span class="hs-identifier hs-var">interp</span></a></span></span><span> </span><span id="local-6989586621682961671"><span class="annot"><span class="annottext">RemotePtr CostCentreStack
</span><a href="#local-6989586621682961671"><span class="hs-identifier hs-var">ccs</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-365"></span><span>  </span><span class="annot"><span class="annottext">Interp -&gt; Message [String] -&gt; IO [String]
forall a. Binary a =&gt; Interp -&gt; Message a -&gt; IO a
</span><a href="GHC.Runtime.Interpreter.html#interpCmd"><span class="hs-identifier hs-var">interpCmd</span></a></span><span> </span><span class="annot"><span class="annottext">Interp
</span><a href="#local-6989586621682961670"><span class="hs-identifier hs-var">interp</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">RemotePtr CostCentreStack -&gt; Message [String]
</span><a href="../../ghci-9.12.2-bd10/src/GHCi.Message.html#CostCentreStackInfo"><span class="hs-identifier hs-var">CostCentreStackInfo</span></a></span><span> </span><span class="annot"><span class="annottext">RemotePtr CostCentreStack
</span><a href="#local-6989586621682961671"><span class="hs-identifier hs-var">ccs</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-366"></span><span>
</span><span id="line-367"></span><span class="annot"><a href="GHC.Runtime.Interpreter.html#newBreakArray"><span class="hs-identifier hs-type">newBreakArray</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Runtime.Interpreter.Types.html#Interp"><span class="hs-identifier hs-type">Interp</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Int</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../../ghci-9.12.2-bd10/src/GHCi.RemoteTypes.html#ForeignRef"><span class="hs-identifier hs-type">ForeignRef</span></a></span><span> </span><span class="annot"><a href="../../ghci-9.12.2-bd10/src/GHCi.BreakArray.html#BreakArray"><span class="hs-identifier hs-type">BreakArray</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-368"></span><span id="newBreakArray"><span class="annot"><span class="annottext">newBreakArray :: Interp -&gt; BreakIndex -&gt; IO (ForeignRef BreakArray)
</span><a href="GHC.Runtime.Interpreter.html#newBreakArray"><span class="hs-identifier hs-var hs-var">newBreakArray</span></a></span></span><span> </span><span id="local-6989586621682961673"><span class="annot"><span class="annottext">Interp
</span><a href="#local-6989586621682961673"><span class="hs-identifier hs-var">interp</span></a></span></span><span> </span><span id="local-6989586621682961674"><span class="annot"><span class="annottext">BreakIndex
</span><a href="#local-6989586621682961674"><span class="hs-identifier hs-var">size</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-369"></span><span>  </span><span id="local-6989586621682961675"><span class="annot"><a href="#local-6989586621682961675"><span class="hs-identifier hs-var">breakArray</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Interp
-&gt; Message (RemoteRef BreakArray) -&gt; IO (RemoteRef BreakArray)
forall a. Binary a =&gt; Interp -&gt; Message a -&gt; IO a
</span><a href="GHC.Runtime.Interpreter.html#interpCmd"><span class="hs-identifier hs-var">interpCmd</span></a></span><span> </span><span class="annot"><span class="annottext">Interp
</span><a href="#local-6989586621682961673"><span class="hs-identifier hs-var">interp</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">BreakIndex -&gt; Message (RemoteRef BreakArray)
</span><a href="../../ghci-9.12.2-bd10/src/GHCi.Message.html#NewBreakArray"><span class="hs-identifier hs-var">NewBreakArray</span></a></span><span> </span><span class="annot"><span class="annottext">BreakIndex
</span><a href="#local-6989586621682961674"><span class="hs-identifier hs-var">size</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-370"></span><span>  </span><span class="annot"><a href="GHC.Runtime.Interpreter.html#mkFinalizedHValue"><span class="hs-identifier hs-type">mkFinalizedHValue</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682961673"><span class="hs-identifier hs-type">interp</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682961675"><span class="hs-identifier hs-type">breakArray</span></a></span><span>
</span><span id="line-371"></span><span>
</span><span id="line-372"></span><span class="annot"><a href="GHC.Runtime.Interpreter.html#newModuleName"><span class="hs-identifier hs-type">newModuleName</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Runtime.Interpreter.Types.html#Interp"><span class="hs-identifier hs-type">Interp</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Language.Haskell.Syntax.Module.Name.html#ModuleName"><span class="hs-identifier hs-type">ModuleName</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../../ghci-9.12.2-bd10/src/GHCi.RemoteTypes.html#RemotePtr"><span class="hs-identifier hs-type">RemotePtr</span></a></span><span> </span><span class="annot"><a href="Language.Haskell.Syntax.Module.Name.html#ModuleName"><span class="hs-identifier hs-type">ModuleName</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-373"></span><span id="newModuleName"><span class="annot"><span class="annottext">newModuleName :: Interp -&gt; ModuleName -&gt; IO (RemotePtr ModuleName)
</span><a href="GHC.Runtime.Interpreter.html#newModuleName"><span class="hs-identifier hs-var hs-var">newModuleName</span></a></span></span><span> </span><span id="local-6989586621682961677"><span class="annot"><span class="annottext">Interp
</span><a href="#local-6989586621682961677"><span class="hs-identifier hs-var">interp</span></a></span></span><span> </span><span id="local-6989586621682961678"><span class="annot"><span class="annottext">ModuleName
</span><a href="#local-6989586621682961678"><span class="hs-identifier hs-var">mod_name</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-374"></span><span>  </span><span class="annot"><span class="annottext">RemotePtr BreakModule -&gt; RemotePtr ModuleName
forall a b. RemotePtr a -&gt; RemotePtr b
</span><a href="../../ghci-9.12.2-bd10/src/GHCi.RemoteTypes.html#castRemotePtr"><span class="hs-identifier hs-var">castRemotePtr</span></a></span><span> </span><span class="annot"><span class="annottext">(RemotePtr BreakModule -&gt; RemotePtr ModuleName)
-&gt; IO (RemotePtr BreakModule) -&gt; IO (RemotePtr ModuleName)
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="annot"><span class="annottext">Interp
-&gt; Message (RemotePtr BreakModule) -&gt; IO (RemotePtr BreakModule)
forall a. Binary a =&gt; Interp -&gt; Message a -&gt; IO a
</span><a href="GHC.Runtime.Interpreter.html#interpCmd"><span class="hs-identifier hs-var">interpCmd</span></a></span><span> </span><span class="annot"><span class="annottext">Interp
</span><a href="#local-6989586621682961677"><span class="hs-identifier hs-var">interp</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">String -&gt; Message (RemotePtr BreakModule)
</span><a href="../../ghci-9.12.2-bd10/src/GHCi.Message.html#NewBreakModule"><span class="hs-identifier hs-var">NewBreakModule</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ModuleName -&gt; String
</span><a href="Language.Haskell.Syntax.Module.Name.html#moduleNameString"><span class="hs-identifier hs-var">moduleNameString</span></a></span><span> </span><span class="annot"><span class="annottext">ModuleName
</span><a href="#local-6989586621682961678"><span class="hs-identifier hs-var">mod_name</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-375"></span><span>
</span><span id="line-376"></span><span class="annot"><a href="GHC.Runtime.Interpreter.html#storeBreakpoint"><span class="hs-identifier hs-type">storeBreakpoint</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Runtime.Interpreter.Types.html#Interp"><span class="hs-identifier hs-type">Interp</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="../../ghci-9.12.2-bd10/src/GHCi.RemoteTypes.html#ForeignRef"><span class="hs-identifier hs-type">ForeignRef</span></a></span><span> </span><span class="annot"><a href="../../ghci-9.12.2-bd10/src/GHCi.BreakArray.html#BreakArray"><span class="hs-identifier hs-type">BreakArray</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Int</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Int</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-377"></span><span id="storeBreakpoint"><span class="annot"><span class="annottext">storeBreakpoint :: Interp
-&gt; ForeignRef BreakArray -&gt; BreakIndex -&gt; BreakIndex -&gt; IO ()
</span><a href="GHC.Runtime.Interpreter.html#storeBreakpoint"><span class="hs-identifier hs-var hs-var">storeBreakpoint</span></a></span></span><span> </span><span id="local-6989586621682961682"><span class="annot"><span class="annottext">Interp
</span><a href="#local-6989586621682961682"><span class="hs-identifier hs-var">interp</span></a></span></span><span> </span><span id="local-6989586621682961683"><span class="annot"><span class="annottext">ForeignRef BreakArray
</span><a href="#local-6989586621682961683"><span class="hs-identifier hs-var">ref</span></a></span></span><span> </span><span id="local-6989586621682961684"><span class="annot"><span class="annottext">BreakIndex
</span><a href="#local-6989586621682961684"><span class="hs-identifier hs-var">ix</span></a></span></span><span> </span><span id="local-6989586621682961685"><span class="annot"><span class="annottext">BreakIndex
</span><a href="#local-6989586621682961685"><span class="hs-identifier hs-var">cnt</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>                               </span><span class="hs-comment">-- #19157</span><span>
</span><span id="line-378"></span><span>  </span><span class="annot"><span class="annottext">ForeignRef BreakArray -&gt; (RemoteRef BreakArray -&gt; IO ()) -&gt; IO ()
forall a b. ForeignRef a -&gt; (RemoteRef a -&gt; IO b) -&gt; IO b
</span><a href="../../ghci-9.12.2-bd10/src/GHCi.RemoteTypes.html#withForeignRef"><span class="hs-identifier hs-var">withForeignRef</span></a></span><span> </span><span class="annot"><span class="annottext">ForeignRef BreakArray
</span><a href="#local-6989586621682961683"><span class="hs-identifier hs-var">ref</span></a></span><span> </span><span class="annot"><span class="annottext">((RemoteRef BreakArray -&gt; IO ()) -&gt; IO ())
-&gt; (RemoteRef BreakArray -&gt; IO ()) -&gt; IO ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-glyph">\</span><span id="local-6989586621682961686"><span class="annot"><span class="annottext">RemoteRef BreakArray
</span><a href="#local-6989586621682961686"><span class="hs-identifier hs-var">breakarray</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-379"></span><span>    </span><span class="annot"><span class="annottext">Interp -&gt; Message () -&gt; IO ()
forall a. Binary a =&gt; Interp -&gt; Message a -&gt; IO a
</span><a href="GHC.Runtime.Interpreter.html#interpCmd"><span class="hs-identifier hs-var">interpCmd</span></a></span><span> </span><span class="annot"><span class="annottext">Interp
</span><a href="#local-6989586621682961682"><span class="hs-identifier hs-var">interp</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">RemoteRef BreakArray -&gt; BreakIndex -&gt; BreakIndex -&gt; Message ()
</span><a href="../../ghci-9.12.2-bd10/src/GHCi.Message.html#SetupBreakpoint"><span class="hs-identifier hs-var">SetupBreakpoint</span></a></span><span> </span><span class="annot"><span class="annottext">RemoteRef BreakArray
</span><a href="#local-6989586621682961686"><span class="hs-identifier hs-var">breakarray</span></a></span><span> </span><span class="annot"><span class="annottext">BreakIndex
</span><a href="#local-6989586621682961684"><span class="hs-identifier hs-var">ix</span></a></span><span> </span><span class="annot"><span class="annottext">BreakIndex
</span><a href="#local-6989586621682961685"><span class="hs-identifier hs-var">cnt</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-380"></span><span>
</span><span id="line-381"></span><span class="annot"><a href="GHC.Runtime.Interpreter.html#breakpointStatus"><span class="hs-identifier hs-type">breakpointStatus</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Runtime.Interpreter.Types.html#Interp"><span class="hs-identifier hs-type">Interp</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="../../ghci-9.12.2-bd10/src/GHCi.RemoteTypes.html#ForeignRef"><span class="hs-identifier hs-type">ForeignRef</span></a></span><span> </span><span class="annot"><a href="../../ghci-9.12.2-bd10/src/GHCi.BreakArray.html#BreakArray"><span class="hs-identifier hs-type">BreakArray</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Int</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Bool</span></span><span>
</span><span id="line-382"></span><span id="breakpointStatus"><span class="annot"><span class="annottext">breakpointStatus :: Interp -&gt; ForeignRef BreakArray -&gt; BreakIndex -&gt; IO Bool
</span><a href="GHC.Runtime.Interpreter.html#breakpointStatus"><span class="hs-identifier hs-var hs-var">breakpointStatus</span></a></span></span><span> </span><span id="local-6989586621682961688"><span class="annot"><span class="annottext">Interp
</span><a href="#local-6989586621682961688"><span class="hs-identifier hs-var">interp</span></a></span></span><span> </span><span id="local-6989586621682961689"><span class="annot"><span class="annottext">ForeignRef BreakArray
</span><a href="#local-6989586621682961689"><span class="hs-identifier hs-var">ref</span></a></span></span><span> </span><span id="local-6989586621682961690"><span class="annot"><span class="annottext">BreakIndex
</span><a href="#local-6989586621682961690"><span class="hs-identifier hs-var">ix</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-383"></span><span>  </span><span class="annot"><span class="annottext">ForeignRef BreakArray
-&gt; (RemoteRef BreakArray -&gt; IO Bool) -&gt; IO Bool
forall a b. ForeignRef a -&gt; (RemoteRef a -&gt; IO b) -&gt; IO b
</span><a href="../../ghci-9.12.2-bd10/src/GHCi.RemoteTypes.html#withForeignRef"><span class="hs-identifier hs-var">withForeignRef</span></a></span><span> </span><span class="annot"><span class="annottext">ForeignRef BreakArray
</span><a href="#local-6989586621682961689"><span class="hs-identifier hs-var">ref</span></a></span><span> </span><span class="annot"><span class="annottext">((RemoteRef BreakArray -&gt; IO Bool) -&gt; IO Bool)
-&gt; (RemoteRef BreakArray -&gt; IO Bool) -&gt; IO Bool
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-glyph">\</span><span id="local-6989586621682961691"><span class="annot"><span class="annottext">RemoteRef BreakArray
</span><a href="#local-6989586621682961691"><span class="hs-identifier hs-var">breakarray</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-384"></span><span>    </span><span class="annot"><span class="annottext">Interp -&gt; Message Bool -&gt; IO Bool
forall a. Binary a =&gt; Interp -&gt; Message a -&gt; IO a
</span><a href="GHC.Runtime.Interpreter.html#interpCmd"><span class="hs-identifier hs-var">interpCmd</span></a></span><span> </span><span class="annot"><span class="annottext">Interp
</span><a href="#local-6989586621682961688"><span class="hs-identifier hs-var">interp</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">RemoteRef BreakArray -&gt; BreakIndex -&gt; Message Bool
</span><a href="../../ghci-9.12.2-bd10/src/GHCi.Message.html#BreakpointStatus"><span class="hs-identifier hs-var">BreakpointStatus</span></a></span><span> </span><span class="annot"><span class="annottext">RemoteRef BreakArray
</span><a href="#local-6989586621682961691"><span class="hs-identifier hs-var">breakarray</span></a></span><span> </span><span class="annot"><span class="annottext">BreakIndex
</span><a href="#local-6989586621682961690"><span class="hs-identifier hs-var">ix</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-385"></span><span>
</span><span id="line-386"></span><span class="annot"><a href="GHC.Runtime.Interpreter.html#getBreakpointVar"><span class="hs-identifier hs-type">getBreakpointVar</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Runtime.Interpreter.Types.html#Interp"><span class="hs-identifier hs-type">Interp</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="../../ghci-9.12.2-bd10/src/GHCi.RemoteTypes.html#ForeignHValue"><span class="hs-identifier hs-type">ForeignHValue</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Int</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Maybe</span></span><span> </span><span class="annot"><a href="../../ghci-9.12.2-bd10/src/GHCi.RemoteTypes.html#ForeignHValue"><span class="hs-identifier hs-type">ForeignHValue</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-387"></span><span id="getBreakpointVar"><span class="annot"><span class="annottext">getBreakpointVar :: Interp -&gt; ForeignHValue -&gt; BreakIndex -&gt; IO (Maybe ForeignHValue)
</span><a href="GHC.Runtime.Interpreter.html#getBreakpointVar"><span class="hs-identifier hs-var hs-var">getBreakpointVar</span></a></span></span><span> </span><span id="local-6989586621682961693"><span class="annot"><span class="annottext">Interp
</span><a href="#local-6989586621682961693"><span class="hs-identifier hs-var">interp</span></a></span></span><span> </span><span id="local-6989586621682961694"><span class="annot"><span class="annottext">ForeignHValue
</span><a href="#local-6989586621682961694"><span class="hs-identifier hs-var">ref</span></a></span></span><span> </span><span id="local-6989586621682961695"><span class="annot"><span class="annottext">BreakIndex
</span><a href="#local-6989586621682961695"><span class="hs-identifier hs-var">ix</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-388"></span><span>  </span><span class="annot"><span class="annottext">ForeignHValue
-&gt; (HValueRef -&gt; IO (Maybe ForeignHValue))
-&gt; IO (Maybe ForeignHValue)
forall a b. ForeignRef a -&gt; (RemoteRef a -&gt; IO b) -&gt; IO b
</span><a href="../../ghci-9.12.2-bd10/src/GHCi.RemoteTypes.html#withForeignRef"><span class="hs-identifier hs-var">withForeignRef</span></a></span><span> </span><span class="annot"><span class="annottext">ForeignHValue
</span><a href="#local-6989586621682961694"><span class="hs-identifier hs-var">ref</span></a></span><span> </span><span class="annot"><span class="annottext">((HValueRef -&gt; IO (Maybe ForeignHValue))
 -&gt; IO (Maybe ForeignHValue))
-&gt; (HValueRef -&gt; IO (Maybe ForeignHValue))
-&gt; IO (Maybe ForeignHValue)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-glyph">\</span><span id="local-6989586621682961696"><span class="annot"><span class="annottext">HValueRef
</span><a href="#local-6989586621682961696"><span class="hs-identifier hs-var">apStack</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-389"></span><span>    </span><span id="local-6989586621682961697"><span class="annot"><a href="#local-6989586621682961697"><span class="hs-identifier hs-var">mb</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Interp -&gt; Message (Maybe HValueRef) -&gt; IO (Maybe HValueRef)
forall a. Binary a =&gt; Interp -&gt; Message a -&gt; IO a
</span><a href="GHC.Runtime.Interpreter.html#interpCmd"><span class="hs-identifier hs-var">interpCmd</span></a></span><span> </span><span class="annot"><span class="annottext">Interp
</span><a href="#local-6989586621682961693"><span class="hs-identifier hs-var">interp</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">HValueRef -&gt; BreakIndex -&gt; Message (Maybe HValueRef)
</span><a href="../../ghci-9.12.2-bd10/src/GHCi.Message.html#GetBreakpointVar"><span class="hs-identifier hs-var">GetBreakpointVar</span></a></span><span> </span><span class="annot"><span class="annottext">HValueRef
</span><a href="#local-6989586621682961696"><span class="hs-identifier hs-var">apStack</span></a></span><span> </span><span class="annot"><span class="annottext">BreakIndex
</span><a href="#local-6989586621682961695"><span class="hs-identifier hs-var">ix</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-390"></span><span>    </span><span class="annot"><span class="hs-identifier hs-type">mapM</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Runtime.Interpreter.html#mkFinalizedHValue"><span class="hs-identifier hs-type">mkFinalizedHValue</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682961693"><span class="hs-identifier hs-type">interp</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><a href="#local-6989586621682961697"><span class="hs-identifier hs-type">mb</span></a></span><span>
</span><span id="line-391"></span><span>
</span><span id="line-392"></span><span class="annot"><a href="GHC.Runtime.Interpreter.html#getClosure"><span class="hs-identifier hs-type">getClosure</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Runtime.Interpreter.Types.html#Interp"><span class="hs-identifier hs-type">Interp</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="../../ghci-9.12.2-bd10/src/GHCi.RemoteTypes.html#ForeignHValue"><span class="hs-identifier hs-type">ForeignHValue</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../../ghc-heap-9.12.2-4363/src/GHC.Exts.Heap.Closures.html#GenClosure"><span class="hs-identifier hs-type">Heap.GenClosure</span></a></span><span> </span><span class="annot"><a href="../../ghci-9.12.2-bd10/src/GHCi.RemoteTypes.html#ForeignHValue"><span class="hs-identifier hs-type">ForeignHValue</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-393"></span><span id="getClosure"><span class="annot"><span class="annottext">getClosure :: Interp -&gt; ForeignHValue -&gt; IO (GenClosure ForeignHValue)
</span><a href="GHC.Runtime.Interpreter.html#getClosure"><span class="hs-identifier hs-var hs-var">getClosure</span></a></span></span><span> </span><span id="local-6989586621682961699"><span class="annot"><span class="annottext">Interp
</span><a href="#local-6989586621682961699"><span class="hs-identifier hs-var">interp</span></a></span></span><span> </span><span id="local-6989586621682961700"><span class="annot"><span class="annottext">ForeignHValue
</span><a href="#local-6989586621682961700"><span class="hs-identifier hs-var">ref</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-394"></span><span>  </span><span class="annot"><span class="annottext">ForeignHValue
-&gt; (HValueRef -&gt; IO (GenClosure ForeignHValue))
-&gt; IO (GenClosure ForeignHValue)
forall a b. ForeignRef a -&gt; (RemoteRef a -&gt; IO b) -&gt; IO b
</span><a href="../../ghci-9.12.2-bd10/src/GHCi.RemoteTypes.html#withForeignRef"><span class="hs-identifier hs-var">withForeignRef</span></a></span><span> </span><span class="annot"><span class="annottext">ForeignHValue
</span><a href="#local-6989586621682961700"><span class="hs-identifier hs-var">ref</span></a></span><span> </span><span class="annot"><span class="annottext">((HValueRef -&gt; IO (GenClosure ForeignHValue))
 -&gt; IO (GenClosure ForeignHValue))
-&gt; (HValueRef -&gt; IO (GenClosure ForeignHValue))
-&gt; IO (GenClosure ForeignHValue)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-glyph">\</span><span id="local-6989586621682961701"><span class="annot"><span class="annottext">HValueRef
</span><a href="#local-6989586621682961701"><span class="hs-identifier hs-var">hval</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-395"></span><span>    </span><span id="local-6989586621682961702"><span class="annot"><a href="#local-6989586621682961702"><span class="hs-identifier hs-var">mb</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Interp
-&gt; Message (GenClosure HValueRef) -&gt; IO (GenClosure HValueRef)
forall a. Binary a =&gt; Interp -&gt; Message a -&gt; IO a
</span><a href="GHC.Runtime.Interpreter.html#interpCmd"><span class="hs-identifier hs-var">interpCmd</span></a></span><span> </span><span class="annot"><span class="annottext">Interp
</span><a href="#local-6989586621682961699"><span class="hs-identifier hs-var">interp</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">HValueRef -&gt; Message (GenClosure HValueRef)
</span><a href="../../ghci-9.12.2-bd10/src/GHCi.Message.html#GetClosure"><span class="hs-identifier hs-var">GetClosure</span></a></span><span> </span><span class="annot"><span class="annottext">HValueRef
</span><a href="#local-6989586621682961701"><span class="hs-identifier hs-var">hval</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-396"></span><span>    </span><span class="annot"><span class="hs-identifier hs-type">mapM</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Runtime.Interpreter.html#mkFinalizedHValue"><span class="hs-identifier hs-type">mkFinalizedHValue</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682961699"><span class="hs-identifier hs-type">interp</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><a href="#local-6989586621682961702"><span class="hs-identifier hs-type">mb</span></a></span><span>
</span><span id="line-397"></span><span>
</span><span id="line-398"></span><span class="annot"><span class="hs-comment">-- | Send a Seq message to the iserv process to force a value      #2950</span></span><span>
</span><span id="line-399"></span><span class="annot"><a href="GHC.Runtime.Interpreter.html#seqHValue"><span class="hs-identifier hs-type">seqHValue</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Runtime.Interpreter.Types.html#Interp"><span class="hs-identifier hs-type">Interp</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Unit.Env.html#UnitEnv"><span class="hs-identifier hs-type">UnitEnv</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="../../ghci-9.12.2-bd10/src/GHCi.RemoteTypes.html#ForeignHValue"><span class="hs-identifier hs-type">ForeignHValue</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../../ghci-9.12.2-bd10/src/GHCi.Message.html#EvalResult"><span class="hs-identifier hs-type">EvalResult</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-400"></span><span id="seqHValue"><span class="annot"><span class="annottext">seqHValue :: Interp -&gt; UnitEnv -&gt; ForeignHValue -&gt; IO (EvalResult ())
</span><a href="GHC.Runtime.Interpreter.html#seqHValue"><span class="hs-identifier hs-var hs-var">seqHValue</span></a></span></span><span> </span><span id="local-6989586621682961704"><span class="annot"><span class="annottext">Interp
</span><a href="#local-6989586621682961704"><span class="hs-identifier hs-var">interp</span></a></span></span><span> </span><span id="local-6989586621682961705"><span class="annot"><span class="annottext">UnitEnv
</span><a href="#local-6989586621682961705"><span class="hs-identifier hs-var">unit_env</span></a></span></span><span> </span><span id="local-6989586621682961706"><span class="annot"><span class="annottext">ForeignHValue
</span><a href="#local-6989586621682961706"><span class="hs-identifier hs-var">ref</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-401"></span><span>  </span><span class="annot"><span class="annottext">ForeignHValue
-&gt; (HValueRef -&gt; IO (EvalResult ())) -&gt; IO (EvalResult ())
forall a b. ForeignRef a -&gt; (RemoteRef a -&gt; IO b) -&gt; IO b
</span><a href="../../ghci-9.12.2-bd10/src/GHCi.RemoteTypes.html#withForeignRef"><span class="hs-identifier hs-var">withForeignRef</span></a></span><span> </span><span class="annot"><span class="annottext">ForeignHValue
</span><a href="#local-6989586621682961706"><span class="hs-identifier hs-var">ref</span></a></span><span> </span><span class="annot"><span class="annottext">((HValueRef -&gt; IO (EvalResult ())) -&gt; IO (EvalResult ()))
-&gt; (HValueRef -&gt; IO (EvalResult ())) -&gt; IO (EvalResult ())
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-glyph">\</span><span id="local-6989586621682961707"><span class="annot"><span class="annottext">HValueRef
</span><a href="#local-6989586621682961707"><span class="hs-identifier hs-var">hval</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-402"></span><span>    </span><span id="local-6989586621682961708"><span class="annot"><a href="#local-6989586621682961708"><span class="hs-identifier hs-var">status</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Interp -&gt; Message (EvalStatus_ () ()) -&gt; IO (EvalStatus_ () ())
forall a. Binary a =&gt; Interp -&gt; Message a -&gt; IO a
</span><a href="GHC.Runtime.Interpreter.html#interpCmd"><span class="hs-identifier hs-var">interpCmd</span></a></span><span> </span><span class="annot"><span class="annottext">Interp
</span><a href="#local-6989586621682961704"><span class="hs-identifier hs-var">interp</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">HValueRef -&gt; Message (EvalStatus_ () ())
</span><a href="../../ghci-9.12.2-bd10/src/GHCi.Message.html#Seq"><span class="hs-identifier hs-var">Seq</span></a></span><span> </span><span class="annot"><span class="annottext">HValueRef
</span><a href="#local-6989586621682961707"><span class="hs-identifier hs-var">hval</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-403"></span><span>    </span><span class="annot"><a href="GHC.Runtime.Interpreter.html#handleSeqHValueStatus"><span class="hs-identifier hs-type">handleSeqHValueStatus</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682961704"><span class="hs-identifier hs-type">interp</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682961705"><span class="hs-identifier hs-type">unit_env</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682961708"><span class="hs-identifier hs-type">status</span></a></span><span>
</span><span id="line-404"></span><span>
</span><span id="line-405"></span><span class="annot"><a href="GHC.Runtime.Interpreter.html#evalBreakpointToId"><span class="hs-identifier hs-type">evalBreakpointToId</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Unit.Home.ModInfo.html#HomePackageTable"><span class="hs-identifier hs-type">HomePackageTable</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="../../ghci-9.12.2-bd10/src/GHCi.Message.html#EvalBreakpoint"><span class="hs-identifier hs-type">EvalBreakpoint</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Types.Breakpoint.html#InternalBreakpointId"><span class="hs-identifier hs-type">InternalBreakpointId</span></a></span><span>
</span><span id="line-406"></span><span id="evalBreakpointToId"><span class="annot"><span class="annottext">evalBreakpointToId :: HomePackageTable -&gt; EvalBreakpoint -&gt; InternalBreakpointId
</span><a href="GHC.Runtime.Interpreter.html#evalBreakpointToId"><span class="hs-identifier hs-var hs-var">evalBreakpointToId</span></a></span></span><span> </span><span id="local-6989586621682961711"><span class="annot"><span class="annottext">HomePackageTable
</span><a href="#local-6989586621682961711"><span class="hs-identifier hs-var">hpt</span></a></span></span><span> </span><span id="local-6989586621682961712"><span class="annot"><span class="annottext">EvalBreakpoint
</span><a href="#local-6989586621682961712"><span class="hs-identifier hs-var">eval_break</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-407"></span><span>  </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621682961713"><span class="annot"><span class="annottext">load_mod :: String -&gt; Module
</span><a href="#local-6989586621682961713"><span class="hs-identifier hs-var hs-var">load_mod</span></a></span></span><span> </span><span id="local-6989586621682961714"><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621682961714"><span class="hs-identifier hs-var">x</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ModIface_ 'ModIfaceFinal -&gt; Module
forall (phase :: ModIfacePhase). ModIface_ phase -&gt; Module
</span><a href="GHC.Unit.Module.ModIface.html#mi_module"><span class="hs-identifier hs-var">mi_module</span></a></span><span> </span><span class="annot"><span class="annottext">(ModIface_ 'ModIfaceFinal -&gt; Module)
-&gt; ModIface_ 'ModIfaceFinal -&gt; Module
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">HomeModInfo -&gt; ModIface_ 'ModIfaceFinal
</span><a href="GHC.Unit.Home.ModInfo.html#hm_iface"><span class="hs-identifier hs-var">hm_iface</span></a></span><span> </span><span class="annot"><span class="annottext">(HomeModInfo -&gt; ModIface_ 'ModIfaceFinal)
-&gt; HomeModInfo -&gt; ModIface_ 'ModIfaceFinal
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">String -&gt; Maybe HomeModInfo -&gt; HomeModInfo
forall a. HasDebugCallStack =&gt; String -&gt; Maybe a -&gt; a
</span><a href="GHC.Data.Maybe.html#expectJust"><span class="hs-identifier hs-var">expectJust</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;evalBreakpointToId&quot;</span></span><span> </span><span class="annot"><span class="annottext">(Maybe HomeModInfo -&gt; HomeModInfo)
-&gt; Maybe HomeModInfo -&gt; HomeModInfo
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">HomePackageTable -&gt; ModuleName -&gt; Maybe HomeModInfo
</span><a href="GHC.Unit.Home.ModInfo.html#lookupHpt"><span class="hs-identifier hs-var">lookupHpt</span></a></span><span> </span><span class="annot"><span class="annottext">HomePackageTable
</span><a href="#local-6989586621682961711"><span class="hs-identifier hs-var">hpt</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">String -&gt; ModuleName
</span><a href="Language.Haskell.Syntax.Module.Name.html#mkModuleName"><span class="hs-identifier hs-var">mkModuleName</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621682961714"><span class="hs-identifier hs-var">x</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-408"></span><span>  </span><span class="hs-keyword">in</span><span> </span><span class="annot"><a href="GHC.Types.Breakpoint.html#InternalBreakpointId"><span class="hs-identifier hs-type">InternalBreakpointId</span></a></span><span>
</span><span id="line-409"></span><span>        </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">ibi_tick_mod :: Module
</span><a href="GHC.Types.Breakpoint.html#ibi_tick_mod"><span class="hs-identifier hs-var">ibi_tick_mod</span></a></span><span>   </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">String -&gt; Module
</span><a href="#local-6989586621682961713"><span class="hs-identifier hs-var">load_mod</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">EvalBreakpoint -&gt; String
</span><a href="../../ghci-9.12.2-bd10/src/GHCi.Message.html#eb_tick_mod"><span class="hs-identifier hs-var">eb_tick_mod</span></a></span><span> </span><span class="annot"><span class="annottext">EvalBreakpoint
</span><a href="#local-6989586621682961712"><span class="hs-identifier hs-var">eval_break</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-410"></span><span>        </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">ibi_tick_index :: BreakIndex
</span><a href="GHC.Types.Breakpoint.html#ibi_tick_index"><span class="hs-identifier hs-var">ibi_tick_index</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">EvalBreakpoint -&gt; BreakIndex
</span><a href="../../ghci-9.12.2-bd10/src/GHCi.Message.html#eb_tick_index"><span class="hs-identifier hs-var">eb_tick_index</span></a></span><span> </span><span class="annot"><span class="annottext">EvalBreakpoint
</span><a href="#local-6989586621682961712"><span class="hs-identifier hs-var">eval_break</span></a></span><span>
</span><span id="line-411"></span><span>        </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">ibi_info_mod :: Module
</span><a href="GHC.Types.Breakpoint.html#ibi_info_mod"><span class="hs-identifier hs-var">ibi_info_mod</span></a></span><span>   </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">String -&gt; Module
</span><a href="#local-6989586621682961713"><span class="hs-identifier hs-var">load_mod</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">EvalBreakpoint -&gt; String
</span><a href="../../ghci-9.12.2-bd10/src/GHCi.Message.html#eb_info_mod"><span class="hs-identifier hs-var">eb_info_mod</span></a></span><span> </span><span class="annot"><span class="annottext">EvalBreakpoint
</span><a href="#local-6989586621682961712"><span class="hs-identifier hs-var">eval_break</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-412"></span><span>        </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">ibi_info_index :: BreakIndex
</span><a href="GHC.Types.Breakpoint.html#ibi_info_index"><span class="hs-identifier hs-var">ibi_info_index</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">EvalBreakpoint -&gt; BreakIndex
</span><a href="../../ghci-9.12.2-bd10/src/GHCi.Message.html#eb_info_index"><span class="hs-identifier hs-var">eb_info_index</span></a></span><span> </span><span class="annot"><span class="annottext">EvalBreakpoint
</span><a href="#local-6989586621682961712"><span class="hs-identifier hs-var">eval_break</span></a></span><span>
</span><span id="line-413"></span><span>        </span><span class="hs-special">}</span><span>
</span><span id="line-414"></span><span>
</span><span id="line-415"></span><span class="annot"><span class="hs-comment">-- | Process the result of a Seq or ResumeSeq message.             #2950</span></span><span>
</span><span id="line-416"></span><span class="annot"><a href="GHC.Runtime.Interpreter.html#handleSeqHValueStatus"><span class="hs-identifier hs-type">handleSeqHValueStatus</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Runtime.Interpreter.Types.html#Interp"><span class="hs-identifier hs-type">Interp</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Unit.Env.html#UnitEnv"><span class="hs-identifier hs-type">UnitEnv</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="../../ghci-9.12.2-bd10/src/GHCi.Message.html#EvalStatus"><span class="hs-identifier hs-type">EvalStatus</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../../ghci-9.12.2-bd10/src/GHCi.Message.html#EvalResult"><span class="hs-identifier hs-type">EvalResult</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-417"></span><span id="handleSeqHValueStatus"><span class="annot"><span class="annottext">handleSeqHValueStatus :: Interp -&gt; UnitEnv -&gt; EvalStatus_ () () -&gt; IO (EvalResult ())
</span><a href="GHC.Runtime.Interpreter.html#handleSeqHValueStatus"><span class="hs-identifier hs-var hs-var">handleSeqHValueStatus</span></a></span></span><span> </span><span id="local-6989586621682961729"><span class="annot"><span class="annottext">Interp
</span><a href="#local-6989586621682961729"><span class="hs-identifier hs-var">interp</span></a></span></span><span> </span><span id="local-6989586621682961730"><span class="annot"><span class="annottext">UnitEnv
</span><a href="#local-6989586621682961730"><span class="hs-identifier hs-var">unit_env</span></a></span></span><span> </span><span id="local-6989586621682961731"><span class="annot"><span class="annottext">EvalStatus_ () ()
</span><a href="#local-6989586621682961731"><span class="hs-identifier hs-var">eval_status</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-418"></span><span>  </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">EvalStatus_ () ()
</span><a href="#local-6989586621682961731"><span class="hs-identifier hs-var">eval_status</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-419"></span><span>    </span><span class="hs-special">(</span><span class="annot"><a href="../../ghci-9.12.2-bd10/src/GHCi.Message.html#EvalBreak"><span class="hs-identifier hs-type">EvalBreak</span></a></span><span> </span><span class="annot"><span class="annottext">HValueRef
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621682961732"><span class="annot"><span class="annottext">Maybe EvalBreakpoint
</span><a href="#local-6989586621682961732"><span class="hs-identifier hs-var">maybe_break</span></a></span></span><span> </span><span id="local-6989586621682961733"><span class="annot"><span class="annottext">RemoteRef (ResumeContext ())
</span><a href="#local-6989586621682961733"><span class="hs-identifier hs-var">resume_ctxt</span></a></span></span><span> </span><span class="annot"><span class="annottext">RemotePtr CostCentreStack
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-420"></span><span>      </span><span class="hs-comment">-- A breakpoint was hit; inform the user and tell them</span><span>
</span><span id="line-421"></span><span>      </span><span class="hs-comment">-- which breakpoint was hit.</span><span>
</span><span id="line-422"></span><span>      </span><span id="local-6989586621682961734"><span class="annot"><a href="#local-6989586621682961734"><span class="hs-identifier hs-var">resume_ctxt_fhv</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">IO (ForeignRef (ResumeContext ()))
-&gt; IO (ForeignRef (ResumeContext ()))
forall a. IO a -&gt; IO a
forall (m :: * -&gt; *) a. MonadIO m =&gt; IO a -&gt; m a
</span><span class="hs-identifier hs-var">liftIO</span></span><span> </span><span class="annot"><span class="annottext">(IO (ForeignRef (ResumeContext ()))
 -&gt; IO (ForeignRef (ResumeContext ())))
-&gt; IO (ForeignRef (ResumeContext ()))
-&gt; IO (ForeignRef (ResumeContext ()))
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Interp
-&gt; RemoteRef (ResumeContext ())
-&gt; IO (ForeignRef (ResumeContext ()))
forall a. Interp -&gt; RemoteRef a -&gt; IO (ForeignRef a)
</span><a href="GHC.Runtime.Interpreter.html#mkFinalizedHValue"><span class="hs-identifier hs-var">mkFinalizedHValue</span></a></span><span> </span><span class="annot"><span class="annottext">Interp
</span><a href="#local-6989586621682961729"><span class="hs-identifier hs-var">interp</span></a></span><span> </span><span class="annot"><span class="annottext">RemoteRef (ResumeContext ())
</span><a href="#local-6989586621682961733"><span class="hs-identifier hs-var">resume_ctxt</span></a></span><span>
</span><span id="line-423"></span><span>      </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621682961735"><span class="annot"><a href="#local-6989586621682961735"><span class="hs-identifier hs-var hs-var">bp</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">HomePackageTable -&gt; EvalBreakpoint -&gt; InternalBreakpointId
</span><a href="GHC.Runtime.Interpreter.html#evalBreakpointToId"><span class="hs-identifier hs-var">evalBreakpointToId</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">HasDebugCallStack =&gt; UnitEnv -&gt; HomePackageTable
UnitEnv -&gt; HomePackageTable
</span><a href="GHC.Unit.Env.html#ue_hpt"><span class="hs-identifier hs-var">ue_hpt</span></a></span><span> </span><span class="annot"><span class="annottext">UnitEnv
</span><a href="#local-6989586621682961730"><span class="hs-identifier hs-var">unit_env</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(EvalBreakpoint -&gt; InternalBreakpointId)
-&gt; Maybe EvalBreakpoint -&gt; Maybe InternalBreakpointId
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="annot"><span class="annottext">Maybe EvalBreakpoint
</span><a href="#local-6989586621682961732"><span class="hs-identifier hs-var">maybe_break</span></a></span><span>
</span><span id="line-424"></span><span>          </span><span id="local-6989586621682961741"><span class="annot"><a href="#local-6989586621682961741"><span class="hs-identifier hs-var hs-var">sdocBpLoc</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">SDoc -&gt; SDoc
forall doc. IsLine doc =&gt; doc -&gt; doc
</span><a href="GHC.Utils.Outputable.html#brackets"><span class="hs-identifier hs-var">brackets</span></a></span><span> </span><span class="annot"><span class="annottext">(SDoc -&gt; SDoc)
-&gt; (Maybe InternalBreakpointId -&gt; SDoc)
-&gt; Maybe InternalBreakpointId
-&gt; SDoc
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">SrcSpan -&gt; SDoc
forall a. Outputable a =&gt; a -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="annot"><span class="annottext">(SrcSpan -&gt; SDoc)
-&gt; (Maybe InternalBreakpointId -&gt; SrcSpan)
-&gt; Maybe InternalBreakpointId
-&gt; SDoc
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">Maybe InternalBreakpointId -&gt; SrcSpan
</span><a href="#local-6989586621682961743"><span class="hs-identifier hs-var">getSeqBpSpan</span></a></span><span>
</span><span id="line-425"></span><span>      </span><span class="annot"><span class="hs-identifier hs-type">putStrLn</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-string">&quot;*** Ignoring breakpoint &quot;</span></span><span> </span><span class="annot"><span class="hs-operator hs-type">++</span></span><span>
</span><span id="line-426"></span><span>            </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Utils.Outputable.html#showSDocUnsafe"><span class="hs-identifier hs-type">showSDocUnsafe</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="annot"><a href="#local-6989586621682961741"><span class="hs-identifier hs-type">sdocBpLoc</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682961735"><span class="hs-identifier hs-type">bp</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-427"></span><span>      </span><span class="hs-comment">-- resume the seq (:force) processing in the iserv process</span><span>
</span><span id="line-428"></span><span>      </span><span class="annot"><a href="../../ghci-9.12.2-bd10/src/GHCi.RemoteTypes.html#withForeignRef"><span class="hs-identifier hs-type">withForeignRef</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682961734"><span class="hs-identifier hs-type">resume_ctxt_fhv</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="hs-glyph">\</span><span id="local-6989586621682961745"><span class="annot"><span class="annottext">RemoteRef (ResumeContext ())
</span><a href="#local-6989586621682961745"><span class="hs-identifier hs-var">hval</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-429"></span><span>        </span><span id="local-6989586621682961746"><span class="annot"><a href="#local-6989586621682961746"><span class="hs-identifier hs-var">status</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Interp -&gt; Message (EvalStatus_ () ()) -&gt; IO (EvalStatus_ () ())
forall a. Binary a =&gt; Interp -&gt; Message a -&gt; IO a
</span><a href="GHC.Runtime.Interpreter.html#interpCmd"><span class="hs-identifier hs-var">interpCmd</span></a></span><span> </span><span class="annot"><span class="annottext">Interp
</span><a href="#local-6989586621682961729"><span class="hs-identifier hs-var">interp</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">RemoteRef (ResumeContext ()) -&gt; Message (EvalStatus_ () ())
</span><a href="../../ghci-9.12.2-bd10/src/GHCi.Message.html#ResumeSeq"><span class="hs-identifier hs-var">ResumeSeq</span></a></span><span> </span><span class="annot"><span class="annottext">RemoteRef (ResumeContext ())
</span><a href="#local-6989586621682961745"><span class="hs-identifier hs-var">hval</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-430"></span><span>        </span><span class="annot"><a href="GHC.Runtime.Interpreter.html#handleSeqHValueStatus"><span class="hs-identifier hs-type">handleSeqHValueStatus</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682961729"><span class="hs-identifier hs-type">interp</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682961730"><span class="hs-identifier hs-type">unit_env</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682961746"><span class="hs-identifier hs-type">status</span></a></span><span>
</span><span id="line-431"></span><span>    </span><span class="hs-special">(</span><span class="annot"><a href="../../ghci-9.12.2-bd10/src/GHCi.Message.html#EvalComplete"><span class="hs-identifier hs-type">EvalComplete</span></a></span><span> </span><span class="annot"><span class="annottext">Word64
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621682961748"><span class="annot"><span class="annottext">EvalResult ()
</span><a href="#local-6989586621682961748"><span class="hs-identifier hs-var">r</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">EvalResult () -&gt; IO (EvalResult ())
forall a. a -&gt; IO a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="annot"><span class="annottext">EvalResult ()
</span><a href="#local-6989586621682961748"><span class="hs-identifier hs-var">r</span></a></span><span>
</span><span id="line-432"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-433"></span><span>    </span><span class="annot"><a href="#local-6989586621682961743"><span class="hs-identifier hs-type">getSeqBpSpan</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Maybe</span></span><span> </span><span class="annot"><a href="GHC.Types.Breakpoint.html#InternalBreakpointId"><span class="hs-identifier hs-type">InternalBreakpointId</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Types.SrcLoc.html#SrcSpan"><span class="hs-identifier hs-type">SrcSpan</span></a></span><span>
</span><span id="line-434"></span><span>    </span><span id="local-6989586621682961743"><span class="annot"><span class="annottext">getSeqBpSpan :: Maybe InternalBreakpointId -&gt; SrcSpan
</span><a href="#local-6989586621682961743"><span class="hs-identifier hs-var hs-var">getSeqBpSpan</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-glyph">\</span><span class="hs-glyph">case</span><span>
</span><span id="line-435"></span><span>      </span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span id="local-6989586621682961749"><span class="annot"><span class="annottext">InternalBreakpointId
</span><a href="#local-6989586621682961749"><span class="hs-identifier hs-var">bi</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ModBreaks -&gt; Array BreakIndex SrcSpan
</span><a href="GHC.ByteCode.Types.html#modBreaks_locs"><span class="hs-identifier hs-var">modBreaks_locs</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Module -&gt; ModBreaks
</span><a href="#local-6989586621682961751"><span class="hs-identifier hs-var">breaks</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">InternalBreakpointId -&gt; Module
</span><a href="GHC.Types.Breakpoint.html#ibi_tick_mod"><span class="hs-identifier hs-var">ibi_tick_mod</span></a></span><span> </span><span class="annot"><span class="annottext">InternalBreakpointId
</span><a href="#local-6989586621682961749"><span class="hs-identifier hs-var">bi</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Array BreakIndex SrcSpan -&gt; BreakIndex -&gt; SrcSpan
forall i e. Ix i =&gt; Array i e -&gt; i -&gt; e
</span><span class="hs-operator hs-var">!</span></span><span> </span><span class="annot"><span class="annottext">InternalBreakpointId -&gt; BreakIndex
</span><a href="GHC.Types.Breakpoint.html#ibi_tick_index"><span class="hs-identifier hs-var">ibi_tick_index</span></a></span><span> </span><span class="annot"><span class="annottext">InternalBreakpointId
</span><a href="#local-6989586621682961749"><span class="hs-identifier hs-var">bi</span></a></span><span>
</span><span id="line-436"></span><span>        </span><span class="hs-comment">-- Just case: Stopped at a breakpoint, extract SrcSpan information</span><span>
</span><span id="line-437"></span><span>        </span><span class="hs-comment">-- from the breakpoint.</span><span>
</span><span id="line-438"></span><span>      </span><span class="annot"><span class="annottext">Maybe InternalBreakpointId
</span><span class="hs-identifier hs-var">Nothing</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">FastString -&gt; SrcSpan
</span><a href="GHC.Types.SrcLoc.html#mkGeneralSrcSpan"><span class="hs-identifier hs-var">mkGeneralSrcSpan</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">String -&gt; FastString
</span><a href="GHC.Data.FastString.html#fsLit"><span class="hs-identifier hs-var">fsLit</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;&lt;unknown&gt;&quot;</span></span><span class="hs-special">)</span><span>
</span><span id="line-439"></span><span>        </span><span class="hs-comment">-- Nothing case - should not occur!</span><span>
</span><span id="line-440"></span><span>        </span><span class="hs-comment">-- Reason: Setting of flags in libraries/ghci/GHCi/Run.hs:evalOptsSeq</span><span>
</span><span id="line-441"></span><span>        </span><span class="hs-comment">--</span><span>
</span><span id="line-442"></span><span>    </span><span id="local-6989586621682961751"><span class="annot"><span class="annottext">breaks :: Module -&gt; ModBreaks
</span><a href="#local-6989586621682961751"><span class="hs-identifier hs-var hs-var">breaks</span></a></span></span><span> </span><span id="local-6989586621682961754"><span class="annot"><span class="annottext">Module
</span><a href="#local-6989586621682961754"><span class="hs-identifier hs-var">mod</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">HomeModInfo -&gt; ModBreaks
</span><a href="GHC.Runtime.Interpreter.html#getModBreaks"><span class="hs-identifier hs-var">getModBreaks</span></a></span><span> </span><span class="annot"><span class="annottext">(HomeModInfo -&gt; ModBreaks) -&gt; HomeModInfo -&gt; ModBreaks
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">String -&gt; Maybe HomeModInfo -&gt; HomeModInfo
forall a. HasDebugCallStack =&gt; String -&gt; Maybe a -&gt; a
</span><a href="GHC.Data.Maybe.html#expectJust"><span class="hs-identifier hs-var">expectJust</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;getSeqBpSpan&quot;</span></span><span> </span><span class="annot"><span class="annottext">(Maybe HomeModInfo -&gt; HomeModInfo)
-&gt; Maybe HomeModInfo -&gt; HomeModInfo
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-443"></span><span>      </span><span class="annot"><span class="annottext">HomePackageTable -&gt; ModuleName -&gt; Maybe HomeModInfo
</span><a href="GHC.Unit.Home.ModInfo.html#lookupHpt"><span class="hs-identifier hs-var">lookupHpt</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">HasDebugCallStack =&gt; UnitEnv -&gt; HomePackageTable
UnitEnv -&gt; HomePackageTable
</span><a href="GHC.Unit.Env.html#ue_hpt"><span class="hs-identifier hs-var">ue_hpt</span></a></span><span> </span><span class="annot"><span class="annottext">UnitEnv
</span><a href="#local-6989586621682961730"><span class="hs-identifier hs-var">unit_env</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Module -&gt; ModuleName
forall unit. GenModule unit -&gt; ModuleName
</span><a href="GHC.Unit.Types.html#moduleName"><span class="hs-identifier hs-var">moduleName</span></a></span><span> </span><span class="annot"><span class="annottext">Module
</span><a href="#local-6989586621682961754"><span class="hs-identifier hs-var">mod</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-444"></span><span>
</span><span id="line-445"></span><span>
</span><span id="line-446"></span><span class="hs-comment">-- -----------------------------------------------------------------------------</span><span>
</span><span id="line-447"></span><span class="hs-comment">-- Interface to the object-code linker</span><span>
</span><span id="line-448"></span><span>
</span><span id="line-449"></span><span class="annot"><a href="GHC.Runtime.Interpreter.html#initObjLinker"><span class="hs-identifier hs-type">initObjLinker</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Runtime.Interpreter.Types.html#Interp"><span class="hs-identifier hs-type">Interp</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-450"></span><span id="initObjLinker"><span class="annot"><span class="annottext">initObjLinker :: Interp -&gt; IO ()
</span><a href="GHC.Runtime.Interpreter.html#initObjLinker"><span class="hs-identifier hs-var hs-var">initObjLinker</span></a></span></span><span> </span><span id="local-6989586621682961756"><span class="annot"><span class="annottext">Interp
</span><a href="#local-6989586621682961756"><span class="hs-identifier hs-var">interp</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Interp -&gt; Message () -&gt; IO ()
forall a. Binary a =&gt; Interp -&gt; Message a -&gt; IO a
</span><a href="GHC.Runtime.Interpreter.html#interpCmd"><span class="hs-identifier hs-var">interpCmd</span></a></span><span> </span><span class="annot"><span class="annottext">Interp
</span><a href="#local-6989586621682961756"><span class="hs-identifier hs-var">interp</span></a></span><span> </span><span class="annot"><span class="annottext">Message ()
</span><a href="../../ghci-9.12.2-bd10/src/GHCi.Message.html#InitLinker"><span class="hs-identifier hs-var">InitLinker</span></a></span><span>
</span><span id="line-451"></span><span>
</span><span id="line-452"></span><span class="annot"><a href="GHC.Runtime.Interpreter.html#lookupSymbol"><span class="hs-identifier hs-type">lookupSymbol</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Runtime.Interpreter.Types.html#Interp"><span class="hs-identifier hs-type">Interp</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Data.FastString.html#FastString"><span class="hs-identifier hs-type">FastString</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Maybe</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Ptr</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-453"></span><span id="lookupSymbol"><span class="annot"><span class="annottext">lookupSymbol :: Interp -&gt; FastString -&gt; IO (Maybe (Ptr ()))
</span><a href="GHC.Runtime.Interpreter.html#lookupSymbol"><span class="hs-identifier hs-var hs-var">lookupSymbol</span></a></span></span><span> </span><span id="local-6989586621682961758"><span class="annot"><span class="annottext">Interp
</span><a href="#local-6989586621682961758"><span class="hs-identifier hs-var">interp</span></a></span></span><span> </span><span id="local-6989586621682961759"><span class="annot"><span class="annottext">FastString
</span><a href="#local-6989586621682961759"><span class="hs-identifier hs-var">str</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Interp -&gt; FastString -&gt; IO (Maybe (Ptr ())) -&gt; IO (Maybe (Ptr ()))
</span><a href="GHC.Runtime.Interpreter.html#withSymbolCache"><span class="hs-identifier hs-var">withSymbolCache</span></a></span><span> </span><span class="annot"><span class="annottext">Interp
</span><a href="#local-6989586621682961758"><span class="hs-identifier hs-var">interp</span></a></span><span> </span><span class="annot"><span class="annottext">FastString
</span><a href="#local-6989586621682961759"><span class="hs-identifier hs-var">str</span></a></span><span> </span><span class="annot"><span class="annottext">(IO (Maybe (Ptr ())) -&gt; IO (Maybe (Ptr ())))
-&gt; IO (Maybe (Ptr ())) -&gt; IO (Maybe (Ptr ()))
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-454"></span><span>  </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">Interp -&gt; InterpInstance
</span><a href="GHC.Runtime.Interpreter.Types.html#interpInstance"><span class="hs-identifier hs-var">interpInstance</span></a></span><span> </span><span class="annot"><span class="annottext">Interp
</span><a href="#local-6989586621682961758"><span class="hs-identifier hs-var">interp</span></a></span><span> </span><span class="hs-keyword">of</span><span class="hs-cpp">
#if defined(HAVE_INTERNAL_INTERPRETER)
</span><span>    </span><span class="annot"><span class="annottext">InterpInstance
</span><a href="GHC.Runtime.Interpreter.Types.html#InternalInterp"><span class="hs-identifier hs-var">InternalInterp</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">(RemotePtr () -&gt; Ptr ()) -&gt; Maybe (RemotePtr ()) -&gt; Maybe (Ptr ())
forall a b. (a -&gt; b) -&gt; Maybe a -&gt; Maybe b
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-identifier hs-var">fmap</span></span><span> </span><span class="annot"><span class="annottext">RemotePtr () -&gt; Ptr ()
forall a. RemotePtr a -&gt; Ptr a
</span><a href="../../ghci-9.12.2-bd10/src/GHCi.RemoteTypes.html#fromRemotePtr"><span class="hs-identifier hs-var">fromRemotePtr</span></a></span><span> </span><span class="annot"><span class="annottext">(Maybe (RemotePtr ()) -&gt; Maybe (Ptr ()))
-&gt; IO (Maybe (RemotePtr ())) -&gt; IO (Maybe (Ptr ()))
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="annot"><span class="annottext">Message (Maybe (RemotePtr ())) -&gt; IO (Maybe (RemotePtr ()))
forall a. Message a -&gt; IO a
</span><a href="../../ghci-9.12.2-bd10/src/GHCi.Run.html#run"><span class="hs-identifier hs-var">run</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">String -&gt; Message (Maybe (RemotePtr ()))
</span><a href="../../ghci-9.12.2-bd10/src/GHCi.Message.html#LookupSymbol"><span class="hs-identifier hs-var">LookupSymbol</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">FastString -&gt; String
</span><a href="GHC.Data.FastString.html#unpackFS"><span class="hs-identifier hs-var">unpackFS</span></a></span><span> </span><span class="annot"><span class="annottext">FastString
</span><a href="#local-6989586621682961759"><span class="hs-identifier hs-var">str</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-cpp">
#endif
</span><span>    </span><span class="annot"><a href="GHC.Runtime.Interpreter.Types.html#ExternalInterp"><span class="hs-identifier hs-type">ExternalInterp</span></a></span><span> </span><span id="local-6989586621682961764"><span class="annot"><span class="annottext">ExtInterp
</span><a href="#local-6989586621682961764"><span class="hs-identifier hs-var">ext</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">ExtInterp
</span><a href="#local-6989586621682961764"><span class="hs-identifier hs-var">ext</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-459"></span><span>      </span><span class="annot"><a href="GHC.Runtime.Interpreter.Types.html#ExtIServ"><span class="hs-identifier hs-type">ExtIServ</span></a></span><span> </span><span id="local-6989586621682961765"><span class="annot"><span class="annottext">IServ
</span><a href="#local-6989586621682961765"><span class="hs-identifier hs-var">i</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">IServ
-&gt; (ExtInterpInstance () -&gt; IO (Maybe (Ptr ())))
-&gt; IO (Maybe (Ptr ()))
forall (m :: * -&gt; *) a.
ExceptionMonad m =&gt;
IServ -&gt; (ExtInterpInstance () -&gt; m a) -&gt; m a
</span><a href="GHC.Runtime.Interpreter.html#withIServ"><span class="hs-identifier hs-var">withIServ</span></a></span><span> </span><span class="annot"><span class="annottext">IServ
</span><a href="#local-6989586621682961765"><span class="hs-identifier hs-var">i</span></a></span><span> </span><span class="annot"><span class="annottext">((ExtInterpInstance () -&gt; IO (Maybe (Ptr ())))
 -&gt; IO (Maybe (Ptr ())))
-&gt; (ExtInterpInstance () -&gt; IO (Maybe (Ptr ())))
-&gt; IO (Maybe (Ptr ()))
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-glyph">\</span><span id="local-6989586621682961766"><span class="annot"><span class="annottext">ExtInterpInstance ()
</span><a href="#local-6989586621682961766"><span class="hs-identifier hs-var">inst</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">(RemotePtr () -&gt; Ptr ()) -&gt; Maybe (RemotePtr ()) -&gt; Maybe (Ptr ())
forall a b. (a -&gt; b) -&gt; Maybe a -&gt; Maybe b
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-identifier hs-var">fmap</span></span><span> </span><span class="annot"><span class="annottext">RemotePtr () -&gt; Ptr ()
forall a. RemotePtr a -&gt; Ptr a
</span><a href="../../ghci-9.12.2-bd10/src/GHCi.RemoteTypes.html#fromRemotePtr"><span class="hs-identifier hs-var">fromRemotePtr</span></a></span><span> </span><span class="annot"><span class="annottext">(Maybe (RemotePtr ()) -&gt; Maybe (Ptr ()))
-&gt; IO (Maybe (RemotePtr ())) -&gt; IO (Maybe (Ptr ()))
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-460"></span><span>        </span><span class="annot"><span class="annottext">IO (Maybe (RemotePtr ())) -&gt; IO (Maybe (RemotePtr ()))
forall a. IO a -&gt; IO a
</span><span class="hs-identifier hs-var">uninterruptibleMask_</span></span><span> </span><span class="annot"><span class="annottext">(IO (Maybe (RemotePtr ())) -&gt; IO (Maybe (RemotePtr ())))
-&gt; IO (Maybe (RemotePtr ())) -&gt; IO (Maybe (RemotePtr ()))
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-461"></span><span>          </span><span class="annot"><span class="annottext">ExtInterpInstance ()
-&gt; Message (Maybe (RemotePtr ())) -&gt; IO (Maybe (RemotePtr ()))
forall a d. Binary a =&gt; ExtInterpInstance d -&gt; Message a -&gt; IO a
</span><a href="GHC.Runtime.Interpreter.Process.html#sendMessage"><span class="hs-identifier hs-var">sendMessage</span></a></span><span> </span><span class="annot"><span class="annottext">ExtInterpInstance ()
</span><a href="#local-6989586621682961766"><span class="hs-identifier hs-var">inst</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">String -&gt; Message (Maybe (RemotePtr ()))
</span><a href="../../ghci-9.12.2-bd10/src/GHCi.Message.html#LookupSymbol"><span class="hs-identifier hs-var">LookupSymbol</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">FastString -&gt; String
</span><a href="GHC.Data.FastString.html#unpackFS"><span class="hs-identifier hs-var">unpackFS</span></a></span><span> </span><span class="annot"><span class="annottext">FastString
</span><a href="#local-6989586621682961759"><span class="hs-identifier hs-var">str</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-462"></span><span>      </span><span class="annot"><a href="GHC.Runtime.Interpreter.Types.html#ExtJS"><span class="hs-identifier hs-type">ExtJS</span></a></span><span> </span><span class="hs-special">{</span><span class="hs-special">}</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">String -&gt; SDoc -&gt; IO (Maybe (Ptr ()))
forall a. HasCallStack =&gt; String -&gt; SDoc -&gt; a
</span><a href="GHC.Utils.Panic.html#pprPanic"><span class="hs-identifier hs-var">pprPanic</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;lookupSymbol not supported by the JS interpreter&quot;</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">FastString -&gt; SDoc
forall a. Outputable a =&gt; a -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="annot"><span class="annottext">FastString
</span><a href="#local-6989586621682961759"><span class="hs-identifier hs-var">str</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-463"></span><span>      </span><span class="annot"><a href="GHC.Runtime.Interpreter.Types.html#ExtWasm"><span class="hs-identifier hs-type">ExtWasm</span></a></span><span> </span><span id="local-6989586621682961768"><span class="annot"><span class="annottext">WasmInterp
</span><a href="#local-6989586621682961768"><span class="hs-identifier hs-var">i</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">WasmInterp
-&gt; (ExtInterpInstance () -&gt; IO (Maybe (Ptr ())))
-&gt; IO (Maybe (Ptr ()))
forall (m :: * -&gt; *) a.
ExceptionMonad m =&gt;
WasmInterp -&gt; (ExtInterpInstance () -&gt; m a) -&gt; m a
</span><a href="GHC.Runtime.Interpreter.html#withWasmInterp"><span class="hs-identifier hs-var">withWasmInterp</span></a></span><span> </span><span class="annot"><span class="annottext">WasmInterp
</span><a href="#local-6989586621682961768"><span class="hs-identifier hs-var">i</span></a></span><span> </span><span class="annot"><span class="annottext">((ExtInterpInstance () -&gt; IO (Maybe (Ptr ())))
 -&gt; IO (Maybe (Ptr ())))
-&gt; (ExtInterpInstance () -&gt; IO (Maybe (Ptr ())))
-&gt; IO (Maybe (Ptr ()))
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-glyph">\</span><span id="local-6989586621682961769"><span class="annot"><span class="annottext">ExtInterpInstance ()
</span><a href="#local-6989586621682961769"><span class="hs-identifier hs-var">inst</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">(RemotePtr () -&gt; Ptr ()) -&gt; Maybe (RemotePtr ()) -&gt; Maybe (Ptr ())
forall a b. (a -&gt; b) -&gt; Maybe a -&gt; Maybe b
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-identifier hs-var">fmap</span></span><span> </span><span class="annot"><span class="annottext">RemotePtr () -&gt; Ptr ()
forall a. RemotePtr a -&gt; Ptr a
</span><a href="../../ghci-9.12.2-bd10/src/GHCi.RemoteTypes.html#fromRemotePtr"><span class="hs-identifier hs-var">fromRemotePtr</span></a></span><span> </span><span class="annot"><span class="annottext">(Maybe (RemotePtr ()) -&gt; Maybe (Ptr ()))
-&gt; IO (Maybe (RemotePtr ())) -&gt; IO (Maybe (Ptr ()))
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-464"></span><span>        </span><span class="annot"><span class="annottext">IO (Maybe (RemotePtr ())) -&gt; IO (Maybe (RemotePtr ()))
forall a. IO a -&gt; IO a
</span><span class="hs-identifier hs-var">uninterruptibleMask_</span></span><span> </span><span class="annot"><span class="annottext">(IO (Maybe (RemotePtr ())) -&gt; IO (Maybe (RemotePtr ())))
-&gt; IO (Maybe (RemotePtr ())) -&gt; IO (Maybe (RemotePtr ()))
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-465"></span><span>          </span><span class="annot"><span class="annottext">ExtInterpInstance ()
-&gt; Message (Maybe (RemotePtr ())) -&gt; IO (Maybe (RemotePtr ()))
forall a d. Binary a =&gt; ExtInterpInstance d -&gt; Message a -&gt; IO a
</span><a href="GHC.Runtime.Interpreter.Process.html#sendMessage"><span class="hs-identifier hs-var">sendMessage</span></a></span><span> </span><span class="annot"><span class="annottext">ExtInterpInstance ()
</span><a href="#local-6989586621682961769"><span class="hs-identifier hs-var">inst</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">String -&gt; Message (Maybe (RemotePtr ()))
</span><a href="../../ghci-9.12.2-bd10/src/GHCi.Message.html#LookupSymbol"><span class="hs-identifier hs-var">LookupSymbol</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">FastString -&gt; String
</span><a href="GHC.Data.FastString.html#unpackFS"><span class="hs-identifier hs-var">unpackFS</span></a></span><span> </span><span class="annot"><span class="annottext">FastString
</span><a href="#local-6989586621682961759"><span class="hs-identifier hs-var">str</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-466"></span><span>
</span><span id="line-467"></span><span class="annot"><a href="GHC.Runtime.Interpreter.html#lookupSymbolInDLL"><span class="hs-identifier hs-type">lookupSymbolInDLL</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Runtime.Interpreter.Types.html#Interp"><span class="hs-identifier hs-type">Interp</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="../../ghci-9.12.2-bd10/src/GHCi.RemoteTypes.html#RemotePtr"><span class="hs-identifier hs-type">RemotePtr</span></a></span><span> </span><span class="annot"><a href="../../ghci-9.12.2-bd10/src/GHCi.Message.html#LoadedDLL"><span class="hs-identifier hs-type">LoadedDLL</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Data.FastString.html#FastString"><span class="hs-identifier hs-type">FastString</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Maybe</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Ptr</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-468"></span><span id="lookupSymbolInDLL"><span class="annot"><span class="annottext">lookupSymbolInDLL :: Interp -&gt; RemotePtr LoadedDLL -&gt; FastString -&gt; IO (Maybe (Ptr ()))
</span><a href="GHC.Runtime.Interpreter.html#lookupSymbolInDLL"><span class="hs-identifier hs-var hs-var">lookupSymbolInDLL</span></a></span></span><span> </span><span id="local-6989586621682961770"><span class="annot"><span class="annottext">Interp
</span><a href="#local-6989586621682961770"><span class="hs-identifier hs-var">interp</span></a></span></span><span> </span><span id="local-6989586621682961771"><span class="annot"><span class="annottext">RemotePtr LoadedDLL
</span><a href="#local-6989586621682961771"><span class="hs-identifier hs-var">dll</span></a></span></span><span> </span><span id="local-6989586621682961772"><span class="annot"><span class="annottext">FastString
</span><a href="#local-6989586621682961772"><span class="hs-identifier hs-var">str</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Interp -&gt; FastString -&gt; IO (Maybe (Ptr ())) -&gt; IO (Maybe (Ptr ()))
</span><a href="GHC.Runtime.Interpreter.html#withSymbolCache"><span class="hs-identifier hs-var">withSymbolCache</span></a></span><span> </span><span class="annot"><span class="annottext">Interp
</span><a href="#local-6989586621682961770"><span class="hs-identifier hs-var">interp</span></a></span><span> </span><span class="annot"><span class="annottext">FastString
</span><a href="#local-6989586621682961772"><span class="hs-identifier hs-var">str</span></a></span><span> </span><span class="annot"><span class="annottext">(IO (Maybe (Ptr ())) -&gt; IO (Maybe (Ptr ())))
-&gt; IO (Maybe (Ptr ())) -&gt; IO (Maybe (Ptr ()))
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-469"></span><span>  </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">Interp -&gt; InterpInstance
</span><a href="GHC.Runtime.Interpreter.Types.html#interpInstance"><span class="hs-identifier hs-var">interpInstance</span></a></span><span> </span><span class="annot"><span class="annottext">Interp
</span><a href="#local-6989586621682961770"><span class="hs-identifier hs-var">interp</span></a></span><span> </span><span class="hs-keyword">of</span><span class="hs-cpp">
#if defined(HAVE_INTERNAL_INTERPRETER)
</span><span>    </span><span class="annot"><span class="annottext">InterpInstance
</span><a href="GHC.Runtime.Interpreter.Types.html#InternalInterp"><span class="hs-identifier hs-var">InternalInterp</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">(RemotePtr () -&gt; Ptr ()) -&gt; Maybe (RemotePtr ()) -&gt; Maybe (Ptr ())
forall a b. (a -&gt; b) -&gt; Maybe a -&gt; Maybe b
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-identifier hs-var">fmap</span></span><span> </span><span class="annot"><span class="annottext">RemotePtr () -&gt; Ptr ()
forall a. RemotePtr a -&gt; Ptr a
</span><a href="../../ghci-9.12.2-bd10/src/GHCi.RemoteTypes.html#fromRemotePtr"><span class="hs-identifier hs-var">fromRemotePtr</span></a></span><span> </span><span class="annot"><span class="annottext">(Maybe (RemotePtr ()) -&gt; Maybe (Ptr ()))
-&gt; IO (Maybe (RemotePtr ())) -&gt; IO (Maybe (Ptr ()))
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="annot"><span class="annottext">Message (Maybe (RemotePtr ())) -&gt; IO (Maybe (RemotePtr ()))
forall a. Message a -&gt; IO a
</span><a href="../../ghci-9.12.2-bd10/src/GHCi.Run.html#run"><span class="hs-identifier hs-var">run</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">RemotePtr LoadedDLL -&gt; String -&gt; Message (Maybe (RemotePtr ()))
</span><a href="../../ghci-9.12.2-bd10/src/GHCi.Message.html#LookupSymbolInDLL"><span class="hs-identifier hs-var">LookupSymbolInDLL</span></a></span><span> </span><span class="annot"><span class="annottext">RemotePtr LoadedDLL
</span><a href="#local-6989586621682961771"><span class="hs-identifier hs-var">dll</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">FastString -&gt; String
</span><a href="GHC.Data.FastString.html#unpackFS"><span class="hs-identifier hs-var">unpackFS</span></a></span><span> </span><span class="annot"><span class="annottext">FastString
</span><a href="#local-6989586621682961772"><span class="hs-identifier hs-var">str</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-cpp">
#endif
</span><span>    </span><span class="annot"><a href="GHC.Runtime.Interpreter.Types.html#ExternalInterp"><span class="hs-identifier hs-type">ExternalInterp</span></a></span><span> </span><span id="local-6989586621682961774"><span class="annot"><span class="annottext">ExtInterp
</span><a href="#local-6989586621682961774"><span class="hs-identifier hs-var">ext</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">ExtInterp
</span><a href="#local-6989586621682961774"><span class="hs-identifier hs-var">ext</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-474"></span><span>      </span><span class="annot"><a href="GHC.Runtime.Interpreter.Types.html#ExtIServ"><span class="hs-identifier hs-type">ExtIServ</span></a></span><span> </span><span id="local-6989586621682961775"><span class="annot"><span class="annottext">IServ
</span><a href="#local-6989586621682961775"><span class="hs-identifier hs-var">i</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">IServ
-&gt; (ExtInterpInstance () -&gt; IO (Maybe (Ptr ())))
-&gt; IO (Maybe (Ptr ()))
forall (m :: * -&gt; *) a.
ExceptionMonad m =&gt;
IServ -&gt; (ExtInterpInstance () -&gt; m a) -&gt; m a
</span><a href="GHC.Runtime.Interpreter.html#withIServ"><span class="hs-identifier hs-var">withIServ</span></a></span><span> </span><span class="annot"><span class="annottext">IServ
</span><a href="#local-6989586621682961775"><span class="hs-identifier hs-var">i</span></a></span><span> </span><span class="annot"><span class="annottext">((ExtInterpInstance () -&gt; IO (Maybe (Ptr ())))
 -&gt; IO (Maybe (Ptr ())))
-&gt; (ExtInterpInstance () -&gt; IO (Maybe (Ptr ())))
-&gt; IO (Maybe (Ptr ()))
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-glyph">\</span><span id="local-6989586621682961776"><span class="annot"><span class="annottext">ExtInterpInstance ()
</span><a href="#local-6989586621682961776"><span class="hs-identifier hs-var">inst</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">(RemotePtr () -&gt; Ptr ()) -&gt; Maybe (RemotePtr ()) -&gt; Maybe (Ptr ())
forall a b. (a -&gt; b) -&gt; Maybe a -&gt; Maybe b
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-identifier hs-var">fmap</span></span><span> </span><span class="annot"><span class="annottext">RemotePtr () -&gt; Ptr ()
forall a. RemotePtr a -&gt; Ptr a
</span><a href="../../ghci-9.12.2-bd10/src/GHCi.RemoteTypes.html#fromRemotePtr"><span class="hs-identifier hs-var">fromRemotePtr</span></a></span><span> </span><span class="annot"><span class="annottext">(Maybe (RemotePtr ()) -&gt; Maybe (Ptr ()))
-&gt; IO (Maybe (RemotePtr ())) -&gt; IO (Maybe (Ptr ()))
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-475"></span><span>        </span><span class="annot"><span class="annottext">IO (Maybe (RemotePtr ())) -&gt; IO (Maybe (RemotePtr ()))
forall a. IO a -&gt; IO a
</span><span class="hs-identifier hs-var">uninterruptibleMask_</span></span><span> </span><span class="annot"><span class="annottext">(IO (Maybe (RemotePtr ())) -&gt; IO (Maybe (RemotePtr ())))
-&gt; IO (Maybe (RemotePtr ())) -&gt; IO (Maybe (RemotePtr ()))
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-476"></span><span>          </span><span class="annot"><span class="annottext">ExtInterpInstance ()
-&gt; Message (Maybe (RemotePtr ())) -&gt; IO (Maybe (RemotePtr ()))
forall a d. Binary a =&gt; ExtInterpInstance d -&gt; Message a -&gt; IO a
</span><a href="GHC.Runtime.Interpreter.Process.html#sendMessage"><span class="hs-identifier hs-var">sendMessage</span></a></span><span> </span><span class="annot"><span class="annottext">ExtInterpInstance ()
</span><a href="#local-6989586621682961776"><span class="hs-identifier hs-var">inst</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">RemotePtr LoadedDLL -&gt; String -&gt; Message (Maybe (RemotePtr ()))
</span><a href="../../ghci-9.12.2-bd10/src/GHCi.Message.html#LookupSymbolInDLL"><span class="hs-identifier hs-var">LookupSymbolInDLL</span></a></span><span> </span><span class="annot"><span class="annottext">RemotePtr LoadedDLL
</span><a href="#local-6989586621682961771"><span class="hs-identifier hs-var">dll</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">FastString -&gt; String
</span><a href="GHC.Data.FastString.html#unpackFS"><span class="hs-identifier hs-var">unpackFS</span></a></span><span> </span><span class="annot"><span class="annottext">FastString
</span><a href="#local-6989586621682961772"><span class="hs-identifier hs-var">str</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-477"></span><span>      </span><span class="annot"><a href="GHC.Runtime.Interpreter.Types.html#ExtJS"><span class="hs-identifier hs-type">ExtJS</span></a></span><span> </span><span class="hs-special">{</span><span class="hs-special">}</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">String -&gt; SDoc -&gt; IO (Maybe (Ptr ()))
forall a. HasCallStack =&gt; String -&gt; SDoc -&gt; a
</span><a href="GHC.Utils.Panic.html#pprPanic"><span class="hs-identifier hs-var">pprPanic</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;lookupSymbol not supported by the JS interpreter&quot;</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">FastString -&gt; SDoc
forall a. Outputable a =&gt; a -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="annot"><span class="annottext">FastString
</span><a href="#local-6989586621682961772"><span class="hs-identifier hs-var">str</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-478"></span><span>      </span><span class="hs-comment">-- wasm dyld doesn't track which symbol comes from which .so</span><span>
</span><span id="line-479"></span><span>      </span><span class="annot"><a href="GHC.Runtime.Interpreter.Types.html#ExtWasm"><span class="hs-identifier hs-type">ExtWasm</span></a></span><span> </span><span class="hs-special">{</span><span class="hs-special">}</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Interp -&gt; FastString -&gt; IO (Maybe (Ptr ()))
</span><a href="GHC.Runtime.Interpreter.html#lookupSymbol"><span class="hs-identifier hs-var">lookupSymbol</span></a></span><span> </span><span class="annot"><span class="annottext">Interp
</span><a href="#local-6989586621682961770"><span class="hs-identifier hs-var">interp</span></a></span><span> </span><span class="annot"><span class="annottext">FastString
</span><a href="#local-6989586621682961772"><span class="hs-identifier hs-var">str</span></a></span><span>
</span><span id="line-480"></span><span>
</span><span id="line-481"></span><span class="annot"><a href="GHC.Runtime.Interpreter.html#lookupClosure"><span class="hs-identifier hs-type">lookupClosure</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Runtime.Interpreter.Types.html#Interp"><span class="hs-identifier hs-type">Interp</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">String</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Maybe</span></span><span> </span><span class="annot"><a href="../../ghci-9.12.2-bd10/src/GHCi.RemoteTypes.html#HValueRef"><span class="hs-identifier hs-type">HValueRef</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-482"></span><span id="lookupClosure"><span class="annot"><span class="annottext">lookupClosure :: Interp -&gt; String -&gt; IO (Maybe HValueRef)
</span><a href="GHC.Runtime.Interpreter.html#lookupClosure"><span class="hs-identifier hs-var hs-var">lookupClosure</span></a></span></span><span> </span><span id="local-6989586621682961777"><span class="annot"><span class="annottext">Interp
</span><a href="#local-6989586621682961777"><span class="hs-identifier hs-var">interp</span></a></span></span><span> </span><span id="local-6989586621682961778"><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621682961778"><span class="hs-identifier hs-var">str</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-483"></span><span>  </span><span class="annot"><span class="annottext">Interp -&gt; Message (Maybe HValueRef) -&gt; IO (Maybe HValueRef)
forall a. Binary a =&gt; Interp -&gt; Message a -&gt; IO a
</span><a href="GHC.Runtime.Interpreter.html#interpCmd"><span class="hs-identifier hs-var">interpCmd</span></a></span><span> </span><span class="annot"><span class="annottext">Interp
</span><a href="#local-6989586621682961777"><span class="hs-identifier hs-var">interp</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">String -&gt; Message (Maybe HValueRef)
</span><a href="../../ghci-9.12.2-bd10/src/GHCi.Message.html#LookupClosure"><span class="hs-identifier hs-var">LookupClosure</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621682961778"><span class="hs-identifier hs-var">str</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-484"></span><span>
</span><span id="line-485"></span><span class="hs-comment">-- | 'withSymbolCache' tries to find a symbol in the 'interpLookupSymbolCache'</span><span>
</span><span id="line-486"></span><span class="hs-comment">-- which maps symbols to the address where they are loaded.</span><span>
</span><span id="line-487"></span><span class="hs-comment">-- When there's a cache hit we simply return the cached address, when there is</span><span>
</span><span id="line-488"></span><span class="hs-comment">-- a miss we run the action which determines the symbol's address and populate</span><span>
</span><span id="line-489"></span><span class="hs-comment">-- the cache with the answer.</span><span>
</span><span id="line-490"></span><span class="annot"><a href="GHC.Runtime.Interpreter.html#withSymbolCache"><span class="hs-identifier hs-type">withSymbolCache</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Runtime.Interpreter.Types.html#Interp"><span class="hs-identifier hs-type">Interp</span></a></span><span>
</span><span id="line-491"></span><span>                </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Data.FastString.html#FastString"><span class="hs-identifier hs-type">FastString</span></a></span><span>
</span><span id="line-492"></span><span>                </span><span class="annot"><span class="hs-comment">-- ^ The symbol we are looking up in the cache</span></span><span>
</span><span id="line-493"></span><span>                </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Maybe</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Ptr</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-494"></span><span>                </span><span class="hs-comment">-- ^ An action which determines the address of the symbol we</span><span>
</span><span id="line-495"></span><span>                </span><span class="hs-comment">-- are looking up in the cache, which is run if there is a</span><span>
</span><span id="line-496"></span><span>                </span><span class="hs-comment">-- cache miss. The result will be cached.</span><span>
</span><span id="line-497"></span><span>                </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Maybe</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Ptr</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-498"></span><span id="withSymbolCache"><span class="annot"><span class="annottext">withSymbolCache :: Interp -&gt; FastString -&gt; IO (Maybe (Ptr ())) -&gt; IO (Maybe (Ptr ()))
</span><a href="GHC.Runtime.Interpreter.html#withSymbolCache"><span class="hs-identifier hs-var hs-var">withSymbolCache</span></a></span></span><span> </span><span id="local-6989586621682961781"><span class="annot"><span class="annottext">Interp
</span><a href="#local-6989586621682961781"><span class="hs-identifier hs-var">interp</span></a></span></span><span> </span><span id="local-6989586621682961782"><span class="annot"><span class="annottext">FastString
</span><a href="#local-6989586621682961782"><span class="hs-identifier hs-var">str</span></a></span></span><span> </span><span id="local-6989586621682961783"><span class="annot"><span class="annottext">IO (Maybe (Ptr ()))
</span><a href="#local-6989586621682961783"><span class="hs-identifier hs-var">determine_addr</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-499"></span><span>
</span><span id="line-500"></span><span>  </span><span class="hs-comment">-- Profiling of GHCi showed a lot of time and allocation spent</span><span>
</span><span id="line-501"></span><span>  </span><span class="hs-comment">-- making cross-process LookupSymbol calls, so I added a GHC-side</span><span>
</span><span id="line-502"></span><span>  </span><span class="hs-comment">-- cache which sped things up quite a lot. We have to be careful</span><span>
</span><span id="line-503"></span><span>  </span><span class="hs-comment">-- to purge this cache when unloading code though.</span><span>
</span><span id="line-504"></span><span>  </span><span class="hs-comment">--</span><span>
</span><span id="line-505"></span><span>  </span><span class="hs-comment">-- The analysis in #23415 further showed this cache should also benefit the</span><span>
</span><span id="line-506"></span><span>  </span><span class="hs-comment">-- internal interpreter's loading times, and needn't be used by the external</span><span>
</span><span id="line-507"></span><span>  </span><span class="hs-comment">-- interpreter only.</span><span>
</span><span id="line-508"></span><span>  </span><span id="local-6989586621682961784"><span class="annot"><a href="#local-6989586621682961784"><span class="hs-identifier hs-var">cache</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">MVar (UniqFM FastString (Ptr ()))
-&gt; IO (UniqFM FastString (Ptr ()))
forall a. MVar a -&gt; IO a
</span><span class="hs-identifier hs-var">readMVar</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Interp -&gt; MVar (UniqFM FastString (Ptr ()))
</span><a href="GHC.Runtime.Interpreter.Types.html#interpLookupSymbolCache"><span class="hs-identifier hs-var">interpLookupSymbolCache</span></a></span><span> </span><span class="annot"><span class="annottext">Interp
</span><a href="#local-6989586621682961781"><span class="hs-identifier hs-var">interp</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-509"></span><span>  </span><span class="hs-keyword">case</span><span> </span><span class="annot"><a href="GHC.Types.Unique.FM.html#lookupUFM"><span class="hs-identifier hs-type">lookupUFM</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682961784"><span class="hs-identifier hs-type">cache</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682961782"><span class="hs-identifier hs-type">str</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-510"></span><span>    </span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span id="local-6989586621682961786"><span class="annot"><span class="annottext">Ptr ()
</span><a href="#local-6989586621682961786"><span class="hs-identifier hs-var">p</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Maybe (Ptr ()) -&gt; IO (Maybe (Ptr ()))
forall a. a -&gt; IO a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Ptr () -&gt; Maybe (Ptr ())
forall a. a -&gt; Maybe a
</span><span class="hs-identifier hs-var">Just</span></span><span> </span><span class="annot"><span class="annottext">Ptr ()
</span><a href="#local-6989586621682961786"><span class="hs-identifier hs-var">p</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-511"></span><span>    </span><span class="annot"><span class="annottext">Maybe (Ptr ())
</span><span class="hs-identifier hs-var">Nothing</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-512"></span><span>
</span><span id="line-513"></span><span>      </span><span id="local-6989586621682961787"><span class="annot"><a href="#local-6989586621682961787"><span class="hs-identifier hs-var">maddr</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">IO (Maybe (Ptr ()))
</span><a href="#local-6989586621682961783"><span class="hs-identifier hs-var">determine_addr</span></a></span><span>
</span><span id="line-514"></span><span>      </span><span class="hs-keyword">case</span><span> </span><span class="annot"><a href="#local-6989586621682961787"><span class="hs-identifier hs-type">maddr</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-515"></span><span>        </span><span class="annot"><span class="annottext">Maybe (Ptr ())
</span><span class="hs-identifier hs-var">Nothing</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Maybe (Ptr ()) -&gt; IO (Maybe (Ptr ()))
forall a. a -&gt; IO a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="annot"><span class="annottext">Maybe (Ptr ())
forall a. Maybe a
</span><span class="hs-identifier hs-var">Nothing</span></span><span>
</span><span id="line-516"></span><span>        </span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span id="local-6989586621682961788"><span class="annot"><span class="annottext">Ptr ()
</span><a href="#local-6989586621682961788"><span class="hs-identifier hs-var">p</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-517"></span><span>          </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621682961789"><span class="annot"><span class="annottext">upd_cache :: UniqFM FastString (Ptr ()) -&gt; UniqFM FastString (Ptr ())
</span><a href="#local-6989586621682961789"><span class="hs-identifier hs-var hs-var hs-var">upd_cache</span></a></span></span><span> </span><span id="local-6989586621682961790"><span class="annot"><span class="annottext">UniqFM FastString (Ptr ())
</span><a href="#local-6989586621682961790"><span class="hs-identifier hs-var">cache'</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">UniqFM FastString (Ptr ())
-&gt; FastString -&gt; Ptr () -&gt; UniqFM FastString (Ptr ())
forall key elt.
Uniquable key =&gt;
UniqFM key elt -&gt; key -&gt; elt -&gt; UniqFM key elt
</span><a href="GHC.Types.Unique.FM.html#addToUFM"><span class="hs-identifier hs-var">addToUFM</span></a></span><span> </span><span class="annot"><span class="annottext">UniqFM FastString (Ptr ())
</span><a href="#local-6989586621682961790"><span class="hs-identifier hs-var">cache'</span></a></span><span> </span><span class="annot"><span class="annottext">FastString
</span><a href="#local-6989586621682961782"><span class="hs-identifier hs-var">str</span></a></span><span> </span><span class="annot"><span class="annottext">Ptr ()
</span><a href="#local-6989586621682961788"><span class="hs-identifier hs-var">p</span></a></span><span>
</span><span id="line-518"></span><span>          </span><span class="annot"><span class="annottext">MVar (UniqFM FastString (Ptr ()))
-&gt; (UniqFM FastString (Ptr ()) -&gt; IO (UniqFM FastString (Ptr ())))
-&gt; IO ()
forall a. MVar a -&gt; (a -&gt; IO a) -&gt; IO ()
</span><span class="hs-identifier hs-var">modifyMVar_</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Interp -&gt; MVar (UniqFM FastString (Ptr ()))
</span><a href="GHC.Runtime.Interpreter.Types.html#interpLookupSymbolCache"><span class="hs-identifier hs-var">interpLookupSymbolCache</span></a></span><span> </span><span class="annot"><span class="annottext">Interp
</span><a href="#local-6989586621682961781"><span class="hs-identifier hs-var">interp</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">UniqFM FastString (Ptr ()) -&gt; IO (UniqFM FastString (Ptr ()))
forall a. a -&gt; IO a
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">pure</span></span><span> </span><span class="annot"><span class="annottext">(UniqFM FastString (Ptr ()) -&gt; IO (UniqFM FastString (Ptr ())))
-&gt; (UniqFM FastString (Ptr ()) -&gt; UniqFM FastString (Ptr ()))
-&gt; UniqFM FastString (Ptr ())
-&gt; IO (UniqFM FastString (Ptr ()))
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">UniqFM FastString (Ptr ()) -&gt; UniqFM FastString (Ptr ())
</span><a href="#local-6989586621682961789"><span class="hs-identifier hs-var">upd_cache</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-519"></span><span>          </span><span class="annot"><span class="annottext">Maybe (Ptr ()) -&gt; IO (Maybe (Ptr ()))
forall a. a -&gt; IO a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Ptr () -&gt; Maybe (Ptr ())
forall a. a -&gt; Maybe a
</span><span class="hs-identifier hs-var">Just</span></span><span> </span><span class="annot"><span class="annottext">Ptr ()
</span><a href="#local-6989586621682961788"><span class="hs-identifier hs-var">p</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-520"></span><span>
</span><span id="line-521"></span><span class="annot"><a href="GHC.Runtime.Interpreter.html#purgeLookupSymbolCache"><span class="hs-identifier hs-type">purgeLookupSymbolCache</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Runtime.Interpreter.Types.html#Interp"><span class="hs-identifier hs-type">Interp</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-522"></span><span id="purgeLookupSymbolCache"><span class="annot"><span class="annottext">purgeLookupSymbolCache :: Interp -&gt; IO ()
</span><a href="GHC.Runtime.Interpreter.html#purgeLookupSymbolCache"><span class="hs-identifier hs-var hs-var">purgeLookupSymbolCache</span></a></span></span><span> </span><span id="local-6989586621682961793"><span class="annot"><span class="annottext">Interp
</span><a href="#local-6989586621682961793"><span class="hs-identifier hs-var">interp</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">MVar (UniqFM FastString (Ptr ()))
-&gt; (UniqFM FastString (Ptr ()) -&gt; IO (UniqFM FastString (Ptr ())))
-&gt; IO ()
forall a. MVar a -&gt; (a -&gt; IO a) -&gt; IO ()
</span><span class="hs-identifier hs-var">modifyMVar_</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Interp -&gt; MVar (UniqFM FastString (Ptr ()))
</span><a href="GHC.Runtime.Interpreter.Types.html#interpLookupSymbolCache"><span class="hs-identifier hs-var">interpLookupSymbolCache</span></a></span><span> </span><span class="annot"><span class="annottext">Interp
</span><a href="#local-6989586621682961793"><span class="hs-identifier hs-var">interp</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">IO (UniqFM FastString (Ptr ()))
-&gt; UniqFM FastString (Ptr ()) -&gt; IO (UniqFM FastString (Ptr ()))
forall a b. a -&gt; b -&gt; a
</span><span class="hs-identifier hs-var">const</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">UniqFM FastString (Ptr ()) -&gt; IO (UniqFM FastString (Ptr ()))
forall a. a -&gt; IO a
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">pure</span></span><span> </span><span class="annot"><span class="annottext">UniqFM FastString (Ptr ())
forall {k} (key :: k) elt. UniqFM key elt
</span><a href="GHC.Types.Unique.FM.html#emptyUFM"><span class="hs-identifier hs-var">emptyUFM</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-523"></span><span>
</span><span id="line-524"></span><span class="hs-comment">-- | loadDLL loads a dynamic library using the OS's native linker</span><span>
</span><span id="line-525"></span><span class="hs-comment">-- (i.e. dlopen() on Unix, LoadLibrary() on Windows).  It takes either</span><span>
</span><span id="line-526"></span><span class="hs-comment">-- an absolute pathname to the file, or a relative filename</span><span>
</span><span id="line-527"></span><span class="hs-comment">-- (e.g. &quot;libfoo.so&quot; or &quot;foo.dll&quot;).  In the latter case, loadDLL</span><span>
</span><span id="line-528"></span><span class="hs-comment">-- searches the standard locations for the appropriate library.</span><span>
</span><span id="line-529"></span><span class="annot"><a href="GHC.Runtime.Interpreter.html#loadDLL"><span class="hs-identifier hs-type">loadDLL</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Runtime.Interpreter.Types.html#Interp"><span class="hs-identifier hs-type">Interp</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">String</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Either</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">String</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../../ghci-9.12.2-bd10/src/GHCi.RemoteTypes.html#RemotePtr"><span class="hs-identifier hs-type">RemotePtr</span></a></span><span> </span><span class="annot"><a href="../../ghci-9.12.2-bd10/src/GHCi.Message.html#LoadedDLL"><span class="hs-identifier hs-type">LoadedDLL</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-530"></span><span id="loadDLL"><span class="annot"><span class="annottext">loadDLL :: Interp -&gt; String -&gt; IO (Either String (RemotePtr LoadedDLL))
</span><a href="GHC.Runtime.Interpreter.html#loadDLL"><span class="hs-identifier hs-var hs-var">loadDLL</span></a></span></span><span> </span><span id="local-6989586621682961796"><span class="annot"><span class="annottext">Interp
</span><a href="#local-6989586621682961796"><span class="hs-identifier hs-var">interp</span></a></span></span><span> </span><span id="local-6989586621682961797"><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621682961797"><span class="hs-identifier hs-var">str</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Interp
-&gt; Message (Either String (RemotePtr LoadedDLL))
-&gt; IO (Either String (RemotePtr LoadedDLL))
forall a. Binary a =&gt; Interp -&gt; Message a -&gt; IO a
</span><a href="GHC.Runtime.Interpreter.html#interpCmd"><span class="hs-identifier hs-var">interpCmd</span></a></span><span> </span><span class="annot"><span class="annottext">Interp
</span><a href="#local-6989586621682961796"><span class="hs-identifier hs-var">interp</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">String -&gt; Message (Either String (RemotePtr LoadedDLL))
</span><a href="../../ghci-9.12.2-bd10/src/GHCi.Message.html#LoadDLL"><span class="hs-identifier hs-var">LoadDLL</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621682961797"><span class="hs-identifier hs-var">str</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-531"></span><span>
</span><span id="line-532"></span><span class="annot"><a href="GHC.Runtime.Interpreter.html#loadArchive"><span class="hs-identifier hs-type">loadArchive</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Runtime.Interpreter.Types.html#Interp"><span class="hs-identifier hs-type">Interp</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">String</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-533"></span><span id="loadArchive"><span class="annot"><span class="annottext">loadArchive :: Interp -&gt; String -&gt; IO ()
</span><a href="GHC.Runtime.Interpreter.html#loadArchive"><span class="hs-identifier hs-var hs-var">loadArchive</span></a></span></span><span> </span><span id="local-6989586621682961799"><span class="annot"><span class="annottext">Interp
</span><a href="#local-6989586621682961799"><span class="hs-identifier hs-var">interp</span></a></span></span><span> </span><span id="local-6989586621682961800"><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621682961800"><span class="hs-identifier hs-var">path</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-534"></span><span>  </span><span id="local-6989586621682961801"><span class="annot"><a href="#local-6989586621682961801"><span class="hs-identifier hs-var">path'</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">String -&gt; IO String
</span><a href="../../directory-1.3.9.0-af18/src/System.Directory.html#canonicalizePath"><span class="hs-identifier hs-var">canonicalizePath</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621682961800"><span class="hs-identifier hs-var">path</span></a></span><span> </span><span class="hs-comment">-- Note [loadObj and relative paths]</span><span>
</span><span id="line-535"></span><span>  </span><span class="annot"><a href="GHC.Runtime.Interpreter.html#interpCmd"><span class="hs-identifier hs-type">interpCmd</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682961799"><span class="hs-identifier hs-type">interp</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../../ghci-9.12.2-bd10/src/GHCi.Message.html#LoadArchive"><span class="hs-identifier hs-type">LoadArchive</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682961801"><span class="hs-identifier hs-type">path'</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-536"></span><span>
</span><span id="line-537"></span><span class="annot"><a href="GHC.Runtime.Interpreter.html#loadObj"><span class="hs-identifier hs-type">loadObj</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Runtime.Interpreter.Types.html#Interp"><span class="hs-identifier hs-type">Interp</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">String</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-538"></span><span id="loadObj"><span class="annot"><span class="annottext">loadObj :: Interp -&gt; String -&gt; IO ()
</span><a href="GHC.Runtime.Interpreter.html#loadObj"><span class="hs-identifier hs-var hs-var">loadObj</span></a></span></span><span> </span><span id="local-6989586621682961804"><span class="annot"><span class="annottext">Interp
</span><a href="#local-6989586621682961804"><span class="hs-identifier hs-var">interp</span></a></span></span><span> </span><span id="local-6989586621682961805"><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621682961805"><span class="hs-identifier hs-var">path</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-539"></span><span>  </span><span id="local-6989586621682961806"><span class="annot"><a href="#local-6989586621682961806"><span class="hs-identifier hs-var">path'</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">String -&gt; IO String
</span><a href="../../directory-1.3.9.0-af18/src/System.Directory.html#canonicalizePath"><span class="hs-identifier hs-var">canonicalizePath</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621682961805"><span class="hs-identifier hs-var">path</span></a></span><span> </span><span class="hs-comment">-- Note [loadObj and relative paths]</span><span>
</span><span id="line-540"></span><span>  </span><span class="annot"><a href="GHC.Runtime.Interpreter.html#interpCmd"><span class="hs-identifier hs-type">interpCmd</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682961804"><span class="hs-identifier hs-type">interp</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../../ghci-9.12.2-bd10/src/GHCi.Message.html#LoadObj"><span class="hs-identifier hs-type">LoadObj</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682961806"><span class="hs-identifier hs-type">path'</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-541"></span><span>
</span><span id="line-542"></span><span class="annot"><a href="GHC.Runtime.Interpreter.html#unloadObj"><span class="hs-identifier hs-type">unloadObj</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Runtime.Interpreter.Types.html#Interp"><span class="hs-identifier hs-type">Interp</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">String</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-543"></span><span id="unloadObj"><span class="annot"><span class="annottext">unloadObj :: Interp -&gt; String -&gt; IO ()
</span><a href="GHC.Runtime.Interpreter.html#unloadObj"><span class="hs-identifier hs-var hs-var">unloadObj</span></a></span></span><span> </span><span id="local-6989586621682961808"><span class="annot"><span class="annottext">Interp
</span><a href="#local-6989586621682961808"><span class="hs-identifier hs-var">interp</span></a></span></span><span> </span><span id="local-6989586621682961809"><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621682961809"><span class="hs-identifier hs-var">path</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-544"></span><span>  </span><span id="local-6989586621682961810"><span class="annot"><a href="#local-6989586621682961810"><span class="hs-identifier hs-var">path'</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">String -&gt; IO String
</span><a href="../../directory-1.3.9.0-af18/src/System.Directory.html#canonicalizePath"><span class="hs-identifier hs-var">canonicalizePath</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621682961809"><span class="hs-identifier hs-var">path</span></a></span><span> </span><span class="hs-comment">-- Note [loadObj and relative paths]</span><span>
</span><span id="line-545"></span><span>  </span><span class="annot"><a href="GHC.Runtime.Interpreter.html#interpCmd"><span class="hs-identifier hs-type">interpCmd</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682961808"><span class="hs-identifier hs-type">interp</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../../ghci-9.12.2-bd10/src/GHCi.Message.html#UnloadObj"><span class="hs-identifier hs-type">UnloadObj</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682961810"><span class="hs-identifier hs-type">path'</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-546"></span><span>
</span><span id="line-547"></span><span class="hs-comment">-- Note [loadObj and relative paths]</span><span>
</span><span id="line-548"></span><span class="hs-comment">-- ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~</span><span>
</span><span id="line-549"></span><span class="hs-comment">-- the iserv process might have a different current directory from the</span><span>
</span><span id="line-550"></span><span class="hs-comment">-- GHC process, so we must make paths absolute before sending them</span><span>
</span><span id="line-551"></span><span class="hs-comment">-- over.</span><span>
</span><span id="line-552"></span><span>
</span><span id="line-553"></span><span class="annot"><a href="GHC.Runtime.Interpreter.html#addLibrarySearchPath"><span class="hs-identifier hs-type">addLibrarySearchPath</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Runtime.Interpreter.Types.html#Interp"><span class="hs-identifier hs-type">Interp</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">String</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Ptr</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-554"></span><span id="addLibrarySearchPath"><span class="annot"><span class="annottext">addLibrarySearchPath :: Interp -&gt; String -&gt; IO (Ptr ())
</span><a href="GHC.Runtime.Interpreter.html#addLibrarySearchPath"><span class="hs-identifier hs-var hs-var">addLibrarySearchPath</span></a></span></span><span> </span><span id="local-6989586621682961812"><span class="annot"><span class="annottext">Interp
</span><a href="#local-6989586621682961812"><span class="hs-identifier hs-var">interp</span></a></span></span><span> </span><span id="local-6989586621682961813"><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621682961813"><span class="hs-identifier hs-var">str</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-555"></span><span>  </span><span class="annot"><span class="annottext">RemotePtr () -&gt; Ptr ()
forall a. RemotePtr a -&gt; Ptr a
</span><a href="../../ghci-9.12.2-bd10/src/GHCi.RemoteTypes.html#fromRemotePtr"><span class="hs-identifier hs-var">fromRemotePtr</span></a></span><span> </span><span class="annot"><span class="annottext">(RemotePtr () -&gt; Ptr ()) -&gt; IO (RemotePtr ()) -&gt; IO (Ptr ())
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="annot"><span class="annottext">Interp -&gt; Message (RemotePtr ()) -&gt; IO (RemotePtr ())
forall a. Binary a =&gt; Interp -&gt; Message a -&gt; IO a
</span><a href="GHC.Runtime.Interpreter.html#interpCmd"><span class="hs-identifier hs-var">interpCmd</span></a></span><span> </span><span class="annot"><span class="annottext">Interp
</span><a href="#local-6989586621682961812"><span class="hs-identifier hs-var">interp</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">String -&gt; Message (RemotePtr ())
</span><a href="../../ghci-9.12.2-bd10/src/GHCi.Message.html#AddLibrarySearchPath"><span class="hs-identifier hs-var">AddLibrarySearchPath</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621682961813"><span class="hs-identifier hs-var">str</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-556"></span><span>
</span><span id="line-557"></span><span class="annot"><a href="GHC.Runtime.Interpreter.html#removeLibrarySearchPath"><span class="hs-identifier hs-type">removeLibrarySearchPath</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Runtime.Interpreter.Types.html#Interp"><span class="hs-identifier hs-type">Interp</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Ptr</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Bool</span></span><span>
</span><span id="line-558"></span><span id="removeLibrarySearchPath"><span class="annot"><span class="annottext">removeLibrarySearchPath :: Interp -&gt; Ptr () -&gt; IO Bool
</span><a href="GHC.Runtime.Interpreter.html#removeLibrarySearchPath"><span class="hs-identifier hs-var hs-var">removeLibrarySearchPath</span></a></span></span><span> </span><span id="local-6989586621682961815"><span class="annot"><span class="annottext">Interp
</span><a href="#local-6989586621682961815"><span class="hs-identifier hs-var">interp</span></a></span></span><span> </span><span id="local-6989586621682961816"><span class="annot"><span class="annottext">Ptr ()
</span><a href="#local-6989586621682961816"><span class="hs-identifier hs-var">p</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-559"></span><span>  </span><span class="annot"><span class="annottext">Interp -&gt; Message Bool -&gt; IO Bool
forall a. Binary a =&gt; Interp -&gt; Message a -&gt; IO a
</span><a href="GHC.Runtime.Interpreter.html#interpCmd"><span class="hs-identifier hs-var">interpCmd</span></a></span><span> </span><span class="annot"><span class="annottext">Interp
</span><a href="#local-6989586621682961815"><span class="hs-identifier hs-var">interp</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">RemotePtr () -&gt; Message Bool
</span><a href="../../ghci-9.12.2-bd10/src/GHCi.Message.html#RemoveLibrarySearchPath"><span class="hs-identifier hs-var">RemoveLibrarySearchPath</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Ptr () -&gt; RemotePtr ()
forall a. Ptr a -&gt; RemotePtr a
</span><a href="../../ghci-9.12.2-bd10/src/GHCi.RemoteTypes.html#toRemotePtr"><span class="hs-identifier hs-var">toRemotePtr</span></a></span><span> </span><span class="annot"><span class="annottext">Ptr ()
</span><a href="#local-6989586621682961816"><span class="hs-identifier hs-var">p</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-560"></span><span>
</span><span id="line-561"></span><span class="annot"><a href="GHC.Runtime.Interpreter.html#resolveObjs"><span class="hs-identifier hs-type">resolveObjs</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Runtime.Interpreter.Types.html#Interp"><span class="hs-identifier hs-type">Interp</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="annot"><a href="GHC.Types.Basic.html#SuccessFlag"><span class="hs-identifier hs-type">SuccessFlag</span></a></span><span>
</span><span id="line-562"></span><span id="resolveObjs"><span class="annot"><span class="annottext">resolveObjs :: Interp -&gt; IO SuccessFlag
</span><a href="GHC.Runtime.Interpreter.html#resolveObjs"><span class="hs-identifier hs-var hs-var">resolveObjs</span></a></span></span><span> </span><span id="local-6989586621682961819"><span class="annot"><span class="annottext">Interp
</span><a href="#local-6989586621682961819"><span class="hs-identifier hs-var">interp</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Bool -&gt; SuccessFlag
</span><a href="GHC.Types.Basic.html#successIf"><span class="hs-identifier hs-var">successIf</span></a></span><span> </span><span class="annot"><span class="annottext">(Bool -&gt; SuccessFlag) -&gt; IO Bool -&gt; IO SuccessFlag
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="annot"><span class="annottext">Interp -&gt; Message Bool -&gt; IO Bool
forall a. Binary a =&gt; Interp -&gt; Message a -&gt; IO a
</span><a href="GHC.Runtime.Interpreter.html#interpCmd"><span class="hs-identifier hs-var">interpCmd</span></a></span><span> </span><span class="annot"><span class="annottext">Interp
</span><a href="#local-6989586621682961819"><span class="hs-identifier hs-var">interp</span></a></span><span> </span><span class="annot"><span class="annottext">Message Bool
</span><a href="../../ghci-9.12.2-bd10/src/GHCi.Message.html#ResolveObjs"><span class="hs-identifier hs-var">ResolveObjs</span></a></span><span>
</span><span id="line-563"></span><span>
</span><span id="line-564"></span><span class="annot"><a href="GHC.Runtime.Interpreter.html#findSystemLibrary"><span class="hs-identifier hs-type">findSystemLibrary</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Runtime.Interpreter.Types.html#Interp"><span class="hs-identifier hs-type">Interp</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">String</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Maybe</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">String</span></span><span class="hs-special">)</span><span>
</span><span id="line-565"></span><span id="findSystemLibrary"><span class="annot"><span class="annottext">findSystemLibrary :: Interp -&gt; String -&gt; IO (Maybe String)
</span><a href="GHC.Runtime.Interpreter.html#findSystemLibrary"><span class="hs-identifier hs-var hs-var">findSystemLibrary</span></a></span></span><span> </span><span id="local-6989586621682961822"><span class="annot"><span class="annottext">Interp
</span><a href="#local-6989586621682961822"><span class="hs-identifier hs-var">interp</span></a></span></span><span> </span><span id="local-6989586621682961823"><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621682961823"><span class="hs-identifier hs-var">str</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Interp -&gt; Message (Maybe String) -&gt; IO (Maybe String)
forall a. Binary a =&gt; Interp -&gt; Message a -&gt; IO a
</span><a href="GHC.Runtime.Interpreter.html#interpCmd"><span class="hs-identifier hs-var">interpCmd</span></a></span><span> </span><span class="annot"><span class="annottext">Interp
</span><a href="#local-6989586621682961822"><span class="hs-identifier hs-var">interp</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">String -&gt; Message (Maybe String)
</span><a href="../../ghci-9.12.2-bd10/src/GHCi.Message.html#FindSystemLibrary"><span class="hs-identifier hs-var">FindSystemLibrary</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621682961823"><span class="hs-identifier hs-var">str</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-566"></span><span>
</span><span id="line-567"></span><span class="hs-comment">-- -----------------------------------------------------------------------------</span><span>
</span><span id="line-568"></span><span class="hs-comment">-- IServ specific calls and messages</span><span>
</span><span id="line-569"></span><span>
</span><span id="line-570"></span><span class="annot"><span class="hs-comment">-- | Spawn an external interpreter</span></span><span>
</span><span id="line-571"></span><span class="annot"><a href="GHC.Runtime.Interpreter.html#spawnIServ"><span class="hs-identifier hs-type">spawnIServ</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Runtime.Interpreter.Types.html#IServConfig"><span class="hs-identifier hs-type">IServConfig</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Runtime.Interpreter.Types.html#ExtInterpInstance"><span class="hs-identifier hs-type">ExtInterpInstance</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-572"></span><span id="spawnIServ"><span class="annot"><span class="annottext">spawnIServ :: IServConfig -&gt; IO (ExtInterpInstance ())
</span><a href="GHC.Runtime.Interpreter.html#spawnIServ"><span class="hs-identifier hs-var hs-var">spawnIServ</span></a></span></span><span> </span><span id="local-6989586621682961825"><span class="annot"><span class="annottext">IServConfig
</span><a href="#local-6989586621682961825"><span class="hs-identifier hs-var">conf</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-573"></span><span>  </span><span class="annot"><span class="annottext">IServConfig -&gt; IO ()
</span><a href="GHC.Runtime.Interpreter.Types.html#iservConfTrace"><span class="hs-identifier hs-var">iservConfTrace</span></a></span><span> </span><span class="annot"><span class="annottext">IServConfig
</span><a href="#local-6989586621682961825"><span class="hs-identifier hs-var">conf</span></a></span><span>
</span><span id="line-574"></span><span>  </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621682961827"><span class="annot"><span class="annottext">createProc :: CreateProcess -&gt; IO ProcessHandle
</span><a href="#local-6989586621682961827"><span class="hs-identifier hs-var hs-var hs-var">createProc</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(CreateProcess -&gt; IO ProcessHandle)
-&gt; Maybe (CreateProcess -&gt; IO ProcessHandle)
-&gt; CreateProcess
-&gt; IO ProcessHandle
forall a. a -&gt; Maybe a -&gt; a
</span><span class="hs-identifier hs-var">fromMaybe</span></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span id="local-6989586621682961829"><span class="annot"><span class="annottext">CreateProcess
</span><a href="#local-6989586621682961829"><span class="hs-identifier hs-var">cp</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">_</span></span><span class="hs-special">,</span><span class="annot"><span class="hs-identifier">_</span></span><span class="hs-special">,</span><span class="annot"><span class="hs-identifier">_</span></span><span class="hs-special">,</span><span id="local-6989586621682961830"><span class="annot"><a href="#local-6989586621682961830"><span class="hs-identifier hs-var">ph</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">CreateProcess
-&gt; IO (Maybe Handle, Maybe Handle, Maybe Handle, ProcessHandle)
</span><a href="../../process-1.6.25.0-5f54/src/System.Process.html#createProcess"><span class="hs-identifier hs-var">createProcess</span></a></span><span> </span><span class="annot"><span class="annottext">CreateProcess
</span><a href="#local-6989586621682961829"><span class="hs-identifier hs-var">cp</span></a></span><span>
</span><span id="line-575"></span><span>                                        </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">return</span></span><span> </span><span class="annot"><a href="#local-6989586621682961830"><span class="hs-identifier hs-type">ph</span></a></span><span> </span><span class="hs-special">}</span><span class="hs-special">)</span><span>
</span><span id="line-576"></span><span>                             </span><span class="hs-special">(</span><span class="annot"><span class="annottext">IServConfig -&gt; Maybe (CreateProcess -&gt; IO ProcessHandle)
</span><a href="GHC.Runtime.Interpreter.Types.html#iservConfHook"><span class="hs-identifier hs-var">iservConfHook</span></a></span><span> </span><span class="annot"><span class="annottext">IServConfig
</span><a href="#local-6989586621682961825"><span class="hs-identifier hs-var">conf</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-577"></span><span>  </span><span class="hs-special">(</span><span id="local-6989586621682961833"><span class="annot"><a href="#local-6989586621682961833"><span class="hs-identifier hs-var">ph</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682961834"><span class="annot"><a href="#local-6989586621682961834"><span class="hs-identifier hs-var">rh</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682961835"><span class="annot"><a href="#local-6989586621682961835"><span class="hs-identifier hs-var">wh</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">(CreateProcess -&gt; IO ProcessHandle)
-&gt; String
-&gt; [String]
-&gt; [String]
-&gt; IO (ProcessHandle, Handle, Handle)
</span><a href="GHC.Runtime.Utils.html#runWithPipes"><span class="hs-identifier hs-var">runWithPipes</span></a></span><span> </span><span class="annot"><span class="annottext">CreateProcess -&gt; IO ProcessHandle
</span><a href="#local-6989586621682961827"><span class="hs-identifier hs-var">createProc</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">IServConfig -&gt; String
</span><a href="GHC.Runtime.Interpreter.Types.html#iservConfProgram"><span class="hs-identifier hs-var">iservConfProgram</span></a></span><span> </span><span class="annot"><span class="annottext">IServConfig
</span><a href="#local-6989586621682961825"><span class="hs-identifier hs-var">conf</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-578"></span><span>                                          </span><span class="hs-special">[</span><span class="hs-special">]</span><span>
</span><span id="line-579"></span><span>                                          </span><span class="hs-special">(</span><span class="annot"><span class="annottext">IServConfig -&gt; [String]
</span><a href="GHC.Runtime.Interpreter.Types.html#iservConfOpts"><span class="hs-identifier hs-var">iservConfOpts</span></a></span><span>    </span><span class="annot"><span class="annottext">IServConfig
</span><a href="#local-6989586621682961825"><span class="hs-identifier hs-var">conf</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-580"></span><span>  </span><span id="local-6989586621682961839"><span class="annot"><a href="#local-6989586621682961839"><span class="hs-identifier hs-var">lo_ref</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="hs-identifier hs-type">newIORef</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Nothing</span></span><span>
</span><span id="line-581"></span><span>  </span><span id="local-6989586621682961841"><span class="annot"><a href="#local-6989586621682961841"><span class="hs-identifier hs-var">lock</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="hs-identifier hs-type">newMVar</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-582"></span><span>  </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621682961843"><span class="annot"><a href="#local-6989586621682961843"><span class="hs-identifier hs-var hs-var">pipe</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="../../ghci-9.12.2-bd10/src/GHCi.Message.html#Pipe"><span class="hs-identifier hs-type">Pipe</span></a></span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">pipeRead :: Handle
</span><a href="../../ghci-9.12.2-bd10/src/GHCi.Message.html#pipeRead"><span class="hs-identifier hs-var">pipeRead</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Handle
</span><a href="#local-6989586621682961834"><span class="hs-identifier hs-var">rh</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">pipeWrite :: Handle
</span><a href="../../ghci-9.12.2-bd10/src/GHCi.Message.html#pipeWrite"><span class="hs-identifier hs-var">pipeWrite</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Handle
</span><a href="#local-6989586621682961835"><span class="hs-identifier hs-var">wh</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">pipeLeftovers :: IORef (Maybe ByteString)
</span><a href="../../ghci-9.12.2-bd10/src/GHCi.Message.html#pipeLeftovers"><span class="hs-identifier hs-var">pipeLeftovers</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">IORef (Maybe ByteString)
</span><a href="#local-6989586621682961839"><span class="hs-identifier hs-var">lo_ref</span></a></span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-583"></span><span>  </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621682961848"><span class="annot"><a href="#local-6989586621682961848"><span class="hs-identifier hs-var hs-var">process</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="GHC.Runtime.Interpreter.Types.html#InterpProcess"><span class="hs-identifier hs-type">InterpProcess</span></a></span><span>
</span><span id="line-584"></span><span>                  </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">interpHandle :: ProcessHandle
</span><a href="GHC.Runtime.Interpreter.Types.html#interpHandle"><span class="hs-identifier hs-var">interpHandle</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ProcessHandle
</span><a href="#local-6989586621682961833"><span class="hs-identifier hs-var">ph</span></a></span><span>
</span><span id="line-585"></span><span>                  </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">interpPipe :: Pipe
</span><a href="GHC.Runtime.Interpreter.Types.html#interpPipe"><span class="hs-identifier hs-var">interpPipe</span></a></span><span>   </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Pipe
</span><a href="#local-6989586621682961843"><span class="hs-identifier hs-var">pipe</span></a></span><span>
</span><span id="line-586"></span><span>                  </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">interpLock :: MVar ()
</span><a href="GHC.Runtime.Interpreter.Types.html#interpLock"><span class="hs-identifier hs-var">interpLock</span></a></span><span>   </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">MVar ()
</span><a href="#local-6989586621682961841"><span class="hs-identifier hs-var">lock</span></a></span><span>
</span><span id="line-587"></span><span>                  </span><span class="hs-special">}</span><span>
</span><span id="line-588"></span><span>
</span><span id="line-589"></span><span>  </span><span id="local-6989586621682961853"><span class="annot"><a href="#local-6989586621682961853"><span class="hs-identifier hs-var">pending_frees</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="hs-identifier hs-type">newMVar</span></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span>
</span><span id="line-590"></span><span>  </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621682961854"><span class="annot"><a href="#local-6989586621682961854"><span class="hs-identifier hs-var hs-var">inst</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="GHC.Runtime.Interpreter.Types.html#ExtInterpInstance"><span class="hs-identifier hs-type">ExtInterpInstance</span></a></span><span>
</span><span id="line-591"></span><span>        </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">instProcess :: InterpProcess
</span><a href="GHC.Runtime.Interpreter.Types.html#instProcess"><span class="hs-identifier hs-var">instProcess</span></a></span><span>           </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">InterpProcess
</span><a href="#local-6989586621682961848"><span class="hs-identifier hs-var">process</span></a></span><span>
</span><span id="line-592"></span><span>        </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">instPendingFrees :: MVar [HValueRef]
</span><a href="GHC.Runtime.Interpreter.Types.html#instPendingFrees"><span class="hs-identifier hs-var">instPendingFrees</span></a></span><span>      </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">MVar [HValueRef]
</span><a href="#local-6989586621682961853"><span class="hs-identifier hs-var">pending_frees</span></a></span><span>
</span><span id="line-593"></span><span>        </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">instExtra :: ()
</span><a href="GHC.Runtime.Interpreter.Types.html#instExtra"><span class="hs-identifier hs-var">instExtra</span></a></span><span>             </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-594"></span><span>        </span><span class="hs-special">}</span><span>
</span><span id="line-595"></span><span>  </span><span class="annot"><span class="hs-identifier hs-type">pure</span></span><span> </span><span class="annot"><a href="#local-6989586621682961854"><span class="hs-identifier hs-type">inst</span></a></span><span>
</span><span id="line-596"></span><span>
</span><span id="line-597"></span><span class="annot"><span class="hs-comment">-- | Stop the interpreter</span></span><span>
</span><span id="line-598"></span><span class="annot"><a href="GHC.Runtime.Interpreter.html#stopInterp"><span class="hs-identifier hs-type">stopInterp</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Runtime.Interpreter.Types.html#Interp"><span class="hs-identifier hs-type">Interp</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-599"></span><span id="stopInterp"><span class="annot"><span class="annottext">stopInterp :: Interp -&gt; IO ()
</span><a href="GHC.Runtime.Interpreter.html#stopInterp"><span class="hs-identifier hs-var hs-var">stopInterp</span></a></span></span><span> </span><span id="local-6989586621682961858"><span class="annot"><span class="annottext">Interp
</span><a href="#local-6989586621682961858"><span class="hs-identifier hs-var">interp</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">Interp -&gt; InterpInstance
</span><a href="GHC.Runtime.Interpreter.Types.html#interpInstance"><span class="hs-identifier hs-var">interpInstance</span></a></span><span> </span><span class="annot"><span class="annottext">Interp
</span><a href="#local-6989586621682961858"><span class="hs-identifier hs-var">interp</span></a></span><span> </span><span class="hs-keyword">of</span><span class="hs-cpp">
#if defined(HAVE_INTERNAL_INTERPRETER)
</span><span>    </span><span class="annot"><span class="annottext">InterpInstance
</span><a href="GHC.Runtime.Interpreter.Types.html#InternalInterp"><span class="hs-identifier hs-var">InternalInterp</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">() -&gt; IO ()
forall a. a -&gt; IO a
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">pure</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span class="hs-cpp">
#endif
</span><span>    </span><span class="annot"><a href="GHC.Runtime.Interpreter.Types.html#ExternalInterp"><span class="hs-identifier hs-type">ExternalInterp</span></a></span><span> </span><span id="local-6989586621682961859"><span class="annot"><span class="annottext">ExtInterp
</span><a href="#local-6989586621682961859"><span class="hs-identifier hs-var">ext</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">ExtInterp -&gt; (forall d. ExtInterpStatusVar d -&gt; IO ()) -&gt; IO ()
forall {k} (m :: k -&gt; *) (a :: k).
ExtInterp -&gt; (forall d. ExtInterpStatusVar d -&gt; m a) -&gt; m a
</span><a href="GHC.Runtime.Interpreter.html#withExtInterpStatus"><span class="hs-identifier hs-var">withExtInterpStatus</span></a></span><span> </span><span class="annot"><span class="annottext">ExtInterp
</span><a href="#local-6989586621682961859"><span class="hs-identifier hs-var">ext</span></a></span><span> </span><span class="annot"><span class="annottext">((forall d. ExtInterpStatusVar d -&gt; IO ()) -&gt; IO ())
-&gt; (forall d. ExtInterpStatusVar d -&gt; IO ()) -&gt; IO ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-glyph">\</span><span id="local-6989586621682961869"><span class="annot"><span class="annottext">ExtInterpStatusVar d
</span><a href="#local-6989586621682961869"><span class="hs-identifier hs-var">mstate</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-604"></span><span>      </span><span class="annot"><span class="annottext">((forall a. IO a -&gt; IO a) -&gt; IO ()) -&gt; IO ()
forall b.
HasCallStack =&gt;
((forall a. IO a -&gt; IO a) -&gt; IO b) -&gt; IO b
forall (m :: * -&gt; *) b.
(MonadMask m, HasCallStack) =&gt;
((forall a. m a -&gt; m a) -&gt; m b) -&gt; m b
</span><a href="../../exceptions-0.10.9-4d2e/src/Control.Monad.Catch.html#mask"><span class="hs-identifier hs-var">MC.mask</span></a></span><span> </span><span class="annot"><span class="annottext">(((forall a. IO a -&gt; IO a) -&gt; IO ()) -&gt; IO ())
-&gt; ((forall a. IO a -&gt; IO a) -&gt; IO ()) -&gt; IO ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-glyph">\</span><span id="local-6989586621682961870"><span class="annot"><span class="annottext">forall a. IO a -&gt; IO a
</span><a href="#local-6989586621682961870"><span class="hs-identifier hs-var">_restore</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">ExtInterpStatusVar d
-&gt; (InterpStatus (ExtInterpInstance d)
    -&gt; IO (InterpStatus (ExtInterpInstance d)))
-&gt; IO ()
forall a. MVar a -&gt; (a -&gt; IO a) -&gt; IO ()
</span><span class="hs-identifier hs-var">modifyMVar_</span></span><span> </span><span class="annot"><span class="annottext">ExtInterpStatusVar d
</span><a href="#local-6989586621682961869"><span class="hs-identifier hs-var">mstate</span></a></span><span> </span><span class="annot"><span class="annottext">((InterpStatus (ExtInterpInstance d)
  -&gt; IO (InterpStatus (ExtInterpInstance d)))
 -&gt; IO ())
-&gt; (InterpStatus (ExtInterpInstance d)
    -&gt; IO (InterpStatus (ExtInterpInstance d)))
-&gt; IO ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-glyph">\</span><span id="local-6989586621682961871"><span class="annot"><span class="annottext">InterpStatus (ExtInterpInstance d)
</span><a href="#local-6989586621682961871"><span class="hs-identifier hs-var">state</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-605"></span><span>        </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">InterpStatus (ExtInterpInstance d)
</span><a href="#local-6989586621682961871"><span class="hs-identifier hs-var">state</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-606"></span><span>          </span><span class="annot"><span class="annottext">InterpStatus (ExtInterpInstance d)
</span><a href="GHC.Runtime.Interpreter.Types.html#InterpPending"><span class="hs-identifier hs-var">InterpPending</span></a></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">InterpStatus (ExtInterpInstance d)
-&gt; IO (InterpStatus (ExtInterpInstance d))
forall a. a -&gt; IO a
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">pure</span></span><span> </span><span class="annot"><span class="annottext">InterpStatus (ExtInterpInstance d)
</span><a href="#local-6989586621682961871"><span class="hs-identifier hs-var">state</span></a></span><span> </span><span class="hs-comment">-- already stopped</span><span>
</span><span id="line-607"></span><span>          </span><span class="annot"><a href="GHC.Runtime.Interpreter.Types.html#InterpRunning"><span class="hs-identifier hs-type">InterpRunning</span></a></span><span> </span><span id="local-6989586621682961872"><span class="annot"><span class="annottext">ExtInterpInstance d
</span><a href="#local-6989586621682961872"><span class="hs-identifier hs-var">i</span></a></span></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-608"></span><span>            </span><span id="local-6989586621682961873"><span class="annot"><a href="#local-6989586621682961873"><span class="hs-identifier hs-var">ex</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">ProcessHandle -&gt; IO (Maybe ExitCode)
</span><a href="../../process-1.6.25.0-5f54/src/System.Process.html#getProcessExitCode"><span class="hs-identifier hs-var">getProcessExitCode</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">InterpProcess -&gt; ProcessHandle
</span><a href="GHC.Runtime.Interpreter.Types.html#interpHandle"><span class="hs-identifier hs-var">interpHandle</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ExtInterpInstance d -&gt; InterpProcess
forall c. ExtInterpInstance c -&gt; InterpProcess
</span><a href="GHC.Runtime.Interpreter.Types.html#instProcess"><span class="hs-identifier hs-var">instProcess</span></a></span><span> </span><span class="annot"><span class="annottext">ExtInterpInstance d
</span><a href="#local-6989586621682961872"><span class="hs-identifier hs-var">i</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-609"></span><span>            </span><span class="hs-keyword">if</span><span> </span><span class="annot"><span class="hs-identifier hs-type">isJust</span></span><span> </span><span class="annot"><a href="#local-6989586621682961873"><span class="hs-identifier hs-type">ex</span></a></span><span>
</span><span id="line-610"></span><span>               </span><span class="hs-keyword">then</span><span> </span><span class="annot"><span class="hs-identifier hs-type">pure</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-611"></span><span>               </span><span class="hs-keyword">else</span><span> </span><span class="annot"><a href="GHC.Runtime.Interpreter.Process.html#sendMessage"><span class="hs-identifier hs-type">sendMessage</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682961872"><span class="hs-identifier hs-type">i</span></a></span><span> </span><span class="annot"><a href="../../ghci-9.12.2-bd10/src/GHCi.Message.html#Shutdown"><span class="hs-identifier hs-type">Shutdown</span></a></span><span>
</span><span id="line-612"></span><span>            </span><span class="annot"><span class="hs-identifier hs-type">pure</span></span><span> </span><span class="annot"><a href="GHC.Runtime.Interpreter.Types.html#InterpPending"><span class="hs-identifier hs-type">InterpPending</span></a></span><span>
</span><span id="line-613"></span><span>
</span><span id="line-614"></span><span class="hs-comment">-- -----------------------------------------------------------------------------</span><span>
</span><span id="line-615"></span><span class="hs-comment">{- Note [External GHCi pointers]
   ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
We have the following ways to reference things in GHCi:

HValue
------

HValue is a direct reference to a value in the local heap.  Obviously
we cannot use this to refer to things in the external process.


RemoteRef
---------

RemoteRef is a StablePtr to a heap-resident value.  When -fexternal-interpreter
or the JS interpreter is used, this value resides in the external process's
heap. RemoteRefs are mostly used to send pointers in messages between GHC and
iserv.

A RemoteRef must be explicitly freed when no longer required, using
freeHValueRefs, or by attaching a finalizer with mkForeignHValue.

To get from a RemoteRef to an HValue you can use 'wormholeRef', which
fails with an error message if -fexternal-interpreter is in use.

ForeignRef
----------

A ForeignRef is a RemoteRef with a finalizer that will free the
'RemoteRef' when it is garbage collected.  We mostly use ForeignHValue
on the GHC side.

The finalizer adds the RemoteRef to the iservPendingFrees list in the
IServ record.  The next call to interpCmd will free any RemoteRefs in
the list.  It was done this way rather than calling interpCmd directly,
because I didn't want to have arbitrary threads calling interpCmd.  In
principle it would probably be ok, but it seems less hairy this way.
-}</span><span>
</span><span id="line-653"></span><span>
</span><span id="line-654"></span><span class="hs-comment">-- | Creates a 'ForeignRef' that will automatically release the</span><span>
</span><span id="line-655"></span><span class="hs-comment">-- 'RemoteRef' when it is no longer referenced.</span><span>
</span><span id="line-656"></span><span id="local-6989586621682961188"><span class="annot"><a href="GHC.Runtime.Interpreter.html#mkFinalizedHValue"><span class="hs-identifier hs-type">mkFinalizedHValue</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Runtime.Interpreter.Types.html#Interp"><span class="hs-identifier hs-type">Interp</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="../../ghci-9.12.2-bd10/src/GHCi.RemoteTypes.html#RemoteRef"><span class="hs-identifier hs-type">RemoteRef</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682961188"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../../ghci-9.12.2-bd10/src/GHCi.RemoteTypes.html#ForeignRef"><span class="hs-identifier hs-type">ForeignRef</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682961188"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">)</span></span><span>
</span><span id="line-657"></span><span id="mkFinalizedHValue"><span class="annot"><span class="annottext">mkFinalizedHValue :: forall a. Interp -&gt; RemoteRef a -&gt; IO (ForeignRef a)
</span><a href="GHC.Runtime.Interpreter.html#mkFinalizedHValue"><span class="hs-identifier hs-var hs-var">mkFinalizedHValue</span></a></span></span><span> </span><span id="local-6989586621682961879"><span class="annot"><span class="annottext">Interp
</span><a href="#local-6989586621682961879"><span class="hs-identifier hs-var">interp</span></a></span></span><span> </span><span id="local-6989586621682961880"><span class="annot"><span class="annottext">RemoteRef a
</span><a href="#local-6989586621682961880"><span class="hs-identifier hs-var">rref</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-658"></span><span>  </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">Interp -&gt; InterpInstance
</span><a href="GHC.Runtime.Interpreter.Types.html#interpInstance"><span class="hs-identifier hs-var">interpInstance</span></a></span><span> </span><span class="annot"><span class="annottext">Interp
</span><a href="#local-6989586621682961879"><span class="hs-identifier hs-var">interp</span></a></span><span> </span><span class="hs-keyword">of</span><span class="hs-cpp">
#if defined(HAVE_INTERNAL_INTERPRETER)
</span><span>    </span><span class="annot"><span class="annottext">InterpInstance
</span><a href="GHC.Runtime.Interpreter.Types.html#InternalInterp"><span class="hs-identifier hs-var">InternalInterp</span></a></span><span>     </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">RemoteRef a -&gt; IO () -&gt; IO (ForeignRef a)
forall a. RemoteRef a -&gt; IO () -&gt; IO (ForeignRef a)
</span><a href="../../ghci-9.12.2-bd10/src/GHCi.RemoteTypes.html#mkForeignRef"><span class="hs-identifier hs-var">mkForeignRef</span></a></span><span> </span><span class="annot"><span class="annottext">RemoteRef a
</span><a href="#local-6989586621682961880"><span class="hs-identifier hs-var">rref</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">RemoteRef a -&gt; IO ()
forall a. RemoteRef a -&gt; IO ()
</span><a href="../../ghci-9.12.2-bd10/src/GHCi.RemoteTypes.html#freeRemoteRef"><span class="hs-identifier hs-var">freeRemoteRef</span></a></span><span> </span><span class="annot"><span class="annottext">RemoteRef a
</span><a href="#local-6989586621682961880"><span class="hs-identifier hs-var">rref</span></a></span><span class="hs-special">)</span><span class="hs-cpp">
#endif
</span><span>    </span><span class="annot"><a href="GHC.Runtime.Interpreter.Types.html#ExternalInterp"><span class="hs-identifier hs-type">ExternalInterp</span></a></span><span> </span><span id="local-6989586621682961883"><span class="annot"><span class="annottext">ExtInterp
</span><a href="#local-6989586621682961883"><span class="hs-identifier hs-var">ext</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">ExtInterp
-&gt; (forall d. Maybe (ExtInterpInstance d) -&gt; IO (ForeignRef a))
-&gt; IO (ForeignRef a)
forall (m :: * -&gt; *) a.
ExceptionMonad m =&gt;
ExtInterp -&gt; (forall d. Maybe (ExtInterpInstance d) -&gt; m a) -&gt; m a
</span><a href="GHC.Runtime.Interpreter.html#withExtInterpMaybe"><span class="hs-identifier hs-var">withExtInterpMaybe</span></a></span><span> </span><span class="annot"><span class="annottext">ExtInterp
</span><a href="#local-6989586621682961883"><span class="hs-identifier hs-var">ext</span></a></span><span> </span><span class="annot"><span class="annottext">((forall d. Maybe (ExtInterpInstance d) -&gt; IO (ForeignRef a))
 -&gt; IO (ForeignRef a))
-&gt; (forall d. Maybe (ExtInterpInstance d) -&gt; IO (ForeignRef a))
-&gt; IO (ForeignRef a)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-glyph">\</span><span class="hs-glyph">case</span><span>
</span><span id="line-663"></span><span>      </span><span class="annot"><span class="annottext">Maybe (ExtInterpInstance d)
</span><span class="hs-identifier hs-var">Nothing</span></span><span>   </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">RemoteRef a -&gt; IO () -&gt; IO (ForeignRef a)
forall a. RemoteRef a -&gt; IO () -&gt; IO (ForeignRef a)
</span><a href="../../ghci-9.12.2-bd10/src/GHCi.RemoteTypes.html#mkForeignRef"><span class="hs-identifier hs-var">mkForeignRef</span></a></span><span> </span><span class="annot"><span class="annottext">RemoteRef a
</span><a href="#local-6989586621682961880"><span class="hs-identifier hs-var">rref</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">() -&gt; IO ()
forall a. a -&gt; IO a
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">pure</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-comment">-- nothing to do, interpreter already stopped</span><span>
</span><span id="line-664"></span><span>      </span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span id="local-6989586621682961885"><span class="annot"><span class="annottext">ExtInterpInstance d
</span><a href="#local-6989586621682961885"><span class="hs-identifier hs-var">inst</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">RemoteRef a -&gt; IO () -&gt; IO (ForeignRef a)
forall a. RemoteRef a -&gt; IO () -&gt; IO (ForeignRef a)
</span><a href="../../ghci-9.12.2-bd10/src/GHCi.RemoteTypes.html#mkForeignRef"><span class="hs-identifier hs-var">mkForeignRef</span></a></span><span> </span><span class="annot"><span class="annottext">RemoteRef a
</span><a href="#local-6989586621682961880"><span class="hs-identifier hs-var">rref</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ExtInterpInstance d -&gt; RemoteRef a -&gt; IO ()
forall d a. ExtInterpInstance d -&gt; RemoteRef a -&gt; IO ()
</span><a href="GHC.Runtime.Interpreter.html#freeReallyRemoteRef"><span class="hs-identifier hs-var">freeReallyRemoteRef</span></a></span><span> </span><span class="annot"><span class="annottext">ExtInterpInstance d
</span><a href="#local-6989586621682961885"><span class="hs-identifier hs-var">inst</span></a></span><span> </span><span class="annot"><span class="annottext">RemoteRef a
</span><a href="#local-6989586621682961880"><span class="hs-identifier hs-var">rref</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-665"></span><span>
</span><span id="line-666"></span><span id="local-6989586621682961259"><span id="local-6989586621682961260"><span class="annot"><a href="GHC.Runtime.Interpreter.html#freeReallyRemoteRef"><span class="hs-identifier hs-type">freeReallyRemoteRef</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Runtime.Interpreter.Types.html#ExtInterpInstance"><span class="hs-identifier hs-type">ExtInterpInstance</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682961259"><span class="hs-identifier hs-type">d</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="../../ghci-9.12.2-bd10/src/GHCi.RemoteTypes.html#RemoteRef"><span class="hs-identifier hs-type">RemoteRef</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682961260"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span></span></span><span>
</span><span id="line-667"></span><span id="freeReallyRemoteRef"><span class="annot"><span class="annottext">freeReallyRemoteRef :: forall d a. ExtInterpInstance d -&gt; RemoteRef a -&gt; IO ()
</span><a href="GHC.Runtime.Interpreter.html#freeReallyRemoteRef"><span class="hs-identifier hs-var hs-var">freeReallyRemoteRef</span></a></span></span><span> </span><span id="local-6989586621682961887"><span class="annot"><span class="annottext">ExtInterpInstance d
</span><a href="#local-6989586621682961887"><span class="hs-identifier hs-var">inst</span></a></span></span><span> </span><span id="local-6989586621682961888"><span class="annot"><span class="annottext">RemoteRef a
</span><a href="#local-6989586621682961888"><span class="hs-identifier hs-var">rref</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-668"></span><span>  </span><span class="hs-comment">-- add to the list of HValues to free</span><span>
</span><span id="line-669"></span><span>  </span><span class="annot"><span class="annottext">MVar [HValueRef] -&gt; ([HValueRef] -&gt; IO [HValueRef]) -&gt; IO ()
forall a. MVar a -&gt; (a -&gt; IO a) -&gt; IO ()
</span><span class="hs-identifier hs-var">modifyMVar_</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ExtInterpInstance d -&gt; MVar [HValueRef]
forall c. ExtInterpInstance c -&gt; MVar [HValueRef]
</span><a href="GHC.Runtime.Interpreter.Types.html#instPendingFrees"><span class="hs-identifier hs-var">instPendingFrees</span></a></span><span> </span><span class="annot"><span class="annottext">ExtInterpInstance d
</span><a href="#local-6989586621682961887"><span class="hs-identifier hs-var">inst</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span id="local-6989586621682961889"><span class="annot"><span class="annottext">[HValueRef]
</span><a href="#local-6989586621682961889"><span class="hs-identifier hs-var">xs</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">[HValueRef] -&gt; IO [HValueRef]
forall a. a -&gt; IO a
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">pure</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">RemoteRef a -&gt; HValueRef
forall a b. RemoteRef a -&gt; RemoteRef b
</span><a href="../../ghci-9.12.2-bd10/src/GHCi.RemoteTypes.html#castRemoteRef"><span class="hs-identifier hs-var">castRemoteRef</span></a></span><span> </span><span class="annot"><span class="annottext">RemoteRef a
</span><a href="#local-6989586621682961888"><span class="hs-identifier hs-var">rref</span></a></span><span> </span><span class="annot"><span class="annottext">HValueRef -&gt; [HValueRef] -&gt; [HValueRef]
forall a. a -&gt; [a] -&gt; [a]
</span><span class="hs-glyph hs-var">:</span></span><span> </span><span class="annot"><span class="annottext">[HValueRef]
</span><a href="#local-6989586621682961889"><span class="hs-identifier hs-var">xs</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-670"></span><span>
</span><span id="line-671"></span><span>
</span><span id="line-672"></span><span class="annot"><a href="GHC.Runtime.Interpreter.html#freeHValueRefs"><span class="hs-identifier hs-type">freeHValueRefs</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Runtime.Interpreter.Types.html#Interp"><span class="hs-identifier hs-type">Interp</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="../../ghci-9.12.2-bd10/src/GHCi.RemoteTypes.html#HValueRef"><span class="hs-identifier hs-type">HValueRef</span></a></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-673"></span><span id="freeHValueRefs"><span class="annot"><span class="annottext">freeHValueRefs :: Interp -&gt; [HValueRef] -&gt; IO ()
</span><a href="GHC.Runtime.Interpreter.html#freeHValueRefs"><span class="hs-identifier hs-var hs-var">freeHValueRefs</span></a></span></span><span> </span><span class="annot"><span class="annottext">Interp
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">() -&gt; IO ()
forall a. a -&gt; IO a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-674"></span><span class="annot"><a href="GHC.Runtime.Interpreter.html#freeHValueRefs"><span class="hs-identifier hs-var">freeHValueRefs</span></a></span><span> </span><span id="local-6989586621682961891"><span class="annot"><span class="annottext">Interp
</span><a href="#local-6989586621682961891"><span class="hs-identifier hs-var">interp</span></a></span></span><span> </span><span id="local-6989586621682961892"><span class="annot"><span class="annottext">[HValueRef]
</span><a href="#local-6989586621682961892"><span class="hs-identifier hs-var">refs</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Interp -&gt; Message () -&gt; IO ()
forall a. Binary a =&gt; Interp -&gt; Message a -&gt; IO a
</span><a href="GHC.Runtime.Interpreter.html#interpCmd"><span class="hs-identifier hs-var">interpCmd</span></a></span><span> </span><span class="annot"><span class="annottext">Interp
</span><a href="#local-6989586621682961891"><span class="hs-identifier hs-var">interp</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[HValueRef] -&gt; Message ()
</span><a href="../../ghci-9.12.2-bd10/src/GHCi.Message.html#FreeHValueRefs"><span class="hs-identifier hs-var">FreeHValueRefs</span></a></span><span> </span><span class="annot"><span class="annottext">[HValueRef]
</span><a href="#local-6989586621682961892"><span class="hs-identifier hs-var">refs</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-675"></span><span>
</span><span id="line-676"></span><span class="hs-comment">-- | Convert a 'ForeignRef' to the value it references directly.  This</span><span>
</span><span id="line-677"></span><span class="hs-comment">-- only works when the interpreter is running in the same process as</span><span>
</span><span id="line-678"></span><span class="hs-comment">-- the compiler, so it fails when @-fexternal-interpreter@ is on.</span><span>
</span><span id="line-679"></span><span id="local-6989586621682961265"><span class="annot"><a href="GHC.Runtime.Interpreter.html#wormhole"><span class="hs-identifier hs-type">wormhole</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Runtime.Interpreter.Types.html#Interp"><span class="hs-identifier hs-type">Interp</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="../../ghci-9.12.2-bd10/src/GHCi.RemoteTypes.html#ForeignRef"><span class="hs-identifier hs-type">ForeignRef</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682961265"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="annot"><a href="#local-6989586621682961265"><span class="hs-identifier hs-type">a</span></a></span></span><span>
</span><span id="line-680"></span><span id="wormhole"><span class="annot"><span class="annottext">wormhole :: forall a. Interp -&gt; ForeignRef a -&gt; IO a
</span><a href="GHC.Runtime.Interpreter.html#wormhole"><span class="hs-identifier hs-var hs-var">wormhole</span></a></span></span><span> </span><span id="local-6989586621682961893"><span class="annot"><span class="annottext">Interp
</span><a href="#local-6989586621682961893"><span class="hs-identifier hs-var">interp</span></a></span></span><span> </span><span id="local-6989586621682961894"><span class="annot"><span class="annottext">ForeignRef a
</span><a href="#local-6989586621682961894"><span class="hs-identifier hs-var">r</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Interp -&gt; RemoteRef a -&gt; IO a
forall a. Interp -&gt; RemoteRef a -&gt; IO a
</span><a href="GHC.Runtime.Interpreter.html#wormholeRef"><span class="hs-identifier hs-var">wormholeRef</span></a></span><span> </span><span class="annot"><span class="annottext">Interp
</span><a href="#local-6989586621682961893"><span class="hs-identifier hs-var">interp</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ForeignRef a -&gt; RemoteRef a
forall a. ForeignRef a -&gt; RemoteRef a
</span><a href="../../ghci-9.12.2-bd10/src/GHCi.RemoteTypes.html#unsafeForeignRefToRemoteRef"><span class="hs-identifier hs-var">unsafeForeignRefToRemoteRef</span></a></span><span> </span><span class="annot"><span class="annottext">ForeignRef a
</span><a href="#local-6989586621682961894"><span class="hs-identifier hs-var">r</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-681"></span><span>
</span><span id="line-682"></span><span class="hs-comment">-- | Convert an 'RemoteRef' to the value it references directly.  This</span><span>
</span><span id="line-683"></span><span class="hs-comment">-- only works when the interpreter is running in the same process as</span><span>
</span><span id="line-684"></span><span class="hs-comment">-- the compiler, so it fails when @-fexternal-interpreter@ is on.</span><span>
</span><span id="line-685"></span><span id="local-6989586621682961267"><span class="annot"><a href="GHC.Runtime.Interpreter.html#wormholeRef"><span class="hs-identifier hs-type">wormholeRef</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Runtime.Interpreter.Types.html#Interp"><span class="hs-identifier hs-type">Interp</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="../../ghci-9.12.2-bd10/src/GHCi.RemoteTypes.html#RemoteRef"><span class="hs-identifier hs-type">RemoteRef</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682961267"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="annot"><a href="#local-6989586621682961267"><span class="hs-identifier hs-type">a</span></a></span></span><span>
</span><span id="line-686"></span><span id="wormholeRef"><span class="annot"><span class="annottext">wormholeRef :: forall a. Interp -&gt; RemoteRef a -&gt; IO a
</span><a href="GHC.Runtime.Interpreter.html#wormholeRef"><span class="hs-identifier hs-var hs-var">wormholeRef</span></a></span></span><span> </span><span id="local-6989586621682961900"><span class="annot"><span class="annottext">Interp
</span><a href="#local-6989586621682961900"><span class="hs-identifier hs-var">interp</span></a></span></span><span> </span><span id="local-6989586621682961901"><span class="annot"><span class="annottext">RemoteRef a
</span><a href="#local-6989586621682961901"><span class="hs-identifier hs-var">_r</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">Interp -&gt; InterpInstance
</span><a href="GHC.Runtime.Interpreter.Types.html#interpInstance"><span class="hs-identifier hs-var">interpInstance</span></a></span><span> </span><span class="annot"><span class="annottext">Interp
</span><a href="#local-6989586621682961900"><span class="hs-identifier hs-var">interp</span></a></span><span> </span><span class="hs-keyword">of</span><span class="hs-cpp">
#if defined(HAVE_INTERNAL_INTERPRETER)
</span><span>  </span><span class="annot"><span class="annottext">InterpInstance
</span><a href="GHC.Runtime.Interpreter.Types.html#InternalInterp"><span class="hs-identifier hs-var">InternalInterp</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">RemoteRef a -&gt; IO a
forall a. RemoteRef a -&gt; IO a
</span><a href="../../ghci-9.12.2-bd10/src/GHCi.RemoteTypes.html#localRef"><span class="hs-identifier hs-var">localRef</span></a></span><span> </span><span class="annot"><span class="annottext">RemoteRef a
</span><a href="#local-6989586621682961901"><span class="hs-identifier hs-var">_r</span></a></span><span class="hs-cpp">
#endif
</span><span>  </span><span class="annot"><a href="GHC.Runtime.Interpreter.Types.html#ExternalInterp"><span class="hs-identifier hs-type">ExternalInterp</span></a></span><span> </span><span class="hs-special">{</span><span class="hs-special">}</span><span>
</span><span id="line-691"></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">GhcException -&gt; IO a
forall e a. (HasCallStack, Exception e) =&gt; e -&gt; IO a
</span><span class="hs-identifier hs-var">throwIO</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">String -&gt; GhcException
</span><a href="GHC.Utils.Panic.html#InstallationError"><span class="hs-identifier hs-var">InstallationError</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;this operation requires -fno-external-interpreter&quot;</span></span><span class="hs-special">)</span><span>
</span><span id="line-692"></span><span>
</span><span id="line-693"></span><span class="hs-comment">-- -----------------------------------------------------------------------------</span><span>
</span><span id="line-694"></span><span class="hs-comment">-- Misc utils</span><span>
</span><span id="line-695"></span><span>
</span><span id="line-696"></span><span id="local-6989586621682961189"><span class="annot"><a href="GHC.Runtime.Interpreter.html#fromEvalResult"><span class="hs-identifier hs-type">fromEvalResult</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="../../ghci-9.12.2-bd10/src/GHCi.Message.html#EvalResult"><span class="hs-identifier hs-type">EvalResult</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682961189"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="annot"><a href="#local-6989586621682961189"><span class="hs-identifier hs-type">a</span></a></span></span><span>
</span><span id="line-697"></span><span id="fromEvalResult"><span class="annot"><span class="annottext">fromEvalResult :: forall a. EvalResult a -&gt; IO a
</span><a href="GHC.Runtime.Interpreter.html#fromEvalResult"><span class="hs-identifier hs-var hs-var">fromEvalResult</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../../ghci-9.12.2-bd10/src/GHCi.Message.html#EvalException"><span class="hs-identifier hs-type">EvalException</span></a></span><span> </span><span id="local-6989586621682961910"><span class="annot"><span class="annottext">SerializableException
</span><a href="#local-6989586621682961910"><span class="hs-identifier hs-var">e</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">SomeException -&gt; IO a
forall e a. (HasCallStack, Exception e) =&gt; e -&gt; IO a
</span><span class="hs-identifier hs-var">throwIO</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">SerializableException -&gt; SomeException
</span><a href="../../ghci-9.12.2-bd10/src/GHCi.Message.html#fromSerializableException"><span class="hs-identifier hs-var">fromSerializableException</span></a></span><span> </span><span class="annot"><span class="annottext">SerializableException
</span><a href="#local-6989586621682961910"><span class="hs-identifier hs-var">e</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-698"></span><span class="annot"><a href="GHC.Runtime.Interpreter.html#fromEvalResult"><span class="hs-identifier hs-var">fromEvalResult</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../../ghci-9.12.2-bd10/src/GHCi.Message.html#EvalSuccess"><span class="hs-identifier hs-type">EvalSuccess</span></a></span><span> </span><span id="local-6989586621682961912"><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621682961912"><span class="hs-identifier hs-var">a</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">a -&gt; IO a
forall a. a -&gt; IO a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621682961912"><span class="hs-identifier hs-var">a</span></a></span><span>
</span><span id="line-699"></span><span>
</span><span id="line-700"></span><span class="annot"><a href="GHC.Runtime.Interpreter.html#getModBreaks"><span class="hs-identifier hs-type">getModBreaks</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Unit.Home.ModInfo.html#HomeModInfo"><span class="hs-identifier hs-type">HomeModInfo</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.ByteCode.Types.html#ModBreaks"><span class="hs-identifier hs-type">ModBreaks</span></a></span><span>
</span><span id="line-701"></span><span id="getModBreaks"><span class="annot"><span class="annottext">getModBreaks :: HomeModInfo -&gt; ModBreaks
</span><a href="GHC.Runtime.Interpreter.html#getModBreaks"><span class="hs-identifier hs-var hs-var">getModBreaks</span></a></span></span><span> </span><span id="local-6989586621682961913"><span class="annot"><span class="annottext">HomeModInfo
</span><a href="#local-6989586621682961913"><span class="hs-identifier hs-var">hmi</span></a></span></span><span>
</span><span id="line-702"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span id="local-6989586621682961914"><span class="annot"><span class="annottext">Linkable
</span><a href="#local-6989586621682961914"><span class="hs-identifier hs-var">linkable</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">HomeModInfo -&gt; Maybe Linkable
</span><a href="GHC.Unit.Home.ModInfo.html#homeModInfoByteCode"><span class="hs-identifier hs-var">homeModInfoByteCode</span></a></span><span> </span><span class="annot"><span class="annottext">HomeModInfo
</span><a href="#local-6989586621682961913"><span class="hs-identifier hs-var">hmi</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-703"></span><span>    </span><span class="hs-comment">-- The linkable may have 'DotO's as well; only consider BCOs. See #20570.</span><span>
</span><span id="line-704"></span><span>    </span><span class="hs-special">[</span><span id="local-6989586621682961916"><span class="annot"><span class="annottext">CompiledByteCode
</span><a href="#local-6989586621682961916"><span class="hs-identifier hs-var">cbc</span></a></span></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Linkable -&gt; [CompiledByteCode]
</span><a href="GHC.Linker.Types.html#linkableBCOs"><span class="hs-identifier hs-var">linkableBCOs</span></a></span><span> </span><span class="annot"><span class="annottext">Linkable
</span><a href="#local-6989586621682961914"><span class="hs-identifier hs-var">linkable</span></a></span><span>
</span><span id="line-705"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ModBreaks -&gt; Maybe ModBreaks -&gt; ModBreaks
forall a. a -&gt; Maybe a -&gt; a
</span><span class="hs-identifier hs-var">fromMaybe</span></span><span> </span><span class="annot"><span class="annottext">ModBreaks
</span><a href="GHC.ByteCode.Types.html#emptyModBreaks"><span class="hs-identifier hs-var">emptyModBreaks</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">CompiledByteCode -&gt; Maybe ModBreaks
</span><a href="GHC.ByteCode.Types.html#bc_breaks"><span class="hs-identifier hs-var">bc_breaks</span></a></span><span> </span><span class="annot"><span class="annottext">CompiledByteCode
</span><a href="#local-6989586621682961916"><span class="hs-identifier hs-var">cbc</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-706"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">otherwise</span></span><span>
</span><span id="line-707"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ModBreaks
</span><a href="GHC.ByteCode.Types.html#emptyModBreaks"><span class="hs-identifier hs-var">emptyModBreaks</span></a></span><span> </span><span class="hs-comment">-- probably object code</span><span>
</span><span id="line-708"></span><span>
</span><span id="line-709"></span><span class="annot"><span class="hs-comment">-- | Interpreter uses Profiling way</span></span><span>
</span><span id="line-710"></span><span class="annot"><a href="GHC.Runtime.Interpreter.html#interpreterProfiled"><span class="hs-identifier hs-type">interpreterProfiled</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Runtime.Interpreter.Types.html#Interp"><span class="hs-identifier hs-type">Interp</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Bool</span></span><span>
</span><span id="line-711"></span><span id="interpreterProfiled"><span class="annot"><span class="annottext">interpreterProfiled :: Interp -&gt; Bool
</span><a href="GHC.Runtime.Interpreter.html#interpreterProfiled"><span class="hs-identifier hs-var hs-var">interpreterProfiled</span></a></span></span><span> </span><span id="local-6989586621682961920"><span class="annot"><span class="annottext">Interp
</span><a href="#local-6989586621682961920"><span class="hs-identifier hs-var">interp</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">Interp -&gt; InterpInstance
</span><a href="GHC.Runtime.Interpreter.Types.html#interpInstance"><span class="hs-identifier hs-var">interpInstance</span></a></span><span> </span><span class="annot"><span class="annottext">Interp
</span><a href="#local-6989586621682961920"><span class="hs-identifier hs-var">interp</span></a></span><span> </span><span class="hs-keyword">of</span><span class="hs-cpp">
#if defined(HAVE_INTERNAL_INTERPRETER)
</span><span>  </span><span class="annot"><span class="annottext">InterpInstance
</span><a href="GHC.Runtime.Interpreter.Types.html#InternalInterp"><span class="hs-identifier hs-var">InternalInterp</span></a></span><span>     </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="GHC.Platform.Ways.html#hostIsProfiled"><span class="hs-identifier hs-var">hostIsProfiled</span></a></span><span class="hs-cpp">
#endif
</span><span>  </span><span class="annot"><a href="GHC.Runtime.Interpreter.Types.html#ExternalInterp"><span class="hs-identifier hs-type">ExternalInterp</span></a></span><span> </span><span id="local-6989586621682961922"><span class="annot"><span class="annottext">ExtInterp
</span><a href="#local-6989586621682961922"><span class="hs-identifier hs-var">ext</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">ExtInterp
</span><a href="#local-6989586621682961922"><span class="hs-identifier hs-var">ext</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-716"></span><span>    </span><span class="annot"><a href="GHC.Runtime.Interpreter.Types.html#ExtIServ"><span class="hs-identifier hs-type">ExtIServ</span></a></span><span> </span><span id="local-6989586621682961923"><span class="annot"><span class="annottext">IServ
</span><a href="#local-6989586621682961923"><span class="hs-identifier hs-var">i</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">IServConfig -&gt; Bool
</span><a href="GHC.Runtime.Interpreter.Types.html#iservConfProfiled"><span class="hs-identifier hs-var">iservConfProfiled</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">IServ -&gt; IServConfig
forall cfg details. ExtInterpState cfg details -&gt; cfg
</span><a href="GHC.Runtime.Interpreter.Types.html#interpConfig"><span class="hs-identifier hs-var">interpConfig</span></a></span><span> </span><span class="annot"><span class="annottext">IServ
</span><a href="#local-6989586621682961923"><span class="hs-identifier hs-var">i</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-717"></span><span>    </span><span class="annot"><a href="GHC.Runtime.Interpreter.Types.html#ExtJS"><span class="hs-identifier hs-type">ExtJS</span></a></span><span> </span><span class="hs-special">{</span><span class="hs-special">}</span><span>   </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">False</span></span><span> </span><span class="hs-comment">-- we don't support profiling yet in the JS backend</span><span>
</span><span id="line-718"></span><span>    </span><span class="annot"><a href="GHC.Runtime.Interpreter.Types.html#ExtWasm"><span class="hs-identifier hs-type">ExtWasm</span></a></span><span> </span><span id="local-6989586621682961926"><span class="annot"><span class="annottext">WasmInterp
</span><a href="#local-6989586621682961926"><span class="hs-identifier hs-var">i</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">WasmInterpConfig -&gt; Bool
</span><a href="GHC.Runtime.Interpreter.Types.html#wasmInterpProfiled"><span class="hs-identifier hs-var">wasmInterpProfiled</span></a></span><span> </span><span class="annot"><span class="annottext">(WasmInterpConfig -&gt; Bool) -&gt; WasmInterpConfig -&gt; Bool
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">WasmInterp -&gt; WasmInterpConfig
forall cfg details. ExtInterpState cfg details -&gt; cfg
</span><a href="GHC.Runtime.Interpreter.Types.html#interpConfig"><span class="hs-identifier hs-var">interpConfig</span></a></span><span> </span><span class="annot"><span class="annottext">WasmInterp
</span><a href="#local-6989586621682961926"><span class="hs-identifier hs-var">i</span></a></span><span>
</span><span id="line-719"></span><span>
</span><span id="line-720"></span><span class="annot"><span class="hs-comment">-- | Interpreter uses Dynamic way</span></span><span>
</span><span id="line-721"></span><span class="annot"><a href="GHC.Runtime.Interpreter.html#interpreterDynamic"><span class="hs-identifier hs-type">interpreterDynamic</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Runtime.Interpreter.Types.html#Interp"><span class="hs-identifier hs-type">Interp</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Bool</span></span><span>
</span><span id="line-722"></span><span id="interpreterDynamic"><span class="annot"><span class="annottext">interpreterDynamic :: Interp -&gt; Bool
</span><a href="GHC.Runtime.Interpreter.html#interpreterDynamic"><span class="hs-identifier hs-var hs-var">interpreterDynamic</span></a></span></span><span> </span><span id="local-6989586621682961928"><span class="annot"><span class="annottext">Interp
</span><a href="#local-6989586621682961928"><span class="hs-identifier hs-var">interp</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">Interp -&gt; InterpInstance
</span><a href="GHC.Runtime.Interpreter.Types.html#interpInstance"><span class="hs-identifier hs-var">interpInstance</span></a></span><span> </span><span class="annot"><span class="annottext">Interp
</span><a href="#local-6989586621682961928"><span class="hs-identifier hs-var">interp</span></a></span><span> </span><span class="hs-keyword">of</span><span class="hs-cpp">
#if defined(HAVE_INTERNAL_INTERPRETER)
</span><span>  </span><span class="annot"><span class="annottext">InterpInstance
</span><a href="GHC.Runtime.Interpreter.Types.html#InternalInterp"><span class="hs-identifier hs-var">InternalInterp</span></a></span><span>     </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="GHC.Platform.Ways.html#hostIsDynamic"><span class="hs-identifier hs-var">hostIsDynamic</span></a></span><span class="hs-cpp">
#endif
</span><span>  </span><span class="annot"><a href="GHC.Runtime.Interpreter.Types.html#ExternalInterp"><span class="hs-identifier hs-type">ExternalInterp</span></a></span><span> </span><span id="local-6989586621682961930"><span class="annot"><span class="annottext">ExtInterp
</span><a href="#local-6989586621682961930"><span class="hs-identifier hs-var">ext</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">ExtInterp
</span><a href="#local-6989586621682961930"><span class="hs-identifier hs-var">ext</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-727"></span><span>    </span><span class="annot"><a href="GHC.Runtime.Interpreter.Types.html#ExtIServ"><span class="hs-identifier hs-type">ExtIServ</span></a></span><span> </span><span id="local-6989586621682961931"><span class="annot"><span class="annottext">IServ
</span><a href="#local-6989586621682961931"><span class="hs-identifier hs-var">i</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">IServConfig -&gt; Bool
</span><a href="GHC.Runtime.Interpreter.Types.html#iservConfDynamic"><span class="hs-identifier hs-var">iservConfDynamic</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">IServ -&gt; IServConfig
forall cfg details. ExtInterpState cfg details -&gt; cfg
</span><a href="GHC.Runtime.Interpreter.Types.html#interpConfig"><span class="hs-identifier hs-var">interpConfig</span></a></span><span> </span><span class="annot"><span class="annottext">IServ
</span><a href="#local-6989586621682961931"><span class="hs-identifier hs-var">i</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-728"></span><span>    </span><span class="annot"><a href="GHC.Runtime.Interpreter.Types.html#ExtJS"><span class="hs-identifier hs-type">ExtJS</span></a></span><span> </span><span class="hs-special">{</span><span class="hs-special">}</span><span>   </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">False</span></span><span> </span><span class="hs-comment">-- dynamic doesn't make sense for JS</span><span>
</span><span id="line-729"></span><span>    </span><span class="annot"><a href="GHC.Runtime.Interpreter.Types.html#ExtWasm"><span class="hs-identifier hs-type">ExtWasm</span></a></span><span> </span><span class="hs-special">{</span><span class="hs-special">}</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">True</span></span><span>  </span><span class="hs-comment">-- wasm dyld can only load dynamic code</span><span>
</span><span id="line-730"></span></pre></body></html>