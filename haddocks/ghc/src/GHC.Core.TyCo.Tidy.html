<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><link rel="stylesheet" type="text/css" href="style.css" /><script type="text/javascript" src="highlight.js"></script></head><body><pre><span class="hs-pragma">{-# OPTIONS_GHC -Wno-incomplete-uni-patterns   #-}</span><span>
</span><span id="line-2"></span><span>
</span><span id="line-3"></span><span class="annot"><span class="hs-comment">-- | Tidying types and coercions for printing in error messages.</span></span><span>
</span><span id="line-4"></span><span class="hs-keyword">module</span><span> </span><span class="annot"><a href="GHC.Core.TyCo.Tidy.html"><span class="hs-identifier">GHC.Core.TyCo.Tidy</span></a></span><span>
</span><span id="line-5"></span><span>  </span><span class="hs-special">(</span><span>
</span><span id="line-6"></span><span>        </span><span class="annot"><span class="hs-comment">-- * Tidying type related things up for printing</span></span><span>
</span><span id="line-7"></span><span>        </span><span class="annot"><a href="GHC.Core.TyCo.Tidy.html#tidyType"><span class="hs-identifier">tidyType</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Core.TyCo.Tidy.html#tidyTypes"><span class="hs-identifier">tidyTypes</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-8"></span><span>        </span><span class="annot"><a href="GHC.Core.TyCo.Tidy.html#tidyCo"><span class="hs-identifier">tidyCo</span></a></span><span class="hs-special">,</span><span>   </span><span class="annot"><a href="GHC.Core.TyCo.Tidy.html#tidyCos"><span class="hs-identifier">tidyCos</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-9"></span><span>        </span><span class="annot"><a href="GHC.Core.TyCo.Tidy.html#tidyTopType"><span class="hs-identifier">tidyTopType</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-10"></span><span>
</span><span id="line-11"></span><span>        </span><span class="annot"><a href="GHC.Core.TyCo.Tidy.html#tidyOpenType"><span class="hs-identifier">tidyOpenType</span></a></span><span class="hs-special">,</span><span>  </span><span class="annot"><a href="GHC.Core.TyCo.Tidy.html#tidyOpenTypes"><span class="hs-identifier">tidyOpenTypes</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-12"></span><span>        </span><span class="annot"><a href="GHC.Core.TyCo.Tidy.html#tidyOpenTypeX"><span class="hs-identifier">tidyOpenTypeX</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Core.TyCo.Tidy.html#tidyOpenTypesX"><span class="hs-identifier">tidyOpenTypesX</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-13"></span><span>        </span><span class="annot"><a href="GHC.Core.TyCo.Tidy.html#tidyFreeTyCoVars"><span class="hs-identifier">tidyFreeTyCoVars</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Core.TyCo.Tidy.html#tidyFreeTyCoVarX"><span class="hs-identifier">tidyFreeTyCoVarX</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Core.TyCo.Tidy.html#tidyFreeTyCoVarsX"><span class="hs-identifier">tidyFreeTyCoVarsX</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-14"></span><span>
</span><span id="line-15"></span><span>        </span><span class="annot"><a href="GHC.Core.TyCo.Tidy.html#tidyAvoiding"><span class="hs-identifier">tidyAvoiding</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-16"></span><span>        </span><span class="annot"><a href="GHC.Core.TyCo.Tidy.html#tidyVarBndr"><span class="hs-identifier">tidyVarBndr</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Core.TyCo.Tidy.html#tidyVarBndrs"><span class="hs-identifier">tidyVarBndrs</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Core.TyCo.Tidy.html#avoidNameClashes"><span class="hs-identifier">avoidNameClashes</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-17"></span><span>        </span><span class="annot"><a href="GHC.Core.TyCo.Tidy.html#tidyForAllTyBinder"><span class="hs-identifier">tidyForAllTyBinder</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Core.TyCo.Tidy.html#tidyForAllTyBinders"><span class="hs-identifier">tidyForAllTyBinders</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-18"></span><span>        </span><span class="annot"><a href="GHC.Core.TyCo.Tidy.html#tidyTyCoVarOcc"><span class="hs-identifier">tidyTyCoVarOcc</span></a></span><span>
</span><span id="line-19"></span><span>  </span><span class="hs-special">)</span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-20"></span><span>
</span><span id="line-21"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Prelude.html"><span class="hs-identifier">GHC.Prelude</span></a></span><span>
</span><span id="line-22"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Data.FastString.html"><span class="hs-identifier">GHC.Data.FastString</span></a></span><span>
</span><span id="line-23"></span><span>
</span><span id="line-24"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Core.TyCo.Rep.html"><span class="hs-identifier">GHC.Core.TyCo.Rep</span></a></span><span>
</span><span id="line-25"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Core.TyCo.FVs.html"><span class="hs-identifier">GHC.Core.TyCo.FVs</span></a></span><span>
</span><span id="line-26"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Types.Name.html"><span class="hs-identifier">GHC.Types.Name</span></a></span><span> </span><span class="hs-keyword">hiding</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Types.Name.Occurrence.html#varName"><span class="hs-identifier">varName</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-27"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Types.Var.html"><span class="hs-identifier">GHC.Types.Var</span></a></span><span>
</span><span id="line-28"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Types.Var.Env.html"><span class="hs-identifier">GHC.Types.Var.Env</span></a></span><span>
</span><span id="line-29"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Utils.Misc.html"><span class="hs-identifier">GHC.Utils.Misc</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Utils.Misc.html#strictMap"><span class="hs-identifier">strictMap</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-30"></span><span>
</span><span id="line-31"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="../../base-4.21.0.0-ae91/src/Data.List.html"><span class="hs-identifier">Data.List</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">mapAccumL</span></span><span class="hs-special">)</span><span>
</span><span id="line-32"></span><span>
</span><span id="line-33"></span><span class="annot"><span class="hs-comment">{- **********************************************************************

                  TidyType

********************************************************************** -}</span></span><span>
</span><span id="line-38"></span><span>
</span><span id="line-39"></span><span class="hs-comment">{- Note [Tidying open types]
~~~~~~~~~~~~~~~~~~~~~~~~~~~~
When tidying some open types [t1,..,tn], we find their free vars, and tidy them first.

But (tricky point) we restrict the occ_env part of inner_env to just the /free/
vars of [t1..tn], so that we don't gratuitously rename the /bound/ variables.

Example: assume the TidyEnv
      ({&quot;a1&quot;,&quot;b&quot;} , [a_4 :-&gt; a1, b_7 :-&gt; b])
and call tidyOpenTypes on
      [a_1, forall a_2. Maybe (a_2,a_4), forall b. (b,a_1)]
All the a's have the same OccName, but different uniques.

The TidyOccEnv binding for &quot;b&quot; relates b_7, which doesn't appear free in the
these types at all, so we don't want that to mess up the tidying for the
(forall b...).

So we proceed as follows:
  1. Find the free vars.
     In our example:the free vars are a_1 and a_4:

  2. Use tidyFreeTyCoVars to tidy them (workhorse: `tidyFreeCoVarX`)
     In our example:
      * a_4 already has a tidy form, a1, so don't change that
      * a_1 gets tidied to a2

  3. Trim the TidyOccEnv to OccNames of the tidied free vars (`trimTidyEnv`)
     In our example &quot;a1&quot; and &quot;a2&quot;

  4. Now tidy the types.  In our example we get
      [a2, forall a3. Maybe (a3,a1), forall b. (b, a2)]

Note [Tidying is idempotent]
~~~~~~~~~~~~~~~~~~~~~~~~~~~~
Key invariant: tidyFreeTyCoVars is idempotent, at least if you start with
an empty TidyEnv. This is important because:

  * The typechecker error message processing carefully tidies types, using
    global knowledge; see for example calls to `tidyCt` in GHC.Tc.Errors.

  * Then the type pretty-printer, GHC.Core.TyCo.Ppr.pprType tidies the type
    again, because that's important for pretty-printing types in general.

But the second tidying is a no-op if the first step has happened, because
all the free vars will have distinct OccNames, so no renaming needs to happen.

Note [tidyAvoiding]
~~~~~~~~~~~~~~~~~~~
Consider tidying this unsolved constraint in GHC.Tc.Errors.report_unsolved.
    C a_33, (forall a. Eq a =&gt; D a)
Here a_33 is a free unification variable.  If we firs tidy [a_33 :-&gt; &quot;a&quot;]
then we have no choice but to tidy the `forall a` to something else. But it
is confusing (sometimes very confusing) to gratuitously rename skolems in
this way -- see #24868.  So it is better to :

  * Find the /bound/ skolems (just `a` in this case)
  * Initialise the TidyOccEnv to avoid using &quot;a&quot;
  * Now tidy the free a_33 to, say, &quot;a1&quot;
  * Delete &quot;a&quot; from the TidyOccEnv

This is done by `tidyAvoiding`.

The last step is very important; if we leave &quot;a&quot; in the TidyOccEnv, when
we get to the (forall a. blah) we'll rename `a` to &quot;a2&quot;, avoiding &quot;a&quot;.
-}</span><span>
</span><span id="line-104"></span><span>
</span><span id="line-105"></span><span class="hs-comment">-- | This tidies up a type for printing in an error message, or in</span><span>
</span><span id="line-106"></span><span class="hs-comment">-- an interface file.</span><span>
</span><span id="line-107"></span><span class="hs-comment">--</span><span>
</span><span id="line-108"></span><span class="hs-comment">-- It doesn't change the uniques at all, just the print names.</span><span>
</span><span id="line-109"></span><span class="annot"><a href="GHC.Core.TyCo.Tidy.html#tidyVarBndrs"><span class="hs-identifier hs-type">tidyVarBndrs</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Types.Var.Env.html#TidyEnv"><span class="hs-identifier hs-type">TidyEnv</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="GHC.Types.Var.html#TyCoVar"><span class="hs-identifier hs-type">TyCoVar</span></a></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Types.Var.Env.html#TidyEnv"><span class="hs-identifier hs-type">TidyEnv</span></a></span><span class="hs-special">,</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="GHC.Types.Var.html#TyCoVar"><span class="hs-identifier hs-type">TyCoVar</span></a></span><span class="hs-special">]</span><span class="hs-special">)</span><span>
</span><span id="line-110"></span><span id="tidyVarBndrs"><span class="annot"><span class="annottext">tidyVarBndrs :: TidyEnv -&gt; [TyCoVar] -&gt; (TidyEnv, [TyCoVar])
</span><a href="GHC.Core.TyCo.Tidy.html#tidyVarBndrs"><span class="hs-identifier hs-var hs-var">tidyVarBndrs</span></a></span></span><span> </span><span id="local-6989586621682561657"><span class="annot"><span class="annottext">TidyEnv
</span><a href="#local-6989586621682561657"><span class="hs-identifier hs-var">tidy_env</span></a></span></span><span> </span><span id="local-6989586621682561658"><span class="annot"><span class="annottext">[TyCoVar]
</span><a href="#local-6989586621682561658"><span class="hs-identifier hs-var">tvs</span></a></span></span><span>
</span><span id="line-111"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(TidyEnv -&gt; TyCoVar -&gt; (TidyEnv, TyCoVar))
-&gt; TidyEnv -&gt; [TyCoVar] -&gt; (TidyEnv, [TyCoVar])
forall (t :: * -&gt; *) s a b.
Traversable t =&gt;
(s -&gt; a -&gt; (s, b)) -&gt; s -&gt; t a -&gt; (s, t b)
</span><span class="hs-identifier hs-var">mapAccumL</span></span><span> </span><span class="annot"><span class="annottext">TidyEnv -&gt; TyCoVar -&gt; (TidyEnv, TyCoVar)
</span><a href="GHC.Core.TyCo.Tidy.html#tidyVarBndr"><span class="hs-identifier hs-var">tidyVarBndr</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[TyCoVar] -&gt; TidyEnv -&gt; TidyEnv
</span><a href="GHC.Core.TyCo.Tidy.html#avoidNameClashes"><span class="hs-identifier hs-var">avoidNameClashes</span></a></span><span> </span><span class="annot"><span class="annottext">[TyCoVar]
</span><a href="#local-6989586621682561658"><span class="hs-identifier hs-var">tvs</span></a></span><span> </span><span class="annot"><span class="annottext">TidyEnv
</span><a href="#local-6989586621682561657"><span class="hs-identifier hs-var">tidy_env</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[TyCoVar]
</span><a href="#local-6989586621682561658"><span class="hs-identifier hs-var">tvs</span></a></span><span>
</span><span id="line-112"></span><span>
</span><span id="line-113"></span><span class="annot"><a href="GHC.Core.TyCo.Tidy.html#tidyVarBndr"><span class="hs-identifier hs-type">tidyVarBndr</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Types.Var.Env.html#TidyEnv"><span class="hs-identifier hs-type">TidyEnv</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Types.Var.html#TyCoVar"><span class="hs-identifier hs-type">TyCoVar</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Types.Var.Env.html#TidyEnv"><span class="hs-identifier hs-type">TidyEnv</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Types.Var.html#TyCoVar"><span class="hs-identifier hs-type">TyCoVar</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-114"></span><span id="tidyVarBndr"><span class="annot"><span class="annottext">tidyVarBndr :: TidyEnv -&gt; TyCoVar -&gt; (TidyEnv, TyCoVar)
</span><a href="GHC.Core.TyCo.Tidy.html#tidyVarBndr"><span class="hs-identifier hs-var hs-var">tidyVarBndr</span></a></span></span><span> </span><span id="local-6989586621682561659"><span class="annot"><span class="annottext">tidy_env :: TidyEnv
</span><a href="#local-6989586621682561659"><span class="hs-identifier hs-var">tidy_env</span></a></span></span><span class="hs-glyph">@</span><span class="hs-special">(</span><span id="local-6989586621682561660"><span class="annot"><span class="annottext">TidyOccEnv
</span><a href="#local-6989586621682561660"><span class="hs-identifier hs-var">occ_env</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682561661"><span class="annot"><span class="annottext">VarEnv TyCoVar
</span><a href="#local-6989586621682561661"><span class="hs-identifier hs-var">subst</span></a></span></span><span class="hs-special">)</span><span> </span><span id="local-6989586621682561662"><span class="annot"><span class="annottext">TyCoVar
</span><a href="#local-6989586621682561662"><span class="hs-identifier hs-var">var</span></a></span></span><span>
</span><span id="line-115"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">TidyOccEnv -&gt; OccName -&gt; (TidyOccEnv, OccName)
</span><a href="GHC.Types.Name.Occurrence.html#tidyOccName"><span class="hs-identifier hs-var">tidyOccName</span></a></span><span> </span><span class="annot"><span class="annottext">TidyOccEnv
</span><a href="#local-6989586621682561660"><span class="hs-identifier hs-var">occ_env</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TyCoVar -&gt; OccName
</span><a href="GHC.Core.TyCo.Tidy.html#getHelpfulOccName"><span class="hs-identifier hs-var">getHelpfulOccName</span></a></span><span> </span><span class="annot"><span class="annottext">TyCoVar
</span><a href="#local-6989586621682561662"><span class="hs-identifier hs-var">var</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-116"></span><span>      </span><span class="hs-special">(</span><span id="local-6989586621682561665"><span class="annot"><span class="annottext">TidyOccEnv
</span><a href="#local-6989586621682561665"><span class="hs-identifier hs-var">occ_env'</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682561666"><span class="annot"><span class="annottext">OccName
</span><a href="#local-6989586621682561666"><span class="hs-identifier hs-var">occ'</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="hs-special">(</span><span class="annot"><span class="annottext">TidyOccEnv
</span><a href="#local-6989586621682561665"><span class="hs-identifier hs-var">occ_env'</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">VarEnv TyCoVar
</span><a href="#local-6989586621682561667"><span class="hs-identifier hs-var">subst'</span></a></span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">TyCoVar
</span><a href="#local-6989586621682561668"><span class="hs-identifier hs-var">var'</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-117"></span><span>        </span><span class="hs-keyword">where</span><span>
</span><span id="line-118"></span><span>          </span><span id="local-6989586621682561667"><span class="annot"><span class="annottext">subst' :: VarEnv TyCoVar
</span><a href="#local-6989586621682561667"><span class="hs-identifier hs-var hs-var">subst'</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">VarEnv TyCoVar -&gt; TyCoVar -&gt; TyCoVar -&gt; VarEnv TyCoVar
forall a. VarEnv a -&gt; TyCoVar -&gt; a -&gt; VarEnv a
</span><a href="GHC.Types.Var.Env.html#extendVarEnv"><span class="hs-identifier hs-var">extendVarEnv</span></a></span><span> </span><span class="annot"><span class="annottext">VarEnv TyCoVar
</span><a href="#local-6989586621682561661"><span class="hs-identifier hs-var">subst</span></a></span><span> </span><span class="annot"><span class="annottext">TyCoVar
</span><a href="#local-6989586621682561662"><span class="hs-identifier hs-var">var</span></a></span><span> </span><span class="annot"><span class="annottext">TyCoVar
</span><a href="#local-6989586621682561668"><span class="hs-identifier hs-var">var'</span></a></span><span>
</span><span id="line-119"></span><span>          </span><span id="local-6989586621682561668"><span class="annot"><span class="annottext">var' :: TyCoVar
</span><a href="#local-6989586621682561668"><span class="hs-identifier hs-var hs-var">var'</span></a></span></span><span>   </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(Type -&gt; Type) -&gt; TyCoVar -&gt; TyCoVar
</span><a href="GHC.Types.Var.html#updateVarType"><span class="hs-identifier hs-var">updateVarType</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TidyEnv -&gt; Type -&gt; Type
</span><a href="GHC.Core.TyCo.Tidy.html#tidyType"><span class="hs-identifier hs-var">tidyType</span></a></span><span> </span><span class="annot"><span class="annottext">TidyEnv
</span><a href="#local-6989586621682561659"><span class="hs-identifier hs-var">tidy_env</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TyCoVar -&gt; Name -&gt; TyCoVar
</span><a href="GHC.Types.Var.html#setVarName"><span class="hs-identifier hs-var">setVarName</span></a></span><span> </span><span class="annot"><span class="annottext">TyCoVar
</span><a href="#local-6989586621682561662"><span class="hs-identifier hs-var">var</span></a></span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621682561672"><span class="hs-identifier hs-var">name'</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-120"></span><span>          </span><span id="local-6989586621682561672"><span class="annot"><span class="annottext">name' :: Name
</span><a href="#local-6989586621682561672"><span class="hs-identifier hs-var hs-var">name'</span></a></span></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Name -&gt; OccName -&gt; Name
</span><a href="GHC.Types.Name.html#tidyNameOcc"><span class="hs-identifier hs-var">tidyNameOcc</span></a></span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621682561674"><span class="hs-identifier hs-var">name</span></a></span><span> </span><span class="annot"><span class="annottext">OccName
</span><a href="#local-6989586621682561666"><span class="hs-identifier hs-var">occ'</span></a></span><span>
</span><span id="line-121"></span><span>          </span><span id="local-6989586621682561674"><span class="annot"><span class="annottext">name :: Name
</span><a href="#local-6989586621682561674"><span class="hs-identifier hs-var hs-var">name</span></a></span></span><span>   </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">TyCoVar -&gt; Name
</span><a href="GHC.Types.Var.html#varName"><span class="hs-identifier hs-var">varName</span></a></span><span> </span><span class="annot"><span class="annottext">TyCoVar
</span><a href="#local-6989586621682561662"><span class="hs-identifier hs-var">var</span></a></span><span>
</span><span id="line-122"></span><span>
</span><span id="line-123"></span><span class="annot"><a href="GHC.Core.TyCo.Tidy.html#avoidNameClashes"><span class="hs-identifier hs-type">avoidNameClashes</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="GHC.Types.Var.html#TyCoVar"><span class="hs-identifier hs-type">TyCoVar</span></a></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Types.Var.Env.html#TidyEnv"><span class="hs-identifier hs-type">TidyEnv</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Types.Var.Env.html#TidyEnv"><span class="hs-identifier hs-type">TidyEnv</span></a></span><span>
</span><span id="line-124"></span><span class="hs-comment">-- Seed the occ_env with clashes among the names, see</span><span>
</span><span id="line-125"></span><span class="hs-comment">-- Note [Tidying multiple names at once] in GHC.Types.Name.Occurrence</span><span>
</span><span id="line-126"></span><span id="avoidNameClashes"><span class="annot"><span class="annottext">avoidNameClashes :: [TyCoVar] -&gt; TidyEnv -&gt; TidyEnv
</span><a href="GHC.Core.TyCo.Tidy.html#avoidNameClashes"><span class="hs-identifier hs-var hs-var">avoidNameClashes</span></a></span></span><span> </span><span id="local-6989586621682561676"><span class="annot"><span class="annottext">[TyCoVar]
</span><a href="#local-6989586621682561676"><span class="hs-identifier hs-var">tvs</span></a></span></span><span> </span><span class="hs-special">(</span><span id="local-6989586621682561677"><span class="annot"><span class="annottext">TidyOccEnv
</span><a href="#local-6989586621682561677"><span class="hs-identifier hs-var">occ_env</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682561678"><span class="annot"><span class="annottext">VarEnv TyCoVar
</span><a href="#local-6989586621682561678"><span class="hs-identifier hs-var">subst</span></a></span></span><span class="hs-special">)</span><span>
</span><span id="line-127"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TidyOccEnv -&gt; [OccName] -&gt; TidyOccEnv
</span><a href="GHC.Types.Name.Occurrence.html#avoidClashesOccEnv"><span class="hs-identifier hs-var">avoidClashesOccEnv</span></a></span><span> </span><span class="annot"><span class="annottext">TidyOccEnv
</span><a href="#local-6989586621682561677"><span class="hs-identifier hs-var">occ_env</span></a></span><span> </span><span class="annot"><span class="annottext">[OccName]
</span><a href="#local-6989586621682561680"><span class="hs-identifier hs-var">occs</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">VarEnv TyCoVar
</span><a href="#local-6989586621682561678"><span class="hs-identifier hs-var">subst</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-128"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-129"></span><span>    </span><span id="local-6989586621682561680"><span class="annot"><span class="annottext">occs :: [OccName]
</span><a href="#local-6989586621682561680"><span class="hs-identifier hs-var hs-var">occs</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(TyCoVar -&gt; OccName) -&gt; [TyCoVar] -&gt; [OccName]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><span class="hs-identifier hs-var">map</span></span><span> </span><span class="annot"><span class="annottext">TyCoVar -&gt; OccName
</span><a href="GHC.Core.TyCo.Tidy.html#getHelpfulOccName"><span class="hs-identifier hs-var">getHelpfulOccName</span></a></span><span> </span><span class="annot"><span class="annottext">[TyCoVar]
</span><a href="#local-6989586621682561676"><span class="hs-identifier hs-var">tvs</span></a></span><span>
</span><span id="line-130"></span><span>
</span><span id="line-131"></span><span class="annot"><a href="GHC.Core.TyCo.Tidy.html#getHelpfulOccName"><span class="hs-identifier hs-type">getHelpfulOccName</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Types.Var.html#TyCoVar"><span class="hs-identifier hs-type">TyCoVar</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Types.Name.Occurrence.html#OccName"><span class="hs-identifier hs-type">OccName</span></a></span><span>
</span><span id="line-132"></span><span class="hs-comment">-- A TcTyVar with a System Name is probably a</span><span>
</span><span id="line-133"></span><span class="hs-comment">-- unification variable; when we tidy them we give them a trailing</span><span>
</span><span id="line-134"></span><span class="hs-comment">-- &quot;0&quot; (or 1 etc) so that they don't take precedence for the</span><span>
</span><span id="line-135"></span><span class="hs-comment">-- un-modified name. Plus, indicating a unification variable in</span><span>
</span><span id="line-136"></span><span class="hs-comment">-- this way is a helpful clue for users</span><span>
</span><span id="line-137"></span><span id="getHelpfulOccName"><span class="annot"><span class="annottext">getHelpfulOccName :: TyCoVar -&gt; OccName
</span><a href="GHC.Core.TyCo.Tidy.html#getHelpfulOccName"><span class="hs-identifier hs-var hs-var">getHelpfulOccName</span></a></span></span><span> </span><span id="local-6989586621682561681"><span class="annot"><span class="annottext">TyCoVar
</span><a href="#local-6989586621682561681"><span class="hs-identifier hs-var">tv</span></a></span></span><span>
</span><span id="line-138"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Name -&gt; Bool
</span><a href="GHC.Types.Name.html#isSystemName"><span class="hs-identifier hs-var">isSystemName</span></a></span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621682561683"><span class="hs-identifier hs-var">name</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">TyCoVar -&gt; Bool
</span><a href="GHC.Types.Var.html#isTcTyVar"><span class="hs-identifier hs-var">isTcTyVar</span></a></span><span> </span><span class="annot"><span class="annottext">TyCoVar
</span><a href="#local-6989586621682561681"><span class="hs-identifier hs-var">tv</span></a></span><span>
</span><span id="line-139"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">FastString -&gt; OccName
</span><a href="GHC.Types.Name.Occurrence.html#mkTyVarOccFS"><span class="hs-identifier hs-var">mkTyVarOccFS</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">OccName -&gt; FastString
</span><a href="GHC.Types.Name.Occurrence.html#occNameFS"><span class="hs-identifier hs-var">occNameFS</span></a></span><span> </span><span class="annot"><span class="annottext">OccName
</span><a href="#local-6989586621682561687"><span class="hs-identifier hs-var">occ</span></a></span><span> </span><span class="annot"><span class="annottext">FastString -&gt; FastString -&gt; FastString
</span><a href="GHC.Data.FastString.html#appendFS"><span class="hs-operator hs-var">`appendFS`</span></a></span><span> </span><span class="annot"><span class="annottext">String -&gt; FastString
</span><a href="GHC.Data.FastString.html#fsLit"><span class="hs-identifier hs-var">fsLit</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;0&quot;</span></span><span class="hs-special">)</span><span>
</span><span id="line-140"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">otherwise</span></span><span>
</span><span id="line-141"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">OccName
</span><a href="#local-6989586621682561687"><span class="hs-identifier hs-var">occ</span></a></span><span>
</span><span id="line-142"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-143"></span><span>   </span><span id="local-6989586621682561683"><span class="annot"><span class="annottext">name :: Name
</span><a href="#local-6989586621682561683"><span class="hs-identifier hs-var hs-var">name</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">TyCoVar -&gt; Name
</span><a href="GHC.Types.Var.html#varName"><span class="hs-identifier hs-var">varName</span></a></span><span> </span><span class="annot"><span class="annottext">TyCoVar
</span><a href="#local-6989586621682561681"><span class="hs-identifier hs-var">tv</span></a></span><span>
</span><span id="line-144"></span><span>   </span><span id="local-6989586621682561687"><span class="annot"><span class="annottext">occ :: OccName
</span><a href="#local-6989586621682561687"><span class="hs-identifier hs-var hs-var">occ</span></a></span></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Name -&gt; OccName
forall a. NamedThing a =&gt; a -&gt; OccName
</span><a href="GHC.Types.Name.html#getOccName"><span class="hs-identifier hs-var">getOccName</span></a></span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621682561683"><span class="hs-identifier hs-var">name</span></a></span><span>
</span><span id="line-145"></span><span>
</span><span id="line-146"></span><span id="local-6989586621682561584"><span class="annot"><a href="GHC.Core.TyCo.Tidy.html#tidyForAllTyBinder"><span class="hs-identifier hs-type">tidyForAllTyBinder</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Types.Var.Env.html#TidyEnv"><span class="hs-identifier hs-type">TidyEnv</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Types.Var.html#VarBndr"><span class="hs-identifier hs-type">VarBndr</span></a></span><span> </span><span class="annot"><a href="GHC.Types.Var.html#TyCoVar"><span class="hs-identifier hs-type">TyCoVar</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682561584"><span class="hs-identifier hs-type">vis</span></a></span><span>
</span><span id="line-147"></span><span>                  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Types.Var.Env.html#TidyEnv"><span class="hs-identifier hs-type">TidyEnv</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Types.Var.html#VarBndr"><span class="hs-identifier hs-type">VarBndr</span></a></span><span> </span><span class="annot"><a href="GHC.Types.Var.html#TyCoVar"><span class="hs-identifier hs-type">TyCoVar</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682561584"><span class="hs-identifier hs-type">vis</span></a></span><span class="hs-special">)</span></span><span>
</span><span id="line-148"></span><span id="tidyForAllTyBinder"><span class="annot"><span class="annottext">tidyForAllTyBinder :: forall vis.
TidyEnv -&gt; VarBndr TyCoVar vis -&gt; (TidyEnv, VarBndr TyCoVar vis)
</span><a href="GHC.Core.TyCo.Tidy.html#tidyForAllTyBinder"><span class="hs-identifier hs-var hs-var">tidyForAllTyBinder</span></a></span></span><span> </span><span id="local-6989586621682561691"><span class="annot"><span class="annottext">TidyEnv
</span><a href="#local-6989586621682561691"><span class="hs-identifier hs-var">tidy_env</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Types.Var.html#Bndr"><span class="hs-identifier hs-type">Bndr</span></a></span><span> </span><span id="local-6989586621682561693"><span class="annot"><span class="annottext">TyCoVar
</span><a href="#local-6989586621682561693"><span class="hs-identifier hs-var">tv</span></a></span></span><span> </span><span id="local-6989586621682561694"><span class="annot"><span class="annottext">vis
</span><a href="#local-6989586621682561694"><span class="hs-identifier hs-var">vis</span></a></span></span><span class="hs-special">)</span><span>
</span><span id="line-149"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TidyEnv
</span><a href="#local-6989586621682561695"><span class="hs-identifier hs-var">tidy_env'</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">TyCoVar -&gt; vis -&gt; VarBndr TyCoVar vis
forall var argf. var -&gt; argf -&gt; VarBndr var argf
</span><a href="GHC.Types.Var.html#Bndr"><span class="hs-identifier hs-var">Bndr</span></a></span><span> </span><span class="annot"><span class="annottext">TyCoVar
</span><a href="#local-6989586621682561696"><span class="hs-identifier hs-var">tv'</span></a></span><span> </span><span class="annot"><span class="annottext">vis
</span><a href="#local-6989586621682561694"><span class="hs-identifier hs-var">vis</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-150"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-151"></span><span>    </span><span class="hs-special">(</span><span id="local-6989586621682561695"><span class="annot"><span class="annottext">TidyEnv
</span><a href="#local-6989586621682561695"><span class="hs-identifier hs-var">tidy_env'</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682561696"><span class="annot"><span class="annottext">TyCoVar
</span><a href="#local-6989586621682561696"><span class="hs-identifier hs-var">tv'</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">TidyEnv -&gt; TyCoVar -&gt; (TidyEnv, TyCoVar)
</span><a href="GHC.Core.TyCo.Tidy.html#tidyVarBndr"><span class="hs-identifier hs-var">tidyVarBndr</span></a></span><span> </span><span class="annot"><span class="annottext">TidyEnv
</span><a href="#local-6989586621682561691"><span class="hs-identifier hs-var">tidy_env</span></a></span><span> </span><span class="annot"><span class="annottext">TyCoVar
</span><a href="#local-6989586621682561693"><span class="hs-identifier hs-var">tv</span></a></span><span>
</span><span id="line-152"></span><span>
</span><span id="line-153"></span><span id="local-6989586621682561589"><span class="annot"><a href="GHC.Core.TyCo.Tidy.html#tidyForAllTyBinders"><span class="hs-identifier hs-type">tidyForAllTyBinders</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Types.Var.Env.html#TidyEnv"><span class="hs-identifier hs-type">TidyEnv</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="GHC.Types.Var.html#VarBndr"><span class="hs-identifier hs-type">VarBndr</span></a></span><span> </span><span class="annot"><a href="GHC.Types.Var.html#TyCoVar"><span class="hs-identifier hs-type">TyCoVar</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682561589"><span class="hs-identifier hs-type">vis</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-154"></span><span>                   </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Types.Var.Env.html#TidyEnv"><span class="hs-identifier hs-type">TidyEnv</span></a></span><span class="hs-special">,</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="GHC.Types.Var.html#VarBndr"><span class="hs-identifier hs-type">VarBndr</span></a></span><span> </span><span class="annot"><a href="GHC.Types.Var.html#TyCoVar"><span class="hs-identifier hs-type">TyCoVar</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682561589"><span class="hs-identifier hs-type">vis</span></a></span><span class="hs-special">]</span><span class="hs-special">)</span></span><span>
</span><span id="line-155"></span><span id="tidyForAllTyBinders"><span class="annot"><span class="annottext">tidyForAllTyBinders :: forall vis.
TidyEnv
-&gt; [VarBndr TyCoVar vis] -&gt; (TidyEnv, [VarBndr TyCoVar vis])
</span><a href="GHC.Core.TyCo.Tidy.html#tidyForAllTyBinders"><span class="hs-identifier hs-var hs-var">tidyForAllTyBinders</span></a></span></span><span> </span><span id="local-6989586621682561698"><span class="annot"><span class="annottext">TidyEnv
</span><a href="#local-6989586621682561698"><span class="hs-identifier hs-var">tidy_env</span></a></span></span><span> </span><span id="local-6989586621682561699"><span class="annot"><span class="annottext">[VarBndr TyCoVar vis]
</span><a href="#local-6989586621682561699"><span class="hs-identifier hs-var">tvbs</span></a></span></span><span>
</span><span id="line-156"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(TidyEnv -&gt; VarBndr TyCoVar vis -&gt; (TidyEnv, VarBndr TyCoVar vis))
-&gt; TidyEnv
-&gt; [VarBndr TyCoVar vis]
-&gt; (TidyEnv, [VarBndr TyCoVar vis])
forall (t :: * -&gt; *) s a b.
Traversable t =&gt;
(s -&gt; a -&gt; (s, b)) -&gt; s -&gt; t a -&gt; (s, t b)
</span><span class="hs-identifier hs-var">mapAccumL</span></span><span> </span><span class="annot"><span class="annottext">TidyEnv -&gt; VarBndr TyCoVar vis -&gt; (TidyEnv, VarBndr TyCoVar vis)
forall vis.
TidyEnv -&gt; VarBndr TyCoVar vis -&gt; (TidyEnv, VarBndr TyCoVar vis)
</span><a href="GHC.Core.TyCo.Tidy.html#tidyForAllTyBinder"><span class="hs-identifier hs-var">tidyForAllTyBinder</span></a></span><span>
</span><span id="line-157"></span><span>              </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[TyCoVar] -&gt; TidyEnv -&gt; TidyEnv
</span><a href="GHC.Core.TyCo.Tidy.html#avoidNameClashes"><span class="hs-identifier hs-var">avoidNameClashes</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[VarBndr TyCoVar vis] -&gt; [TyCoVar]
forall tv argf. [VarBndr tv argf] -&gt; [tv]
</span><a href="GHC.Types.Var.html#binderVars"><span class="hs-identifier hs-var">binderVars</span></a></span><span> </span><span class="annot"><span class="annottext">[VarBndr TyCoVar vis]
</span><a href="#local-6989586621682561699"><span class="hs-identifier hs-var">tvbs</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">TidyEnv
</span><a href="#local-6989586621682561698"><span class="hs-identifier hs-var">tidy_env</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[VarBndr TyCoVar vis]
</span><a href="#local-6989586621682561699"><span class="hs-identifier hs-var">tvbs</span></a></span><span>
</span><span id="line-158"></span><span>
</span><span id="line-159"></span><span class="hs-comment">---------------</span><span>
</span><span id="line-160"></span><span class="annot"><a href="GHC.Core.TyCo.Tidy.html#tidyFreeTyCoVars"><span class="hs-identifier hs-type">tidyFreeTyCoVars</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Types.Var.Env.html#TidyEnv"><span class="hs-identifier hs-type">TidyEnv</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="GHC.Types.Var.html#TyCoVar"><span class="hs-identifier hs-type">TyCoVar</span></a></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Types.Var.Env.html#TidyEnv"><span class="hs-identifier hs-type">TidyEnv</span></a></span><span>
</span><span id="line-161"></span><span class="hs-comment">-- ^ Add the free 'TyVar's to the env in tidy form,</span><span>
</span><span id="line-162"></span><span class="hs-comment">-- so that we can tidy the type they are free in</span><span>
</span><span id="line-163"></span><span class="hs-comment">-- Precondition: input free vars are closed over kinds and</span><span>
</span><span id="line-164"></span><span class="hs-comment">-- This function does a scopedSort, so that tidied variables</span><span>
</span><span id="line-165"></span><span class="hs-comment">-- have tidied kinds.</span><span>
</span><span id="line-166"></span><span class="hs-comment">-- See Note [Tidying is idempotent]</span><span>
</span><span id="line-167"></span><span id="tidyFreeTyCoVars"><span class="annot"><span class="annottext">tidyFreeTyCoVars :: TidyEnv -&gt; [TyCoVar] -&gt; TidyEnv
</span><a href="GHC.Core.TyCo.Tidy.html#tidyFreeTyCoVars"><span class="hs-identifier hs-var hs-var">tidyFreeTyCoVars</span></a></span></span><span> </span><span id="local-6989586621682561702"><span class="annot"><span class="annottext">TidyEnv
</span><a href="#local-6989586621682561702"><span class="hs-identifier hs-var">tidy_env</span></a></span></span><span> </span><span id="local-6989586621682561703"><span class="annot"><span class="annottext">[TyCoVar]
</span><a href="#local-6989586621682561703"><span class="hs-identifier hs-var">tyvars</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(TidyEnv, [TyCoVar]) -&gt; TidyEnv
forall a b. (a, b) -&gt; a
</span><span class="hs-identifier hs-var">fst</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TidyEnv -&gt; [TyCoVar] -&gt; (TidyEnv, [TyCoVar])
</span><a href="GHC.Core.TyCo.Tidy.html#tidyFreeTyCoVarsX"><span class="hs-identifier hs-var">tidyFreeTyCoVarsX</span></a></span><span> </span><span class="annot"><span class="annottext">TidyEnv
</span><a href="#local-6989586621682561702"><span class="hs-identifier hs-var">tidy_env</span></a></span><span> </span><span class="annot"><span class="annottext">[TyCoVar]
</span><a href="#local-6989586621682561703"><span class="hs-identifier hs-var">tyvars</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-168"></span><span>
</span><span id="line-169"></span><span class="hs-comment">---------------</span><span>
</span><span id="line-170"></span><span class="annot"><a href="GHC.Core.TyCo.Tidy.html#tidyFreeTyCoVarsX"><span class="hs-identifier hs-type">tidyFreeTyCoVarsX</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Types.Var.Env.html#TidyEnv"><span class="hs-identifier hs-type">TidyEnv</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="GHC.Types.Var.html#TyCoVar"><span class="hs-identifier hs-type">TyCoVar</span></a></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Types.Var.Env.html#TidyEnv"><span class="hs-identifier hs-type">TidyEnv</span></a></span><span class="hs-special">,</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="GHC.Types.Var.html#TyCoVar"><span class="hs-identifier hs-type">TyCoVar</span></a></span><span class="hs-special">]</span><span class="hs-special">)</span><span>
</span><span id="line-171"></span><span class="hs-comment">-- Precondition: input free vars are closed over kinds and</span><span>
</span><span id="line-172"></span><span class="hs-comment">-- This function does a scopedSort, so that tidied variables</span><span>
</span><span id="line-173"></span><span class="hs-comment">-- have tidied kinds.</span><span>
</span><span id="line-174"></span><span class="hs-comment">-- See Note [Tidying is idempotent]</span><span>
</span><span id="line-175"></span><span id="tidyFreeTyCoVarsX"><span class="annot"><span class="annottext">tidyFreeTyCoVarsX :: TidyEnv -&gt; [TyCoVar] -&gt; (TidyEnv, [TyCoVar])
</span><a href="GHC.Core.TyCo.Tidy.html#tidyFreeTyCoVarsX"><span class="hs-identifier hs-var hs-var">tidyFreeTyCoVarsX</span></a></span></span><span> </span><span id="local-6989586621682561705"><span class="annot"><span class="annottext">TidyEnv
</span><a href="#local-6989586621682561705"><span class="hs-identifier hs-var">env</span></a></span></span><span> </span><span id="local-6989586621682561706"><span class="annot"><span class="annottext">[TyCoVar]
</span><a href="#local-6989586621682561706"><span class="hs-identifier hs-var">tyvars</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(TidyEnv -&gt; TyCoVar -&gt; (TidyEnv, TyCoVar))
-&gt; TidyEnv -&gt; [TyCoVar] -&gt; (TidyEnv, [TyCoVar])
forall (t :: * -&gt; *) s a b.
Traversable t =&gt;
(s -&gt; a -&gt; (s, b)) -&gt; s -&gt; t a -&gt; (s, t b)
</span><span class="hs-identifier hs-var">mapAccumL</span></span><span> </span><span class="annot"><span class="annottext">TidyEnv -&gt; TyCoVar -&gt; (TidyEnv, TyCoVar)
</span><a href="GHC.Core.TyCo.Tidy.html#tidyFreeTyCoVarX"><span class="hs-identifier hs-var">tidyFreeTyCoVarX</span></a></span><span> </span><span class="annot"><span class="annottext">TidyEnv
</span><a href="#local-6989586621682561705"><span class="hs-identifier hs-var">env</span></a></span><span> </span><span class="annot"><span class="annottext">([TyCoVar] -&gt; (TidyEnv, [TyCoVar]))
-&gt; [TyCoVar] -&gt; (TidyEnv, [TyCoVar])
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-176"></span><span>                               </span><span class="annot"><span class="annottext">[TyCoVar] -&gt; [TyCoVar]
</span><a href="GHC.Core.TyCo.FVs.html#scopedSort"><span class="hs-identifier hs-var">scopedSort</span></a></span><span> </span><span class="annot"><span class="annottext">[TyCoVar]
</span><a href="#local-6989586621682561706"><span class="hs-identifier hs-var">tyvars</span></a></span><span>
</span><span id="line-177"></span><span>
</span><span id="line-178"></span><span class="hs-comment">---------------</span><span>
</span><span id="line-179"></span><span class="annot"><a href="GHC.Core.TyCo.Tidy.html#tidyFreeTyCoVarX"><span class="hs-identifier hs-type">tidyFreeTyCoVarX</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Types.Var.Env.html#TidyEnv"><span class="hs-identifier hs-type">TidyEnv</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Types.Var.html#TyCoVar"><span class="hs-identifier hs-type">TyCoVar</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Types.Var.Env.html#TidyEnv"><span class="hs-identifier hs-type">TidyEnv</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Types.Var.html#TyCoVar"><span class="hs-identifier hs-type">TyCoVar</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-180"></span><span class="hs-comment">-- ^ Treat a new 'TyCoVar' as a binder, and give it a fresh tidy name</span><span>
</span><span id="line-181"></span><span class="hs-comment">-- using the environment if one has not already been allocated. See</span><span>
</span><span id="line-182"></span><span class="hs-comment">-- also 'tidyVarBndr'</span><span>
</span><span id="line-183"></span><span class="hs-comment">-- See Note [Tidying is idempotent]</span><span>
</span><span id="line-184"></span><span id="tidyFreeTyCoVarX"><span class="annot"><span class="annottext">tidyFreeTyCoVarX :: TidyEnv -&gt; TyCoVar -&gt; (TidyEnv, TyCoVar)
</span><a href="GHC.Core.TyCo.Tidy.html#tidyFreeTyCoVarX"><span class="hs-identifier hs-var hs-var">tidyFreeTyCoVarX</span></a></span></span><span> </span><span id="local-6989586621682561708"><span class="annot"><span class="annottext">env :: TidyEnv
</span><a href="#local-6989586621682561708"><span class="hs-identifier hs-var">env</span></a></span></span><span class="hs-glyph">@</span><span class="hs-special">(</span><span class="annot"><span class="annottext">TidyOccEnv
</span><span class="hs-identifier">_</span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682561709"><span class="annot"><span class="annottext">VarEnv TyCoVar
</span><a href="#local-6989586621682561709"><span class="hs-identifier hs-var">subst</span></a></span></span><span class="hs-special">)</span><span> </span><span id="local-6989586621682561710"><span class="annot"><span class="annottext">TyCoVar
</span><a href="#local-6989586621682561710"><span class="hs-identifier hs-var">tyvar</span></a></span></span><span>
</span><span id="line-185"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">VarEnv TyCoVar -&gt; TyCoVar -&gt; Maybe TyCoVar
forall a. VarEnv a -&gt; TyCoVar -&gt; Maybe a
</span><a href="GHC.Types.Var.Env.html#lookupVarEnv"><span class="hs-identifier hs-var">lookupVarEnv</span></a></span><span> </span><span class="annot"><span class="annottext">VarEnv TyCoVar
</span><a href="#local-6989586621682561709"><span class="hs-identifier hs-var">subst</span></a></span><span> </span><span class="annot"><span class="annottext">TyCoVar
</span><a href="#local-6989586621682561710"><span class="hs-identifier hs-var">tyvar</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-186"></span><span>        </span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span id="local-6989586621682561712"><span class="annot"><span class="annottext">TyCoVar
</span><a href="#local-6989586621682561712"><span class="hs-identifier hs-var">tyvar'</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TidyEnv
</span><a href="#local-6989586621682561708"><span class="hs-identifier hs-var">env</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">TyCoVar
</span><a href="#local-6989586621682561712"><span class="hs-identifier hs-var">tyvar'</span></a></span><span class="hs-special">)</span><span>           </span><span class="hs-comment">-- Already substituted</span><span>
</span><span id="line-187"></span><span>        </span><span class="annot"><span class="annottext">Maybe TyCoVar
</span><span class="hs-identifier hs-var">Nothing</span></span><span>     </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">TidyEnv -&gt; TyCoVar -&gt; (TidyEnv, TyCoVar)
</span><a href="GHC.Core.TyCo.Tidy.html#tidyVarBndr"><span class="hs-identifier hs-var">tidyVarBndr</span></a></span><span> </span><span class="annot"><span class="annottext">TidyEnv
</span><a href="#local-6989586621682561708"><span class="hs-identifier hs-var">env</span></a></span><span> </span><span class="annot"><span class="annottext">TyCoVar
</span><a href="#local-6989586621682561710"><span class="hs-identifier hs-var">tyvar</span></a></span><span>  </span><span class="hs-comment">-- Treat it as a binder</span><span>
</span><span id="line-188"></span><span>
</span><span id="line-189"></span><span class="hs-comment">---------------</span><span>
</span><span id="line-190"></span><span class="annot"><a href="GHC.Core.TyCo.Tidy.html#tidyTyCoVarOcc"><span class="hs-identifier hs-type">tidyTyCoVarOcc</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Types.Var.Env.html#TidyEnv"><span class="hs-identifier hs-type">TidyEnv</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Types.Var.html#TyCoVar"><span class="hs-identifier hs-type">TyCoVar</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Types.Var.html#TyCoVar"><span class="hs-identifier hs-type">TyCoVar</span></a></span><span>
</span><span id="line-191"></span><span id="tidyTyCoVarOcc"><span class="annot"><span class="annottext">tidyTyCoVarOcc :: TidyEnv -&gt; TyCoVar -&gt; TyCoVar
</span><a href="GHC.Core.TyCo.Tidy.html#tidyTyCoVarOcc"><span class="hs-identifier hs-var hs-var">tidyTyCoVarOcc</span></a></span></span><span> </span><span id="local-6989586621682561713"><span class="annot"><span class="annottext">env :: TidyEnv
</span><a href="#local-6989586621682561713"><span class="hs-identifier hs-var">env</span></a></span></span><span class="hs-glyph">@</span><span class="hs-special">(</span><span class="annot"><span class="annottext">TidyOccEnv
</span><span class="hs-identifier">_</span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682561714"><span class="annot"><span class="annottext">VarEnv TyCoVar
</span><a href="#local-6989586621682561714"><span class="hs-identifier hs-var">subst</span></a></span></span><span class="hs-special">)</span><span> </span><span id="local-6989586621682561715"><span class="annot"><span class="annottext">TyCoVar
</span><a href="#local-6989586621682561715"><span class="hs-identifier hs-var">tcv</span></a></span></span><span>
</span><span id="line-192"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">VarEnv TyCoVar -&gt; TyCoVar -&gt; Maybe TyCoVar
forall a. VarEnv a -&gt; TyCoVar -&gt; Maybe a
</span><a href="GHC.Types.Var.Env.html#lookupVarEnv"><span class="hs-identifier hs-var">lookupVarEnv</span></a></span><span> </span><span class="annot"><span class="annottext">VarEnv TyCoVar
</span><a href="#local-6989586621682561714"><span class="hs-identifier hs-var">subst</span></a></span><span> </span><span class="annot"><span class="annottext">TyCoVar
</span><a href="#local-6989586621682561715"><span class="hs-identifier hs-var">tcv</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-193"></span><span>        </span><span class="annot"><span class="annottext">Maybe TyCoVar
</span><span class="hs-identifier hs-var">Nothing</span></span><span>   </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">(Type -&gt; Type) -&gt; TyCoVar -&gt; TyCoVar
</span><a href="GHC.Types.Var.html#updateVarType"><span class="hs-identifier hs-var">updateVarType</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TidyEnv -&gt; Type -&gt; Type
</span><a href="GHC.Core.TyCo.Tidy.html#tidyType"><span class="hs-identifier hs-var">tidyType</span></a></span><span> </span><span class="annot"><span class="annottext">TidyEnv
</span><a href="#local-6989586621682561713"><span class="hs-identifier hs-var">env</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">TyCoVar
</span><a href="#local-6989586621682561715"><span class="hs-identifier hs-var">tcv</span></a></span><span>
</span><span id="line-194"></span><span>        </span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span id="local-6989586621682561716"><span class="annot"><span class="annottext">TyCoVar
</span><a href="#local-6989586621682561716"><span class="hs-identifier hs-var">tcv'</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">TyCoVar
</span><a href="#local-6989586621682561716"><span class="hs-identifier hs-var">tcv'</span></a></span><span>
</span><span id="line-195"></span><span>
</span><span id="line-196"></span><span class="hs-comment">---------------</span><span>
</span><span id="line-197"></span><span>
</span><span id="line-198"></span><span class="hs-comment">{-
Note [Strictness in tidyType and friends]
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~

Since the result of tidying will be inserted into the HPT, a potentially
long-lived structure, we generally want to avoid pieces of the old AST
being retained by the thunks produced by tidying.

For this reason we take great care to ensure that all pieces of the tidied AST
are evaluated strictly.  So you will see lots of strict applications ($!) and
uses of `strictMap` in `tidyType`, `tidyTypes` and `tidyCo`.

In the case of tidying of lists (e.g. lists of arguments) we prefer to use
`strictMap f xs` rather than `seqList (map f xs)` as the latter will
unnecessarily allocate a thunk, which will then be almost-immediately
evaluated, for each list element.

Making `tidyType` strict has a rather large effect on performance: see #14738.
Sometimes as much as a 5% reduction in allocation.
-}</span><span>
</span><span id="line-218"></span><span>
</span><span id="line-219"></span><span class="hs-comment">-- | Tidy a list of Types</span><span>
</span><span id="line-220"></span><span class="hs-comment">--</span><span>
</span><span id="line-221"></span><span class="hs-comment">-- See Note [Strictness in tidyType and friends]</span><span>
</span><span id="line-222"></span><span class="annot"><a href="GHC.Core.TyCo.Tidy.html#tidyTypes"><span class="hs-identifier hs-type">tidyTypes</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Types.Var.Env.html#TidyEnv"><span class="hs-identifier hs-type">TidyEnv</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#Type"><span class="hs-identifier hs-type">Type</span></a></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#Type"><span class="hs-identifier hs-type">Type</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-223"></span><span id="tidyTypes"><span class="annot"><span class="annottext">tidyTypes :: TidyEnv -&gt; [Type] -&gt; [Type]
</span><a href="GHC.Core.TyCo.Tidy.html#tidyTypes"><span class="hs-identifier hs-var hs-var">tidyTypes</span></a></span></span><span> </span><span id="local-6989586621682561717"><span class="annot"><span class="annottext">TidyEnv
</span><a href="#local-6989586621682561717"><span class="hs-identifier hs-var">env</span></a></span></span><span> </span><span id="local-6989586621682561718"><span class="annot"><span class="annottext">[Type]
</span><a href="#local-6989586621682561718"><span class="hs-identifier hs-var">tys</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(Type -&gt; Type) -&gt; [Type] -&gt; [Type]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><a href="GHC.Utils.Misc.html#strictMap"><span class="hs-identifier hs-var">strictMap</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TidyEnv -&gt; Type -&gt; Type
</span><a href="GHC.Core.TyCo.Tidy.html#tidyType"><span class="hs-identifier hs-var">tidyType</span></a></span><span> </span><span class="annot"><span class="annottext">TidyEnv
</span><a href="#local-6989586621682561717"><span class="hs-identifier hs-var">env</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[Type]
</span><a href="#local-6989586621682561718"><span class="hs-identifier hs-var">tys</span></a></span><span>
</span><span id="line-224"></span><span>
</span><span id="line-225"></span><span class="hs-comment">---------------</span><span>
</span><span id="line-226"></span><span>
</span><span id="line-227"></span><span>
</span><span id="line-228"></span><span class="hs-comment">-- | Tidy a Type</span><span>
</span><span id="line-229"></span><span class="hs-comment">--</span><span>
</span><span id="line-230"></span><span class="hs-comment">-- See Note [Strictness in tidyType and friends]</span><span>
</span><span id="line-231"></span><span class="annot"><a href="GHC.Core.TyCo.Tidy.html#tidyType"><span class="hs-identifier hs-type">tidyType</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Types.Var.Env.html#TidyEnv"><span class="hs-identifier hs-type">TidyEnv</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#Type"><span class="hs-identifier hs-type">Type</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#Type"><span class="hs-identifier hs-type">Type</span></a></span><span>
</span><span id="line-232"></span><span id="tidyType"><span class="annot"><span class="annottext">tidyType :: TidyEnv -&gt; Type -&gt; Type
</span><a href="GHC.Core.TyCo.Tidy.html#tidyType"><span class="hs-identifier hs-var hs-var">tidyType</span></a></span></span><span> </span><span class="annot"><span class="annottext">TidyEnv
</span><span class="hs-identifier">_</span></span><span>   </span><span id="local-6989586621682561719"><span class="annot"><span class="annottext">t :: Type
</span><a href="#local-6989586621682561719"><span class="hs-identifier hs-var">t</span></a></span></span><span class="hs-glyph">@</span><span class="hs-special">(</span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#LitTy"><span class="hs-identifier hs-type">LitTy</span></a></span><span> </span><span class="hs-special">{</span><span class="hs-special">}</span><span class="hs-special">)</span><span>           </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682561719"><span class="hs-identifier hs-var">t</span></a></span><span> </span><span class="hs-comment">-- Preserve sharing</span><span>
</span><span id="line-233"></span><span class="annot"><a href="GHC.Core.TyCo.Tidy.html#tidyType"><span class="hs-identifier hs-var">tidyType</span></a></span><span> </span><span id="local-6989586621682561721"><span class="annot"><span class="annottext">TidyEnv
</span><a href="#local-6989586621682561721"><span class="hs-identifier hs-var">env</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#TyVarTy"><span class="hs-identifier hs-type">TyVarTy</span></a></span><span> </span><span id="local-6989586621682561723"><span class="annot"><span class="annottext">TyCoVar
</span><a href="#local-6989586621682561723"><span class="hs-identifier hs-var">tv</span></a></span></span><span class="hs-special">)</span><span>           </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">TyCoVar -&gt; Type
</span><a href="GHC.Core.TyCo.Rep.html#TyVarTy"><span class="hs-identifier hs-var">TyVarTy</span></a></span><span> </span><span class="annot"><span class="annottext">(TyCoVar -&gt; Type) -&gt; TyCoVar -&gt; Type
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$!</span></span><span> </span><span class="annot"><span class="annottext">TidyEnv -&gt; TyCoVar -&gt; TyCoVar
</span><a href="GHC.Core.TyCo.Tidy.html#tidyTyCoVarOcc"><span class="hs-identifier hs-var">tidyTyCoVarOcc</span></a></span><span> </span><span class="annot"><span class="annottext">TidyEnv
</span><a href="#local-6989586621682561721"><span class="hs-identifier hs-var">env</span></a></span><span> </span><span class="annot"><span class="annottext">TyCoVar
</span><a href="#local-6989586621682561723"><span class="hs-identifier hs-var">tv</span></a></span><span>
</span><span id="line-234"></span><span class="annot"><a href="GHC.Core.TyCo.Tidy.html#tidyType"><span class="hs-identifier hs-var">tidyType</span></a></span><span> </span><span class="annot"><span class="annottext">TidyEnv
</span><span class="hs-identifier">_</span></span><span>   </span><span id="local-6989586621682561725"><span class="annot"><span class="annottext">t :: Type
</span><a href="#local-6989586621682561725"><span class="hs-identifier hs-var">t</span></a></span></span><span class="hs-glyph">@</span><span class="hs-special">(</span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#TyConApp"><span class="hs-identifier hs-type">TyConApp</span></a></span><span> </span><span class="annot"><span class="annottext">TyCon
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span class="hs-special">)</span><span>      </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682561725"><span class="hs-identifier hs-var">t</span></a></span><span> </span><span class="hs-comment">-- Preserve sharing if possible</span><span>
</span><span id="line-235"></span><span class="annot"><a href="GHC.Core.TyCo.Tidy.html#tidyType"><span class="hs-identifier hs-var">tidyType</span></a></span><span> </span><span id="local-6989586621682561727"><span class="annot"><span class="annottext">TidyEnv
</span><a href="#local-6989586621682561727"><span class="hs-identifier hs-var">env</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#TyConApp"><span class="hs-identifier hs-type">TyConApp</span></a></span><span> </span><span id="local-6989586621682561728"><span class="annot"><span class="annottext">TyCon
</span><a href="#local-6989586621682561728"><span class="hs-identifier hs-var">tycon</span></a></span></span><span> </span><span id="local-6989586621682561729"><span class="annot"><span class="annottext">[Type]
</span><a href="#local-6989586621682561729"><span class="hs-identifier hs-var">tys</span></a></span></span><span class="hs-special">)</span><span>   </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">TyCon -&gt; [Type] -&gt; Type
</span><a href="GHC.Core.TyCo.Rep.html#TyConApp"><span class="hs-identifier hs-var">TyConApp</span></a></span><span> </span><span class="annot"><span class="annottext">TyCon
</span><a href="#local-6989586621682561728"><span class="hs-identifier hs-var">tycon</span></a></span><span> </span><span class="annot"><span class="annottext">([Type] -&gt; Type) -&gt; [Type] -&gt; Type
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$!</span></span><span> </span><span class="annot"><span class="annottext">TidyEnv -&gt; [Type] -&gt; [Type]
</span><a href="GHC.Core.TyCo.Tidy.html#tidyTypes"><span class="hs-identifier hs-var">tidyTypes</span></a></span><span> </span><span class="annot"><span class="annottext">TidyEnv
</span><a href="#local-6989586621682561727"><span class="hs-identifier hs-var">env</span></a></span><span> </span><span class="annot"><span class="annottext">[Type]
</span><a href="#local-6989586621682561729"><span class="hs-identifier hs-var">tys</span></a></span><span>
</span><span id="line-236"></span><span class="annot"><a href="GHC.Core.TyCo.Tidy.html#tidyType"><span class="hs-identifier hs-var">tidyType</span></a></span><span> </span><span id="local-6989586621682561730"><span class="annot"><span class="annottext">TidyEnv
</span><a href="#local-6989586621682561730"><span class="hs-identifier hs-var">env</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#AppTy"><span class="hs-identifier hs-type">AppTy</span></a></span><span> </span><span id="local-6989586621682561732"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682561732"><span class="hs-identifier hs-var">fun</span></a></span></span><span> </span><span id="local-6989586621682561733"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682561733"><span class="hs-identifier hs-var">arg</span></a></span></span><span class="hs-special">)</span><span>        </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Type -&gt; Type -&gt; Type
</span><a href="GHC.Core.TyCo.Rep.html#AppTy"><span class="hs-identifier hs-var">AppTy</span></a></span><span> </span><span class="annot"><span class="annottext">(Type -&gt; Type -&gt; Type) -&gt; Type -&gt; Type -&gt; Type
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$!</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TidyEnv -&gt; Type -&gt; Type
</span><a href="GHC.Core.TyCo.Tidy.html#tidyType"><span class="hs-identifier hs-var">tidyType</span></a></span><span> </span><span class="annot"><span class="annottext">TidyEnv
</span><a href="#local-6989586621682561730"><span class="hs-identifier hs-var">env</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682561732"><span class="hs-identifier hs-var">fun</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(Type -&gt; Type) -&gt; Type -&gt; Type
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$!</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TidyEnv -&gt; Type -&gt; Type
</span><a href="GHC.Core.TyCo.Tidy.html#tidyType"><span class="hs-identifier hs-var">tidyType</span></a></span><span> </span><span class="annot"><span class="annottext">TidyEnv
</span><a href="#local-6989586621682561730"><span class="hs-identifier hs-var">env</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682561733"><span class="hs-identifier hs-var">arg</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-237"></span><span class="annot"><a href="GHC.Core.TyCo.Tidy.html#tidyType"><span class="hs-identifier hs-var">tidyType</span></a></span><span> </span><span id="local-6989586621682561734"><span class="annot"><span class="annottext">TidyEnv
</span><a href="#local-6989586621682561734"><span class="hs-identifier hs-var">env</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#CastTy"><span class="hs-identifier hs-type">CastTy</span></a></span><span> </span><span id="local-6989586621682561736"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682561736"><span class="hs-identifier hs-var">ty</span></a></span></span><span> </span><span id="local-6989586621682561737"><span class="annot"><span class="annottext">KindCoercion
</span><a href="#local-6989586621682561737"><span class="hs-identifier hs-var">co</span></a></span></span><span class="hs-special">)</span><span>         </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Type -&gt; KindCoercion -&gt; Type
</span><a href="GHC.Core.TyCo.Rep.html#CastTy"><span class="hs-identifier hs-var">CastTy</span></a></span><span> </span><span class="annot"><span class="annottext">(Type -&gt; KindCoercion -&gt; Type) -&gt; Type -&gt; KindCoercion -&gt; Type
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$!</span></span><span> </span><span class="annot"><span class="annottext">TidyEnv -&gt; Type -&gt; Type
</span><a href="GHC.Core.TyCo.Tidy.html#tidyType"><span class="hs-identifier hs-var">tidyType</span></a></span><span> </span><span class="annot"><span class="annottext">TidyEnv
</span><a href="#local-6989586621682561734"><span class="hs-identifier hs-var">env</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682561736"><span class="hs-identifier hs-var">ty</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(KindCoercion -&gt; Type) -&gt; KindCoercion -&gt; Type
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$!</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TidyEnv -&gt; KindCoercion -&gt; KindCoercion
</span><a href="GHC.Core.TyCo.Tidy.html#tidyCo"><span class="hs-identifier hs-var">tidyCo</span></a></span><span> </span><span class="annot"><span class="annottext">TidyEnv
</span><a href="#local-6989586621682561734"><span class="hs-identifier hs-var">env</span></a></span><span> </span><span class="annot"><span class="annottext">KindCoercion
</span><a href="#local-6989586621682561737"><span class="hs-identifier hs-var">co</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-238"></span><span class="annot"><a href="GHC.Core.TyCo.Tidy.html#tidyType"><span class="hs-identifier hs-var">tidyType</span></a></span><span> </span><span id="local-6989586621682561738"><span class="annot"><span class="annottext">TidyEnv
</span><a href="#local-6989586621682561738"><span class="hs-identifier hs-var">env</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#CoercionTy"><span class="hs-identifier hs-type">CoercionTy</span></a></span><span> </span><span id="local-6989586621682561740"><span class="annot"><span class="annottext">KindCoercion
</span><a href="#local-6989586621682561740"><span class="hs-identifier hs-var">co</span></a></span></span><span class="hs-special">)</span><span>        </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">KindCoercion -&gt; Type
</span><a href="GHC.Core.TyCo.Rep.html#CoercionTy"><span class="hs-identifier hs-var">CoercionTy</span></a></span><span> </span><span class="annot"><span class="annottext">(KindCoercion -&gt; Type) -&gt; KindCoercion -&gt; Type
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$!</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TidyEnv -&gt; KindCoercion -&gt; KindCoercion
</span><a href="GHC.Core.TyCo.Tidy.html#tidyCo"><span class="hs-identifier hs-var">tidyCo</span></a></span><span> </span><span class="annot"><span class="annottext">TidyEnv
</span><a href="#local-6989586621682561738"><span class="hs-identifier hs-var">env</span></a></span><span> </span><span class="annot"><span class="annottext">KindCoercion
</span><a href="#local-6989586621682561740"><span class="hs-identifier hs-var">co</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-239"></span><span class="annot"><a href="GHC.Core.TyCo.Tidy.html#tidyType"><span class="hs-identifier hs-var">tidyType</span></a></span><span> </span><span id="local-6989586621682561741"><span class="annot"><span class="annottext">TidyEnv
</span><a href="#local-6989586621682561741"><span class="hs-identifier hs-var">env</span></a></span></span><span> </span><span id="local-6989586621682561742"><span class="annot"><span class="annottext">ty :: Type
</span><a href="#local-6989586621682561742"><span class="hs-identifier hs-var">ty</span></a></span></span><span class="hs-glyph">@</span><span class="hs-special">(</span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#FunTy"><span class="hs-identifier hs-type">FunTy</span></a></span><span> </span><span class="annot"><span class="annottext">FunTyFlag
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621682561744"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682561744"><span class="hs-identifier hs-var">w</span></a></span></span><span> </span><span id="local-6989586621682561745"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682561745"><span class="hs-identifier hs-var">arg</span></a></span></span><span> </span><span id="local-6989586621682561746"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682561746"><span class="hs-identifier hs-var">res</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">let</span><span> </span><span class="hs-special">{</span><span> </span><span class="hs-glyph">!</span><span id="local-6989586621682561747"><span class="annot"><span class="annottext">w' :: Type
</span><a href="#local-6989586621682561747"><span class="hs-identifier hs-var hs-var">w'</span></a></span></span><span>   </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">TidyEnv -&gt; Type -&gt; Type
</span><a href="GHC.Core.TyCo.Tidy.html#tidyType"><span class="hs-identifier hs-var">tidyType</span></a></span><span> </span><span class="annot"><span class="annottext">TidyEnv
</span><a href="#local-6989586621682561741"><span class="hs-identifier hs-var">env</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682561744"><span class="hs-identifier hs-var">w</span></a></span><span>
</span><span id="line-240"></span><span>                                          </span><span class="hs-special">;</span><span> </span><span class="hs-glyph">!</span><span id="local-6989586621682561748"><span class="annot"><span class="annottext">arg' :: Type
</span><a href="#local-6989586621682561748"><span class="hs-identifier hs-var hs-var">arg'</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">TidyEnv -&gt; Type -&gt; Type
</span><a href="GHC.Core.TyCo.Tidy.html#tidyType"><span class="hs-identifier hs-var">tidyType</span></a></span><span> </span><span class="annot"><span class="annottext">TidyEnv
</span><a href="#local-6989586621682561741"><span class="hs-identifier hs-var">env</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682561745"><span class="hs-identifier hs-var">arg</span></a></span><span>
</span><span id="line-241"></span><span>                                          </span><span class="hs-special">;</span><span> </span><span class="hs-glyph">!</span><span id="local-6989586621682561749"><span class="annot"><span class="annottext">res' :: Type
</span><a href="#local-6989586621682561749"><span class="hs-identifier hs-var hs-var">res'</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">TidyEnv -&gt; Type -&gt; Type
</span><a href="GHC.Core.TyCo.Tidy.html#tidyType"><span class="hs-identifier hs-var">tidyType</span></a></span><span> </span><span class="annot"><span class="annottext">TidyEnv
</span><a href="#local-6989586621682561741"><span class="hs-identifier hs-var">env</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682561746"><span class="hs-identifier hs-var">res</span></a></span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-242"></span><span>                                      </span><span class="hs-keyword">in</span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682561742"><span class="hs-identifier hs-var">ty</span></a></span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#ft_mult"><span class="hs-identifier hs-var">ft_mult</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="#local-6989586621682561747"><span class="hs-identifier hs-type">w'</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#ft_arg"><span class="hs-identifier hs-var">ft_arg</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="#local-6989586621682561748"><span class="hs-identifier hs-type">arg'</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#ft_res"><span class="hs-identifier hs-var">ft_res</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="#local-6989586621682561749"><span class="hs-identifier hs-type">res'</span></a></span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-243"></span><span class="annot"><a href="GHC.Core.TyCo.Tidy.html#tidyType"><span class="hs-identifier hs-var">tidyType</span></a></span><span> </span><span id="local-6989586621682561753"><span class="annot"><span class="annottext">TidyEnv
</span><a href="#local-6989586621682561753"><span class="hs-identifier hs-var">env</span></a></span></span><span> </span><span class="hs-special">(</span><span id="local-6989586621682561754"><span class="annot"><span class="annottext">ty :: Type
</span><a href="#local-6989586621682561754"><span class="hs-identifier hs-var">ty</span></a></span></span><span class="hs-glyph">@</span><span class="hs-special">(</span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#ForAllTy"><span class="hs-identifier hs-type">ForAllTy</span></a></span><span class="hs-special">{</span><span class="hs-special">}</span><span class="hs-special">)</span><span class="hs-special">)</span><span>      </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">TidyEnv -&gt; Type -&gt; Type
</span><a href="GHC.Core.TyCo.Tidy.html#tidyForAllType"><span class="hs-identifier hs-var">tidyForAllType</span></a></span><span> </span><span class="annot"><span class="annottext">TidyEnv
</span><a href="#local-6989586621682561753"><span class="hs-identifier hs-var">env</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682561754"><span class="hs-identifier hs-var">ty</span></a></span><span>
</span><span id="line-244"></span><span>
</span><span id="line-245"></span><span>
</span><span id="line-246"></span><span class="annot"><a href="GHC.Core.TyCo.Tidy.html#tidyForAllType"><span class="hs-identifier hs-type">tidyForAllType</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Types.Var.Env.html#TidyEnv"><span class="hs-identifier hs-type">TidyEnv</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#Type"><span class="hs-identifier hs-type">Type</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#Type"><span class="hs-identifier hs-type">Type</span></a></span><span>
</span><span id="line-247"></span><span id="tidyForAllType"><span class="annot"><span class="annottext">tidyForAllType :: TidyEnv -&gt; Type -&gt; Type
</span><a href="GHC.Core.TyCo.Tidy.html#tidyForAllType"><span class="hs-identifier hs-var hs-var">tidyForAllType</span></a></span></span><span> </span><span id="local-6989586621682561757"><span class="annot"><span class="annottext">TidyEnv
</span><a href="#local-6989586621682561757"><span class="hs-identifier hs-var">env</span></a></span></span><span> </span><span id="local-6989586621682561758"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682561758"><span class="hs-identifier hs-var">ty</span></a></span></span><span>
</span><span id="line-248"></span><span>   </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[(TyCoVar, ForAllTyFlag)] -&gt; Type -&gt; Type
</span><a href="GHC.Core.TyCo.Tidy.html#mkForAllTys%27"><span class="hs-identifier hs-var">mkForAllTys'</span></a></span><span> </span><span class="annot"><span class="annottext">([(TyCoVar, ForAllTyFlag)] -&gt; Type -&gt; Type)
-&gt; [(TyCoVar, ForAllTyFlag)] -&gt; Type -&gt; Type
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$!</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[TyCoVar] -&gt; [ForAllTyFlag] -&gt; [(TyCoVar, ForAllTyFlag)]
forall a b. [a] -&gt; [b] -&gt; [(a, b)]
</span><span class="hs-identifier hs-var">zip</span></span><span> </span><span class="annot"><span class="annottext">[TyCoVar]
</span><a href="#local-6989586621682561760"><span class="hs-identifier hs-var">tcvs'</span></a></span><span> </span><span class="annot"><span class="annottext">[ForAllTyFlag]
</span><a href="#local-6989586621682561761"><span class="hs-identifier hs-var">vis</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(Type -&gt; Type) -&gt; Type -&gt; Type
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$!</span></span><span> </span><span class="annot"><span class="annottext">TidyEnv -&gt; Type -&gt; Type
</span><a href="GHC.Core.TyCo.Tidy.html#tidyType"><span class="hs-identifier hs-var">tidyType</span></a></span><span> </span><span class="annot"><span class="annottext">TidyEnv
</span><a href="#local-6989586621682561762"><span class="hs-identifier hs-var">body_env</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682561763"><span class="hs-identifier hs-var">body_ty</span></a></span><span>
</span><span id="line-249"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-250"></span><span>    </span><span class="hs-special">(</span><span id="local-6989586621682561764"><span class="annot"><span class="annottext">[TyCoVar]
</span><a href="#local-6989586621682561764"><span class="hs-identifier hs-var">tcvs</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682561761"><span class="annot"><span class="annottext">[ForAllTyFlag]
</span><a href="#local-6989586621682561761"><span class="hs-identifier hs-var">vis</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682561763"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682561763"><span class="hs-identifier hs-var">body_ty</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Type -&gt; ([TyCoVar], [ForAllTyFlag], Type)
</span><a href="GHC.Core.TyCo.Tidy.html#splitForAllTyCoVars%27"><span class="hs-identifier hs-var">splitForAllTyCoVars'</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682561758"><span class="hs-identifier hs-var">ty</span></a></span><span>
</span><span id="line-251"></span><span>    </span><span class="hs-special">(</span><span id="local-6989586621682561762"><span class="annot"><span class="annottext">TidyEnv
</span><a href="#local-6989586621682561762"><span class="hs-identifier hs-var">body_env</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682561760"><span class="annot"><span class="annottext">[TyCoVar]
</span><a href="#local-6989586621682561760"><span class="hs-identifier hs-var">tcvs'</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">TidyEnv -&gt; [TyCoVar] -&gt; (TidyEnv, [TyCoVar])
</span><a href="GHC.Core.TyCo.Tidy.html#tidyVarBndrs"><span class="hs-identifier hs-var">tidyVarBndrs</span></a></span><span> </span><span class="annot"><span class="annottext">TidyEnv
</span><a href="#local-6989586621682561757"><span class="hs-identifier hs-var">env</span></a></span><span> </span><span class="annot"><span class="annottext">[TyCoVar]
</span><a href="#local-6989586621682561764"><span class="hs-identifier hs-var">tcvs</span></a></span><span>
</span><span id="line-252"></span><span>
</span><span id="line-253"></span><span class="hs-comment">-- The following two functions differ from mkForAllTys and splitForAllTyCoVars in that</span><span>
</span><span id="line-254"></span><span class="hs-comment">-- they expect/preserve the ForAllTyFlag argument. These belong to &quot;GHC.Core.Type&quot;, but</span><span>
</span><span id="line-255"></span><span class="hs-comment">-- how should they be named?</span><span>
</span><span id="line-256"></span><span class="annot"><a href="GHC.Core.TyCo.Tidy.html#mkForAllTys%27"><span class="hs-identifier hs-type">mkForAllTys'</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><span class="hs-special">(</span><span class="annot"><a href="GHC.Types.Var.html#TyCoVar"><span class="hs-identifier hs-type">TyCoVar</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Language.Haskell.Syntax.Specificity.html#ForAllTyFlag"><span class="hs-identifier hs-type">ForAllTyFlag</span></a></span><span class="hs-special">)</span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#Type"><span class="hs-identifier hs-type">Type</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#Type"><span class="hs-identifier hs-type">Type</span></a></span><span>
</span><span id="line-257"></span><span id="mkForAllTys%27"><span class="annot"><span class="annottext">mkForAllTys' :: [(TyCoVar, ForAllTyFlag)] -&gt; Type -&gt; Type
</span><a href="GHC.Core.TyCo.Tidy.html#mkForAllTys%27"><span class="hs-identifier hs-var hs-var">mkForAllTys'</span></a></span></span><span> </span><span id="local-6989586621682561766"><span class="annot"><span class="annottext">[(TyCoVar, ForAllTyFlag)]
</span><a href="#local-6989586621682561766"><span class="hs-identifier hs-var">tvvs</span></a></span></span><span> </span><span id="local-6989586621682561767"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682561767"><span class="hs-identifier hs-var">ty</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">((TyCoVar, ForAllTyFlag) -&gt; Type -&gt; Type)
-&gt; Type -&gt; [(TyCoVar, ForAllTyFlag)] -&gt; Type
forall a b. (a -&gt; b -&gt; b) -&gt; b -&gt; [a] -&gt; b
forall (t :: * -&gt; *) a b.
Foldable t =&gt;
(a -&gt; b -&gt; b) -&gt; b -&gt; t a -&gt; b
</span><span class="hs-identifier hs-var">foldr</span></span><span> </span><span class="annot"><span class="annottext">(TyCoVar, ForAllTyFlag) -&gt; Type -&gt; Type
</span><a href="#local-6989586621682561769"><span class="hs-identifier hs-var">strictMkForAllTy</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682561767"><span class="hs-identifier hs-var">ty</span></a></span><span> </span><span class="annot"><span class="annottext">[(TyCoVar, ForAllTyFlag)]
</span><a href="#local-6989586621682561766"><span class="hs-identifier hs-var">tvvs</span></a></span><span>
</span><span id="line-258"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-259"></span><span>    </span><span id="local-6989586621682561769"><span class="annot"><span class="annottext">strictMkForAllTy :: (TyCoVar, ForAllTyFlag) -&gt; Type -&gt; Type
</span><a href="#local-6989586621682561769"><span class="hs-identifier hs-var hs-var">strictMkForAllTy</span></a></span></span><span> </span><span class="hs-special">(</span><span id="local-6989586621682561770"><span class="annot"><span class="annottext">TyCoVar
</span><a href="#local-6989586621682561770"><span class="hs-identifier hs-var">tv</span></a></span></span><span class="hs-special">,</span><span id="local-6989586621682561771"><span class="annot"><span class="annottext">ForAllTyFlag
</span><a href="#local-6989586621682561771"><span class="hs-identifier hs-var">vis</span></a></span></span><span class="hs-special">)</span><span> </span><span id="local-6989586621682561772"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682561772"><span class="hs-identifier hs-var">ty</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ForAllTyBinder -&gt; Type -&gt; Type
</span><a href="GHC.Core.TyCo.Rep.html#ForAllTy"><span class="hs-identifier hs-var">ForAllTy</span></a></span><span> </span><span class="annot"><span class="annottext">(ForAllTyBinder -&gt; Type -&gt; Type) -&gt; ForAllTyBinder -&gt; Type -&gt; Type
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$!</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">(</span><span class="annot"><span class="annottext">TyCoVar -&gt; ForAllTyFlag -&gt; ForAllTyBinder
forall var argf. var -&gt; argf -&gt; VarBndr var argf
</span><a href="GHC.Types.Var.html#Bndr"><span class="hs-identifier hs-var">Bndr</span></a></span><span> </span><span class="annot"><span class="annottext">(TyCoVar -&gt; ForAllTyFlag -&gt; ForAllTyBinder)
-&gt; TyCoVar -&gt; ForAllTyFlag -&gt; ForAllTyBinder
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$!</span></span><span> </span><span class="annot"><span class="annottext">TyCoVar
</span><a href="#local-6989586621682561770"><span class="hs-identifier hs-var">tv</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(ForAllTyFlag -&gt; ForAllTyBinder) -&gt; ForAllTyFlag -&gt; ForAllTyBinder
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$!</span></span><span> </span><span class="annot"><span class="annottext">ForAllTyFlag
</span><a href="#local-6989586621682561771"><span class="hs-identifier hs-var">vis</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(Type -&gt; Type) -&gt; Type -&gt; Type
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$!</span></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682561772"><span class="hs-identifier hs-var">ty</span></a></span><span>
</span><span id="line-260"></span><span>
</span><span id="line-261"></span><span class="annot"><a href="GHC.Core.TyCo.Tidy.html#splitForAllTyCoVars%27"><span class="hs-identifier hs-type">splitForAllTyCoVars'</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#Type"><span class="hs-identifier hs-type">Type</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="hs-special">[</span><span class="annot"><a href="GHC.Types.Var.html#TyCoVar"><span class="hs-identifier hs-type">TyCoVar</span></a></span><span class="hs-special">]</span><span class="hs-special">,</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="Language.Haskell.Syntax.Specificity.html#ForAllTyFlag"><span class="hs-identifier hs-type">ForAllTyFlag</span></a></span><span class="hs-special">]</span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#Type"><span class="hs-identifier hs-type">Type</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-262"></span><span id="splitForAllTyCoVars%27"><span class="annot"><span class="annottext">splitForAllTyCoVars' :: Type -&gt; ([TyCoVar], [ForAllTyFlag], Type)
</span><a href="GHC.Core.TyCo.Tidy.html#splitForAllTyCoVars%27"><span class="hs-identifier hs-var hs-var">splitForAllTyCoVars'</span></a></span></span><span> </span><span id="local-6989586621682561773"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682561773"><span class="hs-identifier hs-var">ty</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Type
-&gt; [TyCoVar] -&gt; [ForAllTyFlag] -&gt; ([TyCoVar], [ForAllTyFlag], Type)
</span><a href="#local-6989586621682561774"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682561773"><span class="hs-identifier hs-var">ty</span></a></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span>
</span><span id="line-263"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-264"></span><span>    </span><span id="local-6989586621682561774"><span class="annot"><span class="annottext">go :: Type
-&gt; [TyCoVar] -&gt; [ForAllTyFlag] -&gt; ([TyCoVar], [ForAllTyFlag], Type)
</span><a href="#local-6989586621682561774"><span class="hs-identifier hs-var hs-var">go</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#ForAllTy"><span class="hs-identifier hs-type">ForAllTy</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Types.Var.html#Bndr"><span class="hs-identifier hs-type">Bndr</span></a></span><span> </span><span id="local-6989586621682561775"><span class="annot"><span class="annottext">TyCoVar
</span><a href="#local-6989586621682561775"><span class="hs-identifier hs-var">tv</span></a></span></span><span> </span><span id="local-6989586621682561776"><span class="annot"><span class="annottext">ForAllTyFlag
</span><a href="#local-6989586621682561776"><span class="hs-identifier hs-var">vis</span></a></span></span><span class="hs-special">)</span><span> </span><span id="local-6989586621682561777"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682561777"><span class="hs-identifier hs-var">ty</span></a></span></span><span class="hs-special">)</span><span> </span><span id="local-6989586621682561778"><span class="annot"><span class="annottext">[TyCoVar]
</span><a href="#local-6989586621682561778"><span class="hs-identifier hs-var">tvs</span></a></span></span><span> </span><span id="local-6989586621682561779"><span class="annot"><span class="annottext">[ForAllTyFlag]
</span><a href="#local-6989586621682561779"><span class="hs-identifier hs-var">viss</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Type
-&gt; [TyCoVar] -&gt; [ForAllTyFlag] -&gt; ([TyCoVar], [ForAllTyFlag], Type)
</span><a href="#local-6989586621682561774"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682561777"><span class="hs-identifier hs-var">ty</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TyCoVar
</span><a href="#local-6989586621682561775"><span class="hs-identifier hs-var">tv</span></a></span><span class="annot"><span class="annottext">TyCoVar -&gt; [TyCoVar] -&gt; [TyCoVar]
forall a. a -&gt; [a] -&gt; [a]
</span><span class="hs-glyph hs-var">:</span></span><span class="annot"><span class="annottext">[TyCoVar]
</span><a href="#local-6989586621682561778"><span class="hs-identifier hs-var">tvs</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ForAllTyFlag
</span><a href="#local-6989586621682561776"><span class="hs-identifier hs-var">vis</span></a></span><span class="annot"><span class="annottext">ForAllTyFlag -&gt; [ForAllTyFlag] -&gt; [ForAllTyFlag]
forall a. a -&gt; [a] -&gt; [a]
</span><span class="hs-glyph hs-var">:</span></span><span class="annot"><span class="annottext">[ForAllTyFlag]
</span><a href="#local-6989586621682561779"><span class="hs-identifier hs-var">viss</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-265"></span><span>    </span><span class="annot"><a href="#local-6989586621682561774"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span id="local-6989586621682561780"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682561780"><span class="hs-identifier hs-var">ty</span></a></span></span><span>                          </span><span id="local-6989586621682561781"><span class="annot"><span class="annottext">[TyCoVar]
</span><a href="#local-6989586621682561781"><span class="hs-identifier hs-var">tvs</span></a></span></span><span> </span><span id="local-6989586621682561782"><span class="annot"><span class="annottext">[ForAllTyFlag]
</span><a href="#local-6989586621682561782"><span class="hs-identifier hs-var">viss</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[TyCoVar] -&gt; [TyCoVar]
forall a. [a] -&gt; [a]
</span><span class="hs-identifier hs-var">reverse</span></span><span> </span><span class="annot"><span class="annottext">[TyCoVar]
</span><a href="#local-6989586621682561781"><span class="hs-identifier hs-var">tvs</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">[ForAllTyFlag] -&gt; [ForAllTyFlag]
forall a. [a] -&gt; [a]
</span><span class="hs-identifier hs-var">reverse</span></span><span> </span><span class="annot"><span class="annottext">[ForAllTyFlag]
</span><a href="#local-6989586621682561782"><span class="hs-identifier hs-var">viss</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682561780"><span class="hs-identifier hs-var">ty</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-266"></span><span>
</span><span id="line-267"></span><span>
</span><span id="line-268"></span><span class="hs-comment">---------------</span><span>
</span><span id="line-269"></span><span id="local-6989586621682561615"><span class="annot"><a href="GHC.Core.TyCo.Tidy.html#tidyAvoiding"><span class="hs-identifier hs-type">tidyAvoiding</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="GHC.Types.Name.Occurrence.html#OccName"><span class="hs-identifier hs-type">OccName</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-270"></span><span>             </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Types.Var.Env.html#TidyEnv"><span class="hs-identifier hs-type">TidyEnv</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621682561615"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Types.Var.Env.html#TidyEnv"><span class="hs-identifier hs-type">TidyEnv</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-271"></span><span>             </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621682561615"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Types.Var.Env.html#TidyEnv"><span class="hs-identifier hs-type">TidyEnv</span></a></span></span><span>
</span><span id="line-272"></span><span class="hs-comment">-- Initialise an empty TidyEnv with some bound vars to avoid,</span><span>
</span><span id="line-273"></span><span class="hs-comment">-- run the do_tidy function, and then remove the bound vars again.</span><span>
</span><span id="line-274"></span><span class="hs-comment">-- See Note [tidyAvoiding]</span><span>
</span><span id="line-275"></span><span id="tidyAvoiding"><span class="annot"><span class="annottext">tidyAvoiding :: forall a. [OccName] -&gt; (TidyEnv -&gt; a -&gt; TidyEnv) -&gt; a -&gt; TidyEnv
</span><a href="GHC.Core.TyCo.Tidy.html#tidyAvoiding"><span class="hs-identifier hs-var hs-var">tidyAvoiding</span></a></span></span><span> </span><span id="local-6989586621682561784"><span class="annot"><span class="annottext">[OccName]
</span><a href="#local-6989586621682561784"><span class="hs-identifier hs-var">bound_var_avoids</span></a></span></span><span> </span><span id="local-6989586621682561785"><span class="annot"><span class="annottext">TidyEnv -&gt; a -&gt; TidyEnv
</span><a href="#local-6989586621682561785"><span class="hs-identifier hs-var">do_tidy</span></a></span></span><span> </span><span id="local-6989586621682561786"><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621682561786"><span class="hs-identifier hs-var">thing</span></a></span></span><span>
</span><span id="line-276"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TidyOccEnv
</span><a href="#local-6989586621682561787"><span class="hs-identifier hs-var">occs'</span></a></span><span> </span><span class="annot"><span class="annottext">TidyOccEnv -&gt; [OccName] -&gt; TidyOccEnv
</span><a href="GHC.Types.Name.Occurrence.html#delTidyOccEnvList"><span class="hs-operator hs-var">`delTidyOccEnvList`</span></a></span><span> </span><span class="annot"><span class="annottext">[OccName]
</span><a href="#local-6989586621682561784"><span class="hs-identifier hs-var">bound_var_avoids</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">VarEnv TyCoVar
</span><a href="#local-6989586621682561789"><span class="hs-identifier hs-var">vars'</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-277"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-278"></span><span>    </span><span class="hs-special">(</span><span id="local-6989586621682561787"><span class="annot"><span class="annottext">TidyOccEnv
</span><a href="#local-6989586621682561787"><span class="hs-identifier hs-var">occs'</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682561789"><span class="annot"><span class="annottext">VarEnv TyCoVar
</span><a href="#local-6989586621682561789"><span class="hs-identifier hs-var">vars'</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">TidyEnv -&gt; a -&gt; TidyEnv
</span><a href="#local-6989586621682561785"><span class="hs-identifier hs-var">do_tidy</span></a></span><span> </span><span class="annot"><span class="annottext">TidyEnv
</span><a href="#local-6989586621682561790"><span class="hs-identifier hs-var">init_tidy_env</span></a></span><span> </span><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621682561786"><span class="hs-identifier hs-var">thing</span></a></span><span>
</span><span id="line-279"></span><span>    </span><span id="local-6989586621682561790"><span class="annot"><span class="annottext">init_tidy_env :: TidyEnv
</span><a href="#local-6989586621682561790"><span class="hs-identifier hs-var hs-var">init_tidy_env</span></a></span></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">TidyOccEnv -&gt; TidyEnv
</span><a href="GHC.Types.Var.Env.html#mkEmptyTidyEnv"><span class="hs-identifier hs-var">mkEmptyTidyEnv</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[OccName] -&gt; TidyOccEnv
</span><a href="GHC.Types.Name.Occurrence.html#initTidyOccEnv"><span class="hs-identifier hs-var">initTidyOccEnv</span></a></span><span> </span><span class="annot"><span class="annottext">[OccName]
</span><a href="#local-6989586621682561784"><span class="hs-identifier hs-var">bound_var_avoids</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-280"></span><span>
</span><span id="line-281"></span><span class="hs-comment">---------------</span><span>
</span><span id="line-282"></span><span class="annot"><a href="GHC.Core.TyCo.Tidy.html#trimTidyEnv"><span class="hs-identifier hs-type">trimTidyEnv</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Types.Var.Env.html#TidyEnv"><span class="hs-identifier hs-type">TidyEnv</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="GHC.Types.Var.html#TyCoVar"><span class="hs-identifier hs-type">TyCoVar</span></a></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Types.Var.Env.html#TidyEnv"><span class="hs-identifier hs-type">TidyEnv</span></a></span><span>
</span><span id="line-283"></span><span id="trimTidyEnv"><span class="annot"><span class="annottext">trimTidyEnv :: TidyEnv -&gt; [TyCoVar] -&gt; TidyEnv
</span><a href="GHC.Core.TyCo.Tidy.html#trimTidyEnv"><span class="hs-identifier hs-var hs-var">trimTidyEnv</span></a></span></span><span> </span><span class="hs-special">(</span><span id="local-6989586621682561794"><span class="annot"><span class="annottext">TidyOccEnv
</span><a href="#local-6989586621682561794"><span class="hs-identifier hs-var">occ_env</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682561795"><span class="annot"><span class="annottext">VarEnv TyCoVar
</span><a href="#local-6989586621682561795"><span class="hs-identifier hs-var">var_env</span></a></span></span><span class="hs-special">)</span><span> </span><span id="local-6989586621682561796"><span class="annot"><span class="annottext">[TyCoVar]
</span><a href="#local-6989586621682561796"><span class="hs-identifier hs-var">tcvs</span></a></span></span><span>
</span><span id="line-284"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TidyOccEnv -&gt; [OccName] -&gt; TidyOccEnv
</span><a href="GHC.Types.Name.Occurrence.html#trimTidyOccEnv"><span class="hs-identifier hs-var">trimTidyOccEnv</span></a></span><span> </span><span class="annot"><span class="annottext">TidyOccEnv
</span><a href="#local-6989586621682561794"><span class="hs-identifier hs-var">occ_env</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(TyCoVar -&gt; OccName) -&gt; [TyCoVar] -&gt; [OccName]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><span class="hs-identifier hs-var">map</span></span><span> </span><span class="annot"><span class="annottext">TyCoVar -&gt; OccName
forall a. NamedThing a =&gt; a -&gt; OccName
</span><a href="GHC.Types.Name.html#getOccName"><span class="hs-identifier hs-var">getOccName</span></a></span><span> </span><span class="annot"><span class="annottext">[TyCoVar]
</span><a href="#local-6989586621682561796"><span class="hs-identifier hs-var">tcvs</span></a></span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">VarEnv TyCoVar
</span><a href="#local-6989586621682561795"><span class="hs-identifier hs-var">var_env</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-285"></span><span>
</span><span id="line-286"></span><span class="hs-comment">---------------</span><span>
</span><span id="line-287"></span><span class="hs-comment">-- | Grabs the free type variables, tidies them</span><span>
</span><span id="line-288"></span><span class="hs-comment">-- and then uses 'tidyType' to work over the type itself</span><span>
</span><span id="line-289"></span><span class="annot"><a href="GHC.Core.TyCo.Tidy.html#tidyOpenTypesX"><span class="hs-identifier hs-type">tidyOpenTypesX</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Types.Var.Env.html#TidyEnv"><span class="hs-identifier hs-type">TidyEnv</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#Type"><span class="hs-identifier hs-type">Type</span></a></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Types.Var.Env.html#TidyEnv"><span class="hs-identifier hs-type">TidyEnv</span></a></span><span class="hs-special">,</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#Type"><span class="hs-identifier hs-type">Type</span></a></span><span class="hs-special">]</span><span class="hs-special">)</span><span>
</span><span id="line-290"></span><span class="hs-comment">-- See Note [Tidying open types]</span><span>
</span><span id="line-291"></span><span id="tidyOpenTypesX"><span class="annot"><span class="annottext">tidyOpenTypesX :: TidyEnv -&gt; [Type] -&gt; (TidyEnv, [Type])
</span><a href="GHC.Core.TyCo.Tidy.html#tidyOpenTypesX"><span class="hs-identifier hs-var hs-var">tidyOpenTypesX</span></a></span></span><span> </span><span id="local-6989586621682561798"><span class="annot"><span class="annottext">TidyEnv
</span><a href="#local-6989586621682561798"><span class="hs-identifier hs-var">env</span></a></span></span><span> </span><span id="local-6989586621682561799"><span class="annot"><span class="annottext">[Type]
</span><a href="#local-6989586621682561799"><span class="hs-identifier hs-var">tys</span></a></span></span><span>
</span><span id="line-292"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TidyEnv
</span><a href="#local-6989586621682561800"><span class="hs-identifier hs-var">env1</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">TidyEnv -&gt; [Type] -&gt; [Type]
</span><a href="GHC.Core.TyCo.Tidy.html#tidyTypes"><span class="hs-identifier hs-var">tidyTypes</span></a></span><span> </span><span class="annot"><span class="annottext">TidyEnv
</span><a href="#local-6989586621682561801"><span class="hs-identifier hs-var">inner_env</span></a></span><span> </span><span class="annot"><span class="annottext">[Type]
</span><a href="#local-6989586621682561799"><span class="hs-identifier hs-var">tys</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-293"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-294"></span><span>    </span><span class="annot"><a href="#local-6989586621682561802"><span class="hs-identifier hs-type">free_tcvs</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="GHC.Types.Var.html#TyCoVar"><span class="hs-identifier hs-type">TyCoVar</span></a></span><span class="hs-special">]</span><span> </span><span class="hs-comment">-- Closed over kinds</span><span>
</span><span id="line-295"></span><span>    </span><span id="local-6989586621682561802"><span class="annot"><span class="annottext">free_tcvs :: [TyCoVar]
</span><a href="#local-6989586621682561802"><span class="hs-identifier hs-var hs-var">free_tcvs</span></a></span></span><span>          </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[Type] -&gt; [TyCoVar]
</span><a href="GHC.Core.TyCo.FVs.html#tyCoVarsOfTypesList"><span class="hs-identifier hs-var">tyCoVarsOfTypesList</span></a></span><span> </span><span class="annot"><span class="annottext">[Type]
</span><a href="#local-6989586621682561799"><span class="hs-identifier hs-var">tys</span></a></span><span>
</span><span id="line-296"></span><span>    </span><span class="hs-special">(</span><span id="local-6989586621682561800"><span class="annot"><span class="annottext">TidyEnv
</span><a href="#local-6989586621682561800"><span class="hs-identifier hs-var">env1</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682561804"><span class="annot"><span class="annottext">[TyCoVar]
</span><a href="#local-6989586621682561804"><span class="hs-identifier hs-var">free_tcvs'</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">TidyEnv -&gt; [TyCoVar] -&gt; (TidyEnv, [TyCoVar])
</span><a href="GHC.Core.TyCo.Tidy.html#tidyFreeTyCoVarsX"><span class="hs-identifier hs-var">tidyFreeTyCoVarsX</span></a></span><span> </span><span class="annot"><span class="annottext">TidyEnv
</span><a href="#local-6989586621682561798"><span class="hs-identifier hs-var">env</span></a></span><span> </span><span class="annot"><span class="annottext">[TyCoVar]
</span><a href="#local-6989586621682561802"><span class="hs-identifier hs-var">free_tcvs</span></a></span><span>
</span><span id="line-297"></span><span>    </span><span id="local-6989586621682561801"><span class="annot"><span class="annottext">inner_env :: TidyEnv
</span><a href="#local-6989586621682561801"><span class="hs-identifier hs-var hs-var">inner_env</span></a></span></span><span>          </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">TidyEnv -&gt; [TyCoVar] -&gt; TidyEnv
</span><a href="GHC.Core.TyCo.Tidy.html#trimTidyEnv"><span class="hs-identifier hs-var">trimTidyEnv</span></a></span><span> </span><span class="annot"><span class="annottext">TidyEnv
</span><a href="#local-6989586621682561800"><span class="hs-identifier hs-var">env1</span></a></span><span> </span><span class="annot"><span class="annottext">[TyCoVar]
</span><a href="#local-6989586621682561804"><span class="hs-identifier hs-var">free_tcvs'</span></a></span><span>
</span><span id="line-298"></span><span>
</span><span id="line-299"></span><span class="hs-comment">---------------</span><span>
</span><span id="line-300"></span><span class="annot"><a href="GHC.Core.TyCo.Tidy.html#tidyOpenTypeX"><span class="hs-identifier hs-type">tidyOpenTypeX</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Types.Var.Env.html#TidyEnv"><span class="hs-identifier hs-type">TidyEnv</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#Type"><span class="hs-identifier hs-type">Type</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Types.Var.Env.html#TidyEnv"><span class="hs-identifier hs-type">TidyEnv</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#Type"><span class="hs-identifier hs-type">Type</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-301"></span><span class="hs-comment">-- See Note [Tidying open types]</span><span>
</span><span id="line-302"></span><span id="tidyOpenTypeX"><span class="annot"><span class="annottext">tidyOpenTypeX :: TidyEnv -&gt; Type -&gt; (TidyEnv, Type)
</span><a href="GHC.Core.TyCo.Tidy.html#tidyOpenTypeX"><span class="hs-identifier hs-var hs-var">tidyOpenTypeX</span></a></span></span><span> </span><span id="local-6989586621682561805"><span class="annot"><span class="annottext">TidyEnv
</span><a href="#local-6989586621682561805"><span class="hs-identifier hs-var">env</span></a></span></span><span> </span><span id="local-6989586621682561806"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682561806"><span class="hs-identifier hs-var">ty</span></a></span></span><span>
</span><span id="line-303"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TidyEnv
</span><a href="#local-6989586621682561807"><span class="hs-identifier hs-var">env1</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">TidyEnv -&gt; Type -&gt; Type
</span><a href="GHC.Core.TyCo.Tidy.html#tidyType"><span class="hs-identifier hs-var">tidyType</span></a></span><span> </span><span class="annot"><span class="annottext">TidyEnv
</span><a href="#local-6989586621682561808"><span class="hs-identifier hs-var">inner_env</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682561806"><span class="hs-identifier hs-var">ty</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-304"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-305"></span><span>    </span><span id="local-6989586621682561809"><span class="annot"><span class="annottext">free_tcvs :: [TyCoVar]
</span><a href="#local-6989586621682561809"><span class="hs-identifier hs-var hs-var">free_tcvs</span></a></span></span><span>          </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Type -&gt; [TyCoVar]
</span><a href="GHC.Core.TyCo.FVs.html#tyCoVarsOfTypeList"><span class="hs-identifier hs-var">tyCoVarsOfTypeList</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682561806"><span class="hs-identifier hs-var">ty</span></a></span><span>
</span><span id="line-306"></span><span>    </span><span class="hs-special">(</span><span id="local-6989586621682561807"><span class="annot"><span class="annottext">TidyEnv
</span><a href="#local-6989586621682561807"><span class="hs-identifier hs-var">env1</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682561811"><span class="annot"><span class="annottext">[TyCoVar]
</span><a href="#local-6989586621682561811"><span class="hs-identifier hs-var">free_tcvs'</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">TidyEnv -&gt; [TyCoVar] -&gt; (TidyEnv, [TyCoVar])
</span><a href="GHC.Core.TyCo.Tidy.html#tidyFreeTyCoVarsX"><span class="hs-identifier hs-var">tidyFreeTyCoVarsX</span></a></span><span> </span><span class="annot"><span class="annottext">TidyEnv
</span><a href="#local-6989586621682561805"><span class="hs-identifier hs-var">env</span></a></span><span> </span><span class="annot"><span class="annottext">[TyCoVar]
</span><a href="#local-6989586621682561809"><span class="hs-identifier hs-var">free_tcvs</span></a></span><span>
</span><span id="line-307"></span><span>    </span><span id="local-6989586621682561808"><span class="annot"><span class="annottext">inner_env :: TidyEnv
</span><a href="#local-6989586621682561808"><span class="hs-identifier hs-var hs-var">inner_env</span></a></span></span><span>          </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">TidyEnv -&gt; [TyCoVar] -&gt; TidyEnv
</span><a href="GHC.Core.TyCo.Tidy.html#trimTidyEnv"><span class="hs-identifier hs-var">trimTidyEnv</span></a></span><span> </span><span class="annot"><span class="annottext">TidyEnv
</span><a href="#local-6989586621682561807"><span class="hs-identifier hs-var">env1</span></a></span><span> </span><span class="annot"><span class="annottext">[TyCoVar]
</span><a href="#local-6989586621682561811"><span class="hs-identifier hs-var">free_tcvs'</span></a></span><span>
</span><span id="line-308"></span><span>
</span><span id="line-309"></span><span class="hs-comment">---------------</span><span>
</span><span id="line-310"></span><span class="annot"><a href="GHC.Core.TyCo.Tidy.html#tidyOpenTypes"><span class="hs-identifier hs-type">tidyOpenTypes</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Types.Var.Env.html#TidyEnv"><span class="hs-identifier hs-type">TidyEnv</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#Type"><span class="hs-identifier hs-type">Type</span></a></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#Type"><span class="hs-identifier hs-type">Type</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-311"></span><span id="tidyOpenTypes"><span class="annot"><span class="annottext">tidyOpenTypes :: TidyEnv -&gt; [Type] -&gt; [Type]
</span><a href="GHC.Core.TyCo.Tidy.html#tidyOpenTypes"><span class="hs-identifier hs-var hs-var">tidyOpenTypes</span></a></span></span><span> </span><span id="local-6989586621682561812"><span class="annot"><span class="annottext">TidyEnv
</span><a href="#local-6989586621682561812"><span class="hs-identifier hs-var">env</span></a></span></span><span> </span><span id="local-6989586621682561813"><span class="annot"><span class="annottext">[Type]
</span><a href="#local-6989586621682561813"><span class="hs-identifier hs-var">ty</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(TidyEnv, [Type]) -&gt; [Type]
forall a b. (a, b) -&gt; b
</span><span class="hs-identifier hs-var">snd</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TidyEnv -&gt; [Type] -&gt; (TidyEnv, [Type])
</span><a href="GHC.Core.TyCo.Tidy.html#tidyOpenTypesX"><span class="hs-identifier hs-var">tidyOpenTypesX</span></a></span><span> </span><span class="annot"><span class="annottext">TidyEnv
</span><a href="#local-6989586621682561812"><span class="hs-identifier hs-var">env</span></a></span><span> </span><span class="annot"><span class="annottext">[Type]
</span><a href="#local-6989586621682561813"><span class="hs-identifier hs-var">ty</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-312"></span><span>
</span><span id="line-313"></span><span class="annot"><a href="GHC.Core.TyCo.Tidy.html#tidyOpenType"><span class="hs-identifier hs-type">tidyOpenType</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Types.Var.Env.html#TidyEnv"><span class="hs-identifier hs-type">TidyEnv</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#Type"><span class="hs-identifier hs-type">Type</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#Type"><span class="hs-identifier hs-type">Type</span></a></span><span>
</span><span id="line-314"></span><span id="tidyOpenType"><span class="annot"><span class="annottext">tidyOpenType :: TidyEnv -&gt; Type -&gt; Type
</span><a href="GHC.Core.TyCo.Tidy.html#tidyOpenType"><span class="hs-identifier hs-var hs-var">tidyOpenType</span></a></span></span><span> </span><span id="local-6989586621682561815"><span class="annot"><span class="annottext">TidyEnv
</span><a href="#local-6989586621682561815"><span class="hs-identifier hs-var">env</span></a></span></span><span> </span><span id="local-6989586621682561816"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682561816"><span class="hs-identifier hs-var">ty</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(TidyEnv, Type) -&gt; Type
forall a b. (a, b) -&gt; b
</span><span class="hs-identifier hs-var">snd</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TidyEnv -&gt; Type -&gt; (TidyEnv, Type)
</span><a href="GHC.Core.TyCo.Tidy.html#tidyOpenTypeX"><span class="hs-identifier hs-var">tidyOpenTypeX</span></a></span><span> </span><span class="annot"><span class="annottext">TidyEnv
</span><a href="#local-6989586621682561815"><span class="hs-identifier hs-var">env</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682561816"><span class="hs-identifier hs-var">ty</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-315"></span><span>
</span><span id="line-316"></span><span class="hs-comment">---------------</span><span>
</span><span id="line-317"></span><span class="annot"><span class="hs-comment">-- | Calls 'tidyType' on a top-level type (i.e. with an empty tidying environment)</span></span><span>
</span><span id="line-318"></span><span class="annot"><a href="GHC.Core.TyCo.Tidy.html#tidyTopType"><span class="hs-identifier hs-type">tidyTopType</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#Type"><span class="hs-identifier hs-type">Type</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#Type"><span class="hs-identifier hs-type">Type</span></a></span><span>
</span><span id="line-319"></span><span id="tidyTopType"><span class="annot"><span class="annottext">tidyTopType :: Type -&gt; Type
</span><a href="GHC.Core.TyCo.Tidy.html#tidyTopType"><span class="hs-identifier hs-var hs-var">tidyTopType</span></a></span></span><span> </span><span id="local-6989586621682561817"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682561817"><span class="hs-identifier hs-var">ty</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">TidyEnv -&gt; Type -&gt; Type
</span><a href="GHC.Core.TyCo.Tidy.html#tidyType"><span class="hs-identifier hs-var">tidyType</span></a></span><span> </span><span class="annot"><span class="annottext">TidyEnv
</span><a href="GHC.Types.Var.Env.html#emptyTidyEnv"><span class="hs-identifier hs-var">emptyTidyEnv</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682561817"><span class="hs-identifier hs-var">ty</span></a></span><span>
</span><span id="line-320"></span><span>
</span><span id="line-321"></span><span class="hs-comment">---------------</span><span>
</span><span id="line-322"></span><span>
</span><span id="line-323"></span><span class="hs-comment">-- | Tidy a Coercion</span><span>
</span><span id="line-324"></span><span class="hs-comment">--</span><span>
</span><span id="line-325"></span><span class="hs-comment">-- See Note [Strictness in tidyType and friends]</span><span>
</span><span id="line-326"></span><span class="annot"><a href="GHC.Core.TyCo.Tidy.html#tidyCo"><span class="hs-identifier hs-type">tidyCo</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Types.Var.Env.html#TidyEnv"><span class="hs-identifier hs-type">TidyEnv</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#Coercion"><span class="hs-identifier hs-type">Coercion</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#Coercion"><span class="hs-identifier hs-type">Coercion</span></a></span><span>
</span><span id="line-327"></span><span id="tidyCo"><span class="annot"><span class="annottext">tidyCo :: TidyEnv -&gt; KindCoercion -&gt; KindCoercion
</span><a href="GHC.Core.TyCo.Tidy.html#tidyCo"><span class="hs-identifier hs-var hs-var">tidyCo</span></a></span></span><span> </span><span id="local-6989586621682561820"><span class="annot"><span class="annottext">TidyEnv
</span><a href="#local-6989586621682561820"><span class="hs-identifier hs-var">env</span></a></span></span><span> </span><span id="local-6989586621682561821"><span class="annot"><span class="annottext">KindCoercion
</span><a href="#local-6989586621682561821"><span class="hs-identifier hs-var">co</span></a></span></span><span>
</span><span id="line-328"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">KindCoercion -&gt; KindCoercion
</span><a href="#local-6989586621682561822"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="annot"><span class="annottext">KindCoercion
</span><a href="#local-6989586621682561821"><span class="hs-identifier hs-var">co</span></a></span><span>
</span><span id="line-329"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-330"></span><span>    </span><span id="local-6989586621682561823"><span class="annot"><span class="annottext">go_mco :: MCoercion -&gt; MCoercion
</span><a href="#local-6989586621682561823"><span class="hs-identifier hs-var hs-var">go_mco</span></a></span></span><span> </span><span class="annot"><span class="annottext">MCoercion
</span><a href="GHC.Core.TyCo.Rep.html#MRefl"><span class="hs-identifier hs-var">MRefl</span></a></span><span>    </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">MCoercion
</span><a href="GHC.Core.TyCo.Rep.html#MRefl"><span class="hs-identifier hs-var">MRefl</span></a></span><span>
</span><span id="line-331"></span><span>    </span><span class="annot"><a href="#local-6989586621682561823"><span class="hs-identifier hs-var">go_mco</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#MCo"><span class="hs-identifier hs-type">MCo</span></a></span><span> </span><span id="local-6989586621682561826"><span class="annot"><span class="annottext">KindCoercion
</span><a href="#local-6989586621682561826"><span class="hs-identifier hs-var">co</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">KindCoercion -&gt; MCoercion
</span><a href="GHC.Core.TyCo.Rep.html#MCo"><span class="hs-identifier hs-var">MCo</span></a></span><span> </span><span class="annot"><span class="annottext">(KindCoercion -&gt; MCoercion) -&gt; KindCoercion -&gt; MCoercion
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$!</span></span><span> </span><span class="annot"><span class="annottext">KindCoercion -&gt; KindCoercion
</span><a href="#local-6989586621682561822"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="annot"><span class="annottext">KindCoercion
</span><a href="#local-6989586621682561826"><span class="hs-identifier hs-var">co</span></a></span><span>
</span><span id="line-332"></span><span>
</span><span id="line-333"></span><span>    </span><span id="local-6989586621682561822"><span class="annot"><span class="annottext">go :: KindCoercion -&gt; KindCoercion
</span><a href="#local-6989586621682561822"><span class="hs-identifier hs-var hs-var">go</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#Refl"><span class="hs-identifier hs-type">Refl</span></a></span><span> </span><span id="local-6989586621682561828"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682561828"><span class="hs-identifier hs-var">ty</span></a></span></span><span class="hs-special">)</span><span>             </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Type -&gt; KindCoercion
</span><a href="GHC.Core.TyCo.Rep.html#Refl"><span class="hs-identifier hs-var">Refl</span></a></span><span> </span><span class="annot"><span class="annottext">(Type -&gt; KindCoercion) -&gt; Type -&gt; KindCoercion
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$!</span></span><span> </span><span class="annot"><span class="annottext">TidyEnv -&gt; Type -&gt; Type
</span><a href="GHC.Core.TyCo.Tidy.html#tidyType"><span class="hs-identifier hs-var">tidyType</span></a></span><span> </span><span class="annot"><span class="annottext">TidyEnv
</span><a href="#local-6989586621682561820"><span class="hs-identifier hs-var">env</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682561828"><span class="hs-identifier hs-var">ty</span></a></span><span>
</span><span id="line-334"></span><span>    </span><span class="annot"><a href="#local-6989586621682561822"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#GRefl"><span class="hs-identifier hs-type">GRefl</span></a></span><span> </span><span id="local-6989586621682561830"><span class="annot"><span class="annottext">Role
</span><a href="#local-6989586621682561830"><span class="hs-identifier hs-var">r</span></a></span></span><span> </span><span id="local-6989586621682561831"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682561831"><span class="hs-identifier hs-var">ty</span></a></span></span><span> </span><span id="local-6989586621682561832"><span class="annot"><span class="annottext">MCoercion
</span><a href="#local-6989586621682561832"><span class="hs-identifier hs-var">mco</span></a></span></span><span class="hs-special">)</span><span>      </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Role -&gt; Type -&gt; MCoercion -&gt; KindCoercion
</span><a href="GHC.Core.TyCo.Rep.html#GRefl"><span class="hs-identifier hs-var">GRefl</span></a></span><span> </span><span class="annot"><span class="annottext">Role
</span><a href="#local-6989586621682561830"><span class="hs-identifier hs-var">r</span></a></span><span> </span><span class="annot"><span class="annottext">(Type -&gt; MCoercion -&gt; KindCoercion)
-&gt; Type -&gt; MCoercion -&gt; KindCoercion
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$!</span></span><span> </span><span class="annot"><span class="annottext">TidyEnv -&gt; Type -&gt; Type
</span><a href="GHC.Core.TyCo.Tidy.html#tidyType"><span class="hs-identifier hs-var">tidyType</span></a></span><span> </span><span class="annot"><span class="annottext">TidyEnv
</span><a href="#local-6989586621682561820"><span class="hs-identifier hs-var">env</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682561831"><span class="hs-identifier hs-var">ty</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(MCoercion -&gt; KindCoercion) -&gt; MCoercion -&gt; KindCoercion
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$!</span></span><span> </span><span class="annot"><span class="annottext">MCoercion -&gt; MCoercion
</span><a href="#local-6989586621682561823"><span class="hs-identifier hs-var">go_mco</span></a></span><span> </span><span class="annot"><span class="annottext">MCoercion
</span><a href="#local-6989586621682561832"><span class="hs-identifier hs-var">mco</span></a></span><span>
</span><span id="line-335"></span><span>    </span><span class="annot"><a href="#local-6989586621682561822"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#TyConAppCo"><span class="hs-identifier hs-type">TyConAppCo</span></a></span><span> </span><span id="local-6989586621682561834"><span class="annot"><span class="annottext">Role
</span><a href="#local-6989586621682561834"><span class="hs-identifier hs-var">r</span></a></span></span><span> </span><span id="local-6989586621682561835"><span class="annot"><span class="annottext">TyCon
</span><a href="#local-6989586621682561835"><span class="hs-identifier hs-var">tc</span></a></span></span><span> </span><span id="local-6989586621682561836"><span class="annot"><span class="annottext">[KindCoercion]
</span><a href="#local-6989586621682561836"><span class="hs-identifier hs-var">cos</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Role -&gt; TyCon -&gt; [KindCoercion] -&gt; KindCoercion
</span><a href="GHC.Core.TyCo.Rep.html#TyConAppCo"><span class="hs-identifier hs-var">TyConAppCo</span></a></span><span> </span><span class="annot"><span class="annottext">Role
</span><a href="#local-6989586621682561834"><span class="hs-identifier hs-var">r</span></a></span><span> </span><span class="annot"><span class="annottext">TyCon
</span><a href="#local-6989586621682561835"><span class="hs-identifier hs-var">tc</span></a></span><span> </span><span class="annot"><span class="annottext">([KindCoercion] -&gt; KindCoercion) -&gt; [KindCoercion] -&gt; KindCoercion
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$!</span></span><span> </span><span class="annot"><span class="annottext">(KindCoercion -&gt; KindCoercion) -&gt; [KindCoercion] -&gt; [KindCoercion]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><a href="GHC.Utils.Misc.html#strictMap"><span class="hs-identifier hs-var">strictMap</span></a></span><span> </span><span class="annot"><span class="annottext">KindCoercion -&gt; KindCoercion
</span><a href="#local-6989586621682561822"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="annot"><span class="annottext">[KindCoercion]
</span><a href="#local-6989586621682561836"><span class="hs-identifier hs-var">cos</span></a></span><span>
</span><span id="line-336"></span><span>    </span><span class="annot"><a href="#local-6989586621682561822"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#AppCo"><span class="hs-identifier hs-type">AppCo</span></a></span><span> </span><span id="local-6989586621682561838"><span class="annot"><span class="annottext">KindCoercion
</span><a href="#local-6989586621682561838"><span class="hs-identifier hs-var">co1</span></a></span></span><span> </span><span id="local-6989586621682561839"><span class="annot"><span class="annottext">KindCoercion
</span><a href="#local-6989586621682561839"><span class="hs-identifier hs-var">co2</span></a></span></span><span class="hs-special">)</span><span>       </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">KindCoercion -&gt; KindCoercion -&gt; KindCoercion
</span><a href="GHC.Core.TyCo.Rep.html#AppCo"><span class="hs-identifier hs-var">AppCo</span></a></span><span> </span><span class="annot"><span class="annottext">(KindCoercion -&gt; KindCoercion -&gt; KindCoercion)
-&gt; KindCoercion -&gt; KindCoercion -&gt; KindCoercion
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$!</span></span><span> </span><span class="annot"><span class="annottext">KindCoercion -&gt; KindCoercion
</span><a href="#local-6989586621682561822"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="annot"><span class="annottext">KindCoercion
</span><a href="#local-6989586621682561838"><span class="hs-identifier hs-var">co1</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(KindCoercion -&gt; KindCoercion) -&gt; KindCoercion -&gt; KindCoercion
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$!</span></span><span> </span><span class="annot"><span class="annottext">KindCoercion -&gt; KindCoercion
</span><a href="#local-6989586621682561822"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="annot"><span class="annottext">KindCoercion
</span><a href="#local-6989586621682561839"><span class="hs-identifier hs-var">co2</span></a></span><span>
</span><span id="line-337"></span><span>    </span><span class="annot"><a href="#local-6989586621682561822"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#ForAllCo"><span class="hs-identifier hs-type">ForAllCo</span></a></span><span> </span><span id="local-6989586621682561841"><span class="annot"><span class="annottext">TyCoVar
</span><a href="#local-6989586621682561841"><span class="hs-identifier hs-var">tv</span></a></span></span><span> </span><span id="local-6989586621682561842"><span class="annot"><span class="annottext">ForAllTyFlag
</span><a href="#local-6989586621682561842"><span class="hs-identifier hs-var">visL</span></a></span></span><span> </span><span id="local-6989586621682561843"><span class="annot"><span class="annottext">ForAllTyFlag
</span><a href="#local-6989586621682561843"><span class="hs-identifier hs-var">visR</span></a></span></span><span> </span><span id="local-6989586621682561844"><span class="annot"><span class="annottext">KindCoercion
</span><a href="#local-6989586621682561844"><span class="hs-identifier hs-var">h</span></a></span></span><span> </span><span id="local-6989586621682561845"><span class="annot"><span class="annottext">KindCoercion
</span><a href="#local-6989586621682561845"><span class="hs-identifier hs-var">co</span></a></span></span><span class="hs-special">)</span><span>
</span><span id="line-338"></span><span>      </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><span class="hs-special">(</span><span class="hs-special">(</span><span class="hs-special">(</span><span class="annot"><span class="annottext">TyCoVar
-&gt; ForAllTyFlag
-&gt; ForAllTyFlag
-&gt; KindCoercion
-&gt; KindCoercion
-&gt; KindCoercion
</span><a href="GHC.Core.TyCo.Rep.html#ForAllCo"><span class="hs-identifier hs-var">ForAllCo</span></a></span><span> </span><span class="annot"><span class="annottext">(TyCoVar
 -&gt; ForAllTyFlag
 -&gt; ForAllTyFlag
 -&gt; KindCoercion
 -&gt; KindCoercion
 -&gt; KindCoercion)
-&gt; TyCoVar
-&gt; ForAllTyFlag
-&gt; ForAllTyFlag
-&gt; KindCoercion
-&gt; KindCoercion
-&gt; KindCoercion
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$!</span></span><span> </span><span class="annot"><span class="annottext">TyCoVar
</span><a href="#local-6989586621682561846"><span class="hs-identifier hs-var">tvp</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(ForAllTyFlag
 -&gt; ForAllTyFlag -&gt; KindCoercion -&gt; KindCoercion -&gt; KindCoercion)
-&gt; ForAllTyFlag
-&gt; ForAllTyFlag
-&gt; KindCoercion
-&gt; KindCoercion
-&gt; KindCoercion
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$!</span></span><span> </span><span class="annot"><span class="annottext">ForAllTyFlag
</span><a href="#local-6989586621682561842"><span class="hs-identifier hs-var">visL</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(ForAllTyFlag -&gt; KindCoercion -&gt; KindCoercion -&gt; KindCoercion)
-&gt; ForAllTyFlag -&gt; KindCoercion -&gt; KindCoercion -&gt; KindCoercion
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$!</span></span><span> </span><span class="annot"><span class="annottext">ForAllTyFlag
</span><a href="#local-6989586621682561843"><span class="hs-identifier hs-var">visR</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(KindCoercion -&gt; KindCoercion -&gt; KindCoercion)
-&gt; KindCoercion -&gt; KindCoercion -&gt; KindCoercion
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$!</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">KindCoercion -&gt; KindCoercion
</span><a href="#local-6989586621682561822"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="annot"><span class="annottext">KindCoercion
</span><a href="#local-6989586621682561844"><span class="hs-identifier hs-var">h</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(KindCoercion -&gt; KindCoercion) -&gt; KindCoercion -&gt; KindCoercion
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$!</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TidyEnv -&gt; KindCoercion -&gt; KindCoercion
</span><a href="GHC.Core.TyCo.Tidy.html#tidyCo"><span class="hs-identifier hs-var">tidyCo</span></a></span><span> </span><span class="annot"><span class="annottext">TidyEnv
</span><a href="#local-6989586621682561847"><span class="hs-identifier hs-var">envp</span></a></span><span> </span><span class="annot"><span class="annottext">KindCoercion
</span><a href="#local-6989586621682561845"><span class="hs-identifier hs-var">co</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-339"></span><span>                               </span><span class="hs-keyword">where</span><span> </span><span class="hs-special">(</span><span id="local-6989586621682561847"><span class="annot"><span class="annottext">TidyEnv
</span><a href="#local-6989586621682561847"><span class="hs-identifier hs-var">envp</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682561846"><span class="annot"><span class="annottext">TyCoVar
</span><a href="#local-6989586621682561846"><span class="hs-identifier hs-var">tvp</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">TidyEnv -&gt; TyCoVar -&gt; (TidyEnv, TyCoVar)
</span><a href="GHC.Core.TyCo.Tidy.html#tidyVarBndr"><span class="hs-identifier hs-var">tidyVarBndr</span></a></span><span> </span><span class="annot"><span class="annottext">TidyEnv
</span><a href="#local-6989586621682561820"><span class="hs-identifier hs-var">env</span></a></span><span> </span><span class="annot"><span class="annottext">TyCoVar
</span><a href="#local-6989586621682561841"><span class="hs-identifier hs-var">tv</span></a></span><span>
</span><span id="line-340"></span><span>            </span><span class="hs-comment">-- the case above duplicates a bit of work in tidying h and the kind</span><span>
</span><span id="line-341"></span><span>            </span><span class="hs-comment">-- of tv. But the alternative is to use coercionKind, which seems worse.</span><span>
</span><span id="line-342"></span><span>    </span><span class="annot"><a href="#local-6989586621682561822"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#FunCo"><span class="hs-identifier hs-type">FunCo</span></a></span><span> </span><span id="local-6989586621682561849"><span class="annot"><span class="annottext">Role
</span><a href="#local-6989586621682561849"><span class="hs-identifier hs-var">r</span></a></span></span><span> </span><span id="local-6989586621682561850"><span class="annot"><span class="annottext">FunTyFlag
</span><a href="#local-6989586621682561850"><span class="hs-identifier hs-var">afl</span></a></span></span><span> </span><span id="local-6989586621682561851"><span class="annot"><span class="annottext">FunTyFlag
</span><a href="#local-6989586621682561851"><span class="hs-identifier hs-var">afr</span></a></span></span><span> </span><span id="local-6989586621682561852"><span class="annot"><span class="annottext">KindCoercion
</span><a href="#local-6989586621682561852"><span class="hs-identifier hs-var">w</span></a></span></span><span> </span><span id="local-6989586621682561853"><span class="annot"><span class="annottext">KindCoercion
</span><a href="#local-6989586621682561853"><span class="hs-identifier hs-var">co1</span></a></span></span><span> </span><span id="local-6989586621682561854"><span class="annot"><span class="annottext">KindCoercion
</span><a href="#local-6989586621682561854"><span class="hs-identifier hs-var">co2</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><span class="hs-special">(</span><span class="annot"><span class="annottext">Role
-&gt; FunTyFlag
-&gt; FunTyFlag
-&gt; KindCoercion
-&gt; KindCoercion
-&gt; KindCoercion
-&gt; KindCoercion
</span><a href="GHC.Core.TyCo.Rep.html#FunCo"><span class="hs-identifier hs-var">FunCo</span></a></span><span> </span><span class="annot"><span class="annottext">Role
</span><a href="#local-6989586621682561849"><span class="hs-identifier hs-var">r</span></a></span><span> </span><span class="annot"><span class="annottext">FunTyFlag
</span><a href="#local-6989586621682561850"><span class="hs-identifier hs-var">afl</span></a></span><span> </span><span class="annot"><span class="annottext">FunTyFlag
</span><a href="#local-6989586621682561851"><span class="hs-identifier hs-var">afr</span></a></span><span> </span><span class="annot"><span class="annottext">(KindCoercion -&gt; KindCoercion -&gt; KindCoercion -&gt; KindCoercion)
-&gt; KindCoercion -&gt; KindCoercion -&gt; KindCoercion -&gt; KindCoercion
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$!</span></span><span> </span><span class="annot"><span class="annottext">KindCoercion -&gt; KindCoercion
</span><a href="#local-6989586621682561822"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="annot"><span class="annottext">KindCoercion
</span><a href="#local-6989586621682561852"><span class="hs-identifier hs-var">w</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(KindCoercion -&gt; KindCoercion -&gt; KindCoercion)
-&gt; KindCoercion -&gt; KindCoercion -&gt; KindCoercion
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$!</span></span><span> </span><span class="annot"><span class="annottext">KindCoercion -&gt; KindCoercion
</span><a href="#local-6989586621682561822"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="annot"><span class="annottext">KindCoercion
</span><a href="#local-6989586621682561853"><span class="hs-identifier hs-var">co1</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(KindCoercion -&gt; KindCoercion) -&gt; KindCoercion -&gt; KindCoercion
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$!</span></span><span> </span><span class="annot"><span class="annottext">KindCoercion -&gt; KindCoercion
</span><a href="#local-6989586621682561822"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="annot"><span class="annottext">KindCoercion
</span><a href="#local-6989586621682561854"><span class="hs-identifier hs-var">co2</span></a></span><span>
</span><span id="line-343"></span><span>    </span><span class="annot"><a href="#local-6989586621682561822"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#CoVarCo"><span class="hs-identifier hs-type">CoVarCo</span></a></span><span> </span><span id="local-6989586621682561856"><span class="annot"><span class="annottext">TyCoVar
</span><a href="#local-6989586621682561856"><span class="hs-identifier hs-var">cv</span></a></span></span><span class="hs-special">)</span><span>          </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">TyCoVar -&gt; KindCoercion
</span><a href="GHC.Core.TyCo.Rep.html#CoVarCo"><span class="hs-identifier hs-var">CoVarCo</span></a></span><span> </span><span class="annot"><span class="annottext">(TyCoVar -&gt; KindCoercion) -&gt; TyCoVar -&gt; KindCoercion
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$!</span></span><span> </span><span class="annot"><span class="annottext">TyCoVar -&gt; TyCoVar
</span><a href="#local-6989586621682561857"><span class="hs-identifier hs-var">go_cv</span></a></span><span> </span><span class="annot"><span class="annottext">TyCoVar
</span><a href="#local-6989586621682561856"><span class="hs-identifier hs-var">cv</span></a></span><span>
</span><span id="line-344"></span><span>    </span><span class="annot"><a href="#local-6989586621682561822"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#HoleCo"><span class="hs-identifier hs-type">HoleCo</span></a></span><span> </span><span id="local-6989586621682561859"><span class="annot"><span class="annottext">CoercionHole
</span><a href="#local-6989586621682561859"><span class="hs-identifier hs-var">h</span></a></span></span><span class="hs-special">)</span><span>            </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">CoercionHole -&gt; KindCoercion
</span><a href="GHC.Core.TyCo.Rep.html#HoleCo"><span class="hs-identifier hs-var">HoleCo</span></a></span><span> </span><span class="annot"><span class="annottext">(CoercionHole -&gt; KindCoercion) -&gt; CoercionHole -&gt; KindCoercion
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$!</span></span><span> </span><span class="annot"><span class="annottext">CoercionHole -&gt; CoercionHole
</span><a href="#local-6989586621682561860"><span class="hs-identifier hs-var">go_hole</span></a></span><span> </span><span class="annot"><span class="annottext">CoercionHole
</span><a href="#local-6989586621682561859"><span class="hs-identifier hs-var">h</span></a></span><span>
</span><span id="line-345"></span><span>    </span><span class="annot"><a href="#local-6989586621682561822"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#AxiomCo"><span class="hs-identifier hs-type">AxiomCo</span></a></span><span> </span><span id="local-6989586621682561862"><span class="annot"><span class="annottext">CoAxiomRule
</span><a href="#local-6989586621682561862"><span class="hs-identifier hs-var">ax</span></a></span></span><span> </span><span id="local-6989586621682561863"><span class="annot"><span class="annottext">[KindCoercion]
</span><a href="#local-6989586621682561863"><span class="hs-identifier hs-var">cos</span></a></span></span><span class="hs-special">)</span><span>      </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">CoAxiomRule -&gt; [KindCoercion] -&gt; KindCoercion
</span><a href="GHC.Core.TyCo.Rep.html#AxiomCo"><span class="hs-identifier hs-var">AxiomCo</span></a></span><span> </span><span class="annot"><span class="annottext">CoAxiomRule
</span><a href="#local-6989586621682561862"><span class="hs-identifier hs-var">ax</span></a></span><span> </span><span class="annot"><span class="annottext">([KindCoercion] -&gt; KindCoercion) -&gt; [KindCoercion] -&gt; KindCoercion
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">(KindCoercion -&gt; KindCoercion) -&gt; [KindCoercion] -&gt; [KindCoercion]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><a href="GHC.Utils.Misc.html#strictMap"><span class="hs-identifier hs-var">strictMap</span></a></span><span> </span><span class="annot"><span class="annottext">KindCoercion -&gt; KindCoercion
</span><a href="#local-6989586621682561822"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="annot"><span class="annottext">[KindCoercion]
</span><a href="#local-6989586621682561863"><span class="hs-identifier hs-var">cos</span></a></span><span>
</span><span id="line-346"></span><span>    </span><span class="annot"><a href="#local-6989586621682561822"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span id="local-6989586621682561864"><span class="annot"><span class="annottext">co :: KindCoercion
</span><a href="#local-6989586621682561864"><span class="hs-identifier hs-var">co</span></a></span></span><span class="hs-glyph">@</span><span class="hs-special">(</span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#UnivCo"><span class="hs-identifier hs-type">UnivCo</span></a></span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">uco_lty :: KindCoercion -&gt; Type
</span><a href="GHC.Core.TyCo.Rep.html#uco_lty"><span class="hs-identifier hs-var">uco_lty</span></a></span><span>  </span><span class="hs-glyph">=</span><span> </span><span id="local-6989586621682561867"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682561867"><span class="hs-identifier hs-var">t1</span></a></span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">uco_rty :: KindCoercion -&gt; Type
</span><a href="GHC.Core.TyCo.Rep.html#uco_rty"><span class="hs-identifier hs-var">uco_rty</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="local-6989586621682561869"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682561869"><span class="hs-identifier hs-var">t2</span></a></span></span><span> </span><span class="hs-special">}</span><span class="hs-special">)</span><span>
</span><span id="line-347"></span><span>                             </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">KindCoercion
</span><a href="#local-6989586621682561864"><span class="hs-identifier hs-var">co</span></a></span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#uco_lty"><span class="hs-identifier hs-var">uco_lty</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="GHC.Core.TyCo.Tidy.html#tidyType"><span class="hs-identifier hs-type">tidyType</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682561820"><span class="hs-identifier hs-type">env</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682561867"><span class="hs-identifier hs-type">t1</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#uco_rty"><span class="hs-identifier hs-var">uco_rty</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="GHC.Core.TyCo.Tidy.html#tidyType"><span class="hs-identifier hs-type">tidyType</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682561820"><span class="hs-identifier hs-type">env</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682561869"><span class="hs-identifier hs-type">t2</span></a></span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-348"></span><span>                               </span><span class="hs-comment">-- Don't bother to tidy the uco_deps field</span><span>
</span><span id="line-349"></span><span>    </span><span class="annot"><a href="#local-6989586621682561822"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#SymCo"><span class="hs-identifier hs-type">SymCo</span></a></span><span> </span><span id="local-6989586621682561871"><span class="annot"><span class="annottext">KindCoercion
</span><a href="#local-6989586621682561871"><span class="hs-identifier hs-var">co</span></a></span></span><span class="hs-special">)</span><span>            </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">KindCoercion -&gt; KindCoercion
</span><a href="GHC.Core.TyCo.Rep.html#SymCo"><span class="hs-identifier hs-var">SymCo</span></a></span><span> </span><span class="annot"><span class="annottext">(KindCoercion -&gt; KindCoercion) -&gt; KindCoercion -&gt; KindCoercion
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$!</span></span><span> </span><span class="annot"><span class="annottext">KindCoercion -&gt; KindCoercion
</span><a href="#local-6989586621682561822"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="annot"><span class="annottext">KindCoercion
</span><a href="#local-6989586621682561871"><span class="hs-identifier hs-var">co</span></a></span><span>
</span><span id="line-350"></span><span>    </span><span class="annot"><a href="#local-6989586621682561822"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#TransCo"><span class="hs-identifier hs-type">TransCo</span></a></span><span> </span><span id="local-6989586621682561873"><span class="annot"><span class="annottext">KindCoercion
</span><a href="#local-6989586621682561873"><span class="hs-identifier hs-var">co1</span></a></span></span><span> </span><span id="local-6989586621682561874"><span class="annot"><span class="annottext">KindCoercion
</span><a href="#local-6989586621682561874"><span class="hs-identifier hs-var">co2</span></a></span></span><span class="hs-special">)</span><span>     </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">KindCoercion -&gt; KindCoercion -&gt; KindCoercion
</span><a href="GHC.Core.TyCo.Rep.html#TransCo"><span class="hs-identifier hs-var">TransCo</span></a></span><span> </span><span class="annot"><span class="annottext">(KindCoercion -&gt; KindCoercion -&gt; KindCoercion)
-&gt; KindCoercion -&gt; KindCoercion -&gt; KindCoercion
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$!</span></span><span> </span><span class="annot"><span class="annottext">KindCoercion -&gt; KindCoercion
</span><a href="#local-6989586621682561822"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="annot"><span class="annottext">KindCoercion
</span><a href="#local-6989586621682561873"><span class="hs-identifier hs-var">co1</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(KindCoercion -&gt; KindCoercion) -&gt; KindCoercion -&gt; KindCoercion
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$!</span></span><span> </span><span class="annot"><span class="annottext">KindCoercion -&gt; KindCoercion
</span><a href="#local-6989586621682561822"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="annot"><span class="annottext">KindCoercion
</span><a href="#local-6989586621682561874"><span class="hs-identifier hs-var">co2</span></a></span><span>
</span><span id="line-351"></span><span>    </span><span class="annot"><a href="#local-6989586621682561822"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#SelCo"><span class="hs-identifier hs-type">SelCo</span></a></span><span> </span><span id="local-6989586621682561876"><span class="annot"><span class="annottext">CoSel
</span><a href="#local-6989586621682561876"><span class="hs-identifier hs-var">d</span></a></span></span><span> </span><span id="local-6989586621682561877"><span class="annot"><span class="annottext">KindCoercion
</span><a href="#local-6989586621682561877"><span class="hs-identifier hs-var">co</span></a></span></span><span class="hs-special">)</span><span>          </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">CoSel -&gt; KindCoercion -&gt; KindCoercion
</span><a href="GHC.Core.TyCo.Rep.html#SelCo"><span class="hs-identifier hs-var">SelCo</span></a></span><span> </span><span class="annot"><span class="annottext">CoSel
</span><a href="#local-6989586621682561876"><span class="hs-identifier hs-var">d</span></a></span><span> </span><span class="annot"><span class="annottext">(KindCoercion -&gt; KindCoercion) -&gt; KindCoercion -&gt; KindCoercion
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$!</span></span><span> </span><span class="annot"><span class="annottext">KindCoercion -&gt; KindCoercion
</span><a href="#local-6989586621682561822"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="annot"><span class="annottext">KindCoercion
</span><a href="#local-6989586621682561877"><span class="hs-identifier hs-var">co</span></a></span><span>
</span><span id="line-352"></span><span>    </span><span class="annot"><a href="#local-6989586621682561822"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#LRCo"><span class="hs-identifier hs-type">LRCo</span></a></span><span> </span><span id="local-6989586621682561879"><span class="annot"><span class="annottext">LeftOrRight
</span><a href="#local-6989586621682561879"><span class="hs-identifier hs-var">lr</span></a></span></span><span> </span><span id="local-6989586621682561880"><span class="annot"><span class="annottext">KindCoercion
</span><a href="#local-6989586621682561880"><span class="hs-identifier hs-var">co</span></a></span></span><span class="hs-special">)</span><span>          </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">LeftOrRight -&gt; KindCoercion -&gt; KindCoercion
</span><a href="GHC.Core.TyCo.Rep.html#LRCo"><span class="hs-identifier hs-var">LRCo</span></a></span><span> </span><span class="annot"><span class="annottext">LeftOrRight
</span><a href="#local-6989586621682561879"><span class="hs-identifier hs-var">lr</span></a></span><span> </span><span class="annot"><span class="annottext">(KindCoercion -&gt; KindCoercion) -&gt; KindCoercion -&gt; KindCoercion
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$!</span></span><span> </span><span class="annot"><span class="annottext">KindCoercion -&gt; KindCoercion
</span><a href="#local-6989586621682561822"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="annot"><span class="annottext">KindCoercion
</span><a href="#local-6989586621682561880"><span class="hs-identifier hs-var">co</span></a></span><span>
</span><span id="line-353"></span><span>    </span><span class="annot"><a href="#local-6989586621682561822"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#InstCo"><span class="hs-identifier hs-type">InstCo</span></a></span><span> </span><span id="local-6989586621682561882"><span class="annot"><span class="annottext">KindCoercion
</span><a href="#local-6989586621682561882"><span class="hs-identifier hs-var">co</span></a></span></span><span> </span><span id="local-6989586621682561883"><span class="annot"><span class="annottext">KindCoercion
</span><a href="#local-6989586621682561883"><span class="hs-identifier hs-var">ty</span></a></span></span><span class="hs-special">)</span><span>        </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">KindCoercion -&gt; KindCoercion -&gt; KindCoercion
</span><a href="GHC.Core.TyCo.Rep.html#InstCo"><span class="hs-identifier hs-var">InstCo</span></a></span><span> </span><span class="annot"><span class="annottext">(KindCoercion -&gt; KindCoercion -&gt; KindCoercion)
-&gt; KindCoercion -&gt; KindCoercion -&gt; KindCoercion
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$!</span></span><span> </span><span class="annot"><span class="annottext">KindCoercion -&gt; KindCoercion
</span><a href="#local-6989586621682561822"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="annot"><span class="annottext">KindCoercion
</span><a href="#local-6989586621682561882"><span class="hs-identifier hs-var">co</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(KindCoercion -&gt; KindCoercion) -&gt; KindCoercion -&gt; KindCoercion
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$!</span></span><span> </span><span class="annot"><span class="annottext">KindCoercion -&gt; KindCoercion
</span><a href="#local-6989586621682561822"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="annot"><span class="annottext">KindCoercion
</span><a href="#local-6989586621682561883"><span class="hs-identifier hs-var">ty</span></a></span><span>
</span><span id="line-354"></span><span>    </span><span class="annot"><a href="#local-6989586621682561822"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#KindCo"><span class="hs-identifier hs-type">KindCo</span></a></span><span> </span><span id="local-6989586621682561885"><span class="annot"><span class="annottext">KindCoercion
</span><a href="#local-6989586621682561885"><span class="hs-identifier hs-var">co</span></a></span></span><span class="hs-special">)</span><span>           </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">KindCoercion -&gt; KindCoercion
</span><a href="GHC.Core.TyCo.Rep.html#KindCo"><span class="hs-identifier hs-var">KindCo</span></a></span><span> </span><span class="annot"><span class="annottext">(KindCoercion -&gt; KindCoercion) -&gt; KindCoercion -&gt; KindCoercion
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$!</span></span><span> </span><span class="annot"><span class="annottext">KindCoercion -&gt; KindCoercion
</span><a href="#local-6989586621682561822"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="annot"><span class="annottext">KindCoercion
</span><a href="#local-6989586621682561885"><span class="hs-identifier hs-var">co</span></a></span><span>
</span><span id="line-355"></span><span>    </span><span class="annot"><a href="#local-6989586621682561822"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#SubCo"><span class="hs-identifier hs-type">SubCo</span></a></span><span> </span><span id="local-6989586621682561887"><span class="annot"><span class="annottext">KindCoercion
</span><a href="#local-6989586621682561887"><span class="hs-identifier hs-var">co</span></a></span></span><span class="hs-special">)</span><span>            </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">KindCoercion -&gt; KindCoercion
</span><a href="GHC.Core.TyCo.Rep.html#SubCo"><span class="hs-identifier hs-var">SubCo</span></a></span><span> </span><span class="annot"><span class="annottext">(KindCoercion -&gt; KindCoercion) -&gt; KindCoercion -&gt; KindCoercion
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$!</span></span><span> </span><span class="annot"><span class="annottext">KindCoercion -&gt; KindCoercion
</span><a href="#local-6989586621682561822"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="annot"><span class="annottext">KindCoercion
</span><a href="#local-6989586621682561887"><span class="hs-identifier hs-var">co</span></a></span><span>
</span><span id="line-356"></span><span>
</span><span id="line-357"></span><span>    </span><span id="local-6989586621682561857"><span class="annot"><span class="annottext">go_cv :: TyCoVar -&gt; TyCoVar
</span><a href="#local-6989586621682561857"><span class="hs-identifier hs-var hs-var">go_cv</span></a></span></span><span> </span><span id="local-6989586621682561888"><span class="annot"><span class="annottext">TyCoVar
</span><a href="#local-6989586621682561888"><span class="hs-identifier hs-var">cv</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">TidyEnv -&gt; TyCoVar -&gt; TyCoVar
</span><a href="GHC.Core.TyCo.Tidy.html#tidyTyCoVarOcc"><span class="hs-identifier hs-var">tidyTyCoVarOcc</span></a></span><span> </span><span class="annot"><span class="annottext">TidyEnv
</span><a href="#local-6989586621682561820"><span class="hs-identifier hs-var">env</span></a></span><span> </span><span class="annot"><span class="annottext">TyCoVar
</span><a href="#local-6989586621682561888"><span class="hs-identifier hs-var">cv</span></a></span><span>
</span><span id="line-358"></span><span>
</span><span id="line-359"></span><span>    </span><span id="local-6989586621682561860"><span class="annot"><span class="annottext">go_hole :: CoercionHole -&gt; CoercionHole
</span><a href="#local-6989586621682561860"><span class="hs-identifier hs-var hs-var">go_hole</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#CoercionHole"><span class="hs-identifier hs-type">CoercionHole</span></a></span><span> </span><span id="local-6989586621682561890"><span class="annot"><span class="annottext">TyCoVar
</span><a href="#local-6989586621682561890"><span class="hs-identifier hs-var">cv</span></a></span></span><span> </span><span id="local-6989586621682561891"><span class="annot"><span class="annottext">IORef (Maybe KindCoercion)
</span><a href="#local-6989586621682561891"><span class="hs-identifier hs-var">r</span></a></span></span><span> </span><span id="local-6989586621682561892"><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621682561892"><span class="hs-identifier hs-var">h</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TyCoVar -&gt; IORef (Maybe KindCoercion) -&gt; Bool -&gt; CoercionHole
</span><a href="GHC.Core.TyCo.Rep.html#CoercionHole"><span class="hs-identifier hs-var">CoercionHole</span></a></span><span> </span><span class="annot"><span class="annottext">(TyCoVar -&gt; IORef (Maybe KindCoercion) -&gt; Bool -&gt; CoercionHole)
-&gt; TyCoVar -&gt; IORef (Maybe KindCoercion) -&gt; Bool -&gt; CoercionHole
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$!</span></span><span> </span><span class="annot"><span class="annottext">TyCoVar -&gt; TyCoVar
</span><a href="#local-6989586621682561857"><span class="hs-identifier hs-var">go_cv</span></a></span><span> </span><span class="annot"><span class="annottext">TyCoVar
</span><a href="#local-6989586621682561890"><span class="hs-identifier hs-var">cv</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">IORef (Maybe KindCoercion)
</span><a href="#local-6989586621682561891"><span class="hs-identifier hs-var">r</span></a></span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621682561892"><span class="hs-identifier hs-var">h</span></a></span><span>
</span><span id="line-360"></span><span>    </span><span class="hs-comment">-- Tidy even the holes; tidied types should have tidied kinds</span><span>
</span><span id="line-361"></span><span>
</span><span id="line-362"></span><span class="annot"><a href="GHC.Core.TyCo.Tidy.html#tidyCos"><span class="hs-identifier hs-type">tidyCos</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Types.Var.Env.html#TidyEnv"><span class="hs-identifier hs-type">TidyEnv</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#Coercion"><span class="hs-identifier hs-type">Coercion</span></a></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#Coercion"><span class="hs-identifier hs-type">Coercion</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-363"></span><span id="tidyCos"><span class="annot"><span class="annottext">tidyCos :: TidyEnv -&gt; [KindCoercion] -&gt; [KindCoercion]
</span><a href="GHC.Core.TyCo.Tidy.html#tidyCos"><span class="hs-identifier hs-var hs-var">tidyCos</span></a></span></span><span> </span><span id="local-6989586621682561893"><span class="annot"><span class="annottext">TidyEnv
</span><a href="#local-6989586621682561893"><span class="hs-identifier hs-var">env</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(KindCoercion -&gt; KindCoercion) -&gt; [KindCoercion] -&gt; [KindCoercion]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><a href="GHC.Utils.Misc.html#strictMap"><span class="hs-identifier hs-var">strictMap</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TidyEnv -&gt; KindCoercion -&gt; KindCoercion
</span><a href="GHC.Core.TyCo.Tidy.html#tidyCo"><span class="hs-identifier hs-var">tidyCo</span></a></span><span> </span><span class="annot"><span class="annottext">TidyEnv
</span><a href="#local-6989586621682561893"><span class="hs-identifier hs-var">env</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-364"></span></pre></body></html>