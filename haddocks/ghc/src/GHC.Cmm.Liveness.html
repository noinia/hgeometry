<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><link rel="stylesheet" type="text/css" href="style.css" /><script type="text/javascript" src="highlight.js"></script></head><body><pre><span class="hs-pragma">{-# LANGUAGE GADTs #-}</span><span>
</span><span id="line-2"></span><span>
</span><span id="line-3"></span><span class="hs-keyword">module</span><span> </span><span class="annot"><a href="GHC.Cmm.Liveness.html"><span class="hs-identifier">GHC.Cmm.Liveness</span></a></span><span>
</span><span id="line-4"></span><span>    </span><span class="hs-special">(</span><span> </span><span class="annot"><a href="GHC.Cmm.Liveness.html#CmmLocalLive"><span class="hs-identifier">CmmLocalLive</span></a></span><span>
</span><span id="line-5"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Cmm.Liveness.html#cmmLocalLiveness"><span class="hs-identifier">cmmLocalLiveness</span></a></span><span>
</span><span id="line-6"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Cmm.Liveness.html#cmmLocalLivenessL"><span class="hs-identifier">cmmLocalLivenessL</span></a></span><span>
</span><span id="line-7"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Cmm.Liveness.html#cmmGlobalLiveness"><span class="hs-identifier">cmmGlobalLiveness</span></a></span><span>
</span><span id="line-8"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Cmm.Liveness.html#liveLattice"><span class="hs-identifier">liveLattice</span></a></span><span>
</span><span id="line-9"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Cmm.Liveness.html#liveLatticeL"><span class="hs-identifier">liveLatticeL</span></a></span><span>
</span><span id="line-10"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Cmm.Liveness.html#gen_kill"><span class="hs-identifier">gen_kill</span></a></span><span>
</span><span id="line-11"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Cmm.Liveness.html#gen_killL"><span class="hs-identifier">gen_killL</span></a></span><span>
</span><span id="line-12"></span><span>    </span><span class="hs-special">)</span><span>
</span><span id="line-13"></span><span class="hs-keyword">where</span><span>
</span><span id="line-14"></span><span>
</span><span id="line-15"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Prelude.html"><span class="hs-identifier">GHC.Prelude</span></a></span><span>
</span><span id="line-16"></span><span>
</span><span id="line-17"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Platform.html"><span class="hs-identifier">GHC.Platform</span></a></span><span>
</span><span id="line-18"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Cmm.BlockId.html"><span class="hs-identifier">GHC.Cmm.BlockId</span></a></span><span>
</span><span id="line-19"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Cmm.html"><span class="hs-identifier">GHC.Cmm</span></a></span><span>
</span><span id="line-20"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Cmm.Dataflow.Block.html"><span class="hs-identifier">GHC.Cmm.Dataflow.Block</span></a></span><span>
</span><span id="line-21"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Cmm.Dataflow.html"><span class="hs-identifier">GHC.Cmm.Dataflow</span></a></span><span>
</span><span id="line-22"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Cmm.Dataflow.Label.html"><span class="hs-identifier">GHC.Cmm.Dataflow.Label</span></a></span><span>
</span><span id="line-23"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Cmm.LRegSet.html"><span class="hs-identifier">GHC.Cmm.LRegSet</span></a></span><span>
</span><span id="line-24"></span><span>
</span><span id="line-25"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Data.Maybe.html"><span class="hs-identifier">GHC.Data.Maybe</span></a></span><span>
</span><span id="line-26"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Utils.Outputable.html"><span class="hs-identifier">GHC.Utils.Outputable</span></a></span><span>
</span><span id="line-27"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Utils.Panic.html"><span class="hs-identifier">GHC.Utils.Panic</span></a></span><span>
</span><span id="line-28"></span><span>
</span><span id="line-29"></span><span class="hs-comment">-----------------------------------------------------------------------------</span><span>
</span><span id="line-30"></span><span class="hs-comment">-- Calculating what variables are live on entry to a basic block</span><span>
</span><span id="line-31"></span><span class="hs-comment">-----------------------------------------------------------------------------</span><span>
</span><span id="line-32"></span><span>
</span><span id="line-33"></span><span class="annot"><span class="hs-comment">-- | The variables live on entry to a block</span></span><span>
</span><span id="line-34"></span><span class="hs-keyword">type</span><span> </span><span id="CmmLive"><span class="annot"><a href="GHC.Cmm.Liveness.html#CmmLive"><span class="hs-identifier hs-var">CmmLive</span></a></span></span><span> </span><span id="local-6989586621682873738"><span class="annot"><a href="#local-6989586621682873738"><span class="hs-identifier hs-type">r</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="GHC.Cmm.Expr.html#RegSet"><span class="hs-identifier hs-type">RegSet</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682873738"><span class="hs-identifier hs-type">r</span></a></span><span>
</span><span id="line-35"></span><span class="hs-keyword">type</span><span> </span><span id="CmmLocalLive"><span class="annot"><a href="GHC.Cmm.Liveness.html#CmmLocalLive"><span class="hs-identifier hs-var">CmmLocalLive</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="GHC.Cmm.Liveness.html#CmmLive"><span class="hs-identifier hs-type">CmmLive</span></a></span><span> </span><span class="annot"><a href="GHC.Cmm.Reg.html#LocalReg"><span class="hs-identifier hs-type">LocalReg</span></a></span><span>
</span><span id="line-36"></span><span>
</span><span id="line-37"></span><span class="annot"><span class="hs-comment">-- | The dataflow lattice</span></span><span>
</span><span id="line-38"></span><span id="local-6989586621682873607"><span class="annot"><a href="GHC.Cmm.Liveness.html#liveLattice"><span class="hs-identifier hs-type">liveLattice</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Ord</span></span><span> </span><span class="annot"><a href="#local-6989586621682873607"><span class="hs-identifier hs-type">r</span></a></span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="GHC.Cmm.Dataflow.html#DataflowLattice"><span class="hs-identifier hs-type">DataflowLattice</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Cmm.Liveness.html#CmmLive"><span class="hs-identifier hs-type">CmmLive</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682873607"><span class="hs-identifier hs-type">r</span></a></span><span class="hs-special">)</span></span><span>
</span><span id="line-39"></span><span class="hs-pragma">{-# SPECIALIZE</span><span> </span><span class="annot"><a href="GHC.Cmm.Liveness.html#liveLattice"><span class="hs-pragma hs-type">liveLattice</span></a></span><span> </span><span class="hs-pragma">::</span><span> </span><span class="annot"><a href="GHC.Cmm.Dataflow.html#DataflowLattice"><span class="hs-pragma hs-type">DataflowLattice</span></a></span><span> </span><span class="hs-pragma">(</span><span class="annot"><a href="GHC.Cmm.Liveness.html#CmmLive"><span class="hs-pragma hs-type">CmmLive</span></a></span><span> </span><span class="annot"><a href="GHC.Cmm.Reg.html#LocalReg"><span class="hs-pragma hs-type">LocalReg</span></a></span><span class="hs-pragma">)</span><span> </span><span class="hs-pragma">#-}</span><span>
</span><span id="line-40"></span><span class="hs-pragma">{-# SPECIALIZE</span><span> </span><span class="annot"><a href="GHC.Cmm.Liveness.html#liveLattice"><span class="hs-pragma hs-type">liveLattice</span></a></span><span> </span><span class="hs-pragma">::</span><span> </span><span class="annot"><a href="GHC.Cmm.Dataflow.html#DataflowLattice"><span class="hs-pragma hs-type">DataflowLattice</span></a></span><span> </span><span class="hs-pragma">(</span><span class="annot"><a href="GHC.Cmm.Liveness.html#CmmLive"><span class="hs-pragma hs-type">CmmLive</span></a></span><span> </span><span class="annot"><a href="GHC.Cmm.Reg.html#GlobalReg"><span class="hs-pragma hs-type">GlobalReg</span></a></span><span class="hs-pragma">)</span><span> </span><span class="hs-pragma">#-}</span><span>
</span><span id="line-41"></span><span id="liveLattice"><span class="annot"><span class="annottext">liveLattice :: forall r. Ord r =&gt; DataflowLattice (CmmLive r)
</span><a href="GHC.Cmm.Liveness.html#liveLattice"><span class="hs-identifier hs-var hs-var">liveLattice</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">CmmLive r -&gt; JoinFun (CmmLive r) -&gt; DataflowLattice (CmmLive r)
forall a. a -&gt; JoinFun a -&gt; DataflowLattice a
</span><a href="GHC.Cmm.Dataflow.html#DataflowLattice"><span class="hs-identifier hs-var">DataflowLattice</span></a></span><span> </span><span class="annot"><span class="annottext">CmmLive r
forall r. RegSet r
</span><a href="GHC.Cmm.Expr.html#emptyRegSet"><span class="hs-identifier hs-var">emptyRegSet</span></a></span><span> </span><span class="annot"><span class="annottext">JoinFun (CmmLive r)
forall {r}.
Ord r =&gt;
OldFact (RegSet r) -&gt; NewFact (RegSet r) -&gt; JoinedFact (RegSet r)
</span><a href="#local-6989586621682873743"><span class="hs-identifier hs-var">add</span></a></span><span>
</span><span id="line-42"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-43"></span><span>    </span><span id="local-6989586621682873743"><span class="annot"><span class="annottext">add :: OldFact (RegSet r) -&gt; NewFact (RegSet r) -&gt; JoinedFact (RegSet r)
</span><a href="#local-6989586621682873743"><span class="hs-identifier hs-var hs-var">add</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Cmm.Dataflow.html#OldFact"><span class="hs-identifier hs-type">OldFact</span></a></span><span> </span><span id="local-6989586621682873752"><span class="annot"><span class="annottext">RegSet r
</span><a href="#local-6989586621682873752"><span class="hs-identifier hs-var">old</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Cmm.Dataflow.html#NewFact"><span class="hs-identifier hs-type">NewFact</span></a></span><span> </span><span id="local-6989586621682873754"><span class="annot"><span class="annottext">RegSet r
</span><a href="#local-6989586621682873754"><span class="hs-identifier hs-var">new</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-44"></span><span>        </span><span class="hs-keyword">let</span><span> </span><span class="hs-glyph">!</span><span id="local-6989586621682873755"><span class="annot"><span class="annottext">join :: RegSet r
</span><a href="#local-6989586621682873755"><span class="hs-identifier hs-var hs-var">join</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">RegSet r -&gt; RegSet r -&gt; RegSet r
forall r. Ord r =&gt; RegSet r -&gt; RegSet r -&gt; RegSet r
</span><a href="GHC.Cmm.Expr.html#plusRegSet"><span class="hs-identifier hs-var">plusRegSet</span></a></span><span> </span><span class="annot"><span class="annottext">RegSet r
</span><a href="#local-6989586621682873752"><span class="hs-identifier hs-var">old</span></a></span><span> </span><span class="annot"><span class="annottext">RegSet r
</span><a href="#local-6989586621682873754"><span class="hs-identifier hs-var">new</span></a></span><span>
</span><span id="line-45"></span><span>        </span><span class="hs-keyword">in</span><span> </span><span class="annot"><span class="annottext">Bool -&gt; RegSet r -&gt; JoinedFact (RegSet r)
forall a. Bool -&gt; a -&gt; JoinedFact a
</span><a href="GHC.Cmm.Dataflow.html#changedIf"><span class="hs-identifier hs-var">changedIf</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">RegSet r -&gt; Int
forall r. RegSet r -&gt; Int
</span><a href="GHC.Cmm.Expr.html#sizeRegSet"><span class="hs-identifier hs-var">sizeRegSet</span></a></span><span> </span><span class="annot"><span class="annottext">RegSet r
</span><a href="#local-6989586621682873755"><span class="hs-identifier hs-var">join</span></a></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Bool
forall a. Ord a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">&gt;</span></span><span> </span><span class="annot"><span class="annottext">RegSet r -&gt; Int
forall r. RegSet r -&gt; Int
</span><a href="GHC.Cmm.Expr.html#sizeRegSet"><span class="hs-identifier hs-var">sizeRegSet</span></a></span><span> </span><span class="annot"><span class="annottext">RegSet r
</span><a href="#local-6989586621682873752"><span class="hs-identifier hs-var">old</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">RegSet r
</span><a href="#local-6989586621682873755"><span class="hs-identifier hs-var">join</span></a></span><span>
</span><span id="line-46"></span><span>
</span><span id="line-47"></span><span class="annot"><span class="hs-comment">-- | A mapping from block labels to the variables live on entry</span></span><span>
</span><span id="line-48"></span><span class="hs-keyword">type</span><span> </span><span id="BlockEntryLiveness"><span class="annot"><a href="GHC.Cmm.Liveness.html#BlockEntryLiveness"><span class="hs-identifier hs-var">BlockEntryLiveness</span></a></span></span><span> </span><span id="local-6989586621682873760"><span class="annot"><a href="#local-6989586621682873760"><span class="hs-identifier hs-type">r</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="GHC.Cmm.Dataflow.Label.html#LabelMap"><span class="hs-identifier hs-type">LabelMap</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Cmm.Liveness.html#CmmLive"><span class="hs-identifier hs-type">CmmLive</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682873760"><span class="hs-identifier hs-type">r</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-49"></span><span>
</span><span id="line-50"></span><span class="hs-comment">-----------------------------------------------------------------------------</span><span>
</span><span id="line-51"></span><span class="annot"><span class="hs-comment">-- | Calculated liveness info for a CmmGraph</span></span><span>
</span><span id="line-52"></span><span class="hs-comment">-----------------------------------------------------------------------------</span><span>
</span><span id="line-53"></span><span>
</span><span id="line-54"></span><span class="annot"><a href="GHC.Cmm.Liveness.html#cmmLocalLiveness"><span class="hs-identifier hs-type">cmmLocalLiveness</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Platform.html#Platform"><span class="hs-identifier hs-type">Platform</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Cmm.html#CmmGraph"><span class="hs-identifier hs-type">CmmGraph</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Cmm.Liveness.html#BlockEntryLiveness"><span class="hs-identifier hs-type">BlockEntryLiveness</span></a></span><span> </span><span class="annot"><a href="GHC.Cmm.Reg.html#LocalReg"><span class="hs-identifier hs-type">LocalReg</span></a></span><span>
</span><span id="line-55"></span><span id="cmmLocalLiveness"><span class="annot"><span class="annottext">cmmLocalLiveness :: Platform -&gt; CmmGraph -&gt; BlockEntryLiveness LocalReg
</span><a href="GHC.Cmm.Liveness.html#cmmLocalLiveness"><span class="hs-identifier hs-var hs-var">cmmLocalLiveness</span></a></span></span><span> </span><span id="local-6989586621682873761"><span class="annot"><span class="annottext">Platform
</span><a href="#local-6989586621682873761"><span class="hs-identifier hs-var">platform</span></a></span></span><span> </span><span id="local-6989586621682873762"><span class="annot"><span class="annottext">CmmGraph
</span><a href="#local-6989586621682873762"><span class="hs-identifier hs-var">graph</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-56"></span><span>    </span><span class="annot"><span class="annottext">BlockEntryLiveness LocalReg -&gt; BlockEntryLiveness LocalReg
</span><a href="#local-6989586621682873763"><span class="hs-identifier hs-var">check</span></a></span><span> </span><span class="annot"><span class="annottext">(BlockEntryLiveness LocalReg -&gt; BlockEntryLiveness LocalReg)
-&gt; BlockEntryLiveness LocalReg -&gt; BlockEntryLiveness LocalReg
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">DataflowLattice (CmmLive LocalReg)
-&gt; TransferFun' CmmNode (CmmLive LocalReg)
-&gt; CmmGraph
-&gt; BlockEntryLiveness LocalReg
-&gt; BlockEntryLiveness LocalReg
forall (node :: Extensibility -&gt; Extensibility -&gt; *) f.
NonLocal node =&gt;
DataflowLattice f
-&gt; TransferFun' node f
-&gt; GenCmmGraph node
-&gt; FactBase f
-&gt; FactBase f
</span><a href="GHC.Cmm.Dataflow.html#analyzeCmmBwd"><span class="hs-identifier hs-var">analyzeCmmBwd</span></a></span><span> </span><span class="annot"><span class="annottext">DataflowLattice (CmmLive LocalReg)
forall r. Ord r =&gt; DataflowLattice (CmmLive r)
</span><a href="GHC.Cmm.Liveness.html#liveLattice"><span class="hs-identifier hs-var">liveLattice</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Platform -&gt; TransferFun' CmmNode (CmmLive LocalReg)
forall r.
(UserOfRegs r (CmmNode O O), DefinerOfRegs r (CmmNode O O),
 UserOfRegs r (CmmNode O C), DefinerOfRegs r (CmmNode O C)) =&gt;
Platform -&gt; TransferFun (CmmLive r)
</span><a href="GHC.Cmm.Liveness.html#xferLive"><span class="hs-identifier hs-var">xferLive</span></a></span><span> </span><span class="annot"><span class="annottext">Platform
</span><a href="#local-6989586621682873761"><span class="hs-identifier hs-var">platform</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">CmmGraph
</span><a href="#local-6989586621682873762"><span class="hs-identifier hs-var">graph</span></a></span><span> </span><span class="annot"><span class="annottext">BlockEntryLiveness LocalReg
forall v. LabelMap v
</span><a href="GHC.Cmm.Dataflow.Label.html#mapEmpty"><span class="hs-identifier hs-var">mapEmpty</span></a></span><span>
</span><span id="line-57"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-58"></span><span>    </span><span id="local-6989586621682873767"><span class="annot"><span class="annottext">entry :: BlockId
</span><a href="#local-6989586621682873767"><span class="hs-identifier hs-var hs-var">entry</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">CmmGraph -&gt; BlockId
forall (s :: * -&gt; *) (n :: Extensibility -&gt; Extensibility -&gt; *).
GenGenCmmGraph s n -&gt; BlockId
</span><a href="GHC.Cmm.html#g_entry"><span class="hs-identifier hs-var">g_entry</span></a></span><span> </span><span class="annot"><span class="annottext">CmmGraph
</span><a href="#local-6989586621682873762"><span class="hs-identifier hs-var">graph</span></a></span><span>
</span><span id="line-59"></span><span>    </span><span id="local-6989586621682873763"><span class="annot"><span class="annottext">check :: BlockEntryLiveness LocalReg -&gt; BlockEntryLiveness LocalReg
</span><a href="#local-6989586621682873763"><span class="hs-identifier hs-var hs-var">check</span></a></span></span><span> </span><span id="local-6989586621682873769"><span class="annot"><span class="annottext">BlockEntryLiveness LocalReg
</span><a href="#local-6989586621682873769"><span class="hs-identifier hs-var">facts</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-60"></span><span>        </span><span class="annot"><span class="annottext">BlockId
-&gt; CmmLive LocalReg
-&gt; BlockEntryLiveness LocalReg
-&gt; BlockEntryLiveness LocalReg
forall a. BlockId -&gt; CmmLive LocalReg -&gt; a -&gt; a
</span><a href="GHC.Cmm.Liveness.html#noLiveOnEntry"><span class="hs-identifier hs-var">noLiveOnEntry</span></a></span><span> </span><span class="annot"><span class="annottext">BlockId
</span><a href="#local-6989586621682873767"><span class="hs-identifier hs-var">entry</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">String -&gt; Maybe (CmmLive LocalReg) -&gt; CmmLive LocalReg
forall a. HasDebugCallStack =&gt; String -&gt; Maybe a -&gt; a
</span><a href="GHC.Data.Maybe.html#expectJust"><span class="hs-identifier hs-var">expectJust</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;check&quot;</span></span><span> </span><span class="annot"><span class="annottext">(Maybe (CmmLive LocalReg) -&gt; CmmLive LocalReg)
-&gt; Maybe (CmmLive LocalReg) -&gt; CmmLive LocalReg
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">BlockId -&gt; BlockEntryLiveness LocalReg -&gt; Maybe (CmmLive LocalReg)
forall a. BlockId -&gt; LabelMap a -&gt; Maybe a
</span><a href="GHC.Cmm.Dataflow.Label.html#mapLookup"><span class="hs-identifier hs-var">mapLookup</span></a></span><span> </span><span class="annot"><span class="annottext">BlockId
</span><a href="#local-6989586621682873767"><span class="hs-identifier hs-var">entry</span></a></span><span> </span><span class="annot"><span class="annottext">BlockEntryLiveness LocalReg
</span><a href="#local-6989586621682873769"><span class="hs-identifier hs-var">facts</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">BlockEntryLiveness LocalReg
</span><a href="#local-6989586621682873769"><span class="hs-identifier hs-var">facts</span></a></span><span>
</span><span id="line-61"></span><span>
</span><span id="line-62"></span><span class="annot"><a href="GHC.Cmm.Liveness.html#cmmGlobalLiveness"><span class="hs-identifier hs-type">cmmGlobalLiveness</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Platform.html#Platform"><span class="hs-identifier hs-type">Platform</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Cmm.html#CmmGraph"><span class="hs-identifier hs-type">CmmGraph</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Cmm.Liveness.html#BlockEntryLiveness"><span class="hs-identifier hs-type">BlockEntryLiveness</span></a></span><span> </span><span class="annot"><a href="GHC.Cmm.Reg.html#GlobalRegUse"><span class="hs-identifier hs-type">GlobalRegUse</span></a></span><span>
</span><span id="line-63"></span><span id="cmmGlobalLiveness"><span class="annot"><span class="annottext">cmmGlobalLiveness :: Platform -&gt; CmmGraph -&gt; BlockEntryLiveness GlobalRegUse
</span><a href="GHC.Cmm.Liveness.html#cmmGlobalLiveness"><span class="hs-identifier hs-var hs-var">cmmGlobalLiveness</span></a></span></span><span> </span><span id="local-6989586621682873773"><span class="annot"><span class="annottext">Platform
</span><a href="#local-6989586621682873773"><span class="hs-identifier hs-var">platform</span></a></span></span><span> </span><span id="local-6989586621682873774"><span class="annot"><span class="annottext">CmmGraph
</span><a href="#local-6989586621682873774"><span class="hs-identifier hs-var">graph</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-64"></span><span>    </span><span class="annot"><span class="annottext">DataflowLattice (CmmLive GlobalRegUse)
-&gt; TransferFun' CmmNode (CmmLive GlobalRegUse)
-&gt; CmmGraph
-&gt; BlockEntryLiveness GlobalRegUse
-&gt; BlockEntryLiveness GlobalRegUse
forall (node :: Extensibility -&gt; Extensibility -&gt; *) f.
NonLocal node =&gt;
DataflowLattice f
-&gt; TransferFun' node f
-&gt; GenCmmGraph node
-&gt; FactBase f
-&gt; FactBase f
</span><a href="GHC.Cmm.Dataflow.html#analyzeCmmBwd"><span class="hs-identifier hs-var">analyzeCmmBwd</span></a></span><span> </span><span class="annot"><span class="annottext">DataflowLattice (CmmLive GlobalRegUse)
forall r. Ord r =&gt; DataflowLattice (CmmLive r)
</span><a href="GHC.Cmm.Liveness.html#liveLattice"><span class="hs-identifier hs-var">liveLattice</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Platform -&gt; TransferFun' CmmNode (CmmLive GlobalRegUse)
forall r.
(UserOfRegs r (CmmNode O O), DefinerOfRegs r (CmmNode O O),
 UserOfRegs r (CmmNode O C), DefinerOfRegs r (CmmNode O C)) =&gt;
Platform -&gt; TransferFun (CmmLive r)
</span><a href="GHC.Cmm.Liveness.html#xferLive"><span class="hs-identifier hs-var">xferLive</span></a></span><span> </span><span class="annot"><span class="annottext">Platform
</span><a href="#local-6989586621682873773"><span class="hs-identifier hs-var">platform</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">CmmGraph
</span><a href="#local-6989586621682873774"><span class="hs-identifier hs-var">graph</span></a></span><span> </span><span class="annot"><span class="annottext">BlockEntryLiveness GlobalRegUse
forall v. LabelMap v
</span><a href="GHC.Cmm.Dataflow.Label.html#mapEmpty"><span class="hs-identifier hs-var">mapEmpty</span></a></span><span>
</span><span id="line-65"></span><span>
</span><span id="line-66"></span><span class="hs-comment">-- | On entry to the procedure, there had better not be any LocalReg's live-in.</span><span>
</span><span id="line-67"></span><span class="hs-comment">-- If you see this error it most likely means you are trying to use a variable</span><span>
</span><span id="line-68"></span><span class="hs-comment">-- without it being defined in the given scope.</span><span>
</span><span id="line-69"></span><span id="local-6989586621682873643"><span class="annot"><a href="GHC.Cmm.Liveness.html#noLiveOnEntry"><span class="hs-identifier hs-type">noLiveOnEntry</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Cmm.BlockId.html#BlockId"><span class="hs-identifier hs-type">BlockId</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Cmm.Liveness.html#CmmLive"><span class="hs-identifier hs-type">CmmLive</span></a></span><span> </span><span class="annot"><a href="GHC.Cmm.Reg.html#LocalReg"><span class="hs-identifier hs-type">LocalReg</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621682873643"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621682873643"><span class="hs-identifier hs-type">a</span></a></span></span><span>
</span><span id="line-70"></span><span id="noLiveOnEntry"><span class="annot"><span class="annottext">noLiveOnEntry :: forall a. BlockId -&gt; CmmLive LocalReg -&gt; a -&gt; a
</span><a href="GHC.Cmm.Liveness.html#noLiveOnEntry"><span class="hs-identifier hs-var hs-var">noLiveOnEntry</span></a></span></span><span> </span><span id="local-6989586621682873785"><span class="annot"><span class="annottext">BlockId
</span><a href="#local-6989586621682873785"><span class="hs-identifier hs-var">bid</span></a></span></span><span> </span><span id="local-6989586621682873786"><span class="annot"><span class="annottext">CmmLive LocalReg
</span><a href="#local-6989586621682873786"><span class="hs-identifier hs-var">in_fact</span></a></span></span><span> </span><span id="local-6989586621682873787"><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621682873787"><span class="hs-identifier hs-var">x</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-71"></span><span>  </span><span class="hs-keyword">if</span><span> </span><span class="annot"><span class="annottext">CmmLive LocalReg -&gt; Bool
forall r. RegSet r -&gt; Bool
</span><a href="GHC.Cmm.Expr.html#nullRegSet"><span class="hs-identifier hs-var">nullRegSet</span></a></span><span> </span><span class="annot"><span class="annottext">CmmLive LocalReg
</span><a href="#local-6989586621682873786"><span class="hs-identifier hs-var">in_fact</span></a></span><span> </span><span class="hs-keyword">then</span><span> </span><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621682873787"><span class="hs-identifier hs-var">x</span></a></span><span>
</span><span id="line-72"></span><span>  </span><span class="hs-keyword">else</span><span> </span><span class="annot"><span class="annottext">String -&gt; SDoc -&gt; a
forall a. HasCallStack =&gt; String -&gt; SDoc -&gt; a
</span><a href="GHC.Utils.Panic.html#pprPanic"><span class="hs-identifier hs-var">pprPanic</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;LocalReg's live-in to graph&quot;</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">BlockId -&gt; SDoc
forall a. Outputable a =&gt; a -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="annot"><span class="annottext">BlockId
</span><a href="#local-6989586621682873785"><span class="hs-identifier hs-var">bid</span></a></span><span> </span><span class="annot"><span class="annottext">SDoc -&gt; SDoc -&gt; SDoc
forall doc. IsLine doc =&gt; doc -&gt; doc -&gt; doc
</span><a href="GHC.Utils.Outputable.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">CmmLive LocalReg -&gt; SDoc
forall a. Outputable a =&gt; a -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="annot"><span class="annottext">CmmLive LocalReg
</span><a href="#local-6989586621682873786"><span class="hs-identifier hs-var">in_fact</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-73"></span><span>
</span><span id="line-74"></span><span id="local-6989586621682873657"><span id="local-6989586621682873658"><span class="annot"><a href="GHC.Cmm.Liveness.html#gen_kill"><span class="hs-identifier hs-type">gen_kill</span></a></span><span>
</span><span id="line-75"></span><span>    </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Cmm.Expr.html#DefinerOfRegs"><span class="hs-identifier hs-type">DefinerOfRegs</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682873657"><span class="hs-identifier hs-type">r</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682873658"><span class="hs-identifier hs-type">n</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Cmm.Expr.html#UserOfRegs"><span class="hs-identifier hs-type">UserOfRegs</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682873657"><span class="hs-identifier hs-type">r</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682873658"><span class="hs-identifier hs-type">n</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-76"></span><span>    </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="GHC.Platform.html#Platform"><span class="hs-identifier hs-type">Platform</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621682873658"><span class="hs-identifier hs-type">n</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Cmm.Liveness.html#CmmLive"><span class="hs-identifier hs-type">CmmLive</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682873657"><span class="hs-identifier hs-type">r</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Cmm.Liveness.html#CmmLive"><span class="hs-identifier hs-type">CmmLive</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682873657"><span class="hs-identifier hs-type">r</span></a></span></span></span><span>
</span><span id="line-77"></span><span id="gen_kill"><span class="annot"><span class="annottext">gen_kill :: forall r n.
(DefinerOfRegs r n, UserOfRegs r n) =&gt;
Platform -&gt; n -&gt; CmmLive r -&gt; CmmLive r
</span><a href="GHC.Cmm.Liveness.html#gen_kill"><span class="hs-identifier hs-var hs-var">gen_kill</span></a></span></span><span> </span><span id="local-6989586621682873800"><span class="annot"><span class="annottext">Platform
</span><a href="#local-6989586621682873800"><span class="hs-identifier hs-var">platform</span></a></span></span><span> </span><span id="local-6989586621682873801"><span class="annot"><span class="annottext">n
</span><a href="#local-6989586621682873801"><span class="hs-identifier hs-var">node</span></a></span></span><span> </span><span id="local-6989586621682873802"><span class="annot"><span class="annottext">CmmLive r
</span><a href="#local-6989586621682873802"><span class="hs-identifier hs-var">set</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-78"></span><span>    </span><span class="hs-keyword">let</span><span> </span><span class="hs-glyph">!</span><span id="local-6989586621682873803"><span class="annot"><span class="annottext">afterKill :: CmmLive r
</span><a href="#local-6989586621682873803"><span class="hs-identifier hs-var hs-var">afterKill</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Platform
-&gt; (CmmLive r -&gt; r -&gt; CmmLive r) -&gt; CmmLive r -&gt; n -&gt; CmmLive r
forall b. Platform -&gt; (b -&gt; r -&gt; b) -&gt; b -&gt; n -&gt; b
forall r a b.
DefinerOfRegs r a =&gt;
Platform -&gt; (b -&gt; r -&gt; b) -&gt; b -&gt; a -&gt; b
</span><a href="GHC.Cmm.Expr.html#foldRegsDefd"><span class="hs-identifier hs-var">foldRegsDefd</span></a></span><span> </span><span class="annot"><span class="annottext">Platform
</span><a href="#local-6989586621682873800"><span class="hs-identifier hs-var">platform</span></a></span><span> </span><span class="annot"><span class="annottext">CmmLive r -&gt; r -&gt; CmmLive r
forall r. Ord r =&gt; RegSet r -&gt; r -&gt; RegSet r
</span><a href="GHC.Cmm.Expr.html#deleteFromRegSet"><span class="hs-identifier hs-var">deleteFromRegSet</span></a></span><span> </span><span class="annot"><span class="annottext">CmmLive r
</span><a href="#local-6989586621682873802"><span class="hs-identifier hs-var">set</span></a></span><span> </span><span class="annot"><span class="annottext">n
</span><a href="#local-6989586621682873801"><span class="hs-identifier hs-var">node</span></a></span><span>
</span><span id="line-79"></span><span>    </span><span class="hs-keyword">in</span><span> </span><span class="annot"><span class="annottext">Platform
-&gt; (CmmLive r -&gt; r -&gt; CmmLive r) -&gt; CmmLive r -&gt; n -&gt; CmmLive r
forall b. Platform -&gt; (b -&gt; r -&gt; b) -&gt; b -&gt; n -&gt; b
forall r a b.
UserOfRegs r a =&gt;
Platform -&gt; (b -&gt; r -&gt; b) -&gt; b -&gt; a -&gt; b
</span><a href="GHC.Cmm.Expr.html#foldRegsUsed"><span class="hs-identifier hs-var">foldRegsUsed</span></a></span><span> </span><span class="annot"><span class="annottext">Platform
</span><a href="#local-6989586621682873800"><span class="hs-identifier hs-var">platform</span></a></span><span> </span><span class="annot"><span class="annottext">CmmLive r -&gt; r -&gt; CmmLive r
forall r. Ord r =&gt; RegSet r -&gt; r -&gt; RegSet r
</span><a href="GHC.Cmm.Expr.html#extendRegSet"><span class="hs-identifier hs-var">extendRegSet</span></a></span><span> </span><span class="annot"><span class="annottext">CmmLive r
</span><a href="#local-6989586621682873803"><span class="hs-identifier hs-var">afterKill</span></a></span><span> </span><span class="annot"><span class="annottext">n
</span><a href="#local-6989586621682873801"><span class="hs-identifier hs-var">node</span></a></span><span>
</span><span id="line-80"></span><span class="hs-pragma">{-# INLINE</span><span> </span><span class="annot"><a href="GHC.Cmm.Liveness.html#gen_kill"><span class="hs-pragma hs-type">gen_kill</span></a></span><span> </span><span class="hs-pragma">#-}</span><span>
</span><span id="line-81"></span><span>
</span><span id="line-82"></span><span class="annot"><a href="GHC.Cmm.Liveness.html#xferLive"><span class="hs-identifier hs-type">xferLive</span></a></span><span>
</span><span id="line-83"></span><span>    </span><span class="hs-glyph">::</span><span> </span><span class="hs-keyword">forall</span><span> </span><span id="local-6989586621682873635"><span class="annot"><a href="#local-6989586621682873635"><span class="hs-identifier hs-type">r</span></a></span></span><span class="hs-operator">.</span><span>
</span><span id="line-84"></span><span>       </span><span class="hs-special">(</span><span> </span><span class="annot"><a href="GHC.Cmm.Expr.html#UserOfRegs"><span class="hs-identifier hs-type">UserOfRegs</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682873635"><span class="hs-identifier hs-type">r</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Cmm.Node.html#CmmNode"><span class="hs-identifier hs-type">CmmNode</span></a></span><span> </span><span class="annot"><a href="GHC.Cmm.Dataflow.Block.html#O"><span class="hs-identifier hs-type">O</span></a></span><span> </span><span class="annot"><a href="GHC.Cmm.Dataflow.Block.html#O"><span class="hs-identifier hs-type">O</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-85"></span><span>       </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Cmm.Expr.html#DefinerOfRegs"><span class="hs-identifier hs-type">DefinerOfRegs</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682873635"><span class="hs-identifier hs-type">r</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Cmm.Node.html#CmmNode"><span class="hs-identifier hs-type">CmmNode</span></a></span><span> </span><span class="annot"><a href="GHC.Cmm.Dataflow.Block.html#O"><span class="hs-identifier hs-type">O</span></a></span><span> </span><span class="annot"><a href="GHC.Cmm.Dataflow.Block.html#O"><span class="hs-identifier hs-type">O</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-86"></span><span>       </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Cmm.Expr.html#UserOfRegs"><span class="hs-identifier hs-type">UserOfRegs</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682873635"><span class="hs-identifier hs-type">r</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Cmm.Node.html#CmmNode"><span class="hs-identifier hs-type">CmmNode</span></a></span><span> </span><span class="annot"><a href="GHC.Cmm.Dataflow.Block.html#O"><span class="hs-identifier hs-type">O</span></a></span><span> </span><span class="annot"><a href="GHC.Cmm.Dataflow.Block.html#C"><span class="hs-identifier hs-type">C</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-87"></span><span>       </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Cmm.Expr.html#DefinerOfRegs"><span class="hs-identifier hs-type">DefinerOfRegs</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682873635"><span class="hs-identifier hs-type">r</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Cmm.Node.html#CmmNode"><span class="hs-identifier hs-type">CmmNode</span></a></span><span> </span><span class="annot"><a href="GHC.Cmm.Dataflow.Block.html#O"><span class="hs-identifier hs-type">O</span></a></span><span> </span><span class="annot"><a href="GHC.Cmm.Dataflow.Block.html#C"><span class="hs-identifier hs-type">C</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-88"></span><span>       </span><span class="hs-special">)</span><span>
</span><span id="line-89"></span><span>    </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="GHC.Platform.html#Platform"><span class="hs-identifier hs-type">Platform</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Cmm.Dataflow.html#TransferFun"><span class="hs-identifier hs-type">TransferFun</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Cmm.Liveness.html#CmmLive"><span class="hs-identifier hs-type">CmmLive</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682873635"><span class="hs-identifier hs-type">r</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-90"></span><span id="xferLive"><span class="annot"><span class="annottext">xferLive :: forall r.
(UserOfRegs r (CmmNode O O), DefinerOfRegs r (CmmNode O O),
 UserOfRegs r (CmmNode O C), DefinerOfRegs r (CmmNode O C)) =&gt;
Platform -&gt; TransferFun (CmmLive r)
</span><a href="GHC.Cmm.Liveness.html#xferLive"><span class="hs-identifier hs-var hs-var">xferLive</span></a></span></span><span> </span><span id="local-6989586621682873814"><span class="annot"><span class="annottext">Platform
</span><a href="#local-6989586621682873814"><span class="hs-identifier hs-var">platform</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Cmm.Dataflow.Block.html#BlockCC"><span class="hs-identifier hs-type">BlockCC</span></a></span><span> </span><span id="local-6989586621682873825"><span class="annot"><span class="annottext">CmmNode C O
</span><a href="#local-6989586621682873825"><span class="hs-identifier hs-var">eNode</span></a></span></span><span> </span><span id="local-6989586621682873826"><span class="annot"><span class="annottext">Block CmmNode O O
</span><a href="#local-6989586621682873826"><span class="hs-identifier hs-var">middle</span></a></span></span><span> </span><span id="local-6989586621682873827"><span class="annot"><span class="annottext">CmmNode O C
</span><a href="#local-6989586621682873827"><span class="hs-identifier hs-var">xNode</span></a></span></span><span class="hs-special">)</span><span> </span><span id="local-6989586621682873828"><span class="annot"><span class="annottext">FactBase (CmmLive r)
</span><a href="#local-6989586621682873828"><span class="hs-identifier hs-var">fBase</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-91"></span><span>    </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621682873829"><span class="annot"><span class="annottext">joined :: CmmLive r
</span><a href="#local-6989586621682873829"><span class="hs-identifier hs-var hs-var">joined</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Platform -&gt; CmmNode O C -&gt; CmmLive r -&gt; CmmLive r
forall r n.
(DefinerOfRegs r n, UserOfRegs r n) =&gt;
Platform -&gt; n -&gt; CmmLive r -&gt; CmmLive r
</span><a href="GHC.Cmm.Liveness.html#gen_kill"><span class="hs-identifier hs-var">gen_kill</span></a></span><span> </span><span class="annot"><span class="annottext">Platform
</span><a href="#local-6989586621682873814"><span class="hs-identifier hs-var">platform</span></a></span><span> </span><span class="annot"><span class="annottext">CmmNode O C
</span><a href="#local-6989586621682873827"><span class="hs-identifier hs-var">xNode</span></a></span><span> </span><span class="annot"><span class="annottext">(CmmLive r -&gt; CmmLive r) -&gt; CmmLive r -&gt; CmmLive r
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$!</span></span><span> </span><span class="annot"><span class="annottext">DataflowLattice (CmmLive r)
-&gt; CmmNode O C -&gt; FactBase (CmmLive r) -&gt; CmmLive r
forall (n :: Extensibility -&gt; Extensibility -&gt; *) f
       (e :: Extensibility).
NonLocal n =&gt;
DataflowLattice f -&gt; n e C -&gt; FactBase f -&gt; f
</span><a href="GHC.Cmm.Dataflow.html#joinOutFacts"><span class="hs-identifier hs-var">joinOutFacts</span></a></span><span> </span><span class="annot"><span class="annottext">DataflowLattice (CmmLive r)
forall r. Ord r =&gt; DataflowLattice (CmmLive r)
</span><a href="GHC.Cmm.Liveness.html#liveLattice"><span class="hs-identifier hs-var">liveLattice</span></a></span><span> </span><span class="annot"><span class="annottext">CmmNode O C
</span><a href="#local-6989586621682873827"><span class="hs-identifier hs-var">xNode</span></a></span><span> </span><span class="annot"><span class="annottext">FactBase (CmmLive r)
</span><a href="#local-6989586621682873828"><span class="hs-identifier hs-var">fBase</span></a></span><span>
</span><span id="line-92"></span><span>        </span><span class="hs-glyph">!</span><span id="local-6989586621682873832"><span class="annot"><span class="annottext">result :: CmmLive r
</span><a href="#local-6989586621682873832"><span class="hs-identifier hs-var hs-var">result</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(CmmNode O O -&gt; CmmLive r -&gt; CmmLive r)
-&gt; Block CmmNode O O -&gt; CmmLive r -&gt; CmmLive r
forall (node :: Extensibility -&gt; Extensibility -&gt; *) f.
(node O O -&gt; f -&gt; f) -&gt; Block node O O -&gt; f -&gt; f
</span><a href="GHC.Cmm.Dataflow.html#foldNodesBwdOO"><span class="hs-identifier hs-var">foldNodesBwdOO</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Platform -&gt; CmmNode O O -&gt; CmmLive r -&gt; CmmLive r
forall r n.
(DefinerOfRegs r n, UserOfRegs r n) =&gt;
Platform -&gt; n -&gt; CmmLive r -&gt; CmmLive r
</span><a href="GHC.Cmm.Liveness.html#gen_kill"><span class="hs-identifier hs-var">gen_kill</span></a></span><span> </span><span class="annot"><span class="annottext">Platform
</span><a href="#local-6989586621682873814"><span class="hs-identifier hs-var">platform</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Block CmmNode O O
</span><a href="#local-6989586621682873826"><span class="hs-identifier hs-var">middle</span></a></span><span> </span><span class="annot"><span class="annottext">CmmLive r
</span><a href="#local-6989586621682873829"><span class="hs-identifier hs-var">joined</span></a></span><span>
</span><span id="line-93"></span><span>    </span><span class="hs-keyword">in</span><span> </span><span class="annot"><span class="annottext">BlockId -&gt; CmmLive r -&gt; FactBase (CmmLive r)
forall v. BlockId -&gt; v -&gt; LabelMap v
</span><a href="GHC.Cmm.Dataflow.Label.html#mapSingleton"><span class="hs-identifier hs-var">mapSingleton</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">CmmNode C O -&gt; BlockId
forall (x :: Extensibility). CmmNode C x -&gt; BlockId
forall (thing :: Extensibility -&gt; Extensibility -&gt; *)
       (x :: Extensibility).
NonLocal thing =&gt;
thing C x -&gt; BlockId
</span><a href="GHC.Cmm.Dataflow.Graph.html#entryLabel"><span class="hs-identifier hs-var">entryLabel</span></a></span><span> </span><span class="annot"><span class="annottext">CmmNode C O
</span><a href="#local-6989586621682873825"><span class="hs-identifier hs-var">eNode</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">CmmLive r
</span><a href="#local-6989586621682873832"><span class="hs-identifier hs-var">result</span></a></span><span>
</span><span id="line-94"></span><span class="hs-pragma">{-# SPECIALIZE</span><span> </span><span class="annot"><a href="GHC.Cmm.Liveness.html#xferLive"><span class="hs-pragma hs-type">xferLive</span></a></span><span> </span><span class="hs-pragma">::</span><span> </span><span class="annot"><a href="GHC.Platform.html#Platform"><span class="hs-pragma hs-type">Platform</span></a></span><span> </span><span class="hs-pragma">-&gt;</span><span> </span><span class="annot"><a href="GHC.Cmm.Dataflow.html#TransferFun"><span class="hs-pragma hs-type">TransferFun</span></a></span><span> </span><span class="hs-pragma">(</span><span class="annot"><a href="GHC.Cmm.Liveness.html#CmmLive"><span class="hs-pragma hs-type">CmmLive</span></a></span><span> </span><span class="annot"><a href="GHC.Cmm.Reg.html#LocalReg"><span class="hs-pragma hs-type">LocalReg</span></a></span><span class="hs-pragma">)</span><span> </span><span class="hs-pragma">#-}</span><span>
</span><span id="line-95"></span><span class="hs-pragma">{-# SPECIALIZE</span><span> </span><span class="annot"><a href="GHC.Cmm.Liveness.html#xferLive"><span class="hs-pragma hs-type">xferLive</span></a></span><span> </span><span class="hs-pragma">::</span><span> </span><span class="annot"><a href="GHC.Platform.html#Platform"><span class="hs-pragma hs-type">Platform</span></a></span><span> </span><span class="hs-pragma">-&gt;</span><span> </span><span class="annot"><a href="GHC.Cmm.Dataflow.html#TransferFun"><span class="hs-pragma hs-type">TransferFun</span></a></span><span> </span><span class="hs-pragma">(</span><span class="annot"><a href="GHC.Cmm.Liveness.html#CmmLive"><span class="hs-pragma hs-type">CmmLive</span></a></span><span> </span><span class="annot"><a href="GHC.Cmm.Reg.html#GlobalRegUse"><span class="hs-pragma hs-type">GlobalRegUse</span></a></span><span class="hs-pragma">)</span><span> </span><span class="hs-pragma">#-}</span><span>
</span><span id="line-96"></span><span>
</span><span id="line-97"></span><span class="hs-comment">-----------------------------------------------------------------------------</span><span>
</span><span id="line-98"></span><span class="hs-comment">-- | Specialization that only retains the keys for local variables.</span><span>
</span><span id="line-99"></span><span class="hs-comment">--</span><span>
</span><span id="line-100"></span><span class="hs-comment">-- Local variables are mostly glorified Ints, and some parts of the compiler</span><span>
</span><span id="line-101"></span><span class="hs-comment">-- really don't care about anything but the Int part. So we can avoid some</span><span>
</span><span id="line-102"></span><span class="hs-comment">-- overhead by computing a IntSet instead of a Set LocalReg which (unsurprisingly)</span><span>
</span><span id="line-103"></span><span class="hs-comment">-- is quite a bit faster.</span><span>
</span><span id="line-104"></span><span class="hs-comment">-----------------------------------------------------------------------------</span><span>
</span><span id="line-105"></span><span>
</span><span id="line-106"></span><span class="hs-keyword">type</span><span> </span><span id="BlockEntryLivenessL"><span class="annot"><a href="GHC.Cmm.Liveness.html#BlockEntryLivenessL"><span class="hs-identifier hs-var">BlockEntryLivenessL</span></a></span></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="GHC.Cmm.Dataflow.Label.html#LabelMap"><span class="hs-identifier hs-type">LabelMap</span></a></span><span> </span><span class="annot"><a href="GHC.Cmm.LRegSet.html#LRegSet"><span class="hs-identifier hs-type">LRegSet</span></a></span><span>
</span><span id="line-107"></span><span>
</span><span id="line-108"></span><span class="annot"><span class="hs-comment">-- | The dataflow lattice</span></span><span>
</span><span id="line-109"></span><span class="annot"><a href="GHC.Cmm.Liveness.html#liveLatticeL"><span class="hs-identifier hs-type">liveLatticeL</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Cmm.Dataflow.html#DataflowLattice"><span class="hs-identifier hs-type">DataflowLattice</span></a></span><span> </span><span class="annot"><a href="GHC.Cmm.LRegSet.html#LRegSet"><span class="hs-identifier hs-type">LRegSet</span></a></span><span>
</span><span id="line-110"></span><span id="liveLatticeL"><span class="annot"><span class="annottext">liveLatticeL :: DataflowLattice LRegSet
</span><a href="GHC.Cmm.Liveness.html#liveLatticeL"><span class="hs-identifier hs-var hs-var">liveLatticeL</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">LRegSet -&gt; JoinFun LRegSet -&gt; DataflowLattice LRegSet
forall a. a -&gt; JoinFun a -&gt; DataflowLattice a
</span><a href="GHC.Cmm.Dataflow.html#DataflowLattice"><span class="hs-identifier hs-var">DataflowLattice</span></a></span><span> </span><span class="annot"><span class="annottext">LRegSet
</span><a href="GHC.Cmm.LRegSet.html#emptyLRegSet"><span class="hs-identifier hs-var">emptyLRegSet</span></a></span><span> </span><span class="annot"><span class="annottext">JoinFun LRegSet
</span><a href="#local-6989586621682873837"><span class="hs-identifier hs-var">add</span></a></span><span>
</span><span id="line-111"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-112"></span><span>    </span><span id="local-6989586621682873837"><span class="annot"><span class="annottext">add :: JoinFun LRegSet
</span><a href="#local-6989586621682873837"><span class="hs-identifier hs-var hs-var">add</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Cmm.Dataflow.html#OldFact"><span class="hs-identifier hs-type">OldFact</span></a></span><span> </span><span id="local-6989586621682873839"><span class="annot"><span class="annottext">LRegSet
</span><a href="#local-6989586621682873839"><span class="hs-identifier hs-var">old</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Cmm.Dataflow.html#NewFact"><span class="hs-identifier hs-type">NewFact</span></a></span><span> </span><span id="local-6989586621682873840"><span class="annot"><span class="annottext">LRegSet
</span><a href="#local-6989586621682873840"><span class="hs-identifier hs-var">new</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-113"></span><span>        </span><span class="hs-keyword">let</span><span> </span><span class="hs-glyph">!</span><span id="local-6989586621682873841"><span class="annot"><span class="annottext">join :: LRegSet
</span><a href="#local-6989586621682873841"><span class="hs-identifier hs-var hs-var">join</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">LRegSet -&gt; LRegSet -&gt; LRegSet
</span><a href="GHC.Cmm.LRegSet.html#unionLRegSet"><span class="hs-identifier hs-var">unionLRegSet</span></a></span><span> </span><span class="annot"><span class="annottext">LRegSet
</span><a href="#local-6989586621682873839"><span class="hs-identifier hs-var">old</span></a></span><span> </span><span class="annot"><span class="annottext">LRegSet
</span><a href="#local-6989586621682873840"><span class="hs-identifier hs-var">new</span></a></span><span>
</span><span id="line-114"></span><span>        </span><span class="hs-keyword">in</span><span> </span><span class="annot"><span class="annottext">Bool -&gt; LRegSet -&gt; JoinedFact LRegSet
forall a. Bool -&gt; a -&gt; JoinedFact a
</span><a href="GHC.Cmm.Dataflow.html#changedIf"><span class="hs-identifier hs-var">changedIf</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">LRegSet -&gt; Int
</span><a href="GHC.Cmm.LRegSet.html#sizeLRegSet"><span class="hs-identifier hs-var">sizeLRegSet</span></a></span><span> </span><span class="annot"><span class="annottext">LRegSet
</span><a href="#local-6989586621682873841"><span class="hs-identifier hs-var">join</span></a></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Bool
forall a. Ord a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">&gt;</span></span><span> </span><span class="annot"><span class="annottext">LRegSet -&gt; Int
</span><a href="GHC.Cmm.LRegSet.html#sizeLRegSet"><span class="hs-identifier hs-var">sizeLRegSet</span></a></span><span> </span><span class="annot"><span class="annottext">LRegSet
</span><a href="#local-6989586621682873839"><span class="hs-identifier hs-var">old</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">LRegSet
</span><a href="#local-6989586621682873841"><span class="hs-identifier hs-var">join</span></a></span><span>
</span><span id="line-115"></span><span>
</span><span id="line-116"></span><span>
</span><span id="line-117"></span><span class="annot"><a href="GHC.Cmm.Liveness.html#cmmLocalLivenessL"><span class="hs-identifier hs-type">cmmLocalLivenessL</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Platform.html#Platform"><span class="hs-identifier hs-type">Platform</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Cmm.html#CmmGraph"><span class="hs-identifier hs-type">CmmGraph</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Cmm.Liveness.html#BlockEntryLivenessL"><span class="hs-identifier hs-type">BlockEntryLivenessL</span></a></span><span>
</span><span id="line-118"></span><span id="cmmLocalLivenessL"><span class="annot"><span class="annottext">cmmLocalLivenessL :: Platform -&gt; CmmGraph -&gt; BlockEntryLivenessL
</span><a href="GHC.Cmm.Liveness.html#cmmLocalLivenessL"><span class="hs-identifier hs-var hs-var">cmmLocalLivenessL</span></a></span></span><span> </span><span id="local-6989586621682873844"><span class="annot"><span class="annottext">Platform
</span><a href="#local-6989586621682873844"><span class="hs-identifier hs-var">platform</span></a></span></span><span> </span><span id="local-6989586621682873845"><span class="annot"><span class="annottext">CmmGraph
</span><a href="#local-6989586621682873845"><span class="hs-identifier hs-var">graph</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-119"></span><span>    </span><span class="annot"><span class="annottext">BlockEntryLivenessL -&gt; BlockEntryLivenessL
</span><a href="#local-6989586621682873846"><span class="hs-identifier hs-var">check</span></a></span><span> </span><span class="annot"><span class="annottext">(BlockEntryLivenessL -&gt; BlockEntryLivenessL)
-&gt; BlockEntryLivenessL -&gt; BlockEntryLivenessL
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">DataflowLattice LRegSet
-&gt; TransferFun' CmmNode LRegSet
-&gt; CmmGraph
-&gt; BlockEntryLivenessL
-&gt; BlockEntryLivenessL
forall (node :: Extensibility -&gt; Extensibility -&gt; *) f.
NonLocal node =&gt;
DataflowLattice f
-&gt; TransferFun' node f
-&gt; GenCmmGraph node
-&gt; FactBase f
-&gt; FactBase f
</span><a href="GHC.Cmm.Dataflow.html#analyzeCmmBwd"><span class="hs-identifier hs-var">analyzeCmmBwd</span></a></span><span> </span><span class="annot"><span class="annottext">DataflowLattice LRegSet
</span><a href="GHC.Cmm.Liveness.html#liveLatticeL"><span class="hs-identifier hs-var">liveLatticeL</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Platform -&gt; TransferFun' CmmNode LRegSet
(UserOfRegs LocalReg (CmmNode O O),
 DefinerOfRegs LocalReg (CmmNode O O),
 UserOfRegs LocalReg (CmmNode O C),
 DefinerOfRegs LocalReg (CmmNode O C)) =&gt;
Platform -&gt; TransferFun' CmmNode LRegSet
</span><a href="GHC.Cmm.Liveness.html#xferLiveL"><span class="hs-identifier hs-var">xferLiveL</span></a></span><span> </span><span class="annot"><span class="annottext">Platform
</span><a href="#local-6989586621682873844"><span class="hs-identifier hs-var">platform</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">CmmGraph
</span><a href="#local-6989586621682873845"><span class="hs-identifier hs-var">graph</span></a></span><span> </span><span class="annot"><span class="annottext">BlockEntryLivenessL
forall v. LabelMap v
</span><a href="GHC.Cmm.Dataflow.Label.html#mapEmpty"><span class="hs-identifier hs-var">mapEmpty</span></a></span><span>
</span><span id="line-120"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-121"></span><span>    </span><span id="local-6989586621682873848"><span class="annot"><span class="annottext">entry :: BlockId
</span><a href="#local-6989586621682873848"><span class="hs-identifier hs-var hs-var">entry</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">CmmGraph -&gt; BlockId
forall (s :: * -&gt; *) (n :: Extensibility -&gt; Extensibility -&gt; *).
GenGenCmmGraph s n -&gt; BlockId
</span><a href="GHC.Cmm.html#g_entry"><span class="hs-identifier hs-var">g_entry</span></a></span><span> </span><span class="annot"><span class="annottext">CmmGraph
</span><a href="#local-6989586621682873845"><span class="hs-identifier hs-var">graph</span></a></span><span>
</span><span id="line-122"></span><span>    </span><span id="local-6989586621682873846"><span class="annot"><span class="annottext">check :: BlockEntryLivenessL -&gt; BlockEntryLivenessL
</span><a href="#local-6989586621682873846"><span class="hs-identifier hs-var hs-var">check</span></a></span></span><span> </span><span id="local-6989586621682873849"><span class="annot"><span class="annottext">BlockEntryLivenessL
</span><a href="#local-6989586621682873849"><span class="hs-identifier hs-var">facts</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-123"></span><span>        </span><span class="annot"><span class="annottext">BlockId -&gt; LRegSet -&gt; BlockEntryLivenessL -&gt; BlockEntryLivenessL
forall a. BlockId -&gt; LRegSet -&gt; a -&gt; a
</span><a href="GHC.Cmm.Liveness.html#noLiveOnEntryL"><span class="hs-identifier hs-var">noLiveOnEntryL</span></a></span><span> </span><span class="annot"><span class="annottext">BlockId
</span><a href="#local-6989586621682873848"><span class="hs-identifier hs-var">entry</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">String -&gt; Maybe LRegSet -&gt; LRegSet
forall a. HasDebugCallStack =&gt; String -&gt; Maybe a -&gt; a
</span><a href="GHC.Data.Maybe.html#expectJust"><span class="hs-identifier hs-var">expectJust</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;check&quot;</span></span><span> </span><span class="annot"><span class="annottext">(Maybe LRegSet -&gt; LRegSet) -&gt; Maybe LRegSet -&gt; LRegSet
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">BlockId -&gt; BlockEntryLivenessL -&gt; Maybe LRegSet
forall a. BlockId -&gt; LabelMap a -&gt; Maybe a
</span><a href="GHC.Cmm.Dataflow.Label.html#mapLookup"><span class="hs-identifier hs-var">mapLookup</span></a></span><span> </span><span class="annot"><span class="annottext">BlockId
</span><a href="#local-6989586621682873848"><span class="hs-identifier hs-var">entry</span></a></span><span> </span><span class="annot"><span class="annottext">BlockEntryLivenessL
</span><a href="#local-6989586621682873849"><span class="hs-identifier hs-var">facts</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">BlockEntryLivenessL
</span><a href="#local-6989586621682873849"><span class="hs-identifier hs-var">facts</span></a></span><span>
</span><span id="line-124"></span><span>
</span><span id="line-125"></span><span class="annot"><span class="hs-comment">-- | On entry to the procedure, there had better not be any LocalReg's live-in.</span></span><span>
</span><span id="line-126"></span><span id="local-6989586621682873683"><span class="annot"><a href="GHC.Cmm.Liveness.html#noLiveOnEntryL"><span class="hs-identifier hs-type">noLiveOnEntryL</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Cmm.BlockId.html#BlockId"><span class="hs-identifier hs-type">BlockId</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Cmm.LRegSet.html#LRegSet"><span class="hs-identifier hs-type">LRegSet</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621682873683"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621682873683"><span class="hs-identifier hs-type">a</span></a></span></span><span>
</span><span id="line-127"></span><span id="noLiveOnEntryL"><span class="annot"><span class="annottext">noLiveOnEntryL :: forall a. BlockId -&gt; LRegSet -&gt; a -&gt; a
</span><a href="GHC.Cmm.Liveness.html#noLiveOnEntryL"><span class="hs-identifier hs-var hs-var">noLiveOnEntryL</span></a></span></span><span> </span><span id="local-6989586621682873859"><span class="annot"><span class="annottext">BlockId
</span><a href="#local-6989586621682873859"><span class="hs-identifier hs-var">bid</span></a></span></span><span> </span><span id="local-6989586621682873860"><span class="annot"><span class="annottext">LRegSet
</span><a href="#local-6989586621682873860"><span class="hs-identifier hs-var">in_fact</span></a></span></span><span> </span><span id="local-6989586621682873861"><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621682873861"><span class="hs-identifier hs-var">x</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-128"></span><span>  </span><span class="hs-keyword">if</span><span> </span><span class="annot"><span class="annottext">LRegSet -&gt; Bool
</span><a href="GHC.Cmm.LRegSet.html#nullLRegSet"><span class="hs-identifier hs-var">nullLRegSet</span></a></span><span> </span><span class="annot"><span class="annottext">LRegSet
</span><a href="#local-6989586621682873860"><span class="hs-identifier hs-var">in_fact</span></a></span><span> </span><span class="hs-keyword">then</span><span> </span><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621682873861"><span class="hs-identifier hs-var">x</span></a></span><span>
</span><span id="line-129"></span><span>  </span><span class="hs-keyword">else</span><span> </span><span class="annot"><span class="annottext">String -&gt; SDoc -&gt; a
forall a. HasCallStack =&gt; String -&gt; SDoc -&gt; a
</span><a href="GHC.Utils.Panic.html#pprPanic"><span class="hs-identifier hs-var">pprPanic</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;LocalReg's live-in to graph&quot;</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">BlockId -&gt; SDoc
forall a. Outputable a =&gt; a -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="annot"><span class="annottext">BlockId
</span><a href="#local-6989586621682873859"><span class="hs-identifier hs-var">bid</span></a></span><span> </span><span class="annot"><span class="annottext">SDoc -&gt; SDoc -&gt; SDoc
forall doc. IsLine doc =&gt; doc -&gt; doc -&gt; doc
</span><a href="GHC.Utils.Outputable.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">[Unique] -&gt; SDoc
forall a. Outputable a =&gt; a -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="annot"><span class="annottext">[Unique]
</span><a href="#local-6989586621682873863"><span class="hs-identifier hs-var">reg_uniques</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-130"></span><span>    </span><span class="hs-keyword">where</span><span>
</span><span id="line-131"></span><span>        </span><span class="hs-comment">-- We convert the int's to uniques so that the printing matches that</span><span>
</span><span id="line-132"></span><span>        </span><span class="hs-comment">-- of registers.</span><span>
</span><span id="line-133"></span><span>        </span><span id="local-6989586621682873863"><span class="annot"><span class="annottext">reg_uniques :: [Unique]
</span><a href="#local-6989586621682873863"><span class="hs-identifier hs-var hs-var">reg_uniques</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">LRegSet -&gt; [Unique]
</span><a href="GHC.Cmm.LRegSet.html#elemsLRegSet"><span class="hs-identifier hs-var">elemsLRegSet</span></a></span><span> </span><span class="annot"><span class="annottext">LRegSet
</span><a href="#local-6989586621682873860"><span class="hs-identifier hs-var">in_fact</span></a></span><span>
</span><span id="line-134"></span><span>
</span><span id="line-135"></span><span>
</span><span id="line-136"></span><span>
</span><span id="line-137"></span><span>
</span><span id="line-138"></span><span id="local-6989586621682873687"><span class="annot"><a href="GHC.Cmm.Liveness.html#gen_killL"><span class="hs-identifier hs-type">gen_killL</span></a></span><span>
</span><span id="line-139"></span><span>    </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Cmm.Expr.html#DefinerOfRegs"><span class="hs-identifier hs-type">DefinerOfRegs</span></a></span><span> </span><span class="annot"><a href="GHC.Cmm.Reg.html#LocalReg"><span class="hs-identifier hs-type">LocalReg</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682873687"><span class="hs-identifier hs-type">n</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Cmm.Expr.html#UserOfRegs"><span class="hs-identifier hs-type">UserOfRegs</span></a></span><span> </span><span class="annot"><a href="GHC.Cmm.Reg.html#LocalReg"><span class="hs-identifier hs-type">LocalReg</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682873687"><span class="hs-identifier hs-type">n</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-140"></span><span>    </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="GHC.Platform.html#Platform"><span class="hs-identifier hs-type">Platform</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621682873687"><span class="hs-identifier hs-type">n</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Cmm.LRegSet.html#LRegSet"><span class="hs-identifier hs-type">LRegSet</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Cmm.LRegSet.html#LRegSet"><span class="hs-identifier hs-type">LRegSet</span></a></span></span><span>
</span><span id="line-141"></span><span id="gen_killL"><span class="annot"><span class="annottext">gen_killL :: forall n.
(DefinerOfRegs LocalReg n, UserOfRegs LocalReg n) =&gt;
Platform -&gt; n -&gt; LRegSet -&gt; LRegSet
</span><a href="GHC.Cmm.Liveness.html#gen_killL"><span class="hs-identifier hs-var hs-var">gen_killL</span></a></span></span><span> </span><span id="local-6989586621682873869"><span class="annot"><span class="annottext">Platform
</span><a href="#local-6989586621682873869"><span class="hs-identifier hs-var">platform</span></a></span></span><span> </span><span id="local-6989586621682873870"><span class="annot"><span class="annottext">n
</span><a href="#local-6989586621682873870"><span class="hs-identifier hs-var">node</span></a></span></span><span> </span><span id="local-6989586621682873871"><span class="annot"><span class="annottext">LRegSet
</span><a href="#local-6989586621682873871"><span class="hs-identifier hs-var">set</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-142"></span><span>    </span><span class="hs-keyword">let</span><span> </span><span class="hs-glyph">!</span><span id="local-6989586621682873872"><span class="annot"><span class="annottext">afterKill :: LRegSet
</span><a href="#local-6989586621682873872"><span class="hs-identifier hs-var hs-var">afterKill</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Platform
-&gt; (LRegSet -&gt; LocalReg -&gt; LRegSet) -&gt; LRegSet -&gt; n -&gt; LRegSet
forall b. Platform -&gt; (b -&gt; LocalReg -&gt; b) -&gt; b -&gt; n -&gt; b
forall r a b.
DefinerOfRegs r a =&gt;
Platform -&gt; (b -&gt; r -&gt; b) -&gt; b -&gt; a -&gt; b
</span><a href="GHC.Cmm.Expr.html#foldRegsDefd"><span class="hs-identifier hs-var">foldRegsDefd</span></a></span><span> </span><span class="annot"><span class="annottext">Platform
</span><a href="#local-6989586621682873869"><span class="hs-identifier hs-var">platform</span></a></span><span> </span><span class="annot"><span class="annottext">LRegSet -&gt; LocalReg -&gt; LRegSet
</span><a href="GHC.Cmm.LRegSet.html#deleteFromLRegSet"><span class="hs-identifier hs-var">deleteFromLRegSet</span></a></span><span> </span><span class="annot"><span class="annottext">LRegSet
</span><a href="#local-6989586621682873871"><span class="hs-identifier hs-var">set</span></a></span><span> </span><span class="annot"><span class="annottext">n
</span><a href="#local-6989586621682873870"><span class="hs-identifier hs-var">node</span></a></span><span>
</span><span id="line-143"></span><span>    </span><span class="hs-keyword">in</span><span> </span><span class="annot"><span class="annottext">Platform
-&gt; (LRegSet -&gt; LocalReg -&gt; LRegSet) -&gt; LRegSet -&gt; n -&gt; LRegSet
forall b. Platform -&gt; (b -&gt; LocalReg -&gt; b) -&gt; b -&gt; n -&gt; b
forall r a b.
UserOfRegs r a =&gt;
Platform -&gt; (b -&gt; r -&gt; b) -&gt; b -&gt; a -&gt; b
</span><a href="GHC.Cmm.Expr.html#foldRegsUsed"><span class="hs-identifier hs-var">foldRegsUsed</span></a></span><span> </span><span class="annot"><span class="annottext">Platform
</span><a href="#local-6989586621682873869"><span class="hs-identifier hs-var">platform</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(LocalReg -&gt; LRegSet -&gt; LRegSet) -&gt; LRegSet -&gt; LocalReg -&gt; LRegSet
forall a b c. (a -&gt; b -&gt; c) -&gt; b -&gt; a -&gt; c
</span><span class="hs-identifier hs-var">flip</span></span><span> </span><span class="annot"><span class="annottext">LocalReg -&gt; LRegSet -&gt; LRegSet
</span><a href="GHC.Cmm.LRegSet.html#insertLRegSet"><span class="hs-identifier hs-var">insertLRegSet</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">LRegSet
</span><a href="#local-6989586621682873872"><span class="hs-identifier hs-var">afterKill</span></a></span><span> </span><span class="annot"><span class="annottext">n
</span><a href="#local-6989586621682873870"><span class="hs-identifier hs-var">node</span></a></span><span>
</span><span id="line-144"></span><span class="hs-pragma">{-# INLINE</span><span> </span><span class="annot"><a href="GHC.Cmm.Liveness.html#gen_killL"><span class="hs-pragma hs-type">gen_killL</span></a></span><span> </span><span class="hs-pragma">#-}</span><span>
</span><span id="line-145"></span><span>
</span><span id="line-146"></span><span class="annot"><a href="GHC.Cmm.Liveness.html#xferLiveL"><span class="hs-identifier hs-type">xferLiveL</span></a></span><span>
</span><span id="line-147"></span><span>    </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span> </span><span class="annot"><a href="GHC.Cmm.Expr.html#UserOfRegs"><span class="hs-identifier hs-type">UserOfRegs</span></a></span><span> </span><span class="annot"><a href="GHC.Cmm.Reg.html#LocalReg"><span class="hs-identifier hs-type">LocalReg</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Cmm.Node.html#CmmNode"><span class="hs-identifier hs-type">CmmNode</span></a></span><span> </span><span class="annot"><a href="GHC.Cmm.Dataflow.Block.html#O"><span class="hs-identifier hs-type">O</span></a></span><span> </span><span class="annot"><a href="GHC.Cmm.Dataflow.Block.html#O"><span class="hs-identifier hs-type">O</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-148"></span><span>       </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Cmm.Expr.html#DefinerOfRegs"><span class="hs-identifier hs-type">DefinerOfRegs</span></a></span><span> </span><span class="annot"><a href="GHC.Cmm.Reg.html#LocalReg"><span class="hs-identifier hs-type">LocalReg</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Cmm.Node.html#CmmNode"><span class="hs-identifier hs-type">CmmNode</span></a></span><span> </span><span class="annot"><a href="GHC.Cmm.Dataflow.Block.html#O"><span class="hs-identifier hs-type">O</span></a></span><span> </span><span class="annot"><a href="GHC.Cmm.Dataflow.Block.html#O"><span class="hs-identifier hs-type">O</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-149"></span><span>       </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Cmm.Expr.html#UserOfRegs"><span class="hs-identifier hs-type">UserOfRegs</span></a></span><span> </span><span class="annot"><a href="GHC.Cmm.Reg.html#LocalReg"><span class="hs-identifier hs-type">LocalReg</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Cmm.Node.html#CmmNode"><span class="hs-identifier hs-type">CmmNode</span></a></span><span> </span><span class="annot"><a href="GHC.Cmm.Dataflow.Block.html#O"><span class="hs-identifier hs-type">O</span></a></span><span> </span><span class="annot"><a href="GHC.Cmm.Dataflow.Block.html#C"><span class="hs-identifier hs-type">C</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-150"></span><span>       </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Cmm.Expr.html#DefinerOfRegs"><span class="hs-identifier hs-type">DefinerOfRegs</span></a></span><span> </span><span class="annot"><a href="GHC.Cmm.Reg.html#LocalReg"><span class="hs-identifier hs-type">LocalReg</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Cmm.Node.html#CmmNode"><span class="hs-identifier hs-type">CmmNode</span></a></span><span> </span><span class="annot"><a href="GHC.Cmm.Dataflow.Block.html#O"><span class="hs-identifier hs-type">O</span></a></span><span> </span><span class="annot"><a href="GHC.Cmm.Dataflow.Block.html#C"><span class="hs-identifier hs-type">C</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-151"></span><span>       </span><span class="hs-special">)</span><span>
</span><span id="line-152"></span><span>    </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="GHC.Platform.html#Platform"><span class="hs-identifier hs-type">Platform</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Cmm.Dataflow.html#TransferFun"><span class="hs-identifier hs-type">TransferFun</span></a></span><span> </span><span class="annot"><a href="GHC.Cmm.LRegSet.html#LRegSet"><span class="hs-identifier hs-type">LRegSet</span></a></span><span>
</span><span id="line-153"></span><span id="xferLiveL"><span class="annot"><span class="annottext">xferLiveL :: (UserOfRegs LocalReg (CmmNode O O),
 DefinerOfRegs LocalReg (CmmNode O O),
 UserOfRegs LocalReg (CmmNode O C),
 DefinerOfRegs LocalReg (CmmNode O C)) =&gt;
Platform -&gt; TransferFun' CmmNode LRegSet
</span><a href="GHC.Cmm.Liveness.html#xferLiveL"><span class="hs-identifier hs-var hs-var">xferLiveL</span></a></span></span><span> </span><span id="local-6989586621682873880"><span class="annot"><span class="annottext">Platform
</span><a href="#local-6989586621682873880"><span class="hs-identifier hs-var">platform</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Cmm.Dataflow.Block.html#BlockCC"><span class="hs-identifier hs-type">BlockCC</span></a></span><span> </span><span id="local-6989586621682873889"><span class="annot"><span class="annottext">CmmNode C O
</span><a href="#local-6989586621682873889"><span class="hs-identifier hs-var">eNode</span></a></span></span><span> </span><span id="local-6989586621682873890"><span class="annot"><span class="annottext">Block CmmNode O O
</span><a href="#local-6989586621682873890"><span class="hs-identifier hs-var">middle</span></a></span></span><span> </span><span id="local-6989586621682873891"><span class="annot"><span class="annottext">CmmNode O C
</span><a href="#local-6989586621682873891"><span class="hs-identifier hs-var">xNode</span></a></span></span><span class="hs-special">)</span><span> </span><span id="local-6989586621682873892"><span class="annot"><span class="annottext">BlockEntryLivenessL
</span><a href="#local-6989586621682873892"><span class="hs-identifier hs-var">fBase</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-154"></span><span>    </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621682873893"><span class="annot"><span class="annottext">joined :: LRegSet
</span><a href="#local-6989586621682873893"><span class="hs-identifier hs-var hs-var">joined</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Platform -&gt; CmmNode O C -&gt; LRegSet -&gt; LRegSet
forall n.
(DefinerOfRegs LocalReg n, UserOfRegs LocalReg n) =&gt;
Platform -&gt; n -&gt; LRegSet -&gt; LRegSet
</span><a href="GHC.Cmm.Liveness.html#gen_killL"><span class="hs-identifier hs-var">gen_killL</span></a></span><span> </span><span class="annot"><span class="annottext">Platform
</span><a href="#local-6989586621682873880"><span class="hs-identifier hs-var">platform</span></a></span><span> </span><span class="annot"><span class="annottext">CmmNode O C
</span><a href="#local-6989586621682873891"><span class="hs-identifier hs-var">xNode</span></a></span><span> </span><span class="annot"><span class="annottext">(LRegSet -&gt; LRegSet) -&gt; LRegSet -&gt; LRegSet
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$!</span></span><span> </span><span class="annot"><span class="annottext">DataflowLattice LRegSet
-&gt; CmmNode O C -&gt; BlockEntryLivenessL -&gt; LRegSet
forall (n :: Extensibility -&gt; Extensibility -&gt; *) f
       (e :: Extensibility).
NonLocal n =&gt;
DataflowLattice f -&gt; n e C -&gt; FactBase f -&gt; f
</span><a href="GHC.Cmm.Dataflow.html#joinOutFacts"><span class="hs-identifier hs-var">joinOutFacts</span></a></span><span> </span><span class="annot"><span class="annottext">DataflowLattice LRegSet
</span><a href="GHC.Cmm.Liveness.html#liveLatticeL"><span class="hs-identifier hs-var">liveLatticeL</span></a></span><span> </span><span class="annot"><span class="annottext">CmmNode O C
</span><a href="#local-6989586621682873891"><span class="hs-identifier hs-var">xNode</span></a></span><span> </span><span class="annot"><span class="annottext">BlockEntryLivenessL
</span><a href="#local-6989586621682873892"><span class="hs-identifier hs-var">fBase</span></a></span><span>
</span><span id="line-155"></span><span>        </span><span class="hs-glyph">!</span><span id="local-6989586621682873894"><span class="annot"><span class="annottext">result :: LRegSet
</span><a href="#local-6989586621682873894"><span class="hs-identifier hs-var hs-var">result</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(CmmNode O O -&gt; LRegSet -&gt; LRegSet)
-&gt; Block CmmNode O O -&gt; LRegSet -&gt; LRegSet
forall (node :: Extensibility -&gt; Extensibility -&gt; *) f.
(node O O -&gt; f -&gt; f) -&gt; Block node O O -&gt; f -&gt; f
</span><a href="GHC.Cmm.Dataflow.html#foldNodesBwdOO"><span class="hs-identifier hs-var">foldNodesBwdOO</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Platform -&gt; CmmNode O O -&gt; LRegSet -&gt; LRegSet
forall n.
(DefinerOfRegs LocalReg n, UserOfRegs LocalReg n) =&gt;
Platform -&gt; n -&gt; LRegSet -&gt; LRegSet
</span><a href="GHC.Cmm.Liveness.html#gen_killL"><span class="hs-identifier hs-var">gen_killL</span></a></span><span> </span><span class="annot"><span class="annottext">Platform
</span><a href="#local-6989586621682873880"><span class="hs-identifier hs-var">platform</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Block CmmNode O O
</span><a href="#local-6989586621682873890"><span class="hs-identifier hs-var">middle</span></a></span><span> </span><span class="annot"><span class="annottext">LRegSet
</span><a href="#local-6989586621682873893"><span class="hs-identifier hs-var">joined</span></a></span><span>
</span><span id="line-156"></span><span>    </span><span class="hs-keyword">in</span><span> </span><span class="annot"><span class="annottext">BlockId -&gt; LRegSet -&gt; BlockEntryLivenessL
forall v. BlockId -&gt; v -&gt; LabelMap v
</span><a href="GHC.Cmm.Dataflow.Label.html#mapSingleton"><span class="hs-identifier hs-var">mapSingleton</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">CmmNode C O -&gt; BlockId
forall (x :: Extensibility). CmmNode C x -&gt; BlockId
forall (thing :: Extensibility -&gt; Extensibility -&gt; *)
       (x :: Extensibility).
NonLocal thing =&gt;
thing C x -&gt; BlockId
</span><a href="GHC.Cmm.Dataflow.Graph.html#entryLabel"><span class="hs-identifier hs-var">entryLabel</span></a></span><span> </span><span class="annot"><span class="annottext">CmmNode C O
</span><a href="#local-6989586621682873889"><span class="hs-identifier hs-var">eNode</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">LRegSet
</span><a href="#local-6989586621682873894"><span class="hs-identifier hs-var">result</span></a></span><span>
</span><span id="line-157"></span><span>
</span><span id="line-158"></span><span>
</span><span id="line-159"></span></pre></body></html>