<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><link rel="stylesheet" type="text/css" href="style.css" /><script type="text/javascript" src="highlight.js"></script></head><body><pre><span class="hs-pragma">{-# LANGUAGE DerivingStrategies #-}</span><span>
</span><span id="line-2"></span><span class="hs-pragma">{-# LANGUAGE GADTs #-}</span><span>
</span><span id="line-3"></span><span>
</span><span id="line-4"></span><span class="annot"><span class="hs-comment">-- | Utility types used within the constraint solver</span></span><span>
</span><span id="line-5"></span><span class="hs-keyword">module</span><span> </span><span class="annot"><a href="GHC.Tc.Solver.Types.html"><span class="hs-identifier">GHC.Tc.Solver.Types</span></a></span><span> </span><span class="hs-special">(</span><span>
</span><span id="line-6"></span><span>    </span><span class="hs-comment">-- Inert CDictCans</span><span>
</span><span id="line-7"></span><span>    </span><span class="annot"><a href="GHC.Tc.Solver.Types.html#DictMap"><span class="hs-identifier">DictMap</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Tc.Solver.Types.html#emptyDictMap"><span class="hs-identifier">emptyDictMap</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-8"></span><span>    </span><span class="annot"><a href="GHC.Tc.Solver.Types.html#findDictsByTyConKey"><span class="hs-identifier">findDictsByTyConKey</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Tc.Solver.Types.html#findDictsByClass"><span class="hs-identifier">findDictsByClass</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-9"></span><span>    </span><span class="annot"><a href="GHC.Tc.Solver.Types.html#foldDicts"><span class="hs-identifier">foldDicts</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Tc.Solver.Types.html#findDict"><span class="hs-identifier">findDict</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-10"></span><span>    </span><span class="annot"><a href="GHC.Tc.Solver.Types.html#dictsToBag"><span class="hs-identifier">dictsToBag</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-11"></span><span>
</span><span id="line-12"></span><span>    </span><span class="annot"><a href="GHC.Tc.Solver.Types.html#FunEqMap"><span class="hs-identifier">FunEqMap</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Tc.Solver.Types.html#emptyFunEqs"><span class="hs-identifier">emptyFunEqs</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Tc.Solver.Types.html#findFunEq"><span class="hs-identifier">findFunEq</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Tc.Solver.Types.html#insertFunEq"><span class="hs-identifier">insertFunEq</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-13"></span><span>    </span><span class="annot"><a href="GHC.Tc.Solver.Types.html#findFunEqsByTyCon"><span class="hs-identifier">findFunEqsByTyCon</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-14"></span><span>
</span><span id="line-15"></span><span>    </span><span class="annot"><a href="GHC.Tc.Solver.Types.html#TcAppMap"><span class="hs-identifier">TcAppMap</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Tc.Solver.Types.html#emptyTcAppMap"><span class="hs-identifier">emptyTcAppMap</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Tc.Solver.Types.html#isEmptyTcAppMap"><span class="hs-identifier">isEmptyTcAppMap</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-16"></span><span>    </span><span class="annot"><a href="GHC.Tc.Solver.Types.html#insertTcApp"><span class="hs-identifier">insertTcApp</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Tc.Solver.Types.html#alterTcApp"><span class="hs-identifier">alterTcApp</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Tc.Solver.Types.html#filterTcAppMap"><span class="hs-identifier">filterTcAppMap</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-17"></span><span>    </span><span class="annot"><a href="GHC.Tc.Solver.Types.html#tcAppMapToBag"><span class="hs-identifier">tcAppMapToBag</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Tc.Solver.Types.html#foldTcAppMap"><span class="hs-identifier">foldTcAppMap</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Tc.Solver.Types.html#delTcApp"><span class="hs-identifier">delTcApp</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-18"></span><span>
</span><span id="line-19"></span><span>    </span><span class="annot"><a href="GHC.Tc.Solver.Types.html#EqualCtList"><span class="hs-identifier">EqualCtList</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Tc.Solver.Types.html#filterEqualCtList"><span class="hs-identifier">filterEqualCtList</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Tc.Solver.Types.html#addToEqualCtList"><span class="hs-identifier">addToEqualCtList</span></a></span><span>
</span><span id="line-20"></span><span>
</span><span id="line-21"></span><span>  </span><span class="hs-special">)</span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-22"></span><span>
</span><span id="line-23"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Prelude.html"><span class="hs-identifier">GHC.Prelude</span></a></span><span>
</span><span id="line-24"></span><span>
</span><span id="line-25"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Tc.Types.Constraint.html"><span class="hs-identifier">GHC.Tc.Types.Constraint</span></a></span><span>
</span><span id="line-26"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Tc.Types.Origin.html"><span class="hs-identifier">GHC.Tc.Types.Origin</span></a></span><span>
</span><span id="line-27"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Tc.Types.CtLoc.html"><span class="hs-identifier">GHC.Tc.Types.CtLoc</span></a></span><span class="hs-special">(</span><span> </span><span class="annot"><a href="GHC.Tc.Types.CtLoc.html#CtLoc"><span class="hs-identifier">CtLoc</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Tc.Types.CtLoc.html#ctLocOrigin"><span class="hs-identifier">ctLocOrigin</span></a></span><span> </span><span class="hs-special">)</span><span>
</span><span id="line-28"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.TcType.html"><span class="hs-identifier">GHC.Tc.Utils.TcType</span></a></span><span>
</span><span id="line-29"></span><span>
</span><span id="line-30"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Types.Unique.html"><span class="hs-identifier">GHC.Types.Unique</span></a></span><span>
</span><span id="line-31"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Types.Unique.DFM.html"><span class="hs-identifier">GHC.Types.Unique.DFM</span></a></span><span>
</span><span id="line-32"></span><span>
</span><span id="line-33"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Core.Class.html"><span class="hs-identifier">GHC.Core.Class</span></a></span><span>
</span><span id="line-34"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Core.Map.Type.html"><span class="hs-identifier">GHC.Core.Map.Type</span></a></span><span>
</span><span id="line-35"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Core.Predicate.html"><span class="hs-identifier">GHC.Core.Predicate</span></a></span><span>
</span><span id="line-36"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Core.TyCon.html"><span class="hs-identifier">GHC.Core.TyCon</span></a></span><span>
</span><span id="line-37"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Core.TyCon.Env.html"><span class="hs-identifier">GHC.Core.TyCon.Env</span></a></span><span>
</span><span id="line-38"></span><span>
</span><span id="line-39"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Data.Bag.html"><span class="hs-identifier">GHC.Data.Bag</span></a></span><span>
</span><span id="line-40"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Data.Maybe.html"><span class="hs-identifier">GHC.Data.Maybe</span></a></span><span>
</span><span id="line-41"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Data.TrieMap.html"><span class="hs-identifier">GHC.Data.TrieMap</span></a></span><span>
</span><span id="line-42"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Utils.Constants.html"><span class="hs-identifier">GHC.Utils.Constants</span></a></span><span>
</span><span id="line-43"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Utils.Outputable.html"><span class="hs-identifier">GHC.Utils.Outputable</span></a></span><span>
</span><span id="line-44"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Utils.Panic.html"><span class="hs-identifier">GHC.Utils.Panic</span></a></span><span>
</span><span id="line-45"></span><span>
</span><span id="line-46"></span><span class="annot"><span class="hs-comment">{- *********************************************************************
*                                                                      *
                   TcAppMap
*                                                                      *
************************************************************************

Note [Use loose types in inert set]
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
Whenever we are looking up an inert dictionary (CDictCan) or function
equality (CEqCan), we use a TcAppMap, which uses the Unique of the
class/type family tycon and then a trie which maps the arguments. This
trie does *not* need to match the kinds of the arguments; this Note
explains why.

Consider the types ty0 = (T ty1 ty2 ty3 ty4) and ty0' = (T ty1' ty2' ty3' ty4'),
where ty4 and ty4' have different kinds. Let's further assume that both types
ty0 and ty0' are well-typed. Because the kind of T is closed, it must be that
one of the ty1..ty3 does not match ty1'..ty3' (and that the kind of the fourth
argument to T is dependent on whichever one changed). Since we are matching
all arguments, during the inert-set lookup, we know that ty1..ty3 do indeed
match ty1'..ty3'. Therefore, the kind of ty4 and ty4' must match, too --
without ever looking at it.

Accordingly, we use LooseTypeMap, which skips the kind check when looking
up a type. I (Richard E) believe this is just an optimization, and that
looking at kinds would be harmless.

-}</span></span><span>
</span><span id="line-74"></span><span>
</span><span id="line-75"></span><span class="hs-keyword">type</span><span> </span><span id="TcAppMap"><span class="annot"><a href="GHC.Tc.Solver.Types.html#TcAppMap"><span class="hs-identifier hs-var">TcAppMap</span></a></span></span><span> </span><span id="local-6989586621682724616"><span class="annot"><a href="#local-6989586621682724616"><span class="hs-identifier hs-type">a</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="GHC.Core.TyCon.Env.html#DTyConEnv"><span class="hs-identifier hs-type">DTyConEnv</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Data.TrieMap.html#ListMap"><span class="hs-identifier hs-type">ListMap</span></a></span><span> </span><span class="annot"><a href="GHC.Core.Map.Type.html#LooseTypeMap"><span class="hs-identifier hs-type">LooseTypeMap</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682724616"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-76"></span><span>    </span><span class="hs-comment">-- Indexed by tycon then the arg types, using &quot;loose&quot; matching, where</span><span>
</span><span id="line-77"></span><span>    </span><span class="hs-comment">-- we don't require kind equality. This allows, for example, (a |&gt; co)</span><span>
</span><span id="line-78"></span><span>    </span><span class="hs-comment">-- to match (a).</span><span>
</span><span id="line-79"></span><span>    </span><span class="hs-comment">-- See Note [Use loose types in inert set]</span><span>
</span><span id="line-80"></span><span>    </span><span class="hs-comment">-- Used for types and classes; hence UniqDFM</span><span>
</span><span id="line-81"></span><span>    </span><span class="hs-comment">-- See Note [foldTM determinism] in GHC.Data.TrieMap for why we use DTyConEnv here</span><span>
</span><span id="line-82"></span><span>
</span><span id="line-83"></span><span id="local-6989586621682724458"><span class="annot"><a href="GHC.Tc.Solver.Types.html#isEmptyTcAppMap"><span class="hs-identifier hs-type">isEmptyTcAppMap</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Tc.Solver.Types.html#TcAppMap"><span class="hs-identifier hs-type">TcAppMap</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682724458"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Bool</span></span></span><span>
</span><span id="line-84"></span><span id="isEmptyTcAppMap"><span class="annot"><span class="annottext">isEmptyTcAppMap :: forall a. TcAppMap a -&gt; Bool
</span><a href="GHC.Tc.Solver.Types.html#isEmptyTcAppMap"><span class="hs-identifier hs-var hs-var">isEmptyTcAppMap</span></a></span></span><span> </span><span id="local-6989586621682724617"><span class="annot"><span class="annottext">TcAppMap a
</span><a href="#local-6989586621682724617"><span class="hs-identifier hs-var">m</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">TcAppMap a -&gt; Bool
forall a. DTyConEnv a -&gt; Bool
</span><a href="GHC.Core.TyCon.Env.html#isEmptyDTyConEnv"><span class="hs-identifier hs-var">isEmptyDTyConEnv</span></a></span><span> </span><span class="annot"><span class="annottext">TcAppMap a
</span><a href="#local-6989586621682724617"><span class="hs-identifier hs-var">m</span></a></span><span>
</span><span id="line-85"></span><span>
</span><span id="line-86"></span><span id="local-6989586621682724463"><span class="annot"><a href="GHC.Tc.Solver.Types.html#emptyTcAppMap"><span class="hs-identifier hs-type">emptyTcAppMap</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Tc.Solver.Types.html#TcAppMap"><span class="hs-identifier hs-type">TcAppMap</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682724463"><span class="hs-identifier hs-type">a</span></a></span></span><span>
</span><span id="line-87"></span><span id="emptyTcAppMap"><span class="annot"><span class="annottext">emptyTcAppMap :: forall a. TcAppMap a
</span><a href="GHC.Tc.Solver.Types.html#emptyTcAppMap"><span class="hs-identifier hs-var hs-var">emptyTcAppMap</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">DTyConEnv (ListMap LooseTypeMap a)
forall a. DTyConEnv a
</span><a href="GHC.Core.TyCon.Env.html#emptyDTyConEnv"><span class="hs-identifier hs-var">emptyDTyConEnv</span></a></span><span>
</span><span id="line-88"></span><span>
</span><span id="line-89"></span><span id="local-6989586621682724468"><span class="annot"><a href="GHC.Tc.Solver.Types.html#findTcApp"><span class="hs-identifier hs-type">findTcApp</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Tc.Solver.Types.html#TcAppMap"><span class="hs-identifier hs-type">TcAppMap</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682724468"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Core.TyCon.html#TyCon"><span class="hs-identifier hs-type">TyCon</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#Type"><span class="hs-identifier hs-type">Type</span></a></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Maybe</span></span><span> </span><span class="annot"><a href="#local-6989586621682724468"><span class="hs-identifier hs-type">a</span></a></span></span><span>
</span><span id="line-90"></span><span id="findTcApp"><span class="annot"><span class="annottext">findTcApp :: forall a. TcAppMap a -&gt; TyCon -&gt; [Type] -&gt; Maybe a
</span><a href="GHC.Tc.Solver.Types.html#findTcApp"><span class="hs-identifier hs-var hs-var">findTcApp</span></a></span></span><span> </span><span id="local-6989586621682724627"><span class="annot"><span class="annottext">TcAppMap a
</span><a href="#local-6989586621682724627"><span class="hs-identifier hs-var">m</span></a></span></span><span> </span><span id="local-6989586621682724628"><span class="annot"><span class="annottext">TyCon
</span><a href="#local-6989586621682724628"><span class="hs-identifier hs-var">tc</span></a></span></span><span> </span><span id="local-6989586621682724629"><span class="annot"><span class="annottext">[Type]
</span><a href="#local-6989586621682724629"><span class="hs-identifier hs-var">tys</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span id="local-6989586621682724630"><span class="annot"><a href="#local-6989586621682724630"><span class="hs-identifier hs-var">tys_map</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">TcAppMap a -&gt; TyCon -&gt; Maybe (ListMap LooseTypeMap a)
forall a. DTyConEnv a -&gt; TyCon -&gt; Maybe a
</span><a href="GHC.Core.TyCon.Env.html#lookupDTyConEnv"><span class="hs-identifier hs-var">lookupDTyConEnv</span></a></span><span> </span><span class="annot"><span class="annottext">TcAppMap a
</span><a href="#local-6989586621682724627"><span class="hs-identifier hs-var">m</span></a></span><span> </span><span class="annot"><span class="annottext">TyCon
</span><a href="#local-6989586621682724628"><span class="hs-identifier hs-var">tc</span></a></span><span>
</span><span id="line-91"></span><span>                        </span><span class="hs-special">;</span><span> </span><span class="annot"><a href="GHC.Data.TrieMap.html#lookupTM"><span class="hs-identifier hs-type">lookupTM</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682724629"><span class="hs-identifier hs-type">tys</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682724630"><span class="hs-identifier hs-type">tys_map</span></a></span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-92"></span><span>
</span><span id="line-93"></span><span id="local-6989586621682724478"><span class="annot"><a href="GHC.Tc.Solver.Types.html#delTcApp"><span class="hs-identifier hs-type">delTcApp</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Tc.Solver.Types.html#TcAppMap"><span class="hs-identifier hs-type">TcAppMap</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682724478"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Core.TyCon.html#TyCon"><span class="hs-identifier hs-type">TyCon</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#Type"><span class="hs-identifier hs-type">Type</span></a></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Solver.Types.html#TcAppMap"><span class="hs-identifier hs-type">TcAppMap</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682724478"><span class="hs-identifier hs-type">a</span></a></span></span><span>
</span><span id="line-94"></span><span id="delTcApp"><span class="annot"><span class="annottext">delTcApp :: forall a. TcAppMap a -&gt; TyCon -&gt; [Type] -&gt; TcAppMap a
</span><a href="GHC.Tc.Solver.Types.html#delTcApp"><span class="hs-identifier hs-var hs-var">delTcApp</span></a></span></span><span> </span><span id="local-6989586621682724635"><span class="annot"><span class="annottext">TcAppMap a
</span><a href="#local-6989586621682724635"><span class="hs-identifier hs-var">m</span></a></span></span><span> </span><span id="local-6989586621682724636"><span class="annot"><span class="annottext">TyCon
</span><a href="#local-6989586621682724636"><span class="hs-identifier hs-var">tc</span></a></span></span><span> </span><span id="local-6989586621682724637"><span class="annot"><span class="annottext">[Type]
</span><a href="#local-6989586621682724637"><span class="hs-identifier hs-var">tys</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(ListMap LooseTypeMap a -&gt; ListMap LooseTypeMap a)
-&gt; TcAppMap a -&gt; TyCon -&gt; TcAppMap a
forall a. (a -&gt; a) -&gt; DTyConEnv a -&gt; TyCon -&gt; DTyConEnv a
</span><a href="GHC.Core.TyCon.Env.html#adjustDTyConEnv"><span class="hs-identifier hs-var">adjustDTyConEnv</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Key (ListMap LooseTypeMap)
-&gt; ListMap LooseTypeMap a -&gt; ListMap LooseTypeMap a
forall (m :: * -&gt; *) a. TrieMap m =&gt; Key m -&gt; m a -&gt; m a
</span><a href="GHC.Data.TrieMap.html#deleteTM"><span class="hs-identifier hs-var">deleteTM</span></a></span><span> </span><span class="annot"><span class="annottext">[Type]
Key (ListMap LooseTypeMap)
</span><a href="#local-6989586621682724637"><span class="hs-identifier hs-var">tys</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">TcAppMap a
</span><a href="#local-6989586621682724635"><span class="hs-identifier hs-var">m</span></a></span><span> </span><span class="annot"><span class="annottext">TyCon
</span><a href="#local-6989586621682724636"><span class="hs-identifier hs-var">tc</span></a></span><span>
</span><span id="line-95"></span><span>
</span><span id="line-96"></span><span id="local-6989586621682724483"><span class="annot"><a href="GHC.Tc.Solver.Types.html#insertTcApp"><span class="hs-identifier hs-type">insertTcApp</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Tc.Solver.Types.html#TcAppMap"><span class="hs-identifier hs-type">TcAppMap</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682724483"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Core.TyCon.html#TyCon"><span class="hs-identifier hs-type">TyCon</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#Type"><span class="hs-identifier hs-type">Type</span></a></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621682724483"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Solver.Types.html#TcAppMap"><span class="hs-identifier hs-type">TcAppMap</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682724483"><span class="hs-identifier hs-type">a</span></a></span></span><span>
</span><span id="line-97"></span><span id="insertTcApp"><span class="annot"><span class="annottext">insertTcApp :: forall a. TcAppMap a -&gt; TyCon -&gt; [Type] -&gt; a -&gt; TcAppMap a
</span><a href="GHC.Tc.Solver.Types.html#insertTcApp"><span class="hs-identifier hs-var hs-var">insertTcApp</span></a></span></span><span> </span><span id="local-6989586621682724643"><span class="annot"><span class="annottext">TcAppMap a
</span><a href="#local-6989586621682724643"><span class="hs-identifier hs-var">m</span></a></span></span><span> </span><span id="local-6989586621682724644"><span class="annot"><span class="annottext">TyCon
</span><a href="#local-6989586621682724644"><span class="hs-identifier hs-var">tc</span></a></span></span><span> </span><span id="local-6989586621682724645"><span class="annot"><span class="annottext">[Type]
</span><a href="#local-6989586621682724645"><span class="hs-identifier hs-var">tys</span></a></span></span><span> </span><span id="local-6989586621682724646"><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621682724646"><span class="hs-identifier hs-var">ct</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(Maybe (ListMap LooseTypeMap a) -&gt; Maybe (ListMap LooseTypeMap a))
-&gt; TcAppMap a -&gt; TyCon -&gt; TcAppMap a
forall a.
(Maybe a -&gt; Maybe a) -&gt; DTyConEnv a -&gt; TyCon -&gt; DTyConEnv a
</span><a href="GHC.Core.TyCon.Env.html#alterDTyConEnv"><span class="hs-identifier hs-var">alterDTyConEnv</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe (ListMap LooseTypeMap a) -&gt; Maybe (ListMap LooseTypeMap a)
</span><a href="#local-6989586621682724648"><span class="hs-identifier hs-var">alter_tm</span></a></span><span> </span><span class="annot"><span class="annottext">TcAppMap a
</span><a href="#local-6989586621682724643"><span class="hs-identifier hs-var">m</span></a></span><span> </span><span class="annot"><span class="annottext">TyCon
</span><a href="#local-6989586621682724644"><span class="hs-identifier hs-var">tc</span></a></span><span>
</span><span id="line-98"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-99"></span><span>    </span><span id="local-6989586621682724648"><span class="annot"><span class="annottext">alter_tm :: Maybe (ListMap LooseTypeMap a) -&gt; Maybe (ListMap LooseTypeMap a)
</span><a href="#local-6989586621682724648"><span class="hs-identifier hs-var hs-var">alter_tm</span></a></span></span><span> </span><span id="local-6989586621682724649"><span class="annot"><span class="annottext">Maybe (ListMap LooseTypeMap a)
</span><a href="#local-6989586621682724649"><span class="hs-identifier hs-var">mb_tm</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ListMap LooseTypeMap a -&gt; Maybe (ListMap LooseTypeMap a)
forall a. a -&gt; Maybe a
</span><span class="hs-identifier hs-var">Just</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Key (ListMap LooseTypeMap)
-&gt; a -&gt; ListMap LooseTypeMap a -&gt; ListMap LooseTypeMap a
forall (m :: * -&gt; *) a. TrieMap m =&gt; Key m -&gt; a -&gt; m a -&gt; m a
</span><a href="GHC.Data.TrieMap.html#insertTM"><span class="hs-identifier hs-var">insertTM</span></a></span><span> </span><span class="annot"><span class="annottext">[Type]
Key (ListMap LooseTypeMap)
</span><a href="#local-6989586621682724645"><span class="hs-identifier hs-var">tys</span></a></span><span> </span><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621682724646"><span class="hs-identifier hs-var">ct</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Maybe (ListMap LooseTypeMap a)
</span><a href="#local-6989586621682724649"><span class="hs-identifier hs-var">mb_tm</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe (ListMap LooseTypeMap a)
-&gt; ListMap LooseTypeMap a -&gt; ListMap LooseTypeMap a
forall a. Maybe a -&gt; a -&gt; a
</span><a href="GHC.Data.Maybe.html#orElse"><span class="hs-operator hs-var">`orElse`</span></a></span><span> </span><span class="annot"><span class="annottext">ListMap LooseTypeMap a
forall a. ListMap LooseTypeMap a
forall (m :: * -&gt; *) a. TrieMap m =&gt; m a
</span><a href="GHC.Data.TrieMap.html#emptyTM"><span class="hs-identifier hs-var">emptyTM</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-100"></span><span>
</span><span id="line-101"></span><span class="annot"><a href="GHC.Tc.Solver.Types.html#alterTcApp"><span class="hs-identifier hs-type">alterTcApp</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-keyword">forall</span><span> </span><span id="local-6989586621682724491"><span class="annot"><a href="#local-6989586621682724491"><span class="hs-identifier hs-type">a</span></a></span></span><span class="hs-operator">.</span><span> </span><span class="annot"><a href="GHC.Tc.Solver.Types.html#TcAppMap"><span class="hs-identifier hs-type">TcAppMap</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682724491"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Core.TyCon.html#TyCon"><span class="hs-identifier hs-type">TyCon</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#Type"><span class="hs-identifier hs-type">Type</span></a></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Data.TrieMap.html#XT"><span class="hs-identifier hs-type">XT</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682724491"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Solver.Types.html#TcAppMap"><span class="hs-identifier hs-type">TcAppMap</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682724491"><span class="hs-identifier hs-type">a</span></a></span><span>
</span><span id="line-102"></span><span id="alterTcApp"><span class="annot"><span class="annottext">alterTcApp :: forall a. TcAppMap a -&gt; TyCon -&gt; [Type] -&gt; XT a -&gt; TcAppMap a
</span><a href="GHC.Tc.Solver.Types.html#alterTcApp"><span class="hs-identifier hs-var hs-var">alterTcApp</span></a></span></span><span> </span><span id="local-6989586621682724656"><span class="annot"><span class="annottext">TcAppMap a
</span><a href="#local-6989586621682724656"><span class="hs-identifier hs-var">m</span></a></span></span><span> </span><span id="local-6989586621682724657"><span class="annot"><span class="annottext">TyCon
</span><a href="#local-6989586621682724657"><span class="hs-identifier hs-var">tc</span></a></span></span><span> </span><span id="local-6989586621682724658"><span class="annot"><span class="annottext">[Type]
</span><a href="#local-6989586621682724658"><span class="hs-identifier hs-var">tys</span></a></span></span><span> </span><span id="local-6989586621682724659"><span class="annot"><span class="annottext">XT a
</span><a href="#local-6989586621682724659"><span class="hs-identifier hs-var">upd</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(Maybe (ListMap LooseTypeMap a) -&gt; Maybe (ListMap LooseTypeMap a))
-&gt; TcAppMap a -&gt; TyCon -&gt; TcAppMap a
forall a.
(Maybe a -&gt; Maybe a) -&gt; DTyConEnv a -&gt; TyCon -&gt; DTyConEnv a
</span><a href="GHC.Core.TyCon.Env.html#alterDTyConEnv"><span class="hs-identifier hs-var">alterDTyConEnv</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe (ListMap LooseTypeMap a) -&gt; Maybe (ListMap LooseTypeMap a)
</span><a href="#local-6989586621682724660"><span class="hs-identifier hs-var">alter_tm</span></a></span><span> </span><span class="annot"><span class="annottext">TcAppMap a
</span><a href="#local-6989586621682724656"><span class="hs-identifier hs-var">m</span></a></span><span> </span><span class="annot"><span class="annottext">TyCon
</span><a href="#local-6989586621682724657"><span class="hs-identifier hs-var">tc</span></a></span><span>
</span><span id="line-103"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-104"></span><span>    </span><span class="annot"><a href="#local-6989586621682724660"><span class="hs-identifier hs-type">alter_tm</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Maybe</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Data.TrieMap.html#ListMap"><span class="hs-identifier hs-type">ListMap</span></a></span><span> </span><span class="annot"><a href="GHC.Core.Map.Type.html#LooseTypeMap"><span class="hs-identifier hs-type">LooseTypeMap</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682724491"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Maybe</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Data.TrieMap.html#ListMap"><span class="hs-identifier hs-type">ListMap</span></a></span><span> </span><span class="annot"><a href="GHC.Core.Map.Type.html#LooseTypeMap"><span class="hs-identifier hs-type">LooseTypeMap</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682724491"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-105"></span><span>    </span><span id="local-6989586621682724660"><span class="annot"><span class="annottext">alter_tm :: Maybe (ListMap LooseTypeMap a) -&gt; Maybe (ListMap LooseTypeMap a)
</span><a href="#local-6989586621682724660"><span class="hs-identifier hs-var hs-var">alter_tm</span></a></span></span><span> </span><span id="local-6989586621682724661"><span class="annot"><span class="annottext">Maybe (ListMap LooseTypeMap a)
</span><a href="#local-6989586621682724661"><span class="hs-identifier hs-var">m_elt</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ListMap LooseTypeMap a -&gt; Maybe (ListMap LooseTypeMap a)
forall a. a -&gt; Maybe a
</span><span class="hs-identifier hs-var">Just</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Key (ListMap LooseTypeMap)
-&gt; XT a -&gt; ListMap LooseTypeMap a -&gt; ListMap LooseTypeMap a
forall b.
Key (ListMap LooseTypeMap)
-&gt; XT b -&gt; ListMap LooseTypeMap b -&gt; ListMap LooseTypeMap b
forall (m :: * -&gt; *) b. TrieMap m =&gt; Key m -&gt; XT b -&gt; m b -&gt; m b
</span><a href="GHC.Data.TrieMap.html#alterTM"><span class="hs-identifier hs-var">alterTM</span></a></span><span> </span><span class="annot"><span class="annottext">[Type]
Key (ListMap LooseTypeMap)
</span><a href="#local-6989586621682724658"><span class="hs-identifier hs-var">tys</span></a></span><span> </span><span class="annot"><span class="annottext">XT a
</span><a href="#local-6989586621682724659"><span class="hs-identifier hs-var">upd</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Maybe (ListMap LooseTypeMap a)
</span><a href="#local-6989586621682724661"><span class="hs-identifier hs-var">m_elt</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe (ListMap LooseTypeMap a)
-&gt; ListMap LooseTypeMap a -&gt; ListMap LooseTypeMap a
forall a. Maybe a -&gt; a -&gt; a
</span><a href="GHC.Data.Maybe.html#orElse"><span class="hs-operator hs-var">`orElse`</span></a></span><span> </span><span class="annot"><span class="annottext">ListMap LooseTypeMap a
forall a. ListMap LooseTypeMap a
forall (m :: * -&gt; *) a. TrieMap m =&gt; m a
</span><a href="GHC.Data.TrieMap.html#emptyTM"><span class="hs-identifier hs-var">emptyTM</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-106"></span><span>
</span><span id="line-107"></span><span class="annot"><a href="GHC.Tc.Solver.Types.html#filterTcAppMap"><span class="hs-identifier hs-type">filterTcAppMap</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-keyword">forall</span><span> </span><span id="local-6989586621682724495"><span class="annot"><a href="#local-6989586621682724495"><span class="hs-identifier hs-type">a</span></a></span></span><span class="hs-operator">.</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621682724495"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Bool</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Solver.Types.html#TcAppMap"><span class="hs-identifier hs-type">TcAppMap</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682724495"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Solver.Types.html#TcAppMap"><span class="hs-identifier hs-type">TcAppMap</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682724495"><span class="hs-identifier hs-type">a</span></a></span><span>
</span><span id="line-108"></span><span id="filterTcAppMap"><span class="annot"><span class="annottext">filterTcAppMap :: forall a. (a -&gt; Bool) -&gt; TcAppMap a -&gt; TcAppMap a
</span><a href="GHC.Tc.Solver.Types.html#filterTcAppMap"><span class="hs-identifier hs-var hs-var">filterTcAppMap</span></a></span></span><span> </span><span id="local-6989586621682724666"><span class="annot"><span class="annottext">a -&gt; Bool
</span><a href="#local-6989586621682724666"><span class="hs-identifier hs-var">f</span></a></span></span><span> </span><span id="local-6989586621682724667"><span class="annot"><span class="annottext">TcAppMap a
</span><a href="#local-6989586621682724667"><span class="hs-identifier hs-var">m</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(ListMap LooseTypeMap a -&gt; Maybe (ListMap LooseTypeMap a))
-&gt; TcAppMap a -&gt; TcAppMap a
forall a b. (a -&gt; Maybe b) -&gt; DTyConEnv a -&gt; DTyConEnv b
</span><a href="GHC.Core.TyCon.Env.html#mapMaybeDTyConEnv"><span class="hs-identifier hs-var">mapMaybeDTyConEnv</span></a></span><span> </span><span class="annot"><span class="annottext">ListMap LooseTypeMap a -&gt; Maybe (ListMap LooseTypeMap a)
</span><a href="#local-6989586621682724669"><span class="hs-identifier hs-var">one_tycon</span></a></span><span> </span><span class="annot"><span class="annottext">TcAppMap a
</span><a href="#local-6989586621682724667"><span class="hs-identifier hs-var">m</span></a></span><span>
</span><span id="line-109"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-110"></span><span>    </span><span class="annot"><a href="#local-6989586621682724669"><span class="hs-identifier hs-type">one_tycon</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Data.TrieMap.html#ListMap"><span class="hs-identifier hs-type">ListMap</span></a></span><span> </span><span class="annot"><a href="GHC.Core.Map.Type.html#LooseTypeMap"><span class="hs-identifier hs-type">LooseTypeMap</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682724495"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Maybe</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Data.TrieMap.html#ListMap"><span class="hs-identifier hs-type">ListMap</span></a></span><span> </span><span class="annot"><a href="GHC.Core.Map.Type.html#LooseTypeMap"><span class="hs-identifier hs-type">LooseTypeMap</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682724495"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-111"></span><span>    </span><span id="local-6989586621682724669"><span class="annot"><span class="annottext">one_tycon :: ListMap LooseTypeMap a -&gt; Maybe (ListMap LooseTypeMap a)
</span><a href="#local-6989586621682724669"><span class="hs-identifier hs-var hs-var">one_tycon</span></a></span></span><span> </span><span id="local-6989586621682724670"><span class="annot"><span class="annottext">ListMap LooseTypeMap a
</span><a href="#local-6989586621682724670"><span class="hs-identifier hs-var">tm</span></a></span></span><span>
</span><span id="line-112"></span><span>      </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">ListMap LooseTypeMap a -&gt; Bool
forall (m :: * -&gt; *) a. TrieMap m =&gt; m a -&gt; Bool
</span><a href="GHC.Data.TrieMap.html#isEmptyTM"><span class="hs-identifier hs-var">isEmptyTM</span></a></span><span> </span><span class="annot"><span class="annottext">ListMap LooseTypeMap a
</span><a href="#local-6989586621682724672"><span class="hs-identifier hs-var">filtered_tm</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Maybe (ListMap LooseTypeMap a)
forall a. Maybe a
</span><span class="hs-identifier hs-var">Nothing</span></span><span>
</span><span id="line-113"></span><span>      </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">otherwise</span></span><span>             </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ListMap LooseTypeMap a -&gt; Maybe (ListMap LooseTypeMap a)
forall a. a -&gt; Maybe a
</span><span class="hs-identifier hs-var">Just</span></span><span> </span><span class="annot"><span class="annottext">ListMap LooseTypeMap a
</span><a href="#local-6989586621682724672"><span class="hs-identifier hs-var">filtered_tm</span></a></span><span>
</span><span id="line-114"></span><span>      </span><span class="hs-keyword">where</span><span>
</span><span id="line-115"></span><span>        </span><span id="local-6989586621682724672"><span class="annot"><span class="annottext">filtered_tm :: ListMap LooseTypeMap a
</span><a href="#local-6989586621682724672"><span class="hs-identifier hs-var hs-var">filtered_tm</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(a -&gt; Bool) -&gt; ListMap LooseTypeMap a -&gt; ListMap LooseTypeMap a
forall a.
(a -&gt; Bool) -&gt; ListMap LooseTypeMap a -&gt; ListMap LooseTypeMap a
forall (m :: * -&gt; *) a. TrieMap m =&gt; (a -&gt; Bool) -&gt; m a -&gt; m a
</span><a href="GHC.Data.TrieMap.html#filterTM"><span class="hs-identifier hs-var">filterTM</span></a></span><span> </span><span class="annot"><span class="annottext">a -&gt; Bool
</span><a href="#local-6989586621682724666"><span class="hs-identifier hs-var">f</span></a></span><span> </span><span class="annot"><span class="annottext">ListMap LooseTypeMap a
</span><a href="#local-6989586621682724670"><span class="hs-identifier hs-var">tm</span></a></span><span>
</span><span id="line-116"></span><span>
</span><span id="line-117"></span><span id="local-6989586621682724502"><span class="annot"><a href="GHC.Tc.Solver.Types.html#tcAppMapToBag"><span class="hs-identifier hs-type">tcAppMapToBag</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Tc.Solver.Types.html#TcAppMap"><span class="hs-identifier hs-type">TcAppMap</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682724502"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Data.Bag.html#Bag"><span class="hs-identifier hs-type">Bag</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682724502"><span class="hs-identifier hs-type">a</span></a></span></span><span>
</span><span id="line-118"></span><span id="tcAppMapToBag"><span class="annot"><span class="annottext">tcAppMapToBag :: forall a. TcAppMap a -&gt; Bag a
</span><a href="GHC.Tc.Solver.Types.html#tcAppMapToBag"><span class="hs-identifier hs-var hs-var">tcAppMapToBag</span></a></span></span><span> </span><span id="local-6989586621682724674"><span class="annot"><span class="annottext">TcAppMap a
</span><a href="#local-6989586621682724674"><span class="hs-identifier hs-var">m</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(a -&gt; Bag a -&gt; Bag a) -&gt; TcAppMap a -&gt; Bag a -&gt; Bag a
forall a b. (a -&gt; b -&gt; b) -&gt; TcAppMap a -&gt; b -&gt; b
</span><a href="GHC.Tc.Solver.Types.html#foldTcAppMap"><span class="hs-identifier hs-var">foldTcAppMap</span></a></span><span> </span><span class="annot"><span class="annottext">a -&gt; Bag a -&gt; Bag a
forall a. a -&gt; Bag a -&gt; Bag a
</span><a href="GHC.Data.Bag.html#consBag"><span class="hs-identifier hs-var">consBag</span></a></span><span> </span><span class="annot"><span class="annottext">TcAppMap a
</span><a href="#local-6989586621682724674"><span class="hs-identifier hs-var">m</span></a></span><span> </span><span class="annot"><span class="annottext">Bag a
forall a. Bag a
</span><a href="GHC.Data.Bag.html#emptyBag"><span class="hs-identifier hs-var">emptyBag</span></a></span><span>
</span><span id="line-119"></span><span>
</span><span id="line-120"></span><span id="local-6989586621682724505"><span id="local-6989586621682724506"><span class="annot"><a href="GHC.Tc.Solver.Types.html#foldTcAppMap"><span class="hs-identifier hs-type">foldTcAppMap</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621682724505"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621682724506"><span class="hs-identifier hs-type">b</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621682724506"><span class="hs-identifier hs-type">b</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Solver.Types.html#TcAppMap"><span class="hs-identifier hs-type">TcAppMap</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682724505"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621682724506"><span class="hs-identifier hs-type">b</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621682724506"><span class="hs-identifier hs-type">b</span></a></span></span></span><span>
</span><span id="line-121"></span><span id="foldTcAppMap"><span class="annot"><span class="annottext">foldTcAppMap :: forall a b. (a -&gt; b -&gt; b) -&gt; TcAppMap a -&gt; b -&gt; b
</span><a href="GHC.Tc.Solver.Types.html#foldTcAppMap"><span class="hs-identifier hs-var hs-var">foldTcAppMap</span></a></span></span><span> </span><span id="local-6989586621682724679"><span class="annot"><span class="annottext">a -&gt; b -&gt; b
</span><a href="#local-6989586621682724679"><span class="hs-identifier hs-var">k</span></a></span></span><span> </span><span id="local-6989586621682724680"><span class="annot"><span class="annottext">TcAppMap a
</span><a href="#local-6989586621682724680"><span class="hs-identifier hs-var">m</span></a></span></span><span> </span><span id="local-6989586621682724681"><span class="annot"><span class="annottext">b
</span><a href="#local-6989586621682724681"><span class="hs-identifier hs-var">z</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(ListMap LooseTypeMap a -&gt; b -&gt; b) -&gt; b -&gt; TcAppMap a -&gt; b
forall elt a. (elt -&gt; a -&gt; a) -&gt; a -&gt; DTyConEnv elt -&gt; a
</span><a href="GHC.Core.TyCon.Env.html#foldDTyConEnv"><span class="hs-identifier hs-var">foldDTyConEnv</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(a -&gt; b -&gt; b) -&gt; ListMap LooseTypeMap a -&gt; b -&gt; b
forall a b. (a -&gt; b -&gt; b) -&gt; ListMap LooseTypeMap a -&gt; b -&gt; b
forall (m :: * -&gt; *) a b.
TrieMap m =&gt;
(a -&gt; b -&gt; b) -&gt; m a -&gt; b -&gt; b
</span><a href="GHC.Data.TrieMap.html#foldTM"><span class="hs-identifier hs-var">foldTM</span></a></span><span> </span><span class="annot"><span class="annottext">a -&gt; b -&gt; b
</span><a href="#local-6989586621682724679"><span class="hs-identifier hs-var">k</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">b
</span><a href="#local-6989586621682724681"><span class="hs-identifier hs-var">z</span></a></span><span> </span><span class="annot"><span class="annottext">TcAppMap a
</span><a href="#local-6989586621682724680"><span class="hs-identifier hs-var">m</span></a></span><span>
</span><span id="line-122"></span><span>
</span><span id="line-123"></span><span class="annot"><span class="hs-comment">{- *********************************************************************
*                                                                      *
                   DictMap
*                                                                      *
********************************************************************* -}</span></span><span>
</span><span id="line-128"></span><span>
</span><span id="line-129"></span><span class="hs-keyword">type</span><span> </span><span id="DictMap"><span class="annot"><a href="GHC.Tc.Solver.Types.html#DictMap"><span class="hs-identifier hs-var">DictMap</span></a></span></span><span> </span><span id="local-6989586621682724684"><span class="annot"><a href="#local-6989586621682724684"><span class="hs-identifier hs-type">a</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="GHC.Tc.Solver.Types.html#TcAppMap"><span class="hs-identifier hs-type">TcAppMap</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682724684"><span class="hs-identifier hs-type">a</span></a></span><span>
</span><span id="line-130"></span><span>
</span><span id="line-131"></span><span id="local-6989586621682724685"><span class="annot"><a href="GHC.Tc.Solver.Types.html#emptyDictMap"><span class="hs-identifier hs-type">emptyDictMap</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Tc.Solver.Types.html#DictMap"><span class="hs-identifier hs-type">DictMap</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682724685"><span class="hs-identifier hs-type">a</span></a></span></span><span>
</span><span id="line-132"></span><span id="emptyDictMap"><span class="annot"><span class="annottext">emptyDictMap :: forall a. TcAppMap a
</span><a href="GHC.Tc.Solver.Types.html#emptyDictMap"><span class="hs-identifier hs-var hs-var">emptyDictMap</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">TcAppMap a
forall a. TcAppMap a
</span><a href="GHC.Tc.Solver.Types.html#emptyTcAppMap"><span class="hs-identifier hs-var">emptyTcAppMap</span></a></span><span>
</span><span id="line-133"></span><span>
</span><span id="line-134"></span><span id="local-6989586621682724516"><span class="annot"><a href="GHC.Tc.Solver.Types.html#findDict"><span class="hs-identifier hs-type">findDict</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Tc.Solver.Types.html#DictMap"><span class="hs-identifier hs-type">DictMap</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682724516"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.CtLoc.html#CtLoc"><span class="hs-identifier hs-type">CtLoc</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Core.Class.html#Class"><span class="hs-identifier hs-type">Class</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#Type"><span class="hs-identifier hs-type">Type</span></a></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Maybe</span></span><span> </span><span class="annot"><a href="#local-6989586621682724516"><span class="hs-identifier hs-type">a</span></a></span></span><span>
</span><span id="line-135"></span><span id="findDict"><span class="annot"><span class="annottext">findDict :: forall a. DictMap a -&gt; CtLoc -&gt; Class -&gt; [Type] -&gt; Maybe a
</span><a href="GHC.Tc.Solver.Types.html#findDict"><span class="hs-identifier hs-var hs-var">findDict</span></a></span></span><span> </span><span id="local-6989586621682724686"><span class="annot"><span class="annottext">DictMap a
</span><a href="#local-6989586621682724686"><span class="hs-identifier hs-var">m</span></a></span></span><span> </span><span id="local-6989586621682724687"><span class="annot"><span class="annottext">CtLoc
</span><a href="#local-6989586621682724687"><span class="hs-identifier hs-var">loc</span></a></span></span><span> </span><span id="local-6989586621682724688"><span class="annot"><span class="annottext">Class
</span><a href="#local-6989586621682724688"><span class="hs-identifier hs-var">cls</span></a></span></span><span> </span><span id="local-6989586621682724689"><span class="annot"><span class="annottext">[Type]
</span><a href="#local-6989586621682724689"><span class="hs-identifier hs-var">tys</span></a></span></span><span>
</span><span id="line-136"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span class="hs-special">{</span><span class="hs-special">}</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Class -&gt; [Type] -&gt; Maybe FastString
</span><a href="GHC.Core.Predicate.html#isCallStackPred"><span class="hs-identifier hs-var">isCallStackPred</span></a></span><span> </span><span class="annot"><span class="annottext">Class
</span><a href="#local-6989586621682724688"><span class="hs-identifier hs-var">cls</span></a></span><span> </span><span class="annot"><span class="annottext">[Type]
</span><a href="#local-6989586621682724689"><span class="hs-identifier hs-var">tys</span></a></span><span>
</span><span id="line-137"></span><span>  </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">CtOrigin -&gt; Bool
</span><a href="GHC.Tc.Types.Origin.html#isPushCallStackOrigin"><span class="hs-identifier hs-var">isPushCallStackOrigin</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">CtLoc -&gt; CtOrigin
</span><a href="GHC.Tc.Types.CtLoc.html#ctLocOrigin"><span class="hs-identifier hs-var">ctLocOrigin</span></a></span><span> </span><span class="annot"><span class="annottext">CtLoc
</span><a href="#local-6989586621682724687"><span class="hs-identifier hs-var">loc</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-138"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Maybe a
forall a. Maybe a
</span><span class="hs-identifier hs-var">Nothing</span></span><span>             </span><span class="hs-comment">-- See Note [Solving CallStack constraints]</span><span>
</span><span id="line-139"></span><span>
</span><span id="line-140"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">otherwise</span></span><span>
</span><span id="line-141"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">DictMap a -&gt; TyCon -&gt; [Type] -&gt; Maybe a
forall a. TcAppMap a -&gt; TyCon -&gt; [Type] -&gt; Maybe a
</span><a href="GHC.Tc.Solver.Types.html#findTcApp"><span class="hs-identifier hs-var">findTcApp</span></a></span><span> </span><span class="annot"><span class="annottext">DictMap a
</span><a href="#local-6989586621682724686"><span class="hs-identifier hs-var">m</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Class -&gt; TyCon
</span><a href="GHC.Core.Class.html#classTyCon"><span class="hs-identifier hs-var">classTyCon</span></a></span><span> </span><span class="annot"><span class="annottext">Class
</span><a href="#local-6989586621682724688"><span class="hs-identifier hs-var">cls</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[Type]
</span><a href="#local-6989586621682724689"><span class="hs-identifier hs-var">tys</span></a></span><span>
</span><span id="line-142"></span><span>
</span><span id="line-143"></span><span id="local-6989586621682724523"><span class="annot"><a href="GHC.Tc.Solver.Types.html#findDictsByClass"><span class="hs-identifier hs-type">findDictsByClass</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Tc.Solver.Types.html#DictMap"><span class="hs-identifier hs-type">DictMap</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682724523"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Core.Class.html#Class"><span class="hs-identifier hs-type">Class</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Data.Bag.html#Bag"><span class="hs-identifier hs-type">Bag</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682724523"><span class="hs-identifier hs-type">a</span></a></span></span><span>
</span><span id="line-144"></span><span id="findDictsByClass"><span class="annot"><span class="annottext">findDictsByClass :: forall a. DictMap a -&gt; Class -&gt; Bag a
</span><a href="GHC.Tc.Solver.Types.html#findDictsByClass"><span class="hs-identifier hs-var hs-var">findDictsByClass</span></a></span></span><span> </span><span id="local-6989586621682724695"><span class="annot"><span class="annottext">DictMap a
</span><a href="#local-6989586621682724695"><span class="hs-identifier hs-var">m</span></a></span></span><span> </span><span id="local-6989586621682724696"><span class="annot"><span class="annottext">Class
</span><a href="#local-6989586621682724696"><span class="hs-identifier hs-var">cls</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">DictMap a -&gt; Unique -&gt; Bag a
forall a. DictMap a -&gt; Unique -&gt; Bag a
</span><a href="GHC.Tc.Solver.Types.html#findDictsByTyConKey"><span class="hs-identifier hs-var">findDictsByTyConKey</span></a></span><span> </span><span class="annot"><span class="annottext">DictMap a
</span><a href="#local-6989586621682724695"><span class="hs-identifier hs-var">m</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TyCon -&gt; Unique
forall a. Uniquable a =&gt; a -&gt; Unique
</span><a href="GHC.Types.Unique.html#getUnique"><span class="hs-identifier hs-var">getUnique</span></a></span><span> </span><span class="annot"><span class="annottext">(TyCon -&gt; Unique) -&gt; TyCon -&gt; Unique
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Class -&gt; TyCon
</span><a href="GHC.Core.Class.html#classTyCon"><span class="hs-identifier hs-var">classTyCon</span></a></span><span> </span><span class="annot"><span class="annottext">Class
</span><a href="#local-6989586621682724696"><span class="hs-identifier hs-var">cls</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-145"></span><span>
</span><span id="line-146"></span><span id="local-6989586621682724527"><span class="annot"><a href="GHC.Tc.Solver.Types.html#findDictsByTyConKey"><span class="hs-identifier hs-type">findDictsByTyConKey</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Tc.Solver.Types.html#DictMap"><span class="hs-identifier hs-type">DictMap</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682724527"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Types.Unique.html#Unique"><span class="hs-identifier hs-type">Unique</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Data.Bag.html#Bag"><span class="hs-identifier hs-type">Bag</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682724527"><span class="hs-identifier hs-type">a</span></a></span></span><span>
</span><span id="line-147"></span><span id="findDictsByTyConKey"><span class="annot"><span class="annottext">findDictsByTyConKey :: forall a. DictMap a -&gt; Unique -&gt; Bag a
</span><a href="GHC.Tc.Solver.Types.html#findDictsByTyConKey"><span class="hs-identifier hs-var hs-var">findDictsByTyConKey</span></a></span></span><span> </span><span id="local-6989586621682724700"><span class="annot"><span class="annottext">DictMap a
</span><a href="#local-6989586621682724700"><span class="hs-identifier hs-var">m</span></a></span></span><span> </span><span id="local-6989586621682724701"><span class="annot"><span class="annottext">Unique
</span><a href="#local-6989586621682724701"><span class="hs-identifier hs-var">tc</span></a></span></span><span>
</span><span id="line-148"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span id="local-6989586621682724702"><span class="annot"><span class="annottext">ListMap LooseTypeMap a
</span><a href="#local-6989586621682724702"><span class="hs-identifier hs-var">tm</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">DictMap a -&gt; Unique -&gt; Maybe (ListMap LooseTypeMap a)
forall {k} (key :: k) elt. UniqDFM key elt -&gt; Unique -&gt; Maybe elt
</span><a href="GHC.Types.Unique.DFM.html#lookupUDFM_Directly"><span class="hs-identifier hs-var">lookupUDFM_Directly</span></a></span><span> </span><span class="annot"><span class="annottext">DictMap a
</span><a href="#local-6989586621682724700"><span class="hs-identifier hs-var">m</span></a></span><span> </span><span class="annot"><span class="annottext">Unique
</span><a href="#local-6989586621682724701"><span class="hs-identifier hs-var">tc</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(a -&gt; Bag a -&gt; Bag a) -&gt; ListMap LooseTypeMap a -&gt; Bag a -&gt; Bag a
forall a b. (a -&gt; b -&gt; b) -&gt; ListMap LooseTypeMap a -&gt; b -&gt; b
forall (m :: * -&gt; *) a b.
TrieMap m =&gt;
(a -&gt; b -&gt; b) -&gt; m a -&gt; b -&gt; b
</span><a href="GHC.Data.TrieMap.html#foldTM"><span class="hs-identifier hs-var">foldTM</span></a></span><span> </span><span class="annot"><span class="annottext">a -&gt; Bag a -&gt; Bag a
forall a. a -&gt; Bag a -&gt; Bag a
</span><a href="GHC.Data.Bag.html#consBag"><span class="hs-identifier hs-var">consBag</span></a></span><span> </span><span class="annot"><span class="annottext">ListMap LooseTypeMap a
</span><a href="#local-6989586621682724702"><span class="hs-identifier hs-var">tm</span></a></span><span> </span><span class="annot"><span class="annottext">Bag a
forall a. Bag a
</span><a href="GHC.Data.Bag.html#emptyBag"><span class="hs-identifier hs-var">emptyBag</span></a></span><span>
</span><span id="line-149"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">otherwise</span></span><span>                           </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Bag a
forall a. Bag a
</span><a href="GHC.Data.Bag.html#emptyBag"><span class="hs-identifier hs-var">emptyBag</span></a></span><span>
</span><span id="line-150"></span><span>
</span><span id="line-151"></span><span id="local-6989586621682724704"><span class="annot"><a href="GHC.Tc.Solver.Types.html#dictsToBag"><span class="hs-identifier hs-type">dictsToBag</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Tc.Solver.Types.html#DictMap"><span class="hs-identifier hs-type">DictMap</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682724704"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Data.Bag.html#Bag"><span class="hs-identifier hs-type">Bag</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682724704"><span class="hs-identifier hs-type">a</span></a></span></span><span>
</span><span id="line-152"></span><span id="dictsToBag"><span class="annot"><span class="annottext">dictsToBag :: forall a. TcAppMap a -&gt; Bag a
</span><a href="GHC.Tc.Solver.Types.html#dictsToBag"><span class="hs-identifier hs-var hs-var">dictsToBag</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">TcAppMap a -&gt; Bag a
forall a. TcAppMap a -&gt; Bag a
</span><a href="GHC.Tc.Solver.Types.html#tcAppMapToBag"><span class="hs-identifier hs-var">tcAppMapToBag</span></a></span><span>
</span><span id="line-153"></span><span>
</span><span id="line-154"></span><span id="local-6989586621682724705"><span id="local-6989586621682724706"><span class="annot"><a href="GHC.Tc.Solver.Types.html#foldDicts"><span class="hs-identifier hs-type">foldDicts</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621682724705"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621682724706"><span class="hs-identifier hs-type">b</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621682724706"><span class="hs-identifier hs-type">b</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Solver.Types.html#DictMap"><span class="hs-identifier hs-type">DictMap</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682724705"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621682724706"><span class="hs-identifier hs-type">b</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621682724706"><span class="hs-identifier hs-type">b</span></a></span></span></span><span>
</span><span id="line-155"></span><span id="foldDicts"><span class="annot"><span class="annottext">foldDicts :: forall a b. (a -&gt; b -&gt; b) -&gt; TcAppMap a -&gt; b -&gt; b
</span><a href="GHC.Tc.Solver.Types.html#foldDicts"><span class="hs-identifier hs-var hs-var">foldDicts</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(a -&gt; b -&gt; b) -&gt; TcAppMap a -&gt; b -&gt; b
forall a b. (a -&gt; b -&gt; b) -&gt; TcAppMap a -&gt; b -&gt; b
</span><a href="GHC.Tc.Solver.Types.html#foldTcAppMap"><span class="hs-identifier hs-var">foldTcAppMap</span></a></span><span>
</span><span id="line-156"></span><span>
</span><span id="line-157"></span><span class="hs-comment">{- Note [Solving CallStack constraints]
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
See also Note [Overview of implicit CallStacks] in GHc.Tc.Types.Evidence.

Suppose f :: HasCallStack =&gt; blah.  Then

* Each call to 'f' gives rise to
    [W] s1 :: IP &quot;callStack&quot; CallStack    -- CtOrigin = OccurrenceOf f
  with a CtOrigin that says &quot;OccurrenceOf f&quot;.
  Remember that HasCallStack is just shorthand for
    IP &quot;callStack&quot; CallStack
  See Note [Overview of implicit CallStacks] in GHC.Tc.Types.Evidence

* We cannonicalise such constraints, in GHC.Tc.Solver.Dict.canDictNC, by
  pushing the call-site info on the stack, and changing the CtOrigin
  to record that has been done.
   Bind:  s1 = pushCallStack &lt;site-info&gt; s2
   [W] s2 :: IP &quot;callStack&quot; CallStack   -- CtOrigin = IPOccOrigin

* Then, and only then, we can solve the constraint from an enclosing
  Given.

So we must be careful /not/ to solve 's1' from the Givens.  Again,
we ensure this by arranging that findDict always misses when looking
up such constraints.
-}</span><span>
</span><span id="line-183"></span><span>
</span><span id="line-184"></span><span class="annot"><span class="hs-comment">{- *********************************************************************
*                                                                      *
                   FunEqMap
*                                                                      *
********************************************************************* -}</span></span><span>
</span><span id="line-189"></span><span>
</span><span id="line-190"></span><span class="hs-keyword">type</span><span> </span><span id="FunEqMap"><span class="annot"><a href="GHC.Tc.Solver.Types.html#FunEqMap"><span class="hs-identifier hs-var">FunEqMap</span></a></span></span><span> </span><span id="local-6989586621682724707"><span class="annot"><a href="#local-6989586621682724707"><span class="hs-identifier hs-type">a</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="GHC.Tc.Solver.Types.html#TcAppMap"><span class="hs-identifier hs-type">TcAppMap</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682724707"><span class="hs-identifier hs-type">a</span></a></span><span>  </span><span class="hs-comment">-- A map whose key is a (TyCon, [Type]) pair</span><span>
</span><span id="line-191"></span><span>
</span><span id="line-192"></span><span id="local-6989586621682724708"><span class="annot"><a href="GHC.Tc.Solver.Types.html#emptyFunEqs"><span class="hs-identifier hs-type">emptyFunEqs</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Tc.Solver.Types.html#TcAppMap"><span class="hs-identifier hs-type">TcAppMap</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682724708"><span class="hs-identifier hs-type">a</span></a></span></span><span>
</span><span id="line-193"></span><span id="emptyFunEqs"><span class="annot"><span class="annottext">emptyFunEqs :: forall a. TcAppMap a
</span><a href="GHC.Tc.Solver.Types.html#emptyFunEqs"><span class="hs-identifier hs-var hs-var">emptyFunEqs</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">TcAppMap a
forall a. TcAppMap a
</span><a href="GHC.Tc.Solver.Types.html#emptyTcAppMap"><span class="hs-identifier hs-var">emptyTcAppMap</span></a></span><span>
</span><span id="line-194"></span><span>
</span><span id="line-195"></span><span id="local-6989586621682724709"><span class="annot"><a href="GHC.Tc.Solver.Types.html#findFunEq"><span class="hs-identifier hs-type">findFunEq</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Tc.Solver.Types.html#FunEqMap"><span class="hs-identifier hs-type">FunEqMap</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682724709"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Core.TyCon.html#TyCon"><span class="hs-identifier hs-type">TyCon</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#Type"><span class="hs-identifier hs-type">Type</span></a></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Maybe</span></span><span> </span><span class="annot"><a href="#local-6989586621682724709"><span class="hs-identifier hs-type">a</span></a></span></span><span>
</span><span id="line-196"></span><span id="findFunEq"><span class="annot"><span class="annottext">findFunEq :: forall a. TcAppMap a -&gt; TyCon -&gt; [Type] -&gt; Maybe a
</span><a href="GHC.Tc.Solver.Types.html#findFunEq"><span class="hs-identifier hs-var hs-var">findFunEq</span></a></span></span><span> </span><span id="local-6989586621682724710"><span class="annot"><span class="annottext">FunEqMap a
</span><a href="#local-6989586621682724710"><span class="hs-identifier hs-var">m</span></a></span></span><span> </span><span id="local-6989586621682724711"><span class="annot"><span class="annottext">TyCon
</span><a href="#local-6989586621682724711"><span class="hs-identifier hs-var">tc</span></a></span></span><span> </span><span id="local-6989586621682724712"><span class="annot"><span class="annottext">[Type]
</span><a href="#local-6989586621682724712"><span class="hs-identifier hs-var">tys</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">FunEqMap a -&gt; TyCon -&gt; [Type] -&gt; Maybe a
forall a. TcAppMap a -&gt; TyCon -&gt; [Type] -&gt; Maybe a
</span><a href="GHC.Tc.Solver.Types.html#findTcApp"><span class="hs-identifier hs-var">findTcApp</span></a></span><span> </span><span class="annot"><span class="annottext">FunEqMap a
</span><a href="#local-6989586621682724710"><span class="hs-identifier hs-var">m</span></a></span><span> </span><span class="annot"><span class="annottext">TyCon
</span><a href="#local-6989586621682724711"><span class="hs-identifier hs-var">tc</span></a></span><span> </span><span class="annot"><span class="annottext">[Type]
</span><a href="#local-6989586621682724712"><span class="hs-identifier hs-var">tys</span></a></span><span>
</span><span id="line-197"></span><span>
</span><span id="line-198"></span><span id="local-6989586621682724544"><span class="annot"><a href="GHC.Tc.Solver.Types.html#findFunEqsByTyCon"><span class="hs-identifier hs-type">findFunEqsByTyCon</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Tc.Solver.Types.html#FunEqMap"><span class="hs-identifier hs-type">FunEqMap</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682724544"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Core.TyCon.html#TyCon"><span class="hs-identifier hs-type">TyCon</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="#local-6989586621682724544"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">]</span></span><span>
</span><span id="line-199"></span><span class="hs-comment">-- Get inert function equation constraints that have the given tycon</span><span>
</span><span id="line-200"></span><span class="hs-comment">-- in their head.  Not that the constraints remain in the inert set.</span><span>
</span><span id="line-201"></span><span class="hs-comment">-- We use this to check for wanted interactions with built-in type-function</span><span>
</span><span id="line-202"></span><span class="hs-comment">-- constructors.</span><span>
</span><span id="line-203"></span><span id="findFunEqsByTyCon"><span class="annot"><span class="annottext">findFunEqsByTyCon :: forall a. FunEqMap a -&gt; TyCon -&gt; [a]
</span><a href="GHC.Tc.Solver.Types.html#findFunEqsByTyCon"><span class="hs-identifier hs-var hs-var">findFunEqsByTyCon</span></a></span></span><span> </span><span id="local-6989586621682724715"><span class="annot"><span class="annottext">FunEqMap a
</span><a href="#local-6989586621682724715"><span class="hs-identifier hs-var">m</span></a></span></span><span> </span><span id="local-6989586621682724716"><span class="annot"><span class="annottext">TyCon
</span><a href="#local-6989586621682724716"><span class="hs-identifier hs-var">tc</span></a></span></span><span>
</span><span id="line-204"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span id="local-6989586621682724717"><span class="annot"><span class="annottext">ListMap LooseTypeMap a
</span><a href="#local-6989586621682724717"><span class="hs-identifier hs-var">tm</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">FunEqMap a -&gt; TyCon -&gt; Maybe (ListMap LooseTypeMap a)
forall a. DTyConEnv a -&gt; TyCon -&gt; Maybe a
</span><a href="GHC.Core.TyCon.Env.html#lookupDTyConEnv"><span class="hs-identifier hs-var">lookupDTyConEnv</span></a></span><span> </span><span class="annot"><span class="annottext">FunEqMap a
</span><a href="#local-6989586621682724715"><span class="hs-identifier hs-var">m</span></a></span><span> </span><span class="annot"><span class="annottext">TyCon
</span><a href="#local-6989586621682724716"><span class="hs-identifier hs-var">tc</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(a -&gt; [a] -&gt; [a]) -&gt; ListMap LooseTypeMap a -&gt; [a] -&gt; [a]
forall a b. (a -&gt; b -&gt; b) -&gt; ListMap LooseTypeMap a -&gt; b -&gt; b
forall (m :: * -&gt; *) a b.
TrieMap m =&gt;
(a -&gt; b -&gt; b) -&gt; m a -&gt; b -&gt; b
</span><a href="GHC.Data.TrieMap.html#foldTM"><span class="hs-identifier hs-var">foldTM</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">:</span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">ListMap LooseTypeMap a
</span><a href="#local-6989586621682724717"><span class="hs-identifier hs-var">tm</span></a></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span>
</span><span id="line-205"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">otherwise</span></span><span>                       </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span>
</span><span id="line-206"></span><span>
</span><span id="line-207"></span><span id="local-6989586621682724718"><span class="annot"><a href="GHC.Tc.Solver.Types.html#insertFunEq"><span class="hs-identifier hs-type">insertFunEq</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Tc.Solver.Types.html#FunEqMap"><span class="hs-identifier hs-type">FunEqMap</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682724718"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Core.TyCon.html#TyCon"><span class="hs-identifier hs-type">TyCon</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#Type"><span class="hs-identifier hs-type">Type</span></a></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621682724718"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Solver.Types.html#FunEqMap"><span class="hs-identifier hs-type">FunEqMap</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682724718"><span class="hs-identifier hs-type">a</span></a></span></span><span>
</span><span id="line-208"></span><span id="insertFunEq"><span class="annot"><span class="annottext">insertFunEq :: forall a. TcAppMap a -&gt; TyCon -&gt; [Type] -&gt; a -&gt; TcAppMap a
</span><a href="GHC.Tc.Solver.Types.html#insertFunEq"><span class="hs-identifier hs-var hs-var">insertFunEq</span></a></span></span><span> </span><span id="local-6989586621682724719"><span class="annot"><span class="annottext">FunEqMap a
</span><a href="#local-6989586621682724719"><span class="hs-identifier hs-var">m</span></a></span></span><span> </span><span id="local-6989586621682724720"><span class="annot"><span class="annottext">TyCon
</span><a href="#local-6989586621682724720"><span class="hs-identifier hs-var">tc</span></a></span></span><span> </span><span id="local-6989586621682724721"><span class="annot"><span class="annottext">[Type]
</span><a href="#local-6989586621682724721"><span class="hs-identifier hs-var">tys</span></a></span></span><span> </span><span id="local-6989586621682724722"><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621682724722"><span class="hs-identifier hs-var">val</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">FunEqMap a -&gt; TyCon -&gt; [Type] -&gt; a -&gt; FunEqMap a
forall a. TcAppMap a -&gt; TyCon -&gt; [Type] -&gt; a -&gt; TcAppMap a
</span><a href="GHC.Tc.Solver.Types.html#insertTcApp"><span class="hs-identifier hs-var">insertTcApp</span></a></span><span> </span><span class="annot"><span class="annottext">FunEqMap a
</span><a href="#local-6989586621682724719"><span class="hs-identifier hs-var">m</span></a></span><span> </span><span class="annot"><span class="annottext">TyCon
</span><a href="#local-6989586621682724720"><span class="hs-identifier hs-var">tc</span></a></span><span> </span><span class="annot"><span class="annottext">[Type]
</span><a href="#local-6989586621682724721"><span class="hs-identifier hs-var">tys</span></a></span><span> </span><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621682724722"><span class="hs-identifier hs-var">val</span></a></span><span>
</span><span id="line-209"></span><span>
</span><span id="line-210"></span><span>
</span><span id="line-211"></span><span class="annot"><span class="hs-comment">{- *********************************************************************
*                                                                      *
                   EqualCtList
*                                                                      *
********************************************************************* -}</span></span><span>
</span><span id="line-216"></span><span>
</span><span id="line-217"></span><span class="hs-comment">{-
Note [EqualCtList invariants]
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
    * All are equalities
    * All these equalities have the same LHS
    * No element of the list can rewrite any other

Accordingly, this list is either empty, contains one element, or
contains a Given representational equality and a Wanted nominal one.
-}</span><span>
</span><span id="line-227"></span><span>
</span><span id="line-228"></span><span class="hs-keyword">type</span><span> </span><span id="EqualCtList"><span class="annot"><a href="GHC.Tc.Solver.Types.html#EqualCtList"><span class="hs-identifier hs-var">EqualCtList</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="GHC.Tc.Types.Constraint.html#EqCt"><span class="hs-identifier hs-type">EqCt</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-229"></span><span>  </span><span class="hs-comment">-- See Note [EqualCtList invariants]</span><span>
</span><span id="line-230"></span><span>
</span><span id="line-231"></span><span class="annot"><a href="GHC.Tc.Solver.Types.html#addToEqualCtList"><span class="hs-identifier hs-type">addToEqualCtList</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Tc.Types.Constraint.html#EqCt"><span class="hs-identifier hs-type">EqCt</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Solver.Types.html#EqualCtList"><span class="hs-identifier hs-type">EqualCtList</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Solver.Types.html#EqualCtList"><span class="hs-identifier hs-type">EqualCtList</span></a></span><span>
</span><span id="line-232"></span><span class="hs-comment">-- See Note [EqualCtList invariants]</span><span>
</span><span id="line-233"></span><span id="addToEqualCtList"><span class="annot"><span class="annottext">addToEqualCtList :: EqCt -&gt; [EqCt] -&gt; [EqCt]
</span><a href="GHC.Tc.Solver.Types.html#addToEqualCtList"><span class="hs-identifier hs-var hs-var">addToEqualCtList</span></a></span></span><span> </span><span id="local-6989586621682724723"><span class="annot"><span class="annottext">EqCt
</span><a href="#local-6989586621682724723"><span class="hs-identifier hs-var">ct</span></a></span></span><span> </span><span id="local-6989586621682724724"><span class="annot"><span class="annottext">[EqCt]
</span><a href="#local-6989586621682724724"><span class="hs-identifier hs-var">old_eqs</span></a></span></span><span>
</span><span id="line-234"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="GHC.Utils.Constants.html#debugIsOn"><span class="hs-identifier hs-var">debugIsOn</span></a></span><span>
</span><span id="line-235"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">EqCt
</span><a href="#local-6989586621682724723"><span class="hs-identifier hs-var">ct</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-236"></span><span>      </span><span class="annot"><a href="GHC.Tc.Types.Constraint.html#EqCt"><span class="hs-identifier hs-type">EqCt</span></a></span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">eq_lhs :: EqCt -&gt; CanEqLHS
</span><a href="GHC.Tc.Types.Constraint.html#eq_lhs"><span class="hs-identifier hs-var">eq_lhs</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="GHC.Tc.Types.Constraint.html#TyVarLHS"><span class="hs-identifier hs-type">TyVarLHS</span></a></span><span> </span><span id="local-6989586621682724729"><span class="annot"><span class="annottext">TcTyVar
</span><a href="#local-6989586621682724729"><span class="hs-identifier hs-var">tv</span></a></span></span><span> </span><span class="hs-special">}</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-237"></span><span>        </span><span class="annot"><span class="annottext">Bool -&gt; [EqCt] -&gt; [EqCt]
forall a. HasCallStack =&gt; Bool -&gt; a -&gt; a
</span><a href="GHC.Utils.Panic.Plain.html#assert"><span class="hs-identifier hs-var">assert</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(EqCt -&gt; Bool) -&gt; [EqCt] -&gt; Bool
forall (t :: * -&gt; *) a. Foldable t =&gt; (a -&gt; Bool) -&gt; t a -&gt; Bool
</span><span class="hs-identifier hs-var">all</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TcTyVar -&gt; EqCt -&gt; Bool
</span><a href="#local-6989586621682724732"><span class="hs-identifier hs-var">shares_lhs</span></a></span><span> </span><span class="annot"><span class="annottext">TcTyVar
</span><a href="#local-6989586621682724729"><span class="hs-identifier hs-var">tv</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[EqCt]
</span><a href="#local-6989586621682724724"><span class="hs-identifier hs-var">old_eqs</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">([EqCt] -&gt; [EqCt]) -&gt; [EqCt] -&gt; [EqCt]
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-238"></span><span>        </span><span class="annot"><span class="annottext">Bool -&gt; SDoc -&gt; [EqCt] -&gt; [EqCt]
forall a. HasCallStack =&gt; Bool -&gt; SDoc -&gt; a -&gt; a
</span><a href="GHC.Utils.Panic.html#assertPpr"><span class="hs-identifier hs-var">assertPpr</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[(EqCt, EqCt)] -&gt; Bool
forall a. [a] -&gt; Bool
forall (t :: * -&gt; *) a. Foldable t =&gt; t a -&gt; Bool
</span><span class="hs-identifier hs-var">null</span></span><span> </span><span class="annot"><span class="annottext">[(EqCt, EqCt)]
</span><a href="#local-6989586621682724735"><span class="hs-identifier hs-var">bad_prs</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-239"></span><span>                  </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[SDoc] -&gt; SDoc
forall doc. IsDoc doc =&gt; [doc] -&gt; doc
</span><a href="GHC.Utils.Outputable.html#vcat"><span class="hs-identifier hs-var">vcat</span></a></span><span> </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">String -&gt; SDoc
forall doc. IsLine doc =&gt; String -&gt; doc
</span><a href="GHC.Utils.Outputable.html#text"><span class="hs-identifier hs-var">text</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;bad_prs&quot;</span></span><span> </span><span class="annot"><span class="annottext">SDoc -&gt; SDoc -&gt; SDoc
forall doc. IsLine doc =&gt; doc -&gt; doc -&gt; doc
</span><a href="GHC.Utils.Outputable.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">[(EqCt, EqCt)] -&gt; SDoc
forall a. Outputable a =&gt; a -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="annot"><span class="annottext">[(EqCt, EqCt)]
</span><a href="#local-6989586621682724735"><span class="hs-identifier hs-var">bad_prs</span></a></span><span>
</span><span id="line-240"></span><span>                        </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">String -&gt; SDoc
forall doc. IsLine doc =&gt; String -&gt; doc
</span><a href="GHC.Utils.Outputable.html#text"><span class="hs-identifier hs-var">text</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;ct:old_eqs&quot;</span></span><span> </span><span class="annot"><span class="annottext">SDoc -&gt; SDoc -&gt; SDoc
forall doc. IsLine doc =&gt; doc -&gt; doc -&gt; doc
</span><a href="GHC.Utils.Outputable.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">[EqCt] -&gt; SDoc
forall a. Outputable a =&gt; a -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">EqCt
</span><a href="#local-6989586621682724723"><span class="hs-identifier hs-var">ct</span></a></span><span> </span><span class="annot"><span class="annottext">EqCt -&gt; [EqCt] -&gt; [EqCt]
forall a. a -&gt; [a] -&gt; [a]
</span><span class="hs-glyph hs-var">:</span></span><span> </span><span class="annot"><span class="annottext">[EqCt]
</span><a href="#local-6989586621682724724"><span class="hs-identifier hs-var">old_eqs</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">]</span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">([EqCt] -&gt; [EqCt]) -&gt; [EqCt] -&gt; [EqCt]
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-241"></span><span>        </span><span class="hs-special">(</span><span class="annot"><span class="annottext">EqCt
</span><a href="#local-6989586621682724723"><span class="hs-identifier hs-var">ct</span></a></span><span> </span><span class="annot"><span class="annottext">EqCt -&gt; [EqCt] -&gt; [EqCt]
forall a. a -&gt; [a] -&gt; [a]
</span><span class="hs-glyph hs-var">:</span></span><span> </span><span class="annot"><span class="annottext">[EqCt]
</span><a href="#local-6989586621682724724"><span class="hs-identifier hs-var">old_eqs</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-242"></span><span>
</span><span id="line-243"></span><span>      </span><span class="annot"><span class="annottext">EqCt
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">String -&gt; SDoc -&gt; [EqCt]
forall a. HasCallStack =&gt; String -&gt; SDoc -&gt; a
</span><a href="GHC.Utils.Panic.html#pprPanic"><span class="hs-identifier hs-var">pprPanic</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;addToEqualCtList not CEqCan&quot;</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">EqCt -&gt; SDoc
forall a. Outputable a =&gt; a -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="annot"><span class="annottext">EqCt
</span><a href="#local-6989586621682724723"><span class="hs-identifier hs-var">ct</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-244"></span><span>
</span><span id="line-245"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">otherwise</span></span><span>
</span><span id="line-246"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">EqCt
</span><a href="#local-6989586621682724723"><span class="hs-identifier hs-var">ct</span></a></span><span> </span><span class="annot"><span class="annottext">EqCt -&gt; [EqCt] -&gt; [EqCt]
forall a. a -&gt; [a] -&gt; [a]
</span><span class="hs-glyph hs-var">:</span></span><span> </span><span class="annot"><span class="annottext">[EqCt]
</span><a href="#local-6989586621682724724"><span class="hs-identifier hs-var">old_eqs</span></a></span><span>
</span><span id="line-247"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-248"></span><span>    </span><span id="local-6989586621682724732"><span class="annot"><span class="annottext">shares_lhs :: TcTyVar -&gt; EqCt -&gt; Bool
</span><a href="#local-6989586621682724732"><span class="hs-identifier hs-var hs-var">shares_lhs</span></a></span></span><span> </span><span id="local-6989586621682724743"><span class="annot"><span class="annottext">TcTyVar
</span><a href="#local-6989586621682724743"><span class="hs-identifier hs-var">tv</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Tc.Types.Constraint.html#EqCt"><span class="hs-identifier hs-type">EqCt</span></a></span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">eq_lhs :: EqCt -&gt; CanEqLHS
</span><a href="GHC.Tc.Types.Constraint.html#eq_lhs"><span class="hs-identifier hs-var">eq_lhs</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="GHC.Tc.Types.Constraint.html#TyVarLHS"><span class="hs-identifier hs-type">TyVarLHS</span></a></span><span> </span><span id="local-6989586621682724744"><span class="annot"><span class="annottext">TcTyVar
</span><a href="#local-6989586621682724744"><span class="hs-identifier hs-var">old_tv</span></a></span></span><span> </span><span class="hs-special">}</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">TcTyVar
</span><a href="#local-6989586621682724743"><span class="hs-identifier hs-var">tv</span></a></span><span> </span><span class="annot"><span class="annottext">TcTyVar -&gt; TcTyVar -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">==</span></span><span> </span><span class="annot"><span class="annottext">TcTyVar
</span><a href="#local-6989586621682724744"><span class="hs-identifier hs-var">old_tv</span></a></span><span>
</span><span id="line-249"></span><span>    </span><span class="annot"><a href="#local-6989586621682724732"><span class="hs-identifier hs-var">shares_lhs</span></a></span><span> </span><span class="annot"><span class="annottext">TcTyVar
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">EqCt
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">False</span></span><span>
</span><span id="line-250"></span><span>    </span><span id="local-6989586621682724735"><span class="annot"><span class="annottext">bad_prs :: [(EqCt, EqCt)]
</span><a href="#local-6989586621682724735"><span class="hs-identifier hs-var hs-var">bad_prs</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">((EqCt, EqCt) -&gt; Bool) -&gt; [(EqCt, EqCt)] -&gt; [(EqCt, EqCt)]
forall a. (a -&gt; Bool) -&gt; [a] -&gt; [a]
</span><span class="hs-identifier hs-var">filter</span></span><span> </span><span class="annot"><span class="annottext">(EqCt, EqCt) -&gt; Bool
</span><a href="#local-6989586621682724745"><span class="hs-identifier hs-var">is_bad_pair</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[EqCt] -&gt; [(EqCt, EqCt)]
forall a. [a] -&gt; [(a, a)]
</span><a href="GHC.Tc.Solver.Types.html#distinctPairs"><span class="hs-identifier hs-var">distinctPairs</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">EqCt
</span><a href="#local-6989586621682724723"><span class="hs-identifier hs-var">ct</span></a></span><span> </span><span class="annot"><span class="annottext">EqCt -&gt; [EqCt] -&gt; [EqCt]
forall a. a -&gt; [a] -&gt; [a]
</span><span class="hs-glyph hs-var">:</span></span><span> </span><span class="annot"><span class="annottext">[EqCt]
</span><a href="#local-6989586621682724724"><span class="hs-identifier hs-var">old_eqs</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-251"></span><span>    </span><span class="annot"><a href="#local-6989586621682724745"><span class="hs-identifier hs-type">is_bad_pair</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Tc.Types.Constraint.html#EqCt"><span class="hs-identifier hs-type">EqCt</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Tc.Types.Constraint.html#EqCt"><span class="hs-identifier hs-type">EqCt</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Bool</span></span><span>
</span><span id="line-252"></span><span>    </span><span id="local-6989586621682724745"><span class="annot"><span class="annottext">is_bad_pair :: (EqCt, EqCt) -&gt; Bool
</span><a href="#local-6989586621682724745"><span class="hs-identifier hs-var hs-var">is_bad_pair</span></a></span></span><span> </span><span class="hs-special">(</span><span id="local-6989586621682724747"><span class="annot"><span class="annottext">EqCt
</span><a href="#local-6989586621682724747"><span class="hs-identifier hs-var">ct1</span></a></span></span><span class="hs-special">,</span><span id="local-6989586621682724748"><span class="annot"><span class="annottext">EqCt
</span><a href="#local-6989586621682724748"><span class="hs-identifier hs-var">ct2</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">EqCt -&gt; CtFlavourRole
</span><a href="GHC.Tc.Types.Constraint.html#eqCtFlavourRole"><span class="hs-identifier hs-var">eqCtFlavourRole</span></a></span><span> </span><span class="annot"><span class="annottext">EqCt
</span><a href="#local-6989586621682724747"><span class="hs-identifier hs-var">ct1</span></a></span><span> </span><span class="annot"><span class="annottext">CtFlavourRole -&gt; CtFlavourRole -&gt; Bool
</span><a href="GHC.Tc.Types.Constraint.html#eqCanRewriteFR"><span class="hs-operator hs-var">`eqCanRewriteFR`</span></a></span><span> </span><span class="annot"><span class="annottext">EqCt -&gt; CtFlavourRole
</span><a href="GHC.Tc.Types.Constraint.html#eqCtFlavourRole"><span class="hs-identifier hs-var">eqCtFlavourRole</span></a></span><span> </span><span class="annot"><span class="annottext">EqCt
</span><a href="#local-6989586621682724748"><span class="hs-identifier hs-var">ct2</span></a></span><span>
</span><span id="line-253"></span><span>
</span><span id="line-254"></span><span id="local-6989586621682724561"><span class="annot"><a href="GHC.Tc.Solver.Types.html#distinctPairs"><span class="hs-identifier hs-type">distinctPairs</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="#local-6989586621682724561"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621682724561"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">,</span><span class="annot"><a href="#local-6989586621682724561"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">)</span><span class="hs-special">]</span></span><span>
</span><span id="line-255"></span><span class="hs-comment">-- distinctPairs [x1,...xn] is the list of all pairs [ ...(xi, xj)...]</span><span>
</span><span id="line-256"></span><span class="hs-comment">--                             where i /= j</span><span>
</span><span id="line-257"></span><span class="hs-comment">-- NB: does not return pairs (xi,xi), which would be stupid in the</span><span>
</span><span id="line-258"></span><span class="hs-comment">--     context of addToEqualCtList (#22645)</span><span>
</span><span id="line-259"></span><span id="distinctPairs"><span class="annot"><span class="annottext">distinctPairs :: forall a. [a] -&gt; [(a, a)]
</span><a href="GHC.Tc.Solver.Types.html#distinctPairs"><span class="hs-identifier hs-var hs-var">distinctPairs</span></a></span></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span>     </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span>
</span><span id="line-260"></span><span class="annot"><a href="GHC.Tc.Solver.Types.html#distinctPairs"><span class="hs-identifier hs-var">distinctPairs</span></a></span><span> </span><span class="hs-special">(</span><span id="local-6989586621682724752"><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621682724752"><span class="hs-identifier hs-var">x</span></a></span></span><span class="annot"><span class="hs-glyph hs-type">:</span></span><span id="local-6989586621682724753"><span class="annot"><span class="annottext">[a]
</span><a href="#local-6989586621682724753"><span class="hs-identifier hs-var">xs</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(a -&gt; [(a, a)]) -&gt; [a] -&gt; [(a, a)]
forall (t :: * -&gt; *) a b. Foldable t =&gt; (a -&gt; [b]) -&gt; t a -&gt; [b]
</span><span class="hs-identifier hs-var">concatMap</span></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span id="local-6989586621682724755"><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621682724755"><span class="hs-identifier hs-var">y</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="hs-special">(</span><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621682724752"><span class="hs-identifier hs-var">x</span></a></span><span class="hs-special">,</span><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621682724755"><span class="hs-identifier hs-var">y</span></a></span><span class="hs-special">)</span><span class="hs-special">,</span><span class="hs-special">(</span><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621682724755"><span class="hs-identifier hs-var">y</span></a></span><span class="hs-special">,</span><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621682724752"><span class="hs-identifier hs-var">x</span></a></span><span class="hs-special">)</span><span class="hs-special">]</span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[a]
</span><a href="#local-6989586621682724753"><span class="hs-identifier hs-var">xs</span></a></span><span> </span><span class="annot"><span class="annottext">[(a, a)] -&gt; [(a, a)] -&gt; [(a, a)]
forall a. [a] -&gt; [a] -&gt; [a]
</span><span class="hs-operator hs-var">++</span></span><span> </span><span class="annot"><span class="annottext">[a] -&gt; [(a, a)]
forall a. [a] -&gt; [(a, a)]
</span><a href="GHC.Tc.Solver.Types.html#distinctPairs"><span class="hs-identifier hs-var">distinctPairs</span></a></span><span> </span><span class="annot"><span class="annottext">[a]
</span><a href="#local-6989586621682724753"><span class="hs-identifier hs-var">xs</span></a></span><span>
</span><span id="line-261"></span><span>
</span><span id="line-262"></span><span class="hs-comment">-- returns Nothing when the new list is empty, to keep the environments smaller</span><span>
</span><span id="line-263"></span><span class="annot"><a href="GHC.Tc.Solver.Types.html#filterEqualCtList"><span class="hs-identifier hs-type">filterEqualCtList</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Tc.Types.Constraint.html#EqCt"><span class="hs-identifier hs-type">EqCt</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Bool</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Solver.Types.html#EqualCtList"><span class="hs-identifier hs-type">EqualCtList</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Maybe</span></span><span> </span><span class="annot"><a href="GHC.Tc.Solver.Types.html#EqualCtList"><span class="hs-identifier hs-type">EqualCtList</span></a></span><span>
</span><span id="line-264"></span><span id="filterEqualCtList"><span class="annot"><span class="annottext">filterEqualCtList :: (EqCt -&gt; Bool) -&gt; [EqCt] -&gt; Maybe [EqCt]
</span><a href="GHC.Tc.Solver.Types.html#filterEqualCtList"><span class="hs-identifier hs-var hs-var">filterEqualCtList</span></a></span></span><span> </span><span id="local-6989586621682724756"><span class="annot"><span class="annottext">EqCt -&gt; Bool
</span><a href="#local-6989586621682724756"><span class="hs-identifier hs-var">pred</span></a></span></span><span> </span><span id="local-6989586621682724757"><span class="annot"><span class="annottext">[EqCt]
</span><a href="#local-6989586621682724757"><span class="hs-identifier hs-var">cts</span></a></span></span><span>
</span><span id="line-265"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">[EqCt] -&gt; Bool
forall a. [a] -&gt; Bool
forall (t :: * -&gt; *) a. Foldable t =&gt; t a -&gt; Bool
</span><span class="hs-identifier hs-var">null</span></span><span> </span><span class="annot"><span class="annottext">[EqCt]
</span><a href="#local-6989586621682724758"><span class="hs-identifier hs-var">new_list</span></a></span><span>
</span><span id="line-266"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Maybe [EqCt]
forall a. Maybe a
</span><span class="hs-identifier hs-var">Nothing</span></span><span>
</span><span id="line-267"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">otherwise</span></span><span>
</span><span id="line-268"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[EqCt] -&gt; Maybe [EqCt]
forall a. a -&gt; Maybe a
</span><span class="hs-identifier hs-var">Just</span></span><span> </span><span class="annot"><span class="annottext">[EqCt]
</span><a href="#local-6989586621682724758"><span class="hs-identifier hs-var">new_list</span></a></span><span>
</span><span id="line-269"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-270"></span><span>    </span><span id="local-6989586621682724758"><span class="annot"><span class="annottext">new_list :: [EqCt]
</span><a href="#local-6989586621682724758"><span class="hs-identifier hs-var hs-var">new_list</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(EqCt -&gt; Bool) -&gt; [EqCt] -&gt; [EqCt]
forall a. (a -&gt; Bool) -&gt; [a] -&gt; [a]
</span><span class="hs-identifier hs-var">filter</span></span><span> </span><span class="annot"><span class="annottext">EqCt -&gt; Bool
</span><a href="#local-6989586621682724756"><span class="hs-identifier hs-var">pred</span></a></span><span> </span><span class="annot"><span class="annottext">[EqCt]
</span><a href="#local-6989586621682724757"><span class="hs-identifier hs-var">cts</span></a></span><span>
</span><span id="line-271"></span></pre></body></html>