<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><link rel="stylesheet" type="text/css" href="style.css" /><script type="text/javascript" src="highlight.js"></script></head><body><pre><span class="hs-pragma">{-# LANGUAGE ScopedTypeVariables #-}</span><span>
</span><span id="line-2"></span><span class="hs-pragma">{-# LANGUAGE MultiParamTypeClasses #-}</span><span>
</span><span id="line-3"></span><span class="hs-pragma">{-# LANGUAGE FlexibleInstances #-}</span><span>
</span><span id="line-4"></span><span class="hs-pragma">{-# LANGUAGE FlexibleContexts #-}</span><span>
</span><span id="line-5"></span><span class="hs-pragma">{-# LANGUAGE GeneralizedNewtypeDeriving #-}</span><span>
</span><span id="line-6"></span><span>
</span><span id="line-7"></span><span class="hs-keyword">module</span><span> </span><span class="annot"><a href="GHC.Data.Graph.Collapse.html"><span class="hs-identifier">GHC.Data.Graph.Collapse</span></a></span><span>
</span><span id="line-8"></span><span>  </span><span class="hs-special">(</span><span> </span><span class="annot"><a href="GHC.Data.Graph.Collapse.html#PureSupernode"><span class="hs-identifier">PureSupernode</span></a></span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span>
</span><span id="line-9"></span><span>  </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Data.Graph.Collapse.html#Supernode"><span class="hs-identifier">Supernode</span></a></span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span>
</span><span id="line-10"></span><span>  </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Data.Graph.Collapse.html#collapseInductiveGraph"><span class="hs-identifier">collapseInductiveGraph</span></a></span><span>
</span><span id="line-11"></span><span>  </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Data.Graph.Collapse.html#VizCollapseMonad"><span class="hs-identifier">VizCollapseMonad</span></a></span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span>
</span><span id="line-12"></span><span>  </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Data.Graph.Collapse.html#NullCollapseViz"><span class="hs-identifier">NullCollapseViz</span></a></span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span>
</span><span id="line-13"></span><span>  </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Data.Graph.Collapse.html#runNullCollapse"><span class="hs-identifier">runNullCollapse</span></a></span><span>
</span><span id="line-14"></span><span>  </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Types.Unique.DSM.html#MonadUniqDSM"><span class="hs-identifier">MonadUniqDSM</span></a></span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span>
</span><span id="line-15"></span><span>  </span><span class="hs-special">)</span><span>
</span><span id="line-16"></span><span class="hs-keyword">where</span><span>
</span><span id="line-17"></span><span>
</span><span id="line-18"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Prelude.html"><span class="hs-identifier">GHC.Prelude</span></a></span><span>
</span><span id="line-19"></span><span>
</span><span id="line-20"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="../../base-4.21.0.0-ae91/src/Control.Exception.html"><span class="hs-identifier">Control.Exception</span></a></span><span>
</span><span id="line-21"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="../../base-4.21.0.0-ae91/src/Control.Monad.html"><span class="hs-identifier">Control.Monad</span></a></span><span>
</span><span id="line-22"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="../../base-4.21.0.0-ae91/src/Data.List.html"><span class="hs-identifier">Data.List</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">delete</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">union</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">insert</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">intersect</span></span><span class="hs-special">)</span><span>
</span><span id="line-23"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="../../base-4.21.0.0-ae91/src/Data.Semigroup.html"><span class="hs-identifier">Data.Semigroup</span></a></span><span>
</span><span id="line-24"></span><span>
</span><span id="line-25"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Cmm.Dataflow.Label.html"><span class="hs-identifier">GHC.Cmm.Dataflow.Label</span></a></span><span>
</span><span id="line-26"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Data.Graph.Inductive.Graph.html"><span class="hs-identifier">GHC.Data.Graph.Inductive.Graph</span></a></span><span>
</span><span id="line-27"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Types.Unique.DSM.html"><span class="hs-identifier">GHC.Types.Unique.DSM</span></a></span><span>
</span><span id="line-28"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Utils.Panic.html"><span class="hs-identifier">GHC.Utils.Panic</span></a></span><span> </span><span class="hs-keyword">hiding</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Utils.Panic.Plain.html#assert"><span class="hs-identifier">assert</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-29"></span><span>
</span><span id="line-30"></span><span>
</span><span id="line-31"></span><span class="annot"><span class="hs-comment">{-|
Module      : GHC.Data.Graph.Collapse
Description : Implement the &quot;collapsing&quot; algorithm Hecht and Ullman

A control-flow graph is reducible if and only if it is collapsible
according to the definition of Hecht and Ullman (1972).   This module
implements the collapsing algorithm of Hecht and Ullman, and if it
encounters a graph that is not collapsible, it splits nodes until the
graph is fully collapsed.  It then reports what nodes (if any) had to
be split in order to collapse the graph.  The information is used
upstream to node-split Cmm graphs.

The module uses the inductive graph representation cloned from the
Functional Graph Library (Hackage package `fgl`, modules
`GHC.Data.Graph.Inductive.*`.)

-}</span></span><span>
</span><span id="line-48"></span><span>
</span><span id="line-49"></span><span class="hs-comment">-- Full reference to paper: Matthew S. Hecht and Jeffrey D. Ullman</span><span>
</span><span id="line-50"></span><span class="hs-comment">-- (1972).  Flow Graph Reducibility. SIAM J. Comput., 1(2), 188&#8211;202.</span><span>
</span><span id="line-51"></span><span class="hs-comment">-- https://doi.org/10.1137/0201014</span><span>
</span><span id="line-52"></span><span>
</span><span id="line-53"></span><span>
</span><span id="line-54"></span><span class="hs-comment">------------------ Graph-splitting monad -----------------------</span><span>
</span><span id="line-55"></span><span>
</span><span id="line-56"></span><span class="hs-comment">-- | If you want to visualize the graph-collapsing algorithm, create</span><span>
</span><span id="line-57"></span><span class="hs-comment">-- an instance of monad `VizCollapseMonad`.  Each step in the</span><span>
</span><span id="line-58"></span><span class="hs-comment">-- algorithm is announced to the monad as a side effect.  If you don't</span><span>
</span><span id="line-59"></span><span class="hs-comment">-- care about visualization, you would use the `NullCollapseViz`</span><span>
</span><span id="line-60"></span><span class="hs-comment">-- monad, in which these operations are no-ops.</span><span>
</span><span id="line-61"></span><span>
</span><span id="line-62"></span><span class="hs-keyword">class</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Types.Unique.DSM.html#MonadUniqDSM"><span class="hs-identifier hs-type">MonadUniqDSM</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682511113"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Data.Graph.Inductive.Graph.html#Graph"><span class="hs-identifier hs-type">Graph</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682511114"><span class="hs-identifier hs-type">gr</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Data.Graph.Collapse.html#Supernode"><span class="hs-identifier hs-type">Supernode</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682511115"><span class="hs-identifier hs-type">s</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682511113"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span id="VizCollapseMonad"><span class="annot"><a href="GHC.Data.Graph.Collapse.html#VizCollapseMonad"><span class="hs-identifier hs-var">VizCollapseMonad</span></a></span></span><span> </span><span id="local-6989586621682511113"><span class="annot"><a href="#local-6989586621682511113"><span class="hs-identifier hs-type">m</span></a></span></span><span> </span><span id="local-6989586621682511114"><span class="annot"><a href="#local-6989586621682511114"><span class="hs-identifier hs-type">gr</span></a></span></span><span> </span><span id="local-6989586621682511115"><span class="annot"><a href="#local-6989586621682511115"><span class="hs-identifier hs-type">s</span></a></span></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-63"></span><span>  </span><span id="consumeByInGraph"><span class="annot"><a href="GHC.Data.Graph.Collapse.html#consumeByInGraph"><span class="hs-identifier hs-type">consumeByInGraph</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Data.Graph.Inductive.Graph.html#Node"><span class="hs-identifier hs-type">Node</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Data.Graph.Inductive.Graph.html#Node"><span class="hs-identifier hs-type">Node</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621682511114"><span class="hs-identifier hs-type">gr</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682511115"><span class="hs-identifier hs-type">s</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621682511113"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-64"></span><span>  </span><span id="splitGraphAt"><span class="annot"><a href="GHC.Data.Graph.Collapse.html#splitGraphAt"><span class="hs-identifier hs-type">splitGraphAt</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="#local-6989586621682511114"><span class="hs-identifier hs-type">gr</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682511115"><span class="hs-identifier hs-type">s</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Data.Graph.Inductive.Graph.html#LNode"><span class="hs-identifier hs-type">LNode</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682511115"><span class="hs-identifier hs-type">s</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621682511113"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-65"></span><span>  </span><span id="finalGraph"><span class="annot"><a href="GHC.Data.Graph.Collapse.html#finalGraph"><span class="hs-identifier hs-type">finalGraph</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="#local-6989586621682511114"><span class="hs-identifier hs-type">gr</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682511115"><span class="hs-identifier hs-type">s</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621682511113"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-66"></span><span>
</span><span id="line-67"></span><span class="hs-comment">-- | The identity monad as a `VizCollapseMonad`.  Use this monad when</span><span>
</span><span id="line-68"></span><span class="hs-comment">-- you want efficiency in graph collapse.</span><span>
</span><span id="line-69"></span><span class="hs-keyword">newtype</span><span> </span><span id="NullCollapseViz"><span class="annot"><a href="GHC.Data.Graph.Collapse.html#NullCollapseViz"><span class="hs-identifier hs-var">NullCollapseViz</span></a></span></span><span> </span><span id="local-6989586621682511120"><span class="annot"><a href="#local-6989586621682511120"><span class="hs-identifier hs-type">a</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="NullCollapseViz"><span class="annot"><a href="GHC.Data.Graph.Collapse.html#NullCollapseViz"><span class="hs-identifier hs-var">NullCollapseViz</span></a></span></span><span> </span><span class="hs-special">{</span><span> </span><span id="unNCV"><span class="annot"><span class="annottext">forall a. NullCollapseViz a -&gt; UniqDSM a
</span><a href="GHC.Data.Graph.Collapse.html#unNCV"><span class="hs-identifier hs-var hs-var">unNCV</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Types.Unique.DSM.html#UniqDSM"><span class="hs-identifier hs-type">UniqDSM</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682511120"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-70"></span><span>  </span><span class="hs-keyword">deriving</span><span> </span><span class="hs-special">(</span><span id="local-6989586621682511326"><span id="local-6989586621682511331"><span class="annot"><span class="annottext">(forall a b. (a -&gt; b) -&gt; NullCollapseViz a -&gt; NullCollapseViz b)
-&gt; (forall a b. a -&gt; NullCollapseViz b -&gt; NullCollapseViz a)
-&gt; Functor NullCollapseViz
forall a b. a -&gt; NullCollapseViz b -&gt; NullCollapseViz a
forall a b. (a -&gt; b) -&gt; NullCollapseViz a -&gt; NullCollapseViz b
forall (f :: * -&gt; *).
(forall a b. (a -&gt; b) -&gt; f a -&gt; f b)
-&gt; (forall a b. a -&gt; f b -&gt; f a) -&gt; Functor f
$cfmap :: forall a b. (a -&gt; b) -&gt; NullCollapseViz a -&gt; NullCollapseViz b
fmap :: forall a b. (a -&gt; b) -&gt; NullCollapseViz a -&gt; NullCollapseViz b
$c&lt;$ :: forall a b. a -&gt; NullCollapseViz b -&gt; NullCollapseViz a
&lt;$ :: forall a b. a -&gt; NullCollapseViz b -&gt; NullCollapseViz a
</span><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var hs-var">Functor</span></span></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682511340"><span id="local-6989586621682511345"><span id="local-6989586621682511349"><span id="local-6989586621682511353"><span id="local-6989586621682511357"><span class="annot"><span class="annottext">Functor NullCollapseViz
Functor NullCollapseViz =&gt;
(forall a. a -&gt; NullCollapseViz a)
-&gt; (forall a b.
    NullCollapseViz (a -&gt; b) -&gt; NullCollapseViz a -&gt; NullCollapseViz b)
-&gt; (forall a b c.
    (a -&gt; b -&gt; c)
    -&gt; NullCollapseViz a -&gt; NullCollapseViz b -&gt; NullCollapseViz c)
-&gt; (forall a b.
    NullCollapseViz a -&gt; NullCollapseViz b -&gt; NullCollapseViz b)
-&gt; (forall a b.
    NullCollapseViz a -&gt; NullCollapseViz b -&gt; NullCollapseViz a)
-&gt; Applicative NullCollapseViz
forall a. a -&gt; NullCollapseViz a
forall a b.
NullCollapseViz a -&gt; NullCollapseViz b -&gt; NullCollapseViz a
forall a b.
NullCollapseViz a -&gt; NullCollapseViz b -&gt; NullCollapseViz b
forall a b.
NullCollapseViz (a -&gt; b) -&gt; NullCollapseViz a -&gt; NullCollapseViz b
forall a b c.
(a -&gt; b -&gt; c)
-&gt; NullCollapseViz a -&gt; NullCollapseViz b -&gt; NullCollapseViz c
forall (f :: * -&gt; *).
Functor f =&gt;
(forall a. a -&gt; f a)
-&gt; (forall a b. f (a -&gt; b) -&gt; f a -&gt; f b)
-&gt; (forall a b c. (a -&gt; b -&gt; c) -&gt; f a -&gt; f b -&gt; f c)
-&gt; (forall a b. f a -&gt; f b -&gt; f b)
-&gt; (forall a b. f a -&gt; f b -&gt; f a)
-&gt; Applicative f
$cpure :: forall a. a -&gt; NullCollapseViz a
pure :: forall a. a -&gt; NullCollapseViz a
$c&lt;*&gt; :: forall a b.
NullCollapseViz (a -&gt; b) -&gt; NullCollapseViz a -&gt; NullCollapseViz b
&lt;*&gt; :: forall a b.
NullCollapseViz (a -&gt; b) -&gt; NullCollapseViz a -&gt; NullCollapseViz b
$cliftA2 :: forall a b c.
(a -&gt; b -&gt; c)
-&gt; NullCollapseViz a -&gt; NullCollapseViz b -&gt; NullCollapseViz c
liftA2 :: forall a b c.
(a -&gt; b -&gt; c)
-&gt; NullCollapseViz a -&gt; NullCollapseViz b -&gt; NullCollapseViz c
$c*&gt; :: forall a b.
NullCollapseViz a -&gt; NullCollapseViz b -&gt; NullCollapseViz b
*&gt; :: forall a b.
NullCollapseViz a -&gt; NullCollapseViz b -&gt; NullCollapseViz b
$c&lt;* :: forall a b.
NullCollapseViz a -&gt; NullCollapseViz b -&gt; NullCollapseViz a
&lt;* :: forall a b.
NullCollapseViz a -&gt; NullCollapseViz b -&gt; NullCollapseViz a
</span><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var">Applicative</span></span></span></span></span></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682511367"><span id="local-6989586621682511372"><span id="local-6989586621682511376"><span class="annot"><span class="annottext">Applicative NullCollapseViz
Applicative NullCollapseViz =&gt;
(forall a b.
 NullCollapseViz a -&gt; (a -&gt; NullCollapseViz b) -&gt; NullCollapseViz b)
-&gt; (forall a b.
    NullCollapseViz a -&gt; NullCollapseViz b -&gt; NullCollapseViz b)
-&gt; (forall a. a -&gt; NullCollapseViz a)
-&gt; Monad NullCollapseViz
forall a. a -&gt; NullCollapseViz a
forall a b.
NullCollapseViz a -&gt; NullCollapseViz b -&gt; NullCollapseViz b
forall a b.
NullCollapseViz a -&gt; (a -&gt; NullCollapseViz b) -&gt; NullCollapseViz b
forall (m :: * -&gt; *).
Applicative m =&gt;
(forall a b. m a -&gt; (a -&gt; m b) -&gt; m b)
-&gt; (forall a b. m a -&gt; m b -&gt; m b)
-&gt; (forall a. a -&gt; m a)
-&gt; Monad m
$c&gt;&gt;= :: forall a b.
NullCollapseViz a -&gt; (a -&gt; NullCollapseViz b) -&gt; NullCollapseViz b
&gt;&gt;= :: forall a b.
NullCollapseViz a -&gt; (a -&gt; NullCollapseViz b) -&gt; NullCollapseViz b
$c&gt;&gt; :: forall a b.
NullCollapseViz a -&gt; NullCollapseViz b -&gt; NullCollapseViz b
&gt;&gt; :: forall a b.
NullCollapseViz a -&gt; NullCollapseViz b -&gt; NullCollapseViz b
$creturn :: forall a. a -&gt; NullCollapseViz a
return :: forall a. a -&gt; NullCollapseViz a
</span><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var">Monad</span></span></span></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682511384"><span class="annot"><span class="annottext">Monad NullCollapseViz
NullCollapseViz Unique
Monad NullCollapseViz =&gt;
NullCollapseViz Unique -&gt; MonadGetUnique NullCollapseViz
forall (m :: * -&gt; *). Monad m =&gt; m Unique -&gt; MonadGetUnique m
$cgetUniqueM :: NullCollapseViz Unique
getUniqueM :: NullCollapseViz Unique
</span><a href="GHC.Types.Unique.DSM.html#MonadGetUnique"><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var">MonadGetUnique</span></a></span></span><span class="hs-special">)</span><span>
</span><span id="line-71"></span><span>
</span><span id="line-72"></span><span class="hs-keyword">instance</span><span> </span><span class="annot"><a href="GHC.Types.Unique.DSM.html#MonadUniqDSM"><span class="hs-identifier hs-type">MonadUniqDSM</span></a></span><span> </span><span class="annot"><a href="GHC.Data.Graph.Collapse.html#NullCollapseViz"><span class="hs-identifier hs-type">NullCollapseViz</span></a></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-73"></span><span>  </span><span id="local-6989586621682511396"><span class="annot"><span class="annottext">liftUniqDSM :: forall a. UniqDSM a -&gt; NullCollapseViz a
</span><a href="#local-6989586621682511396"><span class="hs-identifier hs-var hs-var hs-var">liftUniqDSM</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">UniqDSM a -&gt; NullCollapseViz a
forall a. UniqDSM a -&gt; NullCollapseViz a
</span><a href="GHC.Data.Graph.Collapse.html#NullCollapseViz"><span class="hs-identifier hs-var">NullCollapseViz</span></a></span><span>
</span><span id="line-74"></span><span>
</span><span id="line-75"></span><span class="hs-keyword">instance</span><span> </span><span id="local-6989586621682511180"><span id="local-6989586621682511181"><span class="hs-special">(</span><span class="annot"><a href="GHC.Data.Graph.Inductive.Graph.html#Graph"><span class="hs-identifier hs-type">Graph</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682511180"><span class="hs-identifier hs-type">gr</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Data.Graph.Collapse.html#Supernode"><span class="hs-identifier hs-type">Supernode</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682511181"><span class="hs-identifier hs-type">s</span></a></span><span> </span><span class="annot"><a href="GHC.Data.Graph.Collapse.html#NullCollapseViz"><span class="hs-identifier hs-type">NullCollapseViz</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span>
</span><span id="line-76"></span><span>    </span><span class="annot"><a href="GHC.Data.Graph.Collapse.html#VizCollapseMonad"><span class="hs-identifier hs-type">VizCollapseMonad</span></a></span><span> </span><span class="annot"><a href="GHC.Data.Graph.Collapse.html#NullCollapseViz"><span class="hs-identifier hs-type">NullCollapseViz</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682511180"><span class="hs-identifier hs-type">gr</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682511181"><span class="hs-identifier hs-type">s</span></a></span></span></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-77"></span><span>  </span><span id="local-6989586621682511416"><span class="annot"><span class="annottext">consumeByInGraph :: Node -&gt; Node -&gt; gr s () -&gt; NullCollapseViz ()
</span><a href="GHC.Data.Graph.Collapse.html#consumeByInGraph"><span class="hs-identifier hs-var hs-var hs-var">consumeByInGraph</span></a></span></span><span> </span><span class="annot"><span class="annottext">Node
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">Node
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">gr s ()
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">() -&gt; NullCollapseViz ()
forall a. a -&gt; NullCollapseViz a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-78"></span><span>  </span><span id="local-6989586621682511418"><span class="annot"><span class="annottext">splitGraphAt :: gr s () -&gt; LNode s -&gt; NullCollapseViz ()
</span><a href="GHC.Data.Graph.Collapse.html#splitGraphAt"><span class="hs-identifier hs-var hs-var hs-var">splitGraphAt</span></a></span></span><span> </span><span class="annot"><span class="annottext">gr s ()
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">LNode s
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">() -&gt; NullCollapseViz ()
forall a. a -&gt; NullCollapseViz a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-79"></span><span>  </span><span id="local-6989586621682511420"><span class="annot"><span class="annottext">finalGraph :: gr s () -&gt; NullCollapseViz ()
</span><a href="GHC.Data.Graph.Collapse.html#finalGraph"><span class="hs-identifier hs-var hs-var hs-var">finalGraph</span></a></span></span><span> </span><span class="annot"><span class="annottext">gr s ()
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">() -&gt; NullCollapseViz ()
forall a. a -&gt; NullCollapseViz a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-80"></span><span>
</span><span id="line-81"></span><span id="local-6989586621682511421"><span class="annot"><a href="GHC.Data.Graph.Collapse.html#runNullCollapse"><span class="hs-identifier hs-type">runNullCollapse</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Data.Graph.Collapse.html#NullCollapseViz"><span class="hs-identifier hs-type">NullCollapseViz</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682511421"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Types.Unique.DSM.html#UniqDSM"><span class="hs-identifier hs-type">UniqDSM</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682511421"><span class="hs-identifier hs-type">a</span></a></span></span><span>
</span><span id="line-82"></span><span id="runNullCollapse"><span class="annot"><span class="annottext">runNullCollapse :: forall a. NullCollapseViz a -&gt; UniqDSM a
</span><a href="GHC.Data.Graph.Collapse.html#runNullCollapse"><span class="hs-identifier hs-var hs-var">runNullCollapse</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">NullCollapseViz a -&gt; UniqDSM a
forall a. NullCollapseViz a -&gt; UniqDSM a
</span><a href="GHC.Data.Graph.Collapse.html#unNCV"><span class="hs-identifier hs-var">unNCV</span></a></span><span>
</span><span id="line-83"></span><span>
</span><span id="line-84"></span><span>
</span><span id="line-85"></span><span class="hs-comment">------------------ Utility functions on graphs -----------------------</span><span>
</span><span id="line-86"></span><span>
</span><span id="line-87"></span><span>
</span><span id="line-88"></span><span class="annot"><span class="hs-comment">-- | Tell if a `Node` has a single predecessor.</span></span><span>
</span><span id="line-89"></span><span id="local-6989586621682511183"><span id="local-6989586621682511184"><span id="local-6989586621682511185"><span class="annot"><a href="GHC.Data.Graph.Collapse.html#singlePred"><span class="hs-identifier hs-type">singlePred</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Data.Graph.Inductive.Graph.html#Graph"><span class="hs-identifier hs-type">Graph</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682511183"><span class="hs-identifier hs-type">gr</span></a></span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="#local-6989586621682511183"><span class="hs-identifier hs-type">gr</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682511184"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682511185"><span class="hs-identifier hs-type">b</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Data.Graph.Inductive.Graph.html#Node"><span class="hs-identifier hs-type">Node</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Bool</span></span></span></span></span><span>
</span><span id="line-90"></span><span id="singlePred"><span class="annot"><span class="annottext">singlePred :: forall (gr :: * -&gt; * -&gt; *) a b. Graph gr =&gt; gr a b -&gt; Node -&gt; Bool
</span><a href="GHC.Data.Graph.Collapse.html#singlePred"><span class="hs-identifier hs-var hs-var">singlePred</span></a></span></span><span> </span><span id="local-6989586621682511425"><span class="annot"><span class="annottext">gr a b
</span><a href="#local-6989586621682511425"><span class="hs-identifier hs-var">gr</span></a></span></span><span> </span><span id="local-6989586621682511426"><span class="annot"><span class="annottext">Node
</span><a href="#local-6989586621682511426"><span class="hs-identifier hs-var">n</span></a></span></span><span>
</span><span id="line-91"></span><span>    </span><span class="hs-glyph">|</span><span> </span><span class="hs-special">(</span><span class="hs-special">[</span><span class="annot"><span class="annottext">(b, Node)
</span><span class="hs-identifier">_</span></span><span class="hs-special">]</span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Node
</span><span class="hs-identifier">_</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">a
</span><span class="hs-identifier">_</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Adj b
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">gr a b -&gt; Node -&gt; (Adj b, Node, a, Adj b)
forall (gr :: * -&gt; * -&gt; *) a b.
Graph gr =&gt;
gr a b -&gt; Node -&gt; Context a b
</span><a href="GHC.Data.Graph.Inductive.Graph.html#context"><span class="hs-identifier hs-var">context</span></a></span><span> </span><span class="annot"><span class="annottext">gr a b
</span><a href="#local-6989586621682511425"><span class="hs-identifier hs-var">gr</span></a></span><span> </span><span class="annot"><span class="annottext">Node
</span><a href="#local-6989586621682511426"><span class="hs-identifier hs-var">n</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">True</span></span><span>
</span><span id="line-92"></span><span>    </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">otherwise</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">False</span></span><span>
</span><span id="line-93"></span><span>
</span><span id="line-94"></span><span class="hs-comment">-- | Use this function to extract information about a `Node` that you</span><span>
</span><span id="line-95"></span><span class="hs-comment">-- know is in a `Graph`.  It's like `match` from `Graph`, but it must</span><span>
</span><span id="line-96"></span><span class="hs-comment">-- succeed.</span><span>
</span><span id="line-97"></span><span id="local-6989586621682511194"><span id="local-6989586621682511195"><span id="local-6989586621682511196"><span class="annot"><a href="GHC.Data.Graph.Collapse.html#forceMatch"><span class="hs-identifier hs-type">forceMatch</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Data.Graph.Inductive.Graph.html#Graph"><span class="hs-identifier hs-type">Graph</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682511194"><span class="hs-identifier hs-type">gr</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-98"></span><span>           </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="GHC.Data.Graph.Inductive.Graph.html#Node"><span class="hs-identifier hs-type">Node</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621682511194"><span class="hs-identifier hs-type">gr</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682511195"><span class="hs-identifier hs-type">s</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682511196"><span class="hs-identifier hs-type">b</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Data.Graph.Inductive.Graph.html#Context"><span class="hs-identifier hs-type">Context</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682511195"><span class="hs-identifier hs-type">s</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682511196"><span class="hs-identifier hs-type">b</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="#local-6989586621682511194"><span class="hs-identifier hs-type">gr</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682511195"><span class="hs-identifier hs-type">s</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682511196"><span class="hs-identifier hs-type">b</span></a></span><span class="hs-special">)</span></span></span></span><span>
</span><span id="line-99"></span><span id="forceMatch"><span class="annot"><span class="annottext">forceMatch :: forall (gr :: * -&gt; * -&gt; *) s b.
Graph gr =&gt;
Node -&gt; gr s b -&gt; (Context s b, gr s b)
</span><a href="GHC.Data.Graph.Collapse.html#forceMatch"><span class="hs-identifier hs-var hs-var">forceMatch</span></a></span></span><span> </span><span id="local-6989586621682511433"><span class="annot"><span class="annottext">Node
</span><a href="#local-6989586621682511433"><span class="hs-identifier hs-var">node</span></a></span></span><span> </span><span id="local-6989586621682511434"><span class="annot"><span class="annottext">gr s b
</span><a href="#local-6989586621682511434"><span class="hs-identifier hs-var">g</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">Node -&gt; gr s b -&gt; Decomp gr s b
forall a b. Node -&gt; gr a b -&gt; Decomp gr a b
forall (gr :: * -&gt; * -&gt; *) a b.
Graph gr =&gt;
Node -&gt; gr a b -&gt; Decomp gr a b
</span><a href="GHC.Data.Graph.Inductive.Graph.html#match"><span class="hs-identifier hs-var">match</span></a></span><span> </span><span class="annot"><span class="annottext">Node
</span><a href="#local-6989586621682511433"><span class="hs-identifier hs-var">node</span></a></span><span> </span><span class="annot"><span class="annottext">gr s b
</span><a href="#local-6989586621682511434"><span class="hs-identifier hs-var">g</span></a></span><span> </span><span class="hs-keyword">of</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span id="local-6989586621682511435"><span class="annot"><span class="annottext">Context s b
</span><a href="#local-6989586621682511435"><span class="hs-identifier hs-var">c</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682511436"><span class="annot"><span class="annottext">gr s b
</span><a href="#local-6989586621682511436"><span class="hs-identifier hs-var">g'</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Context s b
</span><a href="#local-6989586621682511435"><span class="hs-identifier hs-var">c</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">gr s b
</span><a href="#local-6989586621682511436"><span class="hs-identifier hs-var">g'</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-100"></span><span>                                         </span><span class="annot"><span class="annottext">Decomp gr s b
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Node -&gt; gr s b -&gt; (Context s b, gr s b)
forall (gr :: * -&gt; * -&gt; *) s b any.
Graph gr =&gt;
Node -&gt; gr s b -&gt; any
</span><a href="#local-6989586621682511437"><span class="hs-identifier hs-var">panicDump</span></a></span><span> </span><span class="annot"><span class="annottext">Node
</span><a href="#local-6989586621682511433"><span class="hs-identifier hs-var">node</span></a></span><span> </span><span class="annot"><span class="annottext">gr s b
</span><a href="#local-6989586621682511434"><span class="hs-identifier hs-var">g</span></a></span><span>
</span><span id="line-101"></span><span> </span><span class="hs-keyword">where</span><span> </span><span id="local-6989586621682511204"><span id="local-6989586621682511205"><span id="local-6989586621682511206"><span id="local-6989586621682511207"><span class="annot"><a href="#local-6989586621682511437"><span class="hs-identifier hs-type">panicDump</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Data.Graph.Inductive.Graph.html#Graph"><span class="hs-identifier hs-type">Graph</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682511204"><span class="hs-identifier hs-type">gr</span></a></span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="GHC.Data.Graph.Inductive.Graph.html#Node"><span class="hs-identifier hs-type">Node</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621682511204"><span class="hs-identifier hs-type">gr</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682511205"><span class="hs-identifier hs-type">s</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682511206"><span class="hs-identifier hs-type">b</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621682511207"><span class="hs-identifier hs-type">any</span></a></span></span></span></span></span><span>
</span><span id="line-102"></span><span>       </span><span id="local-6989586621682511437"><span class="annot"><span class="annottext">panicDump :: forall (gr :: * -&gt; * -&gt; *) s b any.
Graph gr =&gt;
Node -&gt; gr s b -&gt; any
</span><a href="#local-6989586621682511437"><span class="hs-identifier hs-var hs-var">panicDump</span></a></span></span><span> </span><span id="local-6989586621682511443"><span class="annot"><span class="annottext">Node
</span><a href="#local-6989586621682511443"><span class="hs-identifier hs-var">k</span></a></span></span><span> </span><span id="local-6989586621682511444"><span class="annot"><span class="annottext">gr s b
</span><a href="#local-6989586621682511444"><span class="hs-identifier hs-var">_g</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-103"></span><span>         </span><span class="annot"><span class="annottext">String -&gt; any
forall a. HasCallStack =&gt; String -&gt; a
</span><a href="GHC.Utils.Panic.Plain.html#panic"><span class="hs-identifier hs-var">panic</span></a></span><span> </span><span class="annot"><span class="annottext">(String -&gt; any) -&gt; String -&gt; any
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;GHC.Data.Graph.Collapse failed to match node &quot;</span></span><span> </span><span class="annot"><span class="annottext">String -&gt; String -&gt; String
forall a. [a] -&gt; [a] -&gt; [a]
</span><span class="hs-operator hs-var">++</span></span><span> </span><span class="annot"><span class="annottext">Node -&gt; String
forall a. Show a =&gt; a -&gt; String
</span><span class="hs-identifier hs-var">show</span></span><span> </span><span class="annot"><span class="annottext">Node
</span><a href="#local-6989586621682511443"><span class="hs-identifier hs-var">k</span></a></span><span>
</span><span id="line-104"></span><span>
</span><span id="line-105"></span><span class="annot"><span class="hs-comment">-- | Rewrite the label of a given node.</span></span><span>
</span><span id="line-106"></span><span id="local-6989586621682511220"><span id="local-6989586621682511222"><span id="local-6989586621682511223"><span class="annot"><a href="GHC.Data.Graph.Collapse.html#updateNode"><span class="hs-identifier hs-type">updateNode</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Data.Graph.Inductive.Graph.html#DynGraph"><span class="hs-identifier hs-type">DynGraph</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682511220"><span class="hs-identifier hs-type">gr</span></a></span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621682511222"><span class="hs-identifier hs-type">s</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621682511222"><span class="hs-identifier hs-type">s</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Data.Graph.Inductive.Graph.html#Node"><span class="hs-identifier hs-type">Node</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621682511220"><span class="hs-identifier hs-type">gr</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682511222"><span class="hs-identifier hs-type">s</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682511223"><span class="hs-identifier hs-type">b</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621682511220"><span class="hs-identifier hs-type">gr</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682511222"><span class="hs-identifier hs-type">s</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682511223"><span class="hs-identifier hs-type">b</span></a></span></span></span></span><span>
</span><span id="line-107"></span><span id="updateNode"><span class="annot"><span class="annottext">updateNode :: forall (gr :: * -&gt; * -&gt; *) s b.
DynGraph gr =&gt;
(s -&gt; s) -&gt; Node -&gt; gr s b -&gt; gr s b
</span><a href="GHC.Data.Graph.Collapse.html#updateNode"><span class="hs-identifier hs-var hs-var">updateNode</span></a></span></span><span> </span><span id="local-6989586621682511453"><span class="annot"><span class="annottext">s -&gt; s
</span><a href="#local-6989586621682511453"><span class="hs-identifier hs-var">relabel</span></a></span></span><span> </span><span id="local-6989586621682511454"><span class="annot"><span class="annottext">Node
</span><a href="#local-6989586621682511454"><span class="hs-identifier hs-var">node</span></a></span></span><span> </span><span id="local-6989586621682511455"><span class="annot"><span class="annottext">gr s b
</span><a href="#local-6989586621682511455"><span class="hs-identifier hs-var">g</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Adj b
</span><a href="#local-6989586621682511456"><span class="hs-identifier hs-var">preds</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Node
</span><a href="#local-6989586621682511457"><span class="hs-identifier hs-var">n</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">s -&gt; s
</span><a href="#local-6989586621682511453"><span class="hs-identifier hs-var">relabel</span></a></span><span> </span><span class="annot"><span class="annottext">s
</span><a href="#local-6989586621682511458"><span class="hs-identifier hs-var">this</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Adj b
</span><a href="#local-6989586621682511459"><span class="hs-identifier hs-var">succs</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Context s b -&gt; gr s b -&gt; gr s b
forall a b. Context a b -&gt; gr a b -&gt; gr a b
forall (gr :: * -&gt; * -&gt; *) a b.
DynGraph gr =&gt;
Context a b -&gt; gr a b -&gt; gr a b
</span><a href="GHC.Data.Graph.Inductive.Graph.html#%26"><span class="hs-operator hs-var">&amp;</span></a></span><span> </span><span class="annot"><span class="annottext">gr s b
</span><a href="#local-6989586621682511461"><span class="hs-identifier hs-var">g'</span></a></span><span>
</span><span id="line-108"></span><span>    </span><span class="hs-keyword">where</span><span> </span><span class="hs-special">(</span><span class="hs-special">(</span><span id="local-6989586621682511456"><span class="annot"><span class="annottext">Adj b
</span><a href="#local-6989586621682511456"><span class="hs-identifier hs-var">preds</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682511457"><span class="annot"><span class="annottext">Node
</span><a href="#local-6989586621682511457"><span class="hs-identifier hs-var">n</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682511458"><span class="annot"><span class="annottext">s
</span><a href="#local-6989586621682511458"><span class="hs-identifier hs-var">this</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682511459"><span class="annot"><span class="annottext">Adj b
</span><a href="#local-6989586621682511459"><span class="hs-identifier hs-var">succs</span></a></span></span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span id="local-6989586621682511461"><span class="annot"><span class="annottext">gr s b
</span><a href="#local-6989586621682511461"><span class="hs-identifier hs-var">g'</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Node -&gt; gr s b -&gt; (Context s b, gr s b)
forall (gr :: * -&gt; * -&gt; *) s b.
Graph gr =&gt;
Node -&gt; gr s b -&gt; (Context s b, gr s b)
</span><a href="GHC.Data.Graph.Collapse.html#forceMatch"><span class="hs-identifier hs-var">forceMatch</span></a></span><span> </span><span class="annot"><span class="annottext">Node
</span><a href="#local-6989586621682511454"><span class="hs-identifier hs-var">node</span></a></span><span> </span><span class="annot"><span class="annottext">gr s b
</span><a href="#local-6989586621682511455"><span class="hs-identifier hs-var">g</span></a></span><span>
</span><span id="line-109"></span><span>
</span><span id="line-110"></span><span>
</span><span id="line-111"></span><span class="annot"><span class="hs-comment">-- | Test if a graph has but a single node.</span></span><span>
</span><span id="line-112"></span><span id="local-6989586621682511230"><span id="local-6989586621682511231"><span id="local-6989586621682511232"><span class="annot"><a href="GHC.Data.Graph.Collapse.html#singletonGraph"><span class="hs-identifier hs-type">singletonGraph</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Data.Graph.Inductive.Graph.html#Graph"><span class="hs-identifier hs-type">Graph</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682511230"><span class="hs-identifier hs-type">gr</span></a></span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="#local-6989586621682511230"><span class="hs-identifier hs-type">gr</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682511231"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682511232"><span class="hs-identifier hs-type">b</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Bool</span></span></span></span></span><span>
</span><span id="line-113"></span><span id="singletonGraph"><span class="annot"><span class="annottext">singletonGraph :: forall (gr :: * -&gt; * -&gt; *) a b. Graph gr =&gt; gr a b -&gt; Bool
</span><a href="GHC.Data.Graph.Collapse.html#singletonGraph"><span class="hs-identifier hs-var hs-var">singletonGraph</span></a></span></span><span> </span><span id="local-6989586621682511465"><span class="annot"><span class="annottext">gr a b
</span><a href="#local-6989586621682511465"><span class="hs-identifier hs-var">g</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">gr a b -&gt; [LNode a]
forall a b. gr a b -&gt; [LNode a]
forall (gr :: * -&gt; * -&gt; *) a b. Graph gr =&gt; gr a b -&gt; [LNode a]
</span><a href="GHC.Data.Graph.Inductive.Graph.html#labNodes"><span class="hs-identifier hs-var">labNodes</span></a></span><span> </span><span class="annot"><span class="annottext">gr a b
</span><a href="#local-6989586621682511465"><span class="hs-identifier hs-var">g</span></a></span><span> </span><span class="hs-keyword">of</span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">LNode a
</span><span class="hs-identifier">_</span></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">True</span></span><span>
</span><span id="line-114"></span><span>                                      </span><span class="annot"><span class="annottext">[LNode a]
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">False</span></span><span>
</span><span id="line-115"></span><span>
</span><span id="line-116"></span><span>
</span><span id="line-117"></span><span class="hs-comment">----------------  Supernodes ------------------------------------</span><span>
</span><span id="line-118"></span><span>
</span><span id="line-119"></span><span class="hs-comment">-- | A &quot;supernode&quot; stands for a collection of one or more nodes (basic</span><span>
</span><span id="line-120"></span><span class="hs-comment">-- blocks) that have been coalesced by the Hecht-Ullman algorithm.</span><span>
</span><span id="line-121"></span><span class="hs-comment">-- A collection in a supernode constitutes a /reducible/ subgraph of a</span><span>
</span><span id="line-122"></span><span class="hs-comment">-- control-flow graph.  (When an entire control-flow graph is collapsed</span><span>
</span><span id="line-123"></span><span class="hs-comment">-- to a single supernode, the flow graph is reducible.)</span><span>
</span><span id="line-124"></span><span class="hs-comment">--</span><span>
</span><span id="line-125"></span><span class="hs-comment">-- The idea of node splitting is to collapse a control-flow graph down</span><span>
</span><span id="line-126"></span><span class="hs-comment">-- to a single supernode, then materialize (``inflate'') the reducible</span><span>
</span><span id="line-127"></span><span class="hs-comment">-- equivalent graph from that supernode.  The `Supernode` class</span><span>
</span><span id="line-128"></span><span class="hs-comment">-- defines only the methods needed to collapse; rematerialization is</span><span>
</span><span id="line-129"></span><span class="hs-comment">-- the responsibility of the client.</span><span>
</span><span id="line-130"></span><span class="hs-comment">--</span><span>
</span><span id="line-131"></span><span class="hs-comment">-- During the Hecht-Ullman algorithm, every supernode has a unique</span><span>
</span><span id="line-132"></span><span class="hs-comment">-- entry point, which is given by `superLabel`.  But this invariant is</span><span>
</span><span id="line-133"></span><span class="hs-comment">-- not guaranteed by the class methods and is not a law of the class.</span><span>
</span><span id="line-134"></span><span class="hs-comment">-- The `mapLabels` function rewrites all labels that appear in a</span><span>
</span><span id="line-135"></span><span class="hs-comment">-- supernode (both definitions and uses).  The `freshen` function</span><span>
</span><span id="line-136"></span><span class="hs-comment">-- replaces every appearance of a /defined/ label with a fresh label.</span><span>
</span><span id="line-137"></span><span class="hs-comment">-- (Appearances include both definitions and uses.)</span><span>
</span><span id="line-138"></span><span class="hs-comment">--</span><span>
</span><span id="line-139"></span><span class="hs-comment">-- Laws:</span><span>
</span><span id="line-140"></span><span class="hs-comment">-- @</span><span>
</span><span id="line-141"></span><span class="hs-comment">--    superLabel (n &lt;&gt; n') == superLabel n</span><span>
</span><span id="line-142"></span><span class="hs-comment">--    blocks (n &lt;&gt; n') == blocks n `union` blocks n'</span><span>
</span><span id="line-143"></span><span class="hs-comment">--    mapLabels f (n &lt;&gt; n') = mapLabels f n &lt;&gt; mapLabels f n'</span><span>
</span><span id="line-144"></span><span class="hs-comment">--    mapLabels id == id</span><span>
</span><span id="line-145"></span><span class="hs-comment">--    mapLabels (f . g) == mapLabels f . mapLabels g</span><span>
</span><span id="line-146"></span><span class="hs-comment">-- @</span><span>
</span><span id="line-147"></span><span class="hs-comment">--</span><span>
</span><span id="line-148"></span><span class="hs-comment">-- (We expect `freshen` to distribute over `&lt;&gt;`, but because of</span><span>
</span><span id="line-149"></span><span class="hs-comment">-- the fresh names involved, formulating a precise law is a bit</span><span>
</span><span id="line-150"></span><span class="hs-comment">-- challenging.)</span><span>
</span><span id="line-151"></span><span>
</span><span id="line-152"></span><span class="hs-keyword">class</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Semigroup</span></span><span> </span><span class="annot"><a href="#local-6989586621682511238"><span class="hs-identifier hs-type">node</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span id="PureSupernode"><span class="annot"><a href="GHC.Data.Graph.Collapse.html#PureSupernode"><span class="hs-identifier hs-var">PureSupernode</span></a></span></span><span> </span><span id="local-6989586621682511238"><span class="annot"><a href="#local-6989586621682511238"><span class="hs-identifier hs-type">node</span></a></span></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-153"></span><span>  </span><span id="superLabel"><span class="annot"><a href="GHC.Data.Graph.Collapse.html#superLabel"><span class="hs-identifier hs-type">superLabel</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="#local-6989586621682511238"><span class="hs-identifier hs-type">node</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Cmm.Dataflow.Label.html#Label"><span class="hs-identifier hs-type">Label</span></a></span><span>
</span><span id="line-154"></span><span>  </span><span id="mapLabels"><span class="annot"><a href="GHC.Data.Graph.Collapse.html#mapLabels"><span class="hs-identifier hs-type">mapLabels</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Cmm.Dataflow.Label.html#Label"><span class="hs-identifier hs-type">Label</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Cmm.Dataflow.Label.html#Label"><span class="hs-identifier hs-type">Label</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621682511238"><span class="hs-identifier hs-type">node</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621682511238"><span class="hs-identifier hs-type">node</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-155"></span><span>
</span><span id="line-156"></span><span class="hs-keyword">class</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Types.Unique.DSM.html#MonadGetUnique"><span class="hs-identifier hs-type">MonadGetUnique</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682511179"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Data.Graph.Collapse.html#PureSupernode"><span class="hs-identifier hs-type">PureSupernode</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682511178"><span class="hs-identifier hs-type">node</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span id="Supernode"><span class="annot"><a href="GHC.Data.Graph.Collapse.html#Supernode"><span class="hs-identifier hs-var">Supernode</span></a></span></span><span> </span><span id="local-6989586621682511178"><span class="annot"><a href="#local-6989586621682511178"><span class="hs-identifier hs-type">node</span></a></span></span><span> </span><span id="local-6989586621682511179"><span class="annot"><a href="#local-6989586621682511179"><span class="hs-identifier hs-type">m</span></a></span></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-157"></span><span>  </span><span id="freshen"><span class="annot"><a href="GHC.Data.Graph.Collapse.html#freshen"><span class="hs-identifier hs-type">freshen</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="#local-6989586621682511178"><span class="hs-identifier hs-type">node</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621682511179"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682511178"><span class="hs-identifier hs-type">node</span></a></span><span>
</span><span id="line-158"></span><span>
</span><span id="line-159"></span><span>  </span><span class="hs-comment">-- ghost method</span><span>
</span><span id="line-160"></span><span>  </span><span class="hs-comment">-- blocks :: node -&gt; Set Block</span><span>
</span><span id="line-161"></span><span>
</span><span id="line-162"></span><span class="hs-comment">------------------ Functions specific to the algorithm -----------------------</span><span>
</span><span id="line-163"></span><span>
</span><span id="line-164"></span><span class="hs-comment">-- | Merge two nodes, return new graph plus list of nodes that newly have a single</span><span>
</span><span id="line-165"></span><span class="hs-comment">-- predecessor.  This function implements transformation $T_2$ from</span><span>
</span><span id="line-166"></span><span class="hs-comment">-- the Hecht and Ullman paper (merge the node into its unique</span><span>
</span><span id="line-167"></span><span class="hs-comment">-- predecessor).  It then also removes self-edges (transformation $T_1$ from</span><span>
</span><span id="line-168"></span><span class="hs-comment">-- the Hecht and Ullman paper).  There is no need for a separate</span><span>
</span><span id="line-169"></span><span class="hs-comment">-- implementation of $T_1$.</span><span>
</span><span id="line-170"></span><span class="hs-comment">--</span><span>
</span><span id="line-171"></span><span class="hs-comment">-- `consumeBy v u g` returns the graph that results when node v is</span><span>
</span><span id="line-172"></span><span class="hs-comment">-- consumed by node u in graph g.  Both v and u are replaced with a new node u'</span><span>
</span><span id="line-173"></span><span class="hs-comment">-- with these properties:</span><span>
</span><span id="line-174"></span><span class="hs-comment">--</span><span>
</span><span id="line-175"></span><span class="hs-comment">--    LABELS(u') = LABELS(u) `union` LABELS(v)</span><span>
</span><span id="line-176"></span><span class="hs-comment">--    SUCC(u') = SUCC(u) `union` SUCC(v) - { u }</span><span>
</span><span id="line-177"></span><span class="hs-comment">--    every node that previously points to u now points to u'</span><span>
</span><span id="line-178"></span><span class="hs-comment">--</span><span>
</span><span id="line-179"></span><span class="hs-comment">-- It also returns a list of nodes in the result graph that</span><span>
</span><span id="line-180"></span><span class="hs-comment">-- are *newly* single-predecessor nodes.</span><span>
</span><span id="line-181"></span><span>
</span><span id="line-182"></span><span id="local-6989586621682511240"><span id="local-6989586621682511241"><span class="annot"><a href="GHC.Data.Graph.Collapse.html#consumeBy"><span class="hs-identifier hs-type">consumeBy</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Data.Graph.Inductive.Graph.html#DynGraph"><span class="hs-identifier hs-type">DynGraph</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682511240"><span class="hs-identifier hs-type">gr</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Data.Graph.Collapse.html#PureSupernode"><span class="hs-identifier hs-type">PureSupernode</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682511241"><span class="hs-identifier hs-type">s</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-183"></span><span>          </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="GHC.Data.Graph.Inductive.Graph.html#Node"><span class="hs-identifier hs-type">Node</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Data.Graph.Inductive.Graph.html#Node"><span class="hs-identifier hs-type">Node</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621682511240"><span class="hs-identifier hs-type">gr</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682511241"><span class="hs-identifier hs-type">s</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621682511240"><span class="hs-identifier hs-type">gr</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682511241"><span class="hs-identifier hs-type">s</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="GHC.Data.Graph.Inductive.Graph.html#Node"><span class="hs-identifier hs-type">Node</span></a></span><span class="hs-special">]</span><span class="hs-special">)</span></span></span><span>
</span><span id="line-184"></span><span id="consumeBy"><span class="annot"><span class="annottext">consumeBy :: forall (gr :: * -&gt; * -&gt; *) s.
(DynGraph gr, PureSupernode s) =&gt;
Node -&gt; Node -&gt; gr s () -&gt; (gr s (), [Node])
</span><a href="GHC.Data.Graph.Collapse.html#consumeBy"><span class="hs-identifier hs-var hs-var">consumeBy</span></a></span></span><span> </span><span id="local-6989586621682511496"><span class="annot"><span class="annottext">Node
</span><a href="#local-6989586621682511496"><span class="hs-identifier hs-var">toNode</span></a></span></span><span> </span><span id="local-6989586621682511497"><span class="annot"><span class="annottext">Node
</span><a href="#local-6989586621682511497"><span class="hs-identifier hs-var">fromNode</span></a></span></span><span> </span><span id="local-6989586621682511498"><span class="annot"><span class="annottext">gr s ()
</span><a href="#local-6989586621682511498"><span class="hs-identifier hs-var">g</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-185"></span><span>    </span><span class="annot"><span class="annottext">Bool -&gt; (gr s (), [Node]) -&gt; (gr s (), [Node])
forall a. HasCallStack =&gt; Bool -&gt; a -&gt; a
</span><span class="hs-identifier hs-var hs-var">assert</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Adj ()
</span><a href="#local-6989586621682511499"><span class="hs-identifier hs-var">toPreds</span></a></span><span> </span><span class="annot"><span class="annottext">Adj () -&gt; Adj () -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">==</span></span><span> </span><span class="hs-special">[</span><span class="hs-special">(</span><span class="hs-special">(</span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Node
</span><a href="#local-6989586621682511497"><span class="hs-identifier hs-var">fromNode</span></a></span><span class="hs-special">)</span><span class="hs-special">]</span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">((gr s (), [Node]) -&gt; (gr s (), [Node]))
-&gt; (gr s (), [Node]) -&gt; (gr s (), [Node])
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-186"></span><span>    </span><span class="hs-special">(</span><span class="annot"><span class="annottext">gr s ()
</span><a href="#local-6989586621682511500"><span class="hs-identifier hs-var">newGraph</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">[Node]
</span><a href="#local-6989586621682511501"><span class="hs-identifier hs-var">newCandidates</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-187"></span><span>  </span><span class="hs-keyword">where</span><span> </span><span class="hs-special">(</span><span class="hs-special">(</span><span id="local-6989586621682511499"><span class="annot"><span class="annottext">Adj ()
</span><a href="#local-6989586621682511499"><span class="hs-identifier hs-var">toPreds</span></a></span></span><span class="hs-special">,</span><span>   </span><span class="annot"><span class="annottext">Node
</span><span class="hs-identifier">_</span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682511502"><span class="annot"><span class="annottext">s
</span><a href="#local-6989586621682511502"><span class="hs-identifier hs-var">to</span></a></span></span><span class="hs-special">,</span><span>   </span><span id="local-6989586621682511503"><span class="annot"><span class="annottext">Adj ()
</span><a href="#local-6989586621682511503"><span class="hs-identifier hs-var">toSuccs</span></a></span></span><span class="hs-special">)</span><span class="hs-special">,</span><span>   </span><span id="local-6989586621682511504"><span class="annot"><span class="annottext">gr s ()
</span><a href="#local-6989586621682511504"><span class="hs-identifier hs-var">g'</span></a></span></span><span class="hs-special">)</span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Node -&gt; gr s () -&gt; (Context s (), gr s ())
forall (gr :: * -&gt; * -&gt; *) s b.
Graph gr =&gt;
Node -&gt; gr s b -&gt; (Context s b, gr s b)
</span><a href="GHC.Data.Graph.Collapse.html#forceMatch"><span class="hs-identifier hs-var">forceMatch</span></a></span><span> </span><span class="annot"><span class="annottext">Node
</span><a href="#local-6989586621682511496"><span class="hs-identifier hs-var">toNode</span></a></span><span>   </span><span class="annot"><span class="annottext">gr s ()
</span><a href="#local-6989586621682511498"><span class="hs-identifier hs-var">g</span></a></span><span>
</span><span id="line-188"></span><span>        </span><span class="hs-special">(</span><span class="hs-special">(</span><span id="local-6989586621682511505"><span class="annot"><span class="annottext">Adj ()
</span><a href="#local-6989586621682511505"><span class="hs-identifier hs-var">fromPreds</span></a></span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Node
</span><span class="hs-identifier">_</span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682511506"><span class="annot"><span class="annottext">s
</span><a href="#local-6989586621682511506"><span class="hs-identifier hs-var">from</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682511507"><span class="annot"><span class="annottext">Adj ()
</span><a href="#local-6989586621682511507"><span class="hs-identifier hs-var">fromSuccs</span></a></span></span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span id="local-6989586621682511508"><span class="annot"><span class="annottext">gr s ()
</span><a href="#local-6989586621682511508"><span class="hs-identifier hs-var">g''</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Node -&gt; gr s () -&gt; (Context s (), gr s ())
forall (gr :: * -&gt; * -&gt; *) s b.
Graph gr =&gt;
Node -&gt; gr s b -&gt; (Context s b, gr s b)
</span><a href="GHC.Data.Graph.Collapse.html#forceMatch"><span class="hs-identifier hs-var">forceMatch</span></a></span><span> </span><span class="annot"><span class="annottext">Node
</span><a href="#local-6989586621682511497"><span class="hs-identifier hs-var">fromNode</span></a></span><span> </span><span class="annot"><span class="annottext">gr s ()
</span><a href="#local-6989586621682511504"><span class="hs-identifier hs-var">g'</span></a></span><span>
</span><span id="line-189"></span><span>        </span><span id="local-6989586621682511509"><span class="annot"><span class="annottext">context :: Context s ()
</span><a href="#local-6989586621682511509"><span class="hs-identifier hs-var hs-var">context</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><span> </span><span class="annot"><span class="annottext">Adj ()
</span><a href="#local-6989586621682511505"><span class="hs-identifier hs-var">fromPreds</span></a></span><span> </span><span class="hs-comment">-- by construction, can't have `toNode`</span><span>
</span><span id="line-190"></span><span>                  </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Node
</span><a href="#local-6989586621682511497"><span class="hs-identifier hs-var">fromNode</span></a></span><span>
</span><span id="line-191"></span><span>                  </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">s
</span><a href="#local-6989586621682511506"><span class="hs-identifier hs-var">from</span></a></span><span> </span><span class="annot"><span class="annottext">s -&gt; s -&gt; s
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">s
</span><a href="#local-6989586621682511502"><span class="hs-identifier hs-var">to</span></a></span><span>
</span><span id="line-192"></span><span>                  </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">((), Node) -&gt; Adj () -&gt; Adj ()
forall a. Eq a =&gt; a -&gt; [a] -&gt; [a]
</span><span class="hs-identifier hs-var">delete</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">(</span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Node
</span><a href="#local-6989586621682511497"><span class="hs-identifier hs-var">fromNode</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Adj ()
</span><a href="#local-6989586621682511503"><span class="hs-identifier hs-var">toSuccs</span></a></span><span> </span><span class="annot"><span class="annottext">Adj () -&gt; Adj () -&gt; Adj ()
forall a. Eq a =&gt; [a] -&gt; [a] -&gt; [a]
</span><span class="hs-operator hs-var">`union`</span></span><span> </span><span class="annot"><span class="annottext">Adj ()
</span><a href="#local-6989586621682511507"><span class="hs-identifier hs-var">fromSuccs</span></a></span><span>
</span><span id="line-193"></span><span>                  </span><span class="hs-special">)</span><span>
</span><span id="line-194"></span><span>        </span><span id="local-6989586621682511500"><span class="annot"><span class="annottext">newGraph :: gr s ()
</span><a href="#local-6989586621682511500"><span class="hs-identifier hs-var hs-var">newGraph</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Context s ()
</span><a href="#local-6989586621682511509"><span class="hs-identifier hs-var">context</span></a></span><span> </span><span class="annot"><span class="annottext">Context s () -&gt; gr s () -&gt; gr s ()
forall a b. Context a b -&gt; gr a b -&gt; gr a b
forall (gr :: * -&gt; * -&gt; *) a b.
DynGraph gr =&gt;
Context a b -&gt; gr a b -&gt; gr a b
</span><a href="GHC.Data.Graph.Inductive.Graph.html#%26"><span class="hs-operator hs-var">&amp;</span></a></span><span> </span><span class="annot"><span class="annottext">gr s ()
</span><a href="#local-6989586621682511508"><span class="hs-identifier hs-var">g''</span></a></span><span>
</span><span id="line-195"></span><span>        </span><span id="local-6989586621682511501"><span class="annot"><span class="annottext">newCandidates :: [Node]
</span><a href="#local-6989586621682511501"><span class="hs-identifier hs-var hs-var">newCandidates</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(Node -&gt; Bool) -&gt; [Node] -&gt; [Node]
forall a. (a -&gt; Bool) -&gt; [a] -&gt; [a]
</span><span class="hs-identifier hs-var">filter</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">gr s () -&gt; Node -&gt; Bool
forall (gr :: * -&gt; * -&gt; *) a b. Graph gr =&gt; gr a b -&gt; Node -&gt; Bool
</span><a href="GHC.Data.Graph.Collapse.html#singlePred"><span class="hs-identifier hs-var">singlePred</span></a></span><span> </span><span class="annot"><span class="annottext">gr s ()
</span><a href="#local-6989586621682511500"><span class="hs-identifier hs-var">newGraph</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[Node]
</span><a href="#local-6989586621682511510"><span class="hs-identifier hs-var">changedNodes</span></a></span><span>
</span><span id="line-196"></span><span>        </span><span id="local-6989586621682511510"><span class="annot"><span class="annottext">changedNodes :: [Node]
</span><a href="#local-6989586621682511510"><span class="hs-identifier hs-var hs-var">changedNodes</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Node
</span><a href="#local-6989586621682511497"><span class="hs-identifier hs-var">fromNode</span></a></span><span> </span><span class="annot"><span class="annottext">Node -&gt; [Node] -&gt; [Node]
forall a. Ord a =&gt; a -&gt; [a] -&gt; [a]
</span><span class="hs-operator hs-var">`insert`</span></span><span> </span><span class="annot"><span class="annottext">(((), Node) -&gt; Node) -&gt; Adj () -&gt; [Node]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><span class="hs-identifier hs-var">map</span></span><span> </span><span class="annot"><span class="annottext">((), Node) -&gt; Node
forall a b. (a, b) -&gt; b
</span><span class="hs-identifier hs-var">snd</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Adj ()
</span><a href="#local-6989586621682511503"><span class="hs-identifier hs-var">toSuccs</span></a></span><span> </span><span class="annot"><span class="annottext">Adj () -&gt; Adj () -&gt; Adj ()
forall a. Eq a =&gt; [a] -&gt; [a] -&gt; [a]
</span><span class="hs-operator hs-var">`intersect`</span></span><span> </span><span class="annot"><span class="annottext">Adj ()
</span><a href="#local-6989586621682511507"><span class="hs-identifier hs-var">fromSuccs</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-197"></span><span>
</span><span id="line-198"></span><span class="hs-comment">-- | Split a given node.  The node is replaced with a collection of replicas,</span><span>
</span><span id="line-199"></span><span class="hs-comment">-- one for each predecessor.  After the split, every predecessor</span><span>
</span><span id="line-200"></span><span class="hs-comment">-- points to a unique replica.</span><span>
</span><span id="line-201"></span><span class="annot"><a href="GHC.Data.Graph.Collapse.html#split"><span class="hs-identifier hs-type">split</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-keyword">forall</span><span> </span><span id="local-6989586621682511258"><span class="annot"><a href="#local-6989586621682511258"><span class="hs-identifier hs-type">gr</span></a></span></span><span> </span><span id="local-6989586621682511259"><span class="annot"><a href="#local-6989586621682511259"><span class="hs-identifier hs-type">s</span></a></span></span><span> </span><span id="local-6989586621682511261"><span class="annot"><a href="#local-6989586621682511261"><span class="hs-identifier hs-type">b</span></a></span></span><span> </span><span id="local-6989586621682511260"><span class="annot"><a href="#local-6989586621682511260"><span class="hs-identifier hs-type">m</span></a></span></span><span> </span><span class="hs-operator">.</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Data.Graph.Inductive.Graph.html#DynGraph"><span class="hs-identifier hs-type">DynGraph</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682511258"><span class="hs-identifier hs-type">gr</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Data.Graph.Collapse.html#Supernode"><span class="hs-identifier hs-type">Supernode</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682511259"><span class="hs-identifier hs-type">s</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682511260"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-202"></span><span>      </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="GHC.Data.Graph.Inductive.Graph.html#Node"><span class="hs-identifier hs-type">Node</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621682511258"><span class="hs-identifier hs-type">gr</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682511259"><span class="hs-identifier hs-type">s</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682511261"><span class="hs-identifier hs-type">b</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621682511260"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621682511258"><span class="hs-identifier hs-type">gr</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682511259"><span class="hs-identifier hs-type">s</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682511261"><span class="hs-identifier hs-type">b</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-203"></span><span id="split"><span class="annot"><span class="annottext">split :: forall (gr :: * -&gt; * -&gt; *) s b (m :: * -&gt; *).
(DynGraph gr, Supernode s m) =&gt;
Node -&gt; gr s b -&gt; m (gr s b)
</span><a href="GHC.Data.Graph.Collapse.html#split"><span class="hs-identifier hs-var hs-var">split</span></a></span></span><span> </span><span id="local-6989586621682511539"><span class="annot"><span class="annottext">Node
</span><a href="#local-6989586621682511539"><span class="hs-identifier hs-var">node</span></a></span></span><span> </span><span id="local-6989586621682511540"><span class="annot"><span class="annottext">gr s b
</span><a href="#local-6989586621682511540"><span class="hs-identifier hs-var">g</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Bool -&gt; m (gr s b) -&gt; m (gr s b)
forall a. HasCallStack =&gt; Bool -&gt; a -&gt; a
</span><span class="hs-identifier hs-var hs-var">assert</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[(b, Node)] -&gt; Bool
forall a. [a] -&gt; Bool
</span><a href="GHC.Data.Graph.Collapse.html#isMultiple"><span class="hs-identifier hs-var">isMultiple</span></a></span><span> </span><span class="annot"><span class="annottext">[(b, Node)]
</span><a href="#local-6989586621682511542"><span class="hs-identifier hs-var">preds</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(m (gr s b) -&gt; m (gr s b)) -&gt; m (gr s b) -&gt; m (gr s b)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">(gr s b -&gt; ((b, Node), Node) -&gt; m (gr s b))
-&gt; gr s b -&gt; [((b, Node), Node)] -&gt; m (gr s b)
forall (t :: * -&gt; *) (m :: * -&gt; *) b a.
(Foldable t, Monad m) =&gt;
(b -&gt; a -&gt; m b) -&gt; b -&gt; t a -&gt; m b
</span><span class="hs-identifier hs-var">foldM</span></span><span> </span><span class="annot"><span class="annottext">gr s b -&gt; ((b, Node), Node) -&gt; m (gr s b)
</span><a href="#local-6989586621682511544"><span class="hs-identifier hs-var">addReplica</span></a></span><span> </span><span class="annot"><span class="annottext">gr s b
</span><a href="#local-6989586621682511545"><span class="hs-identifier hs-var">g'</span></a></span><span> </span><span class="annot"><span class="annottext">[((b, Node), Node)]
</span><a href="#local-6989586621682511546"><span class="hs-identifier hs-var">newNodes</span></a></span><span>
</span><span id="line-204"></span><span>  </span><span class="hs-keyword">where</span><span> </span><span class="hs-special">(</span><span class="hs-special">(</span><span id="local-6989586621682511542"><span class="annot"><span class="annottext">[(b, Node)]
</span><a href="#local-6989586621682511542"><span class="hs-identifier hs-var">preds</span></a></span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Node
</span><span class="hs-identifier">_</span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682511547"><span class="annot"><span class="annottext">s
</span><a href="#local-6989586621682511547"><span class="hs-identifier hs-var">this</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682511548"><span class="annot"><span class="annottext">[(b, Node)]
</span><a href="#local-6989586621682511548"><span class="hs-identifier hs-var">succs</span></a></span></span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span id="local-6989586621682511545"><span class="annot"><span class="annottext">gr s b
</span><a href="#local-6989586621682511545"><span class="hs-identifier hs-var">g'</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Node -&gt; gr s b -&gt; (Context s b, gr s b)
forall (gr :: * -&gt; * -&gt; *) s b.
Graph gr =&gt;
Node -&gt; gr s b -&gt; (Context s b, gr s b)
</span><a href="GHC.Data.Graph.Collapse.html#forceMatch"><span class="hs-identifier hs-var">forceMatch</span></a></span><span> </span><span class="annot"><span class="annottext">Node
</span><a href="#local-6989586621682511539"><span class="hs-identifier hs-var">node</span></a></span><span> </span><span class="annot"><span class="annottext">gr s b
</span><a href="#local-6989586621682511540"><span class="hs-identifier hs-var">g</span></a></span><span>
</span><span id="line-205"></span><span>        </span><span class="annot"><a href="#local-6989586621682511546"><span class="hs-identifier hs-type">newNodes</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><span class="hs-special">(</span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621682511261"><span class="hs-identifier hs-type">b</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Data.Graph.Inductive.Graph.html#Node"><span class="hs-identifier hs-type">Node</span></a></span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Data.Graph.Inductive.Graph.html#Node"><span class="hs-identifier hs-type">Node</span></a></span><span class="hs-special">)</span><span class="hs-special">]</span><span>
</span><span id="line-206"></span><span>        </span><span id="local-6989586621682511546"><span class="annot"><span class="annottext">newNodes :: [((b, Node), Node)]
</span><a href="#local-6989586621682511546"><span class="hs-identifier hs-var hs-var">newNodes</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[(b, Node)] -&gt; [Node] -&gt; [((b, Node), Node)]
forall a b. [a] -&gt; [b] -&gt; [(a, b)]
</span><span class="hs-identifier hs-var">zip</span></span><span> </span><span class="annot"><span class="annottext">[(b, Node)]
</span><a href="#local-6989586621682511542"><span class="hs-identifier hs-var">preds</span></a></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">Node
</span><a href="#local-6989586621682511549"><span class="hs-identifier hs-var">maxNode</span></a></span><span class="annot"><span class="annottext">Node -&gt; Node -&gt; Node
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">+</span></span><span class="annot"><span class="annottext">Node
</span><span class="hs-number">1</span></span><span class="hs-glyph">..</span><span class="hs-special">]</span><span>
</span><span id="line-207"></span><span>        </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Node
</span><span class="hs-identifier">_</span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682511549"><span class="annot"><span class="annottext">Node
</span><a href="#local-6989586621682511549"><span class="hs-identifier hs-var">maxNode</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">gr s b -&gt; (Node, Node)
forall a b. gr a b -&gt; (Node, Node)
forall (gr :: * -&gt; * -&gt; *) a b. Graph gr =&gt; gr a b -&gt; (Node, Node)
</span><a href="GHC.Data.Graph.Inductive.Graph.html#nodeRange"><span class="hs-identifier hs-var">nodeRange</span></a></span><span> </span><span class="annot"><span class="annottext">gr s b
</span><a href="#local-6989586621682511540"><span class="hs-identifier hs-var">g</span></a></span><span>
</span><span id="line-208"></span><span>        </span><span id="local-6989586621682511552"><span class="annot"><span class="annottext">thisLabel :: Label
</span><a href="#local-6989586621682511552"><span class="hs-identifier hs-var hs-var">thisLabel</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">s -&gt; Label
forall node. PureSupernode node =&gt; node -&gt; Label
</span><a href="GHC.Data.Graph.Collapse.html#superLabel"><span class="hs-identifier hs-var">superLabel</span></a></span><span> </span><span class="annot"><span class="annottext">s
</span><a href="#local-6989586621682511547"><span class="hs-identifier hs-var">this</span></a></span><span>
</span><span id="line-209"></span><span>        </span><span class="annot"><a href="#local-6989586621682511544"><span class="hs-identifier hs-type">addReplica</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="#local-6989586621682511258"><span class="hs-identifier hs-type">gr</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682511259"><span class="hs-identifier hs-type">s</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682511261"><span class="hs-identifier hs-type">b</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621682511261"><span class="hs-identifier hs-type">b</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Data.Graph.Inductive.Graph.html#Node"><span class="hs-identifier hs-type">Node</span></a></span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Data.Graph.Inductive.Graph.html#Node"><span class="hs-identifier hs-type">Node</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621682511260"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621682511258"><span class="hs-identifier hs-type">gr</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682511259"><span class="hs-identifier hs-type">s</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682511261"><span class="hs-identifier hs-type">b</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-210"></span><span>        </span><span id="local-6989586621682511544"><span class="annot"><span class="annottext">addReplica :: gr s b -&gt; ((b, Node), Node) -&gt; m (gr s b)
</span><a href="#local-6989586621682511544"><span class="hs-identifier hs-var hs-var">addReplica</span></a></span></span><span> </span><span id="local-6989586621682511553"><span class="annot"><span class="annottext">gr s b
</span><a href="#local-6989586621682511553"><span class="hs-identifier hs-var">g</span></a></span></span><span> </span><span class="hs-special">(</span><span class="hs-special">(</span><span id="local-6989586621682511554"><span class="annot"><span class="annottext">b
</span><a href="#local-6989586621682511554"><span class="hs-identifier hs-var">b</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682511555"><span class="annot"><span class="annottext">Node
</span><a href="#local-6989586621682511555"><span class="hs-identifier hs-var">pred</span></a></span></span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span id="local-6989586621682511556"><span class="annot"><span class="annottext">Node
</span><a href="#local-6989586621682511556"><span class="hs-identifier hs-var">newNode</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-211"></span><span>            </span><span id="local-6989586621682511557"><span class="annot"><a href="#local-6989586621682511557"><span class="hs-identifier hs-var">newSuper</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">s -&gt; m s
forall node (m :: * -&gt; *). Supernode node m =&gt; node -&gt; m node
</span><a href="GHC.Data.Graph.Collapse.html#freshen"><span class="hs-identifier hs-var">freshen</span></a></span><span> </span><span class="annot"><span class="annottext">s
</span><a href="#local-6989586621682511547"><span class="hs-identifier hs-var">this</span></a></span><span>
</span><span id="line-212"></span><span>            </span><span class="annot"><span class="hs-identifier hs-type">return</span></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="annot"><a href="#local-6989586621682511558"><span class="hs-identifier hs-type">add</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682511557"><span class="hs-identifier hs-type">newSuper</span></a></span><span>
</span><span id="line-213"></span><span>          </span><span class="hs-keyword">where</span><span> </span><span id="local-6989586621682511558"><span class="annot"><span class="annottext">add :: s -&gt; gr s b
</span><a href="#local-6989586621682511558"><span class="hs-identifier hs-var hs-var">add</span></a></span></span><span> </span><span id="local-6989586621682511559"><span class="annot"><span class="annottext">s
</span><a href="#local-6989586621682511559"><span class="hs-identifier hs-var">newSuper</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-214"></span><span>                  </span><span class="annot"><span class="annottext">(s -&gt; s) -&gt; Node -&gt; gr s b -&gt; gr s b
forall (gr :: * -&gt; * -&gt; *) s b.
DynGraph gr =&gt;
(s -&gt; s) -&gt; Node -&gt; gr s b -&gt; gr s b
</span><a href="GHC.Data.Graph.Collapse.html#updateNode"><span class="hs-identifier hs-var">updateNode</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Label
</span><a href="#local-6989586621682511552"><span class="hs-identifier hs-var">thisLabel</span></a></span><span> </span><span class="annot"><span class="annottext">Label -&gt; Label -&gt; s -&gt; s
forall s. PureSupernode s =&gt; Label -&gt; Label -&gt; s -&gt; s
</span><a href="GHC.Data.Graph.Collapse.html#replacedWith"><span class="hs-operator hs-var">`replacedWith`</span></a></span><span> </span><span class="annot"><span class="annottext">s -&gt; Label
forall node. PureSupernode node =&gt; node -&gt; Label
</span><a href="GHC.Data.Graph.Collapse.html#superLabel"><span class="hs-identifier hs-var">superLabel</span></a></span><span> </span><span class="annot"><span class="annottext">s
</span><a href="#local-6989586621682511559"><span class="hs-identifier hs-var">newSuper</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Node
</span><a href="#local-6989586621682511555"><span class="hs-identifier hs-var">pred</span></a></span><span> </span><span class="annot"><span class="annottext">(gr s b -&gt; gr s b) -&gt; gr s b -&gt; gr s b
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-215"></span><span>                  </span><span class="hs-special">(</span><span class="hs-special">[</span><span class="hs-special">(</span><span class="annot"><span class="annottext">b
</span><a href="#local-6989586621682511554"><span class="hs-identifier hs-var">b</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Node
</span><a href="#local-6989586621682511555"><span class="hs-identifier hs-var">pred</span></a></span><span class="hs-special">)</span><span class="hs-special">]</span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Node
</span><a href="#local-6989586621682511556"><span class="hs-identifier hs-var">newNode</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">s
</span><a href="#local-6989586621682511559"><span class="hs-identifier hs-var">newSuper</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">[(b, Node)]
</span><a href="#local-6989586621682511548"><span class="hs-identifier hs-var">succs</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Context s b -&gt; gr s b -&gt; gr s b
forall a b. Context a b -&gt; gr a b -&gt; gr a b
forall (gr :: * -&gt; * -&gt; *) a b.
DynGraph gr =&gt;
Context a b -&gt; gr a b -&gt; gr a b
</span><a href="GHC.Data.Graph.Inductive.Graph.html#%26"><span class="hs-operator hs-var">&amp;</span></a></span><span> </span><span class="annot"><span class="annottext">gr s b
</span><a href="#local-6989586621682511553"><span class="hs-identifier hs-var">g</span></a></span><span>
</span><span id="line-216"></span><span>
</span><span id="line-217"></span><span id="local-6989586621682511278"><span class="annot"><a href="GHC.Data.Graph.Collapse.html#replacedWith"><span class="hs-identifier hs-type">replacedWith</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Data.Graph.Collapse.html#PureSupernode"><span class="hs-identifier hs-type">PureSupernode</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682511278"><span class="hs-identifier hs-type">s</span></a></span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="GHC.Cmm.Dataflow.Label.html#Label"><span class="hs-identifier hs-type">Label</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Cmm.Dataflow.Label.html#Label"><span class="hs-identifier hs-type">Label</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621682511278"><span class="hs-identifier hs-type">s</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621682511278"><span class="hs-identifier hs-type">s</span></a></span></span><span>
</span><span id="line-218"></span><span id="replacedWith"><span class="annot"><span class="annottext">replacedWith :: forall s. PureSupernode s =&gt; Label -&gt; Label -&gt; s -&gt; s
</span><a href="GHC.Data.Graph.Collapse.html#replacedWith"><span class="hs-identifier hs-var hs-var">replacedWith</span></a></span></span><span> </span><span id="local-6989586621682511565"><span class="annot"><span class="annottext">Label
</span><a href="#local-6989586621682511565"><span class="hs-identifier hs-var">old</span></a></span></span><span> </span><span id="local-6989586621682511566"><span class="annot"><span class="annottext">Label
</span><a href="#local-6989586621682511566"><span class="hs-identifier hs-var">new</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(Label -&gt; Label) -&gt; s -&gt; s
forall node. PureSupernode node =&gt; (Label -&gt; Label) -&gt; node -&gt; node
</span><a href="GHC.Data.Graph.Collapse.html#mapLabels"><span class="hs-identifier hs-var">mapLabels</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span id="local-6989586621682511567"><span class="annot"><span class="annottext">Label
</span><a href="#local-6989586621682511567"><span class="hs-identifier hs-var">l</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">if</span><span> </span><span class="annot"><span class="annottext">Label
</span><a href="#local-6989586621682511567"><span class="hs-identifier hs-var">l</span></a></span><span> </span><span class="annot"><span class="annottext">Label -&gt; Label -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">==</span></span><span> </span><span class="annot"><span class="annottext">Label
</span><a href="#local-6989586621682511565"><span class="hs-identifier hs-var">old</span></a></span><span> </span><span class="hs-keyword">then</span><span> </span><span class="annot"><span class="annottext">Label
</span><a href="#local-6989586621682511566"><span class="hs-identifier hs-var">new</span></a></span><span> </span><span class="hs-keyword">else</span><span> </span><span class="annot"><span class="annottext">Label
</span><a href="#local-6989586621682511567"><span class="hs-identifier hs-var">l</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-219"></span><span>
</span><span id="line-220"></span><span>
</span><span id="line-221"></span><span class="annot"><span class="hs-comment">-- | Does a list have more than one element? (in constant time).</span></span><span>
</span><span id="line-222"></span><span id="local-6989586621682511266"><span class="annot"><a href="GHC.Data.Graph.Collapse.html#isMultiple"><span class="hs-identifier hs-type">isMultiple</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="#local-6989586621682511266"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Bool</span></span></span><span>
</span><span id="line-223"></span><span id="isMultiple"><span class="annot"><span class="annottext">isMultiple :: forall a. [a] -&gt; Bool
</span><a href="GHC.Data.Graph.Collapse.html#isMultiple"><span class="hs-identifier hs-var hs-var">isMultiple</span></a></span></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">False</span></span><span>
</span><span id="line-224"></span><span class="annot"><a href="GHC.Data.Graph.Collapse.html#isMultiple"><span class="hs-identifier hs-var">isMultiple</span></a></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">a
</span><span class="hs-identifier">_</span></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">False</span></span><span>
</span><span id="line-225"></span><span class="annot"><a href="GHC.Data.Graph.Collapse.html#isMultiple"><span class="hs-identifier hs-var">isMultiple</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">a
</span><span class="hs-identifier">_</span></span><span class="annot"><span class="hs-glyph hs-type">:</span></span><span class="annot"><span class="annottext">a
</span><span class="hs-identifier">_</span></span><span class="annot"><span class="hs-glyph hs-type">:</span></span><span class="annot"><span class="annottext">[a]
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">True</span></span><span>
</span><span id="line-226"></span><span>
</span><span id="line-227"></span><span class="annot"><span class="hs-comment">-- | Find a candidate for splitting by finding a node that has multiple predecessors.</span></span><span>
</span><span id="line-228"></span><span>
</span><span id="line-229"></span><span class="annot"><a href="GHC.Data.Graph.Collapse.html#anySplittable"><span class="hs-identifier hs-type">anySplittable</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-keyword">forall</span><span> </span><span id="local-6989586621682511281"><span class="annot"><a href="#local-6989586621682511281"><span class="hs-identifier hs-type">gr</span></a></span></span><span> </span><span id="local-6989586621682511282"><span class="annot"><a href="#local-6989586621682511282"><span class="hs-identifier hs-type">a</span></a></span></span><span> </span><span id="local-6989586621682511283"><span class="annot"><a href="#local-6989586621682511283"><span class="hs-identifier hs-type">b</span></a></span></span><span> </span><span class="hs-operator">.</span><span> </span><span class="annot"><a href="GHC.Data.Graph.Inductive.Graph.html#Graph"><span class="hs-identifier hs-type">Graph</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682511281"><span class="hs-identifier hs-type">gr</span></a></span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="#local-6989586621682511281"><span class="hs-identifier hs-type">gr</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682511282"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682511283"><span class="hs-identifier hs-type">b</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Data.Graph.Inductive.Graph.html#LNode"><span class="hs-identifier hs-type">LNode</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682511282"><span class="hs-identifier hs-type">a</span></a></span><span>
</span><span id="line-230"></span><span id="anySplittable"><span class="annot"><span class="annottext">anySplittable :: forall (gr :: * -&gt; * -&gt; *) a b. Graph gr =&gt; gr a b -&gt; LNode a
</span><a href="GHC.Data.Graph.Collapse.html#anySplittable"><span class="hs-identifier hs-var hs-var">anySplittable</span></a></span></span><span> </span><span id="local-6989586621682511574"><span class="annot"><span class="annottext">gr a b
</span><a href="#local-6989586621682511574"><span class="hs-identifier hs-var">g</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">[LNode a]
</span><a href="#local-6989586621682511575"><span class="hs-identifier hs-var">splittable</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-231"></span><span>                    </span><span id="local-6989586621682511576"><span class="annot"><span class="annottext">LNode a
</span><a href="#local-6989586621682511576"><span class="hs-identifier hs-var">n</span></a></span></span><span> </span><span class="annot"><span class="hs-glyph hs-type">:</span></span><span> </span><span class="annot"><span class="annottext">[LNode a]
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">LNode a
</span><a href="#local-6989586621682511576"><span class="hs-identifier hs-var">n</span></a></span><span>
</span><span id="line-232"></span><span>                    </span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">String -&gt; LNode a
forall a. HasCallStack =&gt; String -&gt; a
</span><a href="GHC.Utils.Panic.Plain.html#panic"><span class="hs-identifier hs-var">panic</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;anySplittable found no splittable nodes&quot;</span></span><span>
</span><span id="line-233"></span><span>  </span><span class="hs-keyword">where</span><span> </span><span id="local-6989586621682511575"><span class="annot"><span class="annottext">splittable :: [LNode a]
</span><a href="#local-6989586621682511575"><span class="hs-identifier hs-var hs-var">splittable</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(LNode a -&gt; Bool) -&gt; [LNode a] -&gt; [LNode a]
forall a. (a -&gt; Bool) -&gt; [a] -&gt; [a]
</span><span class="hs-identifier hs-var">filter</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[Node] -&gt; Bool
forall a. [a] -&gt; Bool
</span><a href="GHC.Data.Graph.Collapse.html#isMultiple"><span class="hs-identifier hs-var">isMultiple</span></a></span><span> </span><span class="annot"><span class="annottext">([Node] -&gt; Bool) -&gt; (LNode a -&gt; [Node]) -&gt; LNode a -&gt; Bool
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">gr a b -&gt; Node -&gt; [Node]
forall (gr :: * -&gt; * -&gt; *) a b.
Graph gr =&gt;
gr a b -&gt; Node -&gt; [Node]
</span><a href="GHC.Data.Graph.Inductive.Graph.html#pre"><span class="hs-identifier hs-var">pre</span></a></span><span> </span><span class="annot"><span class="annottext">gr a b
</span><a href="#local-6989586621682511574"><span class="hs-identifier hs-var">g</span></a></span><span> </span><span class="annot"><span class="annottext">(Node -&gt; [Node]) -&gt; (LNode a -&gt; Node) -&gt; LNode a -&gt; [Node]
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">LNode a -&gt; Node
forall a b. (a, b) -&gt; a
</span><span class="hs-identifier hs-var">fst</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">([LNode a] -&gt; [LNode a]) -&gt; [LNode a] -&gt; [LNode a]
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">gr a b -&gt; [LNode a]
forall a b. gr a b -&gt; [LNode a]
forall (gr :: * -&gt; * -&gt; *) a b. Graph gr =&gt; gr a b -&gt; [LNode a]
</span><a href="GHC.Data.Graph.Inductive.Graph.html#labNodes"><span class="hs-identifier hs-var">labNodes</span></a></span><span> </span><span class="annot"><span class="annottext">gr a b
</span><a href="#local-6989586621682511574"><span class="hs-identifier hs-var">g</span></a></span><span>
</span><span id="line-234"></span><span>        </span><span class="annot"><a href="#local-6989586621682511575"><span class="hs-identifier hs-type">splittable</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="GHC.Data.Graph.Inductive.Graph.html#LNode"><span class="hs-identifier hs-type">LNode</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682511282"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-235"></span><span>
</span><span id="line-236"></span><span>
</span><span id="line-237"></span><span class="hs-comment">------------------ The collapsing algorithm -----------------------</span><span>
</span><span id="line-238"></span><span>
</span><span id="line-239"></span><span class="hs-comment">-- | Using the algorithm of Hecht and Ullman (1972), collapse a graph</span><span>
</span><span id="line-240"></span><span class="hs-comment">-- into a single node, splitting nodes as needed.  Record</span><span>
</span><span id="line-241"></span><span class="hs-comment">-- visualization events in monad `m`.</span><span>
</span><span id="line-242"></span><span id="local-6989586621682511295"><span id="local-6989586621682511296"><span id="local-6989586621682511297"><span class="annot"><a href="GHC.Data.Graph.Collapse.html#collapseInductiveGraph"><span class="hs-identifier hs-type">collapseInductiveGraph</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Data.Graph.Inductive.Graph.html#DynGraph"><span class="hs-identifier hs-type">DynGraph</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682511295"><span class="hs-identifier hs-type">gr</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Data.Graph.Collapse.html#Supernode"><span class="hs-identifier hs-type">Supernode</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682511296"><span class="hs-identifier hs-type">s</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682511297"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Data.Graph.Collapse.html#VizCollapseMonad"><span class="hs-identifier hs-type">VizCollapseMonad</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682511297"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682511295"><span class="hs-identifier hs-type">gr</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682511296"><span class="hs-identifier hs-type">s</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-243"></span><span>                       </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="#local-6989586621682511295"><span class="hs-identifier hs-type">gr</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682511296"><span class="hs-identifier hs-type">s</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621682511297"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621682511295"><span class="hs-identifier hs-type">gr</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682511296"><span class="hs-identifier hs-type">s</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span class="hs-special">)</span></span></span></span><span>
</span><span id="line-244"></span><span id="collapseInductiveGraph"><span class="annot"><span class="annottext">collapseInductiveGraph :: forall (gr :: * -&gt; * -&gt; *) s (m :: * -&gt; *).
(DynGraph gr, Supernode s m, VizCollapseMonad m gr s) =&gt;
gr s () -&gt; m (gr s ())
</span><a href="GHC.Data.Graph.Collapse.html#collapseInductiveGraph"><span class="hs-identifier hs-var hs-var">collapseInductiveGraph</span></a></span></span><span> </span><span id="local-6989586621682511588"><span class="annot"><span class="annottext">gr s ()
</span><a href="#local-6989586621682511588"><span class="hs-identifier hs-var">g</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">gr s () -&gt; [[Node]] -&gt; m (gr s ())
forall {gr :: * -&gt; * -&gt; *} {m :: * -&gt; *} {s}.
(VizCollapseMonad m gr s, DynGraph gr) =&gt;
gr s () -&gt; [[Node]] -&gt; m (gr s ())
</span><a href="#local-6989586621682511589"><span class="hs-identifier hs-var">drain</span></a></span><span> </span><span class="annot"><span class="annottext">gr s ()
</span><a href="#local-6989586621682511588"><span class="hs-identifier hs-var">g</span></a></span><span> </span><span class="annot"><span class="annottext">[[Node]]
</span><a href="#local-6989586621682511590"><span class="hs-identifier hs-var">worklist</span></a></span><span>
</span><span id="line-245"></span><span>  </span><span class="hs-keyword">where</span><span> </span><span class="annot"><a href="#local-6989586621682511590"><span class="hs-identifier hs-type">worklist</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><span class="hs-special">[</span><span class="annot"><a href="GHC.Data.Graph.Inductive.Graph.html#Node"><span class="hs-identifier hs-type">Node</span></a></span><span class="hs-special">]</span><span class="hs-special">]</span><span> </span><span class="hs-comment">-- nodes with exactly one predecessor</span><span>
</span><span id="line-246"></span><span>        </span><span id="local-6989586621682511590"><span class="annot"><span class="annottext">worklist :: [[Node]]
</span><a href="#local-6989586621682511590"><span class="hs-identifier hs-var hs-var">worklist</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">(Node -&gt; Bool) -&gt; [Node] -&gt; [Node]
forall a. (a -&gt; Bool) -&gt; [a] -&gt; [a]
</span><span class="hs-identifier hs-var">filter</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">gr s () -&gt; Node -&gt; Bool
forall (gr :: * -&gt; * -&gt; *) a b. Graph gr =&gt; gr a b -&gt; Node -&gt; Bool
</span><a href="GHC.Data.Graph.Collapse.html#singlePred"><span class="hs-identifier hs-var">singlePred</span></a></span><span> </span><span class="annot"><span class="annottext">gr s ()
</span><a href="#local-6989586621682511588"><span class="hs-identifier hs-var">g</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">([Node] -&gt; [Node]) -&gt; [Node] -&gt; [Node]
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">gr s () -&gt; [Node]
forall (gr :: * -&gt; * -&gt; *) a b. Graph gr =&gt; gr a b -&gt; [Node]
</span><a href="GHC.Data.Graph.Inductive.Graph.html#nodes"><span class="hs-identifier hs-var">nodes</span></a></span><span> </span><span class="annot"><span class="annottext">gr s ()
</span><a href="#local-6989586621682511588"><span class="hs-identifier hs-var">g</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-247"></span><span>
</span><span id="line-248"></span><span>        </span><span id="local-6989586621682511589"><span class="annot"><span class="annottext">drain :: gr s () -&gt; [[Node]] -&gt; m (gr s ())
</span><a href="#local-6989586621682511589"><span class="hs-identifier hs-var hs-var">drain</span></a></span></span><span> </span><span id="local-6989586621682511648"><span class="annot"><span class="annottext">gr s ()
</span><a href="#local-6989586621682511648"><span class="hs-identifier hs-var">g</span></a></span></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">if</span><span> </span><span class="annot"><span class="annottext">gr s () -&gt; Bool
forall (gr :: * -&gt; * -&gt; *) a b. Graph gr =&gt; gr a b -&gt; Bool
</span><a href="GHC.Data.Graph.Collapse.html#singletonGraph"><span class="hs-identifier hs-var">singletonGraph</span></a></span><span> </span><span class="annot"><span class="annottext">gr s ()
</span><a href="#local-6989586621682511648"><span class="hs-identifier hs-var">g</span></a></span><span> </span><span class="hs-keyword">then</span><span> </span><span class="annot"><span class="annottext">gr s () -&gt; m ()
forall (m :: * -&gt; *) (gr :: * -&gt; * -&gt; *) s.
VizCollapseMonad m gr s =&gt;
gr s () -&gt; m ()
</span><a href="GHC.Data.Graph.Collapse.html#finalGraph"><span class="hs-identifier hs-var">finalGraph</span></a></span><span> </span><span class="annot"><span class="annottext">gr s ()
</span><a href="#local-6989586621682511648"><span class="hs-identifier hs-var">g</span></a></span><span> </span><span class="annot"><span class="annottext">m () -&gt; m (gr s ()) -&gt; m (gr s ())
forall a b. m a -&gt; m b -&gt; m b
forall (m :: * -&gt; *) a b. Monad m =&gt; m a -&gt; m b -&gt; m b
</span><span class="hs-operator hs-var">&gt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">gr s () -&gt; m (gr s ())
forall a. a -&gt; m a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="annot"><span class="annottext">gr s ()
</span><a href="#local-6989586621682511648"><span class="hs-identifier hs-var">g</span></a></span><span>
</span><span id="line-249"></span><span>                     </span><span class="hs-keyword">else</span><span> </span><span class="hs-keyword">let</span><span> </span><span class="hs-special">(</span><span id="local-6989586621682511649"><span class="annot"><span class="annottext">Node
</span><a href="#local-6989586621682511649"><span class="hs-identifier hs-var">n</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682511650"><span class="annot"><span class="annottext">s
</span><a href="#local-6989586621682511650"><span class="hs-identifier hs-var">super</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">gr s () -&gt; (Node, s)
forall (gr :: * -&gt; * -&gt; *) a b. Graph gr =&gt; gr a b -&gt; LNode a
</span><a href="GHC.Data.Graph.Collapse.html#anySplittable"><span class="hs-identifier hs-var">anySplittable</span></a></span><span> </span><span class="annot"><span class="annottext">gr s ()
</span><a href="#local-6989586621682511648"><span class="hs-identifier hs-var">g</span></a></span><span>
</span><span id="line-250"></span><span>                          </span><span class="hs-keyword">in</span><span>  </span><span class="hs-keyword">do</span><span> </span><span class="annot"><span class="annottext">gr s () -&gt; (Node, s) -&gt; m ()
forall (m :: * -&gt; *) (gr :: * -&gt; * -&gt; *) s.
VizCollapseMonad m gr s =&gt;
gr s () -&gt; LNode s -&gt; m ()
</span><a href="GHC.Data.Graph.Collapse.html#splitGraphAt"><span class="hs-identifier hs-var">splitGraphAt</span></a></span><span> </span><span class="annot"><span class="annottext">gr s ()
</span><a href="#local-6989586621682511648"><span class="hs-identifier hs-var">g</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Node
</span><a href="#local-6989586621682511649"><span class="hs-identifier hs-var">n</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">s
</span><a href="#local-6989586621682511650"><span class="hs-identifier hs-var">super</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-251"></span><span>                                 </span><span class="annot"><span class="annottext">gr s () -&gt; m (gr s ())
forall (gr :: * -&gt; * -&gt; *) s (m :: * -&gt; *).
(DynGraph gr, Supernode s m, VizCollapseMonad m gr s) =&gt;
gr s () -&gt; m (gr s ())
</span><a href="GHC.Data.Graph.Collapse.html#collapseInductiveGraph"><span class="hs-identifier hs-var">collapseInductiveGraph</span></a></span><span> </span><span class="annot"><span class="annottext">(gr s () -&gt; m (gr s ())) -&gt; m (gr s ()) -&gt; m (gr s ())
forall (m :: * -&gt; *) a b. Monad m =&gt; (a -&gt; m b) -&gt; m a -&gt; m b
</span><span class="hs-operator hs-var">=&lt;&lt;</span></span><span> </span><span class="annot"><span class="annottext">Node -&gt; gr s () -&gt; m (gr s ())
forall (gr :: * -&gt; * -&gt; *) s b (m :: * -&gt; *).
(DynGraph gr, Supernode s m) =&gt;
Node -&gt; gr s b -&gt; m (gr s b)
</span><a href="GHC.Data.Graph.Collapse.html#split"><span class="hs-identifier hs-var">split</span></a></span><span> </span><span class="annot"><span class="annottext">Node
</span><a href="#local-6989586621682511649"><span class="hs-identifier hs-var">n</span></a></span><span> </span><span class="annot"><span class="annottext">gr s ()
</span><a href="#local-6989586621682511648"><span class="hs-identifier hs-var">g</span></a></span><span>
</span><span id="line-252"></span><span>        </span><span class="annot"><a href="#local-6989586621682511589"><span class="hs-identifier hs-var">drain</span></a></span><span> </span><span id="local-6989586621682511652"><span class="annot"><span class="annottext">gr s ()
</span><a href="#local-6989586621682511652"><span class="hs-identifier hs-var">g</span></a></span></span><span> </span><span class="hs-special">(</span><span class="hs-special">[</span><span class="hs-special">]</span><span class="annot"><span class="hs-glyph hs-type">:</span></span><span id="local-6989586621682511653"><span class="annot"><span class="annottext">[[Node]]
</span><a href="#local-6989586621682511653"><span class="hs-identifier hs-var">nss</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">gr s () -&gt; [[Node]] -&gt; m (gr s ())
</span><a href="#local-6989586621682511589"><span class="hs-identifier hs-var">drain</span></a></span><span> </span><span class="annot"><span class="annottext">gr s ()
</span><a href="#local-6989586621682511652"><span class="hs-identifier hs-var">g</span></a></span><span> </span><span class="annot"><span class="annottext">[[Node]]
</span><a href="#local-6989586621682511653"><span class="hs-identifier hs-var">nss</span></a></span><span>
</span><span id="line-253"></span><span>        </span><span class="annot"><a href="#local-6989586621682511589"><span class="hs-identifier hs-var">drain</span></a></span><span> </span><span id="local-6989586621682511654"><span class="annot"><span class="annottext">gr s ()
</span><a href="#local-6989586621682511654"><span class="hs-identifier hs-var">g</span></a></span></span><span> </span><span class="hs-special">(</span><span class="hs-special">(</span><span id="local-6989586621682511655"><span class="annot"><span class="annottext">Node
</span><a href="#local-6989586621682511655"><span class="hs-identifier hs-var">n</span></a></span></span><span class="annot"><span class="hs-glyph hs-type">:</span></span><span id="local-6989586621682511656"><span class="annot"><span class="annottext">[Node]
</span><a href="#local-6989586621682511656"><span class="hs-identifier hs-var">ns</span></a></span></span><span class="hs-special">)</span><span class="annot"><span class="hs-glyph hs-type">:</span></span><span id="local-6989586621682511657"><span class="annot"><span class="annottext">[[Node]]
</span><a href="#local-6989586621682511657"><span class="hs-identifier hs-var">nss</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">let</span><span> </span><span class="hs-special">(</span><span id="local-6989586621682511658"><span class="annot"><span class="annottext">gr s ()
</span><a href="#local-6989586621682511658"><span class="hs-identifier hs-var">g'</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682511659"><span class="annot"><span class="annottext">[Node]
</span><a href="#local-6989586621682511659"><span class="hs-identifier hs-var">ns'</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Node -&gt; Node -&gt; gr s () -&gt; (gr s (), [Node])
forall (gr :: * -&gt; * -&gt; *) s.
(DynGraph gr, PureSupernode s) =&gt;
Node -&gt; Node -&gt; gr s () -&gt; (gr s (), [Node])
</span><a href="GHC.Data.Graph.Collapse.html#consumeBy"><span class="hs-identifier hs-var">consumeBy</span></a></span><span> </span><span class="annot"><span class="annottext">Node
</span><a href="#local-6989586621682511655"><span class="hs-identifier hs-var">n</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Node -&gt; Node
</span><a href="#local-6989586621682511660"><span class="hs-identifier hs-var">theUniquePred</span></a></span><span> </span><span class="annot"><span class="annottext">Node
</span><a href="#local-6989586621682511655"><span class="hs-identifier hs-var">n</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">gr s ()
</span><a href="#local-6989586621682511654"><span class="hs-identifier hs-var">g</span></a></span><span>
</span><span id="line-254"></span><span>                               </span><span class="hs-keyword">in</span><span>  </span><span class="hs-keyword">do</span><span> </span><span class="annot"><span class="annottext">Node -&gt; Node -&gt; gr s () -&gt; m ()
forall (m :: * -&gt; *) (gr :: * -&gt; * -&gt; *) s.
VizCollapseMonad m gr s =&gt;
Node -&gt; Node -&gt; gr s () -&gt; m ()
</span><a href="GHC.Data.Graph.Collapse.html#consumeByInGraph"><span class="hs-identifier hs-var">consumeByInGraph</span></a></span><span> </span><span class="annot"><span class="annottext">Node
</span><a href="#local-6989586621682511655"><span class="hs-identifier hs-var">n</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Node -&gt; Node
</span><a href="#local-6989586621682511660"><span class="hs-identifier hs-var">theUniquePred</span></a></span><span> </span><span class="annot"><span class="annottext">Node
</span><a href="#local-6989586621682511655"><span class="hs-identifier hs-var">n</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">gr s ()
</span><a href="#local-6989586621682511654"><span class="hs-identifier hs-var">g</span></a></span><span>
</span><span id="line-255"></span><span>                                      </span><span class="annot"><span class="annottext">gr s () -&gt; [[Node]] -&gt; m (gr s ())
</span><a href="#local-6989586621682511589"><span class="hs-identifier hs-var">drain</span></a></span><span> </span><span class="annot"><span class="annottext">gr s ()
</span><a href="#local-6989586621682511658"><span class="hs-identifier hs-var">g'</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[Node]
</span><a href="#local-6989586621682511659"><span class="hs-identifier hs-var">ns'</span></a></span><span class="annot"><span class="annottext">[Node] -&gt; [[Node]] -&gt; [[Node]]
forall a. a -&gt; [a] -&gt; [a]
</span><span class="hs-glyph hs-var">:</span></span><span class="annot"><span class="annottext">[Node]
</span><a href="#local-6989586621682511656"><span class="hs-identifier hs-var">ns</span></a></span><span class="annot"><span class="annottext">[Node] -&gt; [[Node]] -&gt; [[Node]]
forall a. a -&gt; [a] -&gt; [a]
</span><span class="hs-glyph hs-var">:</span></span><span class="annot"><span class="annottext">[[Node]]
</span><a href="#local-6989586621682511657"><span class="hs-identifier hs-var">nss</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-256"></span><span>         </span><span class="hs-keyword">where</span><span> </span><span id="local-6989586621682511660"><span class="annot"><span class="annottext">theUniquePred :: Node -&gt; Node
</span><a href="#local-6989586621682511660"><span class="hs-identifier hs-var hs-var">theUniquePred</span></a></span></span><span> </span><span id="local-6989586621682511661"><span class="annot"><span class="annottext">Node
</span><a href="#local-6989586621682511661"><span class="hs-identifier hs-var">n</span></a></span></span><span>
</span><span id="line-257"></span><span>                 </span><span class="hs-glyph">|</span><span> </span><span class="hs-special">(</span><span class="hs-special">[</span><span class="hs-special">(</span><span class="annot"><span class="annottext">()
</span><span class="hs-identifier">_</span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682511662"><span class="annot"><span class="annottext">Node
</span><a href="#local-6989586621682511662"><span class="hs-identifier hs-var">p</span></a></span></span><span class="hs-special">)</span><span class="hs-special">]</span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Node
</span><span class="hs-identifier">_</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">s
</span><span class="hs-identifier">_</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Adj ()
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">gr s () -&gt; Node -&gt; (Adj (), Node, s, Adj ())
forall (gr :: * -&gt; * -&gt; *) a b.
Graph gr =&gt;
gr a b -&gt; Node -&gt; Context a b
</span><a href="GHC.Data.Graph.Inductive.Graph.html#context"><span class="hs-identifier hs-var">context</span></a></span><span> </span><span class="annot"><span class="annottext">gr s ()
</span><a href="#local-6989586621682511654"><span class="hs-identifier hs-var">g</span></a></span><span> </span><span class="annot"><span class="annottext">Node
</span><a href="#local-6989586621682511661"><span class="hs-identifier hs-var">n</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Node
</span><a href="#local-6989586621682511662"><span class="hs-identifier hs-var">p</span></a></span><span>
</span><span id="line-258"></span><span>                 </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">otherwise</span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-259"></span><span>                     </span><span class="annot"><span class="annottext">String -&gt; Node
forall a. HasCallStack =&gt; String -&gt; a
</span><a href="GHC.Utils.Panic.Plain.html#panic"><span class="hs-identifier hs-var">panic</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;node claimed to have a unique predecessor; it doesn't&quot;</span></span><span>
</span><span id="line-260"></span></pre></body></html>