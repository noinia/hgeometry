<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><link rel="stylesheet" type="text/css" href="style.css" /><script type="text/javascript" src="highlight.js"></script></head><body><pre><span class="hs-pragma">{-# LANGUAGE LambdaCase      #-}</span><span>
</span><span id="line-2"></span><span class="hs-pragma">{-# LANGUAGE MultiWayIf      #-}</span><span>
</span><span id="line-3"></span><span class="hs-pragma">{-# LANGUAGE RecursiveDo     #-}</span><span>
</span><span id="line-4"></span><span class="hs-pragma">{-# LANGUAGE TupleSections   #-}</span><span>
</span><span id="line-5"></span><span>
</span><span id="line-6"></span><span class="hs-pragma">{-# OPTIONS_GHC -Wno-incomplete-record-updates #-}</span><span>
</span><span id="line-7"></span><span class="hs-comment">{-
(c) The University of Glasgow 2006
(c) The GRASP/AQUA Project, Glasgow University, 1992-1998

-}</span><span>
</span><span id="line-12"></span><span>
</span><span id="line-13"></span><span class="hs-comment">-- | Monadic type operations</span><span>
</span><span id="line-14"></span><span class="hs-comment">--</span><span>
</span><span id="line-15"></span><span class="hs-comment">-- This module contains monadic operations over types that contain mutable type</span><span>
</span><span id="line-16"></span><span class="hs-comment">-- variables.</span><span>
</span><span id="line-17"></span><span class="hs-keyword">module</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.TcMType.html"><span class="hs-identifier">GHC.Tc.Utils.TcMType</span></a></span><span> </span><span class="hs-special">(</span><span>
</span><span id="line-18"></span><span>  </span><span class="annot"><a href="GHC.Types.Var.html#TcTyVar"><span class="hs-identifier">TcTyVar</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.TcType.html#TcKind"><span class="hs-identifier">TcKind</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.TcType.html#TcType"><span class="hs-identifier">TcType</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.TcType.html#TcTauType"><span class="hs-identifier">TcTauType</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.TcType.html#TcThetaType"><span class="hs-identifier">TcThetaType</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.TcType.html#TcTyVarSet"><span class="hs-identifier">TcTyVarSet</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-19"></span><span>
</span><span id="line-20"></span><span>  </span><span class="hs-comment">--------------------------------</span><span>
</span><span id="line-21"></span><span>  </span><span class="hs-comment">-- Creating new mutable type variables</span><span>
</span><span id="line-22"></span><span>  </span><span class="annot"><a href="GHC.Tc.Utils.TcMType.html#newFlexiTyVar"><span class="hs-identifier">newFlexiTyVar</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-23"></span><span>  </span><span class="annot"><a href="GHC.Tc.Utils.TcMType.html#newNamedFlexiTyVar"><span class="hs-identifier">newNamedFlexiTyVar</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-24"></span><span>  </span><span class="annot"><a href="GHC.Tc.Utils.TcMType.html#newFlexiTyVarTy"><span class="hs-identifier">newFlexiTyVarTy</span></a></span><span class="hs-special">,</span><span>              </span><span class="hs-comment">-- Kind -&gt; TcM TcType</span><span>
</span><span id="line-25"></span><span>  </span><span class="annot"><a href="GHC.Tc.Utils.TcMType.html#newFlexiTyVarTys"><span class="hs-identifier">newFlexiTyVarTys</span></a></span><span class="hs-special">,</span><span>             </span><span class="hs-comment">-- Int -&gt; Kind -&gt; TcM [TcType]</span><span>
</span><span id="line-26"></span><span>  </span><span class="annot"><a href="GHC.Tc.Utils.TcMType.html#newOpenFlexiTyVar"><span class="hs-identifier">newOpenFlexiTyVar</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.TcMType.html#newOpenFlexiTyVarTy"><span class="hs-identifier">newOpenFlexiTyVarTy</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.TcMType.html#newOpenTypeKind"><span class="hs-identifier">newOpenTypeKind</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-27"></span><span>  </span><span class="annot"><a href="GHC.Tc.Utils.TcMType.html#newOpenFlexiFRRTyVar"><span class="hs-identifier">newOpenFlexiFRRTyVar</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.TcMType.html#newOpenFlexiFRRTyVarTy"><span class="hs-identifier">newOpenFlexiFRRTyVarTy</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-28"></span><span>  </span><span class="annot"><a href="GHC.Tc.Utils.TcMType.html#newOpenBoxedTypeKind"><span class="hs-identifier">newOpenBoxedTypeKind</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-29"></span><span>  </span><span class="annot"><a href="GHC.Tc.Utils.TcMType.html#newMetaKindVar"><span class="hs-identifier">newMetaKindVar</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.TcMType.html#newMetaKindVars"><span class="hs-identifier">newMetaKindVars</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-30"></span><span>  </span><span class="annot"><a href="GHC.Tc.Utils.TcMType.html#newMetaTyVarTyAtLevel"><span class="hs-identifier">newMetaTyVarTyAtLevel</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.TcMType.html#newConcreteTyVarTyAtLevel"><span class="hs-identifier">newConcreteTyVarTyAtLevel</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.TcMType.html#substConcreteTvOrigin"><span class="hs-identifier">substConcreteTvOrigin</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-31"></span><span>  </span><span class="annot"><a href="GHC.Tc.Utils.TcMType.html#newAnonMetaTyVar"><span class="hs-identifier">newAnonMetaTyVar</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.TcMType.html#newConcreteTyVar"><span class="hs-identifier">newConcreteTyVar</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-32"></span><span>  </span><span class="annot"><a href="GHC.Tc.Utils.TcMType.html#cloneMetaTyVar"><span class="hs-identifier">cloneMetaTyVar</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.TcMType.html#cloneMetaTyVarWithInfo"><span class="hs-identifier">cloneMetaTyVarWithInfo</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-33"></span><span>  </span><span class="annot"><a href="GHC.Tc.Utils.TcMType.html#newCycleBreakerTyVar"><span class="hs-identifier">newCycleBreakerTyVar</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-34"></span><span>
</span><span id="line-35"></span><span>  </span><span class="annot"><a href="GHC.Tc.Utils.TcMType.html#newMultiplicityVar"><span class="hs-identifier">newMultiplicityVar</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-36"></span><span>  </span><span class="annot"><a href="GHC.Tc.Utils.TcMType.html#readMetaTyVar"><span class="hs-identifier">readMetaTyVar</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Tc.Zonk.TcType.html#writeMetaTyVar"><span class="hs-identifier">writeMetaTyVar</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Tc.Zonk.TcType.html#writeMetaTyVarRef"><span class="hs-identifier">writeMetaTyVarRef</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-37"></span><span>  </span><span class="annot"><a href="GHC.Tc.Utils.TcMType.html#newTauTvDetailsAtLevel"><span class="hs-identifier">newTauTvDetailsAtLevel</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.TcMType.html#newMetaDetails"><span class="hs-identifier">newMetaDetails</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.TcMType.html#newMetaTyVarName"><span class="hs-identifier">newMetaTyVarName</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-38"></span><span>  </span><span class="annot"><a href="GHC.Tc.Utils.TcMType.html#isFilledMetaTyVar_maybe"><span class="hs-identifier">isFilledMetaTyVar_maybe</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.TcMType.html#isFilledMetaTyVar"><span class="hs-identifier">isFilledMetaTyVar</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.TcMType.html#isUnfilledMetaTyVar"><span class="hs-identifier">isUnfilledMetaTyVar</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-39"></span><span>
</span><span id="line-40"></span><span>  </span><span class="hs-comment">--------------------------------</span><span>
</span><span id="line-41"></span><span>  </span><span class="hs-comment">-- Creating new evidence variables</span><span>
</span><span id="line-42"></span><span>  </span><span class="annot"><a href="GHC.Tc.Utils.TcMType.html#newEvVar"><span class="hs-identifier">newEvVar</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.TcMType.html#newEvVars"><span class="hs-identifier">newEvVars</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.TcMType.html#newDict"><span class="hs-identifier">newDict</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-43"></span><span>  </span><span class="annot"><a href="GHC.Tc.Utils.TcMType.html#newWantedWithLoc"><span class="hs-identifier">newWantedWithLoc</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.TcMType.html#newWanted"><span class="hs-identifier">newWanted</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.TcMType.html#newWanteds"><span class="hs-identifier">newWanteds</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.TcMType.html#cloneWanted"><span class="hs-identifier">cloneWanted</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.TcMType.html#cloneWC"><span class="hs-identifier">cloneWC</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.TcMType.html#cloneWantedCtEv"><span class="hs-identifier">cloneWantedCtEv</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-44"></span><span>  </span><span class="annot"><a href="GHC.Tc.Utils.TcMType.html#emitWanted"><span class="hs-identifier">emitWanted</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.TcMType.html#emitWantedEq"><span class="hs-identifier">emitWantedEq</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.TcMType.html#emitWantedEvVar"><span class="hs-identifier">emitWantedEvVar</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.TcMType.html#emitWantedEvVars"><span class="hs-identifier">emitWantedEvVars</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-45"></span><span>  </span><span class="annot"><a href="GHC.Tc.Utils.TcMType.html#emitWantedEqs"><span class="hs-identifier">emitWantedEqs</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-46"></span><span>  </span><span class="annot"><a href="GHC.Tc.Utils.Monad.html#newTcEvBinds"><span class="hs-identifier">newTcEvBinds</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.Monad.html#newNoTcEvBinds"><span class="hs-identifier">newNoTcEvBinds</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.Monad.html#addTcEvBind"><span class="hs-identifier">addTcEvBind</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-47"></span><span>  </span><span class="annot"><a href="GHC.Tc.Utils.TcMType.html#emitNewExprHole"><span class="hs-identifier">emitNewExprHole</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-48"></span><span>
</span><span id="line-49"></span><span>  </span><span class="annot"><a href="GHC.Tc.Utils.TcMType.html#newCoercionHole"><span class="hs-identifier">newCoercionHole</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.TcMType.html#newCoercionHoleO"><span class="hs-identifier">newCoercionHoleO</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.TcMType.html#newVanillaCoercionHole"><span class="hs-identifier">newVanillaCoercionHole</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-50"></span><span>  </span><span class="annot"><a href="GHC.Tc.Utils.TcMType.html#fillCoercionHole"><span class="hs-identifier">fillCoercionHole</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Tc.Zonk.Type.html#isFilledCoercionHole"><span class="hs-identifier">isFilledCoercionHole</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-51"></span><span>  </span><span class="annot"><a href="GHC.Tc.Zonk.Type.html#unpackCoercionHole"><span class="hs-identifier">unpackCoercionHole</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Tc.Zonk.Type.html#unpackCoercionHole_maybe"><span class="hs-identifier">unpackCoercionHole_maybe</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-52"></span><span>  </span><span class="annot"><a href="GHC.Tc.Zonk.TcType.html#checkCoercionHole"><span class="hs-identifier">checkCoercionHole</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-53"></span><span>
</span><span id="line-54"></span><span>  </span><span class="annot"><a href="GHC.Tc.Utils.TcMType.html#newImplication"><span class="hs-identifier">newImplication</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-55"></span><span>
</span><span id="line-56"></span><span>  </span><span class="hs-comment">--------------------------------</span><span>
</span><span id="line-57"></span><span>  </span><span class="hs-comment">-- Instantiation</span><span>
</span><span id="line-58"></span><span>  </span><span class="annot"><a href="GHC.Tc.Utils.TcMType.html#newMetaTyVars"><span class="hs-identifier">newMetaTyVars</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.TcMType.html#newMetaTyVarX"><span class="hs-identifier">newMetaTyVarX</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.TcMType.html#newMetaTyVarsX"><span class="hs-identifier">newMetaTyVarsX</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.TcMType.html#newMetaTyVarBndrsX"><span class="hs-identifier">newMetaTyVarBndrsX</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-59"></span><span>  </span><span class="annot"><a href="GHC.Tc.Utils.TcMType.html#newMetaTyVarTyVarX"><span class="hs-identifier">newMetaTyVarTyVarX</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-60"></span><span>  </span><span class="annot"><a href="GHC.Tc.Utils.TcMType.html#newTyVarTyVar"><span class="hs-identifier">newTyVarTyVar</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.TcMType.html#cloneTyVarTyVar"><span class="hs-identifier">cloneTyVarTyVar</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-61"></span><span>  </span><span class="annot"><a href="GHC.Tc.Utils.TcMType.html#newConcreteTyVarX"><span class="hs-identifier">newConcreteTyVarX</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-62"></span><span>  </span><span class="annot"><a href="GHC.Tc.Utils.TcMType.html#newPatTyVar"><span class="hs-identifier">newPatTyVar</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.TcMType.html#newSkolemTyVar"><span class="hs-identifier">newSkolemTyVar</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.TcMType.html#newWildCardX"><span class="hs-identifier">newWildCardX</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-63"></span><span>
</span><span id="line-64"></span><span>  </span><span class="hs-comment">--------------------------------</span><span>
</span><span id="line-65"></span><span>  </span><span class="hs-comment">-- Expected types</span><span>
</span><span id="line-66"></span><span>  </span><span class="annot"><a href="GHC.Tc.Utils.TcType.html#ExpType"><span class="hs-identifier">ExpType</span></a></span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.TcType.html#ExpSigmaType"><span class="hs-identifier">ExpSigmaType</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.TcType.html#ExpRhoType"><span class="hs-identifier">ExpRhoType</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-67"></span><span>  </span><span class="annot"><a href="GHC.Tc.Utils.TcType.html#mkCheckExpType"><span class="hs-identifier">mkCheckExpType</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.TcMType.html#newInferExpType"><span class="hs-identifier">newInferExpType</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.TcMType.html#newInferExpTypeFRR"><span class="hs-identifier">newInferExpTypeFRR</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-68"></span><span>  </span><span class="annot"><a href="GHC.Tc.Utils.TcMType.html#tcInfer"><span class="hs-identifier">tcInfer</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.TcMType.html#tcInferFRR"><span class="hs-identifier">tcInferFRR</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-69"></span><span>  </span><span class="annot"><a href="GHC.Tc.Utils.TcMType.html#readExpType"><span class="hs-identifier">readExpType</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.TcMType.html#readExpType_maybe"><span class="hs-identifier">readExpType_maybe</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.TcMType.html#readScaledExpType"><span class="hs-identifier">readScaledExpType</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-70"></span><span>  </span><span class="annot"><a href="GHC.Tc.Utils.TcMType.html#expTypeToType"><span class="hs-identifier">expTypeToType</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.TcMType.html#scaledExpTypeToType"><span class="hs-identifier">scaledExpTypeToType</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-71"></span><span>  </span><span class="annot"><a href="GHC.Tc.Utils.TcType.html#checkingExpType_maybe"><span class="hs-identifier">checkingExpType_maybe</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.TcType.html#checkingExpType"><span class="hs-identifier">checkingExpType</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-72"></span><span>  </span><span class="annot"><a href="GHC.Tc.Utils.TcMType.html#inferResultToType"><span class="hs-identifier">inferResultToType</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.TcMType.html#ensureMonoType"><span class="hs-identifier">ensureMonoType</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.TcMType.html#promoteTcType"><span class="hs-identifier">promoteTcType</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-73"></span><span>
</span><span id="line-74"></span><span>  </span><span class="hs-comment">--------------------------------</span><span>
</span><span id="line-75"></span><span>  </span><span class="hs-comment">-- Multiplicity usage environment</span><span>
</span><span id="line-76"></span><span>  </span><span class="annot"><a href="GHC.Tc.Utils.TcMType.html#tcCheckUsage"><span class="hs-identifier">tcCheckUsage</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-77"></span><span>
</span><span id="line-78"></span><span>  </span><span class="hs-comment">---------------------------------</span><span>
</span><span id="line-79"></span><span>  </span><span class="hs-comment">-- Promotion, defaulting, skolemisation</span><span>
</span><span id="line-80"></span><span>  </span><span class="annot"><a href="GHC.Tc.Utils.TcMType.html#defaultTyVar"><span class="hs-identifier">defaultTyVar</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.TcMType.html#promoteMetaTyVarTo"><span class="hs-identifier">promoteMetaTyVarTo</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.TcMType.html#promoteTyVarSet"><span class="hs-identifier">promoteTyVarSet</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-81"></span><span>  </span><span class="annot"><a href="GHC.Tc.Utils.TcMType.html#quantifyTyVars"><span class="hs-identifier">quantifyTyVars</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.TcMType.html#isQuantifiableTv"><span class="hs-identifier">isQuantifiableTv</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-82"></span><span>  </span><span class="annot"><a href="GHC.Tc.Utils.TcMType.html#zonkAndSkolemise"><span class="hs-identifier">zonkAndSkolemise</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.TcMType.html#skolemiseQuantifiedTyVar"><span class="hs-identifier">skolemiseQuantifiedTyVar</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-83"></span><span>  </span><span class="annot"><a href="GHC.Tc.Utils.TcMType.html#doNotQuantifyTyVars"><span class="hs-identifier">doNotQuantifyTyVars</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-84"></span><span>
</span><span id="line-85"></span><span>  </span><span class="annot"><a href="GHC.Tc.Utils.TcMType.html#candidateQTyVarsOfType"><span class="hs-identifier">candidateQTyVarsOfType</span></a></span><span class="hs-special">,</span><span>  </span><span class="annot"><a href="GHC.Tc.Utils.TcMType.html#candidateQTyVarsOfKind"><span class="hs-identifier">candidateQTyVarsOfKind</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-86"></span><span>  </span><span class="annot"><a href="GHC.Tc.Utils.TcMType.html#candidateQTyVarsOfTypes"><span class="hs-identifier">candidateQTyVarsOfTypes</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.TcMType.html#candidateQTyVarsOfKinds"><span class="hs-identifier">candidateQTyVarsOfKinds</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-87"></span><span>  </span><span class="annot"><a href="GHC.Tc.Utils.TcMType.html#candidateQTyVarsWithBinders"><span class="hs-identifier">candidateQTyVarsWithBinders</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-88"></span><span>  </span><span class="annot"><a href="GHC.Tc.Utils.TcMType.html#CandidatesQTvs"><span class="hs-identifier">CandidatesQTvs</span></a></span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.TcMType.html#delCandidates"><span class="hs-identifier">delCandidates</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-89"></span><span>  </span><span class="annot"><a href="GHC.Tc.Utils.TcMType.html#candidateKindVars"><span class="hs-identifier">candidateKindVars</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.TcMType.html#partitionCandidates"><span class="hs-identifier">partitionCandidates</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-90"></span><span>
</span><span id="line-91"></span><span>  </span><span class="hs-comment">------------------------------</span><span>
</span><span id="line-92"></span><span>  </span><span class="hs-comment">-- Representation polymorphism</span><span>
</span><span id="line-93"></span><span>  </span><span class="annot"><a href="GHC.Tc.Utils.TcMType.html#checkTypeHasFixedRuntimeRep"><span class="hs-identifier">checkTypeHasFixedRuntimeRep</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-94"></span><span>
</span><span id="line-95"></span><span>  </span><span class="annot"><span class="hs-comment">-- * Other HsSyn functions</span></span><span>
</span><span id="line-96"></span><span>  </span><span class="annot"><a href="GHC.Hs.Utils.html#mkHsDictLet"><span class="hs-identifier">mkHsDictLet</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Hs.Utils.html#mkHsApp"><span class="hs-identifier">mkHsApp</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-97"></span><span>  </span><span class="annot"><a href="GHC.Hs.Type.html#mkHsAppTy"><span class="hs-identifier">mkHsAppTy</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Hs.Utils.html#mkHsCaseAlt"><span class="hs-identifier">mkHsCaseAlt</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-98"></span><span>  </span><span class="annot"><a href="GHC.Tc.Utils.TcMType.html#tcShortCutLit"><span class="hs-identifier">tcShortCutLit</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.TcMType.html#shortCutLit"><span class="hs-identifier">shortCutLit</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.TcMType.html#hsOverLitName"><span class="hs-identifier">hsOverLitName</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-99"></span><span>  </span><span class="annot"><a href="GHC.Core.ConLike.html#conLikeResTy"><span class="hs-identifier">conLikeResTy</span></a></span><span>
</span><span id="line-100"></span><span>  </span><span class="hs-special">)</span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-101"></span><span>
</span><span id="line-102"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Prelude.html"><span class="hs-identifier">GHC.Prelude</span></a></span><span>
</span><span id="line-103"></span><span>
</span><span id="line-104"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Hs.html"><span class="hs-identifier">GHC.Hs</span></a></span><span>
</span><span id="line-105"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Platform.html"><span class="hs-identifier">GHC.Platform</span></a></span><span>
</span><span id="line-106"></span><span>
</span><span id="line-107"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Driver.DynFlags.html"><span class="hs-identifier">GHC.Driver.DynFlags</span></a></span><span>
</span><span id="line-108"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><a href="../../ghc-boot-9.12.2-1a37/src/GHC.LanguageExtensions.html"><span class="hs-identifier">GHC.LanguageExtensions</span></a></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">LangExt</span></span><span>
</span><span id="line-109"></span><span>
</span><span id="line-110"></span><span class="hs-keyword">import</span><span> </span><span class="hs-pragma">{-# SOURCE</span><span> </span><span class="hs-pragma">#-}</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.Unify.html"><span class="hs-identifier">GHC.Tc.Utils.Unify</span></a></span><span class="hs-special">(</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.Unify.html#unifyInvisibleType"><span class="hs-identifier">unifyInvisibleType</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.Unify.html#tcSubMult"><span class="hs-identifier">tcSubMult</span></a></span><span> </span><span class="hs-special">)</span><span>
</span><span id="line-111"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Tc.Types.Origin.html"><span class="hs-identifier">GHC.Tc.Types.Origin</span></a></span><span>
</span><span id="line-112"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Tc.Types.Constraint.html"><span class="hs-identifier">GHC.Tc.Types.Constraint</span></a></span><span>
</span><span id="line-113"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Tc.Types.Evidence.html"><span class="hs-identifier">GHC.Tc.Types.Evidence</span></a></span><span>
</span><span id="line-114"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Tc.Types.CtLoc.html"><span class="hs-identifier">GHC.Tc.Types.CtLoc</span></a></span><span class="hs-special">(</span><span> </span><span class="annot"><a href="GHC.Tc.Types.CtLoc.html#CtLoc"><span class="hs-identifier">CtLoc</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Tc.Types.CtLoc.html#ctLocOrigin"><span class="hs-identifier">ctLocOrigin</span></a></span><span> </span><span class="hs-special">)</span><span>
</span><span id="line-115"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.Monad.html"><span class="hs-identifier">GHC.Tc.Utils.Monad</span></a></span><span>        </span><span class="hs-comment">-- TcType, amongst others</span><span>
</span><span id="line-116"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.TcType.html"><span class="hs-identifier">GHC.Tc.Utils.TcType</span></a></span><span>
</span><span id="line-117"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Tc.Errors.Types.html"><span class="hs-identifier">GHC.Tc.Errors.Types</span></a></span><span>
</span><span id="line-118"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Tc.Zonk.Type.html"><span class="hs-identifier">GHC.Tc.Zonk.Type</span></a></span><span>
</span><span id="line-119"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Tc.Zonk.TcType.html"><span class="hs-identifier">GHC.Tc.Zonk.TcType</span></a></span><span>
</span><span id="line-120"></span><span>
</span><span id="line-121"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Builtin.Names.html"><span class="hs-identifier">GHC.Builtin.Names</span></a></span><span>
</span><span id="line-122"></span><span>
</span><span id="line-123"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Core.ConLike.html"><span class="hs-identifier">GHC.Core.ConLike</span></a></span><span>
</span><span id="line-124"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Core.DataCon.html"><span class="hs-identifier">GHC.Core.DataCon</span></a></span><span>
</span><span id="line-125"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Core.TyCo.Rep.html"><span class="hs-identifier">GHC.Core.TyCo.Rep</span></a></span><span>
</span><span id="line-126"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Core.TyCo.Ppr.html"><span class="hs-identifier">GHC.Core.TyCo.Ppr</span></a></span><span>
</span><span id="line-127"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Core.Type.html"><span class="hs-identifier">GHC.Core.Type</span></a></span><span>
</span><span id="line-128"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Core.TyCon.html"><span class="hs-identifier">GHC.Core.TyCon</span></a></span><span>
</span><span id="line-129"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Core.Coercion.html"><span class="hs-identifier">GHC.Core.Coercion</span></a></span><span>
</span><span id="line-130"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Core.Class.html"><span class="hs-identifier">GHC.Core.Class</span></a></span><span>
</span><span id="line-131"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Core.Predicate.html"><span class="hs-identifier">GHC.Core.Predicate</span></a></span><span>
</span><span id="line-132"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Core.UsageEnv.html"><span class="hs-identifier">GHC.Core.UsageEnv</span></a></span><span>
</span><span id="line-133"></span><span>
</span><span id="line-134"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Types.Var.html"><span class="hs-identifier">GHC.Types.Var</span></a></span><span>
</span><span id="line-135"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Types.Id.html"><span class="hs-identifier">GHC.Types.Id</span></a></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">Id</span></span><span>
</span><span id="line-136"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Types.Name.html"><span class="hs-identifier">GHC.Types.Name</span></a></span><span>
</span><span id="line-137"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Types.SourceText.html"><span class="hs-identifier">GHC.Types.SourceText</span></a></span><span>
</span><span id="line-138"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Types.Var.Set.html"><span class="hs-identifier">GHC.Types.Var.Set</span></a></span><span>
</span><span id="line-139"></span><span>
</span><span id="line-140"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Builtin.Types.html"><span class="hs-identifier">GHC.Builtin.Types</span></a></span><span>
</span><span id="line-141"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Types.Var.Env.html"><span class="hs-identifier">GHC.Types.Var.Env</span></a></span><span>
</span><span id="line-142"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Types.Unique.Set.html"><span class="hs-identifier">GHC.Types.Unique.Set</span></a></span><span>
</span><span id="line-143"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Types.Basic.html"><span class="hs-identifier">GHC.Types.Basic</span></a></span><span> </span><span class="hs-special">(</span><span> </span><span class="annot"><a href="GHC.Types.Basic.html#TypeOrKind"><span class="hs-identifier">TypeOrKind</span></a></span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span>
</span><span id="line-144"></span><span>                       </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Types.Basic.html#NonStandardDefaultingStrategy"><span class="hs-identifier">NonStandardDefaultingStrategy</span></a></span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span>
</span><span id="line-145"></span><span>                       </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Types.Basic.html#DefaultingStrategy"><span class="hs-identifier">DefaultingStrategy</span></a></span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Types.Basic.html#defaultNonStandardTyVars"><span class="hs-identifier">defaultNonStandardTyVars</span></a></span><span> </span><span class="hs-special">)</span><span>
</span><span id="line-146"></span><span>
</span><span id="line-147"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Data.FastString.html"><span class="hs-identifier">GHC.Data.FastString</span></a></span><span>
</span><span id="line-148"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Data.Bag.html"><span class="hs-identifier">GHC.Data.Bag</span></a></span><span>
</span><span id="line-149"></span><span>
</span><span id="line-150"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Utils.Misc.html"><span class="hs-identifier">GHC.Utils.Misc</span></a></span><span>
</span><span id="line-151"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Utils.Outputable.html"><span class="hs-identifier">GHC.Utils.Outputable</span></a></span><span>
</span><span id="line-152"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Utils.Panic.html"><span class="hs-identifier">GHC.Utils.Panic</span></a></span><span>
</span><span id="line-153"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Utils.Constants.html"><span class="hs-identifier">GHC.Utils.Constants</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Utils.Constants.html#debugIsOn"><span class="hs-identifier">debugIsOn</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-154"></span><span>
</span><span id="line-155"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="../../base-4.21.0.0-ae91/src/Control.Monad.html"><span class="hs-identifier">Control.Monad</span></a></span><span>
</span><span id="line-156"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="../../base-4.21.0.0-ae91/src/Data.IORef.html"><span class="hs-identifier">Data.IORef</span></a></span><span>
</span><span id="line-157"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Data.Maybe.html"><span class="hs-identifier">GHC.Data.Maybe</span></a></span><span>
</span><span id="line-158"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><a href="../../base-4.21.0.0-ae91/src/Data.Semigroup.html"><span class="hs-identifier">Data.Semigroup</span></a></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">Semi</span></span><span>
</span><span id="line-159"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Types.Name.Reader.html"><span class="hs-identifier">GHC.Types.Name.Reader</span></a></span><span>
</span><span id="line-160"></span><span>
</span><span id="line-161"></span><span class="hs-comment">{-
************************************************************************
*                                                                      *
        Kind variables
*                                                                      *
************************************************************************
-}</span><span>
</span><span id="line-168"></span><span>
</span><span id="line-169"></span><span class="annot"><a href="GHC.Tc.Utils.TcMType.html#newMetaKindVar"><span class="hs-identifier hs-type">newMetaKindVar</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#TcM"><span class="hs-identifier hs-type">TcM</span></a></span><span> </span><span class="annot"><a href="GHC.Tc.Utils.TcType.html#TcKind"><span class="hs-identifier hs-type">TcKind</span></a></span><span>
</span><span id="line-170"></span><span id="newMetaKindVar"><span class="annot"><span class="annottext">newMetaKindVar :: TcM TcType
</span><a href="GHC.Tc.Utils.TcMType.html#newMetaKindVar"><span class="hs-identifier hs-var hs-var">newMetaKindVar</span></a></span></span><span>
</span><span id="line-171"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span id="local-6989586621683014162"><span class="annot"><a href="#local-6989586621683014162"><span class="hs-identifier hs-var">details</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">MetaInfo -&gt; TcM TcTyVarDetails
</span><a href="GHC.Tc.Utils.TcMType.html#newMetaDetails"><span class="hs-identifier hs-var">newMetaDetails</span></a></span><span> </span><span class="annot"><span class="annottext">MetaInfo
</span><a href="GHC.Tc.Utils.TcType.html#TauTv"><span class="hs-identifier hs-var">TauTv</span></a></span><span>
</span><span id="line-172"></span><span>       </span><span class="hs-special">;</span><span> </span><span id="local-6989586621683014164"><span class="annot"><a href="#local-6989586621683014164"><span class="hs-identifier hs-var">name</span></a></span></span><span>    </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.TcMType.html#newMetaTyVarName"><span class="hs-identifier hs-type">newMetaTyVarName</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Data.FastString.html#fsLit"><span class="hs-identifier hs-type">fsLit</span></a></span><span> </span><span class="annot"><span class="hs-string">&quot;k&quot;</span></span><span class="hs-special">)</span><span>
</span><span id="line-173"></span><span>                    </span><span class="hs-comment">-- All MetaKindVars are called &quot;k&quot;</span><span>
</span><span id="line-174"></span><span>                    </span><span class="hs-comment">-- They may be jiggled by tidying</span><span>
</span><span id="line-175"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621683014166"><span class="annot"><a href="#local-6989586621683014166"><span class="hs-identifier hs-var hs-var">kv</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Name -&gt; TcType -&gt; TcTyVarDetails -&gt; TcTyVar
</span><a href="GHC.Types.Var.html#mkTcTyVar"><span class="hs-identifier hs-var">mkTcTyVar</span></a></span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621683014164"><span class="hs-identifier hs-var">name</span></a></span><span> </span><span class="annot"><span class="annottext">TcType
</span><a href="GHC.Builtin.Types.html#liftedTypeKind"><span class="hs-identifier hs-var">liftedTypeKind</span></a></span><span> </span><span class="annot"><span class="annottext">TcTyVarDetails
</span><a href="#local-6989586621683014162"><span class="hs-identifier hs-var">details</span></a></span><span>
</span><span id="line-176"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.Monad.html#traceTc"><span class="hs-identifier hs-type">traceTc</span></a></span><span> </span><span class="annot"><span class="hs-string">&quot;newMetaKindVar&quot;</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-type">ppr</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683014166"><span class="hs-identifier hs-type">kv</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-177"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">return</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#mkTyVarTy"><span class="hs-identifier hs-type">mkTyVarTy</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683014166"><span class="hs-identifier hs-type">kv</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-178"></span><span>
</span><span id="line-179"></span><span class="annot"><a href="GHC.Tc.Utils.TcMType.html#newMetaKindVars"><span class="hs-identifier hs-type">newMetaKindVars</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Int</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#TcM"><span class="hs-identifier hs-type">TcM</span></a></span><span> </span><span class="hs-special">[</span><span class="annot"><a href="GHC.Tc.Utils.TcType.html#TcKind"><span class="hs-identifier hs-type">TcKind</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-180"></span><span id="newMetaKindVars"><span class="annot"><span class="annottext">newMetaKindVars :: Int -&gt; TcM [TcType]
</span><a href="GHC.Tc.Utils.TcMType.html#newMetaKindVars"><span class="hs-identifier hs-var hs-var">newMetaKindVars</span></a></span></span><span> </span><span id="local-6989586621683014172"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621683014172"><span class="hs-identifier hs-var">n</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Int -&gt; TcM TcType -&gt; TcM [TcType]
forall (m :: * -&gt; *) a. Applicative m =&gt; Int -&gt; m a -&gt; m [a]
</span><span class="hs-identifier hs-var">replicateM</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621683014172"><span class="hs-identifier hs-var">n</span></a></span><span> </span><span class="annot"><span class="annottext">TcM TcType
</span><a href="GHC.Tc.Utils.TcMType.html#newMetaKindVar"><span class="hs-identifier hs-var">newMetaKindVar</span></a></span><span>
</span><span id="line-181"></span><span>
</span><span id="line-182"></span><span class="hs-comment">{-
************************************************************************
*                                                                      *
     Evidence variables; range over constraints we can abstract over
*                                                                      *
************************************************************************
-}</span><span>
</span><span id="line-189"></span><span>
</span><span id="line-190"></span><span class="annot"><a href="GHC.Tc.Utils.TcMType.html#newEvVars"><span class="hs-identifier hs-type">newEvVars</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.TcType.html#TcThetaType"><span class="hs-identifier hs-type">TcThetaType</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#TcM"><span class="hs-identifier hs-type">TcM</span></a></span><span> </span><span class="hs-special">[</span><span class="annot"><a href="GHC.Types.Var.html#EvVar"><span class="hs-identifier hs-type">EvVar</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-191"></span><span id="newEvVars"><span class="annot"><span class="annottext">newEvVars :: [TcType] -&gt; TcM [TcTyVar]
</span><a href="GHC.Tc.Utils.TcMType.html#newEvVars"><span class="hs-identifier hs-var hs-var">newEvVars</span></a></span></span><span> </span><span id="local-6989586621683014175"><span class="annot"><span class="annottext">[TcType]
</span><a href="#local-6989586621683014175"><span class="hs-identifier hs-var">theta</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(TcType -&gt; IOEnv (Env TcGblEnv TcLclEnv) TcTyVar)
-&gt; [TcType] -&gt; TcM [TcTyVar]
forall (t :: * -&gt; *) (m :: * -&gt; *) a b.
(Traversable t, Monad m) =&gt;
(a -&gt; m b) -&gt; t a -&gt; m (t b)
forall (m :: * -&gt; *) a b. Monad m =&gt; (a -&gt; m b) -&gt; [a] -&gt; m [b]
</span><span class="hs-identifier hs-var">mapM</span></span><span> </span><span class="annot"><span class="annottext">TcType -&gt; IOEnv (Env TcGblEnv TcLclEnv) TcTyVar
forall gbl lcl. TcType -&gt; TcRnIf gbl lcl TcTyVar
</span><a href="GHC.Tc.Utils.TcMType.html#newEvVar"><span class="hs-identifier hs-var">newEvVar</span></a></span><span> </span><span class="annot"><span class="annottext">[TcType]
</span><a href="#local-6989586621683014175"><span class="hs-identifier hs-var">theta</span></a></span><span>
</span><span id="line-192"></span><span>
</span><span id="line-193"></span><span class="hs-comment">--------------</span><span>
</span><span id="line-194"></span><span>
</span><span id="line-195"></span><span id="local-6989586621683013369"><span id="local-6989586621683013370"><span class="annot"><a href="GHC.Tc.Utils.TcMType.html#newEvVar"><span class="hs-identifier hs-type">newEvVar</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.TcType.html#TcPredType"><span class="hs-identifier hs-type">TcPredType</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#TcRnIf"><span class="hs-identifier hs-type">TcRnIf</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683013369"><span class="hs-identifier hs-type">gbl</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683013370"><span class="hs-identifier hs-type">lcl</span></a></span><span> </span><span class="annot"><a href="GHC.Types.Var.html#EvVar"><span class="hs-identifier hs-type">EvVar</span></a></span></span></span><span>
</span><span id="line-196"></span><span class="hs-comment">-- Creates new *rigid* variables for predicates</span><span>
</span><span id="line-197"></span><span id="newEvVar"><span class="annot"><span class="annottext">newEvVar :: forall gbl lcl. TcType -&gt; TcRnIf gbl lcl TcTyVar
</span><a href="GHC.Tc.Utils.TcMType.html#newEvVar"><span class="hs-identifier hs-var hs-var">newEvVar</span></a></span></span><span> </span><span id="local-6989586621683014181"><span class="annot"><span class="annottext">TcType
</span><a href="#local-6989586621683014181"><span class="hs-identifier hs-var">ty</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span id="local-6989586621683014182"><span class="annot"><a href="#local-6989586621683014182"><span class="hs-identifier hs-var">name</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">OccName -&gt; TcRnIf gbl lcl Name
forall gbl lcl. OccName -&gt; TcRnIf gbl lcl Name
</span><a href="GHC.Tc.Utils.Monad.html#newSysName"><span class="hs-identifier hs-var">newSysName</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TcType -&gt; OccName
</span><a href="GHC.Tc.Utils.TcMType.html#predTypeOccName"><span class="hs-identifier hs-var">predTypeOccName</span></a></span><span> </span><span class="annot"><span class="annottext">TcType
</span><a href="#local-6989586621683014181"><span class="hs-identifier hs-var">ty</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-198"></span><span>                 </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">return</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Types.Id.html#mkLocalIdOrCoVar"><span class="hs-identifier hs-type">mkLocalIdOrCoVar</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683014182"><span class="hs-identifier hs-type">name</span></a></span><span> </span><span class="annot"><a href="GHC.Core.Type.html#ManyTy"><span class="hs-identifier hs-type">ManyTy</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683014181"><span class="hs-identifier hs-type">ty</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-199"></span><span>
</span><span id="line-200"></span><span class="annot"><span class="hs-comment">-- | Create a new Wanted constraint with the given 'CtLoc'.</span></span><span>
</span><span id="line-201"></span><span class="annot"><a href="GHC.Tc.Utils.TcMType.html#newWantedWithLoc"><span class="hs-identifier hs-type">newWantedWithLoc</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Tc.Types.CtLoc.html#CtLoc"><span class="hs-identifier hs-type">CtLoc</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#PredType"><span class="hs-identifier hs-type">PredType</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#TcM"><span class="hs-identifier hs-type">TcM</span></a></span><span> </span><span class="annot"><a href="GHC.Tc.Types.Constraint.html#CtEvidence"><span class="hs-identifier hs-type">CtEvidence</span></a></span><span>
</span><span id="line-202"></span><span id="newWantedWithLoc"><span class="annot"><span class="annottext">newWantedWithLoc :: CtLoc -&gt; TcType -&gt; TcM CtEvidence
</span><a href="GHC.Tc.Utils.TcMType.html#newWantedWithLoc"><span class="hs-identifier hs-var hs-var">newWantedWithLoc</span></a></span></span><span> </span><span id="local-6989586621683014188"><span class="annot"><span class="annottext">CtLoc
</span><a href="#local-6989586621683014188"><span class="hs-identifier hs-var">loc</span></a></span></span><span> </span><span id="local-6989586621683014189"><span class="annot"><span class="annottext">TcType
</span><a href="#local-6989586621683014189"><span class="hs-identifier hs-var">pty</span></a></span></span><span>
</span><span id="line-203"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span id="local-6989586621683014190"><span class="annot"><a href="#local-6989586621683014190"><span class="hs-identifier hs-var">dst</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">TcType -&gt; Pred
</span><a href="GHC.Core.Predicate.html#classifyPredType"><span class="hs-identifier hs-var">classifyPredType</span></a></span><span> </span><span class="annot"><span class="annottext">TcType
</span><a href="#local-6989586621683014189"><span class="hs-identifier hs-var">pty</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-204"></span><span>                </span><span class="annot"><a href="GHC.Core.Predicate.html#EqPred"><span class="hs-identifier hs-type">EqPred</span></a></span><span> </span><span class="hs-special">{</span><span class="hs-special">}</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">CoercionHole -&gt; TcEvDest
</span><a href="GHC.Tc.Types.Constraint.html#HoleDest"><span class="hs-identifier hs-var">HoleDest</span></a></span><span>  </span><span class="annot"><span class="annottext">(CoercionHole -&gt; TcEvDest)
-&gt; IOEnv (Env TcGblEnv TcLclEnv) CoercionHole
-&gt; IOEnv (Env TcGblEnv TcLclEnv) TcEvDest
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="annot"><span class="annottext">CtLoc -&gt; TcType -&gt; IOEnv (Env TcGblEnv TcLclEnv) CoercionHole
</span><a href="GHC.Tc.Utils.TcMType.html#newCoercionHole"><span class="hs-identifier hs-var">newCoercionHole</span></a></span><span> </span><span class="annot"><span class="annottext">CtLoc
</span><a href="#local-6989586621683014188"><span class="hs-identifier hs-var">loc</span></a></span><span> </span><span class="annot"><span class="annottext">TcType
</span><a href="#local-6989586621683014189"><span class="hs-identifier hs-var">pty</span></a></span><span>
</span><span id="line-205"></span><span>                </span><span class="annot"><span class="annottext">Pred
</span><span class="hs-identifier">_</span></span><span>         </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">TcTyVar -&gt; TcEvDest
</span><a href="GHC.Tc.Types.Constraint.html#EvVarDest"><span class="hs-identifier hs-var">EvVarDest</span></a></span><span> </span><span class="annot"><span class="annottext">(TcTyVar -&gt; TcEvDest)
-&gt; IOEnv (Env TcGblEnv TcLclEnv) TcTyVar
-&gt; IOEnv (Env TcGblEnv TcLclEnv) TcEvDest
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="annot"><span class="annottext">TcType -&gt; IOEnv (Env TcGblEnv TcLclEnv) TcTyVar
forall gbl lcl. TcType -&gt; TcRnIf gbl lcl TcTyVar
</span><a href="GHC.Tc.Utils.TcMType.html#newEvVar"><span class="hs-identifier hs-var">newEvVar</span></a></span><span> </span><span class="annot"><span class="annottext">TcType
</span><a href="#local-6989586621683014189"><span class="hs-identifier hs-var">pty</span></a></span><span>
</span><span id="line-206"></span><span>       </span><span class="annot"><span class="hs-identifier hs-type">return</span></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="annot"><a href="GHC.Tc.Types.Constraint.html#CtWanted"><span class="hs-identifier hs-type">CtWanted</span></a></span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><a href="GHC.Tc.Types.Constraint.html#ctev_dest"><span class="hs-identifier hs-var">ctev_dest</span></a></span><span>      </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="#local-6989586621683014190"><span class="hs-identifier hs-type">dst</span></a></span><span>
</span><span id="line-207"></span><span>                         </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Tc.Types.Constraint.html#ctev_pred"><span class="hs-identifier hs-var">ctev_pred</span></a></span><span>      </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="#local-6989586621683014189"><span class="hs-identifier hs-type">pty</span></a></span><span>
</span><span id="line-208"></span><span>                         </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Tc.Types.Constraint.html#ctev_loc"><span class="hs-identifier hs-var">ctev_loc</span></a></span><span>       </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="#local-6989586621683014188"><span class="hs-identifier hs-type">loc</span></a></span><span>
</span><span id="line-209"></span><span>                         </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Tc.Types.Constraint.html#ctev_rewriters"><span class="hs-identifier hs-var">ctev_rewriters</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="GHC.Tc.Types.Constraint.html#emptyRewriterSet"><span class="hs-identifier hs-type">emptyRewriterSet</span></a></span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-210"></span><span>
</span><span id="line-211"></span><span class="hs-comment">-- | Create a new Wanted constraint with the given 'CtOrigin', and</span><span>
</span><span id="line-212"></span><span class="hs-comment">-- location information taken from the 'TcM' environment.</span><span>
</span><span id="line-213"></span><span class="annot"><a href="GHC.Tc.Utils.TcMType.html#newWanted"><span class="hs-identifier hs-type">newWanted</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Tc.Types.Origin.html#CtOrigin"><span class="hs-identifier hs-type">CtOrigin</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Maybe</span></span><span> </span><span class="annot"><a href="GHC.Types.Basic.html#TypeOrKind"><span class="hs-identifier hs-type">TypeOrKind</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#PredType"><span class="hs-identifier hs-type">PredType</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#TcM"><span class="hs-identifier hs-type">TcM</span></a></span><span> </span><span class="annot"><a href="GHC.Tc.Types.Constraint.html#CtEvidence"><span class="hs-identifier hs-type">CtEvidence</span></a></span><span>
</span><span id="line-214"></span><span class="hs-comment">-- Deals with both equality and non-equality predicates</span><span>
</span><span id="line-215"></span><span id="newWanted"><span class="annot"><span class="annottext">newWanted :: CtOrigin -&gt; Maybe TypeOrKind -&gt; TcType -&gt; TcM CtEvidence
</span><a href="GHC.Tc.Utils.TcMType.html#newWanted"><span class="hs-identifier hs-var hs-var">newWanted</span></a></span></span><span> </span><span id="local-6989586621683014202"><span class="annot"><span class="annottext">CtOrigin
</span><a href="#local-6989586621683014202"><span class="hs-identifier hs-var">orig</span></a></span></span><span> </span><span id="local-6989586621683014203"><span class="annot"><span class="annottext">Maybe TypeOrKind
</span><a href="#local-6989586621683014203"><span class="hs-identifier hs-var">t_or_k</span></a></span></span><span> </span><span id="local-6989586621683014204"><span class="annot"><span class="annottext">TcType
</span><a href="#local-6989586621683014204"><span class="hs-identifier hs-var">pty</span></a></span></span><span>
</span><span id="line-216"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span id="local-6989586621683014205"><span class="annot"><a href="#local-6989586621683014205"><span class="hs-identifier hs-var">loc</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">CtOrigin -&gt; Maybe TypeOrKind -&gt; TcM CtLoc
</span><a href="GHC.Tc.Utils.Monad.html#getCtLocM"><span class="hs-identifier hs-var">getCtLocM</span></a></span><span> </span><span class="annot"><span class="annottext">CtOrigin
</span><a href="#local-6989586621683014202"><span class="hs-identifier hs-var">orig</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe TypeOrKind
</span><a href="#local-6989586621683014203"><span class="hs-identifier hs-var">t_or_k</span></a></span><span>
</span><span id="line-217"></span><span>       </span><span class="annot"><a href="GHC.Tc.Utils.TcMType.html#newWantedWithLoc"><span class="hs-identifier hs-type">newWantedWithLoc</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683014205"><span class="hs-identifier hs-type">loc</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683014204"><span class="hs-identifier hs-type">pty</span></a></span><span>
</span><span id="line-218"></span><span>
</span><span id="line-219"></span><span class="hs-comment">-- | Create new Wanted constraints with the given 'CtOrigin',</span><span>
</span><span id="line-220"></span><span class="hs-comment">-- and location information taken from the 'TcM' environment.</span><span>
</span><span id="line-221"></span><span class="annot"><a href="GHC.Tc.Utils.TcMType.html#newWanteds"><span class="hs-identifier hs-type">newWanteds</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Tc.Types.Origin.html#CtOrigin"><span class="hs-identifier hs-type">CtOrigin</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#ThetaType"><span class="hs-identifier hs-type">ThetaType</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#TcM"><span class="hs-identifier hs-type">TcM</span></a></span><span> </span><span class="hs-special">[</span><span class="annot"><a href="GHC.Tc.Types.Constraint.html#CtEvidence"><span class="hs-identifier hs-type">CtEvidence</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-222"></span><span id="newWanteds"><span class="annot"><span class="annottext">newWanteds :: CtOrigin -&gt; [TcType] -&gt; TcM [CtEvidence]
</span><a href="GHC.Tc.Utils.TcMType.html#newWanteds"><span class="hs-identifier hs-var hs-var">newWanteds</span></a></span></span><span> </span><span id="local-6989586621683014208"><span class="annot"><span class="annottext">CtOrigin
</span><a href="#local-6989586621683014208"><span class="hs-identifier hs-var">orig</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(TcType -&gt; TcM CtEvidence) -&gt; [TcType] -&gt; TcM [CtEvidence]
forall (t :: * -&gt; *) (m :: * -&gt; *) a b.
(Traversable t, Monad m) =&gt;
(a -&gt; m b) -&gt; t a -&gt; m (t b)
forall (m :: * -&gt; *) a b. Monad m =&gt; (a -&gt; m b) -&gt; [a] -&gt; m [b]
</span><span class="hs-identifier hs-var">mapM</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">CtOrigin -&gt; Maybe TypeOrKind -&gt; TcType -&gt; TcM CtEvidence
</span><a href="GHC.Tc.Utils.TcMType.html#newWanted"><span class="hs-identifier hs-var">newWanted</span></a></span><span> </span><span class="annot"><span class="annottext">CtOrigin
</span><a href="#local-6989586621683014208"><span class="hs-identifier hs-var">orig</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe TypeOrKind
forall a. Maybe a
</span><span class="hs-identifier hs-var">Nothing</span></span><span class="hs-special">)</span><span>
</span><span id="line-223"></span><span>
</span><span id="line-224"></span><span class="hs-comment">----------------------------------------------</span><span>
</span><span id="line-225"></span><span class="hs-comment">-- Cloning constraints</span><span>
</span><span id="line-226"></span><span class="hs-comment">----------------------------------------------</span><span>
</span><span id="line-227"></span><span>
</span><span id="line-228"></span><span class="annot"><a href="GHC.Tc.Utils.TcMType.html#cloneWantedCtEv"><span class="hs-identifier hs-type">cloneWantedCtEv</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Tc.Types.Constraint.html#CtEvidence"><span class="hs-identifier hs-type">CtEvidence</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#TcM"><span class="hs-identifier hs-type">TcM</span></a></span><span> </span><span class="annot"><a href="GHC.Tc.Types.Constraint.html#CtEvidence"><span class="hs-identifier hs-type">CtEvidence</span></a></span><span>
</span><span id="line-229"></span><span id="cloneWantedCtEv"><span class="annot"><span class="annottext">cloneWantedCtEv :: CtEvidence -&gt; TcM CtEvidence
</span><a href="GHC.Tc.Utils.TcMType.html#cloneWantedCtEv"><span class="hs-identifier hs-var hs-var">cloneWantedCtEv</span></a></span></span><span> </span><span id="local-6989586621683014209"><span class="annot"><span class="annottext">ctev :: CtEvidence
</span><a href="#local-6989586621683014209"><span class="hs-identifier hs-var">ctev</span></a></span></span><span class="hs-glyph">@</span><span class="hs-special">(</span><span class="annot"><a href="GHC.Tc.Types.Constraint.html#CtWanted"><span class="hs-identifier hs-type">CtWanted</span></a></span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">ctev_pred :: CtEvidence -&gt; TcType
</span><a href="GHC.Tc.Types.Constraint.html#ctev_pred"><span class="hs-identifier hs-var">ctev_pred</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="local-6989586621683014210"><span class="annot"><span class="annottext">TcType
</span><a href="#local-6989586621683014210"><span class="hs-identifier hs-var">pty</span></a></span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">ctev_dest :: CtEvidence -&gt; TcEvDest
</span><a href="GHC.Tc.Types.Constraint.html#ctev_dest"><span class="hs-identifier hs-var">ctev_dest</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="GHC.Tc.Types.Constraint.html#HoleDest"><span class="hs-identifier hs-type">HoleDest</span></a></span><span> </span><span class="annot"><span class="annottext">CoercionHole
</span><span class="hs-identifier">_</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">ctev_loc :: CtEvidence -&gt; CtLoc
</span><a href="GHC.Tc.Types.Constraint.html#ctev_loc"><span class="hs-identifier hs-var">ctev_loc</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="local-6989586621683014211"><span class="annot"><span class="annottext">CtLoc
</span><a href="#local-6989586621683014211"><span class="hs-identifier hs-var">loc</span></a></span></span><span> </span><span class="hs-special">}</span><span class="hs-special">)</span><span>
</span><span id="line-230"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">TcType -&gt; Bool
</span><a href="GHC.Core.Predicate.html#isEqPrimPred"><span class="hs-identifier hs-var">isEqPrimPred</span></a></span><span> </span><span class="annot"><span class="annottext">TcType
</span><a href="#local-6989586621683014210"><span class="hs-identifier hs-var">pty</span></a></span><span>
</span><span id="line-231"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span id="local-6989586621683014213"><span class="annot"><a href="#local-6989586621683014213"><span class="hs-identifier hs-var">co_hole</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">CtLoc -&gt; TcType -&gt; IOEnv (Env TcGblEnv TcLclEnv) CoercionHole
</span><a href="GHC.Tc.Utils.TcMType.html#newCoercionHole"><span class="hs-identifier hs-var">newCoercionHole</span></a></span><span> </span><span class="annot"><span class="annottext">CtLoc
</span><a href="#local-6989586621683014211"><span class="hs-identifier hs-var">loc</span></a></span><span> </span><span class="annot"><span class="annottext">TcType
</span><a href="#local-6989586621683014210"><span class="hs-identifier hs-var">pty</span></a></span><span>
</span><span id="line-232"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">return</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621683014209"><span class="hs-identifier hs-type">ctev</span></a></span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><a href="GHC.Tc.Types.Constraint.html#ctev_dest"><span class="hs-identifier hs-var">ctev_dest</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="GHC.Tc.Types.Constraint.html#HoleDest"><span class="hs-identifier hs-type">HoleDest</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683014213"><span class="hs-identifier hs-type">co_hole</span></a></span><span> </span><span class="hs-special">}</span><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-233"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">otherwise</span></span><span>
</span><span id="line-234"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">String -&gt; SDoc -&gt; TcM CtEvidence
forall a. HasCallStack =&gt; String -&gt; SDoc -&gt; a
</span><a href="GHC.Utils.Panic.html#pprPanic"><span class="hs-identifier hs-var">pprPanic</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;cloneWantedCtEv&quot;</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TcType -&gt; SDoc
forall a. Outputable a =&gt; a -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="annot"><span class="annottext">TcType
</span><a href="#local-6989586621683014210"><span class="hs-identifier hs-var">pty</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-235"></span><span class="annot"><a href="GHC.Tc.Utils.TcMType.html#cloneWantedCtEv"><span class="hs-identifier hs-var">cloneWantedCtEv</span></a></span><span> </span><span id="local-6989586621683014215"><span class="annot"><span class="annottext">CtEvidence
</span><a href="#local-6989586621683014215"><span class="hs-identifier hs-var">ctev</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">CtEvidence -&gt; TcM CtEvidence
forall a. a -&gt; IOEnv (Env TcGblEnv TcLclEnv) a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="annot"><span class="annottext">CtEvidence
</span><a href="#local-6989586621683014215"><span class="hs-identifier hs-var">ctev</span></a></span><span>
</span><span id="line-236"></span><span>
</span><span id="line-237"></span><span class="annot"><a href="GHC.Tc.Utils.TcMType.html#cloneWanted"><span class="hs-identifier hs-type">cloneWanted</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Tc.Types.Constraint.html#Ct"><span class="hs-identifier hs-type">Ct</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#TcM"><span class="hs-identifier hs-type">TcM</span></a></span><span> </span><span class="annot"><a href="GHC.Tc.Types.Constraint.html#Ct"><span class="hs-identifier hs-type">Ct</span></a></span><span>
</span><span id="line-238"></span><span id="cloneWanted"><span class="annot"><span class="annottext">cloneWanted :: Ct -&gt; TcM Ct
</span><a href="GHC.Tc.Utils.TcMType.html#cloneWanted"><span class="hs-identifier hs-var hs-var">cloneWanted</span></a></span></span><span> </span><span id="local-6989586621683014216"><span class="annot"><span class="annottext">Ct
</span><a href="#local-6989586621683014216"><span class="hs-identifier hs-var">ct</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">CtEvidence -&gt; Ct
</span><a href="GHC.Tc.Types.Constraint.html#mkNonCanonical"><span class="hs-identifier hs-var">mkNonCanonical</span></a></span><span> </span><span class="annot"><span class="annottext">(CtEvidence -&gt; Ct) -&gt; TcM CtEvidence -&gt; TcM Ct
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="annot"><span class="annottext">CtEvidence -&gt; TcM CtEvidence
</span><a href="GHC.Tc.Utils.TcMType.html#cloneWantedCtEv"><span class="hs-identifier hs-var">cloneWantedCtEv</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Ct -&gt; CtEvidence
</span><a href="GHC.Tc.Types.Constraint.html#ctEvidence"><span class="hs-identifier hs-var">ctEvidence</span></a></span><span> </span><span class="annot"><span class="annottext">Ct
</span><a href="#local-6989586621683014216"><span class="hs-identifier hs-var">ct</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-239"></span><span>
</span><span id="line-240"></span><span class="annot"><a href="GHC.Tc.Utils.TcMType.html#cloneWC"><span class="hs-identifier hs-type">cloneWC</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Tc.Types.Constraint.html#WantedConstraints"><span class="hs-identifier hs-type">WantedConstraints</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#TcM"><span class="hs-identifier hs-type">TcM</span></a></span><span> </span><span class="annot"><a href="GHC.Tc.Types.Constraint.html#WantedConstraints"><span class="hs-identifier hs-type">WantedConstraints</span></a></span><span>
</span><span id="line-241"></span><span class="hs-comment">-- Clone all the evidence bindings in</span><span>
</span><span id="line-242"></span><span class="hs-comment">--   a) the ic_bind field of any implications</span><span>
</span><span id="line-243"></span><span class="hs-comment">--   b) the CoercionHoles of any wanted constraints</span><span>
</span><span id="line-244"></span><span class="hs-comment">-- so that solving the WantedConstraints will not have any visible side</span><span>
</span><span id="line-245"></span><span class="hs-comment">-- effect, /except/ from causing unifications</span><span>
</span><span id="line-246"></span><span id="cloneWC"><span class="annot"><span class="annottext">cloneWC :: WantedConstraints -&gt; TcM WantedConstraints
</span><a href="GHC.Tc.Utils.TcMType.html#cloneWC"><span class="hs-identifier hs-var hs-var">cloneWC</span></a></span></span><span> </span><span id="local-6989586621683014219"><span class="annot"><span class="annottext">wc :: WantedConstraints
</span><a href="#local-6989586621683014219"><span class="hs-identifier hs-var">wc</span></a></span></span><span class="hs-glyph">@</span><span class="hs-special">(</span><span class="annot"><a href="GHC.Tc.Types.Constraint.html#WC"><span class="hs-identifier hs-type">WC</span></a></span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">wc_simple :: WantedConstraints -&gt; Cts
</span><a href="GHC.Tc.Types.Constraint.html#wc_simple"><span class="hs-identifier hs-var">wc_simple</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="local-6989586621683014222"><span class="annot"><span class="annottext">Cts
</span><a href="#local-6989586621683014222"><span class="hs-identifier hs-var">simples</span></a></span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">wc_impl :: WantedConstraints -&gt; Bag Implication
</span><a href="GHC.Tc.Types.Constraint.html#wc_impl"><span class="hs-identifier hs-var">wc_impl</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="local-6989586621683014224"><span class="annot"><span class="annottext">Bag Implication
</span><a href="#local-6989586621683014224"><span class="hs-identifier hs-var">implics</span></a></span></span><span> </span><span class="hs-special">}</span><span class="hs-special">)</span><span>
</span><span id="line-247"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span id="local-6989586621683014225"><span class="annot"><a href="#local-6989586621683014225"><span class="hs-identifier hs-var">simples'</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">(Ct -&gt; TcM Ct) -&gt; Cts -&gt; IOEnv (Env TcGblEnv TcLclEnv) Cts
forall (m :: * -&gt; *) a b.
Monad m =&gt;
(a -&gt; m b) -&gt; Bag a -&gt; m (Bag b)
</span><a href="GHC.Data.Bag.html#mapBagM"><span class="hs-identifier hs-var">mapBagM</span></a></span><span> </span><span class="annot"><span class="annottext">Ct -&gt; TcM Ct
</span><a href="GHC.Tc.Utils.TcMType.html#cloneWanted"><span class="hs-identifier hs-var">cloneWanted</span></a></span><span> </span><span class="annot"><span class="annottext">Cts
</span><a href="#local-6989586621683014222"><span class="hs-identifier hs-var">simples</span></a></span><span>
</span><span id="line-248"></span><span>       </span><span class="hs-special">;</span><span> </span><span id="local-6989586621683014227"><span class="annot"><a href="#local-6989586621683014227"><span class="hs-identifier hs-var">implics'</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><a href="GHC.Data.Bag.html#mapBagM"><span class="hs-identifier hs-type">mapBagM</span></a></span><span> </span><span class="annot"><a href="GHC.Tc.Utils.TcMType.html#cloneImplication"><span class="hs-identifier hs-type">cloneImplication</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683014224"><span class="hs-identifier hs-type">implics</span></a></span><span>
</span><span id="line-249"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">return</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621683014219"><span class="hs-identifier hs-type">wc</span></a></span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><a href="GHC.Tc.Types.Constraint.html#wc_simple"><span class="hs-identifier hs-var">wc_simple</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="#local-6989586621683014225"><span class="hs-identifier hs-type">simples'</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Tc.Types.Constraint.html#wc_impl"><span class="hs-identifier hs-var">wc_impl</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="#local-6989586621683014227"><span class="hs-identifier hs-type">implics'</span></a></span><span> </span><span class="hs-special">}</span><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-250"></span><span>
</span><span id="line-251"></span><span class="annot"><a href="GHC.Tc.Utils.TcMType.html#cloneImplication"><span class="hs-identifier hs-type">cloneImplication</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Tc.Types.Constraint.html#Implication"><span class="hs-identifier hs-type">Implication</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#TcM"><span class="hs-identifier hs-type">TcM</span></a></span><span> </span><span class="annot"><a href="GHC.Tc.Types.Constraint.html#Implication"><span class="hs-identifier hs-type">Implication</span></a></span><span>
</span><span id="line-252"></span><span id="cloneImplication"><span class="annot"><span class="annottext">cloneImplication :: Implication -&gt; IOEnv (Env TcGblEnv TcLclEnv) Implication
</span><a href="GHC.Tc.Utils.TcMType.html#cloneImplication"><span class="hs-identifier hs-var hs-var">cloneImplication</span></a></span></span><span> </span><span id="local-6989586621683014229"><span class="annot"><span class="annottext">implic :: Implication
</span><a href="#local-6989586621683014229"><span class="hs-identifier hs-var">implic</span></a></span></span><span class="hs-glyph">@</span><span class="hs-special">(</span><span class="annot"><a href="GHC.Tc.Types.Constraint.html#Implic"><span class="hs-identifier hs-type">Implic</span></a></span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">ic_binds :: Implication -&gt; EvBindsVar
</span><a href="GHC.Tc.Types.Constraint.html#ic_binds"><span class="hs-identifier hs-var">ic_binds</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="local-6989586621683014232"><span class="annot"><span class="annottext">EvBindsVar
</span><a href="#local-6989586621683014232"><span class="hs-identifier hs-var">binds</span></a></span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">ic_wanted :: Implication -&gt; WantedConstraints
</span><a href="GHC.Tc.Types.Constraint.html#ic_wanted"><span class="hs-identifier hs-var">ic_wanted</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="local-6989586621683014234"><span class="annot"><span class="annottext">WantedConstraints
</span><a href="#local-6989586621683014234"><span class="hs-identifier hs-var">inner_wanted</span></a></span></span><span> </span><span class="hs-special">}</span><span class="hs-special">)</span><span>
</span><span id="line-253"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span id="local-6989586621683014235"><span class="annot"><a href="#local-6989586621683014235"><span class="hs-identifier hs-var">binds'</span></a></span></span><span>        </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">EvBindsVar -&gt; TcM EvBindsVar
</span><a href="GHC.Tc.Utils.Monad.html#cloneEvBindsVar"><span class="hs-identifier hs-var">cloneEvBindsVar</span></a></span><span> </span><span class="annot"><span class="annottext">EvBindsVar
</span><a href="#local-6989586621683014232"><span class="hs-identifier hs-var">binds</span></a></span><span>
</span><span id="line-254"></span><span>       </span><span class="hs-special">;</span><span> </span><span id="local-6989586621683014237"><span class="annot"><a href="#local-6989586621683014237"><span class="hs-identifier hs-var">inner_wanted'</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.TcMType.html#cloneWC"><span class="hs-identifier hs-type">cloneWC</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683014234"><span class="hs-identifier hs-type">inner_wanted</span></a></span><span>
</span><span id="line-255"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">return</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621683014229"><span class="hs-identifier hs-type">implic</span></a></span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><a href="GHC.Tc.Types.Constraint.html#ic_binds"><span class="hs-identifier hs-var">ic_binds</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="#local-6989586621683014235"><span class="hs-identifier hs-type">binds'</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Tc.Types.Constraint.html#ic_wanted"><span class="hs-identifier hs-var">ic_wanted</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="#local-6989586621683014237"><span class="hs-identifier hs-type">inner_wanted'</span></a></span><span> </span><span class="hs-special">}</span><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-256"></span><span>
</span><span id="line-257"></span><span class="hs-comment">----------------------------------------------</span><span>
</span><span id="line-258"></span><span class="hs-comment">-- Emitting constraints</span><span>
</span><span id="line-259"></span><span class="hs-comment">----------------------------------------------</span><span>
</span><span id="line-260"></span><span>
</span><span id="line-261"></span><span class="annot"><span class="hs-comment">-- | Emits a new Wanted. Deals with both equalities and non-equalities.</span></span><span>
</span><span id="line-262"></span><span class="annot"><a href="GHC.Tc.Utils.TcMType.html#emitWanted"><span class="hs-identifier hs-type">emitWanted</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Tc.Types.Origin.html#CtOrigin"><span class="hs-identifier hs-type">CtOrigin</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.TcType.html#TcPredType"><span class="hs-identifier hs-type">TcPredType</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#TcM"><span class="hs-identifier hs-type">TcM</span></a></span><span> </span><span class="annot"><a href="GHC.Tc.Types.Evidence.html#EvTerm"><span class="hs-identifier hs-type">EvTerm</span></a></span><span>
</span><span id="line-263"></span><span id="emitWanted"><span class="annot"><span class="annottext">emitWanted :: CtOrigin -&gt; TcType -&gt; TcM EvTerm
</span><a href="GHC.Tc.Utils.TcMType.html#emitWanted"><span class="hs-identifier hs-var hs-var">emitWanted</span></a></span></span><span> </span><span id="local-6989586621683014238"><span class="annot"><span class="annottext">CtOrigin
</span><a href="#local-6989586621683014238"><span class="hs-identifier hs-var">origin</span></a></span></span><span> </span><span id="local-6989586621683014239"><span class="annot"><span class="annottext">TcType
</span><a href="#local-6989586621683014239"><span class="hs-identifier hs-var">pty</span></a></span></span><span>
</span><span id="line-264"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span id="local-6989586621683014240"><span class="annot"><a href="#local-6989586621683014240"><span class="hs-identifier hs-var">ev</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">CtOrigin -&gt; Maybe TypeOrKind -&gt; TcType -&gt; TcM CtEvidence
</span><a href="GHC.Tc.Utils.TcMType.html#newWanted"><span class="hs-identifier hs-var">newWanted</span></a></span><span> </span><span class="annot"><span class="annottext">CtOrigin
</span><a href="#local-6989586621683014238"><span class="hs-identifier hs-var">origin</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe TypeOrKind
forall a. Maybe a
</span><span class="hs-identifier hs-var">Nothing</span></span><span> </span><span class="annot"><span class="annottext">TcType
</span><a href="#local-6989586621683014239"><span class="hs-identifier hs-var">pty</span></a></span><span>
</span><span id="line-265"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.Monad.html#emitSimple"><span class="hs-identifier hs-type">emitSimple</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="annot"><a href="GHC.Tc.Types.Constraint.html#mkNonCanonical"><span class="hs-identifier hs-type">mkNonCanonical</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683014240"><span class="hs-identifier hs-type">ev</span></a></span><span>
</span><span id="line-266"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">return</span></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="annot"><a href="GHC.Tc.Types.Constraint.html#ctEvTerm"><span class="hs-identifier hs-type">ctEvTerm</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683014240"><span class="hs-identifier hs-type">ev</span></a></span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-267"></span><span>
</span><span id="line-268"></span><span class="annot"><a href="GHC.Tc.Utils.TcMType.html#emitWantedEqs"><span class="hs-identifier hs-type">emitWantedEqs</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Tc.Types.Origin.html#CtOrigin"><span class="hs-identifier hs-type">CtOrigin</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="hs-special">(</span><span class="annot"><a href="GHC.Tc.Utils.TcType.html#TcType"><span class="hs-identifier hs-type">TcType</span></a></span><span class="hs-special">,</span><span class="annot"><a href="GHC.Tc.Utils.TcType.html#TcType"><span class="hs-identifier hs-type">TcType</span></a></span><span class="hs-special">)</span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#TcM"><span class="hs-identifier hs-type">TcM</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-269"></span><span class="hs-comment">-- Emit some new wanted nominal equalities</span><span>
</span><span id="line-270"></span><span id="emitWantedEqs"><span class="annot"><span class="annottext">emitWantedEqs :: CtOrigin -&gt; [(TcType, TcType)] -&gt; TcRn ()
</span><a href="GHC.Tc.Utils.TcMType.html#emitWantedEqs"><span class="hs-identifier hs-var hs-var">emitWantedEqs</span></a></span></span><span> </span><span id="local-6989586621683014243"><span class="annot"><span class="annottext">CtOrigin
</span><a href="#local-6989586621683014243"><span class="hs-identifier hs-var">origin</span></a></span></span><span> </span><span id="local-6989586621683014244"><span class="annot"><span class="annottext">[(TcType, TcType)]
</span><a href="#local-6989586621683014244"><span class="hs-identifier hs-var">pairs</span></a></span></span><span>
</span><span id="line-271"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">[(TcType, TcType)] -&gt; Bool
forall a. [a] -&gt; Bool
forall (t :: * -&gt; *) a. Foldable t =&gt; t a -&gt; Bool
</span><span class="hs-identifier hs-var">null</span></span><span> </span><span class="annot"><span class="annottext">[(TcType, TcType)]
</span><a href="#local-6989586621683014244"><span class="hs-identifier hs-var">pairs</span></a></span><span>
</span><span id="line-272"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">() -&gt; TcRn ()
forall a. a -&gt; IOEnv (Env TcGblEnv TcLclEnv) a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-273"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">otherwise</span></span><span>
</span><span id="line-274"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">((TcType, TcType) -&gt; IOEnv (Env TcGblEnv TcLclEnv) Coercion)
-&gt; [(TcType, TcType)] -&gt; TcRn ()
forall (t :: * -&gt; *) (m :: * -&gt; *) a b.
(Foldable t, Monad m) =&gt;
(a -&gt; m b) -&gt; t a -&gt; m ()
</span><span class="hs-identifier hs-var">mapM_</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(TcType -&gt; TcType -&gt; IOEnv (Env TcGblEnv TcLclEnv) Coercion)
-&gt; (TcType, TcType) -&gt; IOEnv (Env TcGblEnv TcLclEnv) Coercion
forall a b c. (a -&gt; b -&gt; c) -&gt; (a, b) -&gt; c
</span><span class="hs-identifier hs-var">uncurry</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">CtOrigin
-&gt; TypeOrKind
-&gt; Role
-&gt; TcType
-&gt; TcType
-&gt; IOEnv (Env TcGblEnv TcLclEnv) Coercion
</span><a href="GHC.Tc.Utils.TcMType.html#emitWantedEq"><span class="hs-identifier hs-var">emitWantedEq</span></a></span><span> </span><span class="annot"><span class="annottext">CtOrigin
</span><a href="#local-6989586621683014243"><span class="hs-identifier hs-var">origin</span></a></span><span> </span><span class="annot"><span class="annottext">TypeOrKind
</span><a href="GHC.Types.Basic.html#TypeLevel"><span class="hs-identifier hs-var">TypeLevel</span></a></span><span> </span><span class="annot"><span class="annottext">Role
</span><a href="Language.Haskell.Syntax.Basic.html#Nominal"><span class="hs-identifier hs-var">Nominal</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[(TcType, TcType)]
</span><a href="#local-6989586621683014244"><span class="hs-identifier hs-var">pairs</span></a></span><span>
</span><span id="line-275"></span><span>
</span><span id="line-276"></span><span class="annot"><span class="hs-comment">-- | Emits a new equality constraint</span></span><span>
</span><span id="line-277"></span><span class="annot"><a href="GHC.Tc.Utils.TcMType.html#emitWantedEq"><span class="hs-identifier hs-type">emitWantedEq</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Tc.Types.Origin.html#CtOrigin"><span class="hs-identifier hs-type">CtOrigin</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Types.Basic.html#TypeOrKind"><span class="hs-identifier hs-type">TypeOrKind</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Language.Haskell.Syntax.Basic.html#Role"><span class="hs-identifier hs-type">Role</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.TcType.html#TcType"><span class="hs-identifier hs-type">TcType</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.TcType.html#TcType"><span class="hs-identifier hs-type">TcType</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#TcM"><span class="hs-identifier hs-type">TcM</span></a></span><span> </span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#Coercion"><span class="hs-identifier hs-type">Coercion</span></a></span><span>
</span><span id="line-278"></span><span id="emitWantedEq"><span class="annot"><span class="annottext">emitWantedEq :: CtOrigin
-&gt; TypeOrKind
-&gt; Role
-&gt; TcType
-&gt; TcType
-&gt; IOEnv (Env TcGblEnv TcLclEnv) Coercion
</span><a href="GHC.Tc.Utils.TcMType.html#emitWantedEq"><span class="hs-identifier hs-var hs-var">emitWantedEq</span></a></span></span><span> </span><span id="local-6989586621683014250"><span class="annot"><span class="annottext">CtOrigin
</span><a href="#local-6989586621683014250"><span class="hs-identifier hs-var">origin</span></a></span></span><span> </span><span id="local-6989586621683014251"><span class="annot"><span class="annottext">TypeOrKind
</span><a href="#local-6989586621683014251"><span class="hs-identifier hs-var">t_or_k</span></a></span></span><span> </span><span id="local-6989586621683014252"><span class="annot"><span class="annottext">Role
</span><a href="#local-6989586621683014252"><span class="hs-keyword hs-var">role</span></a></span></span><span> </span><span id="local-6989586621683014253"><span class="annot"><span class="annottext">TcType
</span><a href="#local-6989586621683014253"><span class="hs-identifier hs-var">ty1</span></a></span></span><span> </span><span id="local-6989586621683014254"><span class="annot"><span class="annottext">TcType
</span><a href="#local-6989586621683014254"><span class="hs-identifier hs-var">ty2</span></a></span></span><span>
</span><span id="line-279"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span id="local-6989586621683014255"><span class="annot"><a href="#local-6989586621683014255"><span class="hs-identifier hs-var">hole</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">CtOrigin -&gt; TcType -&gt; IOEnv (Env TcGblEnv TcLclEnv) CoercionHole
</span><a href="GHC.Tc.Utils.TcMType.html#newCoercionHoleO"><span class="hs-identifier hs-var">newCoercionHoleO</span></a></span><span> </span><span class="annot"><span class="annottext">CtOrigin
</span><a href="#local-6989586621683014250"><span class="hs-identifier hs-var">origin</span></a></span><span> </span><span class="annot"><span class="annottext">TcType
</span><a href="#local-6989586621683014256"><span class="hs-identifier hs-var">pty</span></a></span><span>
</span><span id="line-280"></span><span>       </span><span class="hs-special">;</span><span> </span><span id="local-6989586621683014257"><span class="annot"><a href="#local-6989586621683014257"><span class="hs-identifier hs-var">loc</span></a></span></span><span>  </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.Monad.html#getCtLocM"><span class="hs-identifier hs-type">getCtLocM</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683014250"><span class="hs-identifier hs-type">origin</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span class="annot"><a href="#local-6989586621683014251"><span class="hs-identifier hs-type">t_or_k</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-281"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.Monad.html#emitSimple"><span class="hs-identifier hs-type">emitSimple</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="annot"><a href="GHC.Tc.Types.Constraint.html#mkNonCanonical"><span class="hs-identifier hs-type">mkNonCanonical</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span>
</span><span id="line-282"></span><span>         </span><span class="annot"><a href="GHC.Tc.Types.Constraint.html#CtWanted"><span class="hs-identifier hs-type">CtWanted</span></a></span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><a href="GHC.Tc.Types.Constraint.html#ctev_pred"><span class="hs-identifier hs-var">ctev_pred</span></a></span><span>      </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="#local-6989586621683014256"><span class="hs-identifier hs-type">pty</span></a></span><span>
</span><span id="line-283"></span><span>                  </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Tc.Types.Constraint.html#ctev_dest"><span class="hs-identifier hs-var">ctev_dest</span></a></span><span>      </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="GHC.Tc.Types.Constraint.html#HoleDest"><span class="hs-identifier hs-type">HoleDest</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683014255"><span class="hs-identifier hs-type">hole</span></a></span><span>
</span><span id="line-284"></span><span>                  </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Tc.Types.Constraint.html#ctev_loc"><span class="hs-identifier hs-var">ctev_loc</span></a></span><span>       </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="#local-6989586621683014257"><span class="hs-identifier hs-type">loc</span></a></span><span>
</span><span id="line-285"></span><span>                  </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Tc.Types.Constraint.html#ctev_rewriters"><span class="hs-identifier hs-var">ctev_rewriters</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="GHC.Tc.Types.Constraint.html#emptyRewriterSet"><span class="hs-identifier hs-type">emptyRewriterSet</span></a></span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-286"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">return</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#HoleCo"><span class="hs-identifier hs-type">HoleCo</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683014255"><span class="hs-identifier hs-type">hole</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-287"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-288"></span><span>    </span><span id="local-6989586621683014256"><span class="annot"><span class="annottext">pty :: TcType
</span><a href="#local-6989586621683014256"><span class="hs-identifier hs-var hs-var">pty</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Role -&gt; TcType -&gt; TcType -&gt; TcType
</span><a href="GHC.Core.Coercion.html#mkPrimEqPredRole"><span class="hs-identifier hs-var">mkPrimEqPredRole</span></a></span><span> </span><span class="annot"><span class="annottext">Role
</span><a href="#local-6989586621683014252"><span class="hs-keyword hs-var">role</span></a></span><span> </span><span class="annot"><span class="annottext">TcType
</span><a href="#local-6989586621683014253"><span class="hs-identifier hs-var">ty1</span></a></span><span> </span><span class="annot"><span class="annottext">TcType
</span><a href="#local-6989586621683014254"><span class="hs-identifier hs-var">ty2</span></a></span><span>
</span><span id="line-289"></span><span>
</span><span id="line-290"></span><span class="hs-comment">-- | Creates a new EvVar and immediately emits it as a Wanted.</span><span>
</span><span id="line-291"></span><span class="hs-comment">-- No equality predicates here.</span><span>
</span><span id="line-292"></span><span class="annot"><a href="GHC.Tc.Utils.TcMType.html#emitWantedEvVar"><span class="hs-identifier hs-type">emitWantedEvVar</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Tc.Types.Origin.html#CtOrigin"><span class="hs-identifier hs-type">CtOrigin</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.TcType.html#TcPredType"><span class="hs-identifier hs-type">TcPredType</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#TcM"><span class="hs-identifier hs-type">TcM</span></a></span><span> </span><span class="annot"><a href="GHC.Types.Var.html#EvVar"><span class="hs-identifier hs-type">EvVar</span></a></span><span>
</span><span id="line-293"></span><span id="emitWantedEvVar"><span class="annot"><span class="annottext">emitWantedEvVar :: CtOrigin -&gt; TcType -&gt; IOEnv (Env TcGblEnv TcLclEnv) TcTyVar
</span><a href="GHC.Tc.Utils.TcMType.html#emitWantedEvVar"><span class="hs-identifier hs-var hs-var">emitWantedEvVar</span></a></span></span><span> </span><span id="local-6989586621683014260"><span class="annot"><span class="annottext">CtOrigin
</span><a href="#local-6989586621683014260"><span class="hs-identifier hs-var">origin</span></a></span></span><span> </span><span id="local-6989586621683014261"><span class="annot"><span class="annottext">TcType
</span><a href="#local-6989586621683014261"><span class="hs-identifier hs-var">ty</span></a></span></span><span>
</span><span id="line-294"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span id="local-6989586621683014262"><span class="annot"><a href="#local-6989586621683014262"><span class="hs-identifier hs-var">new_cv</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">TcType -&gt; IOEnv (Env TcGblEnv TcLclEnv) TcTyVar
forall gbl lcl. TcType -&gt; TcRnIf gbl lcl TcTyVar
</span><a href="GHC.Tc.Utils.TcMType.html#newEvVar"><span class="hs-identifier hs-var">newEvVar</span></a></span><span> </span><span class="annot"><span class="annottext">TcType
</span><a href="#local-6989586621683014261"><span class="hs-identifier hs-var">ty</span></a></span><span>
</span><span id="line-295"></span><span>       </span><span class="hs-special">;</span><span> </span><span id="local-6989586621683014263"><span class="annot"><a href="#local-6989586621683014263"><span class="hs-identifier hs-var">loc</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.Monad.html#getCtLocM"><span class="hs-identifier hs-type">getCtLocM</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683014260"><span class="hs-identifier hs-type">origin</span></a></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Nothing</span></span><span>
</span><span id="line-296"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621683014264"><span class="annot"><a href="#local-6989586621683014264"><span class="hs-identifier hs-var hs-var">ctev</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="GHC.Tc.Types.Constraint.html#CtWanted"><span class="hs-identifier hs-type">CtWanted</span></a></span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">ctev_pred :: TcType
</span><a href="GHC.Tc.Types.Constraint.html#ctev_pred"><span class="hs-identifier hs-var">ctev_pred</span></a></span><span>      </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">TcType
</span><a href="#local-6989586621683014261"><span class="hs-identifier hs-var">ty</span></a></span><span>
</span><span id="line-297"></span><span>                             </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">ctev_dest :: TcEvDest
</span><a href="GHC.Tc.Types.Constraint.html#ctev_dest"><span class="hs-identifier hs-var">ctev_dest</span></a></span><span>      </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">TcTyVar -&gt; TcEvDest
</span><a href="GHC.Tc.Types.Constraint.html#EvVarDest"><span class="hs-identifier hs-var">EvVarDest</span></a></span><span> </span><span class="annot"><span class="annottext">TcTyVar
</span><a href="#local-6989586621683014262"><span class="hs-identifier hs-var">new_cv</span></a></span><span>
</span><span id="line-298"></span><span>                             </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">ctev_loc :: CtLoc
</span><a href="GHC.Tc.Types.Constraint.html#ctev_loc"><span class="hs-identifier hs-var">ctev_loc</span></a></span><span>       </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">CtLoc
</span><a href="#local-6989586621683014263"><span class="hs-identifier hs-var">loc</span></a></span><span>
</span><span id="line-299"></span><span>                             </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">ctev_rewriters :: RewriterSet
</span><a href="GHC.Tc.Types.Constraint.html#ctev_rewriters"><span class="hs-identifier hs-var">ctev_rewriters</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">RewriterSet
</span><a href="GHC.Tc.Types.Constraint.html#emptyRewriterSet"><span class="hs-identifier hs-var">emptyRewriterSet</span></a></span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-300"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.Monad.html#emitSimple"><span class="hs-identifier hs-type">emitSimple</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="annot"><a href="GHC.Tc.Types.Constraint.html#mkNonCanonical"><span class="hs-identifier hs-type">mkNonCanonical</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683014264"><span class="hs-identifier hs-type">ctev</span></a></span><span>
</span><span id="line-301"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">return</span></span><span> </span><span class="annot"><a href="#local-6989586621683014262"><span class="hs-identifier hs-type">new_cv</span></a></span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-302"></span><span>
</span><span id="line-303"></span><span class="annot"><a href="GHC.Tc.Utils.TcMType.html#emitWantedEvVars"><span class="hs-identifier hs-type">emitWantedEvVars</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Tc.Types.Origin.html#CtOrigin"><span class="hs-identifier hs-type">CtOrigin</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="GHC.Tc.Utils.TcType.html#TcPredType"><span class="hs-identifier hs-type">TcPredType</span></a></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#TcM"><span class="hs-identifier hs-type">TcM</span></a></span><span> </span><span class="hs-special">[</span><span class="annot"><a href="GHC.Types.Var.html#EvVar"><span class="hs-identifier hs-type">EvVar</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-304"></span><span id="emitWantedEvVars"><span class="annot"><span class="annottext">emitWantedEvVars :: CtOrigin -&gt; [TcType] -&gt; TcM [TcTyVar]
</span><a href="GHC.Tc.Utils.TcMType.html#emitWantedEvVars"><span class="hs-identifier hs-var hs-var">emitWantedEvVars</span></a></span></span><span> </span><span id="local-6989586621683014265"><span class="annot"><span class="annottext">CtOrigin
</span><a href="#local-6989586621683014265"><span class="hs-identifier hs-var">orig</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(TcType -&gt; IOEnv (Env TcGblEnv TcLclEnv) TcTyVar)
-&gt; [TcType] -&gt; TcM [TcTyVar]
forall (t :: * -&gt; *) (m :: * -&gt; *) a b.
(Traversable t, Monad m) =&gt;
(a -&gt; m b) -&gt; t a -&gt; m (t b)
forall (m :: * -&gt; *) a b. Monad m =&gt; (a -&gt; m b) -&gt; [a] -&gt; m [b]
</span><span class="hs-identifier hs-var">mapM</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">CtOrigin -&gt; TcType -&gt; IOEnv (Env TcGblEnv TcLclEnv) TcTyVar
</span><a href="GHC.Tc.Utils.TcMType.html#emitWantedEvVar"><span class="hs-identifier hs-var">emitWantedEvVar</span></a></span><span> </span><span class="annot"><span class="annottext">CtOrigin
</span><a href="#local-6989586621683014265"><span class="hs-identifier hs-var">orig</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-305"></span><span>
</span><span id="line-306"></span><span class="annot"><span class="hs-comment">-- | Emit a new wanted expression hole</span></span><span>
</span><span id="line-307"></span><span class="annot"><a href="GHC.Tc.Utils.TcMType.html#emitNewExprHole"><span class="hs-identifier hs-type">emitNewExprHole</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Types.Name.Reader.html#RdrName"><span class="hs-identifier hs-type">RdrName</span></a></span><span>         </span><span class="hs-comment">-- of the hole</span><span>
</span><span id="line-308"></span><span>                </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#Type"><span class="hs-identifier hs-type">Type</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#TcM"><span class="hs-identifier hs-type">TcM</span></a></span><span> </span><span class="annot"><a href="GHC.Tc.Types.Evidence.html#HoleExprRef"><span class="hs-identifier hs-type">HoleExprRef</span></a></span><span>
</span><span id="line-309"></span><span id="emitNewExprHole"><span class="annot"><span class="annottext">emitNewExprHole :: RdrName -&gt; TcType -&gt; TcM HoleExprRef
</span><a href="GHC.Tc.Utils.TcMType.html#emitNewExprHole"><span class="hs-identifier hs-var hs-var">emitNewExprHole</span></a></span></span><span> </span><span id="local-6989586621683014267"><span class="annot"><span class="annottext">RdrName
</span><a href="#local-6989586621683014267"><span class="hs-identifier hs-var">occ</span></a></span></span><span> </span><span id="local-6989586621683014268"><span class="annot"><span class="annottext">TcType
</span><a href="#local-6989586621683014268"><span class="hs-identifier hs-var">ty</span></a></span></span><span>
</span><span id="line-310"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span id="local-6989586621683014269"><span class="annot"><a href="#local-6989586621683014269"><span class="hs-identifier hs-var">u</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">TcRnIf TcGblEnv TcLclEnv Unique
forall gbl lcl. TcRnIf gbl lcl Unique
</span><a href="GHC.Tc.Utils.Monad.html#newUnique"><span class="hs-identifier hs-var">newUnique</span></a></span><span>
</span><span id="line-311"></span><span>       </span><span class="hs-special">;</span><span> </span><span id="local-6989586621683014271"><span class="annot"><a href="#local-6989586621683014271"><span class="hs-identifier hs-var">ref</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><a href="GHC.Tc.Types.TcRef.html#newTcRef"><span class="hs-identifier hs-type">newTcRef</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Utils.Panic.html#pprPanic"><span class="hs-identifier hs-type">pprPanic</span></a></span><span> </span><span class="annot"><span class="hs-string">&quot;unfilled unbound-variable evidence&quot;</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-type">ppr</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683014269"><span class="hs-identifier hs-type">u</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-312"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621683014273"><span class="annot"><a href="#local-6989586621683014273"><span class="hs-identifier hs-var hs-var">her</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">TcRef EvTerm -&gt; TcType -&gt; Unique -&gt; HoleExprRef
</span><a href="GHC.Tc.Types.Evidence.html#HER"><span class="hs-identifier hs-var">HER</span></a></span><span> </span><span class="annot"><span class="annottext">TcRef EvTerm
</span><a href="#local-6989586621683014271"><span class="hs-identifier hs-var">ref</span></a></span><span> </span><span class="annot"><span class="annottext">TcType
</span><a href="#local-6989586621683014268"><span class="hs-identifier hs-var">ty</span></a></span><span> </span><span class="annot"><span class="annottext">Unique
</span><a href="#local-6989586621683014269"><span class="hs-identifier hs-var">u</span></a></span><span>
</span><span id="line-313"></span><span>
</span><span id="line-314"></span><span>       </span><span class="hs-special">;</span><span> </span><span id="local-6989586621683014275"><span class="annot"><a href="#local-6989586621683014275"><span class="hs-identifier hs-var">loc</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.Monad.html#getCtLocM"><span class="hs-identifier hs-type">getCtLocM</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Tc.Types.Origin.html#ExprHoleOrigin"><span class="hs-identifier hs-type">ExprHoleOrigin</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span class="annot"><a href="#local-6989586621683014267"><span class="hs-identifier hs-type">occ</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span class="annot"><a href="GHC.Types.Basic.html#TypeLevel"><span class="hs-identifier hs-type">TypeLevel</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-315"></span><span>
</span><span id="line-316"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621683014277"><span class="annot"><a href="#local-6989586621683014277"><span class="hs-identifier hs-var hs-var">hole</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="GHC.Tc.Types.Constraint.html#Hole"><span class="hs-identifier hs-type">Hole</span></a></span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">hole_sort :: HoleSort
</span><a href="GHC.Tc.Types.Constraint.html#hole_sort"><span class="hs-identifier hs-var">hole_sort</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">HoleExprRef -&gt; HoleSort
</span><a href="GHC.Tc.Types.Constraint.html#ExprHole"><span class="hs-identifier hs-var">ExprHole</span></a></span><span> </span><span class="annot"><span class="annottext">HoleExprRef
</span><a href="#local-6989586621683014273"><span class="hs-identifier hs-var">her</span></a></span><span>
</span><span id="line-317"></span><span>                         </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">hole_occ :: RdrName
</span><a href="GHC.Tc.Types.Constraint.html#hole_occ"><span class="hs-identifier hs-var">hole_occ</span></a></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">RdrName
</span><a href="#local-6989586621683014267"><span class="hs-identifier hs-var">occ</span></a></span><span>
</span><span id="line-318"></span><span>                         </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">hole_ty :: TcType
</span><a href="GHC.Tc.Types.Constraint.html#hole_ty"><span class="hs-identifier hs-var">hole_ty</span></a></span><span>   </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">TcType
</span><a href="#local-6989586621683014268"><span class="hs-identifier hs-var">ty</span></a></span><span>
</span><span id="line-319"></span><span>                         </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">hole_loc :: CtLoc
</span><a href="GHC.Tc.Types.Constraint.html#hole_loc"><span class="hs-identifier hs-var">hole_loc</span></a></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">CtLoc
</span><a href="#local-6989586621683014275"><span class="hs-identifier hs-var">loc</span></a></span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-320"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.Monad.html#emitHole"><span class="hs-identifier hs-type">emitHole</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683014277"><span class="hs-identifier hs-type">hole</span></a></span><span>
</span><span id="line-321"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">return</span></span><span> </span><span class="annot"><a href="#local-6989586621683014273"><span class="hs-identifier hs-type">her</span></a></span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-322"></span><span>
</span><span id="line-323"></span><span class="annot"><a href="GHC.Tc.Utils.TcMType.html#newDict"><span class="hs-identifier hs-type">newDict</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Core.Class.html#Class"><span class="hs-identifier hs-type">Class</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="GHC.Tc.Utils.TcType.html#TcType"><span class="hs-identifier hs-type">TcType</span></a></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#TcM"><span class="hs-identifier hs-type">TcM</span></a></span><span> </span><span class="annot"><a href="GHC.Types.Var.html#DictId"><span class="hs-identifier hs-type">DictId</span></a></span><span>
</span><span id="line-324"></span><span id="newDict"><span class="annot"><span class="annottext">newDict :: Class -&gt; [TcType] -&gt; IOEnv (Env TcGblEnv TcLclEnv) TcTyVar
</span><a href="GHC.Tc.Utils.TcMType.html#newDict"><span class="hs-identifier hs-var hs-var">newDict</span></a></span></span><span> </span><span id="local-6989586621683014286"><span class="annot"><span class="annottext">Class
</span><a href="#local-6989586621683014286"><span class="hs-identifier hs-var">cls</span></a></span></span><span> </span><span id="local-6989586621683014287"><span class="annot"><span class="annottext">[TcType]
</span><a href="#local-6989586621683014287"><span class="hs-identifier hs-var">tys</span></a></span></span><span>
</span><span id="line-325"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span id="local-6989586621683014288"><span class="annot"><a href="#local-6989586621683014288"><span class="hs-identifier hs-var">name</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">OccName -&gt; TcM Name
forall gbl lcl. OccName -&gt; TcRnIf gbl lcl Name
</span><a href="GHC.Tc.Utils.Monad.html#newSysName"><span class="hs-identifier hs-var">newSysName</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">OccName -&gt; OccName
</span><a href="GHC.Types.Name.Occurrence.html#mkDictOcc"><span class="hs-identifier hs-var">mkDictOcc</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Class -&gt; OccName
forall a. NamedThing a =&gt; a -&gt; OccName
</span><a href="GHC.Types.Name.html#getOccName"><span class="hs-identifier hs-var">getOccName</span></a></span><span> </span><span class="annot"><span class="annottext">Class
</span><a href="#local-6989586621683014286"><span class="hs-identifier hs-var">cls</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-326"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">return</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Types.Id.html#mkLocalId"><span class="hs-identifier hs-type">mkLocalId</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683014288"><span class="hs-identifier hs-type">name</span></a></span><span> </span><span class="annot"><a href="GHC.Core.Type.html#ManyTy"><span class="hs-identifier hs-type">ManyTy</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Core.Predicate.html#mkClassPred"><span class="hs-identifier hs-type">mkClassPred</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683014286"><span class="hs-identifier hs-type">cls</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683014287"><span class="hs-identifier hs-type">tys</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-327"></span><span>
</span><span id="line-328"></span><span class="annot"><a href="GHC.Tc.Utils.TcMType.html#predTypeOccName"><span class="hs-identifier hs-type">predTypeOccName</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#PredType"><span class="hs-identifier hs-type">PredType</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Types.Name.Occurrence.html#OccName"><span class="hs-identifier hs-type">OccName</span></a></span><span>
</span><span id="line-329"></span><span id="predTypeOccName"><span class="annot"><span class="annottext">predTypeOccName :: TcType -&gt; OccName
</span><a href="GHC.Tc.Utils.TcMType.html#predTypeOccName"><span class="hs-identifier hs-var hs-var">predTypeOccName</span></a></span></span><span> </span><span id="local-6989586621683014293"><span class="annot"><span class="annottext">TcType
</span><a href="#local-6989586621683014293"><span class="hs-identifier hs-var">ty</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">TcType -&gt; Pred
</span><a href="GHC.Core.Predicate.html#classifyPredType"><span class="hs-identifier hs-var">classifyPredType</span></a></span><span> </span><span class="annot"><span class="annottext">TcType
</span><a href="#local-6989586621683014293"><span class="hs-identifier hs-var">ty</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-330"></span><span>    </span><span class="annot"><a href="GHC.Core.Predicate.html#ClassPred"><span class="hs-identifier hs-type">ClassPred</span></a></span><span> </span><span id="local-6989586621683014295"><span class="annot"><span class="annottext">Class
</span><a href="#local-6989586621683014295"><span class="hs-identifier hs-var">cls</span></a></span></span><span> </span><span class="annot"><span class="annottext">[TcType]
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">OccName -&gt; OccName
</span><a href="GHC.Types.Name.Occurrence.html#mkDictOcc"><span class="hs-identifier hs-var">mkDictOcc</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Class -&gt; OccName
forall a. NamedThing a =&gt; a -&gt; OccName
</span><a href="GHC.Types.Name.html#getOccName"><span class="hs-identifier hs-var">getOccName</span></a></span><span> </span><span class="annot"><span class="annottext">Class
</span><a href="#local-6989586621683014295"><span class="hs-identifier hs-var">cls</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-331"></span><span>    </span><span class="annot"><a href="GHC.Core.Predicate.html#EqPred"><span class="hs-identifier hs-type">EqPred</span></a></span><span> </span><span class="hs-special">{</span><span class="hs-special">}</span><span>       </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">FastString -&gt; OccName
</span><a href="GHC.Types.Name.Occurrence.html#mkVarOccFS"><span class="hs-identifier hs-var">mkVarOccFS</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">String -&gt; FastString
</span><a href="GHC.Data.FastString.html#fsLit"><span class="hs-identifier hs-var">fsLit</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;co&quot;</span></span><span class="hs-special">)</span><span>
</span><span id="line-332"></span><span>    </span><span class="annot"><a href="GHC.Core.Predicate.html#IrredPred"><span class="hs-identifier hs-type">IrredPred</span></a></span><span> </span><span class="hs-special">{</span><span class="hs-special">}</span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">FastString -&gt; OccName
</span><a href="GHC.Types.Name.Occurrence.html#mkVarOccFS"><span class="hs-identifier hs-var">mkVarOccFS</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">String -&gt; FastString
</span><a href="GHC.Data.FastString.html#fsLit"><span class="hs-identifier hs-var">fsLit</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;irred&quot;</span></span><span class="hs-special">)</span><span>
</span><span id="line-333"></span><span>    </span><span class="annot"><a href="GHC.Core.Predicate.html#ForAllPred"><span class="hs-identifier hs-type">ForAllPred</span></a></span><span> </span><span class="hs-special">{</span><span class="hs-special">}</span><span>   </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">FastString -&gt; OccName
</span><a href="GHC.Types.Name.Occurrence.html#mkVarOccFS"><span class="hs-identifier hs-var">mkVarOccFS</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">String -&gt; FastString
</span><a href="GHC.Data.FastString.html#fsLit"><span class="hs-identifier hs-var">fsLit</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;df&quot;</span></span><span class="hs-special">)</span><span>
</span><span id="line-334"></span><span>
</span><span id="line-335"></span><span class="hs-comment">-- | Create a new 'Implication' with as many sensible defaults for its fields</span><span>
</span><span id="line-336"></span><span class="hs-comment">-- as possible. Note that the 'ic_tclvl', 'ic_binds', and 'ic_info' fields do</span><span>
</span><span id="line-337"></span><span class="hs-comment">-- /not/ have sensible defaults, so they are initialized with lazy thunks that</span><span>
</span><span id="line-338"></span><span class="hs-comment">-- will 'panic' if forced, so one should take care to initialize these fields</span><span>
</span><span id="line-339"></span><span class="hs-comment">-- after creation.</span><span>
</span><span id="line-340"></span><span class="hs-comment">--</span><span>
</span><span id="line-341"></span><span class="hs-comment">-- This is monadic to look up the 'TcLclEnv', which is used to initialize</span><span>
</span><span id="line-342"></span><span class="hs-comment">-- 'ic_env', and to set the -Winaccessible-code flag. See</span><span>
</span><span id="line-343"></span><span class="hs-comment">-- Note [Avoid -Winaccessible-code when deriving] in &quot;GHC.Tc.TyCl.Instance&quot;.</span><span>
</span><span id="line-344"></span><span class="annot"><a href="GHC.Tc.Utils.TcMType.html#newImplication"><span class="hs-identifier hs-type">newImplication</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#TcM"><span class="hs-identifier hs-type">TcM</span></a></span><span> </span><span class="annot"><a href="GHC.Tc.Types.Constraint.html#Implication"><span class="hs-identifier hs-type">Implication</span></a></span><span>
</span><span id="line-345"></span><span id="newImplication"><span class="annot"><span class="annottext">newImplication :: IOEnv (Env TcGblEnv TcLclEnv) Implication
</span><a href="GHC.Tc.Utils.TcMType.html#newImplication"><span class="hs-identifier hs-var hs-var">newImplication</span></a></span></span><span>
</span><span id="line-346"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span id="local-6989586621683014304"><span class="annot"><a href="#local-6989586621683014304"><span class="hs-identifier hs-var">env</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">TcRnIf TcGblEnv TcLclEnv TcLclEnv
forall gbl lcl. TcRnIf gbl lcl lcl
</span><a href="GHC.Tc.Utils.Monad.html#getLclEnv"><span class="hs-identifier hs-var">getLclEnv</span></a></span><span>
</span><span id="line-347"></span><span>       </span><span id="local-6989586621683014306"><span class="annot"><a href="#local-6989586621683014306"><span class="hs-identifier hs-var">warn_inaccessible</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.Monad.html#woptM"><span class="hs-identifier hs-type">woptM</span></a></span><span> </span><span class="annot"><a href="GHC.Driver.Flags.html#Opt_WarnInaccessibleCode"><span class="hs-identifier hs-type">Opt_WarnInaccessibleCode</span></a></span><span>
</span><span id="line-348"></span><span>       </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621683014309"><span class="annot"><a href="#local-6989586621683014309"><span class="hs-identifier hs-var hs-var">in_gen_code</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">TcLclEnv -&gt; Bool
</span><a href="GHC.Tc.Types.LclEnv.html#lclEnvInGeneratedCode"><span class="hs-identifier hs-var">lclEnvInGeneratedCode</span></a></span><span> </span><span class="annot"><span class="annottext">TcLclEnv
</span><a href="#local-6989586621683014304"><span class="hs-identifier hs-var">env</span></a></span><span>
</span><span id="line-349"></span><span>       </span><span class="annot"><span class="hs-identifier hs-type">return</span></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span>
</span><span id="line-350"></span><span>         </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Tc.Types.Constraint.html#implicationPrototype"><span class="hs-identifier hs-type">implicationPrototype</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Tc.Utils.Monad.html#mkCtLocEnv"><span class="hs-identifier hs-type">mkCtLocEnv</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683014304"><span class="hs-identifier hs-type">env</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-351"></span><span>           </span><span class="hs-special">{</span><span> </span><span class="annot"><a href="GHC.Tc.Types.Constraint.html#ic_warn_inaccessible"><span class="hs-identifier hs-var">ic_warn_inaccessible</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="#local-6989586621683014306"><span class="hs-identifier hs-type">warn_inaccessible</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">&amp;&amp;</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">not</span></span><span> </span><span class="annot"><a href="#local-6989586621683014309"><span class="hs-identifier hs-type">in_gen_code</span></a></span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-352"></span><span>
</span><span id="line-353"></span><span class="hs-comment">{-
************************************************************************
*                                                                      *
        Coercion holes
*                                                                      *
************************************************************************
-}</span><span>
</span><span id="line-360"></span><span>
</span><span id="line-361"></span><span class="annot"><a href="GHC.Tc.Utils.TcMType.html#newVanillaCoercionHole"><span class="hs-identifier hs-type">newVanillaCoercionHole</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.TcType.html#TcPredType"><span class="hs-identifier hs-type">TcPredType</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#TcM"><span class="hs-identifier hs-type">TcM</span></a></span><span> </span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#CoercionHole"><span class="hs-identifier hs-type">CoercionHole</span></a></span><span>
</span><span id="line-362"></span><span id="newVanillaCoercionHole"><span class="annot"><span class="annottext">newVanillaCoercionHole :: TcType -&gt; IOEnv (Env TcGblEnv TcLclEnv) CoercionHole
</span><a href="GHC.Tc.Utils.TcMType.html#newVanillaCoercionHole"><span class="hs-identifier hs-var hs-var">newVanillaCoercionHole</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Bool -&gt; TcType -&gt; IOEnv (Env TcGblEnv TcLclEnv) CoercionHole
</span><a href="GHC.Tc.Utils.TcMType.html#new_coercion_hole"><span class="hs-identifier hs-var">new_coercion_hole</span></a></span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">False</span></span><span>
</span><span id="line-363"></span><span>
</span><span id="line-364"></span><span class="annot"><a href="GHC.Tc.Utils.TcMType.html#newCoercionHole"><span class="hs-identifier hs-type">newCoercionHole</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Tc.Types.CtLoc.html#CtLoc"><span class="hs-identifier hs-type">CtLoc</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.TcType.html#TcPredType"><span class="hs-identifier hs-type">TcPredType</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#TcM"><span class="hs-identifier hs-type">TcM</span></a></span><span> </span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#CoercionHole"><span class="hs-identifier hs-type">CoercionHole</span></a></span><span>
</span><span id="line-365"></span><span id="newCoercionHole"><span class="annot"><span class="annottext">newCoercionHole :: CtLoc -&gt; TcType -&gt; IOEnv (Env TcGblEnv TcLclEnv) CoercionHole
</span><a href="GHC.Tc.Utils.TcMType.html#newCoercionHole"><span class="hs-identifier hs-var hs-var">newCoercionHole</span></a></span></span><span> </span><span id="local-6989586621683014317"><span class="annot"><span class="annottext">CtLoc
</span><a href="#local-6989586621683014317"><span class="hs-identifier hs-var">loc</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">CtOrigin -&gt; TcType -&gt; IOEnv (Env TcGblEnv TcLclEnv) CoercionHole
</span><a href="GHC.Tc.Utils.TcMType.html#newCoercionHoleO"><span class="hs-identifier hs-var">newCoercionHoleO</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">CtLoc -&gt; CtOrigin
</span><a href="GHC.Tc.Types.CtLoc.html#ctLocOrigin"><span class="hs-identifier hs-var">ctLocOrigin</span></a></span><span> </span><span class="annot"><span class="annottext">CtLoc
</span><a href="#local-6989586621683014317"><span class="hs-identifier hs-var">loc</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-366"></span><span>
</span><span id="line-367"></span><span class="annot"><a href="GHC.Tc.Utils.TcMType.html#newCoercionHoleO"><span class="hs-identifier hs-type">newCoercionHoleO</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Tc.Types.Origin.html#CtOrigin"><span class="hs-identifier hs-type">CtOrigin</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.TcType.html#TcPredType"><span class="hs-identifier hs-type">TcPredType</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#TcM"><span class="hs-identifier hs-type">TcM</span></a></span><span> </span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#CoercionHole"><span class="hs-identifier hs-type">CoercionHole</span></a></span><span>
</span><span id="line-368"></span><span id="newCoercionHoleO"><span class="annot"><span class="annottext">newCoercionHoleO :: CtOrigin -&gt; TcType -&gt; IOEnv (Env TcGblEnv TcLclEnv) CoercionHole
</span><a href="GHC.Tc.Utils.TcMType.html#newCoercionHoleO"><span class="hs-identifier hs-var hs-var">newCoercionHoleO</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Tc.Types.Origin.html#KindEqOrigin"><span class="hs-identifier hs-type">KindEqOrigin</span></a></span><span> </span><span class="hs-special">{</span><span class="hs-special">}</span><span class="hs-special">)</span><span> </span><span id="local-6989586621683014319"><span class="annot"><span class="annottext">TcType
</span><a href="#local-6989586621683014319"><span class="hs-identifier hs-var">pty</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Bool -&gt; TcType -&gt; IOEnv (Env TcGblEnv TcLclEnv) CoercionHole
</span><a href="GHC.Tc.Utils.TcMType.html#new_coercion_hole"><span class="hs-identifier hs-var">new_coercion_hole</span></a></span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">True</span></span><span> </span><span class="annot"><span class="annottext">TcType
</span><a href="#local-6989586621683014319"><span class="hs-identifier hs-var">pty</span></a></span><span>
</span><span id="line-369"></span><span class="annot"><a href="GHC.Tc.Utils.TcMType.html#newCoercionHoleO"><span class="hs-identifier hs-var">newCoercionHoleO</span></a></span><span> </span><span class="annot"><span class="annottext">CtOrigin
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621683014320"><span class="annot"><span class="annottext">TcType
</span><a href="#local-6989586621683014320"><span class="hs-identifier hs-var">pty</span></a></span></span><span>                 </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Bool -&gt; TcType -&gt; IOEnv (Env TcGblEnv TcLclEnv) CoercionHole
</span><a href="GHC.Tc.Utils.TcMType.html#new_coercion_hole"><span class="hs-identifier hs-var">new_coercion_hole</span></a></span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">False</span></span><span> </span><span class="annot"><span class="annottext">TcType
</span><a href="#local-6989586621683014320"><span class="hs-identifier hs-var">pty</span></a></span><span>
</span><span id="line-370"></span><span>
</span><span id="line-371"></span><span class="annot"><a href="GHC.Tc.Utils.TcMType.html#new_coercion_hole"><span class="hs-identifier hs-type">new_coercion_hole</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Bool</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.TcType.html#TcPredType"><span class="hs-identifier hs-type">TcPredType</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#TcM"><span class="hs-identifier hs-type">TcM</span></a></span><span> </span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#CoercionHole"><span class="hs-identifier hs-type">CoercionHole</span></a></span><span>
</span><span id="line-372"></span><span id="new_coercion_hole"><span class="annot"><span class="annottext">new_coercion_hole :: Bool -&gt; TcType -&gt; IOEnv (Env TcGblEnv TcLclEnv) CoercionHole
</span><a href="GHC.Tc.Utils.TcMType.html#new_coercion_hole"><span class="hs-identifier hs-var hs-var">new_coercion_hole</span></a></span></span><span> </span><span id="local-6989586621683014321"><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621683014321"><span class="hs-identifier hs-var">hetero_kind</span></a></span></span><span> </span><span id="local-6989586621683014322"><span class="annot"><span class="annottext">TcType
</span><a href="#local-6989586621683014322"><span class="hs-identifier hs-var">pred_ty</span></a></span></span><span>
</span><span id="line-373"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span id="local-6989586621683014323"><span class="annot"><a href="#local-6989586621683014323"><span class="hs-identifier hs-var">co_var</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">TcType -&gt; IOEnv (Env TcGblEnv TcLclEnv) TcTyVar
forall gbl lcl. TcType -&gt; TcRnIf gbl lcl TcTyVar
</span><a href="GHC.Tc.Utils.TcMType.html#newEvVar"><span class="hs-identifier hs-var">newEvVar</span></a></span><span> </span><span class="annot"><span class="annottext">TcType
</span><a href="#local-6989586621683014322"><span class="hs-identifier hs-var">pred_ty</span></a></span><span>
</span><span id="line-374"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.Monad.html#traceTc"><span class="hs-identifier hs-type">traceTc</span></a></span><span> </span><span class="annot"><span class="hs-string">&quot;New coercion hole:&quot;</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-type">ppr</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683014323"><span class="hs-identifier hs-type">co_var</span></a></span><span> </span><span class="annot"><a href="GHC.Utils.Outputable.html#%3C%2B%3E"><span class="hs-operator hs-type">&lt;+&gt;</span></a></span><span> </span><span class="annot"><a href="GHC.Utils.Outputable.html#dcolon"><span class="hs-identifier hs-type">dcolon</span></a></span><span> </span><span class="annot"><a href="GHC.Utils.Outputable.html#%3C%2B%3E"><span class="hs-operator hs-type">&lt;+&gt;</span></a></span><span> </span><span class="annot"><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-type">ppr</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683014322"><span class="hs-identifier hs-type">pred_ty</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-375"></span><span>       </span><span class="hs-special">;</span><span> </span><span id="local-6989586621683014326"><span class="annot"><a href="#local-6989586621683014326"><span class="hs-identifier hs-var">ref</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><a href="GHC.Data.IOEnv.html#newMutVar"><span class="hs-identifier hs-type">newMutVar</span></a></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Nothing</span></span><span>
</span><span id="line-376"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">return</span></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#CoercionHole"><span class="hs-identifier hs-type">CoercionHole</span></a></span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#ch_co_var"><span class="hs-identifier hs-var">ch_co_var</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="#local-6989586621683014323"><span class="hs-identifier hs-type">co_var</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#ch_ref"><span class="hs-identifier hs-var">ch_ref</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="#local-6989586621683014326"><span class="hs-identifier hs-type">ref</span></a></span><span>
</span><span id="line-377"></span><span>                               </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#ch_hetero_kind"><span class="hs-identifier hs-var">ch_hetero_kind</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="#local-6989586621683014321"><span class="hs-identifier hs-type">hetero_kind</span></a></span><span> </span><span class="hs-special">}</span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-378"></span><span>
</span><span id="line-379"></span><span class="annot"><span class="hs-comment">-- | Put a value in a coercion hole</span></span><span>
</span><span id="line-380"></span><span class="annot"><a href="GHC.Tc.Utils.TcMType.html#fillCoercionHole"><span class="hs-identifier hs-type">fillCoercionHole</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#CoercionHole"><span class="hs-identifier hs-type">CoercionHole</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#Coercion"><span class="hs-identifier hs-type">Coercion</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#TcM"><span class="hs-identifier hs-type">TcM</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-381"></span><span id="fillCoercionHole"><span class="annot"><span class="annottext">fillCoercionHole :: CoercionHole -&gt; Coercion -&gt; TcRn ()
</span><a href="GHC.Tc.Utils.TcMType.html#fillCoercionHole"><span class="hs-identifier hs-var hs-var">fillCoercionHole</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#CoercionHole"><span class="hs-identifier hs-type">CoercionHole</span></a></span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">ch_ref :: CoercionHole -&gt; IORef (Maybe Coercion)
</span><a href="GHC.Core.TyCo.Rep.html#ch_ref"><span class="hs-identifier hs-var">ch_ref</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="local-6989586621683014332"><span class="annot"><span class="annottext">IORef (Maybe Coercion)
</span><a href="#local-6989586621683014332"><span class="hs-identifier hs-var">ref</span></a></span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">ch_co_var :: CoercionHole -&gt; TcTyVar
</span><a href="GHC.Core.TyCo.Rep.html#ch_co_var"><span class="hs-identifier hs-var">ch_co_var</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="local-6989586621683014333"><span class="annot"><span class="annottext">TcTyVar
</span><a href="#local-6989586621683014333"><span class="hs-identifier hs-var">cv</span></a></span></span><span> </span><span class="hs-special">}</span><span class="hs-special">)</span><span> </span><span id="local-6989586621683014334"><span class="annot"><span class="annottext">Coercion
</span><a href="#local-6989586621683014334"><span class="hs-identifier hs-var">co</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-382"></span><span>  </span><span class="annot"><span class="annottext">Bool -&gt; TcRn () -&gt; TcRn ()
forall (f :: * -&gt; *). Applicative f =&gt; Bool -&gt; f () -&gt; f ()
</span><span class="hs-identifier hs-var">when</span></span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="GHC.Utils.Constants.html#debugIsOn"><span class="hs-identifier hs-var">debugIsOn</span></a></span><span> </span><span class="annot"><span class="annottext">(TcRn () -&gt; TcRn ()) -&gt; TcRn () -&gt; TcRn ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-383"></span><span>    </span><span id="local-6989586621683014336"><span class="annot"><a href="#local-6989586621683014336"><span class="hs-identifier hs-var">cts</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">IORef (Maybe Coercion)
-&gt; IOEnv (Env TcGblEnv TcLclEnv) (Maybe Coercion)
forall (m :: * -&gt; *) a. MonadIO m =&gt; TcRef a -&gt; m a
</span><a href="GHC.Tc.Types.TcRef.html#readTcRef"><span class="hs-identifier hs-var">readTcRef</span></a></span><span> </span><span class="annot"><span class="annottext">IORef (Maybe Coercion)
</span><a href="#local-6989586621683014332"><span class="hs-identifier hs-var">ref</span></a></span><span>
</span><span id="line-384"></span><span>    </span><span class="annot"><a href="GHC.Data.Maybe.html#whenIsJust"><span class="hs-identifier hs-type">whenIsJust</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683014336"><span class="hs-identifier hs-type">cts</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="hs-glyph">\</span><span id="local-6989586621683014339"><span class="annot"><span class="annottext">Coercion
</span><a href="#local-6989586621683014339"><span class="hs-identifier hs-var">old_co</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-385"></span><span>      </span><span class="annot"><span class="annottext">String -&gt; SDoc -&gt; TcRn ()
forall a. HasCallStack =&gt; String -&gt; SDoc -&gt; a
</span><a href="GHC.Utils.Panic.html#pprPanic"><span class="hs-identifier hs-var">pprPanic</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;Filling a filled coercion hole&quot;</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TcTyVar -&gt; SDoc
forall a. Outputable a =&gt; a -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="annot"><span class="annottext">TcTyVar
</span><a href="#local-6989586621683014333"><span class="hs-identifier hs-var">cv</span></a></span><span> </span><span class="annot"><span class="annottext">SDoc -&gt; SDoc -&gt; SDoc
forall doc. IsDoc doc =&gt; doc -&gt; doc -&gt; doc
</span><a href="GHC.Utils.Outputable.html#%24%24"><span class="hs-operator hs-var">$$</span></a></span><span> </span><span class="annot"><span class="annottext">Coercion -&gt; SDoc
forall a. Outputable a =&gt; a -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="annot"><span class="annottext">Coercion
</span><a href="#local-6989586621683014334"><span class="hs-identifier hs-var">co</span></a></span><span> </span><span class="annot"><span class="annottext">SDoc -&gt; SDoc -&gt; SDoc
forall doc. IsDoc doc =&gt; doc -&gt; doc -&gt; doc
</span><a href="GHC.Utils.Outputable.html#%24%24"><span class="hs-operator hs-var">$$</span></a></span><span> </span><span class="annot"><span class="annottext">Coercion -&gt; SDoc
forall a. Outputable a =&gt; a -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="annot"><span class="annottext">Coercion
</span><a href="#local-6989586621683014339"><span class="hs-identifier hs-var">old_co</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-386"></span><span>  </span><span class="annot"><span class="annottext">String -&gt; SDoc -&gt; TcRn ()
</span><a href="GHC.Tc.Utils.Monad.html#traceTc"><span class="hs-identifier hs-var">traceTc</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;Filling coercion hole&quot;</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TcTyVar -&gt; SDoc
forall a. Outputable a =&gt; a -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="annot"><span class="annottext">TcTyVar
</span><a href="#local-6989586621683014333"><span class="hs-identifier hs-var">cv</span></a></span><span> </span><span class="annot"><span class="annottext">SDoc -&gt; SDoc -&gt; SDoc
forall doc. IsLine doc =&gt; doc -&gt; doc -&gt; doc
</span><a href="GHC.Utils.Outputable.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">String -&gt; SDoc
forall doc. IsLine doc =&gt; String -&gt; doc
</span><a href="GHC.Utils.Outputable.html#text"><span class="hs-identifier hs-var">text</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;:=&quot;</span></span><span> </span><span class="annot"><span class="annottext">SDoc -&gt; SDoc -&gt; SDoc
forall doc. IsLine doc =&gt; doc -&gt; doc -&gt; doc
</span><a href="GHC.Utils.Outputable.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">Coercion -&gt; SDoc
forall a. Outputable a =&gt; a -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="annot"><span class="annottext">Coercion
</span><a href="#local-6989586621683014334"><span class="hs-identifier hs-var">co</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-387"></span><span>  </span><span class="annot"><span class="annottext">IORef (Maybe Coercion) -&gt; Maybe Coercion -&gt; TcRn ()
forall (m :: * -&gt; *) a. MonadIO m =&gt; TcRef a -&gt; a -&gt; m ()
</span><a href="GHC.Tc.Types.TcRef.html#writeTcRef"><span class="hs-identifier hs-var">writeTcRef</span></a></span><span> </span><span class="annot"><span class="annottext">IORef (Maybe Coercion)
</span><a href="#local-6989586621683014332"><span class="hs-identifier hs-var">ref</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Coercion -&gt; Maybe Coercion
forall a. a -&gt; Maybe a
</span><span class="hs-identifier hs-var">Just</span></span><span> </span><span class="annot"><span class="annottext">Coercion
</span><a href="#local-6989586621683014334"><span class="hs-identifier hs-var">co</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-388"></span><span>
</span><span id="line-389"></span><span>
</span><span id="line-390"></span><span class="annot"><span class="hs-comment">{- **********************************************************************
*
                      ExpType functions
*
********************************************************************** -}</span></span><span>
</span><span id="line-395"></span><span>
</span><span id="line-396"></span><span class="hs-comment">{- Note [ExpType]
~~~~~~~~~~~~~~~~~
An ExpType is used as the &quot;expected type&quot; when type-checking an expression.
An ExpType can hold a &quot;hole&quot; that can be filled in by the type-checker.
This allows us to have one tcExpr that works in both checking mode and
synthesis mode (that is, bidirectional type-checking). Previously, this
was achieved by using ordinary unification variables, but we don't need
or want that generality. (For example, #11397 was caused by doing the
wrong thing with unification variables.) Instead, we observe that these
holes should

1. never be nested
2. never appear as the type of a variable
3. be used linearly (never be duplicated)

By defining ExpType, separately from Type, we can achieve goals 1 and 2
statically.

See also [wiki:typechecking]

Note [TcLevel of ExpType]
~~~~~~~~~~~~~~~~~~~~~~~~~
Consider

  data G a where
    MkG :: G Bool

  foo MkG = True

This is a classic untouchable-variable / ambiguous GADT return type
scenario. But, with ExpTypes, we'll be inferring the type of the RHS.
We thus must track a TcLevel in an Inferring ExpType. If we try to
fill the ExpType and find that the TcLevels don't work out, we fill
the ExpType with a tau-tv at the low TcLevel, hopefully to be worked
out later by some means -- see fillInferResult, and Note [fillInferResult]

This behaviour triggered in test gadt/gadt-escape1.

Note [FixedRuntimeRep context in ExpType]
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
Sometimes, we want to be sure that we fill an ExpType with a type
that has a syntactically fixed RuntimeRep (in the sense of
Note [Fixed RuntimeRep] in GHC.Tc.Utils.Concrete).

Example:

  pattern S a = (a :: (T :: TYPE R))

We have to infer a type for `a` which has a syntactically fixed RuntimeRep.
When it comes time to filling in the inferred type, we do the appropriate
representation-polymorphism check, much like we do a level check
as explained in Note [TcLevel of ExpType].

See test case T21325.
-}</span><span>
</span><span id="line-451"></span><span>
</span><span id="line-452"></span><span class="hs-comment">-- actual data definition is in GHC.Tc.Utils.TcType</span><span>
</span><span id="line-453"></span><span>
</span><span id="line-454"></span><span class="annot"><a href="GHC.Tc.Utils.TcMType.html#newInferExpType"><span class="hs-identifier hs-type">newInferExpType</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#TcM"><span class="hs-identifier hs-type">TcM</span></a></span><span> </span><span class="annot"><a href="GHC.Tc.Utils.TcType.html#ExpType"><span class="hs-identifier hs-type">ExpType</span></a></span><span>
</span><span id="line-455"></span><span id="newInferExpType"><span class="annot"><span class="annottext">newInferExpType :: TcM ExpType
</span><a href="GHC.Tc.Utils.TcMType.html#newInferExpType"><span class="hs-identifier hs-var hs-var">newInferExpType</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Maybe FixedRuntimeRepContext -&gt; TcM ExpType
</span><a href="GHC.Tc.Utils.TcMType.html#new_inferExpType"><span class="hs-identifier hs-var">new_inferExpType</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe FixedRuntimeRepContext
forall a. Maybe a
</span><span class="hs-identifier hs-var">Nothing</span></span><span>
</span><span id="line-456"></span><span>
</span><span id="line-457"></span><span class="annot"><a href="GHC.Tc.Utils.TcMType.html#newInferExpTypeFRR"><span class="hs-identifier hs-type">newInferExpTypeFRR</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Tc.Types.Origin.html#FixedRuntimeRepContext"><span class="hs-identifier hs-type">FixedRuntimeRepContext</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#TcM"><span class="hs-identifier hs-type">TcM</span></a></span><span> </span><span class="annot"><a href="GHC.Tc.Utils.TcType.html#ExpTypeFRR"><span class="hs-identifier hs-type">ExpTypeFRR</span></a></span><span>
</span><span id="line-458"></span><span id="newInferExpTypeFRR"><span class="annot"><span class="annottext">newInferExpTypeFRR :: FixedRuntimeRepContext -&gt; TcM ExpType
</span><a href="GHC.Tc.Utils.TcMType.html#newInferExpTypeFRR"><span class="hs-identifier hs-var hs-var">newInferExpTypeFRR</span></a></span></span><span> </span><span id="local-6989586621683014345"><span class="annot"><span class="annottext">FixedRuntimeRepContext
</span><a href="#local-6989586621683014345"><span class="hs-identifier hs-var">frr_orig</span></a></span></span><span>
</span><span id="line-459"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span id="local-6989586621683014346"><span class="annot"><a href="#local-6989586621683014346"><span class="hs-identifier hs-var">th_stage</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">TcM ThStage
</span><a href="GHC.Tc.Utils.Monad.html#getStage"><span class="hs-identifier hs-var">getStage</span></a></span><span>
</span><span id="line-460"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="hs-keyword">if</span><span>
</span><span id="line-461"></span><span>          </span><span class="hs-comment">-- See [Wrinkle: Typed Template Haskell]</span><span>
</span><span id="line-462"></span><span>          </span><span class="hs-comment">-- in Note [hasFixedRuntimeRep] in GHC.Tc.Utils.Concrete.</span><span>
</span><span id="line-463"></span><span>          </span><span class="hs-glyph">|</span><span> </span><span class="annot"><a href="GHC.Tc.Types.TH.html#Brack"><span class="hs-identifier hs-type">Brack</span></a></span><span> </span><span class="annot"><span class="hs-identifier">_</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Tc.Types.TH.html#TcPending"><span class="hs-identifier hs-type">TcPending</span></a></span><span> </span><span class="hs-special">{</span><span class="hs-special">}</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><a href="#local-6989586621683014346"><span class="hs-identifier hs-type">th_stage</span></a></span><span>
</span><span id="line-464"></span><span>          </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.TcMType.html#new_inferExpType"><span class="hs-identifier hs-type">new_inferExpType</span></a></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Nothing</span></span><span>
</span><span id="line-465"></span><span>
</span><span id="line-466"></span><span>          </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="hs-identifier hs-type">otherwise</span></span><span>
</span><span id="line-467"></span><span>          </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.TcMType.html#new_inferExpType"><span class="hs-identifier hs-type">new_inferExpType</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span class="annot"><a href="#local-6989586621683014345"><span class="hs-identifier hs-type">frr_orig</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-468"></span><span>
</span><span id="line-469"></span><span class="annot"><a href="GHC.Tc.Utils.TcMType.html#new_inferExpType"><span class="hs-identifier hs-type">new_inferExpType</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Maybe</span></span><span> </span><span class="annot"><a href="GHC.Tc.Types.Origin.html#FixedRuntimeRepContext"><span class="hs-identifier hs-type">FixedRuntimeRepContext</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#TcM"><span class="hs-identifier hs-type">TcM</span></a></span><span> </span><span class="annot"><a href="GHC.Tc.Utils.TcType.html#ExpType"><span class="hs-identifier hs-type">ExpType</span></a></span><span>
</span><span id="line-470"></span><span id="new_inferExpType"><span class="annot"><span class="annottext">new_inferExpType :: Maybe FixedRuntimeRepContext -&gt; TcM ExpType
</span><a href="GHC.Tc.Utils.TcMType.html#new_inferExpType"><span class="hs-identifier hs-var hs-var">new_inferExpType</span></a></span></span><span> </span><span id="local-6989586621683014350"><span class="annot"><span class="annottext">Maybe FixedRuntimeRepContext
</span><a href="#local-6989586621683014350"><span class="hs-identifier hs-var">mb_frr_orig</span></a></span></span><span>
</span><span id="line-471"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span id="local-6989586621683014351"><span class="annot"><a href="#local-6989586621683014351"><span class="hs-identifier hs-var">u</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">TcRnIf TcGblEnv TcLclEnv Unique
forall gbl lcl. TcRnIf gbl lcl Unique
</span><a href="GHC.Tc.Utils.Monad.html#newUnique"><span class="hs-identifier hs-var">newUnique</span></a></span><span>
</span><span id="line-472"></span><span>       </span><span class="hs-special">;</span><span> </span><span id="local-6989586621683014352"><span class="annot"><a href="#local-6989586621683014352"><span class="hs-identifier hs-var">tclvl</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.Monad.html#getTcLevel"><span class="hs-identifier hs-type">getTcLevel</span></a></span><span>
</span><span id="line-473"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.Monad.html#traceTc"><span class="hs-identifier hs-type">traceTc</span></a></span><span> </span><span class="annot"><span class="hs-string">&quot;newInferExpType&quot;</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-type">ppr</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683014351"><span class="hs-identifier hs-type">u</span></a></span><span> </span><span class="annot"><a href="GHC.Utils.Outputable.html#%3C%2B%3E"><span class="hs-operator hs-type">&lt;+&gt;</span></a></span><span> </span><span class="annot"><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-type">ppr</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683014352"><span class="hs-identifier hs-type">tclvl</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-474"></span><span>       </span><span class="hs-special">;</span><span> </span><span id="local-6989586621683014354"><span class="annot"><a href="#local-6989586621683014354"><span class="hs-identifier hs-var">ref</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><a href="GHC.Data.IOEnv.html#newMutVar"><span class="hs-identifier hs-type">newMutVar</span></a></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Nothing</span></span><span>
</span><span id="line-475"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">return</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Tc.Utils.TcType.html#Infer"><span class="hs-identifier hs-type">Infer</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Tc.Utils.TcType.html#IR"><span class="hs-identifier hs-type">IR</span></a></span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.TcType.html#ir_uniq"><span class="hs-identifier hs-var">ir_uniq</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="#local-6989586621683014351"><span class="hs-identifier hs-type">u</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.TcType.html#ir_lvl"><span class="hs-identifier hs-var">ir_lvl</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="#local-6989586621683014352"><span class="hs-identifier hs-type">tclvl</span></a></span><span>
</span><span id="line-476"></span><span>                           </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.TcType.html#ir_ref"><span class="hs-identifier hs-var">ir_ref</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="#local-6989586621683014354"><span class="hs-identifier hs-type">ref</span></a></span><span>
</span><span id="line-477"></span><span>                           </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.TcType.html#ir_frr"><span class="hs-identifier hs-var">ir_frr</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="#local-6989586621683014350"><span class="hs-identifier hs-type">mb_frr_orig</span></a></span><span> </span><span class="hs-special">}</span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-478"></span><span>
</span><span id="line-479"></span><span class="hs-comment">-- | Extract a type out of an ExpType, if one exists. But one should always</span><span>
</span><span id="line-480"></span><span class="hs-comment">-- exist. Unless you're quite sure you know what you're doing.</span><span>
</span><span id="line-481"></span><span id="local-6989586621683013447"><span class="annot"><a href="GHC.Tc.Utils.TcMType.html#readExpType_maybe"><span class="hs-identifier hs-type">readExpType_maybe</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">MonadIO</span></span><span> </span><span class="annot"><a href="#local-6989586621683013447"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.TcType.html#ExpType"><span class="hs-identifier hs-type">ExpType</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621683013447"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Maybe</span></span><span> </span><span class="annot"><a href="GHC.Tc.Utils.TcType.html#TcType"><span class="hs-identifier hs-type">TcType</span></a></span><span class="hs-special">)</span></span><span>
</span><span id="line-482"></span><span id="readExpType_maybe"><span class="annot"><span class="annottext">readExpType_maybe :: forall (m :: * -&gt; *). MonadIO m =&gt; ExpType -&gt; m (Maybe TcType)
</span><a href="GHC.Tc.Utils.TcMType.html#readExpType_maybe"><span class="hs-identifier hs-var hs-var">readExpType_maybe</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Tc.Utils.TcType.html#Check"><span class="hs-identifier hs-type">Check</span></a></span><span> </span><span id="local-6989586621683014367"><span class="annot"><span class="annottext">TcType
</span><a href="#local-6989586621683014367"><span class="hs-identifier hs-var">ty</span></a></span></span><span class="hs-special">)</span><span>                   </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Maybe TcType -&gt; m (Maybe TcType)
forall a. a -&gt; m a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TcType -&gt; Maybe TcType
forall a. a -&gt; Maybe a
</span><span class="hs-identifier hs-var">Just</span></span><span> </span><span class="annot"><span class="annottext">TcType
</span><a href="#local-6989586621683014367"><span class="hs-identifier hs-var">ty</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-483"></span><span class="annot"><a href="GHC.Tc.Utils.TcMType.html#readExpType_maybe"><span class="hs-identifier hs-var">readExpType_maybe</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Tc.Utils.TcType.html#Infer"><span class="hs-identifier hs-type">Infer</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Tc.Utils.TcType.html#IR"><span class="hs-identifier hs-type">IR</span></a></span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">ir_ref :: InferResult -&gt; IORef (Maybe TcType)
</span><a href="GHC.Tc.Utils.TcType.html#ir_ref"><span class="hs-identifier hs-var">ir_ref</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="local-6989586621683014368"><span class="annot"><span class="annottext">IORef (Maybe TcType)
</span><a href="#local-6989586621683014368"><span class="hs-identifier hs-var">ref</span></a></span></span><span class="hs-special">}</span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">IO (Maybe TcType) -&gt; m (Maybe TcType)
forall a. IO a -&gt; m a
forall (m :: * -&gt; *) a. MonadIO m =&gt; IO a -&gt; m a
</span><span class="hs-identifier hs-var">liftIO</span></span><span> </span><span class="annot"><span class="annottext">(IO (Maybe TcType) -&gt; m (Maybe TcType))
-&gt; IO (Maybe TcType) -&gt; m (Maybe TcType)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">IORef (Maybe TcType) -&gt; IO (Maybe TcType)
forall a. IORef a -&gt; IO a
</span><span class="hs-identifier hs-var">readIORef</span></span><span> </span><span class="annot"><span class="annottext">IORef (Maybe TcType)
</span><a href="#local-6989586621683014368"><span class="hs-identifier hs-var">ref</span></a></span><span>
</span><span id="line-484"></span><span class="hs-pragma">{-# INLINEABLE</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.TcMType.html#readExpType_maybe"><span class="hs-pragma hs-type">readExpType_maybe</span></a></span><span> </span><span class="hs-pragma">#-}</span><span>
</span><span id="line-485"></span><span>
</span><span id="line-486"></span><span class="annot"><span class="hs-comment">-- | Same as readExpType, but for Scaled ExpTypes</span></span><span>
</span><span id="line-487"></span><span id="local-6989586621683013452"><span class="annot"><a href="GHC.Tc.Utils.TcMType.html#readScaledExpType"><span class="hs-identifier hs-type">readScaledExpType</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">MonadIO</span></span><span> </span><span class="annot"><a href="#local-6989586621683013452"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#Scaled"><span class="hs-identifier hs-type">Scaled</span></a></span><span> </span><span class="annot"><a href="GHC.Tc.Utils.TcType.html#ExpType"><span class="hs-identifier hs-type">ExpType</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621683013452"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#Scaled"><span class="hs-identifier hs-type">Scaled</span></a></span><span> </span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#Type"><span class="hs-identifier hs-type">Type</span></a></span><span class="hs-special">)</span></span><span>
</span><span id="line-488"></span><span id="readScaledExpType"><span class="annot"><span class="annottext">readScaledExpType :: forall (m :: * -&gt; *).
MonadIO m =&gt;
Scaled ExpType -&gt; m (Scaled TcType)
</span><a href="GHC.Tc.Utils.TcMType.html#readScaledExpType"><span class="hs-identifier hs-var hs-var">readScaledExpType</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#Scaled"><span class="hs-identifier hs-type">Scaled</span></a></span><span> </span><span id="local-6989586621683014377"><span class="annot"><span class="annottext">TcType
</span><a href="#local-6989586621683014377"><span class="hs-identifier hs-var">m</span></a></span></span><span> </span><span id="local-6989586621683014378"><span class="annot"><span class="annottext">ExpType
</span><a href="#local-6989586621683014378"><span class="hs-identifier hs-var">exp_ty</span></a></span></span><span class="hs-special">)</span><span>
</span><span id="line-489"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span id="local-6989586621683014379"><span class="annot"><a href="#local-6989586621683014379"><span class="hs-identifier hs-var">ty</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">ExpType -&gt; m TcType
forall (m :: * -&gt; *). MonadIO m =&gt; ExpType -&gt; m TcType
</span><a href="GHC.Tc.Utils.TcMType.html#readExpType"><span class="hs-identifier hs-var">readExpType</span></a></span><span> </span><span class="annot"><span class="annottext">ExpType
</span><a href="#local-6989586621683014378"><span class="hs-identifier hs-var">exp_ty</span></a></span><span>
</span><span id="line-490"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">return</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#Scaled"><span class="hs-identifier hs-type">Scaled</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683014377"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683014379"><span class="hs-identifier hs-type">ty</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-491"></span><span class="hs-pragma">{-# INLINEABLE</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.TcMType.html#readScaledExpType"><span class="hs-pragma hs-type">readScaledExpType</span></a></span><span>  </span><span class="hs-pragma">#-}</span><span>
</span><span id="line-492"></span><span>
</span><span id="line-493"></span><span class="annot"><span class="hs-comment">-- | Extract a type out of an ExpType. Otherwise, panics.</span></span><span>
</span><span id="line-494"></span><span id="local-6989586621683013455"><span class="annot"><a href="GHC.Tc.Utils.TcMType.html#readExpType"><span class="hs-identifier hs-type">readExpType</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">MonadIO</span></span><span> </span><span class="annot"><a href="#local-6989586621683013455"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.TcType.html#ExpType"><span class="hs-identifier hs-type">ExpType</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621683013455"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="annot"><a href="GHC.Tc.Utils.TcType.html#TcType"><span class="hs-identifier hs-type">TcType</span></a></span></span><span>
</span><span id="line-495"></span><span id="readExpType"><span class="annot"><span class="annottext">readExpType :: forall (m :: * -&gt; *). MonadIO m =&gt; ExpType -&gt; m TcType
</span><a href="GHC.Tc.Utils.TcMType.html#readExpType"><span class="hs-identifier hs-var hs-var">readExpType</span></a></span></span><span> </span><span id="local-6989586621683014389"><span class="annot"><span class="annottext">ExpType
</span><a href="#local-6989586621683014389"><span class="hs-identifier hs-var">exp_ty</span></a></span></span><span>
</span><span id="line-496"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span id="local-6989586621683014390"><span class="annot"><a href="#local-6989586621683014390"><span class="hs-identifier hs-var">mb_ty</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">ExpType -&gt; m (Maybe TcType)
forall (m :: * -&gt; *). MonadIO m =&gt; ExpType -&gt; m (Maybe TcType)
</span><a href="GHC.Tc.Utils.TcMType.html#readExpType_maybe"><span class="hs-identifier hs-var">readExpType_maybe</span></a></span><span> </span><span class="annot"><span class="annottext">ExpType
</span><a href="#local-6989586621683014389"><span class="hs-identifier hs-var">exp_ty</span></a></span><span>
</span><span id="line-497"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><a href="#local-6989586621683014390"><span class="hs-identifier hs-type">mb_ty</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-498"></span><span>           </span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span id="local-6989586621683014391"><span class="annot"><span class="annottext">TcType
</span><a href="#local-6989586621683014391"><span class="hs-identifier hs-var">ty</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">TcType -&gt; m TcType
forall a. a -&gt; m a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="annot"><span class="annottext">TcType
</span><a href="#local-6989586621683014391"><span class="hs-identifier hs-var">ty</span></a></span><span>
</span><span id="line-499"></span><span>           </span><span class="annot"><span class="annottext">Maybe TcType
</span><span class="hs-identifier hs-var">Nothing</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">String -&gt; SDoc -&gt; m TcType
forall a. HasCallStack =&gt; String -&gt; SDoc -&gt; a
</span><a href="GHC.Utils.Panic.html#pprPanic"><span class="hs-identifier hs-var">pprPanic</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;Unknown expected type&quot;</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ExpType -&gt; SDoc
forall a. Outputable a =&gt; a -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="annot"><span class="annottext">ExpType
</span><a href="#local-6989586621683014389"><span class="hs-identifier hs-var">exp_ty</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-500"></span><span class="hs-pragma">{-# INLINEABLE</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.TcMType.html#readExpType"><span class="hs-pragma hs-type">readExpType</span></a></span><span>  </span><span class="hs-pragma">#-}</span><span>
</span><span id="line-501"></span><span>
</span><span id="line-502"></span><span class="annot"><a href="GHC.Tc.Utils.TcMType.html#scaledExpTypeToType"><span class="hs-identifier hs-type">scaledExpTypeToType</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#Scaled"><span class="hs-identifier hs-type">Scaled</span></a></span><span> </span><span class="annot"><a href="GHC.Tc.Utils.TcType.html#ExpType"><span class="hs-identifier hs-type">ExpType</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#TcM"><span class="hs-identifier hs-type">TcM</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#Scaled"><span class="hs-identifier hs-type">Scaled</span></a></span><span> </span><span class="annot"><a href="GHC.Tc.Utils.TcType.html#TcType"><span class="hs-identifier hs-type">TcType</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-503"></span><span id="scaledExpTypeToType"><span class="annot"><span class="annottext">scaledExpTypeToType :: Scaled ExpType -&gt; TcM (Scaled TcType)
</span><a href="GHC.Tc.Utils.TcMType.html#scaledExpTypeToType"><span class="hs-identifier hs-var hs-var">scaledExpTypeToType</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#Scaled"><span class="hs-identifier hs-type">Scaled</span></a></span><span> </span><span id="local-6989586621683014392"><span class="annot"><span class="annottext">TcType
</span><a href="#local-6989586621683014392"><span class="hs-identifier hs-var">m</span></a></span></span><span> </span><span id="local-6989586621683014393"><span class="annot"><span class="annottext">ExpType
</span><a href="#local-6989586621683014393"><span class="hs-identifier hs-var">exp_ty</span></a></span></span><span class="hs-special">)</span><span>
</span><span id="line-504"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span id="local-6989586621683014394"><span class="annot"><a href="#local-6989586621683014394"><span class="hs-identifier hs-var">ty</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">ExpType -&gt; TcM TcType
</span><a href="GHC.Tc.Utils.TcMType.html#expTypeToType"><span class="hs-identifier hs-var">expTypeToType</span></a></span><span> </span><span class="annot"><span class="annottext">ExpType
</span><a href="#local-6989586621683014393"><span class="hs-identifier hs-var">exp_ty</span></a></span><span>
</span><span id="line-505"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">return</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#Scaled"><span class="hs-identifier hs-type">Scaled</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683014392"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683014394"><span class="hs-identifier hs-type">ty</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-506"></span><span>
</span><span id="line-507"></span><span class="hs-comment">-- | Extracts the expected type if there is one, or generates a new</span><span>
</span><span id="line-508"></span><span class="hs-comment">-- TauTv if there isn't.</span><span>
</span><span id="line-509"></span><span class="annot"><a href="GHC.Tc.Utils.TcMType.html#expTypeToType"><span class="hs-identifier hs-type">expTypeToType</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.TcType.html#ExpType"><span class="hs-identifier hs-type">ExpType</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#TcM"><span class="hs-identifier hs-type">TcM</span></a></span><span> </span><span class="annot"><a href="GHC.Tc.Utils.TcType.html#TcType"><span class="hs-identifier hs-type">TcType</span></a></span><span>
</span><span id="line-510"></span><span id="expTypeToType"><span class="annot"><span class="annottext">expTypeToType :: ExpType -&gt; TcM TcType
</span><a href="GHC.Tc.Utils.TcMType.html#expTypeToType"><span class="hs-identifier hs-var hs-var">expTypeToType</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Tc.Utils.TcType.html#Check"><span class="hs-identifier hs-type">Check</span></a></span><span> </span><span id="local-6989586621683014395"><span class="annot"><span class="annottext">TcType
</span><a href="#local-6989586621683014395"><span class="hs-identifier hs-var">ty</span></a></span></span><span class="hs-special">)</span><span>      </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">TcType -&gt; TcM TcType
forall a. a -&gt; IOEnv (Env TcGblEnv TcLclEnv) a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="annot"><span class="annottext">TcType
</span><a href="#local-6989586621683014395"><span class="hs-identifier hs-var">ty</span></a></span><span>
</span><span id="line-511"></span><span class="annot"><a href="GHC.Tc.Utils.TcMType.html#expTypeToType"><span class="hs-identifier hs-var">expTypeToType</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Tc.Utils.TcType.html#Infer"><span class="hs-identifier hs-type">Infer</span></a></span><span> </span><span id="local-6989586621683014396"><span class="annot"><span class="annottext">InferResult
</span><a href="#local-6989586621683014396"><span class="hs-identifier hs-var">inf_res</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">InferResult -&gt; TcM TcType
</span><a href="GHC.Tc.Utils.TcMType.html#inferResultToType"><span class="hs-identifier hs-var">inferResultToType</span></a></span><span> </span><span class="annot"><span class="annottext">InferResult
</span><a href="#local-6989586621683014396"><span class="hs-identifier hs-var">inf_res</span></a></span><span>
</span><span id="line-512"></span><span>
</span><span id="line-513"></span><span class="annot"><a href="GHC.Tc.Utils.TcMType.html#inferResultToType"><span class="hs-identifier hs-type">inferResultToType</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.TcType.html#InferResult"><span class="hs-identifier hs-type">InferResult</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#TcM"><span class="hs-identifier hs-type">TcM</span></a></span><span> </span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#Type"><span class="hs-identifier hs-type">Type</span></a></span><span>
</span><span id="line-514"></span><span id="inferResultToType"><span class="annot"><span class="annottext">inferResultToType :: InferResult -&gt; TcM TcType
</span><a href="GHC.Tc.Utils.TcMType.html#inferResultToType"><span class="hs-identifier hs-var hs-var">inferResultToType</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Tc.Utils.TcType.html#IR"><span class="hs-identifier hs-type">IR</span></a></span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">ir_uniq :: InferResult -&gt; Unique
</span><a href="GHC.Tc.Utils.TcType.html#ir_uniq"><span class="hs-identifier hs-var">ir_uniq</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="local-6989586621683014397"><span class="annot"><span class="annottext">Unique
</span><a href="#local-6989586621683014397"><span class="hs-identifier hs-var">u</span></a></span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">ir_lvl :: InferResult -&gt; TcLevel
</span><a href="GHC.Tc.Utils.TcType.html#ir_lvl"><span class="hs-identifier hs-var">ir_lvl</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="local-6989586621683014398"><span class="annot"><span class="annottext">TcLevel
</span><a href="#local-6989586621683014398"><span class="hs-identifier hs-var">tc_lvl</span></a></span></span><span>
</span><span id="line-515"></span><span>                      </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">ir_ref :: InferResult -&gt; IORef (Maybe TcType)
</span><a href="GHC.Tc.Utils.TcType.html#ir_ref"><span class="hs-identifier hs-var">ir_ref</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="local-6989586621683014399"><span class="annot"><span class="annottext">IORef (Maybe TcType)
</span><a href="#local-6989586621683014399"><span class="hs-identifier hs-var">ref</span></a></span></span><span>
</span><span id="line-516"></span><span>                      </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">ir_frr :: InferResult -&gt; Maybe FixedRuntimeRepContext
</span><a href="GHC.Tc.Utils.TcType.html#ir_frr"><span class="hs-identifier hs-var">ir_frr</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="local-6989586621683014400"><span class="annot"><span class="annottext">Maybe FixedRuntimeRepContext
</span><a href="#local-6989586621683014400"><span class="hs-identifier hs-var">mb_frr</span></a></span></span><span> </span><span class="hs-special">}</span><span class="hs-special">)</span><span>
</span><span id="line-517"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span id="local-6989586621683014401"><span class="annot"><a href="#local-6989586621683014401"><span class="hs-identifier hs-var">mb_inferred_ty</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">IORef (Maybe TcType)
-&gt; IOEnv (Env TcGblEnv TcLclEnv) (Maybe TcType)
forall (m :: * -&gt; *) a. MonadIO m =&gt; TcRef a -&gt; m a
</span><a href="GHC.Tc.Types.TcRef.html#readTcRef"><span class="hs-identifier hs-var">readTcRef</span></a></span><span> </span><span class="annot"><span class="annottext">IORef (Maybe TcType)
</span><a href="#local-6989586621683014399"><span class="hs-identifier hs-var">ref</span></a></span><span>
</span><span id="line-518"></span><span>       </span><span class="hs-special">;</span><span> </span><span id="local-6989586621683014402"><span class="annot"><a href="#local-6989586621683014402"><span class="hs-identifier hs-var">tau</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><a href="#local-6989586621683014401"><span class="hs-identifier hs-type">mb_inferred_ty</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-519"></span><span>            </span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span id="local-6989586621683014403"><span class="annot"><span class="annottext">TcType
</span><a href="#local-6989586621683014403"><span class="hs-identifier hs-var">ty</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">TcType -&gt; TcRn ()
</span><a href="GHC.Tc.Utils.TcMType.html#ensureMonoType"><span class="hs-identifier hs-var">ensureMonoType</span></a></span><span> </span><span class="annot"><span class="annottext">TcType
</span><a href="#local-6989586621683014403"><span class="hs-identifier hs-var">ty</span></a></span><span>
</span><span id="line-520"></span><span>                            </span><span class="hs-comment">-- See Note [inferResultToType]</span><span>
</span><span id="line-521"></span><span>                          </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="annottext">TcType -&gt; TcM TcType
forall a. a -&gt; IOEnv (Env TcGblEnv TcLclEnv) a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="annot"><span class="annottext">TcType
</span><a href="#local-6989586621683014403"><span class="hs-identifier hs-var">ty</span></a></span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-522"></span><span>            </span><span class="annot"><span class="annottext">Maybe TcType
</span><span class="hs-identifier hs-var">Nothing</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span id="local-6989586621683014404"><span class="annot"><a href="#local-6989586621683014404"><span class="hs-identifier hs-var">tau</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">TcM TcType
</span><a href="#local-6989586621683014405"><span class="hs-identifier hs-var">new_meta</span></a></span><span>
</span><span id="line-523"></span><span>                          </span><span class="hs-special">;</span><span> </span><span class="annot"><a href="GHC.Data.IOEnv.html#writeMutVar"><span class="hs-identifier hs-type">writeMutVar</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683014399"><span class="hs-identifier hs-type">ref</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span class="annot"><a href="#local-6989586621683014404"><span class="hs-identifier hs-type">tau</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-524"></span><span>                          </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">return</span></span><span> </span><span class="annot"><a href="#local-6989586621683014404"><span class="hs-identifier hs-type">tau</span></a></span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-525"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.Monad.html#traceTc"><span class="hs-identifier hs-type">traceTc</span></a></span><span> </span><span class="annot"><span class="hs-string">&quot;Forcing ExpType to be monomorphic:&quot;</span></span><span>
</span><span id="line-526"></span><span>                 </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-type">ppr</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683014397"><span class="hs-identifier hs-type">u</span></a></span><span> </span><span class="annot"><a href="GHC.Utils.Outputable.html#%3C%2B%3E"><span class="hs-operator hs-type">&lt;+&gt;</span></a></span><span> </span><span class="annot"><a href="GHC.Utils.Outputable.html#text"><span class="hs-identifier hs-type">text</span></a></span><span> </span><span class="annot"><span class="hs-string">&quot;:=&quot;</span></span><span> </span><span class="annot"><a href="GHC.Utils.Outputable.html#%3C%2B%3E"><span class="hs-operator hs-type">&lt;+&gt;</span></a></span><span> </span><span class="annot"><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-type">ppr</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683014402"><span class="hs-identifier hs-type">tau</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-527"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">return</span></span><span> </span><span class="annot"><a href="#local-6989586621683014402"><span class="hs-identifier hs-type">tau</span></a></span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-528"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-529"></span><span>    </span><span class="hs-comment">-- See Note [TcLevel of ExpType]</span><span>
</span><span id="line-530"></span><span>    </span><span id="local-6989586621683014405"><span class="annot"><span class="annottext">new_meta :: TcM TcType
</span><a href="#local-6989586621683014405"><span class="hs-identifier hs-var hs-var">new_meta</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">Maybe FixedRuntimeRepContext
</span><a href="#local-6989586621683014400"><span class="hs-identifier hs-var">mb_frr</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-531"></span><span>      </span><span class="annot"><span class="annottext">Maybe FixedRuntimeRepContext
</span><span class="hs-identifier hs-var">Nothing</span></span><span>  </span><span class="hs-glyph">-&gt;</span><span>  </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span id="local-6989586621683014407"><span class="annot"><a href="#local-6989586621683014407"><span class="hs-identifier hs-var">rr</span></a></span></span><span>  </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">TcLevel -&gt; TcType -&gt; TcM TcType
</span><a href="GHC.Tc.Utils.TcMType.html#newMetaTyVarTyAtLevel"><span class="hs-identifier hs-var">newMetaTyVarTyAtLevel</span></a></span><span> </span><span class="annot"><span class="annottext">TcLevel
</span><a href="#local-6989586621683014398"><span class="hs-identifier hs-var">tc_lvl</span></a></span><span> </span><span class="annot"><span class="annottext">TcType
</span><a href="GHC.Builtin.Types.html#runtimeRepTy"><span class="hs-identifier hs-var">runtimeRepTy</span></a></span><span>
</span><span id="line-532"></span><span>                      </span><span class="hs-special">;</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.TcMType.html#newMetaTyVarTyAtLevel"><span class="hs-identifier hs-type">newMetaTyVarTyAtLevel</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683014398"><span class="hs-identifier hs-type">tc_lvl</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Core.Type.html#mkTYPEapp"><span class="hs-identifier hs-type">mkTYPEapp</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683014407"><span class="hs-identifier hs-type">rr</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-533"></span><span>      </span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span id="local-6989586621683014410"><span class="annot"><span class="annottext">FixedRuntimeRepContext
</span><a href="#local-6989586621683014410"><span class="hs-identifier hs-var">frr</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">mdo</span><span> </span><span class="hs-special">{</span><span> </span><span id="local-6989586621683014411"><span class="annot"><a href="#local-6989586621683014411"><span class="hs-identifier hs-var">rr</span></a></span></span><span>  </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.TcMType.html#newConcreteTyVarTyAtLevel"><span class="hs-identifier hs-type">newConcreteTyVarTyAtLevel</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683014412"><span class="hs-identifier hs-type">conc_orig</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683014398"><span class="hs-identifier hs-type">tc_lvl</span></a></span><span> </span><span class="annot"><a href="GHC.Builtin.Types.html#runtimeRepTy"><span class="hs-identifier hs-type">runtimeRepTy</span></a></span><span>
</span><span id="line-534"></span><span>                      </span><span class="hs-special">;</span><span> </span><span id="local-6989586621683014413"><span class="annot"><a href="#local-6989586621683014413"><span class="hs-identifier hs-var">tau</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.TcMType.html#newMetaTyVarTyAtLevel"><span class="hs-identifier hs-type">newMetaTyVarTyAtLevel</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683014398"><span class="hs-identifier hs-type">tc_lvl</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Core.Type.html#mkTYPEapp"><span class="hs-identifier hs-type">mkTYPEapp</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683014411"><span class="hs-identifier hs-type">rr</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-535"></span><span>                      </span><span class="hs-special">;</span><span> </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621683014412"><span class="annot"><a href="#local-6989586621683014412"><span class="hs-identifier hs-var hs-var">conc_orig</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">FixedRuntimeRepOrigin -&gt; ConcreteTvOrigin
</span><a href="GHC.Tc.Utils.TcType.html#ConcreteFRR"><span class="hs-identifier hs-var">ConcreteFRR</span></a></span><span> </span><span class="annot"><span class="annottext">(FixedRuntimeRepOrigin -&gt; ConcreteTvOrigin)
-&gt; FixedRuntimeRepOrigin -&gt; ConcreteTvOrigin
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">TcType -&gt; FixedRuntimeRepContext -&gt; FixedRuntimeRepOrigin
</span><a href="GHC.Tc.Types.Origin.html#FixedRuntimeRepOrigin"><span class="hs-identifier hs-var">FixedRuntimeRepOrigin</span></a></span><span> </span><span class="annot"><span class="annottext">TcType
</span><a href="#local-6989586621683014413"><span class="hs-identifier hs-var">tau</span></a></span><span> </span><span class="annot"><span class="annottext">FixedRuntimeRepContext
</span><a href="#local-6989586621683014410"><span class="hs-identifier hs-var">frr</span></a></span><span>
</span><span id="line-536"></span><span>                      </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">return</span></span><span> </span><span class="annot"><a href="#local-6989586621683014413"><span class="hs-identifier hs-type">tau</span></a></span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-537"></span><span>
</span><span id="line-538"></span><span class="hs-comment">{- Note [inferResultToType]
~~~~~~~~~~~~~~~~~~~~~~~~~~~
expTypeToType and inferResultType convert an InferResult to a monotype.
It must be a monotype because if the InferResult isn't already filled in,
we fill it in with a unification variable (hence monotype).  So to preserve
order-independence we check for mono-type-ness even if it *is* filled in
already.

See also Note [TcLevel of ExpType] above, and
Note [fillInferResult] in GHC.Tc.Utils.Unify.
-}</span><span>
</span><span id="line-549"></span><span>
</span><span id="line-550"></span><span class="hs-comment">-- | Infer a type using a fresh ExpType</span><span>
</span><span id="line-551"></span><span class="hs-comment">-- See also Note [ExpType] in &quot;GHC.Tc.Utils.TcMType&quot;</span><span>
</span><span id="line-552"></span><span class="hs-comment">--</span><span>
</span><span id="line-553"></span><span class="hs-comment">-- Use 'tcInferFRR' if you require the type to have a fixed</span><span>
</span><span id="line-554"></span><span class="hs-comment">-- runtime representation.</span><span>
</span><span id="line-555"></span><span id="local-6989586621683013462"><span class="annot"><a href="GHC.Tc.Utils.TcMType.html#tcInfer"><span class="hs-identifier hs-type">tcInfer</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Tc.Utils.TcType.html#ExpSigmaType"><span class="hs-identifier hs-type">ExpSigmaType</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#TcM"><span class="hs-identifier hs-type">TcM</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683013462"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#TcM"><span class="hs-identifier hs-type">TcM</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621683013462"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.TcType.html#TcSigmaType"><span class="hs-identifier hs-type">TcSigmaType</span></a></span><span class="hs-special">)</span></span><span>
</span><span id="line-556"></span><span id="tcInfer"><span class="annot"><span class="annottext">tcInfer :: forall a. (ExpType -&gt; TcM a) -&gt; TcM (a, TcType)
</span><a href="GHC.Tc.Utils.TcMType.html#tcInfer"><span class="hs-identifier hs-var hs-var">tcInfer</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Maybe FixedRuntimeRepContext
-&gt; (ExpType -&gt; TcM a) -&gt; TcM (a, TcType)
forall a.
Maybe FixedRuntimeRepContext
-&gt; (ExpType -&gt; TcM a) -&gt; TcM (a, TcType)
</span><a href="GHC.Tc.Utils.TcMType.html#tc_infer"><span class="hs-identifier hs-var">tc_infer</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe FixedRuntimeRepContext
forall a. Maybe a
</span><span class="hs-identifier hs-var">Nothing</span></span><span>
</span><span id="line-557"></span><span>
</span><span id="line-558"></span><span class="hs-comment">-- | Like 'tcInfer', except it ensures that the resulting type</span><span>
</span><span id="line-559"></span><span class="hs-comment">-- has a syntactically fixed RuntimeRep as per Note [Fixed RuntimeRep] in</span><span>
</span><span id="line-560"></span><span class="hs-comment">-- GHC.Tc.Utils.Concrete.</span><span>
</span><span id="line-561"></span><span id="local-6989586621683013465"><span class="annot"><a href="GHC.Tc.Utils.TcMType.html#tcInferFRR"><span class="hs-identifier hs-type">tcInferFRR</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Tc.Types.Origin.html#FixedRuntimeRepContext"><span class="hs-identifier hs-type">FixedRuntimeRepContext</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Tc.Utils.TcType.html#ExpSigmaTypeFRR"><span class="hs-identifier hs-type">ExpSigmaTypeFRR</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#TcM"><span class="hs-identifier hs-type">TcM</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683013465"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#TcM"><span class="hs-identifier hs-type">TcM</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621683013465"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.TcType.html#TcSigmaTypeFRR"><span class="hs-identifier hs-type">TcSigmaTypeFRR</span></a></span><span class="hs-special">)</span></span><span>
</span><span id="line-562"></span><span id="tcInferFRR"><span class="annot"><span class="annottext">tcInferFRR :: forall a.
FixedRuntimeRepContext -&gt; (ExpType -&gt; TcM a) -&gt; TcM (a, TcType)
</span><a href="GHC.Tc.Utils.TcMType.html#tcInferFRR"><span class="hs-identifier hs-var hs-var">tcInferFRR</span></a></span></span><span> </span><span id="local-6989586621683014420"><span class="annot"><span class="annottext">FixedRuntimeRepContext
</span><a href="#local-6989586621683014420"><span class="hs-identifier hs-var">frr_orig</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Maybe FixedRuntimeRepContext
-&gt; (ExpType -&gt; TcM a) -&gt; TcM (a, TcType)
forall a.
Maybe FixedRuntimeRepContext
-&gt; (ExpType -&gt; TcM a) -&gt; TcM (a, TcType)
</span><a href="GHC.Tc.Utils.TcMType.html#tc_infer"><span class="hs-identifier hs-var">tc_infer</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">FixedRuntimeRepContext -&gt; Maybe FixedRuntimeRepContext
forall a. a -&gt; Maybe a
</span><span class="hs-identifier hs-var">Just</span></span><span> </span><span class="annot"><span class="annottext">FixedRuntimeRepContext
</span><a href="#local-6989586621683014420"><span class="hs-identifier hs-var">frr_orig</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-563"></span><span>
</span><span id="line-564"></span><span id="local-6989586621683013464"><span class="annot"><a href="GHC.Tc.Utils.TcMType.html#tc_infer"><span class="hs-identifier hs-type">tc_infer</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Maybe</span></span><span> </span><span class="annot"><a href="GHC.Tc.Types.Origin.html#FixedRuntimeRepContext"><span class="hs-identifier hs-type">FixedRuntimeRepContext</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Tc.Utils.TcType.html#ExpSigmaType"><span class="hs-identifier hs-type">ExpSigmaType</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#TcM"><span class="hs-identifier hs-type">TcM</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683013464"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#TcM"><span class="hs-identifier hs-type">TcM</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621683013464"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.TcType.html#TcSigmaType"><span class="hs-identifier hs-type">TcSigmaType</span></a></span><span class="hs-special">)</span></span><span>
</span><span id="line-565"></span><span id="tc_infer"><span class="annot"><span class="annottext">tc_infer :: forall a.
Maybe FixedRuntimeRepContext
-&gt; (ExpType -&gt; TcM a) -&gt; TcM (a, TcType)
</span><a href="GHC.Tc.Utils.TcMType.html#tc_infer"><span class="hs-identifier hs-var hs-var">tc_infer</span></a></span></span><span> </span><span id="local-6989586621683014426"><span class="annot"><span class="annottext">Maybe FixedRuntimeRepContext
</span><a href="#local-6989586621683014426"><span class="hs-identifier hs-var">mb_frr</span></a></span></span><span> </span><span id="local-6989586621683014427"><span class="annot"><span class="annottext">ExpType -&gt; TcM a
</span><a href="#local-6989586621683014427"><span class="hs-identifier hs-var">tc_check</span></a></span></span><span>
</span><span id="line-566"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span id="local-6989586621683014428"><span class="annot"><a href="#local-6989586621683014428"><span class="hs-identifier hs-var">res_ty</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Maybe FixedRuntimeRepContext -&gt; TcM ExpType
</span><a href="GHC.Tc.Utils.TcMType.html#new_inferExpType"><span class="hs-identifier hs-var">new_inferExpType</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe FixedRuntimeRepContext
</span><a href="#local-6989586621683014426"><span class="hs-identifier hs-var">mb_frr</span></a></span><span>
</span><span id="line-567"></span><span>       </span><span class="hs-special">;</span><span> </span><span id="local-6989586621683014429"><span class="annot"><a href="#local-6989586621683014429"><span class="hs-identifier hs-var">result</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><a href="#local-6989586621683014427"><span class="hs-identifier hs-type">tc_check</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683014428"><span class="hs-identifier hs-type">res_ty</span></a></span><span>
</span><span id="line-568"></span><span>       </span><span class="hs-special">;</span><span> </span><span id="local-6989586621683014430"><span class="annot"><a href="#local-6989586621683014430"><span class="hs-identifier hs-var">res_ty</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.TcMType.html#readExpType"><span class="hs-identifier hs-type">readExpType</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683014428"><span class="hs-identifier hs-type">res_ty</span></a></span><span>
</span><span id="line-569"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">return</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621683014429"><span class="hs-identifier hs-type">result</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="#local-6989586621683014430"><span class="hs-identifier hs-type">res_ty</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-570"></span><span>
</span><span id="line-571"></span><span class="annot"><span class="hs-comment">{- *********************************************************************
*                                                                      *
              Promoting types
*                                                                      *
********************************************************************* -}</span></span><span>
</span><span id="line-576"></span><span>
</span><span id="line-577"></span><span class="annot"><a href="GHC.Tc.Utils.TcMType.html#ensureMonoType"><span class="hs-identifier hs-type">ensureMonoType</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.TcType.html#TcType"><span class="hs-identifier hs-type">TcType</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#TcM"><span class="hs-identifier hs-type">TcM</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-578"></span><span class="hs-comment">-- Assuming that the argument type is of kind (TYPE r),</span><span>
</span><span id="line-579"></span><span class="hs-comment">-- ensure that it is a /monotype/</span><span>
</span><span id="line-580"></span><span class="hs-comment">-- If it is not a monotype we can see right away (since unification</span><span>
</span><span id="line-581"></span><span class="hs-comment">-- variables and type-function applications stand for monotypes), but</span><span>
</span><span id="line-582"></span><span class="hs-comment">-- we emit a Wanted equality just to delay the error message until later</span><span>
</span><span id="line-583"></span><span id="ensureMonoType"><span class="annot"><span class="annottext">ensureMonoType :: TcType -&gt; TcRn ()
</span><a href="GHC.Tc.Utils.TcMType.html#ensureMonoType"><span class="hs-identifier hs-var hs-var">ensureMonoType</span></a></span></span><span> </span><span id="local-6989586621683014431"><span class="annot"><span class="annottext">TcType
</span><a href="#local-6989586621683014431"><span class="hs-identifier hs-var">res_ty</span></a></span></span><span>
</span><span id="line-584"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">TcType -&gt; Bool
</span><a href="GHC.Core.Type.html#isTauTy"><span class="hs-identifier hs-var">isTauTy</span></a></span><span> </span><span class="annot"><span class="annottext">TcType
</span><a href="#local-6989586621683014431"><span class="hs-identifier hs-var">res_ty</span></a></span><span>   </span><span class="hs-comment">-- isTauTy doesn't need zonking or anything</span><span>
</span><span id="line-585"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">() -&gt; TcRn ()
forall a. a -&gt; IOEnv (Env TcGblEnv TcLclEnv) a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-586"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">otherwise</span></span><span>
</span><span id="line-587"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span id="local-6989586621683014433"><span class="annot"><a href="#local-6989586621683014433"><span class="hs-identifier hs-var">mono_ty</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">TcM TcType
</span><a href="GHC.Tc.Utils.TcMType.html#newOpenFlexiTyVarTy"><span class="hs-identifier hs-var">newOpenFlexiTyVarTy</span></a></span><span>
</span><span id="line-588"></span><span>       </span><span class="hs-special">;</span><span> </span><span id="local-6989586621683014434"><span class="annot"><a href="#local-6989586621683014434"><span class="hs-identifier hs-var">_co</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.Unify.html#unifyInvisibleType"><span class="hs-identifier hs-type">unifyInvisibleType</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683014431"><span class="hs-identifier hs-type">res_ty</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683014433"><span class="hs-identifier hs-type">mono_ty</span></a></span><span>
</span><span id="line-589"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">return</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-590"></span><span>
</span><span id="line-591"></span><span class="annot"><a href="GHC.Tc.Utils.TcMType.html#promoteTcType"><span class="hs-identifier hs-type">promoteTcType</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.TcType.html#TcLevel"><span class="hs-identifier hs-type">TcLevel</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.TcType.html#TcType"><span class="hs-identifier hs-type">TcType</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#TcM"><span class="hs-identifier hs-type">TcM</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Tc.Types.Evidence.html#TcCoercionN"><span class="hs-identifier hs-type">TcCoercionN</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.TcType.html#TcType"><span class="hs-identifier hs-type">TcType</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-592"></span><span class="hs-comment">-- See Note [Promoting a type]</span><span>
</span><span id="line-593"></span><span class="hs-comment">-- See also Note [fillInferResult]</span><span>
</span><span id="line-594"></span><span class="hs-comment">-- promoteTcType level ty = (co, ty')</span><span>
</span><span id="line-595"></span><span class="hs-comment">--   * Returns ty'  whose max level is just 'level'</span><span>
</span><span id="line-596"></span><span class="hs-comment">--             and  whose kind is ~# to the kind of 'ty'</span><span>
</span><span id="line-597"></span><span class="hs-comment">--             and  whose kind has form TYPE rr</span><span>
</span><span id="line-598"></span><span class="hs-comment">--   * and co :: ty ~ ty'</span><span>
</span><span id="line-599"></span><span class="hs-comment">--   * and emits constraints to justify the coercion</span><span>
</span><span id="line-600"></span><span class="hs-comment">--</span><span>
</span><span id="line-601"></span><span class="hs-comment">-- NB: we expect that 'ty' has already kind (TYPE rr) for</span><span>
</span><span id="line-602"></span><span class="hs-comment">--     some rr::RuntimeRep.  It is, after all, the type of a term.</span><span>
</span><span id="line-603"></span><span id="promoteTcType"><span class="annot"><span class="annottext">promoteTcType :: TcLevel -&gt; TcType -&gt; TcM (Coercion, TcType)
</span><a href="GHC.Tc.Utils.TcMType.html#promoteTcType"><span class="hs-identifier hs-var hs-var">promoteTcType</span></a></span></span><span> </span><span id="local-6989586621683014436"><span class="annot"><span class="annottext">TcLevel
</span><a href="#local-6989586621683014436"><span class="hs-identifier hs-var">dest_lvl</span></a></span></span><span> </span><span id="local-6989586621683014437"><span class="annot"><span class="annottext">TcType
</span><a href="#local-6989586621683014437"><span class="hs-identifier hs-var">ty</span></a></span></span><span>
</span><span id="line-604"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span id="local-6989586621683014438"><span class="annot"><a href="#local-6989586621683014438"><span class="hs-identifier hs-var">cur_lvl</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">TcM TcLevel
</span><a href="GHC.Tc.Utils.Monad.html#getTcLevel"><span class="hs-identifier hs-var">getTcLevel</span></a></span><span>
</span><span id="line-605"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="hs-keyword">if</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621683014438"><span class="hs-identifier hs-type">cur_lvl</span></a></span><span> </span><span class="annot"><a href="GHC.Tc.Utils.TcType.html#sameDepthAs"><span class="hs-operator hs-type">`sameDepthAs`</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683014436"><span class="hs-identifier hs-type">dest_lvl</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-606"></span><span>         </span><span class="hs-keyword">then</span><span> </span><span class="annot"><span class="hs-identifier hs-type">return</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Core.Coercion.html#mkNomReflCo"><span class="hs-identifier hs-type">mkNomReflCo</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683014437"><span class="hs-identifier hs-type">ty</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="#local-6989586621683014437"><span class="hs-identifier hs-type">ty</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-607"></span><span>         </span><span class="hs-keyword">else</span><span> </span><span class="annot"><a href="#local-6989586621683014441"><span class="hs-identifier hs-type">promote_it</span></a></span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-608"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-609"></span><span>    </span><span class="annot"><a href="#local-6989586621683014441"><span class="hs-identifier hs-type">promote_it</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#TcM"><span class="hs-identifier hs-type">TcM</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Tc.Types.Evidence.html#TcCoercion"><span class="hs-identifier hs-type">TcCoercion</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.TcType.html#TcType"><span class="hs-identifier hs-type">TcType</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-610"></span><span>    </span><span id="local-6989586621683014441"><span class="annot"><span class="annottext">promote_it :: TcM (Coercion, TcType)
</span><a href="#local-6989586621683014441"><span class="hs-identifier hs-var hs-var">promote_it</span></a></span></span><span>  </span><span class="hs-comment">-- Emit a constraint  (alpha :: TYPE rr) ~ ty</span><span>
</span><span id="line-611"></span><span>                </span><span class="hs-comment">-- where alpha and rr are fresh and from level dest_lvl</span><span>
</span><span id="line-612"></span><span>      </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span id="local-6989586621683014443"><span class="annot"><a href="#local-6989586621683014443"><span class="hs-identifier hs-var">rr</span></a></span></span><span>      </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">TcLevel -&gt; TcType -&gt; TcM TcType
</span><a href="GHC.Tc.Utils.TcMType.html#newMetaTyVarTyAtLevel"><span class="hs-identifier hs-var">newMetaTyVarTyAtLevel</span></a></span><span> </span><span class="annot"><span class="annottext">TcLevel
</span><a href="#local-6989586621683014436"><span class="hs-identifier hs-var">dest_lvl</span></a></span><span> </span><span class="annot"><span class="annottext">TcType
</span><a href="GHC.Builtin.Types.html#runtimeRepTy"><span class="hs-identifier hs-var">runtimeRepTy</span></a></span><span>
</span><span id="line-613"></span><span>           </span><span class="hs-special">;</span><span> </span><span id="local-6989586621683014444"><span class="annot"><a href="#local-6989586621683014444"><span class="hs-identifier hs-var">prom_ty</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.TcMType.html#newMetaTyVarTyAtLevel"><span class="hs-identifier hs-type">newMetaTyVarTyAtLevel</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683014436"><span class="hs-identifier hs-type">dest_lvl</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Core.Type.html#mkTYPEapp"><span class="hs-identifier hs-type">mkTYPEapp</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683014443"><span class="hs-identifier hs-type">rr</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-614"></span><span>           </span><span class="hs-special">;</span><span> </span><span id="local-6989586621683014445"><span class="annot"><a href="#local-6989586621683014445"><span class="hs-identifier hs-var">co</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.Unify.html#unifyInvisibleType"><span class="hs-identifier hs-type">unifyInvisibleType</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683014437"><span class="hs-identifier hs-type">ty</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683014444"><span class="hs-identifier hs-type">prom_ty</span></a></span><span>
</span><span id="line-615"></span><span>           </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">return</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621683014445"><span class="hs-identifier hs-type">co</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="#local-6989586621683014444"><span class="hs-identifier hs-type">prom_ty</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-616"></span><span>
</span><span id="line-617"></span><span class="hs-comment">{- Note [Promoting a type]
~~~~~~~~~~~~~~~~~~~~~~~~~~
Consider (#12427)

  data T where
    MkT :: (Int -&gt; Int) -&gt; a -&gt; T

  h y = case y of MkT v w -&gt; v

We'll infer the RHS type with an expected type ExpType of
  (IR { ir_lvl = l, ir_ref = ref, ... )
where 'l' is the TcLevel of the RHS of 'h'.  Then the MkT pattern
match will increase the level, so we'll end up in tcSubType, trying to
unify the type of v,
  v :: Int -&gt; Int
with the expected type.  But this attempt takes place at level (l+1),
rightly so, since v's type could have mentioned existential variables,
(like w's does) and we want to catch that.

So we
  - create a new meta-var alpha[l+1]
  - fill in the InferRes ref cell 'ref' with alpha
  - emit an equality constraint, thus
        [W] alpha[l+1] ~ (Int -&gt; Int)

That constraint will float outwards, as it should, unless v's
type mentions a skolem-captured variable.

This approach fails if v has a higher rank type; see
Note [Promotion and higher rank types]


Note [Promotion and higher rank types]
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
If v had a higher-rank type, say v :: (forall a. a-&gt;a) -&gt; Int,
then we'd emit an equality
        [W] alpha[l+1] ~ ((forall a. a-&gt;a) -&gt; Int)
which will sadly fail because we can't unify a unification variable
with a polytype.  But there is nothing really wrong with the program
here.

We could just about solve this by &quot;promote the type&quot; of v, to expose
its polymorphic &quot;shape&quot; while still leaving constraints that will
prevent existential escape.  But we must be careful!  Exposing
the &quot;shape&quot; of the type is precisely what we must NOT do under
a GADT pattern match!  So in this case we might promote the type
to
        (forall a. a-&gt;a) -&gt; alpha[l+1]
and emit the constraint
        [W] alpha[l+1] ~ Int
Now the promoted type can fill the ref cell, while the emitted
equality can float or not, according to the usual rules.

But that's not quite right!  We are exposing the arrow! We could
deal with that too:
        (forall a. mu[l+1] a a) -&gt; alpha[l+1]
with constraints
        [W] alpha[l+1] ~ Int
        [W] mu[l+1] ~ (-&gt;)
Here we abstract over the '-&gt;' inside the forall, in case that
is subject to an equality constraint from a GADT match.

Note that we kept the outer (-&gt;) because that's part of
the polymorphic &quot;shape&quot;.  And because of impredicativity,
GADT matches can't give equalities that affect polymorphic
shape.

This reasoning just seems too complicated, so I decided not
to do it.  These higher-rank notes are just here to record
the thinking.
-}</span><span>
</span><span id="line-688"></span><span>
</span><span id="line-689"></span><span>
</span><span id="line-690"></span><span class="annot"><span class="hs-comment">{- *********************************************************************
*                                                                      *
        MetaTvs (meta type variables; mutable)
*                                                                      *
********************************************************************* -}</span></span><span>
</span><span id="line-695"></span><span>
</span><span id="line-696"></span><span class="hs-comment">{- Note [TyVarTv]
~~~~~~~~~~~~~~~~~
A TyVarTv can unify with type *variables* only, including other TyVarTvs and
skolems.  They are used in two places:

1. In kind signatures, see GHC.Tc.TyCl
      Note [Inferring kinds for type declarations]
   and Note [Using TyVarTvs for kind-checking GADTs]

2. In partial type signatures.  See GHC.Tc.Types
   Note [Quantified variables in partial type signatures]

Sometimes, they can unify with type variables that the user would
rather keep distinct; see #11203 for an example.  So, any client of
this function needs to either allow the TyVarTvs to unify with each
other or check that they don't. In the case of (1) the check is done
in GHC.Tc.TyCl.swizzleTcTyConBndrs.  In case of (2) it's done by
findDupTyVarTvs in GHC.Tc.Gen.Bind.chooseInferredQuantifiers.

Historical note: Before #15050 this (under the name SigTv) was also
used for ScopedTypeVariables in patterns, to make sure these type
variables only refer to other type variables, but this restriction was
dropped, and ScopedTypeVariables can now refer to full types (GHC
Proposal 29).
-}</span><span>
</span><span id="line-721"></span><span>
</span><span id="line-722"></span><span class="annot"><a href="GHC.Tc.Utils.TcMType.html#newMetaTyVarName"><span class="hs-identifier hs-type">newMetaTyVarName</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Data.FastString.html#FastString"><span class="hs-identifier hs-type">FastString</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#TcM"><span class="hs-identifier hs-type">TcM</span></a></span><span> </span><span class="annot"><a href="GHC.Types.Name.html#Name"><span class="hs-identifier hs-type">Name</span></a></span><span>
</span><span id="line-723"></span><span class="hs-comment">-- Makes a /System/ Name, which is eagerly eliminated by</span><span>
</span><span id="line-724"></span><span class="hs-comment">-- the unifier; see GHC.Tc.Utils.Unify.nicer_to_update_tv1, and</span><span>
</span><span id="line-725"></span><span class="hs-comment">-- GHC.Tc.Solver.Equality.canEqTyVarTyVar (nicer_to_update_tv2)</span><span>
</span><span id="line-726"></span><span id="newMetaTyVarName"><span class="annot"><span class="annottext">newMetaTyVarName :: FastString -&gt; TcM Name
</span><a href="GHC.Tc.Utils.TcMType.html#newMetaTyVarName"><span class="hs-identifier hs-var hs-var">newMetaTyVarName</span></a></span></span><span> </span><span id="local-6989586621683014446"><span class="annot"><span class="annottext">FastString
</span><a href="#local-6989586621683014446"><span class="hs-identifier hs-var">str</span></a></span></span><span>
</span><span id="line-727"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">OccName -&gt; TcM Name
forall gbl lcl. OccName -&gt; TcRnIf gbl lcl Name
</span><a href="GHC.Tc.Utils.Monad.html#newSysName"><span class="hs-identifier hs-var">newSysName</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">FastString -&gt; OccName
</span><a href="GHC.Types.Name.Occurrence.html#mkTyVarOccFS"><span class="hs-identifier hs-var">mkTyVarOccFS</span></a></span><span> </span><span class="annot"><span class="annottext">FastString
</span><a href="#local-6989586621683014446"><span class="hs-identifier hs-var">str</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-728"></span><span>
</span><span id="line-729"></span><span class="annot"><a href="GHC.Tc.Utils.TcMType.html#cloneMetaTyVarName"><span class="hs-identifier hs-type">cloneMetaTyVarName</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Types.Name.html#Name"><span class="hs-identifier hs-type">Name</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#TcM"><span class="hs-identifier hs-type">TcM</span></a></span><span> </span><span class="annot"><a href="GHC.Types.Name.html#Name"><span class="hs-identifier hs-type">Name</span></a></span><span>
</span><span id="line-730"></span><span id="cloneMetaTyVarName"><span class="annot"><span class="annottext">cloneMetaTyVarName :: Name -&gt; TcM Name
</span><a href="GHC.Tc.Utils.TcMType.html#cloneMetaTyVarName"><span class="hs-identifier hs-var hs-var">cloneMetaTyVarName</span></a></span></span><span> </span><span id="local-6989586621683014449"><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621683014449"><span class="hs-identifier hs-var">name</span></a></span></span><span>
</span><span id="line-731"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">OccName -&gt; TcM Name
forall gbl lcl. OccName -&gt; TcRnIf gbl lcl Name
</span><a href="GHC.Tc.Utils.Monad.html#newSysName"><span class="hs-identifier hs-var">newSysName</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Name -&gt; OccName
</span><a href="GHC.Types.Name.html#nameOccName"><span class="hs-identifier hs-var">nameOccName</span></a></span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621683014449"><span class="hs-identifier hs-var">name</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-732"></span><span>         </span><span class="hs-comment">-- See Note [Name of an instantiated type variable]</span><span>
</span><span id="line-733"></span><span>
</span><span id="line-734"></span><span class="hs-comment">{- Note [Name of an instantiated type variable]
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
At the moment we give a unification variable a System Name, which
influences the way it is tidied; see TypeRep.tidyTyVarBndr.
-}</span><span>
</span><span id="line-739"></span><span>
</span><span id="line-740"></span><span class="annot"><a href="GHC.Tc.Utils.TcMType.html#metaInfoToTyVarName"><span class="hs-identifier hs-type">metaInfoToTyVarName</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.TcType.html#MetaInfo"><span class="hs-identifier hs-type">MetaInfo</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Data.FastString.html#FastString"><span class="hs-identifier hs-type">FastString</span></a></span><span>
</span><span id="line-741"></span><span id="metaInfoToTyVarName"><span class="annot"><span class="annottext">metaInfoToTyVarName :: MetaInfo -&gt; FastString
</span><a href="GHC.Tc.Utils.TcMType.html#metaInfoToTyVarName"><span class="hs-identifier hs-var hs-var">metaInfoToTyVarName</span></a></span></span><span>  </span><span id="local-6989586621683014452"><span class="annot"><span class="annottext">MetaInfo
</span><a href="#local-6989586621683014452"><span class="hs-identifier hs-var">meta_info</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-742"></span><span>  </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">MetaInfo
</span><a href="#local-6989586621683014452"><span class="hs-identifier hs-var">meta_info</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-743"></span><span>       </span><span class="annot"><span class="annottext">MetaInfo
</span><a href="GHC.Tc.Utils.TcType.html#TauTv"><span class="hs-identifier hs-var">TauTv</span></a></span><span>          </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">String -&gt; FastString
</span><a href="GHC.Data.FastString.html#fsLit"><span class="hs-identifier hs-var">fsLit</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;t&quot;</span></span><span>
</span><span id="line-744"></span><span>       </span><span class="annot"><span class="annottext">MetaInfo
</span><a href="GHC.Tc.Utils.TcType.html#TyVarTv"><span class="hs-identifier hs-var">TyVarTv</span></a></span><span>        </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">String -&gt; FastString
</span><a href="GHC.Data.FastString.html#fsLit"><span class="hs-identifier hs-var">fsLit</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;a&quot;</span></span><span>
</span><span id="line-745"></span><span>       </span><span class="annot"><span class="annottext">MetaInfo
</span><a href="GHC.Tc.Utils.TcType.html#RuntimeUnkTv"><span class="hs-identifier hs-var">RuntimeUnkTv</span></a></span><span>   </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">String -&gt; FastString
</span><a href="GHC.Data.FastString.html#fsLit"><span class="hs-identifier hs-var">fsLit</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;r&quot;</span></span><span>
</span><span id="line-746"></span><span>       </span><span class="annot"><span class="annottext">MetaInfo
</span><a href="GHC.Tc.Utils.TcType.html#CycleBreakerTv"><span class="hs-identifier hs-var">CycleBreakerTv</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">String -&gt; FastString
</span><a href="GHC.Data.FastString.html#fsLit"><span class="hs-identifier hs-var">fsLit</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;b&quot;</span></span><span>
</span><span id="line-747"></span><span>       </span><span class="annot"><a href="GHC.Tc.Utils.TcType.html#ConcreteTv"><span class="hs-identifier hs-type">ConcreteTv</span></a></span><span> </span><span class="hs-special">{</span><span class="hs-special">}</span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">String -&gt; FastString
</span><a href="GHC.Data.FastString.html#fsLit"><span class="hs-identifier hs-var">fsLit</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;c&quot;</span></span><span>
</span><span id="line-748"></span><span>
</span><span id="line-749"></span><span class="annot"><a href="GHC.Tc.Utils.TcMType.html#newAnonMetaTyVar"><span class="hs-identifier hs-type">newAnonMetaTyVar</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.TcType.html#MetaInfo"><span class="hs-identifier hs-type">MetaInfo</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#Kind"><span class="hs-identifier hs-type">Kind</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#TcM"><span class="hs-identifier hs-type">TcM</span></a></span><span> </span><span class="annot"><a href="GHC.Types.Var.html#TcTyVar"><span class="hs-identifier hs-type">TcTyVar</span></a></span><span>
</span><span id="line-750"></span><span id="newAnonMetaTyVar"><span class="annot"><span class="annottext">newAnonMetaTyVar :: MetaInfo -&gt; TcType -&gt; IOEnv (Env TcGblEnv TcLclEnv) TcTyVar
</span><a href="GHC.Tc.Utils.TcMType.html#newAnonMetaTyVar"><span class="hs-identifier hs-var hs-var">newAnonMetaTyVar</span></a></span></span><span> </span><span id="local-6989586621683014458"><span class="annot"><span class="annottext">MetaInfo
</span><a href="#local-6989586621683014458"><span class="hs-identifier hs-var">mi</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">FastString
-&gt; MetaInfo -&gt; TcType -&gt; IOEnv (Env TcGblEnv TcLclEnv) TcTyVar
</span><a href="GHC.Tc.Utils.TcMType.html#newNamedAnonMetaTyVar"><span class="hs-identifier hs-var">newNamedAnonMetaTyVar</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">MetaInfo -&gt; FastString
</span><a href="GHC.Tc.Utils.TcMType.html#metaInfoToTyVarName"><span class="hs-identifier hs-var">metaInfoToTyVarName</span></a></span><span> </span><span class="annot"><span class="annottext">MetaInfo
</span><a href="#local-6989586621683014458"><span class="hs-identifier hs-var">mi</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">MetaInfo
</span><a href="#local-6989586621683014458"><span class="hs-identifier hs-var">mi</span></a></span><span>
</span><span id="line-751"></span><span>
</span><span id="line-752"></span><span class="annot"><a href="GHC.Tc.Utils.TcMType.html#newNamedAnonMetaTyVar"><span class="hs-identifier hs-type">newNamedAnonMetaTyVar</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Data.FastString.html#FastString"><span class="hs-identifier hs-type">FastString</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.TcType.html#MetaInfo"><span class="hs-identifier hs-type">MetaInfo</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#Kind"><span class="hs-identifier hs-type">Kind</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#TcM"><span class="hs-identifier hs-type">TcM</span></a></span><span> </span><span class="annot"><a href="GHC.Types.Var.html#TcTyVar"><span class="hs-identifier hs-type">TcTyVar</span></a></span><span>
</span><span id="line-753"></span><span class="hs-comment">-- Make a new meta tyvar out of thin air</span><span>
</span><span id="line-754"></span><span id="newNamedAnonMetaTyVar"><span class="annot"><span class="annottext">newNamedAnonMetaTyVar :: FastString
-&gt; MetaInfo -&gt; TcType -&gt; IOEnv (Env TcGblEnv TcLclEnv) TcTyVar
</span><a href="GHC.Tc.Utils.TcMType.html#newNamedAnonMetaTyVar"><span class="hs-identifier hs-var hs-var">newNamedAnonMetaTyVar</span></a></span></span><span> </span><span id="local-6989586621683014460"><span class="annot"><span class="annottext">FastString
</span><a href="#local-6989586621683014460"><span class="hs-identifier hs-var">tyvar_name</span></a></span></span><span> </span><span id="local-6989586621683014461"><span class="annot"><span class="annottext">MetaInfo
</span><a href="#local-6989586621683014461"><span class="hs-identifier hs-var">meta_info</span></a></span></span><span> </span><span id="local-6989586621683014462"><span class="annot"><span class="annottext">TcType
</span><a href="#local-6989586621683014462"><span class="hs-identifier hs-var">kind</span></a></span></span><span>
</span><span id="line-755"></span><span>
</span><span id="line-756"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>  </span><span class="hs-special">{</span><span> </span><span id="local-6989586621683014463"><span class="annot"><a href="#local-6989586621683014463"><span class="hs-identifier hs-var">name</span></a></span></span><span>    </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">FastString -&gt; TcM Name
</span><a href="GHC.Tc.Utils.TcMType.html#newMetaTyVarName"><span class="hs-identifier hs-var">newMetaTyVarName</span></a></span><span> </span><span class="annot"><span class="annottext">FastString
</span><a href="#local-6989586621683014460"><span class="hs-identifier hs-var">tyvar_name</span></a></span><span>
</span><span id="line-757"></span><span>        </span><span class="hs-special">;</span><span> </span><span id="local-6989586621683014464"><span class="annot"><a href="#local-6989586621683014464"><span class="hs-identifier hs-var">details</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.TcMType.html#newMetaDetails"><span class="hs-identifier hs-type">newMetaDetails</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683014461"><span class="hs-identifier hs-type">meta_info</span></a></span><span>
</span><span id="line-758"></span><span>        </span><span class="hs-special">;</span><span> </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621683014465"><span class="annot"><a href="#local-6989586621683014465"><span class="hs-identifier hs-var hs-var">tyvar</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Name -&gt; TcType -&gt; TcTyVarDetails -&gt; TcTyVar
</span><a href="GHC.Types.Var.html#mkTcTyVar"><span class="hs-identifier hs-var">mkTcTyVar</span></a></span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621683014463"><span class="hs-identifier hs-var">name</span></a></span><span> </span><span class="annot"><span class="annottext">TcType
</span><a href="#local-6989586621683014462"><span class="hs-identifier hs-var">kind</span></a></span><span> </span><span class="annot"><span class="annottext">TcTyVarDetails
</span><a href="#local-6989586621683014464"><span class="hs-identifier hs-var">details</span></a></span><span>
</span><span id="line-759"></span><span>        </span><span class="hs-special">;</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.Monad.html#traceTc"><span class="hs-identifier hs-type">traceTc</span></a></span><span> </span><span class="annot"><span class="hs-string">&quot;newAnonMetaTyVar&quot;</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-type">ppr</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683014465"><span class="hs-identifier hs-type">tyvar</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-760"></span><span>        </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">return</span></span><span> </span><span class="annot"><a href="#local-6989586621683014465"><span class="hs-identifier hs-type">tyvar</span></a></span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-761"></span><span>
</span><span id="line-762"></span><span class="hs-comment">-- makes a new skolem tv</span><span>
</span><span id="line-763"></span><span class="annot"><a href="GHC.Tc.Utils.TcMType.html#newSkolemTyVar"><span class="hs-identifier hs-type">newSkolemTyVar</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Tc.Types.Origin.html#SkolemInfo"><span class="hs-identifier hs-type">SkolemInfo</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Types.Name.html#Name"><span class="hs-identifier hs-type">Name</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#Kind"><span class="hs-identifier hs-type">Kind</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#TcM"><span class="hs-identifier hs-type">TcM</span></a></span><span> </span><span class="annot"><a href="GHC.Types.Var.html#TcTyVar"><span class="hs-identifier hs-type">TcTyVar</span></a></span><span>
</span><span id="line-764"></span><span id="newSkolemTyVar"><span class="annot"><span class="annottext">newSkolemTyVar :: SkolemInfo
-&gt; Name -&gt; TcType -&gt; IOEnv (Env TcGblEnv TcLclEnv) TcTyVar
</span><a href="GHC.Tc.Utils.TcMType.html#newSkolemTyVar"><span class="hs-identifier hs-var hs-var">newSkolemTyVar</span></a></span></span><span> </span><span id="local-6989586621683014466"><span class="annot"><span class="annottext">SkolemInfo
</span><a href="#local-6989586621683014466"><span class="hs-identifier hs-var">skol_info</span></a></span></span><span> </span><span id="local-6989586621683014467"><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621683014467"><span class="hs-identifier hs-var">name</span></a></span></span><span> </span><span id="local-6989586621683014468"><span class="annot"><span class="annottext">TcType
</span><a href="#local-6989586621683014468"><span class="hs-identifier hs-var">kind</span></a></span></span><span>
</span><span id="line-765"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span id="local-6989586621683014469"><span class="annot"><a href="#local-6989586621683014469"><span class="hs-identifier hs-var">lvl</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">TcM TcLevel
</span><a href="GHC.Tc.Utils.Monad.html#getTcLevel"><span class="hs-identifier hs-var">getTcLevel</span></a></span><span>
</span><span id="line-766"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">return</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Types.Var.html#mkTcTyVar"><span class="hs-identifier hs-type">mkTcTyVar</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683014467"><span class="hs-identifier hs-type">name</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683014468"><span class="hs-identifier hs-type">kind</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Tc.Utils.TcType.html#SkolemTv"><span class="hs-identifier hs-type">SkolemTv</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683014466"><span class="hs-identifier hs-type">skol_info</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683014469"><span class="hs-identifier hs-type">lvl</span></a></span><span> </span><span class="annot"><span class="hs-identifier hs-type">False</span></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-767"></span><span>
</span><span id="line-768"></span><span class="annot"><a href="GHC.Tc.Utils.TcMType.html#newTyVarTyVar"><span class="hs-identifier hs-type">newTyVarTyVar</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Types.Name.html#Name"><span class="hs-identifier hs-type">Name</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#Kind"><span class="hs-identifier hs-type">Kind</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#TcM"><span class="hs-identifier hs-type">TcM</span></a></span><span> </span><span class="annot"><a href="GHC.Types.Var.html#TcTyVar"><span class="hs-identifier hs-type">TcTyVar</span></a></span><span>
</span><span id="line-769"></span><span class="hs-comment">-- See Note [TyVarTv]</span><span>
</span><span id="line-770"></span><span class="hs-comment">-- Does not clone a fresh unique</span><span>
</span><span id="line-771"></span><span id="newTyVarTyVar"><span class="annot"><span class="annottext">newTyVarTyVar :: Name -&gt; TcType -&gt; IOEnv (Env TcGblEnv TcLclEnv) TcTyVar
</span><a href="GHC.Tc.Utils.TcMType.html#newTyVarTyVar"><span class="hs-identifier hs-var hs-var">newTyVarTyVar</span></a></span></span><span> </span><span id="local-6989586621683014471"><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621683014471"><span class="hs-identifier hs-var">name</span></a></span></span><span> </span><span id="local-6989586621683014472"><span class="annot"><span class="annottext">TcType
</span><a href="#local-6989586621683014472"><span class="hs-identifier hs-var">kind</span></a></span></span><span>
</span><span id="line-772"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span id="local-6989586621683014473"><span class="annot"><a href="#local-6989586621683014473"><span class="hs-identifier hs-var">details</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">MetaInfo -&gt; TcM TcTyVarDetails
</span><a href="GHC.Tc.Utils.TcMType.html#newMetaDetails"><span class="hs-identifier hs-var">newMetaDetails</span></a></span><span> </span><span class="annot"><span class="annottext">MetaInfo
</span><a href="GHC.Tc.Utils.TcType.html#TyVarTv"><span class="hs-identifier hs-var">TyVarTv</span></a></span><span>
</span><span id="line-773"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621683014474"><span class="annot"><a href="#local-6989586621683014474"><span class="hs-identifier hs-var hs-var">tyvar</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Name -&gt; TcType -&gt; TcTyVarDetails -&gt; TcTyVar
</span><a href="GHC.Types.Var.html#mkTcTyVar"><span class="hs-identifier hs-var">mkTcTyVar</span></a></span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621683014471"><span class="hs-identifier hs-var">name</span></a></span><span> </span><span class="annot"><span class="annottext">TcType
</span><a href="#local-6989586621683014472"><span class="hs-identifier hs-var">kind</span></a></span><span> </span><span class="annot"><span class="annottext">TcTyVarDetails
</span><a href="#local-6989586621683014473"><span class="hs-identifier hs-var">details</span></a></span><span>
</span><span id="line-774"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.Monad.html#traceTc"><span class="hs-identifier hs-type">traceTc</span></a></span><span> </span><span class="annot"><span class="hs-string">&quot;newTyVarTyVar&quot;</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-type">ppr</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683014474"><span class="hs-identifier hs-type">tyvar</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-775"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">return</span></span><span> </span><span class="annot"><a href="#local-6989586621683014474"><span class="hs-identifier hs-type">tyvar</span></a></span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-776"></span><span>
</span><span id="line-777"></span><span class="annot"><a href="GHC.Tc.Utils.TcMType.html#cloneTyVarTyVar"><span class="hs-identifier hs-type">cloneTyVarTyVar</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Types.Name.html#Name"><span class="hs-identifier hs-type">Name</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#Kind"><span class="hs-identifier hs-type">Kind</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#TcM"><span class="hs-identifier hs-type">TcM</span></a></span><span> </span><span class="annot"><a href="GHC.Types.Var.html#TcTyVar"><span class="hs-identifier hs-type">TcTyVar</span></a></span><span>
</span><span id="line-778"></span><span class="hs-comment">-- See Note [TyVarTv]</span><span>
</span><span id="line-779"></span><span class="hs-comment">-- Clones a fresh unique</span><span>
</span><span id="line-780"></span><span id="cloneTyVarTyVar"><span class="annot"><span class="annottext">cloneTyVarTyVar :: Name -&gt; TcType -&gt; IOEnv (Env TcGblEnv TcLclEnv) TcTyVar
</span><a href="GHC.Tc.Utils.TcMType.html#cloneTyVarTyVar"><span class="hs-identifier hs-var hs-var">cloneTyVarTyVar</span></a></span></span><span> </span><span id="local-6989586621683014475"><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621683014475"><span class="hs-identifier hs-var">name</span></a></span></span><span> </span><span id="local-6989586621683014476"><span class="annot"><span class="annottext">TcType
</span><a href="#local-6989586621683014476"><span class="hs-identifier hs-var">kind</span></a></span></span><span>
</span><span id="line-781"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span id="local-6989586621683014477"><span class="annot"><a href="#local-6989586621683014477"><span class="hs-identifier hs-var">details</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">MetaInfo -&gt; TcM TcTyVarDetails
</span><a href="GHC.Tc.Utils.TcMType.html#newMetaDetails"><span class="hs-identifier hs-var">newMetaDetails</span></a></span><span> </span><span class="annot"><span class="annottext">MetaInfo
</span><a href="GHC.Tc.Utils.TcType.html#TyVarTv"><span class="hs-identifier hs-var">TyVarTv</span></a></span><span>
</span><span id="line-782"></span><span>       </span><span class="hs-special">;</span><span> </span><span id="local-6989586621683014478"><span class="annot"><a href="#local-6989586621683014478"><span class="hs-identifier hs-var">uniq</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.Monad.html#newUnique"><span class="hs-identifier hs-type">newUnique</span></a></span><span>
</span><span id="line-783"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621683014479"><span class="annot"><a href="#local-6989586621683014479"><span class="hs-identifier hs-var hs-var">name'</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621683014475"><span class="hs-identifier hs-var">name</span></a></span><span> </span><span class="annot"><span class="annottext">Name -&gt; Unique -&gt; Name
</span><a href="GHC.Types.Name.html#setNameUnique"><span class="hs-operator hs-var">`setNameUnique`</span></a></span><span> </span><span class="annot"><span class="annottext">Unique
</span><a href="#local-6989586621683014478"><span class="hs-identifier hs-var">uniq</span></a></span><span>
</span><span id="line-784"></span><span>             </span><span id="local-6989586621683014481"><span class="annot"><a href="#local-6989586621683014481"><span class="hs-identifier hs-var hs-var">tyvar</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Name -&gt; TcType -&gt; TcTyVarDetails -&gt; TcTyVar
</span><a href="GHC.Types.Var.html#mkTcTyVar"><span class="hs-identifier hs-var">mkTcTyVar</span></a></span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621683014479"><span class="hs-identifier hs-var">name'</span></a></span><span> </span><span class="annot"><span class="annottext">TcType
</span><a href="#local-6989586621683014476"><span class="hs-identifier hs-var">kind</span></a></span><span> </span><span class="annot"><span class="annottext">TcTyVarDetails
</span><a href="#local-6989586621683014477"><span class="hs-identifier hs-var">details</span></a></span><span>
</span><span id="line-785"></span><span>         </span><span class="hs-comment">-- Don't use cloneMetaTyVar, which makes a SystemName</span><span>
</span><span id="line-786"></span><span>         </span><span class="hs-comment">-- We want to keep the original more user-friendly Name</span><span>
</span><span id="line-787"></span><span>         </span><span class="hs-comment">-- In practical terms that means that in error messages,</span><span>
</span><span id="line-788"></span><span>         </span><span class="hs-comment">-- when the Name is tidied we get 'a' rather than 'a0'</span><span>
</span><span id="line-789"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.Monad.html#traceTc"><span class="hs-identifier hs-type">traceTc</span></a></span><span> </span><span class="annot"><span class="hs-string">&quot;cloneTyVarTyVar&quot;</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-type">ppr</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683014481"><span class="hs-identifier hs-type">tyvar</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-790"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">return</span></span><span> </span><span class="annot"><a href="#local-6989586621683014481"><span class="hs-identifier hs-type">tyvar</span></a></span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-791"></span><span>
</span><span id="line-792"></span><span class="hs-comment">-- | Create a new metavariable, of the given kind, which can only be unified</span><span>
</span><span id="line-793"></span><span class="hs-comment">-- with a concrete type.</span><span>
</span><span id="line-794"></span><span class="hs-comment">--</span><span>
</span><span id="line-795"></span><span class="hs-comment">-- Invariant: the kind must be concrete, as per Note [ConcreteTv].</span><span>
</span><span id="line-796"></span><span class="hs-comment">-- This is checked with an assertion.</span><span>
</span><span id="line-797"></span><span class="annot"><a href="GHC.Tc.Utils.TcMType.html#newConcreteTyVar"><span class="hs-identifier hs-type">newConcreteTyVar</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Utils.Misc.html#HasDebugCallStack"><span class="hs-identifier hs-type">HasDebugCallStack</span></a></span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.TcType.html#ConcreteTvOrigin"><span class="hs-identifier hs-type">ConcreteTvOrigin</span></a></span><span>
</span><span id="line-798"></span><span>                 </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Data.FastString.html#FastString"><span class="hs-identifier hs-type">FastString</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.TcType.html#TcKind"><span class="hs-identifier hs-type">TcKind</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#TcM"><span class="hs-identifier hs-type">TcM</span></a></span><span> </span><span class="annot"><a href="GHC.Types.Var.html#TcTyVar"><span class="hs-identifier hs-type">TcTyVar</span></a></span><span>
</span><span id="line-799"></span><span id="newConcreteTyVar"><span class="annot"><span class="annottext">newConcreteTyVar :: HasDebugCallStack =&gt;
ConcreteTvOrigin
-&gt; FastString -&gt; TcType -&gt; IOEnv (Env TcGblEnv TcLclEnv) TcTyVar
</span><a href="GHC.Tc.Utils.TcMType.html#newConcreteTyVar"><span class="hs-identifier hs-var hs-var">newConcreteTyVar</span></a></span></span><span> </span><span id="local-6989586621683014489"><span class="annot"><span class="annottext">ConcreteTvOrigin
</span><a href="#local-6989586621683014489"><span class="hs-identifier hs-var">reason</span></a></span></span><span> </span><span id="local-6989586621683014490"><span class="annot"><span class="annottext">FastString
</span><a href="#local-6989586621683014490"><span class="hs-identifier hs-var">fs</span></a></span></span><span> </span><span id="local-6989586621683014491"><span class="annot"><span class="annottext">TcType
</span><a href="#local-6989586621683014491"><span class="hs-identifier hs-var">kind</span></a></span></span><span>
</span><span id="line-800"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Bool
-&gt; SDoc
-&gt; IOEnv (Env TcGblEnv TcLclEnv) TcTyVar
-&gt; IOEnv (Env TcGblEnv TcLclEnv) TcTyVar
forall a. HasCallStack =&gt; Bool -&gt; SDoc -&gt; a -&gt; a
</span><a href="GHC.Utils.Panic.html#assertPpr"><span class="hs-identifier hs-var">assertPpr</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TcType -&gt; Bool
</span><a href="GHC.Core.Type.html#isConcreteType"><span class="hs-identifier hs-var">isConcreteType</span></a></span><span> </span><span class="annot"><span class="annottext">TcType
</span><a href="#local-6989586621683014491"><span class="hs-identifier hs-var">kind</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">SDoc
</span><a href="#local-6989586621683014494"><span class="hs-identifier hs-var">assert_msg</span></a></span><span> </span><span class="annot"><span class="annottext">(IOEnv (Env TcGblEnv TcLclEnv) TcTyVar
 -&gt; IOEnv (Env TcGblEnv TcLclEnv) TcTyVar)
-&gt; IOEnv (Env TcGblEnv TcLclEnv) TcTyVar
-&gt; IOEnv (Env TcGblEnv TcLclEnv) TcTyVar
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-801"></span><span>  </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span id="local-6989586621683014495"><span class="annot"><a href="#local-6989586621683014495"><span class="hs-identifier hs-var">th_stage</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">TcM ThStage
</span><a href="GHC.Tc.Utils.Monad.html#getStage"><span class="hs-identifier hs-var">getStage</span></a></span><span>
</span><span id="line-802"></span><span>     </span><span class="hs-special">;</span><span> </span><span class="hs-keyword">if</span><span>
</span><span id="line-803"></span><span>        </span><span class="hs-comment">-- See [Wrinkle: Typed Template Haskell]</span><span>
</span><span id="line-804"></span><span>        </span><span class="hs-comment">-- in Note [hasFixedRuntimeRep] in GHC.Tc.Utils.Concrete.</span><span>
</span><span id="line-805"></span><span>        </span><span class="hs-glyph">|</span><span> </span><span class="annot"><a href="GHC.Tc.Types.TH.html#Brack"><span class="hs-identifier hs-type">Brack</span></a></span><span> </span><span class="annot"><span class="hs-identifier">_</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Tc.Types.TH.html#TcPending"><span class="hs-identifier hs-type">TcPending</span></a></span><span> </span><span class="hs-special">{</span><span class="hs-special">}</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><a href="#local-6989586621683014495"><span class="hs-identifier hs-type">th_stage</span></a></span><span>
</span><span id="line-806"></span><span>        </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.TcMType.html#newNamedAnonMetaTyVar"><span class="hs-identifier hs-type">newNamedAnonMetaTyVar</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683014490"><span class="hs-identifier hs-type">fs</span></a></span><span> </span><span class="annot"><a href="GHC.Tc.Utils.TcType.html#TauTv"><span class="hs-identifier hs-type">TauTv</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683014491"><span class="hs-identifier hs-type">kind</span></a></span><span>
</span><span id="line-807"></span><span>
</span><span id="line-808"></span><span>        </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="hs-identifier hs-type">otherwise</span></span><span>
</span><span id="line-809"></span><span>        </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.TcMType.html#newNamedAnonMetaTyVar"><span class="hs-identifier hs-type">newNamedAnonMetaTyVar</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683014490"><span class="hs-identifier hs-type">fs</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Tc.Utils.TcType.html#ConcreteTv"><span class="hs-identifier hs-type">ConcreteTv</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683014489"><span class="hs-identifier hs-type">reason</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><a href="#local-6989586621683014491"><span class="hs-identifier hs-type">kind</span></a></span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-810"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-811"></span><span>    </span><span id="local-6989586621683014494"><span class="annot"><span class="annottext">assert_msg :: SDoc
</span><a href="#local-6989586621683014494"><span class="hs-identifier hs-var hs-var">assert_msg</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">String -&gt; SDoc
forall doc. IsLine doc =&gt; String -&gt; doc
</span><a href="GHC.Utils.Outputable.html#text"><span class="hs-identifier hs-var">text</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;newConcreteTyVar: non-concrete kind&quot;</span></span><span> </span><span class="annot"><span class="annottext">SDoc -&gt; SDoc -&gt; SDoc
forall doc. IsLine doc =&gt; doc -&gt; doc -&gt; doc
</span><a href="GHC.Utils.Outputable.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">TcType -&gt; SDoc
forall a. Outputable a =&gt; a -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="annot"><span class="annottext">TcType
</span><a href="#local-6989586621683014491"><span class="hs-identifier hs-var">kind</span></a></span><span>
</span><span id="line-812"></span><span>
</span><span id="line-813"></span><span class="annot"><a href="GHC.Tc.Utils.TcMType.html#newPatTyVar"><span class="hs-identifier hs-type">newPatTyVar</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Types.Name.html#Name"><span class="hs-identifier hs-type">Name</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#Kind"><span class="hs-identifier hs-type">Kind</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#TcM"><span class="hs-identifier hs-type">TcM</span></a></span><span> </span><span class="annot"><a href="GHC.Types.Var.html#TcTyVar"><span class="hs-identifier hs-type">TcTyVar</span></a></span><span>
</span><span id="line-814"></span><span id="newPatTyVar"><span class="annot"><span class="annottext">newPatTyVar :: Name -&gt; TcType -&gt; IOEnv (Env TcGblEnv TcLclEnv) TcTyVar
</span><a href="GHC.Tc.Utils.TcMType.html#newPatTyVar"><span class="hs-identifier hs-var hs-var">newPatTyVar</span></a></span></span><span> </span><span id="local-6989586621683014496"><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621683014496"><span class="hs-identifier hs-var">name</span></a></span></span><span> </span><span id="local-6989586621683014497"><span class="annot"><span class="annottext">TcType
</span><a href="#local-6989586621683014497"><span class="hs-identifier hs-var">kind</span></a></span></span><span>
</span><span id="line-815"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span id="local-6989586621683014498"><span class="annot"><a href="#local-6989586621683014498"><span class="hs-identifier hs-var">details</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">MetaInfo -&gt; TcM TcTyVarDetails
</span><a href="GHC.Tc.Utils.TcMType.html#newMetaDetails"><span class="hs-identifier hs-var">newMetaDetails</span></a></span><span> </span><span class="annot"><span class="annottext">MetaInfo
</span><a href="GHC.Tc.Utils.TcType.html#TauTv"><span class="hs-identifier hs-var">TauTv</span></a></span><span>
</span><span id="line-816"></span><span>       </span><span class="hs-special">;</span><span> </span><span id="local-6989586621683014499"><span class="annot"><a href="#local-6989586621683014499"><span class="hs-identifier hs-var">uniq</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.Monad.html#newUnique"><span class="hs-identifier hs-type">newUnique</span></a></span><span>
</span><span id="line-817"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621683014500"><span class="annot"><a href="#local-6989586621683014500"><span class="hs-identifier hs-var hs-var">name'</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621683014496"><span class="hs-identifier hs-var">name</span></a></span><span> </span><span class="annot"><span class="annottext">Name -&gt; Unique -&gt; Name
</span><a href="GHC.Types.Name.html#setNameUnique"><span class="hs-operator hs-var">`setNameUnique`</span></a></span><span> </span><span class="annot"><span class="annottext">Unique
</span><a href="#local-6989586621683014499"><span class="hs-identifier hs-var">uniq</span></a></span><span>
</span><span id="line-818"></span><span>             </span><span id="local-6989586621683014501"><span class="annot"><a href="#local-6989586621683014501"><span class="hs-identifier hs-var hs-var">tyvar</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Name -&gt; TcType -&gt; TcTyVarDetails -&gt; TcTyVar
</span><a href="GHC.Types.Var.html#mkTcTyVar"><span class="hs-identifier hs-var">mkTcTyVar</span></a></span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621683014500"><span class="hs-identifier hs-var">name'</span></a></span><span> </span><span class="annot"><span class="annottext">TcType
</span><a href="#local-6989586621683014497"><span class="hs-identifier hs-var">kind</span></a></span><span> </span><span class="annot"><span class="annottext">TcTyVarDetails
</span><a href="#local-6989586621683014498"><span class="hs-identifier hs-var">details</span></a></span><span>
</span><span id="line-819"></span><span>         </span><span class="hs-comment">-- Don't use cloneMetaTyVar;</span><span>
</span><span id="line-820"></span><span>         </span><span class="hs-comment">-- same reasoning as in newTyVarTyVar</span><span>
</span><span id="line-821"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.Monad.html#traceTc"><span class="hs-identifier hs-type">traceTc</span></a></span><span> </span><span class="annot"><span class="hs-string">&quot;newPatTyVar&quot;</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-type">ppr</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683014501"><span class="hs-identifier hs-type">tyvar</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-822"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">return</span></span><span> </span><span class="annot"><a href="#local-6989586621683014501"><span class="hs-identifier hs-type">tyvar</span></a></span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-823"></span><span>
</span><span id="line-824"></span><span class="annot"><a href="GHC.Tc.Utils.TcMType.html#cloneAnonMetaTyVar"><span class="hs-identifier hs-type">cloneAnonMetaTyVar</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.TcType.html#MetaInfo"><span class="hs-identifier hs-type">MetaInfo</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Types.Var.html#TyVar"><span class="hs-identifier hs-type">TyVar</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.TcType.html#TcKind"><span class="hs-identifier hs-type">TcKind</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#TcM"><span class="hs-identifier hs-type">TcM</span></a></span><span> </span><span class="annot"><a href="GHC.Types.Var.html#TcTyVar"><span class="hs-identifier hs-type">TcTyVar</span></a></span><span>
</span><span id="line-825"></span><span class="hs-comment">-- Make a fresh MetaTyVar, basing the name</span><span>
</span><span id="line-826"></span><span class="hs-comment">-- on that of the supplied TyVar</span><span>
</span><span id="line-827"></span><span id="cloneAnonMetaTyVar"><span class="annot"><span class="annottext">cloneAnonMetaTyVar :: MetaInfo
-&gt; TcTyVar -&gt; TcType -&gt; IOEnv (Env TcGblEnv TcLclEnv) TcTyVar
</span><a href="GHC.Tc.Utils.TcMType.html#cloneAnonMetaTyVar"><span class="hs-identifier hs-var hs-var">cloneAnonMetaTyVar</span></a></span></span><span> </span><span id="local-6989586621683014504"><span class="annot"><span class="annottext">MetaInfo
</span><a href="#local-6989586621683014504"><span class="hs-identifier hs-var">info</span></a></span></span><span> </span><span id="local-6989586621683014505"><span class="annot"><span class="annottext">TcTyVar
</span><a href="#local-6989586621683014505"><span class="hs-identifier hs-var">tv</span></a></span></span><span> </span><span id="local-6989586621683014506"><span class="annot"><span class="annottext">TcType
</span><a href="#local-6989586621683014506"><span class="hs-identifier hs-var">kind</span></a></span></span><span>
</span><span id="line-828"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>  </span><span class="hs-special">{</span><span> </span><span id="local-6989586621683014507"><span class="annot"><a href="#local-6989586621683014507"><span class="hs-identifier hs-var">details</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">MetaInfo -&gt; TcM TcTyVarDetails
</span><a href="GHC.Tc.Utils.TcMType.html#newMetaDetails"><span class="hs-identifier hs-var">newMetaDetails</span></a></span><span> </span><span class="annot"><span class="annottext">MetaInfo
</span><a href="#local-6989586621683014504"><span class="hs-identifier hs-var">info</span></a></span><span>
</span><span id="line-829"></span><span>        </span><span class="hs-special">;</span><span> </span><span id="local-6989586621683014508"><span class="annot"><a href="#local-6989586621683014508"><span class="hs-identifier hs-var">name</span></a></span></span><span>    </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.TcMType.html#cloneMetaTyVarName"><span class="hs-identifier hs-type">cloneMetaTyVarName</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Types.Var.html#tyVarName"><span class="hs-identifier hs-type">tyVarName</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683014505"><span class="hs-identifier hs-type">tv</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-830"></span><span>        </span><span class="hs-special">;</span><span> </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621683014510"><span class="annot"><a href="#local-6989586621683014510"><span class="hs-identifier hs-var hs-var">tyvar</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Name -&gt; TcType -&gt; TcTyVarDetails -&gt; TcTyVar
</span><a href="GHC.Types.Var.html#mkTcTyVar"><span class="hs-identifier hs-var">mkTcTyVar</span></a></span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621683014508"><span class="hs-identifier hs-var">name</span></a></span><span> </span><span class="annot"><span class="annottext">TcType
</span><a href="#local-6989586621683014506"><span class="hs-identifier hs-var">kind</span></a></span><span> </span><span class="annot"><span class="annottext">TcTyVarDetails
</span><a href="#local-6989586621683014507"><span class="hs-identifier hs-var">details</span></a></span><span>
</span><span id="line-831"></span><span>        </span><span class="hs-special">;</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.Monad.html#traceTc"><span class="hs-identifier hs-type">traceTc</span></a></span><span> </span><span class="annot"><span class="hs-string">&quot;cloneAnonMetaTyVar&quot;</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-type">ppr</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683014510"><span class="hs-identifier hs-type">tyvar</span></a></span><span> </span><span class="annot"><a href="GHC.Utils.Outputable.html#%3C%2B%3E"><span class="hs-operator hs-type">&lt;+&gt;</span></a></span><span> </span><span class="annot"><a href="GHC.Utils.Outputable.html#dcolon"><span class="hs-identifier hs-type">dcolon</span></a></span><span> </span><span class="annot"><a href="GHC.Utils.Outputable.html#%3C%2B%3E"><span class="hs-operator hs-type">&lt;+&gt;</span></a></span><span> </span><span class="annot"><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-type">ppr</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Types.Var.html#tyVarKind"><span class="hs-identifier hs-type">tyVarKind</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683014510"><span class="hs-identifier hs-type">tyvar</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-832"></span><span>        </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">return</span></span><span> </span><span class="annot"><a href="#local-6989586621683014510"><span class="hs-identifier hs-type">tyvar</span></a></span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-833"></span><span>
</span><span id="line-834"></span><span class="hs-comment">-- Make a new CycleBreakerTv. See Note [Type equality cycles]</span><span>
</span><span id="line-835"></span><span class="hs-comment">-- in GHC.Tc.Solver.Equality</span><span>
</span><span id="line-836"></span><span class="annot"><a href="GHC.Tc.Utils.TcMType.html#newCycleBreakerTyVar"><span class="hs-identifier hs-type">newCycleBreakerTyVar</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.TcType.html#TcKind"><span class="hs-identifier hs-type">TcKind</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#TcM"><span class="hs-identifier hs-type">TcM</span></a></span><span> </span><span class="annot"><a href="GHC.Types.Var.html#TcTyVar"><span class="hs-identifier hs-type">TcTyVar</span></a></span><span>
</span><span id="line-837"></span><span id="newCycleBreakerTyVar"><span class="annot"><span class="annottext">newCycleBreakerTyVar :: TcType -&gt; IOEnv (Env TcGblEnv TcLclEnv) TcTyVar
</span><a href="GHC.Tc.Utils.TcMType.html#newCycleBreakerTyVar"><span class="hs-identifier hs-var hs-var">newCycleBreakerTyVar</span></a></span></span><span> </span><span id="local-6989586621683014512"><span class="annot"><span class="annottext">TcType
</span><a href="#local-6989586621683014512"><span class="hs-identifier hs-var">kind</span></a></span></span><span>
</span><span id="line-838"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span id="local-6989586621683014513"><span class="annot"><a href="#local-6989586621683014513"><span class="hs-identifier hs-var">details</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">MetaInfo -&gt; TcM TcTyVarDetails
</span><a href="GHC.Tc.Utils.TcMType.html#newMetaDetails"><span class="hs-identifier hs-var">newMetaDetails</span></a></span><span> </span><span class="annot"><span class="annottext">MetaInfo
</span><a href="GHC.Tc.Utils.TcType.html#CycleBreakerTv"><span class="hs-identifier hs-var">CycleBreakerTv</span></a></span><span>
</span><span id="line-839"></span><span>       </span><span class="hs-special">;</span><span> </span><span id="local-6989586621683014514"><span class="annot"><a href="#local-6989586621683014514"><span class="hs-identifier hs-var">name</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.TcMType.html#newMetaTyVarName"><span class="hs-identifier hs-type">newMetaTyVarName</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Data.FastString.html#fsLit"><span class="hs-identifier hs-type">fsLit</span></a></span><span> </span><span class="annot"><span class="hs-string">&quot;cbv&quot;</span></span><span class="hs-special">)</span><span>
</span><span id="line-840"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">return</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Types.Var.html#mkTcTyVar"><span class="hs-identifier hs-type">mkTcTyVar</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683014514"><span class="hs-identifier hs-type">name</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683014512"><span class="hs-identifier hs-type">kind</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683014513"><span class="hs-identifier hs-type">details</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-841"></span><span>
</span><span id="line-842"></span><span class="annot"><a href="GHC.Tc.Utils.TcMType.html#newMetaDetails"><span class="hs-identifier hs-type">newMetaDetails</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.TcType.html#MetaInfo"><span class="hs-identifier hs-type">MetaInfo</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#TcM"><span class="hs-identifier hs-type">TcM</span></a></span><span> </span><span class="annot"><a href="GHC.Tc.Utils.TcType.html#TcTyVarDetails"><span class="hs-identifier hs-type">TcTyVarDetails</span></a></span><span>
</span><span id="line-843"></span><span id="newMetaDetails"><span class="annot"><span class="annottext">newMetaDetails :: MetaInfo -&gt; TcM TcTyVarDetails
</span><a href="GHC.Tc.Utils.TcMType.html#newMetaDetails"><span class="hs-identifier hs-var hs-var">newMetaDetails</span></a></span></span><span> </span><span id="local-6989586621683014515"><span class="annot"><span class="annottext">MetaInfo
</span><a href="#local-6989586621683014515"><span class="hs-identifier hs-var">info</span></a></span></span><span>
</span><span id="line-844"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span id="local-6989586621683014516"><span class="annot"><a href="#local-6989586621683014516"><span class="hs-identifier hs-var">ref</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">MetaDetails -&gt; IOEnv (Env TcGblEnv TcLclEnv) (IORef MetaDetails)
forall a env. a -&gt; IOEnv env (IORef a)
</span><a href="GHC.Data.IOEnv.html#newMutVar"><span class="hs-identifier hs-var">newMutVar</span></a></span><span> </span><span class="annot"><span class="annottext">MetaDetails
</span><a href="GHC.Tc.Utils.TcType.html#Flexi"><span class="hs-identifier hs-var">Flexi</span></a></span><span>
</span><span id="line-845"></span><span>       </span><span class="hs-special">;</span><span> </span><span id="local-6989586621683014518"><span class="annot"><a href="#local-6989586621683014518"><span class="hs-identifier hs-var">tclvl</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.Monad.html#getTcLevel"><span class="hs-identifier hs-type">getTcLevel</span></a></span><span>
</span><span id="line-846"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">return</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Tc.Utils.TcType.html#MetaTv"><span class="hs-identifier hs-type">MetaTv</span></a></span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.TcType.html#mtv_info"><span class="hs-identifier hs-var">mtv_info</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="#local-6989586621683014515"><span class="hs-identifier hs-type">info</span></a></span><span>
</span><span id="line-847"></span><span>                        </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.TcType.html#mtv_ref"><span class="hs-identifier hs-var">mtv_ref</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="#local-6989586621683014516"><span class="hs-identifier hs-type">ref</span></a></span><span>
</span><span id="line-848"></span><span>                        </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.TcType.html#mtv_tclvl"><span class="hs-identifier hs-var">mtv_tclvl</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="#local-6989586621683014518"><span class="hs-identifier hs-type">tclvl</span></a></span><span> </span><span class="hs-special">}</span><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-849"></span><span>
</span><span id="line-850"></span><span class="annot"><a href="GHC.Tc.Utils.TcMType.html#newTauTvDetailsAtLevel"><span class="hs-identifier hs-type">newTauTvDetailsAtLevel</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.TcType.html#TcLevel"><span class="hs-identifier hs-type">TcLevel</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#TcM"><span class="hs-identifier hs-type">TcM</span></a></span><span> </span><span class="annot"><a href="GHC.Tc.Utils.TcType.html#TcTyVarDetails"><span class="hs-identifier hs-type">TcTyVarDetails</span></a></span><span>
</span><span id="line-851"></span><span id="newTauTvDetailsAtLevel"><span class="annot"><span class="annottext">newTauTvDetailsAtLevel :: TcLevel -&gt; TcM TcTyVarDetails
</span><a href="GHC.Tc.Utils.TcMType.html#newTauTvDetailsAtLevel"><span class="hs-identifier hs-var hs-var">newTauTvDetailsAtLevel</span></a></span></span><span> </span><span id="local-6989586621683014523"><span class="annot"><span class="annottext">TcLevel
</span><a href="#local-6989586621683014523"><span class="hs-identifier hs-var">tclvl</span></a></span></span><span>
</span><span id="line-852"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span id="local-6989586621683014524"><span class="annot"><a href="#local-6989586621683014524"><span class="hs-identifier hs-var">ref</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">MetaDetails -&gt; IOEnv (Env TcGblEnv TcLclEnv) (IORef MetaDetails)
forall a env. a -&gt; IOEnv env (IORef a)
</span><a href="GHC.Data.IOEnv.html#newMutVar"><span class="hs-identifier hs-var">newMutVar</span></a></span><span> </span><span class="annot"><span class="annottext">MetaDetails
</span><a href="GHC.Tc.Utils.TcType.html#Flexi"><span class="hs-identifier hs-var">Flexi</span></a></span><span>
</span><span id="line-853"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">return</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Tc.Utils.TcType.html#MetaTv"><span class="hs-identifier hs-type">MetaTv</span></a></span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.TcType.html#mtv_info"><span class="hs-identifier hs-var">mtv_info</span></a></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.TcType.html#TauTv"><span class="hs-identifier hs-type">TauTv</span></a></span><span>
</span><span id="line-854"></span><span>                        </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.TcType.html#mtv_ref"><span class="hs-identifier hs-var">mtv_ref</span></a></span><span>   </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="#local-6989586621683014524"><span class="hs-identifier hs-type">ref</span></a></span><span>
</span><span id="line-855"></span><span>                        </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.TcType.html#mtv_tclvl"><span class="hs-identifier hs-var">mtv_tclvl</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="#local-6989586621683014523"><span class="hs-identifier hs-type">tclvl</span></a></span><span> </span><span class="hs-special">}</span><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-856"></span><span>
</span><span id="line-857"></span><span class="annot"><a href="GHC.Tc.Utils.TcMType.html#newConcreteTvDetailsAtLevel"><span class="hs-identifier hs-type">newConcreteTvDetailsAtLevel</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.TcType.html#ConcreteTvOrigin"><span class="hs-identifier hs-type">ConcreteTvOrigin</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.TcType.html#TcLevel"><span class="hs-identifier hs-type">TcLevel</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#TcM"><span class="hs-identifier hs-type">TcM</span></a></span><span> </span><span class="annot"><a href="GHC.Tc.Utils.TcType.html#TcTyVarDetails"><span class="hs-identifier hs-type">TcTyVarDetails</span></a></span><span>
</span><span id="line-858"></span><span id="newConcreteTvDetailsAtLevel"><span class="annot"><span class="annottext">newConcreteTvDetailsAtLevel :: ConcreteTvOrigin -&gt; TcLevel -&gt; TcM TcTyVarDetails
</span><a href="GHC.Tc.Utils.TcMType.html#newConcreteTvDetailsAtLevel"><span class="hs-identifier hs-var hs-var">newConcreteTvDetailsAtLevel</span></a></span></span><span> </span><span id="local-6989586621683014526"><span class="annot"><span class="annottext">ConcreteTvOrigin
</span><a href="#local-6989586621683014526"><span class="hs-identifier hs-var">conc_orig</span></a></span></span><span> </span><span id="local-6989586621683014527"><span class="annot"><span class="annottext">TcLevel
</span><a href="#local-6989586621683014527"><span class="hs-identifier hs-var">tclvl</span></a></span></span><span>
</span><span id="line-859"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span id="local-6989586621683014528"><span class="annot"><a href="#local-6989586621683014528"><span class="hs-identifier hs-var">ref</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">MetaDetails -&gt; IOEnv (Env TcGblEnv TcLclEnv) (IORef MetaDetails)
forall a env. a -&gt; IOEnv env (IORef a)
</span><a href="GHC.Data.IOEnv.html#newMutVar"><span class="hs-identifier hs-var">newMutVar</span></a></span><span> </span><span class="annot"><span class="annottext">MetaDetails
</span><a href="GHC.Tc.Utils.TcType.html#Flexi"><span class="hs-identifier hs-var">Flexi</span></a></span><span>
</span><span id="line-860"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">return</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Tc.Utils.TcType.html#MetaTv"><span class="hs-identifier hs-type">MetaTv</span></a></span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.TcType.html#mtv_info"><span class="hs-identifier hs-var">mtv_info</span></a></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.TcType.html#ConcreteTv"><span class="hs-identifier hs-type">ConcreteTv</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683014526"><span class="hs-identifier hs-type">conc_orig</span></a></span><span>
</span><span id="line-861"></span><span>                        </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.TcType.html#mtv_ref"><span class="hs-identifier hs-var">mtv_ref</span></a></span><span>   </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="#local-6989586621683014528"><span class="hs-identifier hs-type">ref</span></a></span><span>
</span><span id="line-862"></span><span>                        </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.TcType.html#mtv_tclvl"><span class="hs-identifier hs-var">mtv_tclvl</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="#local-6989586621683014527"><span class="hs-identifier hs-type">tclvl</span></a></span><span> </span><span class="hs-special">}</span><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-863"></span><span>
</span><span id="line-864"></span><span class="annot"><a href="GHC.Tc.Utils.TcMType.html#cloneMetaTyVar"><span class="hs-identifier hs-type">cloneMetaTyVar</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Types.Var.html#TcTyVar"><span class="hs-identifier hs-type">TcTyVar</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#TcM"><span class="hs-identifier hs-type">TcM</span></a></span><span> </span><span class="annot"><a href="GHC.Types.Var.html#TcTyVar"><span class="hs-identifier hs-type">TcTyVar</span></a></span><span>
</span><span id="line-865"></span><span id="cloneMetaTyVar"><span class="annot"><span class="annottext">cloneMetaTyVar :: TcTyVar -&gt; IOEnv (Env TcGblEnv TcLclEnv) TcTyVar
</span><a href="GHC.Tc.Utils.TcMType.html#cloneMetaTyVar"><span class="hs-identifier hs-var hs-var">cloneMetaTyVar</span></a></span></span><span> </span><span id="local-6989586621683014529"><span class="annot"><span class="annottext">TcTyVar
</span><a href="#local-6989586621683014529"><span class="hs-identifier hs-var">tv</span></a></span></span><span>
</span><span id="line-866"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Bool
-&gt; IOEnv (Env TcGblEnv TcLclEnv) TcTyVar
-&gt; IOEnv (Env TcGblEnv TcLclEnv) TcTyVar
forall a. HasCallStack =&gt; Bool -&gt; a -&gt; a
</span><a href="GHC.Utils.Panic.Plain.html#assert"><span class="hs-identifier hs-var">assert</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TcTyVar -&gt; Bool
</span><a href="GHC.Types.Var.html#isTcTyVar"><span class="hs-identifier hs-var">isTcTyVar</span></a></span><span> </span><span class="annot"><span class="annottext">TcTyVar
</span><a href="#local-6989586621683014529"><span class="hs-identifier hs-var">tv</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(IOEnv (Env TcGblEnv TcLclEnv) TcTyVar
 -&gt; IOEnv (Env TcGblEnv TcLclEnv) TcTyVar)
-&gt; IOEnv (Env TcGblEnv TcLclEnv) TcTyVar
-&gt; IOEnv (Env TcGblEnv TcLclEnv) TcTyVar
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-867"></span><span>    </span><span class="hs-keyword">do</span><span>  </span><span class="hs-special">{</span><span> </span><span id="local-6989586621683014532"><span class="annot"><a href="#local-6989586621683014532"><span class="hs-identifier hs-var">ref</span></a></span></span><span>  </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">MetaDetails -&gt; IOEnv (Env TcGblEnv TcLclEnv) (IORef MetaDetails)
forall a env. a -&gt; IOEnv env (IORef a)
</span><a href="GHC.Data.IOEnv.html#newMutVar"><span class="hs-identifier hs-var">newMutVar</span></a></span><span> </span><span class="annot"><span class="annottext">MetaDetails
</span><a href="GHC.Tc.Utils.TcType.html#Flexi"><span class="hs-identifier hs-var">Flexi</span></a></span><span>
</span><span id="line-868"></span><span>        </span><span class="hs-special">;</span><span> </span><span id="local-6989586621683014533"><span class="annot"><a href="#local-6989586621683014533"><span class="hs-identifier hs-var">name'</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.TcMType.html#cloneMetaTyVarName"><span class="hs-identifier hs-type">cloneMetaTyVarName</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Types.Var.html#tyVarName"><span class="hs-identifier hs-type">tyVarName</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683014529"><span class="hs-identifier hs-type">tv</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-869"></span><span>        </span><span class="hs-special">;</span><span> </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621683014534"><span class="annot"><a href="#local-6989586621683014534"><span class="hs-identifier hs-var hs-var">details'</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">TcTyVar -&gt; TcTyVarDetails
</span><a href="GHC.Types.Var.html#tcTyVarDetails"><span class="hs-identifier hs-var">tcTyVarDetails</span></a></span><span> </span><span class="annot"><span class="annottext">TcTyVar
</span><a href="#local-6989586621683014529"><span class="hs-identifier hs-var">tv</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-870"></span><span>                           </span><span id="local-6989586621683014536"><span class="annot"><span class="annottext">details :: TcTyVarDetails
</span><a href="#local-6989586621683014536"><span class="hs-identifier hs-var">details</span></a></span></span><span class="hs-glyph">@</span><span class="hs-special">(</span><span class="annot"><a href="GHC.Tc.Utils.TcType.html#MetaTv"><span class="hs-identifier hs-type">MetaTv</span></a></span><span> </span><span class="hs-special">{</span><span class="hs-special">}</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">TcTyVarDetails
</span><a href="#local-6989586621683014536"><span class="hs-identifier hs-var">details</span></a></span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.TcType.html#mtv_ref"><span class="hs-identifier hs-var">mtv_ref</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="#local-6989586621683014532"><span class="hs-identifier hs-type">ref</span></a></span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-871"></span><span>                           </span><span class="annot"><span class="annottext">TcTyVarDetails
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">String -&gt; SDoc -&gt; TcTyVarDetails
forall a. HasCallStack =&gt; String -&gt; SDoc -&gt; a
</span><a href="GHC.Utils.Panic.html#pprPanic"><span class="hs-identifier hs-var">pprPanic</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;cloneMetaTyVar&quot;</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TcTyVar -&gt; SDoc
forall a. Outputable a =&gt; a -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="annot"><span class="annottext">TcTyVar
</span><a href="#local-6989586621683014529"><span class="hs-identifier hs-var">tv</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-872"></span><span>              </span><span id="local-6989586621683014537"><span class="annot"><a href="#local-6989586621683014537"><span class="hs-identifier hs-var hs-var">tyvar</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Name -&gt; TcType -&gt; TcTyVarDetails -&gt; TcTyVar
</span><a href="GHC.Types.Var.html#mkTcTyVar"><span class="hs-identifier hs-var">mkTcTyVar</span></a></span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621683014533"><span class="hs-identifier hs-var">name'</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TcTyVar -&gt; TcType
</span><a href="GHC.Types.Var.html#tyVarKind"><span class="hs-identifier hs-var">tyVarKind</span></a></span><span> </span><span class="annot"><span class="annottext">TcTyVar
</span><a href="#local-6989586621683014529"><span class="hs-identifier hs-var">tv</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">TcTyVarDetails
</span><a href="#local-6989586621683014534"><span class="hs-identifier hs-var">details'</span></a></span><span>
</span><span id="line-873"></span><span>        </span><span class="hs-special">;</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.Monad.html#traceTc"><span class="hs-identifier hs-type">traceTc</span></a></span><span> </span><span class="annot"><span class="hs-string">&quot;cloneMetaTyVar&quot;</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-type">ppr</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683014537"><span class="hs-identifier hs-type">tyvar</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-874"></span><span>        </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">return</span></span><span> </span><span class="annot"><a href="#local-6989586621683014537"><span class="hs-identifier hs-type">tyvar</span></a></span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-875"></span><span>
</span><span id="line-876"></span><span class="annot"><a href="GHC.Tc.Utils.TcMType.html#cloneMetaTyVarWithInfo"><span class="hs-identifier hs-type">cloneMetaTyVarWithInfo</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.TcType.html#MetaInfo"><span class="hs-identifier hs-type">MetaInfo</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.TcType.html#TcLevel"><span class="hs-identifier hs-type">TcLevel</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Types.Var.html#TcTyVar"><span class="hs-identifier hs-type">TcTyVar</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#TcM"><span class="hs-identifier hs-type">TcM</span></a></span><span> </span><span class="annot"><a href="GHC.Types.Var.html#TcTyVar"><span class="hs-identifier hs-type">TcTyVar</span></a></span><span>
</span><span id="line-877"></span><span id="cloneMetaTyVarWithInfo"><span class="annot"><span class="annottext">cloneMetaTyVarWithInfo :: MetaInfo
-&gt; TcLevel -&gt; TcTyVar -&gt; IOEnv (Env TcGblEnv TcLclEnv) TcTyVar
</span><a href="GHC.Tc.Utils.TcMType.html#cloneMetaTyVarWithInfo"><span class="hs-identifier hs-var hs-var">cloneMetaTyVarWithInfo</span></a></span></span><span> </span><span id="local-6989586621683014538"><span class="annot"><span class="annottext">MetaInfo
</span><a href="#local-6989586621683014538"><span class="hs-identifier hs-var">info</span></a></span></span><span> </span><span id="local-6989586621683014539"><span class="annot"><span class="annottext">TcLevel
</span><a href="#local-6989586621683014539"><span class="hs-identifier hs-var">tc_lvl</span></a></span></span><span> </span><span id="local-6989586621683014540"><span class="annot"><span class="annottext">TcTyVar
</span><a href="#local-6989586621683014540"><span class="hs-identifier hs-var">tv</span></a></span></span><span>
</span><span id="line-878"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Bool
-&gt; IOEnv (Env TcGblEnv TcLclEnv) TcTyVar
-&gt; IOEnv (Env TcGblEnv TcLclEnv) TcTyVar
forall a. HasCallStack =&gt; Bool -&gt; a -&gt; a
</span><a href="GHC.Utils.Panic.Plain.html#assert"><span class="hs-identifier hs-var">assert</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TcTyVar -&gt; Bool
</span><a href="GHC.Types.Var.html#isTcTyVar"><span class="hs-identifier hs-var">isTcTyVar</span></a></span><span> </span><span class="annot"><span class="annottext">TcTyVar
</span><a href="#local-6989586621683014540"><span class="hs-identifier hs-var">tv</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(IOEnv (Env TcGblEnv TcLclEnv) TcTyVar
 -&gt; IOEnv (Env TcGblEnv TcLclEnv) TcTyVar)
-&gt; IOEnv (Env TcGblEnv TcLclEnv) TcTyVar
-&gt; IOEnv (Env TcGblEnv TcLclEnv) TcTyVar
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-879"></span><span>    </span><span class="hs-keyword">do</span><span>  </span><span class="hs-special">{</span><span> </span><span id="local-6989586621683014541"><span class="annot"><a href="#local-6989586621683014541"><span class="hs-identifier hs-var">ref</span></a></span></span><span>  </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">MetaDetails -&gt; IOEnv (Env TcGblEnv TcLclEnv) (IORef MetaDetails)
forall a env. a -&gt; IOEnv env (IORef a)
</span><a href="GHC.Data.IOEnv.html#newMutVar"><span class="hs-identifier hs-var">newMutVar</span></a></span><span> </span><span class="annot"><span class="annottext">MetaDetails
</span><a href="GHC.Tc.Utils.TcType.html#Flexi"><span class="hs-identifier hs-var">Flexi</span></a></span><span>
</span><span id="line-880"></span><span>        </span><span class="hs-special">;</span><span> </span><span id="local-6989586621683014542"><span class="annot"><a href="#local-6989586621683014542"><span class="hs-identifier hs-var">name'</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.TcMType.html#cloneMetaTyVarName"><span class="hs-identifier hs-type">cloneMetaTyVarName</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Types.Var.html#tyVarName"><span class="hs-identifier hs-type">tyVarName</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683014540"><span class="hs-identifier hs-type">tv</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-881"></span><span>        </span><span class="hs-special">;</span><span> </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621683014543"><span class="annot"><a href="#local-6989586621683014543"><span class="hs-identifier hs-var hs-var">details</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.TcType.html#MetaTv"><span class="hs-identifier hs-type">MetaTv</span></a></span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">mtv_info :: MetaInfo
</span><a href="GHC.Tc.Utils.TcType.html#mtv_info"><span class="hs-identifier hs-var">mtv_info</span></a></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">MetaInfo
</span><a href="#local-6989586621683014538"><span class="hs-identifier hs-var">info</span></a></span><span>
</span><span id="line-882"></span><span>                               </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">mtv_ref :: IORef MetaDetails
</span><a href="GHC.Tc.Utils.TcType.html#mtv_ref"><span class="hs-identifier hs-var">mtv_ref</span></a></span><span>   </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">IORef MetaDetails
</span><a href="#local-6989586621683014541"><span class="hs-identifier hs-var">ref</span></a></span><span>
</span><span id="line-883"></span><span>                               </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">mtv_tclvl :: TcLevel
</span><a href="GHC.Tc.Utils.TcType.html#mtv_tclvl"><span class="hs-identifier hs-var">mtv_tclvl</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">TcLevel
</span><a href="#local-6989586621683014539"><span class="hs-identifier hs-var">tc_lvl</span></a></span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-884"></span><span>              </span><span id="local-6989586621683014544"><span class="annot"><a href="#local-6989586621683014544"><span class="hs-identifier hs-var hs-var">tyvar</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Name -&gt; TcType -&gt; TcTyVarDetails -&gt; TcTyVar
</span><a href="GHC.Types.Var.html#mkTcTyVar"><span class="hs-identifier hs-var">mkTcTyVar</span></a></span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621683014542"><span class="hs-identifier hs-var">name'</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TcTyVar -&gt; TcType
</span><a href="GHC.Types.Var.html#tyVarKind"><span class="hs-identifier hs-var">tyVarKind</span></a></span><span> </span><span class="annot"><span class="annottext">TcTyVar
</span><a href="#local-6989586621683014540"><span class="hs-identifier hs-var">tv</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">TcTyVarDetails
</span><a href="#local-6989586621683014543"><span class="hs-identifier hs-var">details</span></a></span><span>
</span><span id="line-885"></span><span>        </span><span class="hs-special">;</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.Monad.html#traceTc"><span class="hs-identifier hs-type">traceTc</span></a></span><span> </span><span class="annot"><span class="hs-string">&quot;cloneMetaTyVarWithInfo&quot;</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-type">ppr</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683014544"><span class="hs-identifier hs-type">tyvar</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-886"></span><span>        </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">return</span></span><span> </span><span class="annot"><a href="#local-6989586621683014544"><span class="hs-identifier hs-type">tyvar</span></a></span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-887"></span><span>
</span><span id="line-888"></span><span class="hs-comment">-- Works for both type and kind variables</span><span>
</span><span id="line-889"></span><span id="local-6989586621683013472"><span class="annot"><a href="GHC.Tc.Utils.TcMType.html#readMetaTyVar"><span class="hs-identifier hs-type">readMetaTyVar</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">MonadIO</span></span><span> </span><span class="annot"><a href="#local-6989586621683013472"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="GHC.Types.Var.html#TyVar"><span class="hs-identifier hs-type">TyVar</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621683013472"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="annot"><a href="GHC.Tc.Utils.TcType.html#MetaDetails"><span class="hs-identifier hs-type">MetaDetails</span></a></span></span><span>
</span><span id="line-890"></span><span id="readMetaTyVar"><span class="annot"><span class="annottext">readMetaTyVar :: forall (m :: * -&gt; *). MonadIO m =&gt; TcTyVar -&gt; m MetaDetails
</span><a href="GHC.Tc.Utils.TcMType.html#readMetaTyVar"><span class="hs-identifier hs-var hs-var">readMetaTyVar</span></a></span></span><span> </span><span id="local-6989586621683014550"><span class="annot"><span class="annottext">TcTyVar
</span><a href="#local-6989586621683014550"><span class="hs-identifier hs-var">tyvar</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Bool -&gt; SDoc -&gt; m MetaDetails -&gt; m MetaDetails
forall a. HasCallStack =&gt; Bool -&gt; SDoc -&gt; a -&gt; a
</span><a href="GHC.Utils.Panic.html#assertPpr"><span class="hs-identifier hs-var">assertPpr</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TcTyVar -&gt; Bool
</span><a href="GHC.Tc.Utils.TcType.html#isMetaTyVar"><span class="hs-identifier hs-var">isMetaTyVar</span></a></span><span> </span><span class="annot"><span class="annottext">TcTyVar
</span><a href="#local-6989586621683014550"><span class="hs-identifier hs-var">tyvar</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TcTyVar -&gt; SDoc
forall a. Outputable a =&gt; a -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="annot"><span class="annottext">TcTyVar
</span><a href="#local-6989586621683014550"><span class="hs-identifier hs-var">tyvar</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(m MetaDetails -&gt; m MetaDetails) -&gt; m MetaDetails -&gt; m MetaDetails
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-891"></span><span>                      </span><span class="annot"><span class="annottext">IO MetaDetails -&gt; m MetaDetails
forall a. IO a -&gt; m a
forall (m :: * -&gt; *) a. MonadIO m =&gt; IO a -&gt; m a
</span><span class="hs-identifier hs-var">liftIO</span></span><span> </span><span class="annot"><span class="annottext">(IO MetaDetails -&gt; m MetaDetails)
-&gt; IO MetaDetails -&gt; m MetaDetails
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">IORef MetaDetails -&gt; IO MetaDetails
forall a. IORef a -&gt; IO a
</span><span class="hs-identifier hs-var">readIORef</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TcTyVar -&gt; IORef MetaDetails
</span><a href="GHC.Tc.Utils.TcType.html#metaTyVarRef"><span class="hs-identifier hs-var">metaTyVarRef</span></a></span><span> </span><span class="annot"><span class="annottext">TcTyVar
</span><a href="#local-6989586621683014550"><span class="hs-identifier hs-var">tyvar</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-892"></span><span class="hs-pragma">{-# SPECIALISE</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.TcMType.html#readMetaTyVar"><span class="hs-pragma hs-type">readMetaTyVar</span></a></span><span> </span><span class="hs-pragma">::</span><span> </span><span class="annot"><a href="GHC.Types.Var.html#TyVar"><span class="hs-pragma hs-type">TyVar</span></a></span><span> </span><span class="hs-pragma">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#TcM"><span class="hs-pragma hs-type">TcM</span></a></span><span> </span><span class="annot"><a href="GHC.Tc.Utils.TcType.html#MetaDetails"><span class="hs-pragma hs-type">MetaDetails</span></a></span><span> </span><span class="hs-pragma">#-}</span><span>
</span><span id="line-893"></span><span class="hs-pragma">{-# SPECIALISE</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.TcMType.html#readMetaTyVar"><span class="hs-pragma hs-type">readMetaTyVar</span></a></span><span> </span><span class="hs-pragma">::</span><span> </span><span class="annot"><a href="GHC.Types.Var.html#TyVar"><span class="hs-pragma hs-type">TyVar</span></a></span><span> </span><span class="hs-pragma">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Zonk.Monad.html#ZonkM"><span class="hs-pragma hs-type">ZonkM</span></a></span><span> </span><span class="annot"><a href="GHC.Tc.Utils.TcType.html#MetaDetails"><span class="hs-pragma hs-type">MetaDetails</span></a></span><span> </span><span class="hs-pragma">#-}</span><span>
</span><span id="line-894"></span><span>
</span><span id="line-895"></span><span class="annot"><a href="GHC.Tc.Utils.TcMType.html#isFilledMetaTyVar_maybe"><span class="hs-identifier hs-type">isFilledMetaTyVar_maybe</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Types.Var.html#TcTyVar"><span class="hs-identifier hs-type">TcTyVar</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#TcM"><span class="hs-identifier hs-type">TcM</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Maybe</span></span><span> </span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#Type"><span class="hs-identifier hs-type">Type</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-896"></span><span id="isFilledMetaTyVar_maybe"><span class="annot"><span class="annottext">isFilledMetaTyVar_maybe :: TcTyVar -&gt; IOEnv (Env TcGblEnv TcLclEnv) (Maybe TcType)
</span><a href="GHC.Tc.Utils.TcMType.html#isFilledMetaTyVar_maybe"><span class="hs-identifier hs-var hs-var">isFilledMetaTyVar_maybe</span></a></span></span><span> </span><span id="local-6989586621683014553"><span class="annot"><span class="annottext">TcTyVar
</span><a href="#local-6989586621683014553"><span class="hs-identifier hs-var">tv</span></a></span></span><span>
</span><span id="line-897"></span><span class="hs-comment">-- TODO: This should be an assertion that tv is definitely a TcTyVar but it fails</span><span>
</span><span id="line-898"></span><span class="hs-comment">-- at the moment (Jan 22)</span><span>
</span><span id="line-899"></span><span> </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">TcTyVar -&gt; Bool
</span><a href="GHC.Types.Var.html#isTcTyVar"><span class="hs-identifier hs-var">isTcTyVar</span></a></span><span> </span><span class="annot"><span class="annottext">TcTyVar
</span><a href="#local-6989586621683014553"><span class="hs-identifier hs-var">tv</span></a></span><span>
</span><span id="line-900"></span><span> </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.TcType.html#MetaTv"><span class="hs-identifier hs-type">MetaTv</span></a></span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">mtv_ref :: TcTyVarDetails -&gt; IORef MetaDetails
</span><a href="GHC.Tc.Utils.TcType.html#mtv_ref"><span class="hs-identifier hs-var">mtv_ref</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="local-6989586621683014554"><span class="annot"><span class="annottext">IORef MetaDetails
</span><a href="#local-6989586621683014554"><span class="hs-identifier hs-var">ref</span></a></span></span><span> </span><span class="hs-special">}</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">TcTyVar -&gt; TcTyVarDetails
</span><a href="GHC.Types.Var.html#tcTyVarDetails"><span class="hs-identifier hs-var">tcTyVarDetails</span></a></span><span> </span><span class="annot"><span class="annottext">TcTyVar
</span><a href="#local-6989586621683014553"><span class="hs-identifier hs-var">tv</span></a></span><span>
</span><span id="line-901"></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span id="local-6989586621683014555"><span class="annot"><a href="#local-6989586621683014555"><span class="hs-identifier hs-var">cts</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">IORef MetaDetails -&gt; IOEnv (Env TcGblEnv TcLclEnv) MetaDetails
forall (m :: * -&gt; *) a. MonadIO m =&gt; TcRef a -&gt; m a
</span><a href="GHC.Tc.Types.TcRef.html#readTcRef"><span class="hs-identifier hs-var">readTcRef</span></a></span><span> </span><span class="annot"><span class="annottext">IORef MetaDetails
</span><a href="#local-6989586621683014554"><span class="hs-identifier hs-var">ref</span></a></span><span>
</span><span id="line-902"></span><span>      </span><span class="hs-special">;</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><a href="#local-6989586621683014555"><span class="hs-identifier hs-type">cts</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-903"></span><span>          </span><span class="annot"><a href="GHC.Tc.Utils.TcType.html#Indirect"><span class="hs-identifier hs-type">Indirect</span></a></span><span> </span><span id="local-6989586621683014557"><span class="annot"><span class="annottext">TcType
</span><a href="#local-6989586621683014557"><span class="hs-identifier hs-var">ty</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Maybe TcType -&gt; IOEnv (Env TcGblEnv TcLclEnv) (Maybe TcType)
forall a. a -&gt; IOEnv (Env TcGblEnv TcLclEnv) a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TcType -&gt; Maybe TcType
forall a. a -&gt; Maybe a
</span><span class="hs-identifier hs-var">Just</span></span><span> </span><span class="annot"><span class="annottext">TcType
</span><a href="#local-6989586621683014557"><span class="hs-identifier hs-var">ty</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-904"></span><span>          </span><span class="annot"><span class="annottext">MetaDetails
</span><a href="GHC.Tc.Utils.TcType.html#Flexi"><span class="hs-identifier hs-var">Flexi</span></a></span><span>       </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Maybe TcType -&gt; IOEnv (Env TcGblEnv TcLclEnv) (Maybe TcType)
forall a. a -&gt; IOEnv (Env TcGblEnv TcLclEnv) a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="annot"><span class="annottext">Maybe TcType
forall a. Maybe a
</span><span class="hs-identifier hs-var">Nothing</span></span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-905"></span><span> </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">otherwise</span></span><span>
</span><span id="line-906"></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Maybe TcType -&gt; IOEnv (Env TcGblEnv TcLclEnv) (Maybe TcType)
forall a. a -&gt; IOEnv (Env TcGblEnv TcLclEnv) a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="annot"><span class="annottext">Maybe TcType
forall a. Maybe a
</span><span class="hs-identifier hs-var">Nothing</span></span><span>
</span><span id="line-907"></span><span>
</span><span id="line-908"></span><span class="annot"><a href="GHC.Tc.Utils.TcMType.html#isFilledMetaTyVar"><span class="hs-identifier hs-type">isFilledMetaTyVar</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Types.Var.html#TyVar"><span class="hs-identifier hs-type">TyVar</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#TcM"><span class="hs-identifier hs-type">TcM</span></a></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Bool</span></span><span>
</span><span id="line-909"></span><span class="hs-comment">-- True of a filled-in (Indirect) meta type variable</span><span>
</span><span id="line-910"></span><span id="isFilledMetaTyVar"><span class="annot"><span class="annottext">isFilledMetaTyVar :: TcTyVar -&gt; TcRnIf TcGblEnv TcLclEnv Bool
</span><a href="GHC.Tc.Utils.TcMType.html#isFilledMetaTyVar"><span class="hs-identifier hs-var hs-var">isFilledMetaTyVar</span></a></span></span><span> </span><span id="local-6989586621683014558"><span class="annot"><span class="annottext">TcTyVar
</span><a href="#local-6989586621683014558"><span class="hs-identifier hs-var">tv</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Maybe TcType -&gt; Bool
forall a. Maybe a -&gt; Bool
</span><span class="hs-identifier hs-var">isJust</span></span><span> </span><span class="annot"><span class="annottext">(Maybe TcType -&gt; Bool)
-&gt; IOEnv (Env TcGblEnv TcLclEnv) (Maybe TcType)
-&gt; TcRnIf TcGblEnv TcLclEnv Bool
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="annot"><span class="annottext">TcTyVar -&gt; IOEnv (Env TcGblEnv TcLclEnv) (Maybe TcType)
</span><a href="GHC.Tc.Utils.TcMType.html#isFilledMetaTyVar_maybe"><span class="hs-identifier hs-var">isFilledMetaTyVar_maybe</span></a></span><span> </span><span class="annot"><span class="annottext">TcTyVar
</span><a href="#local-6989586621683014558"><span class="hs-identifier hs-var">tv</span></a></span><span>
</span><span id="line-911"></span><span>
</span><span id="line-912"></span><span class="annot"><a href="GHC.Tc.Utils.TcMType.html#isUnfilledMetaTyVar"><span class="hs-identifier hs-type">isUnfilledMetaTyVar</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Types.Var.html#TyVar"><span class="hs-identifier hs-type">TyVar</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#TcM"><span class="hs-identifier hs-type">TcM</span></a></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Bool</span></span><span>
</span><span id="line-913"></span><span class="hs-comment">-- True of a un-filled-in (Flexi) meta type variable</span><span>
</span><span id="line-914"></span><span class="hs-comment">-- NB: Not the opposite of isFilledMetaTyVar</span><span>
</span><span id="line-915"></span><span id="isUnfilledMetaTyVar"><span class="annot"><span class="annottext">isUnfilledMetaTyVar :: TcTyVar -&gt; TcRnIf TcGblEnv TcLclEnv Bool
</span><a href="GHC.Tc.Utils.TcMType.html#isUnfilledMetaTyVar"><span class="hs-identifier hs-var hs-var">isUnfilledMetaTyVar</span></a></span></span><span> </span><span id="local-6989586621683014560"><span class="annot"><span class="annottext">TcTyVar
</span><a href="#local-6989586621683014560"><span class="hs-identifier hs-var">tv</span></a></span></span><span>
</span><span id="line-916"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.TcType.html#MetaTv"><span class="hs-identifier hs-type">MetaTv</span></a></span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">mtv_ref :: TcTyVarDetails -&gt; IORef MetaDetails
</span><a href="GHC.Tc.Utils.TcType.html#mtv_ref"><span class="hs-identifier hs-var">mtv_ref</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="local-6989586621683014561"><span class="annot"><span class="annottext">IORef MetaDetails
</span><a href="#local-6989586621683014561"><span class="hs-identifier hs-var">ref</span></a></span></span><span> </span><span class="hs-special">}</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">TcTyVar -&gt; TcTyVarDetails
</span><a href="GHC.Types.Var.html#tcTyVarDetails"><span class="hs-identifier hs-var">tcTyVarDetails</span></a></span><span> </span><span class="annot"><span class="annottext">TcTyVar
</span><a href="#local-6989586621683014560"><span class="hs-identifier hs-var">tv</span></a></span><span>
</span><span id="line-917"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>  </span><span class="hs-special">{</span><span> </span><span id="local-6989586621683014562"><span class="annot"><a href="#local-6989586621683014562"><span class="hs-identifier hs-var">details</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">IORef MetaDetails -&gt; IOEnv (Env TcGblEnv TcLclEnv) MetaDetails
forall a env. IORef a -&gt; IOEnv env a
</span><a href="GHC.Data.IOEnv.html#readMutVar"><span class="hs-identifier hs-var">readMutVar</span></a></span><span> </span><span class="annot"><span class="annottext">IORef MetaDetails
</span><a href="#local-6989586621683014561"><span class="hs-identifier hs-var">ref</span></a></span><span>
</span><span id="line-918"></span><span>        </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">return</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Tc.Utils.TcType.html#isFlexi"><span class="hs-identifier hs-type">isFlexi</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683014562"><span class="hs-identifier hs-type">details</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-919"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">otherwise</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Bool -&gt; TcRnIf TcGblEnv TcLclEnv Bool
forall a. a -&gt; IOEnv (Env TcGblEnv TcLclEnv) a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">False</span></span><span>
</span><span id="line-920"></span><span>
</span><span id="line-921"></span><span class="hs-comment">{-
************************************************************************
*                                                                      *
        MetaTvs: TauTvs
*                                                                      *
************************************************************************

Note [Never need to instantiate coercion variables]
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
With coercion variables sloshing around in types, it might seem that we
sometimes need to instantiate coercion variables. This would be problematic,
because coercion variables inhabit unboxed equality (~#), and the constraint
solver thinks in terms only of boxed equality (~). The solution is that
we never need to instantiate coercion variables in the first place.

The tyvars that we need to instantiate come from the types of functions,
data constructors, and patterns. These will never be quantified over
coercion variables, except for the special case of the promoted Eq#. But,
that can't ever appear in user code, so we're safe!
-}</span><span>
</span><span id="line-941"></span><span>
</span><span id="line-942"></span><span>
</span><span id="line-943"></span><span class="annot"><a href="GHC.Tc.Utils.TcMType.html#newMultiplicityVar"><span class="hs-identifier hs-type">newMultiplicityVar</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#TcM"><span class="hs-identifier hs-type">TcM</span></a></span><span> </span><span class="annot"><a href="GHC.Tc.Utils.TcType.html#TcType"><span class="hs-identifier hs-type">TcType</span></a></span><span>
</span><span id="line-944"></span><span id="newMultiplicityVar"><span class="annot"><span class="annottext">newMultiplicityVar :: TcM TcType
</span><a href="GHC.Tc.Utils.TcMType.html#newMultiplicityVar"><span class="hs-identifier hs-var hs-var">newMultiplicityVar</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">TcType -&gt; TcM TcType
</span><a href="GHC.Tc.Utils.TcMType.html#newFlexiTyVarTy"><span class="hs-identifier hs-var">newFlexiTyVarTy</span></a></span><span> </span><span class="annot"><span class="annottext">TcType
</span><a href="GHC.Builtin.Types.html#multiplicityTy"><span class="hs-identifier hs-var">multiplicityTy</span></a></span><span>
</span><span id="line-945"></span><span>
</span><span id="line-946"></span><span class="annot"><a href="GHC.Tc.Utils.TcMType.html#newFlexiTyVar"><span class="hs-identifier hs-type">newFlexiTyVar</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#Kind"><span class="hs-identifier hs-type">Kind</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#TcM"><span class="hs-identifier hs-type">TcM</span></a></span><span> </span><span class="annot"><a href="GHC.Types.Var.html#TcTyVar"><span class="hs-identifier hs-type">TcTyVar</span></a></span><span>
</span><span id="line-947"></span><span id="newFlexiTyVar"><span class="annot"><span class="annottext">newFlexiTyVar :: TcType -&gt; IOEnv (Env TcGblEnv TcLclEnv) TcTyVar
</span><a href="GHC.Tc.Utils.TcMType.html#newFlexiTyVar"><span class="hs-identifier hs-var hs-var">newFlexiTyVar</span></a></span></span><span> </span><span id="local-6989586621683014566"><span class="annot"><span class="annottext">TcType
</span><a href="#local-6989586621683014566"><span class="hs-identifier hs-var">kind</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">MetaInfo -&gt; TcType -&gt; IOEnv (Env TcGblEnv TcLclEnv) TcTyVar
</span><a href="GHC.Tc.Utils.TcMType.html#newAnonMetaTyVar"><span class="hs-identifier hs-var">newAnonMetaTyVar</span></a></span><span> </span><span class="annot"><span class="annottext">MetaInfo
</span><a href="GHC.Tc.Utils.TcType.html#TauTv"><span class="hs-identifier hs-var">TauTv</span></a></span><span> </span><span class="annot"><span class="annottext">TcType
</span><a href="#local-6989586621683014566"><span class="hs-identifier hs-var">kind</span></a></span><span>
</span><span id="line-948"></span><span>
</span><span id="line-949"></span><span class="annot"><span class="hs-comment">-- | Create a new flexi ty var with a specific name</span></span><span>
</span><span id="line-950"></span><span class="annot"><a href="GHC.Tc.Utils.TcMType.html#newNamedFlexiTyVar"><span class="hs-identifier hs-type">newNamedFlexiTyVar</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Data.FastString.html#FastString"><span class="hs-identifier hs-type">FastString</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#Kind"><span class="hs-identifier hs-type">Kind</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#TcM"><span class="hs-identifier hs-type">TcM</span></a></span><span> </span><span class="annot"><a href="GHC.Types.Var.html#TcTyVar"><span class="hs-identifier hs-type">TcTyVar</span></a></span><span>
</span><span id="line-951"></span><span id="newNamedFlexiTyVar"><span class="annot"><span class="annottext">newNamedFlexiTyVar :: FastString -&gt; TcType -&gt; IOEnv (Env TcGblEnv TcLclEnv) TcTyVar
</span><a href="GHC.Tc.Utils.TcMType.html#newNamedFlexiTyVar"><span class="hs-identifier hs-var hs-var">newNamedFlexiTyVar</span></a></span></span><span> </span><span id="local-6989586621683014567"><span class="annot"><span class="annottext">FastString
</span><a href="#local-6989586621683014567"><span class="hs-identifier hs-var">fs</span></a></span></span><span> </span><span id="local-6989586621683014568"><span class="annot"><span class="annottext">TcType
</span><a href="#local-6989586621683014568"><span class="hs-identifier hs-var">kind</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">FastString
-&gt; MetaInfo -&gt; TcType -&gt; IOEnv (Env TcGblEnv TcLclEnv) TcTyVar
</span><a href="GHC.Tc.Utils.TcMType.html#newNamedAnonMetaTyVar"><span class="hs-identifier hs-var">newNamedAnonMetaTyVar</span></a></span><span> </span><span class="annot"><span class="annottext">FastString
</span><a href="#local-6989586621683014567"><span class="hs-identifier hs-var">fs</span></a></span><span> </span><span class="annot"><span class="annottext">MetaInfo
</span><a href="GHC.Tc.Utils.TcType.html#TauTv"><span class="hs-identifier hs-var">TauTv</span></a></span><span> </span><span class="annot"><span class="annottext">TcType
</span><a href="#local-6989586621683014568"><span class="hs-identifier hs-var">kind</span></a></span><span>
</span><span id="line-952"></span><span>
</span><span id="line-953"></span><span class="annot"><a href="GHC.Tc.Utils.TcMType.html#newFlexiTyVarTy"><span class="hs-identifier hs-type">newFlexiTyVarTy</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#Kind"><span class="hs-identifier hs-type">Kind</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#TcM"><span class="hs-identifier hs-type">TcM</span></a></span><span> </span><span class="annot"><a href="GHC.Tc.Utils.TcType.html#TcType"><span class="hs-identifier hs-type">TcType</span></a></span><span>
</span><span id="line-954"></span><span id="newFlexiTyVarTy"><span class="annot"><span class="annottext">newFlexiTyVarTy :: TcType -&gt; TcM TcType
</span><a href="GHC.Tc.Utils.TcMType.html#newFlexiTyVarTy"><span class="hs-identifier hs-var hs-var">newFlexiTyVarTy</span></a></span></span><span> </span><span id="local-6989586621683014569"><span class="annot"><span class="annottext">TcType
</span><a href="#local-6989586621683014569"><span class="hs-identifier hs-var">kind</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-955"></span><span>    </span><span id="local-6989586621683014570"><span class="annot"><a href="#local-6989586621683014570"><span class="hs-identifier hs-var">tc_tyvar</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">TcType -&gt; IOEnv (Env TcGblEnv TcLclEnv) TcTyVar
</span><a href="GHC.Tc.Utils.TcMType.html#newFlexiTyVar"><span class="hs-identifier hs-var">newFlexiTyVar</span></a></span><span> </span><span class="annot"><span class="annottext">TcType
</span><a href="#local-6989586621683014569"><span class="hs-identifier hs-var">kind</span></a></span><span>
</span><span id="line-956"></span><span>    </span><span class="annot"><span class="hs-identifier hs-type">return</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#mkTyVarTy"><span class="hs-identifier hs-type">mkTyVarTy</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683014570"><span class="hs-identifier hs-type">tc_tyvar</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-957"></span><span>
</span><span id="line-958"></span><span class="annot"><a href="GHC.Tc.Utils.TcMType.html#newFlexiTyVarTys"><span class="hs-identifier hs-type">newFlexiTyVarTys</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Int</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#Kind"><span class="hs-identifier hs-type">Kind</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#TcM"><span class="hs-identifier hs-type">TcM</span></a></span><span> </span><span class="hs-special">[</span><span class="annot"><a href="GHC.Tc.Utils.TcType.html#TcType"><span class="hs-identifier hs-type">TcType</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-959"></span><span id="newFlexiTyVarTys"><span class="annot"><span class="annottext">newFlexiTyVarTys :: Int -&gt; TcType -&gt; TcM [TcType]
</span><a href="GHC.Tc.Utils.TcMType.html#newFlexiTyVarTys"><span class="hs-identifier hs-var hs-var">newFlexiTyVarTys</span></a></span></span><span> </span><span id="local-6989586621683014571"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621683014571"><span class="hs-identifier hs-var">n</span></a></span></span><span> </span><span id="local-6989586621683014572"><span class="annot"><span class="annottext">TcType
</span><a href="#local-6989586621683014572"><span class="hs-identifier hs-var">kind</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Int -&gt; TcM TcType -&gt; TcM [TcType]
forall (m :: * -&gt; *) a. Applicative m =&gt; Int -&gt; m a -&gt; m [a]
</span><span class="hs-identifier hs-var">replicateM</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621683014571"><span class="hs-identifier hs-var">n</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TcType -&gt; TcM TcType
</span><a href="GHC.Tc.Utils.TcMType.html#newFlexiTyVarTy"><span class="hs-identifier hs-var">newFlexiTyVarTy</span></a></span><span> </span><span class="annot"><span class="annottext">TcType
</span><a href="#local-6989586621683014572"><span class="hs-identifier hs-var">kind</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-960"></span><span>
</span><span id="line-961"></span><span class="annot"><a href="GHC.Tc.Utils.TcMType.html#newOpenTypeKind"><span class="hs-identifier hs-type">newOpenTypeKind</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#TcM"><span class="hs-identifier hs-type">TcM</span></a></span><span> </span><span class="annot"><a href="GHC.Tc.Utils.TcType.html#TcKind"><span class="hs-identifier hs-type">TcKind</span></a></span><span>
</span><span id="line-962"></span><span id="newOpenTypeKind"><span class="annot"><span class="annottext">newOpenTypeKind :: TcM TcType
</span><a href="GHC.Tc.Utils.TcMType.html#newOpenTypeKind"><span class="hs-identifier hs-var hs-var">newOpenTypeKind</span></a></span></span><span>
</span><span id="line-963"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span id="local-6989586621683014573"><span class="annot"><a href="#local-6989586621683014573"><span class="hs-identifier hs-var">rr</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">TcType -&gt; TcM TcType
</span><a href="GHC.Tc.Utils.TcMType.html#newFlexiTyVarTy"><span class="hs-identifier hs-var">newFlexiTyVarTy</span></a></span><span> </span><span class="annot"><span class="annottext">TcType
</span><a href="GHC.Builtin.Types.html#runtimeRepTy"><span class="hs-identifier hs-var">runtimeRepTy</span></a></span><span>
</span><span id="line-964"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">return</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Core.Type.html#mkTYPEapp"><span class="hs-identifier hs-type">mkTYPEapp</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683014573"><span class="hs-identifier hs-type">rr</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-965"></span><span>
</span><span id="line-966"></span><span class="hs-comment">-- | Create a tyvar that can be a lifted or unlifted type.</span><span>
</span><span id="line-967"></span><span class="hs-comment">-- Returns @alpha :: TYPE kappa@, where both @alpha@ and @kappa@ are fresh.</span><span>
</span><span id="line-968"></span><span class="hs-comment">--</span><span>
</span><span id="line-969"></span><span class="hs-comment">-- Note: you should use 'newOpenFlexiFRRTyVarTy' if you also need to ensure</span><span>
</span><span id="line-970"></span><span class="hs-comment">-- that the representation is concrete, in the sense of Note [Concrete types]</span><span>
</span><span id="line-971"></span><span class="hs-comment">-- in GHC.Tc.Utils.Concrete.</span><span>
</span><span id="line-972"></span><span class="annot"><a href="GHC.Tc.Utils.TcMType.html#newOpenFlexiTyVarTy"><span class="hs-identifier hs-type">newOpenFlexiTyVarTy</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#TcM"><span class="hs-identifier hs-type">TcM</span></a></span><span> </span><span class="annot"><a href="GHC.Tc.Utils.TcType.html#TcType"><span class="hs-identifier hs-type">TcType</span></a></span><span>
</span><span id="line-973"></span><span id="newOpenFlexiTyVarTy"><span class="annot"><span class="annottext">newOpenFlexiTyVarTy :: TcM TcType
</span><a href="GHC.Tc.Utils.TcMType.html#newOpenFlexiTyVarTy"><span class="hs-identifier hs-var hs-var">newOpenFlexiTyVarTy</span></a></span></span><span>
</span><span id="line-974"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span id="local-6989586621683014574"><span class="annot"><a href="#local-6989586621683014574"><span class="hs-identifier hs-var">tv</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">IOEnv (Env TcGblEnv TcLclEnv) TcTyVar
</span><a href="GHC.Tc.Utils.TcMType.html#newOpenFlexiTyVar"><span class="hs-identifier hs-var">newOpenFlexiTyVar</span></a></span><span>
</span><span id="line-975"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">return</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#mkTyVarTy"><span class="hs-identifier hs-type">mkTyVarTy</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683014574"><span class="hs-identifier hs-type">tv</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-976"></span><span>
</span><span id="line-977"></span><span class="annot"><a href="GHC.Tc.Utils.TcMType.html#newOpenFlexiTyVar"><span class="hs-identifier hs-type">newOpenFlexiTyVar</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#TcM"><span class="hs-identifier hs-type">TcM</span></a></span><span> </span><span class="annot"><a href="GHC.Types.Var.html#TcTyVar"><span class="hs-identifier hs-type">TcTyVar</span></a></span><span>
</span><span id="line-978"></span><span id="newOpenFlexiTyVar"><span class="annot"><span class="annottext">newOpenFlexiTyVar :: IOEnv (Env TcGblEnv TcLclEnv) TcTyVar
</span><a href="GHC.Tc.Utils.TcMType.html#newOpenFlexiTyVar"><span class="hs-identifier hs-var hs-var">newOpenFlexiTyVar</span></a></span></span><span>
</span><span id="line-979"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span id="local-6989586621683014575"><span class="annot"><a href="#local-6989586621683014575"><span class="hs-identifier hs-var">kind</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">TcM TcType
</span><a href="GHC.Tc.Utils.TcMType.html#newOpenTypeKind"><span class="hs-identifier hs-var">newOpenTypeKind</span></a></span><span>
</span><span id="line-980"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.TcMType.html#newFlexiTyVar"><span class="hs-identifier hs-type">newFlexiTyVar</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683014575"><span class="hs-identifier hs-type">kind</span></a></span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-981"></span><span>
</span><span id="line-982"></span><span class="hs-comment">-- | Like 'newOpenFlexiTyVar', but ensures the type variable has a</span><span>
</span><span id="line-983"></span><span class="hs-comment">-- syntactically fixed RuntimeRep in the sense of Note [Fixed RuntimeRep]</span><span>
</span><span id="line-984"></span><span class="hs-comment">-- in GHC.Tc.Utils.Concrete.</span><span>
</span><span id="line-985"></span><span class="annot"><a href="GHC.Tc.Utils.TcMType.html#newOpenFlexiFRRTyVar"><span class="hs-identifier hs-type">newOpenFlexiFRRTyVar</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Tc.Types.Origin.html#FixedRuntimeRepContext"><span class="hs-identifier hs-type">FixedRuntimeRepContext</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#TcM"><span class="hs-identifier hs-type">TcM</span></a></span><span> </span><span class="annot"><a href="GHC.Types.Var.html#TcTyVar"><span class="hs-identifier hs-type">TcTyVar</span></a></span><span>
</span><span id="line-986"></span><span id="newOpenFlexiFRRTyVar"><span class="annot"><span class="annottext">newOpenFlexiFRRTyVar :: FixedRuntimeRepContext -&gt; IOEnv (Env TcGblEnv TcLclEnv) TcTyVar
</span><a href="GHC.Tc.Utils.TcMType.html#newOpenFlexiFRRTyVar"><span class="hs-identifier hs-var hs-var">newOpenFlexiFRRTyVar</span></a></span></span><span> </span><span id="local-6989586621683014576"><span class="annot"><span class="annottext">FixedRuntimeRepContext
</span><a href="#local-6989586621683014576"><span class="hs-identifier hs-var">frr_ctxt</span></a></span></span><span>
</span><span id="line-987"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span id="local-6989586621683014577"><span class="annot"><a href="#local-6989586621683014577"><span class="hs-identifier hs-var">th_stage</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">TcM ThStage
</span><a href="GHC.Tc.Utils.Monad.html#getStage"><span class="hs-identifier hs-var">getStage</span></a></span><span>
</span><span id="line-988"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><a href="#local-6989586621683014577"><span class="hs-identifier hs-type">th_stage</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-989"></span><span>          </span><span class="hs-special">{</span><span> </span><span class="annot"><a href="GHC.Tc.Types.TH.html#Brack"><span class="hs-identifier hs-type">Brack</span></a></span><span> </span><span class="annot"><span class="annottext">ThStage
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Tc.Types.TH.html#TcPending"><span class="hs-identifier hs-type">TcPending</span></a></span><span> </span><span class="hs-special">{</span><span class="hs-special">}</span><span class="hs-special">)</span><span> </span><span class="hs-comment">-- See [Wrinkle: Typed Template Haskell]</span><span>
</span><span id="line-990"></span><span>              </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">IOEnv (Env TcGblEnv TcLclEnv) TcTyVar
</span><a href="GHC.Tc.Utils.TcMType.html#newOpenFlexiTyVar"><span class="hs-identifier hs-var">newOpenFlexiTyVar</span></a></span><span> </span><span class="hs-comment">-- in Note [hasFixedRuntimeRep] in GHC.Tc.Utils.Concrete.</span><span>
</span><span id="line-991"></span><span>          </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="annottext">ThStage
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-992"></span><span>   </span><span class="hs-keyword">mdo</span><span> </span><span class="hs-special">{</span><span> </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621683014578"><span class="annot"><a href="#local-6989586621683014578"><span class="hs-identifier hs-var hs-var">conc_orig</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">FixedRuntimeRepOrigin -&gt; ConcreteTvOrigin
</span><a href="GHC.Tc.Utils.TcType.html#ConcreteFRR"><span class="hs-identifier hs-var">ConcreteFRR</span></a></span><span> </span><span class="annot"><span class="annottext">(FixedRuntimeRepOrigin -&gt; ConcreteTvOrigin)
-&gt; FixedRuntimeRepOrigin -&gt; ConcreteTvOrigin
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-993"></span><span>                          </span><span class="annot"><a href="GHC.Tc.Types.Origin.html#FixedRuntimeRepOrigin"><span class="hs-identifier hs-type">FixedRuntimeRepOrigin</span></a></span><span>
</span><span id="line-994"></span><span>                            </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">frr_context :: FixedRuntimeRepContext
</span><a href="GHC.Tc.Types.Origin.html#frr_context"><span class="hs-identifier hs-var">frr_context</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">FixedRuntimeRepContext
</span><a href="#local-6989586621683014576"><span class="hs-identifier hs-var">frr_ctxt</span></a></span><span>
</span><span id="line-995"></span><span>                            </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">frr_type :: TcType
</span><a href="GHC.Tc.Types.Origin.html#frr_type"><span class="hs-identifier hs-var">frr_type</span></a></span><span>    </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">TcTyVar -&gt; TcType
</span><a href="GHC.Core.TyCo.Rep.html#mkTyVarTy"><span class="hs-identifier hs-var">mkTyVarTy</span></a></span><span> </span><span class="annot"><span class="annottext">TcTyVar
</span><a href="#local-6989586621683014581"><span class="hs-identifier hs-var">tv</span></a></span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-996"></span><span>        </span><span class="hs-special">;</span><span> </span><span id="local-6989586621683014582"><span class="annot"><a href="#local-6989586621683014582"><span class="hs-identifier hs-var">rr</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#mkTyVarTy"><span class="hs-identifier hs-type">mkTyVarTy</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">&lt;$&gt;</span></span><span> </span><span class="annot"><a href="GHC.Tc.Utils.TcMType.html#newConcreteTyVar"><span class="hs-identifier hs-type">newConcreteTyVar</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683014578"><span class="hs-identifier hs-type">conc_orig</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Data.FastString.html#fsLit"><span class="hs-identifier hs-type">fsLit</span></a></span><span> </span><span class="annot"><span class="hs-string">&quot;cx&quot;</span></span><span class="hs-special">)</span><span> </span><span class="annot"><a href="GHC.Builtin.Types.html#runtimeRepTy"><span class="hs-identifier hs-type">runtimeRepTy</span></a></span><span>
</span><span id="line-997"></span><span>        </span><span class="hs-special">;</span><span> </span><span id="local-6989586621683014581"><span class="annot"><a href="#local-6989586621683014581"><span class="hs-identifier hs-var">tv</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.TcMType.html#newFlexiTyVar"><span class="hs-identifier hs-type">newFlexiTyVar</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Core.Type.html#mkTYPEapp"><span class="hs-identifier hs-type">mkTYPEapp</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683014582"><span class="hs-identifier hs-type">rr</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-998"></span><span>        </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">return</span></span><span> </span><span class="annot"><a href="#local-6989586621683014581"><span class="hs-identifier hs-type">tv</span></a></span><span> </span><span class="hs-special">}</span><span> </span><span class="hs-special">}</span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-999"></span><span>
</span><span id="line-1000"></span><span class="annot"><span class="hs-comment">-- | See 'newOpenFlexiFRRTyVar'.</span></span><span>
</span><span id="line-1001"></span><span class="annot"><a href="GHC.Tc.Utils.TcMType.html#newOpenFlexiFRRTyVarTy"><span class="hs-identifier hs-type">newOpenFlexiFRRTyVarTy</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Tc.Types.Origin.html#FixedRuntimeRepContext"><span class="hs-identifier hs-type">FixedRuntimeRepContext</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#TcM"><span class="hs-identifier hs-type">TcM</span></a></span><span> </span><span class="annot"><a href="GHC.Tc.Utils.TcType.html#TcType"><span class="hs-identifier hs-type">TcType</span></a></span><span>
</span><span id="line-1002"></span><span id="newOpenFlexiFRRTyVarTy"><span class="annot"><span class="annottext">newOpenFlexiFRRTyVarTy :: FixedRuntimeRepContext -&gt; TcM TcType
</span><a href="GHC.Tc.Utils.TcMType.html#newOpenFlexiFRRTyVarTy"><span class="hs-identifier hs-var hs-var">newOpenFlexiFRRTyVarTy</span></a></span></span><span> </span><span id="local-6989586621683014583"><span class="annot"><span class="annottext">FixedRuntimeRepContext
</span><a href="#local-6989586621683014583"><span class="hs-identifier hs-var">frr_ctxt</span></a></span></span><span>
</span><span id="line-1003"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span id="local-6989586621683014584"><span class="annot"><a href="#local-6989586621683014584"><span class="hs-identifier hs-var">tv</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">FixedRuntimeRepContext -&gt; IOEnv (Env TcGblEnv TcLclEnv) TcTyVar
</span><a href="GHC.Tc.Utils.TcMType.html#newOpenFlexiFRRTyVar"><span class="hs-identifier hs-var">newOpenFlexiFRRTyVar</span></a></span><span> </span><span class="annot"><span class="annottext">FixedRuntimeRepContext
</span><a href="#local-6989586621683014583"><span class="hs-identifier hs-var">frr_ctxt</span></a></span><span>
</span><span id="line-1004"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">return</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#mkTyVarTy"><span class="hs-identifier hs-type">mkTyVarTy</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683014584"><span class="hs-identifier hs-type">tv</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-1005"></span><span>
</span><span id="line-1006"></span><span class="annot"><a href="GHC.Tc.Utils.TcMType.html#newOpenBoxedTypeKind"><span class="hs-identifier hs-type">newOpenBoxedTypeKind</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#TcM"><span class="hs-identifier hs-type">TcM</span></a></span><span> </span><span class="annot"><a href="GHC.Tc.Utils.TcType.html#TcKind"><span class="hs-identifier hs-type">TcKind</span></a></span><span>
</span><span id="line-1007"></span><span id="newOpenBoxedTypeKind"><span class="annot"><span class="annottext">newOpenBoxedTypeKind :: TcM TcType
</span><a href="GHC.Tc.Utils.TcMType.html#newOpenBoxedTypeKind"><span class="hs-identifier hs-var hs-var">newOpenBoxedTypeKind</span></a></span></span><span>
</span><span id="line-1008"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span id="local-6989586621683014585"><span class="annot"><a href="#local-6989586621683014585"><span class="hs-identifier hs-var">lev</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">TcType -&gt; TcM TcType
</span><a href="GHC.Tc.Utils.TcMType.html#newFlexiTyVarTy"><span class="hs-identifier hs-var">newFlexiTyVarTy</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TyCon -&gt; TcType
</span><a href="GHC.Core.TyCon.html#mkTyConTy"><span class="hs-identifier hs-var">mkTyConTy</span></a></span><span> </span><span class="annot"><span class="annottext">TyCon
</span><a href="GHC.Builtin.Types.html#levityTyCon"><span class="hs-identifier hs-var">levityTyCon</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1009"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621683014588"><span class="annot"><a href="#local-6989586621683014588"><span class="hs-identifier hs-var hs-var">rr</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">TyCon -&gt; [TcType] -&gt; TcType
</span><a href="GHC.Core.Type.html#mkTyConApp"><span class="hs-identifier hs-var">mkTyConApp</span></a></span><span> </span><span class="annot"><span class="annottext">TyCon
</span><a href="GHC.Builtin.Types.html#boxedRepDataConTyCon"><span class="hs-identifier hs-var">boxedRepDataConTyCon</span></a></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">TcType
</span><a href="#local-6989586621683014585"><span class="hs-identifier hs-var">lev</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-1010"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">return</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Core.Type.html#mkTYPEapp"><span class="hs-identifier hs-type">mkTYPEapp</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683014588"><span class="hs-identifier hs-type">rr</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-1011"></span><span>
</span><span id="line-1012"></span><span class="annot"><a href="GHC.Tc.Utils.TcMType.html#newMetaTyVars"><span class="hs-identifier hs-type">newMetaTyVars</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="GHC.Types.Var.html#TyVar"><span class="hs-identifier hs-type">TyVar</span></a></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#TcM"><span class="hs-identifier hs-type">TcM</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Core.TyCo.Subst.html#Subst"><span class="hs-identifier hs-type">Subst</span></a></span><span class="hs-special">,</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="GHC.Types.Var.html#TcTyVar"><span class="hs-identifier hs-type">TcTyVar</span></a></span><span class="hs-special">]</span><span class="hs-special">)</span><span>
</span><span id="line-1013"></span><span class="hs-comment">-- Instantiate with META type variables</span><span>
</span><span id="line-1014"></span><span class="hs-comment">-- Note that this works for a sequence of kind, type, and coercion variables</span><span>
</span><span id="line-1015"></span><span class="hs-comment">-- variables.  Eg    [ (k:*), (a:k-&gt;k) ]</span><span>
</span><span id="line-1016"></span><span class="hs-comment">--             Gives [ (k7:*), (a8:k7-&gt;k7) ]</span><span>
</span><span id="line-1017"></span><span id="newMetaTyVars"><span class="annot"><span class="annottext">newMetaTyVars :: [TcTyVar] -&gt; TcM (Subst, [TcTyVar])
</span><a href="GHC.Tc.Utils.TcMType.html#newMetaTyVars"><span class="hs-identifier hs-var hs-var">newMetaTyVars</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Subst -&gt; [TcTyVar] -&gt; TcM (Subst, [TcTyVar])
</span><a href="GHC.Tc.Utils.TcMType.html#newMetaTyVarsX"><span class="hs-identifier hs-var">newMetaTyVarsX</span></a></span><span> </span><span class="annot"><span class="annottext">Subst
</span><a href="GHC.Core.TyCo.Subst.html#emptySubst"><span class="hs-identifier hs-var">emptySubst</span></a></span><span>
</span><span id="line-1018"></span><span>    </span><span class="hs-comment">-- emptySubst has an empty in-scope set, but that's fine here</span><span>
</span><span id="line-1019"></span><span>    </span><span class="hs-comment">-- Since the tyvars are freshly made, they cannot possibly be</span><span>
</span><span id="line-1020"></span><span>    </span><span class="hs-comment">-- captured by any existing for-alls.</span><span>
</span><span id="line-1021"></span><span>
</span><span id="line-1022"></span><span class="annot"><a href="GHC.Tc.Utils.TcMType.html#newMetaTyVarsX"><span class="hs-identifier hs-type">newMetaTyVarsX</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Core.TyCo.Subst.html#Subst"><span class="hs-identifier hs-type">Subst</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="GHC.Types.Var.html#TyVar"><span class="hs-identifier hs-type">TyVar</span></a></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#TcM"><span class="hs-identifier hs-type">TcM</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Core.TyCo.Subst.html#Subst"><span class="hs-identifier hs-type">Subst</span></a></span><span class="hs-special">,</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="GHC.Types.Var.html#TcTyVar"><span class="hs-identifier hs-type">TcTyVar</span></a></span><span class="hs-special">]</span><span class="hs-special">)</span><span>
</span><span id="line-1023"></span><span class="hs-comment">-- Just like newMetaTyVars, but start with an existing substitution.</span><span>
</span><span id="line-1024"></span><span id="newMetaTyVarsX"><span class="annot"><span class="annottext">newMetaTyVarsX :: Subst -&gt; [TcTyVar] -&gt; TcM (Subst, [TcTyVar])
</span><a href="GHC.Tc.Utils.TcMType.html#newMetaTyVarsX"><span class="hs-identifier hs-var hs-var">newMetaTyVarsX</span></a></span></span><span> </span><span id="local-6989586621683014592"><span class="annot"><span class="annottext">Subst
</span><a href="#local-6989586621683014592"><span class="hs-identifier hs-var">subst</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(Subst
 -&gt; TcTyVar -&gt; IOEnv (Env TcGblEnv TcLclEnv) (Subst, TcTyVar))
-&gt; Subst -&gt; [TcTyVar] -&gt; TcM (Subst, [TcTyVar])
forall (m :: * -&gt; *) (t :: * -&gt; *) acc x y.
(Monad m, Traversable t) =&gt;
(acc -&gt; x -&gt; m (acc, y)) -&gt; acc -&gt; t x -&gt; m (acc, t y)
</span><a href="GHC.Utils.Monad.html#mapAccumLM"><span class="hs-identifier hs-var">mapAccumLM</span></a></span><span> </span><span class="annot"><span class="annottext">Subst -&gt; TcTyVar -&gt; IOEnv (Env TcGblEnv TcLclEnv) (Subst, TcTyVar)
</span><a href="GHC.Tc.Utils.TcMType.html#newMetaTyVarX"><span class="hs-identifier hs-var">newMetaTyVarX</span></a></span><span> </span><span class="annot"><span class="annottext">Subst
</span><a href="#local-6989586621683014592"><span class="hs-identifier hs-var">subst</span></a></span><span>
</span><span id="line-1025"></span><span>
</span><span id="line-1026"></span><span id="local-6989586621683013484"><span class="annot"><a href="GHC.Tc.Utils.TcMType.html#newMetaTyVarBndrsX"><span class="hs-identifier hs-type">newMetaTyVarBndrsX</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Core.TyCo.Subst.html#Subst"><span class="hs-identifier hs-type">Subst</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="GHC.Types.Var.html#VarBndr"><span class="hs-identifier hs-type">VarBndr</span></a></span><span> </span><span class="annot"><a href="GHC.Types.Var.html#TyVar"><span class="hs-identifier hs-type">TyVar</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683013484"><span class="hs-identifier hs-type">vis</span></a></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#TcM"><span class="hs-identifier hs-type">TcM</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Core.TyCo.Subst.html#Subst"><span class="hs-identifier hs-type">Subst</span></a></span><span class="hs-special">,</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="GHC.Types.Var.html#VarBndr"><span class="hs-identifier hs-type">VarBndr</span></a></span><span> </span><span class="annot"><a href="GHC.Types.Var.html#TcTyVar"><span class="hs-identifier hs-type">TcTyVar</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683013484"><span class="hs-identifier hs-type">vis</span></a></span><span class="hs-special">]</span><span class="hs-special">)</span></span><span>
</span><span id="line-1027"></span><span id="newMetaTyVarBndrsX"><span class="annot"><span class="annottext">newMetaTyVarBndrsX :: forall vis.
Subst
-&gt; [VarBndr TcTyVar vis] -&gt; TcM (Subst, [VarBndr TcTyVar vis])
</span><a href="GHC.Tc.Utils.TcMType.html#newMetaTyVarBndrsX"><span class="hs-identifier hs-var hs-var">newMetaTyVarBndrsX</span></a></span></span><span> </span><span id="local-6989586621683014596"><span class="annot"><span class="annottext">Subst
</span><a href="#local-6989586621683014596"><span class="hs-identifier hs-var">subst</span></a></span></span><span> </span><span id="local-6989586621683014597"><span class="annot"><span class="annottext">[VarBndr TcTyVar vis]
</span><a href="#local-6989586621683014597"><span class="hs-identifier hs-var">bndrs</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-1028"></span><span>  </span><span class="hs-special">(</span><span id="local-6989586621683014598"><span class="annot"><a href="#local-6989586621683014598"><span class="hs-identifier hs-var">subst</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621683014599"><span class="annot"><a href="#local-6989586621683014599"><span class="hs-identifier hs-var">bndrs'</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Subst -&gt; [TcTyVar] -&gt; TcM (Subst, [TcTyVar])
</span><a href="GHC.Tc.Utils.TcMType.html#newMetaTyVarsX"><span class="hs-identifier hs-var">newMetaTyVarsX</span></a></span><span> </span><span class="annot"><span class="annottext">Subst
</span><a href="#local-6989586621683014596"><span class="hs-identifier hs-var">subst</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[VarBndr TcTyVar vis] -&gt; [TcTyVar]
forall tv argf. [VarBndr tv argf] -&gt; [tv]
</span><a href="GHC.Types.Var.html#binderVars"><span class="hs-identifier hs-var">binderVars</span></a></span><span> </span><span class="annot"><span class="annottext">[VarBndr TcTyVar vis]
</span><a href="#local-6989586621683014597"><span class="hs-identifier hs-var">bndrs</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1029"></span><span>  </span><span class="annot"><span class="hs-identifier hs-type">pure</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621683014598"><span class="hs-identifier hs-type">subst</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">zipWith</span></span><span> </span><span class="annot"><a href="GHC.Types.Var.html#mkForAllTyBinder"><span class="hs-identifier hs-type">mkForAllTyBinder</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683014603"><span class="hs-identifier hs-type">flags</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683014599"><span class="hs-identifier hs-type">bndrs'</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1030"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-1031"></span><span>    </span><span id="local-6989586621683014603"><span class="annot"><span class="annottext">flags :: [vis]
</span><a href="#local-6989586621683014603"><span class="hs-identifier hs-var hs-var">flags</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[VarBndr TcTyVar vis] -&gt; [vis]
forall tv argf. [VarBndr tv argf] -&gt; [argf]
</span><a href="GHC.Types.Var.html#binderFlags"><span class="hs-identifier hs-var">binderFlags</span></a></span><span> </span><span class="annot"><span class="annottext">[VarBndr TcTyVar vis]
</span><a href="#local-6989586621683014597"><span class="hs-identifier hs-var">bndrs</span></a></span><span>
</span><span id="line-1032"></span><span>
</span><span id="line-1033"></span><span class="annot"><a href="GHC.Tc.Utils.TcMType.html#newMetaTyVarX"><span class="hs-identifier hs-type">newMetaTyVarX</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Core.TyCo.Subst.html#Subst"><span class="hs-identifier hs-type">Subst</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Types.Var.html#TyVar"><span class="hs-identifier hs-type">TyVar</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#TcM"><span class="hs-identifier hs-type">TcM</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Core.TyCo.Subst.html#Subst"><span class="hs-identifier hs-type">Subst</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Types.Var.html#TcTyVar"><span class="hs-identifier hs-type">TcTyVar</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1034"></span><span class="hs-comment">-- Make a new unification variable tyvar whose Name and Kind come from</span><span>
</span><span id="line-1035"></span><span class="hs-comment">-- an existing TyVar. We substitute kind variables in the kind.</span><span>
</span><span id="line-1036"></span><span id="newMetaTyVarX"><span class="annot"><span class="annottext">newMetaTyVarX :: Subst -&gt; TcTyVar -&gt; IOEnv (Env TcGblEnv TcLclEnv) (Subst, TcTyVar)
</span><a href="GHC.Tc.Utils.TcMType.html#newMetaTyVarX"><span class="hs-identifier hs-var hs-var">newMetaTyVarX</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">MetaInfo
-&gt; Subst
-&gt; TcTyVar
-&gt; IOEnv (Env TcGblEnv TcLclEnv) (Subst, TcTyVar)
</span><a href="GHC.Tc.Utils.TcMType.html#new_meta_tv_x"><span class="hs-identifier hs-var">new_meta_tv_x</span></a></span><span> </span><span class="annot"><span class="annottext">MetaInfo
</span><a href="GHC.Tc.Utils.TcType.html#TauTv"><span class="hs-identifier hs-var">TauTv</span></a></span><span>
</span><span id="line-1037"></span><span>
</span><span id="line-1038"></span><span class="annot"><span class="hs-comment">-- | Like 'newMetaTyVarX', but for concrete type variables.</span></span><span>
</span><span id="line-1039"></span><span class="annot"><a href="GHC.Tc.Utils.TcMType.html#newConcreteTyVarX"><span class="hs-identifier hs-type">newConcreteTyVarX</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.TcType.html#ConcreteTvOrigin"><span class="hs-identifier hs-type">ConcreteTvOrigin</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Core.TyCo.Subst.html#Subst"><span class="hs-identifier hs-type">Subst</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Types.Var.html#TyVar"><span class="hs-identifier hs-type">TyVar</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#TcM"><span class="hs-identifier hs-type">TcM</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Core.TyCo.Subst.html#Subst"><span class="hs-identifier hs-type">Subst</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Types.Var.html#TcTyVar"><span class="hs-identifier hs-type">TcTyVar</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1040"></span><span id="newConcreteTyVarX"><span class="annot"><span class="annottext">newConcreteTyVarX :: ConcreteTvOrigin
-&gt; Subst
-&gt; TcTyVar
-&gt; IOEnv (Env TcGblEnv TcLclEnv) (Subst, TcTyVar)
</span><a href="GHC.Tc.Utils.TcMType.html#newConcreteTyVarX"><span class="hs-identifier hs-var hs-var">newConcreteTyVarX</span></a></span></span><span> </span><span id="local-6989586621683014606"><span class="annot"><span class="annottext">ConcreteTvOrigin
</span><a href="#local-6989586621683014606"><span class="hs-identifier hs-var">conc</span></a></span></span><span> </span><span id="local-6989586621683014607"><span class="annot"><span class="annottext">Subst
</span><a href="#local-6989586621683014607"><span class="hs-identifier hs-var">subst</span></a></span></span><span> </span><span id="local-6989586621683014608"><span class="annot"><span class="annottext">TcTyVar
</span><a href="#local-6989586621683014608"><span class="hs-identifier hs-var">tv</span></a></span></span><span>
</span><span id="line-1041"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span id="local-6989586621683014609"><span class="annot"><a href="#local-6989586621683014609"><span class="hs-identifier hs-var">th_stage</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">TcM ThStage
</span><a href="GHC.Tc.Utils.Monad.html#getStage"><span class="hs-identifier hs-var">getStage</span></a></span><span>
</span><span id="line-1042"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="hs-keyword">if</span><span>
</span><span id="line-1043"></span><span>          </span><span class="hs-comment">-- See [Wrinkle: Typed Template Haskell]</span><span>
</span><span id="line-1044"></span><span>          </span><span class="hs-comment">-- in Note [hasFixedRuntimeRep] in GHC.Tc.Utils.Concrete.</span><span>
</span><span id="line-1045"></span><span>          </span><span class="hs-glyph">|</span><span> </span><span class="annot"><a href="GHC.Tc.Types.TH.html#Brack"><span class="hs-identifier hs-type">Brack</span></a></span><span> </span><span class="annot"><span class="hs-identifier">_</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Tc.Types.TH.html#TcPending"><span class="hs-identifier hs-type">TcPending</span></a></span><span> </span><span class="hs-special">{</span><span class="hs-special">}</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><a href="#local-6989586621683014609"><span class="hs-identifier hs-type">th_stage</span></a></span><span>
</span><span id="line-1046"></span><span>          </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.TcMType.html#new_meta_tv_x"><span class="hs-identifier hs-type">new_meta_tv_x</span></a></span><span> </span><span class="annot"><a href="GHC.Tc.Utils.TcType.html#TauTv"><span class="hs-identifier hs-type">TauTv</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683014607"><span class="hs-identifier hs-type">subst</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683014608"><span class="hs-identifier hs-type">tv</span></a></span><span>
</span><span id="line-1047"></span><span>          </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="hs-identifier hs-type">otherwise</span></span><span>
</span><span id="line-1048"></span><span>          </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.TcMType.html#new_meta_tv_x"><span class="hs-identifier hs-type">new_meta_tv_x</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Tc.Utils.TcType.html#ConcreteTv"><span class="hs-identifier hs-type">ConcreteTv</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683014606"><span class="hs-identifier hs-type">conc</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><a href="#local-6989586621683014607"><span class="hs-identifier hs-type">subst</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683014608"><span class="hs-identifier hs-type">tv</span></a></span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-1049"></span><span>
</span><span id="line-1050"></span><span class="annot"><a href="GHC.Tc.Utils.TcMType.html#newMetaTyVarTyVarX"><span class="hs-identifier hs-type">newMetaTyVarTyVarX</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Core.TyCo.Subst.html#Subst"><span class="hs-identifier hs-type">Subst</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Types.Var.html#TyVar"><span class="hs-identifier hs-type">TyVar</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#TcM"><span class="hs-identifier hs-type">TcM</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Core.TyCo.Subst.html#Subst"><span class="hs-identifier hs-type">Subst</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Types.Var.html#TcTyVar"><span class="hs-identifier hs-type">TcTyVar</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1051"></span><span class="hs-comment">-- Just like newMetaTyVarX, but make a TyVarTv</span><span>
</span><span id="line-1052"></span><span id="newMetaTyVarTyVarX"><span class="annot"><span class="annottext">newMetaTyVarTyVarX :: Subst -&gt; TcTyVar -&gt; IOEnv (Env TcGblEnv TcLclEnv) (Subst, TcTyVar)
</span><a href="GHC.Tc.Utils.TcMType.html#newMetaTyVarTyVarX"><span class="hs-identifier hs-var hs-var">newMetaTyVarTyVarX</span></a></span></span><span> </span><span id="local-6989586621683014610"><span class="annot"><span class="annottext">Subst
</span><a href="#local-6989586621683014610"><span class="hs-identifier hs-var">subst</span></a></span></span><span> </span><span id="local-6989586621683014611"><span class="annot"><span class="annottext">TcTyVar
</span><a href="#local-6989586621683014611"><span class="hs-identifier hs-var">tv</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">MetaInfo
-&gt; Subst
-&gt; TcTyVar
-&gt; IOEnv (Env TcGblEnv TcLclEnv) (Subst, TcTyVar)
</span><a href="GHC.Tc.Utils.TcMType.html#new_meta_tv_x"><span class="hs-identifier hs-var">new_meta_tv_x</span></a></span><span> </span><span class="annot"><span class="annottext">MetaInfo
</span><a href="GHC.Tc.Utils.TcType.html#TyVarTv"><span class="hs-identifier hs-var">TyVarTv</span></a></span><span> </span><span class="annot"><span class="annottext">Subst
</span><a href="#local-6989586621683014610"><span class="hs-identifier hs-var">subst</span></a></span><span> </span><span class="annot"><span class="annottext">TcTyVar
</span><a href="#local-6989586621683014611"><span class="hs-identifier hs-var">tv</span></a></span><span>
</span><span id="line-1053"></span><span>
</span><span id="line-1054"></span><span class="annot"><a href="GHC.Tc.Utils.TcMType.html#newWildCardX"><span class="hs-identifier hs-type">newWildCardX</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Core.TyCo.Subst.html#Subst"><span class="hs-identifier hs-type">Subst</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Types.Var.html#TyVar"><span class="hs-identifier hs-type">TyVar</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#TcM"><span class="hs-identifier hs-type">TcM</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Core.TyCo.Subst.html#Subst"><span class="hs-identifier hs-type">Subst</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Types.Var.html#TcTyVar"><span class="hs-identifier hs-type">TcTyVar</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1055"></span><span id="newWildCardX"><span class="annot"><span class="annottext">newWildCardX :: Subst -&gt; TcTyVar -&gt; IOEnv (Env TcGblEnv TcLclEnv) (Subst, TcTyVar)
</span><a href="GHC.Tc.Utils.TcMType.html#newWildCardX"><span class="hs-identifier hs-var hs-var">newWildCardX</span></a></span></span><span> </span><span id="local-6989586621683014612"><span class="annot"><span class="annottext">Subst
</span><a href="#local-6989586621683014612"><span class="hs-identifier hs-var">subst</span></a></span></span><span> </span><span id="local-6989586621683014613"><span class="annot"><span class="annottext">TcTyVar
</span><a href="#local-6989586621683014613"><span class="hs-identifier hs-var">tv</span></a></span></span><span>
</span><span id="line-1056"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span id="local-6989586621683014614"><span class="annot"><a href="#local-6989586621683014614"><span class="hs-identifier hs-var">new_tv</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">MetaInfo -&gt; TcType -&gt; IOEnv (Env TcGblEnv TcLclEnv) TcTyVar
</span><a href="GHC.Tc.Utils.TcMType.html#newAnonMetaTyVar"><span class="hs-identifier hs-var">newAnonMetaTyVar</span></a></span><span> </span><span class="annot"><span class="annottext">MetaInfo
</span><a href="GHC.Tc.Utils.TcType.html#TauTv"><span class="hs-identifier hs-var">TauTv</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">HasDebugCallStack =&gt; Subst -&gt; TcType -&gt; TcType
Subst -&gt; TcType -&gt; TcType
</span><a href="GHC.Core.TyCo.Subst.html#substTy"><span class="hs-identifier hs-var">substTy</span></a></span><span> </span><span class="annot"><span class="annottext">Subst
</span><a href="#local-6989586621683014612"><span class="hs-identifier hs-var">subst</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TcTyVar -&gt; TcType
</span><a href="GHC.Types.Var.html#tyVarKind"><span class="hs-identifier hs-var">tyVarKind</span></a></span><span> </span><span class="annot"><span class="annottext">TcTyVar
</span><a href="#local-6989586621683014613"><span class="hs-identifier hs-var">tv</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-1057"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">return</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Core.TyCo.Subst.html#extendTvSubstWithClone"><span class="hs-identifier hs-type">extendTvSubstWithClone</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683014612"><span class="hs-identifier hs-type">subst</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683014613"><span class="hs-identifier hs-type">tv</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683014614"><span class="hs-identifier hs-type">new_tv</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="#local-6989586621683014614"><span class="hs-identifier hs-type">new_tv</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-1058"></span><span>
</span><span id="line-1059"></span><span class="annot"><a href="GHC.Tc.Utils.TcMType.html#new_meta_tv_x"><span class="hs-identifier hs-type">new_meta_tv_x</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.TcType.html#MetaInfo"><span class="hs-identifier hs-type">MetaInfo</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Core.TyCo.Subst.html#Subst"><span class="hs-identifier hs-type">Subst</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Types.Var.html#TyVar"><span class="hs-identifier hs-type">TyVar</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#TcM"><span class="hs-identifier hs-type">TcM</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Core.TyCo.Subst.html#Subst"><span class="hs-identifier hs-type">Subst</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Types.Var.html#TcTyVar"><span class="hs-identifier hs-type">TcTyVar</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1060"></span><span id="new_meta_tv_x"><span class="annot"><span class="annottext">new_meta_tv_x :: MetaInfo
-&gt; Subst
-&gt; TcTyVar
-&gt; IOEnv (Env TcGblEnv TcLclEnv) (Subst, TcTyVar)
</span><a href="GHC.Tc.Utils.TcMType.html#new_meta_tv_x"><span class="hs-identifier hs-var hs-var">new_meta_tv_x</span></a></span></span><span> </span><span id="local-6989586621683014617"><span class="annot"><span class="annottext">MetaInfo
</span><a href="#local-6989586621683014617"><span class="hs-identifier hs-var">info</span></a></span></span><span> </span><span id="local-6989586621683014618"><span class="annot"><span class="annottext">Subst
</span><a href="#local-6989586621683014618"><span class="hs-identifier hs-var">subst</span></a></span></span><span> </span><span id="local-6989586621683014619"><span class="annot"><span class="annottext">TcTyVar
</span><a href="#local-6989586621683014619"><span class="hs-identifier hs-var">tv</span></a></span></span><span>
</span><span id="line-1061"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>  </span><span class="hs-special">{</span><span> </span><span id="local-6989586621683014620"><span class="annot"><a href="#local-6989586621683014620"><span class="hs-identifier hs-var">new_tv</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">MetaInfo
-&gt; TcTyVar -&gt; TcType -&gt; IOEnv (Env TcGblEnv TcLclEnv) TcTyVar
</span><a href="GHC.Tc.Utils.TcMType.html#cloneAnonMetaTyVar"><span class="hs-identifier hs-var">cloneAnonMetaTyVar</span></a></span><span> </span><span class="annot"><span class="annottext">MetaInfo
</span><a href="#local-6989586621683014617"><span class="hs-identifier hs-var">info</span></a></span><span> </span><span class="annot"><span class="annottext">TcTyVar
</span><a href="#local-6989586621683014619"><span class="hs-identifier hs-var">tv</span></a></span><span> </span><span class="annot"><span class="annottext">TcType
</span><a href="#local-6989586621683014621"><span class="hs-identifier hs-var">substd_kind</span></a></span><span>
</span><span id="line-1062"></span><span>        </span><span class="hs-special">;</span><span> </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621683014622"><span class="annot"><a href="#local-6989586621683014622"><span class="hs-identifier hs-var hs-var">subst1</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Subst -&gt; TcTyVar -&gt; TcTyVar -&gt; Subst
</span><a href="GHC.Core.TyCo.Subst.html#extendTvSubstWithClone"><span class="hs-identifier hs-var">extendTvSubstWithClone</span></a></span><span> </span><span class="annot"><span class="annottext">Subst
</span><a href="#local-6989586621683014618"><span class="hs-identifier hs-var">subst</span></a></span><span> </span><span class="annot"><span class="annottext">TcTyVar
</span><a href="#local-6989586621683014619"><span class="hs-identifier hs-var">tv</span></a></span><span> </span><span class="annot"><span class="annottext">TcTyVar
</span><a href="#local-6989586621683014620"><span class="hs-identifier hs-var">new_tv</span></a></span><span>
</span><span id="line-1063"></span><span>        </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">return</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621683014622"><span class="hs-identifier hs-type">subst1</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="#local-6989586621683014620"><span class="hs-identifier hs-type">new_tv</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-1064"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-1065"></span><span>    </span><span id="local-6989586621683014621"><span class="annot"><span class="annottext">substd_kind :: TcType
</span><a href="#local-6989586621683014621"><span class="hs-identifier hs-var hs-var">substd_kind</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">HasDebugCallStack =&gt; Subst -&gt; TcType -&gt; TcType
Subst -&gt; TcType -&gt; TcType
</span><a href="GHC.Core.TyCo.Subst.html#substTy"><span class="hs-identifier hs-var">substTy</span></a></span><span> </span><span class="annot"><span class="annottext">Subst
</span><a href="#local-6989586621683014618"><span class="hs-identifier hs-var">subst</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TcTyVar -&gt; TcType
</span><a href="GHC.Types.Var.html#tyVarKind"><span class="hs-identifier hs-var">tyVarKind</span></a></span><span> </span><span class="annot"><span class="annottext">TcTyVar
</span><a href="#local-6989586621683014619"><span class="hs-identifier hs-var">tv</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1066"></span><span>
</span><span id="line-1067"></span><span class="annot"><a href="GHC.Tc.Utils.TcMType.html#newMetaTyVarTyAtLevel"><span class="hs-identifier hs-type">newMetaTyVarTyAtLevel</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.TcType.html#TcLevel"><span class="hs-identifier hs-type">TcLevel</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.TcType.html#TcKind"><span class="hs-identifier hs-type">TcKind</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#TcM"><span class="hs-identifier hs-type">TcM</span></a></span><span> </span><span class="annot"><a href="GHC.Tc.Utils.TcType.html#TcType"><span class="hs-identifier hs-type">TcType</span></a></span><span>
</span><span id="line-1068"></span><span id="newMetaTyVarTyAtLevel"><span class="annot"><span class="annottext">newMetaTyVarTyAtLevel :: TcLevel -&gt; TcType -&gt; TcM TcType
</span><a href="GHC.Tc.Utils.TcMType.html#newMetaTyVarTyAtLevel"><span class="hs-identifier hs-var hs-var">newMetaTyVarTyAtLevel</span></a></span></span><span> </span><span id="local-6989586621683014623"><span class="annot"><span class="annottext">TcLevel
</span><a href="#local-6989586621683014623"><span class="hs-identifier hs-var">tc_lvl</span></a></span></span><span> </span><span id="local-6989586621683014624"><span class="annot"><span class="annottext">TcType
</span><a href="#local-6989586621683014624"><span class="hs-identifier hs-var">kind</span></a></span></span><span>
</span><span id="line-1069"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>  </span><span class="hs-special">{</span><span> </span><span id="local-6989586621683014625"><span class="annot"><a href="#local-6989586621683014625"><span class="hs-identifier hs-var">details</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">TcLevel -&gt; TcM TcTyVarDetails
</span><a href="GHC.Tc.Utils.TcMType.html#newTauTvDetailsAtLevel"><span class="hs-identifier hs-var">newTauTvDetailsAtLevel</span></a></span><span> </span><span class="annot"><span class="annottext">TcLevel
</span><a href="#local-6989586621683014623"><span class="hs-identifier hs-var">tc_lvl</span></a></span><span>
</span><span id="line-1070"></span><span>        </span><span class="hs-special">;</span><span> </span><span id="local-6989586621683014626"><span class="annot"><a href="#local-6989586621683014626"><span class="hs-identifier hs-var">name</span></a></span></span><span>    </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.TcMType.html#newMetaTyVarName"><span class="hs-identifier hs-type">newMetaTyVarName</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Data.FastString.html#fsLit"><span class="hs-identifier hs-type">fsLit</span></a></span><span> </span><span class="annot"><span class="hs-string">&quot;p&quot;</span></span><span class="hs-special">)</span><span>
</span><span id="line-1071"></span><span>        </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">return</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#mkTyVarTy"><span class="hs-identifier hs-type">mkTyVarTy</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Types.Var.html#mkTcTyVar"><span class="hs-identifier hs-type">mkTcTyVar</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683014626"><span class="hs-identifier hs-type">name</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683014624"><span class="hs-identifier hs-type">kind</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683014625"><span class="hs-identifier hs-type">details</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-1072"></span><span>
</span><span id="line-1073"></span><span class="annot"><a href="GHC.Tc.Utils.TcMType.html#newConcreteTyVarTyAtLevel"><span class="hs-identifier hs-type">newConcreteTyVarTyAtLevel</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.TcType.html#ConcreteTvOrigin"><span class="hs-identifier hs-type">ConcreteTvOrigin</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.TcType.html#TcLevel"><span class="hs-identifier hs-type">TcLevel</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.TcType.html#TcKind"><span class="hs-identifier hs-type">TcKind</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#TcM"><span class="hs-identifier hs-type">TcM</span></a></span><span> </span><span class="annot"><a href="GHC.Tc.Utils.TcType.html#TcType"><span class="hs-identifier hs-type">TcType</span></a></span><span>
</span><span id="line-1074"></span><span id="newConcreteTyVarTyAtLevel"><span class="annot"><span class="annottext">newConcreteTyVarTyAtLevel :: ConcreteTvOrigin -&gt; TcLevel -&gt; TcType -&gt; TcM TcType
</span><a href="GHC.Tc.Utils.TcMType.html#newConcreteTyVarTyAtLevel"><span class="hs-identifier hs-var hs-var">newConcreteTyVarTyAtLevel</span></a></span></span><span> </span><span id="local-6989586621683014627"><span class="annot"><span class="annottext">ConcreteTvOrigin
</span><a href="#local-6989586621683014627"><span class="hs-identifier hs-var">conc_orig</span></a></span></span><span> </span><span id="local-6989586621683014628"><span class="annot"><span class="annottext">TcLevel
</span><a href="#local-6989586621683014628"><span class="hs-identifier hs-var">tc_lvl</span></a></span></span><span> </span><span id="local-6989586621683014629"><span class="annot"><span class="annottext">TcType
</span><a href="#local-6989586621683014629"><span class="hs-identifier hs-var">kind</span></a></span></span><span>
</span><span id="line-1075"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>  </span><span class="hs-special">{</span><span> </span><span id="local-6989586621683014630"><span class="annot"><a href="#local-6989586621683014630"><span class="hs-identifier hs-var">details</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">ConcreteTvOrigin -&gt; TcLevel -&gt; TcM TcTyVarDetails
</span><a href="GHC.Tc.Utils.TcMType.html#newConcreteTvDetailsAtLevel"><span class="hs-identifier hs-var">newConcreteTvDetailsAtLevel</span></a></span><span> </span><span class="annot"><span class="annottext">ConcreteTvOrigin
</span><a href="#local-6989586621683014627"><span class="hs-identifier hs-var">conc_orig</span></a></span><span> </span><span class="annot"><span class="annottext">TcLevel
</span><a href="#local-6989586621683014628"><span class="hs-identifier hs-var">tc_lvl</span></a></span><span>
</span><span id="line-1076"></span><span>        </span><span class="hs-special">;</span><span> </span><span id="local-6989586621683014631"><span class="annot"><a href="#local-6989586621683014631"><span class="hs-identifier hs-var">name</span></a></span></span><span>    </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.TcMType.html#newMetaTyVarName"><span class="hs-identifier hs-type">newMetaTyVarName</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Data.FastString.html#fsLit"><span class="hs-identifier hs-type">fsLit</span></a></span><span> </span><span class="annot"><span class="hs-string">&quot;c&quot;</span></span><span class="hs-special">)</span><span>
</span><span id="line-1077"></span><span>        </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">return</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#mkTyVarTy"><span class="hs-identifier hs-type">mkTyVarTy</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Types.Var.html#mkTcTyVar"><span class="hs-identifier hs-type">mkTcTyVar</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683014631"><span class="hs-identifier hs-type">name</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683014629"><span class="hs-identifier hs-type">kind</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683014630"><span class="hs-identifier hs-type">details</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-1078"></span><span>
</span><span id="line-1079"></span><span class="hs-comment">{- Note [substConcreteTvOrigin]
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
To report helpful representation-polymorphism errors to the users, we want to
indicate which type caused the error, instead of simply printing kinds.
For example, in

  coerce :: forall {r} (a :: TYPE r) (b :: TYPE r). Coercible a b =&gt; a -&gt; b

  bad :: forall {s} (z :: TYPE s). z -&gt; z
  bad = coerce

we want the error message to say (with additional debug info on type variables
for clarity of this explanation):

  The first argument of 'coerce' does not have a fixed runtime representation.
  Its type is:
    a0[tau] :: TYPE r0[conc]
  Could not unify s[sk] with r0[conc] because the former is not a concrete
  RuntimeRep.

This is more informative than just saying that we could not unify s[sk] with
r0[conc]; it's helpful to users to phrase it in terms of types rather than kinds
whenever possible (especially as the kind variables often have inferred Specificity).

To achieve this, we store the type on which the representation-polymorphism
check is being performed, in the field frr_type of FixedRuntimeRepOrigin.
This is all described in Note [Reporting representation-polymorphism errors] in
GHC.Tc.Types.Origin.

However, we have to be careful in the example above, in which we are
instantiating a built-in representation-polymorphic 'Id'. As described in the
Note [Representation-polymorphism checking built-ins] in GHC.Tc.Utils.Concrete, in such
cases we end up storing types appearing in the original type of the primop,
which means for the situation above with 'coerce' we end up with a ConcreteTvOrigin
which includes type variables bound in the original type of 'coerce':

  FixedRuntimeRepOrigin
    { frr_type = a[tv] :: TYPE r[tv]
    , frr_context = &quot;first argument of coerce&quot; }

When we instantiate 'coerce' in the previous example, we obtain a substitution

  [ r[tv] |-&gt; r0[conc], a |-&gt; a0 :: TYPE r0[conc] ]

which we need to apply to the 'frr_type' field in order for the type variables
in the error message to match up.
This is done by the call to 'substConcreteTvOrigin' in 'instantiateSigma'.

Wrinkle [Extending the substitution]

  In certain cases, we need to extend the substitution we get from 'instantiateSigma'.
  For example, suppose we have:

    bad2 :: forall {s} (z :: TYPE s). z -&gt; z
    bad2 = coerce @z

  Then 'instantiateSigma' will only instantiate the inferred type variable 'r'
  of 'coerce', as it needs to leave 'a' un-instantiated so that the visible
  type application '@z' makes sense. In this case, we end up with a substitution

    subst:                   [ r[tv] |-&gt; r0[conc] ]
    body_ty:                forall (a :: TYPE r[tv]) (b :: TYPE r[tv]). ...
    substTy subst body_ty:  forall (a' :: TYPE r0[conc]) (b' :: TYPE r0[conc]). ...

  Now, we still want a substitution that maps (a :: TYPE r[tv]) to
  (a' :: TYPE r0[conc]) in order to apply it to the 'frr_type', so that we don't
  mention the un-substed (a :: TYPE r[tv]) in the error message.
  To achieve this, we extend the substitution with the outermost quantified type
  variables in the leftover (partially-instantiated) type using 'substTyVarBndrs'
  to get the full substitution which we use in 'substConcreteTvOrigin'.
-}</span><span>
</span><span id="line-1150"></span><span>
</span><span id="line-1151"></span><span class="annot"><a href="GHC.Tc.Utils.TcMType.html#substConcreteTvOrigin"><span class="hs-identifier hs-type">substConcreteTvOrigin</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Core.TyCo.Subst.html#Subst"><span class="hs-identifier hs-type">Subst</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#Type"><span class="hs-identifier hs-type">Type</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.TcType.html#ConcreteTvOrigin"><span class="hs-identifier hs-type">ConcreteTvOrigin</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.TcType.html#ConcreteTvOrigin"><span class="hs-identifier hs-type">ConcreteTvOrigin</span></a></span><span>
</span><span id="line-1152"></span><span id="substConcreteTvOrigin"><span class="annot"><span class="annottext">substConcreteTvOrigin :: Subst -&gt; TcType -&gt; ConcreteTvOrigin -&gt; ConcreteTvOrigin
</span><a href="GHC.Tc.Utils.TcMType.html#substConcreteTvOrigin"><span class="hs-identifier hs-var hs-var">substConcreteTvOrigin</span></a></span></span><span> </span><span id="local-6989586621683014632"><span class="annot"><span class="annottext">Subst
</span><a href="#local-6989586621683014632"><span class="hs-identifier hs-var">subst</span></a></span></span><span> </span><span id="local-6989586621683014633"><span class="annot"><span class="annottext">TcType
</span><a href="#local-6989586621683014633"><span class="hs-identifier hs-var">body_ty</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Tc.Utils.TcType.html#ConcreteFRR"><span class="hs-identifier hs-type">ConcreteFRR</span></a></span><span> </span><span id="local-6989586621683014634"><span class="annot"><span class="annottext">FixedRuntimeRepOrigin
</span><a href="#local-6989586621683014634"><span class="hs-identifier hs-var">frr_orig</span></a></span></span><span class="hs-special">)</span><span>
</span><span id="line-1153"></span><span>  </span><span class="hs-comment">-- See Note [substConcreteTvOrigin], Wrinkle [Extending the substitution]</span><span>
</span><span id="line-1154"></span><span>  </span><span class="hs-comment">-- for the justification of this extra complication.</span><span>
</span><span id="line-1155"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621683014635"><span class="annot"><span class="annottext">subst' :: Subst
</span><a href="#local-6989586621683014635"><span class="hs-identifier hs-var hs-var">subst'</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">TcType -&gt; ([TcTyVar], TcType)
</span><a href="GHC.Core.Type.html#splitForAllTyCoVars"><span class="hs-identifier hs-var">splitForAllTyCoVars</span></a></span><span> </span><span class="annot"><span class="annottext">TcType
</span><a href="#local-6989586621683014633"><span class="hs-identifier hs-var">body_ty</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-1156"></span><span>                   </span><span class="hs-special">(</span><span class="hs-special">[</span><span class="hs-special">]</span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">TcType
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Subst
</span><a href="#local-6989586621683014632"><span class="hs-identifier hs-var">subst</span></a></span><span>
</span><span id="line-1157"></span><span>                   </span><span class="hs-special">(</span><span id="local-6989586621683014637"><span class="annot"><span class="annottext">[TcTyVar]
</span><a href="#local-6989586621683014637"><span class="hs-identifier hs-var">bndrs</span></a></span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">TcType
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">(Subst, [TcTyVar]) -&gt; Subst
forall a b. (a, b) -&gt; a
</span><span class="hs-identifier hs-var">fst</span></span><span> </span><span class="annot"><span class="annottext">((Subst, [TcTyVar]) -&gt; Subst) -&gt; (Subst, [TcTyVar]) -&gt; Subst
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">HasDebugCallStack =&gt; Subst -&gt; [TcTyVar] -&gt; (Subst, [TcTyVar])
Subst -&gt; [TcTyVar] -&gt; (Subst, [TcTyVar])
</span><a href="GHC.Core.TyCo.Subst.html#substTyVarBndrs"><span class="hs-identifier hs-var">substTyVarBndrs</span></a></span><span> </span><span class="annot"><span class="annottext">Subst
</span><a href="#local-6989586621683014632"><span class="hs-identifier hs-var">subst</span></a></span><span> </span><span class="annot"><span class="annottext">[TcTyVar]
</span><a href="#local-6989586621683014637"><span class="hs-identifier hs-var">bndrs</span></a></span><span>
</span><span id="line-1158"></span><span>    </span><span class="hs-keyword">in</span><span> </span><span class="annot"><span class="annottext">FixedRuntimeRepOrigin -&gt; ConcreteTvOrigin
</span><a href="GHC.Tc.Utils.TcType.html#ConcreteFRR"><span class="hs-identifier hs-var">ConcreteFRR</span></a></span><span> </span><span class="annot"><span class="annottext">(FixedRuntimeRepOrigin -&gt; ConcreteTvOrigin)
-&gt; FixedRuntimeRepOrigin -&gt; ConcreteTvOrigin
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Subst -&gt; FixedRuntimeRepOrigin -&gt; FixedRuntimeRepOrigin
</span><a href="GHC.Tc.Utils.TcMType.html#substFRROrigin"><span class="hs-identifier hs-var">substFRROrigin</span></a></span><span> </span><span class="annot"><span class="annottext">Subst
</span><a href="#local-6989586621683014635"><span class="hs-identifier hs-var">subst'</span></a></span><span> </span><span class="annot"><span class="annottext">FixedRuntimeRepOrigin
</span><a href="#local-6989586621683014634"><span class="hs-identifier hs-var">frr_orig</span></a></span><span>
</span><span id="line-1159"></span><span>
</span><span id="line-1160"></span><span class="annot"><a href="GHC.Tc.Utils.TcMType.html#substFRROrigin"><span class="hs-identifier hs-type">substFRROrigin</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Core.TyCo.Subst.html#Subst"><span class="hs-identifier hs-type">Subst</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.Origin.html#FixedRuntimeRepOrigin"><span class="hs-identifier hs-type">FixedRuntimeRepOrigin</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.Origin.html#FixedRuntimeRepOrigin"><span class="hs-identifier hs-type">FixedRuntimeRepOrigin</span></a></span><span>
</span><span id="line-1161"></span><span id="substFRROrigin"><span class="annot"><span class="annottext">substFRROrigin :: Subst -&gt; FixedRuntimeRepOrigin -&gt; FixedRuntimeRepOrigin
</span><a href="GHC.Tc.Utils.TcMType.html#substFRROrigin"><span class="hs-identifier hs-var hs-var">substFRROrigin</span></a></span></span><span> </span><span id="local-6989586621683014641"><span class="annot"><span class="annottext">Subst
</span><a href="#local-6989586621683014641"><span class="hs-identifier hs-var">subst</span></a></span></span><span> </span><span id="local-6989586621683014642"><span class="annot"><span class="annottext">orig :: FixedRuntimeRepOrigin
</span><a href="#local-6989586621683014642"><span class="hs-identifier hs-var">orig</span></a></span></span><span class="hs-glyph">@</span><span class="hs-special">(</span><span class="annot"><a href="GHC.Tc.Types.Origin.html#FixedRuntimeRepOrigin"><span class="hs-identifier hs-type">FixedRuntimeRepOrigin</span></a></span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">frr_type :: FixedRuntimeRepOrigin -&gt; TcType
</span><a href="GHC.Tc.Types.Origin.html#frr_type"><span class="hs-identifier hs-var">frr_type</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="local-6989586621683014643"><span class="annot"><span class="annottext">TcType
</span><a href="#local-6989586621683014643"><span class="hs-identifier hs-var">ty</span></a></span></span><span> </span><span class="hs-special">}</span><span class="hs-special">)</span><span>
</span><span id="line-1162"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">FixedRuntimeRepOrigin
</span><a href="#local-6989586621683014642"><span class="hs-identifier hs-var">orig</span></a></span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><a href="GHC.Tc.Types.Origin.html#frr_type"><span class="hs-identifier hs-var">frr_type</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="GHC.Core.TyCo.Subst.html#substTy"><span class="hs-identifier hs-type">substTy</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683014641"><span class="hs-identifier hs-type">subst</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683014643"><span class="hs-identifier hs-type">ty</span></a></span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-1163"></span><span>
</span><span id="line-1164"></span><span class="annot"><span class="hs-comment">{- *********************************************************************
*                                                                      *
          Finding variables to quantify over
*                                                                      *
********************************************************************* -}</span></span><span>
</span><span id="line-1169"></span><span>
</span><span id="line-1170"></span><span class="hs-comment">{- Note [Dependent type variables]
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
In Haskell type inference we quantify over type variables; but we only
quantify over /kind/ variables when -XPolyKinds is on.  Without -XPolyKinds
we default the kind variables to *.

So, to support this defaulting, and only for that reason, when
collecting the free vars of a type (in candidateQTyVarsOfType and friends),
prior to quantifying, we must keep the type and kind variables separate.

But what does that mean in a system where kind variables /are/ type
variables? It's a fairly arbitrary distinction based on how the
variables appear:

  - &quot;Kind variables&quot; appear in the kind of some other free variable
    or in the kind of a locally quantified type variable
    (forall (a :: kappa). ...) or in the kind of a coercion
    (a |&gt; (co :: kappa1 ~ kappa2)).

     These are the ones we default to * if -XPolyKinds is off

  - &quot;Type variables&quot; are all free vars that are not kind variables

E.g.  In the type    T k (a::k)
      'k' is a kind variable, because it occurs in the kind of 'a',
          even though it also appears at &quot;top level&quot; of the type
      'a' is a type variable, because it doesn't

We gather these variables using a CandidatesQTvs record:
  DV { dv_kvs: Variables free in the kind of a free type variable
               or of a forall-bound type variable
     , dv_tvs: Variables syntactically free in the type }

So:  dv_kvs            are the kind variables of the type
     (dv_tvs - dv_kvs) are the type variable of the type

Note that

* A variable can occur in both.
      T k (x::k)    The first occurrence of k makes it
                    show up in dv_tvs, the second in dv_kvs

* We include any coercion variables in the &quot;dependent&quot;,
  &quot;kind-variable&quot; set because we never quantify over them.

* The &quot;kind variables&quot; might depend on each other; e.g
     (k1 :: k2), (k2 :: *)
  The &quot;type variables&quot; do not depend on each other; if
  one did, it'd be classified as a kind variable!

Note [CandidatesQTvs determinism and order]
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
* Determinism: when we quantify over type variables we decide the
  order in which they appear in the final type. Because the order of
  type variables in the type can end up in the interface file and
  affects some optimizations like worker-wrapper, we want this order to
  be deterministic.

  To achieve that we use deterministic sets of variables that can be
  converted to lists in a deterministic order. For more information
  about deterministic sets see Note [Deterministic UniqFM] in GHC.Types.Unique.DFM.

* Order: as well as being deterministic, we use an
  accumulating-parameter style for candidateQTyVarsOfType so that we
  add variables one at a time, left to right.  That means we tend to
  produce the variables in left-to-right order.  This is just to make
  it bit more predictable for the programmer.

Note [Naughty quantification candidates]
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
Consider (#14880, dependent/should_compile/T14880-2), suppose
we are trying to generalise this type:

  forall arg. ... (alpha[tau]:arg) ...

We have a metavariable alpha whose kind mentions a skolem variable
bound inside the very type we are generalising.
This can arise while type-checking a user-written type signature
(see the test case for the full code).

We cannot generalise over alpha!  That would produce a type like
  forall {a :: arg}. forall arg. ...blah...
The fact that alpha's kind mentions arg renders it completely
ineligible for generalisation.

However, we are not going to learn any new constraints on alpha,
because its kind isn't even in scope in the outer context (but see Wrinkle).
So alpha is entirely unconstrained.

What then should we do with alpha?  During generalization, every
metavariable is either (A) promoted, (B) generalized, or (C) zapped
(according to Note [Recipe for checking a signature] in GHC.Tc.Gen.HsType).

 * We can't generalise it.
 * We can't promote it, because its kind prevents that
 * We can't simply leave it be, because this type is about to
   go into the typing environment (as the type of some let-bound
   variable, say), and then chaos erupts when we try to instantiate.

Previously, we zapped it to Any. This worked, but it had the unfortunate
effect of causing Any sometimes to appear in error messages. If this
kind of signature happens, the user probably has made a mistake -- no
one really wants Any in their types. So we now error. This must be
a hard error (failure in the monad) to avoid other messages from mentioning
Any.

We do this eager erroring in candidateQTyVars, which always precedes
generalisation, because at that moment we have a clear picture of what
skolems are in scope within the type itself (e.g. that 'forall arg').

This change is inspired by and described in Section 7.2 of &quot;Kind Inference
for Datatypes&quot;, POPL'20.

NB: this is all rather similar to, but sadly not the same as
    Note [Error on unconstrained meta-variables]

Wrinkle:

We must make absolutely sure that alpha indeed is not from an outer
context. (Otherwise, we might indeed learn more information about it.)
This can be done easily: we just check alpha's TcLevel.  That level
must be strictly greater than the ambient TcLevel in order to treat it
as naughty. We say &quot;strictly greater than&quot; because the call to
candidateQTyVars is made outside the bumped TcLevel, as stated in the
comment to candidateQTyVarsOfType. The level check is done in go_tv in
collect_cand_qtvs. Skipping this check caused #16517.

-}</span><span>
</span><span id="line-1298"></span><span>
</span><span id="line-1299"></span><span class="hs-keyword">data</span><span> </span><span id="CandidatesQTvs"><span class="annot"><a href="GHC.Tc.Utils.TcMType.html#CandidatesQTvs"><span class="hs-identifier hs-var">CandidatesQTvs</span></a></span></span><span>
</span><span id="line-1300"></span><span>  </span><span class="hs-comment">-- See Note [Dependent type variables]</span><span>
</span><span id="line-1301"></span><span>  </span><span class="hs-comment">-- See Note [CandidatesQTvs determinism and order]</span><span>
</span><span id="line-1302"></span><span>  </span><span class="hs-comment">--</span><span>
</span><span id="line-1303"></span><span>  </span><span class="hs-comment">-- Invariants:</span><span>
</span><span id="line-1304"></span><span>  </span><span class="hs-comment">--   * All variables are fully zonked, including their kinds</span><span>
</span><span id="line-1305"></span><span>  </span><span class="hs-comment">--   * All variables are at a level greater than the ambient level</span><span>
</span><span id="line-1306"></span><span>  </span><span class="hs-comment">--     See Note [Use level numbers for quantification]</span><span>
</span><span id="line-1307"></span><span>  </span><span class="hs-comment">--</span><span>
</span><span id="line-1308"></span><span>  </span><span class="hs-comment">-- This *can* contain skolems. For example, in `data X k :: k -&gt; Type`</span><span>
</span><span id="line-1309"></span><span>  </span><span class="hs-comment">-- we need to know that the k is a dependent variable. This is done</span><span>
</span><span id="line-1310"></span><span>  </span><span class="hs-comment">-- by collecting the candidates in the kind after skolemising. It also</span><span>
</span><span id="line-1311"></span><span>  </span><span class="hs-comment">-- comes up when generalizing a associated type instance, where instance</span><span>
</span><span id="line-1312"></span><span>  </span><span class="hs-comment">-- variables are skolems. (Recall that associated type instances are generalized</span><span>
</span><span id="line-1313"></span><span>  </span><span class="hs-comment">-- independently from their enclosing class instance, and the associated</span><span>
</span><span id="line-1314"></span><span>  </span><span class="hs-comment">-- type instance may be generalized by more, fewer, or different variables</span><span>
</span><span id="line-1315"></span><span>  </span><span class="hs-comment">-- than the class instance.)</span><span>
</span><span id="line-1316"></span><span>  </span><span class="hs-comment">--</span><span>
</span><span id="line-1317"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span id="DV"><span class="annot"><a href="GHC.Tc.Utils.TcMType.html#DV"><span class="hs-identifier hs-var">DV</span></a></span></span><span> </span><span class="hs-special">{</span><span> </span><span id="dv_kvs"><span class="annot"><span class="annottext">CandidatesQTvs -&gt; DTyVarSet
</span><a href="GHC.Tc.Utils.TcMType.html#dv_kvs"><span class="hs-identifier hs-var hs-var">dv_kvs</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Types.Var.Set.html#DTyVarSet"><span class="hs-identifier hs-type">DTyVarSet</span></a></span><span>    </span><span class="hs-comment">-- &quot;kind&quot; metavariables (dependent)</span><span>
</span><span id="line-1318"></span><span>       </span><span class="hs-special">,</span><span> </span><span id="dv_tvs"><span class="annot"><span class="annottext">CandidatesQTvs -&gt; DTyVarSet
</span><a href="GHC.Tc.Utils.TcMType.html#dv_tvs"><span class="hs-identifier hs-var hs-var">dv_tvs</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Types.Var.Set.html#DTyVarSet"><span class="hs-identifier hs-type">DTyVarSet</span></a></span><span>    </span><span class="hs-comment">-- &quot;type&quot; metavariables (non-dependent)</span><span>
</span><span id="line-1319"></span><span>         </span><span class="hs-comment">-- A variable may appear in both sets</span><span>
</span><span id="line-1320"></span><span>         </span><span class="hs-comment">-- E.g.   T k (x::k)    The first occurrence of k makes it</span><span>
</span><span id="line-1321"></span><span>         </span><span class="hs-comment">--                      show up in dv_tvs, the second in dv_kvs</span><span>
</span><span id="line-1322"></span><span>         </span><span class="hs-comment">-- See Note [Dependent type variables]</span><span>
</span><span id="line-1323"></span><span>
</span><span id="line-1324"></span><span>       </span><span class="hs-special">,</span><span> </span><span id="dv_cvs"><span class="annot"><span class="annottext">CandidatesQTvs -&gt; CoVarSet
</span><a href="GHC.Tc.Utils.TcMType.html#dv_cvs"><span class="hs-identifier hs-var hs-var">dv_cvs</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Types.Var.Set.html#CoVarSet"><span class="hs-identifier hs-type">CoVarSet</span></a></span><span>
</span><span id="line-1325"></span><span>         </span><span class="hs-comment">-- These are covars. Included only so that we don't repeatedly</span><span>
</span><span id="line-1326"></span><span>         </span><span class="hs-comment">-- look at covars' kinds in accumulator. Not used by quantifyTyVars.</span><span>
</span><span id="line-1327"></span><span>    </span><span class="hs-special">}</span><span>
</span><span id="line-1328"></span><span>
</span><span id="line-1329"></span><span class="hs-keyword">instance</span><span> </span><span id="local-6989586621683014650"><span id="local-6989586621683014654"><span class="annot"><span class="hs-identifier hs-type">Semi.Semigroup</span></span><span> </span><span class="annot"><a href="GHC.Tc.Utils.TcMType.html#CandidatesQTvs"><span class="hs-identifier hs-type">CandidatesQTvs</span></a></span></span></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-1330"></span><span>   </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Tc.Utils.TcMType.html#DV"><span class="hs-identifier hs-type">DV</span></a></span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">dv_kvs :: CandidatesQTvs -&gt; DTyVarSet
</span><a href="GHC.Tc.Utils.TcMType.html#dv_kvs"><span class="hs-identifier hs-var">dv_kvs</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="local-6989586621683014659"><span class="annot"><span class="annottext">DTyVarSet
</span><a href="#local-6989586621683014659"><span class="hs-identifier hs-var">kv1</span></a></span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">dv_tvs :: CandidatesQTvs -&gt; DTyVarSet
</span><a href="GHC.Tc.Utils.TcMType.html#dv_tvs"><span class="hs-identifier hs-var">dv_tvs</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="local-6989586621683014660"><span class="annot"><span class="annottext">DTyVarSet
</span><a href="#local-6989586621683014660"><span class="hs-identifier hs-var">tv1</span></a></span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">dv_cvs :: CandidatesQTvs -&gt; CoVarSet
</span><a href="GHC.Tc.Utils.TcMType.html#dv_cvs"><span class="hs-identifier hs-var">dv_cvs</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="local-6989586621683014661"><span class="annot"><span class="annottext">CoVarSet
</span><a href="#local-6989586621683014661"><span class="hs-identifier hs-var">cv1</span></a></span></span><span> </span><span class="hs-special">}</span><span class="hs-special">)</span><span>
</span><span id="line-1331"></span><span>     </span><span id="local-6989586621683014662"><span class="annot"><span class="annottext">&lt;&gt; :: CandidatesQTvs -&gt; CandidatesQTvs -&gt; CandidatesQTvs
</span><span class="hs-operator hs-var hs-var hs-var">&lt;&gt;</span></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Tc.Utils.TcMType.html#DV"><span class="hs-identifier hs-type">DV</span></a></span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">dv_kvs :: CandidatesQTvs -&gt; DTyVarSet
</span><a href="GHC.Tc.Utils.TcMType.html#dv_kvs"><span class="hs-identifier hs-var">dv_kvs</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="local-6989586621683014663"><span class="annot"><span class="annottext">DTyVarSet
</span><a href="#local-6989586621683014663"><span class="hs-identifier hs-var">kv2</span></a></span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">dv_tvs :: CandidatesQTvs -&gt; DTyVarSet
</span><a href="GHC.Tc.Utils.TcMType.html#dv_tvs"><span class="hs-identifier hs-var">dv_tvs</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="local-6989586621683014664"><span class="annot"><span class="annottext">DTyVarSet
</span><a href="#local-6989586621683014664"><span class="hs-identifier hs-var">tv2</span></a></span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">dv_cvs :: CandidatesQTvs -&gt; CoVarSet
</span><a href="GHC.Tc.Utils.TcMType.html#dv_cvs"><span class="hs-identifier hs-var">dv_cvs</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="local-6989586621683014665"><span class="annot"><span class="annottext">CoVarSet
</span><a href="#local-6989586621683014665"><span class="hs-identifier hs-var">cv2</span></a></span></span><span> </span><span class="hs-special">}</span><span class="hs-special">)</span><span>
</span><span id="line-1332"></span><span>          </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.TcMType.html#DV"><span class="hs-identifier hs-type">DV</span></a></span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">dv_kvs :: DTyVarSet
</span><a href="GHC.Tc.Utils.TcMType.html#dv_kvs"><span class="hs-identifier hs-var">dv_kvs</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">DTyVarSet
</span><a href="#local-6989586621683014659"><span class="hs-identifier hs-var">kv1</span></a></span><span> </span><span class="annot"><span class="annottext">DTyVarSet -&gt; DTyVarSet -&gt; DTyVarSet
</span><a href="GHC.Types.Var.Set.html#unionDVarSet"><span class="hs-operator hs-var">`unionDVarSet`</span></a></span><span> </span><span class="annot"><span class="annottext">DTyVarSet
</span><a href="#local-6989586621683014663"><span class="hs-identifier hs-var">kv2</span></a></span><span>
</span><span id="line-1333"></span><span>               </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">dv_tvs :: DTyVarSet
</span><a href="GHC.Tc.Utils.TcMType.html#dv_tvs"><span class="hs-identifier hs-var">dv_tvs</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">DTyVarSet
</span><a href="#local-6989586621683014660"><span class="hs-identifier hs-var">tv1</span></a></span><span> </span><span class="annot"><span class="annottext">DTyVarSet -&gt; DTyVarSet -&gt; DTyVarSet
</span><a href="GHC.Types.Var.Set.html#unionDVarSet"><span class="hs-operator hs-var">`unionDVarSet`</span></a></span><span> </span><span class="annot"><span class="annottext">DTyVarSet
</span><a href="#local-6989586621683014664"><span class="hs-identifier hs-var">tv2</span></a></span><span>
</span><span id="line-1334"></span><span>               </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">dv_cvs :: CoVarSet
</span><a href="GHC.Tc.Utils.TcMType.html#dv_cvs"><span class="hs-identifier hs-var">dv_cvs</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">CoVarSet
</span><a href="#local-6989586621683014661"><span class="hs-identifier hs-var">cv1</span></a></span><span> </span><span class="annot"><span class="annottext">CoVarSet -&gt; CoVarSet -&gt; CoVarSet
</span><a href="GHC.Types.Var.Set.html#unionVarSet"><span class="hs-operator hs-var">`unionVarSet`</span></a></span><span> </span><span class="annot"><span class="annottext">CoVarSet
</span><a href="#local-6989586621683014665"><span class="hs-identifier hs-var">cv2</span></a></span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-1335"></span><span>
</span><span id="line-1336"></span><span class="hs-keyword">instance</span><span> </span><span id="local-6989586621683014673"><span class="annot"><span class="hs-identifier hs-type">Monoid</span></span><span> </span><span class="annot"><a href="GHC.Tc.Utils.TcMType.html#CandidatesQTvs"><span class="hs-identifier hs-type">CandidatesQTvs</span></a></span></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-1337"></span><span>   </span><span id="local-6989586621683014676"><span class="annot"><span class="annottext">mempty :: CandidatesQTvs
</span><span class="hs-identifier hs-var hs-var hs-var">mempty</span></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.TcMType.html#DV"><span class="hs-identifier hs-type">DV</span></a></span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">dv_kvs :: DTyVarSet
</span><a href="GHC.Tc.Utils.TcMType.html#dv_kvs"><span class="hs-identifier hs-var">dv_kvs</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">DTyVarSet
</span><a href="GHC.Types.Var.Set.html#emptyDVarSet"><span class="hs-identifier hs-var">emptyDVarSet</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">dv_tvs :: DTyVarSet
</span><a href="GHC.Tc.Utils.TcMType.html#dv_tvs"><span class="hs-identifier hs-var">dv_tvs</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">DTyVarSet
</span><a href="GHC.Types.Var.Set.html#emptyDVarSet"><span class="hs-identifier hs-var">emptyDVarSet</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">dv_cvs :: CoVarSet
</span><a href="GHC.Tc.Utils.TcMType.html#dv_cvs"><span class="hs-identifier hs-var">dv_cvs</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">CoVarSet
</span><a href="GHC.Types.Var.Set.html#emptyVarSet"><span class="hs-identifier hs-var">emptyVarSet</span></a></span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-1338"></span><span>   </span><span id="local-6989586621683014680"><span class="annot"><span class="annottext">mappend :: CandidatesQTvs -&gt; CandidatesQTvs -&gt; CandidatesQTvs
</span><span class="hs-identifier hs-var hs-var hs-var">mappend</span></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">CandidatesQTvs -&gt; CandidatesQTvs -&gt; CandidatesQTvs
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">(Semi.&lt;&gt;)</span></span><span>
</span><span id="line-1339"></span><span>
</span><span id="line-1340"></span><span class="hs-keyword">instance</span><span> </span><span class="annot"><a href="GHC.Utils.Outputable.html#Outputable"><span class="hs-identifier hs-type">Outputable</span></a></span><span> </span><span class="annot"><a href="GHC.Tc.Utils.TcMType.html#CandidatesQTvs"><span class="hs-identifier hs-type">CandidatesQTvs</span></a></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-1341"></span><span>  </span><span id="local-6989586621683014697"><span class="annot"><span class="annottext">ppr :: CandidatesQTvs -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var hs-var hs-var">ppr</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Tc.Utils.TcMType.html#DV"><span class="hs-identifier hs-type">DV</span></a></span><span> </span><span class="hs-special">{</span><span class="annot"><span class="annottext">dv_kvs :: CandidatesQTvs -&gt; DTyVarSet
</span><a href="GHC.Tc.Utils.TcMType.html#dv_kvs"><span class="hs-identifier hs-var">dv_kvs</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="local-6989586621683014698"><span class="annot"><span class="annottext">DTyVarSet
</span><a href="#local-6989586621683014698"><span class="hs-identifier hs-var">kvs</span></a></span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">dv_tvs :: CandidatesQTvs -&gt; DTyVarSet
</span><a href="GHC.Tc.Utils.TcMType.html#dv_tvs"><span class="hs-identifier hs-var">dv_tvs</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="local-6989586621683014699"><span class="annot"><span class="annottext">DTyVarSet
</span><a href="#local-6989586621683014699"><span class="hs-identifier hs-var">tvs</span></a></span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">dv_cvs :: CandidatesQTvs -&gt; CoVarSet
</span><a href="GHC.Tc.Utils.TcMType.html#dv_cvs"><span class="hs-identifier hs-var">dv_cvs</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="local-6989586621683014700"><span class="annot"><span class="annottext">CoVarSet
</span><a href="#local-6989586621683014700"><span class="hs-identifier hs-var">cvs</span></a></span></span><span> </span><span class="hs-special">}</span><span class="hs-special">)</span><span>
</span><span id="line-1342"></span><span>    </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">String -&gt; SDoc
forall doc. IsLine doc =&gt; String -&gt; doc
</span><a href="GHC.Utils.Outputable.html#text"><span class="hs-identifier hs-var">text</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;DV&quot;</span></span><span> </span><span class="annot"><span class="annottext">SDoc -&gt; SDoc -&gt; SDoc
forall doc. IsLine doc =&gt; doc -&gt; doc -&gt; doc
</span><a href="GHC.Utils.Outputable.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">SDoc -&gt; SDoc
forall doc. IsLine doc =&gt; doc -&gt; doc
</span><a href="GHC.Utils.Outputable.html#braces"><span class="hs-identifier hs-var">braces</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(SDoc -&gt; SDoc) -&gt; [SDoc] -&gt; SDoc
forall a. (a -&gt; SDoc) -&gt; [a] -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#pprWithCommas"><span class="hs-identifier hs-var">pprWithCommas</span></a></span><span> </span><span class="annot"><span class="annottext">SDoc -&gt; SDoc
forall a. a -&gt; a
</span><span class="hs-identifier hs-var">id</span></span><span> </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">String -&gt; SDoc
forall doc. IsLine doc =&gt; String -&gt; doc
</span><a href="GHC.Utils.Outputable.html#text"><span class="hs-identifier hs-var">text</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;dv_kvs =&quot;</span></span><span> </span><span class="annot"><span class="annottext">SDoc -&gt; SDoc -&gt; SDoc
forall doc. IsLine doc =&gt; doc -&gt; doc -&gt; doc
</span><a href="GHC.Utils.Outputable.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">DTyVarSet -&gt; SDoc
forall a. Outputable a =&gt; a -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="annot"><span class="annottext">DTyVarSet
</span><a href="#local-6989586621683014698"><span class="hs-identifier hs-var">kvs</span></a></span><span>
</span><span id="line-1343"></span><span>                                             </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">String -&gt; SDoc
forall doc. IsLine doc =&gt; String -&gt; doc
</span><a href="GHC.Utils.Outputable.html#text"><span class="hs-identifier hs-var">text</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;dv_tvs =&quot;</span></span><span> </span><span class="annot"><span class="annottext">SDoc -&gt; SDoc -&gt; SDoc
forall doc. IsLine doc =&gt; doc -&gt; doc -&gt; doc
</span><a href="GHC.Utils.Outputable.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">DTyVarSet -&gt; SDoc
forall a. Outputable a =&gt; a -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="annot"><span class="annottext">DTyVarSet
</span><a href="#local-6989586621683014699"><span class="hs-identifier hs-var">tvs</span></a></span><span>
</span><span id="line-1344"></span><span>                                             </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">String -&gt; SDoc
forall doc. IsLine doc =&gt; String -&gt; doc
</span><a href="GHC.Utils.Outputable.html#text"><span class="hs-identifier hs-var">text</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;dv_cvs =&quot;</span></span><span> </span><span class="annot"><span class="annottext">SDoc -&gt; SDoc -&gt; SDoc
forall doc. IsLine doc =&gt; doc -&gt; doc -&gt; doc
</span><a href="GHC.Utils.Outputable.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">CoVarSet -&gt; SDoc
forall a. Outputable a =&gt; a -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="annot"><span class="annottext">CoVarSet
</span><a href="#local-6989586621683014700"><span class="hs-identifier hs-var">cvs</span></a></span><span> </span><span class="hs-special">]</span><span class="hs-special">)</span><span>
</span><span id="line-1345"></span><span>
</span><span id="line-1346"></span><span class="annot"><a href="GHC.Tc.Utils.TcMType.html#isEmptyCandidates"><span class="hs-identifier hs-type">isEmptyCandidates</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.TcMType.html#CandidatesQTvs"><span class="hs-identifier hs-type">CandidatesQTvs</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Bool</span></span><span>
</span><span id="line-1347"></span><span id="isEmptyCandidates"><span class="annot"><span class="annottext">isEmptyCandidates :: CandidatesQTvs -&gt; Bool
</span><a href="GHC.Tc.Utils.TcMType.html#isEmptyCandidates"><span class="hs-identifier hs-var hs-var">isEmptyCandidates</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Tc.Utils.TcMType.html#DV"><span class="hs-identifier hs-type">DV</span></a></span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">dv_kvs :: CandidatesQTvs -&gt; DTyVarSet
</span><a href="GHC.Tc.Utils.TcMType.html#dv_kvs"><span class="hs-identifier hs-var">dv_kvs</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="local-6989586621683014705"><span class="annot"><span class="annottext">DTyVarSet
</span><a href="#local-6989586621683014705"><span class="hs-identifier hs-var">kvs</span></a></span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">dv_tvs :: CandidatesQTvs -&gt; DTyVarSet
</span><a href="GHC.Tc.Utils.TcMType.html#dv_tvs"><span class="hs-identifier hs-var">dv_tvs</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="local-6989586621683014706"><span class="annot"><span class="annottext">DTyVarSet
</span><a href="#local-6989586621683014706"><span class="hs-identifier hs-var">tvs</span></a></span></span><span> </span><span class="hs-special">}</span><span class="hs-special">)</span><span>
</span><span id="line-1348"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">DTyVarSet -&gt; Bool
</span><a href="GHC.Types.Var.Set.html#isEmptyDVarSet"><span class="hs-identifier hs-var">isEmptyDVarSet</span></a></span><span> </span><span class="annot"><span class="annottext">DTyVarSet
</span><a href="#local-6989586621683014705"><span class="hs-identifier hs-var">kvs</span></a></span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Bool -&gt; Bool
</span><span class="hs-operator hs-var">&amp;&amp;</span></span><span> </span><span class="annot"><span class="annottext">DTyVarSet -&gt; Bool
</span><a href="GHC.Types.Var.Set.html#isEmptyDVarSet"><span class="hs-identifier hs-var">isEmptyDVarSet</span></a></span><span> </span><span class="annot"><span class="annottext">DTyVarSet
</span><a href="#local-6989586621683014706"><span class="hs-identifier hs-var">tvs</span></a></span><span>
</span><span id="line-1349"></span><span>
</span><span id="line-1350"></span><span class="hs-comment">-- | Extract out the kind vars (in order) and type vars (in order) from</span><span>
</span><span id="line-1351"></span><span class="hs-comment">-- a 'CandidatesQTvs'. The lists are guaranteed to be distinct. Keeping</span><span>
</span><span id="line-1352"></span><span class="hs-comment">-- the lists separate is important only in the -XNoPolyKinds case.</span><span>
</span><span id="line-1353"></span><span class="annot"><a href="GHC.Tc.Utils.TcMType.html#candidateVars"><span class="hs-identifier hs-type">candidateVars</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.TcMType.html#CandidatesQTvs"><span class="hs-identifier hs-type">CandidatesQTvs</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="hs-special">[</span><span class="annot"><a href="GHC.Types.Var.html#TcTyVar"><span class="hs-identifier hs-type">TcTyVar</span></a></span><span class="hs-special">]</span><span class="hs-special">,</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="GHC.Types.Var.html#TcTyVar"><span class="hs-identifier hs-type">TcTyVar</span></a></span><span class="hs-special">]</span><span class="hs-special">)</span><span>
</span><span id="line-1354"></span><span id="candidateVars"><span class="annot"><span class="annottext">candidateVars :: CandidatesQTvs -&gt; ([TcTyVar], [TcTyVar])
</span><a href="GHC.Tc.Utils.TcMType.html#candidateVars"><span class="hs-identifier hs-var hs-var">candidateVars</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Tc.Utils.TcMType.html#DV"><span class="hs-identifier hs-type">DV</span></a></span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">dv_kvs :: CandidatesQTvs -&gt; DTyVarSet
</span><a href="GHC.Tc.Utils.TcMType.html#dv_kvs"><span class="hs-identifier hs-var">dv_kvs</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="local-6989586621683014709"><span class="annot"><span class="annottext">DTyVarSet
</span><a href="#local-6989586621683014709"><span class="hs-identifier hs-var">dep_kv_set</span></a></span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">dv_tvs :: CandidatesQTvs -&gt; DTyVarSet
</span><a href="GHC.Tc.Utils.TcMType.html#dv_tvs"><span class="hs-identifier hs-var">dv_tvs</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="local-6989586621683014710"><span class="annot"><span class="annottext">DTyVarSet
</span><a href="#local-6989586621683014710"><span class="hs-identifier hs-var">nondep_tkv_set</span></a></span></span><span> </span><span class="hs-special">}</span><span class="hs-special">)</span><span>
</span><span id="line-1355"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[TcTyVar]
</span><a href="#local-6989586621683014711"><span class="hs-identifier hs-var">dep_kvs</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">[TcTyVar]
</span><a href="#local-6989586621683014712"><span class="hs-identifier hs-var">nondep_tvs</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1356"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-1357"></span><span>    </span><span id="local-6989586621683014711"><span class="annot"><span class="annottext">dep_kvs :: [TcTyVar]
</span><a href="#local-6989586621683014711"><span class="hs-identifier hs-var hs-var">dep_kvs</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[TcTyVar] -&gt; [TcTyVar]
</span><a href="GHC.Core.TyCo.FVs.html#scopedSort"><span class="hs-identifier hs-var">scopedSort</span></a></span><span> </span><span class="annot"><span class="annottext">([TcTyVar] -&gt; [TcTyVar]) -&gt; [TcTyVar] -&gt; [TcTyVar]
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">DTyVarSet -&gt; [TcTyVar]
</span><a href="GHC.Types.Var.Set.html#dVarSetElems"><span class="hs-identifier hs-var">dVarSetElems</span></a></span><span> </span><span class="annot"><span class="annottext">DTyVarSet
</span><a href="#local-6989586621683014709"><span class="hs-identifier hs-var">dep_kv_set</span></a></span><span>
</span><span id="line-1358"></span><span>      </span><span class="hs-comment">-- scopedSort: put the kind variables into</span><span>
</span><span id="line-1359"></span><span>      </span><span class="hs-comment">--    well-scoped order.</span><span>
</span><span id="line-1360"></span><span>      </span><span class="hs-comment">--    E.g.  [k, (a::k)] not the other way round</span><span>
</span><span id="line-1361"></span><span>
</span><span id="line-1362"></span><span>    </span><span id="local-6989586621683014712"><span class="annot"><span class="annottext">nondep_tvs :: [TcTyVar]
</span><a href="#local-6989586621683014712"><span class="hs-identifier hs-var hs-var">nondep_tvs</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">DTyVarSet -&gt; [TcTyVar]
</span><a href="GHC.Types.Var.Set.html#dVarSetElems"><span class="hs-identifier hs-var">dVarSetElems</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">DTyVarSet
</span><a href="#local-6989586621683014710"><span class="hs-identifier hs-var">nondep_tkv_set</span></a></span><span> </span><span class="annot"><span class="annottext">DTyVarSet -&gt; DTyVarSet -&gt; DTyVarSet
</span><a href="GHC.Types.Var.Set.html#minusDVarSet"><span class="hs-operator hs-var">`minusDVarSet`</span></a></span><span> </span><span class="annot"><span class="annottext">DTyVarSet
</span><a href="#local-6989586621683014709"><span class="hs-identifier hs-var">dep_kv_set</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1363"></span><span>      </span><span class="hs-comment">-- See Note [Dependent type variables]</span><span>
</span><span id="line-1364"></span><span>      </span><span class="hs-comment">-- The `minus` dep_tkvs removes any kind-level vars</span><span>
</span><span id="line-1365"></span><span>      </span><span class="hs-comment">--    e.g. T k (a::k)   Since k appear in a kind it'll</span><span>
</span><span id="line-1366"></span><span>      </span><span class="hs-comment">--    be in dv_kvs, and is dependent. So remove it from</span><span>
</span><span id="line-1367"></span><span>      </span><span class="hs-comment">--    dv_tvs which will also contain k</span><span>
</span><span id="line-1368"></span><span>      </span><span class="hs-comment">-- NB kinds of tvs are already zonked</span><span>
</span><span id="line-1369"></span><span>
</span><span id="line-1370"></span><span class="annot"><a href="GHC.Tc.Utils.TcMType.html#candidateKindVars"><span class="hs-identifier hs-type">candidateKindVars</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.TcMType.html#CandidatesQTvs"><span class="hs-identifier hs-type">CandidatesQTvs</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Types.Var.Set.html#TyVarSet"><span class="hs-identifier hs-type">TyVarSet</span></a></span><span>
</span><span id="line-1371"></span><span id="candidateKindVars"><span class="annot"><span class="annottext">candidateKindVars :: CandidatesQTvs -&gt; CoVarSet
</span><a href="GHC.Tc.Utils.TcMType.html#candidateKindVars"><span class="hs-identifier hs-var hs-var">candidateKindVars</span></a></span></span><span> </span><span id="local-6989586621683014717"><span class="annot"><span class="annottext">CandidatesQTvs
</span><a href="#local-6989586621683014717"><span class="hs-identifier hs-var">dvs</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">DTyVarSet -&gt; CoVarSet
</span><a href="GHC.Types.Var.Set.html#dVarSetToVarSet"><span class="hs-identifier hs-var">dVarSetToVarSet</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">CandidatesQTvs -&gt; DTyVarSet
</span><a href="GHC.Tc.Utils.TcMType.html#dv_kvs"><span class="hs-identifier hs-var">dv_kvs</span></a></span><span> </span><span class="annot"><span class="annottext">CandidatesQTvs
</span><a href="#local-6989586621683014717"><span class="hs-identifier hs-var">dvs</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1372"></span><span>
</span><span id="line-1373"></span><span class="annot"><a href="GHC.Tc.Utils.TcMType.html#delCandidates"><span class="hs-identifier hs-type">delCandidates</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.TcMType.html#CandidatesQTvs"><span class="hs-identifier hs-type">CandidatesQTvs</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="GHC.Types.Var.html#Var"><span class="hs-identifier hs-type">Var</span></a></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.TcMType.html#CandidatesQTvs"><span class="hs-identifier hs-type">CandidatesQTvs</span></a></span><span>
</span><span id="line-1374"></span><span id="delCandidates"><span class="annot"><span class="annottext">delCandidates :: CandidatesQTvs -&gt; [TcTyVar] -&gt; CandidatesQTvs
</span><a href="GHC.Tc.Utils.TcMType.html#delCandidates"><span class="hs-identifier hs-var hs-var">delCandidates</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Tc.Utils.TcMType.html#DV"><span class="hs-identifier hs-type">DV</span></a></span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">dv_kvs :: CandidatesQTvs -&gt; DTyVarSet
</span><a href="GHC.Tc.Utils.TcMType.html#dv_kvs"><span class="hs-identifier hs-var">dv_kvs</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="local-6989586621683014720"><span class="annot"><span class="annottext">DTyVarSet
</span><a href="#local-6989586621683014720"><span class="hs-identifier hs-var">kvs</span></a></span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">dv_tvs :: CandidatesQTvs -&gt; DTyVarSet
</span><a href="GHC.Tc.Utils.TcMType.html#dv_tvs"><span class="hs-identifier hs-var">dv_tvs</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="local-6989586621683014721"><span class="annot"><span class="annottext">DTyVarSet
</span><a href="#local-6989586621683014721"><span class="hs-identifier hs-var">tvs</span></a></span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">dv_cvs :: CandidatesQTvs -&gt; CoVarSet
</span><a href="GHC.Tc.Utils.TcMType.html#dv_cvs"><span class="hs-identifier hs-var">dv_cvs</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="local-6989586621683014722"><span class="annot"><span class="annottext">CoVarSet
</span><a href="#local-6989586621683014722"><span class="hs-identifier hs-var">cvs</span></a></span></span><span> </span><span class="hs-special">}</span><span class="hs-special">)</span><span> </span><span id="local-6989586621683014723"><span class="annot"><span class="annottext">[TcTyVar]
</span><a href="#local-6989586621683014723"><span class="hs-identifier hs-var">vars</span></a></span></span><span>
</span><span id="line-1375"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.TcMType.html#DV"><span class="hs-identifier hs-type">DV</span></a></span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">dv_kvs :: DTyVarSet
</span><a href="GHC.Tc.Utils.TcMType.html#dv_kvs"><span class="hs-identifier hs-var">dv_kvs</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">DTyVarSet
</span><a href="#local-6989586621683014720"><span class="hs-identifier hs-var">kvs</span></a></span><span> </span><span class="annot"><span class="annottext">DTyVarSet -&gt; [TcTyVar] -&gt; DTyVarSet
</span><a href="GHC.Types.Var.Set.html#delDVarSetList"><span class="hs-operator hs-var">`delDVarSetList`</span></a></span><span> </span><span class="annot"><span class="annottext">[TcTyVar]
</span><a href="#local-6989586621683014723"><span class="hs-identifier hs-var">vars</span></a></span><span>
</span><span id="line-1376"></span><span>       </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">dv_tvs :: DTyVarSet
</span><a href="GHC.Tc.Utils.TcMType.html#dv_tvs"><span class="hs-identifier hs-var">dv_tvs</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">DTyVarSet
</span><a href="#local-6989586621683014721"><span class="hs-identifier hs-var">tvs</span></a></span><span> </span><span class="annot"><span class="annottext">DTyVarSet -&gt; [TcTyVar] -&gt; DTyVarSet
</span><a href="GHC.Types.Var.Set.html#delDVarSetList"><span class="hs-operator hs-var">`delDVarSetList`</span></a></span><span> </span><span class="annot"><span class="annottext">[TcTyVar]
</span><a href="#local-6989586621683014723"><span class="hs-identifier hs-var">vars</span></a></span><span>
</span><span id="line-1377"></span><span>       </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">dv_cvs :: CoVarSet
</span><a href="GHC.Tc.Utils.TcMType.html#dv_cvs"><span class="hs-identifier hs-var">dv_cvs</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">CoVarSet
</span><a href="#local-6989586621683014722"><span class="hs-identifier hs-var">cvs</span></a></span><span> </span><span class="annot"><span class="annottext">CoVarSet -&gt; [TcTyVar] -&gt; CoVarSet
</span><a href="GHC.Types.Var.Set.html#delVarSetList"><span class="hs-operator hs-var">`delVarSetList`</span></a></span><span>  </span><span class="annot"><span class="annottext">[TcTyVar]
</span><a href="#local-6989586621683014723"><span class="hs-identifier hs-var">vars</span></a></span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-1378"></span><span>
</span><span id="line-1379"></span><span class="annot"><a href="GHC.Tc.Utils.TcMType.html#partitionCandidates"><span class="hs-identifier hs-type">partitionCandidates</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.TcMType.html#CandidatesQTvs"><span class="hs-identifier hs-type">CandidatesQTvs</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Types.Var.html#TyVar"><span class="hs-identifier hs-type">TyVar</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Bool</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Types.Var.Set.html#TyVarSet"><span class="hs-identifier hs-type">TyVarSet</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.TcMType.html#CandidatesQTvs"><span class="hs-identifier hs-type">CandidatesQTvs</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1380"></span><span class="hs-comment">-- The selected TyVars are returned as a non-deterministic TyVarSet</span><span>
</span><span id="line-1381"></span><span id="partitionCandidates"><span class="annot"><span class="annottext">partitionCandidates :: CandidatesQTvs -&gt; (TcTyVar -&gt; Bool) -&gt; (CoVarSet, CandidatesQTvs)
</span><a href="GHC.Tc.Utils.TcMType.html#partitionCandidates"><span class="hs-identifier hs-var hs-var">partitionCandidates</span></a></span></span><span> </span><span id="local-6989586621683014726"><span class="annot"><span class="annottext">dvs :: CandidatesQTvs
</span><a href="#local-6989586621683014726"><span class="hs-identifier hs-var">dvs</span></a></span></span><span class="hs-glyph">@</span><span class="hs-special">(</span><span class="annot"><a href="GHC.Tc.Utils.TcMType.html#DV"><span class="hs-identifier hs-type">DV</span></a></span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">dv_kvs :: CandidatesQTvs -&gt; DTyVarSet
</span><a href="GHC.Tc.Utils.TcMType.html#dv_kvs"><span class="hs-identifier hs-var">dv_kvs</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="local-6989586621683014727"><span class="annot"><span class="annottext">DTyVarSet
</span><a href="#local-6989586621683014727"><span class="hs-identifier hs-var">kvs</span></a></span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">dv_tvs :: CandidatesQTvs -&gt; DTyVarSet
</span><a href="GHC.Tc.Utils.TcMType.html#dv_tvs"><span class="hs-identifier hs-var">dv_tvs</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="local-6989586621683014728"><span class="annot"><span class="annottext">DTyVarSet
</span><a href="#local-6989586621683014728"><span class="hs-identifier hs-var">tvs</span></a></span></span><span> </span><span class="hs-special">}</span><span class="hs-special">)</span><span> </span><span id="local-6989586621683014729"><span class="annot"><span class="annottext">TcTyVar -&gt; Bool
</span><a href="#local-6989586621683014729"><span class="hs-identifier hs-var">pred</span></a></span></span><span>
</span><span id="line-1382"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">CoVarSet
</span><a href="#local-6989586621683014730"><span class="hs-identifier hs-var">extracted</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">CandidatesQTvs
</span><a href="#local-6989586621683014726"><span class="hs-identifier hs-var">dvs</span></a></span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.TcMType.html#dv_kvs"><span class="hs-identifier hs-var">dv_kvs</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="#local-6989586621683014731"><span class="hs-identifier hs-type">rest_kvs</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.TcMType.html#dv_tvs"><span class="hs-identifier hs-var">dv_tvs</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="#local-6989586621683014732"><span class="hs-identifier hs-type">rest_tvs</span></a></span><span> </span><span class="hs-special">}</span><span class="hs-special">)</span><span>
</span><span id="line-1383"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-1384"></span><span>    </span><span class="hs-special">(</span><span id="local-6989586621683014733"><span class="annot"><span class="annottext">DTyVarSet
</span><a href="#local-6989586621683014733"><span class="hs-identifier hs-var">extracted_kvs</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621683014731"><span class="annot"><span class="annottext">DTyVarSet
</span><a href="#local-6989586621683014731"><span class="hs-identifier hs-var">rest_kvs</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(TcTyVar -&gt; Bool) -&gt; DTyVarSet -&gt; (DTyVarSet, DTyVarSet)
</span><a href="GHC.Types.Var.Set.html#partitionDVarSet"><span class="hs-identifier hs-var">partitionDVarSet</span></a></span><span> </span><span class="annot"><span class="annottext">TcTyVar -&gt; Bool
</span><a href="#local-6989586621683014729"><span class="hs-identifier hs-var">pred</span></a></span><span> </span><span class="annot"><span class="annottext">DTyVarSet
</span><a href="#local-6989586621683014727"><span class="hs-identifier hs-var">kvs</span></a></span><span>
</span><span id="line-1385"></span><span>    </span><span class="hs-special">(</span><span id="local-6989586621683014735"><span class="annot"><span class="annottext">DTyVarSet
</span><a href="#local-6989586621683014735"><span class="hs-identifier hs-var">extracted_tvs</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621683014732"><span class="annot"><span class="annottext">DTyVarSet
</span><a href="#local-6989586621683014732"><span class="hs-identifier hs-var">rest_tvs</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(TcTyVar -&gt; Bool) -&gt; DTyVarSet -&gt; (DTyVarSet, DTyVarSet)
</span><a href="GHC.Types.Var.Set.html#partitionDVarSet"><span class="hs-identifier hs-var">partitionDVarSet</span></a></span><span> </span><span class="annot"><span class="annottext">TcTyVar -&gt; Bool
</span><a href="#local-6989586621683014729"><span class="hs-identifier hs-var">pred</span></a></span><span> </span><span class="annot"><span class="annottext">DTyVarSet
</span><a href="#local-6989586621683014728"><span class="hs-identifier hs-var">tvs</span></a></span><span>
</span><span id="line-1386"></span><span>    </span><span id="local-6989586621683014730"><span class="annot"><span class="annottext">extracted :: CoVarSet
</span><a href="#local-6989586621683014730"><span class="hs-identifier hs-var hs-var">extracted</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">DTyVarSet -&gt; CoVarSet
</span><a href="GHC.Types.Var.Set.html#dVarSetToVarSet"><span class="hs-identifier hs-var">dVarSetToVarSet</span></a></span><span> </span><span class="annot"><span class="annottext">DTyVarSet
</span><a href="#local-6989586621683014733"><span class="hs-identifier hs-var">extracted_kvs</span></a></span><span> </span><span class="annot"><span class="annottext">CoVarSet -&gt; CoVarSet -&gt; CoVarSet
</span><a href="GHC.Types.Var.Set.html#unionVarSet"><span class="hs-operator hs-var">`unionVarSet`</span></a></span><span> </span><span class="annot"><span class="annottext">DTyVarSet -&gt; CoVarSet
</span><a href="GHC.Types.Var.Set.html#dVarSetToVarSet"><span class="hs-identifier hs-var">dVarSetToVarSet</span></a></span><span> </span><span class="annot"><span class="annottext">DTyVarSet
</span><a href="#local-6989586621683014735"><span class="hs-identifier hs-var">extracted_tvs</span></a></span><span>
</span><span id="line-1387"></span><span>
</span><span id="line-1388"></span><span class="annot"><a href="GHC.Tc.Utils.TcMType.html#candidateQTyVarsWithBinders"><span class="hs-identifier hs-type">candidateQTyVarsWithBinders</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="GHC.Types.Var.html#TyVar"><span class="hs-identifier hs-type">TyVar</span></a></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#Type"><span class="hs-identifier hs-type">Type</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#TcM"><span class="hs-identifier hs-type">TcM</span></a></span><span> </span><span class="annot"><a href="GHC.Tc.Utils.TcMType.html#CandidatesQTvs"><span class="hs-identifier hs-type">CandidatesQTvs</span></a></span><span>
</span><span id="line-1389"></span><span class="hs-comment">-- (candidateQTyVarsWithBinders tvs ty) returns the candidateQTyVars</span><span>
</span><span id="line-1390"></span><span class="hs-comment">-- of (forall tvs. ty), but do not treat 'tvs' as bound for the purpose</span><span>
</span><span id="line-1391"></span><span class="hs-comment">-- of Note [Naughty quantification candidates].  Why?</span><span>
</span><span id="line-1392"></span><span class="hs-comment">-- Because we are going to scoped-sort the quantified variables</span><span>
</span><span id="line-1393"></span><span class="hs-comment">-- in among the tvs</span><span>
</span><span id="line-1394"></span><span id="candidateQTyVarsWithBinders"><span class="annot"><span class="annottext">candidateQTyVarsWithBinders :: [TcTyVar] -&gt; TcType -&gt; TcM CandidatesQTvs
</span><a href="GHC.Tc.Utils.TcMType.html#candidateQTyVarsWithBinders"><span class="hs-identifier hs-var hs-var">candidateQTyVarsWithBinders</span></a></span></span><span> </span><span id="local-6989586621683014736"><span class="annot"><span class="annottext">[TcTyVar]
</span><a href="#local-6989586621683014736"><span class="hs-identifier hs-var">bound_tvs</span></a></span></span><span> </span><span id="local-6989586621683014737"><span class="annot"><span class="annottext">TcType
</span><a href="#local-6989586621683014737"><span class="hs-identifier hs-var">ty</span></a></span></span><span>
</span><span id="line-1395"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span id="local-6989586621683014738"><span class="annot"><a href="#local-6989586621683014738"><span class="hs-identifier hs-var">kvs</span></a></span></span><span>     </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">[TcType] -&gt; TcM CandidatesQTvs
</span><a href="GHC.Tc.Utils.TcMType.html#candidateQTyVarsOfKinds"><span class="hs-identifier hs-var">candidateQTyVarsOfKinds</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(TcTyVar -&gt; TcType) -&gt; [TcTyVar] -&gt; [TcType]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><span class="hs-identifier hs-var">map</span></span><span> </span><span class="annot"><span class="annottext">TcTyVar -&gt; TcType
</span><a href="GHC.Types.Var.html#tyVarKind"><span class="hs-identifier hs-var">tyVarKind</span></a></span><span> </span><span class="annot"><span class="annottext">[TcTyVar]
</span><a href="#local-6989586621683014736"><span class="hs-identifier hs-var">bound_tvs</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1396"></span><span>       </span><span class="hs-special">;</span><span> </span><span id="local-6989586621683014739"><span class="annot"><a href="#local-6989586621683014739"><span class="hs-identifier hs-var">cur_lvl</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.Monad.html#getTcLevel"><span class="hs-identifier hs-type">getTcLevel</span></a></span><span>
</span><span id="line-1397"></span><span>       </span><span class="hs-special">;</span><span> </span><span id="local-6989586621683014740"><span class="annot"><a href="#local-6989586621683014740"><span class="hs-identifier hs-var">all_tvs</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.TcMType.html#collect_cand_qtvs"><span class="hs-identifier hs-type">collect_cand_qtvs</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683014737"><span class="hs-identifier hs-type">ty</span></a></span><span> </span><span class="annot"><span class="hs-identifier hs-type">False</span></span><span> </span><span class="annot"><a href="#local-6989586621683014739"><span class="hs-identifier hs-type">cur_lvl</span></a></span><span> </span><span class="annot"><a href="GHC.Types.Var.Set.html#emptyVarSet"><span class="hs-identifier hs-type">emptyVarSet</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683014738"><span class="hs-identifier hs-type">kvs</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683014737"><span class="hs-identifier hs-type">ty</span></a></span><span>
</span><span id="line-1398"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">return</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621683014740"><span class="hs-identifier hs-type">all_tvs</span></a></span><span> </span><span class="annot"><a href="GHC.Tc.Utils.TcMType.html#delCandidates"><span class="hs-operator hs-type">`delCandidates`</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683014736"><span class="hs-identifier hs-type">bound_tvs</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-1399"></span><span>
</span><span id="line-1400"></span><span class="hs-comment">-- | Gathers free variables to use as quantification candidates (in</span><span>
</span><span id="line-1401"></span><span class="hs-comment">-- 'quantifyTyVars'). This might output the same var</span><span>
</span><span id="line-1402"></span><span class="hs-comment">-- in both sets, if it's used in both a type and a kind.</span><span>
</span><span id="line-1403"></span><span class="hs-comment">-- The variables to quantify must have a TcLevel strictly greater than</span><span>
</span><span id="line-1404"></span><span class="hs-comment">-- the ambient level. (See Wrinkle in Note [Naughty quantification candidates])</span><span>
</span><span id="line-1405"></span><span class="hs-comment">-- See Note [CandidatesQTvs determinism and order]</span><span>
</span><span id="line-1406"></span><span class="hs-comment">-- See Note [Dependent type variables]</span><span>
</span><span id="line-1407"></span><span class="annot"><a href="GHC.Tc.Utils.TcMType.html#candidateQTyVarsOfType"><span class="hs-identifier hs-type">candidateQTyVarsOfType</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.TcType.html#TcType"><span class="hs-identifier hs-type">TcType</span></a></span><span>       </span><span class="hs-comment">-- not necessarily zonked</span><span>
</span><span id="line-1408"></span><span>                       </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#TcM"><span class="hs-identifier hs-type">TcM</span></a></span><span> </span><span class="annot"><a href="GHC.Tc.Utils.TcMType.html#CandidatesQTvs"><span class="hs-identifier hs-type">CandidatesQTvs</span></a></span><span>
</span><span id="line-1409"></span><span id="candidateQTyVarsOfType"><span class="annot"><span class="annottext">candidateQTyVarsOfType :: TcType -&gt; TcM CandidatesQTvs
</span><a href="GHC.Tc.Utils.TcMType.html#candidateQTyVarsOfType"><span class="hs-identifier hs-var hs-var">candidateQTyVarsOfType</span></a></span></span><span> </span><span id="local-6989586621683014742"><span class="annot"><span class="annottext">TcType
</span><a href="#local-6989586621683014742"><span class="hs-identifier hs-var">ty</span></a></span></span><span>
</span><span id="line-1410"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span id="local-6989586621683014743"><span class="annot"><a href="#local-6989586621683014743"><span class="hs-identifier hs-var">cur_lvl</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">TcM TcLevel
</span><a href="GHC.Tc.Utils.Monad.html#getTcLevel"><span class="hs-identifier hs-var">getTcLevel</span></a></span><span>
</span><span id="line-1411"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.TcMType.html#collect_cand_qtvs"><span class="hs-identifier hs-type">collect_cand_qtvs</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683014742"><span class="hs-identifier hs-type">ty</span></a></span><span> </span><span class="annot"><span class="hs-identifier hs-type">False</span></span><span> </span><span class="annot"><a href="#local-6989586621683014743"><span class="hs-identifier hs-type">cur_lvl</span></a></span><span> </span><span class="annot"><a href="GHC.Types.Var.Set.html#emptyVarSet"><span class="hs-identifier hs-type">emptyVarSet</span></a></span><span> </span><span class="annot"><span class="hs-identifier hs-type">mempty</span></span><span> </span><span class="annot"><a href="#local-6989586621683014742"><span class="hs-identifier hs-type">ty</span></a></span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-1412"></span><span>
</span><span id="line-1413"></span><span class="hs-comment">-- | Like 'candidateQTyVarsOfType', but over a list of types</span><span>
</span><span id="line-1414"></span><span class="hs-comment">-- The variables to quantify must have a TcLevel strictly greater than</span><span>
</span><span id="line-1415"></span><span class="hs-comment">-- the ambient level. (See Wrinkle in Note [Naughty quantification candidates])</span><span>
</span><span id="line-1416"></span><span class="annot"><a href="GHC.Tc.Utils.TcMType.html#candidateQTyVarsOfTypes"><span class="hs-identifier hs-type">candidateQTyVarsOfTypes</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#Type"><span class="hs-identifier hs-type">Type</span></a></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#TcM"><span class="hs-identifier hs-type">TcM</span></a></span><span> </span><span class="annot"><a href="GHC.Tc.Utils.TcMType.html#CandidatesQTvs"><span class="hs-identifier hs-type">CandidatesQTvs</span></a></span><span>
</span><span id="line-1417"></span><span id="candidateQTyVarsOfTypes"><span class="annot"><span class="annottext">candidateQTyVarsOfTypes :: [TcType] -&gt; TcM CandidatesQTvs
</span><a href="GHC.Tc.Utils.TcMType.html#candidateQTyVarsOfTypes"><span class="hs-identifier hs-var hs-var">candidateQTyVarsOfTypes</span></a></span></span><span> </span><span id="local-6989586621683014744"><span class="annot"><span class="annottext">[TcType]
</span><a href="#local-6989586621683014744"><span class="hs-identifier hs-var">tys</span></a></span></span><span>
</span><span id="line-1418"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span id="local-6989586621683014745"><span class="annot"><a href="#local-6989586621683014745"><span class="hs-identifier hs-var">cur_lvl</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">TcM TcLevel
</span><a href="GHC.Tc.Utils.Monad.html#getTcLevel"><span class="hs-identifier hs-var">getTcLevel</span></a></span><span>
</span><span id="line-1419"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">foldlM</span></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span id="local-6989586621683014747"><span class="annot"><span class="annottext">CandidatesQTvs
</span><a href="#local-6989586621683014747"><span class="hs-identifier hs-var">acc</span></a></span></span><span> </span><span id="local-6989586621683014748"><span class="annot"><span class="annottext">TcType
</span><a href="#local-6989586621683014748"><span class="hs-identifier hs-var">ty</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">TcType
-&gt; Bool
-&gt; TcLevel
-&gt; CoVarSet
-&gt; CandidatesQTvs
-&gt; TcType
-&gt; TcM CandidatesQTvs
</span><a href="GHC.Tc.Utils.TcMType.html#collect_cand_qtvs"><span class="hs-identifier hs-var">collect_cand_qtvs</span></a></span><span> </span><span class="annot"><span class="annottext">TcType
</span><a href="#local-6989586621683014748"><span class="hs-identifier hs-var">ty</span></a></span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">False</span></span><span> </span><span class="annot"><span class="annottext">TcLevel
</span><a href="#local-6989586621683014745"><span class="hs-identifier hs-var">cur_lvl</span></a></span><span> </span><span class="annot"><span class="annottext">CoVarSet
</span><a href="GHC.Types.Var.Set.html#emptyVarSet"><span class="hs-identifier hs-var">emptyVarSet</span></a></span><span> </span><span class="annot"><span class="annottext">CandidatesQTvs
</span><a href="#local-6989586621683014747"><span class="hs-identifier hs-var">acc</span></a></span><span> </span><span class="annot"><span class="annottext">TcType
</span><a href="#local-6989586621683014748"><span class="hs-identifier hs-var">ty</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1420"></span><span>                </span><span class="annot"><span class="hs-identifier hs-type">mempty</span></span><span> </span><span class="annot"><a href="#local-6989586621683014744"><span class="hs-identifier hs-type">tys</span></a></span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-1421"></span><span>
</span><span id="line-1422"></span><span class="hs-comment">-- | Like 'candidateQTyVarsOfType', but consider every free variable</span><span>
</span><span id="line-1423"></span><span class="hs-comment">-- to be dependent. This is appropriate when generalizing a *kind*,</span><span>
</span><span id="line-1424"></span><span class="hs-comment">-- instead of a type. (That way, -XNoPolyKinds will default the variables</span><span>
</span><span id="line-1425"></span><span class="hs-comment">-- to Type.)</span><span>
</span><span id="line-1426"></span><span class="annot"><a href="GHC.Tc.Utils.TcMType.html#candidateQTyVarsOfKind"><span class="hs-identifier hs-type">candidateQTyVarsOfKind</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.TcType.html#TcKind"><span class="hs-identifier hs-type">TcKind</span></a></span><span>       </span><span class="hs-comment">-- Not necessarily zonked</span><span>
</span><span id="line-1427"></span><span>                       </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#TcM"><span class="hs-identifier hs-type">TcM</span></a></span><span> </span><span class="annot"><a href="GHC.Tc.Utils.TcMType.html#CandidatesQTvs"><span class="hs-identifier hs-type">CandidatesQTvs</span></a></span><span>
</span><span id="line-1428"></span><span id="candidateQTyVarsOfKind"><span class="annot"><span class="annottext">candidateQTyVarsOfKind :: TcType -&gt; TcM CandidatesQTvs
</span><a href="GHC.Tc.Utils.TcMType.html#candidateQTyVarsOfKind"><span class="hs-identifier hs-var hs-var">candidateQTyVarsOfKind</span></a></span></span><span> </span><span id="local-6989586621683014749"><span class="annot"><span class="annottext">TcType
</span><a href="#local-6989586621683014749"><span class="hs-identifier hs-var">ty</span></a></span></span><span>
</span><span id="line-1429"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span id="local-6989586621683014750"><span class="annot"><a href="#local-6989586621683014750"><span class="hs-identifier hs-var">cur_lvl</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">TcM TcLevel
</span><a href="GHC.Tc.Utils.Monad.html#getTcLevel"><span class="hs-identifier hs-var">getTcLevel</span></a></span><span>
</span><span id="line-1430"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.TcMType.html#collect_cand_qtvs"><span class="hs-identifier hs-type">collect_cand_qtvs</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683014749"><span class="hs-identifier hs-type">ty</span></a></span><span> </span><span class="annot"><span class="hs-identifier hs-type">True</span></span><span> </span><span class="annot"><a href="#local-6989586621683014750"><span class="hs-identifier hs-type">cur_lvl</span></a></span><span> </span><span class="annot"><a href="GHC.Types.Var.Set.html#emptyVarSet"><span class="hs-identifier hs-type">emptyVarSet</span></a></span><span> </span><span class="annot"><span class="hs-identifier hs-type">mempty</span></span><span> </span><span class="annot"><a href="#local-6989586621683014749"><span class="hs-identifier hs-type">ty</span></a></span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-1431"></span><span>
</span><span id="line-1432"></span><span class="annot"><a href="GHC.Tc.Utils.TcMType.html#candidateQTyVarsOfKinds"><span class="hs-identifier hs-type">candidateQTyVarsOfKinds</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="GHC.Tc.Utils.TcType.html#TcKind"><span class="hs-identifier hs-type">TcKind</span></a></span><span class="hs-special">]</span><span>    </span><span class="hs-comment">-- Not necessarily zonked</span><span>
</span><span id="line-1433"></span><span>                       </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#TcM"><span class="hs-identifier hs-type">TcM</span></a></span><span> </span><span class="annot"><a href="GHC.Tc.Utils.TcMType.html#CandidatesQTvs"><span class="hs-identifier hs-type">CandidatesQTvs</span></a></span><span>
</span><span id="line-1434"></span><span id="candidateQTyVarsOfKinds"><span class="annot"><span class="annottext">candidateQTyVarsOfKinds :: [TcType] -&gt; TcM CandidatesQTvs
</span><a href="GHC.Tc.Utils.TcMType.html#candidateQTyVarsOfKinds"><span class="hs-identifier hs-var hs-var">candidateQTyVarsOfKinds</span></a></span></span><span> </span><span id="local-6989586621683014751"><span class="annot"><span class="annottext">[TcType]
</span><a href="#local-6989586621683014751"><span class="hs-identifier hs-var">tys</span></a></span></span><span>
</span><span id="line-1435"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span id="local-6989586621683014752"><span class="annot"><a href="#local-6989586621683014752"><span class="hs-identifier hs-var">cur_lvl</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">TcM TcLevel
</span><a href="GHC.Tc.Utils.Monad.html#getTcLevel"><span class="hs-identifier hs-var">getTcLevel</span></a></span><span>
</span><span id="line-1436"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">foldM</span></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span id="local-6989586621683014754"><span class="annot"><span class="annottext">CandidatesQTvs
</span><a href="#local-6989586621683014754"><span class="hs-identifier hs-var">acc</span></a></span></span><span> </span><span id="local-6989586621683014755"><span class="annot"><span class="annottext">TcType
</span><a href="#local-6989586621683014755"><span class="hs-identifier hs-var">ty</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">TcType
-&gt; Bool
-&gt; TcLevel
-&gt; CoVarSet
-&gt; CandidatesQTvs
-&gt; TcType
-&gt; TcM CandidatesQTvs
</span><a href="GHC.Tc.Utils.TcMType.html#collect_cand_qtvs"><span class="hs-identifier hs-var">collect_cand_qtvs</span></a></span><span> </span><span class="annot"><span class="annottext">TcType
</span><a href="#local-6989586621683014755"><span class="hs-identifier hs-var">ty</span></a></span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">True</span></span><span> </span><span class="annot"><span class="annottext">TcLevel
</span><a href="#local-6989586621683014752"><span class="hs-identifier hs-var">cur_lvl</span></a></span><span> </span><span class="annot"><span class="annottext">CoVarSet
</span><a href="GHC.Types.Var.Set.html#emptyVarSet"><span class="hs-identifier hs-var">emptyVarSet</span></a></span><span> </span><span class="annot"><span class="annottext">CandidatesQTvs
</span><a href="#local-6989586621683014754"><span class="hs-identifier hs-var">acc</span></a></span><span> </span><span class="annot"><span class="annottext">TcType
</span><a href="#local-6989586621683014755"><span class="hs-identifier hs-var">ty</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1437"></span><span>               </span><span class="annot"><span class="hs-identifier hs-type">mempty</span></span><span> </span><span class="annot"><a href="#local-6989586621683014751"><span class="hs-identifier hs-type">tys</span></a></span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-1438"></span><span>
</span><span id="line-1439"></span><span class="annot"><a href="GHC.Tc.Utils.TcMType.html#collect_cand_qtvs"><span class="hs-identifier hs-type">collect_cand_qtvs</span></a></span><span>
</span><span id="line-1440"></span><span>  </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.TcType.html#TcType"><span class="hs-identifier hs-type">TcType</span></a></span><span>          </span><span class="hs-comment">-- Original type that we started recurring into; for errors</span><span>
</span><span id="line-1441"></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Bool</span></span><span>            </span><span class="hs-comment">-- True &lt;=&gt; consider every fv in Type to be dependent</span><span>
</span><span id="line-1442"></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.TcType.html#TcLevel"><span class="hs-identifier hs-type">TcLevel</span></a></span><span>         </span><span class="hs-comment">-- Current TcLevel; collect only tyvars whose level is greater</span><span>
</span><span id="line-1443"></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Types.Var.Set.html#VarSet"><span class="hs-identifier hs-type">VarSet</span></a></span><span>          </span><span class="hs-comment">-- Bound variables (locals only)</span><span>
</span><span id="line-1444"></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.TcMType.html#CandidatesQTvs"><span class="hs-identifier hs-type">CandidatesQTvs</span></a></span><span>  </span><span class="hs-comment">-- Accumulating parameter</span><span>
</span><span id="line-1445"></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#Type"><span class="hs-identifier hs-type">Type</span></a></span><span>            </span><span class="hs-comment">-- Not necessarily zonked</span><span>
</span><span id="line-1446"></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#TcM"><span class="hs-identifier hs-type">TcM</span></a></span><span> </span><span class="annot"><a href="GHC.Tc.Utils.TcMType.html#CandidatesQTvs"><span class="hs-identifier hs-type">CandidatesQTvs</span></a></span><span>
</span><span id="line-1447"></span><span>
</span><span id="line-1448"></span><span class="hs-comment">-- Key points:</span><span>
</span><span id="line-1449"></span><span class="hs-comment">--   * Looks through meta-tyvars as it goes;</span><span>
</span><span id="line-1450"></span><span class="hs-comment">--     no need to zonk in advance</span><span>
</span><span id="line-1451"></span><span class="hs-comment">--</span><span>
</span><span id="line-1452"></span><span class="hs-comment">--   * Needs to be monadic anyway, because it handles naughty</span><span>
</span><span id="line-1453"></span><span class="hs-comment">--     quantification; see Note [Naughty quantification candidates]</span><span>
</span><span id="line-1454"></span><span class="hs-comment">--</span><span>
</span><span id="line-1455"></span><span class="hs-comment">--   * Returns fully-zonked CandidateQTvs, including their kinds</span><span>
</span><span id="line-1456"></span><span class="hs-comment">--     so that subsequent dependency analysis (to build a well</span><span>
</span><span id="line-1457"></span><span class="hs-comment">--     scoped telescope) works correctly</span><span>
</span><span id="line-1458"></span><span>
</span><span id="line-1459"></span><span id="collect_cand_qtvs"><span class="annot"><span class="annottext">collect_cand_qtvs :: TcType
-&gt; Bool
-&gt; TcLevel
-&gt; CoVarSet
-&gt; CandidatesQTvs
-&gt; TcType
-&gt; TcM CandidatesQTvs
</span><a href="GHC.Tc.Utils.TcMType.html#collect_cand_qtvs"><span class="hs-identifier hs-var hs-var">collect_cand_qtvs</span></a></span></span><span> </span><span id="local-6989586621683014757"><span class="annot"><span class="annottext">TcType
</span><a href="#local-6989586621683014757"><span class="hs-identifier hs-var">orig_ty</span></a></span></span><span> </span><span id="local-6989586621683014758"><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621683014758"><span class="hs-identifier hs-var">is_dep</span></a></span></span><span> </span><span id="local-6989586621683014759"><span class="annot"><span class="annottext">TcLevel
</span><a href="#local-6989586621683014759"><span class="hs-identifier hs-var">cur_lvl</span></a></span></span><span> </span><span id="local-6989586621683014760"><span class="annot"><span class="annottext">CoVarSet
</span><a href="#local-6989586621683014760"><span class="hs-identifier hs-var">bound</span></a></span></span><span> </span><span id="local-6989586621683014761"><span class="annot"><span class="annottext">CandidatesQTvs
</span><a href="#local-6989586621683014761"><span class="hs-identifier hs-var">dvs</span></a></span></span><span> </span><span id="local-6989586621683014762"><span class="annot"><span class="annottext">TcType
</span><a href="#local-6989586621683014762"><span class="hs-identifier hs-var">ty</span></a></span></span><span>
</span><span id="line-1460"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">CandidatesQTvs -&gt; TcType -&gt; TcM CandidatesQTvs
</span><a href="#local-6989586621683014763"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="annot"><span class="annottext">CandidatesQTvs
</span><a href="#local-6989586621683014761"><span class="hs-identifier hs-var">dvs</span></a></span><span> </span><span class="annot"><span class="annottext">TcType
</span><a href="#local-6989586621683014762"><span class="hs-identifier hs-var">ty</span></a></span><span>
</span><span id="line-1461"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-1462"></span><span>    </span><span id="local-6989586621683014764"><span class="annot"><span class="annottext">is_bound :: TcTyVar -&gt; Bool
</span><a href="#local-6989586621683014764"><span class="hs-identifier hs-var hs-var">is_bound</span></a></span></span><span> </span><span id="local-6989586621683014765"><span class="annot"><span class="annottext">TcTyVar
</span><a href="#local-6989586621683014765"><span class="hs-identifier hs-var">tv</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">TcTyVar
</span><a href="#local-6989586621683014765"><span class="hs-identifier hs-var">tv</span></a></span><span> </span><span class="annot"><span class="annottext">TcTyVar -&gt; CoVarSet -&gt; Bool
</span><a href="GHC.Types.Var.Set.html#elemVarSet"><span class="hs-operator hs-var">`elemVarSet`</span></a></span><span> </span><span class="annot"><span class="annottext">CoVarSet
</span><a href="#local-6989586621683014760"><span class="hs-identifier hs-var">bound</span></a></span><span>
</span><span id="line-1463"></span><span>
</span><span id="line-1464"></span><span>    </span><span class="hs-comment">-----------------</span><span>
</span><span id="line-1465"></span><span>    </span><span class="annot"><a href="#local-6989586621683014763"><span class="hs-identifier hs-type">go</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.TcMType.html#CandidatesQTvs"><span class="hs-identifier hs-type">CandidatesQTvs</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.TcType.html#TcType"><span class="hs-identifier hs-type">TcType</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#TcM"><span class="hs-identifier hs-type">TcM</span></a></span><span> </span><span class="annot"><a href="GHC.Tc.Utils.TcMType.html#CandidatesQTvs"><span class="hs-identifier hs-type">CandidatesQTvs</span></a></span><span>
</span><span id="line-1466"></span><span>    </span><span class="hs-comment">-- Uses accumulating-parameter style</span><span>
</span><span id="line-1467"></span><span>    </span><span id="local-6989586621683014763"><span class="annot"><span class="annottext">go :: CandidatesQTvs -&gt; TcType -&gt; TcM CandidatesQTvs
</span><a href="#local-6989586621683014763"><span class="hs-identifier hs-var hs-var">go</span></a></span></span><span> </span><span id="local-6989586621683014767"><span class="annot"><span class="annottext">CandidatesQTvs
</span><a href="#local-6989586621683014767"><span class="hs-identifier hs-var">dv</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#AppTy"><span class="hs-identifier hs-type">AppTy</span></a></span><span> </span><span id="local-6989586621683014769"><span class="annot"><span class="annottext">TcType
</span><a href="#local-6989586621683014769"><span class="hs-identifier hs-var">t1</span></a></span></span><span> </span><span id="local-6989586621683014770"><span class="annot"><span class="annottext">TcType
</span><a href="#local-6989586621683014770"><span class="hs-identifier hs-var">t2</span></a></span></span><span class="hs-special">)</span><span>       </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(CandidatesQTvs -&gt; TcType -&gt; TcM CandidatesQTvs)
-&gt; CandidatesQTvs -&gt; [TcType] -&gt; TcM CandidatesQTvs
forall (t :: * -&gt; *) (m :: * -&gt; *) b a.
(Foldable t, Monad m) =&gt;
(b -&gt; a -&gt; m b) -&gt; b -&gt; t a -&gt; m b
</span><span class="hs-identifier hs-var">foldlM</span></span><span> </span><span class="annot"><span class="annottext">CandidatesQTvs -&gt; TcType -&gt; TcM CandidatesQTvs
</span><a href="#local-6989586621683014763"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="annot"><span class="annottext">CandidatesQTvs
</span><a href="#local-6989586621683014767"><span class="hs-identifier hs-var">dv</span></a></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">TcType
</span><a href="#local-6989586621683014769"><span class="hs-identifier hs-var">t1</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">TcType
</span><a href="#local-6989586621683014770"><span class="hs-identifier hs-var">t2</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-1468"></span><span>    </span><span class="annot"><a href="#local-6989586621683014763"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span id="local-6989586621683014771"><span class="annot"><span class="annottext">CandidatesQTvs
</span><a href="#local-6989586621683014771"><span class="hs-identifier hs-var">dv</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#TyConApp"><span class="hs-identifier hs-type">TyConApp</span></a></span><span> </span><span id="local-6989586621683014773"><span class="annot"><span class="annottext">TyCon
</span><a href="#local-6989586621683014773"><span class="hs-identifier hs-var">tc</span></a></span></span><span> </span><span id="local-6989586621683014774"><span class="annot"><span class="annottext">[TcType]
</span><a href="#local-6989586621683014774"><span class="hs-identifier hs-var">tys</span></a></span></span><span class="hs-special">)</span><span>   </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">CandidatesQTvs -&gt; [TyConBinder] -&gt; [TcType] -&gt; TcM CandidatesQTvs
</span><a href="#local-6989586621683014775"><span class="hs-identifier hs-var">go_tc_args</span></a></span><span> </span><span class="annot"><span class="annottext">CandidatesQTvs
</span><a href="#local-6989586621683014771"><span class="hs-identifier hs-var">dv</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TyCon -&gt; [TyConBinder]
</span><a href="GHC.Core.TyCon.html#tyConBinders"><span class="hs-identifier hs-var">tyConBinders</span></a></span><span> </span><span class="annot"><span class="annottext">TyCon
</span><a href="#local-6989586621683014773"><span class="hs-identifier hs-var">tc</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[TcType]
</span><a href="#local-6989586621683014774"><span class="hs-identifier hs-var">tys</span></a></span><span>
</span><span id="line-1469"></span><span>    </span><span class="annot"><a href="#local-6989586621683014763"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span id="local-6989586621683014777"><span class="annot"><span class="annottext">CandidatesQTvs
</span><a href="#local-6989586621683014777"><span class="hs-identifier hs-var">dv</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#FunTy"><span class="hs-identifier hs-type">FunTy</span></a></span><span> </span><span class="annot"><span class="annottext">FunTyFlag
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621683014779"><span class="annot"><span class="annottext">TcType
</span><a href="#local-6989586621683014779"><span class="hs-identifier hs-var">w</span></a></span></span><span> </span><span id="local-6989586621683014780"><span class="annot"><span class="annottext">TcType
</span><a href="#local-6989586621683014780"><span class="hs-identifier hs-var">arg</span></a></span></span><span> </span><span id="local-6989586621683014781"><span class="annot"><span class="annottext">TcType
</span><a href="#local-6989586621683014781"><span class="hs-identifier hs-var">res</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(CandidatesQTvs -&gt; TcType -&gt; TcM CandidatesQTvs)
-&gt; CandidatesQTvs -&gt; [TcType] -&gt; TcM CandidatesQTvs
forall (t :: * -&gt; *) (m :: * -&gt; *) b a.
(Foldable t, Monad m) =&gt;
(b -&gt; a -&gt; m b) -&gt; b -&gt; t a -&gt; m b
</span><span class="hs-identifier hs-var">foldlM</span></span><span> </span><span class="annot"><span class="annottext">CandidatesQTvs -&gt; TcType -&gt; TcM CandidatesQTvs
</span><a href="#local-6989586621683014763"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="annot"><span class="annottext">CandidatesQTvs
</span><a href="#local-6989586621683014777"><span class="hs-identifier hs-var">dv</span></a></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">TcType
</span><a href="#local-6989586621683014779"><span class="hs-identifier hs-var">w</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">TcType
</span><a href="#local-6989586621683014780"><span class="hs-identifier hs-var">arg</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">TcType
</span><a href="#local-6989586621683014781"><span class="hs-identifier hs-var">res</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-1470"></span><span>    </span><span class="annot"><a href="#local-6989586621683014763"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span id="local-6989586621683014782"><span class="annot"><span class="annottext">CandidatesQTvs
</span><a href="#local-6989586621683014782"><span class="hs-identifier hs-var">dv</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#LitTy"><span class="hs-identifier hs-type">LitTy</span></a></span><span> </span><span class="hs-special">{</span><span class="hs-special">}</span><span class="hs-special">)</span><span>          </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">CandidatesQTvs -&gt; TcM CandidatesQTvs
forall a. a -&gt; IOEnv (Env TcGblEnv TcLclEnv) a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="annot"><span class="annottext">CandidatesQTvs
</span><a href="#local-6989586621683014782"><span class="hs-identifier hs-var">dv</span></a></span><span>
</span><span id="line-1471"></span><span>    </span><span class="annot"><a href="#local-6989586621683014763"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span id="local-6989586621683014784"><span class="annot"><span class="annottext">CandidatesQTvs
</span><a href="#local-6989586621683014784"><span class="hs-identifier hs-var">dv</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#CastTy"><span class="hs-identifier hs-type">CastTy</span></a></span><span> </span><span id="local-6989586621683014786"><span class="annot"><span class="annottext">TcType
</span><a href="#local-6989586621683014786"><span class="hs-identifier hs-var">ty</span></a></span></span><span> </span><span id="local-6989586621683014787"><span class="annot"><span class="annottext">Coercion
</span><a href="#local-6989586621683014787"><span class="hs-identifier hs-var">co</span></a></span></span><span class="hs-special">)</span><span>      </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span id="local-6989586621683014788"><span class="annot"><a href="#local-6989586621683014788"><span class="hs-identifier hs-var">dv1</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">CandidatesQTvs -&gt; TcType -&gt; TcM CandidatesQTvs
</span><a href="#local-6989586621683014763"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="annot"><span class="annottext">CandidatesQTvs
</span><a href="#local-6989586621683014784"><span class="hs-identifier hs-var">dv</span></a></span><span> </span><span class="annot"><span class="annottext">TcType
</span><a href="#local-6989586621683014786"><span class="hs-identifier hs-var">ty</span></a></span><span>
</span><span id="line-1472"></span><span>                                   </span><span class="hs-special">;</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.TcMType.html#collect_cand_qtvs_co"><span class="hs-identifier hs-type">collect_cand_qtvs_co</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683014757"><span class="hs-identifier hs-type">orig_ty</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683014759"><span class="hs-identifier hs-type">cur_lvl</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683014760"><span class="hs-identifier hs-type">bound</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683014788"><span class="hs-identifier hs-type">dv1</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683014787"><span class="hs-identifier hs-type">co</span></a></span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-1473"></span><span>    </span><span class="annot"><a href="#local-6989586621683014763"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span id="local-6989586621683014790"><span class="annot"><span class="annottext">CandidatesQTvs
</span><a href="#local-6989586621683014790"><span class="hs-identifier hs-var">dv</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#CoercionTy"><span class="hs-identifier hs-type">CoercionTy</span></a></span><span> </span><span id="local-6989586621683014792"><span class="annot"><span class="annottext">Coercion
</span><a href="#local-6989586621683014792"><span class="hs-identifier hs-var">co</span></a></span></span><span class="hs-special">)</span><span>     </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">TcType
-&gt; TcLevel
-&gt; CoVarSet
-&gt; CandidatesQTvs
-&gt; Coercion
-&gt; TcM CandidatesQTvs
</span><a href="GHC.Tc.Utils.TcMType.html#collect_cand_qtvs_co"><span class="hs-identifier hs-var">collect_cand_qtvs_co</span></a></span><span> </span><span class="annot"><span class="annottext">TcType
</span><a href="#local-6989586621683014757"><span class="hs-identifier hs-var">orig_ty</span></a></span><span> </span><span class="annot"><span class="annottext">TcLevel
</span><a href="#local-6989586621683014759"><span class="hs-identifier hs-var">cur_lvl</span></a></span><span> </span><span class="annot"><span class="annottext">CoVarSet
</span><a href="#local-6989586621683014760"><span class="hs-identifier hs-var">bound</span></a></span><span> </span><span class="annot"><span class="annottext">CandidatesQTvs
</span><a href="#local-6989586621683014790"><span class="hs-identifier hs-var">dv</span></a></span><span> </span><span class="annot"><span class="annottext">Coercion
</span><a href="#local-6989586621683014792"><span class="hs-identifier hs-var">co</span></a></span><span>
</span><span id="line-1474"></span><span>
</span><span id="line-1475"></span><span>    </span><span class="annot"><a href="#local-6989586621683014763"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span id="local-6989586621683014793"><span class="annot"><span class="annottext">CandidatesQTvs
</span><a href="#local-6989586621683014793"><span class="hs-identifier hs-var">dv</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#TyVarTy"><span class="hs-identifier hs-type">TyVarTy</span></a></span><span> </span><span id="local-6989586621683014795"><span class="annot"><span class="annottext">TcTyVar
</span><a href="#local-6989586621683014795"><span class="hs-identifier hs-var">tv</span></a></span></span><span class="hs-special">)</span><span>
</span><span id="line-1476"></span><span>      </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">TcTyVar -&gt; Bool
</span><a href="#local-6989586621683014764"><span class="hs-identifier hs-var">is_bound</span></a></span><span> </span><span class="annot"><span class="annottext">TcTyVar
</span><a href="#local-6989586621683014795"><span class="hs-identifier hs-var">tv</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">CandidatesQTvs -&gt; TcM CandidatesQTvs
forall a. a -&gt; IOEnv (Env TcGblEnv TcLclEnv) a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="annot"><span class="annottext">CandidatesQTvs
</span><a href="#local-6989586621683014793"><span class="hs-identifier hs-var">dv</span></a></span><span>
</span><span id="line-1477"></span><span>      </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">otherwise</span></span><span>   </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span id="local-6989586621683014796"><span class="annot"><a href="#local-6989586621683014796"><span class="hs-identifier hs-var">m_contents</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">TcTyVar -&gt; IOEnv (Env TcGblEnv TcLclEnv) (Maybe TcType)
</span><a href="GHC.Tc.Utils.TcMType.html#isFilledMetaTyVar_maybe"><span class="hs-identifier hs-var">isFilledMetaTyVar_maybe</span></a></span><span> </span><span class="annot"><span class="annottext">TcTyVar
</span><a href="#local-6989586621683014795"><span class="hs-identifier hs-var">tv</span></a></span><span>
</span><span id="line-1478"></span><span>                         </span><span class="hs-special">;</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><a href="#local-6989586621683014796"><span class="hs-identifier hs-type">m_contents</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-1479"></span><span>                             </span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span id="local-6989586621683014797"><span class="annot"><span class="annottext">TcType
</span><a href="#local-6989586621683014797"><span class="hs-identifier hs-var">ind_ty</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">CandidatesQTvs -&gt; TcType -&gt; TcM CandidatesQTvs
</span><a href="#local-6989586621683014763"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="annot"><span class="annottext">CandidatesQTvs
</span><a href="#local-6989586621683014793"><span class="hs-identifier hs-var">dv</span></a></span><span> </span><span class="annot"><span class="annottext">TcType
</span><a href="#local-6989586621683014797"><span class="hs-identifier hs-var">ind_ty</span></a></span><span>
</span><span id="line-1480"></span><span>                             </span><span class="annot"><span class="annottext">Maybe TcType
</span><span class="hs-identifier hs-var">Nothing</span></span><span>     </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">CandidatesQTvs -&gt; TcTyVar -&gt; TcM CandidatesQTvs
</span><a href="#local-6989586621683014798"><span class="hs-identifier hs-var">go_tv</span></a></span><span> </span><span class="annot"><span class="annottext">CandidatesQTvs
</span><a href="#local-6989586621683014793"><span class="hs-identifier hs-var">dv</span></a></span><span> </span><span class="annot"><span class="annottext">TcTyVar
</span><a href="#local-6989586621683014795"><span class="hs-identifier hs-var">tv</span></a></span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-1481"></span><span>
</span><span id="line-1482"></span><span>    </span><span class="annot"><a href="#local-6989586621683014763"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span id="local-6989586621683014799"><span class="annot"><span class="annottext">CandidatesQTvs
</span><a href="#local-6989586621683014799"><span class="hs-identifier hs-var">dv</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#ForAllTy"><span class="hs-identifier hs-type">ForAllTy</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Types.Var.html#Bndr"><span class="hs-identifier hs-type">Bndr</span></a></span><span> </span><span id="local-6989586621683014802"><span class="annot"><span class="annottext">TcTyVar
</span><a href="#local-6989586621683014802"><span class="hs-identifier hs-var">tv</span></a></span></span><span> </span><span class="annot"><span class="annottext">ForAllTyFlag
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span> </span><span id="local-6989586621683014803"><span class="annot"><span class="annottext">TcType
</span><a href="#local-6989586621683014803"><span class="hs-identifier hs-var">ty</span></a></span></span><span class="hs-special">)</span><span>
</span><span id="line-1483"></span><span>      </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span id="local-6989586621683014804"><span class="annot"><a href="#local-6989586621683014804"><span class="hs-identifier hs-var">dv1</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">TcType
-&gt; Bool
-&gt; TcLevel
-&gt; CoVarSet
-&gt; CandidatesQTvs
-&gt; TcType
-&gt; TcM CandidatesQTvs
</span><a href="GHC.Tc.Utils.TcMType.html#collect_cand_qtvs"><span class="hs-identifier hs-var">collect_cand_qtvs</span></a></span><span> </span><span class="annot"><span class="annottext">TcType
</span><a href="#local-6989586621683014757"><span class="hs-identifier hs-var">orig_ty</span></a></span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">True</span></span><span> </span><span class="annot"><span class="annottext">TcLevel
</span><a href="#local-6989586621683014759"><span class="hs-identifier hs-var">cur_lvl</span></a></span><span> </span><span class="annot"><span class="annottext">CoVarSet
</span><a href="#local-6989586621683014760"><span class="hs-identifier hs-var">bound</span></a></span><span> </span><span class="annot"><span class="annottext">CandidatesQTvs
</span><a href="#local-6989586621683014799"><span class="hs-identifier hs-var">dv</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TcTyVar -&gt; TcType
</span><a href="GHC.Types.Var.html#tyVarKind"><span class="hs-identifier hs-var">tyVarKind</span></a></span><span> </span><span class="annot"><span class="annottext">TcTyVar
</span><a href="#local-6989586621683014802"><span class="hs-identifier hs-var">tv</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1484"></span><span>           </span><span class="hs-special">;</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.TcMType.html#collect_cand_qtvs"><span class="hs-identifier hs-type">collect_cand_qtvs</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683014757"><span class="hs-identifier hs-type">orig_ty</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683014758"><span class="hs-identifier hs-type">is_dep</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683014759"><span class="hs-identifier hs-type">cur_lvl</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621683014760"><span class="hs-identifier hs-type">bound</span></a></span><span> </span><span class="annot"><a href="GHC.Types.Var.Set.html#extendVarSet"><span class="hs-operator hs-type">`extendVarSet`</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683014802"><span class="hs-identifier hs-type">tv</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><a href="#local-6989586621683014804"><span class="hs-identifier hs-type">dv1</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683014803"><span class="hs-identifier hs-type">ty</span></a></span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-1485"></span><span>
</span><span id="line-1486"></span><span>      </span><span class="hs-comment">-- This makes sure that we default e.g. the alpha in Proxy alpha (Any alpha).</span><span>
</span><span id="line-1487"></span><span>      </span><span class="hs-comment">-- Tested in polykinds/NestedProxies.</span><span>
</span><span id="line-1488"></span><span>      </span><span class="hs-comment">-- We just might get this wrong in AppTy, but I don't think that's possible</span><span>
</span><span id="line-1489"></span><span>      </span><span class="hs-comment">-- with -XNoPolyKinds. And fixing it would be non-performant, as we'd need</span><span>
</span><span id="line-1490"></span><span>      </span><span class="hs-comment">-- to look at kinds.</span><span>
</span><span id="line-1491"></span><span>    </span><span id="local-6989586621683014775"><span class="annot"><span class="annottext">go_tc_args :: CandidatesQTvs -&gt; [TyConBinder] -&gt; [TcType] -&gt; TcM CandidatesQTvs
</span><a href="#local-6989586621683014775"><span class="hs-identifier hs-var hs-var">go_tc_args</span></a></span></span><span> </span><span id="local-6989586621683014806"><span class="annot"><span class="annottext">CandidatesQTvs
</span><a href="#local-6989586621683014806"><span class="hs-identifier hs-var">dv</span></a></span></span><span> </span><span class="hs-special">(</span><span id="local-6989586621683014807"><span class="annot"><span class="annottext">TyConBinder
</span><a href="#local-6989586621683014807"><span class="hs-identifier hs-var">tc_bndr</span></a></span></span><span class="annot"><span class="hs-glyph hs-type">:</span></span><span id="local-6989586621683014808"><span class="annot"><span class="annottext">[TyConBinder]
</span><a href="#local-6989586621683014808"><span class="hs-identifier hs-var">tc_bndrs</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span id="local-6989586621683014809"><span class="annot"><span class="annottext">TcType
</span><a href="#local-6989586621683014809"><span class="hs-identifier hs-var">ty</span></a></span></span><span class="annot"><span class="hs-glyph hs-type">:</span></span><span id="local-6989586621683014810"><span class="annot"><span class="annottext">[TcType]
</span><a href="#local-6989586621683014810"><span class="hs-identifier hs-var">tys</span></a></span></span><span class="hs-special">)</span><span>
</span><span id="line-1492"></span><span>      </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span id="local-6989586621683014811"><span class="annot"><a href="#local-6989586621683014811"><span class="hs-identifier hs-var">dv1</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">TcType
-&gt; Bool
-&gt; TcLevel
-&gt; CoVarSet
-&gt; CandidatesQTvs
-&gt; TcType
-&gt; TcM CandidatesQTvs
</span><a href="GHC.Tc.Utils.TcMType.html#collect_cand_qtvs"><span class="hs-identifier hs-var">collect_cand_qtvs</span></a></span><span> </span><span class="annot"><span class="annottext">TcType
</span><a href="#local-6989586621683014757"><span class="hs-identifier hs-var">orig_ty</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621683014758"><span class="hs-identifier hs-var">is_dep</span></a></span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Bool -&gt; Bool
</span><span class="hs-operator hs-var">||</span></span><span> </span><span class="annot"><span class="annottext">TyConBinder -&gt; Bool
</span><a href="GHC.Core.TyCon.html#isNamedTyConBinder"><span class="hs-identifier hs-var">isNamedTyConBinder</span></a></span><span> </span><span class="annot"><span class="annottext">TyConBinder
</span><a href="#local-6989586621683014807"><span class="hs-identifier hs-var">tc_bndr</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1493"></span><span>                                      </span><span class="annot"><span class="annottext">TcLevel
</span><a href="#local-6989586621683014759"><span class="hs-identifier hs-var">cur_lvl</span></a></span><span> </span><span class="annot"><span class="annottext">CoVarSet
</span><a href="#local-6989586621683014760"><span class="hs-identifier hs-var">bound</span></a></span><span> </span><span class="annot"><span class="annottext">CandidatesQTvs
</span><a href="#local-6989586621683014806"><span class="hs-identifier hs-var">dv</span></a></span><span> </span><span class="annot"><span class="annottext">TcType
</span><a href="#local-6989586621683014809"><span class="hs-identifier hs-var">ty</span></a></span><span>
</span><span id="line-1494"></span><span>           </span><span class="hs-special">;</span><span> </span><span class="annot"><a href="#local-6989586621683014775"><span class="hs-identifier hs-type">go_tc_args</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683014811"><span class="hs-identifier hs-type">dv1</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683014808"><span class="hs-identifier hs-type">tc_bndrs</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683014810"><span class="hs-identifier hs-type">tys</span></a></span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-1495"></span><span>    </span><span class="annot"><a href="#local-6989586621683014775"><span class="hs-identifier hs-var">go_tc_args</span></a></span><span> </span><span id="local-6989586621683014814"><span class="annot"><span class="annottext">CandidatesQTvs
</span><a href="#local-6989586621683014814"><span class="hs-identifier hs-var">dv</span></a></span></span><span> </span><span id="local-6989586621683014815"><span class="annot"><span class="annottext">[TyConBinder]
</span><a href="#local-6989586621683014815"><span class="hs-identifier hs-var">_bndrs</span></a></span></span><span> </span><span id="local-6989586621683014816"><span class="annot"><span class="annottext">[TcType]
</span><a href="#local-6989586621683014816"><span class="hs-identifier hs-var">tys</span></a></span></span><span>  </span><span class="hs-comment">-- _bndrs might be non-empty: undersaturation</span><span>
</span><span id="line-1496"></span><span>                              </span><span class="hs-comment">-- tys might be non-empty: oversaturation</span><span>
</span><span id="line-1497"></span><span>                              </span><span class="hs-comment">-- either way, the foldlM is correct</span><span>
</span><span id="line-1498"></span><span>      </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(CandidatesQTvs -&gt; TcType -&gt; TcM CandidatesQTvs)
-&gt; CandidatesQTvs -&gt; [TcType] -&gt; TcM CandidatesQTvs
forall (t :: * -&gt; *) (m :: * -&gt; *) b a.
(Foldable t, Monad m) =&gt;
(b -&gt; a -&gt; m b) -&gt; b -&gt; t a -&gt; m b
</span><span class="hs-identifier hs-var">foldlM</span></span><span> </span><span class="annot"><span class="annottext">CandidatesQTvs -&gt; TcType -&gt; TcM CandidatesQTvs
</span><a href="#local-6989586621683014763"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="annot"><span class="annottext">CandidatesQTvs
</span><a href="#local-6989586621683014814"><span class="hs-identifier hs-var">dv</span></a></span><span> </span><span class="annot"><span class="annottext">[TcType]
</span><a href="#local-6989586621683014816"><span class="hs-identifier hs-var">tys</span></a></span><span>
</span><span id="line-1499"></span><span>
</span><span id="line-1500"></span><span>    </span><span class="hs-comment">-----------------</span><span>
</span><span id="line-1501"></span><span>    </span><span id="local-6989586621683014798"><span class="annot"><span class="annottext">go_tv :: CandidatesQTvs -&gt; TcTyVar -&gt; TcM CandidatesQTvs
</span><a href="#local-6989586621683014798"><span class="hs-identifier hs-var hs-var">go_tv</span></a></span></span><span> </span><span id="local-6989586621683014817"><span class="annot"><span class="annottext">dv :: CandidatesQTvs
</span><a href="#local-6989586621683014817"><span class="hs-identifier hs-var">dv</span></a></span></span><span class="hs-glyph">@</span><span class="hs-special">(</span><span class="annot"><a href="GHC.Tc.Utils.TcMType.html#DV"><span class="hs-identifier hs-type">DV</span></a></span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">dv_kvs :: CandidatesQTvs -&gt; DTyVarSet
</span><a href="GHC.Tc.Utils.TcMType.html#dv_kvs"><span class="hs-identifier hs-var">dv_kvs</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="local-6989586621683014818"><span class="annot"><span class="annottext">DTyVarSet
</span><a href="#local-6989586621683014818"><span class="hs-identifier hs-var">kvs</span></a></span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">dv_tvs :: CandidatesQTvs -&gt; DTyVarSet
</span><a href="GHC.Tc.Utils.TcMType.html#dv_tvs"><span class="hs-identifier hs-var">dv_tvs</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="local-6989586621683014819"><span class="annot"><span class="annottext">DTyVarSet
</span><a href="#local-6989586621683014819"><span class="hs-identifier hs-var">tvs</span></a></span></span><span> </span><span class="hs-special">}</span><span class="hs-special">)</span><span> </span><span id="local-6989586621683014820"><span class="annot"><span class="annottext">TcTyVar
</span><a href="#local-6989586621683014820"><span class="hs-identifier hs-var">tv</span></a></span></span><span>
</span><span id="line-1502"></span><span>      </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">TcLevel
</span><a href="#local-6989586621683014759"><span class="hs-identifier hs-var">cur_lvl</span></a></span><span> </span><span class="annot"><span class="annottext">TcLevel -&gt; TcLevel -&gt; Bool
</span><a href="GHC.Tc.Utils.TcType.html#deeperThanOrSame"><span class="hs-operator hs-var">`deeperThanOrSame`</span></a></span><span> </span><span class="annot"><span class="annottext">TcTyVar -&gt; TcLevel
</span><a href="GHC.Tc.Utils.TcType.html#tcTyVarLevel"><span class="hs-identifier hs-var">tcTyVarLevel</span></a></span><span> </span><span class="annot"><span class="annottext">TcTyVar
</span><a href="#local-6989586621683014820"><span class="hs-identifier hs-var">tv</span></a></span><span>
</span><span id="line-1503"></span><span>      </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">CandidatesQTvs -&gt; TcM CandidatesQTvs
forall a. a -&gt; IOEnv (Env TcGblEnv TcLclEnv) a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="annot"><span class="annottext">CandidatesQTvs
</span><a href="#local-6989586621683014817"><span class="hs-identifier hs-var">dv</span></a></span><span>   </span><span class="hs-comment">-- This variable is from an outer context; skip</span><span>
</span><span id="line-1504"></span><span>                    </span><span class="hs-comment">-- See Note [Use level numbers for quantification]</span><span>
</span><span id="line-1505"></span><span>
</span><span id="line-1506"></span><span>      </span><span class="hs-glyph">|</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">TcTyVar -&gt; TcTyVarDetails
</span><a href="GHC.Types.Var.html#tcTyVarDetails"><span class="hs-identifier hs-var">tcTyVarDetails</span></a></span><span> </span><span class="annot"><span class="annottext">TcTyVar
</span><a href="#local-6989586621683014820"><span class="hs-identifier hs-var">tv</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-1507"></span><span>          </span><span class="annot"><a href="GHC.Tc.Utils.TcType.html#SkolemTv"><span class="hs-identifier hs-type">SkolemTv</span></a></span><span> </span><span class="annot"><span class="annottext">SkolemInfo
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621683014823"><span class="annot"><span class="annottext">TcLevel
</span><a href="#local-6989586621683014823"><span class="hs-identifier hs-var">lvl</span></a></span></span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">TcLevel
</span><a href="#local-6989586621683014823"><span class="hs-identifier hs-var">lvl</span></a></span><span> </span><span class="annot"><span class="annottext">TcLevel -&gt; TcLevel -&gt; Bool
</span><a href="GHC.Tc.Utils.TcType.html#strictlyDeeperThan"><span class="hs-operator hs-var">`strictlyDeeperThan`</span></a></span><span> </span><span class="annot"><span class="annottext">TcLevel -&gt; TcLevel
</span><a href="GHC.Tc.Utils.TcType.html#pushTcLevel"><span class="hs-identifier hs-var">pushTcLevel</span></a></span><span> </span><span class="annot"><span class="annottext">TcLevel
</span><a href="#local-6989586621683014759"><span class="hs-identifier hs-var">cur_lvl</span></a></span><span>
</span><span id="line-1508"></span><span>          </span><span class="annot"><span class="annottext">TcTyVarDetails
</span><span class="hs-identifier">_</span></span><span>                </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">False</span></span><span>
</span><span id="line-1509"></span><span>      </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">CandidatesQTvs -&gt; TcM CandidatesQTvs
forall a. a -&gt; IOEnv (Env TcGblEnv TcLclEnv) a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="annot"><span class="annottext">CandidatesQTvs
</span><a href="#local-6989586621683014817"><span class="hs-identifier hs-var">dv</span></a></span><span>  </span><span class="hs-comment">-- Skip inner skolems</span><span>
</span><span id="line-1510"></span><span>        </span><span class="hs-comment">-- This only happens for erroneous program with bad telescopes</span><span>
</span><span id="line-1511"></span><span>        </span><span class="hs-comment">-- e.g. BadTelescope2:  forall a k (b :: k). SameKind a b</span><span>
</span><span id="line-1512"></span><span>        </span><span class="hs-comment">--      We have (a::k), and at the outer we don't want to quantify</span><span>
</span><span id="line-1513"></span><span>        </span><span class="hs-comment">--      over the already-quantified skolem k.</span><span>
</span><span id="line-1514"></span><span>        </span><span class="hs-comment">-- (Apparently we /do/ want to quantify over skolems whose level sk_lvl is</span><span>
</span><span id="line-1515"></span><span>        </span><span class="hs-comment">-- sk_lvl &gt; cur_lvl; you get lots of failures otherwise. A battle for another day.)</span><span>
</span><span id="line-1516"></span><span>
</span><span id="line-1517"></span><span>      </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">TcTyVar
</span><a href="#local-6989586621683014820"><span class="hs-identifier hs-var">tv</span></a></span><span> </span><span class="annot"><span class="annottext">TcTyVar -&gt; DTyVarSet -&gt; Bool
</span><a href="GHC.Types.Var.Set.html#elemDVarSet"><span class="hs-operator hs-var">`elemDVarSet`</span></a></span><span> </span><span class="annot"><span class="annottext">DTyVarSet
</span><a href="#local-6989586621683014818"><span class="hs-identifier hs-var">kvs</span></a></span><span>
</span><span id="line-1518"></span><span>      </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">CandidatesQTvs -&gt; TcM CandidatesQTvs
forall a. a -&gt; IOEnv (Env TcGblEnv TcLclEnv) a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="annot"><span class="annottext">CandidatesQTvs
</span><a href="#local-6989586621683014817"><span class="hs-identifier hs-var">dv</span></a></span><span>  </span><span class="hs-comment">-- We have met this tyvar already</span><span>
</span><span id="line-1519"></span><span>
</span><span id="line-1520"></span><span>      </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Bool
</span><span class="hs-identifier hs-var">not</span></span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621683014758"><span class="hs-identifier hs-var">is_dep</span></a></span><span>
</span><span id="line-1521"></span><span>      </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">TcTyVar
</span><a href="#local-6989586621683014820"><span class="hs-identifier hs-var">tv</span></a></span><span> </span><span class="annot"><span class="annottext">TcTyVar -&gt; DTyVarSet -&gt; Bool
</span><a href="GHC.Types.Var.Set.html#elemDVarSet"><span class="hs-operator hs-var">`elemDVarSet`</span></a></span><span> </span><span class="annot"><span class="annottext">DTyVarSet
</span><a href="#local-6989586621683014819"><span class="hs-identifier hs-var">tvs</span></a></span><span>
</span><span id="line-1522"></span><span>      </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">CandidatesQTvs -&gt; TcM CandidatesQTvs
forall a. a -&gt; IOEnv (Env TcGblEnv TcLclEnv) a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="annot"><span class="annottext">CandidatesQTvs
</span><a href="#local-6989586621683014817"><span class="hs-identifier hs-var">dv</span></a></span><span>  </span><span class="hs-comment">-- We have met this tyvar already</span><span>
</span><span id="line-1523"></span><span>
</span><span id="line-1524"></span><span>      </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">otherwise</span></span><span>
</span><span id="line-1525"></span><span>      </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span id="local-6989586621683014827"><span class="annot"><a href="#local-6989586621683014827"><span class="hs-identifier hs-var">tv_kind</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">ZonkM TcType -&gt; TcM TcType
forall a. ZonkM a -&gt; TcM a
</span><a href="GHC.Tc.Utils.Monad.html#liftZonkM"><span class="hs-identifier hs-var">liftZonkM</span></a></span><span> </span><span class="annot"><span class="annottext">(ZonkM TcType -&gt; TcM TcType) -&gt; ZonkM TcType -&gt; TcM TcType
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">TcType -&gt; ZonkM TcType
</span><a href="GHC.Tc.Zonk.TcType.html#zonkTcType"><span class="hs-identifier hs-var">zonkTcType</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TcTyVar -&gt; TcType
</span><a href="GHC.Types.Var.html#tyVarKind"><span class="hs-identifier hs-var">tyVarKind</span></a></span><span> </span><span class="annot"><span class="annottext">TcTyVar
</span><a href="#local-6989586621683014820"><span class="hs-identifier hs-var">tv</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1526"></span><span>                 </span><span class="hs-comment">-- This zonk is annoying, but it is necessary, both to</span><span>
</span><span id="line-1527"></span><span>                 </span><span class="hs-comment">-- ensure that the collected candidates have zonked kinds</span><span>
</span><span id="line-1528"></span><span>                 </span><span class="hs-comment">-- (#15795) and to make the naughty check</span><span>
</span><span id="line-1529"></span><span>                 </span><span class="hs-comment">-- (which comes next) works correctly</span><span>
</span><span id="line-1530"></span><span>
</span><span id="line-1531"></span><span>           </span><span class="hs-special">;</span><span> </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621683014830"><span class="annot"><a href="#local-6989586621683014830"><span class="hs-identifier hs-var hs-var">tv_kind_vars</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">TcType -&gt; CoVarSet
</span><a href="GHC.Core.TyCo.FVs.html#tyCoVarsOfType"><span class="hs-identifier hs-var">tyCoVarsOfType</span></a></span><span> </span><span class="annot"><span class="annottext">TcType
</span><a href="#local-6989586621683014827"><span class="hs-identifier hs-var">tv_kind</span></a></span><span>
</span><span id="line-1532"></span><span>           </span><span class="hs-special">;</span><span> </span><span class="hs-keyword">if</span><span> </span><span class="hs-glyph">|</span><span> </span><span class="annot"><a href="GHC.Types.Var.Set.html#intersectsVarSet"><span class="hs-identifier hs-type">intersectsVarSet</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683014760"><span class="hs-identifier hs-type">bound</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683014830"><span class="hs-identifier hs-type">tv_kind_vars</span></a></span><span>
</span><span id="line-1533"></span><span>                   </span><span class="hs-comment">-- the tyvar must not be from an outer context, but we have</span><span>
</span><span id="line-1534"></span><span>                   </span><span class="hs-comment">-- already checked for this.</span><span>
</span><span id="line-1535"></span><span>                   </span><span class="hs-comment">-- See Note [Naughty quantification candidates]</span><span>
</span><span id="line-1536"></span><span>                </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.Monad.html#traceTc"><span class="hs-identifier hs-type">traceTc</span></a></span><span> </span><span class="annot"><span class="hs-string">&quot;Naughty quantifier&quot;</span></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span>
</span><span id="line-1537"></span><span>                          </span><span class="annot"><a href="GHC.Utils.Outputable.html#vcat"><span class="hs-identifier hs-type">vcat</span></a></span><span> </span><span class="hs-special">[</span><span> </span><span class="annot"><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-type">ppr</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683014820"><span class="hs-identifier hs-type">tv</span></a></span><span> </span><span class="annot"><a href="GHC.Utils.Outputable.html#%3C%2B%3E"><span class="hs-operator hs-type">&lt;+&gt;</span></a></span><span> </span><span class="annot"><a href="GHC.Utils.Outputable.html#dcolon"><span class="hs-identifier hs-type">dcolon</span></a></span><span> </span><span class="annot"><a href="GHC.Utils.Outputable.html#%3C%2B%3E"><span class="hs-operator hs-type">&lt;+&gt;</span></a></span><span> </span><span class="annot"><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-type">ppr</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683014827"><span class="hs-identifier hs-type">tv_kind</span></a></span><span>
</span><span id="line-1538"></span><span>                               </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Utils.Outputable.html#text"><span class="hs-identifier hs-type">text</span></a></span><span> </span><span class="annot"><span class="hs-string">&quot;bound:&quot;</span></span><span> </span><span class="annot"><a href="GHC.Utils.Outputable.html#%3C%2B%3E"><span class="hs-operator hs-type">&lt;+&gt;</span></a></span><span> </span><span class="annot"><a href="GHC.Core.TyCo.Ppr.html#pprTyVars"><span class="hs-identifier hs-type">pprTyVars</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Types.Unique.Set.html#nonDetEltsUniqSet"><span class="hs-identifier hs-type">nonDetEltsUniqSet</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683014760"><span class="hs-identifier hs-type">bound</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1539"></span><span>                               </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Utils.Outputable.html#text"><span class="hs-identifier hs-type">text</span></a></span><span> </span><span class="annot"><span class="hs-string">&quot;fvs:&quot;</span></span><span> </span><span class="annot"><a href="GHC.Utils.Outputable.html#%3C%2B%3E"><span class="hs-operator hs-type">&lt;+&gt;</span></a></span><span> </span><span class="annot"><a href="GHC.Core.TyCo.Ppr.html#pprTyVars"><span class="hs-identifier hs-type">pprTyVars</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Types.Unique.Set.html#nonDetEltsUniqSet"><span class="hs-identifier hs-type">nonDetEltsUniqSet</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683014830"><span class="hs-identifier hs-type">tv_kind_vars</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">]</span><span>
</span><span id="line-1540"></span><span>
</span><span id="line-1541"></span><span>                      </span><span class="hs-special">;</span><span> </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621683014836"><span class="annot"><a href="#local-6989586621683014836"><span class="hs-identifier hs-var hs-var">escapees</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">CoVarSet -&gt; CoVarSet -&gt; CoVarSet
</span><a href="GHC.Types.Var.Set.html#intersectVarSet"><span class="hs-identifier hs-var">intersectVarSet</span></a></span><span> </span><span class="annot"><span class="annottext">CoVarSet
</span><a href="#local-6989586621683014760"><span class="hs-identifier hs-var">bound</span></a></span><span> </span><span class="annot"><span class="annottext">CoVarSet
</span><a href="#local-6989586621683014830"><span class="hs-identifier hs-var">tv_kind_vars</span></a></span><span>
</span><span id="line-1542"></span><span>                      </span><span class="hs-special">;</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.TcMType.html#naughtyQuantification"><span class="hs-identifier hs-type">naughtyQuantification</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683014757"><span class="hs-identifier hs-type">orig_ty</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683014820"><span class="hs-identifier hs-type">tv</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683014836"><span class="hs-identifier hs-type">escapees</span></a></span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-1543"></span><span>
</span><span id="line-1544"></span><span>                </span><span class="hs-glyph">|</span><span>  </span><span class="annot"><span class="hs-identifier hs-type">otherwise</span></span><span>
</span><span id="line-1545"></span><span>                </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621683014839"><span class="annot"><a href="#local-6989586621683014839"><span class="hs-identifier hs-var hs-var">tv'</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">TcTyVar
</span><a href="#local-6989586621683014820"><span class="hs-identifier hs-var">tv</span></a></span><span> </span><span class="annot"><span class="annottext">TcTyVar -&gt; TcType -&gt; TcTyVar
</span><a href="GHC.Types.Var.html#setTyVarKind"><span class="hs-operator hs-var">`setTyVarKind`</span></a></span><span> </span><span class="annot"><span class="annottext">TcType
</span><a href="#local-6989586621683014827"><span class="hs-identifier hs-var">tv_kind</span></a></span><span>
</span><span id="line-1546"></span><span>                            </span><span id="local-6989586621683014841"><span class="annot"><a href="#local-6989586621683014841"><span class="hs-identifier hs-var hs-var">dv'</span></a></span></span><span> </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621683014758"><span class="hs-identifier hs-var">is_dep</span></a></span><span>    </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">CandidatesQTvs
</span><a href="#local-6989586621683014817"><span class="hs-identifier hs-var">dv</span></a></span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.TcMType.html#dv_kvs"><span class="hs-identifier hs-var">dv_kvs</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="#local-6989586621683014818"><span class="hs-identifier hs-type">kvs</span></a></span><span> </span><span class="annot"><a href="GHC.Types.Var.Set.html#extendDVarSet"><span class="hs-operator hs-type">`extendDVarSet`</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683014839"><span class="hs-identifier hs-type">tv'</span></a></span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-1547"></span><span>                                </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">otherwise</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">CandidatesQTvs
</span><a href="#local-6989586621683014817"><span class="hs-identifier hs-var">dv</span></a></span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.TcMType.html#dv_tvs"><span class="hs-identifier hs-var">dv_tvs</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="#local-6989586621683014819"><span class="hs-identifier hs-type">tvs</span></a></span><span> </span><span class="annot"><a href="GHC.Types.Var.Set.html#extendDVarSet"><span class="hs-operator hs-type">`extendDVarSet`</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683014839"><span class="hs-identifier hs-type">tv'</span></a></span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-1548"></span><span>                                </span><span class="hs-comment">-- See Note [Order of accumulation]</span><span>
</span><span id="line-1549"></span><span>
</span><span id="line-1550"></span><span>                        </span><span class="hs-comment">-- See Note [Recurring into kinds for candidateQTyVars]</span><span>
</span><span id="line-1551"></span><span>                      </span><span class="hs-special">;</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.TcMType.html#collect_cand_qtvs"><span class="hs-identifier hs-type">collect_cand_qtvs</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683014757"><span class="hs-identifier hs-type">orig_ty</span></a></span><span> </span><span class="annot"><span class="hs-identifier hs-type">True</span></span><span> </span><span class="annot"><a href="#local-6989586621683014759"><span class="hs-identifier hs-type">cur_lvl</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683014760"><span class="hs-identifier hs-type">bound</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683014841"><span class="hs-identifier hs-type">dv'</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683014827"><span class="hs-identifier hs-type">tv_kind</span></a></span><span> </span><span class="hs-special">}</span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-1552"></span><span>
</span><span id="line-1553"></span><span class="annot"><a href="GHC.Tc.Utils.TcMType.html#collect_cand_qtvs_co"><span class="hs-identifier hs-type">collect_cand_qtvs_co</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.TcType.html#TcType"><span class="hs-identifier hs-type">TcType</span></a></span><span> </span><span class="hs-comment">-- original type at top of recursion; for errors</span><span>
</span><span id="line-1554"></span><span>                     </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.TcType.html#TcLevel"><span class="hs-identifier hs-type">TcLevel</span></a></span><span>
</span><span id="line-1555"></span><span>                     </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Types.Var.Set.html#VarSet"><span class="hs-identifier hs-type">VarSet</span></a></span><span> </span><span class="hs-comment">-- bound variables</span><span>
</span><span id="line-1556"></span><span>                     </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.TcMType.html#CandidatesQTvs"><span class="hs-identifier hs-type">CandidatesQTvs</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#Coercion"><span class="hs-identifier hs-type">Coercion</span></a></span><span>
</span><span id="line-1557"></span><span>                     </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#TcM"><span class="hs-identifier hs-type">TcM</span></a></span><span> </span><span class="annot"><a href="GHC.Tc.Utils.TcMType.html#CandidatesQTvs"><span class="hs-identifier hs-type">CandidatesQTvs</span></a></span><span>
</span><span id="line-1558"></span><span id="collect_cand_qtvs_co"><span class="annot"><span class="annottext">collect_cand_qtvs_co :: TcType
-&gt; TcLevel
-&gt; CoVarSet
-&gt; CandidatesQTvs
-&gt; Coercion
-&gt; TcM CandidatesQTvs
</span><a href="GHC.Tc.Utils.TcMType.html#collect_cand_qtvs_co"><span class="hs-identifier hs-var hs-var">collect_cand_qtvs_co</span></a></span></span><span> </span><span id="local-6989586621683014843"><span class="annot"><span class="annottext">TcType
</span><a href="#local-6989586621683014843"><span class="hs-identifier hs-var">orig_ty</span></a></span></span><span> </span><span id="local-6989586621683014844"><span class="annot"><span class="annottext">TcLevel
</span><a href="#local-6989586621683014844"><span class="hs-identifier hs-var">cur_lvl</span></a></span></span><span> </span><span id="local-6989586621683014845"><span class="annot"><span class="annottext">CoVarSet
</span><a href="#local-6989586621683014845"><span class="hs-identifier hs-var">bound</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">CandidatesQTvs -&gt; Coercion -&gt; TcM CandidatesQTvs
</span><a href="#local-6989586621683014846"><span class="hs-identifier hs-var">go_co</span></a></span><span>
</span><span id="line-1559"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-1560"></span><span>    </span><span id="local-6989586621683014846"><span class="annot"><span class="annottext">go_co :: CandidatesQTvs -&gt; Coercion -&gt; TcM CandidatesQTvs
</span><a href="#local-6989586621683014846"><span class="hs-identifier hs-var hs-var">go_co</span></a></span></span><span> </span><span id="local-6989586621683014847"><span class="annot"><span class="annottext">CandidatesQTvs
</span><a href="#local-6989586621683014847"><span class="hs-identifier hs-var">dv</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#Refl"><span class="hs-identifier hs-type">Refl</span></a></span><span> </span><span id="local-6989586621683014849"><span class="annot"><span class="annottext">TcType
</span><a href="#local-6989586621683014849"><span class="hs-identifier hs-var">ty</span></a></span></span><span class="hs-special">)</span><span>               </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">TcType
-&gt; Bool
-&gt; TcLevel
-&gt; CoVarSet
-&gt; CandidatesQTvs
-&gt; TcType
-&gt; TcM CandidatesQTvs
</span><a href="GHC.Tc.Utils.TcMType.html#collect_cand_qtvs"><span class="hs-identifier hs-var">collect_cand_qtvs</span></a></span><span> </span><span class="annot"><span class="annottext">TcType
</span><a href="#local-6989586621683014843"><span class="hs-identifier hs-var">orig_ty</span></a></span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">True</span></span><span> </span><span class="annot"><span class="annottext">TcLevel
</span><a href="#local-6989586621683014844"><span class="hs-identifier hs-var">cur_lvl</span></a></span><span> </span><span class="annot"><span class="annottext">CoVarSet
</span><a href="#local-6989586621683014845"><span class="hs-identifier hs-var">bound</span></a></span><span> </span><span class="annot"><span class="annottext">CandidatesQTvs
</span><a href="#local-6989586621683014847"><span class="hs-identifier hs-var">dv</span></a></span><span> </span><span class="annot"><span class="annottext">TcType
</span><a href="#local-6989586621683014849"><span class="hs-identifier hs-var">ty</span></a></span><span>
</span><span id="line-1561"></span><span>    </span><span class="annot"><a href="#local-6989586621683014846"><span class="hs-identifier hs-var">go_co</span></a></span><span> </span><span id="local-6989586621683014850"><span class="annot"><span class="annottext">CandidatesQTvs
</span><a href="#local-6989586621683014850"><span class="hs-identifier hs-var">dv</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#GRefl"><span class="hs-identifier hs-type">GRefl</span></a></span><span> </span><span class="annot"><span class="annottext">Role
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621683014852"><span class="annot"><span class="annottext">TcType
</span><a href="#local-6989586621683014852"><span class="hs-identifier hs-var">ty</span></a></span></span><span> </span><span id="local-6989586621683014853"><span class="annot"><span class="annottext">MCoercionN
</span><a href="#local-6989586621683014853"><span class="hs-identifier hs-var">mco</span></a></span></span><span class="hs-special">)</span><span>        </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span id="local-6989586621683014854"><span class="annot"><a href="#local-6989586621683014854"><span class="hs-identifier hs-var">dv1</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">TcType
-&gt; Bool
-&gt; TcLevel
-&gt; CoVarSet
-&gt; CandidatesQTvs
-&gt; TcType
-&gt; TcM CandidatesQTvs
</span><a href="GHC.Tc.Utils.TcMType.html#collect_cand_qtvs"><span class="hs-identifier hs-var">collect_cand_qtvs</span></a></span><span> </span><span class="annot"><span class="annottext">TcType
</span><a href="#local-6989586621683014843"><span class="hs-identifier hs-var">orig_ty</span></a></span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">True</span></span><span> </span><span class="annot"><span class="annottext">TcLevel
</span><a href="#local-6989586621683014844"><span class="hs-identifier hs-var">cur_lvl</span></a></span><span> </span><span class="annot"><span class="annottext">CoVarSet
</span><a href="#local-6989586621683014845"><span class="hs-identifier hs-var">bound</span></a></span><span> </span><span class="annot"><span class="annottext">CandidatesQTvs
</span><a href="#local-6989586621683014850"><span class="hs-identifier hs-var">dv</span></a></span><span> </span><span class="annot"><span class="annottext">TcType
</span><a href="#local-6989586621683014852"><span class="hs-identifier hs-var">ty</span></a></span><span>
</span><span id="line-1562"></span><span>                                          </span><span class="hs-special">;</span><span> </span><span class="annot"><a href="#local-6989586621683014855"><span class="hs-identifier hs-type">go_mco</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683014854"><span class="hs-identifier hs-type">dv1</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683014853"><span class="hs-identifier hs-type">mco</span></a></span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-1563"></span><span>    </span><span class="annot"><a href="#local-6989586621683014846"><span class="hs-identifier hs-var">go_co</span></a></span><span> </span><span id="local-6989586621683014856"><span class="annot"><span class="annottext">CandidatesQTvs
</span><a href="#local-6989586621683014856"><span class="hs-identifier hs-var">dv</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#TyConAppCo"><span class="hs-identifier hs-type">TyConAppCo</span></a></span><span> </span><span class="annot"><span class="annottext">Role
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">TyCon
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621683014858"><span class="annot"><span class="annottext">[Coercion]
</span><a href="#local-6989586621683014858"><span class="hs-identifier hs-var">cos</span></a></span></span><span class="hs-special">)</span><span>    </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(CandidatesQTvs -&gt; Coercion -&gt; TcM CandidatesQTvs)
-&gt; CandidatesQTvs -&gt; [Coercion] -&gt; TcM CandidatesQTvs
forall (t :: * -&gt; *) (m :: * -&gt; *) b a.
(Foldable t, Monad m) =&gt;
(b -&gt; a -&gt; m b) -&gt; b -&gt; t a -&gt; m b
</span><span class="hs-identifier hs-var">foldlM</span></span><span> </span><span class="annot"><span class="annottext">CandidatesQTvs -&gt; Coercion -&gt; TcM CandidatesQTvs
</span><a href="#local-6989586621683014846"><span class="hs-identifier hs-var">go_co</span></a></span><span> </span><span class="annot"><span class="annottext">CandidatesQTvs
</span><a href="#local-6989586621683014856"><span class="hs-identifier hs-var">dv</span></a></span><span> </span><span class="annot"><span class="annottext">[Coercion]
</span><a href="#local-6989586621683014858"><span class="hs-identifier hs-var">cos</span></a></span><span>
</span><span id="line-1564"></span><span>    </span><span class="annot"><a href="#local-6989586621683014846"><span class="hs-identifier hs-var">go_co</span></a></span><span> </span><span id="local-6989586621683014859"><span class="annot"><span class="annottext">CandidatesQTvs
</span><a href="#local-6989586621683014859"><span class="hs-identifier hs-var">dv</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#AppCo"><span class="hs-identifier hs-type">AppCo</span></a></span><span> </span><span id="local-6989586621683014861"><span class="annot"><span class="annottext">Coercion
</span><a href="#local-6989586621683014861"><span class="hs-identifier hs-var">co1</span></a></span></span><span> </span><span id="local-6989586621683014862"><span class="annot"><span class="annottext">Coercion
</span><a href="#local-6989586621683014862"><span class="hs-identifier hs-var">co2</span></a></span></span><span class="hs-special">)</span><span>         </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(CandidatesQTvs -&gt; Coercion -&gt; TcM CandidatesQTvs)
-&gt; CandidatesQTvs -&gt; [Coercion] -&gt; TcM CandidatesQTvs
forall (t :: * -&gt; *) (m :: * -&gt; *) b a.
(Foldable t, Monad m) =&gt;
(b -&gt; a -&gt; m b) -&gt; b -&gt; t a -&gt; m b
</span><span class="hs-identifier hs-var">foldlM</span></span><span> </span><span class="annot"><span class="annottext">CandidatesQTvs -&gt; Coercion -&gt; TcM CandidatesQTvs
</span><a href="#local-6989586621683014846"><span class="hs-identifier hs-var">go_co</span></a></span><span> </span><span class="annot"><span class="annottext">CandidatesQTvs
</span><a href="#local-6989586621683014859"><span class="hs-identifier hs-var">dv</span></a></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">Coercion
</span><a href="#local-6989586621683014861"><span class="hs-identifier hs-var">co1</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Coercion
</span><a href="#local-6989586621683014862"><span class="hs-identifier hs-var">co2</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-1565"></span><span>    </span><span class="annot"><a href="#local-6989586621683014846"><span class="hs-identifier hs-var">go_co</span></a></span><span> </span><span id="local-6989586621683014863"><span class="annot"><span class="annottext">CandidatesQTvs
</span><a href="#local-6989586621683014863"><span class="hs-identifier hs-var">dv</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#FunCo"><span class="hs-identifier hs-type">FunCo</span></a></span><span> </span><span class="annot"><span class="annottext">Role
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">FunTyFlag
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">FunTyFlag
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621683014865"><span class="annot"><span class="annottext">Coercion
</span><a href="#local-6989586621683014865"><span class="hs-identifier hs-var">w</span></a></span></span><span> </span><span id="local-6989586621683014866"><span class="annot"><span class="annottext">Coercion
</span><a href="#local-6989586621683014866"><span class="hs-identifier hs-var">co1</span></a></span></span><span> </span><span id="local-6989586621683014867"><span class="annot"><span class="annottext">Coercion
</span><a href="#local-6989586621683014867"><span class="hs-identifier hs-var">co2</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(CandidatesQTvs -&gt; Coercion -&gt; TcM CandidatesQTvs)
-&gt; CandidatesQTvs -&gt; [Coercion] -&gt; TcM CandidatesQTvs
forall (t :: * -&gt; *) (m :: * -&gt; *) b a.
(Foldable t, Monad m) =&gt;
(b -&gt; a -&gt; m b) -&gt; b -&gt; t a -&gt; m b
</span><span class="hs-identifier hs-var">foldlM</span></span><span> </span><span class="annot"><span class="annottext">CandidatesQTvs -&gt; Coercion -&gt; TcM CandidatesQTvs
</span><a href="#local-6989586621683014846"><span class="hs-identifier hs-var">go_co</span></a></span><span> </span><span class="annot"><span class="annottext">CandidatesQTvs
</span><a href="#local-6989586621683014863"><span class="hs-identifier hs-var">dv</span></a></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">Coercion
</span><a href="#local-6989586621683014865"><span class="hs-identifier hs-var">w</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Coercion
</span><a href="#local-6989586621683014866"><span class="hs-identifier hs-var">co1</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Coercion
</span><a href="#local-6989586621683014867"><span class="hs-identifier hs-var">co2</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-1566"></span><span>    </span><span class="annot"><a href="#local-6989586621683014846"><span class="hs-identifier hs-var">go_co</span></a></span><span> </span><span id="local-6989586621683014868"><span class="annot"><span class="annottext">CandidatesQTvs
</span><a href="#local-6989586621683014868"><span class="hs-identifier hs-var">dv</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#AxiomCo"><span class="hs-identifier hs-type">AxiomCo</span></a></span><span> </span><span class="annot"><span class="annottext">CoAxiomRule
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621683014870"><span class="annot"><span class="annottext">[Coercion]
</span><a href="#local-6989586621683014870"><span class="hs-identifier hs-var">cos</span></a></span></span><span class="hs-special">)</span><span>         </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(CandidatesQTvs -&gt; Coercion -&gt; TcM CandidatesQTvs)
-&gt; CandidatesQTvs -&gt; [Coercion] -&gt; TcM CandidatesQTvs
forall (t :: * -&gt; *) (m :: * -&gt; *) b a.
(Foldable t, Monad m) =&gt;
(b -&gt; a -&gt; m b) -&gt; b -&gt; t a -&gt; m b
</span><span class="hs-identifier hs-var">foldlM</span></span><span> </span><span class="annot"><span class="annottext">CandidatesQTvs -&gt; Coercion -&gt; TcM CandidatesQTvs
</span><a href="#local-6989586621683014846"><span class="hs-identifier hs-var">go_co</span></a></span><span> </span><span class="annot"><span class="annottext">CandidatesQTvs
</span><a href="#local-6989586621683014868"><span class="hs-identifier hs-var">dv</span></a></span><span> </span><span class="annot"><span class="annottext">[Coercion]
</span><a href="#local-6989586621683014870"><span class="hs-identifier hs-var">cos</span></a></span><span>
</span><span id="line-1567"></span><span>    </span><span class="annot"><a href="#local-6989586621683014846"><span class="hs-identifier hs-var">go_co</span></a></span><span> </span><span id="local-6989586621683014871"><span class="annot"><span class="annottext">CandidatesQTvs
</span><a href="#local-6989586621683014871"><span class="hs-identifier hs-var">dv</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#UnivCo"><span class="hs-identifier hs-type">UnivCo</span></a></span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">uco_lty :: Coercion -&gt; TcType
</span><a href="GHC.Core.TyCo.Rep.html#uco_lty"><span class="hs-identifier hs-var">uco_lty</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="local-6989586621683014874"><span class="annot"><span class="annottext">TcType
</span><a href="#local-6989586621683014874"><span class="hs-identifier hs-var">t1</span></a></span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">uco_rty :: Coercion -&gt; TcType
</span><a href="GHC.Core.TyCo.Rep.html#uco_rty"><span class="hs-identifier hs-var">uco_rty</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="local-6989586621683014876"><span class="annot"><span class="annottext">TcType
</span><a href="#local-6989586621683014876"><span class="hs-identifier hs-var">t2</span></a></span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">uco_deps :: Coercion -&gt; [Coercion]
</span><a href="GHC.Core.TyCo.Rep.html#uco_deps"><span class="hs-identifier hs-var">uco_deps</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="local-6989586621683014878"><span class="annot"><span class="annottext">[Coercion]
</span><a href="#local-6989586621683014878"><span class="hs-identifier hs-var">deps</span></a></span></span><span> </span><span class="hs-special">}</span><span class="hs-special">)</span><span>
</span><span id="line-1568"></span><span>                                     </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span id="local-6989586621683014879"><span class="annot"><a href="#local-6989586621683014879"><span class="hs-identifier hs-var">dv1</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">TcType
-&gt; Bool
-&gt; TcLevel
-&gt; CoVarSet
-&gt; CandidatesQTvs
-&gt; TcType
-&gt; TcM CandidatesQTvs
</span><a href="GHC.Tc.Utils.TcMType.html#collect_cand_qtvs"><span class="hs-identifier hs-var">collect_cand_qtvs</span></a></span><span> </span><span class="annot"><span class="annottext">TcType
</span><a href="#local-6989586621683014843"><span class="hs-identifier hs-var">orig_ty</span></a></span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">True</span></span><span> </span><span class="annot"><span class="annottext">TcLevel
</span><a href="#local-6989586621683014844"><span class="hs-identifier hs-var">cur_lvl</span></a></span><span> </span><span class="annot"><span class="annottext">CoVarSet
</span><a href="#local-6989586621683014845"><span class="hs-identifier hs-var">bound</span></a></span><span> </span><span class="annot"><span class="annottext">CandidatesQTvs
</span><a href="#local-6989586621683014871"><span class="hs-identifier hs-var">dv</span></a></span><span> </span><span class="annot"><span class="annottext">TcType
</span><a href="#local-6989586621683014874"><span class="hs-identifier hs-var">t1</span></a></span><span>
</span><span id="line-1569"></span><span>                                          </span><span class="hs-special">;</span><span> </span><span id="local-6989586621683014880"><span class="annot"><a href="#local-6989586621683014880"><span class="hs-identifier hs-var">dv2</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.TcMType.html#collect_cand_qtvs"><span class="hs-identifier hs-type">collect_cand_qtvs</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683014843"><span class="hs-identifier hs-type">orig_ty</span></a></span><span> </span><span class="annot"><span class="hs-identifier hs-type">True</span></span><span> </span><span class="annot"><a href="#local-6989586621683014844"><span class="hs-identifier hs-type">cur_lvl</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683014845"><span class="hs-identifier hs-type">bound</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683014879"><span class="hs-identifier hs-type">dv1</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683014876"><span class="hs-identifier hs-type">t2</span></a></span><span>
</span><span id="line-1570"></span><span>                                          </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">foldM</span></span><span> </span><span class="annot"><a href="#local-6989586621683014846"><span class="hs-identifier hs-type">go_co</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683014880"><span class="hs-identifier hs-type">dv2</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683014878"><span class="hs-identifier hs-type">deps</span></a></span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-1571"></span><span>    </span><span class="annot"><a href="#local-6989586621683014846"><span class="hs-identifier hs-var">go_co</span></a></span><span> </span><span id="local-6989586621683014881"><span class="annot"><span class="annottext">CandidatesQTvs
</span><a href="#local-6989586621683014881"><span class="hs-identifier hs-var">dv</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#SymCo"><span class="hs-identifier hs-type">SymCo</span></a></span><span> </span><span id="local-6989586621683014883"><span class="annot"><span class="annottext">Coercion
</span><a href="#local-6989586621683014883"><span class="hs-identifier hs-var">co</span></a></span></span><span class="hs-special">)</span><span>              </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">CandidatesQTvs -&gt; Coercion -&gt; TcM CandidatesQTvs
</span><a href="#local-6989586621683014846"><span class="hs-identifier hs-var">go_co</span></a></span><span> </span><span class="annot"><span class="annottext">CandidatesQTvs
</span><a href="#local-6989586621683014881"><span class="hs-identifier hs-var">dv</span></a></span><span> </span><span class="annot"><span class="annottext">Coercion
</span><a href="#local-6989586621683014883"><span class="hs-identifier hs-var">co</span></a></span><span>
</span><span id="line-1572"></span><span>    </span><span class="annot"><a href="#local-6989586621683014846"><span class="hs-identifier hs-var">go_co</span></a></span><span> </span><span id="local-6989586621683014884"><span class="annot"><span class="annottext">CandidatesQTvs
</span><a href="#local-6989586621683014884"><span class="hs-identifier hs-var">dv</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#TransCo"><span class="hs-identifier hs-type">TransCo</span></a></span><span> </span><span id="local-6989586621683014886"><span class="annot"><span class="annottext">Coercion
</span><a href="#local-6989586621683014886"><span class="hs-identifier hs-var">co1</span></a></span></span><span> </span><span id="local-6989586621683014887"><span class="annot"><span class="annottext">Coercion
</span><a href="#local-6989586621683014887"><span class="hs-identifier hs-var">co2</span></a></span></span><span class="hs-special">)</span><span>       </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(CandidatesQTvs -&gt; Coercion -&gt; TcM CandidatesQTvs)
-&gt; CandidatesQTvs -&gt; [Coercion] -&gt; TcM CandidatesQTvs
forall (t :: * -&gt; *) (m :: * -&gt; *) b a.
(Foldable t, Monad m) =&gt;
(b -&gt; a -&gt; m b) -&gt; b -&gt; t a -&gt; m b
</span><span class="hs-identifier hs-var">foldlM</span></span><span> </span><span class="annot"><span class="annottext">CandidatesQTvs -&gt; Coercion -&gt; TcM CandidatesQTvs
</span><a href="#local-6989586621683014846"><span class="hs-identifier hs-var">go_co</span></a></span><span> </span><span class="annot"><span class="annottext">CandidatesQTvs
</span><a href="#local-6989586621683014884"><span class="hs-identifier hs-var">dv</span></a></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">Coercion
</span><a href="#local-6989586621683014886"><span class="hs-identifier hs-var">co1</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Coercion
</span><a href="#local-6989586621683014887"><span class="hs-identifier hs-var">co2</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-1573"></span><span>    </span><span class="annot"><a href="#local-6989586621683014846"><span class="hs-identifier hs-var">go_co</span></a></span><span> </span><span id="local-6989586621683014888"><span class="annot"><span class="annottext">CandidatesQTvs
</span><a href="#local-6989586621683014888"><span class="hs-identifier hs-var">dv</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#SelCo"><span class="hs-identifier hs-type">SelCo</span></a></span><span> </span><span class="annot"><span class="annottext">CoSel
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621683014890"><span class="annot"><span class="annottext">Coercion
</span><a href="#local-6989586621683014890"><span class="hs-identifier hs-var">co</span></a></span></span><span class="hs-special">)</span><span>            </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">CandidatesQTvs -&gt; Coercion -&gt; TcM CandidatesQTvs
</span><a href="#local-6989586621683014846"><span class="hs-identifier hs-var">go_co</span></a></span><span> </span><span class="annot"><span class="annottext">CandidatesQTvs
</span><a href="#local-6989586621683014888"><span class="hs-identifier hs-var">dv</span></a></span><span> </span><span class="annot"><span class="annottext">Coercion
</span><a href="#local-6989586621683014890"><span class="hs-identifier hs-var">co</span></a></span><span>
</span><span id="line-1574"></span><span>    </span><span class="annot"><a href="#local-6989586621683014846"><span class="hs-identifier hs-var">go_co</span></a></span><span> </span><span id="local-6989586621683014891"><span class="annot"><span class="annottext">CandidatesQTvs
</span><a href="#local-6989586621683014891"><span class="hs-identifier hs-var">dv</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#LRCo"><span class="hs-identifier hs-type">LRCo</span></a></span><span> </span><span class="annot"><span class="annottext">LeftOrRight
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621683014893"><span class="annot"><span class="annottext">Coercion
</span><a href="#local-6989586621683014893"><span class="hs-identifier hs-var">co</span></a></span></span><span class="hs-special">)</span><span>             </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">CandidatesQTvs -&gt; Coercion -&gt; TcM CandidatesQTvs
</span><a href="#local-6989586621683014846"><span class="hs-identifier hs-var">go_co</span></a></span><span> </span><span class="annot"><span class="annottext">CandidatesQTvs
</span><a href="#local-6989586621683014891"><span class="hs-identifier hs-var">dv</span></a></span><span> </span><span class="annot"><span class="annottext">Coercion
</span><a href="#local-6989586621683014893"><span class="hs-identifier hs-var">co</span></a></span><span>
</span><span id="line-1575"></span><span>    </span><span class="annot"><a href="#local-6989586621683014846"><span class="hs-identifier hs-var">go_co</span></a></span><span> </span><span id="local-6989586621683014894"><span class="annot"><span class="annottext">CandidatesQTvs
</span><a href="#local-6989586621683014894"><span class="hs-identifier hs-var">dv</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#InstCo"><span class="hs-identifier hs-type">InstCo</span></a></span><span> </span><span id="local-6989586621683014896"><span class="annot"><span class="annottext">Coercion
</span><a href="#local-6989586621683014896"><span class="hs-identifier hs-var">co1</span></a></span></span><span> </span><span id="local-6989586621683014897"><span class="annot"><span class="annottext">Coercion
</span><a href="#local-6989586621683014897"><span class="hs-identifier hs-var">co2</span></a></span></span><span class="hs-special">)</span><span>        </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(CandidatesQTvs -&gt; Coercion -&gt; TcM CandidatesQTvs)
-&gt; CandidatesQTvs -&gt; [Coercion] -&gt; TcM CandidatesQTvs
forall (t :: * -&gt; *) (m :: * -&gt; *) b a.
(Foldable t, Monad m) =&gt;
(b -&gt; a -&gt; m b) -&gt; b -&gt; t a -&gt; m b
</span><span class="hs-identifier hs-var">foldlM</span></span><span> </span><span class="annot"><span class="annottext">CandidatesQTvs -&gt; Coercion -&gt; TcM CandidatesQTvs
</span><a href="#local-6989586621683014846"><span class="hs-identifier hs-var">go_co</span></a></span><span> </span><span class="annot"><span class="annottext">CandidatesQTvs
</span><a href="#local-6989586621683014894"><span class="hs-identifier hs-var">dv</span></a></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">Coercion
</span><a href="#local-6989586621683014896"><span class="hs-identifier hs-var">co1</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Coercion
</span><a href="#local-6989586621683014897"><span class="hs-identifier hs-var">co2</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-1576"></span><span>    </span><span class="annot"><a href="#local-6989586621683014846"><span class="hs-identifier hs-var">go_co</span></a></span><span> </span><span id="local-6989586621683014898"><span class="annot"><span class="annottext">CandidatesQTvs
</span><a href="#local-6989586621683014898"><span class="hs-identifier hs-var">dv</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#KindCo"><span class="hs-identifier hs-type">KindCo</span></a></span><span> </span><span id="local-6989586621683014900"><span class="annot"><span class="annottext">Coercion
</span><a href="#local-6989586621683014900"><span class="hs-identifier hs-var">co</span></a></span></span><span class="hs-special">)</span><span>             </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">CandidatesQTvs -&gt; Coercion -&gt; TcM CandidatesQTvs
</span><a href="#local-6989586621683014846"><span class="hs-identifier hs-var">go_co</span></a></span><span> </span><span class="annot"><span class="annottext">CandidatesQTvs
</span><a href="#local-6989586621683014898"><span class="hs-identifier hs-var">dv</span></a></span><span> </span><span class="annot"><span class="annottext">Coercion
</span><a href="#local-6989586621683014900"><span class="hs-identifier hs-var">co</span></a></span><span>
</span><span id="line-1577"></span><span>    </span><span class="annot"><a href="#local-6989586621683014846"><span class="hs-identifier hs-var">go_co</span></a></span><span> </span><span id="local-6989586621683014901"><span class="annot"><span class="annottext">CandidatesQTvs
</span><a href="#local-6989586621683014901"><span class="hs-identifier hs-var">dv</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#SubCo"><span class="hs-identifier hs-type">SubCo</span></a></span><span> </span><span id="local-6989586621683014903"><span class="annot"><span class="annottext">Coercion
</span><a href="#local-6989586621683014903"><span class="hs-identifier hs-var">co</span></a></span></span><span class="hs-special">)</span><span>              </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">CandidatesQTvs -&gt; Coercion -&gt; TcM CandidatesQTvs
</span><a href="#local-6989586621683014846"><span class="hs-identifier hs-var">go_co</span></a></span><span> </span><span class="annot"><span class="annottext">CandidatesQTvs
</span><a href="#local-6989586621683014901"><span class="hs-identifier hs-var">dv</span></a></span><span> </span><span class="annot"><span class="annottext">Coercion
</span><a href="#local-6989586621683014903"><span class="hs-identifier hs-var">co</span></a></span><span>
</span><span id="line-1578"></span><span>
</span><span id="line-1579"></span><span>    </span><span class="annot"><a href="#local-6989586621683014846"><span class="hs-identifier hs-var">go_co</span></a></span><span> </span><span id="local-6989586621683014904"><span class="annot"><span class="annottext">CandidatesQTvs
</span><a href="#local-6989586621683014904"><span class="hs-identifier hs-var">dv</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#HoleCo"><span class="hs-identifier hs-type">HoleCo</span></a></span><span> </span><span id="local-6989586621683014905"><span class="annot"><span class="annottext">CoercionHole
</span><a href="#local-6989586621683014905"><span class="hs-identifier hs-var">hole</span></a></span></span><span class="hs-special">)</span><span>
</span><span id="line-1580"></span><span>      </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span id="local-6989586621683014906"><span class="annot"><a href="#local-6989586621683014906"><span class="hs-identifier hs-var">m_co</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">CoercionHole -&gt; IOEnv (Env TcGblEnv TcLclEnv) (Maybe Coercion)
</span><a href="GHC.Tc.Zonk.Type.html#unpackCoercionHole_maybe"><span class="hs-identifier hs-var">unpackCoercionHole_maybe</span></a></span><span> </span><span class="annot"><span class="annottext">CoercionHole
</span><a href="#local-6989586621683014905"><span class="hs-identifier hs-var">hole</span></a></span><span>
</span><span id="line-1581"></span><span>           </span><span class="hs-keyword">case</span><span> </span><span class="annot"><a href="#local-6989586621683014906"><span class="hs-identifier hs-type">m_co</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-1582"></span><span>             </span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span id="local-6989586621683014907"><span class="annot"><span class="annottext">Coercion
</span><a href="#local-6989586621683014907"><span class="hs-identifier hs-var">co</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">CandidatesQTvs -&gt; Coercion -&gt; TcM CandidatesQTvs
</span><a href="#local-6989586621683014846"><span class="hs-identifier hs-var">go_co</span></a></span><span> </span><span class="annot"><span class="annottext">CandidatesQTvs
</span><a href="#local-6989586621683014904"><span class="hs-identifier hs-var">dv</span></a></span><span> </span><span class="annot"><span class="annottext">Coercion
</span><a href="#local-6989586621683014907"><span class="hs-identifier hs-var">co</span></a></span><span>
</span><span id="line-1583"></span><span>             </span><span class="annot"><span class="annottext">Maybe Coercion
</span><span class="hs-identifier hs-var">Nothing</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">CandidatesQTvs -&gt; TcTyVar -&gt; TcM CandidatesQTvs
</span><a href="#local-6989586621683014908"><span class="hs-identifier hs-var">go_cv</span></a></span><span> </span><span class="annot"><span class="annottext">CandidatesQTvs
</span><a href="#local-6989586621683014904"><span class="hs-identifier hs-var">dv</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">CoercionHole -&gt; TcTyVar
</span><a href="GHC.Core.TyCo.Rep.html#coHoleCoVar"><span class="hs-identifier hs-var">coHoleCoVar</span></a></span><span> </span><span class="annot"><span class="annottext">CoercionHole
</span><a href="#local-6989586621683014905"><span class="hs-identifier hs-var">hole</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1584"></span><span>
</span><span id="line-1585"></span><span>    </span><span class="annot"><a href="#local-6989586621683014846"><span class="hs-identifier hs-var">go_co</span></a></span><span> </span><span id="local-6989586621683014910"><span class="annot"><span class="annottext">CandidatesQTvs
</span><a href="#local-6989586621683014910"><span class="hs-identifier hs-var">dv</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#CoVarCo"><span class="hs-identifier hs-type">CoVarCo</span></a></span><span> </span><span id="local-6989586621683014912"><span class="annot"><span class="annottext">TcTyVar
</span><a href="#local-6989586621683014912"><span class="hs-identifier hs-var">cv</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">CandidatesQTvs -&gt; TcTyVar -&gt; TcM CandidatesQTvs
</span><a href="#local-6989586621683014908"><span class="hs-identifier hs-var">go_cv</span></a></span><span> </span><span class="annot"><span class="annottext">CandidatesQTvs
</span><a href="#local-6989586621683014910"><span class="hs-identifier hs-var">dv</span></a></span><span> </span><span class="annot"><span class="annottext">TcTyVar
</span><a href="#local-6989586621683014912"><span class="hs-identifier hs-var">cv</span></a></span><span>
</span><span id="line-1586"></span><span>
</span><span id="line-1587"></span><span>    </span><span class="annot"><a href="#local-6989586621683014846"><span class="hs-identifier hs-var">go_co</span></a></span><span> </span><span id="local-6989586621683014913"><span class="annot"><span class="annottext">CandidatesQTvs
</span><a href="#local-6989586621683014913"><span class="hs-identifier hs-var">dv</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#ForAllCo"><span class="hs-identifier hs-type">ForAllCo</span></a></span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">fco_tcv :: Coercion -&gt; TcTyVar
</span><a href="GHC.Core.TyCo.Rep.html#fco_tcv"><span class="hs-identifier hs-var">fco_tcv</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="local-6989586621683014916"><span class="annot"><span class="annottext">TcTyVar
</span><a href="#local-6989586621683014916"><span class="hs-identifier hs-var">tcv</span></a></span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">fco_kind :: Coercion -&gt; Coercion
</span><a href="GHC.Core.TyCo.Rep.html#fco_kind"><span class="hs-identifier hs-var">fco_kind</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="local-6989586621683014918"><span class="annot"><span class="annottext">Coercion
</span><a href="#local-6989586621683014918"><span class="hs-identifier hs-var">kind_co</span></a></span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">fco_body :: Coercion -&gt; Coercion
</span><a href="GHC.Core.TyCo.Rep.html#fco_body"><span class="hs-identifier hs-var">fco_body</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="local-6989586621683014920"><span class="annot"><span class="annottext">Coercion
</span><a href="#local-6989586621683014920"><span class="hs-identifier hs-var">co</span></a></span></span><span> </span><span class="hs-special">}</span><span class="hs-special">)</span><span>
</span><span id="line-1588"></span><span>      </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span id="local-6989586621683014921"><span class="annot"><a href="#local-6989586621683014921"><span class="hs-identifier hs-var">dv1</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">CandidatesQTvs -&gt; Coercion -&gt; TcM CandidatesQTvs
</span><a href="#local-6989586621683014846"><span class="hs-identifier hs-var">go_co</span></a></span><span> </span><span class="annot"><span class="annottext">CandidatesQTvs
</span><a href="#local-6989586621683014913"><span class="hs-identifier hs-var">dv</span></a></span><span> </span><span class="annot"><span class="annottext">Coercion
</span><a href="#local-6989586621683014918"><span class="hs-identifier hs-var">kind_co</span></a></span><span>
</span><span id="line-1589"></span><span>           </span><span class="hs-special">;</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.TcMType.html#collect_cand_qtvs_co"><span class="hs-identifier hs-type">collect_cand_qtvs_co</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683014843"><span class="hs-identifier hs-type">orig_ty</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683014844"><span class="hs-identifier hs-type">cur_lvl</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621683014845"><span class="hs-identifier hs-type">bound</span></a></span><span> </span><span class="annot"><a href="GHC.Types.Var.Set.html#extendVarSet"><span class="hs-operator hs-type">`extendVarSet`</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683014916"><span class="hs-identifier hs-type">tcv</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><a href="#local-6989586621683014921"><span class="hs-identifier hs-type">dv1</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683014920"><span class="hs-identifier hs-type">co</span></a></span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-1590"></span><span>
</span><span id="line-1591"></span><span>    </span><span id="local-6989586621683014855"><span class="annot"><span class="annottext">go_mco :: CandidatesQTvs -&gt; MCoercionN -&gt; TcM CandidatesQTvs
</span><a href="#local-6989586621683014855"><span class="hs-identifier hs-var hs-var">go_mco</span></a></span></span><span> </span><span id="local-6989586621683014922"><span class="annot"><span class="annottext">CandidatesQTvs
</span><a href="#local-6989586621683014922"><span class="hs-identifier hs-var">dv</span></a></span></span><span> </span><span class="annot"><span class="annottext">MCoercionN
</span><a href="GHC.Core.TyCo.Rep.html#MRefl"><span class="hs-identifier hs-var">MRefl</span></a></span><span>    </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">CandidatesQTvs -&gt; TcM CandidatesQTvs
forall a. a -&gt; IOEnv (Env TcGblEnv TcLclEnv) a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="annot"><span class="annottext">CandidatesQTvs
</span><a href="#local-6989586621683014922"><span class="hs-identifier hs-var">dv</span></a></span><span>
</span><span id="line-1592"></span><span>    </span><span class="annot"><a href="#local-6989586621683014855"><span class="hs-identifier hs-var">go_mco</span></a></span><span> </span><span id="local-6989586621683014924"><span class="annot"><span class="annottext">CandidatesQTvs
</span><a href="#local-6989586621683014924"><span class="hs-identifier hs-var">dv</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#MCo"><span class="hs-identifier hs-type">MCo</span></a></span><span> </span><span id="local-6989586621683014926"><span class="annot"><span class="annottext">Coercion
</span><a href="#local-6989586621683014926"><span class="hs-identifier hs-var">co</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">CandidatesQTvs -&gt; Coercion -&gt; TcM CandidatesQTvs
</span><a href="#local-6989586621683014846"><span class="hs-identifier hs-var">go_co</span></a></span><span> </span><span class="annot"><span class="annottext">CandidatesQTvs
</span><a href="#local-6989586621683014924"><span class="hs-identifier hs-var">dv</span></a></span><span> </span><span class="annot"><span class="annottext">Coercion
</span><a href="#local-6989586621683014926"><span class="hs-identifier hs-var">co</span></a></span><span>
</span><span id="line-1593"></span><span>
</span><span id="line-1594"></span><span>    </span><span class="annot"><a href="#local-6989586621683014908"><span class="hs-identifier hs-type">go_cv</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.TcMType.html#CandidatesQTvs"><span class="hs-identifier hs-type">CandidatesQTvs</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Types.Var.html#CoVar"><span class="hs-identifier hs-type">CoVar</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#TcM"><span class="hs-identifier hs-type">TcM</span></a></span><span> </span><span class="annot"><a href="GHC.Tc.Utils.TcMType.html#CandidatesQTvs"><span class="hs-identifier hs-type">CandidatesQTvs</span></a></span><span>
</span><span id="line-1595"></span><span>    </span><span id="local-6989586621683014908"><span class="annot"><span class="annottext">go_cv :: CandidatesQTvs -&gt; TcTyVar -&gt; TcM CandidatesQTvs
</span><a href="#local-6989586621683014908"><span class="hs-identifier hs-var hs-var">go_cv</span></a></span></span><span> </span><span id="local-6989586621683014928"><span class="annot"><span class="annottext">dv :: CandidatesQTvs
</span><a href="#local-6989586621683014928"><span class="hs-identifier hs-var">dv</span></a></span></span><span class="hs-glyph">@</span><span class="hs-special">(</span><span class="annot"><a href="GHC.Tc.Utils.TcMType.html#DV"><span class="hs-identifier hs-type">DV</span></a></span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">dv_cvs :: CandidatesQTvs -&gt; CoVarSet
</span><a href="GHC.Tc.Utils.TcMType.html#dv_cvs"><span class="hs-identifier hs-var">dv_cvs</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="local-6989586621683014929"><span class="annot"><span class="annottext">CoVarSet
</span><a href="#local-6989586621683014929"><span class="hs-identifier hs-var">cvs</span></a></span></span><span> </span><span class="hs-special">}</span><span class="hs-special">)</span><span> </span><span id="local-6989586621683014930"><span class="annot"><span class="annottext">TcTyVar
</span><a href="#local-6989586621683014930"><span class="hs-identifier hs-var">cv</span></a></span></span><span>
</span><span id="line-1596"></span><span>      </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">TcTyVar -&gt; Bool
</span><a href="#local-6989586621683014931"><span class="hs-identifier hs-var">is_bound</span></a></span><span> </span><span class="annot"><span class="annottext">TcTyVar
</span><a href="#local-6989586621683014930"><span class="hs-identifier hs-var">cv</span></a></span><span>         </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">CandidatesQTvs -&gt; TcM CandidatesQTvs
forall a. a -&gt; IOEnv (Env TcGblEnv TcLclEnv) a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="annot"><span class="annottext">CandidatesQTvs
</span><a href="#local-6989586621683014928"><span class="hs-identifier hs-var">dv</span></a></span><span>
</span><span id="line-1597"></span><span>      </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">TcTyVar
</span><a href="#local-6989586621683014930"><span class="hs-identifier hs-var">cv</span></a></span><span> </span><span class="annot"><span class="annottext">TcTyVar -&gt; CoVarSet -&gt; Bool
</span><a href="GHC.Types.Var.Set.html#elemVarSet"><span class="hs-operator hs-var">`elemVarSet`</span></a></span><span> </span><span class="annot"><span class="annottext">CoVarSet
</span><a href="#local-6989586621683014929"><span class="hs-identifier hs-var">cvs</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">CandidatesQTvs -&gt; TcM CandidatesQTvs
forall a. a -&gt; IOEnv (Env TcGblEnv TcLclEnv) a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="annot"><span class="annottext">CandidatesQTvs
</span><a href="#local-6989586621683014928"><span class="hs-identifier hs-var">dv</span></a></span><span>
</span><span id="line-1598"></span><span>
</span><span id="line-1599"></span><span>        </span><span class="hs-comment">-- See Note [Recurring into kinds for candidateQTyVars]</span><span>
</span><span id="line-1600"></span><span>      </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">otherwise</span></span><span>           </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">TcType
-&gt; Bool
-&gt; TcLevel
-&gt; CoVarSet
-&gt; CandidatesQTvs
-&gt; TcType
-&gt; TcM CandidatesQTvs
</span><a href="GHC.Tc.Utils.TcMType.html#collect_cand_qtvs"><span class="hs-identifier hs-var">collect_cand_qtvs</span></a></span><span> </span><span class="annot"><span class="annottext">TcType
</span><a href="#local-6989586621683014843"><span class="hs-identifier hs-var">orig_ty</span></a></span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">True</span></span><span> </span><span class="annot"><span class="annottext">TcLevel
</span><a href="#local-6989586621683014844"><span class="hs-identifier hs-var">cur_lvl</span></a></span><span> </span><span class="annot"><span class="annottext">CoVarSet
</span><a href="#local-6989586621683014845"><span class="hs-identifier hs-var">bound</span></a></span><span>
</span><span id="line-1601"></span><span>                                    </span><span class="hs-special">(</span><span class="annot"><span class="annottext">CandidatesQTvs
</span><a href="#local-6989586621683014928"><span class="hs-identifier hs-var">dv</span></a></span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.TcMType.html#dv_cvs"><span class="hs-identifier hs-var">dv_cvs</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="#local-6989586621683014929"><span class="hs-identifier hs-type">cvs</span></a></span><span> </span><span class="annot"><a href="GHC.Types.Var.Set.html#extendVarSet"><span class="hs-operator hs-type">`extendVarSet`</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683014930"><span class="hs-identifier hs-type">cv</span></a></span><span> </span><span class="hs-special">}</span><span class="hs-special">)</span><span>
</span><span id="line-1602"></span><span>                                    </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TcTyVar -&gt; TcType
</span><a href="GHC.Types.Id.html#idType"><span class="hs-identifier hs-var">idType</span></a></span><span> </span><span class="annot"><span class="annottext">TcTyVar
</span><a href="#local-6989586621683014930"><span class="hs-identifier hs-var">cv</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1603"></span><span>
</span><span id="line-1604"></span><span>    </span><span id="local-6989586621683014931"><span class="annot"><span class="annottext">is_bound :: TcTyVar -&gt; Bool
</span><a href="#local-6989586621683014931"><span class="hs-identifier hs-var hs-var">is_bound</span></a></span></span><span> </span><span id="local-6989586621683014933"><span class="annot"><span class="annottext">TcTyVar
</span><a href="#local-6989586621683014933"><span class="hs-identifier hs-var">tv</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">TcTyVar
</span><a href="#local-6989586621683014933"><span class="hs-identifier hs-var">tv</span></a></span><span> </span><span class="annot"><span class="annottext">TcTyVar -&gt; CoVarSet -&gt; Bool
</span><a href="GHC.Types.Var.Set.html#elemVarSet"><span class="hs-operator hs-var">`elemVarSet`</span></a></span><span> </span><span class="annot"><span class="annottext">CoVarSet
</span><a href="#local-6989586621683014845"><span class="hs-identifier hs-var">bound</span></a></span><span>
</span><span id="line-1605"></span><span>
</span><span id="line-1606"></span><span class="hs-comment">{- Note [Order of accumulation]
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
You might be tempted (like I was) to use unitDVarSet and mappend
rather than extendDVarSet.  However, the union algorithm for
deterministic sets depends on (roughly) the size of the sets. The
elements from the smaller set end up to the right of the elements from
the larger one. When sets are equal, the left-hand argument to
`mappend` goes to the right of the right-hand argument.

In our case, if we use unitDVarSet and mappend, we learn that the free
variables of (a -&gt; b -&gt; c -&gt; d) are [b, a, c, d], and we then quantify
over them in that order. (The a comes after the b because we union the
singleton sets as ({a} `mappend` {b}), producing {b, a}. Thereafter,
the size criterion works to our advantage.) This is just annoying to
users, so I use `extendDVarSet`, which unambiguously puts the new
element to the right.

Note that the unitDVarSet/mappend implementation would not be wrong
against any specification -- just suboptimal and confounding to users.

Note [Recurring into kinds for candidateQTyVars]
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
First, read Note [Closing over free variable kinds] in GHC.Core.TyCo.FVs, paying
attention to the end of the Note about using an empty bound set when
traversing a variable's kind.

That Note concludes with the recommendation that we empty out the bound
set when recurring into the kind of a type variable. Yet, we do not do
this here. I have two tasks in order to convince you that this code is
right. First, I must show why it is safe to ignore the reasoning in that
Note. Then, I must show why is is necessary to contradict the reasoning in
that Note.

Why it is safe: There can be no
shadowing in the candidateQ... functions: they work on the output of
type inference, which is seeded by the renamer and its insistence to
use different Uniques for different variables. (In contrast, the Core
functions work on the output of optimizations, which may introduce
shadowing.) Without shadowing, the problem studied by
Note [Closing over free variable kinds] in GHC.Core.TyCo.FVs cannot happen.

Why it is necessary:
Wiping the bound set would be just plain wrong here. Consider

  forall k1 k2 (a :: k1). Proxy k2 (a |&gt; (hole :: k1 ~# k2))

We really don't want to think k1 and k2 are free here. (It's true that we'll
never be able to fill in `hole`, but we don't want to go off the rails just
because we have an insoluble coercion hole.) So: why is it wrong to wipe
the bound variables here but right in Core? Because the final statement
in Note [Closing over free variable kinds] in GHC.Core.TyCo.FVs is wrong: not
every variable is either free or bound. A variable can be a hole, too!
The reasoning in that Note then breaks down.

And the reasoning applies just as well to free non-hole variables, so we
retain the bound set always.

-}</span><span>
</span><span id="line-1664"></span><span>
</span><span id="line-1665"></span><span class="annot"><span class="hs-comment">{- *********************************************************************
*                                                                      *
             Quantification
*                                                                      *
************************************************************************

Note [quantifyTyVars]
~~~~~~~~~~~~~~~~~~~~~
quantifyTyVars is given the free vars of a type that we
are about to wrap in a forall.

It takes these free type/kind variables (partitioned into dependent and
non-dependent variables) skolemises metavariables with a TcLevel greater
than the ambient level (see Note [Use level numbers for quantification]).

* This function distinguishes between dependent and non-dependent
  variables only to keep correct defaulting behavior with -XNoPolyKinds.
  With -XPolyKinds, it treats both classes of variables identically.

* quantifyTyVars never quantifies over
    - a coercion variable (or any tv mentioned in the kind of a covar)
    - a runtime-rep variable

Note [Use level numbers for quantification]
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
The level numbers assigned to metavariables are very useful. Not only
do they track touchability (Note [TcLevel invariants] in GHC.Tc.Utils.TcType),
but they also allow us to determine which variables to
generalise. The rule is this:

  When generalising, quantify only metavariables with a TcLevel greater
  than the ambient level.

This works because we bump the level every time we go inside a new
source-level construct. In a traditional generalisation algorithm, we
would gather all free variables that aren't free in an environment.
However, if a variable is in that environment, it will always have a lower
TcLevel: it came from an outer scope. So we can replace the &quot;free in
environment&quot; check with a level-number check.

Here is an example:

  f x = x + (z True)
    where
      z y = x * x

We start by saying (x :: alpha[1]). When inferring the type of z, we'll
quickly discover that z :: alpha[1]. But it would be disastrous to
generalise over alpha in the type of z. So we need to know that alpha
comes from an outer environment. By contrast, the type of y is beta[2],
and we are free to generalise over it. What's the difference between
alpha[1] and beta[2]? Their levels. beta[2] has the right TcLevel for
generalisation, and so we generalise it. alpha[1] does not, and so
we leave it alone.

Note that not *every* variable with a higher level will get
generalised, either due to the monomorphism restriction or other
quirks. See, for example, the code in GHC.Tc.Solver.decidePromotedTyVars
and in GHC.Tc.Gen.HsType.kindGeneralizeSome, both of which exclude
certain otherwise-eligible variables from being generalised.

Using level numbers for quantification is implemented in the candidateQTyVars...
functions, by adding only those variables with a level strictly higher than
the ambient level to the set of candidates.

Note [quantifyTyVars determinism]
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
The results of quantifyTyVars are wrapped in a forall and can end up in the
interface file. One such example is inferred type signatures. They also affect
the results of optimizations, for example worker-wrapper. This means that to
get deterministic builds quantifyTyVars needs to be deterministic.

To achieve this CandidatesQTvs is backed by deterministic sets which allows them
to be later converted to a list in a deterministic order.

For more information about deterministic sets see
Note [Deterministic UniqFM] in GHC.Types.Unique.DFM.
-}</span></span><span>
</span><span id="line-1743"></span><span>
</span><span id="line-1744"></span><span class="annot"><a href="GHC.Tc.Utils.TcMType.html#quantifyTyVars"><span class="hs-identifier hs-type">quantifyTyVars</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Tc.Types.Origin.html#SkolemInfo"><span class="hs-identifier hs-type">SkolemInfo</span></a></span><span>
</span><span id="line-1745"></span><span>               </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Types.Basic.html#NonStandardDefaultingStrategy"><span class="hs-identifier hs-type">NonStandardDefaultingStrategy</span></a></span><span>
</span><span id="line-1746"></span><span>               </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.TcMType.html#CandidatesQTvs"><span class="hs-identifier hs-type">CandidatesQTvs</span></a></span><span>   </span><span class="hs-comment">-- See Note [Dependent type variables]</span><span>
</span><span id="line-1747"></span><span>                                   </span><span class="hs-comment">-- Already zonked</span><span>
</span><span id="line-1748"></span><span>               </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#TcM"><span class="hs-identifier hs-type">TcM</span></a></span><span> </span><span class="hs-special">[</span><span class="annot"><a href="GHC.Types.Var.html#TcTyVar"><span class="hs-identifier hs-type">TcTyVar</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-1749"></span><span class="hs-comment">-- See Note [quantifyTyVars]</span><span>
</span><span id="line-1750"></span><span class="hs-comment">-- Can be given a mixture of TcTyVars and TyVars, in the case of</span><span>
</span><span id="line-1751"></span><span class="hs-comment">--   associated type declarations. Also accepts covars, but *never* returns any.</span><span>
</span><span id="line-1752"></span><span class="hs-comment">-- According to Note [Use level numbers for quantification] and the</span><span>
</span><span id="line-1753"></span><span class="hs-comment">-- invariants on CandidateQTvs, we do not have to filter out variables</span><span>
</span><span id="line-1754"></span><span class="hs-comment">-- free in the environment here. Just quantify unconditionally, subject</span><span>
</span><span id="line-1755"></span><span class="hs-comment">-- to the restrictions in Note [quantifyTyVars].</span><span>
</span><span id="line-1756"></span><span id="quantifyTyVars"><span class="annot"><span class="annottext">quantifyTyVars :: SkolemInfo
-&gt; NonStandardDefaultingStrategy -&gt; CandidatesQTvs -&gt; TcM [TcTyVar]
</span><a href="GHC.Tc.Utils.TcMType.html#quantifyTyVars"><span class="hs-identifier hs-var hs-var">quantifyTyVars</span></a></span></span><span> </span><span id="local-6989586621683014934"><span class="annot"><span class="annottext">SkolemInfo
</span><a href="#local-6989586621683014934"><span class="hs-identifier hs-var">skol_info</span></a></span></span><span> </span><span id="local-6989586621683014935"><span class="annot"><span class="annottext">NonStandardDefaultingStrategy
</span><a href="#local-6989586621683014935"><span class="hs-identifier hs-var">ns_strat</span></a></span></span><span> </span><span id="local-6989586621683014936"><span class="annot"><span class="annottext">CandidatesQTvs
</span><a href="#local-6989586621683014936"><span class="hs-identifier hs-var">dvs</span></a></span></span><span>
</span><span id="line-1757"></span><span>       </span><span class="hs-comment">-- short-circuit common case</span><span>
</span><span id="line-1758"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">CandidatesQTvs -&gt; Bool
</span><a href="GHC.Tc.Utils.TcMType.html#isEmptyCandidates"><span class="hs-identifier hs-var">isEmptyCandidates</span></a></span><span> </span><span class="annot"><span class="annottext">CandidatesQTvs
</span><a href="#local-6989586621683014936"><span class="hs-identifier hs-var">dvs</span></a></span><span>
</span><span id="line-1759"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">String -&gt; SDoc -&gt; TcRn ()
</span><a href="GHC.Tc.Utils.Monad.html#traceTc"><span class="hs-identifier hs-var">traceTc</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;quantifyTyVars has nothing to quantify&quot;</span></span><span> </span><span class="annot"><span class="annottext">SDoc
forall doc. IsOutput doc =&gt; doc
</span><a href="GHC.Utils.Outputable.html#empty"><span class="hs-identifier hs-var">empty</span></a></span><span>
</span><span id="line-1760"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="annottext">[TcTyVar] -&gt; TcM [TcTyVar]
forall a. a -&gt; IOEnv (Env TcGblEnv TcLclEnv) a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-1761"></span><span>
</span><span id="line-1762"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">otherwise</span></span><span>
</span><span id="line-1763"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">String -&gt; SDoc -&gt; TcRn ()
</span><a href="GHC.Tc.Utils.Monad.html#traceTc"><span class="hs-identifier hs-var">traceTc</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;quantifyTyVars {&quot;</span></span><span>
</span><span id="line-1764"></span><span>           </span><span class="hs-special">(</span><span> </span><span class="annot"><span class="annottext">[SDoc] -&gt; SDoc
forall doc. IsDoc doc =&gt; [doc] -&gt; doc
</span><a href="GHC.Utils.Outputable.html#vcat"><span class="hs-identifier hs-var">vcat</span></a></span><span> </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">String -&gt; SDoc
forall doc. IsLine doc =&gt; String -&gt; doc
</span><a href="GHC.Utils.Outputable.html#text"><span class="hs-identifier hs-var">text</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;ns_strat =&quot;</span></span><span> </span><span class="annot"><span class="annottext">SDoc -&gt; SDoc -&gt; SDoc
forall doc. IsLine doc =&gt; doc -&gt; doc -&gt; doc
</span><a href="GHC.Utils.Outputable.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">NonStandardDefaultingStrategy -&gt; SDoc
forall a. Outputable a =&gt; a -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="annot"><span class="annottext">NonStandardDefaultingStrategy
</span><a href="#local-6989586621683014935"><span class="hs-identifier hs-var">ns_strat</span></a></span><span>
</span><span id="line-1765"></span><span>                  </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">String -&gt; SDoc
forall doc. IsLine doc =&gt; String -&gt; doc
</span><a href="GHC.Utils.Outputable.html#text"><span class="hs-identifier hs-var">text</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;dvs =&quot;</span></span><span> </span><span class="annot"><span class="annottext">SDoc -&gt; SDoc -&gt; SDoc
forall doc. IsLine doc =&gt; doc -&gt; doc -&gt; doc
</span><a href="GHC.Utils.Outputable.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">CandidatesQTvs -&gt; SDoc
forall a. Outputable a =&gt; a -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="annot"><span class="annottext">CandidatesQTvs
</span><a href="#local-6989586621683014936"><span class="hs-identifier hs-var">dvs</span></a></span><span> </span><span class="hs-special">]</span><span class="hs-special">)</span><span>
</span><span id="line-1766"></span><span>
</span><span id="line-1767"></span><span>       </span><span class="hs-special">;</span><span> </span><span id="local-6989586621683014938"><span class="annot"><a href="#local-6989586621683014938"><span class="hs-identifier hs-var">undefaulted</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">NonStandardDefaultingStrategy -&gt; CandidatesQTvs -&gt; TcM [TcTyVar]
</span><a href="GHC.Tc.Utils.TcMType.html#defaultTyVars"><span class="hs-identifier hs-var">defaultTyVars</span></a></span><span> </span><span class="annot"><span class="annottext">NonStandardDefaultingStrategy
</span><a href="#local-6989586621683014935"><span class="hs-identifier hs-var">ns_strat</span></a></span><span> </span><span class="annot"><span class="annottext">CandidatesQTvs
</span><a href="#local-6989586621683014936"><span class="hs-identifier hs-var">dvs</span></a></span><span>
</span><span id="line-1768"></span><span>       </span><span class="hs-special">;</span><span> </span><span id="local-6989586621683014940"><span class="annot"><a href="#local-6989586621683014940"><span class="hs-identifier hs-var">final_qtvs</span></a></span></span><span>  </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.Monad.html#liftZonkM"><span class="hs-identifier hs-type">liftZonkM</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="annot"><a href="GHC.Utils.Monad.html#mapMaybeM"><span class="hs-identifier hs-type">mapMaybeM</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683014942"><span class="hs-identifier hs-type">zonk_quant</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683014938"><span class="hs-identifier hs-type">undefaulted</span></a></span><span>
</span><span id="line-1769"></span><span>
</span><span id="line-1770"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.Monad.html#traceTc"><span class="hs-identifier hs-type">traceTc</span></a></span><span> </span><span class="annot"><span class="hs-string">&quot;quantifyTyVars }&quot;</span></span><span>
</span><span id="line-1771"></span><span>           </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Utils.Outputable.html#vcat"><span class="hs-identifier hs-type">vcat</span></a></span><span> </span><span class="hs-special">[</span><span> </span><span class="annot"><a href="GHC.Utils.Outputable.html#text"><span class="hs-identifier hs-type">text</span></a></span><span> </span><span class="annot"><span class="hs-string">&quot;undefaulted:&quot;</span></span><span> </span><span class="annot"><a href="GHC.Utils.Outputable.html#%3C%2B%3E"><span class="hs-operator hs-type">&lt;+&gt;</span></a></span><span> </span><span class="annot"><a href="GHC.Core.TyCo.Ppr.html#pprTyVars"><span class="hs-identifier hs-type">pprTyVars</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683014938"><span class="hs-identifier hs-type">undefaulted</span></a></span><span>
</span><span id="line-1772"></span><span>                 </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Utils.Outputable.html#text"><span class="hs-identifier hs-type">text</span></a></span><span> </span><span class="annot"><span class="hs-string">&quot;final_qtvs:&quot;</span></span><span>  </span><span class="annot"><a href="GHC.Utils.Outputable.html#%3C%2B%3E"><span class="hs-operator hs-type">&lt;+&gt;</span></a></span><span> </span><span class="annot"><a href="GHC.Core.TyCo.Ppr.html#pprTyVars"><span class="hs-identifier hs-type">pprTyVars</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683014940"><span class="hs-identifier hs-type">final_qtvs</span></a></span><span> </span><span class="hs-special">]</span><span class="hs-special">)</span><span>
</span><span id="line-1773"></span><span>
</span><span id="line-1774"></span><span>       </span><span class="hs-comment">-- We should never quantify over coercion variables; check this</span><span>
</span><span id="line-1775"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621683014943"><span class="annot"><a href="#local-6989586621683014943"><span class="hs-identifier hs-var hs-var">co_vars</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(TcTyVar -&gt; Bool) -&gt; [TcTyVar] -&gt; [TcTyVar]
forall a. (a -&gt; Bool) -&gt; [a] -&gt; [a]
</span><span class="hs-identifier hs-var">filter</span></span><span> </span><span class="annot"><span class="annottext">TcTyVar -&gt; Bool
</span><a href="GHC.Types.Var.html#isCoVar"><span class="hs-identifier hs-var">isCoVar</span></a></span><span> </span><span class="annot"><span class="annottext">[TcTyVar]
</span><a href="#local-6989586621683014940"><span class="hs-identifier hs-var">final_qtvs</span></a></span><span>
</span><span id="line-1776"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="annot"><a href="GHC.Utils.Panic.html#massertPpr"><span class="hs-identifier hs-type">massertPpr</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">null</span></span><span> </span><span class="annot"><a href="#local-6989586621683014943"><span class="hs-identifier hs-type">co_vars</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-type">ppr</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683014943"><span class="hs-identifier hs-type">co_vars</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1777"></span><span>
</span><span id="line-1778"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">return</span></span><span> </span><span class="annot"><a href="#local-6989586621683014940"><span class="hs-identifier hs-type">final_qtvs</span></a></span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-1779"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-1780"></span><span>    </span><span class="hs-comment">-- zonk_quant returns a tyvar if it should be quantified over;</span><span>
</span><span id="line-1781"></span><span>    </span><span class="hs-comment">-- otherwise, it returns Nothing. The latter case happens for</span><span>
</span><span id="line-1782"></span><span>    </span><span class="hs-comment">-- non-meta-tyvars</span><span>
</span><span id="line-1783"></span><span>    </span><span id="local-6989586621683014942"><span class="annot"><span class="annottext">zonk_quant :: TcTyVar -&gt; ZonkM (Maybe TcTyVar)
</span><a href="#local-6989586621683014942"><span class="hs-identifier hs-var hs-var">zonk_quant</span></a></span></span><span> </span><span id="local-6989586621683014946"><span class="annot"><span class="annottext">TcTyVar
</span><a href="#local-6989586621683014946"><span class="hs-identifier hs-var">tkv</span></a></span></span><span>
</span><span id="line-1784"></span><span>      </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Bool
</span><span class="hs-identifier hs-var">not</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TcTyVar -&gt; Bool
</span><a href="GHC.Types.Var.html#isTyVar"><span class="hs-identifier hs-var">isTyVar</span></a></span><span> </span><span class="annot"><span class="annottext">TcTyVar
</span><a href="#local-6989586621683014946"><span class="hs-identifier hs-var">tkv</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1785"></span><span>      </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Maybe TcTyVar -&gt; ZonkM (Maybe TcTyVar)
forall a. a -&gt; ZonkM a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="annot"><span class="annottext">Maybe TcTyVar
forall a. Maybe a
</span><span class="hs-identifier hs-var">Nothing</span></span><span>   </span><span class="hs-comment">-- this can happen for a covar that's associated with</span><span>
</span><span id="line-1786"></span><span>                         </span><span class="hs-comment">-- a coercion hole. Test case: typecheck/should_compile/T2494</span><span>
</span><span id="line-1787"></span><span>
</span><span id="line-1788"></span><span>      </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">otherwise</span></span><span>
</span><span id="line-1789"></span><span>      </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">TcTyVar -&gt; Maybe TcTyVar
forall a. a -&gt; Maybe a
</span><span class="hs-identifier hs-var">Just</span></span><span> </span><span class="annot"><span class="annottext">(TcTyVar -&gt; Maybe TcTyVar)
-&gt; ZonkM TcTyVar -&gt; ZonkM (Maybe TcTyVar)
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="annot"><span class="annottext">SkolemInfo -&gt; TcTyVar -&gt; ZonkM TcTyVar
</span><a href="GHC.Tc.Utils.TcMType.html#skolemiseQuantifiedTyVar"><span class="hs-identifier hs-var">skolemiseQuantifiedTyVar</span></a></span><span> </span><span class="annot"><span class="annottext">SkolemInfo
</span><a href="#local-6989586621683014934"><span class="hs-identifier hs-var">skol_info</span></a></span><span> </span><span class="annot"><span class="annottext">TcTyVar
</span><a href="#local-6989586621683014946"><span class="hs-identifier hs-var">tkv</span></a></span><span>
</span><span id="line-1790"></span><span>
</span><span id="line-1791"></span><span class="annot"><a href="GHC.Tc.Utils.TcMType.html#isQuantifiableTv"><span class="hs-identifier hs-type">isQuantifiableTv</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.TcType.html#TcLevel"><span class="hs-identifier hs-type">TcLevel</span></a></span><span>   </span><span class="hs-comment">-- Level of the context, outside the quantification</span><span>
</span><span id="line-1792"></span><span>                 </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Types.Var.html#TcTyVar"><span class="hs-identifier hs-type">TcTyVar</span></a></span><span>
</span><span id="line-1793"></span><span>                 </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Bool</span></span><span>
</span><span id="line-1794"></span><span id="isQuantifiableTv"><span class="annot"><span class="annottext">isQuantifiableTv :: TcLevel -&gt; TcTyVar -&gt; Bool
</span><a href="GHC.Tc.Utils.TcMType.html#isQuantifiableTv"><span class="hs-identifier hs-var hs-var">isQuantifiableTv</span></a></span></span><span> </span><span id="local-6989586621683014948"><span class="annot"><span class="annottext">TcLevel
</span><a href="#local-6989586621683014948"><span class="hs-identifier hs-var">outer_tclvl</span></a></span></span><span> </span><span id="local-6989586621683014949"><span class="annot"><span class="annottext">TcTyVar
</span><a href="#local-6989586621683014949"><span class="hs-identifier hs-var">tcv</span></a></span></span><span>
</span><span id="line-1795"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">TcTyVar -&gt; Bool
</span><a href="GHC.Types.Var.html#isTcTyVar"><span class="hs-identifier hs-var">isTcTyVar</span></a></span><span> </span><span class="annot"><span class="annottext">TcTyVar
</span><a href="#local-6989586621683014949"><span class="hs-identifier hs-var">tcv</span></a></span><span>  </span><span class="hs-comment">-- Might be a CoVar; change this when gather covars separately</span><span>
</span><span id="line-1796"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">TcTyVar -&gt; TcLevel
</span><a href="GHC.Tc.Utils.TcType.html#tcTyVarLevel"><span class="hs-identifier hs-var">tcTyVarLevel</span></a></span><span> </span><span class="annot"><span class="annottext">TcTyVar
</span><a href="#local-6989586621683014949"><span class="hs-identifier hs-var">tcv</span></a></span><span> </span><span class="annot"><span class="annottext">TcLevel -&gt; TcLevel -&gt; Bool
</span><a href="GHC.Tc.Utils.TcType.html#strictlyDeeperThan"><span class="hs-operator hs-var">`strictlyDeeperThan`</span></a></span><span> </span><span class="annot"><span class="annottext">TcLevel
</span><a href="#local-6989586621683014948"><span class="hs-identifier hs-var">outer_tclvl</span></a></span><span>
</span><span id="line-1797"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">otherwise</span></span><span>
</span><span id="line-1798"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">False</span></span><span>
</span><span id="line-1799"></span><span>
</span><span id="line-1800"></span><span class="annot"><a href="GHC.Tc.Utils.TcMType.html#zonkAndSkolemise"><span class="hs-identifier hs-type">zonkAndSkolemise</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Tc.Types.Origin.html#SkolemInfo"><span class="hs-identifier hs-type">SkolemInfo</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.TcType.html#TcTyCoVar"><span class="hs-identifier hs-type">TcTyCoVar</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Zonk.Monad.html#ZonkM"><span class="hs-identifier hs-type">ZonkM</span></a></span><span> </span><span class="annot"><a href="GHC.Tc.Utils.TcType.html#TcTyCoVar"><span class="hs-identifier hs-type">TcTyCoVar</span></a></span><span>
</span><span id="line-1801"></span><span class="hs-comment">-- A tyvar binder is never a unification variable (TauTv),</span><span>
</span><span id="line-1802"></span><span class="hs-comment">-- rather it is always a skolem. It *might* be a TyVarTv.</span><span>
</span><span id="line-1803"></span><span class="hs-comment">-- (Because non-CUSK type declarations use TyVarTvs.)</span><span>
</span><span id="line-1804"></span><span class="hs-comment">-- Regardless, it may have a kind that has not yet been zonked,</span><span>
</span><span id="line-1805"></span><span class="hs-comment">-- and may include kind unification variables.</span><span>
</span><span id="line-1806"></span><span id="zonkAndSkolemise"><span class="annot"><span class="annottext">zonkAndSkolemise :: SkolemInfo -&gt; TcTyVar -&gt; ZonkM TcTyVar
</span><a href="GHC.Tc.Utils.TcMType.html#zonkAndSkolemise"><span class="hs-identifier hs-var hs-var">zonkAndSkolemise</span></a></span></span><span> </span><span id="local-6989586621683014951"><span class="annot"><span class="annottext">SkolemInfo
</span><a href="#local-6989586621683014951"><span class="hs-identifier hs-var">skol_info</span></a></span></span><span> </span><span id="local-6989586621683014952"><span class="annot"><span class="annottext">TcTyVar
</span><a href="#local-6989586621683014952"><span class="hs-identifier hs-var">tyvar</span></a></span></span><span>
</span><span id="line-1807"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">TcTyVar -&gt; Bool
</span><a href="GHC.Tc.Utils.TcType.html#isTyVarTyVar"><span class="hs-identifier hs-var">isTyVarTyVar</span></a></span><span> </span><span class="annot"><span class="annottext">TcTyVar
</span><a href="#local-6989586621683014952"><span class="hs-identifier hs-var">tyvar</span></a></span><span>
</span><span id="line-1808"></span><span>     </span><span class="hs-comment">-- We want to preserve the binding location of the original TyVarTv.</span><span>
</span><span id="line-1809"></span><span>     </span><span class="hs-comment">-- This is important for error messages. If we don't do this, then</span><span>
</span><span id="line-1810"></span><span>     </span><span class="hs-comment">-- we get bad locations in, e.g., typecheck/should_fail/T2688</span><span>
</span><span id="line-1811"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span id="local-6989586621683014954"><span class="annot"><a href="#local-6989586621683014954"><span class="hs-identifier hs-var">zonked_tyvar</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">HasDebugCallStack =&gt; TcTyVar -&gt; ZonkM TcTyVar
TcTyVar -&gt; ZonkM TcTyVar
</span><a href="GHC.Tc.Zonk.TcType.html#zonkTcTyVarToTcTyVar"><span class="hs-identifier hs-var">zonkTcTyVarToTcTyVar</span></a></span><span> </span><span class="annot"><span class="annottext">TcTyVar
</span><a href="#local-6989586621683014952"><span class="hs-identifier hs-var">tyvar</span></a></span><span>
</span><span id="line-1812"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.TcMType.html#skolemiseQuantifiedTyVar"><span class="hs-identifier hs-type">skolemiseQuantifiedTyVar</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683014951"><span class="hs-identifier hs-type">skol_info</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683014954"><span class="hs-identifier hs-type">zonked_tyvar</span></a></span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-1813"></span><span>
</span><span id="line-1814"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">otherwise</span></span><span>
</span><span id="line-1815"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Bool -&gt; SDoc -&gt; ZonkM TcTyVar -&gt; ZonkM TcTyVar
forall a. HasCallStack =&gt; Bool -&gt; SDoc -&gt; a -&gt; a
</span><a href="GHC.Utils.Panic.html#assertPpr"><span class="hs-identifier hs-var">assertPpr</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TcTyVar -&gt; Bool
</span><a href="GHC.Tc.Utils.TcType.html#isImmutableTyVar"><span class="hs-identifier hs-var">isImmutableTyVar</span></a></span><span> </span><span class="annot"><span class="annottext">TcTyVar
</span><a href="#local-6989586621683014952"><span class="hs-identifier hs-var">tyvar</span></a></span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Bool -&gt; Bool
</span><span class="hs-operator hs-var">||</span></span><span> </span><span class="annot"><span class="annottext">TcTyVar -&gt; Bool
</span><a href="GHC.Types.Var.html#isCoVar"><span class="hs-identifier hs-var">isCoVar</span></a></span><span> </span><span class="annot"><span class="annottext">TcTyVar
</span><a href="#local-6989586621683014952"><span class="hs-identifier hs-var">tyvar</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TcTyVar -&gt; SDoc
</span><a href="GHC.Core.TyCo.Ppr.html#pprTyVar"><span class="hs-identifier hs-var">pprTyVar</span></a></span><span> </span><span class="annot"><span class="annottext">TcTyVar
</span><a href="#local-6989586621683014952"><span class="hs-identifier hs-var">tyvar</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(ZonkM TcTyVar -&gt; ZonkM TcTyVar) -&gt; ZonkM TcTyVar -&gt; ZonkM TcTyVar
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-1816"></span><span>    </span><span class="annot"><span class="annottext">TcTyVar -&gt; ZonkM TcTyVar
</span><a href="GHC.Tc.Zonk.TcType.html#zonkTyCoVarKind"><span class="hs-identifier hs-var">zonkTyCoVarKind</span></a></span><span> </span><span class="annot"><span class="annottext">TcTyVar
</span><a href="#local-6989586621683014952"><span class="hs-identifier hs-var">tyvar</span></a></span><span>
</span><span id="line-1817"></span><span>
</span><span id="line-1818"></span><span class="annot"><a href="GHC.Tc.Utils.TcMType.html#skolemiseQuantifiedTyVar"><span class="hs-identifier hs-type">skolemiseQuantifiedTyVar</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Tc.Types.Origin.html#SkolemInfo"><span class="hs-identifier hs-type">SkolemInfo</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Types.Var.html#TcTyVar"><span class="hs-identifier hs-type">TcTyVar</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Zonk.Monad.html#ZonkM"><span class="hs-identifier hs-type">ZonkM</span></a></span><span> </span><span class="annot"><a href="GHC.Types.Var.html#TcTyVar"><span class="hs-identifier hs-type">TcTyVar</span></a></span><span>
</span><span id="line-1819"></span><span class="hs-comment">-- The quantified type variables often include meta type variables</span><span>
</span><span id="line-1820"></span><span class="hs-comment">-- we want to freeze them into ordinary type variables</span><span>
</span><span id="line-1821"></span><span class="hs-comment">-- The meta tyvar is updated to point to the new skolem TyVar.  Now any</span><span>
</span><span id="line-1822"></span><span class="hs-comment">-- bound occurrences of the original type variable will get zonked to</span><span>
</span><span id="line-1823"></span><span class="hs-comment">-- the immutable version.</span><span>
</span><span id="line-1824"></span><span class="hs-comment">--</span><span>
</span><span id="line-1825"></span><span class="hs-comment">-- We leave skolem TyVars alone; they are immutable.</span><span>
</span><span id="line-1826"></span><span class="hs-comment">--</span><span>
</span><span id="line-1827"></span><span class="hs-comment">-- This function is called on both kind and type variables,</span><span>
</span><span id="line-1828"></span><span class="hs-comment">-- but kind variables *only* if PolyKinds is on.</span><span>
</span><span id="line-1829"></span><span>
</span><span id="line-1830"></span><span id="skolemiseQuantifiedTyVar"><span class="annot"><span class="annottext">skolemiseQuantifiedTyVar :: SkolemInfo -&gt; TcTyVar -&gt; ZonkM TcTyVar
</span><a href="GHC.Tc.Utils.TcMType.html#skolemiseQuantifiedTyVar"><span class="hs-identifier hs-var hs-var">skolemiseQuantifiedTyVar</span></a></span></span><span> </span><span id="local-6989586621683014959"><span class="annot"><span class="annottext">SkolemInfo
</span><a href="#local-6989586621683014959"><span class="hs-identifier hs-var">skol_info</span></a></span></span><span> </span><span id="local-6989586621683014960"><span class="annot"><span class="annottext">TcTyVar
</span><a href="#local-6989586621683014960"><span class="hs-identifier hs-var">tv</span></a></span></span><span>
</span><span id="line-1831"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">TcTyVar -&gt; TcTyVarDetails
</span><a href="GHC.Types.Var.html#tcTyVarDetails"><span class="hs-identifier hs-var">tcTyVarDetails</span></a></span><span> </span><span class="annot"><span class="annottext">TcTyVar
</span><a href="#local-6989586621683014960"><span class="hs-identifier hs-var">tv</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-1832"></span><span>      </span><span class="annot"><a href="GHC.Tc.Utils.TcType.html#MetaTv"><span class="hs-identifier hs-type">MetaTv</span></a></span><span> </span><span class="hs-special">{</span><span class="hs-special">}</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">SkolemInfo -&gt; TcTyVar -&gt; ZonkM TcTyVar
</span><a href="GHC.Tc.Utils.TcMType.html#skolemiseUnboundMetaTyVar"><span class="hs-identifier hs-var">skolemiseUnboundMetaTyVar</span></a></span><span> </span><span class="annot"><span class="annottext">SkolemInfo
</span><a href="#local-6989586621683014959"><span class="hs-identifier hs-var">skol_info</span></a></span><span> </span><span class="annot"><span class="annottext">TcTyVar
</span><a href="#local-6989586621683014960"><span class="hs-identifier hs-var">tv</span></a></span><span>
</span><span id="line-1833"></span><span>
</span><span id="line-1834"></span><span>      </span><span class="annot"><a href="GHC.Tc.Utils.TcType.html#SkolemTv"><span class="hs-identifier hs-type">SkolemTv</span></a></span><span> </span><span class="annot"><span class="annottext">SkolemInfo
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621683014962"><span class="annot"><span class="annottext">TcLevel
</span><a href="#local-6989586621683014962"><span class="hs-identifier hs-var">lvl</span></a></span></span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier">_</span></span><span>  </span><span class="hs-comment">-- It might be a skolem type variable,</span><span>
</span><span id="line-1835"></span><span>                        </span><span class="hs-comment">-- for example from a user type signature</span><span>
</span><span id="line-1836"></span><span>        </span><span class="hs-comment">-- But it might also be a shared meta-variable across several</span><span>
</span><span id="line-1837"></span><span>        </span><span class="hs-comment">-- type declarations, each with its own skol_info. The first</span><span>
</span><span id="line-1838"></span><span>        </span><span class="hs-comment">-- will skolemise it, but the other uses must update its</span><span>
</span><span id="line-1839"></span><span>        </span><span class="hs-comment">-- skolem info (#22379)</span><span>
</span><span id="line-1840"></span><span>        </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span id="local-6989586621683014963"><span class="annot"><a href="#local-6989586621683014963"><span class="hs-identifier hs-var">kind</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">TcType -&gt; ZonkM TcType
</span><a href="GHC.Tc.Zonk.TcType.html#zonkTcType"><span class="hs-identifier hs-var">zonkTcType</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TcTyVar -&gt; TcType
</span><a href="GHC.Types.Var.html#tyVarKind"><span class="hs-identifier hs-var">tyVarKind</span></a></span><span> </span><span class="annot"><span class="annottext">TcTyVar
</span><a href="#local-6989586621683014960"><span class="hs-identifier hs-var">tv</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1841"></span><span>              </span><span class="hs-special">;</span><span> </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621683014964"><span class="annot"><a href="#local-6989586621683014964"><span class="hs-identifier hs-var hs-var">details</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">SkolemInfo -&gt; TcLevel -&gt; Bool -&gt; TcTyVarDetails
</span><a href="GHC.Tc.Utils.TcType.html#SkolemTv"><span class="hs-identifier hs-var">SkolemTv</span></a></span><span> </span><span class="annot"><span class="annottext">SkolemInfo
</span><a href="#local-6989586621683014959"><span class="hs-identifier hs-var">skol_info</span></a></span><span> </span><span class="annot"><span class="annottext">TcLevel
</span><a href="#local-6989586621683014962"><span class="hs-identifier hs-var">lvl</span></a></span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">False</span></span><span>
</span><span id="line-1842"></span><span>                    </span><span id="local-6989586621683014965"><span class="annot"><a href="#local-6989586621683014965"><span class="hs-identifier hs-var hs-var">name</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">TcTyVar -&gt; Name
</span><a href="GHC.Types.Var.html#tyVarName"><span class="hs-identifier hs-var">tyVarName</span></a></span><span> </span><span class="annot"><span class="annottext">TcTyVar
</span><a href="#local-6989586621683014960"><span class="hs-identifier hs-var">tv</span></a></span><span>
</span><span id="line-1843"></span><span>              </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">return</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Types.Var.html#mkTcTyVar"><span class="hs-identifier hs-type">mkTcTyVar</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683014965"><span class="hs-identifier hs-type">name</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683014963"><span class="hs-identifier hs-type">kind</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683014964"><span class="hs-identifier hs-type">details</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-1844"></span><span>
</span><span id="line-1845"></span><span>      </span><span id="local-6989586621683014966"><span class="annot"><span class="annottext">TcTyVarDetails
</span><a href="#local-6989586621683014966"><span class="hs-identifier hs-var">_other</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">String -&gt; SDoc -&gt; ZonkM TcTyVar
forall a. HasCallStack =&gt; String -&gt; SDoc -&gt; a
</span><a href="GHC.Utils.Panic.html#pprPanic"><span class="hs-identifier hs-var">pprPanic</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;skolemiseQuantifiedTyVar&quot;</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TcTyVar -&gt; SDoc
forall a. Outputable a =&gt; a -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="annot"><span class="annottext">TcTyVar
</span><a href="#local-6989586621683014960"><span class="hs-identifier hs-var">tv</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-comment">-- RuntimeUnk</span><span>
</span><span id="line-1846"></span><span>
</span><span id="line-1847"></span><span class="hs-comment">-- | Default a type variable using the given defaulting strategy.</span><span>
</span><span id="line-1848"></span><span class="hs-comment">--</span><span>
</span><span id="line-1849"></span><span class="hs-comment">-- See Note [Type variable defaulting options] in GHC.Types.Basic.</span><span>
</span><span id="line-1850"></span><span class="annot"><a href="GHC.Tc.Utils.TcMType.html#defaultTyVar"><span class="hs-identifier hs-type">defaultTyVar</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Types.Basic.html#DefaultingStrategy"><span class="hs-identifier hs-type">DefaultingStrategy</span></a></span><span>
</span><span id="line-1851"></span><span>             </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Types.Var.html#TcTyVar"><span class="hs-identifier hs-type">TcTyVar</span></a></span><span>    </span><span class="hs-comment">-- If it's a MetaTyVar then it is unbound</span><span>
</span><span id="line-1852"></span><span>             </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#TcM"><span class="hs-identifier hs-type">TcM</span></a></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Bool</span></span><span>   </span><span class="hs-comment">-- True &lt;=&gt; defaulted away altogether</span><span>
</span><span id="line-1853"></span><span id="defaultTyVar"><span class="annot"><span class="annottext">defaultTyVar :: DefaultingStrategy -&gt; TcTyVar -&gt; TcRnIf TcGblEnv TcLclEnv Bool
</span><a href="GHC.Tc.Utils.TcMType.html#defaultTyVar"><span class="hs-identifier hs-var hs-var">defaultTyVar</span></a></span></span><span> </span><span id="local-6989586621683014967"><span class="annot"><span class="annottext">DefaultingStrategy
</span><a href="#local-6989586621683014967"><span class="hs-identifier hs-var">def_strat</span></a></span></span><span> </span><span id="local-6989586621683014968"><span class="annot"><span class="annottext">TcTyVar
</span><a href="#local-6989586621683014968"><span class="hs-identifier hs-var">tv</span></a></span></span><span>
</span><span id="line-1854"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Bool
</span><span class="hs-identifier hs-var">not</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TcTyVar -&gt; Bool
</span><a href="GHC.Tc.Utils.TcType.html#isMetaTyVar"><span class="hs-identifier hs-var">isMetaTyVar</span></a></span><span> </span><span class="annot"><span class="annottext">TcTyVar
</span><a href="#local-6989586621683014968"><span class="hs-identifier hs-var">tv</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1855"></span><span>  </span><span class="annot"><span class="annottext">Bool -&gt; Bool -&gt; Bool
</span><span class="hs-operator hs-var">||</span></span><span> </span><span class="annot"><span class="annottext">TcTyVar -&gt; Bool
</span><a href="GHC.Tc.Utils.TcType.html#isTyVarTyVar"><span class="hs-identifier hs-var">isTyVarTyVar</span></a></span><span> </span><span class="annot"><span class="annottext">TcTyVar
</span><a href="#local-6989586621683014968"><span class="hs-identifier hs-var">tv</span></a></span><span>
</span><span id="line-1856"></span><span>    </span><span class="hs-comment">-- Do not default TyVarTvs. Doing so would violate the invariants</span><span>
</span><span id="line-1857"></span><span>    </span><span class="hs-comment">-- on TyVarTvs; see Note [TyVarTv] in GHC.Tc.Utils.TcMType.</span><span>
</span><span id="line-1858"></span><span>    </span><span class="hs-comment">-- #13343 is an example; #14555 is another</span><span>
</span><span id="line-1859"></span><span>    </span><span class="hs-comment">-- See Note [Inferring kinds for type declarations] in GHC.Tc.TyCl</span><span>
</span><span id="line-1860"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Bool -&gt; TcRnIf TcGblEnv TcLclEnv Bool
forall a. a -&gt; IOEnv (Env TcGblEnv TcLclEnv) a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">False</span></span><span>
</span><span id="line-1861"></span><span>
</span><span id="line-1862"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">TcTyVar -&gt; Bool
</span><a href="GHC.Core.Type.html#isRuntimeRepVar"><span class="hs-identifier hs-var">isRuntimeRepVar</span></a></span><span> </span><span class="annot"><span class="annottext">TcTyVar
</span><a href="#local-6989586621683014968"><span class="hs-identifier hs-var">tv</span></a></span><span>
</span><span id="line-1863"></span><span>  </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621683014970"><span class="hs-identifier hs-var">default_ns_vars</span></a></span><span>
</span><span id="line-1864"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">String -&gt; SDoc -&gt; TcRn ()
</span><a href="GHC.Tc.Utils.Monad.html#traceTc"><span class="hs-identifier hs-var">traceTc</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;Defaulting a RuntimeRep var to LiftedRep&quot;</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TcTyVar -&gt; SDoc
forall a. Outputable a =&gt; a -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="annot"><span class="annottext">TcTyVar
</span><a href="#local-6989586621683014968"><span class="hs-identifier hs-var">tv</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1865"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="annottext">ZonkM () -&gt; TcRn ()
forall a. ZonkM a -&gt; TcM a
</span><a href="GHC.Tc.Utils.Monad.html#liftZonkM"><span class="hs-identifier hs-var">liftZonkM</span></a></span><span> </span><span class="annot"><span class="annottext">(ZonkM () -&gt; TcRn ()) -&gt; ZonkM () -&gt; TcRn ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">HasDebugCallStack =&gt; TcTyVar -&gt; TcType -&gt; ZonkM ()
TcTyVar -&gt; TcType -&gt; ZonkM ()
</span><a href="GHC.Tc.Zonk.TcType.html#writeMetaTyVar"><span class="hs-identifier hs-var">writeMetaTyVar</span></a></span><span> </span><span class="annot"><span class="annottext">TcTyVar
</span><a href="#local-6989586621683014968"><span class="hs-identifier hs-var">tv</span></a></span><span> </span><span class="annot"><span class="annottext">TcType
</span><a href="GHC.Builtin.Types.html#liftedRepTy"><span class="hs-identifier hs-var">liftedRepTy</span></a></span><span>
</span><span id="line-1866"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="annottext">Bool -&gt; TcRnIf TcGblEnv TcLclEnv Bool
forall a. a -&gt; IOEnv (Env TcGblEnv TcLclEnv) a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">True</span></span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-1867"></span><span>
</span><span id="line-1868"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">TcTyVar -&gt; Bool
</span><a href="GHC.Core.Type.html#isLevityVar"><span class="hs-identifier hs-var">isLevityVar</span></a></span><span> </span><span class="annot"><span class="annottext">TcTyVar
</span><a href="#local-6989586621683014968"><span class="hs-identifier hs-var">tv</span></a></span><span>
</span><span id="line-1869"></span><span>  </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621683014970"><span class="hs-identifier hs-var">default_ns_vars</span></a></span><span>
</span><span id="line-1870"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">String -&gt; SDoc -&gt; TcRn ()
</span><a href="GHC.Tc.Utils.Monad.html#traceTc"><span class="hs-identifier hs-var">traceTc</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;Defaulting a Levity var to Lifted&quot;</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TcTyVar -&gt; SDoc
forall a. Outputable a =&gt; a -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="annot"><span class="annottext">TcTyVar
</span><a href="#local-6989586621683014968"><span class="hs-identifier hs-var">tv</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1871"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="annottext">ZonkM () -&gt; TcRn ()
forall a. ZonkM a -&gt; TcM a
</span><a href="GHC.Tc.Utils.Monad.html#liftZonkM"><span class="hs-identifier hs-var">liftZonkM</span></a></span><span> </span><span class="annot"><span class="annottext">(ZonkM () -&gt; TcRn ()) -&gt; ZonkM () -&gt; TcRn ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">HasDebugCallStack =&gt; TcTyVar -&gt; TcType -&gt; ZonkM ()
TcTyVar -&gt; TcType -&gt; ZonkM ()
</span><a href="GHC.Tc.Zonk.TcType.html#writeMetaTyVar"><span class="hs-identifier hs-var">writeMetaTyVar</span></a></span><span> </span><span class="annot"><span class="annottext">TcTyVar
</span><a href="#local-6989586621683014968"><span class="hs-identifier hs-var">tv</span></a></span><span> </span><span class="annot"><span class="annottext">TcType
</span><a href="GHC.Builtin.Types.html#liftedDataConTy"><span class="hs-identifier hs-var">liftedDataConTy</span></a></span><span>
</span><span id="line-1872"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="annottext">Bool -&gt; TcRnIf TcGblEnv TcLclEnv Bool
forall a. a -&gt; IOEnv (Env TcGblEnv TcLclEnv) a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">True</span></span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-1873"></span><span>
</span><span id="line-1874"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">TcTyVar -&gt; Bool
</span><a href="GHC.Core.Type.html#isMultiplicityVar"><span class="hs-identifier hs-var">isMultiplicityVar</span></a></span><span> </span><span class="annot"><span class="annottext">TcTyVar
</span><a href="#local-6989586621683014968"><span class="hs-identifier hs-var">tv</span></a></span><span>
</span><span id="line-1875"></span><span>  </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621683014970"><span class="hs-identifier hs-var">default_ns_vars</span></a></span><span>
</span><span id="line-1876"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">String -&gt; SDoc -&gt; TcRn ()
</span><a href="GHC.Tc.Utils.Monad.html#traceTc"><span class="hs-identifier hs-var">traceTc</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;Defaulting a Multiplicity var to Many&quot;</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TcTyVar -&gt; SDoc
forall a. Outputable a =&gt; a -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="annot"><span class="annottext">TcTyVar
</span><a href="#local-6989586621683014968"><span class="hs-identifier hs-var">tv</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1877"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="annottext">ZonkM () -&gt; TcRn ()
forall a. ZonkM a -&gt; TcM a
</span><a href="GHC.Tc.Utils.Monad.html#liftZonkM"><span class="hs-identifier hs-var">liftZonkM</span></a></span><span> </span><span class="annot"><span class="annottext">(ZonkM () -&gt; TcRn ()) -&gt; ZonkM () -&gt; TcRn ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">HasDebugCallStack =&gt; TcTyVar -&gt; TcType -&gt; ZonkM ()
TcTyVar -&gt; TcType -&gt; ZonkM ()
</span><a href="GHC.Tc.Zonk.TcType.html#writeMetaTyVar"><span class="hs-identifier hs-var">writeMetaTyVar</span></a></span><span> </span><span class="annot"><span class="annottext">TcTyVar
</span><a href="#local-6989586621683014968"><span class="hs-identifier hs-var">tv</span></a></span><span> </span><span class="annot"><span class="annottext">TcType
</span><a href="GHC.Builtin.Types.html#manyDataConTy"><span class="hs-identifier hs-var">manyDataConTy</span></a></span><span>
</span><span id="line-1878"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="annottext">Bool -&gt; TcRnIf TcGblEnv TcLclEnv Bool
forall a. a -&gt; IOEnv (Env TcGblEnv TcLclEnv) a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">True</span></span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-1879"></span><span>
</span><span id="line-1880"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">TcTyVar -&gt; Bool
</span><a href="GHC.Tc.Utils.TcType.html#isConcreteTyVar"><span class="hs-identifier hs-var">isConcreteTyVar</span></a></span><span> </span><span class="annot"><span class="annottext">TcTyVar
</span><a href="#local-6989586621683014968"><span class="hs-identifier hs-var">tv</span></a></span><span>
</span><span id="line-1881"></span><span>    </span><span class="hs-comment">-- We don't want to quantify; but neither can we default to</span><span>
</span><span id="line-1882"></span><span>    </span><span class="hs-comment">-- anything sensible.  (If it has kind RuntimeRep or Levity, as is</span><span>
</span><span id="line-1883"></span><span>    </span><span class="hs-comment">-- often the case, it'll have been caught earlier by earlier</span><span>
</span><span id="line-1884"></span><span>    </span><span class="hs-comment">-- cases. So in this exotic situation we just promote.  Not very</span><span>
</span><span id="line-1885"></span><span>    </span><span class="hs-comment">-- satisfing, but it's very much a corner case: #23051</span><span>
</span><span id="line-1886"></span><span>    </span><span class="hs-comment">-- We should really implement the plan in #20686.</span><span>
</span><span id="line-1887"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span id="local-6989586621683014977"><span class="annot"><a href="#local-6989586621683014977"><span class="hs-identifier hs-var">lvl</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">TcM TcLevel
</span><a href="GHC.Tc.Utils.Monad.html#getTcLevel"><span class="hs-identifier hs-var">getTcLevel</span></a></span><span>
</span><span id="line-1888"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.TcMType.html#promoteMetaTyVarTo"><span class="hs-identifier hs-type">promoteMetaTyVarTo</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683014977"><span class="hs-identifier hs-type">lvl</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683014968"><span class="hs-identifier hs-type">tv</span></a></span><span>
</span><span id="line-1889"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">return</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">True</span></span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-1890"></span><span>
</span><span id="line-1891"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">DefaultingStrategy
</span><a href="GHC.Types.Basic.html#DefaultKindVars"><span class="hs-identifier hs-var">DefaultKindVars</span></a></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">DefaultingStrategy
</span><a href="#local-6989586621683014967"><span class="hs-identifier hs-var">def_strat</span></a></span><span> </span><span class="hs-comment">-- -XNoPolyKinds and this is a kind var: we must default it</span><span>
</span><span id="line-1892"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">TcTyVar -&gt; TcRnIf TcGblEnv TcLclEnv Bool
</span><a href="#local-6989586621683014979"><span class="hs-identifier hs-var">default_kind_var</span></a></span><span> </span><span class="annot"><span class="annottext">TcTyVar
</span><a href="#local-6989586621683014968"><span class="hs-identifier hs-var">tv</span></a></span><span>
</span><span id="line-1893"></span><span>
</span><span id="line-1894"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">otherwise</span></span><span>
</span><span id="line-1895"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Bool -&gt; TcRnIf TcGblEnv TcLclEnv Bool
forall a. a -&gt; IOEnv (Env TcGblEnv TcLclEnv) a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">False</span></span><span>
</span><span id="line-1896"></span><span>
</span><span id="line-1897"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-1898"></span><span>    </span><span class="annot"><a href="#local-6989586621683014970"><span class="hs-identifier hs-type">default_ns_vars</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Bool</span></span><span>
</span><span id="line-1899"></span><span>    </span><span id="local-6989586621683014970"><span class="annot"><span class="annottext">default_ns_vars :: Bool
</span><a href="#local-6989586621683014970"><span class="hs-identifier hs-var hs-var">default_ns_vars</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">DefaultingStrategy -&gt; Bool
</span><a href="GHC.Types.Basic.html#defaultNonStandardTyVars"><span class="hs-identifier hs-var">defaultNonStandardTyVars</span></a></span><span> </span><span class="annot"><span class="annottext">DefaultingStrategy
</span><a href="#local-6989586621683014967"><span class="hs-identifier hs-var">def_strat</span></a></span><span>
</span><span id="line-1900"></span><span>    </span><span class="annot"><a href="#local-6989586621683014979"><span class="hs-identifier hs-type">default_kind_var</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Types.Var.html#TyVar"><span class="hs-identifier hs-type">TyVar</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#TcM"><span class="hs-identifier hs-type">TcM</span></a></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Bool</span></span><span>
</span><span id="line-1901"></span><span>       </span><span class="hs-comment">-- defaultKindVar is used exclusively with -XNoPolyKinds</span><span>
</span><span id="line-1902"></span><span>       </span><span class="hs-comment">-- See Note [Defaulting with -XNoPolyKinds]</span><span>
</span><span id="line-1903"></span><span>       </span><span class="hs-comment">-- It takes an (unconstrained) meta tyvar and defaults it.</span><span>
</span><span id="line-1904"></span><span>       </span><span class="hs-comment">-- Works only on vars of type *; for other kinds, it issues an error.</span><span>
</span><span id="line-1905"></span><span>    </span><span id="local-6989586621683014979"><span class="annot"><span class="annottext">default_kind_var :: TcTyVar -&gt; TcRnIf TcGblEnv TcLclEnv Bool
</span><a href="#local-6989586621683014979"><span class="hs-identifier hs-var hs-var">default_kind_var</span></a></span></span><span> </span><span id="local-6989586621683014980"><span class="annot"><span class="annottext">TcTyVar
</span><a href="#local-6989586621683014980"><span class="hs-identifier hs-var">kv</span></a></span></span><span>
</span><span id="line-1906"></span><span>      </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">TcType -&gt; Bool
</span><a href="GHC.Core.Type.html#isLiftedTypeKind"><span class="hs-identifier hs-var">isLiftedTypeKind</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TcTyVar -&gt; TcType
</span><a href="GHC.Types.Var.html#tyVarKind"><span class="hs-identifier hs-var">tyVarKind</span></a></span><span> </span><span class="annot"><span class="annottext">TcTyVar
</span><a href="#local-6989586621683014980"><span class="hs-identifier hs-var">kv</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1907"></span><span>      </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">String -&gt; SDoc -&gt; TcRn ()
</span><a href="GHC.Tc.Utils.Monad.html#traceTc"><span class="hs-identifier hs-var">traceTc</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;Defaulting a kind var to *&quot;</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TcTyVar -&gt; SDoc
forall a. Outputable a =&gt; a -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="annot"><span class="annottext">TcTyVar
</span><a href="#local-6989586621683014980"><span class="hs-identifier hs-var">kv</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1908"></span><span>           </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="annottext">ZonkM () -&gt; TcRn ()
forall a. ZonkM a -&gt; TcM a
</span><a href="GHC.Tc.Utils.Monad.html#liftZonkM"><span class="hs-identifier hs-var">liftZonkM</span></a></span><span> </span><span class="annot"><span class="annottext">(ZonkM () -&gt; TcRn ()) -&gt; ZonkM () -&gt; TcRn ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">HasDebugCallStack =&gt; TcTyVar -&gt; TcType -&gt; ZonkM ()
TcTyVar -&gt; TcType -&gt; ZonkM ()
</span><a href="GHC.Tc.Zonk.TcType.html#writeMetaTyVar"><span class="hs-identifier hs-var">writeMetaTyVar</span></a></span><span> </span><span class="annot"><span class="annottext">TcTyVar
</span><a href="#local-6989586621683014980"><span class="hs-identifier hs-var">kv</span></a></span><span> </span><span class="annot"><span class="annottext">TcType
</span><a href="GHC.Builtin.Types.html#liftedTypeKind"><span class="hs-identifier hs-var">liftedTypeKind</span></a></span><span>
</span><span id="line-1909"></span><span>           </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="annottext">Bool -&gt; TcRnIf TcGblEnv TcLclEnv Bool
forall a. a -&gt; IOEnv (Env TcGblEnv TcLclEnv) a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">True</span></span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-1910"></span><span>      </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">otherwise</span></span><span>
</span><span id="line-1911"></span><span>      </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span class="hs-keyword">let</span><span> </span><span class="hs-special">(</span><span id="local-6989586621683014982"><span class="annot"><span class="annottext">TidyEnv
</span><a href="#local-6989586621683014982"><span class="hs-identifier hs-var hs-var">tidy_env</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621683014983"><span class="annot"><span class="annottext">TcTyVar
</span><a href="#local-6989586621683014983"><span class="hs-identifier hs-var hs-var">kv'</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">TidyEnv -&gt; TcTyVar -&gt; (TidyEnv, TcTyVar)
</span><a href="GHC.Core.TyCo.Tidy.html#tidyFreeTyCoVarX"><span class="hs-identifier hs-var">tidyFreeTyCoVarX</span></a></span><span> </span><span class="annot"><span class="annottext">TidyEnv
</span><a href="GHC.Types.Var.Env.html#emptyTidyEnv"><span class="hs-identifier hs-var">emptyTidyEnv</span></a></span><span> </span><span class="annot"><span class="annottext">TcTyVar
</span><a href="#local-6989586621683014980"><span class="hs-identifier hs-var">kv</span></a></span><span>
</span><span id="line-1912"></span><span>           </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="annottext">(TidyEnv, TcRnMessage) -&gt; TcRn ()
</span><a href="GHC.Tc.Utils.Monad.html#addErrTcM"><span class="hs-identifier hs-var">addErrTcM</span></a></span><span> </span><span class="annot"><span class="annottext">((TidyEnv, TcRnMessage) -&gt; TcRn ())
-&gt; (TidyEnv, TcRnMessage) -&gt; TcRn ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TidyEnv
</span><a href="#local-6989586621683014982"><span class="hs-identifier hs-var">tidy_env</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">TcTyVar -&gt; TcType -&gt; TcRnMessage
</span><a href="GHC.Tc.Errors.Types.html#TcRnCannotDefaultKindVar"><span class="hs-identifier hs-var">TcRnCannotDefaultKindVar</span></a></span><span> </span><span class="annot"><span class="annottext">TcTyVar
</span><a href="#local-6989586621683014983"><span class="hs-identifier hs-var">kv'</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TcTyVar -&gt; TcType
</span><a href="GHC.Types.Var.html#tyVarKind"><span class="hs-identifier hs-var">tyVarKind</span></a></span><span> </span><span class="annot"><span class="annottext">TcTyVar
</span><a href="#local-6989586621683014983"><span class="hs-identifier hs-var">kv'</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-1913"></span><span>           </span><span class="hs-comment">-- We failed to default it, so return False to say so.</span><span>
</span><span id="line-1914"></span><span>           </span><span class="hs-comment">-- Hence, it'll get skolemised.  That might seem odd, but we must either</span><span>
</span><span id="line-1915"></span><span>           </span><span class="hs-comment">-- promote, skolemise, or zap-to-Any, to satisfy GHC.Tc.Gen.HsType</span><span>
</span><span id="line-1916"></span><span>           </span><span class="hs-comment">--    Note [Recipe for checking a signature]</span><span>
</span><span id="line-1917"></span><span>           </span><span class="hs-comment">-- Otherwise we get level-number assertion failures. It doesn't matter much</span><span>
</span><span id="line-1918"></span><span>           </span><span class="hs-comment">-- because we are in an error situation anyway.</span><span>
</span><span id="line-1919"></span><span>           </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="annottext">Bool -&gt; TcRnIf TcGblEnv TcLclEnv Bool
forall a. a -&gt; IOEnv (Env TcGblEnv TcLclEnv) a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">False</span></span><span>
</span><span id="line-1920"></span><span>        </span><span class="hs-special">}</span><span>
</span><span id="line-1921"></span><span>
</span><span id="line-1922"></span><span class="hs-comment">-- | Default some unconstrained type variables, as specified</span><span>
</span><span id="line-1923"></span><span class="hs-comment">-- by the defaulting options:</span><span>
</span><span id="line-1924"></span><span class="hs-comment">--</span><span>
</span><span id="line-1925"></span><span class="hs-comment">--  - 'RuntimeRep' tyvars default to 'LiftedRep'</span><span>
</span><span id="line-1926"></span><span class="hs-comment">--  - 'Levity' tyvars default to 'Lifted'</span><span>
</span><span id="line-1927"></span><span class="hs-comment">--  - 'Multiplicity' tyvars default to 'Many'</span><span>
</span><span id="line-1928"></span><span class="hs-comment">--  - 'Type' tyvars from dv_kvs default to 'Type', when -XNoPolyKinds</span><span>
</span><span id="line-1929"></span><span class="hs-comment">--    (under -XNoPolyKinds, non-defaulting vars in dv_kvs is an error)</span><span>
</span><span id="line-1930"></span><span class="annot"><a href="GHC.Tc.Utils.TcMType.html#defaultTyVars"><span class="hs-identifier hs-type">defaultTyVars</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Types.Basic.html#NonStandardDefaultingStrategy"><span class="hs-identifier hs-type">NonStandardDefaultingStrategy</span></a></span><span>
</span><span id="line-1931"></span><span>              </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.TcMType.html#CandidatesQTvs"><span class="hs-identifier hs-type">CandidatesQTvs</span></a></span><span>    </span><span class="annot"><span class="hs-comment">-- ^ all candidates for quantification</span></span><span>
</span><span id="line-1932"></span><span>              </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#TcM"><span class="hs-identifier hs-type">TcM</span></a></span><span> </span><span class="hs-special">[</span><span class="annot"><a href="GHC.Types.Var.html#TcTyVar"><span class="hs-identifier hs-type">TcTyVar</span></a></span><span class="hs-special">]</span><span>     </span><span class="annot"><span class="hs-comment">-- ^ those variables not defaulted</span></span><span>
</span><span id="line-1933"></span><span id="defaultTyVars"><span class="annot"><span class="annottext">defaultTyVars :: NonStandardDefaultingStrategy -&gt; CandidatesQTvs -&gt; TcM [TcTyVar]
</span><a href="GHC.Tc.Utils.TcMType.html#defaultTyVars"><span class="hs-identifier hs-var hs-var">defaultTyVars</span></a></span></span><span> </span><span id="local-6989586621683014992"><span class="annot"><span class="annottext">NonStandardDefaultingStrategy
</span><a href="#local-6989586621683014992"><span class="hs-identifier hs-var">ns_strat</span></a></span></span><span> </span><span id="local-6989586621683014993"><span class="annot"><span class="annottext">CandidatesQTvs
</span><a href="#local-6989586621683014993"><span class="hs-identifier hs-var">dvs</span></a></span></span><span>
</span><span id="line-1934"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span id="local-6989586621683014994"><span class="annot"><a href="#local-6989586621683014994"><span class="hs-identifier hs-var">poly_kinds</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Extension -&gt; TcRnIf TcGblEnv TcLclEnv Bool
forall gbl lcl. Extension -&gt; TcRnIf gbl lcl Bool
</span><a href="GHC.Tc.Utils.Monad.html#xoptM"><span class="hs-identifier hs-var">xoptM</span></a></span><span> </span><span class="annot"><span class="annottext">Extension
</span><span class="hs-identifier hs-var">LangExt.PolyKinds</span></span><span>
</span><span id="line-1935"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="hs-keyword">let</span><span>
</span><span id="line-1936"></span><span>           </span><span class="annot"><a href="#local-6989586621683014997"><span class="hs-identifier hs-type">def_tvs</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="#local-6989586621683014998"><span class="hs-identifier hs-type">def_kvs</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Types.Basic.html#DefaultingStrategy"><span class="hs-identifier hs-type">DefaultingStrategy</span></a></span><span>
</span><span id="line-1937"></span><span>           </span><span id="local-6989586621683014997"><span class="annot"><a href="#local-6989586621683014997"><span class="hs-identifier hs-var hs-var">def_tvs</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">NonStandardDefaultingStrategy -&gt; DefaultingStrategy
</span><a href="GHC.Types.Basic.html#NonStandardDefaulting"><span class="hs-identifier hs-var">NonStandardDefaulting</span></a></span><span> </span><span class="annot"><span class="annottext">NonStandardDefaultingStrategy
</span><a href="#local-6989586621683014992"><span class="hs-identifier hs-var">ns_strat</span></a></span><span>
</span><span id="line-1938"></span><span>           </span><span id="local-6989586621683014998"><span class="annot"><a href="#local-6989586621683014998"><span class="hs-identifier hs-var hs-var">def_kvs</span></a></span></span><span> </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621683014994"><span class="hs-identifier hs-var">poly_kinds</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">DefaultingStrategy
</span><a href="#local-6989586621683014997"><span class="hs-identifier hs-var">def_tvs</span></a></span><span>
</span><span id="line-1939"></span><span>                   </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">otherwise</span></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">DefaultingStrategy
</span><a href="GHC.Types.Basic.html#DefaultKindVars"><span class="hs-identifier hs-var">DefaultKindVars</span></a></span><span>
</span><span id="line-1940"></span><span>             </span><span class="hs-comment">-- As -XNoPolyKinds precludes polymorphic kind variables, we default them.</span><span>
</span><span id="line-1941"></span><span>             </span><span class="hs-comment">-- For example:</span><span>
</span><span id="line-1942"></span><span>             </span><span class="hs-comment">--</span><span>
</span><span id="line-1943"></span><span>             </span><span class="hs-comment">--   type F :: Type -&gt; Type</span><span>
</span><span id="line-1944"></span><span>             </span><span class="hs-comment">--   type family F a where</span><span>
</span><span id="line-1945"></span><span>             </span><span class="hs-comment">--      F (a -&gt; b) = b</span><span>
</span><span id="line-1946"></span><span>             </span><span class="hs-comment">--</span><span>
</span><span id="line-1947"></span><span>             </span><span class="hs-comment">-- Here we get `a :: TYPE r`, so to accept this program when -XNoPolyKinds is enabled</span><span>
</span><span id="line-1948"></span><span>             </span><span class="hs-comment">-- we must default the kind variable `r :: RuntimeRep`.</span><span>
</span><span id="line-1949"></span><span>             </span><span class="hs-comment">-- Test case: T20584.</span><span>
</span><span id="line-1950"></span><span>       </span><span class="hs-special">;</span><span> </span><span id="local-6989586621683015000"><span class="annot"><a href="#local-6989586621683015000"><span class="hs-identifier hs-var">defaulted_kvs</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="hs-identifier hs-type">mapM</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Tc.Utils.TcMType.html#defaultTyVar"><span class="hs-identifier hs-type">defaultTyVar</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683014998"><span class="hs-identifier hs-type">def_kvs</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><a href="#local-6989586621683015001"><span class="hs-identifier hs-type">dep_kvs</span></a></span><span>
</span><span id="line-1951"></span><span>       </span><span class="hs-special">;</span><span> </span><span id="local-6989586621683015002"><span class="annot"><a href="#local-6989586621683015002"><span class="hs-identifier hs-var">defaulted_tvs</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="hs-identifier hs-type">mapM</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Tc.Utils.TcMType.html#defaultTyVar"><span class="hs-identifier hs-type">defaultTyVar</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683014997"><span class="hs-identifier hs-type">def_tvs</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><a href="#local-6989586621683015003"><span class="hs-identifier hs-type">nondep_tvs</span></a></span><span>
</span><span id="line-1952"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621683015004"><span class="annot"><a href="#local-6989586621683015004"><span class="hs-identifier hs-var hs-var">undefaulted_kvs</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">TcTyVar
</span><a href="#local-6989586621683015005"><span class="hs-identifier hs-var">kv</span></a></span><span> </span><span class="hs-glyph">|</span><span> </span><span class="hs-special">(</span><span id="local-6989586621683015005"><span class="annot"><span class="annottext">TcTyVar
</span><a href="#local-6989586621683015005"><span class="hs-identifier hs-var">kv</span></a></span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">False</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">[TcTyVar]
</span><a href="#local-6989586621683015001"><span class="hs-identifier hs-var">dep_kvs</span></a></span><span>    </span><span class="annot"><span class="annottext">[TcTyVar] -&gt; [Bool] -&gt; [(TcTyVar, Bool)]
forall a b. [a] -&gt; [b] -&gt; [(a, b)]
</span><span class="hs-operator hs-var">`zip`</span></span><span> </span><span class="annot"><span class="annottext">[Bool]
</span><a href="#local-6989586621683015000"><span class="hs-identifier hs-var">defaulted_kvs</span></a></span><span> </span><span class="hs-special">]</span><span>
</span><span id="line-1953"></span><span>             </span><span id="local-6989586621683015006"><span class="annot"><a href="#local-6989586621683015006"><span class="hs-identifier hs-var hs-var">undefaulted_tvs</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">TcTyVar
</span><a href="#local-6989586621683015007"><span class="hs-identifier hs-var">tv</span></a></span><span> </span><span class="hs-glyph">|</span><span> </span><span class="hs-special">(</span><span id="local-6989586621683015007"><span class="annot"><span class="annottext">TcTyVar
</span><a href="#local-6989586621683015007"><span class="hs-identifier hs-var">tv</span></a></span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">False</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">[TcTyVar]
</span><a href="#local-6989586621683015003"><span class="hs-identifier hs-var">nondep_tvs</span></a></span><span> </span><span class="annot"><span class="annottext">[TcTyVar] -&gt; [Bool] -&gt; [(TcTyVar, Bool)]
forall a b. [a] -&gt; [b] -&gt; [(a, b)]
</span><span class="hs-operator hs-var">`zip`</span></span><span> </span><span class="annot"><span class="annottext">[Bool]
</span><a href="#local-6989586621683015002"><span class="hs-identifier hs-var">defaulted_tvs</span></a></span><span> </span><span class="hs-special">]</span><span>
</span><span id="line-1954"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">return</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621683015004"><span class="hs-identifier hs-type">undefaulted_kvs</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">++</span></span><span> </span><span class="annot"><a href="#local-6989586621683015006"><span class="hs-identifier hs-type">undefaulted_tvs</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-1955"></span><span>          </span><span class="hs-comment">-- NB: kvs before tvs because tvs may depend on kvs</span><span>
</span><span id="line-1956"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-1957"></span><span>    </span><span class="hs-special">(</span><span id="local-6989586621683015001"><span class="annot"><span class="annottext">[TcTyVar]
</span><a href="#local-6989586621683015001"><span class="hs-identifier hs-var">dep_kvs</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621683015003"><span class="annot"><span class="annottext">[TcTyVar]
</span><a href="#local-6989586621683015003"><span class="hs-identifier hs-var">nondep_tvs</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">CandidatesQTvs -&gt; ([TcTyVar], [TcTyVar])
</span><a href="GHC.Tc.Utils.TcMType.html#candidateVars"><span class="hs-identifier hs-var">candidateVars</span></a></span><span> </span><span class="annot"><span class="annottext">CandidatesQTvs
</span><a href="#local-6989586621683014993"><span class="hs-identifier hs-var">dvs</span></a></span><span>
</span><span id="line-1958"></span><span>
</span><span id="line-1959"></span><span class="annot"><a href="GHC.Tc.Utils.TcMType.html#skolemiseUnboundMetaTyVar"><span class="hs-identifier hs-type">skolemiseUnboundMetaTyVar</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Tc.Types.Origin.html#SkolemInfo"><span class="hs-identifier hs-type">SkolemInfo</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Types.Var.html#TcTyVar"><span class="hs-identifier hs-type">TcTyVar</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Zonk.Monad.html#ZonkM"><span class="hs-identifier hs-type">ZonkM</span></a></span><span> </span><span class="annot"><a href="GHC.Types.Var.html#TyVar"><span class="hs-identifier hs-type">TyVar</span></a></span><span>
</span><span id="line-1960"></span><span class="hs-comment">-- We have a Meta tyvar with a ref-cell inside it</span><span>
</span><span id="line-1961"></span><span class="hs-comment">-- Skolemise it, so that we are totally out of Meta-tyvar-land</span><span>
</span><span id="line-1962"></span><span class="hs-comment">-- We create a skolem TcTyVar, not a regular TyVar</span><span>
</span><span id="line-1963"></span><span class="hs-comment">--   See Note [Zonking to Skolem]</span><span>
</span><span id="line-1964"></span><span class="hs-comment">--</span><span>
</span><span id="line-1965"></span><span class="hs-comment">-- Its level should be one greater than the ambient level, which will typically</span><span>
</span><span id="line-1966"></span><span class="hs-comment">-- be the same as the level on the meta-tyvar. But not invariably; for example</span><span>
</span><span id="line-1967"></span><span class="hs-comment">--    f :: (forall a b. SameKind a b) -&gt; Int</span><span>
</span><span id="line-1968"></span><span class="hs-comment">-- The skolems 'a' and 'b' are bound by tcTKTelescope, at level 2; and they each</span><span>
</span><span id="line-1969"></span><span class="hs-comment">-- have a level-2 kind unification variable, since it might get unified with another</span><span>
</span><span id="line-1970"></span><span class="hs-comment">-- of the level-2 skolems e.g. 'k' in this version</span><span>
</span><span id="line-1971"></span><span class="hs-comment">--    f :: (forall k (a :: k) b. SameKind a b) -&gt; Int</span><span>
</span><span id="line-1972"></span><span class="hs-comment">-- So when we quantify the kind vars at the top level of the signature, the ambient</span><span>
</span><span id="line-1973"></span><span class="hs-comment">-- level is 1, but we will quantify over kappa[2].</span><span>
</span><span id="line-1974"></span><span>
</span><span id="line-1975"></span><span id="skolemiseUnboundMetaTyVar"><span class="annot"><span class="annottext">skolemiseUnboundMetaTyVar :: SkolemInfo -&gt; TcTyVar -&gt; ZonkM TcTyVar
</span><a href="GHC.Tc.Utils.TcMType.html#skolemiseUnboundMetaTyVar"><span class="hs-identifier hs-var hs-var">skolemiseUnboundMetaTyVar</span></a></span></span><span> </span><span id="local-6989586621683015008"><span class="annot"><span class="annottext">SkolemInfo
</span><a href="#local-6989586621683015008"><span class="hs-identifier hs-var">skol_info</span></a></span></span><span> </span><span id="local-6989586621683015009"><span class="annot"><span class="annottext">TcTyVar
</span><a href="#local-6989586621683015009"><span class="hs-identifier hs-var">tv</span></a></span></span><span>
</span><span id="line-1976"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Bool -&gt; SDoc -&gt; ZonkM TcTyVar -&gt; ZonkM TcTyVar
forall a. HasCallStack =&gt; Bool -&gt; SDoc -&gt; a -&gt; a
</span><a href="GHC.Utils.Panic.html#assertPpr"><span class="hs-identifier hs-var">assertPpr</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TcTyVar -&gt; Bool
</span><a href="GHC.Tc.Utils.TcType.html#isMetaTyVar"><span class="hs-identifier hs-var">isMetaTyVar</span></a></span><span> </span><span class="annot"><span class="annottext">TcTyVar
</span><a href="#local-6989586621683015009"><span class="hs-identifier hs-var">tv</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TcTyVar -&gt; SDoc
forall a. Outputable a =&gt; a -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="annot"><span class="annottext">TcTyVar
</span><a href="#local-6989586621683015009"><span class="hs-identifier hs-var">tv</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(ZonkM TcTyVar -&gt; ZonkM TcTyVar) -&gt; ZonkM TcTyVar -&gt; ZonkM TcTyVar
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-1977"></span><span>    </span><span class="hs-keyword">do</span><span>  </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">TcTyVar -&gt; ZonkM ()
forall {f :: * -&gt; *}. MonadIO f =&gt; TcTyVar -&gt; f ()
</span><a href="#local-6989586621683015010"><span class="hs-identifier hs-var">check_empty</span></a></span><span> </span><span class="annot"><span class="annottext">TcTyVar
</span><a href="#local-6989586621683015009"><span class="hs-identifier hs-var">tv</span></a></span><span>
</span><span id="line-1978"></span><span>        </span><span class="hs-comment">-- Get the location and level from &quot;here&quot;,</span><span>
</span><span id="line-1979"></span><span>        </span><span class="hs-comment">-- i.e. where we are generalising</span><span>
</span><span id="line-1980"></span><span>        </span><span class="hs-special">;</span><span> </span><span class="annot"><a href="GHC.Tc.Zonk.Monad.html#ZonkGblEnv"><span class="hs-identifier hs-type">ZonkGblEnv</span></a></span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><a href="GHC.Tc.Zonk.Monad.html#zge_src_span"><span class="hs-identifier hs-var">zge_src_span</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="local-6989586621683015013"><span class="annot"><a href="#local-6989586621683015013"><span class="hs-identifier hs-var">here</span></a></span></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Tc.Zonk.Monad.html#zge_tc_level"><span class="hs-identifier hs-var">zge_tc_level</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="local-6989586621683015015"><span class="annot"><a href="#local-6989586621683015015"><span class="hs-identifier hs-var">tc_lvl</span></a></span></span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-1981"></span><span>           </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">ZonkM ZonkGblEnv
</span><a href="GHC.Tc.Zonk.Monad.html#getZonkGblEnv"><span class="hs-identifier hs-var">getZonkGblEnv</span></a></span><span>
</span><span id="line-1982"></span><span>        </span><span class="hs-special">;</span><span> </span><span id="local-6989586621683015017"><span class="annot"><a href="#local-6989586621683015017"><span class="hs-identifier hs-var">kind</span></a></span></span><span>   </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><a href="GHC.Tc.Zonk.TcType.html#zonkTcType"><span class="hs-identifier hs-type">zonkTcType</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Types.Var.html#tyVarKind"><span class="hs-identifier hs-type">tyVarKind</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683015009"><span class="hs-identifier hs-type">tv</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1983"></span><span>        </span><span class="hs-special">;</span><span> </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621683015018"><span class="annot"><a href="#local-6989586621683015018"><span class="hs-identifier hs-var hs-var">tv_name</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">TcTyVar -&gt; Name
</span><a href="GHC.Types.Var.html#tyVarName"><span class="hs-identifier hs-var">tyVarName</span></a></span><span> </span><span class="annot"><span class="annottext">TcTyVar
</span><a href="#local-6989586621683015009"><span class="hs-identifier hs-var">tv</span></a></span><span>
</span><span id="line-1984"></span><span>              </span><span class="hs-comment">-- See Note [Skolemising and identity]</span><span>
</span><span id="line-1985"></span><span>              </span><span id="local-6989586621683015019"><span class="annot"><a href="#local-6989586621683015019"><span class="hs-identifier hs-var hs-var">final_name</span></a></span></span><span> </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Name -&gt; Bool
</span><a href="GHC.Types.Name.html#isSystemName"><span class="hs-identifier hs-var">isSystemName</span></a></span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621683015018"><span class="hs-identifier hs-var">tv_name</span></a></span><span>
</span><span id="line-1986"></span><span>                         </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Unique -&gt; OccName -&gt; SrcSpan -&gt; Name
</span><a href="GHC.Types.Name.html#mkInternalName"><span class="hs-identifier hs-var">mkInternalName</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Name -&gt; Unique
</span><a href="GHC.Types.Name.html#nameUnique"><span class="hs-identifier hs-var">nameUnique</span></a></span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621683015018"><span class="hs-identifier hs-var">tv_name</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1987"></span><span>                                          </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Name -&gt; OccName
</span><a href="GHC.Types.Name.html#nameOccName"><span class="hs-identifier hs-var">nameOccName</span></a></span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621683015018"><span class="hs-identifier hs-var">tv_name</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">SrcSpan
</span><a href="#local-6989586621683015013"><span class="hs-identifier hs-var">here</span></a></span><span>
</span><span id="line-1988"></span><span>                         </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">otherwise</span></span><span>
</span><span id="line-1989"></span><span>                         </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621683015018"><span class="hs-identifier hs-var">tv_name</span></a></span><span>
</span><span id="line-1990"></span><span>              </span><span id="local-6989586621683015023"><span class="annot"><a href="#local-6989586621683015023"><span class="hs-identifier hs-var hs-var">details</span></a></span></span><span>    </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">SkolemInfo -&gt; TcLevel -&gt; Bool -&gt; TcTyVarDetails
</span><a href="GHC.Tc.Utils.TcType.html#SkolemTv"><span class="hs-identifier hs-var">SkolemTv</span></a></span><span> </span><span class="annot"><span class="annottext">SkolemInfo
</span><a href="#local-6989586621683015008"><span class="hs-identifier hs-var">skol_info</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TcLevel -&gt; TcLevel
</span><a href="GHC.Tc.Utils.TcType.html#pushTcLevel"><span class="hs-identifier hs-var">pushTcLevel</span></a></span><span> </span><span class="annot"><span class="annottext">TcLevel
</span><a href="#local-6989586621683015015"><span class="hs-identifier hs-var">tc_lvl</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">False</span></span><span>
</span><span id="line-1991"></span><span>              </span><span id="local-6989586621683015024"><span class="annot"><a href="#local-6989586621683015024"><span class="hs-identifier hs-var hs-var">final_tv</span></a></span></span><span>   </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Name -&gt; TcType -&gt; TcTyVarDetails -&gt; TcTyVar
</span><a href="GHC.Types.Var.html#mkTcTyVar"><span class="hs-identifier hs-var">mkTcTyVar</span></a></span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621683015019"><span class="hs-identifier hs-var">final_name</span></a></span><span> </span><span class="annot"><span class="annottext">TcType
</span><a href="#local-6989586621683015017"><span class="hs-identifier hs-var">kind</span></a></span><span> </span><span class="annot"><span class="annottext">TcTyVarDetails
</span><a href="#local-6989586621683015023"><span class="hs-identifier hs-var">details</span></a></span><span>
</span><span id="line-1992"></span><span>
</span><span id="line-1993"></span><span>        </span><span class="hs-special">;</span><span> </span><span class="annot"><a href="GHC.Tc.Zonk.Monad.html#traceZonk"><span class="hs-identifier hs-type">traceZonk</span></a></span><span> </span><span class="annot"><span class="hs-string">&quot;Skolemising&quot;</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-type">ppr</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683015009"><span class="hs-identifier hs-type">tv</span></a></span><span> </span><span class="annot"><a href="GHC.Utils.Outputable.html#%3C%2B%3E"><span class="hs-operator hs-type">&lt;+&gt;</span></a></span><span> </span><span class="annot"><a href="GHC.Utils.Outputable.html#text"><span class="hs-identifier hs-type">text</span></a></span><span> </span><span class="annot"><span class="hs-string">&quot;:=&quot;</span></span><span> </span><span class="annot"><a href="GHC.Utils.Outputable.html#%3C%2B%3E"><span class="hs-operator hs-type">&lt;+&gt;</span></a></span><span> </span><span class="annot"><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-type">ppr</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683015024"><span class="hs-identifier hs-type">final_tv</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1994"></span><span>        </span><span class="hs-special">;</span><span> </span><span class="annot"><a href="GHC.Tc.Zonk.TcType.html#writeMetaTyVar"><span class="hs-identifier hs-type">writeMetaTyVar</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683015009"><span class="hs-identifier hs-type">tv</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#mkTyVarTy"><span class="hs-identifier hs-type">mkTyVarTy</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683015024"><span class="hs-identifier hs-type">final_tv</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1995"></span><span>        </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">return</span></span><span> </span><span class="annot"><a href="#local-6989586621683015024"><span class="hs-identifier hs-type">final_tv</span></a></span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-1996"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-1997"></span><span>    </span><span id="local-6989586621683015010"><span class="annot"><span class="annottext">check_empty :: TcTyVar -&gt; f ()
</span><a href="#local-6989586621683015010"><span class="hs-identifier hs-var hs-var">check_empty</span></a></span></span><span> </span><span id="local-6989586621683015048"><span class="annot"><span class="annottext">TcTyVar
</span><a href="#local-6989586621683015048"><span class="hs-identifier hs-var">tv</span></a></span></span><span>       </span><span class="hs-comment">-- [Sept 04] Check for non-empty.</span><span>
</span><span id="line-1998"></span><span>      </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Bool -&gt; f () -&gt; f ()
forall (f :: * -&gt; *). Applicative f =&gt; Bool -&gt; f () -&gt; f ()
</span><span class="hs-identifier hs-var">when</span></span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="GHC.Utils.Constants.html#debugIsOn"><span class="hs-identifier hs-var">debugIsOn</span></a></span><span> </span><span class="annot"><span class="annottext">(f () -&gt; f ()) -&gt; f () -&gt; f ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>  </span><span class="hs-comment">-- See Note [Silly Type Synonyms]</span><span>
</span><span id="line-1999"></span><span>        </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span id="local-6989586621683015049"><span class="annot"><a href="#local-6989586621683015049"><span class="hs-identifier hs-var">cts</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">TcTyVar -&gt; f MetaDetails
forall (m :: * -&gt; *). MonadIO m =&gt; TcTyVar -&gt; m MetaDetails
</span><a href="GHC.Tc.Utils.TcMType.html#readMetaTyVar"><span class="hs-identifier hs-var">readMetaTyVar</span></a></span><span> </span><span class="annot"><span class="annottext">TcTyVar
</span><a href="#local-6989586621683015048"><span class="hs-identifier hs-var">tv</span></a></span><span>
</span><span id="line-2000"></span><span>           </span><span class="hs-special">;</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><a href="#local-6989586621683015049"><span class="hs-identifier hs-type">cts</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-2001"></span><span>               </span><span class="annot"><span class="annottext">MetaDetails
</span><a href="GHC.Tc.Utils.TcType.html#Flexi"><span class="hs-identifier hs-var">Flexi</span></a></span><span>       </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">() -&gt; f ()
forall a. a -&gt; f a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-2002"></span><span>               </span><span class="annot"><a href="GHC.Tc.Utils.TcType.html#Indirect"><span class="hs-identifier hs-type">Indirect</span></a></span><span> </span><span id="local-6989586621683015050"><span class="annot"><span class="annottext">TcType
</span><a href="#local-6989586621683015050"><span class="hs-identifier hs-var">ty</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Bool -&gt; String -&gt; SDoc -&gt; f () -&gt; f ()
forall a. HasCallStack =&gt; Bool -&gt; String -&gt; SDoc -&gt; a -&gt; a
</span><a href="GHC.Utils.Trace.html#warnPprTrace"><span class="hs-identifier hs-var">warnPprTrace</span></a></span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">True</span></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;skolemiseUnboundMetaTyVar&quot;</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TcTyVar -&gt; SDoc
forall a. Outputable a =&gt; a -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="annot"><span class="annottext">TcTyVar
</span><a href="#local-6989586621683015048"><span class="hs-identifier hs-var">tv</span></a></span><span> </span><span class="annot"><span class="annottext">SDoc -&gt; SDoc -&gt; SDoc
forall doc. IsDoc doc =&gt; doc -&gt; doc -&gt; doc
</span><a href="GHC.Utils.Outputable.html#%24%24"><span class="hs-operator hs-var">$$</span></a></span><span> </span><span class="annot"><span class="annottext">TcType -&gt; SDoc
forall a. Outputable a =&gt; a -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="annot"><span class="annottext">TcType
</span><a href="#local-6989586621683015050"><span class="hs-identifier hs-var">ty</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(f () -&gt; f ()) -&gt; f () -&gt; f ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-2003"></span><span>                              </span><span class="annot"><span class="annottext">() -&gt; f ()
forall a. a -&gt; f a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-2004"></span><span>
</span><span id="line-2005"></span><span class="hs-comment">{- Note [Error on unconstrained meta-variables]
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
Consider

* type C :: Type -&gt; Type -&gt; Constraint
  class (forall a. a b ~ a c) =&gt; C b c

* type T = forall a. Proxy a

* data (forall a. a b ~ a c) =&gt; T b c

* type instance F Int = Proxy Any
  where Any :: forall k. k

In the first three cases we will infer a :: Type -&gt; kappa, but then
we get no further information on kappa. In the last, we will get
  Proxy kappa Any
but again will get no further info on kappa.

What do do?
 A. We could choose kappa := Type. But this only works when the kind of kappa
    is Type (true in this example, but not always).
 B. We could default to Any.
 C. We could quantify.
 D. We could error.

We choose (D), as described in #17567, and implement this choice in
doNotQuantifyTyVars.  Discussion of alternatives A-C is below.

NB: this is all rather similar to, but sadly not the same as
    Note [Naughty quantification candidates]

To do this, we must take an extra step before doing the final zonk to create
e.g. a TyCon. (There is no problem in the final term-level zonk. See the
section on alternative (B) below.) This extra step is needed only for
constructs that do not quantify their free meta-variables, such as a class
constraint or right-hand side of a type synonym.

Specifically: before the final zonk, every construct must either call
quantifyTyVars or doNotQuantifyTyVars. The latter issues an error
if it is passed any free variables. (Exception: we still default
RuntimeRep and Multiplicity variables.)

Because no meta-variables remain after quantifying or erroring, we perform
the zonk with NoFlexi, which panics upon seeing a meta-variable.

Alternatives A-C, not implemented:

A. As stated above, this works only sometimes. We might have a free
   meta-variable of kind Nat, for example.

B. This is what we used to do, but it caused Any to appear in error
   messages sometimes. See #17567 for several examples. Defaulting to
   Any during the final, whole-program zonk is OK, though, because
   we are completely done type-checking at that point. No chance to
   leak into an error message.

C. Examine the class declaration at the top of this Note again.
   Where should we quantify? We might imagine quantifying and
   putting the kind variable in the forall of the quantified constraint.
   But what if there are nested foralls? Which one should get the
   variable? Other constructs have other problems. (For example,
   the right-hand side of a type family instance equation may not
   be a poly-type.)

   More broadly, the GHC AST defines a set of places where it performs
   implicit lexical generalization. For example, in a type
   signature

     f :: Proxy a -&gt; Bool

   the otherwise-unbound a is lexically quantified, giving us

     f :: forall a. Proxy a -&gt; Bool

   The places that allow lexical quantification are marked in the AST with
   HsImplicitBndrs. HsImplicitBndrs offers a binding site for otherwise-unbound
   variables.

   Later, during type-checking, we discover that a's kind is unconstrained.
   We thus quantify *again*, to

     f :: forall {k} (a :: k). Proxy @k a -&gt; Bool

   It is this second quantification that this Note is really about --
   let's call it *inferred quantification*.
   So there are two sorts of implicit quantification in types:
     1. Lexical quantification: signalled by HsImplicitBndrs, occurs over
        variables mentioned by the user but with no explicit binding site,
        suppressed by a user-written forall (by the forall-or-nothing rule,
        in Note [forall-or-nothing rule] in GHC.Hs.Type).
     2. Inferred quantification: no signal in HsSyn, occurs over unconstrained
        variables invented by the type-checker, possible only with -XPolyKinds,
        unaffected by forall-or-nothing rule
   These two quantifications are performed in different compiler phases, and are
   essentially unrelated. However, it is convenient
   for programmers to remember only one set of implicit quantification
   sites. So, we choose to use the same places (those with HsImplicitBndrs)
   for lexical quantification as for inferred quantification of unconstrained
   meta-variables. Accordingly, there is no quantification in a class
   constraint, or the other constructs that call doNotQuantifyTyVars.
-}</span><span>
</span><span id="line-2107"></span><span>
</span><span id="line-2108"></span><span class="annot"><a href="GHC.Tc.Utils.TcMType.html#doNotQuantifyTyVars"><span class="hs-identifier hs-type">doNotQuantifyTyVars</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.TcMType.html#CandidatesQTvs"><span class="hs-identifier hs-type">CandidatesQTvs</span></a></span><span>
</span><span id="line-2109"></span><span>                    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Types.Var.Env.html#TidyEnv"><span class="hs-identifier hs-type">TidyEnv</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Zonk.Monad.html#ZonkM"><span class="hs-identifier hs-type">ZonkM</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Types.Var.Env.html#TidyEnv"><span class="hs-identifier hs-type">TidyEnv</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Tc.Errors.Types.html#UninferrableTyVarCtx"><span class="hs-identifier hs-type">UninferrableTyVarCtx</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-2110"></span><span>                            </span><span class="annot"><span class="hs-comment">-- ^ like &quot;the class context (D a b, E foogle)&quot;</span></span><span>
</span><span id="line-2111"></span><span>                    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#TcM"><span class="hs-identifier hs-type">TcM</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-2112"></span><span class="hs-comment">-- See Note [Error on unconstrained meta-variables]</span><span>
</span><span id="line-2113"></span><span id="doNotQuantifyTyVars"><span class="annot"><span class="annottext">doNotQuantifyTyVars :: CandidatesQTvs
-&gt; (TidyEnv -&gt; ZonkM (TidyEnv, UninferrableTyVarCtx)) -&gt; TcRn ()
</span><a href="GHC.Tc.Utils.TcMType.html#doNotQuantifyTyVars"><span class="hs-identifier hs-var hs-var">doNotQuantifyTyVars</span></a></span></span><span> </span><span id="local-6989586621683015052"><span class="annot"><span class="annottext">CandidatesQTvs
</span><a href="#local-6989586621683015052"><span class="hs-identifier hs-var">dvs</span></a></span></span><span> </span><span id="local-6989586621683015053"><span class="annot"><span class="annottext">TidyEnv -&gt; ZonkM (TidyEnv, UninferrableTyVarCtx)
</span><a href="#local-6989586621683015053"><span class="hs-identifier hs-var">where_found</span></a></span></span><span>
</span><span id="line-2114"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">CandidatesQTvs -&gt; Bool
</span><a href="GHC.Tc.Utils.TcMType.html#isEmptyCandidates"><span class="hs-identifier hs-var">isEmptyCandidates</span></a></span><span> </span><span class="annot"><span class="annottext">CandidatesQTvs
</span><a href="#local-6989586621683015052"><span class="hs-identifier hs-var">dvs</span></a></span><span>
</span><span id="line-2115"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">String -&gt; SDoc -&gt; TcRn ()
</span><a href="GHC.Tc.Utils.Monad.html#traceTc"><span class="hs-identifier hs-var">traceTc</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;doNotQuantifyTyVars has nothing to error on&quot;</span></span><span> </span><span class="annot"><span class="annottext">SDoc
forall doc. IsOutput doc =&gt; doc
</span><a href="GHC.Utils.Outputable.html#empty"><span class="hs-identifier hs-var">empty</span></a></span><span>
</span><span id="line-2116"></span><span>
</span><span id="line-2117"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">otherwise</span></span><span>
</span><span id="line-2118"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">String -&gt; SDoc -&gt; TcRn ()
</span><a href="GHC.Tc.Utils.Monad.html#traceTc"><span class="hs-identifier hs-var">traceTc</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;doNotQuantifyTyVars&quot;</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">CandidatesQTvs -&gt; SDoc
forall a. Outputable a =&gt; a -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="annot"><span class="annottext">CandidatesQTvs
</span><a href="#local-6989586621683015052"><span class="hs-identifier hs-var">dvs</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-2119"></span><span>       </span><span class="hs-special">;</span><span> </span><span id="local-6989586621683015054"><span class="annot"><a href="#local-6989586621683015054"><span class="hs-identifier hs-var">undefaulted</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">NonStandardDefaultingStrategy -&gt; CandidatesQTvs -&gt; TcM [TcTyVar]
</span><a href="GHC.Tc.Utils.TcMType.html#defaultTyVars"><span class="hs-identifier hs-var">defaultTyVars</span></a></span><span> </span><span class="annot"><span class="annottext">NonStandardDefaultingStrategy
</span><a href="GHC.Types.Basic.html#DefaultNonStandardTyVars"><span class="hs-identifier hs-var">DefaultNonStandardTyVars</span></a></span><span> </span><span class="annot"><span class="annottext">CandidatesQTvs
</span><a href="#local-6989586621683015052"><span class="hs-identifier hs-var">dvs</span></a></span><span>
</span><span id="line-2120"></span><span>          </span><span class="hs-comment">-- could have regular TyVars here, in an associated type RHS, or</span><span>
</span><span id="line-2121"></span><span>          </span><span class="hs-comment">-- bound by a type declaration head. So filter looking only for</span><span>
</span><span id="line-2122"></span><span>          </span><span class="hs-comment">-- metavars. e.g. b and c in `class (forall a. a b ~ a c) =&gt; C b c`</span><span>
</span><span id="line-2123"></span><span>          </span><span class="hs-comment">-- are OK</span><span>
</span><span id="line-2124"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621683015056"><span class="annot"><a href="#local-6989586621683015056"><span class="hs-identifier hs-var hs-var">leftover_metas</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(TcTyVar -&gt; Bool) -&gt; [TcTyVar] -&gt; [TcTyVar]
forall a. (a -&gt; Bool) -&gt; [a] -&gt; [a]
</span><span class="hs-identifier hs-var">filter</span></span><span> </span><span class="annot"><span class="annottext">TcTyVar -&gt; Bool
</span><a href="GHC.Tc.Utils.TcType.html#isMetaTyVar"><span class="hs-identifier hs-var">isMetaTyVar</span></a></span><span> </span><span class="annot"><span class="annottext">[TcTyVar]
</span><a href="#local-6989586621683015054"><span class="hs-identifier hs-var">undefaulted</span></a></span><span>
</span><span id="line-2125"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">unless</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">null</span></span><span> </span><span class="annot"><a href="#local-6989586621683015056"><span class="hs-identifier hs-type">leftover_metas</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span>
</span><span id="line-2126"></span><span>         </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span class="hs-keyword">let</span><span> </span><span class="hs-special">(</span><span id="local-6989586621683015058"><span class="annot"><a href="#local-6989586621683015058"><span class="hs-identifier hs-var">tidy_env1</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621683015059"><span class="annot"><a href="#local-6989586621683015059"><span class="hs-identifier hs-var">tidied_tvs</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="GHC.Core.TyCo.Tidy.html#tidyFreeTyCoVarsX"><span class="hs-identifier hs-type">tidyFreeTyCoVarsX</span></a></span><span> </span><span class="annot"><a href="GHC.Types.Var.Env.html#emptyTidyEnv"><span class="hs-identifier hs-type">emptyTidyEnv</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683015056"><span class="hs-identifier hs-type">leftover_metas</span></a></span><span>
</span><span id="line-2127"></span><span>            </span><span class="hs-special">;</span><span> </span><span class="hs-special">(</span><span id="local-6989586621683015061"><span class="annot"><a href="#local-6989586621683015061"><span class="hs-identifier hs-var">tidy_env2</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621683015062"><span class="annot"><a href="#local-6989586621683015062"><span class="hs-identifier hs-var">where_doc</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.Monad.html#liftZonkM"><span class="hs-identifier hs-type">liftZonkM</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="annot"><a href="#local-6989586621683015053"><span class="hs-identifier hs-type">where_found</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683015058"><span class="hs-identifier hs-type">tidy_env1</span></a></span><span>
</span><span id="line-2128"></span><span>            </span><span class="hs-special">;</span><span> </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621683015063"><span class="annot"><a href="#local-6989586621683015063"><span class="hs-identifier hs-var hs-var">msg</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[TcTyVar] -&gt; UninferrableTyVarCtx -&gt; TcRnMessage
</span><a href="GHC.Tc.Errors.Types.html#TcRnUninferrableTyVar"><span class="hs-identifier hs-var">TcRnUninferrableTyVar</span></a></span><span> </span><span class="annot"><span class="annottext">[TcTyVar]
</span><a href="#local-6989586621683015059"><span class="hs-identifier hs-var">tidied_tvs</span></a></span><span> </span><span class="annot"><span class="annottext">UninferrableTyVarCtx
</span><a href="#local-6989586621683015062"><span class="hs-identifier hs-var">where_doc</span></a></span><span>
</span><span id="line-2129"></span><span>            </span><span class="hs-special">;</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.Monad.html#failWithTcM"><span class="hs-identifier hs-type">failWithTcM</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621683015061"><span class="hs-identifier hs-type">tidy_env2</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="#local-6989586621683015063"><span class="hs-identifier hs-type">msg</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-2130"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.Monad.html#traceTc"><span class="hs-identifier hs-type">traceTc</span></a></span><span> </span><span class="annot"><span class="hs-string">&quot;doNotQuantifyTyVars success&quot;</span></span><span> </span><span class="annot"><a href="GHC.Utils.Outputable.html#empty"><span class="hs-identifier hs-type">empty</span></a></span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-2131"></span><span>
</span><span id="line-2132"></span><span class="hs-comment">{- Note [Defaulting with -XNoPolyKinds]
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
Consider

  data Compose f g a = Mk (f (g a))

We infer

  Compose :: forall k1 k2. (k2 -&gt; *) -&gt; (k1 -&gt; k2) -&gt; k1 -&gt; *
  Mk :: forall k1 k2 (f :: k2 -&gt; *) (g :: k1 -&gt; k2) (a :: k1).
        f (g a) -&gt; Compose k1 k2 f g a

Now, in another module, we have -XNoPolyKinds -XDataKinds in effect.
What does 'Mk mean? Pre GHC-8.0 with -XNoPolyKinds,
we just defaulted all kind variables to *. But that's no good here,
because the kind variables in 'Mk aren't of kind *, so defaulting to *
is ill-kinded.

After some debate on #11334, we decided to issue an error in this case.
The code is in defaultKindVar.

Note [What is a meta variable?]
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
A &quot;meta type-variable&quot;, also know as a &quot;unification variable&quot; is a placeholder
introduced by the typechecker for an as-yet-unknown monotype.

For example, when we see a call `reverse (f xs)`, we know that we calling
    reverse :: forall a. [a] -&gt; [a]
So we know that the argument `f xs` must be a &quot;list of something&quot;. But what is
the &quot;something&quot;? We don't know until we explore the `f xs` a bit more. So we set
out what we do know at the call of `reverse` by instantiating its type with a fresh
meta tyvar, `alpha` say. So now the type of the argument `f xs`, and of the
result, is `[alpha]`. The unification variable `alpha` stands for the
as-yet-unknown type of the elements of the list.

As type inference progresses we may learn more about `alpha`. For example, suppose
`f` has the type
    f :: forall b. b -&gt; [Maybe b]
Then we instantiate `f`'s type with another fresh unification variable, say
`beta`; and equate `f`'s result type with reverse's argument type, thus
`[alpha] ~ [Maybe beta]`.

Now we can solve this equality to learn that `alpha ~ Maybe beta`, so we've
refined our knowledge about `alpha`. And so on.

If you found this Note useful, you may also want to have a look at
Section 5 of &quot;Practical type inference for higher rank types&quot; (Peyton Jones,
Vytiniotis, Weirich and Shields. J. Functional Programming. 2011).

Note [Zonking to Skolem]
~~~~~~~~~~~~~~~~~~~~~~~~
We used to zonk quantified type variables to regular TyVars.  However, this
leads to problems.  Consider this program from the regression test suite:

  eval :: Int -&gt; String -&gt; String -&gt; String
  eval 0 root actual = evalRHS 0 root actual

  evalRHS :: Int -&gt; a
  evalRHS 0 root actual = eval 0 root actual

It leads to the deferral of an equality (wrapped in an implication constraint)

  forall a. () =&gt; ((String -&gt; String -&gt; String) ~ a)

which is propagated up to the toplevel (see GHC.Tc.Solver.tcSimplifyInferCheck).
In the meantime `a' is zonked and quantified to form `evalRHS's signature.
This has the *side effect* of also zonking the `a' in the deferred equality
(which at this point is being handed around wrapped in an implication
constraint).

Finally, the equality (with the zonked `a') will be handed back to the
simplifier by GHC.Tc.Module.tcRnSrcDecls calling GHC.Tc.Solver.tcSimplifyTop.
If we zonk `a' with a regular type variable, we will have this regular type
variable now floating around in the simplifier, which in many places assumes to
only see proper TcTyVars.

We can avoid this problem by zonking with a skolem TcTyVar.  The
skolem is rigid (which we require for a quantified variable), but is
still a TcTyVar that the simplifier knows how to deal with.

Note [Skolemising and identity]
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
In some places, we make a TyVarTv for a binder. E.g.
    class C a where ...
As Note [Inferring kinds for type declarations] discusses,
we make a TyVarTv for 'a'.  Later we skolemise it, and we'd
like to retain its identity, location info etc.  (If we don't
retain its identity we'll have to do some pointless swizzling;
see GHC.Tc.TyCl.swizzleTcTyConBndrs.  If we retain its identity
but not its location we'll lose the detailed binding site info.

Conclusion: use the Name of the TyVarTv.  But we don't want
to do that when skolemising random unification variables;
there the location we want is the skolemisation site.

Fortunately we can tell the difference: random unification
variables have System Names.  That's why final_name is
set based on the isSystemName test.


Note [Silly Type Synonyms]
~~~~~~~~~~~~~~~~~~~~~~~~~~
Consider this:
        type C u a = u  -- Note 'a' unused

        foo :: (forall a. C u a -&gt; C u a) -&gt; u
        foo x = ...

        bar :: Num u =&gt; u
        bar = foo (\t -&gt; t + t)

* From the (\t -&gt; t+t) we get type  {Num d} =&gt;  d -&gt; d
  where d is fresh.

* Now unify with type of foo's arg, and we get:
        {Num (C d a)} =&gt;  C d a -&gt; C d a
  where a is fresh.

* Now abstract over the 'a', but float out the Num (C d a) constraint
  because it does not 'really' mention a.  (see exactTyVarsOfType)
  The arg to foo becomes
        \/\a -&gt; \t -&gt; t+t

* So we get a dict binding for Num (C d a), which is zonked to give
        a = ()
  Note (Sept 04): now that we are zonking quantified type variables
  on construction, the 'a' will be frozen as a regular tyvar on
  quantification, so the floated dict will still have type (C d a).
  Which renders this whole note moot; happily!]

* Then the \/\a abstraction has a zonked 'a' in it.

All very silly.   I think its harmless to ignore the problem.  We'll end up with
a \/\a in the final result but all the occurrences of a will be zonked to ()
-}</span><span>
</span><span id="line-2267"></span><span>
</span><span id="line-2268"></span><span class="hs-comment">--------------------------------------------------------------------------------</span><span>
</span><span id="line-2269"></span><span>
</span><span id="line-2270"></span><span class="hs-comment">-- | @tcCheckUsage name mult thing_inside@ runs @thing_inside@, checks that the</span><span>
</span><span id="line-2271"></span><span class="hs-comment">-- usage of @name@ is a submultiplicity of @mult@, and removes @name@ from the</span><span>
</span><span id="line-2272"></span><span class="hs-comment">-- usage environment. See also Note [Coercions returned from tcSubMult] in</span><span>
</span><span id="line-2273"></span><span class="hs-comment">-- GHC.Tc.Utils.Unify, which applies to the wrapper returned from this function.</span><span>
</span><span id="line-2274"></span><span id="local-6989586621683013549"><span class="annot"><a href="GHC.Tc.Utils.TcMType.html#tcCheckUsage"><span class="hs-identifier hs-type">tcCheckUsage</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Types.Name.html#Name"><span class="hs-identifier hs-type">Name</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#Mult"><span class="hs-identifier hs-type">Mult</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#TcM"><span class="hs-identifier hs-type">TcM</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683013549"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#TcM"><span class="hs-identifier hs-type">TcM</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621683013549"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Tc.Types.Evidence.html#HsWrapper"><span class="hs-identifier hs-type">HsWrapper</span></a></span><span class="hs-special">)</span></span><span>
</span><span id="line-2275"></span><span id="tcCheckUsage"><span class="annot"><span class="annottext">tcCheckUsage :: forall a. Name -&gt; TcType -&gt; TcM a -&gt; TcM (a, HsWrapper)
</span><a href="GHC.Tc.Utils.TcMType.html#tcCheckUsage"><span class="hs-identifier hs-var hs-var">tcCheckUsage</span></a></span></span><span> </span><span id="local-6989586621683015083"><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621683015083"><span class="hs-identifier hs-var">name</span></a></span></span><span> </span><span id="local-6989586621683015084"><span class="annot"><span class="annottext">TcType
</span><a href="#local-6989586621683015084"><span class="hs-identifier hs-var">id_mult</span></a></span></span><span> </span><span id="local-6989586621683015085"><span class="annot"><span class="annottext">TcM a
</span><a href="#local-6989586621683015085"><span class="hs-identifier hs-var">thing_inside</span></a></span></span><span>
</span><span id="line-2276"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span class="hs-special">(</span><span id="local-6989586621683015086"><span class="annot"><a href="#local-6989586621683015086"><span class="hs-identifier hs-var">local_usage</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621683015087"><span class="annot"><a href="#local-6989586621683015087"><span class="hs-identifier hs-var">result</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">TcM a -&gt; TcM (UsageEnv, a)
forall a. TcM a -&gt; TcM (UsageEnv, a)
</span><a href="GHC.Tc.Utils.Monad.html#tcCollectingUsage"><span class="hs-identifier hs-var">tcCollectingUsage</span></a></span><span> </span><span class="annot"><span class="annottext">TcM a
</span><a href="#local-6989586621683015085"><span class="hs-identifier hs-var">thing_inside</span></a></span><span>
</span><span id="line-2277"></span><span>       </span><span class="hs-special">;</span><span> </span><span id="local-6989586621683015089"><span class="annot"><a href="#local-6989586621683015089"><span class="hs-identifier hs-var">wrapper</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><a href="#local-6989586621683015090"><span class="hs-identifier hs-type">check_then_add_usage</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683015086"><span class="hs-identifier hs-type">local_usage</span></a></span><span>
</span><span id="line-2278"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">return</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621683015087"><span class="hs-identifier hs-type">result</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="#local-6989586621683015089"><span class="hs-identifier hs-type">wrapper</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-2279"></span><span>    </span><span class="hs-keyword">where</span><span>
</span><span id="line-2280"></span><span>    </span><span class="annot"><a href="#local-6989586621683015090"><span class="hs-identifier hs-type">check_then_add_usage</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Core.UsageEnv.html#UsageEnv"><span class="hs-identifier hs-type">UsageEnv</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#TcM"><span class="hs-identifier hs-type">TcM</span></a></span><span> </span><span class="annot"><a href="GHC.Tc.Types.Evidence.html#HsWrapper"><span class="hs-identifier hs-type">HsWrapper</span></a></span><span>
</span><span id="line-2281"></span><span>    </span><span class="hs-comment">-- Checks that the usage of the newly introduced binder is compatible with</span><span>
</span><span id="line-2282"></span><span>    </span><span class="hs-comment">-- its multiplicity, and combines the usage of non-new binders to |uenv|</span><span>
</span><span id="line-2283"></span><span>    </span><span id="local-6989586621683015090"><span class="annot"><span class="annottext">check_then_add_usage :: UsageEnv -&gt; TcM HsWrapper
</span><a href="#local-6989586621683015090"><span class="hs-identifier hs-var hs-var">check_then_add_usage</span></a></span></span><span> </span><span id="local-6989586621683015091"><span class="annot"><span class="annottext">UsageEnv
</span><a href="#local-6989586621683015091"><span class="hs-identifier hs-var">uenv</span></a></span></span><span>
</span><span id="line-2284"></span><span>      </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621683015092"><span class="annot"><span class="annottext">actual_u :: Usage
</span><a href="#local-6989586621683015092"><span class="hs-identifier hs-var hs-var hs-var">actual_u</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">UsageEnv -&gt; Name -&gt; Usage
forall n. NamedThing n =&gt; UsageEnv -&gt; n -&gt; Usage
</span><a href="GHC.Core.UsageEnv.html#lookupUE"><span class="hs-identifier hs-var">lookupUE</span></a></span><span> </span><span class="annot"><span class="annottext">UsageEnv
</span><a href="#local-6989586621683015091"><span class="hs-identifier hs-var">uenv</span></a></span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621683015083"><span class="hs-identifier hs-var">name</span></a></span><span>
</span><span id="line-2285"></span><span>           </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="annottext">String -&gt; SDoc -&gt; TcRn ()
</span><a href="GHC.Tc.Utils.Monad.html#traceTc"><span class="hs-identifier hs-var">traceTc</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;check_then_add_usage&quot;</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TcType -&gt; SDoc
forall a. Outputable a =&gt; a -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="annot"><span class="annottext">TcType
</span><a href="#local-6989586621683015084"><span class="hs-identifier hs-var">id_mult</span></a></span><span> </span><span class="annot"><span class="annottext">SDoc -&gt; SDoc -&gt; SDoc
forall doc. IsDoc doc =&gt; doc -&gt; doc -&gt; doc
</span><a href="GHC.Utils.Outputable.html#%24%24"><span class="hs-operator hs-var">$$</span></a></span><span> </span><span class="annot"><span class="annottext">Usage -&gt; SDoc
forall a. Outputable a =&gt; a -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="annot"><span class="annottext">Usage
</span><a href="#local-6989586621683015092"><span class="hs-identifier hs-var">actual_u</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-2286"></span><span>           </span><span class="hs-special">;</span><span> </span><span id="local-6989586621683015094"><span class="annot"><a href="#local-6989586621683015094"><span class="hs-identifier hs-var">wrapper</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">Usage
</span><a href="#local-6989586621683015092"><span class="hs-identifier hs-var">actual_u</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-2287"></span><span>               </span><span class="annot"><span class="annottext">Usage
</span><a href="GHC.Core.UsageEnv.html#Bottom"><span class="hs-identifier hs-var">Bottom</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">HsWrapper -&gt; TcM HsWrapper
forall a. a -&gt; IOEnv (Env TcGblEnv TcLclEnv) a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="annot"><span class="annottext">HsWrapper
</span><a href="GHC.Tc.Types.Evidence.html#idHsWrapper"><span class="hs-identifier hs-var">idHsWrapper</span></a></span><span>
</span><span id="line-2288"></span><span>               </span><span class="annot"><span class="annottext">Usage
</span><a href="GHC.Core.UsageEnv.html#Zero"><span class="hs-identifier hs-var">Zero</span></a></span><span>     </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">CtOrigin -&gt; TcType -&gt; TcType -&gt; TcM HsWrapper
</span><a href="GHC.Tc.Utils.Unify.html#tcSubMult"><span class="hs-identifier hs-var">tcSubMult</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Name -&gt; CtOrigin
</span><a href="GHC.Tc.Types.Origin.html#UsageEnvironmentOf"><span class="hs-identifier hs-var">UsageEnvironmentOf</span></a></span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621683015083"><span class="hs-identifier hs-var">name</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">TcType
</span><a href="GHC.Core.Type.html#ManyTy"><span class="hs-identifier hs-var">ManyTy</span></a></span><span> </span><span class="annot"><span class="annottext">TcType
</span><a href="#local-6989586621683015084"><span class="hs-identifier hs-var">id_mult</span></a></span><span>
</span><span id="line-2289"></span><span>               </span><span class="annot"><a href="GHC.Core.UsageEnv.html#MUsage"><span class="hs-identifier hs-type">MUsage</span></a></span><span> </span><span id="local-6989586621683015100"><span class="annot"><span class="annottext">TcType
</span><a href="#local-6989586621683015100"><span class="hs-identifier hs-var">m</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span id="local-6989586621683015101"><span class="annot"><a href="#local-6989586621683015101"><span class="hs-identifier hs-var">m</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">TcType -&gt; TcM TcType
</span><a href="#local-6989586621683015102"><span class="hs-identifier hs-var">promote_mult</span></a></span><span> </span><span class="annot"><span class="annottext">TcType
</span><a href="#local-6989586621683015100"><span class="hs-identifier hs-var">m</span></a></span><span>
</span><span id="line-2290"></span><span>                              </span><span class="hs-special">;</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.Unify.html#tcSubMult"><span class="hs-identifier hs-type">tcSubMult</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Tc.Types.Origin.html#UsageEnvironmentOf"><span class="hs-identifier hs-type">UsageEnvironmentOf</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683015083"><span class="hs-identifier hs-type">name</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><a href="#local-6989586621683015101"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683015084"><span class="hs-identifier hs-type">id_mult</span></a></span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-2291"></span><span>           </span><span class="hs-special">;</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.Monad.html#tcEmitBindingUsage"><span class="hs-identifier hs-type">tcEmitBindingUsage</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Core.UsageEnv.html#deleteUE"><span class="hs-identifier hs-type">deleteUE</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683015091"><span class="hs-identifier hs-type">uenv</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683015083"><span class="hs-identifier hs-type">name</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-2292"></span><span>           </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">return</span></span><span> </span><span class="annot"><a href="#local-6989586621683015094"><span class="hs-identifier hs-type">wrapper</span></a></span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-2293"></span><span>
</span><span id="line-2294"></span><span>    </span><span class="hs-comment">-- This is gross. The problem is in test case typecheck/should_compile/T18998:</span><span>
</span><span id="line-2295"></span><span>    </span><span class="hs-comment">--   f :: a %1-&gt; Id n a -&gt; Id n a</span><span>
</span><span id="line-2296"></span><span>    </span><span class="hs-comment">--   f x (MkId _) = MkId x</span><span>
</span><span id="line-2297"></span><span>    </span><span class="hs-comment">-- where MkId is a GADT constructor. Multiplicity polymorphism of constructors</span><span>
</span><span id="line-2298"></span><span>    </span><span class="hs-comment">-- invents a new multiplicity variable p[2] for the application MkId x. This</span><span>
</span><span id="line-2299"></span><span>    </span><span class="hs-comment">-- variable is at level 2, bumped because of the GADT pattern-match (MkId _).</span><span>
</span><span id="line-2300"></span><span>    </span><span class="hs-comment">-- We eventually unify the variable with One, due to the call to tcSubMult in</span><span>
</span><span id="line-2301"></span><span>    </span><span class="hs-comment">-- tcCheckUsage. But by then, we're at TcLevel 1, and so the level-check</span><span>
</span><span id="line-2302"></span><span>    </span><span class="hs-comment">-- fails.</span><span>
</span><span id="line-2303"></span><span>    </span><span class="hs-comment">--</span><span>
</span><span id="line-2304"></span><span>    </span><span class="hs-comment">-- What to do? If we did inference &quot;for real&quot;, the sub-multiplicity constraint</span><span>
</span><span id="line-2305"></span><span>    </span><span class="hs-comment">-- would end up in the implication of the GADT pattern-match, and all would</span><span>
</span><span id="line-2306"></span><span>    </span><span class="hs-comment">-- be well. But we don't have a real sub-multiplicity constraint to put in</span><span>
</span><span id="line-2307"></span><span>    </span><span class="hs-comment">-- the implication. (Multiplicity inference works outside the usual generate-</span><span>
</span><span id="line-2308"></span><span>    </span><span class="hs-comment">-- constraints-and-solve scheme.) Here, where the multiplicity arrives, we</span><span>
</span><span id="line-2309"></span><span>    </span><span class="hs-comment">-- must promote all multiplicity variables to reflect this outer TcLevel.</span><span>
</span><span id="line-2310"></span><span>    </span><span class="hs-comment">-- It's reminiscent of floating a constraint, really, so promotion is</span><span>
</span><span id="line-2311"></span><span>    </span><span class="hs-comment">-- appropriate. The promoteTcType function works only on types of kind TYPE rr,</span><span>
</span><span id="line-2312"></span><span>    </span><span class="hs-comment">-- so we can't use it here. Thus, this dirtiness.</span><span>
</span><span id="line-2313"></span><span>    </span><span class="hs-comment">--</span><span>
</span><span id="line-2314"></span><span>    </span><span class="hs-comment">-- It works nicely in practice.</span><span>
</span><span id="line-2315"></span><span>    </span><span class="hs-comment">--</span><span>
</span><span id="line-2316"></span><span>    </span><span class="hs-comment">-- We use a set to avoid calling promoteMetaTyVarTo twice on the same</span><span>
</span><span id="line-2317"></span><span>    </span><span class="hs-comment">-- metavariable. This happened in #19400.</span><span>
</span><span id="line-2318"></span><span>    </span><span id="local-6989586621683015102"><span class="annot"><span class="annottext">promote_mult :: TcType -&gt; TcM TcType
</span><a href="#local-6989586621683015102"><span class="hs-identifier hs-var hs-var">promote_mult</span></a></span></span><span> </span><span id="local-6989586621683015109"><span class="annot"><span class="annottext">TcType
</span><a href="#local-6989586621683015109"><span class="hs-identifier hs-var">m</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span id="local-6989586621683015110"><span class="annot"><a href="#local-6989586621683015110"><span class="hs-identifier hs-var">fvs</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">ZonkM CoVarSet -&gt; TcM CoVarSet
forall a. ZonkM a -&gt; TcM a
</span><a href="GHC.Tc.Utils.Monad.html#liftZonkM"><span class="hs-identifier hs-var">liftZonkM</span></a></span><span> </span><span class="annot"><span class="annottext">(ZonkM CoVarSet -&gt; TcM CoVarSet) -&gt; ZonkM CoVarSet -&gt; TcM CoVarSet
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">CoVarSet -&gt; ZonkM CoVarSet
</span><a href="GHC.Tc.Zonk.TcType.html#zonkTyCoVarsAndFV"><span class="hs-identifier hs-var">zonkTyCoVarsAndFV</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TcType -&gt; CoVarSet
</span><a href="GHC.Core.TyCo.FVs.html#tyCoVarsOfType"><span class="hs-identifier hs-var">tyCoVarsOfType</span></a></span><span> </span><span class="annot"><span class="annottext">TcType
</span><a href="#local-6989586621683015109"><span class="hs-identifier hs-var">m</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-2319"></span><span>                        </span><span class="hs-special">;</span><span> </span><span id="local-6989586621683015112"><span class="annot"><a href="#local-6989586621683015112"><span class="hs-identifier hs-var">any_promoted</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.TcMType.html#promoteTyVarSet"><span class="hs-identifier hs-type">promoteTyVarSet</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683015110"><span class="hs-identifier hs-type">fvs</span></a></span><span>
</span><span id="line-2320"></span><span>                        </span><span class="hs-special">;</span><span> </span><span class="hs-keyword">if</span><span> </span><span class="annot"><a href="#local-6989586621683015112"><span class="hs-identifier hs-type">any_promoted</span></a></span><span> </span><span class="hs-keyword">then</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.Monad.html#liftZonkM"><span class="hs-identifier hs-type">liftZonkM</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="annot"><a href="GHC.Tc.Zonk.TcType.html#zonkTcType"><span class="hs-identifier hs-type">zonkTcType</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683015109"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="hs-keyword">else</span><span> </span><span class="annot"><span class="hs-identifier hs-type">return</span></span><span> </span><span class="annot"><a href="#local-6989586621683015109"><span class="hs-identifier hs-type">m</span></a></span><span>
</span><span id="line-2321"></span><span>                        </span><span class="hs-special">}</span><span>
</span><span id="line-2322"></span><span>
</span><span id="line-2323"></span><span class="annot"><span class="hs-comment">{- *********************************************************************
*                                                                      *
         Short-cuts for overloaded numeric literals
*                                                                      *
********************************************************************* -}</span></span><span>
</span><span id="line-2328"></span><span>
</span><span id="line-2329"></span><span class="hs-comment">-- Overloaded literals. Here mainly because it uses isIntTy etc</span><span>
</span><span id="line-2330"></span><span>
</span><span id="line-2331"></span><span class="hs-comment">{- Note [Short cut for overloaded literals]
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
A literal like &quot;3&quot; means (fromInteger @ty (dNum :: Num ty) (3::Integer)).
But if we have a list like
  [4,2,3,2,4,4,2]::[Int]
we use a lot of compile time and space generating and solving all those Num
constraints, and generating calls to fromInteger etc.  Better just to cut to
the chase, and cough up an Int literal. Large collections of literals like this
sometimes appear in source files, so it's quite a worthwhile fix.

So we try to take advantage of whatever nearby type information we have,
to short-cut the process for built-in types.  We can do this in two places;

* In the typechecker, when we are about to typecheck the literal.
* If that fails, in the desugarer, once we know the final type.
-}</span><span>
</span><span id="line-2347"></span><span>
</span><span id="line-2348"></span><span class="annot"><a href="GHC.Tc.Utils.TcMType.html#tcShortCutLit"><span class="hs-identifier hs-type">tcShortCutLit</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Language.Haskell.Syntax.Lit.html#HsOverLit"><span class="hs-identifier hs-type">HsOverLit</span></a></span><span> </span><span class="annot"><a href="GHC.Hs.Extension.html#GhcRn"><span class="hs-identifier hs-type">GhcRn</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.TcType.html#ExpRhoType"><span class="hs-identifier hs-type">ExpRhoType</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#TcM"><span class="hs-identifier hs-type">TcM</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Maybe</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Language.Haskell.Syntax.Lit.html#HsOverLit"><span class="hs-identifier hs-type">HsOverLit</span></a></span><span> </span><span class="annot"><a href="GHC.Hs.Extension.html#GhcTc"><span class="hs-identifier hs-type">GhcTc</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-2349"></span><span id="tcShortCutLit"><span class="annot"><span class="annottext">tcShortCutLit :: HsOverLit GhcRn -&gt; ExpType -&gt; TcM (Maybe (HsOverLit GhcTc))
</span><a href="GHC.Tc.Utils.TcMType.html#tcShortCutLit"><span class="hs-identifier hs-var hs-var">tcShortCutLit</span></a></span></span><span> </span><span id="local-6989586621683015113"><span class="annot"><span class="annottext">lit :: HsOverLit GhcRn
</span><a href="#local-6989586621683015113"><span class="hs-identifier hs-var">lit</span></a></span></span><span class="hs-glyph">@</span><span class="hs-special">(</span><span class="annot"><a href="Language.Haskell.Syntax.Lit.html#OverLit"><span class="hs-identifier hs-type">OverLit</span></a></span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">ol_val :: forall p. HsOverLit p -&gt; OverLitVal
</span><a href="Language.Haskell.Syntax.Lit.html#ol_val"><span class="hs-identifier hs-var">ol_val</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="local-6989586621683015116"><span class="annot"><span class="annottext">OverLitVal
</span><a href="#local-6989586621683015116"><span class="hs-identifier hs-var">val</span></a></span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">ol_ext :: forall p. HsOverLit p -&gt; XOverLit p
</span><a href="Language.Haskell.Syntax.Lit.html#ol_ext"><span class="hs-identifier hs-var">ol_ext</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="GHC.Hs.Lit.html#OverLitRn"><span class="hs-identifier hs-type">OverLitRn</span></a></span><span> </span><span id="local-6989586621683015119"><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621683015119"><span class="hs-identifier hs-var">rebindable</span></a></span></span><span> </span><span class="annot"><span class="annottext">LIdP GhcRn
</span><span class="hs-identifier">_</span></span><span class="hs-special">}</span><span class="hs-special">)</span><span> </span><span id="local-6989586621683015120"><span class="annot"><span class="annottext">ExpType
</span><a href="#local-6989586621683015120"><span class="hs-identifier hs-var">exp_res_ty</span></a></span></span><span>
</span><span id="line-2350"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Bool
</span><span class="hs-identifier hs-var">not</span></span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621683015119"><span class="hs-identifier hs-var">rebindable</span></a></span><span>
</span><span id="line-2351"></span><span>  </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span id="local-6989586621683015121"><span class="annot"><span class="annottext">TcType
</span><a href="#local-6989586621683015121"><span class="hs-identifier hs-var">res_ty</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">ExpType -&gt; Maybe TcType
</span><a href="GHC.Tc.Utils.TcType.html#checkingExpType_maybe"><span class="hs-identifier hs-var">checkingExpType_maybe</span></a></span><span> </span><span class="annot"><span class="annottext">ExpType
</span><a href="#local-6989586621683015120"><span class="hs-identifier hs-var">exp_res_ty</span></a></span><span>
</span><span id="line-2352"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span id="local-6989586621683015122"><span class="annot"><a href="#local-6989586621683015122"><span class="hs-identifier hs-var">dflags</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">IOEnv (Env TcGblEnv TcLclEnv) DynFlags
forall (m :: * -&gt; *). HasDynFlags m =&gt; m DynFlags
</span><a href="GHC.Driver.DynFlags.html#getDynFlags"><span class="hs-identifier hs-var">getDynFlags</span></a></span><span>
</span><span id="line-2353"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621683015124"><span class="annot"><a href="#local-6989586621683015124"><span class="hs-identifier hs-var hs-var">platform</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">DynFlags -&gt; Platform
</span><a href="GHC.Driver.DynFlags.html#targetPlatform"><span class="hs-identifier hs-var">targetPlatform</span></a></span><span> </span><span class="annot"><span class="annottext">DynFlags
</span><a href="#local-6989586621683015122"><span class="hs-identifier hs-var">dflags</span></a></span><span>
</span><span id="line-2354"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.TcMType.html#shortCutLit"><span class="hs-identifier hs-type">shortCutLit</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683015124"><span class="hs-identifier hs-type">platform</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683015116"><span class="hs-identifier hs-type">val</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683015121"><span class="hs-identifier hs-type">res_ty</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-2355"></span><span>            </span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span id="local-6989586621683015126"><span class="annot"><span class="annottext">HsExpr GhcTc
</span><a href="#local-6989586621683015126"><span class="hs-identifier hs-var">expr</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Maybe (HsOverLit GhcTc) -&gt; TcM (Maybe (HsOverLit GhcTc))
forall a. a -&gt; IOEnv (Env TcGblEnv TcLclEnv) a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="annot"><span class="annottext">(Maybe (HsOverLit GhcTc) -&gt; TcM (Maybe (HsOverLit GhcTc)))
-&gt; Maybe (HsOverLit GhcTc) -&gt; TcM (Maybe (HsOverLit GhcTc))
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">HsOverLit GhcTc -&gt; Maybe (HsOverLit GhcTc)
forall a. a -&gt; Maybe a
</span><span class="hs-identifier hs-var">Just</span></span><span> </span><span class="annot"><span class="annottext">(HsOverLit GhcTc -&gt; Maybe (HsOverLit GhcTc))
-&gt; HsOverLit GhcTc -&gt; Maybe (HsOverLit GhcTc)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-2356"></span><span>                         </span><span class="annot"><span class="annottext">HsOverLit GhcRn
</span><a href="#local-6989586621683015113"><span class="hs-identifier hs-var">lit</span></a></span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><a href="Language.Haskell.Syntax.Lit.html#ol_ext"><span class="hs-identifier hs-var">ol_ext</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="GHC.Hs.Lit.html#OverLitTc"><span class="hs-identifier hs-type">OverLitTc</span></a></span><span> </span><span class="annot"><span class="hs-identifier hs-type">False</span></span><span> </span><span class="annot"><a href="#local-6989586621683015126"><span class="hs-identifier hs-type">expr</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683015121"><span class="hs-identifier hs-type">res_ty</span></a></span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-2357"></span><span>            </span><span class="annot"><span class="annottext">Maybe (HsExpr GhcTc)
</span><span class="hs-identifier hs-var">Nothing</span></span><span>   </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Maybe (HsOverLit GhcTc) -&gt; TcM (Maybe (HsOverLit GhcTc))
forall a. a -&gt; IOEnv (Env TcGblEnv TcLclEnv) a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="annot"><span class="annottext">Maybe (HsOverLit GhcTc)
forall a. Maybe a
</span><span class="hs-identifier hs-var">Nothing</span></span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-2358"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">otherwise</span></span><span>
</span><span id="line-2359"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Maybe (HsOverLit GhcTc) -&gt; TcM (Maybe (HsOverLit GhcTc))
forall a. a -&gt; IOEnv (Env TcGblEnv TcLclEnv) a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="annot"><span class="annottext">Maybe (HsOverLit GhcTc)
forall a. Maybe a
</span><span class="hs-identifier hs-var">Nothing</span></span><span>
</span><span id="line-2360"></span><span>
</span><span id="line-2361"></span><span class="annot"><a href="GHC.Tc.Utils.TcMType.html#shortCutLit"><span class="hs-identifier hs-type">shortCutLit</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Platform.html#Platform"><span class="hs-identifier hs-type">Platform</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Language.Haskell.Syntax.Lit.html#OverLitVal"><span class="hs-identifier hs-type">OverLitVal</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.TcType.html#TcType"><span class="hs-identifier hs-type">TcType</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Maybe</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Language.Haskell.Syntax.Expr.html#HsExpr"><span class="hs-identifier hs-type">HsExpr</span></a></span><span> </span><span class="annot"><a href="GHC.Hs.Extension.html#GhcTc"><span class="hs-identifier hs-type">GhcTc</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-2362"></span><span id="shortCutLit"><span class="annot"><span class="annottext">shortCutLit :: Platform -&gt; OverLitVal -&gt; TcType -&gt; Maybe (HsExpr GhcTc)
</span><a href="GHC.Tc.Utils.TcMType.html#shortCutLit"><span class="hs-identifier hs-var hs-var">shortCutLit</span></a></span></span><span> </span><span id="local-6989586621683015128"><span class="annot"><span class="annottext">Platform
</span><a href="#local-6989586621683015128"><span class="hs-identifier hs-var">platform</span></a></span></span><span> </span><span id="local-6989586621683015129"><span class="annot"><span class="annottext">OverLitVal
</span><a href="#local-6989586621683015129"><span class="hs-identifier hs-var">val</span></a></span></span><span> </span><span id="local-6989586621683015130"><span class="annot"><span class="annottext">TcType
</span><a href="#local-6989586621683015130"><span class="hs-identifier hs-var">res_ty</span></a></span></span><span>
</span><span id="line-2363"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">OverLitVal
</span><a href="#local-6989586621683015129"><span class="hs-identifier hs-var">val</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-2364"></span><span>      </span><span class="annot"><a href="Language.Haskell.Syntax.Lit.html#HsIntegral"><span class="hs-identifier hs-type">HsIntegral</span></a></span><span> </span><span id="local-6989586621683015132"><span class="annot"><span class="annottext">IntegralLit
</span><a href="#local-6989586621683015132"><span class="hs-identifier hs-var">int_lit</span></a></span></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">IntegralLit -&gt; Maybe (HsExpr GhcTc)
</span><a href="#local-6989586621683015133"><span class="hs-identifier hs-var">go_integral</span></a></span><span> </span><span class="annot"><span class="annottext">IntegralLit
</span><a href="#local-6989586621683015132"><span class="hs-identifier hs-var">int_lit</span></a></span><span>
</span><span id="line-2365"></span><span>      </span><span class="annot"><a href="Language.Haskell.Syntax.Lit.html#HsFractional"><span class="hs-identifier hs-type">HsFractional</span></a></span><span> </span><span id="local-6989586621683015135"><span class="annot"><span class="annottext">FractionalLit
</span><a href="#local-6989586621683015135"><span class="hs-identifier hs-var">frac_lit</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">FractionalLit -&gt; Maybe (HsExpr GhcTc)
</span><a href="#local-6989586621683015136"><span class="hs-identifier hs-var">go_fractional</span></a></span><span> </span><span class="annot"><span class="annottext">FractionalLit
</span><a href="#local-6989586621683015135"><span class="hs-identifier hs-var">frac_lit</span></a></span><span>
</span><span id="line-2366"></span><span>      </span><span class="annot"><a href="Language.Haskell.Syntax.Lit.html#HsIsString"><span class="hs-identifier hs-type">HsIsString</span></a></span><span> </span><span id="local-6989586621683015138"><span class="annot"><span class="annottext">SourceText
</span><a href="#local-6989586621683015138"><span class="hs-identifier hs-var">s</span></a></span></span><span> </span><span id="local-6989586621683015139"><span class="annot"><span class="annottext">FastString
</span><a href="#local-6989586621683015139"><span class="hs-identifier hs-var">src</span></a></span></span><span>      </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">SourceText -&gt; FastString -&gt; Maybe (HsExpr GhcTc)
</span><a href="#local-6989586621683015140"><span class="hs-identifier hs-var">go_string</span></a></span><span>   </span><span class="annot"><span class="annottext">SourceText
</span><a href="#local-6989586621683015138"><span class="hs-identifier hs-var">s</span></a></span><span> </span><span class="annot"><span class="annottext">FastString
</span><a href="#local-6989586621683015139"><span class="hs-identifier hs-var">src</span></a></span><span>
</span><span id="line-2367"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-2368"></span><span>    </span><span id="local-6989586621683015133"><span class="annot"><span class="annottext">go_integral :: IntegralLit -&gt; Maybe (HsExpr GhcTc)
</span><a href="#local-6989586621683015133"><span class="hs-identifier hs-var hs-var">go_integral</span></a></span></span><span> </span><span id="local-6989586621683015141"><span class="annot"><span class="annottext">int :: IntegralLit
</span><a href="#local-6989586621683015141"><span class="hs-identifier hs-var">int</span></a></span></span><span class="hs-glyph">@</span><span class="hs-special">(</span><span class="annot"><a href="GHC.Types.SourceText.html#IL"><span class="hs-identifier hs-type">IL</span></a></span><span> </span><span id="local-6989586621683015143"><span class="annot"><span class="annottext">SourceText
</span><a href="#local-6989586621683015143"><span class="hs-identifier hs-var">src</span></a></span></span><span> </span><span id="local-6989586621683015144"><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621683015144"><span class="hs-identifier hs-var">neg</span></a></span></span><span> </span><span id="local-6989586621683015145"><span class="annot"><span class="annottext">Integer
</span><a href="#local-6989586621683015145"><span class="hs-identifier hs-var">i</span></a></span></span><span class="hs-special">)</span><span>
</span><span id="line-2369"></span><span>      </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">TcType -&gt; Bool
</span><a href="GHC.Tc.Utils.TcType.html#isIntTy"><span class="hs-identifier hs-var">isIntTy</span></a></span><span> </span><span class="annot"><span class="annottext">TcType
</span><a href="#local-6989586621683015130"><span class="hs-identifier hs-var">res_ty</span></a></span><span>  </span><span class="annot"><span class="annottext">Bool -&gt; Bool -&gt; Bool
</span><span class="hs-operator hs-var">&amp;&amp;</span></span><span> </span><span class="annot"><span class="annottext">Platform -&gt; Integer -&gt; Bool
</span><a href="GHC.Platform.html#platformInIntRange"><span class="hs-identifier hs-var">platformInIntRange</span></a></span><span>  </span><span class="annot"><span class="annottext">Platform
</span><a href="#local-6989586621683015128"><span class="hs-identifier hs-var">platform</span></a></span><span> </span><span class="annot"><span class="annottext">Integer
</span><a href="#local-6989586621683015145"><span class="hs-identifier hs-var">i</span></a></span><span>
</span><span id="line-2370"></span><span>      </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">HsExpr GhcTc -&gt; Maybe (HsExpr GhcTc)
forall a. a -&gt; Maybe a
</span><span class="hs-identifier hs-var">Just</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">XLitE GhcTc -&gt; HsLit GhcTc -&gt; HsExpr GhcTc
forall p. XLitE p -&gt; HsLit p -&gt; HsExpr p
</span><a href="Language.Haskell.Syntax.Expr.html#HsLit"><span class="hs-identifier hs-var">HsLit</span></a></span><span> </span><span class="annot"><span class="annottext">XLitE GhcTc
NoExtField
</span><a href="Language.Haskell.Syntax.Extension.html#noExtField"><span class="hs-identifier hs-var">noExtField</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">XHsInt GhcTc -&gt; IntegralLit -&gt; HsLit GhcTc
forall x. XHsInt x -&gt; IntegralLit -&gt; HsLit x
</span><a href="Language.Haskell.Syntax.Lit.html#HsInt"><span class="hs-identifier hs-var">HsInt</span></a></span><span> </span><span class="annot"><span class="annottext">XHsInt GhcTc
NoExtField
</span><a href="Language.Haskell.Syntax.Extension.html#noExtField"><span class="hs-identifier hs-var">noExtField</span></a></span><span> </span><span class="annot"><span class="annottext">IntegralLit
</span><a href="#local-6989586621683015141"><span class="hs-identifier hs-var">int</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-2371"></span><span>      </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">TcType -&gt; Bool
</span><a href="GHC.Tc.Utils.TcType.html#isWordTy"><span class="hs-identifier hs-var">isWordTy</span></a></span><span> </span><span class="annot"><span class="annottext">TcType
</span><a href="#local-6989586621683015130"><span class="hs-identifier hs-var">res_ty</span></a></span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Bool -&gt; Bool
</span><span class="hs-operator hs-var">&amp;&amp;</span></span><span> </span><span class="annot"><span class="annottext">Platform -&gt; Integer -&gt; Bool
</span><a href="GHC.Platform.html#platformInWordRange"><span class="hs-identifier hs-var">platformInWordRange</span></a></span><span> </span><span class="annot"><span class="annottext">Platform
</span><a href="#local-6989586621683015128"><span class="hs-identifier hs-var">platform</span></a></span><span> </span><span class="annot"><span class="annottext">Integer
</span><a href="#local-6989586621683015145"><span class="hs-identifier hs-var">i</span></a></span><span>
</span><span id="line-2372"></span><span>      </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">HsExpr GhcTc -&gt; Maybe (HsExpr GhcTc)
forall a. a -&gt; Maybe a
</span><span class="hs-identifier hs-var">Just</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">DataCon -&gt; HsLit GhcTc -&gt; HsExpr GhcTc
</span><a href="GHC.Tc.Utils.TcMType.html#mkLit"><span class="hs-identifier hs-var">mkLit</span></a></span><span> </span><span class="annot"><span class="annottext">DataCon
</span><a href="GHC.Builtin.Types.html#wordDataCon"><span class="hs-identifier hs-var">wordDataCon</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">XHsWordPrim GhcTc -&gt; Integer -&gt; HsLit GhcTc
forall x. XHsWordPrim x -&gt; Integer -&gt; HsLit x
</span><a href="Language.Haskell.Syntax.Lit.html#HsWordPrim"><span class="hs-identifier hs-var">HsWordPrim</span></a></span><span> </span><span class="annot"><span class="annottext">XHsWordPrim GhcTc
SourceText
</span><a href="#local-6989586621683015143"><span class="hs-identifier hs-var">src</span></a></span><span> </span><span class="annot"><span class="annottext">Integer
</span><a href="#local-6989586621683015145"><span class="hs-identifier hs-var">i</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-2373"></span><span>      </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">TcType -&gt; Bool
</span><a href="GHC.Tc.Utils.TcType.html#isIntegerTy"><span class="hs-identifier hs-var">isIntegerTy</span></a></span><span> </span><span class="annot"><span class="annottext">TcType
</span><a href="#local-6989586621683015130"><span class="hs-identifier hs-var">res_ty</span></a></span><span>
</span><span id="line-2374"></span><span>      </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">HsExpr GhcTc -&gt; Maybe (HsExpr GhcTc)
forall a. a -&gt; Maybe a
</span><span class="hs-identifier hs-var">Just</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">XLitE GhcTc -&gt; HsLit GhcTc -&gt; HsExpr GhcTc
forall p. XLitE p -&gt; HsLit p -&gt; HsExpr p
</span><a href="Language.Haskell.Syntax.Expr.html#HsLit"><span class="hs-identifier hs-var">HsLit</span></a></span><span> </span><span class="annot"><span class="annottext">XLitE GhcTc
NoExtField
</span><a href="Language.Haskell.Syntax.Extension.html#noExtField"><span class="hs-identifier hs-var">noExtField</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">XHsInteger GhcTc -&gt; Integer -&gt; TcType -&gt; HsLit GhcTc
forall x. XHsInteger x -&gt; Integer -&gt; TcType -&gt; HsLit x
</span><a href="Language.Haskell.Syntax.Lit.html#HsInteger"><span class="hs-identifier hs-var">HsInteger</span></a></span><span> </span><span class="annot"><span class="annottext">XHsInteger GhcTc
SourceText
</span><a href="#local-6989586621683015143"><span class="hs-identifier hs-var">src</span></a></span><span> </span><span class="annot"><span class="annottext">Integer
</span><a href="#local-6989586621683015145"><span class="hs-identifier hs-var">i</span></a></span><span> </span><span class="annot"><span class="annottext">TcType
</span><a href="#local-6989586621683015130"><span class="hs-identifier hs-var">res_ty</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-2375"></span><span>      </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">otherwise</span></span><span>
</span><span id="line-2376"></span><span>      </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">FractionalLit -&gt; Maybe (HsExpr GhcTc)
</span><a href="#local-6989586621683015136"><span class="hs-identifier hs-var">go_fractional</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Bool -&gt; Integer -&gt; FractionalLit
</span><a href="GHC.Types.SourceText.html#integralFractionalLit"><span class="hs-identifier hs-var">integralFractionalLit</span></a></span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621683015144"><span class="hs-identifier hs-var">neg</span></a></span><span> </span><span class="annot"><span class="annottext">Integer
</span><a href="#local-6989586621683015145"><span class="hs-identifier hs-var">i</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-2377"></span><span>        </span><span class="hs-comment">-- The 'otherwise' case is important</span><span>
</span><span id="line-2378"></span><span>        </span><span class="hs-comment">-- Consider (3 :: Float).  Syntactically it looks like an IntLit,</span><span>
</span><span id="line-2379"></span><span>        </span><span class="hs-comment">-- so we'll call shortCutIntLit, but of course it's a float</span><span>
</span><span id="line-2380"></span><span>        </span><span class="hs-comment">-- This can make a big difference for programs with a lot of</span><span>
</span><span id="line-2381"></span><span>        </span><span class="hs-comment">-- literals, compiled without -O</span><span>
</span><span id="line-2382"></span><span>
</span><span id="line-2383"></span><span>    </span><span id="local-6989586621683015136"><span class="annot"><span class="annottext">go_fractional :: FractionalLit -&gt; Maybe (HsExpr GhcTc)
</span><a href="#local-6989586621683015136"><span class="hs-identifier hs-var hs-var">go_fractional</span></a></span></span><span> </span><span id="local-6989586621683015159"><span class="annot"><span class="annottext">FractionalLit
</span><a href="#local-6989586621683015159"><span class="hs-identifier hs-var">f</span></a></span></span><span>
</span><span id="line-2384"></span><span>      </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">TcType -&gt; Bool
</span><a href="GHC.Tc.Utils.TcType.html#isFloatTy"><span class="hs-identifier hs-var">isFloatTy</span></a></span><span> </span><span class="annot"><span class="annottext">TcType
</span><a href="#local-6989586621683015130"><span class="hs-identifier hs-var">res_ty</span></a></span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Bool -&gt; Bool
</span><span class="hs-operator hs-var">&amp;&amp;</span></span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621683015161"><span class="hs-identifier hs-var">valueInRange</span></a></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">HsExpr GhcTc -&gt; Maybe (HsExpr GhcTc)
forall a. a -&gt; Maybe a
</span><span class="hs-identifier hs-var">Just</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">DataCon -&gt; HsLit GhcTc -&gt; HsExpr GhcTc
</span><a href="GHC.Tc.Utils.TcMType.html#mkLit"><span class="hs-identifier hs-var">mkLit</span></a></span><span> </span><span class="annot"><span class="annottext">DataCon
</span><a href="GHC.Builtin.Types.html#floatDataCon"><span class="hs-identifier hs-var">floatDataCon</span></a></span><span>  </span><span class="hs-special">(</span><span class="annot"><span class="annottext">XHsFloatPrim GhcTc -&gt; FractionalLit -&gt; HsLit GhcTc
forall x. XHsFloatPrim x -&gt; FractionalLit -&gt; HsLit x
</span><a href="Language.Haskell.Syntax.Lit.html#HsFloatPrim"><span class="hs-identifier hs-var">HsFloatPrim</span></a></span><span> </span><span class="annot"><span class="annottext">XHsFloatPrim GhcTc
NoExtField
</span><a href="Language.Haskell.Syntax.Extension.html#noExtField"><span class="hs-identifier hs-var">noExtField</span></a></span><span> </span><span class="annot"><span class="annottext">FractionalLit
</span><a href="#local-6989586621683015159"><span class="hs-identifier hs-var">f</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-2385"></span><span>      </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">TcType -&gt; Bool
</span><a href="GHC.Tc.Utils.TcType.html#isDoubleTy"><span class="hs-identifier hs-var">isDoubleTy</span></a></span><span> </span><span class="annot"><span class="annottext">TcType
</span><a href="#local-6989586621683015130"><span class="hs-identifier hs-var">res_ty</span></a></span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Bool -&gt; Bool
</span><span class="hs-operator hs-var">&amp;&amp;</span></span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621683015161"><span class="hs-identifier hs-var">valueInRange</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">HsExpr GhcTc -&gt; Maybe (HsExpr GhcTc)
forall a. a -&gt; Maybe a
</span><span class="hs-identifier hs-var">Just</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">DataCon -&gt; HsLit GhcTc -&gt; HsExpr GhcTc
</span><a href="GHC.Tc.Utils.TcMType.html#mkLit"><span class="hs-identifier hs-var">mkLit</span></a></span><span> </span><span class="annot"><span class="annottext">DataCon
</span><a href="GHC.Builtin.Types.html#doubleDataCon"><span class="hs-identifier hs-var">doubleDataCon</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">XHsDoublePrim GhcTc -&gt; FractionalLit -&gt; HsLit GhcTc
forall x. XHsDoublePrim x -&gt; FractionalLit -&gt; HsLit x
</span><a href="Language.Haskell.Syntax.Lit.html#HsDoublePrim"><span class="hs-identifier hs-var">HsDoublePrim</span></a></span><span> </span><span class="annot"><span class="annottext">XHsDoublePrim GhcTc
NoExtField
</span><a href="Language.Haskell.Syntax.Extension.html#noExtField"><span class="hs-identifier hs-var">noExtField</span></a></span><span> </span><span class="annot"><span class="annottext">FractionalLit
</span><a href="#local-6989586621683015159"><span class="hs-identifier hs-var">f</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-2386"></span><span>      </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">otherwise</span></span><span>                         </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Maybe (HsExpr GhcTc)
forall a. Maybe a
</span><span class="hs-identifier hs-var">Nothing</span></span><span>
</span><span id="line-2387"></span><span>      </span><span class="hs-keyword">where</span><span>
</span><span id="line-2388"></span><span>        </span><span id="local-6989586621683015161"><span class="annot"><span class="annottext">valueInRange :: Bool
</span><a href="#local-6989586621683015161"><span class="hs-identifier hs-var hs-var">valueInRange</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-2389"></span><span>          </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">FractionalLit
</span><a href="#local-6989586621683015159"><span class="hs-identifier hs-var">f</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-2390"></span><span>            </span><span class="annot"><a href="GHC.Types.SourceText.html#FL"><span class="hs-identifier hs-type">FL</span></a></span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">fl_exp :: FractionalLit -&gt; Integer
</span><a href="GHC.Types.SourceText.html#fl_exp"><span class="hs-identifier hs-var">fl_exp</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="local-6989586621683015169"><span class="annot"><span class="annottext">Integer
</span><a href="#local-6989586621683015169"><span class="hs-identifier hs-var">e</span></a></span></span><span> </span><span class="hs-special">}</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="hs-glyph">-</span><span class="annot"><span class="annottext">Integer
</span><span class="hs-number">100</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Integer -&gt; Integer -&gt; Bool
forall a. Ord a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">&lt;=</span></span><span> </span><span class="annot"><span class="annottext">Integer
</span><a href="#local-6989586621683015169"><span class="hs-identifier hs-var">e</span></a></span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Bool -&gt; Bool
</span><span class="hs-operator hs-var">&amp;&amp;</span></span><span> </span><span class="annot"><span class="annottext">Integer
</span><a href="#local-6989586621683015169"><span class="hs-identifier hs-var">e</span></a></span><span> </span><span class="annot"><span class="annottext">Integer -&gt; Integer -&gt; Bool
forall a. Ord a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">&lt;=</span></span><span> </span><span class="annot"><span class="annottext">Integer
</span><span class="hs-number">100</span></span><span>
</span><span id="line-2391"></span><span>            </span><span class="hs-comment">-- We limit short-cutting Fractional Literals to when their power of 10</span><span>
</span><span id="line-2392"></span><span>            </span><span class="hs-comment">-- is less than 100, which ensures desugaring isn't slow.</span><span>
</span><span id="line-2393"></span><span>
</span><span id="line-2394"></span><span>    </span><span id="local-6989586621683015140"><span class="annot"><span class="annottext">go_string :: SourceText -&gt; FastString -&gt; Maybe (HsExpr GhcTc)
</span><a href="#local-6989586621683015140"><span class="hs-identifier hs-var hs-var">go_string</span></a></span></span><span> </span><span id="local-6989586621683015171"><span class="annot"><span class="annottext">SourceText
</span><a href="#local-6989586621683015171"><span class="hs-identifier hs-var">src</span></a></span></span><span> </span><span id="local-6989586621683015172"><span class="annot"><span class="annottext">FastString
</span><a href="#local-6989586621683015172"><span class="hs-identifier hs-var">s</span></a></span></span><span>
</span><span id="line-2395"></span><span>      </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">TcType -&gt; Bool
</span><a href="GHC.Tc.Utils.TcType.html#isStringTy"><span class="hs-identifier hs-var">isStringTy</span></a></span><span> </span><span class="annot"><span class="annottext">TcType
</span><a href="#local-6989586621683015130"><span class="hs-identifier hs-var">res_ty</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">HsExpr GhcTc -&gt; Maybe (HsExpr GhcTc)
forall a. a -&gt; Maybe a
</span><span class="hs-identifier hs-var">Just</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">XLitE GhcTc -&gt; HsLit GhcTc -&gt; HsExpr GhcTc
forall p. XLitE p -&gt; HsLit p -&gt; HsExpr p
</span><a href="Language.Haskell.Syntax.Expr.html#HsLit"><span class="hs-identifier hs-var">HsLit</span></a></span><span> </span><span class="annot"><span class="annottext">XLitE GhcTc
NoExtField
</span><a href="Language.Haskell.Syntax.Extension.html#noExtField"><span class="hs-identifier hs-var">noExtField</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">XHsString GhcTc -&gt; FastString -&gt; HsLit GhcTc
forall x. XHsString x -&gt; FastString -&gt; HsLit x
</span><a href="Language.Haskell.Syntax.Lit.html#HsString"><span class="hs-identifier hs-var">HsString</span></a></span><span> </span><span class="annot"><span class="annottext">XHsString GhcTc
SourceText
</span><a href="#local-6989586621683015171"><span class="hs-identifier hs-var">src</span></a></span><span> </span><span class="annot"><span class="annottext">FastString
</span><a href="#local-6989586621683015172"><span class="hs-identifier hs-var">s</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-2396"></span><span>      </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">otherwise</span></span><span>         </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Maybe (HsExpr GhcTc)
forall a. Maybe a
</span><span class="hs-identifier hs-var">Nothing</span></span><span>
</span><span id="line-2397"></span><span>
</span><span id="line-2398"></span><span class="annot"><a href="GHC.Tc.Utils.TcMType.html#mkLit"><span class="hs-identifier hs-type">mkLit</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Core.DataCon.html#DataCon"><span class="hs-identifier hs-type">DataCon</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Language.Haskell.Syntax.Lit.html#HsLit"><span class="hs-identifier hs-type">HsLit</span></a></span><span> </span><span class="annot"><a href="GHC.Hs.Extension.html#GhcTc"><span class="hs-identifier hs-type">GhcTc</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Language.Haskell.Syntax.Expr.html#HsExpr"><span class="hs-identifier hs-type">HsExpr</span></a></span><span> </span><span class="annot"><a href="GHC.Hs.Extension.html#GhcTc"><span class="hs-identifier hs-type">GhcTc</span></a></span><span>
</span><span id="line-2399"></span><span id="mkLit"><span class="annot"><span class="annottext">mkLit :: DataCon -&gt; HsLit GhcTc -&gt; HsExpr GhcTc
</span><a href="GHC.Tc.Utils.TcMType.html#mkLit"><span class="hs-identifier hs-var hs-var">mkLit</span></a></span></span><span> </span><span id="local-6989586621683015175"><span class="annot"><span class="annottext">DataCon
</span><a href="#local-6989586621683015175"><span class="hs-identifier hs-var">con</span></a></span></span><span> </span><span id="local-6989586621683015176"><span class="annot"><span class="annottext">HsLit GhcTc
</span><a href="#local-6989586621683015176"><span class="hs-identifier hs-var">lit</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">XApp GhcTc -&gt; LHsExpr GhcTc -&gt; LHsExpr GhcTc -&gt; HsExpr GhcTc
forall p. XApp p -&gt; LHsExpr p -&gt; LHsExpr p -&gt; HsExpr p
</span><a href="Language.Haskell.Syntax.Expr.html#HsApp"><span class="hs-identifier hs-var">HsApp</span></a></span><span> </span><span class="annot"><span class="annottext">XApp GhcTc
NoExtField
</span><a href="Language.Haskell.Syntax.Extension.html#noExtField"><span class="hs-identifier hs-var">noExtField</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">DataCon -&gt; LHsExpr GhcTc
</span><a href="GHC.Hs.Utils.html#nlHsDataCon"><span class="hs-identifier hs-var">nlHsDataCon</span></a></span><span> </span><span class="annot"><span class="annottext">DataCon
</span><a href="#local-6989586621683015175"><span class="hs-identifier hs-var">con</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">HsLit GhcTc -&gt; LHsExpr GhcTc
forall (p :: Pass). HsLit (GhcPass p) -&gt; LHsExpr (GhcPass p)
</span><a href="GHC.Hs.Utils.html#nlHsLit"><span class="hs-identifier hs-var">nlHsLit</span></a></span><span> </span><span class="annot"><span class="annottext">HsLit GhcTc
</span><a href="#local-6989586621683015176"><span class="hs-identifier hs-var">lit</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-2400"></span><span>
</span><span id="line-2401"></span><span class="hs-comment">------------------------------</span><span>
</span><span id="line-2402"></span><span class="annot"><a href="GHC.Tc.Utils.TcMType.html#hsOverLitName"><span class="hs-identifier hs-type">hsOverLitName</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Language.Haskell.Syntax.Lit.html#OverLitVal"><span class="hs-identifier hs-type">OverLitVal</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Types.Name.html#Name"><span class="hs-identifier hs-type">Name</span></a></span><span>
</span><span id="line-2403"></span><span class="hs-comment">-- Get the canonical 'fromX' name for a particular OverLitVal</span><span>
</span><span id="line-2404"></span><span id="hsOverLitName"><span class="annot"><span class="annottext">hsOverLitName :: OverLitVal -&gt; Name
</span><a href="GHC.Tc.Utils.TcMType.html#hsOverLitName"><span class="hs-identifier hs-var hs-var">hsOverLitName</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Language.Haskell.Syntax.Lit.html#HsIntegral"><span class="hs-identifier hs-type">HsIntegral</span></a></span><span> </span><span class="hs-special">{</span><span class="hs-special">}</span><span class="hs-special">)</span><span>   </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="GHC.Builtin.Names.html#fromIntegerName"><span class="hs-identifier hs-var">fromIntegerName</span></a></span><span>
</span><span id="line-2405"></span><span class="annot"><a href="GHC.Tc.Utils.TcMType.html#hsOverLitName"><span class="hs-identifier hs-var">hsOverLitName</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Language.Haskell.Syntax.Lit.html#HsFractional"><span class="hs-identifier hs-type">HsFractional</span></a></span><span> </span><span class="hs-special">{</span><span class="hs-special">}</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="GHC.Builtin.Names.html#fromRationalName"><span class="hs-identifier hs-var">fromRationalName</span></a></span><span>
</span><span id="line-2406"></span><span class="annot"><a href="GHC.Tc.Utils.TcMType.html#hsOverLitName"><span class="hs-identifier hs-var">hsOverLitName</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Language.Haskell.Syntax.Lit.html#HsIsString"><span class="hs-identifier hs-type">HsIsString</span></a></span><span> </span><span class="hs-special">{</span><span class="hs-special">}</span><span class="hs-special">)</span><span>   </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="GHC.Builtin.Names.html#fromStringName"><span class="hs-identifier hs-var">fromStringName</span></a></span><span>
</span><span id="line-2407"></span><span>
</span><span id="line-2408"></span><span>
</span><span id="line-2409"></span><span class="annot"><span class="hs-comment">{- *********************************************************************
*                                                                      *
              Promotion
*                                                                      *
********************************************************************* -}</span></span><span>
</span><span id="line-2414"></span><span>
</span><span id="line-2415"></span><span class="annot"><a href="GHC.Tc.Utils.TcMType.html#promoteMetaTyVarTo"><span class="hs-identifier hs-type">promoteMetaTyVarTo</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Utils.Misc.html#HasDebugCallStack"><span class="hs-identifier hs-type">HasDebugCallStack</span></a></span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.TcType.html#TcLevel"><span class="hs-identifier hs-type">TcLevel</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Types.Var.html#TcTyVar"><span class="hs-identifier hs-type">TcTyVar</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#TcM"><span class="hs-identifier hs-type">TcM</span></a></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Bool</span></span><span>
</span><span id="line-2416"></span><span class="hs-comment">-- When we float a constraint out of an implication we must restore</span><span>
</span><span id="line-2417"></span><span class="hs-comment">-- invariant (WantedInv) in Note [TcLevel invariants] in GHC.Tc.Utils.TcType</span><span>
</span><span id="line-2418"></span><span class="hs-comment">-- Return True &lt;=&gt; we did some promotion</span><span>
</span><span id="line-2419"></span><span class="hs-comment">-- Also returns either the original tyvar (no promotion) or the new one</span><span>
</span><span id="line-2420"></span><span class="hs-comment">-- See Note [Promoting unification variables]</span><span>
</span><span id="line-2421"></span><span id="promoteMetaTyVarTo"><span class="annot"><span class="annottext">promoteMetaTyVarTo :: HasDebugCallStack =&gt;
TcLevel -&gt; TcTyVar -&gt; TcRnIf TcGblEnv TcLclEnv Bool
</span><a href="GHC.Tc.Utils.TcMType.html#promoteMetaTyVarTo"><span class="hs-identifier hs-var hs-var">promoteMetaTyVarTo</span></a></span></span><span> </span><span id="local-6989586621683015198"><span class="annot"><span class="annottext">TcLevel
</span><a href="#local-6989586621683015198"><span class="hs-identifier hs-var">tclvl</span></a></span></span><span> </span><span id="local-6989586621683015199"><span class="annot"><span class="annottext">TcTyVar
</span><a href="#local-6989586621683015199"><span class="hs-identifier hs-var">tv</span></a></span></span><span>
</span><span id="line-2422"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool -&gt; SDoc -&gt; Bool -&gt; Bool
forall a. HasCallStack =&gt; Bool -&gt; SDoc -&gt; a -&gt; a
</span><a href="GHC.Utils.Panic.html#assertPpr"><span class="hs-identifier hs-var">assertPpr</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TcTyVar -&gt; Bool
</span><a href="GHC.Tc.Utils.TcType.html#isMetaTyVar"><span class="hs-identifier hs-var">isMetaTyVar</span></a></span><span> </span><span class="annot"><span class="annottext">TcTyVar
</span><a href="#local-6989586621683015199"><span class="hs-identifier hs-var">tv</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TcTyVar -&gt; SDoc
forall a. Outputable a =&gt; a -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="annot"><span class="annottext">TcTyVar
</span><a href="#local-6989586621683015199"><span class="hs-identifier hs-var">tv</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(Bool -&gt; Bool) -&gt; Bool -&gt; Bool
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-2423"></span><span>    </span><span class="annot"><span class="annottext">TcTyVar -&gt; TcLevel
</span><a href="GHC.Tc.Utils.TcType.html#tcTyVarLevel"><span class="hs-identifier hs-var">tcTyVarLevel</span></a></span><span> </span><span class="annot"><span class="annottext">TcTyVar
</span><a href="#local-6989586621683015199"><span class="hs-identifier hs-var">tv</span></a></span><span> </span><span class="annot"><span class="annottext">TcLevel -&gt; TcLevel -&gt; Bool
</span><a href="GHC.Tc.Utils.TcType.html#strictlyDeeperThan"><span class="hs-operator hs-var">`strictlyDeeperThan`</span></a></span><span> </span><span class="annot"><span class="annottext">TcLevel
</span><a href="#local-6989586621683015198"><span class="hs-identifier hs-var">tclvl</span></a></span><span>
</span><span id="line-2424"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span id="local-6989586621683015200"><span class="annot"><a href="#local-6989586621683015200"><span class="hs-identifier hs-var">cloned_tv</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">TcTyVar -&gt; IOEnv (Env TcGblEnv TcLclEnv) TcTyVar
</span><a href="GHC.Tc.Utils.TcMType.html#cloneMetaTyVar"><span class="hs-identifier hs-var">cloneMetaTyVar</span></a></span><span> </span><span class="annot"><span class="annottext">TcTyVar
</span><a href="#local-6989586621683015199"><span class="hs-identifier hs-var">tv</span></a></span><span>
</span><span id="line-2425"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621683015201"><span class="annot"><a href="#local-6989586621683015201"><span class="hs-identifier hs-var hs-var">rhs_tv</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">TcTyVar -&gt; TcLevel -&gt; TcTyVar
</span><a href="GHC.Tc.Utils.TcType.html#setMetaTyVarTcLevel"><span class="hs-identifier hs-var">setMetaTyVarTcLevel</span></a></span><span> </span><span class="annot"><span class="annottext">TcTyVar
</span><a href="#local-6989586621683015200"><span class="hs-identifier hs-var">cloned_tv</span></a></span><span> </span><span class="annot"><span class="annottext">TcLevel
</span><a href="#local-6989586621683015198"><span class="hs-identifier hs-var">tclvl</span></a></span><span>
</span><span id="line-2426"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.Monad.html#liftZonkM"><span class="hs-identifier hs-type">liftZonkM</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="annot"><a href="GHC.Tc.Zonk.TcType.html#writeMetaTyVar"><span class="hs-identifier hs-type">writeMetaTyVar</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683015199"><span class="hs-identifier hs-type">tv</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#mkTyVarTy"><span class="hs-identifier hs-type">mkTyVarTy</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683015201"><span class="hs-identifier hs-type">rhs_tv</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-2427"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.Monad.html#traceTc"><span class="hs-identifier hs-type">traceTc</span></a></span><span> </span><span class="annot"><span class="hs-string">&quot;promoteTyVar&quot;</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-type">ppr</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683015199"><span class="hs-identifier hs-type">tv</span></a></span><span> </span><span class="annot"><a href="GHC.Utils.Outputable.html#%3C%2B%3E"><span class="hs-operator hs-type">&lt;+&gt;</span></a></span><span> </span><span class="annot"><a href="GHC.Utils.Outputable.html#text"><span class="hs-identifier hs-type">text</span></a></span><span> </span><span class="annot"><span class="hs-string">&quot;--&gt;&quot;</span></span><span> </span><span class="annot"><a href="GHC.Utils.Outputable.html#%3C%2B%3E"><span class="hs-operator hs-type">&lt;+&gt;</span></a></span><span> </span><span class="annot"><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-type">ppr</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683015201"><span class="hs-identifier hs-type">rhs_tv</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-2428"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">return</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">True</span></span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-2429"></span><span>   </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">otherwise</span></span><span>
</span><span id="line-2430"></span><span>   </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Bool -&gt; TcRnIf TcGblEnv TcLclEnv Bool
forall a. a -&gt; IOEnv (Env TcGblEnv TcLclEnv) a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">False</span></span><span>
</span><span id="line-2431"></span><span>
</span><span id="line-2432"></span><span class="hs-comment">-- Returns whether or not *any* tyvar is defaulted</span><span>
</span><span id="line-2433"></span><span class="annot"><a href="GHC.Tc.Utils.TcMType.html#promoteTyVarSet"><span class="hs-identifier hs-type">promoteTyVarSet</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Utils.Misc.html#HasDebugCallStack"><span class="hs-identifier hs-type">HasDebugCallStack</span></a></span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.TcType.html#TcTyVarSet"><span class="hs-identifier hs-type">TcTyVarSet</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#TcM"><span class="hs-identifier hs-type">TcM</span></a></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Bool</span></span><span>
</span><span id="line-2434"></span><span id="promoteTyVarSet"><span class="annot"><span class="annottext">promoteTyVarSet :: HasDebugCallStack =&gt; CoVarSet -&gt; TcRnIf TcGblEnv TcLclEnv Bool
</span><a href="GHC.Tc.Utils.TcMType.html#promoteTyVarSet"><span class="hs-identifier hs-var hs-var">promoteTyVarSet</span></a></span></span><span> </span><span id="local-6989586621683015211"><span class="annot"><span class="annottext">CoVarSet
</span><a href="#local-6989586621683015211"><span class="hs-identifier hs-var">tvs</span></a></span></span><span>
</span><span id="line-2435"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span id="local-6989586621683015212"><span class="annot"><a href="#local-6989586621683015212"><span class="hs-identifier hs-var">tclvl</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">TcM TcLevel
</span><a href="GHC.Tc.Utils.Monad.html#getTcLevel"><span class="hs-identifier hs-var">getTcLevel</span></a></span><span>
</span><span id="line-2436"></span><span>       </span><span class="hs-special">;</span><span> </span><span id="local-6989586621683015213"><span class="annot"><a href="#local-6989586621683015213"><span class="hs-identifier hs-var">bools</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="hs-identifier hs-type">mapM</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Tc.Utils.TcMType.html#promoteMetaTyVarTo"><span class="hs-identifier hs-type">promoteMetaTyVarTo</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683015212"><span class="hs-identifier hs-type">tclvl</span></a></span><span class="hs-special">)</span><span>  </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span>
</span><span id="line-2437"></span><span>                  </span><span class="annot"><span class="hs-identifier hs-type">filter</span></span><span> </span><span class="annot"><a href="GHC.Tc.Utils.TcType.html#isPromotableMetaTyVar"><span class="hs-identifier hs-type">isPromotableMetaTyVar</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span>
</span><span id="line-2438"></span><span>                  </span><span class="annot"><a href="GHC.Types.Unique.Set.html#nonDetEltsUniqSet"><span class="hs-identifier hs-type">nonDetEltsUniqSet</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683015211"><span class="hs-identifier hs-type">tvs</span></a></span><span>
</span><span id="line-2439"></span><span>         </span><span class="hs-comment">-- Non-determinism is OK because order of promotion doesn't matter</span><span>
</span><span id="line-2440"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">return</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">or</span></span><span> </span><span class="annot"><a href="#local-6989586621683015213"><span class="hs-identifier hs-type">bools</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-2441"></span><span>
</span><span id="line-2442"></span><span class="hs-comment">{-
%************************************************************************
%*                                                                      *
             Representation polymorphism checks
*                                                                       *
***********************************************************************-}</span><span>
</span><span id="line-2448"></span><span>
</span><span id="line-2449"></span><span class="hs-comment">-- | Check that the specified type has a fixed runtime representation.</span><span>
</span><span id="line-2450"></span><span class="hs-comment">--</span><span>
</span><span id="line-2451"></span><span class="hs-comment">-- If it isn't, throw a representation-polymorphism error appropriate</span><span>
</span><span id="line-2452"></span><span class="hs-comment">-- for the context (as specified by the 'FixedRuntimeRepProvenance').</span><span>
</span><span id="line-2453"></span><span class="hs-comment">--</span><span>
</span><span id="line-2454"></span><span class="hs-comment">-- Unlike the other representation polymorphism checks, which can emit</span><span>
</span><span id="line-2455"></span><span class="hs-comment">-- new Wanted constraints to be solved by the constraint solver, this function</span><span>
</span><span id="line-2456"></span><span class="hs-comment">-- does not emit any constraints: it has enough information to immediately</span><span>
</span><span id="line-2457"></span><span class="hs-comment">-- make a decision.</span><span>
</span><span id="line-2458"></span><span class="hs-comment">--</span><span>
</span><span id="line-2459"></span><span class="hs-comment">-- See (1) in Note [Representation polymorphism checking] in GHC.Tc.Utils.Concrete</span><span>
</span><span id="line-2460"></span><span class="annot"><a href="GHC.Tc.Utils.TcMType.html#checkTypeHasFixedRuntimeRep"><span class="hs-identifier hs-type">checkTypeHasFixedRuntimeRep</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Tc.Errors.Types.html#FixedRuntimeRepProvenance"><span class="hs-identifier hs-type">FixedRuntimeRepProvenance</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#Type"><span class="hs-identifier hs-type">Type</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#TcM"><span class="hs-identifier hs-type">TcM</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-2461"></span><span id="checkTypeHasFixedRuntimeRep"><span class="annot"><span class="annottext">checkTypeHasFixedRuntimeRep :: FixedRuntimeRepProvenance -&gt; TcType -&gt; TcRn ()
</span><a href="GHC.Tc.Utils.TcMType.html#checkTypeHasFixedRuntimeRep"><span class="hs-identifier hs-var hs-var">checkTypeHasFixedRuntimeRep</span></a></span></span><span> </span><span id="local-6989586621683015216"><span class="annot"><span class="annottext">FixedRuntimeRepProvenance
</span><a href="#local-6989586621683015216"><span class="hs-identifier hs-var">prov</span></a></span></span><span> </span><span id="local-6989586621683015217"><span class="annot"><span class="annottext">TcType
</span><a href="#local-6989586621683015217"><span class="hs-identifier hs-var">ty</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-2462"></span><span>  </span><span class="annot"><span class="annottext">Bool -&gt; TcRn () -&gt; TcRn ()
forall (f :: * -&gt; *). Applicative f =&gt; Bool -&gt; f () -&gt; f ()
</span><span class="hs-identifier hs-var">unless</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">HasDebugCallStack =&gt; TcType -&gt; Bool
TcType -&gt; Bool
</span><a href="GHC.Core.Type.html#typeHasFixedRuntimeRep"><span class="hs-identifier hs-var">typeHasFixedRuntimeRep</span></a></span><span> </span><span class="annot"><span class="annottext">TcType
</span><a href="#local-6989586621683015217"><span class="hs-identifier hs-var">ty</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-2463"></span><span>    </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(ErrInfo -&gt; TcRnMessage) -&gt; TcRn ()
</span><a href="GHC.Tc.Utils.Monad.html#addDetailedDiagnostic"><span class="hs-identifier hs-var">addDetailedDiagnostic</span></a></span><span> </span><span class="annot"><span class="annottext">((ErrInfo -&gt; TcRnMessage) -&gt; TcRn ())
-&gt; (ErrInfo -&gt; TcRnMessage) -&gt; TcRn ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">TcType -&gt; FixedRuntimeRepProvenance -&gt; ErrInfo -&gt; TcRnMessage
</span><a href="GHC.Tc.Errors.Types.html#TcRnTypeDoesNotHaveFixedRuntimeRep"><span class="hs-identifier hs-var">TcRnTypeDoesNotHaveFixedRuntimeRep</span></a></span><span> </span><span class="annot"><span class="annottext">TcType
</span><a href="#local-6989586621683015217"><span class="hs-identifier hs-var">ty</span></a></span><span> </span><span class="annot"><span class="annottext">FixedRuntimeRepProvenance
</span><a href="#local-6989586621683015216"><span class="hs-identifier hs-var">prov</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-2464"></span><span>
</span><span id="line-2465"></span><span class="hs-comment">{-
%************************************************************************
%*                                                                      *
             Error messages
*                                                                       *
*************************************************************************

-}</span><span>
</span><span id="line-2473"></span><span>
</span><span id="line-2474"></span><span class="hs-comment">-- See Note [Naughty quantification candidates]</span><span>
</span><span id="line-2475"></span><span id="local-6989586621683013523"><span class="annot"><a href="GHC.Tc.Utils.TcMType.html#naughtyQuantification"><span class="hs-identifier hs-type">naughtyQuantification</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.TcType.html#TcType"><span class="hs-identifier hs-type">TcType</span></a></span><span>   </span><span class="hs-comment">-- original type user wanted to quantify</span><span>
</span><span id="line-2476"></span><span>                      </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Types.Var.html#TcTyVar"><span class="hs-identifier hs-type">TcTyVar</span></a></span><span>  </span><span class="hs-comment">-- naughty var</span><span>
</span><span id="line-2477"></span><span>                      </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Types.Var.Set.html#TyVarSet"><span class="hs-identifier hs-type">TyVarSet</span></a></span><span> </span><span class="hs-comment">-- skolems that would escape</span><span>
</span><span id="line-2478"></span><span>                      </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#TcM"><span class="hs-identifier hs-type">TcM</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683013523"><span class="hs-identifier hs-type">a</span></a></span></span><span>
</span><span id="line-2479"></span><span id="naughtyQuantification"><span class="annot"><span class="annottext">naughtyQuantification :: forall a. TcType -&gt; TcTyVar -&gt; CoVarSet -&gt; TcM a
</span><a href="GHC.Tc.Utils.TcMType.html#naughtyQuantification"><span class="hs-identifier hs-var hs-var">naughtyQuantification</span></a></span></span><span> </span><span id="local-6989586621683015226"><span class="annot"><span class="annottext">TcType
</span><a href="#local-6989586621683015226"><span class="hs-identifier hs-var">orig_ty</span></a></span></span><span> </span><span id="local-6989586621683015227"><span class="annot"><span class="annottext">TcTyVar
</span><a href="#local-6989586621683015227"><span class="hs-identifier hs-var">tv</span></a></span></span><span> </span><span id="local-6989586621683015228"><span class="annot"><span class="annottext">CoVarSet
</span><a href="#local-6989586621683015228"><span class="hs-identifier hs-var">escapees</span></a></span></span><span>
</span><span id="line-2480"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span class="hs-special">(</span><span id="local-6989586621683015229"><span class="annot"><a href="#local-6989586621683015229"><span class="hs-identifier hs-var">orig_ty1</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621683015230"><span class="annot"><a href="#local-6989586621683015230"><span class="hs-identifier hs-var">escapees'</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">ZonkM (TcType, [TcTyVar]) -&gt; TcM (TcType, [TcTyVar])
forall a. ZonkM a -&gt; TcM a
</span><a href="GHC.Tc.Utils.Monad.html#liftZonkM"><span class="hs-identifier hs-var">liftZonkM</span></a></span><span> </span><span class="annot"><span class="annottext">(ZonkM (TcType, [TcTyVar]) -&gt; TcM (TcType, [TcTyVar]))
-&gt; ZonkM (TcType, [TcTyVar]) -&gt; TcM (TcType, [TcTyVar])
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-2481"></span><span>           </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span id="local-6989586621683015231"><span class="annot"><a href="#local-6989586621683015231"><span class="hs-identifier hs-var">orig_ty1</span></a></span></span><span>  </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">TcType -&gt; ZonkM TcType
</span><a href="GHC.Tc.Zonk.TcType.html#zonkTcType"><span class="hs-identifier hs-var">zonkTcType</span></a></span><span> </span><span class="annot"><span class="annottext">TcType
</span><a href="#local-6989586621683015226"><span class="hs-identifier hs-var">orig_ty</span></a></span><span>  </span><span class="hs-comment">-- in case it's not zonked</span><span>
</span><span id="line-2482"></span><span>              </span><span class="hs-special">;</span><span> </span><span id="local-6989586621683015232"><span class="annot"><a href="#local-6989586621683015232"><span class="hs-identifier hs-var">escapees'</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><a href="GHC.Tc.Zonk.TcType.html#zonkTcTyVarsToTcTyVars"><span class="hs-identifier hs-type">zonkTcTyVarsToTcTyVars</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span>
</span><span id="line-2483"></span><span>                             </span><span class="annot"><a href="GHC.Types.Unique.Set.html#nonDetEltsUniqSet"><span class="hs-identifier hs-type">nonDetEltsUniqSet</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683015228"><span class="hs-identifier hs-type">escapees</span></a></span><span>
</span><span id="line-2484"></span><span>                             </span><span class="hs-comment">-- we'll just be printing, so no harmful non-determinism</span><span>
</span><span id="line-2485"></span><span>              </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">return</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621683015231"><span class="hs-identifier hs-type">orig_ty1</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="#local-6989586621683015232"><span class="hs-identifier hs-type">escapees'</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-2486"></span><span>
</span><span id="line-2487"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621683015234"><span class="annot"><a href="#local-6989586621683015234"><span class="hs-identifier hs-var hs-var">fvs</span></a></span></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">TcType -&gt; [TcTyVar]
</span><a href="GHC.Core.TyCo.FVs.html#tyCoVarsOfTypeList"><span class="hs-identifier hs-var">tyCoVarsOfTypeList</span></a></span><span> </span><span class="annot"><span class="annottext">TcType
</span><a href="#local-6989586621683015229"><span class="hs-identifier hs-var">orig_ty1</span></a></span><span>
</span><span id="line-2488"></span><span>             </span><span id="local-6989586621683015236"><span class="annot"><a href="#local-6989586621683015236"><span class="hs-identifier hs-var hs-var">env0</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">TidyEnv -&gt; [TcTyVar] -&gt; TidyEnv
</span><a href="GHC.Core.TyCo.Tidy.html#tidyFreeTyCoVars"><span class="hs-identifier hs-var">tidyFreeTyCoVars</span></a></span><span> </span><span class="annot"><span class="annottext">TidyEnv
</span><a href="GHC.Types.Var.Env.html#emptyTidyEnv"><span class="hs-identifier hs-var">emptyTidyEnv</span></a></span><span> </span><span class="annot"><span class="annottext">[TcTyVar]
</span><a href="#local-6989586621683015234"><span class="hs-identifier hs-var">fvs</span></a></span><span>
</span><span id="line-2489"></span><span>             </span><span id="local-6989586621683015238"><span class="annot"><a href="#local-6989586621683015238"><span class="hs-identifier hs-var hs-var">env</span></a></span></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">TidyEnv
</span><a href="#local-6989586621683015236"><span class="hs-identifier hs-var">env0</span></a></span><span> </span><span class="annot"><span class="annottext">TidyEnv -&gt; [TcTyVar] -&gt; TidyEnv
</span><a href="GHC.Types.Var.Env.html#delTidyEnvList"><span class="hs-operator hs-var">`delTidyEnvList`</span></a></span><span> </span><span class="annot"><span class="annottext">[TcTyVar]
</span><a href="#local-6989586621683015230"><span class="hs-identifier hs-var">escapees'</span></a></span><span>
</span><span id="line-2490"></span><span>                    </span><span class="hs-comment">-- this avoids gratuitous renaming of the escaped</span><span>
</span><span id="line-2491"></span><span>                    </span><span class="hs-comment">-- variables; very confusing to users!</span><span>
</span><span id="line-2492"></span><span>
</span><span id="line-2493"></span><span>             </span><span id="local-6989586621683015240"><span class="annot"><a href="#local-6989586621683015240"><span class="hs-identifier hs-var hs-var">orig_ty'</span></a></span></span><span>   </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">TidyEnv -&gt; TcType -&gt; TcType
</span><a href="GHC.Core.TyCo.Tidy.html#tidyType"><span class="hs-identifier hs-var">tidyType</span></a></span><span> </span><span class="annot"><span class="annottext">TidyEnv
</span><a href="#local-6989586621683015238"><span class="hs-identifier hs-var">env</span></a></span><span> </span><span class="annot"><span class="annottext">TcType
</span><a href="#local-6989586621683015229"><span class="hs-identifier hs-var">orig_ty1</span></a></span><span>
</span><span id="line-2494"></span><span>             </span><span id="local-6989586621683015242"><span class="annot"><a href="#local-6989586621683015242"><span class="hs-identifier hs-var hs-var">tidied</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(TcTyVar -&gt; TcTyVar) -&gt; [TcTyVar] -&gt; [TcTyVar]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><span class="hs-identifier hs-var">map</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TidyEnv -&gt; TcTyVar -&gt; TcTyVar
</span><a href="GHC.Core.TyCo.Tidy.html#tidyTyCoVarOcc"><span class="hs-identifier hs-var">tidyTyCoVarOcc</span></a></span><span> </span><span class="annot"><span class="annottext">TidyEnv
</span><a href="#local-6989586621683015238"><span class="hs-identifier hs-var">env</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[TcTyVar]
</span><a href="#local-6989586621683015230"><span class="hs-identifier hs-var">escapees'</span></a></span><span>
</span><span id="line-2495"></span><span>             </span><span id="local-6989586621683015244"><span class="annot"><a href="#local-6989586621683015244"><span class="hs-identifier hs-var hs-var">msg</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[TcTyVar] -&gt; TcTyVar -&gt; TcType -&gt; TcRnMessage
</span><a href="GHC.Tc.Errors.Types.html#TcRnSkolemEscape"><span class="hs-identifier hs-var">TcRnSkolemEscape</span></a></span><span> </span><span class="annot"><span class="annottext">[TcTyVar]
</span><a href="#local-6989586621683015242"><span class="hs-identifier hs-var">tidied</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TidyEnv -&gt; TcTyVar -&gt; TcTyVar
</span><a href="GHC.Core.TyCo.Tidy.html#tidyTyCoVarOcc"><span class="hs-identifier hs-var">tidyTyCoVarOcc</span></a></span><span> </span><span class="annot"><span class="annottext">TidyEnv
</span><a href="#local-6989586621683015238"><span class="hs-identifier hs-var">env</span></a></span><span> </span><span class="annot"><span class="annottext">TcTyVar
</span><a href="#local-6989586621683015227"><span class="hs-identifier hs-var">tv</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">TcType
</span><a href="#local-6989586621683015240"><span class="hs-identifier hs-var">orig_ty'</span></a></span><span>
</span><span id="line-2496"></span><span>
</span><span id="line-2497"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.Monad.html#failWithTcM"><span class="hs-identifier hs-type">failWithTcM</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621683015238"><span class="hs-identifier hs-type">env</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="#local-6989586621683015244"><span class="hs-identifier hs-type">msg</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-2498"></span></pre></body></html>