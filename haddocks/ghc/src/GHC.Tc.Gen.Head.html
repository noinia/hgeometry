<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><link rel="stylesheet" type="text/css" href="style.css" /><script type="text/javascript" src="highlight.js"></script></head><body><pre><span>
</span><span id="line-2"></span><span class="hs-pragma">{-# LANGUAGE DataKinds           #-}</span><span>
</span><span id="line-3"></span><span class="hs-pragma">{-# LANGUAGE FlexibleContexts    #-}</span><span>
</span><span id="line-4"></span><span class="hs-pragma">{-# LANGUAGE GADTs               #-}</span><span>
</span><span id="line-5"></span><span class="hs-pragma">{-# LANGUAGE ScopedTypeVariables #-}</span><span>
</span><span id="line-6"></span><span class="hs-pragma">{-# LANGUAGE TupleSections       #-}</span><span>
</span><span id="line-7"></span><span class="hs-pragma">{-# LANGUAGE TypeFamilies        #-}</span><span>
</span><span id="line-8"></span><span class="hs-pragma">{-# LANGUAGE UndecidableInstances #-}</span><span> </span><span class="hs-comment">-- Wrinkle in Note [Trees That Grow]</span><span>
</span><span id="line-9"></span><span class="hs-pragma">{-# LANGUAGE ViewPatterns        #-}</span><span>
</span><span id="line-10"></span><span class="hs-pragma">{-# LANGUAGE DisambiguateRecordFields #-}</span><span>
</span><span id="line-11"></span><span>
</span><span id="line-12"></span><span class="hs-comment">{-
%
(c) The University of Glasgow 2006
(c) The GRASP/AQUA Project, Glasgow University, 1992-1998
-}</span><span>
</span><span id="line-17"></span><span>
</span><span id="line-18"></span><span class="hs-keyword">module</span><span> </span><span class="annot"><a href="GHC.Tc.Gen.Head.html"><span class="hs-identifier">GHC.Tc.Gen.Head</span></a></span><span>
</span><span id="line-19"></span><span>       </span><span class="hs-special">(</span><span> </span><span class="annot"><a href="GHC.Tc.Gen.Head.html#HsExprArg"><span class="hs-identifier">HsExprArg</span></a></span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Tc.Gen.Head.html#TcPass"><span class="hs-identifier">TcPass</span></a></span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Tc.Gen.Head.html#QLFlag"><span class="hs-identifier">QLFlag</span></a></span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Tc.Gen.Head.html#EWrap"><span class="hs-identifier">EWrap</span></a></span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span>
</span><span id="line-20"></span><span>       </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Tc.Gen.Head.html#AppCtxt"><span class="hs-identifier">AppCtxt</span></a></span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Tc.Gen.Head.html#appCtxtLoc"><span class="hs-identifier">appCtxtLoc</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Tc.Gen.Head.html#insideExpansion"><span class="hs-identifier">insideExpansion</span></a></span><span>
</span><span id="line-21"></span><span>       </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Tc.Gen.Head.html#splitHsApps"><span class="hs-identifier">splitHsApps</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Tc.Gen.Head.html#rebuildHsApps"><span class="hs-identifier">rebuildHsApps</span></a></span><span>
</span><span id="line-22"></span><span>       </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Tc.Gen.Head.html#addArgWrap"><span class="hs-identifier">addArgWrap</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Tc.Gen.Head.html#isHsValArg"><span class="hs-identifier">isHsValArg</span></a></span><span>
</span><span id="line-23"></span><span>       </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Tc.Gen.Head.html#leadingValArgs"><span class="hs-identifier">leadingValArgs</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Tc.Gen.Head.html#isVisibleArg"><span class="hs-identifier">isVisibleArg</span></a></span><span>
</span><span id="line-24"></span><span>
</span><span id="line-25"></span><span>       </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Tc.Gen.Head.html#tcInferAppHead"><span class="hs-identifier">tcInferAppHead</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Tc.Gen.Head.html#tcInferAppHead_maybe"><span class="hs-identifier">tcInferAppHead_maybe</span></a></span><span>
</span><span id="line-26"></span><span>       </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Tc.Gen.Head.html#tcInferId"><span class="hs-identifier">tcInferId</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Tc.Gen.Head.html#tcCheckId"><span class="hs-identifier">tcCheckId</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Tc.Gen.Head.html#obviousSig"><span class="hs-identifier">obviousSig</span></a></span><span>
</span><span id="line-27"></span><span>       </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Tc.Gen.Head.html#tyConOf"><span class="hs-identifier">tyConOf</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Tc.Gen.Head.html#tyConOfET"><span class="hs-identifier">tyConOfET</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Tc.Gen.Head.html#fieldNotInType"><span class="hs-identifier">fieldNotInType</span></a></span><span>
</span><span id="line-28"></span><span>       </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Tc.Gen.Head.html#nonBidirectionalErr"><span class="hs-identifier">nonBidirectionalErr</span></a></span><span>
</span><span id="line-29"></span><span>
</span><span id="line-30"></span><span>       </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Tc.Gen.Head.html#pprArgInst"><span class="hs-identifier">pprArgInst</span></a></span><span>
</span><span id="line-31"></span><span>       </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Tc.Gen.Head.html#addHeadCtxt"><span class="hs-identifier">addHeadCtxt</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Tc.Gen.Head.html#addExprCtxt"><span class="hs-identifier">addExprCtxt</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Tc.Gen.Head.html#addStmtCtxt"><span class="hs-identifier">addStmtCtxt</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Tc.Gen.Head.html#addFunResCtxt"><span class="hs-identifier">addFunResCtxt</span></a></span><span> </span><span class="hs-special">)</span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-32"></span><span>
</span><span id="line-33"></span><span class="hs-keyword">import</span><span> </span><span class="hs-pragma">{-# SOURCE</span><span> </span><span class="hs-pragma">#-}</span><span> </span><span class="annot"><a href="GHC.Tc.Gen.Expr.html"><span class="hs-identifier">GHC.Tc.Gen.Expr</span></a></span><span class="hs-special">(</span><span> </span><span class="annot"><a href="GHC.Tc.Gen.Expr.html#tcExpr"><span class="hs-identifier">tcExpr</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Tc.Gen.Expr.html#tcCheckPolyExprNC"><span class="hs-identifier">tcCheckPolyExprNC</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Tc.Gen.Expr.html#tcPolyLExprSig"><span class="hs-identifier">tcPolyLExprSig</span></a></span><span> </span><span class="hs-special">)</span><span>
</span><span id="line-34"></span><span class="hs-keyword">import</span><span> </span><span class="hs-pragma">{-# SOURCE</span><span> </span><span class="hs-pragma">#-}</span><span> </span><span class="annot"><a href="GHC.Tc.Gen.Splice.html"><span class="hs-identifier">GHC.Tc.Gen.Splice</span></a></span><span class="hs-special">(</span><span> </span><span class="annot"><a href="GHC.Tc.Gen.Splice.html#getUntypedSpliceBody"><span class="hs-identifier">getUntypedSpliceBody</span></a></span><span> </span><span class="hs-special">)</span><span>
</span><span id="line-35"></span><span>
</span><span id="line-36"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Prelude.html"><span class="hs-identifier">GHC.Prelude</span></a></span><span>
</span><span id="line-37"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Hs.html"><span class="hs-identifier">GHC.Hs</span></a></span><span>
</span><span id="line-38"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Hs.Syn.Type.html"><span class="hs-identifier">GHC.Hs.Syn.Type</span></a></span><span>
</span><span id="line-39"></span><span>
</span><span id="line-40"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Tc.Gen.HsType.html"><span class="hs-identifier">GHC.Tc.Gen.HsType</span></a></span><span>
</span><span id="line-41"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Tc.Gen.Bind.html"><span class="hs-identifier">GHC.Tc.Gen.Bind</span></a></span><span class="hs-special">(</span><span> </span><span class="annot"><a href="GHC.Tc.Gen.Bind.html#chooseInferredQuantifiers"><span class="hs-identifier">chooseInferredQuantifiers</span></a></span><span> </span><span class="hs-special">)</span><span>
</span><span id="line-42"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Tc.Gen.Sig.html"><span class="hs-identifier">GHC.Tc.Gen.Sig</span></a></span><span class="hs-special">(</span><span> </span><span class="annot"><a href="GHC.Tc.Gen.Sig.html#tcUserTypeSig"><span class="hs-identifier">tcUserTypeSig</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Tc.Gen.Sig.html#tcInstSig"><span class="hs-identifier">tcInstSig</span></a></span><span> </span><span class="hs-special">)</span><span>
</span><span id="line-43"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Tc.TyCl.PatSyn.html"><span class="hs-identifier">GHC.Tc.TyCl.PatSyn</span></a></span><span class="hs-special">(</span><span> </span><span class="annot"><a href="GHC.Tc.TyCl.PatSyn.html#patSynBuilderOcc"><span class="hs-identifier">patSynBuilderOcc</span></a></span><span> </span><span class="hs-special">)</span><span>
</span><span id="line-44"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.Monad.html"><span class="hs-identifier">GHC.Tc.Utils.Monad</span></a></span><span>
</span><span id="line-45"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.Unify.html"><span class="hs-identifier">GHC.Tc.Utils.Unify</span></a></span><span>
</span><span id="line-46"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.Instantiate.html"><span class="hs-identifier">GHC.Tc.Utils.Instantiate</span></a></span><span>
</span><span id="line-47"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Tc.Instance.Family.html"><span class="hs-identifier">GHC.Tc.Instance.Family</span></a></span><span> </span><span class="hs-special">(</span><span> </span><span class="annot"><a href="GHC.Tc.Instance.Family.html#tcLookupDataFamInst"><span class="hs-identifier">tcLookupDataFamInst</span></a></span><span> </span><span class="hs-special">)</span><span>
</span><span id="line-48"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Tc.Errors.Types.html"><span class="hs-identifier">GHC.Tc.Errors.Types</span></a></span><span>
</span><span id="line-49"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Tc.Solver.html"><span class="hs-identifier">GHC.Tc.Solver</span></a></span><span>          </span><span class="hs-special">(</span><span> </span><span class="annot"><a href="GHC.Tc.Solver.html#InferMode"><span class="hs-identifier">InferMode</span></a></span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Tc.Solver.html#simplifyInfer"><span class="hs-identifier">simplifyInfer</span></a></span><span> </span><span class="hs-special">)</span><span>
</span><span id="line-50"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.Env.html"><span class="hs-identifier">GHC.Tc.Utils.Env</span></a></span><span>
</span><span id="line-51"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.TcMType.html"><span class="hs-identifier">GHC.Tc.Utils.TcMType</span></a></span><span>
</span><span id="line-52"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Tc.Types.Origin.html"><span class="hs-identifier">GHC.Tc.Types.Origin</span></a></span><span>
</span><span id="line-53"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Tc.Types.Constraint.html"><span class="hs-identifier">GHC.Tc.Types.Constraint</span></a></span><span class="hs-special">(</span><span> </span><span class="annot"><a href="GHC.Tc.Types.Constraint.html#WantedConstraints"><span class="hs-identifier">WantedConstraints</span></a></span><span> </span><span class="hs-special">)</span><span>
</span><span id="line-54"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.TcType.html"><span class="hs-identifier">GHC.Tc.Utils.TcType</span></a></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">TcType</span></span><span>
</span><span id="line-55"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Tc.Types.Evidence.html"><span class="hs-identifier">GHC.Tc.Types.Evidence</span></a></span><span>
</span><span id="line-56"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Tc.Zonk.TcType.html"><span class="hs-identifier">GHC.Tc.Zonk.TcType</span></a></span><span>
</span><span id="line-57"></span><span>
</span><span id="line-58"></span><span>
</span><span id="line-59"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Core.FamInstEnv.html"><span class="hs-identifier">GHC.Core.FamInstEnv</span></a></span><span>    </span><span class="hs-special">(</span><span> </span><span class="annot"><a href="GHC.Core.FamInstEnv.html#FamInstEnvs"><span class="hs-identifier">FamInstEnvs</span></a></span><span> </span><span class="hs-special">)</span><span>
</span><span id="line-60"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Core.UsageEnv.html"><span class="hs-identifier">GHC.Core.UsageEnv</span></a></span><span>      </span><span class="hs-special">(</span><span> </span><span class="annot"><a href="GHC.Core.UsageEnv.html#singleUsageUE"><span class="hs-identifier">singleUsageUE</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Core.UsageEnv.html#UsageEnv"><span class="hs-identifier">UsageEnv</span></a></span><span> </span><span class="hs-special">)</span><span>
</span><span id="line-61"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Core.PatSyn.html"><span class="hs-identifier">GHC.Core.PatSyn</span></a></span><span class="hs-special">(</span><span> </span><span class="annot"><a href="GHC.Core.PatSyn.html#PatSyn"><span class="hs-identifier">PatSyn</span></a></span><span> </span><span class="hs-special">)</span><span>
</span><span id="line-62"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Core.ConLike.html"><span class="hs-identifier">GHC.Core.ConLike</span></a></span><span class="hs-special">(</span><span> </span><span class="annot"><a href="GHC.Core.ConLike.html#ConLike"><span class="hs-identifier">ConLike</span></a></span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span> </span><span class="hs-special">)</span><span>
</span><span id="line-63"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Core.DataCon.html"><span class="hs-identifier">GHC.Core.DataCon</span></a></span><span>
</span><span id="line-64"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Core.TyCon.html"><span class="hs-identifier">GHC.Core.TyCon</span></a></span><span>
</span><span id="line-65"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Core.TyCo.Rep.html"><span class="hs-identifier">GHC.Core.TyCo.Rep</span></a></span><span>
</span><span id="line-66"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Core.Type.html"><span class="hs-identifier">GHC.Core.Type</span></a></span><span>
</span><span id="line-67"></span><span>
</span><span id="line-68"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Types.Id.html"><span class="hs-identifier">GHC.Types.Id</span></a></span><span>
</span><span id="line-69"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Types.Id.Info.html"><span class="hs-identifier">GHC.Types.Id.Info</span></a></span><span>
</span><span id="line-70"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Types.Name.html"><span class="hs-identifier">GHC.Types.Name</span></a></span><span>
</span><span id="line-71"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Types.Name.Reader.html"><span class="hs-identifier">GHC.Types.Name.Reader</span></a></span><span>
</span><span id="line-72"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Types.SrcLoc.html"><span class="hs-identifier">GHC.Types.SrcLoc</span></a></span><span>
</span><span id="line-73"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Types.Basic.html"><span class="hs-identifier">GHC.Types.Basic</span></a></span><span>
</span><span id="line-74"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Types.Error.html"><span class="hs-identifier">GHC.Types.Error</span></a></span><span>
</span><span id="line-75"></span><span>
</span><span id="line-76"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Builtin.Types.html"><span class="hs-identifier">GHC.Builtin.Types</span></a></span><span class="hs-special">(</span><span> </span><span class="annot"><a href="GHC.Builtin.Types.html#multiplicityTy"><span class="hs-identifier">multiplicityTy</span></a></span><span> </span><span class="hs-special">)</span><span>
</span><span id="line-77"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Builtin.Names.html"><span class="hs-identifier">GHC.Builtin.Names</span></a></span><span>
</span><span id="line-78"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Builtin.Names.TH.html"><span class="hs-identifier">GHC.Builtin.Names.TH</span></a></span><span class="hs-special">(</span><span> </span><span class="annot"><a href="GHC.Builtin.Names.TH.html#liftStringName"><span class="hs-identifier">liftStringName</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Builtin.Names.TH.html#liftName"><span class="hs-identifier">liftName</span></a></span><span> </span><span class="hs-special">)</span><span>
</span><span id="line-79"></span><span>
</span><span id="line-80"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Driver.DynFlags.html"><span class="hs-identifier">GHC.Driver.DynFlags</span></a></span><span>
</span><span id="line-81"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Utils.Misc.html"><span class="hs-identifier">GHC.Utils.Misc</span></a></span><span>
</span><span id="line-82"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Utils.Outputable.html"><span class="hs-identifier">GHC.Utils.Outputable</span></a></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">Outputable</span></span><span>
</span><span id="line-83"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Utils.Panic.html"><span class="hs-identifier">GHC.Utils.Panic</span></a></span><span>
</span><span id="line-84"></span><span>
</span><span id="line-85"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Data.Maybe.html"><span class="hs-identifier">GHC.Data.Maybe</span></a></span><span>
</span><span id="line-86"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="../../base-4.21.0.0-ae91/src/Control.Monad.html"><span class="hs-identifier">Control.Monad</span></a></span><span>
</span><span id="line-87"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Rename.Unbound.html"><span class="hs-identifier">GHC.Rename.Unbound</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Rename.Unbound.html#WhatLooking"><span class="hs-identifier">WhatLooking</span></a></span><span class="hs-special">(</span><span class="annot"><a href="GHC.Rename.Unbound.html#WL_Anything"><span class="hs-identifier">WL_Anything</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-88"></span><span>
</span><span id="line-89"></span><span>
</span><span id="line-90"></span><span>
</span><span id="line-91"></span><span class="annot"><span class="hs-comment">{- *********************************************************************
*                                                                      *
              HsExprArg: auxiliary data type
*                                                                      *
********************************************************************* -}</span></span><span>
</span><span id="line-96"></span><span>
</span><span id="line-97"></span><span class="hs-comment">{- Note [HsExprArg]
~~~~~~~~~~~~~~~~~~~
The data type HsExprArg :: TcPass -&gt; Type
is a very local type, used only within this module and GHC.Tc.Gen.App

* It's really a zipper for an application chain
  See Note [Application chains and heads] in GHC.Tc.Gen.App for
  what an &quot;application chain&quot; is.

* It's a GHC-specific type, so using TTG only where necessary

* It is indexed by TcPass, meaning
  - HsExprArg TcpRn:
      The result of splitHsApps, which decomposes a HsExpr GhcRn

  - HsExprArg TcpInst:
      The result of tcInstFun, which instantiates the function type,
      perhaps taking a quick look at arguments.

  - HsExprArg TcpTc:
      The result of tcArg, which typechecks the value args
      In EValArg we now have a (LHsExpr GhcTc)

* rebuildPrefixApps is dual to splitHsApps, and zips an application
  back into a HsExpr

Invariants:

1. With QL switched off, all arguments are ValArg; no ValArgQL

2. With QL switched on, tcInstFun converts some ValArgs to ValArgQL,
   under the conditions when quick-look should happen (eg the argument
   type is guarded) -- see quickLookArg

Note [EValArgQL]
~~~~~~~~~~~~~~~~
Data constructor EValArgQL represents an argument that has been
partly-type-checked by Quick Look: the first part of `tcApp` has been
done, but not the second, `finishApp` part.

The constuctor captures all the bits and pieces needed to complete
typechecking.  (An alternative would to to store a function closure,
but that's less concrete.)  See Note [Quick Look at value arguments]
in GHC.Tc.Gen.App

Note [splitHsApps]
~~~~~~~~~~~~~~~~~~
The key function
  splitHsApps :: HsExpr GhcRn -&gt; (HsExpr GhcRn, HsExpr GhcRn, [HsExprArg 'TcpRn])
takes apart either an HsApp, or an infix OpApp, returning

* The &quot;head&quot; of the application, an expression that is often a variable;
  this is used for typechecking

* The &quot;user head&quot; or &quot;error head&quot; of the application, to be reported to the
  user in case of an error.  Example:
         (`op` e)
  expands (via ExpandedThingRn) to
         (rightSection op e)
  but we don't want to see 'rightSection' in error messages. So we keep the
  innermost un-expanded head as the &quot;error head&quot;.

* A list of HsExprArg, the arguments
-}</span><span>
</span><span id="line-161"></span><span>
</span><span id="line-162"></span><span class="hs-keyword">data</span><span> </span><span id="TcPass"><span class="annot"><a href="GHC.Tc.Gen.Head.html#TcPass"><span class="hs-identifier hs-var">TcPass</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="TcpRn"><span class="annot"><a href="GHC.Tc.Gen.Head.html#TcpRn"><span class="hs-identifier hs-var">TcpRn</span></a></span></span><span>     </span><span class="hs-comment">-- Arguments decomposed</span><span>
</span><span id="line-163"></span><span>            </span><span class="hs-glyph">|</span><span> </span><span id="TcpInst"><span class="annot"><a href="GHC.Tc.Gen.Head.html#TcpInst"><span class="hs-identifier hs-var">TcpInst</span></a></span></span><span>   </span><span class="hs-comment">-- Function instantiated</span><span>
</span><span id="line-164"></span><span>            </span><span class="hs-glyph">|</span><span> </span><span id="TcpTc"><span class="annot"><a href="GHC.Tc.Gen.Head.html#TcpTc"><span class="hs-identifier hs-var">TcpTc</span></a></span></span><span>     </span><span class="hs-comment">-- Typechecked</span><span>
</span><span id="line-165"></span><span>
</span><span id="line-166"></span><span class="hs-keyword">data</span><span> </span><span id="HsExprArg"><span class="annot"><a href="GHC.Tc.Gen.Head.html#HsExprArg"><span class="hs-identifier hs-var">HsExprArg</span></a></span></span><span> </span><span class="hs-special">(</span><span id="local-6989586621683097416"><span class="annot"><a href="#local-6989586621683097416"><span class="hs-identifier hs-type">p</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Tc.Gen.Head.html#TcPass"><span class="hs-identifier hs-type">TcPass</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-keyword">where</span><span> </span><span class="hs-comment">-- See Note [HsExprArg]</span><span>
</span><span id="line-167"></span><span>
</span><span id="line-168"></span><span>  </span><span class="hs-comment">-- Data constructor EValArg represents a value argument</span><span>
</span><span id="line-169"></span><span>  </span><span id="local-6989586621683096913"><span id="EValArg"><span class="annot"><a href="GHC.Tc.Gen.Head.html#EValArg"><span class="hs-identifier hs-var">EValArg</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">{</span><span> </span><span id="ea_ctxt"><span class="annot"><span class="annottext">forall (p :: TcPass). HsExprArg p -&gt; AppCtxt
</span><a href="GHC.Tc.Gen.Head.html#ea_ctxt"><span class="hs-identifier hs-var hs-var">ea_ctxt</span></a></span></span><span>   </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Tc.Gen.Head.html#AppCtxt"><span class="hs-identifier hs-type">AppCtxt</span></a></span><span>
</span><span id="line-170"></span><span>             </span><span class="hs-special">,</span><span> </span><span id="ea_arg_ty"><span class="annot"><span class="annottext">forall (p :: TcPass). HsExprArg p -&gt; XEVAType p
</span><a href="GHC.Tc.Gen.Head.html#ea_arg_ty"><span class="hs-identifier hs-var hs-var">ea_arg_ty</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-glyph">!</span><span class="hs-special">(</span><span class="annot"><a href="GHC.Tc.Gen.Head.html#XEVAType"><span class="hs-identifier hs-type">XEVAType</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683096913"><span class="hs-identifier hs-type">p</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-171"></span><span>             </span><span class="hs-special">,</span><span> </span><span id="ea_arg"><span class="annot"><span class="annottext">forall (p :: TcPass). HsExprArg p -&gt; LHsExpr (GhcPass (XPass p))
</span><a href="GHC.Tc.Gen.Head.html#ea_arg"><span class="hs-identifier hs-var hs-var">ea_arg</span></a></span></span><span>    </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Language.Haskell.Syntax.Expr.html#LHsExpr"><span class="hs-identifier hs-type">LHsExpr</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Hs.Extension.html#GhcPass"><span class="hs-identifier hs-type">GhcPass</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Tc.Gen.Head.html#XPass"><span class="hs-identifier hs-type">XPass</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683096913"><span class="hs-identifier hs-type">p</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-172"></span><span>          </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Gen.Head.html#HsExprArg"><span class="hs-identifier hs-type">HsExprArg</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683096913"><span class="hs-identifier hs-type">p</span></a></span></span><span>
</span><span id="line-173"></span><span>
</span><span id="line-174"></span><span>  </span><span class="hs-comment">-- Data constructor EValArgQL represents an argument that has been</span><span>
</span><span id="line-175"></span><span>  </span><span class="hs-comment">-- partly-type-checked by Quick Look; see Note [EValArgQL]</span><span>
</span><span id="line-176"></span><span>  </span><span id="EValArgQL"><span class="annot"><a href="GHC.Tc.Gen.Head.html#EValArgQL"><span class="hs-identifier hs-var">EValArgQL</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">{</span><span> </span><span id="eaql_ctxt"><span class="annot"><span class="annottext">HsExprArg 'TcpInst -&gt; AppCtxt
</span><a href="GHC.Tc.Gen.Head.html#eaql_ctxt"><span class="hs-identifier hs-var hs-var">eaql_ctxt</span></a></span></span><span>    </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Tc.Gen.Head.html#AppCtxt"><span class="hs-identifier hs-type">AppCtxt</span></a></span><span>
</span><span id="line-177"></span><span>               </span><span class="hs-special">,</span><span> </span><span id="eaql_arg_ty"><span class="annot"><span class="annottext">HsExprArg 'TcpInst -&gt; Scaled TcSigmaType
</span><a href="GHC.Tc.Gen.Head.html#eaql_arg_ty"><span class="hs-identifier hs-var hs-var">eaql_arg_ty</span></a></span></span><span>  </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#Scaled"><span class="hs-identifier hs-type">Scaled</span></a></span><span> </span><span class="annot"><a href="GHC.Tc.Utils.TcType.html#TcSigmaType"><span class="hs-identifier hs-type">TcSigmaType</span></a></span><span>  </span><span class="hs-comment">-- Argument type expected by function</span><span>
</span><span id="line-178"></span><span>               </span><span class="hs-special">,</span><span> </span><span id="eaql_larg"><span class="annot"><span class="annottext">HsExprArg 'TcpInst -&gt; LHsExpr (GhcPass 'Renamed)
</span><a href="GHC.Tc.Gen.Head.html#eaql_larg"><span class="hs-identifier hs-var hs-var">eaql_larg</span></a></span></span><span>    </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Language.Haskell.Syntax.Expr.html#LHsExpr"><span class="hs-identifier hs-type">LHsExpr</span></a></span><span> </span><span class="annot"><a href="GHC.Hs.Extension.html#GhcRn"><span class="hs-identifier hs-type">GhcRn</span></a></span><span>       </span><span class="hs-comment">-- Original application, for</span><span>
</span><span id="line-179"></span><span>                                                     </span><span class="hs-comment">-- location and error msgs</span><span>
</span><span id="line-180"></span><span>               </span><span class="hs-special">,</span><span> </span><span id="eaql_tc_fun"><span class="annot"><span class="annottext">HsExprArg 'TcpInst -&gt; (HsExpr GhcTc, AppCtxt)
</span><a href="GHC.Tc.Gen.Head.html#eaql_tc_fun"><span class="hs-identifier hs-var hs-var">eaql_tc_fun</span></a></span></span><span>  </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Language.Haskell.Syntax.Expr.html#HsExpr"><span class="hs-identifier hs-type">HsExpr</span></a></span><span> </span><span class="annot"><a href="GHC.Hs.Extension.html#GhcTc"><span class="hs-identifier hs-type">GhcTc</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Tc.Gen.Head.html#AppCtxt"><span class="hs-identifier hs-type">AppCtxt</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-comment">-- Typechecked head</span><span>
</span><span id="line-181"></span><span>               </span><span class="hs-special">,</span><span> </span><span id="eaql_fun_ue"><span class="annot"><span class="annottext">HsExprArg 'TcpInst -&gt; UsageEnv
</span><a href="GHC.Tc.Gen.Head.html#eaql_fun_ue"><span class="hs-identifier hs-var hs-var">eaql_fun_ue</span></a></span></span><span>  </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Core.UsageEnv.html#UsageEnv"><span class="hs-identifier hs-type">UsageEnv</span></a></span><span> </span><span class="hs-comment">-- Usage environment of the typechecked head (QLA5)</span><span>
</span><span id="line-182"></span><span>               </span><span class="hs-special">,</span><span> </span><span id="eaql_args"><span class="annot"><span class="annottext">HsExprArg 'TcpInst -&gt; [HsExprArg 'TcpInst]
</span><a href="GHC.Tc.Gen.Head.html#eaql_args"><span class="hs-identifier hs-var hs-var">eaql_args</span></a></span></span><span>    </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="GHC.Tc.Gen.Head.html#HsExprArg"><span class="hs-identifier hs-type">HsExprArg</span></a></span><span> </span><span class="hs-special">'</span><span class="annot"><a href="GHC.Tc.Gen.Head.html#TcpInst"><span class="hs-identifier hs-type">TcpInst</span></a></span><span class="hs-special">]</span><span>    </span><span class="hs-comment">-- Args: instantiated, not typechecked</span><span>
</span><span id="line-183"></span><span>               </span><span class="hs-special">,</span><span> </span><span id="eaql_wanted"><span class="annot"><span class="annottext">HsExprArg 'TcpInst -&gt; WantedConstraints
</span><a href="GHC.Tc.Gen.Head.html#eaql_wanted"><span class="hs-identifier hs-var hs-var">eaql_wanted</span></a></span></span><span>  </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Tc.Types.Constraint.html#WantedConstraints"><span class="hs-identifier hs-type">WantedConstraints</span></a></span><span>
</span><span id="line-184"></span><span>               </span><span class="hs-special">,</span><span> </span><span id="eaql_encl"><span class="annot"><span class="annottext">HsExprArg 'TcpInst -&gt; Bool
</span><a href="GHC.Tc.Gen.Head.html#eaql_encl"><span class="hs-identifier hs-var hs-var">eaql_encl</span></a></span></span><span>    </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Bool</span></span><span>                  </span><span class="hs-comment">-- True &lt;=&gt; we have already qlUnified</span><span>
</span><span id="line-185"></span><span>                                                       </span><span class="hs-comment">--   eaql_arg_ty and eaql_res_rho</span><span>
</span><span id="line-186"></span><span>               </span><span class="hs-special">,</span><span> </span><span id="eaql_res_rho"><span class="annot"><span class="annottext">HsExprArg 'TcpInst -&gt; TcSigmaType
</span><a href="GHC.Tc.Gen.Head.html#eaql_res_rho"><span class="hs-identifier hs-var hs-var">eaql_res_rho</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.TcType.html#TcRhoType"><span class="hs-identifier hs-type">TcRhoType</span></a></span><span> </span><span class="hs-special">}</span><span>           </span><span class="hs-comment">-- Result type of the application</span><span>
</span><span id="line-187"></span><span>            </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Gen.Head.html#HsExprArg"><span class="hs-identifier hs-type">HsExprArg</span></a></span><span> </span><span class="hs-special">'</span><span class="annot"><a href="GHC.Tc.Gen.Head.html#TcpInst"><span class="hs-identifier hs-type">TcpInst</span></a></span><span>  </span><span class="hs-comment">-- Only exists in TcpInst phase</span><span>
</span><span id="line-188"></span><span>
</span><span id="line-189"></span><span>  </span><span id="local-6989586621683096925"><span id="ETypeArg"><span class="annot"><a href="GHC.Tc.Gen.Head.html#ETypeArg"><span class="hs-identifier hs-var">ETypeArg</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">{</span><span> </span><span id="ea_ctxt"><span class="annot"><a href="GHC.Tc.Gen.Head.html#ea_ctxt"><span class="hs-identifier hs-var">ea_ctxt</span></a></span></span><span>   </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Tc.Gen.Head.html#AppCtxt"><span class="hs-identifier hs-type">AppCtxt</span></a></span><span>
</span><span id="line-190"></span><span>              </span><span class="hs-special">,</span><span> </span><span id="ea_hs_ty"><span class="annot"><span class="annottext">forall (p :: TcPass). HsExprArg p -&gt; LHsWcType (GhcPass 'Renamed)
</span><a href="GHC.Tc.Gen.Head.html#ea_hs_ty"><span class="hs-identifier hs-var hs-var">ea_hs_ty</span></a></span></span><span>  </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Language.Haskell.Syntax.Type.html#LHsWcType"><span class="hs-identifier hs-type">LHsWcType</span></a></span><span> </span><span class="annot"><a href="GHC.Hs.Extension.html#GhcRn"><span class="hs-identifier hs-type">GhcRn</span></a></span><span>  </span><span class="hs-comment">-- The type arg</span><span>
</span><span id="line-191"></span><span>              </span><span class="hs-special">,</span><span> </span><span id="ea_ty_arg"><span class="annot"><span class="annottext">forall (p :: TcPass). HsExprArg p -&gt; XETAType p
</span><a href="GHC.Tc.Gen.Head.html#ea_ty_arg"><span class="hs-identifier hs-var hs-var">ea_ty_arg</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-glyph">!</span><span class="hs-special">(</span><span class="annot"><a href="GHC.Tc.Gen.Head.html#XETAType"><span class="hs-identifier hs-type">XETAType</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683096925"><span class="hs-identifier hs-type">p</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>  </span><span class="hs-comment">-- Kind-checked type arg</span><span>
</span><span id="line-192"></span><span>           </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Gen.Head.html#HsExprArg"><span class="hs-identifier hs-type">HsExprArg</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683096925"><span class="hs-identifier hs-type">p</span></a></span></span><span>
</span><span id="line-193"></span><span>
</span><span id="line-194"></span><span>  </span><span id="local-6989586621683096952"><span id="EPrag"><span class="annot"><a href="GHC.Tc.Gen.Head.html#EPrag"><span class="hs-identifier hs-var">EPrag</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Tc.Gen.Head.html#AppCtxt"><span class="hs-identifier hs-type">AppCtxt</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Language.Haskell.Syntax.Expr.html#HsPragE"><span class="hs-identifier hs-type">HsPragE</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Hs.Extension.html#GhcPass"><span class="hs-identifier hs-type">GhcPass</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Tc.Gen.Head.html#XPass"><span class="hs-identifier hs-type">XPass</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683096952"><span class="hs-identifier hs-type">p</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Gen.Head.html#HsExprArg"><span class="hs-identifier hs-type">HsExprArg</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683096952"><span class="hs-identifier hs-type">p</span></a></span></span><span>
</span><span id="line-195"></span><span>  </span><span id="local-6989586621683096940"><span id="EWrap"><span class="annot"><a href="GHC.Tc.Gen.Head.html#EWrap"><span class="hs-identifier hs-var">EWrap</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Tc.Gen.Head.html#EWrap"><span class="hs-identifier hs-type">EWrap</span></a></span><span>                                    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Gen.Head.html#HsExprArg"><span class="hs-identifier hs-type">HsExprArg</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683096940"><span class="hs-identifier hs-type">p</span></a></span></span><span>
</span><span id="line-196"></span><span>
</span><span id="line-197"></span><span class="hs-keyword">type</span><span> </span><span class="hs-keyword">family</span><span> </span><span id="XETAType"><span class="annot"><a href="GHC.Tc.Gen.Head.html#XETAType"><span class="hs-identifier hs-var">XETAType</span></a></span></span><span> </span><span class="hs-special">(</span><span id="local-6989586621683097447"><span class="annot"><a href="#local-6989586621683097447"><span class="hs-identifier hs-type">p</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Tc.Gen.Head.html#TcPass"><span class="hs-identifier hs-type">TcPass</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-keyword">where</span><span>  </span><span class="hs-comment">-- Type arguments</span><span>
</span><span id="line-198"></span><span>  </span><span id="XETAType"><span class="annot"><a href="GHC.Tc.Gen.Head.html#XETAType"><span class="hs-identifier hs-var">XETAType</span></a></span></span><span> </span><span class="hs-special">'</span><span class="annot"><a href="GHC.Tc.Gen.Head.html#TcpRn"><span class="hs-identifier hs-type">TcpRn</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="Language.Haskell.Syntax.Extension.html#NoExtField"><span class="hs-identifier hs-type">NoExtField</span></a></span><span>
</span><span id="line-199"></span><span>  </span><span id="XETAType"><span class="annot"><a href="GHC.Tc.Gen.Head.html#XETAType"><span class="hs-identifier hs-var">XETAType</span></a></span></span><span> </span><span class="annot"><span class="hs-identifier">_</span></span><span>      </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#Type"><span class="hs-identifier hs-type">Type</span></a></span><span>
</span><span id="line-200"></span><span>
</span><span id="line-201"></span><span class="hs-keyword">type</span><span> </span><span class="hs-keyword">family</span><span> </span><span id="XEVAType"><span class="annot"><a href="GHC.Tc.Gen.Head.html#XEVAType"><span class="hs-identifier hs-var">XEVAType</span></a></span></span><span> </span><span class="hs-special">(</span><span id="local-6989586621683097449"><span class="annot"><a href="#local-6989586621683097449"><span class="hs-identifier hs-type">p</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Tc.Gen.Head.html#TcPass"><span class="hs-identifier hs-type">TcPass</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-keyword">where</span><span>   </span><span class="hs-comment">-- Value arguments</span><span>
</span><span id="line-202"></span><span>  </span><span id="XEVAType"><span class="annot"><a href="GHC.Tc.Gen.Head.html#XEVAType"><span class="hs-identifier hs-var">XEVAType</span></a></span></span><span> </span><span class="hs-special">'</span><span class="annot"><a href="GHC.Tc.Gen.Head.html#TcpInst"><span class="hs-identifier hs-type">TcpInst</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#Scaled"><span class="hs-identifier hs-type">Scaled</span></a></span><span> </span><span class="annot"><a href="GHC.Tc.Utils.TcType.html#TcSigmaType"><span class="hs-identifier hs-type">TcSigmaType</span></a></span><span>
</span><span id="line-203"></span><span>  </span><span id="XEVAType"><span class="annot"><a href="GHC.Tc.Gen.Head.html#XEVAType"><span class="hs-identifier hs-var">XEVAType</span></a></span></span><span> </span><span class="annot"><span class="hs-identifier">_</span></span><span>        </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="Language.Haskell.Syntax.Extension.html#NoExtField"><span class="hs-identifier hs-type">NoExtField</span></a></span><span>
</span><span id="line-204"></span><span>
</span><span id="line-205"></span><span class="hs-keyword">data</span><span> </span><span id="QLFlag"><span class="annot"><a href="GHC.Tc.Gen.Head.html#QLFlag"><span class="hs-identifier hs-var">QLFlag</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="DoQL"><span class="annot"><a href="GHC.Tc.Gen.Head.html#DoQL"><span class="hs-identifier hs-var">DoQL</span></a></span></span><span> </span><span class="hs-glyph">|</span><span> </span><span id="NoQL"><span class="annot"><a href="GHC.Tc.Gen.Head.html#NoQL"><span class="hs-identifier hs-var">NoQL</span></a></span></span><span>
</span><span id="line-206"></span><span>
</span><span id="line-207"></span><span class="hs-keyword">data</span><span> </span><span id="EWrap"><span class="annot"><a href="GHC.Tc.Gen.Head.html#EWrap"><span class="hs-identifier hs-var">EWrap</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="EPar"><span class="annot"><a href="GHC.Tc.Gen.Head.html#EPar"><span class="hs-identifier hs-var">EPar</span></a></span></span><span>    </span><span class="annot"><a href="GHC.Tc.Gen.Head.html#AppCtxt"><span class="hs-identifier hs-type">AppCtxt</span></a></span><span>
</span><span id="line-208"></span><span>           </span><span class="hs-glyph">|</span><span> </span><span id="EExpand"><span class="annot"><a href="GHC.Tc.Gen.Head.html#EExpand"><span class="hs-identifier hs-var">EExpand</span></a></span></span><span> </span><span class="annot"><a href="GHC.Hs.Expr.html#HsThingRn"><span class="hs-identifier hs-type">HsThingRn</span></a></span><span>
</span><span id="line-209"></span><span>           </span><span class="hs-glyph">|</span><span> </span><span id="EHsWrap"><span class="annot"><a href="GHC.Tc.Gen.Head.html#EHsWrap"><span class="hs-identifier hs-var">EHsWrap</span></a></span></span><span> </span><span class="annot"><a href="GHC.Tc.Types.Evidence.html#HsWrapper"><span class="hs-identifier hs-type">HsWrapper</span></a></span><span>
</span><span id="line-210"></span><span>
</span><span id="line-211"></span><span class="hs-keyword">data</span><span> </span><span id="AppCtxt"><span class="annot"><a href="GHC.Tc.Gen.Head.html#AppCtxt"><span class="hs-identifier hs-var">AppCtxt</span></a></span></span><span>
</span><span id="line-212"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span id="VAExpansion"><span class="annot"><a href="GHC.Tc.Gen.Head.html#VAExpansion"><span class="hs-identifier hs-var">VAExpansion</span></a></span></span><span>
</span><span id="line-213"></span><span>       </span><span class="annot"><a href="GHC.Hs.Expr.html#HsThingRn"><span class="hs-identifier hs-type">HsThingRn</span></a></span><span>
</span><span id="line-214"></span><span>       </span><span class="annot"><a href="GHC.Types.SrcLoc.html#SrcSpan"><span class="hs-identifier hs-type">SrcSpan</span></a></span><span>
</span><span id="line-215"></span><span>       </span><span class="annot"><a href="GHC.Types.SrcLoc.html#SrcSpan"><span class="hs-identifier hs-type">SrcSpan</span></a></span><span>
</span><span id="line-216"></span><span>
</span><span id="line-217"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span id="VACall"><span class="annot"><a href="GHC.Tc.Gen.Head.html#VACall"><span class="hs-identifier hs-var">VACall</span></a></span></span><span>
</span><span id="line-218"></span><span>       </span><span class="hs-special">(</span><span class="annot"><a href="Language.Haskell.Syntax.Expr.html#HsExpr"><span class="hs-identifier hs-type">HsExpr</span></a></span><span> </span><span class="annot"><a href="GHC.Hs.Extension.html#GhcRn"><span class="hs-identifier hs-type">GhcRn</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Int</span></span><span>  </span><span class="hs-comment">-- In the third argument of function f</span><span>
</span><span id="line-219"></span><span>       </span><span class="annot"><a href="GHC.Types.SrcLoc.html#SrcSpan"><span class="hs-identifier hs-type">SrcSpan</span></a></span><span>             </span><span class="hs-comment">-- The SrcSpan of the application (f e1 e2 e3)</span><span>
</span><span id="line-220"></span><span>                         </span><span class="hs-comment">--    noSrcSpan if outermost; see Note [AppCtxt]</span><span>
</span><span id="line-221"></span><span>
</span><span id="line-222"></span><span>
</span><span id="line-223"></span><span class="hs-comment">{- Note [AppCtxt]
~~~~~~~~~~~~~~~~~
In a call (f e1 ... en), we pair up each argument with an AppCtxt. For
example, the AppCtxt for e3 allows us to say
    &quot;In the third argument of `f`&quot;
See splitHsApps.

To do this we must take a quick look into the expression to find the
function at the head (`f` in this case) and how many arguments it
has. That is what the funcion top_ctxt does.

If the function part is an expansion, we don't want to look further.
For example, with rebindable syntax the expression
    (if e1 then e2 else e3) e4 e5
might expand to
    (ifThenElse e1 e2 e3) e4 e5
For e4 we an AppCtxt that says &quot;In the first argument of (if ...)&quot;,
not &quot;In the fourth argument of ifThenElse&quot;.  So top_ctxt stops
at expansions.

The SrcSpan in an AppCtxt describes the whole call.  We initialise
it to noSrcSpan, because splitHsApps deals in HsExpr not LHsExpr, so
we don't have a span for the whole call; and we use that noSrcSpan in
GHC.Tc.Gen.App.tcInstFun (set_fun_ctxt) to avoid pushing &quot;In the expression `f`&quot;
a second time.
-}</span><span>
</span><span id="line-249"></span><span>
</span><span id="line-250"></span><span class="annot"><a href="GHC.Tc.Gen.Head.html#appCtxtLoc"><span class="hs-identifier hs-type">appCtxtLoc</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Tc.Gen.Head.html#AppCtxt"><span class="hs-identifier hs-type">AppCtxt</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Types.SrcLoc.html#SrcSpan"><span class="hs-identifier hs-type">SrcSpan</span></a></span><span>
</span><span id="line-251"></span><span id="appCtxtLoc"><span class="annot"><span class="annottext">appCtxtLoc :: AppCtxt -&gt; SrcSpan
</span><a href="GHC.Tc.Gen.Head.html#appCtxtLoc"><span class="hs-identifier hs-var hs-var">appCtxtLoc</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Tc.Gen.Head.html#VAExpansion"><span class="hs-identifier hs-type">VAExpansion</span></a></span><span> </span><span class="annot"><span class="annottext">HsThingRn
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621683097457"><span class="annot"><span class="annottext">SrcSpan
</span><a href="#local-6989586621683097457"><span class="hs-identifier hs-var">l</span></a></span></span><span> </span><span class="annot"><span class="annottext">SrcSpan
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">SrcSpan
</span><a href="#local-6989586621683097457"><span class="hs-identifier hs-var">l</span></a></span><span>
</span><span id="line-252"></span><span class="annot"><a href="GHC.Tc.Gen.Head.html#appCtxtLoc"><span class="hs-identifier hs-var">appCtxtLoc</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Tc.Gen.Head.html#VACall"><span class="hs-identifier hs-type">VACall</span></a></span><span> </span><span class="annot"><span class="annottext">HsExpr (GhcPass 'Renamed)
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">ThLevel
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621683097458"><span class="annot"><span class="annottext">SrcSpan
</span><a href="#local-6989586621683097458"><span class="hs-identifier hs-var">l</span></a></span></span><span class="hs-special">)</span><span>    </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">SrcSpan
</span><a href="#local-6989586621683097458"><span class="hs-identifier hs-var">l</span></a></span><span>
</span><span id="line-253"></span><span>
</span><span id="line-254"></span><span class="annot"><a href="GHC.Tc.Gen.Head.html#insideExpansion"><span class="hs-identifier hs-type">insideExpansion</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Tc.Gen.Head.html#AppCtxt"><span class="hs-identifier hs-type">AppCtxt</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Bool</span></span><span>
</span><span id="line-255"></span><span id="insideExpansion"><span class="annot"><span class="annottext">insideExpansion :: AppCtxt -&gt; Bool
</span><a href="GHC.Tc.Gen.Head.html#insideExpansion"><span class="hs-identifier hs-var hs-var">insideExpansion</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Tc.Gen.Head.html#VAExpansion"><span class="hs-identifier hs-type">VAExpansion</span></a></span><span> </span><span class="hs-special">{</span><span class="hs-special">}</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">True</span></span><span>
</span><span id="line-256"></span><span class="annot"><a href="GHC.Tc.Gen.Head.html#insideExpansion"><span class="hs-identifier hs-var">insideExpansion</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Tc.Gen.Head.html#VACall"><span class="hs-identifier hs-type">VACall</span></a></span><span> </span><span class="hs-special">{</span><span class="hs-special">}</span><span class="hs-special">)</span><span>      </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">False</span></span><span> </span><span class="hs-comment">-- but what if the VACall has a generated context?</span><span>
</span><span id="line-257"></span><span>
</span><span id="line-258"></span><span class="hs-keyword">instance</span><span> </span><span class="annot"><a href="GHC.Utils.Outputable.html#Outputable"><span class="hs-identifier hs-type">Outputable</span></a></span><span> </span><span class="annot"><a href="GHC.Tc.Gen.Head.html#QLFlag"><span class="hs-identifier hs-type">QLFlag</span></a></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-259"></span><span>  </span><span id="local-6989586621683097464"><span class="annot"><span class="annottext">ppr :: QLFlag -&gt; SDoc
</span><a href="#local-6989586621683097464"><span class="hs-identifier hs-var hs-var hs-var">ppr</span></a></span></span><span> </span><span class="annot"><span class="annottext">QLFlag
</span><a href="GHC.Tc.Gen.Head.html#DoQL"><span class="hs-identifier hs-var">DoQL</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">String -&gt; SDoc
forall doc. IsLine doc =&gt; String -&gt; doc
</span><a href="GHC.Utils.Outputable.html#text"><span class="hs-identifier hs-var">text</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;DoQL&quot;</span></span><span>
</span><span id="line-260"></span><span>  </span><span class="annot"><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="annot"><span class="annottext">QLFlag
</span><a href="GHC.Tc.Gen.Head.html#NoQL"><span class="hs-identifier hs-var">NoQL</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">String -&gt; SDoc
forall doc. IsLine doc =&gt; String -&gt; doc
</span><a href="GHC.Utils.Outputable.html#text"><span class="hs-identifier hs-var">text</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;NoQL&quot;</span></span><span>
</span><span id="line-261"></span><span>
</span><span id="line-262"></span><span class="hs-keyword">instance</span><span> </span><span class="annot"><a href="GHC.Utils.Outputable.html#Outputable"><span class="hs-identifier hs-type">Outputable</span></a></span><span> </span><span class="annot"><a href="GHC.Tc.Gen.Head.html#AppCtxt"><span class="hs-identifier hs-type">AppCtxt</span></a></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-263"></span><span>  </span><span id="local-6989586621683097483"><span class="annot"><span class="annottext">ppr :: AppCtxt -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var hs-var hs-var">ppr</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Tc.Gen.Head.html#VAExpansion"><span class="hs-identifier hs-type">VAExpansion</span></a></span><span> </span><span id="local-6989586621683097484"><span class="annot"><span class="annottext">HsThingRn
</span><a href="#local-6989586621683097484"><span class="hs-identifier hs-var">e</span></a></span></span><span> </span><span id="local-6989586621683097485"><span class="annot"><span class="annottext">SrcSpan
</span><a href="#local-6989586621683097485"><span class="hs-identifier hs-var">l</span></a></span></span><span> </span><span class="annot"><span class="annottext">SrcSpan
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">String -&gt; SDoc
forall doc. IsLine doc =&gt; String -&gt; doc
</span><a href="GHC.Utils.Outputable.html#text"><span class="hs-identifier hs-var">text</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;VAExpansion&quot;</span></span><span> </span><span class="annot"><span class="annottext">SDoc -&gt; SDoc -&gt; SDoc
forall doc. IsLine doc =&gt; doc -&gt; doc -&gt; doc
</span><a href="GHC.Utils.Outputable.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">HsThingRn -&gt; SDoc
forall a. Outputable a =&gt; a -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="annot"><span class="annottext">HsThingRn
</span><a href="#local-6989586621683097484"><span class="hs-identifier hs-var">e</span></a></span><span> </span><span class="annot"><span class="annottext">SDoc -&gt; SDoc -&gt; SDoc
forall doc. IsLine doc =&gt; doc -&gt; doc -&gt; doc
</span><a href="GHC.Utils.Outputable.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">SrcSpan -&gt; SDoc
forall a. Outputable a =&gt; a -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="annot"><span class="annottext">SrcSpan
</span><a href="#local-6989586621683097485"><span class="hs-identifier hs-var">l</span></a></span><span>
</span><span id="line-264"></span><span>  </span><span class="annot"><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Tc.Gen.Head.html#VACall"><span class="hs-identifier hs-type">VACall</span></a></span><span> </span><span id="local-6989586621683097487"><span class="annot"><span class="annottext">HsExpr (GhcPass 'Renamed)
</span><a href="#local-6989586621683097487"><span class="hs-identifier hs-var">f</span></a></span></span><span> </span><span id="local-6989586621683097488"><span class="annot"><span class="annottext">ThLevel
</span><a href="#local-6989586621683097488"><span class="hs-identifier hs-var">n</span></a></span></span><span> </span><span id="local-6989586621683097489"><span class="annot"><span class="annottext">SrcSpan
</span><a href="#local-6989586621683097489"><span class="hs-identifier hs-var">l</span></a></span></span><span class="hs-special">)</span><span>    </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">String -&gt; SDoc
forall doc. IsLine doc =&gt; String -&gt; doc
</span><a href="GHC.Utils.Outputable.html#text"><span class="hs-identifier hs-var">text</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;VACall&quot;</span></span><span> </span><span class="annot"><span class="annottext">SDoc -&gt; SDoc -&gt; SDoc
forall doc. IsLine doc =&gt; doc -&gt; doc -&gt; doc
</span><a href="GHC.Utils.Outputable.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">ThLevel -&gt; SDoc
forall doc. IsLine doc =&gt; ThLevel -&gt; doc
</span><a href="GHC.Utils.Outputable.html#int"><span class="hs-identifier hs-var">int</span></a></span><span> </span><span class="annot"><span class="annottext">ThLevel
</span><a href="#local-6989586621683097488"><span class="hs-identifier hs-var">n</span></a></span><span> </span><span class="annot"><span class="annottext">SDoc -&gt; SDoc -&gt; SDoc
forall doc. IsLine doc =&gt; doc -&gt; doc -&gt; doc
</span><a href="GHC.Utils.Outputable.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">HsExpr (GhcPass 'Renamed) -&gt; SDoc
forall a. Outputable a =&gt; a -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="annot"><span class="annottext">HsExpr (GhcPass 'Renamed)
</span><a href="#local-6989586621683097487"><span class="hs-identifier hs-var">f</span></a></span><span>  </span><span class="annot"><span class="annottext">SDoc -&gt; SDoc -&gt; SDoc
forall doc. IsLine doc =&gt; doc -&gt; doc -&gt; doc
</span><a href="GHC.Utils.Outputable.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">SrcSpan -&gt; SDoc
forall a. Outputable a =&gt; a -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="annot"><span class="annottext">SrcSpan
</span><a href="#local-6989586621683097489"><span class="hs-identifier hs-var">l</span></a></span><span>
</span><span id="line-265"></span><span>
</span><span id="line-266"></span><span class="hs-keyword">type</span><span> </span><span class="hs-keyword">family</span><span> </span><span id="XPass"><span class="annot"><a href="GHC.Tc.Gen.Head.html#XPass"><span class="hs-identifier hs-var">XPass</span></a></span></span><span> </span><span class="hs-special">(</span><span id="local-6989586621683097491"><span class="annot"><a href="#local-6989586621683097491"><span class="hs-identifier hs-type">p</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Tc.Gen.Head.html#TcPass"><span class="hs-identifier hs-type">TcPass</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-267"></span><span>  </span><span id="XPass"><span class="annot"><a href="GHC.Tc.Gen.Head.html#XPass"><span class="hs-identifier hs-var">XPass</span></a></span></span><span> </span><span class="hs-special">'</span><span class="annot"><a href="GHC.Tc.Gen.Head.html#TcpRn"><span class="hs-identifier hs-type">TcpRn</span></a></span><span>   </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">'</span><span class="annot"><a href="GHC.Hs.Extension.html#Renamed"><span class="hs-identifier hs-type">Renamed</span></a></span><span>
</span><span id="line-268"></span><span>  </span><span id="XPass"><span class="annot"><a href="GHC.Tc.Gen.Head.html#XPass"><span class="hs-identifier hs-var">XPass</span></a></span></span><span> </span><span class="hs-special">'</span><span class="annot"><a href="GHC.Tc.Gen.Head.html#TcpInst"><span class="hs-identifier hs-type">TcpInst</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">'</span><span class="annot"><a href="GHC.Hs.Extension.html#Renamed"><span class="hs-identifier hs-type">Renamed</span></a></span><span>
</span><span id="line-269"></span><span>  </span><span id="XPass"><span class="annot"><a href="GHC.Tc.Gen.Head.html#XPass"><span class="hs-identifier hs-var">XPass</span></a></span></span><span> </span><span class="hs-special">'</span><span class="annot"><a href="GHC.Tc.Gen.Head.html#TcpTc"><span class="hs-identifier hs-type">TcpTc</span></a></span><span>   </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">'</span><span class="annot"><a href="GHC.Hs.Extension.html#Typechecked"><span class="hs-identifier hs-type">Typechecked</span></a></span><span>
</span><span id="line-270"></span><span>
</span><span id="line-271"></span><span class="annot"><a href="GHC.Tc.Gen.Head.html#mkEValArg"><span class="hs-identifier hs-type">mkEValArg</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Tc.Gen.Head.html#AppCtxt"><span class="hs-identifier hs-type">AppCtxt</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Language.Haskell.Syntax.Expr.html#LHsExpr"><span class="hs-identifier hs-type">LHsExpr</span></a></span><span> </span><span class="annot"><a href="GHC.Hs.Extension.html#GhcRn"><span class="hs-identifier hs-type">GhcRn</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Gen.Head.html#HsExprArg"><span class="hs-identifier hs-type">HsExprArg</span></a></span><span> </span><span class="hs-special">'</span><span class="annot"><a href="GHC.Tc.Gen.Head.html#TcpRn"><span class="hs-identifier hs-type">TcpRn</span></a></span><span>
</span><span id="line-272"></span><span id="mkEValArg"><span class="annot"><span class="annottext">mkEValArg :: AppCtxt -&gt; LHsExpr (GhcPass 'Renamed) -&gt; HsExprArg 'TcpRn
</span><a href="GHC.Tc.Gen.Head.html#mkEValArg"><span class="hs-identifier hs-var hs-var">mkEValArg</span></a></span></span><span> </span><span id="local-6989586621683097493"><span class="annot"><span class="annottext">AppCtxt
</span><a href="#local-6989586621683097493"><span class="hs-identifier hs-var">ctxt</span></a></span></span><span> </span><span id="local-6989586621683097494"><span class="annot"><span class="annottext">LHsExpr (GhcPass 'Renamed)
</span><a href="#local-6989586621683097494"><span class="hs-identifier hs-var">e</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="GHC.Tc.Gen.Head.html#EValArg"><span class="hs-identifier hs-type">EValArg</span></a></span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">ea_arg :: LHsExpr (GhcPass (XPass 'TcpRn))
</span><a href="GHC.Tc.Gen.Head.html#ea_arg"><span class="hs-identifier hs-var">ea_arg</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">LHsExpr (GhcPass 'Renamed)
LHsExpr (GhcPass (XPass 'TcpRn))
</span><a href="#local-6989586621683097494"><span class="hs-identifier hs-var">e</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">ea_ctxt :: AppCtxt
</span><a href="GHC.Tc.Gen.Head.html#ea_ctxt"><span class="hs-identifier hs-var">ea_ctxt</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">AppCtxt
</span><a href="#local-6989586621683097493"><span class="hs-identifier hs-var">ctxt</span></a></span><span>
</span><span id="line-273"></span><span>                           </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">ea_arg_ty :: XEVAType 'TcpRn
</span><a href="GHC.Tc.Gen.Head.html#ea_arg_ty"><span class="hs-identifier hs-var">ea_arg_ty</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">NoExtField
XEVAType 'TcpRn
</span><a href="Language.Haskell.Syntax.Extension.html#noExtField"><span class="hs-identifier hs-var">noExtField</span></a></span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-274"></span><span>
</span><span id="line-275"></span><span class="annot"><a href="GHC.Tc.Gen.Head.html#mkETypeArg"><span class="hs-identifier hs-type">mkETypeArg</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Tc.Gen.Head.html#AppCtxt"><span class="hs-identifier hs-type">AppCtxt</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Language.Haskell.Syntax.Type.html#LHsWcType"><span class="hs-identifier hs-type">LHsWcType</span></a></span><span> </span><span class="annot"><a href="GHC.Hs.Extension.html#GhcRn"><span class="hs-identifier hs-type">GhcRn</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Gen.Head.html#HsExprArg"><span class="hs-identifier hs-type">HsExprArg</span></a></span><span> </span><span class="hs-special">'</span><span class="annot"><a href="GHC.Tc.Gen.Head.html#TcpRn"><span class="hs-identifier hs-type">TcpRn</span></a></span><span>
</span><span id="line-276"></span><span id="mkETypeArg"><span class="annot"><span class="annottext">mkETypeArg :: AppCtxt -&gt; LHsWcType (GhcPass 'Renamed) -&gt; HsExprArg 'TcpRn
</span><a href="GHC.Tc.Gen.Head.html#mkETypeArg"><span class="hs-identifier hs-var hs-var">mkETypeArg</span></a></span></span><span> </span><span id="local-6989586621683097497"><span class="annot"><span class="annottext">AppCtxt
</span><a href="#local-6989586621683097497"><span class="hs-identifier hs-var">ctxt</span></a></span></span><span> </span><span id="local-6989586621683097498"><span class="annot"><span class="annottext">LHsWcType (GhcPass 'Renamed)
</span><a href="#local-6989586621683097498"><span class="hs-identifier hs-var">hs_ty</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-277"></span><span>  </span><span class="annot"><a href="GHC.Tc.Gen.Head.html#ETypeArg"><span class="hs-identifier hs-type">ETypeArg</span></a></span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">ea_ctxt :: AppCtxt
</span><a href="GHC.Tc.Gen.Head.html#ea_ctxt"><span class="hs-identifier hs-var">ea_ctxt</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">AppCtxt
</span><a href="#local-6989586621683097497"><span class="hs-identifier hs-var">ctxt</span></a></span><span>
</span><span id="line-278"></span><span>           </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">ea_hs_ty :: LHsWcType (GhcPass 'Renamed)
</span><a href="GHC.Tc.Gen.Head.html#ea_hs_ty"><span class="hs-identifier hs-var">ea_hs_ty</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">LHsWcType (GhcPass 'Renamed)
</span><a href="#local-6989586621683097498"><span class="hs-identifier hs-var">hs_ty</span></a></span><span>
</span><span id="line-279"></span><span>           </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">ea_ty_arg :: XETAType 'TcpRn
</span><a href="GHC.Tc.Gen.Head.html#ea_ty_arg"><span class="hs-identifier hs-var">ea_ty_arg</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">NoExtField
XETAType 'TcpRn
</span><a href="Language.Haskell.Syntax.Extension.html#noExtField"><span class="hs-identifier hs-var">noExtField</span></a></span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-280"></span><span>
</span><span id="line-281"></span><span id="local-6989586621683096938"><span class="annot"><a href="GHC.Tc.Gen.Head.html#addArgWrap"><span class="hs-identifier hs-type">addArgWrap</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Tc.Types.Evidence.html#HsWrapper"><span class="hs-identifier hs-type">HsWrapper</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="GHC.Tc.Gen.Head.html#HsExprArg"><span class="hs-identifier hs-type">HsExprArg</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683096938"><span class="hs-identifier hs-type">p</span></a></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="GHC.Tc.Gen.Head.html#HsExprArg"><span class="hs-identifier hs-type">HsExprArg</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683096938"><span class="hs-identifier hs-type">p</span></a></span><span class="hs-special">]</span></span><span>
</span><span id="line-282"></span><span id="addArgWrap"><span class="annot"><span class="annottext">addArgWrap :: forall (p :: TcPass). HsWrapper -&gt; [HsExprArg p] -&gt; [HsExprArg p]
</span><a href="GHC.Tc.Gen.Head.html#addArgWrap"><span class="hs-identifier hs-var hs-var">addArgWrap</span></a></span></span><span> </span><span id="local-6989586621683097499"><span class="annot"><span class="annottext">HsWrapper
</span><a href="#local-6989586621683097499"><span class="hs-identifier hs-var">wrap</span></a></span></span><span> </span><span id="local-6989586621683097500"><span class="annot"><span class="annottext">[HsExprArg p]
</span><a href="#local-6989586621683097500"><span class="hs-identifier hs-var">args</span></a></span></span><span>
</span><span id="line-283"></span><span> </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">HsWrapper -&gt; Bool
</span><a href="GHC.Tc.Types.Evidence.html#isIdHsWrapper"><span class="hs-identifier hs-var">isIdHsWrapper</span></a></span><span> </span><span class="annot"><span class="annottext">HsWrapper
</span><a href="#local-6989586621683097499"><span class="hs-identifier hs-var">wrap</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[HsExprArg p]
</span><a href="#local-6989586621683097500"><span class="hs-identifier hs-var">args</span></a></span><span>
</span><span id="line-284"></span><span> </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">otherwise</span></span><span>          </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">EWrap -&gt; HsExprArg p
forall (p :: TcPass). EWrap -&gt; HsExprArg p
</span><a href="GHC.Tc.Gen.Head.html#EWrap"><span class="hs-identifier hs-var">EWrap</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">HsWrapper -&gt; EWrap
</span><a href="GHC.Tc.Gen.Head.html#EHsWrap"><span class="hs-identifier hs-var">EHsWrap</span></a></span><span> </span><span class="annot"><span class="annottext">HsWrapper
</span><a href="#local-6989586621683097499"><span class="hs-identifier hs-var">wrap</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">HsExprArg p -&gt; [HsExprArg p] -&gt; [HsExprArg p]
forall a. a -&gt; [a] -&gt; [a]
</span><span class="hs-glyph hs-var">:</span></span><span> </span><span class="annot"><span class="annottext">[HsExprArg p]
</span><a href="#local-6989586621683097500"><span class="hs-identifier hs-var">args</span></a></span><span>
</span><span id="line-285"></span><span>
</span><span id="line-286"></span><span class="annot"><a href="GHC.Tc.Gen.Head.html#splitHsApps"><span class="hs-identifier hs-type">splitHsApps</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Language.Haskell.Syntax.Expr.html#HsExpr"><span class="hs-identifier hs-type">HsExpr</span></a></span><span> </span><span class="annot"><a href="GHC.Hs.Extension.html#GhcRn"><span class="hs-identifier hs-type">GhcRn</span></a></span><span>
</span><span id="line-287"></span><span>            </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#TcM"><span class="hs-identifier hs-type">TcM</span></a></span><span> </span><span class="hs-special">(</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Language.Haskell.Syntax.Expr.html#HsExpr"><span class="hs-identifier hs-type">HsExpr</span></a></span><span> </span><span class="annot"><a href="GHC.Hs.Extension.html#GhcRn"><span class="hs-identifier hs-type">GhcRn</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Tc.Gen.Head.html#AppCtxt"><span class="hs-identifier hs-type">AppCtxt</span></a></span><span class="hs-special">)</span><span>  </span><span class="hs-comment">-- Head</span><span>
</span><span id="line-288"></span><span>                   </span><span class="hs-special">,</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="GHC.Tc.Gen.Head.html#HsExprArg"><span class="hs-identifier hs-type">HsExprArg</span></a></span><span> </span><span class="hs-special">'</span><span class="annot"><a href="GHC.Tc.Gen.Head.html#TcpRn"><span class="hs-identifier hs-type">TcpRn</span></a></span><span class="hs-special">]</span><span class="hs-special">)</span><span>      </span><span class="hs-comment">-- Args</span><span>
</span><span id="line-289"></span><span class="hs-comment">-- See Note [splitHsApps].</span><span>
</span><span id="line-290"></span><span class="hs-comment">--</span><span>
</span><span id="line-291"></span><span class="hs-comment">-- This uses the TcM monad solely because we must run modFinalizers when looking</span><span>
</span><span id="line-292"></span><span class="hs-comment">-- through HsUntypedSplices</span><span>
</span><span id="line-293"></span><span class="hs-comment">-- (see Note [Looking through Template Haskell splices in splitHsApps]).</span><span>
</span><span id="line-294"></span><span id="splitHsApps"><span class="annot"><span class="annottext">splitHsApps :: HsExpr (GhcPass 'Renamed)
-&gt; TcM ((HsExpr (GhcPass 'Renamed), AppCtxt), [HsExprArg 'TcpRn])
</span><a href="GHC.Tc.Gen.Head.html#splitHsApps"><span class="hs-identifier hs-var hs-var">splitHsApps</span></a></span></span><span> </span><span id="local-6989586621683097502"><span class="annot"><span class="annottext">HsExpr (GhcPass 'Renamed)
</span><a href="#local-6989586621683097502"><span class="hs-identifier hs-var">e</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">HsExpr (GhcPass 'Renamed)
-&gt; AppCtxt
-&gt; [HsExprArg 'TcpRn]
-&gt; TcM ((HsExpr (GhcPass 'Renamed), AppCtxt), [HsExprArg 'TcpRn])
</span><a href="#local-6989586621683097503"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="annot"><span class="annottext">HsExpr (GhcPass 'Renamed)
</span><a href="#local-6989586621683097502"><span class="hs-identifier hs-var">e</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ThLevel -&gt; HsExpr (GhcPass 'Renamed) -&gt; AppCtxt
</span><a href="#local-6989586621683097504"><span class="hs-identifier hs-var">top_ctxt</span></a></span><span> </span><span class="annot"><span class="annottext">ThLevel
</span><span class="hs-number">0</span></span><span> </span><span class="annot"><span class="annottext">HsExpr (GhcPass 'Renamed)
</span><a href="#local-6989586621683097502"><span class="hs-identifier hs-var">e</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span>
</span><span id="line-295"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-296"></span><span>    </span><span class="annot"><a href="#local-6989586621683097504"><span class="hs-identifier hs-type">top_ctxt</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Int</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Language.Haskell.Syntax.Expr.html#HsExpr"><span class="hs-identifier hs-type">HsExpr</span></a></span><span> </span><span class="annot"><a href="GHC.Hs.Extension.html#GhcRn"><span class="hs-identifier hs-type">GhcRn</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Gen.Head.html#AppCtxt"><span class="hs-identifier hs-type">AppCtxt</span></a></span><span>
</span><span id="line-297"></span><span>    </span><span class="hs-comment">-- Always returns VACall fun n_val_args noSrcSpan</span><span>
</span><span id="line-298"></span><span>    </span><span class="hs-comment">-- to initialise the argument splitting in 'go'</span><span>
</span><span id="line-299"></span><span>    </span><span class="hs-comment">-- See Note [AppCtxt]</span><span>
</span><span id="line-300"></span><span>    </span><span id="local-6989586621683097504"><span class="annot"><span class="annottext">top_ctxt :: ThLevel -&gt; HsExpr (GhcPass 'Renamed) -&gt; AppCtxt
</span><a href="#local-6989586621683097504"><span class="hs-identifier hs-var hs-var">top_ctxt</span></a></span></span><span> </span><span id="local-6989586621683097505"><span class="annot"><span class="annottext">ThLevel
</span><a href="#local-6989586621683097505"><span class="hs-identifier hs-var">n</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Language.Haskell.Syntax.Expr.html#HsPar"><span class="hs-identifier hs-type">HsPar</span></a></span><span> </span><span class="annot"><span class="annottext">XPar (GhcPass 'Renamed)
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621683097507"><span class="annot"><span class="annottext">LHsExpr (GhcPass 'Renamed)
</span><a href="#local-6989586621683097507"><span class="hs-identifier hs-var">fun</span></a></span></span><span class="hs-special">)</span><span>               </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ThLevel
-&gt; GenLocated SrcSpanAnnA (HsExpr (GhcPass 'Renamed)) -&gt; AppCtxt
forall {l}.
ThLevel -&gt; GenLocated l (HsExpr (GhcPass 'Renamed)) -&gt; AppCtxt
</span><a href="#local-6989586621683097508"><span class="hs-identifier hs-var">top_lctxt</span></a></span><span> </span><span class="annot"><span class="annottext">ThLevel
</span><a href="#local-6989586621683097505"><span class="hs-identifier hs-var">n</span></a></span><span> </span><span class="annot"><span class="annottext">LHsExpr (GhcPass 'Renamed)
GenLocated SrcSpanAnnA (HsExpr (GhcPass 'Renamed))
</span><a href="#local-6989586621683097507"><span class="hs-identifier hs-var">fun</span></a></span><span>
</span><span id="line-301"></span><span>    </span><span class="annot"><a href="#local-6989586621683097504"><span class="hs-identifier hs-var">top_ctxt</span></a></span><span> </span><span id="local-6989586621683097509"><span class="annot"><span class="annottext">ThLevel
</span><a href="#local-6989586621683097509"><span class="hs-identifier hs-var">n</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Language.Haskell.Syntax.Expr.html#HsPragE"><span class="hs-identifier hs-type">HsPragE</span></a></span><span> </span><span class="annot"><span class="annottext">XPragE (GhcPass 'Renamed)
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">HsPragE (GhcPass 'Renamed)
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621683097511"><span class="annot"><span class="annottext">LHsExpr (GhcPass 'Renamed)
</span><a href="#local-6989586621683097511"><span class="hs-identifier hs-var">fun</span></a></span></span><span class="hs-special">)</span><span>           </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ThLevel
-&gt; GenLocated SrcSpanAnnA (HsExpr (GhcPass 'Renamed)) -&gt; AppCtxt
forall {l}.
ThLevel -&gt; GenLocated l (HsExpr (GhcPass 'Renamed)) -&gt; AppCtxt
</span><a href="#local-6989586621683097508"><span class="hs-identifier hs-var">top_lctxt</span></a></span><span> </span><span class="annot"><span class="annottext">ThLevel
</span><a href="#local-6989586621683097509"><span class="hs-identifier hs-var">n</span></a></span><span> </span><span class="annot"><span class="annottext">LHsExpr (GhcPass 'Renamed)
GenLocated SrcSpanAnnA (HsExpr (GhcPass 'Renamed))
</span><a href="#local-6989586621683097511"><span class="hs-identifier hs-var">fun</span></a></span><span>
</span><span id="line-302"></span><span>    </span><span class="annot"><a href="#local-6989586621683097504"><span class="hs-identifier hs-var">top_ctxt</span></a></span><span> </span><span id="local-6989586621683097512"><span class="annot"><span class="annottext">ThLevel
</span><a href="#local-6989586621683097512"><span class="hs-identifier hs-var">n</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Language.Haskell.Syntax.Expr.html#HsAppType"><span class="hs-identifier hs-type">HsAppType</span></a></span><span> </span><span class="annot"><span class="annottext">XAppTypeE (GhcPass 'Renamed)
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621683097514"><span class="annot"><span class="annottext">LHsExpr (GhcPass 'Renamed)
</span><a href="#local-6989586621683097514"><span class="hs-identifier hs-var">fun</span></a></span></span><span> </span><span class="annot"><span class="annottext">LHsWcType (NoGhcTc (GhcPass 'Renamed))
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span>         </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ThLevel
-&gt; GenLocated SrcSpanAnnA (HsExpr (GhcPass 'Renamed)) -&gt; AppCtxt
forall {l}.
ThLevel -&gt; GenLocated l (HsExpr (GhcPass 'Renamed)) -&gt; AppCtxt
</span><a href="#local-6989586621683097508"><span class="hs-identifier hs-var">top_lctxt</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ThLevel
</span><a href="#local-6989586621683097512"><span class="hs-identifier hs-var">n</span></a></span><span class="annot"><span class="annottext">ThLevel -&gt; ThLevel -&gt; ThLevel
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">+</span></span><span class="annot"><span class="annottext">ThLevel
</span><span class="hs-number">1</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">LHsExpr (GhcPass 'Renamed)
GenLocated SrcSpanAnnA (HsExpr (GhcPass 'Renamed))
</span><a href="#local-6989586621683097514"><span class="hs-identifier hs-var">fun</span></a></span><span>
</span><span id="line-303"></span><span>    </span><span class="annot"><a href="#local-6989586621683097504"><span class="hs-identifier hs-var">top_ctxt</span></a></span><span> </span><span id="local-6989586621683097516"><span class="annot"><span class="annottext">ThLevel
</span><a href="#local-6989586621683097516"><span class="hs-identifier hs-var">n</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Language.Haskell.Syntax.Expr.html#HsApp"><span class="hs-identifier hs-type">HsApp</span></a></span><span> </span><span class="annot"><span class="annottext">XApp (GhcPass 'Renamed)
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621683097518"><span class="annot"><span class="annottext">LHsExpr (GhcPass 'Renamed)
</span><a href="#local-6989586621683097518"><span class="hs-identifier hs-var">fun</span></a></span></span><span> </span><span class="annot"><span class="annottext">LHsExpr (GhcPass 'Renamed)
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span>             </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ThLevel
-&gt; GenLocated SrcSpanAnnA (HsExpr (GhcPass 'Renamed)) -&gt; AppCtxt
forall {l}.
ThLevel -&gt; GenLocated l (HsExpr (GhcPass 'Renamed)) -&gt; AppCtxt
</span><a href="#local-6989586621683097508"><span class="hs-identifier hs-var">top_lctxt</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ThLevel
</span><a href="#local-6989586621683097516"><span class="hs-identifier hs-var">n</span></a></span><span class="annot"><span class="annottext">ThLevel -&gt; ThLevel -&gt; ThLevel
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">+</span></span><span class="annot"><span class="annottext">ThLevel
</span><span class="hs-number">1</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">LHsExpr (GhcPass 'Renamed)
GenLocated SrcSpanAnnA (HsExpr (GhcPass 'Renamed))
</span><a href="#local-6989586621683097518"><span class="hs-identifier hs-var">fun</span></a></span><span>
</span><span id="line-304"></span><span>    </span><span class="annot"><a href="#local-6989586621683097504"><span class="hs-identifier hs-var">top_ctxt</span></a></span><span> </span><span id="local-6989586621683097519"><span class="annot"><span class="annottext">ThLevel
</span><a href="#local-6989586621683097519"><span class="hs-identifier hs-var">n</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Language.Haskell.Syntax.Expr.html#XExpr"><span class="hs-identifier hs-type">XExpr</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Hs.Expr.html#ExpandedThingRn"><span class="hs-identifier hs-type">ExpandedThingRn</span></a></span><span> </span><span id="local-6989586621683097522"><span class="annot"><span class="annottext">HsThingRn
</span><a href="#local-6989586621683097522"><span class="hs-identifier hs-var">o</span></a></span></span><span> </span><span class="annot"><span class="annottext">HsExpr (GhcPass 'Renamed)
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-305"></span><span>      </span><span class="hs-glyph">|</span><span> </span><span class="annot"><a href="GHC.Hs.Expr.html#OrigExpr"><span class="hs-identifier hs-type">OrigExpr</span></a></span><span> </span><span id="local-6989586621683097524"><span class="annot"><span class="annottext">HsExpr (GhcPass 'Renamed)
</span><a href="#local-6989586621683097524"><span class="hs-identifier hs-var">fun</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">HsThingRn
</span><a href="#local-6989586621683097522"><span class="hs-identifier hs-var">o</span></a></span><span>                  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">HsExpr (GhcPass 'Renamed) -&gt; ThLevel -&gt; SrcSpan -&gt; AppCtxt
</span><a href="GHC.Tc.Gen.Head.html#VACall"><span class="hs-identifier hs-var">VACall</span></a></span><span> </span><span class="annot"><span class="annottext">HsExpr (GhcPass 'Renamed)
</span><a href="#local-6989586621683097524"><span class="hs-identifier hs-var">fun</span></a></span><span>  </span><span class="annot"><span class="annottext">ThLevel
</span><a href="#local-6989586621683097519"><span class="hs-identifier hs-var">n</span></a></span><span> </span><span class="annot"><span class="annottext">SrcSpan
</span><a href="GHC.Types.SrcLoc.html#noSrcSpan"><span class="hs-identifier hs-var">noSrcSpan</span></a></span><span>
</span><span id="line-306"></span><span>    </span><span class="annot"><a href="#local-6989586621683097504"><span class="hs-identifier hs-var">top_ctxt</span></a></span><span> </span><span id="local-6989586621683097526"><span class="annot"><span class="annottext">ThLevel
</span><a href="#local-6989586621683097526"><span class="hs-identifier hs-var">n</span></a></span></span><span> </span><span id="local-6989586621683097527"><span class="annot"><span class="annottext">HsExpr (GhcPass 'Renamed)
</span><a href="#local-6989586621683097527"><span class="hs-identifier hs-var">other_fun</span></a></span></span><span>                   </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">HsExpr (GhcPass 'Renamed) -&gt; ThLevel -&gt; SrcSpan -&gt; AppCtxt
</span><a href="GHC.Tc.Gen.Head.html#VACall"><span class="hs-identifier hs-var">VACall</span></a></span><span> </span><span class="annot"><span class="annottext">HsExpr (GhcPass 'Renamed)
</span><a href="#local-6989586621683097527"><span class="hs-identifier hs-var">other_fun</span></a></span><span> </span><span class="annot"><span class="annottext">ThLevel
</span><a href="#local-6989586621683097526"><span class="hs-identifier hs-var">n</span></a></span><span> </span><span class="annot"><span class="annottext">SrcSpan
</span><a href="GHC.Types.SrcLoc.html#noSrcSpan"><span class="hs-identifier hs-var">noSrcSpan</span></a></span><span>
</span><span id="line-307"></span><span>
</span><span id="line-308"></span><span>    </span><span id="local-6989586621683097508"><span class="annot"><span class="annottext">top_lctxt :: ThLevel -&gt; GenLocated l (HsExpr (GhcPass 'Renamed)) -&gt; AppCtxt
</span><a href="#local-6989586621683097508"><span class="hs-identifier hs-var hs-var">top_lctxt</span></a></span></span><span> </span><span id="local-6989586621683097528"><span class="annot"><span class="annottext">ThLevel
</span><a href="#local-6989586621683097528"><span class="hs-identifier hs-var">n</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Types.SrcLoc.html#L"><span class="hs-identifier hs-type">L</span></a></span><span> </span><span class="annot"><span class="annottext">l
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621683097530"><span class="annot"><span class="annottext">HsExpr (GhcPass 'Renamed)
</span><a href="#local-6989586621683097530"><span class="hs-identifier hs-var">fun</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ThLevel -&gt; HsExpr (GhcPass 'Renamed) -&gt; AppCtxt
</span><a href="#local-6989586621683097504"><span class="hs-identifier hs-var">top_ctxt</span></a></span><span> </span><span class="annot"><span class="annottext">ThLevel
</span><a href="#local-6989586621683097528"><span class="hs-identifier hs-var">n</span></a></span><span> </span><span class="annot"><span class="annottext">HsExpr (GhcPass 'Renamed)
</span><a href="#local-6989586621683097530"><span class="hs-identifier hs-var">fun</span></a></span><span>
</span><span id="line-309"></span><span>
</span><span id="line-310"></span><span>    </span><span class="annot"><a href="#local-6989586621683097503"><span class="hs-identifier hs-type">go</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Language.Haskell.Syntax.Expr.html#HsExpr"><span class="hs-identifier hs-type">HsExpr</span></a></span><span> </span><span class="annot"><a href="GHC.Hs.Extension.html#GhcRn"><span class="hs-identifier hs-type">GhcRn</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Gen.Head.html#AppCtxt"><span class="hs-identifier hs-type">AppCtxt</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="GHC.Tc.Gen.Head.html#HsExprArg"><span class="hs-identifier hs-type">HsExprArg</span></a></span><span> </span><span class="hs-special">'</span><span class="annot"><a href="GHC.Tc.Gen.Head.html#TcpRn"><span class="hs-identifier hs-type">TcpRn</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-311"></span><span>       </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#TcM"><span class="hs-identifier hs-type">TcM</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">(</span><span class="annot"><a href="Language.Haskell.Syntax.Expr.html#HsExpr"><span class="hs-identifier hs-type">HsExpr</span></a></span><span> </span><span class="annot"><a href="GHC.Hs.Extension.html#GhcRn"><span class="hs-identifier hs-type">GhcRn</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Tc.Gen.Head.html#AppCtxt"><span class="hs-identifier hs-type">AppCtxt</span></a></span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="GHC.Tc.Gen.Head.html#HsExprArg"><span class="hs-identifier hs-type">HsExprArg</span></a></span><span> </span><span class="hs-special">'</span><span class="annot"><a href="GHC.Tc.Gen.Head.html#TcpRn"><span class="hs-identifier hs-type">TcpRn</span></a></span><span class="hs-special">]</span><span class="hs-special">)</span><span>
</span><span id="line-312"></span><span>    </span><span class="hs-comment">-- Modify the AppCtxt as we walk inwards, so it describes the next argument</span><span>
</span><span id="line-313"></span><span>    </span><span id="local-6989586621683097503"><span class="annot"><span class="annottext">go :: HsExpr (GhcPass 'Renamed)
-&gt; AppCtxt
-&gt; [HsExprArg 'TcpRn]
-&gt; TcM ((HsExpr (GhcPass 'Renamed), AppCtxt), [HsExprArg 'TcpRn])
</span><a href="#local-6989586621683097503"><span class="hs-identifier hs-var hs-var">go</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Language.Haskell.Syntax.Expr.html#HsPar"><span class="hs-identifier hs-type">HsPar</span></a></span><span> </span><span class="annot"><span class="annottext">XPar (GhcPass 'Renamed)
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Types.SrcLoc.html#L"><span class="hs-identifier hs-type">L</span></a></span><span> </span><span id="local-6989586621683097531"><span class="annot"><span class="annottext">SrcSpanAnnA
</span><a href="#local-6989586621683097531"><span class="hs-identifier hs-var">l</span></a></span></span><span> </span><span id="local-6989586621683097532"><span class="annot"><span class="annottext">HsExpr (GhcPass 'Renamed)
</span><a href="#local-6989586621683097532"><span class="hs-identifier hs-var">fun</span></a></span></span><span class="hs-special">)</span><span class="hs-special">)</span><span>           </span><span id="local-6989586621683097533"><span class="annot"><span class="annottext">AppCtxt
</span><a href="#local-6989586621683097533"><span class="hs-identifier hs-var">ctxt</span></a></span></span><span> </span><span id="local-6989586621683097534"><span class="annot"><span class="annottext">[HsExprArg 'TcpRn]
</span><a href="#local-6989586621683097534"><span class="hs-identifier hs-var">args</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">HsExpr (GhcPass 'Renamed)
-&gt; AppCtxt
-&gt; [HsExprArg 'TcpRn]
-&gt; TcM ((HsExpr (GhcPass 'Renamed), AppCtxt), [HsExprArg 'TcpRn])
</span><a href="#local-6989586621683097503"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="annot"><span class="annottext">HsExpr (GhcPass 'Renamed)
</span><a href="#local-6989586621683097532"><span class="hs-identifier hs-var">fun</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">SrcSpanAnnA -&gt; AppCtxt -&gt; AppCtxt
forall ann. EpAnn ann -&gt; AppCtxt -&gt; AppCtxt
</span><a href="#local-6989586621683097535"><span class="hs-identifier hs-var">set</span></a></span><span> </span><span class="annot"><span class="annottext">SrcSpanAnnA
</span><a href="#local-6989586621683097531"><span class="hs-identifier hs-var">l</span></a></span><span> </span><span class="annot"><span class="annottext">AppCtxt
</span><a href="#local-6989586621683097533"><span class="hs-identifier hs-var">ctxt</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">EWrap -&gt; HsExprArg 'TcpRn
forall (p :: TcPass). EWrap -&gt; HsExprArg p
</span><a href="GHC.Tc.Gen.Head.html#EWrap"><span class="hs-identifier hs-var">EWrap</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">AppCtxt -&gt; EWrap
</span><a href="GHC.Tc.Gen.Head.html#EPar"><span class="hs-identifier hs-var">EPar</span></a></span><span> </span><span class="annot"><span class="annottext">AppCtxt
</span><a href="#local-6989586621683097533"><span class="hs-identifier hs-var">ctxt</span></a></span><span class="hs-special">)</span><span>     </span><span class="annot"><span class="annottext">HsExprArg 'TcpRn -&gt; [HsExprArg 'TcpRn] -&gt; [HsExprArg 'TcpRn]
forall a. a -&gt; [a] -&gt; [a]
</span><span class="hs-glyph hs-var">:</span></span><span> </span><span class="annot"><span class="annottext">[HsExprArg 'TcpRn]
</span><a href="#local-6989586621683097534"><span class="hs-identifier hs-var">args</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-314"></span><span>    </span><span class="annot"><a href="#local-6989586621683097503"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Language.Haskell.Syntax.Expr.html#HsPragE"><span class="hs-identifier hs-type">HsPragE</span></a></span><span> </span><span class="annot"><span class="annottext">XPragE (GhcPass 'Renamed)
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621683097536"><span class="annot"><span class="annottext">HsPragE (GhcPass 'Renamed)
</span><a href="#local-6989586621683097536"><span class="hs-identifier hs-var">p</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Types.SrcLoc.html#L"><span class="hs-identifier hs-type">L</span></a></span><span> </span><span id="local-6989586621683097537"><span class="annot"><span class="annottext">SrcSpanAnnA
</span><a href="#local-6989586621683097537"><span class="hs-identifier hs-var">l</span></a></span></span><span> </span><span id="local-6989586621683097538"><span class="annot"><span class="annottext">HsExpr (GhcPass 'Renamed)
</span><a href="#local-6989586621683097538"><span class="hs-identifier hs-var">fun</span></a></span></span><span class="hs-special">)</span><span class="hs-special">)</span><span>       </span><span id="local-6989586621683097539"><span class="annot"><span class="annottext">AppCtxt
</span><a href="#local-6989586621683097539"><span class="hs-identifier hs-var">ctxt</span></a></span></span><span> </span><span id="local-6989586621683097540"><span class="annot"><span class="annottext">[HsExprArg 'TcpRn]
</span><a href="#local-6989586621683097540"><span class="hs-identifier hs-var">args</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">HsExpr (GhcPass 'Renamed)
-&gt; AppCtxt
-&gt; [HsExprArg 'TcpRn]
-&gt; TcM ((HsExpr (GhcPass 'Renamed), AppCtxt), [HsExprArg 'TcpRn])
</span><a href="#local-6989586621683097503"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="annot"><span class="annottext">HsExpr (GhcPass 'Renamed)
</span><a href="#local-6989586621683097538"><span class="hs-identifier hs-var">fun</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">SrcSpanAnnA -&gt; AppCtxt -&gt; AppCtxt
forall ann. EpAnn ann -&gt; AppCtxt -&gt; AppCtxt
</span><a href="#local-6989586621683097535"><span class="hs-identifier hs-var">set</span></a></span><span> </span><span class="annot"><span class="annottext">SrcSpanAnnA
</span><a href="#local-6989586621683097537"><span class="hs-identifier hs-var">l</span></a></span><span> </span><span class="annot"><span class="annottext">AppCtxt
</span><a href="#local-6989586621683097539"><span class="hs-identifier hs-var">ctxt</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">AppCtxt -&gt; HsPragE (GhcPass (XPass 'TcpRn)) -&gt; HsExprArg 'TcpRn
forall (p :: TcPass).
AppCtxt -&gt; HsPragE (GhcPass (XPass p)) -&gt; HsExprArg p
</span><a href="GHC.Tc.Gen.Head.html#EPrag"><span class="hs-identifier hs-var">EPrag</span></a></span><span>      </span><span class="annot"><span class="annottext">AppCtxt
</span><a href="#local-6989586621683097539"><span class="hs-identifier hs-var">ctxt</span></a></span><span> </span><span class="annot"><span class="annottext">HsPragE (GhcPass 'Renamed)
HsPragE (GhcPass (XPass 'TcpRn))
</span><a href="#local-6989586621683097536"><span class="hs-identifier hs-var">p</span></a></span><span>     </span><span class="annot"><span class="annottext">HsExprArg 'TcpRn -&gt; [HsExprArg 'TcpRn] -&gt; [HsExprArg 'TcpRn]
forall a. a -&gt; [a] -&gt; [a]
</span><span class="hs-glyph hs-var">:</span></span><span> </span><span class="annot"><span class="annottext">[HsExprArg 'TcpRn]
</span><a href="#local-6989586621683097540"><span class="hs-identifier hs-var">args</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-315"></span><span>    </span><span class="annot"><a href="#local-6989586621683097503"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Language.Haskell.Syntax.Expr.html#HsAppType"><span class="hs-identifier hs-type">HsAppType</span></a></span><span> </span><span class="annot"><span class="annottext">XAppTypeE (GhcPass 'Renamed)
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Types.SrcLoc.html#L"><span class="hs-identifier hs-type">L</span></a></span><span> </span><span id="local-6989586621683097541"><span class="annot"><span class="annottext">SrcSpanAnnA
</span><a href="#local-6989586621683097541"><span class="hs-identifier hs-var">l</span></a></span></span><span> </span><span id="local-6989586621683097542"><span class="annot"><span class="annottext">HsExpr (GhcPass 'Renamed)
</span><a href="#local-6989586621683097542"><span class="hs-identifier hs-var">fun</span></a></span></span><span class="hs-special">)</span><span> </span><span id="local-6989586621683097543"><span class="annot"><span class="annottext">LHsWcType (NoGhcTc (GhcPass 'Renamed))
</span><a href="#local-6989586621683097543"><span class="hs-identifier hs-var">ty</span></a></span></span><span class="hs-special">)</span><span>    </span><span id="local-6989586621683097544"><span class="annot"><span class="annottext">AppCtxt
</span><a href="#local-6989586621683097544"><span class="hs-identifier hs-var">ctxt</span></a></span></span><span> </span><span id="local-6989586621683097545"><span class="annot"><span class="annottext">[HsExprArg 'TcpRn]
</span><a href="#local-6989586621683097545"><span class="hs-identifier hs-var">args</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">HsExpr (GhcPass 'Renamed)
-&gt; AppCtxt
-&gt; [HsExprArg 'TcpRn]
-&gt; TcM ((HsExpr (GhcPass 'Renamed), AppCtxt), [HsExprArg 'TcpRn])
</span><a href="#local-6989586621683097503"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="annot"><span class="annottext">HsExpr (GhcPass 'Renamed)
</span><a href="#local-6989586621683097542"><span class="hs-identifier hs-var">fun</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">SrcSpanAnnA -&gt; AppCtxt -&gt; AppCtxt
forall ann. EpAnn ann -&gt; AppCtxt -&gt; AppCtxt
</span><a href="#local-6989586621683097546"><span class="hs-identifier hs-var">dec</span></a></span><span> </span><span class="annot"><span class="annottext">SrcSpanAnnA
</span><a href="#local-6989586621683097541"><span class="hs-identifier hs-var">l</span></a></span><span> </span><span class="annot"><span class="annottext">AppCtxt
</span><a href="#local-6989586621683097544"><span class="hs-identifier hs-var">ctxt</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">AppCtxt -&gt; LHsWcType (GhcPass 'Renamed) -&gt; HsExprArg 'TcpRn
</span><a href="GHC.Tc.Gen.Head.html#mkETypeArg"><span class="hs-identifier hs-var">mkETypeArg</span></a></span><span> </span><span class="annot"><span class="annottext">AppCtxt
</span><a href="#local-6989586621683097544"><span class="hs-identifier hs-var">ctxt</span></a></span><span> </span><span class="annot"><span class="annottext">LHsWcType (NoGhcTc (GhcPass 'Renamed))
LHsWcType (GhcPass 'Renamed)
</span><a href="#local-6989586621683097543"><span class="hs-identifier hs-var">ty</span></a></span><span>    </span><span class="annot"><span class="annottext">HsExprArg 'TcpRn -&gt; [HsExprArg 'TcpRn] -&gt; [HsExprArg 'TcpRn]
forall a. a -&gt; [a] -&gt; [a]
</span><span class="hs-glyph hs-var">:</span></span><span> </span><span class="annot"><span class="annottext">[HsExprArg 'TcpRn]
</span><a href="#local-6989586621683097545"><span class="hs-identifier hs-var">args</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-316"></span><span>    </span><span class="annot"><a href="#local-6989586621683097503"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Language.Haskell.Syntax.Expr.html#HsApp"><span class="hs-identifier hs-type">HsApp</span></a></span><span> </span><span class="annot"><span class="annottext">XApp (GhcPass 'Renamed)
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Types.SrcLoc.html#L"><span class="hs-identifier hs-type">L</span></a></span><span> </span><span id="local-6989586621683097547"><span class="annot"><span class="annottext">SrcSpanAnnA
</span><a href="#local-6989586621683097547"><span class="hs-identifier hs-var">l</span></a></span></span><span> </span><span id="local-6989586621683097548"><span class="annot"><span class="annottext">HsExpr (GhcPass 'Renamed)
</span><a href="#local-6989586621683097548"><span class="hs-identifier hs-var">fun</span></a></span></span><span class="hs-special">)</span><span> </span><span id="local-6989586621683097549"><span class="annot"><span class="annottext">LHsExpr (GhcPass 'Renamed)
</span><a href="#local-6989586621683097549"><span class="hs-identifier hs-var">arg</span></a></span></span><span class="hs-special">)</span><span>       </span><span id="local-6989586621683097550"><span class="annot"><span class="annottext">AppCtxt
</span><a href="#local-6989586621683097550"><span class="hs-identifier hs-var">ctxt</span></a></span></span><span> </span><span id="local-6989586621683097551"><span class="annot"><span class="annottext">[HsExprArg 'TcpRn]
</span><a href="#local-6989586621683097551"><span class="hs-identifier hs-var">args</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">HsExpr (GhcPass 'Renamed)
-&gt; AppCtxt
-&gt; [HsExprArg 'TcpRn]
-&gt; TcM ((HsExpr (GhcPass 'Renamed), AppCtxt), [HsExprArg 'TcpRn])
</span><a href="#local-6989586621683097503"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="annot"><span class="annottext">HsExpr (GhcPass 'Renamed)
</span><a href="#local-6989586621683097548"><span class="hs-identifier hs-var">fun</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">SrcSpanAnnA -&gt; AppCtxt -&gt; AppCtxt
forall ann. EpAnn ann -&gt; AppCtxt -&gt; AppCtxt
</span><a href="#local-6989586621683097546"><span class="hs-identifier hs-var">dec</span></a></span><span> </span><span class="annot"><span class="annottext">SrcSpanAnnA
</span><a href="#local-6989586621683097547"><span class="hs-identifier hs-var">l</span></a></span><span> </span><span class="annot"><span class="annottext">AppCtxt
</span><a href="#local-6989586621683097550"><span class="hs-identifier hs-var">ctxt</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">AppCtxt -&gt; LHsExpr (GhcPass 'Renamed) -&gt; HsExprArg 'TcpRn
</span><a href="GHC.Tc.Gen.Head.html#mkEValArg"><span class="hs-identifier hs-var">mkEValArg</span></a></span><span>  </span><span class="annot"><span class="annottext">AppCtxt
</span><a href="#local-6989586621683097550"><span class="hs-identifier hs-var">ctxt</span></a></span><span> </span><span class="annot"><span class="annottext">LHsExpr (GhcPass 'Renamed)
</span><a href="#local-6989586621683097549"><span class="hs-identifier hs-var">arg</span></a></span><span>   </span><span class="annot"><span class="annottext">HsExprArg 'TcpRn -&gt; [HsExprArg 'TcpRn] -&gt; [HsExprArg 'TcpRn]
forall a. a -&gt; [a] -&gt; [a]
</span><span class="hs-glyph hs-var">:</span></span><span> </span><span class="annot"><span class="annottext">[HsExprArg 'TcpRn]
</span><a href="#local-6989586621683097551"><span class="hs-identifier hs-var">args</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-317"></span><span>
</span><span id="line-318"></span><span>    </span><span class="hs-comment">-- See Note [Looking through Template Haskell splices in splitHsApps]</span><span>
</span><span id="line-319"></span><span>    </span><span class="annot"><a href="#local-6989586621683097503"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span id="local-6989586621683097552"><span class="annot"><span class="annottext">e :: HsExpr (GhcPass 'Renamed)
</span><a href="#local-6989586621683097552"><span class="hs-identifier hs-var">e</span></a></span></span><span class="hs-glyph">@</span><span class="hs-special">(</span><span class="annot"><a href="Language.Haskell.Syntax.Expr.html#HsUntypedSplice"><span class="hs-identifier hs-type">HsUntypedSplice</span></a></span><span> </span><span id="local-6989586621683097554"><span class="annot"><span class="annottext">XUntypedSplice (GhcPass 'Renamed)
</span><a href="#local-6989586621683097554"><span class="hs-identifier hs-var">splice_res</span></a></span></span><span> </span><span id="local-6989586621683097555"><span class="annot"><span class="annottext">HsUntypedSplice (GhcPass 'Renamed)
</span><a href="#local-6989586621683097555"><span class="hs-identifier hs-var">splice</span></a></span></span><span class="hs-special">)</span><span> </span><span id="local-6989586621683097556"><span class="annot"><span class="annottext">AppCtxt
</span><a href="#local-6989586621683097556"><span class="hs-identifier hs-var">ctxt</span></a></span></span><span> </span><span id="local-6989586621683097557"><span class="annot"><span class="annottext">[HsExprArg 'TcpRn]
</span><a href="#local-6989586621683097557"><span class="hs-identifier hs-var">args</span></a></span></span><span>
</span><span id="line-320"></span><span>      </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span id="local-6989586621683097558"><span class="annot"><a href="#local-6989586621683097558"><span class="hs-identifier hs-var">fun</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">HsUntypedSpliceResult (HsExpr (GhcPass 'Renamed))
-&gt; TcM (HsExpr (GhcPass 'Renamed))
</span><a href="GHC.Tc.Gen.Splice.html#getUntypedSpliceBody"><span class="hs-identifier hs-var">getUntypedSpliceBody</span></a></span><span> </span><span class="annot"><span class="annottext">XUntypedSplice (GhcPass 'Renamed)
HsUntypedSpliceResult (HsExpr (GhcPass 'Renamed))
</span><a href="#local-6989586621683097554"><span class="hs-identifier hs-var">splice_res</span></a></span><span>
</span><span id="line-321"></span><span>           </span><span class="hs-special">;</span><span> </span><span class="annot"><a href="#local-6989586621683097503"><span class="hs-identifier hs-type">go</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683097558"><span class="hs-identifier hs-type">fun</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683097559"><span class="hs-identifier hs-type">ctxt'</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Tc.Gen.Head.html#EWrap"><span class="hs-identifier hs-type">EWrap</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Tc.Gen.Head.html#EExpand"><span class="hs-identifier hs-type">EExpand</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Hs.Expr.html#OrigExpr"><span class="hs-identifier hs-type">OrigExpr</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683097552"><span class="hs-identifier hs-type">e</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="annot"><span class="hs-glyph hs-type">:</span></span><span> </span><span class="annot"><a href="#local-6989586621683097557"><span class="hs-identifier hs-type">args</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-322"></span><span>      </span><span class="hs-keyword">where</span><span>
</span><span id="line-323"></span><span>        </span><span class="annot"><a href="#local-6989586621683097559"><span class="hs-identifier hs-type">ctxt'</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Tc.Gen.Head.html#AppCtxt"><span class="hs-identifier hs-type">AppCtxt</span></a></span><span>
</span><span id="line-324"></span><span>        </span><span id="local-6989586621683097559"><span class="annot"><span class="annottext">ctxt' :: AppCtxt
</span><a href="#local-6989586621683097559"><span class="hs-identifier hs-var hs-var">ctxt'</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">HsUntypedSplice (GhcPass 'Renamed)
</span><a href="#local-6989586621683097555"><span class="hs-identifier hs-var">splice</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-325"></span><span>            </span><span class="annot"><a href="Language.Haskell.Syntax.Expr.html#HsUntypedSpliceExpr"><span class="hs-identifier hs-type">HsUntypedSpliceExpr</span></a></span><span> </span><span class="annot"><span class="annottext">XUntypedSpliceExpr (GhcPass 'Renamed)
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Types.SrcLoc.html#L"><span class="hs-identifier hs-type">L</span></a></span><span> </span><span id="local-6989586621683097561"><span class="annot"><span class="annottext">SrcSpanAnnA
</span><a href="#local-6989586621683097561"><span class="hs-identifier hs-var">l</span></a></span></span><span> </span><span class="annot"><span class="annottext">HsExpr (GhcPass 'Renamed)
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">SrcSpanAnnA -&gt; AppCtxt -&gt; AppCtxt
forall ann. EpAnn ann -&gt; AppCtxt -&gt; AppCtxt
</span><a href="#local-6989586621683097535"><span class="hs-identifier hs-var">set</span></a></span><span> </span><span class="annot"><span class="annottext">SrcSpanAnnA
</span><a href="#local-6989586621683097561"><span class="hs-identifier hs-var">l</span></a></span><span> </span><span class="annot"><span class="annottext">AppCtxt
</span><a href="#local-6989586621683097556"><span class="hs-identifier hs-var">ctxt</span></a></span><span> </span><span class="hs-comment">-- l :: SrcAnn AnnListItem</span><span>
</span><span id="line-326"></span><span>            </span><span class="annot"><a href="Language.Haskell.Syntax.Expr.html#HsQuasiQuote"><span class="hs-identifier hs-type">HsQuasiQuote</span></a></span><span> </span><span class="annot"><span class="annottext">XQuasiQuote (GhcPass 'Renamed)
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">IdP (GhcPass 'Renamed)
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Types.SrcLoc.html#L"><span class="hs-identifier hs-type">L</span></a></span><span> </span><span id="local-6989586621683097563"><span class="annot"><span class="annottext">EpAnn NoEpAnns
</span><a href="#local-6989586621683097563"><span class="hs-identifier hs-var">l</span></a></span></span><span> </span><span class="annot"><span class="annottext">FastString
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span>      </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">EpAnn NoEpAnns -&gt; AppCtxt -&gt; AppCtxt
forall ann. EpAnn ann -&gt; AppCtxt -&gt; AppCtxt
</span><a href="#local-6989586621683097535"><span class="hs-identifier hs-var">set</span></a></span><span> </span><span class="annot"><span class="annottext">EpAnn NoEpAnns
</span><a href="#local-6989586621683097563"><span class="hs-identifier hs-var">l</span></a></span><span> </span><span class="annot"><span class="annottext">AppCtxt
</span><a href="#local-6989586621683097556"><span class="hs-identifier hs-var">ctxt</span></a></span><span> </span><span class="hs-comment">-- l :: SrcAnn NoEpAnns</span><span>
</span><span id="line-327"></span><span>
</span><span id="line-328"></span><span>    </span><span class="hs-comment">-- See Note [Looking through ExpandedThingRn]</span><span>
</span><span id="line-329"></span><span>    </span><span class="annot"><a href="#local-6989586621683097503"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Language.Haskell.Syntax.Expr.html#XExpr"><span class="hs-identifier hs-type">XExpr</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Hs.Expr.html#ExpandedThingRn"><span class="hs-identifier hs-type">ExpandedThingRn</span></a></span><span> </span><span id="local-6989586621683097564"><span class="annot"><span class="annottext">HsThingRn
</span><a href="#local-6989586621683097564"><span class="hs-identifier hs-var">o</span></a></span></span><span> </span><span id="local-6989586621683097565"><span class="annot"><span class="annottext">HsExpr (GhcPass 'Renamed)
</span><a href="#local-6989586621683097565"><span class="hs-identifier hs-var">e</span></a></span></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span id="local-6989586621683097566"><span class="annot"><span class="annottext">AppCtxt
</span><a href="#local-6989586621683097566"><span class="hs-identifier hs-var">ctxt</span></a></span></span><span> </span><span id="local-6989586621683097567"><span class="annot"><span class="annottext">[HsExprArg 'TcpRn]
</span><a href="#local-6989586621683097567"><span class="hs-identifier hs-var">args</span></a></span></span><span>
</span><span id="line-330"></span><span>      </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">HsThingRn -&gt; Bool
</span><a href="GHC.Hs.Expr.html#isHsThingRnExpr"><span class="hs-identifier hs-var">isHsThingRnExpr</span></a></span><span> </span><span class="annot"><span class="annottext">HsThingRn
</span><a href="#local-6989586621683097564"><span class="hs-identifier hs-var">o</span></a></span><span>
</span><span id="line-331"></span><span>      </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">HsExpr (GhcPass 'Renamed)
-&gt; AppCtxt
-&gt; [HsExprArg 'TcpRn]
-&gt; TcM ((HsExpr (GhcPass 'Renamed), AppCtxt), [HsExprArg 'TcpRn])
</span><a href="#local-6989586621683097503"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="annot"><span class="annottext">HsExpr (GhcPass 'Renamed)
</span><a href="#local-6989586621683097565"><span class="hs-identifier hs-var">e</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">HsThingRn -&gt; SrcSpan -&gt; SrcSpan -&gt; AppCtxt
</span><a href="GHC.Tc.Gen.Head.html#VAExpansion"><span class="hs-identifier hs-var">VAExpansion</span></a></span><span> </span><span class="annot"><span class="annottext">HsThingRn
</span><a href="#local-6989586621683097564"><span class="hs-identifier hs-var">o</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">AppCtxt -&gt; SrcSpan
</span><a href="GHC.Tc.Gen.Head.html#appCtxtLoc"><span class="hs-identifier hs-var">appCtxtLoc</span></a></span><span> </span><span class="annot"><span class="annottext">AppCtxt
</span><a href="#local-6989586621683097566"><span class="hs-identifier hs-var">ctxt</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">AppCtxt -&gt; SrcSpan
</span><a href="GHC.Tc.Gen.Head.html#appCtxtLoc"><span class="hs-identifier hs-var">appCtxtLoc</span></a></span><span> </span><span class="annot"><span class="annottext">AppCtxt
</span><a href="#local-6989586621683097566"><span class="hs-identifier hs-var">ctxt</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-332"></span><span>               </span><span class="hs-special">(</span><span class="annot"><span class="annottext">EWrap -&gt; HsExprArg 'TcpRn
forall (p :: TcPass). EWrap -&gt; HsExprArg p
</span><a href="GHC.Tc.Gen.Head.html#EWrap"><span class="hs-identifier hs-var">EWrap</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">HsThingRn -&gt; EWrap
</span><a href="GHC.Tc.Gen.Head.html#EExpand"><span class="hs-identifier hs-var">EExpand</span></a></span><span> </span><span class="annot"><span class="annottext">HsThingRn
</span><a href="#local-6989586621683097564"><span class="hs-identifier hs-var">o</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">HsExprArg 'TcpRn -&gt; [HsExprArg 'TcpRn] -&gt; [HsExprArg 'TcpRn]
forall a. a -&gt; [a] -&gt; [a]
</span><span class="hs-glyph hs-var">:</span></span><span> </span><span class="annot"><span class="annottext">[HsExprArg 'TcpRn]
</span><a href="#local-6989586621683097567"><span class="hs-identifier hs-var">args</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-333"></span><span>
</span><span id="line-334"></span><span>      </span><span class="hs-glyph">|</span><span> </span><span class="annot"><a href="GHC.Hs.Expr.html#OrigStmt"><span class="hs-identifier hs-type">OrigStmt</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Types.SrcLoc.html#L"><span class="hs-identifier hs-type">L</span></a></span><span> </span><span class="annot"><span class="annottext">SrcSpanAnnA
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621683097570"><span class="annot"><span class="annottext">StmtLR
  (GhcPass 'Renamed)
  (GhcPass 'Renamed)
  (GenLocated SrcSpanAnnA (HsExpr (GhcPass 'Renamed)))
</span><a href="#local-6989586621683097570"><span class="hs-identifier hs-var">stmt</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">HsThingRn
</span><a href="#local-6989586621683097564"><span class="hs-identifier hs-var">o</span></a></span><span>                </span><span class="hs-comment">-- so that we set `(&gt;&gt;)` as generated</span><span>
</span><span id="line-335"></span><span>      </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Language.Haskell.Syntax.Expr.html#BodyStmt"><span class="hs-identifier hs-type">BodyStmt</span></a></span><span class="hs-special">{</span><span class="hs-special">}</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">StmtLR
  (GhcPass 'Renamed)
  (GhcPass 'Renamed)
  (GenLocated SrcSpanAnnA (HsExpr (GhcPass 'Renamed)))
</span><a href="#local-6989586621683097570"><span class="hs-identifier hs-var">stmt</span></a></span><span>                      </span><span class="hs-comment">-- and get the right unused bind warnings</span><span>
</span><span id="line-336"></span><span>      </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">HsExpr (GhcPass 'Renamed)
-&gt; AppCtxt
-&gt; [HsExprArg 'TcpRn]
-&gt; TcM ((HsExpr (GhcPass 'Renamed), AppCtxt), [HsExprArg 'TcpRn])
</span><a href="#local-6989586621683097503"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="annot"><span class="annottext">HsExpr (GhcPass 'Renamed)
</span><a href="#local-6989586621683097565"><span class="hs-identifier hs-var">e</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">HsThingRn -&gt; SrcSpan -&gt; SrcSpan -&gt; AppCtxt
</span><a href="GHC.Tc.Gen.Head.html#VAExpansion"><span class="hs-identifier hs-var">VAExpansion</span></a></span><span> </span><span class="annot"><span class="annottext">HsThingRn
</span><a href="#local-6989586621683097564"><span class="hs-identifier hs-var">o</span></a></span><span> </span><span class="annot"><span class="annottext">SrcSpan
</span><a href="GHC.Types.SrcLoc.html#generatedSrcSpan"><span class="hs-identifier hs-var">generatedSrcSpan</span></a></span><span> </span><span class="annot"><span class="annottext">SrcSpan
</span><a href="GHC.Types.SrcLoc.html#generatedSrcSpan"><span class="hs-identifier hs-var">generatedSrcSpan</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-337"></span><span>                                                </span><span class="hs-comment">-- See Part 3. in Note [Expanding HsDo with XXExprGhcRn]</span><span>
</span><span id="line-338"></span><span>               </span><span class="hs-special">(</span><span class="annot"><span class="annottext">EWrap -&gt; HsExprArg 'TcpRn
forall (p :: TcPass). EWrap -&gt; HsExprArg p
</span><a href="GHC.Tc.Gen.Head.html#EWrap"><span class="hs-identifier hs-var">EWrap</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">HsThingRn -&gt; EWrap
</span><a href="GHC.Tc.Gen.Head.html#EExpand"><span class="hs-identifier hs-var">EExpand</span></a></span><span> </span><span class="annot"><span class="annottext">HsThingRn
</span><a href="#local-6989586621683097564"><span class="hs-identifier hs-var">o</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">HsExprArg 'TcpRn -&gt; [HsExprArg 'TcpRn] -&gt; [HsExprArg 'TcpRn]
forall a. a -&gt; [a] -&gt; [a]
</span><span class="hs-glyph hs-var">:</span></span><span> </span><span class="annot"><span class="annottext">[HsExprArg 'TcpRn]
</span><a href="#local-6989586621683097567"><span class="hs-identifier hs-var">args</span></a></span><span class="hs-special">)</span><span>       </span><span class="hs-comment">-- in `GHC.Tc.Gen.Do`</span><span>
</span><span id="line-339"></span><span>
</span><span id="line-340"></span><span>
</span><span id="line-341"></span><span>      </span><span class="hs-glyph">|</span><span> </span><span class="annot"><a href="GHC.Hs.Expr.html#OrigPat"><span class="hs-identifier hs-type">OrigPat</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Types.SrcLoc.html#L"><span class="hs-identifier hs-type">L</span></a></span><span> </span><span id="local-6989586621683097574"><span class="annot"><span class="annottext">SrcSpanAnnA
</span><a href="#local-6989586621683097574"><span class="hs-identifier hs-var">loc</span></a></span></span><span> </span><span class="annot"><span class="annottext">Pat (GhcPass 'Renamed)
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">HsThingRn
</span><a href="#local-6989586621683097564"><span class="hs-identifier hs-var">o</span></a></span><span>                              </span><span class="hs-comment">-- so that we set the compiler generated fail context</span><span>
</span><span id="line-342"></span><span>      </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">HsExpr (GhcPass 'Renamed)
-&gt; AppCtxt
-&gt; [HsExprArg 'TcpRn]
-&gt; TcM ((HsExpr (GhcPass 'Renamed), AppCtxt), [HsExprArg 'TcpRn])
</span><a href="#local-6989586621683097503"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="annot"><span class="annottext">HsExpr (GhcPass 'Renamed)
</span><a href="#local-6989586621683097565"><span class="hs-identifier hs-var">e</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">HsThingRn -&gt; SrcSpan -&gt; SrcSpan -&gt; AppCtxt
</span><a href="GHC.Tc.Gen.Head.html#VAExpansion"><span class="hs-identifier hs-var">VAExpansion</span></a></span><span> </span><span class="annot"><span class="annottext">HsThingRn
</span><a href="#local-6989586621683097564"><span class="hs-identifier hs-var">o</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">SrcSpanAnnA -&gt; SrcSpan
forall a. HasLoc a =&gt; a -&gt; SrcSpan
</span><a href="GHC.Parser.Annotation.html#locA"><span class="hs-identifier hs-var">locA</span></a></span><span> </span><span class="annot"><span class="annottext">SrcSpanAnnA
</span><a href="#local-6989586621683097574"><span class="hs-identifier hs-var">loc</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">SrcSpanAnnA -&gt; SrcSpan
forall a. HasLoc a =&gt; a -&gt; SrcSpan
</span><a href="GHC.Parser.Annotation.html#locA"><span class="hs-identifier hs-var">locA</span></a></span><span> </span><span class="annot"><span class="annottext">SrcSpanAnnA
</span><a href="#local-6989586621683097574"><span class="hs-identifier hs-var">loc</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>          </span><span class="hs-comment">-- to be originating from a failable pattern</span><span>
</span><span id="line-343"></span><span>                                                            </span><span class="hs-comment">-- See Part 1. Wrinkle 2. of</span><span>
</span><span id="line-344"></span><span>               </span><span class="hs-special">(</span><span class="annot"><span class="annottext">EWrap -&gt; HsExprArg 'TcpRn
forall (p :: TcPass). EWrap -&gt; HsExprArg p
</span><a href="GHC.Tc.Gen.Head.html#EWrap"><span class="hs-identifier hs-var">EWrap</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">HsThingRn -&gt; EWrap
</span><a href="GHC.Tc.Gen.Head.html#EExpand"><span class="hs-identifier hs-var">EExpand</span></a></span><span> </span><span class="annot"><span class="annottext">HsThingRn
</span><a href="#local-6989586621683097564"><span class="hs-identifier hs-var">o</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">HsExprArg 'TcpRn -&gt; [HsExprArg 'TcpRn] -&gt; [HsExprArg 'TcpRn]
forall a. a -&gt; [a] -&gt; [a]
</span><span class="hs-glyph hs-var">:</span></span><span> </span><span class="annot"><span class="annottext">[HsExprArg 'TcpRn]
</span><a href="#local-6989586621683097567"><span class="hs-identifier hs-var">args</span></a></span><span class="hs-special">)</span><span>                   </span><span class="hs-comment">-- Note [Expanding HsDo with XXExprGhcRn]</span><span>
</span><span id="line-345"></span><span>                                                            </span><span class="hs-comment">-- in `GHC.Tc.Gen.Do`</span><span>
</span><span id="line-346"></span><span>
</span><span id="line-347"></span><span>      </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">otherwise</span></span><span>
</span><span id="line-348"></span><span>      </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">HsExpr (GhcPass 'Renamed)
-&gt; AppCtxt
-&gt; [HsExprArg 'TcpRn]
-&gt; TcM ((HsExpr (GhcPass 'Renamed), AppCtxt), [HsExprArg 'TcpRn])
</span><a href="#local-6989586621683097503"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="annot"><span class="annottext">HsExpr (GhcPass 'Renamed)
</span><a href="#local-6989586621683097565"><span class="hs-identifier hs-var">e</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">HsThingRn -&gt; SrcSpan -&gt; SrcSpan -&gt; AppCtxt
</span><a href="GHC.Tc.Gen.Head.html#VAExpansion"><span class="hs-identifier hs-var">VAExpansion</span></a></span><span> </span><span class="annot"><span class="annottext">HsThingRn
</span><a href="#local-6989586621683097564"><span class="hs-identifier hs-var">o</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">AppCtxt -&gt; SrcSpan
</span><a href="GHC.Tc.Gen.Head.html#appCtxtLoc"><span class="hs-identifier hs-var">appCtxtLoc</span></a></span><span> </span><span class="annot"><span class="annottext">AppCtxt
</span><a href="#local-6989586621683097566"><span class="hs-identifier hs-var">ctxt</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">AppCtxt -&gt; SrcSpan
</span><a href="GHC.Tc.Gen.Head.html#appCtxtLoc"><span class="hs-identifier hs-var">appCtxtLoc</span></a></span><span> </span><span class="annot"><span class="annottext">AppCtxt
</span><a href="#local-6989586621683097566"><span class="hs-identifier hs-var">ctxt</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-349"></span><span>               </span><span class="hs-special">(</span><span class="annot"><span class="annottext">EWrap -&gt; HsExprArg 'TcpRn
forall (p :: TcPass). EWrap -&gt; HsExprArg p
</span><a href="GHC.Tc.Gen.Head.html#EWrap"><span class="hs-identifier hs-var">EWrap</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">HsThingRn -&gt; EWrap
</span><a href="GHC.Tc.Gen.Head.html#EExpand"><span class="hs-identifier hs-var">EExpand</span></a></span><span> </span><span class="annot"><span class="annottext">HsThingRn
</span><a href="#local-6989586621683097564"><span class="hs-identifier hs-var">o</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">HsExprArg 'TcpRn -&gt; [HsExprArg 'TcpRn] -&gt; [HsExprArg 'TcpRn]
forall a. a -&gt; [a] -&gt; [a]
</span><span class="hs-glyph hs-var">:</span></span><span> </span><span class="annot"><span class="annottext">[HsExprArg 'TcpRn]
</span><a href="#local-6989586621683097567"><span class="hs-identifier hs-var">args</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-350"></span><span>
</span><span id="line-351"></span><span>    </span><span class="hs-comment">-- See Note [Desugar OpApp in the typechecker]</span><span>
</span><span id="line-352"></span><span>    </span><span class="annot"><a href="#local-6989586621683097503"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span id="local-6989586621683097576"><span class="annot"><span class="annottext">e :: HsExpr (GhcPass 'Renamed)
</span><a href="#local-6989586621683097576"><span class="hs-identifier hs-var">e</span></a></span></span><span class="hs-glyph">@</span><span class="hs-special">(</span><span class="annot"><a href="Language.Haskell.Syntax.Expr.html#OpApp"><span class="hs-identifier hs-type">OpApp</span></a></span><span> </span><span class="annot"><span class="annottext">XOpApp (GhcPass 'Renamed)
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621683097578"><span class="annot"><span class="annottext">LHsExpr (GhcPass 'Renamed)
</span><a href="#local-6989586621683097578"><span class="hs-identifier hs-var">arg1</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Types.SrcLoc.html#L"><span class="hs-identifier hs-type">L</span></a></span><span> </span><span id="local-6989586621683097579"><span class="annot"><span class="annottext">SrcSpanAnnA
</span><a href="#local-6989586621683097579"><span class="hs-identifier hs-var">l</span></a></span></span><span> </span><span id="local-6989586621683097580"><span class="annot"><span class="annottext">HsExpr (GhcPass 'Renamed)
</span><a href="#local-6989586621683097580"><span class="hs-identifier hs-var">op</span></a></span></span><span class="hs-special">)</span><span> </span><span id="local-6989586621683097581"><span class="annot"><span class="annottext">LHsExpr (GhcPass 'Renamed)
</span><a href="#local-6989586621683097581"><span class="hs-identifier hs-var">arg2</span></a></span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">AppCtxt
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621683097582"><span class="annot"><span class="annottext">[HsExprArg 'TcpRn]
</span><a href="#local-6989586621683097582"><span class="hs-identifier hs-var">args</span></a></span></span><span>
</span><span id="line-353"></span><span>      </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">((HsExpr (GhcPass 'Renamed), AppCtxt), [HsExprArg 'TcpRn])
-&gt; TcM ((HsExpr (GhcPass 'Renamed), AppCtxt), [HsExprArg 'TcpRn])
forall a. a -&gt; IOEnv (Env TcGblEnv TcLclEnv) a
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">pure</span></span><span> </span><span class="hs-special">(</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">HsExpr (GhcPass 'Renamed)
</span><a href="#local-6989586621683097580"><span class="hs-identifier hs-var">op</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">HsExpr (GhcPass 'Renamed) -&gt; ThLevel -&gt; SrcSpan -&gt; AppCtxt
</span><a href="GHC.Tc.Gen.Head.html#VACall"><span class="hs-identifier hs-var">VACall</span></a></span><span> </span><span class="annot"><span class="annottext">HsExpr (GhcPass 'Renamed)
</span><a href="#local-6989586621683097580"><span class="hs-identifier hs-var">op</span></a></span><span> </span><span class="annot"><span class="annottext">ThLevel
</span><span class="hs-number">0</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">SrcSpanAnnA -&gt; SrcSpan
forall a. HasLoc a =&gt; a -&gt; SrcSpan
</span><a href="GHC.Parser.Annotation.html#locA"><span class="hs-identifier hs-var">locA</span></a></span><span> </span><span class="annot"><span class="annottext">SrcSpanAnnA
</span><a href="#local-6989586621683097579"><span class="hs-identifier hs-var">l</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-354"></span><span>             </span><span class="hs-special">,</span><span>   </span><span class="annot"><span class="annottext">AppCtxt -&gt; LHsExpr (GhcPass 'Renamed) -&gt; HsExprArg 'TcpRn
</span><a href="GHC.Tc.Gen.Head.html#mkEValArg"><span class="hs-identifier hs-var">mkEValArg</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">HsExpr (GhcPass 'Renamed) -&gt; ThLevel -&gt; SrcSpan -&gt; AppCtxt
</span><a href="GHC.Tc.Gen.Head.html#VACall"><span class="hs-identifier hs-var">VACall</span></a></span><span> </span><span class="annot"><span class="annottext">HsExpr (GhcPass 'Renamed)
</span><a href="#local-6989586621683097580"><span class="hs-identifier hs-var">op</span></a></span><span> </span><span class="annot"><span class="annottext">ThLevel
</span><span class="hs-number">1</span></span><span> </span><span class="annot"><span class="annottext">SrcSpan
</span><a href="GHC.Types.SrcLoc.html#generatedSrcSpan"><span class="hs-identifier hs-var">generatedSrcSpan</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">LHsExpr (GhcPass 'Renamed)
</span><a href="#local-6989586621683097578"><span class="hs-identifier hs-var">arg1</span></a></span><span>
</span><span id="line-355"></span><span>               </span><span class="annot"><span class="annottext">HsExprArg 'TcpRn -&gt; [HsExprArg 'TcpRn] -&gt; [HsExprArg 'TcpRn]
forall a. a -&gt; [a] -&gt; [a]
</span><span class="hs-glyph hs-var">:</span></span><span> </span><span class="annot"><span class="annottext">AppCtxt -&gt; LHsExpr (GhcPass 'Renamed) -&gt; HsExprArg 'TcpRn
</span><a href="GHC.Tc.Gen.Head.html#mkEValArg"><span class="hs-identifier hs-var">mkEValArg</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">HsExpr (GhcPass 'Renamed) -&gt; ThLevel -&gt; SrcSpan -&gt; AppCtxt
</span><a href="GHC.Tc.Gen.Head.html#VACall"><span class="hs-identifier hs-var">VACall</span></a></span><span> </span><span class="annot"><span class="annottext">HsExpr (GhcPass 'Renamed)
</span><a href="#local-6989586621683097580"><span class="hs-identifier hs-var">op</span></a></span><span> </span><span class="annot"><span class="annottext">ThLevel
</span><span class="hs-number">2</span></span><span> </span><span class="annot"><span class="annottext">SrcSpan
</span><a href="GHC.Types.SrcLoc.html#generatedSrcSpan"><span class="hs-identifier hs-var">generatedSrcSpan</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">LHsExpr (GhcPass 'Renamed)
</span><a href="#local-6989586621683097581"><span class="hs-identifier hs-var">arg2</span></a></span><span>
</span><span id="line-356"></span><span>                    </span><span class="hs-comment">-- generatedSrcSpan because this the span of the call,</span><span>
</span><span id="line-357"></span><span>                    </span><span class="hs-comment">-- and its hard to say exactly what that is</span><span>
</span><span id="line-358"></span><span>               </span><span class="annot"><span class="annottext">HsExprArg 'TcpRn -&gt; [HsExprArg 'TcpRn] -&gt; [HsExprArg 'TcpRn]
forall a. a -&gt; [a] -&gt; [a]
</span><span class="hs-glyph hs-var">:</span></span><span> </span><span class="annot"><span class="annottext">EWrap -&gt; HsExprArg 'TcpRn
forall (p :: TcPass). EWrap -&gt; HsExprArg p
</span><a href="GHC.Tc.Gen.Head.html#EWrap"><span class="hs-identifier hs-var">EWrap</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">HsThingRn -&gt; EWrap
</span><a href="GHC.Tc.Gen.Head.html#EExpand"><span class="hs-identifier hs-var">EExpand</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">HsExpr (GhcPass 'Renamed) -&gt; HsThingRn
</span><a href="GHC.Hs.Expr.html#OrigExpr"><span class="hs-identifier hs-var">OrigExpr</span></a></span><span> </span><span class="annot"><span class="annottext">HsExpr (GhcPass 'Renamed)
</span><a href="#local-6989586621683097576"><span class="hs-identifier hs-var">e</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-359"></span><span>               </span><span class="annot"><span class="annottext">HsExprArg 'TcpRn -&gt; [HsExprArg 'TcpRn] -&gt; [HsExprArg 'TcpRn]
forall a. a -&gt; [a] -&gt; [a]
</span><span class="hs-glyph hs-var">:</span></span><span> </span><span class="annot"><span class="annottext">[HsExprArg 'TcpRn]
</span><a href="#local-6989586621683097582"><span class="hs-identifier hs-var">args</span></a></span><span> </span><span class="hs-special">)</span><span>
</span><span id="line-360"></span><span>
</span><span id="line-361"></span><span>    </span><span class="annot"><a href="#local-6989586621683097503"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span id="local-6989586621683097583"><span class="annot"><span class="annottext">HsExpr (GhcPass 'Renamed)
</span><a href="#local-6989586621683097583"><span class="hs-identifier hs-var">e</span></a></span></span><span> </span><span id="local-6989586621683097584"><span class="annot"><span class="annottext">AppCtxt
</span><a href="#local-6989586621683097584"><span class="hs-identifier hs-var">ctxt</span></a></span></span><span> </span><span id="local-6989586621683097585"><span class="annot"><span class="annottext">[HsExprArg 'TcpRn]
</span><a href="#local-6989586621683097585"><span class="hs-identifier hs-var">args</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">((HsExpr (GhcPass 'Renamed), AppCtxt), [HsExprArg 'TcpRn])
-&gt; TcM ((HsExpr (GhcPass 'Renamed), AppCtxt), [HsExprArg 'TcpRn])
forall a. a -&gt; IOEnv (Env TcGblEnv TcLclEnv) a
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">pure</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">(</span><span class="annot"><span class="annottext">HsExpr (GhcPass 'Renamed)
</span><a href="#local-6989586621683097583"><span class="hs-identifier hs-var">e</span></a></span><span class="hs-special">,</span><span class="annot"><span class="annottext">AppCtxt
</span><a href="#local-6989586621683097584"><span class="hs-identifier hs-var">ctxt</span></a></span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">[HsExprArg 'TcpRn]
</span><a href="#local-6989586621683097585"><span class="hs-identifier hs-var">args</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-362"></span><span>
</span><span id="line-363"></span><span>    </span><span id="local-6989586621683096951"><span class="annot"><a href="#local-6989586621683097535"><span class="hs-identifier hs-type">set</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Parser.Annotation.html#EpAnn"><span class="hs-identifier hs-type">EpAnn</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683096951"><span class="hs-identifier hs-type">ann</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Gen.Head.html#AppCtxt"><span class="hs-identifier hs-type">AppCtxt</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Gen.Head.html#AppCtxt"><span class="hs-identifier hs-type">AppCtxt</span></a></span></span><span>
</span><span id="line-364"></span><span>    </span><span id="local-6989586621683097535"><span class="annot"><span class="annottext">set :: forall ann. EpAnn ann -&gt; AppCtxt -&gt; AppCtxt
</span><a href="#local-6989586621683097535"><span class="hs-identifier hs-var hs-var">set</span></a></span></span><span> </span><span id="local-6989586621683097588"><span class="annot"><span class="annottext">EpAnn ann
</span><a href="#local-6989586621683097588"><span class="hs-identifier hs-var">l</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Tc.Gen.Head.html#VACall"><span class="hs-identifier hs-type">VACall</span></a></span><span> </span><span id="local-6989586621683097589"><span class="annot"><span class="annottext">HsExpr (GhcPass 'Renamed)
</span><a href="#local-6989586621683097589"><span class="hs-identifier hs-var">f</span></a></span></span><span> </span><span id="local-6989586621683097590"><span class="annot"><span class="annottext">ThLevel
</span><a href="#local-6989586621683097590"><span class="hs-identifier hs-var">n</span></a></span></span><span> </span><span class="annot"><span class="annottext">SrcSpan
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span>          </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">HsExpr (GhcPass 'Renamed) -&gt; ThLevel -&gt; SrcSpan -&gt; AppCtxt
</span><a href="GHC.Tc.Gen.Head.html#VACall"><span class="hs-identifier hs-var">VACall</span></a></span><span> </span><span class="annot"><span class="annottext">HsExpr (GhcPass 'Renamed)
</span><a href="#local-6989586621683097589"><span class="hs-identifier hs-var">f</span></a></span><span> </span><span class="annot"><span class="annottext">ThLevel
</span><a href="#local-6989586621683097590"><span class="hs-identifier hs-var">n</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">EpAnn ann -&gt; SrcSpan
forall a. HasLoc a =&gt; a -&gt; SrcSpan
</span><a href="GHC.Parser.Annotation.html#locA"><span class="hs-identifier hs-var">locA</span></a></span><span> </span><span class="annot"><span class="annottext">EpAnn ann
</span><a href="#local-6989586621683097588"><span class="hs-identifier hs-var">l</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-365"></span><span>    </span><span class="annot"><a href="#local-6989586621683097535"><span class="hs-identifier hs-var">set</span></a></span><span> </span><span id="local-6989586621683097591"><span class="annot"><span class="annottext">EpAnn ann
</span><a href="#local-6989586621683097591"><span class="hs-identifier hs-var">l</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Tc.Gen.Head.html#VAExpansion"><span class="hs-identifier hs-type">VAExpansion</span></a></span><span> </span><span id="local-6989586621683097592"><span class="annot"><span class="annottext">HsThingRn
</span><a href="#local-6989586621683097592"><span class="hs-identifier hs-var">orig</span></a></span></span><span> </span><span id="local-6989586621683097593"><span class="annot"><span class="annottext">SrcSpan
</span><a href="#local-6989586621683097593"><span class="hs-identifier hs-var">ol</span></a></span></span><span> </span><span class="annot"><span class="annottext">SrcSpan
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">HsThingRn -&gt; SrcSpan -&gt; SrcSpan -&gt; AppCtxt
</span><a href="GHC.Tc.Gen.Head.html#VAExpansion"><span class="hs-identifier hs-var">VAExpansion</span></a></span><span> </span><span class="annot"><span class="annottext">HsThingRn
</span><a href="#local-6989586621683097592"><span class="hs-identifier hs-var">orig</span></a></span><span> </span><span class="annot"><span class="annottext">SrcSpan
</span><a href="#local-6989586621683097593"><span class="hs-identifier hs-var">ol</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">EpAnn ann -&gt; SrcSpan
forall a. HasLoc a =&gt; a -&gt; SrcSpan
</span><a href="GHC.Parser.Annotation.html#locA"><span class="hs-identifier hs-var">locA</span></a></span><span> </span><span class="annot"><span class="annottext">EpAnn ann
</span><a href="#local-6989586621683097591"><span class="hs-identifier hs-var">l</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-366"></span><span>
</span><span id="line-367"></span><span>    </span><span id="local-6989586621683097594"><span class="annot"><a href="#local-6989586621683097546"><span class="hs-identifier hs-type">dec</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Parser.Annotation.html#EpAnn"><span class="hs-identifier hs-type">EpAnn</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683097594"><span class="hs-identifier hs-type">ann</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Gen.Head.html#AppCtxt"><span class="hs-identifier hs-type">AppCtxt</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Gen.Head.html#AppCtxt"><span class="hs-identifier hs-type">AppCtxt</span></a></span></span><span>
</span><span id="line-368"></span><span>    </span><span id="local-6989586621683097546"><span class="annot"><span class="annottext">dec :: forall ann. EpAnn ann -&gt; AppCtxt -&gt; AppCtxt
</span><a href="#local-6989586621683097546"><span class="hs-identifier hs-var hs-var">dec</span></a></span></span><span> </span><span id="local-6989586621683097599"><span class="annot"><span class="annottext">EpAnn ann
</span><a href="#local-6989586621683097599"><span class="hs-identifier hs-var">l</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Tc.Gen.Head.html#VACall"><span class="hs-identifier hs-type">VACall</span></a></span><span> </span><span id="local-6989586621683097600"><span class="annot"><span class="annottext">HsExpr (GhcPass 'Renamed)
</span><a href="#local-6989586621683097600"><span class="hs-identifier hs-var">f</span></a></span></span><span> </span><span id="local-6989586621683097601"><span class="annot"><span class="annottext">ThLevel
</span><a href="#local-6989586621683097601"><span class="hs-identifier hs-var">n</span></a></span></span><span> </span><span class="annot"><span class="annottext">SrcSpan
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span>          </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">HsExpr (GhcPass 'Renamed) -&gt; ThLevel -&gt; SrcSpan -&gt; AppCtxt
</span><a href="GHC.Tc.Gen.Head.html#VACall"><span class="hs-identifier hs-var">VACall</span></a></span><span> </span><span class="annot"><span class="annottext">HsExpr (GhcPass 'Renamed)
</span><a href="#local-6989586621683097600"><span class="hs-identifier hs-var">f</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ThLevel
</span><a href="#local-6989586621683097601"><span class="hs-identifier hs-var">n</span></a></span><span class="annot"><span class="annottext">ThLevel -&gt; ThLevel -&gt; ThLevel
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-glyph hs-var">-</span></span><span class="annot"><span class="annottext">ThLevel
</span><span class="hs-number">1</span></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">EpAnn ann -&gt; SrcSpan
forall a. HasLoc a =&gt; a -&gt; SrcSpan
</span><a href="GHC.Parser.Annotation.html#locA"><span class="hs-identifier hs-var">locA</span></a></span><span> </span><span class="annot"><span class="annottext">EpAnn ann
</span><a href="#local-6989586621683097599"><span class="hs-identifier hs-var">l</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-369"></span><span>    </span><span class="annot"><a href="#local-6989586621683097546"><span class="hs-identifier hs-var">dec</span></a></span><span> </span><span id="local-6989586621683097602"><span class="annot"><span class="annottext">EpAnn ann
</span><a href="#local-6989586621683097602"><span class="hs-identifier hs-var">l</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Tc.Gen.Head.html#VAExpansion"><span class="hs-identifier hs-type">VAExpansion</span></a></span><span> </span><span id="local-6989586621683097603"><span class="annot"><span class="annottext">HsThingRn
</span><a href="#local-6989586621683097603"><span class="hs-identifier hs-var">orig</span></a></span></span><span> </span><span id="local-6989586621683097604"><span class="annot"><span class="annottext">SrcSpan
</span><a href="#local-6989586621683097604"><span class="hs-identifier hs-var">ol</span></a></span></span><span> </span><span class="annot"><span class="annottext">SrcSpan
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">HsThingRn -&gt; SrcSpan -&gt; SrcSpan -&gt; AppCtxt
</span><a href="GHC.Tc.Gen.Head.html#VAExpansion"><span class="hs-identifier hs-var">VAExpansion</span></a></span><span> </span><span class="annot"><span class="annottext">HsThingRn
</span><a href="#local-6989586621683097603"><span class="hs-identifier hs-var">orig</span></a></span><span> </span><span class="annot"><span class="annottext">SrcSpan
</span><a href="#local-6989586621683097604"><span class="hs-identifier hs-var">ol</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">EpAnn ann -&gt; SrcSpan
forall a. HasLoc a =&gt; a -&gt; SrcSpan
</span><a href="GHC.Parser.Annotation.html#locA"><span class="hs-identifier hs-var">locA</span></a></span><span> </span><span class="annot"><span class="annottext">EpAnn ann
</span><a href="#local-6989586621683097602"><span class="hs-identifier hs-var">l</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-370"></span><span>
</span><span id="line-371"></span><span class="hs-comment">-- | Rebuild an application: takes a type-checked application head</span><span>
</span><span id="line-372"></span><span class="hs-comment">-- expression together with arguments in the form of typechecked 'HsExprArg's</span><span>
</span><span id="line-373"></span><span class="hs-comment">-- and returns a typechecked application of the head to the arguments.</span><span>
</span><span id="line-374"></span><span class="hs-comment">--</span><span>
</span><span id="line-375"></span><span class="hs-comment">-- This performs a representation-polymorphism check to ensure that</span><span>
</span><span id="line-376"></span><span class="hs-comment">-- representation-polymorphic unlifted newtypes have been eta-expanded.</span><span>
</span><span id="line-377"></span><span class="hs-comment">--</span><span>
</span><span id="line-378"></span><span class="hs-comment">-- See Note [Eta-expanding rep-poly unlifted newtypes].</span><span>
</span><span id="line-379"></span><span class="annot"><a href="GHC.Tc.Gen.Head.html#rebuildHsApps"><span class="hs-identifier hs-type">rebuildHsApps</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Language.Haskell.Syntax.Expr.html#HsExpr"><span class="hs-identifier hs-type">HsExpr</span></a></span><span> </span><span class="annot"><a href="GHC.Hs.Extension.html#GhcTc"><span class="hs-identifier hs-type">GhcTc</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Tc.Gen.Head.html#AppCtxt"><span class="hs-identifier hs-type">AppCtxt</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-380"></span><span>                      </span><span class="annot"><span class="hs-comment">-- ^ the function being applied</span></span><span>
</span><span id="line-381"></span><span>              </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="GHC.Tc.Gen.Head.html#HsExprArg"><span class="hs-identifier hs-type">HsExprArg</span></a></span><span> </span><span class="hs-special">'</span><span class="annot"><a href="GHC.Tc.Gen.Head.html#TcpTc"><span class="hs-identifier hs-type">TcpTc</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-382"></span><span>                      </span><span class="annot"><span class="hs-comment">-- ^ the arguments to the function</span></span><span>
</span><span id="line-383"></span><span>              </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Language.Haskell.Syntax.Expr.html#HsExpr"><span class="hs-identifier hs-type">HsExpr</span></a></span><span> </span><span class="annot"><a href="GHC.Hs.Extension.html#GhcTc"><span class="hs-identifier hs-type">GhcTc</span></a></span><span>
</span><span id="line-384"></span><span id="rebuildHsApps"><span class="annot"><span class="annottext">rebuildHsApps :: (HsExpr GhcTc, AppCtxt) -&gt; [HsExprArg 'TcpTc] -&gt; HsExpr GhcTc
</span><a href="GHC.Tc.Gen.Head.html#rebuildHsApps"><span class="hs-identifier hs-var hs-var">rebuildHsApps</span></a></span></span><span> </span><span class="hs-special">(</span><span id="local-6989586621683097605"><span class="annot"><span class="annottext">HsExpr GhcTc
</span><a href="#local-6989586621683097605"><span class="hs-identifier hs-var">fun</span></a></span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">AppCtxt
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">HsExpr GhcTc
</span><a href="#local-6989586621683097605"><span class="hs-identifier hs-var">fun</span></a></span><span>
</span><span id="line-385"></span><span class="annot"><a href="GHC.Tc.Gen.Head.html#rebuildHsApps"><span class="hs-identifier hs-var">rebuildHsApps</span></a></span><span> </span><span class="hs-special">(</span><span id="local-6989586621683097606"><span class="annot"><span class="annottext">HsExpr GhcTc
</span><a href="#local-6989586621683097606"><span class="hs-identifier hs-var">fun</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621683097607"><span class="annot"><span class="annottext">AppCtxt
</span><a href="#local-6989586621683097607"><span class="hs-identifier hs-var">ctxt</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span id="local-6989586621683097608"><span class="annot"><span class="annottext">HsExprArg 'TcpTc
</span><a href="#local-6989586621683097608"><span class="hs-identifier hs-var">arg</span></a></span></span><span> </span><span class="annot"><span class="hs-glyph hs-type">:</span></span><span> </span><span id="local-6989586621683097609"><span class="annot"><span class="annottext">[HsExprArg 'TcpTc]
</span><a href="#local-6989586621683097609"><span class="hs-identifier hs-var">args</span></a></span></span><span class="hs-special">)</span><span>
</span><span id="line-386"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">HsExprArg 'TcpTc
</span><a href="#local-6989586621683097608"><span class="hs-identifier hs-var">arg</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-387"></span><span>      </span><span class="annot"><a href="GHC.Tc.Gen.Head.html#EValArg"><span class="hs-identifier hs-type">EValArg</span></a></span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">ea_arg :: forall (p :: TcPass). HsExprArg p -&gt; LHsExpr (GhcPass (XPass p))
</span><a href="GHC.Tc.Gen.Head.html#ea_arg"><span class="hs-identifier hs-var">ea_arg</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="local-6989586621683097610"><span class="annot"><span class="annottext">LHsExpr (GhcPass (XPass 'TcpTc))
</span><a href="#local-6989586621683097610"><span class="hs-identifier hs-var">arg</span></a></span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">ea_ctxt :: forall (p :: TcPass). HsExprArg p -&gt; AppCtxt
</span><a href="GHC.Tc.Gen.Head.html#ea_ctxt"><span class="hs-identifier hs-var">ea_ctxt</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="local-6989586621683097611"><span class="annot"><span class="annottext">AppCtxt
</span><a href="#local-6989586621683097611"><span class="hs-identifier hs-var">ctxt'</span></a></span></span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-388"></span><span>        </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">(HsExpr GhcTc, AppCtxt) -&gt; [HsExprArg 'TcpTc] -&gt; HsExpr GhcTc
</span><a href="GHC.Tc.Gen.Head.html#rebuildHsApps"><span class="hs-identifier hs-var">rebuildHsApps</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">XApp GhcTc -&gt; LHsExpr GhcTc -&gt; LHsExpr GhcTc -&gt; HsExpr GhcTc
forall p. XApp p -&gt; LHsExpr p -&gt; LHsExpr p -&gt; HsExpr p
</span><a href="Language.Haskell.Syntax.Expr.html#HsApp"><span class="hs-identifier hs-var">HsApp</span></a></span><span> </span><span class="annot"><span class="annottext">XApp GhcTc
NoExtField
</span><a href="Language.Haskell.Syntax.Extension.html#noExtField"><span class="hs-identifier hs-var">noExtField</span></a></span><span> </span><span class="annot"><span class="annottext">LHsExpr GhcTc
GenLocated SrcSpanAnnA (HsExpr GhcTc)
</span><a href="#local-6989586621683097612"><span class="hs-identifier hs-var">lfun</span></a></span><span> </span><span class="annot"><span class="annottext">LHsExpr GhcTc
LHsExpr (GhcPass (XPass 'TcpTc))
</span><a href="#local-6989586621683097610"><span class="hs-identifier hs-var">arg</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">AppCtxt
</span><a href="#local-6989586621683097611"><span class="hs-identifier hs-var">ctxt'</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[HsExprArg 'TcpTc]
</span><a href="#local-6989586621683097609"><span class="hs-identifier hs-var">args</span></a></span><span>
</span><span id="line-389"></span><span>      </span><span class="annot"><a href="GHC.Tc.Gen.Head.html#ETypeArg"><span class="hs-identifier hs-type">ETypeArg</span></a></span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">ea_hs_ty :: forall (p :: TcPass). HsExprArg p -&gt; LHsWcType (GhcPass 'Renamed)
</span><a href="GHC.Tc.Gen.Head.html#ea_hs_ty"><span class="hs-identifier hs-var">ea_hs_ty</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="local-6989586621683097613"><span class="annot"><span class="annottext">LHsWcType (GhcPass 'Renamed)
</span><a href="#local-6989586621683097613"><span class="hs-identifier hs-var">hs_ty</span></a></span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">ea_ty_arg :: forall (p :: TcPass). HsExprArg p -&gt; XETAType p
</span><a href="GHC.Tc.Gen.Head.html#ea_ty_arg"><span class="hs-identifier hs-var">ea_ty_arg</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="local-6989586621683097614"><span class="annot"><span class="annottext">XETAType 'TcpTc
</span><a href="#local-6989586621683097614"><span class="hs-identifier hs-var">ty</span></a></span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">ea_ctxt :: forall (p :: TcPass). HsExprArg p -&gt; AppCtxt
</span><a href="GHC.Tc.Gen.Head.html#ea_ctxt"><span class="hs-identifier hs-var">ea_ctxt</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="local-6989586621683097615"><span class="annot"><span class="annottext">AppCtxt
</span><a href="#local-6989586621683097615"><span class="hs-identifier hs-var">ctxt'</span></a></span></span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-390"></span><span>        </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">(HsExpr GhcTc, AppCtxt) -&gt; [HsExprArg 'TcpTc] -&gt; HsExpr GhcTc
</span><a href="GHC.Tc.Gen.Head.html#rebuildHsApps"><span class="hs-identifier hs-var">rebuildHsApps</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">XAppTypeE GhcTc
-&gt; LHsExpr GhcTc -&gt; LHsWcType (NoGhcTc GhcTc) -&gt; HsExpr GhcTc
forall p.
XAppTypeE p -&gt; LHsExpr p -&gt; LHsWcType (NoGhcTc p) -&gt; HsExpr p
</span><a href="Language.Haskell.Syntax.Expr.html#HsAppType"><span class="hs-identifier hs-var">HsAppType</span></a></span><span> </span><span class="annot"><span class="annottext">XAppTypeE GhcTc
XETAType 'TcpTc
</span><a href="#local-6989586621683097614"><span class="hs-identifier hs-var">ty</span></a></span><span> </span><span class="annot"><span class="annottext">LHsExpr GhcTc
GenLocated SrcSpanAnnA (HsExpr GhcTc)
</span><a href="#local-6989586621683097612"><span class="hs-identifier hs-var">lfun</span></a></span><span> </span><span class="annot"><span class="annottext">LHsWcType (NoGhcTc GhcTc)
LHsWcType (GhcPass 'Renamed)
</span><a href="#local-6989586621683097613"><span class="hs-identifier hs-var">hs_ty</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">AppCtxt
</span><a href="#local-6989586621683097615"><span class="hs-identifier hs-var">ctxt'</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[HsExprArg 'TcpTc]
</span><a href="#local-6989586621683097609"><span class="hs-identifier hs-var">args</span></a></span><span>
</span><span id="line-391"></span><span>      </span><span class="annot"><a href="GHC.Tc.Gen.Head.html#EPrag"><span class="hs-identifier hs-type">EPrag</span></a></span><span> </span><span id="local-6989586621683097616"><span class="annot"><span class="annottext">AppCtxt
</span><a href="#local-6989586621683097616"><span class="hs-identifier hs-var">ctxt'</span></a></span></span><span> </span><span id="local-6989586621683097617"><span class="annot"><span class="annottext">HsPragE (GhcPass (XPass 'TcpTc))
</span><a href="#local-6989586621683097617"><span class="hs-identifier hs-var">p</span></a></span></span><span>
</span><span id="line-392"></span><span>        </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">(HsExpr GhcTc, AppCtxt) -&gt; [HsExprArg 'TcpTc] -&gt; HsExpr GhcTc
</span><a href="GHC.Tc.Gen.Head.html#rebuildHsApps"><span class="hs-identifier hs-var">rebuildHsApps</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">XPragE GhcTc -&gt; HsPragE GhcTc -&gt; LHsExpr GhcTc -&gt; HsExpr GhcTc
forall p. XPragE p -&gt; HsPragE p -&gt; LHsExpr p -&gt; HsExpr p
</span><a href="Language.Haskell.Syntax.Expr.html#HsPragE"><span class="hs-identifier hs-var">HsPragE</span></a></span><span> </span><span class="annot"><span class="annottext">XPragE GhcTc
NoExtField
</span><a href="Language.Haskell.Syntax.Extension.html#noExtField"><span class="hs-identifier hs-var">noExtField</span></a></span><span> </span><span class="annot"><span class="annottext">HsPragE GhcTc
HsPragE (GhcPass (XPass 'TcpTc))
</span><a href="#local-6989586621683097617"><span class="hs-identifier hs-var">p</span></a></span><span> </span><span class="annot"><span class="annottext">LHsExpr GhcTc
GenLocated SrcSpanAnnA (HsExpr GhcTc)
</span><a href="#local-6989586621683097612"><span class="hs-identifier hs-var">lfun</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">AppCtxt
</span><a href="#local-6989586621683097616"><span class="hs-identifier hs-var">ctxt'</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[HsExprArg 'TcpTc]
</span><a href="#local-6989586621683097609"><span class="hs-identifier hs-var">args</span></a></span><span>
</span><span id="line-393"></span><span>      </span><span class="annot"><a href="GHC.Tc.Gen.Head.html#EWrap"><span class="hs-identifier hs-type">EWrap</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Tc.Gen.Head.html#EPar"><span class="hs-identifier hs-type">EPar</span></a></span><span> </span><span id="local-6989586621683097618"><span class="annot"><span class="annottext">AppCtxt
</span><a href="#local-6989586621683097618"><span class="hs-identifier hs-var">ctxt'</span></a></span></span><span class="hs-special">)</span><span>
</span><span id="line-394"></span><span>        </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">(HsExpr GhcTc, AppCtxt) -&gt; [HsExprArg 'TcpTc] -&gt; HsExpr GhcTc
</span><a href="GHC.Tc.Gen.Head.html#rebuildHsApps"><span class="hs-identifier hs-var">rebuildHsApps</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">LHsExpr GhcTc -&gt; HsExpr GhcTc
forall (p :: Pass).
IsPass p =&gt;
LHsExpr (GhcPass p) -&gt; HsExpr (GhcPass p)
</span><a href="GHC.Hs.Expr.html#gHsPar"><span class="hs-identifier hs-var">gHsPar</span></a></span><span> </span><span class="annot"><span class="annottext">LHsExpr GhcTc
GenLocated SrcSpanAnnA (HsExpr GhcTc)
</span><a href="#local-6989586621683097612"><span class="hs-identifier hs-var">lfun</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">AppCtxt
</span><a href="#local-6989586621683097618"><span class="hs-identifier hs-var">ctxt'</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[HsExprArg 'TcpTc]
</span><a href="#local-6989586621683097609"><span class="hs-identifier hs-var">args</span></a></span><span>
</span><span id="line-395"></span><span>      </span><span class="annot"><a href="GHC.Tc.Gen.Head.html#EWrap"><span class="hs-identifier hs-type">EWrap</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Tc.Gen.Head.html#EExpand"><span class="hs-identifier hs-type">EExpand</span></a></span><span> </span><span id="local-6989586621683097620"><span class="annot"><span class="annottext">HsThingRn
</span><a href="#local-6989586621683097620"><span class="hs-identifier hs-var">orig</span></a></span></span><span class="hs-special">)</span><span>
</span><span id="line-396"></span><span>        </span><span class="hs-glyph">|</span><span> </span><span class="annot"><a href="GHC.Hs.Expr.html#OrigExpr"><span class="hs-identifier hs-type">OrigExpr</span></a></span><span> </span><span id="local-6989586621683097621"><span class="annot"><span class="annottext">HsExpr (GhcPass 'Renamed)
</span><a href="#local-6989586621683097621"><span class="hs-identifier hs-var">oe</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">HsThingRn
</span><a href="#local-6989586621683097620"><span class="hs-identifier hs-var">orig</span></a></span><span>
</span><span id="line-397"></span><span>        </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">(HsExpr GhcTc, AppCtxt) -&gt; [HsExprArg 'TcpTc] -&gt; HsExpr GhcTc
</span><a href="GHC.Tc.Gen.Head.html#rebuildHsApps"><span class="hs-identifier hs-var">rebuildHsApps</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">HsExpr (GhcPass 'Renamed) -&gt; HsExpr GhcTc -&gt; HsExpr GhcTc
</span><a href="GHC.Hs.Expr.html#mkExpandedExprTc"><span class="hs-identifier hs-var">mkExpandedExprTc</span></a></span><span> </span><span class="annot"><span class="annottext">HsExpr (GhcPass 'Renamed)
</span><a href="#local-6989586621683097621"><span class="hs-identifier hs-var">oe</span></a></span><span> </span><span class="annot"><span class="annottext">HsExpr GhcTc
</span><a href="#local-6989586621683097606"><span class="hs-identifier hs-var">fun</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">AppCtxt
</span><a href="#local-6989586621683097607"><span class="hs-identifier hs-var">ctxt</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[HsExprArg 'TcpTc]
</span><a href="#local-6989586621683097609"><span class="hs-identifier hs-var">args</span></a></span><span>
</span><span id="line-398"></span><span>        </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">otherwise</span></span><span>
</span><span id="line-399"></span><span>        </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">(HsExpr GhcTc, AppCtxt) -&gt; [HsExprArg 'TcpTc] -&gt; HsExpr GhcTc
</span><a href="GHC.Tc.Gen.Head.html#rebuildHsApps"><span class="hs-identifier hs-var">rebuildHsApps</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">HsExpr GhcTc
</span><a href="#local-6989586621683097606"><span class="hs-identifier hs-var">fun</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">AppCtxt
</span><a href="#local-6989586621683097607"><span class="hs-identifier hs-var">ctxt</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[HsExprArg 'TcpTc]
</span><a href="#local-6989586621683097609"><span class="hs-identifier hs-var">args</span></a></span><span>
</span><span id="line-400"></span><span>      </span><span class="annot"><a href="GHC.Tc.Gen.Head.html#EWrap"><span class="hs-identifier hs-type">EWrap</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Tc.Gen.Head.html#EHsWrap"><span class="hs-identifier hs-type">EHsWrap</span></a></span><span> </span><span id="local-6989586621683097623"><span class="annot"><span class="annottext">HsWrapper
</span><a href="#local-6989586621683097623"><span class="hs-identifier hs-var">wrap</span></a></span></span><span class="hs-special">)</span><span>
</span><span id="line-401"></span><span>        </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">(HsExpr GhcTc, AppCtxt) -&gt; [HsExprArg 'TcpTc] -&gt; HsExpr GhcTc
</span><a href="GHC.Tc.Gen.Head.html#rebuildHsApps"><span class="hs-identifier hs-var">rebuildHsApps</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">HsWrapper -&gt; HsExpr GhcTc -&gt; HsExpr GhcTc
</span><a href="GHC.Hs.Utils.html#mkHsWrap"><span class="hs-identifier hs-var">mkHsWrap</span></a></span><span> </span><span class="annot"><span class="annottext">HsWrapper
</span><a href="#local-6989586621683097623"><span class="hs-identifier hs-var">wrap</span></a></span><span> </span><span class="annot"><span class="annottext">HsExpr GhcTc
</span><a href="#local-6989586621683097606"><span class="hs-identifier hs-var">fun</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">AppCtxt
</span><a href="#local-6989586621683097607"><span class="hs-identifier hs-var">ctxt</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[HsExprArg 'TcpTc]
</span><a href="#local-6989586621683097609"><span class="hs-identifier hs-var">args</span></a></span><span>
</span><span id="line-402"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-403"></span><span>    </span><span id="local-6989586621683097612"><span class="annot"><span class="annottext">lfun :: GenLocated SrcSpanAnnA (HsExpr GhcTc)
</span><a href="#local-6989586621683097612"><span class="hs-identifier hs-var hs-var">lfun</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">SrcSpanAnnA
-&gt; HsExpr GhcTc -&gt; GenLocated SrcSpanAnnA (HsExpr GhcTc)
forall l e. l -&gt; e -&gt; GenLocated l e
</span><a href="GHC.Types.SrcLoc.html#L"><span class="hs-identifier hs-var">L</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">SrcSpan -&gt; SrcSpanAnnA
forall e. HasAnnotation e =&gt; SrcSpan -&gt; e
</span><a href="GHC.Parser.Annotation.html#noAnnSrcSpan"><span class="hs-identifier hs-var">noAnnSrcSpan</span></a></span><span> </span><span class="annot"><span class="annottext">(SrcSpan -&gt; SrcSpanAnnA) -&gt; SrcSpan -&gt; SrcSpanAnnA
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">AppCtxt -&gt; SrcSpan
</span><a href="#local-6989586621683097626"><span class="hs-identifier hs-var">appCtxtLoc'</span></a></span><span> </span><span class="annot"><span class="annottext">AppCtxt
</span><a href="#local-6989586621683097607"><span class="hs-identifier hs-var">ctxt</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">HsExpr GhcTc
</span><a href="#local-6989586621683097606"><span class="hs-identifier hs-var">fun</span></a></span><span>
</span><span id="line-404"></span><span>    </span><span id="local-6989586621683097626"><span class="annot"><span class="annottext">appCtxtLoc' :: AppCtxt -&gt; SrcSpan
</span><a href="#local-6989586621683097626"><span class="hs-identifier hs-var hs-var">appCtxtLoc'</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Tc.Gen.Head.html#VAExpansion"><span class="hs-identifier hs-type">VAExpansion</span></a></span><span> </span><span class="annot"><span class="annottext">HsThingRn
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">SrcSpan
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621683097627"><span class="annot"><span class="annottext">SrcSpan
</span><a href="#local-6989586621683097627"><span class="hs-identifier hs-var">l</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">SrcSpan
</span><a href="#local-6989586621683097627"><span class="hs-identifier hs-var">l</span></a></span><span>
</span><span id="line-405"></span><span>    </span><span class="annot"><a href="#local-6989586621683097626"><span class="hs-identifier hs-var">appCtxtLoc'</span></a></span><span> </span><span id="local-6989586621683097628"><span class="annot"><span class="annottext">AppCtxt
</span><a href="#local-6989586621683097628"><span class="hs-identifier hs-var">v</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">AppCtxt -&gt; SrcSpan
</span><a href="GHC.Tc.Gen.Head.html#appCtxtLoc"><span class="hs-identifier hs-var">appCtxtLoc</span></a></span><span> </span><span class="annot"><span class="annottext">AppCtxt
</span><a href="#local-6989586621683097628"><span class="hs-identifier hs-var">v</span></a></span><span>
</span><span id="line-406"></span><span>
</span><span id="line-407"></span><span>
</span><span id="line-408"></span><span id="local-6989586621683096980"><span class="annot"><a href="GHC.Tc.Gen.Head.html#isHsValArg"><span class="hs-identifier hs-type">isHsValArg</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Tc.Gen.Head.html#HsExprArg"><span class="hs-identifier hs-type">HsExprArg</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683096980"><span class="hs-identifier hs-type">id</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Bool</span></span></span><span>
</span><span id="line-409"></span><span id="isHsValArg"><span class="annot"><span class="annottext">isHsValArg :: forall (id :: TcPass). HsExprArg id -&gt; Bool
</span><a href="GHC.Tc.Gen.Head.html#isHsValArg"><span class="hs-identifier hs-var hs-var">isHsValArg</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Tc.Gen.Head.html#EValArg"><span class="hs-identifier hs-type">EValArg</span></a></span><span> </span><span class="hs-special">{</span><span class="hs-special">}</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">True</span></span><span>
</span><span id="line-410"></span><span class="annot"><a href="GHC.Tc.Gen.Head.html#isHsValArg"><span class="hs-identifier hs-var">isHsValArg</span></a></span><span> </span><span class="annot"><span class="annottext">HsExprArg id
</span><span class="hs-identifier">_</span></span><span>            </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">False</span></span><span>
</span><span id="line-411"></span><span>
</span><span id="line-412"></span><span class="annot"><a href="GHC.Tc.Gen.Head.html#leadingValArgs"><span class="hs-identifier hs-type">leadingValArgs</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="GHC.Tc.Gen.Head.html#HsExprArg"><span class="hs-identifier hs-type">HsExprArg</span></a></span><span> </span><span class="hs-special">'</span><span class="annot"><a href="GHC.Tc.Gen.Head.html#TcpRn"><span class="hs-identifier hs-type">TcpRn</span></a></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="Language.Haskell.Syntax.Expr.html#LHsExpr"><span class="hs-identifier hs-type">LHsExpr</span></a></span><span> </span><span class="annot"><a href="GHC.Hs.Extension.html#GhcRn"><span class="hs-identifier hs-type">GhcRn</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-413"></span><span id="leadingValArgs"><span class="annot"><span class="annottext">leadingValArgs :: [HsExprArg 'TcpRn] -&gt; [LHsExpr (GhcPass 'Renamed)]
</span><a href="GHC.Tc.Gen.Head.html#leadingValArgs"><span class="hs-identifier hs-var hs-var">leadingValArgs</span></a></span></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span>                                </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span>
</span><span id="line-414"></span><span class="annot"><a href="GHC.Tc.Gen.Head.html#leadingValArgs"><span class="hs-identifier hs-var">leadingValArgs</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Tc.Gen.Head.html#EValArg"><span class="hs-identifier hs-type">EValArg</span></a></span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">ea_arg :: forall (p :: TcPass). HsExprArg p -&gt; LHsExpr (GhcPass (XPass p))
</span><a href="GHC.Tc.Gen.Head.html#ea_arg"><span class="hs-identifier hs-var">ea_arg</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="local-6989586621683097629"><span class="annot"><span class="annottext">LHsExpr (GhcPass (XPass 'TcpRn))
</span><a href="#local-6989586621683097629"><span class="hs-identifier hs-var">arg</span></a></span></span><span> </span><span class="hs-special">}</span><span> </span><span class="annot"><span class="hs-glyph hs-type">:</span></span><span> </span><span id="local-6989586621683097630"><span class="annot"><span class="annottext">[HsExprArg 'TcpRn]
</span><a href="#local-6989586621683097630"><span class="hs-identifier hs-var">args</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">LHsExpr (GhcPass (XPass 'TcpRn))
GenLocated SrcSpanAnnA (HsExpr (GhcPass 'Renamed))
</span><a href="#local-6989586621683097629"><span class="hs-identifier hs-var">arg</span></a></span><span> </span><span class="annot"><span class="annottext">GenLocated SrcSpanAnnA (HsExpr (GhcPass 'Renamed))
-&gt; [GenLocated SrcSpanAnnA (HsExpr (GhcPass 'Renamed))]
-&gt; [GenLocated SrcSpanAnnA (HsExpr (GhcPass 'Renamed))]
forall a. a -&gt; [a] -&gt; [a]
</span><span class="hs-glyph hs-var">:</span></span><span> </span><span class="annot"><span class="annottext">[HsExprArg 'TcpRn] -&gt; [LHsExpr (GhcPass 'Renamed)]
</span><a href="GHC.Tc.Gen.Head.html#leadingValArgs"><span class="hs-identifier hs-var">leadingValArgs</span></a></span><span> </span><span class="annot"><span class="annottext">[HsExprArg 'TcpRn]
</span><a href="#local-6989586621683097630"><span class="hs-identifier hs-var">args</span></a></span><span>
</span><span id="line-415"></span><span class="annot"><a href="GHC.Tc.Gen.Head.html#leadingValArgs"><span class="hs-identifier hs-var">leadingValArgs</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Tc.Gen.Head.html#EWrap"><span class="hs-identifier hs-type">EWrap</span></a></span><span> </span><span class="hs-special">{</span><span class="hs-special">}</span><span>    </span><span class="annot"><span class="hs-glyph hs-type">:</span></span><span> </span><span id="local-6989586621683097631"><span class="annot"><span class="annottext">[HsExprArg 'TcpRn]
</span><a href="#local-6989586621683097631"><span class="hs-identifier hs-var">args</span></a></span></span><span class="hs-special">)</span><span>              </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[HsExprArg 'TcpRn] -&gt; [LHsExpr (GhcPass 'Renamed)]
</span><a href="GHC.Tc.Gen.Head.html#leadingValArgs"><span class="hs-identifier hs-var">leadingValArgs</span></a></span><span> </span><span class="annot"><span class="annottext">[HsExprArg 'TcpRn]
</span><a href="#local-6989586621683097631"><span class="hs-identifier hs-var">args</span></a></span><span>
</span><span id="line-416"></span><span class="annot"><a href="GHC.Tc.Gen.Head.html#leadingValArgs"><span class="hs-identifier hs-var">leadingValArgs</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Tc.Gen.Head.html#EPrag"><span class="hs-identifier hs-type">EPrag</span></a></span><span> </span><span class="hs-special">{</span><span class="hs-special">}</span><span>    </span><span class="annot"><span class="hs-glyph hs-type">:</span></span><span> </span><span id="local-6989586621683097632"><span class="annot"><span class="annottext">[HsExprArg 'TcpRn]
</span><a href="#local-6989586621683097632"><span class="hs-identifier hs-var">args</span></a></span></span><span class="hs-special">)</span><span>              </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[HsExprArg 'TcpRn] -&gt; [LHsExpr (GhcPass 'Renamed)]
</span><a href="GHC.Tc.Gen.Head.html#leadingValArgs"><span class="hs-identifier hs-var">leadingValArgs</span></a></span><span> </span><span class="annot"><span class="annottext">[HsExprArg 'TcpRn]
</span><a href="#local-6989586621683097632"><span class="hs-identifier hs-var">args</span></a></span><span>
</span><span id="line-417"></span><span class="annot"><a href="GHC.Tc.Gen.Head.html#leadingValArgs"><span class="hs-identifier hs-var">leadingValArgs</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Tc.Gen.Head.html#ETypeArg"><span class="hs-identifier hs-type">ETypeArg</span></a></span><span> </span><span class="hs-special">{</span><span class="hs-special">}</span><span> </span><span class="annot"><span class="hs-glyph hs-type">:</span></span><span> </span><span class="annot"><span class="annottext">[HsExprArg 'TcpRn]
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span>                 </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span>
</span><span id="line-418"></span><span>
</span><span id="line-419"></span><span id="local-6989586621683097633"><span class="annot"><a href="GHC.Tc.Gen.Head.html#isValArg"><span class="hs-identifier hs-type">isValArg</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Tc.Gen.Head.html#HsExprArg"><span class="hs-identifier hs-type">HsExprArg</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683097633"><span class="hs-identifier hs-type">id</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Bool</span></span></span><span>
</span><span id="line-420"></span><span id="isValArg"><span class="annot"><span class="annottext">isValArg :: forall (id :: TcPass). HsExprArg id -&gt; Bool
</span><a href="GHC.Tc.Gen.Head.html#isValArg"><span class="hs-identifier hs-var hs-var">isValArg</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Tc.Gen.Head.html#EValArg"><span class="hs-identifier hs-type">EValArg</span></a></span><span> </span><span class="hs-special">{</span><span class="hs-special">}</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">True</span></span><span>
</span><span id="line-421"></span><span class="annot"><a href="GHC.Tc.Gen.Head.html#isValArg"><span class="hs-identifier hs-var">isValArg</span></a></span><span> </span><span class="annot"><span class="annottext">HsExprArg id
</span><span class="hs-identifier">_</span></span><span>            </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">False</span></span><span>
</span><span id="line-422"></span><span>
</span><span id="line-423"></span><span id="local-6989586621683097635"><span class="annot"><a href="GHC.Tc.Gen.Head.html#isVisibleArg"><span class="hs-identifier hs-type">isVisibleArg</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Tc.Gen.Head.html#HsExprArg"><span class="hs-identifier hs-type">HsExprArg</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683097635"><span class="hs-identifier hs-type">id</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Bool</span></span></span><span>
</span><span id="line-424"></span><span id="isVisibleArg"><span class="annot"><span class="annottext">isVisibleArg :: forall (id :: TcPass). HsExprArg id -&gt; Bool
</span><a href="GHC.Tc.Gen.Head.html#isVisibleArg"><span class="hs-identifier hs-var hs-var">isVisibleArg</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Tc.Gen.Head.html#EValArg"><span class="hs-identifier hs-type">EValArg</span></a></span><span> </span><span class="hs-special">{</span><span class="hs-special">}</span><span class="hs-special">)</span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">True</span></span><span>
</span><span id="line-425"></span><span class="annot"><a href="GHC.Tc.Gen.Head.html#isVisibleArg"><span class="hs-identifier hs-var">isVisibleArg</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Tc.Gen.Head.html#ETypeArg"><span class="hs-identifier hs-type">ETypeArg</span></a></span><span> </span><span class="hs-special">{</span><span class="hs-special">}</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">True</span></span><span>
</span><span id="line-426"></span><span class="annot"><a href="GHC.Tc.Gen.Head.html#isVisibleArg"><span class="hs-identifier hs-var">isVisibleArg</span></a></span><span> </span><span class="annot"><span class="annottext">HsExprArg id
</span><span class="hs-identifier">_</span></span><span>             </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">False</span></span><span>
</span><span id="line-427"></span><span>
</span><span id="line-428"></span><span class="hs-keyword">instance</span><span> </span><span id="local-6989586621683096985"><span class="annot"><a href="GHC.Hs.Extension.html#OutputableBndrId"><span class="hs-identifier hs-type">OutputableBndrId</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Tc.Gen.Head.html#XPass"><span class="hs-identifier hs-type">XPass</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683096985"><span class="hs-identifier hs-type">p</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="GHC.Utils.Outputable.html#Outputable"><span class="hs-identifier hs-type">Outputable</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Tc.Gen.Head.html#HsExprArg"><span class="hs-identifier hs-type">HsExprArg</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683096985"><span class="hs-identifier hs-type">p</span></a></span><span class="hs-special">)</span></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-429"></span><span>  </span><span id="local-6989586621683097653"><span class="annot"><span class="annottext">ppr :: HsExprArg p -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var hs-var hs-var">ppr</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Tc.Gen.Head.html#EPrag"><span class="hs-identifier hs-type">EPrag</span></a></span><span> </span><span class="annot"><span class="annottext">AppCtxt
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621683097654"><span class="annot"><span class="annottext">HsPragE (GhcPass (XPass p))
</span><a href="#local-6989586621683097654"><span class="hs-identifier hs-var">p</span></a></span></span><span class="hs-special">)</span><span>                     </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">String -&gt; SDoc
forall doc. IsLine doc =&gt; String -&gt; doc
</span><a href="GHC.Utils.Outputable.html#text"><span class="hs-identifier hs-var">text</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;EPrag&quot;</span></span><span> </span><span class="annot"><span class="annottext">SDoc -&gt; SDoc -&gt; SDoc
forall doc. IsLine doc =&gt; doc -&gt; doc -&gt; doc
</span><a href="GHC.Utils.Outputable.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">HsPragE (GhcPass (XPass p)) -&gt; SDoc
forall a. Outputable a =&gt; a -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="annot"><span class="annottext">HsPragE (GhcPass (XPass p))
</span><a href="#local-6989586621683097654"><span class="hs-identifier hs-var">p</span></a></span><span>
</span><span id="line-430"></span><span>  </span><span class="annot"><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Tc.Gen.Head.html#ETypeArg"><span class="hs-identifier hs-type">ETypeArg</span></a></span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">ea_hs_ty :: forall (p :: TcPass). HsExprArg p -&gt; LHsWcType (GhcPass 'Renamed)
</span><a href="GHC.Tc.Gen.Head.html#ea_hs_ty"><span class="hs-identifier hs-var">ea_hs_ty</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="local-6989586621683097655"><span class="annot"><span class="annottext">LHsWcType (GhcPass 'Renamed)
</span><a href="#local-6989586621683097655"><span class="hs-identifier hs-var">hs_ty</span></a></span></span><span> </span><span class="hs-special">}</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Char -&gt; SDoc
forall doc. IsLine doc =&gt; Char -&gt; doc
</span><a href="GHC.Utils.Outputable.html#char"><span class="hs-identifier hs-var">char</span></a></span><span> </span><span class="annot"><span class="annottext">Char
</span><span class="hs-char">'@'</span></span><span> </span><span class="annot"><span class="annottext">SDoc -&gt; SDoc -&gt; SDoc
forall doc. IsLine doc =&gt; doc -&gt; doc -&gt; doc
</span><a href="GHC.Utils.Outputable.html#%3C%3E"><span class="hs-operator hs-var">&lt;&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">HsWildCardBndrs
  (GhcPass 'Renamed)
  (GenLocated SrcSpanAnnA (HsType (GhcPass 'Renamed)))
-&gt; SDoc
forall a. Outputable a =&gt; a -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="annot"><span class="annottext">LHsWcType (GhcPass 'Renamed)
HsWildCardBndrs
  (GhcPass 'Renamed)
  (GenLocated SrcSpanAnnA (HsType (GhcPass 'Renamed)))
</span><a href="#local-6989586621683097655"><span class="hs-identifier hs-var">hs_ty</span></a></span><span>
</span><span id="line-431"></span><span>  </span><span class="annot"><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Tc.Gen.Head.html#EWrap"><span class="hs-identifier hs-type">EWrap</span></a></span><span> </span><span id="local-6989586621683097658"><span class="annot"><span class="annottext">EWrap
</span><a href="#local-6989586621683097658"><span class="hs-identifier hs-var">wrap</span></a></span></span><span class="hs-special">)</span><span>                    </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">EWrap -&gt; SDoc
forall a. Outputable a =&gt; a -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="annot"><span class="annottext">EWrap
</span><a href="#local-6989586621683097658"><span class="hs-identifier hs-var">wrap</span></a></span><span>
</span><span id="line-432"></span><span>  </span><span class="annot"><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Tc.Gen.Head.html#EValArg"><span class="hs-identifier hs-type">EValArg</span></a></span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">ea_arg :: forall (p :: TcPass). HsExprArg p -&gt; LHsExpr (GhcPass (XPass p))
</span><a href="GHC.Tc.Gen.Head.html#ea_arg"><span class="hs-identifier hs-var">ea_arg</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="local-6989586621683097659"><span class="annot"><span class="annottext">LHsExpr (GhcPass (XPass p))
</span><a href="#local-6989586621683097659"><span class="hs-identifier hs-var">arg</span></a></span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">ea_ctxt :: forall (p :: TcPass). HsExprArg p -&gt; AppCtxt
</span><a href="GHC.Tc.Gen.Head.html#ea_ctxt"><span class="hs-identifier hs-var">ea_ctxt</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="local-6989586621683097660"><span class="annot"><span class="annottext">AppCtxt
</span><a href="#local-6989586621683097660"><span class="hs-identifier hs-var">ctxt</span></a></span></span><span> </span><span class="hs-special">}</span><span class="hs-special">)</span><span>
</span><span id="line-433"></span><span>    </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">String -&gt; SDoc
forall doc. IsLine doc =&gt; String -&gt; doc
</span><a href="GHC.Utils.Outputable.html#text"><span class="hs-identifier hs-var">text</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;EValArg&quot;</span></span><span> </span><span class="annot"><span class="annottext">SDoc -&gt; SDoc -&gt; SDoc
forall doc. IsLine doc =&gt; doc -&gt; doc -&gt; doc
</span><a href="GHC.Utils.Outputable.html#%3C%3E"><span class="hs-operator hs-var">&lt;&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">SDoc -&gt; SDoc
forall doc. IsLine doc =&gt; doc -&gt; doc
</span><a href="GHC.Utils.Outputable.html#braces"><span class="hs-identifier hs-var">braces</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">AppCtxt -&gt; SDoc
forall a. Outputable a =&gt; a -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="annot"><span class="annottext">AppCtxt
</span><a href="#local-6989586621683097660"><span class="hs-identifier hs-var">ctxt</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">SDoc -&gt; SDoc -&gt; SDoc
forall doc. IsLine doc =&gt; doc -&gt; doc -&gt; doc
</span><a href="GHC.Utils.Outputable.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">GenLocated SrcSpanAnnA (HsExpr (GhcPass (XPass p))) -&gt; SDoc
forall a. Outputable a =&gt; a -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="annot"><span class="annottext">LHsExpr (GhcPass (XPass p))
GenLocated SrcSpanAnnA (HsExpr (GhcPass (XPass p)))
</span><a href="#local-6989586621683097659"><span class="hs-identifier hs-var">arg</span></a></span><span>
</span><span id="line-434"></span><span>  </span><span class="annot"><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Tc.Gen.Head.html#EValArgQL"><span class="hs-identifier hs-type">EValArgQL</span></a></span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">eaql_tc_fun :: HsExprArg 'TcpInst -&gt; (HsExpr GhcTc, AppCtxt)
</span><a href="GHC.Tc.Gen.Head.html#eaql_tc_fun"><span class="hs-identifier hs-var">eaql_tc_fun</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="local-6989586621683097674"><span class="annot"><span class="annottext">(HsExpr GhcTc, AppCtxt)
</span><a href="#local-6989586621683097674"><span class="hs-identifier hs-var">fun</span></a></span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">eaql_args :: HsExprArg 'TcpInst -&gt; [HsExprArg 'TcpInst]
</span><a href="GHC.Tc.Gen.Head.html#eaql_args"><span class="hs-identifier hs-var">eaql_args</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="local-6989586621683097675"><span class="annot"><span class="annottext">[HsExprArg 'TcpInst]
</span><a href="#local-6989586621683097675"><span class="hs-identifier hs-var">args</span></a></span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">eaql_res_rho :: HsExprArg 'TcpInst -&gt; TcSigmaType
</span><a href="GHC.Tc.Gen.Head.html#eaql_res_rho"><span class="hs-identifier hs-var">eaql_res_rho</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="local-6989586621683097676"><span class="annot"><span class="annottext">TcSigmaType
</span><a href="#local-6989586621683097676"><span class="hs-identifier hs-var">ty</span></a></span></span><span class="hs-special">}</span><span class="hs-special">)</span><span>
</span><span id="line-435"></span><span>    </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">SDoc -&gt; ThLevel -&gt; SDoc -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#hang"><span class="hs-identifier hs-var">hang</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">String -&gt; SDoc
forall doc. IsLine doc =&gt; String -&gt; doc
</span><a href="GHC.Utils.Outputable.html#text"><span class="hs-identifier hs-var">text</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;EValArgQL&quot;</span></span><span> </span><span class="annot"><span class="annottext">SDoc -&gt; SDoc -&gt; SDoc
forall doc. IsLine doc =&gt; doc -&gt; doc -&gt; doc
</span><a href="GHC.Utils.Outputable.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">(HsExpr GhcTc, AppCtxt) -&gt; SDoc
forall a. Outputable a =&gt; a -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="annot"><span class="annottext">(HsExpr GhcTc, AppCtxt)
</span><a href="#local-6989586621683097674"><span class="hs-identifier hs-var">fun</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-436"></span><span>         </span><span class="annot"><span class="annottext">ThLevel
</span><span class="hs-number">2</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[SDoc] -&gt; SDoc
forall doc. IsDoc doc =&gt; [doc] -&gt; doc
</span><a href="GHC.Utils.Outputable.html#vcat"><span class="hs-identifier hs-var">vcat</span></a></span><span> </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">[HsExprArg 'TcpInst] -&gt; SDoc
forall a. Outputable a =&gt; a -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="annot"><span class="annottext">[HsExprArg 'TcpInst]
</span><a href="#local-6989586621683097675"><span class="hs-identifier hs-var">args</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">String -&gt; SDoc
forall doc. IsLine doc =&gt; String -&gt; doc
</span><a href="GHC.Utils.Outputable.html#text"><span class="hs-identifier hs-var">text</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;ea_ql_ty:&quot;</span></span><span> </span><span class="annot"><span class="annottext">SDoc -&gt; SDoc -&gt; SDoc
forall doc. IsLine doc =&gt; doc -&gt; doc -&gt; doc
</span><a href="GHC.Utils.Outputable.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">TcSigmaType -&gt; SDoc
forall a. Outputable a =&gt; a -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="annot"><span class="annottext">TcSigmaType
</span><a href="#local-6989586621683097676"><span class="hs-identifier hs-var">ty</span></a></span><span> </span><span class="hs-special">]</span><span class="hs-special">)</span><span>
</span><span id="line-437"></span><span>
</span><span id="line-438"></span><span class="annot"><a href="GHC.Tc.Gen.Head.html#pprArgInst"><span class="hs-identifier hs-type">pprArgInst</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Tc.Gen.Head.html#HsExprArg"><span class="hs-identifier hs-type">HsExprArg</span></a></span><span> </span><span class="hs-special">'</span><span class="annot"><a href="GHC.Tc.Gen.Head.html#TcpInst"><span class="hs-identifier hs-type">TcpInst</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Utils.Outputable.html#SDoc"><span class="hs-identifier hs-type">SDoc</span></a></span><span>
</span><span id="line-439"></span><span class="hs-comment">-- Ugh!  A special version for 'TcpInst, se we can print the arg_ty of EValArg</span><span>
</span><span id="line-440"></span><span id="pprArgInst"><span class="annot"><span class="annottext">pprArgInst :: HsExprArg 'TcpInst -&gt; SDoc
</span><a href="GHC.Tc.Gen.Head.html#pprArgInst"><span class="hs-identifier hs-var hs-var">pprArgInst</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Tc.Gen.Head.html#EPrag"><span class="hs-identifier hs-type">EPrag</span></a></span><span> </span><span class="annot"><span class="annottext">AppCtxt
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621683097679"><span class="annot"><span class="annottext">HsPragE (GhcPass (XPass 'TcpInst))
</span><a href="#local-6989586621683097679"><span class="hs-identifier hs-var">p</span></a></span></span><span class="hs-special">)</span><span>                     </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">String -&gt; SDoc
forall doc. IsLine doc =&gt; String -&gt; doc
</span><a href="GHC.Utils.Outputable.html#text"><span class="hs-identifier hs-var">text</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;EPrag&quot;</span></span><span> </span><span class="annot"><span class="annottext">SDoc -&gt; SDoc -&gt; SDoc
forall doc. IsLine doc =&gt; doc -&gt; doc -&gt; doc
</span><a href="GHC.Utils.Outputable.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">HsPragE (GhcPass 'Renamed) -&gt; SDoc
forall a. Outputable a =&gt; a -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="annot"><span class="annottext">HsPragE (GhcPass 'Renamed)
HsPragE (GhcPass (XPass 'TcpInst))
</span><a href="#local-6989586621683097679"><span class="hs-identifier hs-var">p</span></a></span><span>
</span><span id="line-441"></span><span class="annot"><a href="GHC.Tc.Gen.Head.html#pprArgInst"><span class="hs-identifier hs-var">pprArgInst</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Tc.Gen.Head.html#ETypeArg"><span class="hs-identifier hs-type">ETypeArg</span></a></span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">ea_hs_ty :: forall (p :: TcPass). HsExprArg p -&gt; LHsWcType (GhcPass 'Renamed)
</span><a href="GHC.Tc.Gen.Head.html#ea_hs_ty"><span class="hs-identifier hs-var">ea_hs_ty</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="local-6989586621683097680"><span class="annot"><span class="annottext">LHsWcType (GhcPass 'Renamed)
</span><a href="#local-6989586621683097680"><span class="hs-identifier hs-var">hs_ty</span></a></span></span><span> </span><span class="hs-special">}</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Char -&gt; SDoc
forall doc. IsLine doc =&gt; Char -&gt; doc
</span><a href="GHC.Utils.Outputable.html#char"><span class="hs-identifier hs-var">char</span></a></span><span> </span><span class="annot"><span class="annottext">Char
</span><span class="hs-char">'@'</span></span><span> </span><span class="annot"><span class="annottext">SDoc -&gt; SDoc -&gt; SDoc
forall doc. IsLine doc =&gt; doc -&gt; doc -&gt; doc
</span><a href="GHC.Utils.Outputable.html#%3C%3E"><span class="hs-operator hs-var">&lt;&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">HsWildCardBndrs
  (GhcPass 'Renamed)
  (GenLocated SrcSpanAnnA (HsType (GhcPass 'Renamed)))
-&gt; SDoc
forall a. Outputable a =&gt; a -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="annot"><span class="annottext">LHsWcType (GhcPass 'Renamed)
HsWildCardBndrs
  (GhcPass 'Renamed)
  (GenLocated SrcSpanAnnA (HsType (GhcPass 'Renamed)))
</span><a href="#local-6989586621683097680"><span class="hs-identifier hs-var">hs_ty</span></a></span><span>
</span><span id="line-442"></span><span class="annot"><a href="GHC.Tc.Gen.Head.html#pprArgInst"><span class="hs-identifier hs-var">pprArgInst</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Tc.Gen.Head.html#EWrap"><span class="hs-identifier hs-type">EWrap</span></a></span><span> </span><span id="local-6989586621683097681"><span class="annot"><span class="annottext">EWrap
</span><a href="#local-6989586621683097681"><span class="hs-identifier hs-var">wrap</span></a></span></span><span class="hs-special">)</span><span>                    </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">EWrap -&gt; SDoc
forall a. Outputable a =&gt; a -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="annot"><span class="annottext">EWrap
</span><a href="#local-6989586621683097681"><span class="hs-identifier hs-var">wrap</span></a></span><span>
</span><span id="line-443"></span><span class="annot"><a href="GHC.Tc.Gen.Head.html#pprArgInst"><span class="hs-identifier hs-var">pprArgInst</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Tc.Gen.Head.html#EValArg"><span class="hs-identifier hs-type">EValArg</span></a></span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">ea_arg :: forall (p :: TcPass). HsExprArg p -&gt; LHsExpr (GhcPass (XPass p))
</span><a href="GHC.Tc.Gen.Head.html#ea_arg"><span class="hs-identifier hs-var">ea_arg</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="local-6989586621683097682"><span class="annot"><span class="annottext">LHsExpr (GhcPass (XPass 'TcpInst))
</span><a href="#local-6989586621683097682"><span class="hs-identifier hs-var">arg</span></a></span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">ea_arg_ty :: forall (p :: TcPass). HsExprArg p -&gt; XEVAType p
</span><a href="GHC.Tc.Gen.Head.html#ea_arg_ty"><span class="hs-identifier hs-var">ea_arg_ty</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="local-6989586621683097683"><span class="annot"><span class="annottext">XEVAType 'TcpInst
</span><a href="#local-6989586621683097683"><span class="hs-identifier hs-var">ty</span></a></span></span><span> </span><span class="hs-special">}</span><span class="hs-special">)</span><span>
</span><span id="line-444"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">SDoc -&gt; ThLevel -&gt; SDoc -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#hang"><span class="hs-identifier hs-var">hang</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">String -&gt; SDoc
forall doc. IsLine doc =&gt; String -&gt; doc
</span><a href="GHC.Utils.Outputable.html#text"><span class="hs-identifier hs-var">text</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;EValArg&quot;</span></span><span> </span><span class="annot"><span class="annottext">SDoc -&gt; SDoc -&gt; SDoc
forall doc. IsLine doc =&gt; doc -&gt; doc -&gt; doc
</span><a href="GHC.Utils.Outputable.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">GenLocated SrcSpanAnnA (HsExpr (GhcPass 'Renamed)) -&gt; SDoc
forall a. Outputable a =&gt; a -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="annot"><span class="annottext">LHsExpr (GhcPass (XPass 'TcpInst))
GenLocated SrcSpanAnnA (HsExpr (GhcPass 'Renamed))
</span><a href="#local-6989586621683097682"><span class="hs-identifier hs-var">arg</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-445"></span><span>       </span><span class="annot"><span class="annottext">ThLevel
</span><span class="hs-number">2</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">String -&gt; SDoc
forall doc. IsLine doc =&gt; String -&gt; doc
</span><a href="GHC.Utils.Outputable.html#text"><span class="hs-identifier hs-var">text</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;arg_ty&quot;</span></span><span> </span><span class="annot"><span class="annottext">SDoc -&gt; SDoc -&gt; SDoc
forall doc. IsLine doc =&gt; doc -&gt; doc -&gt; doc
</span><a href="GHC.Utils.Outputable.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">Scaled TcSigmaType -&gt; SDoc
forall a. Outputable a =&gt; a -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="annot"><span class="annottext">Scaled TcSigmaType
XEVAType 'TcpInst
</span><a href="#local-6989586621683097683"><span class="hs-identifier hs-var">ty</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-446"></span><span class="annot"><a href="GHC.Tc.Gen.Head.html#pprArgInst"><span class="hs-identifier hs-var">pprArgInst</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Tc.Gen.Head.html#EValArgQL"><span class="hs-identifier hs-type">EValArgQL</span></a></span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">eaql_tc_fun :: HsExprArg 'TcpInst -&gt; (HsExpr GhcTc, AppCtxt)
</span><a href="GHC.Tc.Gen.Head.html#eaql_tc_fun"><span class="hs-identifier hs-var">eaql_tc_fun</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="local-6989586621683097694"><span class="annot"><span class="annottext">(HsExpr GhcTc, AppCtxt)
</span><a href="#local-6989586621683097694"><span class="hs-identifier hs-var">fun</span></a></span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">eaql_args :: HsExprArg 'TcpInst -&gt; [HsExprArg 'TcpInst]
</span><a href="GHC.Tc.Gen.Head.html#eaql_args"><span class="hs-identifier hs-var">eaql_args</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="local-6989586621683097695"><span class="annot"><span class="annottext">[HsExprArg 'TcpInst]
</span><a href="#local-6989586621683097695"><span class="hs-identifier hs-var">args</span></a></span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">eaql_res_rho :: HsExprArg 'TcpInst -&gt; TcSigmaType
</span><a href="GHC.Tc.Gen.Head.html#eaql_res_rho"><span class="hs-identifier hs-var">eaql_res_rho</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="local-6989586621683097696"><span class="annot"><span class="annottext">TcSigmaType
</span><a href="#local-6989586621683097696"><span class="hs-identifier hs-var">ty</span></a></span></span><span class="hs-special">}</span><span class="hs-special">)</span><span>
</span><span id="line-447"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">SDoc -&gt; ThLevel -&gt; SDoc -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#hang"><span class="hs-identifier hs-var">hang</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">String -&gt; SDoc
forall doc. IsLine doc =&gt; String -&gt; doc
</span><a href="GHC.Utils.Outputable.html#text"><span class="hs-identifier hs-var">text</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;EValArgQL&quot;</span></span><span> </span><span class="annot"><span class="annottext">SDoc -&gt; SDoc -&gt; SDoc
forall doc. IsLine doc =&gt; doc -&gt; doc -&gt; doc
</span><a href="GHC.Utils.Outputable.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">(HsExpr GhcTc, AppCtxt) -&gt; SDoc
forall a. Outputable a =&gt; a -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="annot"><span class="annottext">(HsExpr GhcTc, AppCtxt)
</span><a href="#local-6989586621683097694"><span class="hs-identifier hs-var">fun</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-448"></span><span>       </span><span class="annot"><span class="annottext">ThLevel
</span><span class="hs-number">2</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[SDoc] -&gt; SDoc
forall doc. IsDoc doc =&gt; [doc] -&gt; doc
</span><a href="GHC.Utils.Outputable.html#vcat"><span class="hs-identifier hs-var">vcat</span></a></span><span> </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">[SDoc] -&gt; SDoc
forall doc. IsDoc doc =&gt; [doc] -&gt; doc
</span><a href="GHC.Utils.Outputable.html#vcat"><span class="hs-identifier hs-var">vcat</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(HsExprArg 'TcpInst -&gt; SDoc) -&gt; [HsExprArg 'TcpInst] -&gt; [SDoc]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><span class="hs-identifier hs-var">map</span></span><span> </span><span class="annot"><span class="annottext">HsExprArg 'TcpInst -&gt; SDoc
</span><a href="GHC.Tc.Gen.Head.html#pprArgInst"><span class="hs-identifier hs-var">pprArgInst</span></a></span><span> </span><span class="annot"><span class="annottext">[HsExprArg 'TcpInst]
</span><a href="#local-6989586621683097695"><span class="hs-identifier hs-var">args</span></a></span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">String -&gt; SDoc
forall doc. IsLine doc =&gt; String -&gt; doc
</span><a href="GHC.Utils.Outputable.html#text"><span class="hs-identifier hs-var">text</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;ea_ql_ty:&quot;</span></span><span> </span><span class="annot"><span class="annottext">SDoc -&gt; SDoc -&gt; SDoc
forall doc. IsLine doc =&gt; doc -&gt; doc -&gt; doc
</span><a href="GHC.Utils.Outputable.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">TcSigmaType -&gt; SDoc
forall a. Outputable a =&gt; a -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="annot"><span class="annottext">TcSigmaType
</span><a href="#local-6989586621683097696"><span class="hs-identifier hs-var">ty</span></a></span><span> </span><span class="hs-special">]</span><span class="hs-special">)</span><span>
</span><span id="line-449"></span><span>
</span><span id="line-450"></span><span class="hs-keyword">instance</span><span> </span><span class="annot"><a href="GHC.Utils.Outputable.html#Outputable"><span class="hs-identifier hs-type">Outputable</span></a></span><span> </span><span class="annot"><a href="GHC.Tc.Gen.Head.html#EWrap"><span class="hs-identifier hs-type">EWrap</span></a></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-451"></span><span>  </span><span id="local-6989586621683097706"><span class="annot"><span class="annottext">ppr :: EWrap -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var hs-var hs-var">ppr</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Tc.Gen.Head.html#EPar"><span class="hs-identifier hs-type">EPar</span></a></span><span> </span><span class="annot"><span class="annottext">AppCtxt
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span>       </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">String -&gt; SDoc
forall doc. IsLine doc =&gt; String -&gt; doc
</span><a href="GHC.Utils.Outputable.html#text"><span class="hs-identifier hs-var">text</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;EPar&quot;</span></span><span>
</span><span id="line-452"></span><span>  </span><span class="annot"><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Tc.Gen.Head.html#EHsWrap"><span class="hs-identifier hs-type">EHsWrap</span></a></span><span> </span><span id="local-6989586621683097707"><span class="annot"><span class="annottext">HsWrapper
</span><a href="#local-6989586621683097707"><span class="hs-identifier hs-var">w</span></a></span></span><span class="hs-special">)</span><span>    </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">String -&gt; SDoc
forall doc. IsLine doc =&gt; String -&gt; doc
</span><a href="GHC.Utils.Outputable.html#text"><span class="hs-identifier hs-var">text</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;EHsWrap&quot;</span></span><span> </span><span class="annot"><span class="annottext">SDoc -&gt; SDoc -&gt; SDoc
forall doc. IsLine doc =&gt; doc -&gt; doc -&gt; doc
</span><a href="GHC.Utils.Outputable.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">HsWrapper -&gt; SDoc
forall a. Outputable a =&gt; a -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="annot"><span class="annottext">HsWrapper
</span><a href="#local-6989586621683097707"><span class="hs-identifier hs-var">w</span></a></span><span>
</span><span id="line-453"></span><span>  </span><span class="annot"><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Tc.Gen.Head.html#EExpand"><span class="hs-identifier hs-type">EExpand</span></a></span><span> </span><span id="local-6989586621683097708"><span class="annot"><span class="annottext">HsThingRn
</span><a href="#local-6989586621683097708"><span class="hs-identifier hs-var">orig</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">String -&gt; SDoc
forall doc. IsLine doc =&gt; String -&gt; doc
</span><a href="GHC.Utils.Outputable.html#text"><span class="hs-identifier hs-var">text</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;EExpand&quot;</span></span><span> </span><span class="annot"><span class="annottext">SDoc -&gt; SDoc -&gt; SDoc
forall doc. IsLine doc =&gt; doc -&gt; doc -&gt; doc
</span><a href="GHC.Utils.Outputable.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">HsThingRn -&gt; SDoc
forall a. Outputable a =&gt; a -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="annot"><span class="annottext">HsThingRn
</span><a href="#local-6989586621683097708"><span class="hs-identifier hs-var">orig</span></a></span><span>
</span><span id="line-454"></span><span>
</span><span id="line-455"></span><span class="hs-comment">{- Note [Desugar OpApp in the typechecker]
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
Operator sections are desugared in the renamer; see GHC.Rename.Expr
Note [Handling overloaded and rebindable constructs].
But for reasons explained there, we rename OpApp to OpApp.  Then,
here in the typechecker, we desugar it to a use of ExpandedThingRn.
That makes it possible to typecheck something like
     e1 `f` e2
where
   f :: forall a. t1 -&gt; forall b. t2 -&gt; t3

Note [Looking through ExpandedThingRn]
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
When creating an application chain in splitHsApps, we must deal with
     ExpandedThingRn f1 (f `HsApp` e1) `HsApp` e2 `HsApp` e3

as a single application chain `f e1 e2 e3`.  Otherwise stuff like overloaded
labels (#19154) won't work.

It's easy to achieve this: `splitHsApps` unwraps `ExpandedThingRn`.

In order to be able to more accurately reconstruct the original `SrcSpan`s
from the renamer in `rebuildHsApps`, we also have to track the `SrcSpan`
of the current application in `VAExpansion` when unwrapping `ExpandedThingRn`
in `splitHsApps`, just as we track it in a non-expanded expression.

Previously, `rebuildHsApps` substituted the location of the original
expression as given by `splitHsApps` for this. As a result, the application
head in expanded expressions, e.g. the call to `fromListN`, would either
have `noSrcSpan` set as its location post-typecheck, or get the location
of the original expression, depending on whether the `XExpr` given to
`splitHsApps` is in the outermost layer. The span it got in the renamer
would always be discarded, causing #23120.

Note [Looking through Template Haskell splices in splitHsApps]
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
When typechecking an application, we must look through untyped TH splices in
order to typecheck examples like the one in #21077:

  data Foo = MkFoo () (forall a. a -&gt; a)

  foo :: Foo
  foo = $([| MkFoo () |]) $ \x -&gt; x

In principle, this is straightforward to accomplish. By the time we typecheck
`foo`, the renamer will have already run the splice, so all we have to do is
look at the expanded version of the splice in `splitHsApps`. See the
`HsUntypedSplice` case in `splitHsApps` for how this is accomplished.

There is one slight complication in that untyped TH splices also include
modFinalizers (see Note [Delaying modFinalizers in untyped splices] in
GHC.Rename.Splice), which must be run during typechecking. splitHsApps is a
convenient place to run the modFinalizers, so we do so there. This is the only
reason that `splitHsApps` uses the TcM monad.

`HsUntypedSplice` covers both ordinary TH splices, such as the example above,
as well as quasiquotes (see Note [Quasi-quote overview] in
Language.Haskell.Syntax.Expr). The `splitHsApps` case for `HsUntypedSplice`
handles both of these. This is easy to accomplish, since all the real work in
handling splices and quasiquotes has already been performed by the renamer by
the time we get to `splitHsApps`.

Wrinkle (UTS1):
  `tcExpr` has a separate case for `HsUntypedSplice`s that do /not/ occur at the
  head of an application. This is important to handle programs like this one:

    foo :: (forall a. a -&gt; a) -&gt; b -&gt; b
    foo = $([| \g x -&gt; g x |])

  Here, it is vital that we push the expected type inwards so that `g` gets the
  type `forall a. a -&gt; a`, and the `tcExpr` case for `HsUntypedSplice` performs
  this pushing. Without it, we would instead infer `g` to have type `b -&gt; b`,
  which isn't sufficiently general. Unfortunately, this does mean that there are
  two different places in the code where an `HsUntypedSplice`'s modFinalizers can
  be ran, depending on whether the splice appears at the head of an application
  or not.
-}</span><span>
</span><span id="line-532"></span><span>
</span><span id="line-533"></span><span class="annot"><span class="hs-comment">{- *********************************************************************
*                                                                      *
                 tcInferAppHead
*                                                                      *
********************************************************************* -}</span></span><span>
</span><span id="line-538"></span><span>
</span><span id="line-539"></span><span class="annot"><a href="GHC.Tc.Gen.Head.html#tcInferAppHead"><span class="hs-identifier hs-type">tcInferAppHead</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Language.Haskell.Syntax.Expr.html#HsExpr"><span class="hs-identifier hs-type">HsExpr</span></a></span><span> </span><span class="annot"><a href="GHC.Hs.Extension.html#GhcRn"><span class="hs-identifier hs-type">GhcRn</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Tc.Gen.Head.html#AppCtxt"><span class="hs-identifier hs-type">AppCtxt</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-540"></span><span>               </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#TcM"><span class="hs-identifier hs-type">TcM</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Language.Haskell.Syntax.Expr.html#HsExpr"><span class="hs-identifier hs-type">HsExpr</span></a></span><span> </span><span class="annot"><a href="GHC.Hs.Extension.html#GhcTc"><span class="hs-identifier hs-type">GhcTc</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.TcType.html#TcSigmaType"><span class="hs-identifier hs-type">TcSigmaType</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-541"></span><span class="hs-comment">-- Infer type of the head of an application</span><span>
</span><span id="line-542"></span><span class="hs-comment">--   i.e. the 'f' in (f e1 ... en)</span><span>
</span><span id="line-543"></span><span class="hs-comment">-- See Note [Application chains and heads] in GHC.Tc.Gen.App</span><span>
</span><span id="line-544"></span><span class="hs-comment">-- We get back a /SigmaType/ because we have special cases for</span><span>
</span><span id="line-545"></span><span class="hs-comment">--   * A bare identifier (just look it up)</span><span>
</span><span id="line-546"></span><span class="hs-comment">--     This case also covers a record selector HsRecSel</span><span>
</span><span id="line-547"></span><span class="hs-comment">--   * An expression with a type signature (e :: ty)</span><span>
</span><span id="line-548"></span><span class="hs-comment">-- See Note [Application chains and heads] in GHC.Tc.Gen.App</span><span>
</span><span id="line-549"></span><span class="hs-comment">--</span><span>
</span><span id="line-550"></span><span class="hs-comment">-- Note that [] and (,,) are both HsVar:</span><span>
</span><span id="line-551"></span><span class="hs-comment">--   see Note [Empty lists] and [ExplicitTuple] in GHC.Hs.Expr</span><span>
</span><span id="line-552"></span><span class="hs-comment">--</span><span>
</span><span id="line-553"></span><span class="hs-comment">-- NB: 'e' cannot be HsApp, HsTyApp, HsPrag, HsPar, because those</span><span>
</span><span id="line-554"></span><span class="hs-comment">--     cases are dealt with by splitHsApps.</span><span>
</span><span id="line-555"></span><span class="hs-comment">--</span><span>
</span><span id="line-556"></span><span class="hs-comment">-- See Note [tcApp: typechecking applications] in GHC.Tc.Gen.App</span><span>
</span><span id="line-557"></span><span id="tcInferAppHead"><span class="annot"><span class="annottext">tcInferAppHead :: (HsExpr (GhcPass 'Renamed), AppCtxt)
-&gt; TcM (HsExpr GhcTc, TcSigmaType)
</span><a href="GHC.Tc.Gen.Head.html#tcInferAppHead"><span class="hs-identifier hs-var hs-var">tcInferAppHead</span></a></span></span><span> </span><span class="hs-special">(</span><span id="local-6989586621683097709"><span class="annot"><span class="annottext">HsExpr (GhcPass 'Renamed)
</span><a href="#local-6989586621683097709"><span class="hs-identifier hs-var">fun</span></a></span></span><span class="hs-special">,</span><span id="local-6989586621683097710"><span class="annot"><span class="annottext">AppCtxt
</span><a href="#local-6989586621683097710"><span class="hs-identifier hs-var">ctxt</span></a></span></span><span class="hs-special">)</span><span>
</span><span id="line-558"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">AppCtxt
-&gt; TcM (HsExpr GhcTc, TcSigmaType)
-&gt; TcM (HsExpr GhcTc, TcSigmaType)
forall a. AppCtxt -&gt; TcM a -&gt; TcM a
</span><a href="GHC.Tc.Gen.Head.html#addHeadCtxt"><span class="hs-identifier hs-var">addHeadCtxt</span></a></span><span> </span><span class="annot"><span class="annottext">AppCtxt
</span><a href="#local-6989586621683097710"><span class="hs-identifier hs-var">ctxt</span></a></span><span> </span><span class="annot"><span class="annottext">(TcM (HsExpr GhcTc, TcSigmaType)
 -&gt; TcM (HsExpr GhcTc, TcSigmaType))
-&gt; TcM (HsExpr GhcTc, TcSigmaType)
-&gt; TcM (HsExpr GhcTc, TcSigmaType)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-559"></span><span>    </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span id="local-6989586621683097711"><span class="annot"><a href="#local-6989586621683097711"><span class="hs-identifier hs-var">mb_tc_fun</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">HsExpr (GhcPass 'Renamed)
-&gt; TcM (Maybe (HsExpr GhcTc, TcSigmaType))
</span><a href="GHC.Tc.Gen.Head.html#tcInferAppHead_maybe"><span class="hs-identifier hs-var">tcInferAppHead_maybe</span></a></span><span> </span><span class="annot"><span class="annottext">HsExpr (GhcPass 'Renamed)
</span><a href="#local-6989586621683097709"><span class="hs-identifier hs-var">fun</span></a></span><span>
</span><span id="line-560"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><a href="#local-6989586621683097711"><span class="hs-identifier hs-type">mb_tc_fun</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-561"></span><span>            </span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span class="hs-special">(</span><span id="local-6989586621683097712"><span class="annot"><span class="annottext">HsExpr GhcTc
</span><a href="#local-6989586621683097712"><span class="hs-identifier hs-var">fun'</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621683097713"><span class="annot"><span class="annottext">TcSigmaType
</span><a href="#local-6989586621683097713"><span class="hs-identifier hs-var">fun_sigma</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">(HsExpr GhcTc, TcSigmaType) -&gt; TcM (HsExpr GhcTc, TcSigmaType)
forall a. a -&gt; IOEnv (Env TcGblEnv TcLclEnv) a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">HsExpr GhcTc
</span><a href="#local-6989586621683097712"><span class="hs-identifier hs-var">fun'</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">TcSigmaType
</span><a href="#local-6989586621683097713"><span class="hs-identifier hs-var">fun_sigma</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-562"></span><span>            </span><span class="annot"><span class="annottext">Maybe (HsExpr GhcTc, TcSigmaType)
</span><span class="hs-identifier hs-var">Nothing</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">(ExpRhoType -&gt; TcM (HsExpr GhcTc))
-&gt; TcM (HsExpr GhcTc, TcSigmaType)
forall a. (ExpRhoType -&gt; TcM a) -&gt; TcM (a, TcSigmaType)
</span><a href="GHC.Tc.Utils.TcMType.html#tcInfer"><span class="hs-identifier hs-var">tcInfer</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">HsExpr (GhcPass 'Renamed) -&gt; ExpRhoType -&gt; TcM (HsExpr GhcTc)
</span><a href="GHC.Tc.Gen.Expr.html#tcExpr"><span class="hs-identifier hs-var">tcExpr</span></a></span><span> </span><span class="annot"><span class="annottext">HsExpr (GhcPass 'Renamed)
</span><a href="#local-6989586621683097709"><span class="hs-identifier hs-var">fun</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-563"></span><span>
</span><span id="line-564"></span><span class="annot"><a href="GHC.Tc.Gen.Head.html#tcInferAppHead_maybe"><span class="hs-identifier hs-type">tcInferAppHead_maybe</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Language.Haskell.Syntax.Expr.html#HsExpr"><span class="hs-identifier hs-type">HsExpr</span></a></span><span> </span><span class="annot"><a href="GHC.Hs.Extension.html#GhcRn"><span class="hs-identifier hs-type">GhcRn</span></a></span><span>
</span><span id="line-565"></span><span>                     </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#TcM"><span class="hs-identifier hs-type">TcM</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Maybe</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Language.Haskell.Syntax.Expr.html#HsExpr"><span class="hs-identifier hs-type">HsExpr</span></a></span><span> </span><span class="annot"><a href="GHC.Hs.Extension.html#GhcTc"><span class="hs-identifier hs-type">GhcTc</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.TcType.html#TcSigmaType"><span class="hs-identifier hs-type">TcSigmaType</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-566"></span><span class="hs-comment">-- See Note [Application chains and heads] in GHC.Tc.Gen.App</span><span>
</span><span id="line-567"></span><span class="hs-comment">-- Returns Nothing for a complicated head</span><span>
</span><span id="line-568"></span><span id="tcInferAppHead_maybe"><span class="annot"><span class="annottext">tcInferAppHead_maybe :: HsExpr (GhcPass 'Renamed)
-&gt; TcM (Maybe (HsExpr GhcTc, TcSigmaType))
</span><a href="GHC.Tc.Gen.Head.html#tcInferAppHead_maybe"><span class="hs-identifier hs-var hs-var">tcInferAppHead_maybe</span></a></span></span><span> </span><span id="local-6989586621683097715"><span class="annot"><span class="annottext">HsExpr (GhcPass 'Renamed)
</span><a href="#local-6989586621683097715"><span class="hs-identifier hs-var">fun</span></a></span></span><span>
</span><span id="line-569"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">HsExpr (GhcPass 'Renamed)
</span><a href="#local-6989586621683097715"><span class="hs-identifier hs-var">fun</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-570"></span><span>      </span><span class="annot"><a href="Language.Haskell.Syntax.Expr.html#HsVar"><span class="hs-identifier hs-type">HsVar</span></a></span><span> </span><span class="annot"><span class="annottext">XVar (GhcPass 'Renamed)
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Types.SrcLoc.html#L"><span class="hs-identifier hs-type">L</span></a></span><span> </span><span class="annot"><span class="annottext">SrcSpanAnnN
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621683097717"><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621683097717"><span class="hs-identifier hs-var">nm</span></a></span></span><span class="hs-special">)</span><span>          </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">(HsExpr GhcTc, TcSigmaType) -&gt; Maybe (HsExpr GhcTc, TcSigmaType)
forall a. a -&gt; Maybe a
</span><span class="hs-identifier hs-var">Just</span></span><span> </span><span class="annot"><span class="annottext">((HsExpr GhcTc, TcSigmaType) -&gt; Maybe (HsExpr GhcTc, TcSigmaType))
-&gt; TcM (HsExpr GhcTc, TcSigmaType)
-&gt; TcM (Maybe (HsExpr GhcTc, TcSigmaType))
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="annot"><span class="annottext">Name -&gt; TcM (HsExpr GhcTc, TcSigmaType)
</span><a href="GHC.Tc.Gen.Head.html#tcInferId"><span class="hs-identifier hs-var">tcInferId</span></a></span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621683097717"><span class="hs-identifier hs-var">nm</span></a></span><span>
</span><span id="line-571"></span><span>      </span><span class="annot"><a href="Language.Haskell.Syntax.Expr.html#XExpr"><span class="hs-identifier hs-type">XExpr</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Hs.Expr.html#HsRecSelRn"><span class="hs-identifier hs-type">HsRecSelRn</span></a></span><span> </span><span id="local-6989586621683097720"><span class="annot"><span class="annottext">FieldOcc (GhcPass 'Renamed)
</span><a href="#local-6989586621683097720"><span class="hs-identifier hs-var">f</span></a></span></span><span class="hs-special">)</span><span>      </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">(HsExpr GhcTc, TcSigmaType) -&gt; Maybe (HsExpr GhcTc, TcSigmaType)
forall a. a -&gt; Maybe a
</span><span class="hs-identifier hs-var">Just</span></span><span> </span><span class="annot"><span class="annottext">((HsExpr GhcTc, TcSigmaType) -&gt; Maybe (HsExpr GhcTc, TcSigmaType))
-&gt; TcM (HsExpr GhcTc, TcSigmaType)
-&gt; TcM (Maybe (HsExpr GhcTc, TcSigmaType))
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="annot"><span class="annottext">FieldOcc (GhcPass 'Renamed) -&gt; TcM (HsExpr GhcTc, TcSigmaType)
</span><a href="GHC.Tc.Gen.Head.html#tcInferRecSelId"><span class="hs-identifier hs-var">tcInferRecSelId</span></a></span><span> </span><span class="annot"><span class="annottext">FieldOcc (GhcPass 'Renamed)
</span><a href="#local-6989586621683097720"><span class="hs-identifier hs-var">f</span></a></span><span>
</span><span id="line-572"></span><span>      </span><span class="annot"><a href="Language.Haskell.Syntax.Expr.html#ExprWithTySig"><span class="hs-identifier hs-type">ExprWithTySig</span></a></span><span> </span><span class="annot"><span class="annottext">XExprWithTySig (GhcPass 'Renamed)
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621683097723"><span class="annot"><span class="annottext">LHsExpr (GhcPass 'Renamed)
</span><a href="#local-6989586621683097723"><span class="hs-identifier hs-var">e</span></a></span></span><span> </span><span id="local-6989586621683097724"><span class="annot"><span class="annottext">LHsSigWcType (NoGhcTc (GhcPass 'Renamed))
</span><a href="#local-6989586621683097724"><span class="hs-identifier hs-var">hs_ty</span></a></span></span><span>   </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">(HsExpr GhcTc, TcSigmaType) -&gt; Maybe (HsExpr GhcTc, TcSigmaType)
forall a. a -&gt; Maybe a
</span><span class="hs-identifier hs-var">Just</span></span><span> </span><span class="annot"><span class="annottext">((HsExpr GhcTc, TcSigmaType) -&gt; Maybe (HsExpr GhcTc, TcSigmaType))
-&gt; TcM (HsExpr GhcTc, TcSigmaType)
-&gt; TcM (Maybe (HsExpr GhcTc, TcSigmaType))
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="annot"><span class="annottext">LHsExpr (GhcPass 'Renamed)
-&gt; LHsSigWcType (NoGhcTc (GhcPass 'Renamed))
-&gt; TcM (HsExpr GhcTc, TcSigmaType)
</span><a href="GHC.Tc.Gen.Head.html#tcExprWithSig"><span class="hs-identifier hs-var">tcExprWithSig</span></a></span><span> </span><span class="annot"><span class="annottext">LHsExpr (GhcPass 'Renamed)
</span><a href="#local-6989586621683097723"><span class="hs-identifier hs-var">e</span></a></span><span> </span><span class="annot"><span class="annottext">LHsSigWcType (NoGhcTc (GhcPass 'Renamed))
</span><a href="#local-6989586621683097724"><span class="hs-identifier hs-var">hs_ty</span></a></span><span>
</span><span id="line-573"></span><span>      </span><span class="annot"><a href="Language.Haskell.Syntax.Expr.html#HsOverLit"><span class="hs-identifier hs-type">HsOverLit</span></a></span><span> </span><span class="annot"><span class="annottext">XOverLitE (GhcPass 'Renamed)
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621683097727"><span class="annot"><span class="annottext">HsOverLit (GhcPass 'Renamed)
</span><a href="#local-6989586621683097727"><span class="hs-identifier hs-var">lit</span></a></span></span><span>           </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">(HsExpr GhcTc, TcSigmaType) -&gt; Maybe (HsExpr GhcTc, TcSigmaType)
forall a. a -&gt; Maybe a
</span><span class="hs-identifier hs-var">Just</span></span><span> </span><span class="annot"><span class="annottext">((HsExpr GhcTc, TcSigmaType) -&gt; Maybe (HsExpr GhcTc, TcSigmaType))
-&gt; TcM (HsExpr GhcTc, TcSigmaType)
-&gt; TcM (Maybe (HsExpr GhcTc, TcSigmaType))
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="annot"><span class="annottext">HsOverLit (GhcPass 'Renamed) -&gt; TcM (HsExpr GhcTc, TcSigmaType)
</span><a href="GHC.Tc.Gen.Head.html#tcInferOverLit"><span class="hs-identifier hs-var">tcInferOverLit</span></a></span><span> </span><span class="annot"><span class="annottext">HsOverLit (GhcPass 'Renamed)
</span><a href="#local-6989586621683097727"><span class="hs-identifier hs-var">lit</span></a></span><span>
</span><span id="line-574"></span><span>      </span><span class="annot"><span class="annottext">HsExpr (GhcPass 'Renamed)
</span><span class="hs-identifier">_</span></span><span>                         </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Maybe (HsExpr GhcTc, TcSigmaType)
-&gt; TcM (Maybe (HsExpr GhcTc, TcSigmaType))
forall a. a -&gt; IOEnv (Env TcGblEnv TcLclEnv) a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="annot"><span class="annottext">Maybe (HsExpr GhcTc, TcSigmaType)
forall a. Maybe a
</span><span class="hs-identifier hs-var">Nothing</span></span><span>
</span><span id="line-575"></span><span>
</span><span id="line-576"></span><span id="local-6989586621683096992"><span class="annot"><a href="GHC.Tc.Gen.Head.html#addHeadCtxt"><span class="hs-identifier hs-type">addHeadCtxt</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Tc.Gen.Head.html#AppCtxt"><span class="hs-identifier hs-type">AppCtxt</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#TcM"><span class="hs-identifier hs-type">TcM</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683096992"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#TcM"><span class="hs-identifier hs-type">TcM</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683096992"><span class="hs-identifier hs-type">a</span></a></span></span><span>
</span><span id="line-577"></span><span id="addHeadCtxt"><span class="annot"><span class="annottext">addHeadCtxt :: forall a. AppCtxt -&gt; TcM a -&gt; TcM a
</span><a href="GHC.Tc.Gen.Head.html#addHeadCtxt"><span class="hs-identifier hs-var hs-var">addHeadCtxt</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Tc.Gen.Head.html#VAExpansion"><span class="hs-identifier hs-type">VAExpansion</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Hs.Expr.html#OrigStmt"><span class="hs-identifier hs-type">OrigStmt</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Types.SrcLoc.html#L"><span class="hs-identifier hs-type">L</span></a></span><span> </span><span id="local-6989586621683097729"><span class="annot"><span class="annottext">SrcSpanAnnA
</span><a href="#local-6989586621683097729"><span class="hs-identifier hs-var">loc</span></a></span></span><span> </span><span id="local-6989586621683097730"><span class="annot"><span class="annottext">StmtLR
  (GhcPass 'Renamed)
  (GhcPass 'Renamed)
  (GenLocated SrcSpanAnnA (HsExpr (GhcPass 'Renamed)))
</span><a href="#local-6989586621683097730"><span class="hs-identifier hs-var">stmt</span></a></span></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">SrcSpan
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">SrcSpan
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span> </span><span id="local-6989586621683097731"><span class="annot"><span class="annottext">TcM a
</span><a href="#local-6989586621683097731"><span class="hs-identifier hs-var">thing_inside</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-578"></span><span>  </span><span class="hs-keyword">do</span><span> </span><span class="annot"><span class="annottext">SrcSpanAnnA -&gt; TcM a -&gt; TcM a
forall ann a. EpAnn ann -&gt; TcRn a -&gt; TcRn a
</span><a href="GHC.Tc.Utils.Monad.html#setSrcSpanA"><span class="hs-identifier hs-var">setSrcSpanA</span></a></span><span> </span><span class="annot"><span class="annottext">SrcSpanAnnA
</span><a href="#local-6989586621683097729"><span class="hs-identifier hs-var">loc</span></a></span><span> </span><span class="annot"><span class="annottext">(TcM a -&gt; TcM a) -&gt; TcM a -&gt; TcM a
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-579"></span><span>       </span><span class="annot"><span class="annottext">ExprStmt (GhcPass 'Renamed) -&gt; TcM a -&gt; TcM a
forall a. ExprStmt (GhcPass 'Renamed) -&gt; TcRn a -&gt; TcRn a
</span><a href="GHC.Tc.Gen.Head.html#addStmtCtxt"><span class="hs-identifier hs-var">addStmtCtxt</span></a></span><span> </span><span class="annot"><span class="annottext">ExprStmt (GhcPass 'Renamed)
StmtLR
  (GhcPass 'Renamed)
  (GhcPass 'Renamed)
  (GenLocated SrcSpanAnnA (HsExpr (GhcPass 'Renamed)))
</span><a href="#local-6989586621683097730"><span class="hs-identifier hs-var">stmt</span></a></span><span>
</span><span id="line-580"></span><span>         </span><span class="annot"><span class="annottext">TcM a
</span><a href="#local-6989586621683097731"><span class="hs-identifier hs-var">thing_inside</span></a></span><span>
</span><span id="line-581"></span><span class="annot"><a href="GHC.Tc.Gen.Head.html#addHeadCtxt"><span class="hs-identifier hs-var">addHeadCtxt</span></a></span><span> </span><span id="local-6989586621683097733"><span class="annot"><span class="annottext">AppCtxt
</span><a href="#local-6989586621683097733"><span class="hs-identifier hs-var">fun_ctxt</span></a></span></span><span> </span><span id="local-6989586621683097734"><span class="annot"><span class="annottext">TcM a
</span><a href="#local-6989586621683097734"><span class="hs-identifier hs-var">thing_inside</span></a></span></span><span>
</span><span id="line-582"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Bool
</span><span class="hs-identifier hs-var">not</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">SrcSpan -&gt; Bool
</span><a href="GHC.Types.SrcLoc.html#isGoodSrcSpan"><span class="hs-identifier hs-var">isGoodSrcSpan</span></a></span><span> </span><span class="annot"><span class="annottext">SrcSpan
</span><a href="#local-6989586621683097737"><span class="hs-identifier hs-var">fun_loc</span></a></span><span class="hs-special">)</span><span>   </span><span class="hs-comment">-- noSrcSpan =&gt; no arguments</span><span>
</span><span id="line-583"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">TcM a
</span><a href="#local-6989586621683097734"><span class="hs-identifier hs-var">thing_inside</span></a></span><span>                  </span><span class="hs-comment">-- =&gt; context is already set</span><span>
</span><span id="line-584"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">otherwise</span></span><span>
</span><span id="line-585"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">SrcSpan -&gt; TcM a -&gt; TcM a
forall a. SrcSpan -&gt; TcRn a -&gt; TcRn a
</span><a href="GHC.Tc.Utils.Monad.html#setSrcSpan"><span class="hs-identifier hs-var">setSrcSpan</span></a></span><span> </span><span class="annot"><span class="annottext">SrcSpan
</span><a href="#local-6989586621683097737"><span class="hs-identifier hs-var">fun_loc</span></a></span><span> </span><span class="annot"><span class="annottext">(TcM a -&gt; TcM a) -&gt; TcM a -&gt; TcM a
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-586"></span><span>    </span><span class="hs-keyword">do</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">AppCtxt
</span><a href="#local-6989586621683097733"><span class="hs-identifier hs-var">fun_ctxt</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-587"></span><span>         </span><span class="annot"><a href="GHC.Tc.Gen.Head.html#VAExpansion"><span class="hs-identifier hs-type">VAExpansion</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Hs.Expr.html#OrigExpr"><span class="hs-identifier hs-type">OrigExpr</span></a></span><span> </span><span id="local-6989586621683097739"><span class="annot"><span class="annottext">HsExpr (GhcPass 'Renamed)
</span><a href="#local-6989586621683097739"><span class="hs-identifier hs-var">orig</span></a></span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">SrcSpan
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">SrcSpan
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">HsExpr (GhcPass 'Renamed) -&gt; TcM a -&gt; TcM a
forall a. HsExpr (GhcPass 'Renamed) -&gt; TcRn a -&gt; TcRn a
</span><a href="GHC.Tc.Gen.Head.html#addExprCtxt"><span class="hs-identifier hs-var">addExprCtxt</span></a></span><span> </span><span class="annot"><span class="annottext">HsExpr (GhcPass 'Renamed)
</span><a href="#local-6989586621683097739"><span class="hs-identifier hs-var">orig</span></a></span><span> </span><span class="annot"><span class="annottext">TcM a
</span><a href="#local-6989586621683097734"><span class="hs-identifier hs-var">thing_inside</span></a></span><span>
</span><span id="line-588"></span><span>         </span><span class="annot"><span class="annottext">AppCtxt
</span><span class="hs-identifier">_</span></span><span>                               </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">TcM a
</span><a href="#local-6989586621683097734"><span class="hs-identifier hs-var">thing_inside</span></a></span><span>
</span><span id="line-589"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-590"></span><span>    </span><span id="local-6989586621683097737"><span class="annot"><span class="annottext">fun_loc :: SrcSpan
</span><a href="#local-6989586621683097737"><span class="hs-identifier hs-var hs-var">fun_loc</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">AppCtxt -&gt; SrcSpan
</span><a href="GHC.Tc.Gen.Head.html#appCtxtLoc"><span class="hs-identifier hs-var">appCtxtLoc</span></a></span><span> </span><span class="annot"><span class="annottext">AppCtxt
</span><a href="#local-6989586621683097733"><span class="hs-identifier hs-var">fun_ctxt</span></a></span><span>
</span><span id="line-591"></span><span>
</span><span id="line-592"></span><span>
</span><span id="line-593"></span><span class="annot"><span class="hs-comment">{- *********************************************************************
*                                                                      *
                 Record selectors
*                                                                      *
********************************************************************* -}</span></span><span>
</span><span id="line-598"></span><span>
</span><span id="line-599"></span><span class="annot"><a href="GHC.Tc.Gen.Head.html#tcInferRecSelId"><span class="hs-identifier hs-type">tcInferRecSelId</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Language.Haskell.Syntax.Type.html#FieldOcc"><span class="hs-identifier hs-type">FieldOcc</span></a></span><span> </span><span class="annot"><a href="GHC.Hs.Extension.html#GhcRn"><span class="hs-identifier hs-type">GhcRn</span></a></span><span>
</span><span id="line-600"></span><span>                </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#TcM"><span class="hs-identifier hs-type">TcM</span></a></span><span> </span><span class="hs-special">(</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Language.Haskell.Syntax.Expr.html#HsExpr"><span class="hs-identifier hs-type">HsExpr</span></a></span><span> </span><span class="annot"><a href="GHC.Hs.Extension.html#GhcTc"><span class="hs-identifier hs-type">GhcTc</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.TcType.html#TcSigmaType"><span class="hs-identifier hs-type">TcSigmaType</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-601"></span><span id="tcInferRecSelId"><span class="annot"><span class="annottext">tcInferRecSelId :: FieldOcc (GhcPass 'Renamed) -&gt; TcM (HsExpr GhcTc, TcSigmaType)
</span><a href="GHC.Tc.Gen.Head.html#tcInferRecSelId"><span class="hs-identifier hs-var hs-var">tcInferRecSelId</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Language.Haskell.Syntax.Type.html#FieldOcc"><span class="hs-identifier hs-type">FieldOcc</span></a></span><span> </span><span id="local-6989586621683097741"><span class="annot"><span class="annottext">XCFieldOcc (GhcPass 'Renamed)
</span><a href="#local-6989586621683097741"><span class="hs-identifier hs-var">lbl</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Types.SrcLoc.html#L"><span class="hs-identifier hs-type">L</span></a></span><span> </span><span id="local-6989586621683097742"><span class="annot"><span class="annottext">SrcSpanAnnN
</span><a href="#local-6989586621683097742"><span class="hs-identifier hs-var">l</span></a></span></span><span> </span><span id="local-6989586621683097743"><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621683097743"><span class="hs-identifier hs-var">sel_name</span></a></span></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-602"></span><span>     </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span id="local-6989586621683097744"><span class="annot"><a href="#local-6989586621683097744"><span class="hs-identifier hs-var">sel_id</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">TcM Var
</span><a href="#local-6989586621683097745"><span class="hs-identifier hs-var">tc_rec_sel_id</span></a></span><span>
</span><span id="line-603"></span><span>        </span><span class="hs-special">;</span><span> </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621683097746"><span class="annot"><a href="#local-6989586621683097746"><span class="hs-identifier hs-var hs-var">expr</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">XXExpr GhcTc -&gt; HsExpr GhcTc
forall p. XXExpr p -&gt; HsExpr p
</span><a href="Language.Haskell.Syntax.Expr.html#XExpr"><span class="hs-identifier hs-var">XExpr</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">FieldOcc GhcTc -&gt; XXExprGhcTc
</span><a href="GHC.Hs.Expr.html#HsRecSelTc"><span class="hs-identifier hs-var">HsRecSelTc</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">XCFieldOcc GhcTc -&gt; LIdP GhcTc -&gt; FieldOcc GhcTc
forall pass. XCFieldOcc pass -&gt; LIdP pass -&gt; FieldOcc pass
</span><a href="Language.Haskell.Syntax.Type.html#FieldOcc"><span class="hs-identifier hs-var">FieldOcc</span></a></span><span> </span><span class="annot"><span class="annottext">XCFieldOcc (GhcPass 'Renamed)
XCFieldOcc GhcTc
</span><a href="#local-6989586621683097741"><span class="hs-identifier hs-var">lbl</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">SrcSpanAnnN -&gt; Var -&gt; GenLocated SrcSpanAnnN Var
forall l e. l -&gt; e -&gt; GenLocated l e
</span><a href="GHC.Types.SrcLoc.html#L"><span class="hs-identifier hs-var">L</span></a></span><span> </span><span class="annot"><span class="annottext">SrcSpanAnnN
</span><a href="#local-6989586621683097742"><span class="hs-identifier hs-var">l</span></a></span><span> </span><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621683097744"><span class="hs-identifier hs-var">sel_id</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-604"></span><span>        </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">return</span></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621683097746"><span class="hs-identifier hs-type">expr</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Types.Id.html#idType"><span class="hs-identifier hs-type">idType</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683097744"><span class="hs-identifier hs-type">sel_id</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-605"></span><span>        </span><span class="hs-special">}</span><span>
</span><span id="line-606"></span><span>     </span><span class="hs-keyword">where</span><span>
</span><span id="line-607"></span><span>       </span><span class="annot"><a href="#local-6989586621683097749"><span class="hs-identifier hs-type">occ</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Types.Name.Occurrence.html#OccName"><span class="hs-identifier hs-type">OccName</span></a></span><span>
</span><span id="line-608"></span><span>       </span><span id="local-6989586621683097749"><span class="annot"><span class="annottext">occ :: OccName
</span><a href="#local-6989586621683097749"><span class="hs-identifier hs-var hs-var">occ</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Name -&gt; OccName
</span><a href="GHC.Types.Name.html#nameOccName"><span class="hs-identifier hs-var">nameOccName</span></a></span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621683097743"><span class="hs-identifier hs-var">sel_name</span></a></span><span>
</span><span id="line-609"></span><span>       </span><span class="annot"><a href="#local-6989586621683097745"><span class="hs-identifier hs-type">tc_rec_sel_id</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#TcM"><span class="hs-identifier hs-type">TcM</span></a></span><span> </span><span class="annot"><a href="GHC.Tc.Types.BasicTypes.html#TcId"><span class="hs-identifier hs-type">TcId</span></a></span><span>
</span><span id="line-610"></span><span>       </span><span class="hs-comment">-- Like tc_infer_id, but returns an Id not a HsExpr,</span><span>
</span><span id="line-611"></span><span>       </span><span class="hs-comment">-- so we can wrap it back up into a HsRecSel</span><span>
</span><span id="line-612"></span><span>       </span><span id="local-6989586621683097745"><span class="annot"><span class="annottext">tc_rec_sel_id :: TcM Var
</span><a href="#local-6989586621683097745"><span class="hs-identifier hs-var hs-var">tc_rec_sel_id</span></a></span></span><span>
</span><span id="line-613"></span><span>         </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span id="local-6989586621683097752"><span class="annot"><a href="#local-6989586621683097752"><span class="hs-identifier hs-var">thing</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Name -&gt; TcM TcTyThing
</span><a href="GHC.Tc.Utils.Env.html#tcLookup"><span class="hs-identifier hs-var">tcLookup</span></a></span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621683097743"><span class="hs-identifier hs-var">sel_name</span></a></span><span>
</span><span id="line-614"></span><span>              </span><span class="hs-special">;</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><a href="#local-6989586621683097752"><span class="hs-identifier hs-type">thing</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-615"></span><span>                    </span><span class="annot"><a href="GHC.Tc.Types.BasicTypes.html#ATcId"><span class="hs-identifier hs-type">ATcId</span></a></span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">tct_id :: TcTyThing -&gt; Var
</span><a href="GHC.Tc.Types.BasicTypes.html#tct_id"><span class="hs-identifier hs-var">tct_id</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="local-6989586621683097756"><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621683097756"><span class="hs-identifier hs-var">id</span></a></span></span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-616"></span><span>                      </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">OccName -&gt; Var -&gt; TcM ()
</span><a href="GHC.Tc.Gen.Head.html#check_naughty"><span class="hs-identifier hs-var">check_naughty</span></a></span><span> </span><span class="annot"><span class="annottext">OccName
</span><a href="#local-6989586621683097749"><span class="hs-identifier hs-var">occ</span></a></span><span> </span><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621683097756"><span class="hs-identifier hs-var">id</span></a></span><span>  </span><span class="hs-comment">-- See Note [Local record selectors]</span><span>
</span><span id="line-617"></span><span>                            </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="annottext">Var -&gt; TcM ()
</span><a href="GHC.Tc.Gen.Head.html#check_local_id"><span class="hs-identifier hs-var">check_local_id</span></a></span><span> </span><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621683097756"><span class="hs-identifier hs-var">id</span></a></span><span>
</span><span id="line-618"></span><span>                            </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="annottext">Var -&gt; TcM Var
forall a. a -&gt; IOEnv (Env TcGblEnv TcLclEnv) a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621683097756"><span class="hs-identifier hs-var">id</span></a></span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-619"></span><span>
</span><span id="line-620"></span><span>                    </span><span class="annot"><a href="GHC.Tc.Types.BasicTypes.html#AGlobal"><span class="hs-identifier hs-type">AGlobal</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Types.TyThing.html#AnId"><span class="hs-identifier hs-type">AnId</span></a></span><span> </span><span id="local-6989586621683097761"><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621683097761"><span class="hs-identifier hs-var">id</span></a></span></span><span class="hs-special">)</span><span>
</span><span id="line-621"></span><span>                      </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">OccName -&gt; Var -&gt; TcM ()
</span><a href="GHC.Tc.Gen.Head.html#check_naughty"><span class="hs-identifier hs-var">check_naughty</span></a></span><span> </span><span class="annot"><span class="annottext">OccName
</span><a href="#local-6989586621683097749"><span class="hs-identifier hs-var">occ</span></a></span><span> </span><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621683097761"><span class="hs-identifier hs-var">id</span></a></span><span>
</span><span id="line-622"></span><span>                            </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="annottext">Var -&gt; TcM Var
forall a. a -&gt; IOEnv (Env TcGblEnv TcLclEnv) a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621683097761"><span class="hs-identifier hs-var">id</span></a></span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-623"></span><span>                           </span><span class="hs-comment">-- A global cannot possibly be ill-staged</span><span>
</span><span id="line-624"></span><span>                           </span><span class="hs-comment">-- nor does it need the 'lifting' treatment</span><span>
</span><span id="line-625"></span><span>                           </span><span class="hs-comment">-- hence no checkTh stuff here</span><span>
</span><span id="line-626"></span><span>
</span><span id="line-627"></span><span>                    </span><span class="annot"><span class="annottext">TcTyThing
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">TcRnMessage -&gt; TcM Var
forall a. TcRnMessage -&gt; TcM a
</span><a href="GHC.Tc.Utils.Monad.html#failWithTc"><span class="hs-identifier hs-var">failWithTc</span></a></span><span> </span><span class="annot"><span class="annottext">(TcRnMessage -&gt; TcM Var) -&gt; TcRnMessage -&gt; TcM Var
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">TcTyThing -&gt; TcRnMessage
</span><a href="GHC.Tc.Errors.Types.html#TcRnExpectedValueId"><span class="hs-identifier hs-var">TcRnExpectedValueId</span></a></span><span> </span><span class="annot"><span class="annottext">TcTyThing
</span><a href="#local-6989586621683097752"><span class="hs-identifier hs-var">thing</span></a></span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-628"></span><span>
</span><span id="line-629"></span><span class="hs-comment">------------------------</span><span>
</span><span id="line-630"></span><span>
</span><span id="line-631"></span><span class="hs-comment">-- A type signature on the argument of an ambiguous record selector or</span><span>
</span><span id="line-632"></span><span class="hs-comment">-- the record expression in an update must be &quot;obvious&quot;, i.e. the</span><span>
</span><span id="line-633"></span><span class="hs-comment">-- outermost constructor ignoring parentheses.</span><span>
</span><span id="line-634"></span><span class="annot"><a href="GHC.Tc.Gen.Head.html#obviousSig"><span class="hs-identifier hs-type">obviousSig</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Language.Haskell.Syntax.Expr.html#HsExpr"><span class="hs-identifier hs-type">HsExpr</span></a></span><span> </span><span class="annot"><a href="GHC.Hs.Extension.html#GhcRn"><span class="hs-identifier hs-type">GhcRn</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Maybe</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Language.Haskell.Syntax.Type.html#LHsSigWcType"><span class="hs-identifier hs-type">LHsSigWcType</span></a></span><span> </span><span class="annot"><a href="GHC.Hs.Extension.html#GhcRn"><span class="hs-identifier hs-type">GhcRn</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-635"></span><span id="obviousSig"><span class="annot"><span class="annottext">obviousSig :: HsExpr (GhcPass 'Renamed)
-&gt; Maybe (LHsSigWcType (GhcPass 'Renamed))
</span><a href="GHC.Tc.Gen.Head.html#obviousSig"><span class="hs-identifier hs-var hs-var">obviousSig</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Language.Haskell.Syntax.Expr.html#ExprWithTySig"><span class="hs-identifier hs-type">ExprWithTySig</span></a></span><span> </span><span class="annot"><span class="annottext">XExprWithTySig (GhcPass 'Renamed)
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">LHsExpr (GhcPass 'Renamed)
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621683097764"><span class="annot"><span class="annottext">LHsSigWcType (NoGhcTc (GhcPass 'Renamed))
</span><a href="#local-6989586621683097764"><span class="hs-identifier hs-var">ty</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">HsWildCardBndrs
  (GhcPass 'Renamed)
  (GenLocated SrcSpanAnnA (HsSigType (GhcPass 'Renamed)))
-&gt; Maybe
     (HsWildCardBndrs
        (GhcPass 'Renamed)
        (GenLocated SrcSpanAnnA (HsSigType (GhcPass 'Renamed))))
forall a. a -&gt; Maybe a
</span><span class="hs-identifier hs-var">Just</span></span><span> </span><span class="annot"><span class="annottext">LHsSigWcType (NoGhcTc (GhcPass 'Renamed))
HsWildCardBndrs
  (GhcPass 'Renamed)
  (GenLocated SrcSpanAnnA (HsSigType (GhcPass 'Renamed)))
</span><a href="#local-6989586621683097764"><span class="hs-identifier hs-var">ty</span></a></span><span>
</span><span id="line-636"></span><span class="annot"><a href="GHC.Tc.Gen.Head.html#obviousSig"><span class="hs-identifier hs-var">obviousSig</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Language.Haskell.Syntax.Expr.html#HsPar"><span class="hs-identifier hs-type">HsPar</span></a></span><span> </span><span class="annot"><span class="annottext">XPar (GhcPass 'Renamed)
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621683097765"><span class="annot"><span class="annottext">LHsExpr (GhcPass 'Renamed)
</span><a href="#local-6989586621683097765"><span class="hs-identifier hs-var">p</span></a></span></span><span class="hs-special">)</span><span>            </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">HsExpr (GhcPass 'Renamed)
-&gt; Maybe (LHsSigWcType (GhcPass 'Renamed))
</span><a href="GHC.Tc.Gen.Head.html#obviousSig"><span class="hs-identifier hs-var">obviousSig</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">GenLocated SrcSpanAnnA (HsExpr (GhcPass 'Renamed))
-&gt; HsExpr (GhcPass 'Renamed)
forall l e. GenLocated l e -&gt; e
</span><a href="GHC.Types.SrcLoc.html#unLoc"><span class="hs-identifier hs-var">unLoc</span></a></span><span> </span><span class="annot"><span class="annottext">LHsExpr (GhcPass 'Renamed)
GenLocated SrcSpanAnnA (HsExpr (GhcPass 'Renamed))
</span><a href="#local-6989586621683097765"><span class="hs-identifier hs-var">p</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-637"></span><span class="annot"><a href="GHC.Tc.Gen.Head.html#obviousSig"><span class="hs-identifier hs-var">obviousSig</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Language.Haskell.Syntax.Expr.html#HsPragE"><span class="hs-identifier hs-type">HsPragE</span></a></span><span> </span><span class="annot"><span class="annottext">XPragE (GhcPass 'Renamed)
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">HsPragE (GhcPass 'Renamed)
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621683097767"><span class="annot"><span class="annottext">LHsExpr (GhcPass 'Renamed)
</span><a href="#local-6989586621683097767"><span class="hs-identifier hs-var">p</span></a></span></span><span class="hs-special">)</span><span>        </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">HsExpr (GhcPass 'Renamed)
-&gt; Maybe (LHsSigWcType (GhcPass 'Renamed))
</span><a href="GHC.Tc.Gen.Head.html#obviousSig"><span class="hs-identifier hs-var">obviousSig</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">GenLocated SrcSpanAnnA (HsExpr (GhcPass 'Renamed))
-&gt; HsExpr (GhcPass 'Renamed)
forall l e. GenLocated l e -&gt; e
</span><a href="GHC.Types.SrcLoc.html#unLoc"><span class="hs-identifier hs-var">unLoc</span></a></span><span> </span><span class="annot"><span class="annottext">LHsExpr (GhcPass 'Renamed)
GenLocated SrcSpanAnnA (HsExpr (GhcPass 'Renamed))
</span><a href="#local-6989586621683097767"><span class="hs-identifier hs-var">p</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-638"></span><span class="annot"><a href="GHC.Tc.Gen.Head.html#obviousSig"><span class="hs-identifier hs-var">obviousSig</span></a></span><span> </span><span class="annot"><span class="annottext">HsExpr (GhcPass 'Renamed)
</span><span class="hs-identifier">_</span></span><span>                      </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Maybe (LHsSigWcType (GhcPass 'Renamed))
Maybe
  (HsWildCardBndrs
     (GhcPass 'Renamed)
     (GenLocated SrcSpanAnnA (HsSigType (GhcPass 'Renamed))))
forall a. Maybe a
</span><span class="hs-identifier hs-var">Nothing</span></span><span>
</span><span id="line-639"></span><span>
</span><span id="line-640"></span><span class="hs-comment">-- Extract the outermost TyCon of a type, if there is one; for</span><span>
</span><span id="line-641"></span><span class="hs-comment">-- data families this is the representation tycon (because that's</span><span>
</span><span id="line-642"></span><span class="hs-comment">-- where the fields live).</span><span>
</span><span id="line-643"></span><span class="annot"><a href="GHC.Tc.Gen.Head.html#tyConOf"><span class="hs-identifier hs-type">tyConOf</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Core.FamInstEnv.html#FamInstEnvs"><span class="hs-identifier hs-type">FamInstEnvs</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.TcType.html#TcSigmaType"><span class="hs-identifier hs-type">TcSigmaType</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Maybe</span></span><span> </span><span class="annot"><a href="GHC.Core.TyCon.html#TyCon"><span class="hs-identifier hs-type">TyCon</span></a></span><span>
</span><span id="line-644"></span><span id="tyConOf"><span class="annot"><span class="annottext">tyConOf :: FamInstEnvs -&gt; TcSigmaType -&gt; Maybe TyCon
</span><a href="GHC.Tc.Gen.Head.html#tyConOf"><span class="hs-identifier hs-var hs-var">tyConOf</span></a></span></span><span> </span><span id="local-6989586621683097768"><span class="annot"><span class="annottext">FamInstEnvs
</span><a href="#local-6989586621683097768"><span class="hs-identifier hs-var">fam_inst_envs</span></a></span></span><span> </span><span id="local-6989586621683097769"><span class="annot"><span class="annottext">TcSigmaType
</span><a href="#local-6989586621683097769"><span class="hs-identifier hs-var">ty0</span></a></span></span><span>
</span><span id="line-645"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">HasDebugCallStack =&gt; TcSigmaType -&gt; Maybe (TyCon, [TcSigmaType])
TcSigmaType -&gt; Maybe (TyCon, [TcSigmaType])
</span><a href="GHC.Core.Type.html#tcSplitTyConApp_maybe"><span class="hs-identifier hs-var">tcSplitTyConApp_maybe</span></a></span><span> </span><span class="annot"><span class="annottext">TcSigmaType
</span><a href="#local-6989586621683097771"><span class="hs-identifier hs-var">ty</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-646"></span><span>      </span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span class="hs-special">(</span><span id="local-6989586621683097772"><span class="annot"><span class="annottext">TyCon
</span><a href="#local-6989586621683097772"><span class="hs-identifier hs-var">tc</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621683097773"><span class="annot"><span class="annottext">[TcSigmaType]
</span><a href="#local-6989586621683097773"><span class="hs-identifier hs-var">tys</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">TyCon -&gt; Maybe TyCon
forall a. a -&gt; Maybe a
</span><span class="hs-identifier hs-var">Just</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(TyCon, [TcSigmaType], Coercion) -&gt; TyCon
forall a b c. (a, b, c) -&gt; a
</span><a href="GHC.Utils.Misc.html#fstOf3"><span class="hs-identifier hs-var">fstOf3</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">FamInstEnvs
-&gt; TyCon -&gt; [TcSigmaType] -&gt; (TyCon, [TcSigmaType], Coercion)
</span><a href="GHC.Tc.Instance.Family.html#tcLookupDataFamInst"><span class="hs-identifier hs-var">tcLookupDataFamInst</span></a></span><span> </span><span class="annot"><span class="annottext">FamInstEnvs
</span><a href="#local-6989586621683097768"><span class="hs-identifier hs-var">fam_inst_envs</span></a></span><span> </span><span class="annot"><span class="annottext">TyCon
</span><a href="#local-6989586621683097772"><span class="hs-identifier hs-var">tc</span></a></span><span> </span><span class="annot"><span class="annottext">[TcSigmaType]
</span><a href="#local-6989586621683097773"><span class="hs-identifier hs-var">tys</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-647"></span><span>      </span><span class="annot"><span class="annottext">Maybe (TyCon, [TcSigmaType])
</span><span class="hs-identifier hs-var">Nothing</span></span><span>        </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Maybe TyCon
forall a. Maybe a
</span><span class="hs-identifier hs-var">Nothing</span></span><span>
</span><span id="line-648"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-649"></span><span>    </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[Var]
</span><span class="hs-identifier">_</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">[TcSigmaType]
</span><span class="hs-identifier">_</span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621683097771"><span class="annot"><span class="annottext">TcSigmaType
</span><a href="#local-6989586621683097771"><span class="hs-identifier hs-var">ty</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">TcSigmaType -&gt; ([Var], [TcSigmaType], TcSigmaType)
</span><a href="GHC.Tc.Utils.TcType.html#tcSplitSigmaTy"><span class="hs-identifier hs-var">tcSplitSigmaTy</span></a></span><span> </span><span class="annot"><span class="annottext">TcSigmaType
</span><a href="#local-6989586621683097769"><span class="hs-identifier hs-var">ty0</span></a></span><span>
</span><span id="line-650"></span><span>
</span><span id="line-651"></span><span class="hs-comment">-- Variant of tyConOf that works for ExpTypes</span><span>
</span><span id="line-652"></span><span class="annot"><a href="GHC.Tc.Gen.Head.html#tyConOfET"><span class="hs-identifier hs-type">tyConOfET</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Core.FamInstEnv.html#FamInstEnvs"><span class="hs-identifier hs-type">FamInstEnvs</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.TcType.html#ExpRhoType"><span class="hs-identifier hs-type">ExpRhoType</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Maybe</span></span><span> </span><span class="annot"><a href="GHC.Core.TyCon.html#TyCon"><span class="hs-identifier hs-type">TyCon</span></a></span><span>
</span><span id="line-653"></span><span id="tyConOfET"><span class="annot"><span class="annottext">tyConOfET :: FamInstEnvs -&gt; ExpRhoType -&gt; Maybe TyCon
</span><a href="GHC.Tc.Gen.Head.html#tyConOfET"><span class="hs-identifier hs-var hs-var">tyConOfET</span></a></span></span><span> </span><span id="local-6989586621683097776"><span class="annot"><span class="annottext">FamInstEnvs
</span><a href="#local-6989586621683097776"><span class="hs-identifier hs-var">fam_inst_envs</span></a></span></span><span> </span><span id="local-6989586621683097777"><span class="annot"><span class="annottext">ExpRhoType
</span><a href="#local-6989586621683097777"><span class="hs-identifier hs-var">ty0</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">FamInstEnvs -&gt; TcSigmaType -&gt; Maybe TyCon
</span><a href="GHC.Tc.Gen.Head.html#tyConOf"><span class="hs-identifier hs-var">tyConOf</span></a></span><span> </span><span class="annot"><span class="annottext">FamInstEnvs
</span><a href="#local-6989586621683097776"><span class="hs-identifier hs-var">fam_inst_envs</span></a></span><span> </span><span class="annot"><span class="annottext">(TcSigmaType -&gt; Maybe TyCon) -&gt; Maybe TcSigmaType -&gt; Maybe TyCon
forall (m :: * -&gt; *) a b. Monad m =&gt; (a -&gt; m b) -&gt; m a -&gt; m b
</span><span class="hs-operator hs-var">=&lt;&lt;</span></span><span> </span><span class="annot"><span class="annottext">ExpRhoType -&gt; Maybe TcSigmaType
</span><a href="GHC.Tc.Utils.TcType.html#checkingExpType_maybe"><span class="hs-identifier hs-var">checkingExpType_maybe</span></a></span><span> </span><span class="annot"><span class="annottext">ExpRhoType
</span><a href="#local-6989586621683097777"><span class="hs-identifier hs-var">ty0</span></a></span><span>
</span><span id="line-654"></span><span>
</span><span id="line-655"></span><span class="annot"><a href="GHC.Tc.Gen.Head.html#fieldNotInType"><span class="hs-identifier hs-type">fieldNotInType</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Types.Id.Info.html#RecSelParent"><span class="hs-identifier hs-type">RecSelParent</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Types.Name.Reader.html#RdrName"><span class="hs-identifier hs-type">RdrName</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Errors.Types.html#TcRnMessage"><span class="hs-identifier hs-type">TcRnMessage</span></a></span><span>
</span><span id="line-656"></span><span id="fieldNotInType"><span class="annot"><span class="annottext">fieldNotInType :: RecSelParent -&gt; RdrName -&gt; TcRnMessage
</span><a href="GHC.Tc.Gen.Head.html#fieldNotInType"><span class="hs-identifier hs-var hs-var">fieldNotInType</span></a></span></span><span> </span><span id="local-6989586621683097780"><span class="annot"><span class="annottext">RecSelParent
</span><a href="#local-6989586621683097780"><span class="hs-identifier hs-var">p</span></a></span></span><span> </span><span id="local-6989586621683097781"><span class="annot"><span class="annottext">RdrName
</span><a href="#local-6989586621683097781"><span class="hs-identifier hs-var">rdr</span></a></span></span><span>
</span><span id="line-657"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">RdrName -&gt; NotInScopeError -&gt; TcRnMessage
</span><a href="GHC.Tc.Errors.Types.html#mkTcRnNotInScope"><span class="hs-identifier hs-var">mkTcRnNotInScope</span></a></span><span> </span><span class="annot"><span class="annottext">RdrName
</span><a href="#local-6989586621683097781"><span class="hs-identifier hs-var">rdr</span></a></span><span> </span><span class="annot"><span class="annottext">(NotInScopeError -&gt; TcRnMessage) -&gt; NotInScopeError -&gt; TcRnMessage
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-658"></span><span>    </span><span class="annot"><span class="annottext">SDoc -&gt; NotInScopeError
</span><a href="GHC.Tc.Errors.Types.html#UnknownSubordinate"><span class="hs-identifier hs-var">UnknownSubordinate</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">String -&gt; SDoc
forall doc. IsLine doc =&gt; String -&gt; doc
</span><a href="GHC.Utils.Outputable.html#text"><span class="hs-identifier hs-var">text</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;field of type&quot;</span></span><span> </span><span class="annot"><span class="annottext">SDoc -&gt; SDoc -&gt; SDoc
forall doc. IsLine doc =&gt; doc -&gt; doc -&gt; doc
</span><a href="GHC.Utils.Outputable.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">SDoc -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#quotes"><span class="hs-identifier hs-var">quotes</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">RecSelParent -&gt; SDoc
forall a. Outputable a =&gt; a -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="annot"><span class="annottext">RecSelParent
</span><a href="#local-6989586621683097780"><span class="hs-identifier hs-var">p</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-659"></span><span>
</span><span id="line-660"></span><span>
</span><span id="line-661"></span><span class="annot"><span class="hs-comment">{- *********************************************************************
*                                                                      *
                Expressions with a type signature
                        expr :: type
*                                                                      *
********************************************************************* -}</span></span><span>
</span><span id="line-667"></span><span>
</span><span id="line-668"></span><span class="annot"><a href="GHC.Tc.Gen.Head.html#tcExprWithSig"><span class="hs-identifier hs-type">tcExprWithSig</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Language.Haskell.Syntax.Expr.html#LHsExpr"><span class="hs-identifier hs-type">LHsExpr</span></a></span><span> </span><span class="annot"><a href="GHC.Hs.Extension.html#GhcRn"><span class="hs-identifier hs-type">GhcRn</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Language.Haskell.Syntax.Type.html#LHsSigWcType"><span class="hs-identifier hs-type">LHsSigWcType</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Language.Haskell.Syntax.Extension.html#NoGhcTc"><span class="hs-identifier hs-type">NoGhcTc</span></a></span><span> </span><span class="annot"><a href="GHC.Hs.Extension.html#GhcRn"><span class="hs-identifier hs-type">GhcRn</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-669"></span><span>              </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#TcM"><span class="hs-identifier hs-type">TcM</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Language.Haskell.Syntax.Expr.html#HsExpr"><span class="hs-identifier hs-type">HsExpr</span></a></span><span> </span><span class="annot"><a href="GHC.Hs.Extension.html#GhcTc"><span class="hs-identifier hs-type">GhcTc</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.TcType.html#TcSigmaType"><span class="hs-identifier hs-type">TcSigmaType</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-670"></span><span id="tcExprWithSig"><span class="annot"><span class="annottext">tcExprWithSig :: LHsExpr (GhcPass 'Renamed)
-&gt; LHsSigWcType (NoGhcTc (GhcPass 'Renamed))
-&gt; TcM (HsExpr GhcTc, TcSigmaType)
</span><a href="GHC.Tc.Gen.Head.html#tcExprWithSig"><span class="hs-identifier hs-var hs-var">tcExprWithSig</span></a></span></span><span> </span><span id="local-6989586621683097785"><span class="annot"><span class="annottext">LHsExpr (GhcPass 'Renamed)
</span><a href="#local-6989586621683097785"><span class="hs-identifier hs-var">expr</span></a></span></span><span> </span><span id="local-6989586621683097786"><span class="annot"><span class="annottext">LHsSigWcType (NoGhcTc (GhcPass 'Renamed))
</span><a href="#local-6989586621683097786"><span class="hs-identifier hs-var">hs_ty</span></a></span></span><span>
</span><span id="line-671"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span id="local-6989586621683097787"><span class="annot"><a href="#local-6989586621683097787"><span class="hs-identifier hs-var">sig_info</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">TcM TcIdSig -&gt; TcM TcIdSig
forall r. TcM r -&gt; TcM r
</span><a href="GHC.Tc.Utils.Monad.html#checkNoErrs"><span class="hs-identifier hs-var">checkNoErrs</span></a></span><span> </span><span class="annot"><span class="annottext">(TcM TcIdSig -&gt; TcM TcIdSig) -&gt; TcM TcIdSig -&gt; TcM TcIdSig
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>  </span><span class="hs-comment">-- Avoid error cascade</span><span>
</span><span id="line-672"></span><span>                     </span><span class="annot"><span class="annottext">SrcSpan
-&gt; LHsSigWcType (GhcPass 'Renamed) -&gt; Maybe Name -&gt; TcM TcIdSig
</span><a href="GHC.Tc.Gen.Sig.html#tcUserTypeSig"><span class="hs-identifier hs-var">tcUserTypeSig</span></a></span><span> </span><span class="annot"><span class="annottext">SrcSpan
</span><a href="#local-6989586621683097789"><span class="hs-identifier hs-var">loc</span></a></span><span> </span><span class="annot"><span class="annottext">LHsSigWcType (NoGhcTc (GhcPass 'Renamed))
LHsSigWcType (GhcPass 'Renamed)
</span><a href="#local-6989586621683097786"><span class="hs-identifier hs-var">hs_ty</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe Name
forall a. Maybe a
</span><span class="hs-identifier hs-var">Nothing</span></span><span>
</span><span id="line-673"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="hs-special">(</span><span id="local-6989586621683097790"><span class="annot"><a href="#local-6989586621683097790"><span class="hs-identifier hs-var">expr'</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621683097791"><span class="annot"><a href="#local-6989586621683097791"><span class="hs-identifier hs-var">poly_ty</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><a href="GHC.Tc.Gen.Head.html#tcExprSig"><span class="hs-identifier hs-type">tcExprSig</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683097785"><span class="hs-identifier hs-type">expr</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683097787"><span class="hs-identifier hs-type">sig_info</span></a></span><span>
</span><span id="line-674"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">return</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Language.Haskell.Syntax.Expr.html#ExprWithTySig"><span class="hs-identifier hs-type">ExprWithTySig</span></a></span><span> </span><span class="annot"><a href="Language.Haskell.Syntax.Extension.html#noExtField"><span class="hs-identifier hs-type">noExtField</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683097790"><span class="hs-identifier hs-type">expr'</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683097786"><span class="hs-identifier hs-type">hs_ty</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="#local-6989586621683097791"><span class="hs-identifier hs-type">poly_ty</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-675"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-676"></span><span>    </span><span id="local-6989586621683097789"><span class="annot"><span class="annottext">loc :: SrcSpan
</span><a href="#local-6989586621683097789"><span class="hs-identifier hs-var hs-var">loc</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">GenLocated SrcSpanAnnA (HsSigType (GhcPass 'Renamed)) -&gt; SrcSpan
forall a e. HasLoc a =&gt; GenLocated a e -&gt; SrcSpan
</span><a href="GHC.Parser.Annotation.html#getLocA"><span class="hs-identifier hs-var">getLocA</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">LHsSigWcType (GhcPass 'Renamed) -&gt; LHsSigType (GhcPass 'Renamed)
forall pass. LHsSigWcType pass -&gt; LHsSigType pass
</span><a href="GHC.Hs.Type.html#dropWildCards"><span class="hs-identifier hs-var">dropWildCards</span></a></span><span> </span><span class="annot"><span class="annottext">LHsSigWcType (NoGhcTc (GhcPass 'Renamed))
LHsSigWcType (GhcPass 'Renamed)
</span><a href="#local-6989586621683097786"><span class="hs-identifier hs-var">hs_ty</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-677"></span><span>
</span><span id="line-678"></span><span class="annot"><a href="GHC.Tc.Gen.Head.html#tcExprSig"><span class="hs-identifier hs-type">tcExprSig</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Language.Haskell.Syntax.Expr.html#LHsExpr"><span class="hs-identifier hs-type">LHsExpr</span></a></span><span> </span><span class="annot"><a href="GHC.Hs.Extension.html#GhcRn"><span class="hs-identifier hs-type">GhcRn</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.BasicTypes.html#TcIdSig"><span class="hs-identifier hs-type">TcIdSig</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#TcM"><span class="hs-identifier hs-type">TcM</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Language.Haskell.Syntax.Expr.html#LHsExpr"><span class="hs-identifier hs-type">LHsExpr</span></a></span><span> </span><span class="annot"><a href="GHC.Hs.Extension.html#GhcTc"><span class="hs-identifier hs-type">GhcTc</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.TcType.html#TcSigmaType"><span class="hs-identifier hs-type">TcSigmaType</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-679"></span><span id="tcExprSig"><span class="annot"><span class="annottext">tcExprSig :: LHsExpr (GhcPass 'Renamed)
-&gt; TcIdSig -&gt; TcM (LHsExpr GhcTc, TcSigmaType)
</span><a href="GHC.Tc.Gen.Head.html#tcExprSig"><span class="hs-identifier hs-var hs-var">tcExprSig</span></a></span></span><span> </span><span id="local-6989586621683097795"><span class="annot"><span class="annottext">LHsExpr (GhcPass 'Renamed)
</span><a href="#local-6989586621683097795"><span class="hs-identifier hs-var">expr</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Tc.Types.BasicTypes.html#TcCompleteSig"><span class="hs-identifier hs-type">TcCompleteSig</span></a></span><span> </span><span id="local-6989586621683097797"><span class="annot"><span class="annottext">TcCompleteSig
</span><a href="#local-6989586621683097797"><span class="hs-identifier hs-var">sig</span></a></span></span><span class="hs-special">)</span><span>
</span><span id="line-680"></span><span>   </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span id="local-6989586621683097798"><span class="annot"><a href="#local-6989586621683097798"><span class="hs-identifier hs-var">expr'</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">LHsExpr (GhcPass 'Renamed) -&gt; TcCompleteSig -&gt; TcM (LHsExpr GhcTc)
</span><a href="GHC.Tc.Gen.Expr.html#tcPolyLExprSig"><span class="hs-identifier hs-var">tcPolyLExprSig</span></a></span><span> </span><span class="annot"><span class="annottext">LHsExpr (GhcPass 'Renamed)
</span><a href="#local-6989586621683097795"><span class="hs-identifier hs-var">expr</span></a></span><span> </span><span class="annot"><span class="annottext">TcCompleteSig
</span><a href="#local-6989586621683097797"><span class="hs-identifier hs-var">sig</span></a></span><span>
</span><span id="line-681"></span><span>        </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">return</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621683097798"><span class="hs-identifier hs-type">expr'</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Types.Id.html#idType"><span class="hs-identifier hs-type">idType</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Tc.Types.BasicTypes.html#sig_bndr"><span class="hs-identifier hs-var">sig_bndr</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683097797"><span class="hs-identifier hs-type">sig</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-682"></span><span>
</span><span id="line-683"></span><span class="annot"><a href="GHC.Tc.Gen.Head.html#tcExprSig"><span class="hs-identifier hs-var">tcExprSig</span></a></span><span> </span><span id="local-6989586621683097800"><span class="annot"><span class="annottext">LHsExpr (GhcPass 'Renamed)
</span><a href="#local-6989586621683097800"><span class="hs-identifier hs-var">expr</span></a></span></span><span> </span><span id="local-6989586621683097801"><span class="annot"><span class="annottext">sig :: TcIdSig
</span><a href="#local-6989586621683097801"><span class="hs-identifier hs-var">sig</span></a></span></span><span class="hs-glyph">@</span><span class="hs-special">(</span><span class="annot"><a href="GHC.Tc.Types.BasicTypes.html#TcPartialSig"><span class="hs-identifier hs-type">TcPartialSig</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Tc.Types.BasicTypes.html#PSig"><span class="hs-identifier hs-type">PSig</span></a></span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">psig_name :: TcPartialSig -&gt; Name
</span><a href="GHC.Tc.Types.BasicTypes.html#psig_name"><span class="hs-identifier hs-var">psig_name</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="local-6989586621683097805"><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621683097805"><span class="hs-identifier hs-var">name</span></a></span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">psig_loc :: TcPartialSig -&gt; SrcSpan
</span><a href="GHC.Tc.Types.BasicTypes.html#psig_loc"><span class="hs-identifier hs-var">psig_loc</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="local-6989586621683097807"><span class="annot"><span class="annottext">SrcSpan
</span><a href="#local-6989586621683097807"><span class="hs-identifier hs-var">loc</span></a></span></span><span> </span><span class="hs-special">}</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-684"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">SrcSpan
-&gt; TcM (LHsExpr GhcTc, TcSigmaType)
-&gt; TcM (LHsExpr GhcTc, TcSigmaType)
forall a. SrcSpan -&gt; TcRn a -&gt; TcRn a
</span><a href="GHC.Tc.Utils.Monad.html#setSrcSpan"><span class="hs-identifier hs-var">setSrcSpan</span></a></span><span> </span><span class="annot"><span class="annottext">SrcSpan
</span><a href="#local-6989586621683097807"><span class="hs-identifier hs-var">loc</span></a></span><span> </span><span class="annot"><span class="annottext">(TcM (LHsExpr GhcTc, TcSigmaType)
 -&gt; TcM (LHsExpr GhcTc, TcSigmaType))
-&gt; TcM (LHsExpr GhcTc, TcSigmaType)
-&gt; TcM (LHsExpr GhcTc, TcSigmaType)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>   </span><span class="hs-comment">-- Sets the location for the implication constraint</span><span>
</span><span id="line-685"></span><span>    </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span class="hs-special">(</span><span id="local-6989586621683097808"><span class="annot"><a href="#local-6989586621683097808"><span class="hs-identifier hs-var">tclvl</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621683097809"><span class="annot"><a href="#local-6989586621683097809"><span class="hs-identifier hs-var">wanted</span></a></span></span><span class="hs-special">,</span><span> </span><span class="hs-special">(</span><span id="local-6989586621683097810"><span class="annot"><a href="#local-6989586621683097810"><span class="hs-identifier hs-var">expr'</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621683097811"><span class="annot"><a href="#local-6989586621683097811"><span class="hs-identifier hs-var">sig_inst</span></a></span></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-686"></span><span>             </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">TcM (GenLocated SrcSpanAnnA (HsExpr GhcTc), TcIdSigInst)
-&gt; TcM
     (TcLevel, WantedConstraints,
      (GenLocated SrcSpanAnnA (HsExpr GhcTc), TcIdSigInst))
forall a. TcM a -&gt; TcM (TcLevel, WantedConstraints, a)
</span><a href="GHC.Tc.Utils.Monad.html#pushLevelAndCaptureConstraints"><span class="hs-identifier hs-var">pushLevelAndCaptureConstraints</span></a></span><span>  </span><span class="annot"><span class="annottext">(TcM (GenLocated SrcSpanAnnA (HsExpr GhcTc), TcIdSigInst)
 -&gt; TcM
      (TcLevel, WantedConstraints,
       (GenLocated SrcSpanAnnA (HsExpr GhcTc), TcIdSigInst)))
-&gt; TcM (GenLocated SrcSpanAnnA (HsExpr GhcTc), TcIdSigInst)
-&gt; TcM
     (TcLevel, WantedConstraints,
      (GenLocated SrcSpanAnnA (HsExpr GhcTc), TcIdSigInst))
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-687"></span><span>                </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span id="local-6989586621683097813"><span class="annot"><a href="#local-6989586621683097813"><span class="hs-identifier hs-var">sig_inst</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">TcIdSig -&gt; TcM TcIdSigInst
</span><a href="GHC.Tc.Gen.Sig.html#tcInstSig"><span class="hs-identifier hs-var">tcInstSig</span></a></span><span> </span><span class="annot"><span class="annottext">TcIdSig
</span><a href="#local-6989586621683097801"><span class="hs-identifier hs-var">sig</span></a></span><span>
</span><span id="line-688"></span><span>                   </span><span class="hs-special">;</span><span> </span><span id="local-6989586621683097814"><span class="annot"><a href="#local-6989586621683097814"><span class="hs-identifier hs-var">expr'</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.Env.html#tcExtendNameTyVarEnv"><span class="hs-identifier hs-type">tcExtendNameTyVarEnv</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Utils.Misc.html#mapSnd"><span class="hs-identifier hs-type">mapSnd</span></a></span><span> </span><span class="annot"><a href="GHC.Types.Var.html#binderVar"><span class="hs-identifier hs-type">binderVar</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="annot"><a href="GHC.Tc.Types.BasicTypes.html#sig_inst_skols"><span class="hs-identifier hs-var">sig_inst_skols</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683097813"><span class="hs-identifier hs-type">sig_inst</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span>
</span><span id="line-689"></span><span>                              </span><span class="annot"><a href="GHC.Tc.Utils.Env.html#tcExtendNameTyVarEnv"><span class="hs-identifier hs-type">tcExtendNameTyVarEnv</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Tc.Types.BasicTypes.html#sig_inst_wcs"><span class="hs-identifier hs-var">sig_inst_wcs</span></a></span><span>   </span><span class="annot"><a href="#local-6989586621683097813"><span class="hs-identifier hs-type">sig_inst</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span>
</span><span id="line-690"></span><span>                              </span><span class="annot"><a href="GHC.Tc.Gen.Expr.html#tcCheckPolyExprNC"><span class="hs-identifier hs-type">tcCheckPolyExprNC</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683097800"><span class="hs-identifier hs-type">expr</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Tc.Types.BasicTypes.html#sig_inst_tau"><span class="hs-identifier hs-var">sig_inst_tau</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683097813"><span class="hs-identifier hs-type">sig_inst</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-691"></span><span>                   </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">return</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621683097814"><span class="hs-identifier hs-type">expr'</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="#local-6989586621683097813"><span class="hs-identifier hs-type">sig_inst</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-692"></span><span>       </span><span class="hs-comment">-- See Note [Partial expression signatures]</span><span>
</span><span id="line-693"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621683097821"><span class="annot"><a href="#local-6989586621683097821"><span class="hs-identifier hs-var hs-var">tau</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">TcIdSigInst -&gt; TcSigmaType
</span><a href="GHC.Tc.Types.BasicTypes.html#sig_inst_tau"><span class="hs-identifier hs-var">sig_inst_tau</span></a></span><span> </span><span class="annot"><span class="annottext">TcIdSigInst
</span><a href="#local-6989586621683097811"><span class="hs-identifier hs-var">sig_inst</span></a></span><span>
</span><span id="line-694"></span><span>             </span><span id="local-6989586621683097822"><span class="annot"><a href="#local-6989586621683097822"><span class="hs-identifier hs-var hs-var">infer_mode</span></a></span></span><span> </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">[TcSigmaType] -&gt; Bool
forall a. [a] -&gt; Bool
forall (t :: * -&gt; *) a. Foldable t =&gt; t a -&gt; Bool
</span><span class="hs-identifier hs-var">null</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TcIdSigInst -&gt; [TcSigmaType]
</span><a href="GHC.Tc.Types.BasicTypes.html#sig_inst_theta"><span class="hs-identifier hs-var">sig_inst_theta</span></a></span><span> </span><span class="annot"><span class="annottext">TcIdSigInst
</span><a href="#local-6989586621683097811"><span class="hs-identifier hs-var">sig_inst</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-695"></span><span>                        </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Maybe TcSigmaType -&gt; Bool
forall a. Maybe a -&gt; Bool
</span><span class="hs-identifier hs-var">isNothing</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TcIdSigInst -&gt; Maybe TcSigmaType
</span><a href="GHC.Tc.Types.BasicTypes.html#sig_inst_wcx"><span class="hs-identifier hs-var">sig_inst_wcx</span></a></span><span> </span><span class="annot"><span class="annottext">TcIdSigInst
</span><a href="#local-6989586621683097811"><span class="hs-identifier hs-var">sig_inst</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-696"></span><span>                        </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">InferMode
</span><a href="GHC.Tc.Solver.html#ApplyMR"><span class="hs-identifier hs-var">ApplyMR</span></a></span><span>
</span><span id="line-697"></span><span>                        </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">otherwise</span></span><span>
</span><span id="line-698"></span><span>                        </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">InferMode
</span><a href="GHC.Tc.Solver.html#NoRestrictions"><span class="hs-identifier hs-var">NoRestrictions</span></a></span><span>
</span><span id="line-699"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="hs-special">(</span><span class="hs-special">(</span><span id="local-6989586621683097829"><span class="annot"><a href="#local-6989586621683097829"><span class="hs-identifier hs-var">qtvs</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621683097830"><span class="annot"><a href="#local-6989586621683097830"><span class="hs-identifier hs-var">givens</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621683097831"><span class="annot"><a href="#local-6989586621683097831"><span class="hs-identifier hs-var">ev_binds</span></a></span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span id="local-6989586621683097832"><span class="annot"><a href="#local-6989586621683097832"><span class="hs-identifier hs-var">residual</span></a></span></span><span class="hs-special">)</span><span>
</span><span id="line-700"></span><span>           </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.Monad.html#captureConstraints"><span class="hs-identifier hs-type">captureConstraints</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="annot"><a href="GHC.Tc.Solver.html#simplifyInfer"><span class="hs-identifier hs-type">simplifyInfer</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683097808"><span class="hs-identifier hs-type">tclvl</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683097822"><span class="hs-identifier hs-type">infer_mode</span></a></span><span> </span><span class="hs-special">[</span><span class="annot"><a href="#local-6989586621683097811"><span class="hs-identifier hs-type">sig_inst</span></a></span><span class="hs-special">]</span><span> </span><span class="hs-special">[</span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621683097805"><span class="hs-identifier hs-type">name</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="#local-6989586621683097821"><span class="hs-identifier hs-type">tau</span></a></span><span class="hs-special">)</span><span class="hs-special">]</span><span> </span><span class="annot"><a href="#local-6989586621683097809"><span class="hs-identifier hs-type">wanted</span></a></span><span>
</span><span id="line-701"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.Monad.html#emitConstraints"><span class="hs-identifier hs-type">emitConstraints</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683097832"><span class="hs-identifier hs-type">residual</span></a></span><span>
</span><span id="line-702"></span><span>
</span><span id="line-703"></span><span>       </span><span class="hs-special">;</span><span> </span><span id="local-6989586621683097835"><span class="annot"><a href="#local-6989586621683097835"><span class="hs-identifier hs-var">tau</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.Monad.html#liftZonkM"><span class="hs-identifier hs-type">liftZonkM</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="annot"><a href="GHC.Tc.Zonk.TcType.html#zonkTcType"><span class="hs-identifier hs-type">zonkTcType</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683097821"><span class="hs-identifier hs-type">tau</span></a></span><span>
</span><span id="line-704"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621683097838"><span class="annot"><a href="#local-6989586621683097838"><span class="hs-identifier hs-var hs-var">inferred_theta</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(Var -&gt; TcSigmaType) -&gt; [Var] -&gt; [TcSigmaType]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><span class="hs-identifier hs-var">map</span></span><span> </span><span class="annot"><span class="annottext">Var -&gt; TcSigmaType
</span><a href="GHC.Tc.Utils.TcType.html#evVarPred"><span class="hs-identifier hs-var">evVarPred</span></a></span><span> </span><span class="annot"><span class="annottext">[Var]
</span><a href="#local-6989586621683097830"><span class="hs-identifier hs-var">givens</span></a></span><span>
</span><span id="line-705"></span><span>             </span><span id="local-6989586621683097840"><span class="annot"><a href="#local-6989586621683097840"><span class="hs-identifier hs-var hs-var">tau_tvs</span></a></span></span><span>        </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">TcSigmaType -&gt; TyCoVarSet
</span><a href="GHC.Core.TyCo.FVs.html#tyCoVarsOfType"><span class="hs-identifier hs-var">tyCoVarsOfType</span></a></span><span> </span><span class="annot"><span class="annottext">TcSigmaType
</span><a href="#local-6989586621683097835"><span class="hs-identifier hs-var">tau</span></a></span><span>
</span><span id="line-706"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="hs-special">(</span><span id="local-6989586621683097842"><span class="annot"><a href="#local-6989586621683097842"><span class="hs-identifier hs-var">binders</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621683097843"><span class="annot"><a href="#local-6989586621683097843"><span class="hs-identifier hs-var">my_theta</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><a href="GHC.Tc.Gen.Bind.html#chooseInferredQuantifiers"><span class="hs-identifier hs-type">chooseInferredQuantifiers</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683097832"><span class="hs-identifier hs-type">residual</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683097838"><span class="hs-identifier hs-type">inferred_theta</span></a></span><span>
</span><span id="line-707"></span><span>                                   </span><span class="annot"><a href="#local-6989586621683097840"><span class="hs-identifier hs-type">tau_tvs</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683097829"><span class="hs-identifier hs-type">qtvs</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span class="annot"><a href="#local-6989586621683097811"><span class="hs-identifier hs-type">sig_inst</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-708"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621683097844"><span class="annot"><a href="#local-6989586621683097844"><span class="hs-identifier hs-var hs-var">inferred_sigma</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[Var] -&gt; [TcSigmaType] -&gt; TcSigmaType -&gt; TcSigmaType
HasDebugCallStack =&gt;
[Var] -&gt; [TcSigmaType] -&gt; TcSigmaType -&gt; TcSigmaType
</span><a href="GHC.Tc.Utils.TcType.html#mkInfSigmaTy"><span class="hs-identifier hs-var">mkInfSigmaTy</span></a></span><span> </span><span class="annot"><span class="annottext">[Var]
</span><a href="#local-6989586621683097829"><span class="hs-identifier hs-var">qtvs</span></a></span><span> </span><span class="annot"><span class="annottext">[TcSigmaType]
</span><a href="#local-6989586621683097838"><span class="hs-identifier hs-var">inferred_theta</span></a></span><span> </span><span class="annot"><span class="annottext">TcSigmaType
</span><a href="#local-6989586621683097835"><span class="hs-identifier hs-var">tau</span></a></span><span>
</span><span id="line-709"></span><span>             </span><span id="local-6989586621683097846"><span class="annot"><a href="#local-6989586621683097846"><span class="hs-identifier hs-var hs-var">my_sigma</span></a></span></span><span>       </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[InvisTVBinder] -&gt; TcSigmaType -&gt; TcSigmaType
</span><a href="GHC.Core.TyCo.Rep.html#mkInvisForAllTys"><span class="hs-identifier hs-var">mkInvisForAllTys</span></a></span><span> </span><span class="annot"><span class="annottext">[InvisTVBinder]
</span><a href="#local-6989586621683097842"><span class="hs-identifier hs-var">binders</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[TcSigmaType] -&gt; TcSigmaType -&gt; TcSigmaType
HasDebugCallStack =&gt; [TcSigmaType] -&gt; TcSigmaType -&gt; TcSigmaType
</span><a href="GHC.Tc.Utils.TcType.html#mkPhiTy"><span class="hs-identifier hs-var">mkPhiTy</span></a></span><span>  </span><span class="annot"><span class="annottext">[TcSigmaType]
</span><a href="#local-6989586621683097843"><span class="hs-identifier hs-var">my_theta</span></a></span><span> </span><span class="annot"><span class="annottext">TcSigmaType
</span><a href="#local-6989586621683097835"><span class="hs-identifier hs-var">tau</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-710"></span><span>       </span><span class="hs-special">;</span><span> </span><span id="local-6989586621683097849"><span class="annot"><a href="#local-6989586621683097849"><span class="hs-identifier hs-var">wrap</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-keyword">if</span><span> </span><span class="annot"><a href="#local-6989586621683097844"><span class="hs-identifier hs-type">inferred_sigma</span></a></span><span> </span><span class="annot"><a href="GHC.Core.TyCo.Compare.html#eqType"><span class="hs-operator hs-type">`eqType`</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683097846"><span class="hs-identifier hs-type">my_sigma</span></a></span><span> </span><span class="hs-comment">-- NB: eqType ignores vis.</span><span>
</span><span id="line-711"></span><span>                 </span><span class="hs-keyword">then</span><span> </span><span class="annot"><span class="hs-identifier hs-type">return</span></span><span> </span><span class="annot"><a href="GHC.Tc.Types.Evidence.html#idHsWrapper"><span class="hs-identifier hs-type">idHsWrapper</span></a></span><span>  </span><span class="hs-comment">-- Fast path; also avoids complaint when we infer</span><span>
</span><span id="line-712"></span><span>                                          </span><span class="hs-comment">-- an ambiguous type and have AllowAmbiguousType</span><span>
</span><span id="line-713"></span><span>                                          </span><span class="hs-comment">-- e..g infer  x :: forall a. F a -&gt; Int</span><span>
</span><span id="line-714"></span><span>                 </span><span class="hs-keyword">else</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.Unify.html#tcSubTypeSigma"><span class="hs-identifier hs-type">tcSubTypeSigma</span></a></span><span> </span><span class="annot"><a href="GHC.Tc.Types.Origin.html#ExprSigOrigin"><span class="hs-identifier hs-type">ExprSigOrigin</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Tc.Types.Origin.html#ExprSigCtxt"><span class="hs-identifier hs-type">ExprSigCtxt</span></a></span><span> </span><span class="annot"><a href="GHC.Tc.Types.Origin.html#NoRRC"><span class="hs-identifier hs-type">NoRRC</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><a href="#local-6989586621683097844"><span class="hs-identifier hs-type">inferred_sigma</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683097846"><span class="hs-identifier hs-type">my_sigma</span></a></span><span>
</span><span id="line-715"></span><span>
</span><span id="line-716"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.Monad.html#traceTc"><span class="hs-identifier hs-type">traceTc</span></a></span><span> </span><span class="annot"><span class="hs-string">&quot;tcExpSig&quot;</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-type">ppr</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683097829"><span class="hs-identifier hs-type">qtvs</span></a></span><span> </span><span class="annot"><a href="GHC.Utils.Outputable.html#%24%24"><span class="hs-operator hs-type">$$</span></a></span><span> </span><span class="annot"><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-type">ppr</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683097830"><span class="hs-identifier hs-type">givens</span></a></span><span> </span><span class="annot"><a href="GHC.Utils.Outputable.html#%24%24"><span class="hs-operator hs-type">$$</span></a></span><span> </span><span class="annot"><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-type">ppr</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683097844"><span class="hs-identifier hs-type">inferred_sigma</span></a></span><span> </span><span class="annot"><a href="GHC.Utils.Outputable.html#%24%24"><span class="hs-operator hs-type">$$</span></a></span><span> </span><span class="annot"><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-type">ppr</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683097846"><span class="hs-identifier hs-type">my_sigma</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-717"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621683097858"><span class="annot"><a href="#local-6989586621683097858"><span class="hs-identifier hs-var hs-var">poly_wrap</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">HsWrapper
</span><a href="#local-6989586621683097849"><span class="hs-identifier hs-var">wrap</span></a></span><span>
</span><span id="line-718"></span><span>                         </span><span class="annot"><span class="annottext">HsWrapper -&gt; HsWrapper -&gt; HsWrapper
</span><a href="GHC.Tc.Types.Evidence.html#%3C.%3E"><span class="hs-operator hs-var">&lt;.&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">[Var] -&gt; HsWrapper
</span><a href="GHC.Tc.Types.Evidence.html#mkWpTyLams"><span class="hs-identifier hs-var">mkWpTyLams</span></a></span><span> </span><span class="annot"><span class="annottext">[Var]
</span><a href="#local-6989586621683097829"><span class="hs-identifier hs-var">qtvs</span></a></span><span>
</span><span id="line-719"></span><span>                         </span><span class="annot"><span class="annottext">HsWrapper -&gt; HsWrapper -&gt; HsWrapper
</span><a href="GHC.Tc.Types.Evidence.html#%3C.%3E"><span class="hs-operator hs-var">&lt;.&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">[Var] -&gt; HsWrapper
</span><a href="GHC.Tc.Types.Evidence.html#mkWpEvLams"><span class="hs-identifier hs-var">mkWpEvLams</span></a></span><span> </span><span class="annot"><span class="annottext">[Var]
</span><a href="#local-6989586621683097830"><span class="hs-identifier hs-var">givens</span></a></span><span>
</span><span id="line-720"></span><span>                         </span><span class="annot"><span class="annottext">HsWrapper -&gt; HsWrapper -&gt; HsWrapper
</span><a href="GHC.Tc.Types.Evidence.html#%3C.%3E"><span class="hs-operator hs-var">&lt;.&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">TcEvBinds -&gt; HsWrapper
</span><a href="GHC.Tc.Types.Evidence.html#mkWpLet"><span class="hs-identifier hs-var">mkWpLet</span></a></span><span>  </span><span class="annot"><span class="annottext">TcEvBinds
</span><a href="#local-6989586621683097831"><span class="hs-identifier hs-var">ev_binds</span></a></span><span>
</span><span id="line-721"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">return</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Hs.Utils.html#mkLHsWrap"><span class="hs-identifier hs-type">mkLHsWrap</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683097858"><span class="hs-identifier hs-type">poly_wrap</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683097810"><span class="hs-identifier hs-type">expr'</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="#local-6989586621683097846"><span class="hs-identifier hs-type">my_sigma</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-722"></span><span>
</span><span id="line-723"></span><span>
</span><span id="line-724"></span><span class="hs-comment">{- Note [Partial expression signatures]
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
Partial type signatures on expressions are easy to get wrong.  But
here is a guiding principle
    e :: ty
should behave like
    let x :: ty
        x = e
    in x

So for partial signatures we apply the MR if no context is given.  So
   e :: IO _          apply the MR
   e :: _ =&gt; IO _     do not apply the MR
just like in GHC.Tc.Gen.Bind.decideGeneralisationPlan

This makes a difference (#11670):
   peek :: Ptr a -&gt; IO CLong
   peek ptr = peekElemOff undefined 0 :: _
from (peekElemOff undefined 0) we get
          type: IO w
   constraints: Storable w

We must NOT try to generalise over 'w' because the signature specifies
no constraints so we'll complain about not being able to solve
Storable w.  Instead, don't generalise; then _ gets instantiated to
CLong, as it should.
-}</span><span>
</span><span id="line-751"></span><span>
</span><span id="line-752"></span><span>
</span><span id="line-753"></span><span class="annot"><span class="hs-comment">{- *********************************************************************
*                                                                      *
                 Overloaded literals
*                                                                      *
********************************************************************* -}</span></span><span>
</span><span id="line-758"></span><span>
</span><span id="line-759"></span><span class="annot"><a href="GHC.Tc.Gen.Head.html#tcInferOverLit"><span class="hs-identifier hs-type">tcInferOverLit</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Language.Haskell.Syntax.Lit.html#HsOverLit"><span class="hs-identifier hs-type">HsOverLit</span></a></span><span> </span><span class="annot"><a href="GHC.Hs.Extension.html#GhcRn"><span class="hs-identifier hs-type">GhcRn</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#TcM"><span class="hs-identifier hs-type">TcM</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Language.Haskell.Syntax.Expr.html#HsExpr"><span class="hs-identifier hs-type">HsExpr</span></a></span><span> </span><span class="annot"><a href="GHC.Hs.Extension.html#GhcTc"><span class="hs-identifier hs-type">GhcTc</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.TcType.html#TcSigmaType"><span class="hs-identifier hs-type">TcSigmaType</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-760"></span><span id="tcInferOverLit"><span class="annot"><span class="annottext">tcInferOverLit :: HsOverLit (GhcPass 'Renamed) -&gt; TcM (HsExpr GhcTc, TcSigmaType)
</span><a href="GHC.Tc.Gen.Head.html#tcInferOverLit"><span class="hs-identifier hs-var hs-var">tcInferOverLit</span></a></span></span><span> </span><span id="local-6989586621683097864"><span class="annot"><span class="annottext">lit :: HsOverLit (GhcPass 'Renamed)
</span><a href="#local-6989586621683097864"><span class="hs-identifier hs-var">lit</span></a></span></span><span class="hs-glyph">@</span><span class="hs-special">(</span><span class="annot"><a href="Language.Haskell.Syntax.Lit.html#OverLit"><span class="hs-identifier hs-type">OverLit</span></a></span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">ol_val :: forall p. HsOverLit p -&gt; OverLitVal
</span><a href="Language.Haskell.Syntax.Lit.html#ol_val"><span class="hs-identifier hs-var">ol_val</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="local-6989586621683097867"><span class="annot"><span class="annottext">OverLitVal
</span><a href="#local-6989586621683097867"><span class="hs-identifier hs-var">val</span></a></span></span><span>
</span><span id="line-761"></span><span>                            </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">ol_ext :: forall p. HsOverLit p -&gt; XOverLit p
</span><a href="Language.Haskell.Syntax.Lit.html#ol_ext"><span class="hs-identifier hs-var">ol_ext</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="GHC.Hs.Lit.html#OverLitRn"><span class="hs-identifier hs-type">OverLitRn</span></a></span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">ol_rebindable :: OverLitRn -&gt; Bool
</span><a href="GHC.Hs.Lit.html#ol_rebindable"><span class="hs-identifier hs-var">ol_rebindable</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="local-6989586621683097871"><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621683097871"><span class="hs-identifier hs-var">rebindable</span></a></span></span><span>
</span><span id="line-762"></span><span>                                                 </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">ol_from_fun :: OverLitRn -&gt; LIdP (GhcPass 'Renamed)
</span><a href="GHC.Hs.Lit.html#ol_from_fun"><span class="hs-identifier hs-var">ol_from_fun</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="GHC.Types.SrcLoc.html#L"><span class="hs-identifier hs-type">L</span></a></span><span> </span><span id="local-6989586621683097873"><span class="annot"><span class="annottext">SrcSpanAnnN
</span><a href="#local-6989586621683097873"><span class="hs-identifier hs-var">loc</span></a></span></span><span> </span><span id="local-6989586621683097874"><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621683097874"><span class="hs-identifier hs-var">from_name</span></a></span></span><span> </span><span class="hs-special">}</span><span> </span><span class="hs-special">}</span><span class="hs-special">)</span><span>
</span><span id="line-763"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-comment">-- Desugar &quot;3&quot; to (fromInteger (3 :: Integer))</span><span>
</span><span id="line-764"></span><span>    </span><span class="hs-comment">--   where fromInteger is gotten by looking up from_name, and</span><span>
</span><span id="line-765"></span><span>    </span><span class="hs-comment">--   the (3 :: Integer) is returned by mkOverLit</span><span>
</span><span id="line-766"></span><span>    </span><span class="hs-comment">-- Ditto the string literal &quot;foo&quot; to (fromString (&quot;foo&quot; :: String))</span><span>
</span><span id="line-767"></span><span>    </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span id="local-6989586621683097875"><span class="annot"><a href="#local-6989586621683097875"><span class="hs-identifier hs-var">hs_lit</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">OverLitVal -&gt; TcM (HsLit GhcTc)
forall (p :: Pass). OverLitVal -&gt; TcM (HsLit (GhcPass p))
</span><a href="GHC.Tc.Utils.Instantiate.html#mkOverLit"><span class="hs-identifier hs-var">mkOverLit</span></a></span><span> </span><span class="annot"><span class="annottext">OverLitVal
</span><a href="#local-6989586621683097867"><span class="hs-identifier hs-var">val</span></a></span><span>
</span><span id="line-768"></span><span>       </span><span class="hs-special">;</span><span> </span><span id="local-6989586621683097877"><span class="annot"><a href="#local-6989586621683097877"><span class="hs-identifier hs-var">from_id</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.Env.html#tcLookupId"><span class="hs-identifier hs-type">tcLookupId</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683097874"><span class="hs-identifier hs-type">from_name</span></a></span><span>
</span><span id="line-769"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="hs-special">(</span><span id="local-6989586621683097879"><span class="annot"><a href="#local-6989586621683097879"><span class="hs-identifier hs-var">wrap1</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621683097880"><span class="annot"><a href="#local-6989586621683097880"><span class="hs-identifier hs-var">from_ty</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.Instantiate.html#topInstantiate"><span class="hs-identifier hs-type">topInstantiate</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Tc.Types.Origin.html#LiteralOrigin"><span class="hs-identifier hs-type">LiteralOrigin</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683097864"><span class="hs-identifier hs-type">lit</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Types.Id.html#idType"><span class="hs-identifier hs-type">idType</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683097877"><span class="hs-identifier hs-type">from_id</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-770"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="hs-keyword">let</span><span>
</span><span id="line-771"></span><span>           </span><span id="local-6989586621683097883"><span class="annot"><a href="#local-6989586621683097883"><span class="hs-identifier hs-var hs-var">thing</span></a></span></span><span>    </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Name -&gt; TypedThing
</span><a href="GHC.Tc.Types.Origin.html#NameThing"><span class="hs-identifier hs-var">NameThing</span></a></span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621683097874"><span class="hs-identifier hs-var">from_name</span></a></span><span>
</span><span id="line-772"></span><span>           </span><span id="local-6989586621683097885"><span class="annot"><a href="#local-6989586621683097885"><span class="hs-identifier hs-var hs-var">mb_thing</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">TypedThing -&gt; Maybe TypedThing
forall a. a -&gt; Maybe a
</span><span class="hs-identifier hs-var">Just</span></span><span> </span><span class="annot"><span class="annottext">TypedThing
</span><a href="#local-6989586621683097883"><span class="hs-identifier hs-var">thing</span></a></span><span>
</span><span id="line-773"></span><span>           </span><span id="local-6989586621683097886"><span class="annot"><a href="#local-6989586621683097886"><span class="hs-identifier hs-var hs-var">herald</span></a></span></span><span>   </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">TypedThing -&gt; HsExpr GhcTc -&gt; ExpectedFunTyOrigin
forall (p :: Pass).
Outputable (HsExpr (GhcPass p)) =&gt;
TypedThing -&gt; HsExpr (GhcPass p) -&gt; ExpectedFunTyOrigin
</span><a href="GHC.Tc.Types.Origin.html#ExpectedFunTyArg"><span class="hs-identifier hs-var">ExpectedFunTyArg</span></a></span><span> </span><span class="annot"><span class="annottext">TypedThing
</span><a href="#local-6989586621683097883"><span class="hs-identifier hs-var">thing</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">XLitE GhcTc -&gt; HsLit GhcTc -&gt; HsExpr GhcTc
forall p. XLitE p -&gt; HsLit p -&gt; HsExpr p
</span><a href="Language.Haskell.Syntax.Expr.html#HsLit"><span class="hs-identifier hs-var">HsLit</span></a></span><span> </span><span class="annot"><span class="annottext">XLitE GhcTc
NoExtField
</span><a href="Language.Haskell.Syntax.Extension.html#noExtField"><span class="hs-identifier hs-var">noExtField</span></a></span><span> </span><span class="annot"><span class="annottext">HsLit GhcTc
</span><a href="#local-6989586621683097875"><span class="hs-identifier hs-var">hs_lit</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-774"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="hs-special">(</span><span id="local-6989586621683097889"><span class="annot"><a href="#local-6989586621683097889"><span class="hs-identifier hs-var">wrap2</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621683097890"><span class="annot"><a href="#local-6989586621683097890"><span class="hs-identifier hs-var">sarg_ty</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621683097891"><span class="annot"><a href="#local-6989586621683097891"><span class="hs-identifier hs-var">res_ty</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.Unify.html#matchActualFunTy"><span class="hs-identifier hs-type">matchActualFunTy</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683097886"><span class="hs-identifier hs-type">herald</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683097885"><span class="hs-identifier hs-type">mb_thing</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-number">1</span></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="#local-6989586621683097880"><span class="hs-identifier hs-type">from_ty</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><a href="#local-6989586621683097880"><span class="hs-identifier hs-type">from_ty</span></a></span><span>
</span><span id="line-775"></span><span>
</span><span id="line-776"></span><span>       </span><span class="hs-special">;</span><span> </span><span id="local-6989586621683097893"><span class="annot"><a href="#local-6989586621683097893"><span class="hs-identifier hs-var">co</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.Unify.html#unifyType"><span class="hs-identifier hs-type">unifyType</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683097885"><span class="hs-identifier hs-type">mb_thing</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Hs.Syn.Type.html#hsLitType"><span class="hs-identifier hs-type">hsLitType</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683097875"><span class="hs-identifier hs-type">hs_lit</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#scaledThing"><span class="hs-identifier hs-type">scaledThing</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683097890"><span class="hs-identifier hs-type">sarg_ty</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-777"></span><span>       </span><span class="hs-comment">-- See Note [Source locations for implicit function calls] in GHC.Iface.Ext.Ast</span><span>
</span><span id="line-778"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621683097897"><span class="annot"><a href="#local-6989586621683097897"><span class="hs-identifier hs-var hs-var">lit_expr</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">SrcSpanAnnA
-&gt; HsExpr GhcTc -&gt; GenLocated SrcSpanAnnA (HsExpr GhcTc)
forall l e. l -&gt; e -&gt; GenLocated l e
</span><a href="GHC.Types.SrcLoc.html#L"><span class="hs-identifier hs-var">L</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">SrcSpanAnnN -&gt; SrcSpanAnnA
forall a b. (HasLoc a, HasAnnotation b) =&gt; a -&gt; b
</span><a href="GHC.Parser.Annotation.html#l2l"><span class="hs-identifier hs-var">l2l</span></a></span><span> </span><span class="annot"><span class="annottext">SrcSpanAnnN
</span><a href="#local-6989586621683097873"><span class="hs-identifier hs-var">loc</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(HsExpr GhcTc -&gt; GenLocated SrcSpanAnnA (HsExpr GhcTc))
-&gt; HsExpr GhcTc -&gt; GenLocated SrcSpanAnnA (HsExpr GhcTc)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Coercion -&gt; HsExpr GhcTc -&gt; HsExpr GhcTc
</span><a href="GHC.Hs.Utils.html#mkHsWrapCo"><span class="hs-identifier hs-var">mkHsWrapCo</span></a></span><span> </span><span class="annot"><span class="annottext">Coercion
</span><a href="#local-6989586621683097893"><span class="hs-identifier hs-var">co</span></a></span><span> </span><span class="annot"><span class="annottext">(HsExpr GhcTc -&gt; HsExpr GhcTc) -&gt; HsExpr GhcTc -&gt; HsExpr GhcTc
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-779"></span><span>                        </span><span class="annot"><span class="annottext">XLitE GhcTc -&gt; HsLit GhcTc -&gt; HsExpr GhcTc
forall p. XLitE p -&gt; HsLit p -&gt; HsExpr p
</span><a href="Language.Haskell.Syntax.Expr.html#HsLit"><span class="hs-identifier hs-var">HsLit</span></a></span><span> </span><span class="annot"><span class="annottext">XLitE GhcTc
NoExtField
</span><a href="Language.Haskell.Syntax.Extension.html#noExtField"><span class="hs-identifier hs-var">noExtField</span></a></span><span> </span><span class="annot"><span class="annottext">HsLit GhcTc
</span><a href="#local-6989586621683097875"><span class="hs-identifier hs-var">hs_lit</span></a></span><span>
</span><span id="line-780"></span><span>             </span><span id="local-6989586621683097900"><span class="annot"><a href="#local-6989586621683097900"><span class="hs-identifier hs-var hs-var">from_expr</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">HsWrapper -&gt; HsExpr GhcTc -&gt; HsExpr GhcTc
</span><a href="GHC.Hs.Utils.html#mkHsWrap"><span class="hs-identifier hs-var">mkHsWrap</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">HsWrapper
</span><a href="#local-6989586621683097889"><span class="hs-identifier hs-var">wrap2</span></a></span><span> </span><span class="annot"><span class="annottext">HsWrapper -&gt; HsWrapper -&gt; HsWrapper
</span><a href="GHC.Tc.Types.Evidence.html#%3C.%3E"><span class="hs-operator hs-var">&lt;.&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">HsWrapper
</span><a href="#local-6989586621683097879"><span class="hs-identifier hs-var">wrap1</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(HsExpr GhcTc -&gt; HsExpr GhcTc) -&gt; HsExpr GhcTc -&gt; HsExpr GhcTc
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-781"></span><span>                         </span><span class="annot"><span class="annottext">XVar GhcTc -&gt; LIdP GhcTc -&gt; HsExpr GhcTc
forall p. XVar p -&gt; LIdP p -&gt; HsExpr p
</span><a href="Language.Haskell.Syntax.Expr.html#HsVar"><span class="hs-identifier hs-var">HsVar</span></a></span><span> </span><span class="annot"><span class="annottext">XVar GhcTc
NoExtField
</span><a href="Language.Haskell.Syntax.Extension.html#noExtField"><span class="hs-identifier hs-var">noExtField</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">SrcSpanAnnN -&gt; Var -&gt; GenLocated SrcSpanAnnN Var
forall l e. l -&gt; e -&gt; GenLocated l e
</span><a href="GHC.Types.SrcLoc.html#L"><span class="hs-identifier hs-var">L</span></a></span><span> </span><span class="annot"><span class="annottext">SrcSpanAnnN
</span><a href="#local-6989586621683097873"><span class="hs-identifier hs-var">loc</span></a></span><span> </span><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621683097877"><span class="hs-identifier hs-var">from_id</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-782"></span><span>             </span><span id="local-6989586621683097901"><span class="annot"><a href="#local-6989586621683097901"><span class="hs-identifier hs-var hs-var">witness</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">XApp GhcTc -&gt; LHsExpr GhcTc -&gt; LHsExpr GhcTc -&gt; HsExpr GhcTc
forall p. XApp p -&gt; LHsExpr p -&gt; LHsExpr p -&gt; HsExpr p
</span><a href="Language.Haskell.Syntax.Expr.html#HsApp"><span class="hs-identifier hs-var">HsApp</span></a></span><span> </span><span class="annot"><span class="annottext">XApp GhcTc
NoExtField
</span><a href="Language.Haskell.Syntax.Extension.html#noExtField"><span class="hs-identifier hs-var">noExtField</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">SrcSpanAnnA
-&gt; HsExpr GhcTc -&gt; GenLocated SrcSpanAnnA (HsExpr GhcTc)
forall l e. l -&gt; e -&gt; GenLocated l e
</span><a href="GHC.Types.SrcLoc.html#L"><span class="hs-identifier hs-var">L</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">SrcSpanAnnN -&gt; SrcSpanAnnA
forall a b. (HasLoc a, HasAnnotation b) =&gt; a -&gt; b
</span><a href="GHC.Parser.Annotation.html#l2l"><span class="hs-identifier hs-var">l2l</span></a></span><span> </span><span class="annot"><span class="annottext">SrcSpanAnnN
</span><a href="#local-6989586621683097873"><span class="hs-identifier hs-var">loc</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">HsExpr GhcTc
</span><a href="#local-6989586621683097900"><span class="hs-identifier hs-var">from_expr</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">LHsExpr GhcTc
GenLocated SrcSpanAnnA (HsExpr GhcTc)
</span><a href="#local-6989586621683097897"><span class="hs-identifier hs-var">lit_expr</span></a></span><span>
</span><span id="line-783"></span><span>             </span><span id="local-6989586621683097902"><span class="annot"><a href="#local-6989586621683097902"><span class="hs-identifier hs-var hs-var">lit'</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">HsOverLit (GhcPass 'Renamed)
</span><a href="#local-6989586621683097864"><span class="hs-identifier hs-var">lit</span></a></span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><a href="Language.Haskell.Syntax.Lit.html#ol_ext"><span class="hs-identifier hs-var">ol_ext</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="GHC.Hs.Lit.html#OverLitTc"><span class="hs-identifier hs-type">OverLitTc</span></a></span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><a href="GHC.Hs.Lit.html#ol_rebindable"><span class="hs-identifier hs-var">ol_rebindable</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="#local-6989586621683097871"><span class="hs-identifier hs-type">rebindable</span></a></span><span>
</span><span id="line-784"></span><span>                                             </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Hs.Lit.html#ol_witness"><span class="hs-identifier hs-var">ol_witness</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="#local-6989586621683097901"><span class="hs-identifier hs-type">witness</span></a></span><span>
</span><span id="line-785"></span><span>                                             </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Hs.Lit.html#ol_type"><span class="hs-identifier hs-var">ol_type</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="#local-6989586621683097891"><span class="hs-identifier hs-type">res_ty</span></a></span><span> </span><span class="hs-special">}</span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-786"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">return</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Language.Haskell.Syntax.Expr.html#HsOverLit"><span class="hs-identifier hs-type">HsOverLit</span></a></span><span> </span><span class="annot"><a href="Language.Haskell.Syntax.Extension.html#noExtField"><span class="hs-identifier hs-type">noExtField</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683097902"><span class="hs-identifier hs-type">lit'</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="#local-6989586621683097891"><span class="hs-identifier hs-type">res_ty</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-787"></span><span>
</span><span id="line-788"></span><span class="annot"><span class="hs-comment">{- *********************************************************************
*                                                                      *
                 tcInferId, tcCheckId
*                                                                      *
********************************************************************* -}</span></span><span>
</span><span id="line-793"></span><span>
</span><span id="line-794"></span><span class="annot"><a href="GHC.Tc.Gen.Head.html#tcCheckId"><span class="hs-identifier hs-type">tcCheckId</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Types.Name.html#Name"><span class="hs-identifier hs-type">Name</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.TcType.html#ExpRhoType"><span class="hs-identifier hs-type">ExpRhoType</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#TcM"><span class="hs-identifier hs-type">TcM</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Language.Haskell.Syntax.Expr.html#HsExpr"><span class="hs-identifier hs-type">HsExpr</span></a></span><span> </span><span class="annot"><a href="GHC.Hs.Extension.html#GhcTc"><span class="hs-identifier hs-type">GhcTc</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-795"></span><span id="tcCheckId"><span class="annot"><span class="annottext">tcCheckId :: Name -&gt; ExpRhoType -&gt; TcM (HsExpr GhcTc)
</span><a href="GHC.Tc.Gen.Head.html#tcCheckId"><span class="hs-identifier hs-var hs-var">tcCheckId</span></a></span></span><span> </span><span id="local-6989586621683097907"><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621683097907"><span class="hs-identifier hs-var">name</span></a></span></span><span> </span><span id="local-6989586621683097908"><span class="annot"><span class="annottext">ExpRhoType
</span><a href="#local-6989586621683097908"><span class="hs-identifier hs-var">res_ty</span></a></span></span><span>
</span><span id="line-796"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span class="hs-special">(</span><span id="local-6989586621683097909"><span class="annot"><a href="#local-6989586621683097909"><span class="hs-identifier hs-var">expr</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621683097910"><span class="annot"><a href="#local-6989586621683097910"><span class="hs-identifier hs-var">actual_res_ty</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Name -&gt; TcM (HsExpr GhcTc, TcSigmaType)
</span><a href="GHC.Tc.Gen.Head.html#tcInferId"><span class="hs-identifier hs-var">tcInferId</span></a></span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621683097907"><span class="hs-identifier hs-var">name</span></a></span><span>
</span><span id="line-797"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.Monad.html#traceTc"><span class="hs-identifier hs-type">traceTc</span></a></span><span> </span><span class="annot"><span class="hs-string">&quot;tcCheckId&quot;</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Utils.Outputable.html#vcat"><span class="hs-identifier hs-type">vcat</span></a></span><span> </span><span class="hs-special">[</span><span class="annot"><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-type">ppr</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683097907"><span class="hs-identifier hs-type">name</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-type">ppr</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683097910"><span class="hs-identifier hs-type">actual_res_ty</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-type">ppr</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683097908"><span class="hs-identifier hs-type">res_ty</span></a></span><span class="hs-special">]</span><span class="hs-special">)</span><span>
</span><span id="line-798"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="annot"><a href="GHC.Tc.Gen.Head.html#addFunResCtxt"><span class="hs-identifier hs-type">addFunResCtxt</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683097909"><span class="hs-identifier hs-type">expr</span></a></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><span class="annot"><a href="#local-6989586621683097910"><span class="hs-identifier hs-type">actual_res_ty</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683097908"><span class="hs-identifier hs-type">res_ty</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span>
</span><span id="line-799"></span><span>         </span><span class="annot"><a href="GHC.Tc.Utils.Unify.html#tcWrapResultO"><span class="hs-identifier hs-type">tcWrapResultO</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Tc.Types.Origin.html#OccurrenceOf"><span class="hs-identifier hs-type">OccurrenceOf</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683097907"><span class="hs-identifier hs-type">name</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><a href="#local-6989586621683097913"><span class="hs-identifier hs-type">rn_fun</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683097909"><span class="hs-identifier hs-type">expr</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683097910"><span class="hs-identifier hs-type">actual_res_ty</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683097908"><span class="hs-identifier hs-type">res_ty</span></a></span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-800"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-801"></span><span>    </span><span id="local-6989586621683097913"><span class="annot"><span class="annottext">rn_fun :: HsExpr (GhcPass 'Renamed)
</span><a href="#local-6989586621683097913"><span class="hs-identifier hs-var hs-var">rn_fun</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">XVar (GhcPass 'Renamed)
-&gt; LIdP (GhcPass 'Renamed) -&gt; HsExpr (GhcPass 'Renamed)
forall p. XVar p -&gt; LIdP p -&gt; HsExpr p
</span><a href="Language.Haskell.Syntax.Expr.html#HsVar"><span class="hs-identifier hs-var">HsVar</span></a></span><span> </span><span class="annot"><span class="annottext">XVar (GhcPass 'Renamed)
NoExtField
</span><a href="Language.Haskell.Syntax.Extension.html#noExtField"><span class="hs-identifier hs-var">noExtField</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Name -&gt; GenLocated SrcSpanAnnN Name
forall e a. HasAnnotation e =&gt; a -&gt; GenLocated e a
</span><a href="GHC.Parser.Annotation.html#noLocA"><span class="hs-identifier hs-var">noLocA</span></a></span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621683097907"><span class="hs-identifier hs-var">name</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-802"></span><span>
</span><span id="line-803"></span><span class="hs-comment">------------------------</span><span>
</span><span id="line-804"></span><span class="annot"><a href="GHC.Tc.Gen.Head.html#tcInferId"><span class="hs-identifier hs-type">tcInferId</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Types.Name.html#Name"><span class="hs-identifier hs-type">Name</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#TcM"><span class="hs-identifier hs-type">TcM</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Language.Haskell.Syntax.Expr.html#HsExpr"><span class="hs-identifier hs-type">HsExpr</span></a></span><span> </span><span class="annot"><a href="GHC.Hs.Extension.html#GhcTc"><span class="hs-identifier hs-type">GhcTc</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.TcType.html#TcSigmaType"><span class="hs-identifier hs-type">TcSigmaType</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-805"></span><span class="hs-comment">-- Look up an occurrence of an Id</span><span>
</span><span id="line-806"></span><span class="hs-comment">-- Do not instantiate its type</span><span>
</span><span id="line-807"></span><span id="tcInferId"><span class="annot"><span class="annottext">tcInferId :: Name -&gt; TcM (HsExpr GhcTc, TcSigmaType)
</span><a href="GHC.Tc.Gen.Head.html#tcInferId"><span class="hs-identifier hs-var hs-var">tcInferId</span></a></span></span><span> </span><span id="local-6989586621683097915"><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621683097915"><span class="hs-identifier hs-var">id_name</span></a></span></span><span>
</span><span id="line-808"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621683097915"><span class="hs-identifier hs-var">id_name</span></a></span><span> </span><span class="annot"><span class="annottext">Name -&gt; Unique -&gt; Bool
forall a. Uniquable a =&gt; a -&gt; Unique -&gt; Bool
</span><a href="GHC.Types.Unique.html#hasKey"><span class="hs-operator hs-var">`hasKey`</span></a></span><span> </span><span class="annot"><span class="annottext">Unique
</span><a href="GHC.Builtin.Names.html#assertIdKey"><span class="hs-identifier hs-var">assertIdKey</span></a></span><span>
</span><span id="line-809"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span id="local-6989586621683097918"><span class="annot"><a href="#local-6989586621683097918"><span class="hs-identifier hs-var">dflags</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">IOEnv (Env TcGblEnv TcLclEnv) DynFlags
forall (m :: * -&gt; *). HasDynFlags m =&gt; m DynFlags
</span><a href="GHC.Driver.DynFlags.html#getDynFlags"><span class="hs-identifier hs-var">getDynFlags</span></a></span><span>
</span><span id="line-810"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="hs-keyword">if</span><span> </span><span class="annot"><a href="GHC.Driver.DynFlags.html#gopt"><span class="hs-identifier hs-type">gopt</span></a></span><span> </span><span class="annot"><a href="GHC.Driver.Flags.html#Opt_IgnoreAsserts"><span class="hs-identifier hs-type">Opt_IgnoreAsserts</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683097918"><span class="hs-identifier hs-type">dflags</span></a></span><span>
</span><span id="line-811"></span><span>         </span><span class="hs-keyword">then</span><span> </span><span class="annot"><a href="GHC.Tc.Gen.Head.html#tc_infer_id"><span class="hs-identifier hs-type">tc_infer_id</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683097915"><span class="hs-identifier hs-type">id_name</span></a></span><span>
</span><span id="line-812"></span><span>         </span><span class="hs-keyword">else</span><span> </span><span class="annot"><a href="GHC.Tc.Gen.Head.html#tc_infer_assert"><span class="hs-identifier hs-type">tc_infer_assert</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683097915"><span class="hs-identifier hs-type">id_name</span></a></span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-813"></span><span>
</span><span id="line-814"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">otherwise</span></span><span>
</span><span id="line-815"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span class="hs-special">(</span><span id="local-6989586621683097924"><span class="annot"><a href="#local-6989586621683097924"><span class="hs-identifier hs-var">expr</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621683097925"><span class="annot"><a href="#local-6989586621683097925"><span class="hs-identifier hs-var">ty</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Name -&gt; TcM (HsExpr GhcTc, TcSigmaType)
</span><a href="GHC.Tc.Gen.Head.html#tc_infer_id"><span class="hs-identifier hs-var">tc_infer_id</span></a></span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621683097915"><span class="hs-identifier hs-var">id_name</span></a></span><span>
</span><span id="line-816"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.Monad.html#traceTc"><span class="hs-identifier hs-type">traceTc</span></a></span><span> </span><span class="annot"><span class="hs-string">&quot;tcInferId&quot;</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-type">ppr</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683097915"><span class="hs-identifier hs-type">id_name</span></a></span><span> </span><span class="annot"><a href="GHC.Utils.Outputable.html#%3C%2B%3E"><span class="hs-operator hs-type">&lt;+&gt;</span></a></span><span> </span><span class="annot"><a href="GHC.Utils.Outputable.html#dcolon"><span class="hs-identifier hs-type">dcolon</span></a></span><span> </span><span class="annot"><a href="GHC.Utils.Outputable.html#%3C%2B%3E"><span class="hs-operator hs-type">&lt;+&gt;</span></a></span><span> </span><span class="annot"><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-type">ppr</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683097925"><span class="hs-identifier hs-type">ty</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-817"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">return</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621683097924"><span class="hs-identifier hs-type">expr</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="#local-6989586621683097925"><span class="hs-identifier hs-type">ty</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-818"></span><span>
</span><span id="line-819"></span><span class="annot"><a href="GHC.Tc.Gen.Head.html#tc_infer_assert"><span class="hs-identifier hs-type">tc_infer_assert</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Types.Name.html#Name"><span class="hs-identifier hs-type">Name</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#TcM"><span class="hs-identifier hs-type">TcM</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Language.Haskell.Syntax.Expr.html#HsExpr"><span class="hs-identifier hs-type">HsExpr</span></a></span><span> </span><span class="annot"><a href="GHC.Hs.Extension.html#GhcTc"><span class="hs-identifier hs-type">GhcTc</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.TcType.html#TcSigmaType"><span class="hs-identifier hs-type">TcSigmaType</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-820"></span><span class="hs-comment">-- Deal with an occurrence of 'assert'</span><span>
</span><span id="line-821"></span><span class="hs-comment">-- See Note [Adding the implicit parameter to 'assert']</span><span>
</span><span id="line-822"></span><span id="tc_infer_assert"><span class="annot"><span class="annottext">tc_infer_assert :: Name -&gt; TcM (HsExpr GhcTc, TcSigmaType)
</span><a href="GHC.Tc.Gen.Head.html#tc_infer_assert"><span class="hs-identifier hs-var hs-var">tc_infer_assert</span></a></span></span><span> </span><span id="local-6989586621683097927"><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621683097927"><span class="hs-identifier hs-var">assert_name</span></a></span></span><span>
</span><span id="line-823"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span id="local-6989586621683097928"><span class="annot"><a href="#local-6989586621683097928"><span class="hs-identifier hs-var">assert_error_id</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Name -&gt; TcM Var
</span><a href="GHC.Tc.Utils.Env.html#tcLookupId"><span class="hs-identifier hs-var">tcLookupId</span></a></span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="GHC.Builtin.Names.html#assertErrorName"><span class="hs-identifier hs-var">assertErrorName</span></a></span><span>
</span><span id="line-824"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="hs-special">(</span><span id="local-6989586621683097930"><span class="annot"><a href="#local-6989586621683097930"><span class="hs-identifier hs-var">wrap</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621683097931"><span class="annot"><a href="#local-6989586621683097931"><span class="hs-identifier hs-var">id_rho</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.Instantiate.html#topInstantiate"><span class="hs-identifier hs-type">topInstantiate</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Tc.Types.Origin.html#OccurrenceOf"><span class="hs-identifier hs-type">OccurrenceOf</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683097927"><span class="hs-identifier hs-type">assert_name</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-825"></span><span>                                          </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Types.Id.html#idType"><span class="hs-identifier hs-type">idType</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683097928"><span class="hs-identifier hs-type">assert_error_id</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-826"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">return</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Hs.Utils.html#mkHsWrap"><span class="hs-identifier hs-type">mkHsWrap</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683097930"><span class="hs-identifier hs-type">wrap</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Language.Haskell.Syntax.Expr.html#HsVar"><span class="hs-identifier hs-type">HsVar</span></a></span><span> </span><span class="annot"><a href="Language.Haskell.Syntax.Extension.html#noExtField"><span class="hs-identifier hs-type">noExtField</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Parser.Annotation.html#noLocA"><span class="hs-identifier hs-type">noLocA</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683097928"><span class="hs-identifier hs-type">assert_error_id</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="annot"><a href="#local-6989586621683097931"><span class="hs-identifier hs-type">id_rho</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-827"></span><span>       </span><span class="hs-special">}</span><span>
</span><span id="line-828"></span><span>
</span><span id="line-829"></span><span class="annot"><a href="GHC.Tc.Gen.Head.html#tc_infer_id"><span class="hs-identifier hs-type">tc_infer_id</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Types.Name.html#Name"><span class="hs-identifier hs-type">Name</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#TcM"><span class="hs-identifier hs-type">TcM</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Language.Haskell.Syntax.Expr.html#HsExpr"><span class="hs-identifier hs-type">HsExpr</span></a></span><span> </span><span class="annot"><a href="GHC.Hs.Extension.html#GhcTc"><span class="hs-identifier hs-type">GhcTc</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.TcType.html#TcSigmaType"><span class="hs-identifier hs-type">TcSigmaType</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-830"></span><span id="tc_infer_id"><span class="annot"><span class="annottext">tc_infer_id :: Name -&gt; TcM (HsExpr GhcTc, TcSigmaType)
</span><a href="GHC.Tc.Gen.Head.html#tc_infer_id"><span class="hs-identifier hs-var hs-var">tc_infer_id</span></a></span></span><span> </span><span id="local-6989586621683097932"><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621683097932"><span class="hs-identifier hs-var">id_name</span></a></span></span><span>
</span><span id="line-831"></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span id="local-6989586621683097933"><span class="annot"><a href="#local-6989586621683097933"><span class="hs-identifier hs-var">thing</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Name -&gt; TcM TcTyThing
</span><a href="GHC.Tc.Utils.Env.html#tcLookup"><span class="hs-identifier hs-var">tcLookup</span></a></span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621683097932"><span class="hs-identifier hs-var">id_name</span></a></span><span>
</span><span id="line-832"></span><span>      </span><span class="hs-special">;</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><a href="#local-6989586621683097933"><span class="hs-identifier hs-type">thing</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-833"></span><span>             </span><span class="annot"><a href="GHC.Tc.Types.BasicTypes.html#ATcId"><span class="hs-identifier hs-type">ATcId</span></a></span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">tct_id :: TcTyThing -&gt; Var
</span><a href="GHC.Tc.Types.BasicTypes.html#tct_id"><span class="hs-identifier hs-var">tct_id</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="local-6989586621683097934"><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621683097934"><span class="hs-identifier hs-var">id</span></a></span></span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-834"></span><span>               </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">Var -&gt; TcM ()
</span><a href="GHC.Tc.Gen.Head.html#check_local_id"><span class="hs-identifier hs-var">check_local_id</span></a></span><span> </span><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621683097934"><span class="hs-identifier hs-var">id</span></a></span><span>
</span><span id="line-835"></span><span>                     </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="annottext">Var -&gt; TcM (HsExpr GhcTc, TcSigmaType)
forall {p} {e} {m :: * -&gt; *}.
(XVar p ~ NoExtField, IdP p ~ Var, XRec p Var ~ GenLocated e Var,
 Monad m, HasAnnotation e) =&gt;
Var -&gt; m (HsExpr p, TcSigmaType)
</span><a href="#local-6989586621683097935"><span class="hs-identifier hs-var">return_id</span></a></span><span> </span><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621683097934"><span class="hs-identifier hs-var">id</span></a></span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-836"></span><span>
</span><span id="line-837"></span><span>             </span><span class="annot"><a href="GHC.Tc.Types.BasicTypes.html#AGlobal"><span class="hs-identifier hs-type">AGlobal</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Types.TyThing.html#AnId"><span class="hs-identifier hs-type">AnId</span></a></span><span> </span><span id="local-6989586621683097936"><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621683097936"><span class="hs-identifier hs-var">id</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Var -&gt; TcM (HsExpr GhcTc, TcSigmaType)
forall {p} {e} {m :: * -&gt; *}.
(XVar p ~ NoExtField, IdP p ~ Var, XRec p Var ~ GenLocated e Var,
 Monad m, HasAnnotation e) =&gt;
Var -&gt; m (HsExpr p, TcSigmaType)
</span><a href="#local-6989586621683097935"><span class="hs-identifier hs-var">return_id</span></a></span><span> </span><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621683097936"><span class="hs-identifier hs-var">id</span></a></span><span>
</span><span id="line-838"></span><span>               </span><span class="hs-comment">-- A global cannot possibly be ill-staged</span><span>
</span><span id="line-839"></span><span>               </span><span class="hs-comment">-- nor does it need the 'lifting' treatment</span><span>
</span><span id="line-840"></span><span>               </span><span class="hs-comment">-- Hence no checkTh stuff here</span><span>
</span><span id="line-841"></span><span>
</span><span id="line-842"></span><span>             </span><span class="annot"><a href="GHC.Tc.Types.BasicTypes.html#AGlobal"><span class="hs-identifier hs-type">AGlobal</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Types.TyThing.html#AConLike"><span class="hs-identifier hs-type">AConLike</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Core.ConLike.html#RealDataCon"><span class="hs-identifier hs-type">RealDataCon</span></a></span><span> </span><span id="local-6989586621683097939"><span class="annot"><span class="annottext">DataCon
</span><a href="#local-6989586621683097939"><span class="hs-identifier hs-var">con</span></a></span></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">DataCon -&gt; TcM (HsExpr GhcTc, TcSigmaType)
</span><a href="GHC.Tc.Gen.Head.html#tcInferDataCon"><span class="hs-identifier hs-var">tcInferDataCon</span></a></span><span> </span><span class="annot"><span class="annottext">DataCon
</span><a href="#local-6989586621683097939"><span class="hs-identifier hs-var">con</span></a></span><span>
</span><span id="line-843"></span><span>             </span><span class="annot"><a href="GHC.Tc.Types.BasicTypes.html#AGlobal"><span class="hs-identifier hs-type">AGlobal</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Types.TyThing.html#AConLike"><span class="hs-identifier hs-type">AConLike</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Core.ConLike.html#PatSynCon"><span class="hs-identifier hs-type">PatSynCon</span></a></span><span> </span><span id="local-6989586621683097942"><span class="annot"><span class="annottext">PatSyn
</span><a href="#local-6989586621683097942"><span class="hs-identifier hs-var">ps</span></a></span></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Name -&gt; PatSyn -&gt; TcM (HsExpr GhcTc, TcSigmaType)
</span><a href="GHC.Tc.Gen.Head.html#tcInferPatSyn"><span class="hs-identifier hs-var">tcInferPatSyn</span></a></span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621683097932"><span class="hs-identifier hs-var">id_name</span></a></span><span> </span><span class="annot"><span class="annottext">PatSyn
</span><a href="#local-6989586621683097942"><span class="hs-identifier hs-var">ps</span></a></span><span>
</span><span id="line-844"></span><span>             </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TcTyThing -&gt; Maybe TyCon
</span><a href="GHC.Tc.Types.BasicTypes.html#tcTyThingTyCon_maybe"><span class="hs-identifier hs-var">tcTyThingTyCon_maybe</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span id="local-6989586621683097945"><span class="annot"><span class="annottext">TyCon
</span><a href="#local-6989586621683097945"><span class="hs-identifier hs-var">tc</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">WhatLooking -&gt; Name -&gt; TcM (HsExpr GhcTc, TcSigmaType)
forall a. WhatLooking -&gt; Name -&gt; TcM a
</span><a href="GHC.Tc.Utils.Env.html#failIllegalTyCon"><span class="hs-identifier hs-var">failIllegalTyCon</span></a></span><span> </span><span class="annot"><span class="annottext">WhatLooking
</span><a href="GHC.Rename.Unbound.html#WL_Anything"><span class="hs-identifier hs-var">WL_Anything</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TyCon -&gt; Name
</span><a href="GHC.Core.TyCon.html#tyConName"><span class="hs-identifier hs-var">tyConName</span></a></span><span> </span><span class="annot"><span class="annottext">TyCon
</span><a href="#local-6989586621683097945"><span class="hs-identifier hs-var">tc</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-845"></span><span>             </span><span class="annot"><a href="GHC.Tc.Types.BasicTypes.html#ATyVar"><span class="hs-identifier hs-type">ATyVar</span></a></span><span> </span><span id="local-6989586621683097949"><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621683097949"><span class="hs-identifier hs-var">name</span></a></span></span><span> </span><span class="annot"><span class="annottext">Var
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Name -&gt; TcM (HsExpr GhcTc, TcSigmaType)
forall a. Name -&gt; TcM a
</span><a href="GHC.Tc.Utils.Env.html#failIllegalTyVal"><span class="hs-identifier hs-var">failIllegalTyVal</span></a></span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621683097949"><span class="hs-identifier hs-var">name</span></a></span><span>
</span><span id="line-846"></span><span>
</span><span id="line-847"></span><span>             </span><span class="annot"><span class="annottext">TcTyThing
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">TcRnMessage -&gt; TcM (HsExpr GhcTc, TcSigmaType)
forall a. TcRnMessage -&gt; TcM a
</span><a href="GHC.Tc.Utils.Monad.html#failWithTc"><span class="hs-identifier hs-var">failWithTc</span></a></span><span> </span><span class="annot"><span class="annottext">(TcRnMessage -&gt; TcM (HsExpr GhcTc, TcSigmaType))
-&gt; TcRnMessage -&gt; TcM (HsExpr GhcTc, TcSigmaType)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">TcTyThing -&gt; TcRnMessage
</span><a href="GHC.Tc.Errors.Types.html#TcRnExpectedValueId"><span class="hs-identifier hs-var">TcRnExpectedValueId</span></a></span><span> </span><span class="annot"><span class="annottext">TcTyThing
</span><a href="#local-6989586621683097933"><span class="hs-identifier hs-var">thing</span></a></span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-848"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-849"></span><span>    </span><span id="local-6989586621683097935"><span class="annot"><span class="annottext">return_id :: Var -&gt; m (HsExpr p, TcSigmaType)
</span><a href="#local-6989586621683097935"><span class="hs-identifier hs-var hs-var">return_id</span></a></span></span><span> </span><span id="local-6989586621683097967"><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621683097967"><span class="hs-identifier hs-var">id</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(HsExpr p, TcSigmaType) -&gt; m (HsExpr p, TcSigmaType)
forall a. a -&gt; m a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">XVar p -&gt; LIdP p -&gt; HsExpr p
forall p. XVar p -&gt; LIdP p -&gt; HsExpr p
</span><a href="Language.Haskell.Syntax.Expr.html#HsVar"><span class="hs-identifier hs-var">HsVar</span></a></span><span> </span><span class="annot"><span class="annottext">XVar p
NoExtField
</span><a href="Language.Haskell.Syntax.Extension.html#noExtField"><span class="hs-identifier hs-var">noExtField</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Var -&gt; GenLocated e Var
forall e a. HasAnnotation e =&gt; a -&gt; GenLocated e a
</span><a href="GHC.Parser.Annotation.html#noLocA"><span class="hs-identifier hs-var">noLocA</span></a></span><span> </span><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621683097967"><span class="hs-identifier hs-var">id</span></a></span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Var -&gt; TcSigmaType
</span><a href="GHC.Types.Id.html#idType"><span class="hs-identifier hs-var">idType</span></a></span><span> </span><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621683097967"><span class="hs-identifier hs-var">id</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-850"></span><span>
</span><span id="line-851"></span><span class="hs-comment">{- Note [Suppress hints with RequiredTypeArguments]
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
When a type variable is used at the term level, GHC assumes the user might
have made a typo and suggests a term variable with a similar name.

For example, if the user writes
  f (Proxy :: Proxy nap) (Proxy :: Proxy gap) = nap (+1) [1,2,3]
then GHC will helpfully suggest `map` instead of `nap`
  &#8226; Illegal term-level use of the type variable &#8216;nap&#8217;
  &#8226; Perhaps use &#8216;map&#8217; (imported from Prelude)

Importantly, GHC does /not/ suggest `gap`, which is in scope.
Question: How does GHC know not to suggest `gap`?  After all, the edit distance
          between `map`, `nap`, and `gap` is equally short.
Answer: GHC takes the namespace into consideration. `gap` is a `tvName`, and GHC
        would only suggest a `varName` at the term level.

In other words, the current hint infrastructure assumes that the namespace of an
entity is a reliable indicator of its level
   term-level name &lt;=&gt; term-level entity
   type-level name &lt;=&gt; type-level entity

With RequiredTypeArguments, this assumption does not hold. Consider
  bad :: forall a b -&gt; ...
  bad nap gap = nap

This use of `nap` on the RHS is illegal because `nap` stands for a type
variable. It cannot be returned as the result of a function. At the same time,
it is bound as a `varName`, i.e. in the term-level namespace.

Unless we suppress hints, GHC gets awfully confused
    &#8226; Illegal term-level use of the variable &#8216;nap&#8217;
    &#8226; Perhaps use one of these:
        &#8216;nap&#8217; (line 2), &#8216;gap&#8217; (line 2), &#8216;map&#8217; (imported from Prelude)

GHC shouldn't suggest `gap`, which is also a type variable; using it would
result in the same error. And it especially shouldn't suggest using `nap`
instead of `nap`, which is absurd.

The proper solution is to overhaul the hint system to consider what a name
stands for instead of looking at its namespace alone. This is tracked in #24231.
As a temporary measure, we avoid those potentially misleading hints by
suppressing them entirely if RequiredTypeArguments is in effect.
-}</span><span>
</span><span id="line-895"></span><span>
</span><span id="line-896"></span><span class="annot"><a href="GHC.Tc.Gen.Head.html#check_local_id"><span class="hs-identifier hs-type">check_local_id</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Types.Var.html#Id"><span class="hs-identifier hs-type">Id</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#TcM"><span class="hs-identifier hs-type">TcM</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-897"></span><span id="check_local_id"><span class="annot"><span class="annottext">check_local_id :: Var -&gt; TcM ()
</span><a href="GHC.Tc.Gen.Head.html#check_local_id"><span class="hs-identifier hs-var hs-var">check_local_id</span></a></span></span><span> </span><span id="local-6989586621683097969"><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621683097969"><span class="hs-identifier hs-var">id</span></a></span></span><span>
</span><span id="line-898"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">Var -&gt; TcM ()
</span><a href="GHC.Tc.Gen.Head.html#checkThLocalId"><span class="hs-identifier hs-var">checkThLocalId</span></a></span><span> </span><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621683097969"><span class="hs-identifier hs-var">id</span></a></span><span>
</span><span id="line-899"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="annottext">UsageEnv -&gt; TcM ()
</span><a href="GHC.Tc.Utils.Monad.html#tcEmitBindingUsage"><span class="hs-identifier hs-var">tcEmitBindingUsage</span></a></span><span> </span><span class="annot"><span class="annottext">(UsageEnv -&gt; TcM ()) -&gt; UsageEnv -&gt; TcM ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Var -&gt; UsageEnv
</span><a href="GHC.Core.UsageEnv.html#singleUsageUE"><span class="hs-identifier hs-var">singleUsageUE</span></a></span><span> </span><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621683097969"><span class="hs-identifier hs-var">id</span></a></span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-900"></span><span>
</span><span id="line-901"></span><span class="annot"><a href="GHC.Tc.Gen.Head.html#check_naughty"><span class="hs-identifier hs-type">check_naughty</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Types.Name.Occurrence.html#OccName"><span class="hs-identifier hs-type">OccName</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.BasicTypes.html#TcId"><span class="hs-identifier hs-type">TcId</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#TcM"><span class="hs-identifier hs-type">TcM</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-902"></span><span id="check_naughty"><span class="annot"><span class="annottext">check_naughty :: OccName -&gt; Var -&gt; TcM ()
</span><a href="GHC.Tc.Gen.Head.html#check_naughty"><span class="hs-identifier hs-var hs-var">check_naughty</span></a></span></span><span> </span><span id="local-6989586621683097972"><span class="annot"><span class="annottext">OccName
</span><a href="#local-6989586621683097972"><span class="hs-identifier hs-var">lbl</span></a></span></span><span> </span><span id="local-6989586621683097973"><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621683097973"><span class="hs-identifier hs-var">id</span></a></span></span><span>
</span><span id="line-903"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Var -&gt; Bool
</span><a href="GHC.Types.Id.html#isNaughtyRecordSelector"><span class="hs-identifier hs-var">isNaughtyRecordSelector</span></a></span><span> </span><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621683097973"><span class="hs-identifier hs-var">id</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">TcRnMessage -&gt; TcM ()
forall a. TcRnMessage -&gt; TcM a
</span><a href="GHC.Tc.Utils.Monad.html#failWithTc"><span class="hs-identifier hs-var">failWithTc</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">OccName -&gt; TcRnMessage
</span><a href="GHC.Tc.Errors.Types.html#TcRnRecSelectorEscapedTyVar"><span class="hs-identifier hs-var">TcRnRecSelectorEscapedTyVar</span></a></span><span> </span><span class="annot"><span class="annottext">OccName
</span><a href="#local-6989586621683097972"><span class="hs-identifier hs-var">lbl</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-904"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">otherwise</span></span><span>                  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">() -&gt; TcM ()
forall a. a -&gt; IOEnv (Env TcGblEnv TcLclEnv) a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-905"></span><span>
</span><span id="line-906"></span><span class="annot"><a href="GHC.Tc.Gen.Head.html#tcInferDataCon"><span class="hs-identifier hs-type">tcInferDataCon</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Core.DataCon.html#DataCon"><span class="hs-identifier hs-type">DataCon</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#TcM"><span class="hs-identifier hs-type">TcM</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Language.Haskell.Syntax.Expr.html#HsExpr"><span class="hs-identifier hs-type">HsExpr</span></a></span><span> </span><span class="annot"><a href="GHC.Hs.Extension.html#GhcTc"><span class="hs-identifier hs-type">GhcTc</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.TcType.html#TcSigmaType"><span class="hs-identifier hs-type">TcSigmaType</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-907"></span><span class="hs-comment">-- See Note [Typechecking data constructors]</span><span>
</span><span id="line-908"></span><span id="tcInferDataCon"><span class="annot"><span class="annottext">tcInferDataCon :: DataCon -&gt; TcM (HsExpr GhcTc, TcSigmaType)
</span><a href="GHC.Tc.Gen.Head.html#tcInferDataCon"><span class="hs-identifier hs-var hs-var">tcInferDataCon</span></a></span></span><span> </span><span id="local-6989586621683097976"><span class="annot"><span class="annottext">DataCon
</span><a href="#local-6989586621683097976"><span class="hs-identifier hs-var">con</span></a></span></span><span>
</span><span id="line-909"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621683097977"><span class="annot"><span class="annottext">tvbs :: [InvisTVBinder]
</span><a href="#local-6989586621683097977"><span class="hs-identifier hs-var hs-var hs-var">tvbs</span></a></span></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">DataCon -&gt; [InvisTVBinder]
</span><a href="GHC.Core.DataCon.html#dataConUserTyVarBinders"><span class="hs-identifier hs-var">dataConUserTyVarBinders</span></a></span><span> </span><span class="annot"><span class="annottext">DataCon
</span><a href="#local-6989586621683097976"><span class="hs-identifier hs-var">con</span></a></span><span>
</span><span id="line-910"></span><span>             </span><span id="local-6989586621683097979"><span class="annot"><span class="annottext">tvs :: [Var]
</span><a href="#local-6989586621683097979"><span class="hs-identifier hs-var hs-var hs-var">tvs</span></a></span></span><span>   </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[InvisTVBinder] -&gt; [Var]
forall tv argf. [VarBndr tv argf] -&gt; [tv]
</span><a href="GHC.Types.Var.html#binderVars"><span class="hs-identifier hs-var">binderVars</span></a></span><span> </span><span class="annot"><span class="annottext">[InvisTVBinder]
</span><a href="#local-6989586621683097977"><span class="hs-identifier hs-var">tvbs</span></a></span><span>
</span><span id="line-911"></span><span>             </span><span id="local-6989586621683097981"><span class="annot"><span class="annottext">theta :: [TcSigmaType]
</span><a href="#local-6989586621683097981"><span class="hs-identifier hs-var hs-var hs-var">theta</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">DataCon -&gt; [TcSigmaType]
</span><a href="GHC.Core.DataCon.html#dataConOtherTheta"><span class="hs-identifier hs-var">dataConOtherTheta</span></a></span><span> </span><span class="annot"><span class="annottext">DataCon
</span><a href="#local-6989586621683097976"><span class="hs-identifier hs-var">con</span></a></span><span>
</span><span id="line-912"></span><span>             </span><span id="local-6989586621683097983"><span class="annot"><span class="annottext">args :: [Scaled TcSigmaType]
</span><a href="#local-6989586621683097983"><span class="hs-identifier hs-var hs-var hs-var">args</span></a></span></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">DataCon -&gt; [Scaled TcSigmaType]
</span><a href="GHC.Core.DataCon.html#dataConOrigArgTys"><span class="hs-identifier hs-var">dataConOrigArgTys</span></a></span><span> </span><span class="annot"><span class="annottext">DataCon
</span><a href="#local-6989586621683097976"><span class="hs-identifier hs-var">con</span></a></span><span>
</span><span id="line-913"></span><span>             </span><span id="local-6989586621683097985"><span class="annot"><span class="annottext">res :: TcSigmaType
</span><a href="#local-6989586621683097985"><span class="hs-identifier hs-var hs-var hs-var">res</span></a></span></span><span>   </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">DataCon -&gt; TcSigmaType
</span><a href="GHC.Core.DataCon.html#dataConOrigResTy"><span class="hs-identifier hs-var">dataConOrigResTy</span></a></span><span> </span><span class="annot"><span class="annottext">DataCon
</span><a href="#local-6989586621683097976"><span class="hs-identifier hs-var">con</span></a></span><span>
</span><span id="line-914"></span><span>             </span><span id="local-6989586621683097987"><span class="annot"><span class="annottext">stupid_theta :: [TcSigmaType]
</span><a href="#local-6989586621683097987"><span class="hs-identifier hs-var hs-var hs-var">stupid_theta</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">DataCon -&gt; [TcSigmaType]
</span><a href="GHC.Core.DataCon.html#dataConStupidTheta"><span class="hs-identifier hs-var">dataConStupidTheta</span></a></span><span> </span><span class="annot"><span class="annottext">DataCon
</span><a href="#local-6989586621683097976"><span class="hs-identifier hs-var">con</span></a></span><span>
</span><span id="line-915"></span><span>
</span><span id="line-916"></span><span>       </span><span class="hs-special">;</span><span> </span><span id="local-6989586621683097989"><span class="annot"><a href="#local-6989586621683097989"><span class="hs-identifier hs-var">scaled_arg_tys</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">(Scaled TcSigmaType
 -&gt; IOEnv (Env TcGblEnv TcLclEnv) (Scaled TcSigmaType))
-&gt; [Scaled TcSigmaType]
-&gt; IOEnv (Env TcGblEnv TcLclEnv) [Scaled TcSigmaType]
forall (t :: * -&gt; *) (m :: * -&gt; *) a b.
(Traversable t, Monad m) =&gt;
(a -&gt; m b) -&gt; t a -&gt; m (t b)
forall (m :: * -&gt; *) a b. Monad m =&gt; (a -&gt; m b) -&gt; [a] -&gt; m [b]
</span><span class="hs-identifier hs-var">mapM</span></span><span> </span><span class="annot"><span class="annottext">Scaled TcSigmaType
-&gt; IOEnv (Env TcGblEnv TcLclEnv) (Scaled TcSigmaType)
</span><a href="#local-6989586621683097991"><span class="hs-identifier hs-var">linear_to_poly</span></a></span><span> </span><span class="annot"><span class="annottext">[Scaled TcSigmaType]
</span><a href="#local-6989586621683097983"><span class="hs-identifier hs-var">args</span></a></span><span>
</span><span id="line-917"></span><span>
</span><span id="line-918"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621683097992"><span class="annot"><a href="#local-6989586621683097992"><span class="hs-identifier hs-var hs-var">full_theta</span></a></span></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[TcSigmaType]
</span><a href="#local-6989586621683097987"><span class="hs-identifier hs-var">stupid_theta</span></a></span><span> </span><span class="annot"><span class="annottext">[TcSigmaType] -&gt; [TcSigmaType] -&gt; [TcSigmaType]
forall a. [a] -&gt; [a] -&gt; [a]
</span><span class="hs-operator hs-var">++</span></span><span> </span><span class="annot"><span class="annottext">[TcSigmaType]
</span><a href="#local-6989586621683097981"><span class="hs-identifier hs-var">theta</span></a></span><span>
</span><span id="line-919"></span><span>             </span><span id="local-6989586621683097993"><span class="annot"><a href="#local-6989586621683097993"><span class="hs-identifier hs-var hs-var">all_arg_tys</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(TcSigmaType -&gt; Scaled TcSigmaType)
-&gt; [TcSigmaType] -&gt; [Scaled TcSigmaType]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><span class="hs-identifier hs-var">map</span></span><span> </span><span class="annot"><span class="annottext">TcSigmaType -&gt; Scaled TcSigmaType
forall a. a -&gt; Scaled a
</span><a href="GHC.Core.Type.html#unrestricted"><span class="hs-identifier hs-var">unrestricted</span></a></span><span> </span><span class="annot"><span class="annottext">[TcSigmaType]
</span><a href="#local-6989586621683097992"><span class="hs-identifier hs-var">full_theta</span></a></span><span> </span><span class="annot"><span class="annottext">[Scaled TcSigmaType]
-&gt; [Scaled TcSigmaType] -&gt; [Scaled TcSigmaType]
forall a. [a] -&gt; [a] -&gt; [a]
</span><span class="hs-operator hs-var">++</span></span><span> </span><span class="annot"><span class="annottext">[Scaled TcSigmaType]
</span><a href="#local-6989586621683097989"><span class="hs-identifier hs-var">scaled_arg_tys</span></a></span><span>
</span><span id="line-920"></span><span>                </span><span class="hs-comment">-- We are building the type of the data con wrapper, so the</span><span>
</span><span id="line-921"></span><span>                </span><span class="hs-comment">-- type must precisely match the construction in</span><span>
</span><span id="line-922"></span><span>                </span><span class="hs-comment">-- GHC.Core.DataCon.dataConWrapperType.</span><span>
</span><span id="line-923"></span><span>                </span><span class="hs-comment">-- See Note [Instantiating stupid theta]</span><span>
</span><span id="line-924"></span><span>                </span><span class="hs-comment">-- in GHC.Core.DataCon.</span><span>
</span><span id="line-925"></span><span>
</span><span id="line-926"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">return</span></span><span> </span><span class="hs-special">(</span><span> </span><span class="annot"><a href="Language.Haskell.Syntax.Expr.html#XExpr"><span class="hs-identifier hs-type">XExpr</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Hs.Expr.html#ConLikeTc"><span class="hs-identifier hs-type">ConLikeTc</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Core.ConLike.html#RealDataCon"><span class="hs-identifier hs-type">RealDataCon</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683097976"><span class="hs-identifier hs-type">con</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><a href="#local-6989586621683097979"><span class="hs-identifier hs-type">tvs</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683097993"><span class="hs-identifier hs-type">all_arg_tys</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-927"></span><span>                </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#mkInvisForAllTys"><span class="hs-identifier hs-type">mkInvisForAllTys</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683097977"><span class="hs-identifier hs-type">tvbs</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="annot"><a href="GHC.Tc.Utils.TcType.html#mkPhiTy"><span class="hs-identifier hs-type">mkPhiTy</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683097992"><span class="hs-identifier hs-type">full_theta</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span>
</span><span id="line-928"></span><span>                  </span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#mkScaledFunTys"><span class="hs-identifier hs-type">mkScaledFunTys</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683097989"><span class="hs-identifier hs-type">scaled_arg_tys</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683097985"><span class="hs-identifier hs-type">res</span></a></span><span> </span><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-929"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-930"></span><span>    </span><span class="annot"><a href="#local-6989586621683097991"><span class="hs-identifier hs-type">linear_to_poly</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#Scaled"><span class="hs-identifier hs-type">Scaled</span></a></span><span> </span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#Type"><span class="hs-identifier hs-type">Type</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#TcM"><span class="hs-identifier hs-type">TcM</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#Scaled"><span class="hs-identifier hs-type">Scaled</span></a></span><span> </span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#Type"><span class="hs-identifier hs-type">Type</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-931"></span><span>    </span><span class="hs-comment">-- linear_to_poly implements point (3,4)</span><span>
</span><span id="line-932"></span><span>    </span><span class="hs-comment">-- of Note [Typechecking data constructors]</span><span>
</span><span id="line-933"></span><span>    </span><span id="local-6989586621683097991"><span class="annot"><span class="annottext">linear_to_poly :: Scaled TcSigmaType
-&gt; IOEnv (Env TcGblEnv TcLclEnv) (Scaled TcSigmaType)
</span><a href="#local-6989586621683097991"><span class="hs-identifier hs-var hs-var">linear_to_poly</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#Scaled"><span class="hs-identifier hs-type">Scaled</span></a></span><span> </span><span class="annot"><span class="annottext">TcSigmaType
</span><a href="GHC.Core.Type.html#OneTy"><span class="hs-identifier hs-var">OneTy</span></a></span><span> </span><span id="local-6989586621683097999"><span class="annot"><span class="annottext">TcSigmaType
</span><a href="#local-6989586621683097999"><span class="hs-identifier hs-var">ty</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span id="local-6989586621683098000"><span class="annot"><a href="#local-6989586621683098000"><span class="hs-identifier hs-var">mul_var</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">TcSigmaType -&gt; TcM TcSigmaType
</span><a href="GHC.Tc.Utils.TcMType.html#newFlexiTyVarTy"><span class="hs-identifier hs-var">newFlexiTyVarTy</span></a></span><span> </span><span class="annot"><span class="annottext">TcSigmaType
</span><a href="GHC.Builtin.Types.html#multiplicityTy"><span class="hs-identifier hs-var">multiplicityTy</span></a></span><span>
</span><span id="line-934"></span><span>                                          </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">return</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#Scaled"><span class="hs-identifier hs-type">Scaled</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683098000"><span class="hs-identifier hs-type">mul_var</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683097999"><span class="hs-identifier hs-type">ty</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-935"></span><span>    </span><span class="annot"><a href="#local-6989586621683097991"><span class="hs-identifier hs-var">linear_to_poly</span></a></span><span> </span><span id="local-6989586621683098002"><span class="annot"><span class="annottext">Scaled TcSigmaType
</span><a href="#local-6989586621683098002"><span class="hs-identifier hs-var">scaled_ty</span></a></span></span><span>         </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Scaled TcSigmaType
-&gt; IOEnv (Env TcGblEnv TcLclEnv) (Scaled TcSigmaType)
forall a. a -&gt; IOEnv (Env TcGblEnv TcLclEnv) a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="annot"><span class="annottext">Scaled TcSigmaType
</span><a href="#local-6989586621683098002"><span class="hs-identifier hs-var">scaled_ty</span></a></span><span>
</span><span id="line-936"></span><span>
</span><span id="line-937"></span><span class="annot"><a href="GHC.Tc.Gen.Head.html#tcInferPatSyn"><span class="hs-identifier hs-type">tcInferPatSyn</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Types.Name.html#Name"><span class="hs-identifier hs-type">Name</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Core.PatSyn.html#PatSyn"><span class="hs-identifier hs-type">PatSyn</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#TcM"><span class="hs-identifier hs-type">TcM</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Language.Haskell.Syntax.Expr.html#HsExpr"><span class="hs-identifier hs-type">HsExpr</span></a></span><span> </span><span class="annot"><a href="GHC.Hs.Extension.html#GhcTc"><span class="hs-identifier hs-type">GhcTc</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.TcType.html#TcSigmaType"><span class="hs-identifier hs-type">TcSigmaType</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-938"></span><span id="tcInferPatSyn"><span class="annot"><span class="annottext">tcInferPatSyn :: Name -&gt; PatSyn -&gt; TcM (HsExpr GhcTc, TcSigmaType)
</span><a href="GHC.Tc.Gen.Head.html#tcInferPatSyn"><span class="hs-identifier hs-var hs-var">tcInferPatSyn</span></a></span></span><span> </span><span id="local-6989586621683098003"><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621683098003"><span class="hs-identifier hs-var">id_name</span></a></span></span><span> </span><span id="local-6989586621683098004"><span class="annot"><span class="annottext">PatSyn
</span><a href="#local-6989586621683098004"><span class="hs-identifier hs-var">ps</span></a></span></span><span>
</span><span id="line-939"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">PatSyn -&gt; Maybe (HsExpr GhcTc, TcSigmaType)
</span><a href="GHC.Tc.TyCl.PatSyn.html#patSynBuilderOcc"><span class="hs-identifier hs-var">patSynBuilderOcc</span></a></span><span> </span><span class="annot"><span class="annottext">PatSyn
</span><a href="#local-6989586621683098004"><span class="hs-identifier hs-var">ps</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-940"></span><span>       </span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span class="hs-special">(</span><span id="local-6989586621683098005"><span class="annot"><span class="annottext">HsExpr GhcTc
</span><a href="#local-6989586621683098005"><span class="hs-identifier hs-var">expr</span></a></span></span><span class="hs-special">,</span><span id="local-6989586621683098006"><span class="annot"><span class="annottext">TcSigmaType
</span><a href="#local-6989586621683098006"><span class="hs-identifier hs-var">ty</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">(HsExpr GhcTc, TcSigmaType) -&gt; TcM (HsExpr GhcTc, TcSigmaType)
forall a. a -&gt; IOEnv (Env TcGblEnv TcLclEnv) a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">HsExpr GhcTc
</span><a href="#local-6989586621683098005"><span class="hs-identifier hs-var">expr</span></a></span><span class="hs-special">,</span><span class="annot"><span class="annottext">TcSigmaType
</span><a href="#local-6989586621683098006"><span class="hs-identifier hs-var">ty</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-941"></span><span>       </span><span class="annot"><span class="annottext">Maybe (HsExpr GhcTc, TcSigmaType)
</span><span class="hs-identifier hs-var">Nothing</span></span><span>        </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">TcRnMessage -&gt; TcM (HsExpr GhcTc, TcSigmaType)
forall a. TcRnMessage -&gt; TcM a
</span><a href="GHC.Tc.Utils.Monad.html#failWithTc"><span class="hs-identifier hs-var">failWithTc</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Name -&gt; TcRnMessage
</span><a href="GHC.Tc.Gen.Head.html#nonBidirectionalErr"><span class="hs-identifier hs-var">nonBidirectionalErr</span></a></span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621683098003"><span class="hs-identifier hs-var">id_name</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-942"></span><span>
</span><span id="line-943"></span><span class="annot"><a href="GHC.Tc.Gen.Head.html#nonBidirectionalErr"><span class="hs-identifier hs-type">nonBidirectionalErr</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Types.Name.html#Name"><span class="hs-identifier hs-type">Name</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Errors.Types.html#TcRnMessage"><span class="hs-identifier hs-type">TcRnMessage</span></a></span><span>
</span><span id="line-944"></span><span id="nonBidirectionalErr"><span class="annot"><span class="annottext">nonBidirectionalErr :: Name -&gt; TcRnMessage
</span><a href="GHC.Tc.Gen.Head.html#nonBidirectionalErr"><span class="hs-identifier hs-var hs-var">nonBidirectionalErr</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Name -&gt; TcRnMessage
</span><a href="GHC.Tc.Errors.Types.html#TcRnPatSynNotBidirectional"><span class="hs-identifier hs-var">TcRnPatSynNotBidirectional</span></a></span><span>
</span><span id="line-945"></span><span>
</span><span id="line-946"></span><span class="hs-comment">{- Note [Adding the implicit parameter to 'assert']
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
The typechecker transforms (assert e1 e2) to (assertError e1 e2).
This isn't really the Right Thing because there's no way to &quot;undo&quot;
if you want to see the original source code in the typechecker
output.  We'll have fix this in due course, when we care more about
being able to reconstruct the exact original program.

Note [Typechecking data constructors]
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
As per Note [Polymorphisation of linear fields] in
GHC.Core.Multiplicity, linear fields of data constructors get a
polymorphic multiplicity when the data constructor is used as a term:

    Just :: forall {p} a. a %p -&gt; Maybe a

So at an occurrence of a data constructor we do the following:

1. Typechecking, in tcInferDataCon.

  a. Get the original type of the constructor, say
     K :: forall (r :: RuntimeRep) (a :: TYPE r). a %1 -&gt; T r a
     Note the %1: it is linear

  b. We are going to return a ConLikeTc, thus:
     XExpr (ConLikeTc K [r,a] [Scaled p a])
      :: forall (r :: RuntimeRep) (a :: TYPE r). a %p -&gt; T r a
   where 'p' is a fresh multiplicity unification variable.

   To get the returned ConLikeTc, we allocate a fresh multiplicity
   variable for each linear argument, and store the type, scaled by
   the fresh multiplicity variable in the ConLikeTc; along with
   the type of the ConLikeTc. This is done by linear_to_poly.

   If the argument is not linear (perhaps explicitly declared as
   non-linear by the user), don't bother with this.

2. Desugaring, in dsConLike.

  a. The (ConLikeTc K [r,a] [Scaled p a]) is desugared to
     (/\r (a :: TYPE r). \(x %p :: a). K @r @a x)
   which has the desired type given in the previous bullet.

   The 'p' is the multiplicity unification variable, which
   will by now have been unified to something, or defaulted in
   `GHC.Tc.Zonk.Type.commitFlexi`. So it won't just be an
   (unbound) variable.

   So a saturated application (K e), where e::Int will desugar to
     (/\r (a :: TYPE r). ..etc..)
        @LiftedRep @Int e
   and all those lambdas will beta-reduce away in the simple optimiser
   (see Wrinkle [Representation-polymorphic lambdas] below).

   But for an /unsaturated/ application, such as `map (K @LiftedRep @Int) xs`,
   beta reduction will leave (\x %Many :: Int. K x), which is the type `map`
   expects whereas if we had just plain K, with its linear type, we'd
   get a type mismatch. That's why we do this funky desugaring.

Wrinkles

  [ConLikeTc arguments]

    Note that the [TcType] argument to ConLikeTc is strictly redundant; those are
    the type variables from the dataConUserTyVarBinders of the data constructor.
    Similarly in the [Scaled TcType] field of ConLikeTc, the types come directly
    from the data constructor.  The only bit that /isn't/ redundant is the
    fresh multiplicity variables!

    So an alternative would be to define ConLikeTc like this:
        | ConLikeTc [TcType]    -- Just the multiplicity variables
    But then the desugarer would need to repeat some of the work done here.
    So for now at least ConLikeTc records this strictly-redundant info.

  [Representation-polymorphic lambdas]

    The lambda expression we produce in (4) can have representation-polymorphic
    arguments, as indeed in (/\r (a :: TYPE r). \(x %p :: a). K @r @a x),
    we have a lambda-bound variable x :: (a :: TYPE r).
    This goes against the representation polymorphism invariants given in
    Note [Representation polymorphism invariants] in GHC.Core. The trick is that
    this this lambda will always be instantiated in a way that upholds the invariants.
    This is achieved as follows:

      A. Any arguments to such lambda abstractions are guaranteed to have
         a fixed runtime representation. This is enforced in 'tcApp' by
         'matchActualFunTy'.

      B. If there are fewer arguments than there are bound term variables,
         we will ensure that the appropriate type arguments are instantiated
         concretely, such as 'r' in

         ( /\r (a :: TYPE r). \ (x %p :: a). K @r @a x) @IntRep @Int#
           :: Int# -&gt; T IntRep Int#

         See Note [Representation-polymorphic Ids with no binding] in GHC.Tc.Utils.Concrete

      C. In the output of the desugarer in (4) above, we have a representation
         polymorphic lambda, which Lint would normally reject. So for that one
         pass, we switch off Lint's representation-polymorphism checks; see
         the `lf_check_fixed_rep` flag in `LintFlags`.
-}</span><span>
</span><span id="line-1048"></span><span>
</span><span id="line-1049"></span><span class="hs-comment">{-
************************************************************************
*                                                                      *
                 Template Haskell checks
*                                                                      *
************************************************************************
-}</span><span>
</span><span id="line-1056"></span><span>
</span><span id="line-1057"></span><span class="annot"><a href="GHC.Tc.Gen.Head.html#checkThLocalId"><span class="hs-identifier hs-type">checkThLocalId</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Types.Var.html#Id"><span class="hs-identifier hs-type">Id</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#TcM"><span class="hs-identifier hs-type">TcM</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-1058"></span><span class="hs-comment">-- The renamer has already done checkWellStaged,</span><span>
</span><span id="line-1059"></span><span class="hs-comment">--   in RnSplice.checkThLocalName, so don't repeat that here.</span><span>
</span><span id="line-1060"></span><span class="hs-comment">-- Here we just add constraints for cross-stage lifting</span><span>
</span><span id="line-1061"></span><span id="checkThLocalId"><span class="annot"><span class="annottext">checkThLocalId :: Var -&gt; TcM ()
</span><a href="GHC.Tc.Gen.Head.html#checkThLocalId"><span class="hs-identifier hs-var hs-var">checkThLocalId</span></a></span></span><span> </span><span id="local-6989586621683098008"><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621683098008"><span class="hs-identifier hs-var">id</span></a></span></span><span>
</span><span id="line-1062"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>  </span><span class="hs-special">{</span><span> </span><span id="local-6989586621683098009"><span class="annot"><a href="#local-6989586621683098009"><span class="hs-identifier hs-var">mb_local_use</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Name -&gt; TcRn (Maybe (TopLevelFlag, ThLevel, ThStage))
</span><a href="GHC.Tc.Utils.Monad.html#getStageAndBindLevel"><span class="hs-identifier hs-var">getStageAndBindLevel</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Var -&gt; Name
</span><a href="GHC.Types.Id.html#idName"><span class="hs-identifier hs-var">idName</span></a></span><span> </span><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621683098008"><span class="hs-identifier hs-var">id</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1063"></span><span>        </span><span class="hs-special">;</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><a href="#local-6989586621683098009"><span class="hs-identifier hs-type">mb_local_use</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-1064"></span><span>             </span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span class="hs-special">(</span><span id="local-6989586621683098012"><span class="annot"><span class="annottext">TopLevelFlag
</span><a href="#local-6989586621683098012"><span class="hs-identifier hs-var">top_lvl</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621683098013"><span class="annot"><span class="annottext">ThLevel
</span><a href="#local-6989586621683098013"><span class="hs-identifier hs-var">bind_lvl</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621683098014"><span class="annot"><span class="annottext">ThStage
</span><a href="#local-6989586621683098014"><span class="hs-identifier hs-var">use_stage</span></a></span></span><span class="hs-special">)</span><span>
</span><span id="line-1065"></span><span>                </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">ThStage -&gt; ThLevel
</span><a href="GHC.Tc.Types.TH.html#thLevel"><span class="hs-identifier hs-var">thLevel</span></a></span><span> </span><span class="annot"><span class="annottext">ThStage
</span><a href="#local-6989586621683098014"><span class="hs-identifier hs-var">use_stage</span></a></span><span> </span><span class="annot"><span class="annottext">ThLevel -&gt; ThLevel -&gt; Bool
forall a. Ord a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">&gt;</span></span><span> </span><span class="annot"><span class="annottext">ThLevel
</span><a href="#local-6989586621683098013"><span class="hs-identifier hs-var">bind_lvl</span></a></span><span>
</span><span id="line-1066"></span><span>                </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">TopLevelFlag -&gt; Var -&gt; ThStage -&gt; TcM ()
</span><a href="GHC.Tc.Gen.Head.html#checkCrossStageLifting"><span class="hs-identifier hs-var">checkCrossStageLifting</span></a></span><span> </span><span class="annot"><span class="annottext">TopLevelFlag
</span><a href="#local-6989586621683098012"><span class="hs-identifier hs-var">top_lvl</span></a></span><span> </span><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621683098008"><span class="hs-identifier hs-var">id</span></a></span><span> </span><span class="annot"><span class="annottext">ThStage
</span><a href="#local-6989586621683098014"><span class="hs-identifier hs-var">use_stage</span></a></span><span>
</span><span id="line-1067"></span><span>             </span><span class="annot"><span class="annottext">Maybe (TopLevelFlag, ThLevel, ThStage)
</span><span class="hs-identifier">_</span></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">() -&gt; TcM ()
forall a. a -&gt; IOEnv (Env TcGblEnv TcLclEnv) a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>   </span><span class="hs-comment">-- Not a locally-bound thing, or</span><span>
</span><span id="line-1068"></span><span>                               </span><span class="hs-comment">-- no cross-stage link</span><span>
</span><span id="line-1069"></span><span>    </span><span class="hs-special">}</span><span>
</span><span id="line-1070"></span><span>
</span><span id="line-1071"></span><span class="hs-comment">--------------------------------------</span><span>
</span><span id="line-1072"></span><span class="annot"><a href="GHC.Tc.Gen.Head.html#checkCrossStageLifting"><span class="hs-identifier hs-type">checkCrossStageLifting</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Types.Basic.html#TopLevelFlag"><span class="hs-identifier hs-type">TopLevelFlag</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Types.Var.html#Id"><span class="hs-identifier hs-type">Id</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.TH.html#ThStage"><span class="hs-identifier hs-type">ThStage</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#TcM"><span class="hs-identifier hs-type">TcM</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-1073"></span><span class="hs-comment">-- If we are inside typed brackets, and (use_lvl &gt; bind_lvl)</span><span>
</span><span id="line-1074"></span><span class="hs-comment">-- we must check whether there's a cross-stage lift to do</span><span>
</span><span id="line-1075"></span><span class="hs-comment">-- Examples   \x -&gt; [|| x ||]</span><span>
</span><span id="line-1076"></span><span class="hs-comment">--            [|| map ||]</span><span>
</span><span id="line-1077"></span><span class="hs-comment">--</span><span>
</span><span id="line-1078"></span><span class="hs-comment">-- This is similar to checkCrossStageLifting in GHC.Rename.Splice, but</span><span>
</span><span id="line-1079"></span><span class="hs-comment">-- this code is applied to *typed* brackets.</span><span>
</span><span id="line-1080"></span><span>
</span><span id="line-1081"></span><span id="checkCrossStageLifting"><span class="annot"><span class="annottext">checkCrossStageLifting :: TopLevelFlag -&gt; Var -&gt; ThStage -&gt; TcM ()
</span><a href="GHC.Tc.Gen.Head.html#checkCrossStageLifting"><span class="hs-identifier hs-var hs-var">checkCrossStageLifting</span></a></span></span><span> </span><span id="local-6989586621683098018"><span class="annot"><span class="annottext">TopLevelFlag
</span><a href="#local-6989586621683098018"><span class="hs-identifier hs-var">top_lvl</span></a></span></span><span> </span><span id="local-6989586621683098019"><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621683098019"><span class="hs-identifier hs-var">id</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Tc.Types.TH.html#Brack"><span class="hs-identifier hs-type">Brack</span></a></span><span> </span><span class="annot"><span class="annottext">ThStage
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Tc.Types.TH.html#TcPending"><span class="hs-identifier hs-type">TcPending</span></a></span><span> </span><span id="local-6989586621683098022"><span class="annot"><span class="annottext">TcRef [PendingTcSplice]
</span><a href="#local-6989586621683098022"><span class="hs-identifier hs-var">ps_var</span></a></span></span><span> </span><span id="local-6989586621683098023"><span class="annot"><span class="annottext">TcRef WantedConstraints
</span><a href="#local-6989586621683098023"><span class="hs-identifier hs-var">lie_var</span></a></span></span><span> </span><span id="local-6989586621683098024"><span class="annot"><span class="annottext">QuoteWrapper
</span><a href="#local-6989586621683098024"><span class="hs-identifier hs-var">q</span></a></span></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-1082"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">TopLevelFlag -&gt; Bool
</span><a href="GHC.Types.Basic.html#isTopLevel"><span class="hs-identifier hs-var">isTopLevel</span></a></span><span> </span><span class="annot"><span class="annottext">TopLevelFlag
</span><a href="#local-6989586621683098018"><span class="hs-identifier hs-var">top_lvl</span></a></span><span>
</span><span id="line-1083"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Bool -&gt; TcM () -&gt; TcM ()
forall (f :: * -&gt; *). Applicative f =&gt; Bool -&gt; f () -&gt; f ()
</span><span class="hs-identifier hs-var">when</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Name -&gt; Bool
</span><a href="GHC.Types.Name.html#isExternalName"><span class="hs-identifier hs-var">isExternalName</span></a></span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621683098028"><span class="hs-identifier hs-var">id_name</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Name -&gt; TcM ()
</span><a href="GHC.Tc.Utils.Monad.html#keepAlive"><span class="hs-identifier hs-var">keepAlive</span></a></span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621683098028"><span class="hs-identifier hs-var">id_name</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1084"></span><span>    </span><span class="hs-comment">-- See Note [Keeping things alive for Template Haskell] in GHC.Rename.Splice</span><span>
</span><span id="line-1085"></span><span>
</span><span id="line-1086"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">otherwise</span></span><span>
</span><span id="line-1087"></span><span>  </span><span class="hs-glyph">=</span><span>     </span><span class="hs-comment">-- Nested identifiers, such as 'x' in</span><span>
</span><span id="line-1088"></span><span>        </span><span class="hs-comment">-- E.g. \x -&gt; [|| h x ||]</span><span>
</span><span id="line-1089"></span><span>        </span><span class="hs-comment">-- We must behave as if the reference to x was</span><span>
</span><span id="line-1090"></span><span>        </span><span class="hs-comment">--      h $(lift x)</span><span>
</span><span id="line-1091"></span><span>        </span><span class="hs-comment">-- We use 'x' itself as the splice proxy, used by</span><span>
</span><span id="line-1092"></span><span>        </span><span class="hs-comment">-- the desugarer to stitch it all back together.</span><span>
</span><span id="line-1093"></span><span>        </span><span class="hs-comment">-- If 'x' occurs many times we may get many identical</span><span>
</span><span id="line-1094"></span><span>        </span><span class="hs-comment">-- bindings of the same splice proxy, but that doesn't</span><span>
</span><span id="line-1095"></span><span>        </span><span class="hs-comment">-- matter, although it's a mite untidy.</span><span>
</span><span id="line-1096"></span><span>    </span><span class="hs-keyword">do</span><span>  </span><span class="hs-special">{</span><span> </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621683098030"><span class="annot"><span class="annottext">id_ty :: TcSigmaType
</span><a href="#local-6989586621683098030"><span class="hs-identifier hs-var hs-var hs-var">id_ty</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Var -&gt; TcSigmaType
</span><a href="GHC.Types.Id.html#idType"><span class="hs-identifier hs-var">idType</span></a></span><span> </span><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621683098019"><span class="hs-identifier hs-var">id</span></a></span><span>
</span><span id="line-1097"></span><span>        </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="annottext">Bool -&gt; TcRnMessage -&gt; TcM ()
</span><a href="GHC.Tc.Utils.Monad.html#checkTc"><span class="hs-identifier hs-var">checkTc</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TcSigmaType -&gt; Bool
</span><a href="GHC.Core.Type.html#isTauTy"><span class="hs-identifier hs-var">isTauTy</span></a></span><span> </span><span class="annot"><span class="annottext">TcSigmaType
</span><a href="#local-6989586621683098030"><span class="hs-identifier hs-var">id_ty</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(TcRnMessage -&gt; TcM ()) -&gt; TcRnMessage -&gt; TcM ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-1098"></span><span>          </span><span class="annot"><span class="annottext">THError -&gt; TcRnMessage
</span><a href="GHC.Tc.Errors.Types.html#TcRnTHError"><span class="hs-identifier hs-var">TcRnTHError</span></a></span><span> </span><span class="annot"><span class="annottext">(THError -&gt; TcRnMessage) -&gt; THError -&gt; TcRnMessage
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">TypedTHError -&gt; THError
</span><a href="GHC.Tc.Errors.Types.html#TypedTHError"><span class="hs-identifier hs-var">TypedTHError</span></a></span><span> </span><span class="annot"><span class="annottext">(TypedTHError -&gt; THError) -&gt; TypedTHError -&gt; THError
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Var -&gt; TypedTHError
</span><a href="GHC.Tc.Errors.Types.html#SplicePolymorphicLocalVar"><span class="hs-identifier hs-var">SplicePolymorphicLocalVar</span></a></span><span> </span><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621683098019"><span class="hs-identifier hs-var">id</span></a></span><span>
</span><span id="line-1099"></span><span>               </span><span class="hs-comment">-- If x is polymorphic, its occurrence sites might</span><span>
</span><span id="line-1100"></span><span>               </span><span class="hs-comment">-- have different instantiations, so we can't use plain</span><span>
</span><span id="line-1101"></span><span>               </span><span class="hs-comment">-- 'x' as the splice proxy name.  I don't know how to</span><span>
</span><span id="line-1102"></span><span>               </span><span class="hs-comment">-- solve this, and it's probably unimportant, so I'm</span><span>
</span><span id="line-1103"></span><span>               </span><span class="hs-comment">-- just going to flag an error for now</span><span>
</span><span id="line-1104"></span><span>
</span><span id="line-1105"></span><span>        </span><span class="hs-special">;</span><span> </span><span id="local-6989586621683098036"><span class="annot"><a href="#local-6989586621683098036"><span class="hs-identifier hs-var">lift</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-keyword">if</span><span> </span><span class="annot"><span class="annottext">TcSigmaType -&gt; Bool
</span><a href="GHC.Tc.Utils.TcType.html#isStringTy"><span class="hs-identifier hs-var">isStringTy</span></a></span><span> </span><span class="annot"><span class="annottext">TcSigmaType
</span><a href="#local-6989586621683098030"><span class="hs-identifier hs-var">id_ty</span></a></span><span> </span><span class="hs-keyword">then</span><span>
</span><span id="line-1106"></span><span>                     </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span id="local-6989586621683098038"><span class="annot"><a href="#local-6989586621683098038"><span class="hs-identifier hs-var">sid</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Name -&gt; TcM Var
</span><a href="GHC.Tc.Utils.Env.html#tcLookupId"><span class="hs-identifier hs-var">tcLookupId</span></a></span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="GHC.Builtin.Names.TH.html#liftStringName"><span class="hs-identifier hs-var">GHC.Builtin.Names.TH.liftStringName</span></a></span><span>
</span><span id="line-1107"></span><span>                                     </span><span class="hs-comment">-- See Note [Lifting strings]</span><span>
</span><span id="line-1108"></span><span>                        </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">return</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Language.Haskell.Syntax.Expr.html#HsVar"><span class="hs-identifier hs-type">HsVar</span></a></span><span> </span><span class="annot"><a href="Language.Haskell.Syntax.Extension.html#noExtField"><span class="hs-identifier hs-type">noExtField</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Parser.Annotation.html#noLocA"><span class="hs-identifier hs-type">noLocA</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683098038"><span class="hs-identifier hs-type">sid</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-1109"></span><span>                  </span><span class="hs-keyword">else</span><span>
</span><span id="line-1110"></span><span>                     </span><span class="annot"><span class="annottext">TcRef WantedConstraints -&gt; TcM (HsExpr GhcTc) -&gt; TcM (HsExpr GhcTc)
forall a. TcRef WantedConstraints -&gt; TcM a -&gt; TcM a
</span><a href="GHC.Tc.Utils.Monad.html#setConstraintVar"><span class="hs-identifier hs-var">setConstraintVar</span></a></span><span> </span><span class="annot"><span class="annottext">TcRef WantedConstraints
</span><a href="#local-6989586621683098023"><span class="hs-identifier hs-var">lie_var</span></a></span><span>   </span><span class="annot"><span class="annottext">(TcM (HsExpr GhcTc) -&gt; TcM (HsExpr GhcTc))
-&gt; TcM (HsExpr GhcTc) -&gt; TcM (HsExpr GhcTc)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-1111"></span><span>                          </span><span class="hs-comment">-- Put the 'lift' constraint into the right LIE</span><span>
</span><span id="line-1112"></span><span>                     </span><span class="annot"><span class="annottext">CtOrigin -&gt; Name -&gt; [TcSigmaType] -&gt; TcM (HsExpr GhcTc)
</span><a href="GHC.Tc.Utils.Instantiate.html#newMethodFromName"><span class="hs-identifier hs-var">newMethodFromName</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Name -&gt; CtOrigin
</span><a href="GHC.Tc.Types.Origin.html#OccurrenceOf"><span class="hs-identifier hs-var">OccurrenceOf</span></a></span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621683098028"><span class="hs-identifier hs-var">id_name</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1113"></span><span>                                       </span><span class="annot"><span class="annottext">Name
</span><a href="GHC.Builtin.Names.TH.html#liftName"><span class="hs-identifier hs-var">GHC.Builtin.Names.TH.liftName</span></a></span><span>
</span><span id="line-1114"></span><span>                                       </span><span class="hs-special">[</span><span class="annot"><span class="annottext">HasDebugCallStack =&gt; TcSigmaType -&gt; TcSigmaType
TcSigmaType -&gt; TcSigmaType
</span><a href="GHC.Core.Type.html#getRuntimeRep"><span class="hs-identifier hs-var">getRuntimeRep</span></a></span><span> </span><span class="annot"><span class="annottext">TcSigmaType
</span><a href="#local-6989586621683098030"><span class="hs-identifier hs-var">id_ty</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">TcSigmaType
</span><a href="#local-6989586621683098030"><span class="hs-identifier hs-var">id_ty</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-1115"></span><span>
</span><span id="line-1116"></span><span>                   </span><span class="hs-comment">-- Warning for implicit lift (#17804)</span><span>
</span><span id="line-1117"></span><span>        </span><span class="hs-special">;</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.Monad.html#addDetailedDiagnostic"><span class="hs-identifier hs-type">addDetailedDiagnostic</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Tc.Errors.Types.html#TcRnImplicitLift"><span class="hs-identifier hs-type">TcRnImplicitLift</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="annot"><a href="GHC.Types.Id.html#idName"><span class="hs-identifier hs-type">idName</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683098019"><span class="hs-identifier hs-type">id</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1118"></span><span>
</span><span id="line-1119"></span><span>                   </span><span class="hs-comment">-- Update the pending splices</span><span>
</span><span id="line-1120"></span><span>        </span><span class="hs-special">;</span><span> </span><span id="local-6989586621683098044"><span class="annot"><a href="#local-6989586621683098044"><span class="hs-identifier hs-var">ps</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><a href="GHC.Data.IOEnv.html#readMutVar"><span class="hs-identifier hs-type">readMutVar</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683098022"><span class="hs-identifier hs-type">ps_var</span></a></span><span>
</span><span id="line-1121"></span><span>        </span><span class="hs-special">;</span><span> </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621683098046"><span class="annot"><a href="#local-6989586621683098046"><span class="hs-identifier hs-var hs-var">pending_splice</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Name -&gt; LHsExpr GhcTc -&gt; PendingTcSplice
</span><a href="GHC.Hs.Expr.html#PendingTcSplice"><span class="hs-identifier hs-var">PendingTcSplice</span></a></span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621683098028"><span class="hs-identifier hs-var">id_name</span></a></span><span>
</span><span id="line-1122"></span><span>                                 </span><span class="hs-special">(</span><span class="annot"><span class="annottext">LHsExpr GhcTc -&gt; LHsExpr GhcTc -&gt; LHsExpr GhcTc
forall (id :: Pass).
IsPass id =&gt;
LHsExpr (GhcPass id)
-&gt; LHsExpr (GhcPass id) -&gt; LHsExpr (GhcPass id)
</span><a href="GHC.Hs.Utils.html#nlHsApp"><span class="hs-identifier hs-var">nlHsApp</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">HsWrapper -&gt; LHsExpr GhcTc -&gt; LHsExpr GhcTc
</span><a href="GHC.Hs.Utils.html#mkLHsWrap"><span class="hs-identifier hs-var">mkLHsWrap</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">QuoteWrapper -&gt; HsWrapper
</span><a href="GHC.Tc.Types.Evidence.html#applyQuoteWrapper"><span class="hs-identifier hs-var">applyQuoteWrapper</span></a></span><span> </span><span class="annot"><span class="annottext">QuoteWrapper
</span><a href="#local-6989586621683098024"><span class="hs-identifier hs-var">q</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">HsExpr GhcTc -&gt; GenLocated SrcSpanAnnA (HsExpr GhcTc)
forall e a. HasAnnotation e =&gt; a -&gt; GenLocated e a
</span><a href="GHC.Parser.Annotation.html#noLocA"><span class="hs-identifier hs-var">noLocA</span></a></span><span> </span><span class="annot"><span class="annottext">HsExpr GhcTc
</span><a href="#local-6989586621683098036"><span class="hs-identifier hs-var">lift</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-1123"></span><span>                                          </span><span class="hs-special">(</span><span class="annot"><span class="annottext">IdP GhcTc -&gt; LHsExpr GhcTc
forall (p :: Pass) a.
IsSrcSpanAnn p a =&gt;
IdP (GhcPass p) -&gt; LHsExpr (GhcPass p)
</span><a href="GHC.Hs.Utils.html#nlHsVar"><span class="hs-identifier hs-var">nlHsVar</span></a></span><span> </span><span class="annot"><span class="annottext">IdP GhcTc
Var
</span><a href="#local-6989586621683098019"><span class="hs-identifier hs-var">id</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-1124"></span><span>        </span><span class="hs-special">;</span><span> </span><span class="annot"><a href="GHC.Data.IOEnv.html#writeMutVar"><span class="hs-identifier hs-type">writeMutVar</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683098022"><span class="hs-identifier hs-type">ps_var</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621683098046"><span class="hs-identifier hs-type">pending_splice</span></a></span><span> </span><span class="annot"><span class="hs-glyph hs-type">:</span></span><span> </span><span class="annot"><a href="#local-6989586621683098044"><span class="hs-identifier hs-type">ps</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1125"></span><span>
</span><span id="line-1126"></span><span>        </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">return</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-1127"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-1128"></span><span>    </span><span id="local-6989586621683098028"><span class="annot"><span class="annottext">id_name :: Name
</span><a href="#local-6989586621683098028"><span class="hs-identifier hs-var hs-var">id_name</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Var -&gt; Name
</span><a href="GHC.Types.Id.html#idName"><span class="hs-identifier hs-var">idName</span></a></span><span> </span><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621683098019"><span class="hs-identifier hs-var">id</span></a></span><span>
</span><span id="line-1129"></span><span>
</span><span id="line-1130"></span><span class="annot"><a href="GHC.Tc.Gen.Head.html#checkCrossStageLifting"><span class="hs-identifier hs-var">checkCrossStageLifting</span></a></span><span> </span><span class="annot"><span class="annottext">TopLevelFlag
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">Var
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">ThStage
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">() -&gt; TcM ()
forall a. a -&gt; IOEnv (Env TcGblEnv TcLclEnv) a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-1131"></span><span>
</span><span id="line-1132"></span><span class="hs-comment">{-
Note [Lifting strings]
~~~~~~~~~~~~~~~~~~~~~~
If we see $(... [| s |] ...) where s::String, we don't want to
generate a mass of Cons (CharL 'x') (Cons (CharL 'y') ...)) etc.
So this conditional short-circuits the lifting mechanism to generate
(liftString &quot;xy&quot;) in that case.  I didn't want to use overlapping instances
for the Lift class in TH.Syntax, because that can lead to overlapping-instance
errors in a polymorphic situation.

If this check fails (which isn't impossible) we get another chance; see
Note [Converting strings] in Convert.hs

Note [Local record selectors]
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
Record selectors for TyCons in this module are ordinary local bindings,
which show up as ATcIds rather than AGlobals.  So we need to check for
naughtiness in both branches.  c.f. GHC.Tc.TyCl.Utils.mkRecSelBinds.
-}</span><span>
</span><span id="line-1151"></span><span>
</span><span id="line-1152"></span><span>
</span><span id="line-1153"></span><span class="annot"><span class="hs-comment">{- *********************************************************************
*                                                                      *
         Error reporting for function result mis-matches
*                                                                      *
********************************************************************* -}</span></span><span>
</span><span id="line-1158"></span><span>
</span><span id="line-1159"></span><span id="local-6989586621683097083"><span id="local-6989586621683097084"><span class="annot"><a href="GHC.Tc.Gen.Head.html#addFunResCtxt"><span class="hs-identifier hs-type">addFunResCtxt</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Language.Haskell.Syntax.Expr.html#HsExpr"><span class="hs-identifier hs-type">HsExpr</span></a></span><span> </span><span class="annot"><a href="GHC.Hs.Extension.html#GhcTc"><span class="hs-identifier hs-type">GhcTc</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="GHC.Tc.Gen.Head.html#HsExprArg"><span class="hs-identifier hs-type">HsExprArg</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683097083"><span class="hs-identifier hs-type">p</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-1160"></span><span>              </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.TcType.html#TcType"><span class="hs-identifier hs-type">TcType</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.TcType.html#ExpRhoType"><span class="hs-identifier hs-type">ExpRhoType</span></a></span><span>
</span><span id="line-1161"></span><span>              </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#TcM"><span class="hs-identifier hs-type">TcM</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683097084"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#TcM"><span class="hs-identifier hs-type">TcM</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683097084"><span class="hs-identifier hs-type">a</span></a></span></span></span><span>
</span><span id="line-1162"></span><span class="hs-comment">-- When we have a mis-match in the return type of a function</span><span>
</span><span id="line-1163"></span><span class="hs-comment">-- try to give a helpful message about too many/few arguments</span><span>
</span><span id="line-1164"></span><span class="hs-comment">-- But not in generated code, where we don't want</span><span>
</span><span id="line-1165"></span><span class="hs-comment">-- to mention internal (rebindable syntax) function names</span><span>
</span><span id="line-1166"></span><span id="addFunResCtxt"><span class="annot"><span class="annottext">addFunResCtxt :: forall (p :: TcPass) a.
HsExpr GhcTc
-&gt; [HsExprArg p] -&gt; TcSigmaType -&gt; ExpRhoType -&gt; TcM a -&gt; TcM a
</span><a href="GHC.Tc.Gen.Head.html#addFunResCtxt"><span class="hs-identifier hs-var hs-var">addFunResCtxt</span></a></span></span><span> </span><span id="local-6989586621683098088"><span class="annot"><span class="annottext">HsExpr GhcTc
</span><a href="#local-6989586621683098088"><span class="hs-identifier hs-var">fun</span></a></span></span><span> </span><span id="local-6989586621683098089"><span class="annot"><span class="annottext">[HsExprArg p]
</span><a href="#local-6989586621683098089"><span class="hs-identifier hs-var">args</span></a></span></span><span> </span><span id="local-6989586621683098090"><span class="annot"><span class="annottext">TcSigmaType
</span><a href="#local-6989586621683098090"><span class="hs-identifier hs-var">fun_res_ty</span></a></span></span><span> </span><span id="local-6989586621683098091"><span class="annot"><span class="annottext">ExpRhoType
</span><a href="#local-6989586621683098091"><span class="hs-identifier hs-var">env_ty</span></a></span></span><span> </span><span id="local-6989586621683098092"><span class="annot"><span class="annottext">TcM a
</span><a href="#local-6989586621683098092"><span class="hs-identifier hs-var">thing_inside</span></a></span></span><span>
</span><span id="line-1167"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span id="local-6989586621683098093"><span class="annot"><a href="#local-6989586621683098093"><span class="hs-identifier hs-var">env_tv</span></a></span></span><span>  </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">TcSigmaType -&gt; TcM TcSigmaType
</span><a href="GHC.Tc.Utils.TcMType.html#newFlexiTyVarTy"><span class="hs-identifier hs-var">newFlexiTyVarTy</span></a></span><span> </span><span class="annot"><span class="annottext">TcSigmaType
</span><a href="GHC.Builtin.Types.html#liftedTypeKind"><span class="hs-identifier hs-var">liftedTypeKind</span></a></span><span>
</span><span id="line-1168"></span><span>       </span><span class="hs-special">;</span><span> </span><span id="local-6989586621683098095"><span class="annot"><a href="#local-6989586621683098095"><span class="hs-identifier hs-var">dumping</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.Monad.html#doptM"><span class="hs-identifier hs-type">doptM</span></a></span><span> </span><span class="annot"><a href="GHC.Driver.Flags.html#Opt_D_dump_tc_trace"><span class="hs-identifier hs-type">Opt_D_dump_tc_trace</span></a></span><span>
</span><span id="line-1169"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.Monad.html#addLandmarkErrCtxtM"><span class="hs-identifier hs-type">addLandmarkErrCtxtM</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span id="local-6989586621683098099"><span class="annot"><span class="annottext">TidyEnv
</span><a href="#local-6989586621683098099"><span class="hs-identifier hs-var">env</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TidyEnv
</span><a href="#local-6989586621683098099"><span class="hs-identifier hs-var">env</span></a></span><span class="hs-special">,</span><span> </span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(SDoc -&gt; (TidyEnv, SDoc)) -&gt; ZonkM SDoc -&gt; ZonkM (TidyEnv, SDoc)
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="annot"><span class="annottext">Bool -&gt; TcSigmaType -&gt; ZonkM SDoc
</span><a href="#local-6989586621683098100"><span class="hs-identifier hs-var">mk_msg</span></a></span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621683098095"><span class="hs-identifier hs-var">dumping</span></a></span><span> </span><span class="annot"><span class="annottext">TcSigmaType
</span><a href="#local-6989586621683098093"><span class="hs-identifier hs-var">env_tv</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><a href="#local-6989586621683098092"><span class="hs-identifier hs-type">thing_inside</span></a></span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-1170"></span><span>      </span><span class="hs-comment">-- NB: use a landmark error context, so that an empty context</span><span>
</span><span id="line-1171"></span><span>      </span><span class="hs-comment">-- doesn't suppress some more useful context</span><span>
</span><span id="line-1172"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-1173"></span><span>    </span><span id="local-6989586621683098100"><span class="annot"><span class="annottext">mk_msg :: Bool -&gt; TcSigmaType -&gt; ZonkM SDoc
</span><a href="#local-6989586621683098100"><span class="hs-identifier hs-var hs-var">mk_msg</span></a></span></span><span> </span><span id="local-6989586621683098101"><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621683098101"><span class="hs-identifier hs-var">dumping</span></a></span></span><span> </span><span id="local-6989586621683098102"><span class="annot"><span class="annottext">TcSigmaType
</span><a href="#local-6989586621683098102"><span class="hs-identifier hs-var">env_tv</span></a></span></span><span>
</span><span id="line-1174"></span><span>      </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span id="local-6989586621683098103"><span class="annot"><a href="#local-6989586621683098103"><span class="hs-identifier hs-var">mb_env_ty</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">ExpRhoType -&gt; ZonkM (Maybe TcSigmaType)
forall (m :: * -&gt; *).
MonadIO m =&gt;
ExpRhoType -&gt; m (Maybe TcSigmaType)
</span><a href="GHC.Tc.Utils.TcMType.html#readExpType_maybe"><span class="hs-identifier hs-var">readExpType_maybe</span></a></span><span> </span><span class="annot"><span class="annottext">ExpRhoType
</span><a href="#local-6989586621683098091"><span class="hs-identifier hs-var">env_ty</span></a></span><span>
</span><span id="line-1175"></span><span>                     </span><span class="hs-comment">-- by the time the message is rendered, the ExpType</span><span>
</span><span id="line-1176"></span><span>                     </span><span class="hs-comment">-- will be filled in (except if we're debugging)</span><span>
</span><span id="line-1177"></span><span>           </span><span class="hs-special">;</span><span> </span><span id="local-6989586621683098105"><span class="annot"><a href="#local-6989586621683098105"><span class="hs-identifier hs-var">fun_res'</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><a href="GHC.Tc.Zonk.TcType.html#zonkTcType"><span class="hs-identifier hs-type">zonkTcType</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683098090"><span class="hs-identifier hs-type">fun_res_ty</span></a></span><span>
</span><span id="line-1178"></span><span>           </span><span class="hs-special">;</span><span> </span><span id="local-6989586621683098106"><span class="annot"><a href="#local-6989586621683098106"><span class="hs-identifier hs-var">env'</span></a></span></span><span>     </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><a href="#local-6989586621683098103"><span class="hs-identifier hs-type">mb_env_ty</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-1179"></span><span>                           </span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span id="local-6989586621683098107"><span class="annot"><span class="annottext">TcSigmaType
</span><a href="#local-6989586621683098107"><span class="hs-identifier hs-var">env_ty</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">TcSigmaType -&gt; ZonkM TcSigmaType
</span><a href="GHC.Tc.Zonk.TcType.html#zonkTcType"><span class="hs-identifier hs-var">zonkTcType</span></a></span><span> </span><span class="annot"><span class="annottext">TcSigmaType
</span><a href="#local-6989586621683098107"><span class="hs-identifier hs-var">env_ty</span></a></span><span>
</span><span id="line-1180"></span><span>                           </span><span class="annot"><span class="annottext">Maybe TcSigmaType
</span><span class="hs-identifier hs-var">Nothing</span></span><span>     </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">Bool -&gt; ZonkM ()
forall (m :: * -&gt; *). (HasCallStack, Applicative m) =&gt; Bool -&gt; m ()
</span><a href="GHC.Utils.Panic.Plain.html#massert"><span class="hs-identifier hs-var">massert</span></a></span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621683098101"><span class="hs-identifier hs-var">dumping</span></a></span><span class="hs-special">;</span><span> </span><span class="annot"><span class="annottext">TcSigmaType -&gt; ZonkM TcSigmaType
forall a. a -&gt; ZonkM a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="annot"><span class="annottext">TcSigmaType
</span><a href="#local-6989586621683098102"><span class="hs-identifier hs-var">env_tv</span></a></span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-1181"></span><span>           </span><span class="hs-special">;</span><span> </span><span class="hs-keyword">let</span><span> </span><span class="hs-comment">-- See Note [Splitting nested sigma types in mismatched</span><span>
</span><span id="line-1182"></span><span>                 </span><span class="hs-comment">--           function types]</span><span>
</span><span id="line-1183"></span><span>                 </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">_</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">_</span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621683098109"><span class="annot"><a href="#local-6989586621683098109"><span class="hs-identifier hs-var">fun_tau</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.TcType.html#tcSplitNestedSigmaTys"><span class="hs-identifier hs-type">tcSplitNestedSigmaTys</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683098105"><span class="hs-identifier hs-type">fun_res'</span></a></span><span>
</span><span id="line-1184"></span><span>                 </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">_</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">_</span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621683098111"><span class="annot"><a href="#local-6989586621683098111"><span class="hs-identifier hs-var">env_tau</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.TcType.html#tcSplitNestedSigmaTys"><span class="hs-identifier hs-type">tcSplitNestedSigmaTys</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683098106"><span class="hs-identifier hs-type">env'</span></a></span><span>
</span><span id="line-1185"></span><span>                     </span><span class="hs-comment">-- env_ty is an ExpRhoTy, but with simple subsumption it</span><span>
</span><span id="line-1186"></span><span>                     </span><span class="hs-comment">-- is not deeply skolemised, so still use tcSplitNestedSigmaTys</span><span>
</span><span id="line-1187"></span><span>                 </span><span class="hs-special">(</span><span id="local-6989586621683098112"><span class="annot"><a href="#local-6989586621683098112"><span class="hs-identifier hs-var">args_fun</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621683098113"><span class="annot"><a href="#local-6989586621683098113"><span class="hs-identifier hs-var">res_fun</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.TcType.html#tcSplitFunTys"><span class="hs-identifier hs-type">tcSplitFunTys</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683098109"><span class="hs-identifier hs-type">fun_tau</span></a></span><span>
</span><span id="line-1188"></span><span>                 </span><span class="hs-special">(</span><span id="local-6989586621683098115"><span class="annot"><a href="#local-6989586621683098115"><span class="hs-identifier hs-var">args_env</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621683098116"><span class="annot"><a href="#local-6989586621683098116"><span class="hs-identifier hs-var">res_env</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.TcType.html#tcSplitFunTys"><span class="hs-identifier hs-type">tcSplitFunTys</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683098111"><span class="hs-identifier hs-type">env_tau</span></a></span><span>
</span><span id="line-1189"></span><span>                 </span><span id="local-6989586621683098117"><span class="annot"><a href="#local-6989586621683098117"><span class="hs-identifier hs-var hs-var">n_fun</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[Scaled TcSigmaType] -&gt; ThLevel
forall a. [a] -&gt; ThLevel
forall (t :: * -&gt; *) a. Foldable t =&gt; t a -&gt; ThLevel
</span><span class="hs-identifier hs-var">length</span></span><span> </span><span class="annot"><span class="annottext">[Scaled TcSigmaType]
</span><a href="#local-6989586621683098112"><span class="hs-identifier hs-var">args_fun</span></a></span><span>
</span><span id="line-1190"></span><span>                 </span><span id="local-6989586621683098119"><span class="annot"><a href="#local-6989586621683098119"><span class="hs-identifier hs-var hs-var">n_env</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[Scaled TcSigmaType] -&gt; ThLevel
forall a. [a] -&gt; ThLevel
forall (t :: * -&gt; *) a. Foldable t =&gt; t a -&gt; ThLevel
</span><span class="hs-identifier hs-var">length</span></span><span> </span><span class="annot"><span class="annottext">[Scaled TcSigmaType]
</span><a href="#local-6989586621683098115"><span class="hs-identifier hs-var">args_env</span></a></span><span>
</span><span id="line-1191"></span><span>                 </span><span id="local-6989586621683098120"><span class="annot"><a href="#local-6989586621683098120"><span class="hs-identifier hs-var hs-var">info</span></a></span></span><span>  </span><span class="hs-glyph">|</span><span> </span><span class="hs-comment">-- Check for too few args</span><span>
</span><span id="line-1192"></span><span>                         </span><span class="hs-comment">--  fun_tau = a -&gt; b, res_tau = Int</span><span>
</span><span id="line-1193"></span><span>                         </span><span class="annot"><span class="annottext">ThLevel
</span><a href="#local-6989586621683098117"><span class="hs-identifier hs-var">n_fun</span></a></span><span> </span><span class="annot"><span class="annottext">ThLevel -&gt; ThLevel -&gt; Bool
forall a. Ord a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">&gt;</span></span><span> </span><span class="annot"><span class="annottext">ThLevel
</span><a href="#local-6989586621683098119"><span class="hs-identifier hs-var">n_env</span></a></span><span>
</span><span id="line-1194"></span><span>                       </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">TcSigmaType -&gt; Bool
</span><a href="#local-6989586621683098121"><span class="hs-identifier hs-var">not_fun</span></a></span><span> </span><span class="annot"><span class="annottext">TcSigmaType
</span><a href="#local-6989586621683098116"><span class="hs-identifier hs-var">res_env</span></a></span><span>
</span><span id="line-1195"></span><span>                       </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">String -&gt; SDoc
forall doc. IsLine doc =&gt; String -&gt; doc
</span><a href="GHC.Utils.Outputable.html#text"><span class="hs-identifier hs-var">text</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;Probable cause:&quot;</span></span><span> </span><span class="annot"><span class="annottext">SDoc -&gt; SDoc -&gt; SDoc
forall doc. IsLine doc =&gt; doc -&gt; doc -&gt; doc
</span><a href="GHC.Utils.Outputable.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">SDoc -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#quotes"><span class="hs-identifier hs-var">quotes</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">HsExpr GhcTc -&gt; SDoc
forall a. Outputable a =&gt; a -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="annot"><span class="annottext">HsExpr GhcTc
</span><a href="#local-6989586621683098088"><span class="hs-identifier hs-var">fun</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1196"></span><span>                         </span><span class="annot"><span class="annottext">SDoc -&gt; SDoc -&gt; SDoc
forall doc. IsLine doc =&gt; doc -&gt; doc -&gt; doc
</span><a href="GHC.Utils.Outputable.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">String -&gt; SDoc
forall doc. IsLine doc =&gt; String -&gt; doc
</span><a href="GHC.Utils.Outputable.html#text"><span class="hs-identifier hs-var">text</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;is applied to too few arguments&quot;</span></span><span>
</span><span id="line-1197"></span><span>
</span><span id="line-1198"></span><span>                       </span><span class="hs-glyph">|</span><span> </span><span class="hs-comment">-- Check for too many args</span><span>
</span><span id="line-1199"></span><span>                         </span><span class="hs-comment">-- fun_tau = a -&gt; Int,   res_tau = a -&gt; b -&gt; c -&gt; d</span><span>
</span><span id="line-1200"></span><span>                         </span><span class="hs-comment">-- The final guard suppresses the message when there</span><span>
</span><span id="line-1201"></span><span>                         </span><span class="hs-comment">-- aren't enough args to drop; eg. the call is (f e1)</span><span>
</span><span id="line-1202"></span><span>                         </span><span class="annot"><span class="annottext">ThLevel
</span><a href="#local-6989586621683098117"><span class="hs-identifier hs-var">n_fun</span></a></span><span> </span><span class="annot"><span class="annottext">ThLevel -&gt; ThLevel -&gt; Bool
forall a. Ord a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">&lt;</span></span><span> </span><span class="annot"><span class="annottext">ThLevel
</span><a href="#local-6989586621683098119"><span class="hs-identifier hs-var">n_env</span></a></span><span>
</span><span id="line-1203"></span><span>                       </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">TcSigmaType -&gt; Bool
</span><a href="#local-6989586621683098121"><span class="hs-identifier hs-var">not_fun</span></a></span><span> </span><span class="annot"><span class="annottext">TcSigmaType
</span><a href="#local-6989586621683098113"><span class="hs-identifier hs-var">res_fun</span></a></span><span>
</span><span id="line-1204"></span><span>                       </span><span class="hs-special">,</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ThLevel
</span><a href="#local-6989586621683098117"><span class="hs-identifier hs-var">n_fun</span></a></span><span> </span><span class="annot"><span class="annottext">ThLevel -&gt; ThLevel -&gt; ThLevel
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">+</span></span><span> </span><span class="annot"><span class="annottext">(HsExprArg p -&gt; Bool) -&gt; [HsExprArg p] -&gt; ThLevel
forall a. (a -&gt; Bool) -&gt; [a] -&gt; ThLevel
</span><a href="GHC.Utils.Misc.html#count"><span class="hs-identifier hs-var">count</span></a></span><span> </span><span class="annot"><span class="annottext">HsExprArg p -&gt; Bool
forall (id :: TcPass). HsExprArg id -&gt; Bool
</span><a href="GHC.Tc.Gen.Head.html#isValArg"><span class="hs-identifier hs-var">isValArg</span></a></span><span> </span><span class="annot"><span class="annottext">[HsExprArg p]
</span><a href="#local-6989586621683098089"><span class="hs-identifier hs-var">args</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">ThLevel -&gt; ThLevel -&gt; Bool
forall a. Ord a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">&gt;=</span></span><span> </span><span class="annot"><span class="annottext">ThLevel
</span><a href="#local-6989586621683098119"><span class="hs-identifier hs-var">n_env</span></a></span><span>
</span><span id="line-1205"></span><span>                          </span><span class="hs-comment">-- Never suggest that a naked variable is</span><span>
</span><span id="line-1206"></span><span>                                           </span><span class="hs-comment">-- applied to too many args!</span><span>
</span><span id="line-1207"></span><span>                       </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">String -&gt; SDoc
forall doc. IsLine doc =&gt; String -&gt; doc
</span><a href="GHC.Utils.Outputable.html#text"><span class="hs-identifier hs-var">text</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;Possible cause:&quot;</span></span><span> </span><span class="annot"><span class="annottext">SDoc -&gt; SDoc -&gt; SDoc
forall doc. IsLine doc =&gt; doc -&gt; doc -&gt; doc
</span><a href="GHC.Utils.Outputable.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">SDoc -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#quotes"><span class="hs-identifier hs-var">quotes</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">HsExpr GhcTc -&gt; SDoc
forall a. Outputable a =&gt; a -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="annot"><span class="annottext">HsExpr GhcTc
</span><a href="#local-6989586621683098088"><span class="hs-identifier hs-var">fun</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1208"></span><span>                         </span><span class="annot"><span class="annottext">SDoc -&gt; SDoc -&gt; SDoc
forall doc. IsLine doc =&gt; doc -&gt; doc -&gt; doc
</span><a href="GHC.Utils.Outputable.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">String -&gt; SDoc
forall doc. IsLine doc =&gt; String -&gt; doc
</span><a href="GHC.Utils.Outputable.html#text"><span class="hs-identifier hs-var">text</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;is applied to too many arguments&quot;</span></span><span>
</span><span id="line-1209"></span><span>
</span><span id="line-1210"></span><span>                       </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">otherwise</span></span><span>
</span><span id="line-1211"></span><span>                       </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">SDoc
forall doc. IsOutput doc =&gt; doc
</span><a href="GHC.Utils.Outputable.html#empty"><span class="hs-identifier hs-var">Outputable.empty</span></a></span><span>
</span><span id="line-1212"></span><span>
</span><span id="line-1213"></span><span>           </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">return</span></span><span> </span><span class="annot"><a href="#local-6989586621683098120"><span class="hs-identifier hs-type">info</span></a></span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-1214"></span><span>
</span><span id="line-1215"></span><span>    </span><span id="local-6989586621683098121"><span class="annot"><span class="annottext">not_fun :: TcSigmaType -&gt; Bool
</span><a href="#local-6989586621683098121"><span class="hs-identifier hs-var hs-var">not_fun</span></a></span></span><span> </span><span id="local-6989586621683098126"><span class="annot"><span class="annottext">TcSigmaType
</span><a href="#local-6989586621683098126"><span class="hs-identifier hs-var">ty</span></a></span></span><span>   </span><span class="hs-comment">-- ty is definitely not an arrow type,</span><span>
</span><span id="line-1216"></span><span>                 </span><span class="hs-comment">-- and cannot conceivably become one</span><span>
</span><span id="line-1217"></span><span>      </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">HasDebugCallStack =&gt; TcSigmaType -&gt; Maybe (TyCon, [TcSigmaType])
TcSigmaType -&gt; Maybe (TyCon, [TcSigmaType])
</span><a href="GHC.Core.Type.html#tcSplitTyConApp_maybe"><span class="hs-identifier hs-var">tcSplitTyConApp_maybe</span></a></span><span> </span><span class="annot"><span class="annottext">TcSigmaType
</span><a href="#local-6989586621683098126"><span class="hs-identifier hs-var">ty</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-1218"></span><span>          </span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span class="hs-special">(</span><span id="local-6989586621683098127"><span class="annot"><span class="annottext">TyCon
</span><a href="#local-6989586621683098127"><span class="hs-identifier hs-var">tc</span></a></span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">[TcSigmaType]
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">TyCon -&gt; Bool
</span><a href="GHC.Core.TyCon.html#isAlgTyCon"><span class="hs-identifier hs-var">isAlgTyCon</span></a></span><span> </span><span class="annot"><span class="annottext">TyCon
</span><a href="#local-6989586621683098127"><span class="hs-identifier hs-var">tc</span></a></span><span>
</span><span id="line-1219"></span><span>          </span><span class="annot"><span class="annottext">Maybe (TyCon, [TcSigmaType])
</span><span class="hs-identifier hs-var">Nothing</span></span><span>      </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">False</span></span><span>
</span><span id="line-1220"></span><span>
</span><span id="line-1221"></span><span class="hs-comment">{-
Note [Splitting nested sigma types in mismatched function types]
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
When one applies a function to too few arguments, GHC tries to determine this
fact if possible so that it may give a helpful error message. It accomplishes
this by checking if the type of the applied function has more argument types
than supplied arguments.

Previously, GHC computed the number of argument types through tcSplitSigmaTy.
This is incorrect in the face of nested foralls, however!
This caused Ticket #13311, for instance:

  f :: forall a. (Monoid a) =&gt; Int -&gt; forall b. (Monoid b) =&gt; Maybe a -&gt; Maybe b

If one uses `f` like so:

  do { f; putChar 'a' }

Then tcSplitSigmaTy will decompose the type of `f` into:

  Tyvars: [a]
  Context: (Monoid a)
  Argument types: []
  Return type: Int -&gt; forall b. Monoid b =&gt; Maybe a -&gt; Maybe b

That is, it will conclude that there are *no* argument types, and since `f`
was given no arguments, it won't print a helpful error message. On the other
hand, tcSplitNestedSigmaTys correctly decomposes `f`'s type down to:

  Tyvars: [a, b]
  Context: (Monoid a, Monoid b)
  Argument types: [Int, Maybe a]
  Return type: Maybe b

So now GHC recognizes that `f` has one more argument type than it was actually
provided.

Notice that tcSplitNestedSigmaTys looks through function arrows too, regardless
of simple/deep subsumption.  Here we are concerned only whether there is a
mis-match in the number of value arguments.
-}</span><span>
</span><span id="line-1262"></span><span>
</span><span id="line-1263"></span><span>
</span><span id="line-1264"></span><span class="annot"><span class="hs-comment">{- *********************************************************************
*                                                                      *
             Misc utility functions
*                                                                      *
********************************************************************* -}</span></span><span>
</span><span id="line-1269"></span><span>
</span><span id="line-1270"></span><span id="local-6989586621683097010"><span class="annot"><a href="GHC.Tc.Gen.Head.html#addStmtCtxt"><span class="hs-identifier hs-type">addStmtCtxt</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Language.Haskell.Syntax.Expr.html#ExprStmt"><span class="hs-identifier hs-type">ExprStmt</span></a></span><span> </span><span class="annot"><a href="GHC.Hs.Extension.html#GhcRn"><span class="hs-identifier hs-type">GhcRn</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#TcRn"><span class="hs-identifier hs-type">TcRn</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683097010"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#TcRn"><span class="hs-identifier hs-type">TcRn</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683097010"><span class="hs-identifier hs-type">a</span></a></span></span><span>
</span><span id="line-1271"></span><span id="addStmtCtxt"><span class="annot"><span class="annottext">addStmtCtxt :: forall a. ExprStmt (GhcPass 'Renamed) -&gt; TcRn a -&gt; TcRn a
</span><a href="GHC.Tc.Gen.Head.html#addStmtCtxt"><span class="hs-identifier hs-var hs-var">addStmtCtxt</span></a></span></span><span> </span><span id="local-6989586621683098139"><span class="annot"><span class="annottext">ExprStmt (GhcPass 'Renamed)
</span><a href="#local-6989586621683098139"><span class="hs-identifier hs-var">stmt</span></a></span></span><span> </span><span id="local-6989586621683098140"><span class="annot"><span class="annottext">TcRn a
</span><a href="#local-6989586621683098140"><span class="hs-identifier hs-var">thing_inside</span></a></span></span><span>
</span><span id="line-1272"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621683098141"><span class="annot"><span class="annottext">err_doc :: SDoc
</span><a href="#local-6989586621683098141"><span class="hs-identifier hs-var hs-var">err_doc</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">HsStmtContextRn -&gt; ExprStmt (GhcPass 'Renamed) -&gt; SDoc
</span><a href="#local-6989586621683098142"><span class="hs-identifier hs-var">pprStmtInCtxt</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">HsDoFlavour -&gt; HsStmtContext (GenLocated SrcSpanAnnN Name)
forall fn. HsDoFlavour -&gt; HsStmtContext fn
</span><a href="Language.Haskell.Syntax.Expr.html#HsDoStmt"><span class="hs-identifier hs-var">HsDoStmt</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Maybe ModuleName -&gt; HsDoFlavour
</span><a href="Language.Haskell.Syntax.Expr.html#DoExpr"><span class="hs-identifier hs-var">DoExpr</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe ModuleName
forall a. Maybe a
</span><span class="hs-identifier hs-var">Nothing</span></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">ExprStmt (GhcPass 'Renamed)
</span><a href="#local-6989586621683098139"><span class="hs-identifier hs-var">stmt</span></a></span><span>
</span><span id="line-1273"></span><span>       </span><span class="annot"><span class="annottext">SDoc -&gt; TcRn a -&gt; TcRn a
forall a. SDoc -&gt; TcM a -&gt; TcM a
</span><a href="GHC.Tc.Utils.Monad.html#addErrCtxt"><span class="hs-identifier hs-var">addErrCtxt</span></a></span><span> </span><span class="annot"><span class="annottext">SDoc
</span><a href="#local-6989586621683098141"><span class="hs-identifier hs-var">err_doc</span></a></span><span> </span><span class="annot"><span class="annottext">TcRn a
</span><a href="#local-6989586621683098140"><span class="hs-identifier hs-var">thing_inside</span></a></span><span>
</span><span id="line-1274"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-1275"></span><span>    </span><span class="annot"><a href="#local-6989586621683098142"><span class="hs-identifier hs-type">pprStmtInCtxt</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Hs.Expr.html#HsStmtContextRn"><span class="hs-identifier hs-type">HsStmtContextRn</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Language.Haskell.Syntax.Expr.html#StmtLR"><span class="hs-identifier hs-type">StmtLR</span></a></span><span> </span><span class="annot"><a href="GHC.Hs.Extension.html#GhcRn"><span class="hs-identifier hs-type">GhcRn</span></a></span><span> </span><span class="annot"><a href="GHC.Hs.Extension.html#GhcRn"><span class="hs-identifier hs-type">GhcRn</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Language.Haskell.Syntax.Expr.html#LHsExpr"><span class="hs-identifier hs-type">LHsExpr</span></a></span><span> </span><span class="annot"><a href="GHC.Hs.Extension.html#GhcRn"><span class="hs-identifier hs-type">GhcRn</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Utils.Outputable.html#SDoc"><span class="hs-identifier hs-type">SDoc</span></a></span><span>
</span><span id="line-1276"></span><span>    </span><span id="local-6989586621683098142"><span class="annot"><span class="annottext">pprStmtInCtxt :: HsStmtContextRn -&gt; ExprStmt (GhcPass 'Renamed) -&gt; SDoc
</span><a href="#local-6989586621683098142"><span class="hs-identifier hs-var hs-var">pprStmtInCtxt</span></a></span></span><span> </span><span id="local-6989586621683098146"><span class="annot"><span class="annottext">HsStmtContextRn
</span><a href="#local-6989586621683098146"><span class="hs-identifier hs-var">ctxt</span></a></span></span><span> </span><span id="local-6989586621683098147"><span class="annot"><span class="annottext">ExprStmt (GhcPass 'Renamed)
</span><a href="#local-6989586621683098147"><span class="hs-identifier hs-var">stmt</span></a></span></span><span>
</span><span id="line-1277"></span><span>      </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[SDoc] -&gt; SDoc
forall doc. IsDoc doc =&gt; [doc] -&gt; doc
</span><a href="GHC.Utils.Outputable.html#vcat"><span class="hs-identifier hs-var">vcat</span></a></span><span> </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">SDoc -&gt; ThLevel -&gt; SDoc -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#hang"><span class="hs-identifier hs-var">hang</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">String -&gt; SDoc
forall doc. IsLine doc =&gt; String -&gt; doc
</span><a href="GHC.Utils.Outputable.html#text"><span class="hs-identifier hs-var">text</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;In a stmt of&quot;</span></span><span>
</span><span id="line-1278"></span><span>                     </span><span class="annot"><span class="annottext">SDoc -&gt; SDoc -&gt; SDoc
forall doc. IsLine doc =&gt; doc -&gt; doc -&gt; doc
</span><a href="GHC.Utils.Outputable.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">HsStmtContext (GenLocated SrcSpanAnnN Name) -&gt; SDoc
forall fn. Outputable fn =&gt; HsStmtContext fn -&gt; SDoc
</span><a href="GHC.Hs.Expr.html#pprAStmtContext"><span class="hs-identifier hs-var">pprAStmtContext</span></a></span><span> </span><span class="annot"><span class="annottext">HsStmtContextRn
HsStmtContext (GenLocated SrcSpanAnnN Name)
</span><a href="#local-6989586621683098146"><span class="hs-identifier hs-var">ctxt</span></a></span><span> </span><span class="annot"><span class="annottext">SDoc -&gt; SDoc -&gt; SDoc
forall doc. IsLine doc =&gt; doc -&gt; doc -&gt; doc
</span><a href="GHC.Utils.Outputable.html#%3C%3E"><span class="hs-operator hs-var">&lt;&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">SDoc
forall doc. IsLine doc =&gt; doc
</span><a href="GHC.Utils.Outputable.html#colon"><span class="hs-identifier hs-var">colon</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">ThLevel
</span><span class="hs-number">2</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">StmtLR
  (GhcPass 'Renamed)
  (GhcPass 'Renamed)
  (GenLocated SrcSpanAnnA (HsExpr (GhcPass 'Renamed)))
-&gt; SDoc
forall (idL :: Pass) (idR :: Pass) body.
(OutputableBndrId idL, OutputableBndrId idR,
 Anno (StmtLR (GhcPass idL) (GhcPass idR) body) ~ SrcSpanAnnA,
 Outputable body) =&gt;
StmtLR (GhcPass idL) (GhcPass idR) body -&gt; SDoc
</span><a href="GHC.Hs.Expr.html#pprStmt"><span class="hs-identifier hs-var">pprStmt</span></a></span><span> </span><span class="annot"><span class="annottext">ExprStmt (GhcPass 'Renamed)
StmtLR
  (GhcPass 'Renamed)
  (GhcPass 'Renamed)
  (GenLocated SrcSpanAnnA (HsExpr (GhcPass 'Renamed)))
</span><a href="#local-6989586621683098147"><span class="hs-identifier hs-var">stmt</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1279"></span><span>             </span><span class="hs-special">]</span><span>
</span><span id="line-1280"></span><span>
</span><span id="line-1281"></span><span id="local-6989586621683097012"><span class="annot"><a href="GHC.Tc.Gen.Head.html#addExprCtxt"><span class="hs-identifier hs-type">addExprCtxt</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Language.Haskell.Syntax.Expr.html#HsExpr"><span class="hs-identifier hs-type">HsExpr</span></a></span><span> </span><span class="annot"><a href="GHC.Hs.Extension.html#GhcRn"><span class="hs-identifier hs-type">GhcRn</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#TcRn"><span class="hs-identifier hs-type">TcRn</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683097012"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#TcRn"><span class="hs-identifier hs-type">TcRn</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683097012"><span class="hs-identifier hs-type">a</span></a></span></span><span>
</span><span id="line-1282"></span><span id="addExprCtxt"><span class="annot"><span class="annottext">addExprCtxt :: forall a. HsExpr (GhcPass 'Renamed) -&gt; TcRn a -&gt; TcRn a
</span><a href="GHC.Tc.Gen.Head.html#addExprCtxt"><span class="hs-identifier hs-var hs-var">addExprCtxt</span></a></span></span><span> </span><span id="local-6989586621683098151"><span class="annot"><span class="annottext">HsExpr (GhcPass 'Renamed)
</span><a href="#local-6989586621683098151"><span class="hs-identifier hs-var">e</span></a></span></span><span> </span><span id="local-6989586621683098152"><span class="annot"><span class="annottext">TcRn a
</span><a href="#local-6989586621683098152"><span class="hs-identifier hs-var">thing_inside</span></a></span></span><span>
</span><span id="line-1283"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">HsExpr (GhcPass 'Renamed)
</span><a href="#local-6989586621683098151"><span class="hs-identifier hs-var">e</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-1284"></span><span>      </span><span class="annot"><a href="Language.Haskell.Syntax.Expr.html#HsUnboundVar"><span class="hs-identifier hs-type">HsUnboundVar</span></a></span><span> </span><span class="hs-special">{</span><span class="hs-special">}</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">TcRn a
</span><a href="#local-6989586621683098152"><span class="hs-identifier hs-var">thing_inside</span></a></span><span>
</span><span id="line-1285"></span><span>      </span><span class="annot"><span class="annottext">HsExpr (GhcPass 'Renamed)
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">SDoc -&gt; TcRn a -&gt; TcRn a
forall a. SDoc -&gt; TcM a -&gt; TcM a
</span><a href="GHC.Tc.Utils.Monad.html#addErrCtxt"><span class="hs-identifier hs-var">addErrCtxt</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">HsExpr (GhcPass 'Renamed) -&gt; SDoc
</span><a href="GHC.Tc.Gen.Head.html#exprCtxt"><span class="hs-identifier hs-var">exprCtxt</span></a></span><span> </span><span class="annot"><span class="annottext">HsExpr (GhcPass 'Renamed)
</span><a href="#local-6989586621683098151"><span class="hs-identifier hs-var">e</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">TcRn a
</span><a href="#local-6989586621683098152"><span class="hs-identifier hs-var">thing_inside</span></a></span><span>
</span><span id="line-1286"></span><span>   </span><span class="hs-comment">-- The HsUnboundVar special case addresses situations like</span><span>
</span><span id="line-1287"></span><span>   </span><span class="hs-comment">--    f x = _</span><span>
</span><span id="line-1288"></span><span>   </span><span class="hs-comment">-- when we don't want to say &quot;In the expression: _&quot;,</span><span>
</span><span id="line-1289"></span><span>   </span><span class="hs-comment">-- because it is mentioned in the error message itself</span><span>
</span><span id="line-1290"></span><span>
</span><span id="line-1291"></span><span class="annot"><a href="GHC.Tc.Gen.Head.html#exprCtxt"><span class="hs-identifier hs-type">exprCtxt</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Language.Haskell.Syntax.Expr.html#HsExpr"><span class="hs-identifier hs-type">HsExpr</span></a></span><span> </span><span class="annot"><a href="GHC.Hs.Extension.html#GhcRn"><span class="hs-identifier hs-type">GhcRn</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Utils.Outputable.html#SDoc"><span class="hs-identifier hs-type">SDoc</span></a></span><span>
</span><span id="line-1292"></span><span id="exprCtxt"><span class="annot"><span class="annottext">exprCtxt :: HsExpr (GhcPass 'Renamed) -&gt; SDoc
</span><a href="GHC.Tc.Gen.Head.html#exprCtxt"><span class="hs-identifier hs-var hs-var">exprCtxt</span></a></span></span><span> </span><span id="local-6989586621683098155"><span class="annot"><span class="annottext">HsExpr (GhcPass 'Renamed)
</span><a href="#local-6989586621683098155"><span class="hs-identifier hs-var">expr</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">SDoc -&gt; ThLevel -&gt; SDoc -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#hang"><span class="hs-identifier hs-var">hang</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">String -&gt; SDoc
forall doc. IsLine doc =&gt; String -&gt; doc
</span><a href="GHC.Utils.Outputable.html#text"><span class="hs-identifier hs-var">text</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;In the expression:&quot;</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">ThLevel
</span><span class="hs-number">2</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">HsExpr (GhcPass 'Renamed) -&gt; SDoc
forall a. Outputable a =&gt; a -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">HsExpr (GhcPass 'Renamed) -&gt; HsExpr (GhcPass 'Renamed)
forall (p :: Pass). HsExpr (GhcPass p) -&gt; HsExpr (GhcPass p)
</span><a href="GHC.Hs.Expr.html#stripParensHsExpr"><span class="hs-identifier hs-var">stripParensHsExpr</span></a></span><span> </span><span class="annot"><span class="annottext">HsExpr (GhcPass 'Renamed)
</span><a href="#local-6989586621683098155"><span class="hs-identifier hs-var">expr</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-1293"></span></pre></body></html>